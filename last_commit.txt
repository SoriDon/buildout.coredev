Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-12-02T10:49:37+01:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/ad873f96293dce3d908f4616983da4dde60462d0

fix: getIcon for archetypes

Files changed:
M CHANGES.rst
M Products/CMFPlone/CatalogTool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c0cebce..85a3e7e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -75,6 +75,9 @@ Fixes:
   https://github.com/plone/Products.CMFPlone/issues/1226
   [fgrcon]
 
+- Also remove deprecated icons for archetypes
+  [Gagaro]
+
 - Fixed white space pep8 warnings.
   [maurits]
 
diff --git a/Products/CMFPlone/CatalogTool.py b/Products/CMFPlone/CatalogTool.py
index b73d446..87c902d 100644
--- a/Products/CMFPlone/CatalogTool.py
+++ b/Products/CMFPlone/CatalogTool.py
@@ -256,8 +256,16 @@ def is_default_page(obj):
 
 @indexer(Interface)
 def getIcon(obj):
-    """Make sure we index icon relative to portal"""
-    return obj.getIcon(True)
+    """
+    geticon redefined in Plone > 5.0
+    see https://github.com/plone/Products.CMFPlone/issues/1226
+
+    reuse of metadata field,
+    now used for showing thumbs in content listings etc.
+    when obj is an image or has a lead image
+    or has an image field with name 'image': true else false
+    """
+    return bool(getattr(obj.aq_base, 'image', False))
 
 
 @indexer(Interface)


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-12-03T14:44:22+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/530ebe6d530d9bc1de2a8846d08a9c6f55a71fdf

Merge pull request #1271 from plone/fix-geticon-archetypes

fix: getIcon for archetypes

Files changed:
M CHANGES.rst
M Products/CMFPlone/CatalogTool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c0cebce..85a3e7e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -75,6 +75,9 @@ Fixes:
   https://github.com/plone/Products.CMFPlone/issues/1226
   [fgrcon]
 
+- Also remove deprecated icons for archetypes
+  [Gagaro]
+
 - Fixed white space pep8 warnings.
   [maurits]
 
diff --git a/Products/CMFPlone/CatalogTool.py b/Products/CMFPlone/CatalogTool.py
index b73d446..87c902d 100644
--- a/Products/CMFPlone/CatalogTool.py
+++ b/Products/CMFPlone/CatalogTool.py
@@ -256,8 +256,16 @@ def is_default_page(obj):
 
 @indexer(Interface)
 def getIcon(obj):
-    """Make sure we index icon relative to portal"""
-    return obj.getIcon(True)
+    """
+    geticon redefined in Plone > 5.0
+    see https://github.com/plone/Products.CMFPlone/issues/1226
+
+    reuse of metadata field,
+    now used for showing thumbs in content listings etc.
+    when obj is an image or has a lead image
+    or has an image field with name 'image': true else false
+    """
+    return bool(getattr(obj.aq_base, 'image', False))
 
 
 @indexer(Interface)


