Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-12T01:47:10+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/bed77586e419fb8beb8674c9f209b7f1ac50aa2a

Remove AT code from TOC viewlet.

Files changed:
A news/rm-at-code-from-toc.bugfix
M plone/app/layout/viewlets/common.py

b'diff --git a/news/rm-at-code-from-toc.bugfix b/news/rm-at-code-from-toc.bugfix\nnew file mode 100644\nindex 00000000..5cb7971e\n--- /dev/null\n+++ b/news/rm-at-code-from-toc.bugfix\n@@ -0,0 +1,2 @@\n+Remove Archetypes code from TOC viewlet.\n+@jensens\ndiff --git a/plone/app/layout/viewlets/common.py b/plone/app/layout/viewlets/common.py\nindex 61a62774..ac026b3f 100644\n--- a/plone/app/layout/viewlets/common.py\n+++ b/plone/app/layout/viewlets/common.py\n@@ -158,19 +158,7 @@ class TableOfContentsViewlet(ViewletBase):\n     index = ViewPageTemplateFile("toc.pt")\n \n     def update(self):\n-        obj = aq_base(self.context)\n-        getTableContents = getattr(obj, "getTableContents", None)\n-        self.enabled = False\n-        if getTableContents is not None:\n-            try:\n-                self.enabled = getTableContents()\n-            except KeyError:\n-                # schema not updated yet\n-                self.enabled = False\n-        # handle dexterity-behavior\n-        toc = getattr(obj, "table_of_contents", None)\n-        if toc is not None:\n-            self.enabled = toc\n+        self.enabled = getattr(aq_base(self.context), "table_of_contents", False)\n \n \n class SiteActionsViewlet(ViewletBase):\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-12T01:47:43+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/78b50e9eddc9a9c06fdabc6402d47bbaa138f752

git ignore .tox

Files changed:
M .gitignore

b'diff --git a/.gitignore b/.gitignore\nindex 562df3ee..80c62af3 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -25,3 +25,4 @@ docs/make.bat\n docs/doctrees\n docs/html\n .DS_Store\n+.tox\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-12T12:55:44+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/3f86262860fb1d6c072fc08191863caf4140422c

Merge pull request #335 from plone/rm-at-code-from-toc

Remove Archetypes code from TOC viewlet.

Files changed:
A news/rm-at-code-from-toc.bugfix
M .gitignore
M plone/app/layout/viewlets/common.py

b'diff --git a/.gitignore b/.gitignore\nindex 562df3ee..80c62af3 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -25,3 +25,4 @@ docs/make.bat\n docs/doctrees\n docs/html\n .DS_Store\n+.tox\ndiff --git a/news/rm-at-code-from-toc.bugfix b/news/rm-at-code-from-toc.bugfix\nnew file mode 100644\nindex 00000000..5cb7971e\n--- /dev/null\n+++ b/news/rm-at-code-from-toc.bugfix\n@@ -0,0 +1,2 @@\n+Remove Archetypes code from TOC viewlet.\n+@jensens\ndiff --git a/plone/app/layout/viewlets/common.py b/plone/app/layout/viewlets/common.py\nindex 61a62774..ac026b3f 100644\n--- a/plone/app/layout/viewlets/common.py\n+++ b/plone/app/layout/viewlets/common.py\n@@ -158,19 +158,7 @@ class TableOfContentsViewlet(ViewletBase):\n     index = ViewPageTemplateFile("toc.pt")\n \n     def update(self):\n-        obj = aq_base(self.context)\n-        getTableContents = getattr(obj, "getTableContents", None)\n-        self.enabled = False\n-        if getTableContents is not None:\n-            try:\n-                self.enabled = getTableContents()\n-            except KeyError:\n-                # schema not updated yet\n-                self.enabled = False\n-        # handle dexterity-behavior\n-        toc = getattr(obj, "table_of_contents", None)\n-        if toc is not None:\n-            self.enabled = toc\n+        self.enabled = getattr(aq_base(self.context), "table_of_contents", False)\n \n \n class SiteActionsViewlet(ViewletBase):\n'

