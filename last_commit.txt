Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2022-01-15T09:49:36+01:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/Products.CMFEditions/commit/ec795a3a8cf321680f515ace7a0cac8eb41cb7d1

Use the human_readable_size method from the @@plone view

Fixes #84

Files changed:
A news/84.breaking
M Products/CMFEditions/browser/configure.zcml
M Products/CMFEditions/browser/templates/version_image_view.pt
M Products/CMFEditions/browser/views.py

b'diff --git a/Products/CMFEditions/browser/configure.zcml b/Products/CMFEditions/browser/configure.zcml\nindex 8dce428..ffe9c05 100644\n--- a/Products/CMFEditions/browser/configure.zcml\n+++ b/Products/CMFEditions/browser/configure.zcml\n@@ -35,7 +35,6 @@\n     <browser:page\n         for="*"\n         name="version_file_view"\n-        class=".views.VersionView"\n         template="templates/version_file_view.pt"\n         permission="zope2.View"\n         />\n@@ -43,7 +42,6 @@\n     <browser:page\n         for="*"\n         name="version_image_view"\n-        class=".views.VersionView"\n         template="templates/version_image_view.pt"\n         permission="zope2.View"\n         />\n@@ -100,4 +98,3 @@\n         />\n \n </configure>\n-\ndiff --git a/Products/CMFEditions/browser/templates/version_image_view.pt b/Products/CMFEditions/browser/templates/version_image_view.pt\nindex e6295a6..5ca0425 100644\n--- a/Products/CMFEditions/browser/templates/version_image_view.pt\n+++ b/Products/CMFEditions/browser/templates/version_image_view.pt\n@@ -7,7 +7,8 @@\n \n <metal:main fill-slot="main">\n     <tal:main-macro metal:define-macro="main"\n-                    tal:define="size here/size;\n+                    tal:define="plone_view here/@@plone;\n+                                size python:plone_view.human_readable_size(here.get_size());\n                                 here_url context/absolute_url;">\n \n         <div id="content-core">\n@@ -25,12 +26,7 @@\n             <span class="discreet visualNoPrint">\n             &mdash;\n                 <span i18n:translate="label_size">Size</span>:\n-\n-                <span tal:define="size python:view.human_readable_size(here.get_size())"\n-                      tal:content="size">\n-                    File size\n-                </span>\n-\n+                ${size}\n                 <span tal:condition="python:test(size, 0, 1)"\n                       i18n:translate="no_image_uploaded">\n                     (No image has been uploaded yet)\n@@ -45,4 +41,3 @@\n </body>\n \n </html>\n-\ndiff --git a/Products/CMFEditions/browser/views.py b/Products/CMFEditions/browser/views.py\nindex 88e4271..cbf7e43 100644\n--- a/Products/CMFEditions/browser/views.py\n+++ b/Products/CMFEditions/browser/views.py\n@@ -10,6 +10,14 @@\n from Products.statusmessages.interfaces import IStatusMessage\n \n import os\n+import zope.deferredimport\n+\n+\n+zope.deferredimport.deprecated(\n+    "This class is deprecated since Plone 6",\n+    VersionView="Products.CMFPlone.browser.ploneview:Plone",\n+)\n+\n \n \n class UpdateVersionOnEditView(BrowserView):\n@@ -92,11 +100,6 @@ def __call__(self):\n         return tag\n \n \n-class VersionView(BrowserView):\n-    def human_readable_size(self):\n-        return human_readable_size\n-\n-\n class VersionsHistoryForm(BrowserView):\n     def checkUpToDate(self, history):\n         """Check if Up To Date.\ndiff --git a/news/84.breaking b/news/84.breaking\nnew file mode 100644\nindex 0000000..3c32125\n--- /dev/null\n+++ b/news/84.breaking\n@@ -0,0 +1,2 @@\n+The VersionView class is deprecated because it contained just one method that is now part of the @@plone view\n+[ale-rt]\n'

Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2022-01-18T10:46:23+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFEditions/commit/b9fa8ed64b2b3cc7657e745facec5e8016061eda

Merge pull request #85 from plone/84-human_readable_size

Use the human_readable_size method from the @@plone view

Files changed:
A news/84.breaking
M Products/CMFEditions/browser/configure.zcml
M Products/CMFEditions/browser/templates/version_image_view.pt
M Products/CMFEditions/browser/views.py

b'diff --git a/Products/CMFEditions/browser/configure.zcml b/Products/CMFEditions/browser/configure.zcml\nindex 8dce428..ffe9c05 100644\n--- a/Products/CMFEditions/browser/configure.zcml\n+++ b/Products/CMFEditions/browser/configure.zcml\n@@ -35,7 +35,6 @@\n     <browser:page\n         for="*"\n         name="version_file_view"\n-        class=".views.VersionView"\n         template="templates/version_file_view.pt"\n         permission="zope2.View"\n         />\n@@ -43,7 +42,6 @@\n     <browser:page\n         for="*"\n         name="version_image_view"\n-        class=".views.VersionView"\n         template="templates/version_image_view.pt"\n         permission="zope2.View"\n         />\n@@ -100,4 +98,3 @@\n         />\n \n </configure>\n-\ndiff --git a/Products/CMFEditions/browser/templates/version_image_view.pt b/Products/CMFEditions/browser/templates/version_image_view.pt\nindex e6295a6..5ca0425 100644\n--- a/Products/CMFEditions/browser/templates/version_image_view.pt\n+++ b/Products/CMFEditions/browser/templates/version_image_view.pt\n@@ -7,7 +7,8 @@\n \n <metal:main fill-slot="main">\n     <tal:main-macro metal:define-macro="main"\n-                    tal:define="size here/size;\n+                    tal:define="plone_view here/@@plone;\n+                                size python:plone_view.human_readable_size(here.get_size());\n                                 here_url context/absolute_url;">\n \n         <div id="content-core">\n@@ -25,12 +26,7 @@\n             <span class="discreet visualNoPrint">\n             &mdash;\n                 <span i18n:translate="label_size">Size</span>:\n-\n-                <span tal:define="size python:view.human_readable_size(here.get_size())"\n-                      tal:content="size">\n-                    File size\n-                </span>\n-\n+                ${size}\n                 <span tal:condition="python:test(size, 0, 1)"\n                       i18n:translate="no_image_uploaded">\n                     (No image has been uploaded yet)\n@@ -45,4 +41,3 @@\n </body>\n \n </html>\n-\ndiff --git a/Products/CMFEditions/browser/views.py b/Products/CMFEditions/browser/views.py\nindex 88e4271..cbf7e43 100644\n--- a/Products/CMFEditions/browser/views.py\n+++ b/Products/CMFEditions/browser/views.py\n@@ -10,6 +10,14 @@\n from Products.statusmessages.interfaces import IStatusMessage\n \n import os\n+import zope.deferredimport\n+\n+\n+zope.deferredimport.deprecated(\n+    "This class is deprecated since Plone 6",\n+    VersionView="Products.CMFPlone.browser.ploneview:Plone",\n+)\n+\n \n \n class UpdateVersionOnEditView(BrowserView):\n@@ -92,11 +100,6 @@ def __call__(self):\n         return tag\n \n \n-class VersionView(BrowserView):\n-    def human_readable_size(self):\n-        return human_readable_size\n-\n-\n class VersionsHistoryForm(BrowserView):\n     def checkUpToDate(self, history):\n         """Check if Up To Date.\ndiff --git a/news/84.breaking b/news/84.breaking\nnew file mode 100644\nindex 0000000..3c32125\n--- /dev/null\n+++ b/news/84.breaking\n@@ -0,0 +1,2 @@\n+The VersionView class is deprecated because it contained just one method that is now part of the @@plone view\n+[ale-rt]\n'

