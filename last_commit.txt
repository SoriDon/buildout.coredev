Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-10-23T08:53:24+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/bdae28bb1f8f4a17013bac254d349d5ef9a5cf0a

Fix test. Testbrowser shows List of textlines as item1\nitem2

Files changed:
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_filter.py

diff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_filter.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_filter.py
index 5769032b9..3447a581d 100644
--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_filter.py
+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_filter.py
@@ -83,15 +83,20 @@ def test_disable_filtering(self):
     def test_nasty_tags(self):
         self.browser.open(
             "%s/@@filter-controlpanel" % self.portal_url)
+        self.assertEqual(
+            self.browser.getControl(name='form.widgets.nasty_tags').value,
+            'style\nobject\nembed\napplet\nscript\nmeta')
         self.browser.getControl(
-            name='form.widgets.nasty_tags'
-        ).value = 'div\r\na'
+            name='form.widgets.nasty_tags').value = 'div\na'
         valid_tags = self.browser.getControl(
             name='form.widgets.valid_tags').value
-        valid_tags = valid_tags.replace('a\r\n', '')
+        self.assertTrue(valid_tags.startswith('a\nabbr\nacronym\naddress'))
+        valid_tags = valid_tags.replace('a\n', '')
         valid_tags = self.browser.getControl(
             name='form.widgets.valid_tags').value = valid_tags
         self.browser.getControl('Save').click()
+        self.assertEqual(self.settings.nasty_tags, [u'div', u'a'])
+        self.assertNotIn(u'a', self.settings.valid_tags)
 
         # test that <a> is filtered
         self.assertFalse(self.settings.disable_filtering)


