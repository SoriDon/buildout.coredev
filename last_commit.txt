Repository: plone.app.layout


Branch: refs/heads/master
Date: 2017-07-03T17:59:00+03:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.layout/commit/99628a7a25155d02e77e8ee16191686131a79e40

move condition up to not show an empty div

Files changed:
M plone/app/layout/viewlets/anontools.pt

diff --git a/plone/app/layout/viewlets/anontools.pt b/plone/app/layout/viewlets/anontools.pt
index 7909e68..3fec0ef 100644
--- a/plone/app/layout/viewlets/anontools.pt
+++ b/plone/app/layout/viewlets/anontools.pt
@@ -1,5 +1,5 @@
-<div id='portal-anontools'>
-  <ul tal:condition="python:view.user_actions and view.anonymous">
+<div id="portal-anontools" tal:condition="python:view.user_actions and view.anonymous">
+  <ul>
     <li>
       <tal:actions repeat="action view/user_actions">
           <a href=""


Repository: plone.app.layout


Branch: refs/heads/master
Date: 2017-07-03T18:05:32+03:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.layout/commit/19fa14ca59823bd11c45823ca41af3e40dc0113b

Added membertools viewlet

Files changed:
A plone/app/layout/viewlets/membertools.pt
M CHANGES.rst
M plone/app/layout/viewlets/configure.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 9f0156e..4fd214d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Added membertools viewlet. If user is not anonymous and toolbar is not visible according to ``is_toolbar_visible`` the viewlet will show at the location of anontools.
+  [agitator]
 
 Bug fixes:
 
diff --git a/plone/app/layout/viewlets/configure.zcml b/plone/app/layout/viewlets/configure.zcml
index a324b8b..ef81421 100644
--- a/plone/app/layout/viewlets/configure.zcml
+++ b/plone/app/layout/viewlets/configure.zcml
@@ -177,6 +177,15 @@
         template="anontools.pt"
         />
 
+    <!-- The member panel (logout, user actions) -->
+    <browser:viewlet
+        name="plone.membertools"
+        manager=".interfaces.IPortalHeader"
+        class=".common.PersonalBarViewlet"
+        permission="zope2.View"
+        template="membertools.pt"
+        />
+
     <!-- The logo -->
     <browser:viewlet
         name="plone.logo"
diff --git a/plone/app/layout/viewlets/membertools.pt b/plone/app/layout/viewlets/membertools.pt
new file mode 100644
index 0000000..8110fa6
--- /dev/null
+++ b/plone/app/layout/viewlets/membertools.pt
@@ -0,0 +1,31 @@
+<div id="portal-membertools-wrapper"
+     i18n:domain="plone"
+     tal:define="toolbar_visible here/@@plone_context_state/is_toolbar_visible;
+                 isAnon view/anonymous;"
+     tal:condition="python:not isAnon and not toolbar_visible">
+
+  <p class="hiddenStructure" i18n:translate="heading_member_tools">Member tools</p>
+
+  <div class="dropdown pull-right" id="portal-membertools"
+      tal:condition="python:view.user_actions and not view.anonymous">
+      <a id="user-name"
+         class="dropdown-toggle" data-toggle="dropdown"
+         tal:attributes="href view/homelink_url">
+         <span tal:replace="view/user_name">John</span>
+         <span class="caret"></span>
+      </a>
+      <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
+          <li tal:repeat="action view/user_actions"
+              tal:attributes="id string:membertools-${action/id}">
+              <a href=""
+                 tal:attributes="href action/href;
+                                 target action/link_target|nothing"
+                 tal:content="action/title"
+                 i18n:translate="">
+                  action title
+              </a>
+          </li>
+      </ul>
+  </div>
+
+</div>


Repository: plone.app.layout


Branch: refs/heads/master
Date: 2017-07-04T11:19:20+03:00
Author: Eric Steele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.app.layout/commit/2f7d4cf0ed9cac82c347957925ced505623a4b6b

Merge pull request #128 from plone/personal-bar

Member bar

Files changed:
A plone/app/layout/viewlets/membertools.pt
M CHANGES.rst
M plone/app/layout/viewlets/anontools.pt
M plone/app/layout/viewlets/configure.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 6606b8e..c6a6552 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Added membertools viewlet. If user is not anonymous and toolbar is not visible according to ``is_toolbar_visible`` the viewlet will show at the location of anontools.
+  [agitator]
 
 Bug fixes:
 
diff --git a/plone/app/layout/viewlets/anontools.pt b/plone/app/layout/viewlets/anontools.pt
index 7909e68..3fec0ef 100644
--- a/plone/app/layout/viewlets/anontools.pt
+++ b/plone/app/layout/viewlets/anontools.pt
@@ -1,5 +1,5 @@
-<div id='portal-anontools'>
-  <ul tal:condition="python:view.user_actions and view.anonymous">
+<div id="portal-anontools" tal:condition="python:view.user_actions and view.anonymous">
+  <ul>
     <li>
       <tal:actions repeat="action view/user_actions">
           <a href=""
diff --git a/plone/app/layout/viewlets/configure.zcml b/plone/app/layout/viewlets/configure.zcml
index a324b8b..ef81421 100644
--- a/plone/app/layout/viewlets/configure.zcml
+++ b/plone/app/layout/viewlets/configure.zcml
@@ -177,6 +177,15 @@
         template="anontools.pt"
         />
 
+    <!-- The member panel (logout, user actions) -->
+    <browser:viewlet
+        name="plone.membertools"
+        manager=".interfaces.IPortalHeader"
+        class=".common.PersonalBarViewlet"
+        permission="zope2.View"
+        template="membertools.pt"
+        />
+
     <!-- The logo -->
     <browser:viewlet
         name="plone.logo"
diff --git a/plone/app/layout/viewlets/membertools.pt b/plone/app/layout/viewlets/membertools.pt
new file mode 100644
index 0000000..8110fa6
--- /dev/null
+++ b/plone/app/layout/viewlets/membertools.pt
@@ -0,0 +1,31 @@
+<div id="portal-membertools-wrapper"
+     i18n:domain="plone"
+     tal:define="toolbar_visible here/@@plone_context_state/is_toolbar_visible;
+                 isAnon view/anonymous;"
+     tal:condition="python:not isAnon and not toolbar_visible">
+
+  <p class="hiddenStructure" i18n:translate="heading_member_tools">Member tools</p>
+
+  <div class="dropdown pull-right" id="portal-membertools"
+      tal:condition="python:view.user_actions and not view.anonymous">
+      <a id="user-name"
+         class="dropdown-toggle" data-toggle="dropdown"
+         tal:attributes="href view/homelink_url">
+         <span tal:replace="view/user_name">John</span>
+         <span class="caret"></span>
+      </a>
+      <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
+          <li tal:repeat="action view/user_actions"
+              tal:attributes="id string:membertools-${action/id}">
+              <a href=""
+                 tal:attributes="href action/href;
+                                 target action/link_target|nothing"
+                 tal:content="action/title"
+                 i18n:translate="">
+                  action title
+              </a>
+          </li>
+      </ul>
+  </div>
+
+</div>


