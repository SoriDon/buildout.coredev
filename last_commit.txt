Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-12-19T22:16:32+01:00
Author: llisa123 (llisa123) <labraham4800@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/acbe19a210ad875fcdfc3b8b102124a31fe3a98b

Scenarios added and fixed timing problems in querystring robot tests.

Files changed:
A news/2489.feature
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex f0e18a6a6..f06598d1f 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -12,55 +12,288 @@ Test Teardown  Run keywords  Plone Test Teardown\n \n *** Test Cases **************************************************************\n \n-Scenario: Location query\n-    [Tags]  unstable\n-    [Documentation]  This sometimes fails with: Element locator \'jquery=:focus\' did not match any elements.\n-    ...              This sometimes fails with: Element locator \'jquery=.pattern-relateditems-tree-select\' did not match any elements.\n+Scenario: Location query Current\n     Given a logged-in site administrator\n     and a bunch of folders\n     and the querystring pattern\n-    When I open the Current operator in the Location criteria\n+    When I activate the operator Current in the criteria Location\n     Then we expect 1 hits\n-    When I open the Parent operator in the Location criteria\n-    Then we expect 3 hits\n-    When I open the Custom operator in the Location criteria\n-    and I search in A subfolder in the related items widget\n+\n+Scenario: Location query Parent\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the operator Parent in the criteria Location\n     Then we expect 3 hits\n-    When I open the Advanced operator in the Location criteria\n+\n+Scenario: Location query Custom\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the operator Custom in the criteria Location\n+    and I search in B subfolder in the related items widget\n+    Then we expect 5 hits\n+\n+Scenario: Location query Advanced\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the operator Advanced in the criteria Location\n     Then I expect to be in Advanced mode\n-    When I open the Simple operator in the Location criteria\n+\n+Scenario: Location query Simple\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the operator Simple in the criteria Location\n     Then I expect to be in Simple mode\n \n+Scenario: Title query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I open the criteria Title\n+    and I search for A\n+    Then we expect 1 hits\n+\n+Scenario: Description query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I open the criteria Description\n+    and I search for a\n+    Then we expect 1 hits\n+\n+Scenario: Searchable text query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I open the criteria Searchable text\n+    and I search for a\n+    and Click Element  css=div.querystring-preview\n+    Then we expect 2 hits\n+    When I open the criteria Searchable text\n+    and I search for d\n+    Then we expect 1 hits\n+\n+Scenario: Tag query one\n+    # tests the "Matches any of" option\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the default operator in the criteria Tag\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    Then we expect 4 hits\n+    When I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    Then we expect 4 hits\n+    When I delete my selection\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    Then we expect 1 hits\n+    When I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    Then we expect 2 hits\n+\n+Scenario Tag query two\n+    # tests the "Matches all of" option\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I expect an empty result after open the operator Matches all of in the criteria Tag\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    Then we expect 4 hits\n+    When and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    Then we expect 3 hits\n+    When I delete my selection\n+    and and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    Then we expect 1 hits\n+    When and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    Then we expect 1 hits\n+\n+\n+Scenario Event end date query\n+    Given a logged-in manager\n+    and a bunch of events\n+    and the querystring pattern\n+    # Before date\n+    When I activate the default operator in the criteria Event end date\n+    and Execute Javascript  $(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\').pickadate(\'picker\').set(\'select\', new Date(2018, 7, 1))\n+    Then we do not expect any hits\n+\n+    # When Execute Javascript  $(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\').pickadate(\'picker\').set(\'select\', new Date(2018, 7, 6))\n+\n+    # !!! BUG in plone.app.robotframework?\n+    # File "~/.buildout/shared-eggs/plone.app.event-3.2.1-py3.6.egg/plone/app/event/recurrence.py", line 77, in occurrences\n+    #     duration = event_end - event_start\n+    # TypeError: can\'t subtract offset-naive and offset-aware datetimes\n+\n+    # for some reason the timezone is not applied correctly here. this is\n+    # probably a problem with plone.app.robotframework.content creation mechanism.\n+    # actually we got 3 hits, but right would be:\n+    # Then we expect 2 hits\n+    # Between dates\n+    # When I activate the operator Between dates in the criteria Event end date\n+    # and Execute Javascript  $($(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\')[0]).pickadate(\'picker\').set(\'select\', new Date(2018, 7, 1))\n+    # and Execute Javascript  $($(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\')[1]).pickadate(\'picker\').set(\'select\', new Date(2018, 7, 7))\n+    # Then we expect 3 hits\n+    # When Execute Javascript  $($(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\')[0]).pickadate(\'picker\').set(\'select\', new Date(2018, 7, 6))\n+    # and Execute Javascript  $($(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\')[1]).pickadate(\'picker\').set(\'select\', new Date(2018, 7, 8))\n+    # Then we expect 2 hits\n+\n+Scenario Short name (id) query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I open the criteria Short name (id)\n+    And I search for a\n+    Then Page Should Contain  A\n+\n+Scenario Review state query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I open the criteria Review State\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-private\n+    and Click Element  css=li.select2-option-private\n+    Then we expect 7 hits\n+\n+Scenario Type query\n+    Given a logged-in site administrator\n+    and a bunch of events\n+    and the querystring pattern\n+    When I open the criteria Type\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-event\n+    and Click Element  css=li.select2-option-event\n+    Then we expect 4 hits\n+    When I delete one selection\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-file\n+    and Click Element  css=li.select2-option-file\n+    Then we do not expect any hits\n+    When I delete one selection\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-folder\n+    and Click Element  css=li.select2-option-folder\n+    Then we expect 5 hits\n+    When I delete one selection\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-link\n+    and Click Element  css=li.select2-option-link\n+    Then we expect 1 hits\n+    When I delete one selection\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-document\n+    and Click Element  css=li.select2-option-document\n+    Then we expect 2 hits\n+    When I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-link\n+    and Click Element  css=li.select2-option-link\n+    Then we expect 3 hits\n+\n+Scenario Creator query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the default operator in the criteria Creator\n+    Then we expect 6 hits\n+\n+\n *** Keywords ****************************************************************\n \n+save\n+    Click Link  css=input#form-buttons-save\n+\n the querystring pattern\n     #We go the /a to give more useful query results\n     Go to  ${PLONE_URL}/a/++add++Collection\n     Wait until page contains element  css=.pat-querystring\n     Given querystring pattern loaded\n+    # for some unknown reason unload protection pops up, but only in robot tests\n+    Execute Javascript  $(window).unbind(\'beforeunload\')\n \n querystring pattern loaded\n     Wait For Condition  return window.jQuery(\'.querystring-criteria-remove\').size() > 0\n \n a bunch of folders\n     #We create enough items to give meaningful test results\n-    ${F1}=  Create content  type=Folder  title=A\n-    ${F2}=  Create content  type=Folder  title=B  container=${F1}\n-    ${F3}=  Create content  type=Folder  title=C  container=${F2}\n-    Create content  type=Document  title=D  container=${F3}\n+    ${F1}=  Create content  type=Folder  title=A  description=a  subject=onep\n+    ${F2}=  Create content  type=Folder  title=B  description=b  subject=one  container=${F1}\n+    ${F3}=  Create content  type=Folder  title=C  description=and  subject=on  container=${F2}\n+    Create content  type=Document  title=D  subject=o  container=${F3}\n+    Create content  type=Document  title=E  container=${F3}\n+    Create content  type=Link  title=Link  remoteUrl=/front-page  container=${F3}\n+    [Return]  ${F1}\n \n-I open the ${OPERATOR} operator in the ${CRITERIA} criteria\n+a bunch of events\n+    ${F1}=  a bunch of folders\n+    Create content  type=Event  title=Event1  start=2018-08-01 15:00  end=2018-08-01 17:00  container=${F1}\n+    Create content  type=Event  title=Event2  start=2018-08-05 16:00  end=2018-08-07 11:00  container=${F1}\n+    Create content  type=Event  title=Event3  start=2018-08-05 16:30  open_end-empty-marker=1  container=${F1}\n+    Create content  type=Event  title=Event4  start=2018-08-06  end=2018-08-06  whole_day-empty-marker=1  container=${F1}\n+\n+I activate the default operator in the criteria ${CRITERIA}\n+    open the select box titled index\n+    select index type ${CRITERIA}\n+\n+I activate the operator ${OPERATOR} in the criteria ${CRITERIA}\n     open the select box titled index\n     select index type ${CRITERIA}\n+    mark results\n     open the select box titled operator\n     select index type ${OPERATOR}\n \n+I expect an empty result after open the operator ${OPERATOR} in the criteria ${CRITERIA}\n+    open the select box titled index\n+    select index type ${CRITERIA}\n+    sleep  0.75\n+    Wait for condition  return $("dl.searchResults").length == 0\n+    open the select box titled operator\n+    select index type ${OPERATOR}\n+\n+I open the criteria ${CRITERIA}\n+    open the select box titled index\n+    select index type ${CRITERIA}\n+\n+I search for ${KEYWORD}\n+    Wait Until Element Is Visible  css=input.querystring-criteria-value-StringWidget\n+    Click Element  css=input.querystring-criteria-value-StringWidget\n+    Input Text  css=input.querystring-criteria-value-StringWidget  ${KEYWORD}\n+    Click Element  css=div#content-core\n+\n+I open the Selection Widget\n+    wait until element is visible  css=div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n+    click element  css=div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n+\n+I delete one selection\n+    #deletes one element\n+    Click Element  css=a.select2-search-choice-close\n+\n+I delete my selection\n+    #deletes two elements\n+    Click Element  css=a.select2-search-choice-close\n+    Click Element  css=a.select2-search-choice-close\n+\n I search in ${NAME} subfolder in the related items widget\n-    Click Element  jquery=.pattern-relateditems-tree-select\n-    Wait Until Element Is Visible  jquery=.pat-tree li.jqtree_common:contains("${NAME}") .pattern-relateditems-result-browse\n-    Click Element  jquery=.pat-tree li.jqtree_common:contains("${NAME}") .pattern-relateditems-result-browse\n-    Wait Until Element Is Visible  css=.pattern-relateditems-result-select\n-    Click Element  css=.pattern-relateditems-result-select\n+    mark results\n+    Click Element  css=ul.select2-choices\n+    Wait Until Page Contains  ${NAME}\n+    Click Element  //a[contains(concat(\' \', normalize-space(@class), \' \'), \' pattern-relateditems-result-select \')]//span[contains(text(),\'${NAME}\')]\n \n I expect to be in Advanced mode\n     open the select box titled operator\n@@ -68,8 +301,8 @@ I expect to be in Advanced mode\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Absolute Path\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Relative Path\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Simple Mode\n-    Click Element  css=body\n-    Sleep  1\n+    Click Element  css=div#select2-drop-mask\n+    Wait Until Element Is Not Visible  css=div#select2-drop-mask\n \n I expect to be in Simple mode\n     open the select box titled operator\n@@ -77,7 +310,8 @@ I expect to be in Simple mode\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Parent (../)\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Current (./)\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Advanced Mode\n-    Click Element  css=body\n+    Click Element  css=div#select2-drop-mask\n+    Wait Until Element Is Not Visible  css=div#select2-drop-mask\n \n open the select box titled ${NAME}\n     Click Element  css=body\n@@ -90,6 +324,21 @@ select index type ${INDEX}\n we expect ${NUM} hits\n     #This assumes we have the 2 "Test document" and "Test folder" items from the\n     #robot setup, as well as the 4 additional items from the "a bunch of folders" macro\n-    Sleep   1\n-    ${hits}=    Execute Javascript  return window.jQuery(\'.searchResults > dd\').size().toString();\n-    Should Be Equal     ${hits}     ${NUM}\n+    #works only for ${NUM} > 0\n+    Wait until result is no longer marked\n+    ${hits}=  Execute Javascript  return $(\'.searchResults > dd\').length\n+    Should Be Equal As Integers  ${hits}  ${NUM}\n+    mark results\n+\n+we do not expect any hits\n+    Wait Until Element Contains  css=div#search-results  No results were found.\n+\n+a logged-in manager\n+    Enable autologin as  Manager  Site Administrator  Contributor  Reviewer\n+\n+mark results\n+    Wait for condition  return $("dl.searchResults").length > 0\n+    Execute Javascript  $("dl.searchResults").attr("marker", "marked")\n+\n+wait until result is no longer marked\n+    Wait for condition  return $("dl.searchResults").length > 0 && $("dl.searchResults").attr("marker") != "marked"\n\\ No newline at end of file\ndiff --git a/news/2489.feature b/news/2489.feature\nnew file mode 100644\nindex 000000000..465dc5c9c\n--- /dev/null\n+++ b/news/2489.feature\n@@ -0,0 +1,3 @@\n+- New robot tests for querystring in Collection type.\n+  Now almost all querystring types are robot tested.\n+  [llisa123]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-12-20T10:29:13+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/9b45ea4d165b0b99b9dfb6eba2297ec36e4eaf91

Merge pull request #2489 from plone/llisa123-add-querystring-robottests

Scenarios added and fixed timing problems in querystring robot tests.

Files changed:
A news/2489.feature
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex f0e18a6a6..f06598d1f 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -12,55 +12,288 @@ Test Teardown  Run keywords  Plone Test Teardown\n \n *** Test Cases **************************************************************\n \n-Scenario: Location query\n-    [Tags]  unstable\n-    [Documentation]  This sometimes fails with: Element locator \'jquery=:focus\' did not match any elements.\n-    ...              This sometimes fails with: Element locator \'jquery=.pattern-relateditems-tree-select\' did not match any elements.\n+Scenario: Location query Current\n     Given a logged-in site administrator\n     and a bunch of folders\n     and the querystring pattern\n-    When I open the Current operator in the Location criteria\n+    When I activate the operator Current in the criteria Location\n     Then we expect 1 hits\n-    When I open the Parent operator in the Location criteria\n-    Then we expect 3 hits\n-    When I open the Custom operator in the Location criteria\n-    and I search in A subfolder in the related items widget\n+\n+Scenario: Location query Parent\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the operator Parent in the criteria Location\n     Then we expect 3 hits\n-    When I open the Advanced operator in the Location criteria\n+\n+Scenario: Location query Custom\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the operator Custom in the criteria Location\n+    and I search in B subfolder in the related items widget\n+    Then we expect 5 hits\n+\n+Scenario: Location query Advanced\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the operator Advanced in the criteria Location\n     Then I expect to be in Advanced mode\n-    When I open the Simple operator in the Location criteria\n+\n+Scenario: Location query Simple\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the operator Simple in the criteria Location\n     Then I expect to be in Simple mode\n \n+Scenario: Title query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I open the criteria Title\n+    and I search for A\n+    Then we expect 1 hits\n+\n+Scenario: Description query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I open the criteria Description\n+    and I search for a\n+    Then we expect 1 hits\n+\n+Scenario: Searchable text query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I open the criteria Searchable text\n+    and I search for a\n+    and Click Element  css=div.querystring-preview\n+    Then we expect 2 hits\n+    When I open the criteria Searchable text\n+    and I search for d\n+    Then we expect 1 hits\n+\n+Scenario: Tag query one\n+    # tests the "Matches any of" option\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the default operator in the criteria Tag\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    Then we expect 4 hits\n+    When I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    Then we expect 4 hits\n+    When I delete my selection\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    Then we expect 1 hits\n+    When I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    Then we expect 2 hits\n+\n+Scenario Tag query two\n+    # tests the "Matches all of" option\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I expect an empty result after open the operator Matches all of in the criteria Tag\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    Then we expect 4 hits\n+    When and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    Then we expect 3 hits\n+    When I delete my selection\n+    and and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    Then we expect 1 hits\n+    When and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    Then we expect 1 hits\n+\n+\n+Scenario Event end date query\n+    Given a logged-in manager\n+    and a bunch of events\n+    and the querystring pattern\n+    # Before date\n+    When I activate the default operator in the criteria Event end date\n+    and Execute Javascript  $(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\').pickadate(\'picker\').set(\'select\', new Date(2018, 7, 1))\n+    Then we do not expect any hits\n+\n+    # When Execute Javascript  $(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\').pickadate(\'picker\').set(\'select\', new Date(2018, 7, 6))\n+\n+    # !!! BUG in plone.app.robotframework?\n+    # File "~/.buildout/shared-eggs/plone.app.event-3.2.1-py3.6.egg/plone/app/event/recurrence.py", line 77, in occurrences\n+    #     duration = event_end - event_start\n+    # TypeError: can\'t subtract offset-naive and offset-aware datetimes\n+\n+    # for some reason the timezone is not applied correctly here. this is\n+    # probably a problem with plone.app.robotframework.content creation mechanism.\n+    # actually we got 3 hits, but right would be:\n+    # Then we expect 2 hits\n+    # Between dates\n+    # When I activate the operator Between dates in the criteria Event end date\n+    # and Execute Javascript  $($(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\')[0]).pickadate(\'picker\').set(\'select\', new Date(2018, 7, 1))\n+    # and Execute Javascript  $($(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\')[1]).pickadate(\'picker\').set(\'select\', new Date(2018, 7, 7))\n+    # Then we expect 3 hits\n+    # When Execute Javascript  $($(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\')[0]).pickadate(\'picker\').set(\'select\', new Date(2018, 7, 6))\n+    # and Execute Javascript  $($(\'.querystring-criteria-value .pattern-pickadate-date-wrapper > input[type="text"]\')[1]).pickadate(\'picker\').set(\'select\', new Date(2018, 7, 8))\n+    # Then we expect 2 hits\n+\n+Scenario Short name (id) query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I open the criteria Short name (id)\n+    And I search for a\n+    Then Page Should Contain  A\n+\n+Scenario Review state query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I open the criteria Review State\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-private\n+    and Click Element  css=li.select2-option-private\n+    Then we expect 7 hits\n+\n+Scenario Type query\n+    Given a logged-in site administrator\n+    and a bunch of events\n+    and the querystring pattern\n+    When I open the criteria Type\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-event\n+    and Click Element  css=li.select2-option-event\n+    Then we expect 4 hits\n+    When I delete one selection\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-file\n+    and Click Element  css=li.select2-option-file\n+    Then we do not expect any hits\n+    When I delete one selection\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-folder\n+    and Click Element  css=li.select2-option-folder\n+    Then we expect 5 hits\n+    When I delete one selection\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-link\n+    and Click Element  css=li.select2-option-link\n+    Then we expect 1 hits\n+    When I delete one selection\n+    and I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-document\n+    and Click Element  css=li.select2-option-document\n+    Then we expect 2 hits\n+    When I open the Selection Widget\n+    and Wait Until Element Is Visible  css=li.select2-option-link\n+    and Click Element  css=li.select2-option-link\n+    Then we expect 3 hits\n+\n+Scenario Creator query\n+    Given a logged-in site administrator\n+    and a bunch of folders\n+    and the querystring pattern\n+    When I activate the default operator in the criteria Creator\n+    Then we expect 6 hits\n+\n+\n *** Keywords ****************************************************************\n \n+save\n+    Click Link  css=input#form-buttons-save\n+\n the querystring pattern\n     #We go the /a to give more useful query results\n     Go to  ${PLONE_URL}/a/++add++Collection\n     Wait until page contains element  css=.pat-querystring\n     Given querystring pattern loaded\n+    # for some unknown reason unload protection pops up, but only in robot tests\n+    Execute Javascript  $(window).unbind(\'beforeunload\')\n \n querystring pattern loaded\n     Wait For Condition  return window.jQuery(\'.querystring-criteria-remove\').size() > 0\n \n a bunch of folders\n     #We create enough items to give meaningful test results\n-    ${F1}=  Create content  type=Folder  title=A\n-    ${F2}=  Create content  type=Folder  title=B  container=${F1}\n-    ${F3}=  Create content  type=Folder  title=C  container=${F2}\n-    Create content  type=Document  title=D  container=${F3}\n+    ${F1}=  Create content  type=Folder  title=A  description=a  subject=onep\n+    ${F2}=  Create content  type=Folder  title=B  description=b  subject=one  container=${F1}\n+    ${F3}=  Create content  type=Folder  title=C  description=and  subject=on  container=${F2}\n+    Create content  type=Document  title=D  subject=o  container=${F3}\n+    Create content  type=Document  title=E  container=${F3}\n+    Create content  type=Link  title=Link  remoteUrl=/front-page  container=${F3}\n+    [Return]  ${F1}\n \n-I open the ${OPERATOR} operator in the ${CRITERIA} criteria\n+a bunch of events\n+    ${F1}=  a bunch of folders\n+    Create content  type=Event  title=Event1  start=2018-08-01 15:00  end=2018-08-01 17:00  container=${F1}\n+    Create content  type=Event  title=Event2  start=2018-08-05 16:00  end=2018-08-07 11:00  container=${F1}\n+    Create content  type=Event  title=Event3  start=2018-08-05 16:30  open_end-empty-marker=1  container=${F1}\n+    Create content  type=Event  title=Event4  start=2018-08-06  end=2018-08-06  whole_day-empty-marker=1  container=${F1}\n+\n+I activate the default operator in the criteria ${CRITERIA}\n+    open the select box titled index\n+    select index type ${CRITERIA}\n+\n+I activate the operator ${OPERATOR} in the criteria ${CRITERIA}\n     open the select box titled index\n     select index type ${CRITERIA}\n+    mark results\n     open the select box titled operator\n     select index type ${OPERATOR}\n \n+I expect an empty result after open the operator ${OPERATOR} in the criteria ${CRITERIA}\n+    open the select box titled index\n+    select index type ${CRITERIA}\n+    sleep  0.75\n+    Wait for condition  return $("dl.searchResults").length == 0\n+    open the select box titled operator\n+    select index type ${OPERATOR}\n+\n+I open the criteria ${CRITERIA}\n+    open the select box titled index\n+    select index type ${CRITERIA}\n+\n+I search for ${KEYWORD}\n+    Wait Until Element Is Visible  css=input.querystring-criteria-value-StringWidget\n+    Click Element  css=input.querystring-criteria-value-StringWidget\n+    Input Text  css=input.querystring-criteria-value-StringWidget  ${KEYWORD}\n+    Click Element  css=div#content-core\n+\n+I open the Selection Widget\n+    wait until element is visible  css=div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n+    click element  css=div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n+\n+I delete one selection\n+    #deletes one element\n+    Click Element  css=a.select2-search-choice-close\n+\n+I delete my selection\n+    #deletes two elements\n+    Click Element  css=a.select2-search-choice-close\n+    Click Element  css=a.select2-search-choice-close\n+\n I search in ${NAME} subfolder in the related items widget\n-    Click Element  jquery=.pattern-relateditems-tree-select\n-    Wait Until Element Is Visible  jquery=.pat-tree li.jqtree_common:contains("${NAME}") .pattern-relateditems-result-browse\n-    Click Element  jquery=.pat-tree li.jqtree_common:contains("${NAME}") .pattern-relateditems-result-browse\n-    Wait Until Element Is Visible  css=.pattern-relateditems-result-select\n-    Click Element  css=.pattern-relateditems-result-select\n+    mark results\n+    Click Element  css=ul.select2-choices\n+    Wait Until Page Contains  ${NAME}\n+    Click Element  //a[contains(concat(\' \', normalize-space(@class), \' \'), \' pattern-relateditems-result-select \')]//span[contains(text(),\'${NAME}\')]\n \n I expect to be in Advanced mode\n     open the select box titled operator\n@@ -68,8 +301,8 @@ I expect to be in Advanced mode\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Absolute Path\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Relative Path\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Simple Mode\n-    Click Element  css=body\n-    Sleep  1\n+    Click Element  css=div#select2-drop-mask\n+    Wait Until Element Is Not Visible  css=div#select2-drop-mask\n \n I expect to be in Simple mode\n     open the select box titled operator\n@@ -77,7 +310,8 @@ I expect to be in Simple mode\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Parent (../)\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Current (./)\n     Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Advanced Mode\n-    Click Element  css=body\n+    Click Element  css=div#select2-drop-mask\n+    Wait Until Element Is Not Visible  css=div#select2-drop-mask\n \n open the select box titled ${NAME}\n     Click Element  css=body\n@@ -90,6 +324,21 @@ select index type ${INDEX}\n we expect ${NUM} hits\n     #This assumes we have the 2 "Test document" and "Test folder" items from the\n     #robot setup, as well as the 4 additional items from the "a bunch of folders" macro\n-    Sleep   1\n-    ${hits}=    Execute Javascript  return window.jQuery(\'.searchResults > dd\').size().toString();\n-    Should Be Equal     ${hits}     ${NUM}\n+    #works only for ${NUM} > 0\n+    Wait until result is no longer marked\n+    ${hits}=  Execute Javascript  return $(\'.searchResults > dd\').length\n+    Should Be Equal As Integers  ${hits}  ${NUM}\n+    mark results\n+\n+we do not expect any hits\n+    Wait Until Element Contains  css=div#search-results  No results were found.\n+\n+a logged-in manager\n+    Enable autologin as  Manager  Site Administrator  Contributor  Reviewer\n+\n+mark results\n+    Wait for condition  return $("dl.searchResults").length > 0\n+    Execute Javascript  $("dl.searchResults").attr("marker", "marked")\n+\n+wait until result is no longer marked\n+    Wait for condition  return $("dl.searchResults").length > 0 && $("dl.searchResults").attr("marker") != "marked"\n\\ No newline at end of file\ndiff --git a/news/2489.feature b/news/2489.feature\nnew file mode 100644\nindex 000000000..465dc5c9c\n--- /dev/null\n+++ b/news/2489.feature\n@@ -0,0 +1,3 @@\n+- New robot tests for querystring in Collection type.\n+  Now almost all querystring types are robot tested.\n+  [llisa123]\n\\ No newline at end of file\n'

