Repository: plone.dexterity


Branch: refs/heads/master
Date: 2022-08-08T16:17:55+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.dexterity/commit/f2e54e8c14920f1e8f7904e2f2d6570851bae32c

Check code quality with fresh plone/code-quality 2.0.0.

Files changed:
M .github/workflows/code-analysis.yml
M Makefile
M pyproject.toml

b'diff --git a/.github/workflows/code-analysis.yml b/.github/workflows/code-analysis.yml\nindex d54242f..8411110 100644\n--- a/.github/workflows/code-analysis.yml\n+++ b/.github/workflows/code-analysis.yml\n@@ -11,40 +11,5 @@ jobs:\n       - name: Checkout codebase\n         uses: actions/checkout@v2\n \n-      - name: Run check isort\n-        uses: plone/code-analysis-action@v1\n-        with:\n-          check: \'isort\'\n-          path: |\n-            plone\n-            setup.py\n-\n-      - name: Run check black\n-        uses: plone/code-analysis-action@v1\n-        with:\n-          check: \'black\'\n-          path: |\n-            plone\n-            setup.py\n-\n-      - name: Run check flake8\n-        uses: plone/code-analysis-action@v1\n-        with:\n-          check: \'flake8\'\n-          path: |\n-            plone\n-            setup.py\n-\n-      - name: Run check pyroma\n-        uses: plone/code-analysis-action@v1\n-        with:\n-          check: \'pyroma\'\n-          path: |\n-            ./\n-\n-      - name: Run check zpretty\n-        uses: plone/code-analysis-action@v1\n-        with:\n-          check: \'zpretty\'\n-          path: |\n-            plone\n+      - name: Run all lint checks\n+        uses: plone/code-analysis-action@v2\ndiff --git a/Makefile b/Makefile\nindex 950cf2c..5c9cecb 100644\n--- a/Makefile\n+++ b/Makefile\n@@ -15,7 +15,9 @@ GREEN=`tput setaf 2`\n RESET=`tput sgr0`\n YELLOW=`tput setaf 3`\n \n-CODE_QUALITY_VERSION=1.0.1\n+# See https://github.com/plone/code-quality\n+# Our configuration is in pyproject.toml.\n+CODE_QUALITY_VERSION=2.0.0\n LINT=docker run --rm -v "$(PWD)":/github/workspace plone/code-quality:${CODE_QUALITY_VERSION} check\n FORMAT=docker run --rm -v "$(PWD)":/github/workspace plone/code-quality:${CODE_QUALITY_VERSION} format\n \n@@ -31,13 +33,8 @@ help: ## This help message\n \n .PHONY: format\n format:  ## Format the codebase according to our standards\n-\t$(FORMAT) "$(CHECK_PATH)"\n+\t$(FORMAT)\n \n .PHONY: lint\n lint:  ## validate with isort, black, flake8, pyroma, zpretty\n-    # Would be nice to have a way to run all available checks, instead of specifying them here.\n-\t$(LINT) isort "$(CHECK_PATH)"\n-\t$(LINT) black "$(CHECK_PATH)"\n-\t$(LINT) flake8 "$(CHECK_PATH)"\n-\t$(LINT) pyroma .\n-\t$(LINT) zpretty "$(PACKAGE_PATH)"\n+\t$(LINT)\ndiff --git a/pyproject.toml b/pyproject.toml\nindex b736348..5392512 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -36,3 +36,8 @@ mccabe = ["+*"]\n pycodestyle = ["+*", "-E501", "-W503"]\n pyflakes = ["+*"]\n pylint = ["+*"]\n+\n+[tool.plone-code-analysis]\n+paths = "plone/ setup.py"\n+paths_pyroma = "."\n+paths_zpretty = "plone/"\n'

Repository: plone.dexterity


Branch: refs/heads/master
Date: 2022-08-08T23:11:27+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.dexterity/commit/b65219ced0b41e199213cd8b837170a33c2a0918

code quality: use current user id and group for formatting.

This should fix possible permission issues when a file gets changed.

Files changed:
M Makefile

b'diff --git a/Makefile b/Makefile\nindex 5c9cecb..60afba8 100644\n--- a/Makefile\n+++ b/Makefile\n@@ -18,8 +18,10 @@ YELLOW=`tput setaf 3`\n # See https://github.com/plone/code-quality\n # Our configuration is in pyproject.toml.\n CODE_QUALITY_VERSION=2.0.0\n+CURRENT_USER=$$(whoami)\n+USER_INFO=$$(id -u ${CURRENT_USER}):$$(id -g ${CURRENT_USER})\n LINT=docker run --rm -v "$(PWD)":/github/workspace plone/code-quality:${CODE_QUALITY_VERSION} check\n-FORMAT=docker run --rm -v "$(PWD)":/github/workspace plone/code-quality:${CODE_QUALITY_VERSION} format\n+FORMAT=docker run --user="${USER_INFO}" --rm -v "$(PWD)":/github/workspace plone/code-quality:${CODE_QUALITY_VERSION} format\n \n PACKAGE_NAME=plone.dexterity\n PACKAGE_PATH=plone/\n'

Repository: plone.dexterity


Branch: refs/heads/master
Date: 2022-08-08T19:37:39-03:00
Author: Ã‰rico Andrei (ericof) <ericof@gmail.com>
Commit: https://github.com/plone/plone.dexterity/commit/bff61e6e5b82feacf146e9da377c44912f369822

Merge pull request #171 from plone/maurits-plone-code-quality-200

Check code quality with fresh plone/code-quality 2.0.0.

Files changed:
M .github/workflows/code-analysis.yml
M Makefile
M pyproject.toml

b'diff --git a/.github/workflows/code-analysis.yml b/.github/workflows/code-analysis.yml\nindex d54242f..8411110 100644\n--- a/.github/workflows/code-analysis.yml\n+++ b/.github/workflows/code-analysis.yml\n@@ -11,40 +11,5 @@ jobs:\n       - name: Checkout codebase\n         uses: actions/checkout@v2\n \n-      - name: Run check isort\n-        uses: plone/code-analysis-action@v1\n-        with:\n-          check: \'isort\'\n-          path: |\n-            plone\n-            setup.py\n-\n-      - name: Run check black\n-        uses: plone/code-analysis-action@v1\n-        with:\n-          check: \'black\'\n-          path: |\n-            plone\n-            setup.py\n-\n-      - name: Run check flake8\n-        uses: plone/code-analysis-action@v1\n-        with:\n-          check: \'flake8\'\n-          path: |\n-            plone\n-            setup.py\n-\n-      - name: Run check pyroma\n-        uses: plone/code-analysis-action@v1\n-        with:\n-          check: \'pyroma\'\n-          path: |\n-            ./\n-\n-      - name: Run check zpretty\n-        uses: plone/code-analysis-action@v1\n-        with:\n-          check: \'zpretty\'\n-          path: |\n-            plone\n+      - name: Run all lint checks\n+        uses: plone/code-analysis-action@v2\ndiff --git a/Makefile b/Makefile\nindex 950cf2c..60afba8 100644\n--- a/Makefile\n+++ b/Makefile\n@@ -15,9 +15,13 @@ GREEN=`tput setaf 2`\n RESET=`tput sgr0`\n YELLOW=`tput setaf 3`\n \n-CODE_QUALITY_VERSION=1.0.1\n+# See https://github.com/plone/code-quality\n+# Our configuration is in pyproject.toml.\n+CODE_QUALITY_VERSION=2.0.0\n+CURRENT_USER=$$(whoami)\n+USER_INFO=$$(id -u ${CURRENT_USER}):$$(id -g ${CURRENT_USER})\n LINT=docker run --rm -v "$(PWD)":/github/workspace plone/code-quality:${CODE_QUALITY_VERSION} check\n-FORMAT=docker run --rm -v "$(PWD)":/github/workspace plone/code-quality:${CODE_QUALITY_VERSION} format\n+FORMAT=docker run --user="${USER_INFO}" --rm -v "$(PWD)":/github/workspace plone/code-quality:${CODE_QUALITY_VERSION} format\n \n PACKAGE_NAME=plone.dexterity\n PACKAGE_PATH=plone/\n@@ -31,13 +35,8 @@ help: ## This help message\n \n .PHONY: format\n format:  ## Format the codebase according to our standards\n-\t$(FORMAT) "$(CHECK_PATH)"\n+\t$(FORMAT)\n \n .PHONY: lint\n lint:  ## validate with isort, black, flake8, pyroma, zpretty\n-    # Would be nice to have a way to run all available checks, instead of specifying them here.\n-\t$(LINT) isort "$(CHECK_PATH)"\n-\t$(LINT) black "$(CHECK_PATH)"\n-\t$(LINT) flake8 "$(CHECK_PATH)"\n-\t$(LINT) pyroma .\n-\t$(LINT) zpretty "$(PACKAGE_PATH)"\n+\t$(LINT)\ndiff --git a/pyproject.toml b/pyproject.toml\nindex b736348..5392512 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -36,3 +36,8 @@ mccabe = ["+*"]\n pycodestyle = ["+*", "-E501", "-W503"]\n pyflakes = ["+*"]\n pylint = ["+*"]\n+\n+[tool.plone-code-analysis]\n+paths = "plone/ setup.py"\n+paths_pyroma = "."\n+paths_zpretty = "plone/"\n'

