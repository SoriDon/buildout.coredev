Repository: plone.app.mosaic


Branch: refs/heads/es6
Date: 2022-06-14T18:08:31+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.mosaic/commit/98eec6a4777a2c7ffadc63b5912309f898fa410f

update mxdev and tests

Files changed:
M .github/workflows/test.yml
M .gitignore
M Makefile
M constraints.txt
M sources.ini
M src/plone/app/mosaic/tests/robot/keywords.robot
M src/plone/app/mosaic/tests/robot/test_editor.robot
M src/plone/app/mosaic/tests/robot/test_layout.robot

b'diff --git a/.github/workflows/test.yml b/.github/workflows/test.yml\nindex 61fb4f87..368fee48 100644\n--- a/.github/workflows/test.yml\n+++ b/.github/workflows/test.yml\n@@ -28,8 +28,8 @@ jobs:\n \n       - name: Install package\n         run: |\n-          make VENV=off install\n+          make install\n \n       - name: Run tests\n         run: |\n-          make VENV=off test-ignore-warnings\n+          make test-ignore-warnings\ndiff --git a/.gitignore b/.gitignore\nindex fe42e17d..9409d931 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -47,3 +47,8 @@ pip-selfcheck.json\n pyvenv.cfg\n package-lock.json\n stats.json\n+=*\n+\n+# robot test\n+robot_*\n+test_*\ndiff --git a/Makefile b/Makefile\nindex 95278270..52d063d8 100644\n--- a/Makefile\n+++ b/Makefile\n@@ -73,7 +73,7 @@ help: ## This help message\n \t@echo\n \t@echo "${WARN_COLOR}Additional parameters:${NO_COLOR}"\n \t@echo "${MARK_COLOR}PYTHON${NO_COLOR}:       python interpreter to be used (default: python3)"\n-\t@echo "${MARK_COLOR}VENV${NO_COLOR}:        [on|off] wether to create a Python virtual environment or not (default: on)"\n+\t@echo "${MARK_COLOR}VENV${NO_COLOR}:        [on|off] wether to create a Python virtual environment or not (default: off)"\n \t@echo "${MARK_COLOR}VENV_FOLDER${NO_COLOR}: location of the virtual environment (default: ./venv)"\n \t@echo\n \t@echo "${WARN_COLOR}Targets:${NO_COLOR}"\n@@ -103,7 +103,7 @@ ${SENTINEL}:\n # PYTHON, VENV, PIP\n # venv and pybin\n PYTHON?=python3\n-VENV?=on\n+VENV?=off\n ifeq ("${VENV}", "on")\n \tVENV_FOLDER?=./venv\n \tPYBIN=${VENV_FOLDER}/bin/\n@@ -142,7 +142,7 @@ endif\n PIP_SENTINEL=${SENTINELFOLDER}pip.sentinel\n ${PIP_SENTINEL}: ${VENV_SENTINEL} ${CONSTRAINTS_IN} ${SENTINEL}\n \t@echo "$(OK_COLOR)Install pip$(NO_COLOR)"\n-\t@${PYBIN}pip install -U pip>=22.0.2 wheel setuptools\n+\t@${PYBIN}pip install -U "pip>=22.0.2" wheel setuptools\n \t@touch ${PIP_SENTINEL}\n \n ##############################################################################\n@@ -151,7 +151,7 @@ ${PIP_SENTINEL}: ${VENV_SENTINEL} ${CONSTRAINTS_IN} ${SENTINEL}\n MXDEV_SENTINEL=${SENTINELFOLDER}pip-mxdev.sentinel\n ${MXDEV_SENTINEL}: ${PIP_SENTINEL}\n \t@echo "$(OK_COLOR)Install mxdev$(NO_COLOR)"\n-\t@${PYBIN}pip install mxdev>=2.0.0 libvcs==0.11.1\n+\t@${PYBIN}pip install "mxdev>=2.0.0" libvcs==0.11.1\n \t@touch ${MXDEV_SENTINEL}\n \n .PHONY: prepare\n@@ -202,12 +202,12 @@ ${TESTRUNNER_SENTINEL}: ${PIP_SENTINEL}\n .PHONY: test\n test: ${TEST_PREREQUISITES} ${TESTRUNNER_SENTINEL} ## run tests\n \t@echo "$(OK_COLOR)Run addon tests$(NO_COLOR)"\n-\t@${PYBIN}zope-testrunner --auto-color --auto-progress --test-path=${ADDONFOLDER}\n+\t@${PYBIN}zope-testrunner --all --auto-color --auto-progress --test-path=${ADDONFOLDER}\n \n .PHONY: test-ignore-warnings\n test-ignore-warnings: ${TEST_PREREQUISITES} ${TESTRUNNER_SENTINEL}  ## run tests (hide warnins)\n \t@echo "$(OK_COLOR)Run addon tests$(NO_COLOR)"\n-\t@PYTHONWARNINGS=ignore ${PYBIN}zope-testrunner --auto-color --auto-progress --test-path=${ADDONFOLDER}\n+\t@PYTHONWARNINGS=ignore ${PYBIN}zope-testrunner --all --auto-color --auto-progress --test-path=${ADDONFOLDER}\n \n ##############################################################################\n # CODE FORMATTING\n@@ -312,8 +312,13 @@ clean-resources:  ## clean npm packages\n \t@echo "$(OK_COLOR)Remove npm packages.$(NO_COLOR)"\n \trm -rf node_modules/\n \n+.PHONY: clean-tests\n+clean-tests:  ## clean test output\n+\t@echo "$(OK_COLOR)Remove test output files.$(NO_COLOR)"\n+\trm -rf robot_* test_*\n+\n .PHONY: clean\n-clean:  clean-venv clean-pyc clean-make clean-instance clean-resources   ## clean all (except local database and pip installed packages)\n+clean:  clean-venv clean-pyc clean-make clean-instance clean-resources clean-tests   ## clean all (except local database and pip installed packages)\n \n ##############################################################################\n # DOCKER/CONTAINER\ndiff --git a/constraints.txt b/constraints.txt\nindex ab7a7659..c0e8f2f6 100644\n--- a/constraints.txt\n+++ b/constraints.txt\n@@ -1,10 +1 @@\n -c https://dist.plone.org/release/6.0-dev/constraints.txt\n-\n-plone.app.blocks==4.3.2\n-plone.app.drafts==1.1.3\n-plone.app.standardtile==2.4.0\n-plone.app.tiles==3.2.2\n-plone.behavior==1.4.0\n-plone.jsonserializer==0.9.10\n-plone.subrequest==1.9.3\n-plone.tiles==2.3.0\ndiff --git a/sources.ini b/sources.ini\nindex f05f2f64..e8b426cd 100644\n--- a/sources.ini\n+++ b/sources.ini\n@@ -18,89 +18,54 @@ ignores =\n     plone.app.mosaic\n \n version-overrides =\n-    z3c.form>=4.0\n-    plone.namedfile>=6.0.0a3\n+    robotframework==5.0.1\n+    robotframework-seleniumtestability==2.0.0\n+    robotframework-seleniumlibrary==6.0.0\n \n default-install-mode = direct\n \n # variables\n-github = git+ssh://git@github.com\n-# github = git+https://github.com\n+; github = git+ssh://git@github.com\n+github = git+https://github.com\n \n # Checkouts after ES6 merge\n-[mockup]\n-url = ${settings:github}/plone/mockup.git\n-branch = master\n-install-mode = skip\n-\n-[plone.staticresources]\n-url = ${settings:github}/plone/plone.staticresources.git\n-branch = master\n-\n-[plonetheme.barceloneta]\n-url =  ${settings:github}/plone/plonetheme.barceloneta.git\n-branch = master\n-\n-[plone.app.content]\n-url =  ${settings:github}/plone/plone.app.content.git\n-branch = master\n-\n-[plone.app.contentrules]\n-url =  ${settings:github}/plone/plone.app.contentrules.git\n-branch = master\n+; [mockup]\n+; url = ${settings:github}/plone/mockup.git\n+; branch = master\n+; install-mode = skip\n \n [plone.app.contentmenu]\n-url =  ${settings:github}/plone/plone.app.contentmenu.git\n+url = ${settings:github}/plone/plone.app.contentmenu.git\n branch = master\n \n [plone.app.discussion]\n-url =  ${settings:github}/plone/plone.app.discussion.git\n-branch = master\n-\n-[plone.app.dexterity]\n-url =  ${settings:github}/plone/plone.app.dexterity.git\n+url = ${settings:github}/plone/plone.app.discussion.git\n branch = master\n \n-[plone.app.event]\n-url =  ${settings:github}/plone/plone.app.event.git\n-branch = master\n-\n-[plone.app.theming]\n-url =  ${settings:github}/plone/plone.app.theming.git\n-branch = master\n-\n-[plone.app.portlets]\n-url =  ${settings:github}/plone/plone.app.portlets.git\n-branch = master\n-\n-[plone.z3cform]\n-url =  ${settings:github}/plone/plone.z3cform.git\n+[plone.app.layout]\n+url = ${settings:github}/plone/plone.app.layout.git\n branch = master\n \n-[plone.app.z3cform]\n-url =  ${settings:github}/plone/plone.app.z3cform.git\n+[plone.app.robotframework]\n+url = ${settings:github}/plone/plone.app.robotframework.git\n branch = master\n \n-[plone.app.registry]\n-url =  ${settings:github}/plone/plone.app.registry.git\n+[plone.base]\n+url = ${settings:github}/plone/plone.base.git\n branch = master\n \n-[plone.app.widgets]\n-url =  ${settings:github}/plone/plone.app.widgets.git\n+[plone.staticresources]\n+url = ${settings:github}/plone/plone.staticresources.git\n branch = master\n \n-[plone.schemaeditor]\n-url =  ${settings:github}/plone/plone.schemaeditor.git\n+[plonetheme.barceloneta]\n+url =  ${settings:github}/plone/plonetheme.barceloneta.git\n branch = master\n \n [Products.CMFPlone]\n url = ${settings:github}/plone/Products.CMFPlone.git\n branch = master\n \n-[plone.app.layout]\n-url =  ${settings:github}/plone/plone.app.layout.git\n-branch = master\n-\n # mosaic dependencies\n [plone.app.blocks]\n url = ${settings:github}/plone/plone.app.blocks\n@@ -112,7 +77,7 @@ branch = master\n \n [plone.app.standardtiles]\n url = ${settings:github}/plone/plone.app.standardtiles.git\n-branch = master\n+branch = main\n \n [plone.app.tiles]\n url = ${settings:github}/plone/plone.app.tiles.git\ndiff --git a/src/plone/app/mosaic/tests/robot/keywords.robot b/src/plone/app/mosaic/tests/robot/keywords.robot\nindex 68ead531..1956f2af 100644\n--- a/src/plone/app/mosaic/tests/robot/keywords.robot\n+++ b/src/plone/app/mosaic/tests/robot/keywords.robot\n@@ -23,7 +23,6 @@ ${SELECTOR_CONTENTMENU_DISPLAY_ITEMS}  css=#plone-contentmenu-display ul\n \n ${SELECTOR_TOOLBAR}  css=#edit-zone\n \n-\n *** Keywords ***\n \n a logged-in manager\ndiff --git a/src/plone/app/mosaic/tests/robot/test_editor.robot b/src/plone/app/mosaic/tests/robot/test_editor.robot\nindex 6da368c3..df6e897d 100644\n--- a/src/plone/app/mosaic/tests/robot/test_editor.robot\n+++ b/src/plone/app/mosaic/tests/robot/test_editor.robot\n@@ -10,7 +10,7 @@ Test Teardown  Close all browsers\n \n Show how Mosaic editor is opened\n     Go to  ${PLONE_URL}/example-document\n-    Wait Until Element Is Visible  id=contentview-edit\n+    Wait For Element  id=contentview-edit\n     Highlight  id=contentview-edit\n     Capture and crop page screenshot\n     ...  _screenshots/mosaic-editor-open.png\n@@ -20,17 +20,17 @@ Show how Mosaic editor is opened\n \n Show the Mosaic editing capabilities\n     Go to  ${PLONE_URL}/example-document/edit\n-    Wait Until Element Is Visible  css=.mosaic-select-layout\n+    Wait For Element  css=.mosaic-select-layout\n     Capture and crop page screenshot\n     ...  _screenshots/mosaic-editor-layout-selector.png\n-    ...  css=.plone-modal\n+    ...  css=.modal-dialog\n \n     # Show how to select the initial layout\n-    Wait until Page contains element  jquery=a[data-value="default/basic.html"]\n+    Wait For Element  jquery=a[data-value="default/basic.html"]\n     Highlight  jquery=a[data-value="default/basic.html"] img\n     Capture and crop page screenshot\n     ...  _screenshots/mosaic-editor-layout-selector-select.png\n-    ...  css=.plone-modal\n+    ...  css=.modal-dialog\n \n     ## XXX: Only double click worked on Firefox 52\n     Click element  jquery=a[data-value="default/basic.html"]\n@@ -38,22 +38,20 @@ Show the Mosaic editing capabilities\n \n     # Show the properties view in Mosaic editor\n     Run keyword and ignore error  Set window size  1024  1200\n-    Wait Until Element Is Visible  css=.mosaic-toolbar\n+    Wait For Element  css=.mosaic-toolbar\n     Click element  css=.mosaic-button-properties\n \n     Highlight  css=.autotoc-nav\n \n     Capture and crop page screenshot\n     ...  _screenshots/mosaic-editor-properties-modal.png\n-    ...  css=.plone-modal-content\n+    ...  css=.modal-content\n \n-    #...  css=html\n-    #.plone-modal-content\n     Run keyword and ignore error  Set window size  1024  800\n     Click element  css=.mosaic-overlay-ok-button\n \n     # Show the Mosaic editor\n-    Wait Until Element Is Visible  css=.mosaic-toolbar\n+    Wait For Element  css=.mosaic-toolbar\n     Highlight  css=.mosaic-button-layout\n     Capture and crop page screenshot\n     ...  _screenshots/mosaic-editor-layout.png\n@@ -73,7 +71,7 @@ Show the Mosaic editing capabilities\n     Click element  css=.mosaic-button-customizelayout\n \n     # Show how to select a new tile from menu\n-    Wait Until Element Is Visible  css=.mosaic-toolbar\n+    Wait For Element  css=.mosaic-toolbar\n     Highlight  css=.select2-container.mosaic-menu-insert\n     Click element  css=.select2-container.mosaic-menu-insert a\n     Wait until element is visible  css=.select2-result.mosaic-option-irichtextbehavior-text\n@@ -102,7 +100,7 @@ Show the Mosaic editing capabilities\n     # Show how to drop a new tile into its initial position\n \n     Click element  css=.mosaic-selected-divider\n-    Wait Until Element Is Visible  css=.mosaic-button-save\n+    Wait For Element  css=.mosaic-button-save\n     Highlight  css=.mosaic-button-save\n     Capture and crop page screenshot\n     ...  _screenshots/mosaic-editor-drop-field-text-tile.png\n@@ -119,4 +117,3 @@ Show the Mosaic editing capabilities\n \n \n *** Keywords ***\n-\ndiff --git a/src/plone/app/mosaic/tests/robot/test_layout.robot b/src/plone/app/mosaic/tests/robot/test_layout.robot\nindex ebb69adf..38c6fdb1 100644\n--- a/src/plone/app/mosaic/tests/robot/test_layout.robot\n+++ b/src/plone/app/mosaic/tests/robot/test_layout.robot\n@@ -24,14 +24,12 @@ Show how to select Mosaic layout option\n     ...  ${SELECTOR_TOOLBAR}  id=plone-contentmenu-display\n     ...  ${SELECTOR_CONTENTMENU_DISPLAY_ITEMS}\n \n-    Mouse over  id=plone-contentmenu-display-layout_view\n+    Set focus to element  id=plone-contentmenu-display-layout_view\n     Click element  id=plone-contentmenu-display-layout_view\n \n-    ## XXX: Mouse over got stuck on Firefox 52\n-    # Mouse over  ${SELECTOR_CONTENTMENU_DISPLAY_LINK}\n     Run keyword and ignore error  Set window size  1024  800\n     Wait until page contains element\n-    ...  css=#plone-contentmenu-display-layout_view.actionMenuSelected\n+    ...  css=body.layout-default-document\n \n \n Show how to select custom layout view\n'

