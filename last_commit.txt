Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-04-21T16:14:13+02:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/84c9a1449ce787228c5e9a2eafdb97c0b82261cc

Fix tinymce formats menu by allowing autoinclude of styles with .tiny prefix

Files changed:
M Products/CMFPlone/patterns/tinymce.py

b'diff --git a/Products/CMFPlone/patterns/tinymce.py b/Products/CMFPlone/patterns/tinymce.py\nindex 1db131559b..795a046c32 100644\n--- a/Products/CMFPlone/patterns/tinymce.py\n+++ b/Products/CMFPlone/patterns/tinymce.py\n@@ -95,6 +95,7 @@ def get_all_style_formats(self):\n     def get_tiny_config(self):\n         settings = self.settings\n         importcss_file_filter = ""\n+        importcss_selector_filter = ".tiny-"\n \n         theme = self.get_theme()\n         if theme and getattr(theme, "tinymce_styles_css", None):\n@@ -111,6 +112,7 @@ def get_tiny_config(self):\n             "entity_encoding": settings.entity_encoding,\n             "importcss_append": True,\n             "importcss_file_filter": importcss_file_filter,\n+            "importcss_selector_filter": importcss_selector_filter,\n             "browser_spellcheck": True,\n         }\n         toolbar_additions = settings.custom_buttons or []\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-04-21T16:18:56+02:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/ad0d6efcb74456a9266f2a824e263f7db28e4e2c

add news

Files changed:
A news/3510.feature

b'diff --git a/news/3510.feature b/news/3510.feature\nnew file mode 100644\nindex 0000000000..577dc4f552\n--- /dev/null\n+++ b/news/3510.feature\n@@ -0,0 +1,2 @@\n+Enable auto include of `.tiny` prefixed styles to the TinyMCE formats menu.\n+[agitator]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-04-22T08:49:13+02:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/553bfcabb33d7ee5f6d72f7bcafea3db201d7d8c

use importcss_file_filter and fix content_css

Files changed:
M Products/CMFPlone/patterns/tinymce.py
M news/3510.feature

b'diff --git a/Products/CMFPlone/patterns/tinymce.py b/Products/CMFPlone/patterns/tinymce.py\nindex 795a046c32..0ae8528f46 100644\n--- a/Products/CMFPlone/patterns/tinymce.py\n+++ b/Products/CMFPlone/patterns/tinymce.py\n@@ -94,8 +94,7 @@ def get_all_style_formats(self):\n \n     def get_tiny_config(self):\n         settings = self.settings\n-        importcss_file_filter = ""\n-        importcss_selector_filter = ".tiny-"\n+        importcss_file_filter = "tinymce-formats.css"\n \n         theme = self.get_theme()\n         if theme and getattr(theme, "tinymce_styles_css", None):\n@@ -105,14 +104,13 @@ def get_tiny_config(self):\n \n         tiny_config = {\n             "resize": "both" if settings.resizing else False,\n-            "content_css": self.get_content_css(importcss_file_filter),\n+            "content_css": self.get_content_css(),\n             "plugins": ["plonelink", "ploneimage", "importcss"] + settings.plugins,\n             "external_plugins": {},\n             "toolbar": settings.toolbar,\n             "entity_encoding": settings.entity_encoding,\n             "importcss_append": True,\n             "importcss_file_filter": importcss_file_filter,\n-            "importcss_selector_filter": importcss_selector_filter,\n             "browser_spellcheck": True,\n         }\n         toolbar_additions = settings.custom_buttons or []\ndiff --git a/news/3510.feature b/news/3510.feature\nindex 577dc4f552..927f8ac2fe 100644\n--- a/news/3510.feature\n+++ b/news/3510.feature\n@@ -1,2 +1,2 @@\n-Enable auto include of `.tiny` prefixed styles to the TinyMCE formats menu.\n+Enable auto include of styles to the TinyMCE formats menu. The file has to be named `tinymce-formats.css` and known by TinyMCE.\n [agitator]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-04-22T08:51:17+02:00
Author: agitator (agitator) <agitator@users.noreply.github.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/0b136ec99649665f05e322be850981926d1f86c7

Merge branch 'master' into fix-tiny-formatsmenu

Files changed:
A news/3432.bugfix
M Products/CMFPlone/browser/search.py

b"diff --git a/Products/CMFPlone/browser/search.py b/Products/CMFPlone/browser/search.py\nindex c44596fe4c..393fcd0005 100644\n--- a/Products/CMFPlone/browser/search.py\n+++ b/Products/CMFPlone/browser/search.py\n@@ -13,7 +13,6 @@\n from zope.component import queryUtility\n from zope.i18nmessageid import MessageFactory\n from zope.publisher.browser import BrowserView\n-from ZPublisher.HTTPRequest import record\n from ZTUtils import make_query\n \n import json\n@@ -119,11 +118,6 @@ def _filter_query(self, query):\n                 # created not a mapping\n                 del query['created']\n \n-        # https://github.com/plone/Products.CMFPlone/issues/3007\n-        # If 'created' exists and is of type 'record', then cast it as dict\n-        if 'created' in query and isinstance(query['created'], record):\n-            query['created'] = dict(query['created'])\n-\n         # respect `types_not_searched` setting\n         types = query.get('portal_type', [])\n         if 'query' in types:\ndiff --git a/news/3432.bugfix b/news/3432.bugfix\nnew file mode 100644\nindex 0000000000..dd272a593f\n--- /dev/null\n+++ b/news/3432.bugfix\n@@ -0,0 +1,2 @@\n+Remove date range search fix, which was done in Products.ZCatalog.\n+[wesleybl]\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-04-22T12:41:34+03:00
Author: Maik Derstappen (MrTango) <md@derico.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/16ca65e16a9db68c11a82a9a2becf26c07dd062f

Merge pull request #3510 from plone/fix-tiny-formatsmenu

Fix tinymce formats menu with content_css and configure importcss_file_filter

Files changed:
A news/3510.feature
M Products/CMFPlone/patterns/tinymce.py

b'diff --git a/Products/CMFPlone/patterns/tinymce.py b/Products/CMFPlone/patterns/tinymce.py\nindex 1db131559b..0ae8528f46 100644\n--- a/Products/CMFPlone/patterns/tinymce.py\n+++ b/Products/CMFPlone/patterns/tinymce.py\n@@ -94,7 +94,7 @@ def get_all_style_formats(self):\n \n     def get_tiny_config(self):\n         settings = self.settings\n-        importcss_file_filter = ""\n+        importcss_file_filter = "tinymce-formats.css"\n \n         theme = self.get_theme()\n         if theme and getattr(theme, "tinymce_styles_css", None):\n@@ -104,7 +104,7 @@ def get_tiny_config(self):\n \n         tiny_config = {\n             "resize": "both" if settings.resizing else False,\n-            "content_css": self.get_content_css(importcss_file_filter),\n+            "content_css": self.get_content_css(),\n             "plugins": ["plonelink", "ploneimage", "importcss"] + settings.plugins,\n             "external_plugins": {},\n             "toolbar": settings.toolbar,\ndiff --git a/news/3510.feature b/news/3510.feature\nnew file mode 100644\nindex 0000000000..927f8ac2fe\n--- /dev/null\n+++ b/news/3510.feature\n@@ -0,0 +1,2 @@\n+Enable auto include of styles to the TinyMCE formats menu. The file has to be named `tinymce-formats.css` and known by TinyMCE.\n+[agitator]\n\\ No newline at end of file\n'

