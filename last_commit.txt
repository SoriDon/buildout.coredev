Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2016-01-06T11:12:32-06:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/c4fe78afea8658f0250d82179c586c6ceb74509f

use layer request so we get correct host

Files changed:
M plone/app/z3cform/tests/test_widgets.py

diff --git a/plone/app/z3cform/tests/test_widgets.py b/plone/app/z3cform/tests/test_widgets.py
index 8444043..f44b250 100644
--- a/plone/app/z3cform/tests/test_widgets.py
+++ b/plone/app/z3cform/tests/test_widgets.py
@@ -1102,7 +1102,11 @@ def setUp(self):
         from plone.app.textfield import RichText as RichTextField
 
         self.portal = self.layer['portal']
-        self.request = TestRequest(environ={'HTTP_ACCEPT_LANGUAGE': 'en'})
+        # since we are using a plone integration layer, we do
+        # not need to use the TestRequest class and we do not want
+        # to since the tinymce pattern requires a more properly
+        # setup zope2 request object to work correctly in tests
+        self.request = self.layer['request']
 
         class IWithText(Interface):
             text = RichTextField(title=u"Text")
@@ -1122,8 +1126,8 @@ def test_widget_params(self):
         self.assertEqual(base_args['pattern'], 'tinymce')
 
         prependToUrl = '/plone/resolveuid/'
-        self.assertEqual(base_args['pattern_options']['prependToUrl'],
-                         prependToUrl)
+        self.assertEquals(base_args['pattern_options']['prependToUrl'],
+                          prependToUrl)
         self.assertEqual(
             base_args['pattern_options']['upload']['relativePath'],
             '@@fileUpload')


