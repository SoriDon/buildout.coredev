Repository: plone.app.users


Branch: refs/heads/master
Date: 2016-01-28T13:11:37+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.users/commit/83310f87cffc7c10dd205e5e8a0d70d9faa850af

Fix bug when registering a user by adding a schema-setter to UserDataPanelAdapter

when registering a user the properties-setter in
plone.app.users.browser.register.BaseRegistrationForm.applyProperties uses
``adapter.schema = schema`` to set schema on plone.app.users.browser.userdatapanel.UserDataPanelAdapter.
That used the __setattr__ of its super but UserDataPanelAdapter.schema was a property.

Files changed:
M CHANGES.rst
M plone/app/users/browser/userdatapanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b5a4234..e1a3260 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fix bug when registering a user by adding a schema-setter to
+  UserDataPanelAdapter.
+  [pbauer]
 
 
 2.3.4 (2015-11-28)
diff --git a/plone/app/users/browser/userdatapanel.py b/plone/app/users/browser/userdatapanel.py
index 6645dbe..debc12d 100644
--- a/plone/app/users/browser/userdatapanel.py
+++ b/plone/app/users/browser/userdatapanel.py
@@ -22,7 +22,17 @@ class UserDataPanelAdapter(AccountPanelSchemaAdapter):
 
     @property
     def schema(self):
-        return getUserDataSchema()
+        # prevent infinite recursion when accessing the schema via bypassing
+        # __getattr__ of self
+        try:
+            return object.__getattribute__(self, '_schema')
+        except AttributeError:
+            object.__setattr__(self, '_schema', getUserDataSchema())
+        return object.__getattribute__(self, '_schema')
+
+    @schema.setter
+    def schema(self, value):
+        self._schema = value
 
     def get_email(self):
         return self._getProperty('email')


Repository: plone.app.users


Branch: refs/heads/master
Date: 2016-02-01T15:47:34+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.users/commit/2f671578d8448a443560f07b801594f4148e9799

Merge pull request #53 from plone/thet-zope4

Fix bug when registering a user

Files changed:
M CHANGES.rst
M plone/app/users/browser/userdatapanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b5a4234..e1a3260 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fix bug when registering a user by adding a schema-setter to
+  UserDataPanelAdapter.
+  [pbauer]
 
 
 2.3.4 (2015-11-28)
diff --git a/plone/app/users/browser/userdatapanel.py b/plone/app/users/browser/userdatapanel.py
index 6645dbe..debc12d 100644
--- a/plone/app/users/browser/userdatapanel.py
+++ b/plone/app/users/browser/userdatapanel.py
@@ -22,7 +22,17 @@ class UserDataPanelAdapter(AccountPanelSchemaAdapter):
 
     @property
     def schema(self):
-        return getUserDataSchema()
+        # prevent infinite recursion when accessing the schema via bypassing
+        # __getattr__ of self
+        try:
+            return object.__getattribute__(self, '_schema')
+        except AttributeError:
+            object.__setattr__(self, '_schema', getUserDataSchema())
+        return object.__getattribute__(self, '_schema')
+
+    @schema.setter
+    def schema(self, value):
+        self._schema = value
 
     def get_email(self):
         return self._getProperty('email')


