Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-02-23T15:26:32+01:00
Author: Benoit Suttor (bsuttor) <benoit.suttor@imio.be>
Commit: https://github.com/plone/Products.CMFPlone/commit/732b76cdced9eb230f125c23e3fe7e3365d14fef

Use warnings instead of "except pass"

This was discussed on issue #3442

Files changed:
M Products/CMFPlone/controlpanel/browser/overview.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_overview.py
M setup.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/overview.py b/Products/CMFPlone/controlpanel/browser/overview.py\nindex 685ca272bf..47657ded96 100644\n--- a/Products/CMFPlone/controlpanel/browser/overview.py\n+++ b/Products/CMFPlone/controlpanel/browser/overview.py\n@@ -12,6 +12,7 @@\n from ZPublisher.HTTPRequest import WSGIRequest\n \n import pkg_resources\n+import warnings\n \n try:\n     import plone.app.event\n@@ -62,11 +63,11 @@ def server_info(self):\n             try:\n                 server = pkg_resources.get_distribution(server_name)\n                 server_version = server.version\n-            except (\n-                pkg_resources.DistributionNotFound,\n-                pkg_resources.RequirementParseError,\n-            ):\n-                pass\n+            except Exception:\n+                warnings.warn(\n+                    "Cannot find or parse version for %r"\n+                    % self.request.get("SERVER_SOFTWARE"),\n+                )\n         return {\n             "wsgi": wsgi,\n             "server_name": server_name,\ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_overview.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_overview.py\nindex 090cbabb94..974d6c3828 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_overview.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_overview.py\n@@ -71,3 +71,7 @@ def test_gunicorn_server_name(self):\n         self.request["SERVER_SOFTWARE"] = "gunicorn/19.6.0"\n         view = self.portal.restrictedTraverse("@@overview-controlpanel")\n         self.assertEqual(view.server_info()["server_name"], "gunicorn")\n+        self.request["SERVER_SOFTWARE"] = "bad-gunicorn-name/19.6.0"\n+        view = self.portal.restrictedTraverse("@@overview-controlpanel")\n+        with self.assertWarns(Warning):\n+            view.server_info()["server_name"]\ndiff --git a/setup.py b/setup.py\nindex fa9fec7413..30d7353b8b 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -140,6 +140,7 @@\n             \'plone.app.testing\',\n             \'zope.globalrequest\',\n             \'zope.testing\',\n+            \'gunicorn\',\n         ]\n     },\n )\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-02-23T22:01:01+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/f64f3d105073b47c4d185323cdda9c7738e36d31

Merge pull request #3444 from plone/bsuttor/3442-end

Use warnings instead of "except pass"

Files changed:
M Products/CMFPlone/controlpanel/browser/overview.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_overview.py
M setup.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/overview.py b/Products/CMFPlone/controlpanel/browser/overview.py\nindex 685ca272bf..47657ded96 100644\n--- a/Products/CMFPlone/controlpanel/browser/overview.py\n+++ b/Products/CMFPlone/controlpanel/browser/overview.py\n@@ -12,6 +12,7 @@\n from ZPublisher.HTTPRequest import WSGIRequest\n \n import pkg_resources\n+import warnings\n \n try:\n     import plone.app.event\n@@ -62,11 +63,11 @@ def server_info(self):\n             try:\n                 server = pkg_resources.get_distribution(server_name)\n                 server_version = server.version\n-            except (\n-                pkg_resources.DistributionNotFound,\n-                pkg_resources.RequirementParseError,\n-            ):\n-                pass\n+            except Exception:\n+                warnings.warn(\n+                    "Cannot find or parse version for %r"\n+                    % self.request.get("SERVER_SOFTWARE"),\n+                )\n         return {\n             "wsgi": wsgi,\n             "server_name": server_name,\ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_overview.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_overview.py\nindex 090cbabb94..974d6c3828 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_overview.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_overview.py\n@@ -71,3 +71,7 @@ def test_gunicorn_server_name(self):\n         self.request["SERVER_SOFTWARE"] = "gunicorn/19.6.0"\n         view = self.portal.restrictedTraverse("@@overview-controlpanel")\n         self.assertEqual(view.server_info()["server_name"], "gunicorn")\n+        self.request["SERVER_SOFTWARE"] = "bad-gunicorn-name/19.6.0"\n+        view = self.portal.restrictedTraverse("@@overview-controlpanel")\n+        with self.assertWarns(Warning):\n+            view.server_info()["server_name"]\ndiff --git a/setup.py b/setup.py\nindex fa9fec7413..30d7353b8b 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -140,6 +140,7 @@\n             \'plone.app.testing\',\n             \'zope.globalrequest\',\n             \'zope.testing\',\n+            \'gunicorn\',\n         ]\n     },\n )\n'

