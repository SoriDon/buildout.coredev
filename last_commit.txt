Repository: plone.restapi


Branch: refs/heads/master
Date: 2018-12-28T00:41:27+01:00
Author: Gil Forcada (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/ea85167849d022bbde6e88695cc7b797cb684370

chore: do not use deprecated assertNotEquals method

Files changed:
M src/plone/restapi/tests/test_atcontent_deserializer.py
M src/plone/restapi/tests/test_dxcontent_deserializer.py
M src/plone/restapi/tests/test_site_deserializer.py

b'diff --git a/src/plone/restapi/tests/test_atcontent_deserializer.py b/src/plone/restapi/tests/test_atcontent_deserializer.py\nindex 6be01743..92ae9b45 100644\n--- a/src/plone/restapi/tests/test_atcontent_deserializer.py\n+++ b/src/plone/restapi/tests/test_atcontent_deserializer.py\n@@ -156,7 +156,7 @@ def __call__(self, request):\n \n     def test_set_layout(self):\n         current_layout = self.doc1.getLayout()\n-        self.assertNotEquals(current_layout, "my_new_layout")\n+        self.assertNotEqual(current_layout, "my_new_layout")\n         self.deserialize(body=\'{"layout": "my_new_layout"}\')\n         self.assertEqual(\'my_new_layout\', self.doc1.getLayout())\n \ndiff --git a/src/plone/restapi/tests/test_dxcontent_deserializer.py b/src/plone/restapi/tests/test_dxcontent_deserializer.py\nindex 6cd85ccd..b8def61d 100644\n--- a/src/plone/restapi/tests/test_dxcontent_deserializer.py\n+++ b/src/plone/restapi/tests/test_dxcontent_deserializer.py\n@@ -210,7 +210,7 @@ def test_deserializer_sets_missing_value_on_required_field(self):\n \n     def test_set_layout(self):\n         current_layout = self.portal.doc1.getLayout()\n-        self.assertNotEquals(current_layout, "my_new_layout")\n+        self.assertNotEqual(current_layout, "my_new_layout")\n         self.deserialize(body=\'{"layout": "my_new_layout"}\')\n         self.assertEqual(\'my_new_layout\', self.portal.doc1.getLayout())\n \ndiff --git a/src/plone/restapi/tests/test_site_deserializer.py b/src/plone/restapi/tests/test_site_deserializer.py\nindex ad7f7c0c..46f38550 100644\n--- a/src/plone/restapi/tests/test_site_deserializer.py\n+++ b/src/plone/restapi/tests/test_site_deserializer.py\n@@ -35,6 +35,6 @@ def deserialize(self, body=\'{}\', validate_all=False, context=None):\n \n     def test_set_layout(self):\n         current_layout = self.portal.getLayout()\n-        self.assertNotEquals(current_layout, "my_new_layout")\n+        self.assertNotEqual(current_layout, "my_new_layout")\n         self.deserialize(body=\'{"layout": "my_new_layout"}\')\n         self.assertEqual(\'my_new_layout\', self.portal.getLayout())\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2018-12-28T01:32:33+01:00
Author: Gil Forcada (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/f0e3619c0d13523827447cabaf1d8e93af882e6a

chore: fix test class name

Files changed:
M src/plone/restapi/tests/test_services_actions.py

b"diff --git a/src/plone/restapi/tests/test_services_actions.py b/src/plone/restapi/tests/test_services_actions.py\nindex 9c3332d5..80a7b814 100644\n--- a/src/plone/restapi/tests/test_services_actions.py\n+++ b/src/plone/restapi/tests/test_services_actions.py\n@@ -17,7 +17,7 @@\n TEST_CATEGORY_ID = 'testcategory'\n \n \n-class TestRegistry(unittest.TestCase):\n+class TestActions(unittest.TestCase):\n \n     layer = PLONE_RESTAPI_DX_FUNCTIONAL_TESTING\n \n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2018-12-29T23:11:51+01:00
Author: Gil Forcada (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/cae413a3968749b4fa288a27d0758d46e2170382

feat: do not leave open sockets behind

Files changed:
M src/plone/restapi/tests/test_batching.py
M src/plone/restapi/tests/test_copymove.py
M src/plone/restapi/tests/test_documentation.py
M src/plone/restapi/tests/test_error_handling.py
M src/plone/restapi/tests/test_expansion.py
M src/plone/restapi/tests/test_locking.py
M src/plone/restapi/tests/test_permissions.py
M src/plone/restapi/tests/test_registry.py
M src/plone/restapi/tests/test_roles.py
M src/plone/restapi/tests/test_search.py
M src/plone/restapi/tests/test_services.py
M src/plone/restapi/tests/test_services_actions.py
M src/plone/restapi/tests/test_services_breadcrumbs.py
M src/plone/restapi/tests/test_services_comments.py
M src/plone/restapi/tests/test_services_content.py
M src/plone/restapi/tests/test_services_controlpanels.py
M src/plone/restapi/tests/test_services_email_notification.py
M src/plone/restapi/tests/test_services_email_send.py
M src/plone/restapi/tests/test_services_groups.py
M src/plone/restapi/tests/test_services_history.py
M src/plone/restapi/tests/test_services_navigation.py
M src/plone/restapi/tests/test_services_principals.py
M src/plone/restapi/tests/test_services_tiles.py
M src/plone/restapi/tests/test_services_types.py
M src/plone/restapi/tests/test_services_users.py
M src/plone/restapi/tests/test_services_vocabularies.py
M src/plone/restapi/tests/test_tus.py

b"diff --git a/src/plone/restapi/tests/test_batching.py b/src/plone/restapi/tests/test_batching.py\nindex f8e25bb3..7852d5d8 100644\n--- a/src/plone/restapi/tests/test_batching.py\n+++ b/src/plone/restapi/tests/test_batching.py\n@@ -35,6 +35,9 @@ def setUp(self):\n         self.api_session.headers.update({'Accept': 'application/json'})\n         self.api_session.auth = (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def _create_doc(self, container, number):\n         createContentInContainer(\n             container, u'DXTestDocument',\ndiff --git a/src/plone/restapi/tests/test_copymove.py b/src/plone/restapi/tests/test_copymove.py\nindex 95f32042..6cc45052 100644\n--- a/src/plone/restapi/tests/test_copymove.py\n+++ b/src/plone/restapi/tests/test_copymove.py\n@@ -87,6 +87,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_copy_single_object(self):\n         response = self.api_session.post(\n             '/@copy',\ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex 1b919dd1..a2ddbfc5 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -226,6 +226,7 @@ def create_folder(self):\n         return folder\n \n     def tearDown(self):\n+        self.api_session.close()\n         self.time_freezer.stop()\n         popGlobalRegistry(getSite())\n         self.api_session.close()\n@@ -646,6 +647,7 @@ def test_documentation_users_as_anonymous(self):\n         response = logged_out_api_session.get('@users')\n         save_request_and_response_for_docs('users_anonymous', response)\n         self.assertEqual(response.status_code, 401)\n+        logged_out_api_session.close()\n \n     def test_documentations_users_as_unauthorized_user(self):\n         properties = {\n@@ -671,6 +673,7 @@ def test_documentations_users_as_unauthorized_user(self):\n         response = standard_api_session.get('@users')\n         save_request_and_response_for_docs('users_unauthorized', response)\n         self.assertEqual(response.status_code, 401)\n+        standard_api_session.close()\n \n     def test_documentation_users_get(self):\n         properties = {\n@@ -711,6 +714,7 @@ def test_documentation_users_anonymous_get(self):\n \n         response = logged_out_api_session.get('@users/noam')\n         save_request_and_response_for_docs('users_anonymous_get', response)\n+        logged_out_api_session.close()\n \n     def test_documentation_users_unauthorized_get(self):\n         properties = {\n@@ -743,6 +747,7 @@ def test_documentation_users_unauthorized_get(self):\n \n         response = logged_out_api_session.get('@users/noam')\n         save_request_and_response_for_docs('users_unauthorized_get', response)\n+        logged_out_api_session.close()\n \n     def test_documentation_users_authorized_get(self):\n         properties = {\n@@ -766,6 +771,7 @@ def test_documentation_users_authorized_get(self):\n         logged_out_api_session.auth = ('noam', 'secret')\n         response = logged_out_api_session.get('@users/noam')\n         save_request_and_response_for_docs('users_authorized_get', response)\n+        logged_out_api_session.close()\n \n     def test_documentation_users_filtered_get(self):\n         properties = {\ndiff --git a/src/plone/restapi/tests/test_error_handling.py b/src/plone/restapi/tests/test_error_handling.py\nindex 9cad014d..7cb02d73 100644\n--- a/src/plone/restapi/tests/test_error_handling.py\n+++ b/src/plone/restapi/tests/test_error_handling.py\n@@ -52,6 +52,9 @@ def setUp(self):\n         self.folder_url = self.folder.absolute_url()\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     @unittest.skip('Not working since we moved to plone.rest')\n     def test_404_not_found(self):\n         response = self.api_session.get('non-existing-resource')\ndiff --git a/src/plone/restapi/tests/test_expansion.py b/src/plone/restapi/tests/test_expansion.py\nindex 8bed02c9..de805d73 100644\n--- a/src/plone/restapi/tests/test_expansion.py\n+++ b/src/plone/restapi/tests/test_expansion.py\n@@ -120,6 +120,9 @@ def setUp(self):\n             title=u'Some Folder')\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_actions_is_expandable(self):\n         response = self.api_session.get('/folder')\n \n@@ -331,6 +334,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_translations_is_expandable(self):\n         response = self.api_session.get('/en/test-document')\n \ndiff --git a/src/plone/restapi/tests/test_locking.py b/src/plone/restapi/tests/test_locking.py\nindex 0e7b49fb..44e57653 100644\n--- a/src/plone/restapi/tests/test_locking.py\n+++ b/src/plone/restapi/tests/test_locking.py\n@@ -32,6 +32,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_lock_object(self):\n         response = self.api_session.post('/@lock',)\n         transaction.commit()\ndiff --git a/src/plone/restapi/tests/test_permissions.py b/src/plone/restapi/tests/test_permissions.py\nindex 0bf9c634..84a94c9b 100644\n--- a/src/plone/restapi/tests/test_permissions.py\n+++ b/src/plone/restapi/tests/test_permissions.py\n@@ -24,6 +24,9 @@ def setUp(self):\n         self.api_session.headers.update({'Accept': 'application/json'})\n         self.api_session.auth = (TEST_USER_NAME, TEST_USER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_anonymous_allowed_to_use_api_by_default(self):\n         setRoles(self.portal, TEST_USER_ID, ['Anonymous'])\n         transaction.commit()\ndiff --git a/src/plone/restapi/tests/test_registry.py b/src/plone/restapi/tests/test_registry.py\nindex bee9973c..7bb89ba9 100644\n--- a/src/plone/restapi/tests/test_registry.py\n+++ b/src/plone/restapi/tests/test_registry.py\n@@ -39,6 +39,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_registry_record(self):\n         response = self.api_session.get('/@registry/foo.bar')\n \ndiff --git a/src/plone/restapi/tests/test_roles.py b/src/plone/restapi/tests/test_roles.py\nindex 05291d40..474dd4cc 100644\n--- a/src/plone/restapi/tests/test_roles.py\n+++ b/src/plone/restapi/tests/test_roles.py\n@@ -19,6 +19,9 @@ def setUp(self):\n         self.api_session.headers.update({'Accept': 'application/json'})\n         self.api_session.auth = (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_roles_endpoint_lists_roles(self):\n         response = self.api_session.get('/@roles')\n \ndiff --git a/src/plone/restapi/tests/test_search.py b/src/plone/restapi/tests/test_search.py\nindex 942f9f8a..827d1526 100644\n--- a/src/plone/restapi/tests/test_search.py\n+++ b/src/plone/restapi/tests/test_search.py\n@@ -102,6 +102,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_overall_response_format(self):\n         response = self.api_session.get('/@search')\n \ndiff --git a/src/plone/restapi/tests/test_services.py b/src/plone/restapi/tests/test_services.py\nindex 7e25c043..9a68830c 100644\n--- a/src/plone/restapi/tests/test_services.py\n+++ b/src/plone/restapi/tests/test_services.py\n@@ -33,6 +33,9 @@ def setUp(self):\n         self.api_session.headers.update({'Accept': 'application/json'})\n         self.api_session.auth = (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_document(self):\n         self.portal.invokeFactory(\n             'Document',\ndiff --git a/src/plone/restapi/tests/test_services_actions.py b/src/plone/restapi/tests/test_services_actions.py\nindex 80a7b814..e90688ce 100644\n--- a/src/plone/restapi/tests/test_services_actions.py\n+++ b/src/plone/restapi/tests/test_services_actions.py\n@@ -66,6 +66,10 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+        self.anon_api_session.close()\n+\n     def test_actions_all_categories(self):\n         response = self.api_session.get('/@actions')\n \ndiff --git a/src/plone/restapi/tests/test_services_breadcrumbs.py b/src/plone/restapi/tests/test_services_breadcrumbs.py\nindex b65f6618..190e6a0d 100644\n--- a/src/plone/restapi/tests/test_services_breadcrumbs.py\n+++ b/src/plone/restapi/tests/test_services_breadcrumbs.py\n@@ -35,6 +35,9 @@ def setUp(self):\n             title=u'A document')\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_breadcrumbs(self):\n         response = self.api_session.get('/folder/doc1/@breadcrumbs')\n \ndiff --git a/src/plone/restapi/tests/test_services_comments.py b/src/plone/restapi/tests/test_services_comments.py\nindex 67cc15a0..0eb86824 100644\n--- a/src/plone/restapi/tests/test_services_comments.py\n+++ b/src/plone/restapi/tests/test_services_comments.py\n@@ -55,6 +55,10 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+        self.user_session.close()\n+\n     def test_list_datastructure(self):\n         url = '{}/@comments'.format(self.doc.absolute_url())\n         response = self.api_session.get(url)\ndiff --git a/src/plone/restapi/tests/test_services_content.py b/src/plone/restapi/tests/test_services_content.py\nindex 3af4b406..54b12521 100644\n--- a/src/plone/restapi/tests/test_services_content.py\n+++ b/src/plone/restapi/tests/test_services_content.py\n@@ -34,6 +34,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_response(self):\n         response = self.api_session.get(self.doc.absolute_url())\n         self.assertIn('version', response.json())\ndiff --git a/src/plone/restapi/tests/test_services_controlpanels.py b/src/plone/restapi/tests/test_services_controlpanels.py\nindex aed41985..4955e5da 100644\n--- a/src/plone/restapi/tests/test_services_controlpanels.py\n+++ b/src/plone/restapi/tests/test_services_controlpanels.py\n@@ -32,6 +32,9 @@ def setUp(self):\n         self.api_session.headers.update({'Accept': 'application/json'})\n         self.api_session.auth = (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_listing(self):\n         # Do we get a list with at least one item?\n         response = self.api_session.get('/@controlpanels')\ndiff --git a/src/plone/restapi/tests/test_services_email_notification.py b/src/plone/restapi/tests/test_services_email_notification.py\nindex 192f6d1b..0e6ce006 100644\n--- a/src/plone/restapi/tests/test_services_email_notification.py\n+++ b/src/plone/restapi/tests/test_services_email_notification.py\n@@ -46,6 +46,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_email_notification_missing_parameters(self):\n         response = self.api_session.post(\n             '/@email-notification',\ndiff --git a/src/plone/restapi/tests/test_services_email_send.py b/src/plone/restapi/tests/test_services_email_send.py\nindex 32efd9e8..9fe77368 100644\n--- a/src/plone/restapi/tests/test_services_email_send.py\n+++ b/src/plone/restapi/tests/test_services_email_send.py\n@@ -46,6 +46,10 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+        self.anon_api_session.close()\n+\n     def test_email_send(self):\n         response = self.api_session.post(\n             '/@email-send',\ndiff --git a/src/plone/restapi/tests/test_services_groups.py b/src/plone/restapi/tests/test_services_groups.py\nindex 59ebff50..cf265f93 100644\n--- a/src/plone/restapi/tests/test_services_groups.py\n+++ b/src/plone/restapi/tests/test_services_groups.py\n@@ -38,6 +38,9 @@ def setUp(self):\n                             description=properties['description'])\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_list_groups(self):\n         response = self.api_session.get('/@groups')\n \ndiff --git a/src/plone/restapi/tests/test_services_history.py b/src/plone/restapi/tests/test_services_history.py\nindex 7dbbd54e..0d262098 100644\n--- a/src/plone/restapi/tests/test_services_history.py\n+++ b/src/plone/restapi/tests/test_services_history.py\n@@ -40,6 +40,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_types(self):\n         # Check if we have all history types in our test setup\n         response = self.api_session.get(self.endpoint_url)\n@@ -165,6 +168,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_actions_are_translated(self):\n         url = self.doc.absolute_url() + '/@history'\n         response = self.api_session.get(url)\ndiff --git a/src/plone/restapi/tests/test_services_navigation.py b/src/plone/restapi/tests/test_services_navigation.py\nindex 4a25f850..e7c08903 100644\n--- a/src/plone/restapi/tests/test_services_navigation.py\n+++ b/src/plone/restapi/tests/test_services_navigation.py\n@@ -55,6 +55,9 @@ def setUp(self):\n             title=u'A document')\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_navigation_with_no_params_gets_only_top_level(self):\n         response = self.api_session.get('/folder/@navigation')\n \ndiff --git a/src/plone/restapi/tests/test_services_principals.py b/src/plone/restapi/tests/test_services_principals.py\nindex 64e2d647..2aaaf608 100644\n--- a/src/plone/restapi/tests/test_services_principals.py\n+++ b/src/plone/restapi/tests/test_services_principals.py\n@@ -52,6 +52,9 @@ def setUp(self):\n                             description=properties['description'])\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_principals(self):\n         response = self.api_session.get(\n             '/@principals',\ndiff --git a/src/plone/restapi/tests/test_services_tiles.py b/src/plone/restapi/tests/test_services_tiles.py\nindex 4efd6869..7e6adf17 100644\n--- a/src/plone/restapi/tests/test_services_tiles.py\n+++ b/src/plone/restapi/tests/test_services_tiles.py\n@@ -75,6 +75,9 @@ def setUp(self):\n         provideAdapter(SampleTile, (Interface, Interface),\n                        IBasicTile, name=u'sample.tile')\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_available_tiles(self):\n         response = self.api_session.get('/@tiles')\n \ndiff --git a/src/plone/restapi/tests/test_services_types.py b/src/plone/restapi/tests/test_services_types.py\nindex 44b44e5e..a498878f 100644\n--- a/src/plone/restapi/tests/test_services_types.py\n+++ b/src/plone/restapi/tests/test_services_types.py\n@@ -26,6 +26,9 @@ def setUp(self):\n         self.api_session.headers.update({'Accept': 'application/json'})\n         self.api_session.auth = (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_types(self):\n         response = self.api_session.get(\n             '{}/@types'.format(self.portal.absolute_url())\n@@ -184,6 +187,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_types_translated(self):\n         response = self.api_session.get(\n             '{}/@types'.format(self.portal.absolute_url())\ndiff --git a/src/plone/restapi/tests/test_services_users.py b/src/plone/restapi/tests/test_services_users.py\nindex fadf8007..92097918 100644\n--- a/src/plone/restapi/tests/test_services_users.py\n+++ b/src/plone/restapi/tests/test_services_users.py\n@@ -67,6 +67,10 @@ def setUp(self):\n         )\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+        self.anon_api_session.close()\n+\n     def test_list_users(self):\n         response = self.api_session.get('/@users')\n \n@@ -95,6 +99,7 @@ def test_list_users_without_being_manager(self):\n \n         response = noam_api_session.get('/@users')\n         self.assertEqual(response.status_code, 401)\n+        noam_api_session.close()\n \n     def test_list_users_as_anonymous(self):\n \n@@ -343,6 +348,7 @@ def test_get_other_user_info_when_logged_in(self):\n \n         response = noam_api_session.get('/@users/otheruser')\n         self.assertEqual(response.status_code, 401)\n+        noam_api_session.close()\n \n     def test_get_search_user_with_filter(self):\n         response = self.api_session.post(\n@@ -406,6 +412,7 @@ def test_get_search_user_with_filter_as_unauthorized_user(self):\n \n         response = noam_api_session.get('/@users', params={'query': 'howa'})\n         self.assertEqual(response.status_code, 401)\n+        noam_api_session.close()\n \n     def test_get_non_existing_user(self):\n         response = self.api_session.get('/@users/non-existing-user')\ndiff --git a/src/plone/restapi/tests/test_services_vocabularies.py b/src/plone/restapi/tests/test_services_vocabularies.py\nindex f7c57563..25b6cf65 100644\n--- a/src/plone/restapi/tests/test_services_vocabularies.py\n+++ b/src/plone/restapi/tests/test_services_vocabularies.py\n@@ -139,6 +139,7 @@ def test_context_vocabulary(self):\n             })\n \n     def tearDown(self):\n+        self.api_session.close()\n         gsm = getGlobalSiteManager()\n         gsm.unregisterUtility(provided=IVocabularyFactory,\n                               name='plone.restapi.tests.test_vocabulary')\ndiff --git a/src/plone/restapi/tests/test_tus.py b/src/plone/restapi/tests/test_tus.py\nindex 3879ca81..e7ec7858 100644\n--- a/src/plone/restapi/tests/test_tus.py\n+++ b/src/plone/restapi/tests/test_tus.py\n@@ -400,6 +400,7 @@ def test_tus_can_replace_pdf_file(self):\n         self.assertEqual(pdf_file_size, self.file.file.size)\n \n     def tearDown(self):\n+        self.api_session.close()\n         client_home = os.environ.get('CLIENT_HOME')\n         tmp_dir = os.path.join(client_home, 'tus-uploads')\n         if os.path.isdir(tmp_dir):\n@@ -471,6 +472,7 @@ def test_cors_preflight_for_head_contains_tus_headers(self):\n         self.assertIn('Tus-Extension', response.headers)\n \n     def tearDown(self):\n+        self.api_session.close()\n         gsm = getGlobalSiteManager()\n         gsm.unregisterAdapter(\n             CORSTestPolicy, (Interface, IBrowserRequest), ICORSPolicy)\n@@ -607,6 +609,9 @@ def setUp(self):\n         self.api_session.headers.update({'Accept': 'application/json'})\n         self.api_session.auth = (TEST_USER_NAME, TEST_USER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_tus_can_upload_pdf_file(self):\n         # initialize the upload with POST\n         pdf_file_path = os.path.join(os.path.dirname(__file__),\n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2018-12-29T23:12:56+01:00
Author: Gil Forcada (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/cdcc0aaf2d66b0ce7a1db6126404d0568a81dcff

Update CHANGES

Files changed:
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 166b8429..e523a999 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,7 @@ Bugfixes:\n   This prevents lots of ResourceWarnings about unclosed sockets.\n   Fixes issues `636 <https://github.com/plone/plone.restapi/issues/636>`_\n   and `648 <https://github.com/plone/plone.restapi/issues/648>`_.\n-  [maurits]\n+  [maurits, gforcada]\n \n - Standardize errors data structure of email-notification endpoint.\n   [cekk]\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2018-12-30T12:56:52+01:00
Author: Timo Stollenwerk (tisto) <tisto@users.noreply.github.com>
Commit: https://github.com/plone/plone.restapi/commit/8f4b1e386368f03107559d59c95ceefa8ef086ae

Merge pull request #652 from plone/gforcada-fix-more-warnings

Fix more warnings

Files changed:
M CHANGES.rst
M src/plone/restapi/tests/test_atcontent_deserializer.py
M src/plone/restapi/tests/test_batching.py
M src/plone/restapi/tests/test_copymove.py
M src/plone/restapi/tests/test_documentation.py
M src/plone/restapi/tests/test_dxcontent_deserializer.py
M src/plone/restapi/tests/test_error_handling.py
M src/plone/restapi/tests/test_expansion.py
M src/plone/restapi/tests/test_locking.py
M src/plone/restapi/tests/test_permissions.py
M src/plone/restapi/tests/test_registry.py
M src/plone/restapi/tests/test_roles.py
M src/plone/restapi/tests/test_search.py
M src/plone/restapi/tests/test_services.py
M src/plone/restapi/tests/test_services_actions.py
M src/plone/restapi/tests/test_services_breadcrumbs.py
M src/plone/restapi/tests/test_services_comments.py
M src/plone/restapi/tests/test_services_content.py
M src/plone/restapi/tests/test_services_controlpanels.py
M src/plone/restapi/tests/test_services_email_notification.py
M src/plone/restapi/tests/test_services_email_send.py
M src/plone/restapi/tests/test_services_groups.py
M src/plone/restapi/tests/test_services_history.py
M src/plone/restapi/tests/test_services_navigation.py
M src/plone/restapi/tests/test_services_principals.py
M src/plone/restapi/tests/test_services_tiles.py
M src/plone/restapi/tests/test_services_types.py
M src/plone/restapi/tests/test_services_users.py
M src/plone/restapi/tests/test_services_vocabularies.py
M src/plone/restapi/tests/test_site_deserializer.py
M src/plone/restapi/tests/test_tus.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 166b8429..e523a999 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,7 @@ Bugfixes:\n   This prevents lots of ResourceWarnings about unclosed sockets.\n   Fixes issues `636 <https://github.com/plone/plone.restapi/issues/636>`_\n   and `648 <https://github.com/plone/plone.restapi/issues/648>`_.\n-  [maurits]\n+  [maurits, gforcada]\n \n - Standardize errors data structure of email-notification endpoint.\n   [cekk]\ndiff --git a/src/plone/restapi/tests/test_atcontent_deserializer.py b/src/plone/restapi/tests/test_atcontent_deserializer.py\nindex 6be01743..92ae9b45 100644\n--- a/src/plone/restapi/tests/test_atcontent_deserializer.py\n+++ b/src/plone/restapi/tests/test_atcontent_deserializer.py\n@@ -156,7 +156,7 @@ def __call__(self, request):\n \n     def test_set_layout(self):\n         current_layout = self.doc1.getLayout()\n-        self.assertNotEquals(current_layout, "my_new_layout")\n+        self.assertNotEqual(current_layout, "my_new_layout")\n         self.deserialize(body=\'{"layout": "my_new_layout"}\')\n         self.assertEqual(\'my_new_layout\', self.doc1.getLayout())\n \ndiff --git a/src/plone/restapi/tests/test_batching.py b/src/plone/restapi/tests/test_batching.py\nindex f8e25bb3..7852d5d8 100644\n--- a/src/plone/restapi/tests/test_batching.py\n+++ b/src/plone/restapi/tests/test_batching.py\n@@ -35,6 +35,9 @@ def setUp(self):\n         self.api_session.headers.update({\'Accept\': \'application/json\'})\n         self.api_session.auth = (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def _create_doc(self, container, number):\n         createContentInContainer(\n             container, u\'DXTestDocument\',\ndiff --git a/src/plone/restapi/tests/test_copymove.py b/src/plone/restapi/tests/test_copymove.py\nindex 95f32042..6cc45052 100644\n--- a/src/plone/restapi/tests/test_copymove.py\n+++ b/src/plone/restapi/tests/test_copymove.py\n@@ -87,6 +87,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_copy_single_object(self):\n         response = self.api_session.post(\n             \'/@copy\',\ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex 1b919dd1..a2ddbfc5 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -226,6 +226,7 @@ def create_folder(self):\n         return folder\n \n     def tearDown(self):\n+        self.api_session.close()\n         self.time_freezer.stop()\n         popGlobalRegistry(getSite())\n         self.api_session.close()\n@@ -646,6 +647,7 @@ def test_documentation_users_as_anonymous(self):\n         response = logged_out_api_session.get(\'@users\')\n         save_request_and_response_for_docs(\'users_anonymous\', response)\n         self.assertEqual(response.status_code, 401)\n+        logged_out_api_session.close()\n \n     def test_documentations_users_as_unauthorized_user(self):\n         properties = {\n@@ -671,6 +673,7 @@ def test_documentations_users_as_unauthorized_user(self):\n         response = standard_api_session.get(\'@users\')\n         save_request_and_response_for_docs(\'users_unauthorized\', response)\n         self.assertEqual(response.status_code, 401)\n+        standard_api_session.close()\n \n     def test_documentation_users_get(self):\n         properties = {\n@@ -711,6 +714,7 @@ def test_documentation_users_anonymous_get(self):\n \n         response = logged_out_api_session.get(\'@users/noam\')\n         save_request_and_response_for_docs(\'users_anonymous_get\', response)\n+        logged_out_api_session.close()\n \n     def test_documentation_users_unauthorized_get(self):\n         properties = {\n@@ -743,6 +747,7 @@ def test_documentation_users_unauthorized_get(self):\n \n         response = logged_out_api_session.get(\'@users/noam\')\n         save_request_and_response_for_docs(\'users_unauthorized_get\', response)\n+        logged_out_api_session.close()\n \n     def test_documentation_users_authorized_get(self):\n         properties = {\n@@ -766,6 +771,7 @@ def test_documentation_users_authorized_get(self):\n         logged_out_api_session.auth = (\'noam\', \'secret\')\n         response = logged_out_api_session.get(\'@users/noam\')\n         save_request_and_response_for_docs(\'users_authorized_get\', response)\n+        logged_out_api_session.close()\n \n     def test_documentation_users_filtered_get(self):\n         properties = {\ndiff --git a/src/plone/restapi/tests/test_dxcontent_deserializer.py b/src/plone/restapi/tests/test_dxcontent_deserializer.py\nindex 6cd85ccd..b8def61d 100644\n--- a/src/plone/restapi/tests/test_dxcontent_deserializer.py\n+++ b/src/plone/restapi/tests/test_dxcontent_deserializer.py\n@@ -210,7 +210,7 @@ def test_deserializer_sets_missing_value_on_required_field(self):\n \n     def test_set_layout(self):\n         current_layout = self.portal.doc1.getLayout()\n-        self.assertNotEquals(current_layout, "my_new_layout")\n+        self.assertNotEqual(current_layout, "my_new_layout")\n         self.deserialize(body=\'{"layout": "my_new_layout"}\')\n         self.assertEqual(\'my_new_layout\', self.portal.doc1.getLayout())\n \ndiff --git a/src/plone/restapi/tests/test_error_handling.py b/src/plone/restapi/tests/test_error_handling.py\nindex 9cad014d..7cb02d73 100644\n--- a/src/plone/restapi/tests/test_error_handling.py\n+++ b/src/plone/restapi/tests/test_error_handling.py\n@@ -52,6 +52,9 @@ def setUp(self):\n         self.folder_url = self.folder.absolute_url()\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     @unittest.skip(\'Not working since we moved to plone.rest\')\n     def test_404_not_found(self):\n         response = self.api_session.get(\'non-existing-resource\')\ndiff --git a/src/plone/restapi/tests/test_expansion.py b/src/plone/restapi/tests/test_expansion.py\nindex 8bed02c9..de805d73 100644\n--- a/src/plone/restapi/tests/test_expansion.py\n+++ b/src/plone/restapi/tests/test_expansion.py\n@@ -120,6 +120,9 @@ def setUp(self):\n             title=u\'Some Folder\')\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_actions_is_expandable(self):\n         response = self.api_session.get(\'/folder\')\n \n@@ -331,6 +334,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_translations_is_expandable(self):\n         response = self.api_session.get(\'/en/test-document\')\n \ndiff --git a/src/plone/restapi/tests/test_locking.py b/src/plone/restapi/tests/test_locking.py\nindex 0e7b49fb..44e57653 100644\n--- a/src/plone/restapi/tests/test_locking.py\n+++ b/src/plone/restapi/tests/test_locking.py\n@@ -32,6 +32,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_lock_object(self):\n         response = self.api_session.post(\'/@lock\',)\n         transaction.commit()\ndiff --git a/src/plone/restapi/tests/test_permissions.py b/src/plone/restapi/tests/test_permissions.py\nindex 0bf9c634..84a94c9b 100644\n--- a/src/plone/restapi/tests/test_permissions.py\n+++ b/src/plone/restapi/tests/test_permissions.py\n@@ -24,6 +24,9 @@ def setUp(self):\n         self.api_session.headers.update({\'Accept\': \'application/json\'})\n         self.api_session.auth = (TEST_USER_NAME, TEST_USER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_anonymous_allowed_to_use_api_by_default(self):\n         setRoles(self.portal, TEST_USER_ID, [\'Anonymous\'])\n         transaction.commit()\ndiff --git a/src/plone/restapi/tests/test_registry.py b/src/plone/restapi/tests/test_registry.py\nindex bee9973c..7bb89ba9 100644\n--- a/src/plone/restapi/tests/test_registry.py\n+++ b/src/plone/restapi/tests/test_registry.py\n@@ -39,6 +39,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_registry_record(self):\n         response = self.api_session.get(\'/@registry/foo.bar\')\n \ndiff --git a/src/plone/restapi/tests/test_roles.py b/src/plone/restapi/tests/test_roles.py\nindex 05291d40..474dd4cc 100644\n--- a/src/plone/restapi/tests/test_roles.py\n+++ b/src/plone/restapi/tests/test_roles.py\n@@ -19,6 +19,9 @@ def setUp(self):\n         self.api_session.headers.update({\'Accept\': \'application/json\'})\n         self.api_session.auth = (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_roles_endpoint_lists_roles(self):\n         response = self.api_session.get(\'/@roles\')\n \ndiff --git a/src/plone/restapi/tests/test_search.py b/src/plone/restapi/tests/test_search.py\nindex 942f9f8a..827d1526 100644\n--- a/src/plone/restapi/tests/test_search.py\n+++ b/src/plone/restapi/tests/test_search.py\n@@ -102,6 +102,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_overall_response_format(self):\n         response = self.api_session.get(\'/@search\')\n \ndiff --git a/src/plone/restapi/tests/test_services.py b/src/plone/restapi/tests/test_services.py\nindex 7e25c043..9a68830c 100644\n--- a/src/plone/restapi/tests/test_services.py\n+++ b/src/plone/restapi/tests/test_services.py\n@@ -33,6 +33,9 @@ def setUp(self):\n         self.api_session.headers.update({\'Accept\': \'application/json\'})\n         self.api_session.auth = (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_document(self):\n         self.portal.invokeFactory(\n             \'Document\',\ndiff --git a/src/plone/restapi/tests/test_services_actions.py b/src/plone/restapi/tests/test_services_actions.py\nindex 9c3332d5..e90688ce 100644\n--- a/src/plone/restapi/tests/test_services_actions.py\n+++ b/src/plone/restapi/tests/test_services_actions.py\n@@ -17,7 +17,7 @@\n TEST_CATEGORY_ID = \'testcategory\'\n \n \n-class TestRegistry(unittest.TestCase):\n+class TestActions(unittest.TestCase):\n \n     layer = PLONE_RESTAPI_DX_FUNCTIONAL_TESTING\n \n@@ -66,6 +66,10 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+        self.anon_api_session.close()\n+\n     def test_actions_all_categories(self):\n         response = self.api_session.get(\'/@actions\')\n \ndiff --git a/src/plone/restapi/tests/test_services_breadcrumbs.py b/src/plone/restapi/tests/test_services_breadcrumbs.py\nindex b65f6618..190e6a0d 100644\n--- a/src/plone/restapi/tests/test_services_breadcrumbs.py\n+++ b/src/plone/restapi/tests/test_services_breadcrumbs.py\n@@ -35,6 +35,9 @@ def setUp(self):\n             title=u\'A document\')\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_breadcrumbs(self):\n         response = self.api_session.get(\'/folder/doc1/@breadcrumbs\')\n \ndiff --git a/src/plone/restapi/tests/test_services_comments.py b/src/plone/restapi/tests/test_services_comments.py\nindex 67cc15a0..0eb86824 100644\n--- a/src/plone/restapi/tests/test_services_comments.py\n+++ b/src/plone/restapi/tests/test_services_comments.py\n@@ -55,6 +55,10 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+        self.user_session.close()\n+\n     def test_list_datastructure(self):\n         url = \'{}/@comments\'.format(self.doc.absolute_url())\n         response = self.api_session.get(url)\ndiff --git a/src/plone/restapi/tests/test_services_content.py b/src/plone/restapi/tests/test_services_content.py\nindex 3af4b406..54b12521 100644\n--- a/src/plone/restapi/tests/test_services_content.py\n+++ b/src/plone/restapi/tests/test_services_content.py\n@@ -34,6 +34,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_response(self):\n         response = self.api_session.get(self.doc.absolute_url())\n         self.assertIn(\'version\', response.json())\ndiff --git a/src/plone/restapi/tests/test_services_controlpanels.py b/src/plone/restapi/tests/test_services_controlpanels.py\nindex aed41985..4955e5da 100644\n--- a/src/plone/restapi/tests/test_services_controlpanels.py\n+++ b/src/plone/restapi/tests/test_services_controlpanels.py\n@@ -32,6 +32,9 @@ def setUp(self):\n         self.api_session.headers.update({\'Accept\': \'application/json\'})\n         self.api_session.auth = (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_listing(self):\n         # Do we get a list with at least one item?\n         response = self.api_session.get(\'/@controlpanels\')\ndiff --git a/src/plone/restapi/tests/test_services_email_notification.py b/src/plone/restapi/tests/test_services_email_notification.py\nindex 192f6d1b..0e6ce006 100644\n--- a/src/plone/restapi/tests/test_services_email_notification.py\n+++ b/src/plone/restapi/tests/test_services_email_notification.py\n@@ -46,6 +46,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_email_notification_missing_parameters(self):\n         response = self.api_session.post(\n             \'/@email-notification\',\ndiff --git a/src/plone/restapi/tests/test_services_email_send.py b/src/plone/restapi/tests/test_services_email_send.py\nindex 32efd9e8..9fe77368 100644\n--- a/src/plone/restapi/tests/test_services_email_send.py\n+++ b/src/plone/restapi/tests/test_services_email_send.py\n@@ -46,6 +46,10 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+        self.anon_api_session.close()\n+\n     def test_email_send(self):\n         response = self.api_session.post(\n             \'/@email-send\',\ndiff --git a/src/plone/restapi/tests/test_services_groups.py b/src/plone/restapi/tests/test_services_groups.py\nindex 59ebff50..cf265f93 100644\n--- a/src/plone/restapi/tests/test_services_groups.py\n+++ b/src/plone/restapi/tests/test_services_groups.py\n@@ -38,6 +38,9 @@ def setUp(self):\n                             description=properties[\'description\'])\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_list_groups(self):\n         response = self.api_session.get(\'/@groups\')\n \ndiff --git a/src/plone/restapi/tests/test_services_history.py b/src/plone/restapi/tests/test_services_history.py\nindex 7dbbd54e..0d262098 100644\n--- a/src/plone/restapi/tests/test_services_history.py\n+++ b/src/plone/restapi/tests/test_services_history.py\n@@ -40,6 +40,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_types(self):\n         # Check if we have all history types in our test setup\n         response = self.api_session.get(self.endpoint_url)\n@@ -165,6 +168,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_actions_are_translated(self):\n         url = self.doc.absolute_url() + \'/@history\'\n         response = self.api_session.get(url)\ndiff --git a/src/plone/restapi/tests/test_services_navigation.py b/src/plone/restapi/tests/test_services_navigation.py\nindex 4a25f850..e7c08903 100644\n--- a/src/plone/restapi/tests/test_services_navigation.py\n+++ b/src/plone/restapi/tests/test_services_navigation.py\n@@ -55,6 +55,9 @@ def setUp(self):\n             title=u\'A document\')\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_navigation_with_no_params_gets_only_top_level(self):\n         response = self.api_session.get(\'/folder/@navigation\')\n \ndiff --git a/src/plone/restapi/tests/test_services_principals.py b/src/plone/restapi/tests/test_services_principals.py\nindex 64e2d647..2aaaf608 100644\n--- a/src/plone/restapi/tests/test_services_principals.py\n+++ b/src/plone/restapi/tests/test_services_principals.py\n@@ -52,6 +52,9 @@ def setUp(self):\n                             description=properties[\'description\'])\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_principals(self):\n         response = self.api_session.get(\n             \'/@principals\',\ndiff --git a/src/plone/restapi/tests/test_services_tiles.py b/src/plone/restapi/tests/test_services_tiles.py\nindex 4efd6869..7e6adf17 100644\n--- a/src/plone/restapi/tests/test_services_tiles.py\n+++ b/src/plone/restapi/tests/test_services_tiles.py\n@@ -75,6 +75,9 @@ def setUp(self):\n         provideAdapter(SampleTile, (Interface, Interface),\n                        IBasicTile, name=u\'sample.tile\')\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_available_tiles(self):\n         response = self.api_session.get(\'/@tiles\')\n \ndiff --git a/src/plone/restapi/tests/test_services_types.py b/src/plone/restapi/tests/test_services_types.py\nindex 44b44e5e..a498878f 100644\n--- a/src/plone/restapi/tests/test_services_types.py\n+++ b/src/plone/restapi/tests/test_services_types.py\n@@ -26,6 +26,9 @@ def setUp(self):\n         self.api_session.headers.update({\'Accept\': \'application/json\'})\n         self.api_session.auth = (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_types(self):\n         response = self.api_session.get(\n             \'{}/@types\'.format(self.portal.absolute_url())\n@@ -184,6 +187,9 @@ def setUp(self):\n \n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_get_types_translated(self):\n         response = self.api_session.get(\n             \'{}/@types\'.format(self.portal.absolute_url())\ndiff --git a/src/plone/restapi/tests/test_services_users.py b/src/plone/restapi/tests/test_services_users.py\nindex fadf8007..92097918 100644\n--- a/src/plone/restapi/tests/test_services_users.py\n+++ b/src/plone/restapi/tests/test_services_users.py\n@@ -67,6 +67,10 @@ def setUp(self):\n         )\n         transaction.commit()\n \n+    def tearDown(self):\n+        self.api_session.close()\n+        self.anon_api_session.close()\n+\n     def test_list_users(self):\n         response = self.api_session.get(\'/@users\')\n \n@@ -95,6 +99,7 @@ def test_list_users_without_being_manager(self):\n \n         response = noam_api_session.get(\'/@users\')\n         self.assertEqual(response.status_code, 401)\n+        noam_api_session.close()\n \n     def test_list_users_as_anonymous(self):\n \n@@ -343,6 +348,7 @@ def test_get_other_user_info_when_logged_in(self):\n \n         response = noam_api_session.get(\'/@users/otheruser\')\n         self.assertEqual(response.status_code, 401)\n+        noam_api_session.close()\n \n     def test_get_search_user_with_filter(self):\n         response = self.api_session.post(\n@@ -406,6 +412,7 @@ def test_get_search_user_with_filter_as_unauthorized_user(self):\n \n         response = noam_api_session.get(\'/@users\', params={\'query\': \'howa\'})\n         self.assertEqual(response.status_code, 401)\n+        noam_api_session.close()\n \n     def test_get_non_existing_user(self):\n         response = self.api_session.get(\'/@users/non-existing-user\')\ndiff --git a/src/plone/restapi/tests/test_services_vocabularies.py b/src/plone/restapi/tests/test_services_vocabularies.py\nindex f7c57563..25b6cf65 100644\n--- a/src/plone/restapi/tests/test_services_vocabularies.py\n+++ b/src/plone/restapi/tests/test_services_vocabularies.py\n@@ -139,6 +139,7 @@ def test_context_vocabulary(self):\n             })\n \n     def tearDown(self):\n+        self.api_session.close()\n         gsm = getGlobalSiteManager()\n         gsm.unregisterUtility(provided=IVocabularyFactory,\n                               name=\'plone.restapi.tests.test_vocabulary\')\ndiff --git a/src/plone/restapi/tests/test_site_deserializer.py b/src/plone/restapi/tests/test_site_deserializer.py\nindex ad7f7c0c..46f38550 100644\n--- a/src/plone/restapi/tests/test_site_deserializer.py\n+++ b/src/plone/restapi/tests/test_site_deserializer.py\n@@ -35,6 +35,6 @@ def deserialize(self, body=\'{}\', validate_all=False, context=None):\n \n     def test_set_layout(self):\n         current_layout = self.portal.getLayout()\n-        self.assertNotEquals(current_layout, "my_new_layout")\n+        self.assertNotEqual(current_layout, "my_new_layout")\n         self.deserialize(body=\'{"layout": "my_new_layout"}\')\n         self.assertEqual(\'my_new_layout\', self.portal.getLayout())\ndiff --git a/src/plone/restapi/tests/test_tus.py b/src/plone/restapi/tests/test_tus.py\nindex 3879ca81..e7ec7858 100644\n--- a/src/plone/restapi/tests/test_tus.py\n+++ b/src/plone/restapi/tests/test_tus.py\n@@ -400,6 +400,7 @@ def test_tus_can_replace_pdf_file(self):\n         self.assertEqual(pdf_file_size, self.file.file.size)\n \n     def tearDown(self):\n+        self.api_session.close()\n         client_home = os.environ.get(\'CLIENT_HOME\')\n         tmp_dir = os.path.join(client_home, \'tus-uploads\')\n         if os.path.isdir(tmp_dir):\n@@ -471,6 +472,7 @@ def test_cors_preflight_for_head_contains_tus_headers(self):\n         self.assertIn(\'Tus-Extension\', response.headers)\n \n     def tearDown(self):\n+        self.api_session.close()\n         gsm = getGlobalSiteManager()\n         gsm.unregisterAdapter(\n             CORSTestPolicy, (Interface, IBrowserRequest), ICORSPolicy)\n@@ -607,6 +609,9 @@ def setUp(self):\n         self.api_session.headers.update({\'Accept\': \'application/json\'})\n         self.api_session.auth = (TEST_USER_NAME, TEST_USER_PASSWORD)\n \n+    def tearDown(self):\n+        self.api_session.close()\n+\n     def test_tus_can_upload_pdf_file(self):\n         # initialize the upload with POST\n         pdf_file_path = os.path.join(os.path.dirname(__file__),\n'

