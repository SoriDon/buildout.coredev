Repository: plone.app.imaging


Branch: refs/heads/master
Date: 2019-09-27T13:10:10+03:00
Author: Alin Voinea (avoinea) <contact@avoinea.com>
Commit: https://github.com/plone/plone.app.imaging/commit/6105cebba7833a3568d2f76b52ee9706fe2b5741

Fix IOError: cannot write mode RGBA as JPEG

Files changed:
M src/plone/app/imaging/monkey.py

b"diff --git a/src/plone/app/imaging/monkey.py b/src/plone/app/imaging/monkey.py\nindex a99a7bc..a5b7090 100644\n--- a/src/plone/app/imaging/monkey.py\n+++ b/src/plone/app/imaging/monkey.py\n@@ -109,6 +109,12 @@ def scale(self, data, w, h, default_format='PNG'):\n     # for GIF, could also use image.format in ('GIF','PNG')\n     if original_mode == 'P' and img_format == 'GIF':\n         image = image.convert('P')\n+\n+    # Avoid - IOError: cannot write mode RGBA as JPEG\n+    # See https://github.com/python-pillow/Pillow/issues/2609#issuecomment-313841918\n+    if original_mode in ('CMYK', 'RGBA', 'LA') and target_format in ('JPG', 'JPEG'):\n+        target_format = 'PNG'\n+\n     thumbnail_file = StringIO()\n     # quality parameter doesn't affect lossless formats\n     image.save(thumbnail_file, target_format, quality=pil_quality, progressive=True)\n"

Repository: plone.app.imaging


Branch: refs/heads/master
Date: 2019-09-27T13:15:42+03:00
Author: Alin Voinea (avoinea) <contact@avoinea.com>
Commit: https://github.com/plone/plone.app.imaging/commit/e561f550699a71ec7cecaea3c306a61c4d02d77d

Update CHANGES

Files changed:
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex f1f873f..3a8614e 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Fix IOError: cannot write mode RGBA as JPEG on ImageField scale\n+  [avoinea]\n \n \n 2.1.0 (2018-10-30)\n'

Repository: plone.app.imaging


Branch: refs/heads/master
Date: 2019-09-30T09:24:58+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.imaging/commit/8dcf40ede55619f7dd5512a68ea7e2e0528fcc72

Merge pull request #38 from eea/master

Fix IOError: cannot write mode RGBA as JPEG

Files changed:
M CHANGES.rst
M src/plone/app/imaging/monkey.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex f1f873f..3a8614e 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Fix IOError: cannot write mode RGBA as JPEG on ImageField scale\n+  [avoinea]\n \n \n 2.1.0 (2018-10-30)\ndiff --git a/src/plone/app/imaging/monkey.py b/src/plone/app/imaging/monkey.py\nindex a99a7bc..a5b7090 100644\n--- a/src/plone/app/imaging/monkey.py\n+++ b/src/plone/app/imaging/monkey.py\n@@ -109,6 +109,12 @@ def scale(self, data, w, h, default_format='PNG'):\n     # for GIF, could also use image.format in ('GIF','PNG')\n     if original_mode == 'P' and img_format == 'GIF':\n         image = image.convert('P')\n+\n+    # Avoid - IOError: cannot write mode RGBA as JPEG\n+    # See https://github.com/python-pillow/Pillow/issues/2609#issuecomment-313841918\n+    if original_mode in ('CMYK', 'RGBA', 'LA') and target_format in ('JPG', 'JPEG'):\n+        target_format = 'PNG'\n+\n     thumbnail_file = StringIO()\n     # quality parameter doesn't affect lossless formats\n     image.save(thumbnail_file, target_format, quality=pil_quality, progressive=True)\n"

