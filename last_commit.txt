Repository: plone.scale


Branch: refs/heads/master
Date: 2022-04-14T00:33:34+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.scale/commit/b107bce87a6171753647dcbb4387affabf2b1b33

Fixed DeprecationWarning with Pillow 9.1.0 for ANTIALIAS.

Use `Resampling.LANCZOS`, falling back to `ANTIALIAS` on older Pillows.

If you want to try it out, you can edit `sources-60.ini` and add:

```
version-overrides =
    Pillow==9.1.0
```

I will update the pin in coredev after merge of this PR.

Files changed:
A news/49.bugfix
M plone/scale/scale.py

b'diff --git a/news/49.bugfix b/news/49.bugfix\nnew file mode 100644\nindex 0000000..cd1e30c\n--- /dev/null\n+++ b/news/49.bugfix\n@@ -0,0 +1,3 @@\n+Fixed ``DeprecationWarning`` with Pillow 9.1.0 for ``ANTIALIAS``.\n+Use ``Resampling.LANCZOS``, falling back to ``ANTIALIAS`` on older Pillows.\n+[maurits]\ndiff --git a/plone/scale/scale.py b/plone/scale/scale.py\nindex 0e55eed..0a42863 100644\n--- a/plone/scale/scale.py\n+++ b/plone/scale/scale.py\n@@ -7,6 +7,13 @@\n import warnings\n \n \n+try:\n+    # Pillow 9.1.0+\n+    LANCZOS = PIL.Image.Resampling.LANCZOS\n+except AttributeError:\n+    LANCZOS = PIL.Image.ANTIALIAS\n+\n+\n def none_as_int(the_int):\n     """For python 3 compatibility, to make int vs. none comparison possible\n     without changing the algorithms below.\n@@ -131,7 +138,7 @@ def _scale_thumbnail(image, width=None, height=None):\n \n     image.draft(image.mode, (dimensions.target_width, dimensions.target_height))\n     image = image.resize(\n-        (dimensions.target_width, dimensions.target_height), PIL.Image.ANTIALIAS\n+        (dimensions.target_width, dimensions.target_height), LANCZOS\n     )\n     return image\n \n@@ -393,11 +400,11 @@ def scalePILImage(image, width=None, height=None, mode="contain", direction=None\n         # to scale.\n         if mode == "contain":\n             image.thumbnail(\n-                (dimensions.final_width, dimensions.final_height), PIL.Image.ANTIALIAS\n+                (dimensions.final_width, dimensions.final_height), LANCZOS\n             )\n             return image\n         return image.resize(\n-            (dimensions.final_width, dimensions.final_height), PIL.Image.ANTIALIAS\n+            (dimensions.final_width, dimensions.final_height), LANCZOS\n         )\n \n     if dimensions.pre_scale_crop:\n@@ -412,7 +419,7 @@ def scalePILImage(image, width=None, height=None, mode="contain", direction=None\n \n     image.draft(image.mode, (dimensions.target_width, dimensions.target_height))\n     image = image.resize(\n-        (dimensions.target_width, dimensions.target_height), PIL.Image.ANTIALIAS\n+        (dimensions.target_width, dimensions.target_height), LANCZOS\n     )\n \n     if dimensions.post_scale_crop:\n'

Repository: plone.scale


Branch: refs/heads/master
Date: 2022-04-14T13:34:20+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.scale/commit/dce4db1efc46867dd3c3aa3f2850da2cc3f7511e

Merge pull request #50 from plone/maurits-pillow-910

Fixed DeprecationWarning with Pillow 9.1.0 for ANTIALIAS.

Files changed:
A news/49.bugfix
M plone/scale/scale.py

b'diff --git a/news/49.bugfix b/news/49.bugfix\nnew file mode 100644\nindex 0000000..cd1e30c\n--- /dev/null\n+++ b/news/49.bugfix\n@@ -0,0 +1,3 @@\n+Fixed ``DeprecationWarning`` with Pillow 9.1.0 for ``ANTIALIAS``.\n+Use ``Resampling.LANCZOS``, falling back to ``ANTIALIAS`` on older Pillows.\n+[maurits]\ndiff --git a/plone/scale/scale.py b/plone/scale/scale.py\nindex 0e55eed..0a42863 100644\n--- a/plone/scale/scale.py\n+++ b/plone/scale/scale.py\n@@ -7,6 +7,13 @@\n import warnings\n \n \n+try:\n+    # Pillow 9.1.0+\n+    LANCZOS = PIL.Image.Resampling.LANCZOS\n+except AttributeError:\n+    LANCZOS = PIL.Image.ANTIALIAS\n+\n+\n def none_as_int(the_int):\n     """For python 3 compatibility, to make int vs. none comparison possible\n     without changing the algorithms below.\n@@ -131,7 +138,7 @@ def _scale_thumbnail(image, width=None, height=None):\n \n     image.draft(image.mode, (dimensions.target_width, dimensions.target_height))\n     image = image.resize(\n-        (dimensions.target_width, dimensions.target_height), PIL.Image.ANTIALIAS\n+        (dimensions.target_width, dimensions.target_height), LANCZOS\n     )\n     return image\n \n@@ -393,11 +400,11 @@ def scalePILImage(image, width=None, height=None, mode="contain", direction=None\n         # to scale.\n         if mode == "contain":\n             image.thumbnail(\n-                (dimensions.final_width, dimensions.final_height), PIL.Image.ANTIALIAS\n+                (dimensions.final_width, dimensions.final_height), LANCZOS\n             )\n             return image\n         return image.resize(\n-            (dimensions.final_width, dimensions.final_height), PIL.Image.ANTIALIAS\n+            (dimensions.final_width, dimensions.final_height), LANCZOS\n         )\n \n     if dimensions.pre_scale_crop:\n@@ -412,7 +419,7 @@ def scalePILImage(image, width=None, height=None, mode="contain", direction=None\n \n     image.draft(image.mode, (dimensions.target_width, dimensions.target_height))\n     image = image.resize(\n-        (dimensions.target_width, dimensions.target_height), PIL.Image.ANTIALIAS\n+        (dimensions.target_width, dimensions.target_height), LANCZOS\n     )\n \n     if dimensions.post_scale_crop:\n'

