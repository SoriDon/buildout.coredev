Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-06-15T17:05:13+02:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.layout/commit/4fb6bd2691c7f5ff607ddc7d2ab0cde684cf5e9f

Fix og:image by using an @@images scale instead of @@download.

Files changed:
M plone/app/layout/viewlets/social.py

b'diff --git a/plone/app/layout/viewlets/social.py b/plone/app/layout/viewlets/social.py\nindex 8f96aed2..eb11af0b 100644\n--- a/plone/app/layout/viewlets/social.py\n+++ b/plone/app/layout/viewlets/social.py\n@@ -92,14 +92,24 @@ def _get_tags(self):\n         found_image = False\n         if item.has_enclosure and item.file_length > 0:\n             if item.file_type.startswith("image"):\n-                found_image = True\n-                tags.extend(\n-                    [\n-                        dict(property="og:image", content=item.file_url),\n-                        dict(itemprop="image", content=item.file_url),\n-                        dict(property="og:image:type", content=item.file_type),\n-                    ]\n-                )\n+                image = None\n+                scales = self.context.restrictedTraverse(\'@@images\', None)\n+                if scales:\n+                    try:\n+                        image = scales.scale(\'image\', scale=\'great\')\n+                    except Exception as e:\n+                        logger.exception(e)\n+                if image:\n+                    tags.extend(\n+                        [\n+                            dict(property="og:image", content=image.url),\n+                            dict(property="og:image:width", content=image.width),\n+                            dict(property="og:image:height", content=image.height),\n+                            dict(itemprop="image", content=image.url),\n+                            dict(property="og:image:type", content=item.file_type),\n+                        ]\n+                    )\n+                    found_image = True\n             elif (\n                 item.file_type.startswith("video")\n                 or item.file_type == "application/x-shockwave-flash"\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-06-15T17:06:29+02:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.layout/commit/17630ffd47a0e79ab1e9d9b1564b188836a7a00c

add news

Files changed:
A news/312.bugfix

b'diff --git a/news/312.bugfix b/news/312.bugfix\nnew file mode 100644\nindex 00000000..f61fa619\n--- /dev/null\n+++ b/news/312.bugfix\n@@ -0,0 +1,2 @@\n+Fix og:image by using an @@images scale instead of @@download.\n+[agitator]\n\\ No newline at end of file\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-06-16T17:19:01+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/395a8a125bd2a654e0bcf5ca1d59d3fbbcb704fd

Merge branch 'master' into fix-og-image

Files changed:
A news/311.bugfix
M plone/app/layout/viewlets/toolbar.pt

b'diff --git a/news/311.bugfix b/news/311.bugfix\nnew file mode 100644\nindex 00000000..5dd813c3\n--- /dev/null\n+++ b/news/311.bugfix\n@@ -0,0 +1,2 @@\n+Toolbar width and wrapping tweaks.\n+[agitator]\n\\ No newline at end of file\ndiff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex 8549ca81..cdfe07a8 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -34,7 +34,7 @@\n          data-bs-offset="0,0"\n          aria-expanded="false"\n          tal:attributes="href personal_bar/homelink_url">\n-        <tal:icon tal:replace="structure python:icons.tag(\'toolbar-action/personaltools\', tag_class=\'me-1\')" />\n+        <tal:icon tal:replace="structure python:icons.tag(\'toolbar-action/personaltools\', tag_class=\'\')" />\n         <span class="toolbar-label" tal:content="personal_bar/user_name">User</span>\n       </a>\n \n@@ -45,8 +45,8 @@\n           <h6 class="dropdown-header">${personal_bar/user_name}</h6>\n         </li>\n         <li tal:repeat="action personal_bar/user_actions">\n-          <a href="${action/href}" class="dropdown-item">\n-            <tal:icon replace="structure python:icons.tag(action.get(\'icon\', \'dot\'), tag_class=\'me-1\')" />\n+          <a href="${action/href}" class="nav-link dropdown-item">\n+            <tal:icon replace="structure python:icons.tag(action.get(\'icon\', \'dot\'), tag_class=\'\')" />\n             <tal:actionname tal:content="action/title">\n               action title\n             </tal:actionname>\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-06-16T17:19:08+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/4b13df9a8cbb514d91d98f0df5b1801e534d7fb7

Merge pull request #312 from plone/fix-og-image

Fix og:image by using an @@images scale instead of @@download.

Files changed:
A news/312.bugfix
M plone/app/layout/viewlets/social.py

b'diff --git a/news/312.bugfix b/news/312.bugfix\nnew file mode 100644\nindex 00000000..f61fa619\n--- /dev/null\n+++ b/news/312.bugfix\n@@ -0,0 +1,2 @@\n+Fix og:image by using an @@images scale instead of @@download.\n+[agitator]\n\\ No newline at end of file\ndiff --git a/plone/app/layout/viewlets/social.py b/plone/app/layout/viewlets/social.py\nindex 8f96aed2..eb11af0b 100644\n--- a/plone/app/layout/viewlets/social.py\n+++ b/plone/app/layout/viewlets/social.py\n@@ -92,14 +92,24 @@ def _get_tags(self):\n         found_image = False\n         if item.has_enclosure and item.file_length > 0:\n             if item.file_type.startswith("image"):\n-                found_image = True\n-                tags.extend(\n-                    [\n-                        dict(property="og:image", content=item.file_url),\n-                        dict(itemprop="image", content=item.file_url),\n-                        dict(property="og:image:type", content=item.file_type),\n-                    ]\n-                )\n+                image = None\n+                scales = self.context.restrictedTraverse(\'@@images\', None)\n+                if scales:\n+                    try:\n+                        image = scales.scale(\'image\', scale=\'great\')\n+                    except Exception as e:\n+                        logger.exception(e)\n+                if image:\n+                    tags.extend(\n+                        [\n+                            dict(property="og:image", content=image.url),\n+                            dict(property="og:image:width", content=image.width),\n+                            dict(property="og:image:height", content=image.height),\n+                            dict(itemprop="image", content=image.url),\n+                            dict(property="og:image:type", content=item.file_type),\n+                        ]\n+                    )\n+                    found_image = True\n             elif (\n                 item.file_type.startswith("video")\n                 or item.file_type == "application/x-shockwave-flash"\n'

