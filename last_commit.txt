Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2022-01-19T17:25:34+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/25820be583b1765c4040bda59c43eb53925ec7c9

Use toolbar-action/workflow as icon.  Only works in Plone 6.

Removed the CMFPlacefulWorkflow skin layer that only contained the old logo.
Removed ancient upgrade step, added new one for the above.

Fixes https://github.com/plone/Products.CMFPlacefulWorkflow/issues/33

Files changed:
A news/33.breaking
M Products/CMFPlacefulWorkflow/__init__.py
M Products/CMFPlacefulWorkflow/profiles.zcml
M Products/CMFPlacefulWorkflow/profiles/base/controlpanel.xml
M Products/CMFPlacefulWorkflow/profiles/base/metadata.xml
M Products/CMFPlacefulWorkflow/profiles/default/metadata.xml
M setup.py
D Products/CMFPlacefulWorkflow/profiles/base/skins.xml

b'diff --git a/Products/CMFPlacefulWorkflow/__init__.py b/Products/CMFPlacefulWorkflow/__init__.py\nindex d70f929..4af4254 100644\n--- a/Products/CMFPlacefulWorkflow/__init__.py\n+++ b/Products/CMFPlacefulWorkflow/__init__.py\n@@ -19,7 +19,6 @@\n Initialization\n """\n from AccessControl import ModuleSecurityInfo\n-from Products.CMFCore import DirectoryView\n from Products.CMFCore import utils\n from Products.CMFPlacefulWorkflow import DefaultWorkflowPolicy\n from Products.CMFPlacefulWorkflow import PlacefulWorkflowTool\n@@ -29,8 +28,6 @@\n \n tools = (PlacefulWorkflowTool.PlacefulWorkflowTool, )\n \n-DirectoryView.registerDirectory(\'skins\', globals())\n-\n \n # Initialization method\n def initialize(context):\ndiff --git a/Products/CMFPlacefulWorkflow/profiles.zcml b/Products/CMFPlacefulWorkflow/profiles.zcml\nindex 034b622..3e42861 100644\n--- a/Products/CMFPlacefulWorkflow/profiles.zcml\n+++ b/Products/CMFPlacefulWorkflow/profiles.zcml\n@@ -28,12 +28,20 @@\n      pre_handler="Products.CMFPlacefulWorkflow.setuphandlers.uninstall"\n      />\n \n-  <genericsetup:upgradeStep\n-    title="Apply full profile"\n-    description="Meant mostly for upgrades from ancient versions that had no profile yet."\n-    source="*"\n-    destination="1.4.1"\n-    handler=".upgrades.apply_full_profile"\n-    profile="Products.CMFPlacefulWorkflow:CMFPlacefulWorkflow" />\n+  <genericsetup:upgradeSteps\n+    source="1.4.1"\n+    destination="1000"\n+    profile="Products.CMFPlacefulWorkflow:CMFPlacefulWorkflow">\n+    <genericsetup:upgradeDepends\n+      title="Update controlpanel logo"\n+      import_profile="Products.CMFPlacefulWorkflow:base"\n+      import_steps="controlpanel"\n+      />\n+    <genericsetup:upgradeDepends\n+      title="Remove skin layer"\n+      import_profile="Products.CMFPlacefulWorkflow:uninstall"\n+      import_steps="skins"\n+      />\n+  </genericsetup:upgradeSteps>\n \n </configure>\ndiff --git a/Products/CMFPlacefulWorkflow/profiles/base/controlpanel.xml b/Products/CMFPlacefulWorkflow/profiles/base/controlpanel.xml\nindex 69c312a..ce4a083 100644\n--- a/Products/CMFPlacefulWorkflow/profiles/base/controlpanel.xml\n+++ b/Products/CMFPlacefulWorkflow/profiles/base/controlpanel.xml\n@@ -7,7 +7,7 @@\n  <configlet\n   title="Workflow Policies" action_id="placefulworkflow"\n   appId="CMFPlacefulWorkflow" category="Products" condition_expr=""\n-  icon_expr="string:$portal_url/placefulworkflow_icon.png"\n+  icon_expr="string:toolbar-action/workflow"\n   url_expr="string:$portal_url/prefs_workflow_localpolicies_form" visible="True"\n   i18n:attributes="title">\n   <permission>Manage portal</permission>\ndiff --git a/Products/CMFPlacefulWorkflow/profiles/base/metadata.xml b/Products/CMFPlacefulWorkflow/profiles/base/metadata.xml\nindex 21fc675..8590785 100644\n--- a/Products/CMFPlacefulWorkflow/profiles/base/metadata.xml\n+++ b/Products/CMFPlacefulWorkflow/profiles/base/metadata.xml\n@@ -1,3 +1,3 @@\n <metadata>\n-  <version>1.4.1</version>\n-</metadata>\n\\ No newline at end of file\n+  <version>1000</version>\n+</metadata>\ndiff --git a/Products/CMFPlacefulWorkflow/profiles/base/skins.xml b/Products/CMFPlacefulWorkflow/profiles/base/skins.xml\ndeleted file mode 100644\nindex 48fb680..0000000\n--- a/Products/CMFPlacefulWorkflow/profiles/base/skins.xml\n+++ /dev/null\n@@ -1,13 +0,0 @@\n-<?xml version="1.0"?>\n-<object name="portal_skins">\n-\n- <object name="CMFPlacefulWorkflow"\n-         meta_type="Filesystem Directory View"\n-         directory="Products.CMFPlacefulWorkflow:skins/CMFPlacefulWorkflow"/>\n-\n- <skin-path name="*">\n-  <layer insert-after="custom"\n-         name="CMFPlacefulWorkflow"/>\n- </skin-path>\n-\n-</object>\ndiff --git a/Products/CMFPlacefulWorkflow/profiles/default/metadata.xml b/Products/CMFPlacefulWorkflow/profiles/default/metadata.xml\nindex ba6da7a..89b8a8c 100644\n--- a/Products/CMFPlacefulWorkflow/profiles/default/metadata.xml\n+++ b/Products/CMFPlacefulWorkflow/profiles/default/metadata.xml\n@@ -1,6 +1,6 @@\n <metadata>\n-  <version>1.4.1</version>\n+  <version>1000</version>\n   <dependencies>\n     <dependency>profile-Products.CMFPlacefulWorkflow:base</dependency>\n   </dependencies>\n-</metadata>\n\\ No newline at end of file\n+</metadata>\ndiff --git a/news/33.breaking b/news/33.breaking\nnew file mode 100644\nindex 0000000..40c96ad\n--- /dev/null\n+++ b/news/33.breaking\n@@ -0,0 +1,4 @@\n+Use ``toolbar-action/workflow`` as icon.  Only works in Plone 6.\n+Removed the ``CMFPlacefulWorkflow`` skin layer.\n+Removed ancient upgrade step, added new one for the above.\n+[maurits]\ndiff --git a/setup.py b/setup.py\nindex 7fa3f18..675c9ee 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -1,6 +1,6 @@\n from setuptools import setup, find_packages\n \n-version = \'2.0.5.dev0\'\n+version = \'3.0.0a1.dev0\'\n \n \n setup(\n@@ -12,14 +12,13 @@\n     classifiers=[\n         "Development Status :: 5 - Production/Stable",\n         "Framework :: Plone",\n-        "Framework :: Plone :: 5.2",\n+        "Framework :: Plone :: 6.0",\n         "Framework :: Plone :: Core",\n         "License :: OSI Approved :: GNU General Public License (GPL)",\n         "Programming Language :: Python",\n-        "Programming Language :: Python :: 2.7",\n-        "Programming Language :: Python :: 3.6",\n         "Programming Language :: Python :: 3.7",\n         "Programming Language :: Python :: 3.8",\n+        "Programming Language :: Python :: 3.9",\n     ],\n     keywords=\'CMF Plone Zope2 workflow\',\n     author=\'Encolpe DEGOUTE\',\n@@ -44,6 +43,6 @@\n         \'zope.i18nmessageid\',\n         \'Products.CMFCore\',\n         \'Products.CMFPlone\',\n-        \'Products.GenericSetup >= 2.0.dev0\',\n+        \'Products.GenericSetup >= 2.0\',\n     ],\n )\n'

Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2022-01-25T10:20:29+01:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/d0d60c378284ac09ba1a38656723ce3d18bcb6a7

Merge pull request #37 from plone/plone6-icon

Use toolbar-action/workflow as icon.  Only works in Plone 6.

Files changed:
A news/33.breaking
M Products/CMFPlacefulWorkflow/__init__.py
M Products/CMFPlacefulWorkflow/profiles.zcml
M Products/CMFPlacefulWorkflow/profiles/base/controlpanel.xml
M Products/CMFPlacefulWorkflow/profiles/base/metadata.xml
M Products/CMFPlacefulWorkflow/profiles/default/metadata.xml
M setup.py
D Products/CMFPlacefulWorkflow/profiles/base/skins.xml

b'diff --git a/Products/CMFPlacefulWorkflow/__init__.py b/Products/CMFPlacefulWorkflow/__init__.py\nindex d70f929..4af4254 100644\n--- a/Products/CMFPlacefulWorkflow/__init__.py\n+++ b/Products/CMFPlacefulWorkflow/__init__.py\n@@ -19,7 +19,6 @@\n Initialization\n """\n from AccessControl import ModuleSecurityInfo\n-from Products.CMFCore import DirectoryView\n from Products.CMFCore import utils\n from Products.CMFPlacefulWorkflow import DefaultWorkflowPolicy\n from Products.CMFPlacefulWorkflow import PlacefulWorkflowTool\n@@ -29,8 +28,6 @@\n \n tools = (PlacefulWorkflowTool.PlacefulWorkflowTool, )\n \n-DirectoryView.registerDirectory(\'skins\', globals())\n-\n \n # Initialization method\n def initialize(context):\ndiff --git a/Products/CMFPlacefulWorkflow/profiles.zcml b/Products/CMFPlacefulWorkflow/profiles.zcml\nindex 034b622..3e42861 100644\n--- a/Products/CMFPlacefulWorkflow/profiles.zcml\n+++ b/Products/CMFPlacefulWorkflow/profiles.zcml\n@@ -28,12 +28,20 @@\n      pre_handler="Products.CMFPlacefulWorkflow.setuphandlers.uninstall"\n      />\n \n-  <genericsetup:upgradeStep\n-    title="Apply full profile"\n-    description="Meant mostly for upgrades from ancient versions that had no profile yet."\n-    source="*"\n-    destination="1.4.1"\n-    handler=".upgrades.apply_full_profile"\n-    profile="Products.CMFPlacefulWorkflow:CMFPlacefulWorkflow" />\n+  <genericsetup:upgradeSteps\n+    source="1.4.1"\n+    destination="1000"\n+    profile="Products.CMFPlacefulWorkflow:CMFPlacefulWorkflow">\n+    <genericsetup:upgradeDepends\n+      title="Update controlpanel logo"\n+      import_profile="Products.CMFPlacefulWorkflow:base"\n+      import_steps="controlpanel"\n+      />\n+    <genericsetup:upgradeDepends\n+      title="Remove skin layer"\n+      import_profile="Products.CMFPlacefulWorkflow:uninstall"\n+      import_steps="skins"\n+      />\n+  </genericsetup:upgradeSteps>\n \n </configure>\ndiff --git a/Products/CMFPlacefulWorkflow/profiles/base/controlpanel.xml b/Products/CMFPlacefulWorkflow/profiles/base/controlpanel.xml\nindex 69c312a..ce4a083 100644\n--- a/Products/CMFPlacefulWorkflow/profiles/base/controlpanel.xml\n+++ b/Products/CMFPlacefulWorkflow/profiles/base/controlpanel.xml\n@@ -7,7 +7,7 @@\n  <configlet\n   title="Workflow Policies" action_id="placefulworkflow"\n   appId="CMFPlacefulWorkflow" category="Products" condition_expr=""\n-  icon_expr="string:$portal_url/placefulworkflow_icon.png"\n+  icon_expr="string:toolbar-action/workflow"\n   url_expr="string:$portal_url/prefs_workflow_localpolicies_form" visible="True"\n   i18n:attributes="title">\n   <permission>Manage portal</permission>\ndiff --git a/Products/CMFPlacefulWorkflow/profiles/base/metadata.xml b/Products/CMFPlacefulWorkflow/profiles/base/metadata.xml\nindex 21fc675..8590785 100644\n--- a/Products/CMFPlacefulWorkflow/profiles/base/metadata.xml\n+++ b/Products/CMFPlacefulWorkflow/profiles/base/metadata.xml\n@@ -1,3 +1,3 @@\n <metadata>\n-  <version>1.4.1</version>\n-</metadata>\n\\ No newline at end of file\n+  <version>1000</version>\n+</metadata>\ndiff --git a/Products/CMFPlacefulWorkflow/profiles/base/skins.xml b/Products/CMFPlacefulWorkflow/profiles/base/skins.xml\ndeleted file mode 100644\nindex 48fb680..0000000\n--- a/Products/CMFPlacefulWorkflow/profiles/base/skins.xml\n+++ /dev/null\n@@ -1,13 +0,0 @@\n-<?xml version="1.0"?>\n-<object name="portal_skins">\n-\n- <object name="CMFPlacefulWorkflow"\n-         meta_type="Filesystem Directory View"\n-         directory="Products.CMFPlacefulWorkflow:skins/CMFPlacefulWorkflow"/>\n-\n- <skin-path name="*">\n-  <layer insert-after="custom"\n-         name="CMFPlacefulWorkflow"/>\n- </skin-path>\n-\n-</object>\ndiff --git a/Products/CMFPlacefulWorkflow/profiles/default/metadata.xml b/Products/CMFPlacefulWorkflow/profiles/default/metadata.xml\nindex ba6da7a..89b8a8c 100644\n--- a/Products/CMFPlacefulWorkflow/profiles/default/metadata.xml\n+++ b/Products/CMFPlacefulWorkflow/profiles/default/metadata.xml\n@@ -1,6 +1,6 @@\n <metadata>\n-  <version>1.4.1</version>\n+  <version>1000</version>\n   <dependencies>\n     <dependency>profile-Products.CMFPlacefulWorkflow:base</dependency>\n   </dependencies>\n-</metadata>\n\\ No newline at end of file\n+</metadata>\ndiff --git a/news/33.breaking b/news/33.breaking\nnew file mode 100644\nindex 0000000..40c96ad\n--- /dev/null\n+++ b/news/33.breaking\n@@ -0,0 +1,4 @@\n+Use ``toolbar-action/workflow`` as icon.  Only works in Plone 6.\n+Removed the ``CMFPlacefulWorkflow`` skin layer.\n+Removed ancient upgrade step, added new one for the above.\n+[maurits]\ndiff --git a/setup.py b/setup.py\nindex 7fa3f18..675c9ee 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -1,6 +1,6 @@\n from setuptools import setup, find_packages\n \n-version = \'2.0.5.dev0\'\n+version = \'3.0.0a1.dev0\'\n \n \n setup(\n@@ -12,14 +12,13 @@\n     classifiers=[\n         "Development Status :: 5 - Production/Stable",\n         "Framework :: Plone",\n-        "Framework :: Plone :: 5.2",\n+        "Framework :: Plone :: 6.0",\n         "Framework :: Plone :: Core",\n         "License :: OSI Approved :: GNU General Public License (GPL)",\n         "Programming Language :: Python",\n-        "Programming Language :: Python :: 2.7",\n-        "Programming Language :: Python :: 3.6",\n         "Programming Language :: Python :: 3.7",\n         "Programming Language :: Python :: 3.8",\n+        "Programming Language :: Python :: 3.9",\n     ],\n     keywords=\'CMF Plone Zope2 workflow\',\n     author=\'Encolpe DEGOUTE\',\n@@ -44,6 +43,6 @@\n         \'zope.i18nmessageid\',\n         \'Products.CMFCore\',\n         \'Products.CMFPlone\',\n-        \'Products.GenericSetup >= 2.0.dev0\',\n+        \'Products.GenericSetup >= 2.0\',\n     ],\n )\n'

