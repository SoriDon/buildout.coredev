Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2019-08-05T10:16:27+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.multilingual/commit/629997ceeeb3c91670e941542ccf56e6f4597dd4

fix error when adding a new language with contents in assets folder

Files changed:
A news/358.bugfix
M src/plone/app/multilingual/subscriber.py

b"diff --git a/news/358.bugfix b/news/358.bugfix\nnew file mode 100644\nindex 00000000..27185a50\n--- /dev/null\n+++ b/news/358.bugfix\n@@ -0,0 +1,2 @@\n+fix adding new language when Language Independent Folder has content\n+[petschki]\ndiff --git a/src/plone/app/multilingual/subscriber.py b/src/plone/app/multilingual/subscriber.py\nindex 582a4890..6069fb7b 100644\n--- a/src/plone/app/multilingual/subscriber.py\n+++ b/src/plone/app/multilingual/subscriber.py\n@@ -89,13 +89,14 @@ def unindex_language_independent(ob, event):\n \n     language_tool = getToolByName(ob, 'portal_languages')\n     language_codes = language_tool.supported_langs\n-\n+    portal = getSite()\n     uuid = IUUID(ob).split('-')[0]\n+\n     for code in language_codes:\n         for brain in pc.unrestrictedSearchResults(UID=uuid + '-' + code):\n-            ob.unrestrictedTraverse(brain.getPath()).unindexObject()\n+            portal.unrestrictedTraverse(brain.getPath()).unindexObject()\n         for brain in pc.unrestrictedSearchResults(UID=uuid):\n-            ob.unrestrictedTraverse(brain.getPath()).unindexObject()\n+            portal.unrestrictedTraverse(brain.getPath()).unindexObject()\n \n \n # Multilingual subscribers\n"

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2019-08-07T10:40:21+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.multilingual/commit/dfbc2f19e512b99e6349db52ddda5efea18fd1bf

Merge pull request #361 from plone/petschki/issue-358

fix error when adding a new language with contents in assets folder

Files changed:
A news/358.bugfix
M src/plone/app/multilingual/subscriber.py

b"diff --git a/news/358.bugfix b/news/358.bugfix\nnew file mode 100644\nindex 00000000..27185a50\n--- /dev/null\n+++ b/news/358.bugfix\n@@ -0,0 +1,2 @@\n+fix adding new language when Language Independent Folder has content\n+[petschki]\ndiff --git a/src/plone/app/multilingual/subscriber.py b/src/plone/app/multilingual/subscriber.py\nindex 582a4890..6069fb7b 100644\n--- a/src/plone/app/multilingual/subscriber.py\n+++ b/src/plone/app/multilingual/subscriber.py\n@@ -89,13 +89,14 @@ def unindex_language_independent(ob, event):\n \n     language_tool = getToolByName(ob, 'portal_languages')\n     language_codes = language_tool.supported_langs\n-\n+    portal = getSite()\n     uuid = IUUID(ob).split('-')[0]\n+\n     for code in language_codes:\n         for brain in pc.unrestrictedSearchResults(UID=uuid + '-' + code):\n-            ob.unrestrictedTraverse(brain.getPath()).unindexObject()\n+            portal.unrestrictedTraverse(brain.getPath()).unindexObject()\n         for brain in pc.unrestrictedSearchResults(UID=uuid):\n-            ob.unrestrictedTraverse(brain.getPath()).unindexObject()\n+            portal.unrestrictedTraverse(brain.getPath()).unindexObject()\n \n \n # Multilingual subscribers\n"

