Repository: plone.namedfile


Branch: refs/heads/master
Date: 2017-05-19T11:05:40+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.namedfile/commit/8944f614ee13fed5532a0eb81825813696b85f58

reduce logging level

Files changed:
M CHANGES.rst
M plone/namedfile/utils/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 137cdad..b52c670 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -23,6 +23,9 @@ Bug fixes:
 - Fix bug on Image rotation if ImageIFD.XResolution or ImageIFD.YResolution are not set.
   [loechel]
 
+- Fix: Do not log failing PIL image regognition as error, but as warning.
+  [jensens]
+
 
 4.2.0 (2017-03-26)
 ------------------
diff --git a/plone/namedfile/utils/__init__.py b/plone/namedfile/utils/__init__.py
index 2ec9a8c..7ce3350 100644
--- a/plone/namedfile/utils/__init__.py
+++ b/plone/namedfile/utils/__init__.py
@@ -141,11 +141,14 @@ def getImageInfo(data):
             img = PIL.Image.open(StringIO(data))
             width, height = img.size
             content_type = img.format
-        except Exception as e:
+        except Exception:
             # TODO: determ wich error really happens
             # Should happen if data is to short --> first_bytes
-            log.error(e)
-            # return 'image/jpeg', -1, -1
+            # happens also if data is an svg or another special format.
+            log.warn(
+                'PIL can not recognize the image. '
+                'Image is probably broken or of a non-supported format.'
+            )
 
     log.debug('Image Info (Type: %s, Width: %s, Height: %s)',
               content_type, width, height)


Repository: plone.namedfile


Branch: refs/heads/master
Date: 2017-05-19T14:13:30+02:00
Author: Robert Niederreiter (rnixx) <office@squarewave.at>
Commit: https://github.com/plone/plone.namedfile/commit/48541276399d7b0fc6aeceb59ba8c391ff56fbbe

Merge pull request #50 from plone/jensens-fix-logging

reduce logging level

Files changed:
M CHANGES.rst
M plone/namedfile/utils/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 137cdad..b52c670 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -23,6 +23,9 @@ Bug fixes:
 - Fix bug on Image rotation if ImageIFD.XResolution or ImageIFD.YResolution are not set.
   [loechel]
 
+- Fix: Do not log failing PIL image regognition as error, but as warning.
+  [jensens]
+
 
 4.2.0 (2017-03-26)
 ------------------
diff --git a/plone/namedfile/utils/__init__.py b/plone/namedfile/utils/__init__.py
index 2ec9a8c..7ce3350 100644
--- a/plone/namedfile/utils/__init__.py
+++ b/plone/namedfile/utils/__init__.py
@@ -141,11 +141,14 @@ def getImageInfo(data):
             img = PIL.Image.open(StringIO(data))
             width, height = img.size
             content_type = img.format
-        except Exception as e:
+        except Exception:
             # TODO: determ wich error really happens
             # Should happen if data is to short --> first_bytes
-            log.error(e)
-            # return 'image/jpeg', -1, -1
+            # happens also if data is an svg or another special format.
+            log.warn(
+                'PIL can not recognize the image. '
+                'Image is probably broken or of a non-supported format.'
+            )
 
     log.debug('Image Info (Type: %s, Width: %s, Height: %s)',
               content_type, width, height)


