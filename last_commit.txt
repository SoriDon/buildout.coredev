Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2018-10-05T13:36:12+02:00
Author: Manuel Reinhardt (reinhardt) <reinhardt@syslab.com>
Commit: https://github.com/plone/Products.CMFEditions/commit/76a11854c7dff0d07341dd695b7ecb543c8b8e20

Replaced usages of getObjSize with human_readable_size. #60

Files changed:
A news/60.feature
M Products/CMFEditions/browser/configure.zcml
M Products/CMFEditions/browser/templates/version_file_view.pt
M Products/CMFEditions/browser/templates/version_image_view.pt
M Products/CMFEditions/browser/views.py

b'diff --git a/Products/CMFEditions/browser/configure.zcml b/Products/CMFEditions/browser/configure.zcml\nindex b804731..f995fad 100644\n--- a/Products/CMFEditions/browser/configure.zcml\n+++ b/Products/CMFEditions/browser/configure.zcml\n@@ -52,6 +52,7 @@\n     <browser:page\n         for="*"\n         name="version_file_view"\n+        class=".views.VersionView"\n         template="templates/version_file_view.pt"\n         permission="zope2.View"\n         />\n@@ -59,6 +60,7 @@\n     <browser:page\n         for="*"\n         name="version_image_view"\n+        class=".views.VersionView"\n         template="templates/version_image_view.pt"\n         permission="zope2.View"\n         />\ndiff --git a/Products/CMFEditions/browser/templates/version_file_view.pt b/Products/CMFEditions/browser/templates/version_file_view.pt\nindex 81b7531..42039c9 100644\n--- a/Products/CMFEditions/browser/templates/version_file_view.pt\n+++ b/Products/CMFEditions/browser/templates/version_file_view.pt\n@@ -8,7 +8,7 @@\n <metal:main fill-slot="main">\n     <tal:main-macro metal:define-macro="main"\n            tal:define="size_value context/get_size;\n-                       size_label python:size_value and context.getObjSize(context) or None;\n+                       size_label python:size_value and view.human_readable_size(size_value) or None;\n                        content_type context/get_content_type|context/Format;\n                       ">\n \ndiff --git a/Products/CMFEditions/browser/templates/version_image_view.pt b/Products/CMFEditions/browser/templates/version_image_view.pt\nindex 672a3b7..e6295a6 100644\n--- a/Products/CMFEditions/browser/templates/version_image_view.pt\n+++ b/Products/CMFEditions/browser/templates/version_image_view.pt\n@@ -26,7 +26,7 @@\n             &mdash;\n                 <span i18n:translate="label_size">Size</span>:\n \n-                <span tal:define="size python:here.getObjSize(here)"\n+                <span tal:define="size python:view.human_readable_size(here.get_size())"\n                       tal:content="size">\n                     File size\n                 </span>\ndiff --git a/Products/CMFEditions/browser/views.py b/Products/CMFEditions/browser/views.py\nindex 8db1666..29ab7fb 100644\n--- a/Products/CMFEditions/browser/views.py\n+++ b/Products/CMFEditions/browser/views.py\n@@ -6,6 +6,7 @@\n from Products.CMFEditions.utilities import isObjectChanged\n from Products.CMFEditions.utilities import isObjectVersioned\n from Products.CMFEditions.utilities import maybeSaveVersion\n+from Products.CMFPlone.utils import human_readable_size\n from Products.statusmessages.interfaces import IStatusMessage\n \n class UpdateVersionOnEditView(BrowserView):\n@@ -86,3 +87,9 @@ def __call__(self):\n         tag = \'<img src="%s/file_download_version?version_id=%s" %s\' % \\\n               (here_url, version_id, working_copy_tag[altPos:])\n         return tag\n+\n+\n+class VersionView(BrowserView):\n+\n+    def human_readable_size(self):\n+        return human_readable_size\ndiff --git a/news/60.feature b/news/60.feature\nnew file mode 100644\nindex 0000000..a45935e\n--- /dev/null\n+++ b/news/60.feature\n@@ -0,0 +1 @@\n+Replaced usages of getObjSize with human_readable_size.\n'

Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2018-10-05T20:21:30+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFEditions/commit/b8396916e48eec6b203573068f10aea13184b49c

Merge pull request #61 from plone/60-skin-scripts-removed

Replaced usages of getObjSize with human_readable_size

Files changed:
A news/60.feature
M Products/CMFEditions/browser/configure.zcml
M Products/CMFEditions/browser/templates/version_file_view.pt
M Products/CMFEditions/browser/templates/version_image_view.pt
M Products/CMFEditions/browser/views.py

b'diff --git a/Products/CMFEditions/browser/configure.zcml b/Products/CMFEditions/browser/configure.zcml\nindex b804731..f995fad 100644\n--- a/Products/CMFEditions/browser/configure.zcml\n+++ b/Products/CMFEditions/browser/configure.zcml\n@@ -52,6 +52,7 @@\n     <browser:page\n         for="*"\n         name="version_file_view"\n+        class=".views.VersionView"\n         template="templates/version_file_view.pt"\n         permission="zope2.View"\n         />\n@@ -59,6 +60,7 @@\n     <browser:page\n         for="*"\n         name="version_image_view"\n+        class=".views.VersionView"\n         template="templates/version_image_view.pt"\n         permission="zope2.View"\n         />\ndiff --git a/Products/CMFEditions/browser/templates/version_file_view.pt b/Products/CMFEditions/browser/templates/version_file_view.pt\nindex 81b7531..42039c9 100644\n--- a/Products/CMFEditions/browser/templates/version_file_view.pt\n+++ b/Products/CMFEditions/browser/templates/version_file_view.pt\n@@ -8,7 +8,7 @@\n <metal:main fill-slot="main">\n     <tal:main-macro metal:define-macro="main"\n            tal:define="size_value context/get_size;\n-                       size_label python:size_value and context.getObjSize(context) or None;\n+                       size_label python:size_value and view.human_readable_size(size_value) or None;\n                        content_type context/get_content_type|context/Format;\n                       ">\n \ndiff --git a/Products/CMFEditions/browser/templates/version_image_view.pt b/Products/CMFEditions/browser/templates/version_image_view.pt\nindex 672a3b7..e6295a6 100644\n--- a/Products/CMFEditions/browser/templates/version_image_view.pt\n+++ b/Products/CMFEditions/browser/templates/version_image_view.pt\n@@ -26,7 +26,7 @@\n             &mdash;\n                 <span i18n:translate="label_size">Size</span>:\n \n-                <span tal:define="size python:here.getObjSize(here)"\n+                <span tal:define="size python:view.human_readable_size(here.get_size())"\n                       tal:content="size">\n                     File size\n                 </span>\ndiff --git a/Products/CMFEditions/browser/views.py b/Products/CMFEditions/browser/views.py\nindex 8db1666..29ab7fb 100644\n--- a/Products/CMFEditions/browser/views.py\n+++ b/Products/CMFEditions/browser/views.py\n@@ -6,6 +6,7 @@\n from Products.CMFEditions.utilities import isObjectChanged\n from Products.CMFEditions.utilities import isObjectVersioned\n from Products.CMFEditions.utilities import maybeSaveVersion\n+from Products.CMFPlone.utils import human_readable_size\n from Products.statusmessages.interfaces import IStatusMessage\n \n class UpdateVersionOnEditView(BrowserView):\n@@ -86,3 +87,9 @@ def __call__(self):\n         tag = \'<img src="%s/file_download_version?version_id=%s" %s\' % \\\n               (here_url, version_id, working_copy_tag[altPos:])\n         return tag\n+\n+\n+class VersionView(BrowserView):\n+\n+    def human_readable_size(self):\n+        return human_readable_size\ndiff --git a/news/60.feature b/news/60.feature\nnew file mode 100644\nindex 0000000..a45935e\n--- /dev/null\n+++ b/news/60.feature\n@@ -0,0 +1 @@\n+Replaced usages of getObjSize with human_readable_size.\n'

