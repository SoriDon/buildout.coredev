Repository: plone.app.caching


Branch: refs/heads/master
Date: 2022-05-05T15:01:43+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.caching/commit/54d59b55039ffeffe07508d3d865726d6e7c090b

pyupgrade and overhaul, use plone.test and reduce dependencies.

Files changed:
M plone/app/caching/browser/configure.zcml
M plone/app/caching/operations/etags.py
M plone/app/caching/profiles.zcml
M plone/app/caching/purge.py
M setup.py

b'diff --git a/plone/app/caching/browser/configure.zcml b/plone/app/caching/browser/configure.zcml\nindex c9cb415..23bbda1 100644\n--- a/plone/app/caching/browser/configure.zcml\n+++ b/plone/app/caching/browser/configure.zcml\n@@ -6,7 +6,7 @@\n \n   <browser:page\n       name="caching-controlpanel"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.ControlPanel"\n       template="controlpanel.pt"\n       permission="cmf.ManagePortal"\n@@ -14,7 +14,7 @@\n \n   <browser:page\n       name="caching-controlpanel-import"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.Import"\n       template="import.pt"\n       permission="cmf.ManagePortal"\n@@ -22,7 +22,7 @@\n \n   <browser:page\n       name="caching-controlpanel-purge"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.Purge"\n       template="purge.pt"\n       permission="cmf.ManagePortal"\n@@ -30,7 +30,7 @@\n \n   <browser:page\n       name="caching-controlpanel-ramcache"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.RAMCache"\n       template="ramcache.pt"\n       permission="cmf.ManagePortal"\ndiff --git a/plone/app/caching/operations/etags.py b/plone/app/caching/operations/etags.py\nindex 0cbf70a..94987b0 100644\n--- a/plone/app/caching/operations/etags.py\n+++ b/plone/app/caching/operations/etags.py\n@@ -6,23 +6,14 @@\n from Products.CMFCore.interfaces import ICatalogTool\n from Products.CMFCore.interfaces import IMembershipTool\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import safe_hasattr\n+from plone.base.utils import safe_hasattr\n from zope.component import adapter\n from zope.component import queryMultiAdapter\n from zope.component import queryUtility\n from zope.interface import implementer\n from zope.interface import Interface\n-\n-\n-try:\n-    from Products.CMFPlone.resources.utils import get_override_directory\n-    from Products.CMFPlone.resources.utils import PRODUCTION_RESOURCE_DIRECTORY\n-except ImportError:\n-    # Plone < 6\n-    from Products.CMFPlone.resources.browser.combine import get_override_directory\n-    from Products.CMFPlone.resources.browser.combine import (\n-        PRODUCTION_RESOURCE_DIRECTORY,\n-    )\n+from Products.CMFPlone.resources.utils import get_override_directory\n+from Products.CMFPlone.resources.utils import PRODUCTION_RESOURCE_DIRECTORY\n \n import random\n import time\n@@ -236,7 +227,7 @@ def __call__(self):\n \n @implementer(IETagValue)\n @adapter(Interface, Interface)\n-class ResourceRegistries(object):\n+class ResourceRegistries:\n     """The ``resourceRegistries`` etag component, returning a timestamp.\n \n     This is the last modified timestamp from the Plone 5+ Resource Registries.\n@@ -268,7 +259,7 @@ def __call__(self):\n \n @implementer(IETagValue)\n @adapter(Interface, Interface)\n-class Layout(object):\n+class Layout:\n     """The \'layout\' etag component, returning they layout of a content item."""\n \n     def __init__(self, published, request):\ndiff --git a/plone/app/caching/profiles.zcml b/plone/app/caching/profiles.zcml\nindex a8d1d3f..433c313 100644\n--- a/plone/app/caching/profiles.zcml\n+++ b/plone/app/caching/profiles.zcml\n@@ -16,7 +16,7 @@\n       name="v2"\n       title="Upgrade plone.app.caching to v2 with terse caching"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n-      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       directory="profiles/default"\n       />\n \ndiff --git a/plone/app/caching/purge.py b/plone/app/caching/purge.py\nindex 0982b05..4162b4a 100644\n--- a/plone/app/caching/purge.py\n+++ b/plone/app/caching/purge.py\n@@ -141,8 +141,7 @@ def getRelativePaths(self):\n                         yield relativePath\n                         continue\n                     rewrittenPaths = rewriter(relativePath) or []\n-                    for rewrittenPath in rewrittenPaths:\n-                        yield rewrittenPath\n+                    yield from rewrittenPaths\n \n     def getAbsolutePaths(self):\n         root = self._getRoot()\ndiff --git a/setup.py b/setup.py\nindex 3132b7f..da96778 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -37,25 +37,8 @@\n         "python-dateutil",\n         "plone.caching",\n         "plone.cachepurging",\n-        "plone.app.registry >= 1.0b5",\n-        "zope.browserresource",\n-        "zope.interface",\n-        "zope.component",\n-        "zope.publisher",\n-        "zope.pagetemplate",\n-        "plone.memoize",\n-        "plone.protect",\n-        "plone.registry >= 1.0b4",\n-        "Products.CMFDynamicViewFTI",\n-        "Products.GenericSetup",\n-        "Products.CMFCore",\n-        "Products.statusmessages",\n-        "Zope",\n-        "Acquisition",\n-        "plone.app.z3cform",\n-        "plone.z3cform",\n-        "z3c.form",\n         "z3c.zcmlhook",\n+        "Products.CMFPlone",\n     ],\n     extras_require={\n         "test": [\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2022-05-05T15:03:18+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.caching/commit/b3364a8c8169606ba80085f9648042be3ffae72f

add newsfile

Files changed:
A 98.bugfix

b'diff --git a/98.bugfix b/98.bugfix\nnew file mode 100644\nindex 0000000..42c2218\n--- /dev/null\n+++ b/98.bugfix\n@@ -0,0 +1,3 @@\n+\n+Use plone.base and some overhaul.\n+[jensens]\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2022-05-05T16:18:54+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.caching/commit/6508a70ffdf994e306869861a10c2bbdd99a3ddb

remove test, pointless for coredev package

Files changed:
D .github/workflows/tests.yml

b'diff --git a/.github/workflows/tests.yml b/.github/workflows/tests.yml\ndeleted file mode 100644\nindex dc2521b..0000000\n--- a/.github/workflows/tests.yml\n+++ /dev/null\n@@ -1,34 +0,0 @@\n-name: Tests\n-on: [push]\n-jobs:\n-  build:\n-    runs-on: ubuntu-latest\n-    strategy:\n-      fail-fast: false\n-      matrix:\n-        python: [3.7, 3.8, 3.9]\n-        plone: ["6.0.0a3", "5.2-latest"]\n-        exclude:\n-          - plone: "5.2-latest"\n-            python: 3.9\n-\n-    steps:\n-      # git checkout\n-      - uses: actions/checkout@v2\n-\n-      - name: Setup Plone ${{ matrix.plone }} with Python ${{ matrix.python }}\n-        id: setup\n-        uses: plone/setup-plone@v1.0.0\n-        with:\n-          python-version: ${{ matrix.python }}\n-          plone-version: ${{ matrix.plone }}\n-\n-      # Install plone.volto with test extras\n-      - name: Install plone.volto\n-        run: |\n-          pip install ".[test]"\n-\n-      # test\n-      - name: test\n-        run: |\n-          zope-testrunner --auto-color --auto-progress --test-path .\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2022-05-05T16:20:22+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.caching/commit/7f46c3d376697b8d0fff35090e9843e93f59e733

add newsfile

Files changed:
A news/98.bugfix

b'diff --git a/news/98.bugfix b/news/98.bugfix\nnew file mode 100644\nindex 0000000..00716d3\n--- /dev/null\n+++ b/news/98.bugfix\n@@ -0,0 +1,2 @@\n+Minor overhaul, use plone.base, remove some Plone 5.2 imports, ...\n+[jensens]\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2022-05-05T17:48:03+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.caching/commit/0dc71ebe2fccdca82b71344677b2bd203fea0734

Merge pull request #98 from plone/plone-base-overhaul

pyupgrade and overhaul, use plone.test and reduce dependencies.

Files changed:
A 98.bugfix
A news/98.bugfix
M plone/app/caching/browser/configure.zcml
M plone/app/caching/operations/etags.py
M plone/app/caching/profiles.zcml
M plone/app/caching/purge.py
M setup.py
D .github/workflows/tests.yml

b'diff --git a/.github/workflows/tests.yml b/.github/workflows/tests.yml\ndeleted file mode 100644\nindex dc2521b..0000000\n--- a/.github/workflows/tests.yml\n+++ /dev/null\n@@ -1,34 +0,0 @@\n-name: Tests\n-on: [push]\n-jobs:\n-  build:\n-    runs-on: ubuntu-latest\n-    strategy:\n-      fail-fast: false\n-      matrix:\n-        python: [3.7, 3.8, 3.9]\n-        plone: ["6.0.0a3", "5.2-latest"]\n-        exclude:\n-          - plone: "5.2-latest"\n-            python: 3.9\n-\n-    steps:\n-      # git checkout\n-      - uses: actions/checkout@v2\n-\n-      - name: Setup Plone ${{ matrix.plone }} with Python ${{ matrix.python }}\n-        id: setup\n-        uses: plone/setup-plone@v1.0.0\n-        with:\n-          python-version: ${{ matrix.python }}\n-          plone-version: ${{ matrix.plone }}\n-\n-      # Install plone.volto with test extras\n-      - name: Install plone.volto\n-        run: |\n-          pip install ".[test]"\n-\n-      # test\n-      - name: test\n-        run: |\n-          zope-testrunner --auto-color --auto-progress --test-path .\ndiff --git a/98.bugfix b/98.bugfix\nnew file mode 100644\nindex 0000000..42c2218\n--- /dev/null\n+++ b/98.bugfix\n@@ -0,0 +1,3 @@\n+\n+Use plone.base and some overhaul.\n+[jensens]\ndiff --git a/news/98.bugfix b/news/98.bugfix\nnew file mode 100644\nindex 0000000..00716d3\n--- /dev/null\n+++ b/news/98.bugfix\n@@ -0,0 +1,2 @@\n+Minor overhaul, use plone.base, remove some Plone 5.2 imports, ...\n+[jensens]\ndiff --git a/plone/app/caching/browser/configure.zcml b/plone/app/caching/browser/configure.zcml\nindex c9cb415..23bbda1 100644\n--- a/plone/app/caching/browser/configure.zcml\n+++ b/plone/app/caching/browser/configure.zcml\n@@ -6,7 +6,7 @@\n \n   <browser:page\n       name="caching-controlpanel"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.ControlPanel"\n       template="controlpanel.pt"\n       permission="cmf.ManagePortal"\n@@ -14,7 +14,7 @@\n \n   <browser:page\n       name="caching-controlpanel-import"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.Import"\n       template="import.pt"\n       permission="cmf.ManagePortal"\n@@ -22,7 +22,7 @@\n \n   <browser:page\n       name="caching-controlpanel-purge"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.Purge"\n       template="purge.pt"\n       permission="cmf.ManagePortal"\n@@ -30,7 +30,7 @@\n \n   <browser:page\n       name="caching-controlpanel-ramcache"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.RAMCache"\n       template="ramcache.pt"\n       permission="cmf.ManagePortal"\ndiff --git a/plone/app/caching/operations/etags.py b/plone/app/caching/operations/etags.py\nindex 0cbf70a..94987b0 100644\n--- a/plone/app/caching/operations/etags.py\n+++ b/plone/app/caching/operations/etags.py\n@@ -6,23 +6,14 @@\n from Products.CMFCore.interfaces import ICatalogTool\n from Products.CMFCore.interfaces import IMembershipTool\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import safe_hasattr\n+from plone.base.utils import safe_hasattr\n from zope.component import adapter\n from zope.component import queryMultiAdapter\n from zope.component import queryUtility\n from zope.interface import implementer\n from zope.interface import Interface\n-\n-\n-try:\n-    from Products.CMFPlone.resources.utils import get_override_directory\n-    from Products.CMFPlone.resources.utils import PRODUCTION_RESOURCE_DIRECTORY\n-except ImportError:\n-    # Plone < 6\n-    from Products.CMFPlone.resources.browser.combine import get_override_directory\n-    from Products.CMFPlone.resources.browser.combine import (\n-        PRODUCTION_RESOURCE_DIRECTORY,\n-    )\n+from Products.CMFPlone.resources.utils import get_override_directory\n+from Products.CMFPlone.resources.utils import PRODUCTION_RESOURCE_DIRECTORY\n \n import random\n import time\n@@ -236,7 +227,7 @@ def __call__(self):\n \n @implementer(IETagValue)\n @adapter(Interface, Interface)\n-class ResourceRegistries(object):\n+class ResourceRegistries:\n     """The ``resourceRegistries`` etag component, returning a timestamp.\n \n     This is the last modified timestamp from the Plone 5+ Resource Registries.\n@@ -268,7 +259,7 @@ def __call__(self):\n \n @implementer(IETagValue)\n @adapter(Interface, Interface)\n-class Layout(object):\n+class Layout:\n     """The \'layout\' etag component, returning they layout of a content item."""\n \n     def __init__(self, published, request):\ndiff --git a/plone/app/caching/profiles.zcml b/plone/app/caching/profiles.zcml\nindex a8d1d3f..433c313 100644\n--- a/plone/app/caching/profiles.zcml\n+++ b/plone/app/caching/profiles.zcml\n@@ -16,7 +16,7 @@\n       name="v2"\n       title="Upgrade plone.app.caching to v2 with terse caching"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n-      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       directory="profiles/default"\n       />\n \ndiff --git a/plone/app/caching/purge.py b/plone/app/caching/purge.py\nindex 0982b05..4162b4a 100644\n--- a/plone/app/caching/purge.py\n+++ b/plone/app/caching/purge.py\n@@ -141,8 +141,7 @@ def getRelativePaths(self):\n                         yield relativePath\n                         continue\n                     rewrittenPaths = rewriter(relativePath) or []\n-                    for rewrittenPath in rewrittenPaths:\n-                        yield rewrittenPath\n+                    yield from rewrittenPaths\n \n     def getAbsolutePaths(self):\n         root = self._getRoot()\ndiff --git a/setup.py b/setup.py\nindex 3132b7f..da96778 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -37,25 +37,8 @@\n         "python-dateutil",\n         "plone.caching",\n         "plone.cachepurging",\n-        "plone.app.registry >= 1.0b5",\n-        "zope.browserresource",\n-        "zope.interface",\n-        "zope.component",\n-        "zope.publisher",\n-        "zope.pagetemplate",\n-        "plone.memoize",\n-        "plone.protect",\n-        "plone.registry >= 1.0b4",\n-        "Products.CMFDynamicViewFTI",\n-        "Products.GenericSetup",\n-        "Products.CMFCore",\n-        "Products.statusmessages",\n-        "Zope",\n-        "Acquisition",\n-        "plone.app.z3cform",\n-        "plone.z3cform",\n-        "z3c.form",\n         "z3c.zcmlhook",\n+        "Products.CMFPlone",\n     ],\n     extras_require={\n         "test": [\n'

