Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2016-05-30T21:45:34+02:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/Products.ATContentTypes/commit/0fe1831a837441b79004e530d31e3e5dc21660cc

make tests pass with old and new safe HTML cleaner (PLIP 1441)

Files changed:
M CHANGES.rst
M Products/ATContentTypes/tests/test_atdocument.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 920fad8..7bdfc34 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Make tests work with old and new safe HTML cleaner (PLIP 1441)
+  [tomgross]
 
 Bug fixes:
 
diff --git a/Products/ATContentTypes/tests/test_atdocument.py b/Products/ATContentTypes/tests/test_atdocument.py
index 3475432..de5b68f 100644
--- a/Products/ATContentTypes/tests/test_atdocument.py
+++ b/Products/ATContentTypes/tests/test_atdocument.py
@@ -104,6 +104,12 @@ def test_x_safe_html(self):
             text = "<p>test</p><script>I'm a nasty boy<p>nested</p></script>"
             doc.setText(text, mimetype=mimetype)
             txt = doc.getText()
+            # fix for lxml based safe HTML cleaner
+            # nested p-tags are not allowed and therefore removed
+            # put expected string to mimetypes tuple above and remove condition
+            # once PLIP 1441 is merged.
+            if '<p/>' in txt:
+                expected = '<p/><p>test</p>\n'
             self.assertEqual(txt, expected, (txt, expected, mimetype))
 
     def test_get_size(self):


Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2016-05-31T12:00:30+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.ATContentTypes/commit/6f0aa13a16855603b4a20660f6416d4378765175

Merge pull request #35 from plone/plip1441

Make tests pass with old and new safe HTML cleaner (PLIP 1441)

Files changed:
M CHANGES.rst
M Products/ATContentTypes/tests/test_atdocument.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 920fad8..7bdfc34 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Make tests work with old and new safe HTML cleaner (PLIP 1441)
+  [tomgross]
 
 Bug fixes:
 
diff --git a/Products/ATContentTypes/tests/test_atdocument.py b/Products/ATContentTypes/tests/test_atdocument.py
index 3475432..de5b68f 100644
--- a/Products/ATContentTypes/tests/test_atdocument.py
+++ b/Products/ATContentTypes/tests/test_atdocument.py
@@ -104,6 +104,12 @@ def test_x_safe_html(self):
             text = "<p>test</p><script>I'm a nasty boy<p>nested</p></script>"
             doc.setText(text, mimetype=mimetype)
             txt = doc.getText()
+            # fix for lxml based safe HTML cleaner
+            # nested p-tags are not allowed and therefore removed
+            # put expected string to mimetypes tuple above and remove condition
+            # once PLIP 1441 is merged.
+            if '<p/>' in txt:
+                expected = '<p/><p>test</p>\n'
             self.assertEqual(txt, expected, (txt, expected, mimetype))
 
     def test_get_size(self):


