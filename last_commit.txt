Repository: plone.app.layout


Branch: refs/heads/master
Date: 2016-12-29T21:09:54Z
Author: Daniel Jowett (djowett) <daniel@jowettenterprises.com>
Commit: https://github.com/plone/plone.app.layout/commit/dc5bf988ffbc7309a99d4e10e90911cf4777d576

Fix sitemap.xml.gz for plone.app.multilingual (&gt;= 2.x) but breaks it for LinguaPlone and PAM 1.x

If this is a problem then please see bedbfeb67 on 2.5.x branch for how to maintain compatibility with these products.

Files changed:
M CHANGES.rst
M plone/app/layout/sitemap/sitemap.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e2f7675..3a44eb5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,11 @@ Changelog
 
 Breaking changes:
 
-- *add item here*
+- Fix sitemap.xml.gz for plone.app.multilingual (>= 2.x) but breaks it for 
+  LinguaPlone and plone.app.multilingual 1.x
+  If this is a problem then please see bedbfeb67 on 2.5.x branch for how to 
+  maintain compatibility with these products.
+  [djowett]
 
 New features:
 
diff --git a/plone/app/layout/sitemap/sitemap.py b/plone/app/layout/sitemap/sitemap.py
index d8bfd60..7a21b90 100644
--- a/plone/app/layout/sitemap/sitemap.py
+++ b/plone/app/layout/sitemap/sitemap.py
@@ -54,7 +54,7 @@ def objects(self):
 
         query['is_default_page'] = True
         default_page_modified = OOBTree()
-        for item in catalog.searchResults(query, Language='all'):
+        for item in catalog.searchResults(query):
             key = item.getURL().rsplit('/', 1)[0]
             value = (item.modified.micros(), item.modified.ISO8601())
             default_page_modified[key] = value
@@ -78,7 +78,7 @@ def objects(self):
             }
 
         query['is_default_page'] = False
-        for item in catalog.searchResults(query, Language='all'):
+        for item in catalog.searchResults(query):
             loc = item.getURL()
             date = item.modified
             # Comparison must be on GMT value


Repository: plone.app.layout


Branch: refs/heads/master
Date: 2016-12-30T11:01:22+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/b219090b9454200832dece9b5a2324f373f081cf

Merge pull request #110 from plone/master_fix_issue_91

Fix sitemap.xml.gz for plone.app.multilingual (&gt;= 2.x)

Files changed:
M CHANGES.rst
M plone/app/layout/sitemap/sitemap.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e2f7675..3a44eb5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,11 @@ Changelog
 
 Breaking changes:
 
-- *add item here*
+- Fix sitemap.xml.gz for plone.app.multilingual (>= 2.x) but breaks it for 
+  LinguaPlone and plone.app.multilingual 1.x
+  If this is a problem then please see bedbfeb67 on 2.5.x branch for how to 
+  maintain compatibility with these products.
+  [djowett]
 
 New features:
 
diff --git a/plone/app/layout/sitemap/sitemap.py b/plone/app/layout/sitemap/sitemap.py
index d8bfd60..7a21b90 100644
--- a/plone/app/layout/sitemap/sitemap.py
+++ b/plone/app/layout/sitemap/sitemap.py
@@ -54,7 +54,7 @@ def objects(self):
 
         query['is_default_page'] = True
         default_page_modified = OOBTree()
-        for item in catalog.searchResults(query, Language='all'):
+        for item in catalog.searchResults(query):
             key = item.getURL().rsplit('/', 1)[0]
             value = (item.modified.micros(), item.modified.ISO8601())
             default_page_modified[key] = value
@@ -78,7 +78,7 @@ def objects(self):
             }
 
         query['is_default_page'] = False
-        for item in catalog.searchResults(query, Language='all'):
+        for item in catalog.searchResults(query):
             loc = item.getURL()
             date = item.modified
             # Comparison must be on GMT value


