Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-10-06T13:11:56+02:00
Author: Alin Voinea (avoinea) <contact@avoinea.com>
Commit: https://github.com/plone/plone.restapi/commit/10f3a3eadc65439cae3f2e4cd8aabf30fb8e799d

Volto blocks editable layout behavior (#1477)

* Add volto.blocks.editable.layout marker interface to fix TTW DX Layout

* Changelog

* Black

* [Tests] - Update snapshots

Co-authored-by: Timo Stollenwerk &lt;tisto@users.noreply.github.com&gt;
Co-authored-by: David Glick &lt;david@glicksoftware.com&gt;

Files changed:
A news/1476.bugfix
M src/plone/restapi/behaviors.py
M src/plone/restapi/configure.zcml
M src/plone/restapi/tests/http-examples/controlpanels_get_dexterity_item.resp
M src/plone/restapi/tests/http-examples/controlpanels_post_dexterity_item.resp

b'diff --git a/news/1476.bugfix b/news/1476.bugfix\nnew file mode 100644\nindex 000000000..0968fd5e8\n--- /dev/null\n+++ b/news/1476.bugfix\n@@ -0,0 +1,2 @@\n+New behavior `volto.blocks.editable.layout` to be used with Volto DX Editable Layout\n+[avoinea]\ndiff --git a/src/plone/restapi/behaviors.py b/src/plone/restapi/behaviors.py\nindex af59e503a..a544f0fbd 100644\n--- a/src/plone/restapi/behaviors.py\n+++ b/src/plone/restapi/behaviors.py\n@@ -37,3 +37,7 @@ class IBlocks(model.Schema):\n         default={"items": []},\n         required=False,\n     )\n+\n+\n+class IBlocksEditableLayout(IBlocks):\n+    """Volto Blocks Editable Layout marker interface"""\ndiff --git a/src/plone/restapi/configure.zcml b/src/plone/restapi/configure.zcml\nindex f31a80c92..005eea5bc 100644\n--- a/src/plone/restapi/configure.zcml\n+++ b/src/plone/restapi/configure.zcml\n@@ -114,6 +114,13 @@\n         provides=".behaviors.IBlocks"\n         />\n \n+    <plone:behavior\n+        name="volto.blocks.editable.layout"\n+        title="Blocks (Editable Layout)"\n+        description="Enables Volto Blocks (editable layout) support"\n+        provides=".behaviors.IBlocksEditableLayout"\n+        />\n+\n   </configure>\n \n   <utility\ndiff --git a/src/plone/restapi/tests/http-examples/controlpanels_get_dexterity_item.resp b/src/plone/restapi/tests/http-examples/controlpanels_get_dexterity_item.resp\nindex 65c729188..a668bea51 100644\n--- a/src/plone/restapi/tests/http-examples/controlpanels_get_dexterity_item.resp\n+++ b/src/plone/restapi/tests/http-examples/controlpanels_get_dexterity_item.resp\n@@ -39,7 +39,8 @@ Content-Type: application/json\n         "tests.restapi.test_annotations_behavior": false,\n         "tests.restapi.test_behavior": false,\n         "title": "My Custom Content Type",\n-        "volto.blocks": false\n+        "volto.blocks": false,\n+        "volto.blocks.editable.layout": false\n     },\n     "description": "A custom content-type",\n     "group": "Content",\n@@ -63,6 +64,7 @@ Content-Type: application/json\n                     "plone.allowdiscussion",\n                     "plone.basic",\n                     "volto.blocks",\n+                    "volto.blocks.editable.layout",\n                     "plone.categorization",\n                     "plone.collection",\n                     "plone.publication",\n@@ -353,6 +355,12 @@ Content-Type: application/json\n                 "factory": "Yes/No",\n                 "title": "Blocks",\n                 "type": "boolean"\n+            },\n+            "volto.blocks.editable.layout": {\n+                "description": "Enables Volto Blocks (editable layout) support",\n+                "factory": "Yes/No",\n+                "title": "Blocks (Editable Layout)",\n+                "type": "boolean"\n             }\n         },\n         "required": [\ndiff --git a/src/plone/restapi/tests/http-examples/controlpanels_post_dexterity_item.resp b/src/plone/restapi/tests/http-examples/controlpanels_post_dexterity_item.resp\nindex 35f5a7678..d622acc6d 100644\n--- a/src/plone/restapi/tests/http-examples/controlpanels_post_dexterity_item.resp\n+++ b/src/plone/restapi/tests/http-examples/controlpanels_post_dexterity_item.resp\n@@ -40,7 +40,8 @@ Location: http://localhost:55001/plone/@controlpanels/dexterity-types/my_custom_\n         "tests.restapi.test_annotations_behavior": false,\n         "tests.restapi.test_behavior": false,\n         "title": "My Custom Content Type",\n-        "volto.blocks": false\n+        "volto.blocks": false,\n+        "volto.blocks.editable.layout": false\n     },\n     "description": "A custom content-type",\n     "group": "Content",\n@@ -64,6 +65,7 @@ Location: http://localhost:55001/plone/@controlpanels/dexterity-types/my_custom_\n                     "plone.allowdiscussion",\n                     "plone.basic",\n                     "volto.blocks",\n+                    "volto.blocks.editable.layout",\n                     "plone.categorization",\n                     "plone.collection",\n                     "plone.publication",\n@@ -354,6 +356,12 @@ Location: http://localhost:55001/plone/@controlpanels/dexterity-types/my_custom_\n                 "factory": "Yes/No",\n                 "title": "Blocks",\n                 "type": "boolean"\n+            },\n+            "volto.blocks.editable.layout": {\n+                "description": "Enables Volto Blocks (editable layout) support",\n+                "factory": "Yes/No",\n+                "title": "Blocks (Editable Layout)",\n+                "type": "boolean"\n             }\n         },\n         "required": [\n'

