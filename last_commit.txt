Repository: plone.app.content


Branch: refs/heads/master
Date: 2017-10-18T16:57:17+02:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/e2b58d8670b909fc3d36e65bb81fc08d41a50340

move at specific code in PropertiesActionView to its own method

Files changed:
M plone/app/content/browser/contents/properties.py

diff --git a/plone/app/content/browser/contents/properties.py b/plone/app/content/browser/contents/properties.py
index 0e3b950..8d52195 100644
--- a/plone/app/content/browser/contents/properties.py
+++ b/plone/app/content/browser/contents/properties.py
@@ -107,6 +107,43 @@ def dx_action(self, obj):
         if self.language and behavior_categorization:
             behavior_categorization.language = self.language
 
+    def at_action(self, obj):
+        if self.effectiveDate:
+            try:
+                obj.setEffectiveDate(DateTime(self.effectiveDate))
+            except AttributeError:
+                pass
+        if self.expirationDate:
+            try:
+                obj.setExpirationDate(DateTime(self.expirationDate))
+            except AttributeError:
+                pass
+        if self.copyright:
+            try:
+                obj.setRights(self.copyright)
+            except AttributeError:
+                pass
+        if self.contributors:
+            try:
+                obj.setContributors(self.contributors)
+            except AttributeError:
+                pass
+        if self.creators:
+            try:
+                obj.setCreators(self.creators)
+            except AttributeError:
+                pass
+        if self.exclude:
+            try:
+                obj.setExcludeFromNav(self.exclude == 'yes')
+            except AttributeError:
+                pass
+        if self.language:
+            try:
+                obj.setLanguage(self.language)
+            except AttributeError:
+                pass
+
     def action(self, obj, bypass_recurse=False):
 
         if self.putils.isDefaultPage(obj):
@@ -119,40 +156,6 @@ def action(self, obj, bypass_recurse=False):
         if IDexterityContent.providedBy(obj):
             self.dx_action(obj)
         else:
-            if self.effectiveDate:
-                try:
-                    obj.setEffectiveDate(DateTime(self.effectiveDate))
-                except AttributeError:
-                    pass
-            if self.expirationDate:
-                try:
-                    obj.setExpirationDate(DateTime(self.expirationDate))
-                except AttributeError:
-                    pass
-            if self.copyright:
-                try:
-                    obj.setRights(self.copyright)
-                except AttributeError:
-                    pass
-            if self.contributors:
-                try:
-                    obj.setContributors(self.contributors)
-                except AttributeError:
-                    pass
-            if self.creators:
-                try:
-                    obj.setCreators(self.creators)
-                except AttributeError:
-                    pass
-            if self.exclude:
-                try:
-                    obj.setExcludeFromNav(self.exclude == 'yes')
-                except AttributeError:
-                    pass
-            if self.language:
-                try:
-                    obj.setLanguage(self.language)
-                except AttributeError:
-                    pass
+            self.at_action(obj)
 
         obj.reindexObject()


Repository: plone.app.content


Branch: refs/heads/master
Date: 2017-10-18T17:47:52+02:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/802847c7f8f1e58bb5df42cabf6d4d95f8fbc33e

Added changelog

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 36eaa79..5ec63ed 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -16,7 +16,9 @@ New features:
   This makes the menu bar more compact and avoids breaking into two lines.
   Also: Better icons for copy and paste.
   [thet]
-
+  
+- Move AT specific code in PropertiesActionView in its own method.
+  [Gagaro]
 
 Bug fixes:
 


Repository: plone.app.content


Branch: refs/heads/master
Date: 2017-10-18T18:38:43+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/1008599f05af2428c3f94dd35199ea35ea34dba1

Merge pull request #142 from plone/refactor-properties-at_action

move AT specific code in PropertiesActionView in its own method

Files changed:
M CHANGES.rst
M plone/app/content/browser/contents/properties.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 36eaa79..5ec63ed 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -16,7 +16,9 @@ New features:
   This makes the menu bar more compact and avoids breaking into two lines.
   Also: Better icons for copy and paste.
   [thet]
-
+  
+- Move AT specific code in PropertiesActionView in its own method.
+  [Gagaro]
 
 Bug fixes:
 
diff --git a/plone/app/content/browser/contents/properties.py b/plone/app/content/browser/contents/properties.py
index 0e3b950..8d52195 100644
--- a/plone/app/content/browser/contents/properties.py
+++ b/plone/app/content/browser/contents/properties.py
@@ -107,6 +107,43 @@ def dx_action(self, obj):
         if self.language and behavior_categorization:
             behavior_categorization.language = self.language
 
+    def at_action(self, obj):
+        if self.effectiveDate:
+            try:
+                obj.setEffectiveDate(DateTime(self.effectiveDate))
+            except AttributeError:
+                pass
+        if self.expirationDate:
+            try:
+                obj.setExpirationDate(DateTime(self.expirationDate))
+            except AttributeError:
+                pass
+        if self.copyright:
+            try:
+                obj.setRights(self.copyright)
+            except AttributeError:
+                pass
+        if self.contributors:
+            try:
+                obj.setContributors(self.contributors)
+            except AttributeError:
+                pass
+        if self.creators:
+            try:
+                obj.setCreators(self.creators)
+            except AttributeError:
+                pass
+        if self.exclude:
+            try:
+                obj.setExcludeFromNav(self.exclude == 'yes')
+            except AttributeError:
+                pass
+        if self.language:
+            try:
+                obj.setLanguage(self.language)
+            except AttributeError:
+                pass
+
     def action(self, obj, bypass_recurse=False):
 
         if self.putils.isDefaultPage(obj):
@@ -119,40 +156,6 @@ def action(self, obj, bypass_recurse=False):
         if IDexterityContent.providedBy(obj):
             self.dx_action(obj)
         else:
-            if self.effectiveDate:
-                try:
-                    obj.setEffectiveDate(DateTime(self.effectiveDate))
-                except AttributeError:
-                    pass
-            if self.expirationDate:
-                try:
-                    obj.setExpirationDate(DateTime(self.expirationDate))
-                except AttributeError:
-                    pass
-            if self.copyright:
-                try:
-                    obj.setRights(self.copyright)
-                except AttributeError:
-                    pass
-            if self.contributors:
-                try:
-                    obj.setContributors(self.contributors)
-                except AttributeError:
-                    pass
-            if self.creators:
-                try:
-                    obj.setCreators(self.creators)
-                except AttributeError:
-                    pass
-            if self.exclude:
-                try:
-                    obj.setExcludeFromNav(self.exclude == 'yes')
-                except AttributeError:
-                    pass
-            if self.language:
-                try:
-                    obj.setLanguage(self.language)
-                except AttributeError:
-                    pass
+            self.at_action(obj)
 
         obj.reindexObject()


