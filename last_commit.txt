Repository: plone.app.redirector


Branch: refs/heads/master
Date: 2023-04-01T19:42:37+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.redirector/commit/aae25160e48e0252b83d18b27401df2153b29444

Configuring with plone/meta

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/93e1ab65.internal
A tox.ini
M pyproject.toml
M setup.cfg

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 0000000..b4158b8\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 0000000..7316575\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "93e1ab65"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 0000000..449e951\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/news/93e1ab65.internal b/news/93e1ab65.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/93e1ab65.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615d..9eb73f3 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,43 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 2bb25cb..0da8f8f 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,10 +1,23 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n \n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n \n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 0000000..a227114\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,54 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --all --test-path={toxinidir} -s plone.app.redirector {posargs}\n+extras =\n+    test\n'

Repository: plone.app.redirector


Branch: refs/heads/master
Date: 2023-04-01T19:45:36+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.redirector/commit/d612f8105f69e3f9c7a3aaec8c5c0c553d507aa5

chore: black

Files changed:
M plone/app/redirector/testing.py

b'diff --git a/plone/app/redirector/testing.py b/plone/app/redirector/testing.py\nindex f4af544..1b051f1 100644\n--- a/plone/app/redirector/testing.py\n+++ b/plone/app/redirector/testing.py\n@@ -6,7 +6,6 @@\n \n \n class PloneAppRedirector(PloneSandboxLayer):\n-\n     defaultBases = (PLONE_APP_CONTENTTYPES_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\n'

Repository: plone.app.redirector


Branch: refs/heads/master
Date: 2023-04-01T19:45:51+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.redirector/commit/8628da47bb1ecd485b4e995c928315b69d9b3e36

chore: zpretty

Files changed:
M plone/app/redirector/configure.zcml

b'diff --git a/plone/app/redirector/configure.zcml b/plone/app/redirector/configure.zcml\nindex d348758..cf6c5a2 100644\n--- a/plone/app/redirector/configure.zcml\n+++ b/plone/app/redirector/configure.zcml\n@@ -1,30 +1,31 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <adapter factory=".policy.RedirectionPolicy" />\n+  <adapter factory=".policy.RedirectionPolicy" />\n \n-    <!-- Register a page the UI -->\n-    <browser:page\n-        name="plone_redirector_view"\n-        for="*"\n-        class=".browser.FourOhFourView"\n-        permission="zope2.View"\n-        allowed_interface=".interfaces.IFourOhFourView"\n-        />\n+  <!-- Register a page the UI -->\n+  <browser:page\n+      name="plone_redirector_view"\n+      for="*"\n+      class=".browser.FourOhFourView"\n+      allowed_interface=".interfaces.IFourOhFourView"\n+      permission="zope2.View"\n+      />\n \n-    <!-- Remember the movements of CMF objects -->\n-    <subscriber\n-        for="Products.CMFCore.interfaces.IContentish\n-             zope.lifecycleevent.interfaces.IObjectMovedEvent"\n-        handler=".subscribers.objectMoved"\n-        />\n+  <!-- Remember the movements of CMF objects -->\n+  <subscriber\n+      for="Products.CMFCore.interfaces.IContentish\n+           zope.lifecycleevent.interfaces.IObjectMovedEvent"\n+      handler=".subscribers.objectMoved"\n+      />\n \n-    <subscriber\n-        for="Products.CMFCore.interfaces.IContentish\n-             zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n-        handler=".subscribers.objectRemoved"\n-        />\n+  <subscriber\n+      for="Products.CMFCore.interfaces.IContentish\n+           zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n+      handler=".subscribers.objectRemoved"\n+      />\n \n \n </configure>\n'

Repository: plone.app.redirector


Branch: refs/heads/master
Date: 2023-04-01T19:46:43+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.redirector/commit/a25c6eb8b6c2dfe2c4e7d4e4fa58066db6a16fc2

feat: flake8

Files changed:
M plone/app/redirector/tests/test_view.py

b'diff --git a/plone/app/redirector/tests/test_view.py b/plone/app/redirector/tests/test_view.py\nindex 2d89b65..54e67eb 100644\n--- a/plone/app/redirector/tests/test_view.py\n+++ b/plone/app/redirector/tests/test_view.py\n@@ -185,8 +185,8 @@ def test_search_parens(self):\n     def test_search_query_parser_error(self):\n         view = self.view(self.portal, self.portal.absolute_url() + "/&")\n         try:\n-            urls = view.search_for_similar()\n-        except:\n+            _ = view.search_for_similar()\n+        except Exception:\n             self.fail("Query parsing error was not handled.")\n \n     def test_search_blacklisted(self):\n'

Repository: plone.app.redirector


Branch: refs/heads/master
Date: 2023-04-01T19:47:15+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.redirector/commit/b37a6ccef5b7e4e1629283b16c55bef25075eed2

feat: codespell

Files changed:
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 8e4b704..066e047 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -269,7 +269,7 @@ Fixes:\n   [wichert]\n \n - Update browser view to handle environments where the storage utility is not\n-  availbale.\n+  available.\n   [wichert]\n \n \n'

Repository: plone.app.redirector


Branch: refs/heads/master
Date: 2023-04-01T19:50:23+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.redirector/commit/9ab9d19f66d76e606ddefb8884b9743fedb71955

feat: configure z3c.dependencychecker

Files changed:
M pyproject.toml

b"diff --git a/pyproject.toml b/pyproject.toml\nindex 9eb73f3..8baa0dd 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,3 +60,4 @@ Zope = [\n   'Products.CMFDynamicViewFTI', 'zope.deprecation',\n ]\n python-dateutil = ['dateutil']\n+'Products.ZCatalog' = ['Products.ZCTextIndex']\n"

Repository: plone.app.redirector


Branch: refs/heads/master
Date: 2023-04-01T19:52:02+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.redirector/commit/e1f1552da153584c10471aa080e5dcc70e37ff6e

feat: drop CMFPlone dependency

Files changed:
M plone/app/redirector/tests/test_view.py

b'diff --git a/plone/app/redirector/tests/test_view.py b/plone/app/redirector/tests/test_view.py\nindex 54e67eb..ec9adb3 100644\n--- a/plone/app/redirector/tests/test_view.py\n+++ b/plone/app/redirector/tests/test_view.py\n@@ -2,8 +2,8 @@\n from plone.app.redirector.testing import PLONE_APP_REDIRECTOR_INTEGRATION_TESTING\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n+from plone.base.interfaces import ISearchSchema\n from plone.registry.interfaces import IRegistry\n-from Products.CMFPlone.interfaces import ISearchSchema\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n'

Repository: plone.app.redirector


Branch: refs/heads/master
Date: 2023-04-01T19:53:39+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.redirector/commit/4364d160d6665addb570ebca9b9a362143992d26

feat: declare dependencies

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex 369bd1e..3f78326 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -38,6 +38,18 @@\n         "setuptools",\n         "plone.memoize",\n         "Zope>=5",\n+        "BTrees",\n+        "Products.CMFCore",\n+        "Products.ZCatalog",\n+        "persistent",\n     ],\n-    extras_require={"test": ["plone.app.testing", "plone.app.contenttypes"]},\n+    extras_require={\n+        "test": [\n+            "plone.app.testing",\n+            "plone.app.contenttypes[test]",\n+            "plone.base",\n+            "plone.registry",\n+            "plone.testing",\n+        ]\n+    },\n )\n'

Repository: plone.app.redirector


Branch: refs/heads/master
Date: 2023-04-10T03:02:48+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.redirector/commit/362341598a3ae15e47404325d061b4a0914ccfb5

Merge pull request #27 from plone/config-with-default-template-15bbcc40

Config with default template

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/93e1ab65.internal
A tox.ini
M CHANGES.rst
M plone/app/redirector/configure.zcml
M plone/app/redirector/testing.py
M plone/app/redirector/tests/test_view.py
M pyproject.toml
M setup.cfg
M setup.py

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 0000000..b4158b8\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 0000000..7316575\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "93e1ab65"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 0000000..449e951\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/CHANGES.rst b/CHANGES.rst\nindex 8e4b704..066e047 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -269,7 +269,7 @@ Fixes:\n   [wichert]\n \n - Update browser view to handle environments where the storage utility is not\n-  availbale.\n+  available.\n   [wichert]\n \n \ndiff --git a/news/93e1ab65.internal b/news/93e1ab65.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/93e1ab65.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/plone/app/redirector/configure.zcml b/plone/app/redirector/configure.zcml\nindex d348758..cf6c5a2 100644\n--- a/plone/app/redirector/configure.zcml\n+++ b/plone/app/redirector/configure.zcml\n@@ -1,30 +1,31 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <adapter factory=".policy.RedirectionPolicy" />\n+  <adapter factory=".policy.RedirectionPolicy" />\n \n-    <!-- Register a page the UI -->\n-    <browser:page\n-        name="plone_redirector_view"\n-        for="*"\n-        class=".browser.FourOhFourView"\n-        permission="zope2.View"\n-        allowed_interface=".interfaces.IFourOhFourView"\n-        />\n+  <!-- Register a page the UI -->\n+  <browser:page\n+      name="plone_redirector_view"\n+      for="*"\n+      class=".browser.FourOhFourView"\n+      allowed_interface=".interfaces.IFourOhFourView"\n+      permission="zope2.View"\n+      />\n \n-    <!-- Remember the movements of CMF objects -->\n-    <subscriber\n-        for="Products.CMFCore.interfaces.IContentish\n-             zope.lifecycleevent.interfaces.IObjectMovedEvent"\n-        handler=".subscribers.objectMoved"\n-        />\n+  <!-- Remember the movements of CMF objects -->\n+  <subscriber\n+      for="Products.CMFCore.interfaces.IContentish\n+           zope.lifecycleevent.interfaces.IObjectMovedEvent"\n+      handler=".subscribers.objectMoved"\n+      />\n \n-    <subscriber\n-        for="Products.CMFCore.interfaces.IContentish\n-             zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n-        handler=".subscribers.objectRemoved"\n-        />\n+  <subscriber\n+      for="Products.CMFCore.interfaces.IContentish\n+           zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n+      handler=".subscribers.objectRemoved"\n+      />\n \n \n </configure>\ndiff --git a/plone/app/redirector/testing.py b/plone/app/redirector/testing.py\nindex f4af544..1b051f1 100644\n--- a/plone/app/redirector/testing.py\n+++ b/plone/app/redirector/testing.py\n@@ -6,7 +6,6 @@\n \n \n class PloneAppRedirector(PloneSandboxLayer):\n-\n     defaultBases = (PLONE_APP_CONTENTTYPES_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\ndiff --git a/plone/app/redirector/tests/test_view.py b/plone/app/redirector/tests/test_view.py\nindex 2d89b65..ec9adb3 100644\n--- a/plone/app/redirector/tests/test_view.py\n+++ b/plone/app/redirector/tests/test_view.py\n@@ -2,8 +2,8 @@\n from plone.app.redirector.testing import PLONE_APP_REDIRECTOR_INTEGRATION_TESTING\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n+from plone.base.interfaces import ISearchSchema\n from plone.registry.interfaces import IRegistry\n-from Products.CMFPlone.interfaces import ISearchSchema\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n@@ -185,8 +185,8 @@ def test_search_parens(self):\n     def test_search_query_parser_error(self):\n         view = self.view(self.portal, self.portal.absolute_url() + "/&")\n         try:\n-            urls = view.search_for_similar()\n-        except:\n+            _ = view.search_for_similar()\n+        except Exception:\n             self.fail("Query parsing error was not handled.")\n \n     def test_search_blacklisted(self):\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615d..8baa0dd 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,44 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\n+\'Products.ZCatalog\' = [\'Products.ZCTextIndex\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 2bb25cb..0da8f8f 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,10 +1,23 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n \n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n \n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/setup.py b/setup.py\nindex 369bd1e..3f78326 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -38,6 +38,18 @@\n         "setuptools",\n         "plone.memoize",\n         "Zope>=5",\n+        "BTrees",\n+        "Products.CMFCore",\n+        "Products.ZCatalog",\n+        "persistent",\n     ],\n-    extras_require={"test": ["plone.app.testing", "plone.app.contenttypes"]},\n+    extras_require={\n+        "test": [\n+            "plone.app.testing",\n+            "plone.app.contenttypes[test]",\n+            "plone.base",\n+            "plone.registry",\n+            "plone.testing",\n+        ]\n+    },\n )\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 0000000..a227114\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,54 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --all --test-path={toxinidir} -s plone.app.redirector {posargs}\n+extras =\n+    test\n'

