Repository: plone.namedfile


Branch: refs/heads/master
Date: 2019-08-30T10:23:26+02:00
Author: mauro (mamico) <mauro.amico@unibo.it>
Commit: https://github.com/plone/plone.namedfile/commit/b5769721989ec53a55fb3374593393d0e76616ad

fix ResourceWarnings for unclosed files

Files changed:
M plone/namedfile/file.py

b'diff --git a/plone/namedfile/file.py b/plone/namedfile/file.py\nindex d726fd3..b9f51c2 100644\n--- a/plone/namedfile/file.py\n+++ b/plone/namedfile/file.py\n@@ -362,10 +362,9 @@ def _getData(self):\n     def size(self):\n         if \'size\' in self.__dict__:\n             return self.__dict__[\'size\']\n-        reader = self._blob.open()\n-        reader.seek(0, 2)\n-        size = int(reader.tell())\n-        reader.close()\n+        with self._blob.open() as reader:\n+            reader.seek(0, 2)\n+            size = int(reader.tell())\n         self.__dict__[\'size\'] = size\n         return size\n \n@@ -426,10 +425,9 @@ def getFirstBytes(self, start=0, length=IMAGE_INFO_BYTES):\n \n         Returns an amount which is sufficient to determine the image type.\n         """\n-        fp = self.open(\'r\')\n-        fp.seek(start)\n-        firstbytes = fp.read(length)\n-        fp.close()\n+        with self.open(\'r\') as fp:\n+            fp.seek(start)\n+            firstbytes = fp.read(length)\n         return firstbytes\n \n     def getImageSize(self):\n'

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2019-08-30T10:27:46+02:00
Author: mauro (mamico) <mauro.amico@unibo.it>
Commit: https://github.com/plone/plone.namedfile/commit/120b7d37518007c4ee43085260abbf27cf516093

changelog

Files changed:
A news/80.bugfix

b'diff --git a/news/80.bugfix b/news/80.bugfix\nnew file mode 100644\nindex 0000000..239a081\n--- /dev/null\n+++ b/news/80.bugfix\n@@ -0,0 +1,2 @@\n+fix ResourceWarnings for unclosed files\n+[mamico]\n'

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2019-09-03T10:03:36+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.namedfile/commit/13dccf57eee9ba02aab0f28981bef818f7f4d730

Merge pull request #80 from mamico/master

fix ResourceWarnings for unclosed files

Files changed:
A news/80.bugfix
M plone/namedfile/file.py

b'diff --git a/news/80.bugfix b/news/80.bugfix\nnew file mode 100644\nindex 0000000..239a081\n--- /dev/null\n+++ b/news/80.bugfix\n@@ -0,0 +1,2 @@\n+fix ResourceWarnings for unclosed files\n+[mamico]\ndiff --git a/plone/namedfile/file.py b/plone/namedfile/file.py\nindex d726fd3..b9f51c2 100644\n--- a/plone/namedfile/file.py\n+++ b/plone/namedfile/file.py\n@@ -362,10 +362,9 @@ def _getData(self):\n     def size(self):\n         if \'size\' in self.__dict__:\n             return self.__dict__[\'size\']\n-        reader = self._blob.open()\n-        reader.seek(0, 2)\n-        size = int(reader.tell())\n-        reader.close()\n+        with self._blob.open() as reader:\n+            reader.seek(0, 2)\n+            size = int(reader.tell())\n         self.__dict__[\'size\'] = size\n         return size\n \n@@ -426,10 +425,9 @@ def getFirstBytes(self, start=0, length=IMAGE_INFO_BYTES):\n \n         Returns an amount which is sufficient to determine the image type.\n         """\n-        fp = self.open(\'r\')\n-        fp.seek(start)\n-        firstbytes = fp.read(length)\n-        fp.close()\n+        with self.open(\'r\') as fp:\n+            fp.seek(start)\n+            firstbytes = fp.read(length)\n         return firstbytes\n \n     def getImageSize(self):\n'

