Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2018-04-27T09:51:14+02:00
Author: tschorr (tschorr) <t_schorr@gmx.de>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/bc275f89789df372365981de759afe0da5ceefb6

fix https://github.com/plone/Products.CMFPlone/issues/2385

Files changed:
M src/plone/recipe/zope2instance/__init__.py

diff --git a/src/plone/recipe/zope2instance/__init__.py b/src/plone/recipe/zope2instance/__init__.py
index 0590586..5dd6ad9 100644
--- a/src/plone/recipe/zope2instance/__init__.py
+++ b/src/plone/recipe/zope2instance/__init__.py
@@ -612,7 +612,6 @@ def install_scripts(self):
         reqs = [self.options.get('control-script', self.name)]
         if self.wsgi:
             reqs.extend(['plone.recipe.zope2instance.wsgi', 'waitress_main'])
-            options['initialization'] = wsgi_initialization
         else:
             reqs.extend(['plone.recipe.zope2instance.ctl', 'main'])
         reqs = [tuple(reqs)]
@@ -674,13 +673,17 @@ def _install_scripts(self, dest, working_set, reqs=(), interpreter=None,
                 script_arguments=script_arguments,
                 )
         else:
+            if self.wsgi:
+                initialization = wsgi_initialization % options
+            else:
+                initialization = options['initialization'] % options
             return zc.buildout.easy_install.scripts(
                 dest=dest,
                 reqs=reqs,
                 working_set=working_set,
                 executable=options['executable'],
                 extra_paths=extra_paths,
-                initialization=options['initialization'] % options,
+                initialization=initialization,
                 arguments=script_arguments,
                 interpreter=interpreter,
                 relative_paths=self._relative_paths,)


Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2018-04-27T10:33:46+02:00
Author: tschorr (tschorr) <t_schorr@gmx.de>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/f6d1d1f4bc1cdc75362dab160627ee4804868b5a

update changelog

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 9410d50..a6960df 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,7 @@ New features:
 Bug fixes:
 
 - Super user password created on Python 3 can now be read by Zope.
+- Fix WSGI initialization [tschorr]
 
 
 5.0.0 (2018-01-27)


Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2018-04-29T13:50:26+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/d61f86af2d1b99fb39def138a5a36ec553992f91

Merge pull request #42 from plone/fix_wsgi_initialization

Fix WSGI initialization

Files changed:
M CHANGES.rst
M src/plone/recipe/zope2instance/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 9410d50..a6960df 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,7 @@ New features:
 Bug fixes:
 
 - Super user password created on Python 3 can now be read by Zope.
+- Fix WSGI initialization [tschorr]
 
 
 5.0.0 (2018-01-27)
diff --git a/src/plone/recipe/zope2instance/__init__.py b/src/plone/recipe/zope2instance/__init__.py
index 0590586..5dd6ad9 100644
--- a/src/plone/recipe/zope2instance/__init__.py
+++ b/src/plone/recipe/zope2instance/__init__.py
@@ -612,7 +612,6 @@ def install_scripts(self):
         reqs = [self.options.get('control-script', self.name)]
         if self.wsgi:
             reqs.extend(['plone.recipe.zope2instance.wsgi', 'waitress_main'])
-            options['initialization'] = wsgi_initialization
         else:
             reqs.extend(['plone.recipe.zope2instance.ctl', 'main'])
         reqs = [tuple(reqs)]
@@ -674,13 +673,17 @@ def _install_scripts(self, dest, working_set, reqs=(), interpreter=None,
                 script_arguments=script_arguments,
                 )
         else:
+            if self.wsgi:
+                initialization = wsgi_initialization % options
+            else:
+                initialization = options['initialization'] % options
             return zc.buildout.easy_install.scripts(
                 dest=dest,
                 reqs=reqs,
                 working_set=working_set,
                 executable=options['executable'],
                 extra_paths=extra_paths,
-                initialization=options['initialization'] % options,
+                initialization=initialization,
                 arguments=script_arguments,
                 interpreter=interpreter,
                 relative_paths=self._relative_paths,)


