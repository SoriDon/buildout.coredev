Repository: Products.MimetypesRegistry


Branch: refs/heads/master
Date: 2016-10-02T18:00:13+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.MimetypesRegistry/commit/a60827fe800af10e33585cdd96f4d68fbb31154b

utf8 headers

Files changed:
M Products/MimetypesRegistry/MimeTypeItem.py
M Products/MimetypesRegistry/MimeTypesRegistry.py
M Products/MimetypesRegistry/__init__.py
M Products/MimetypesRegistry/common.py
M Products/MimetypesRegistry/encoding.py
M Products/MimetypesRegistry/interfaces.py
M Products/MimetypesRegistry/mime_types/__init__.py
M Products/MimetypesRegistry/mime_types/magic.py
M Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
M Products/MimetypesRegistry/mime_types/py_mimetypes.py
M Products/MimetypesRegistry/mime_types/smi_mimetypes.py
M Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
M Products/MimetypesRegistry/mime_types/windows_mimetypes.py
M Products/MimetypesRegistry/setuphandlers.py
M Products/MimetypesRegistry/tests/test_encoding.py
M Products/MimetypesRegistry/tests/test_magic.py
M Products/MimetypesRegistry/tests/test_mimetypes.py
M Products/MimetypesRegistry/tests/utils.py
M Products/__init__.py
M bootstrap.py
M setup.py

diff --git a/Products/MimetypesRegistry/MimeTypeItem.py b/Products/MimetypesRegistry/MimeTypeItem.py
index 2ee08f1..c9179c4 100644
--- a/Products/MimetypesRegistry/MimeTypeItem.py
+++ b/Products/MimetypesRegistry/MimeTypeItem.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from AccessControl import ClassSecurityInfo
 from Acquisition import Explicit
 from App.class_init import InitializeClass
diff --git a/Products/MimetypesRegistry/MimeTypesRegistry.py b/Products/MimetypesRegistry/MimeTypesRegistry.py
index e84c579..6e2d1cb 100644
--- a/Products/MimetypesRegistry/MimeTypesRegistry.py
+++ b/Products/MimetypesRegistry/MimeTypesRegistry.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from AccessControl import ClassSecurityInfo
 from Acquisition import aq_base
 from App.class_init import InitializeClass
diff --git a/Products/MimetypesRegistry/__init__.py b/Products/MimetypesRegistry/__init__.py
index 1de1b6b..35e0a31 100644
--- a/Products/MimetypesRegistry/__init__.py
+++ b/Products/MimetypesRegistry/__init__.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from AccessControl.SecurityInfo import allow_module, allow_class
 from Products.MimetypesRegistry import MimeTypesRegistry
 from Products.MimetypesRegistry.common import MimeTypeException
diff --git a/Products/MimetypesRegistry/common.py b/Products/MimetypesRegistry/common.py
index 6bf6406..bcd0adc 100644
--- a/Products/MimetypesRegistry/common.py
+++ b/Products/MimetypesRegistry/common.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from AccessControl import ModuleSecurityInfo
 from types import StringType
 from types import UnicodeType
diff --git a/Products/MimetypesRegistry/encoding.py b/Products/MimetypesRegistry/encoding.py
index 3c2f6d1..8ad7f78 100644
--- a/Products/MimetypesRegistry/encoding.py
+++ b/Products/MimetypesRegistry/encoding.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 import re
 import encodings
 
diff --git a/Products/MimetypesRegistry/interfaces.py b/Products/MimetypesRegistry/interfaces.py
index 96f57ce..057c294 100644
--- a/Products/MimetypesRegistry/interfaces.py
+++ b/Products/MimetypesRegistry/interfaces.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from zope.interface import Interface
 
 
diff --git a/Products/MimetypesRegistry/mime_types/__init__.py b/Products/MimetypesRegistry/mime_types/__init__.py
index b834633..8e30f3a 100644
--- a/Products/MimetypesRegistry/mime_types/__init__.py
+++ b/Products/MimetypesRegistry/mime_types/__init__.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 import mtr_mimetypes
 import py_mimetypes
 import smi_mimetypes
diff --git a/Products/MimetypesRegistry/mime_types/magic.py b/Products/MimetypesRegistry/mime_types/magic.py
index d45bc89..5ff16c0 100644
--- a/Products/MimetypesRegistry/mime_types/magic.py
+++ b/Products/MimetypesRegistry/mime_types/magic.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 """
 magic.py
 
diff --git a/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py b/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
index d98f774..d726388 100644
--- a/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from Products.MimetypesRegistry.interfaces import IClassifier
 from types import InstanceType
diff --git a/Products/MimetypesRegistry/mime_types/py_mimetypes.py b/Products/MimetypesRegistry/mime_types/py_mimetypes.py
index 767a25d..98c91c5 100644
--- a/Products/MimetypesRegistry/mime_types/py_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/py_mimetypes.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path
 from Products.MimetypesRegistry.common import MimeTypeException
diff --git a/Products/MimetypesRegistry/mime_types/smi_mimetypes.py b/Products/MimetypesRegistry/mime_types/smi_mimetypes.py
index 924c88e..29b3c2d 100644
--- a/Products/MimetypesRegistry/mime_types/smi_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/smi_mimetypes.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from cPickle import dump, load
 from stat import ST_MTIME
 from xml.sax import parse
diff --git a/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py b/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
index e0605f9..8e22eb4 100644
--- a/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from Products.MimetypesRegistry.common import MimeTypeException
 
diff --git a/Products/MimetypesRegistry/mime_types/windows_mimetypes.py b/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
index d173779..062296a 100644
--- a/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 # Utilities for mime-types and the Windows registry.
 import _winreg
 import win32api
diff --git a/Products/MimetypesRegistry/setuphandlers.py b/Products/MimetypesRegistry/setuphandlers.py
index 084ea97..f986e7f 100644
--- a/Products/MimetypesRegistry/setuphandlers.py
+++ b/Products/MimetypesRegistry/setuphandlers.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from Products.CMFCore.utils import getToolByName
 from StringIO import StringIO
 import logging
diff --git a/Products/MimetypesRegistry/tests/test_encoding.py b/Products/MimetypesRegistry/tests/test_encoding.py
index 3e6cb30..e68d797 100644
--- a/Products/MimetypesRegistry/tests/test_encoding.py
+++ b/Products/MimetypesRegistry/tests/test_encoding.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from Products.MimetypesRegistry.encoding import guess_encoding
 from plone.app.testing.bbb import PloneTestCase as ATSiteTestCase
 
diff --git a/Products/MimetypesRegistry/tests/test_magic.py b/Products/MimetypesRegistry/tests/test_magic.py
index 9b5c094..2c01b67 100644
--- a/Products/MimetypesRegistry/tests/test_magic.py
+++ b/Products/MimetypesRegistry/tests/test_magic.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from .utils import input_file_path
 from Products.CMFCore.utils import getToolByName
 from Products.MimetypesRegistry.mime_types.magic import guessMime
diff --git a/Products/MimetypesRegistry/tests/test_mimetypes.py b/Products/MimetypesRegistry/tests/test_mimetypes.py
index 9e2268e..ecb196b 100644
--- a/Products/MimetypesRegistry/tests/test_mimetypes.py
+++ b/Products/MimetypesRegistry/tests/test_mimetypes.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from .utils import input_file_path
 from Products.CMFCore.utils import getToolByName
 from Products.MimetypesRegistry.mime_types import application_octet_stream
diff --git a/Products/MimetypesRegistry/tests/utils.py b/Products/MimetypesRegistry/tests/utils.py
index c6d73c4..c76d75c 100644
--- a/Products/MimetypesRegistry/tests/utils.py
+++ b/Products/MimetypesRegistry/tests/utils.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from os.path import abspath
 from os.path import basename
 from os.path import dirname
diff --git a/Products/__init__.py b/Products/__init__.py
index f48ad10..85880ef 100644
--- a/Products/__init__.py
+++ b/Products/__init__.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 # See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
 try:
     __import__('pkg_resources').declare_namespace(__name__)
diff --git a/bootstrap.py b/bootstrap.py
index a629566..1a5e5d5 100644
--- a/bootstrap.py
+++ b/bootstrap.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 ##############################################################################
 #
 # Copyright (c) 2006 Zope Foundation and Contributors.
diff --git a/setup.py b/setup.py
index fe04beb..5571bd5 100644
--- a/setup.py
+++ b/setup.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from setuptools import find_packages
 from setuptools import setup
 


Repository: Products.MimetypesRegistry


Branch: refs/heads/master
Date: 2016-10-02T18:00:13+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.MimetypesRegistry/commit/cf5d5e5901d4e8da6e65aef6831bcda91fe519a5

isort

Files changed:
A setup.cfg
M Products/MimetypesRegistry/MimeTypeItem.py
M Products/MimetypesRegistry/MimeTypesRegistry.py
M Products/MimetypesRegistry/__init__.py
M Products/MimetypesRegistry/common.py
M Products/MimetypesRegistry/encoding.py
M Products/MimetypesRegistry/mime_types/__init__.py
M Products/MimetypesRegistry/mime_types/magic.py
M Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
M Products/MimetypesRegistry/mime_types/py_mimetypes.py
M Products/MimetypesRegistry/mime_types/smi_mimetypes.py
M Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
M Products/MimetypesRegistry/mime_types/windows_mimetypes.py
M Products/MimetypesRegistry/setuphandlers.py
M Products/MimetypesRegistry/tests/test_encoding.py
M Products/MimetypesRegistry/tests/test_magic.py
M Products/MimetypesRegistry/tests/test_mimetypes.py
M Products/MimetypesRegistry/tests/utils.py

diff --git a/Products/MimetypesRegistry/MimeTypeItem.py b/Products/MimetypesRegistry/MimeTypeItem.py
index c9179c4..be7e79c 100644
--- a/Products/MimetypesRegistry/MimeTypeItem.py
+++ b/Products/MimetypesRegistry/MimeTypeItem.py
@@ -7,6 +7,7 @@
 from Products.CMFCore.permissions import ManagePortal
 from Products.MimetypesRegistry.interfaces import IMimetype
 from zope.interface import implementer
+
 import os
 import urllib
 
diff --git a/Products/MimetypesRegistry/MimeTypesRegistry.py b/Products/MimetypesRegistry/MimeTypesRegistry.py
index 6e2d1cb..7bfefa7 100644
--- a/Products/MimetypesRegistry/MimeTypesRegistry.py
+++ b/Products/MimetypesRegistry/MimeTypesRegistry.py
@@ -7,12 +7,11 @@
 from Persistence import PersistentMapping
 from Products.CMFCore.ActionProviderBase import ActionProviderBase
 from Products.CMFCore.permissions import ManagePortal
-from Products.CMFCore.utils import UniqueObject
 from Products.CMFCore.utils import registerToolInterface
-from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
-from Products.MimetypesRegistry.common import MimeTypeException
+from Products.CMFCore.utils import UniqueObject
 from Products.MimetypesRegistry.common import _www
 from Products.MimetypesRegistry.common import log
+from Products.MimetypesRegistry.common import MimeTypeException
 from Products.MimetypesRegistry.encoding import guess_encoding
 from Products.MimetypesRegistry.interfaces import IClassifier
 from Products.MimetypesRegistry.interfaces import IMimetype
@@ -21,10 +20,12 @@
 from Products.MimetypesRegistry.interfaces import ISourceAdapter
 from Products.MimetypesRegistry.mime_types import initialize
 from Products.MimetypesRegistry.mime_types import magic
+from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from Products.PageTemplates.PageTemplateFile import PageTemplateFile
 from types import UnicodeType
 from zope.contenttype import guess_content_type
 from zope.interface import implementer
+
 import fnmatch
 import os
 import re
diff --git a/Products/MimetypesRegistry/__init__.py b/Products/MimetypesRegistry/__init__.py
index 35e0a31..41bb842 100644
--- a/Products/MimetypesRegistry/__init__.py
+++ b/Products/MimetypesRegistry/__init__.py
@@ -1,5 +1,6 @@
 # -*- coding: utf-8 -*-
-from AccessControl.SecurityInfo import allow_module, allow_class
+from AccessControl.SecurityInfo import allow_class
+from AccessControl.SecurityInfo import allow_module
 from Products.MimetypesRegistry import MimeTypesRegistry
 from Products.MimetypesRegistry.common import MimeTypeException
 
diff --git a/Products/MimetypesRegistry/common.py b/Products/MimetypesRegistry/common.py
index bcd0adc..7cbf59a 100644
--- a/Products/MimetypesRegistry/common.py
+++ b/Products/MimetypesRegistry/common.py
@@ -2,6 +2,7 @@
 from AccessControl import ModuleSecurityInfo
 from types import StringType
 from types import UnicodeType
+
 import logging
 import os.path
 
diff --git a/Products/MimetypesRegistry/encoding.py b/Products/MimetypesRegistry/encoding.py
index 8ad7f78..db2b765 100644
--- a/Products/MimetypesRegistry/encoding.py
+++ b/Products/MimetypesRegistry/encoding.py
@@ -1,6 +1,6 @@
 # -*- coding: utf-8 -*-
-import re
 import encodings
+import re
 
 
 EMACS_ENCODING_RGX = re.compile('[^#]*[#\s]*-\*-\s*coding: ([^\s]*)\s*-\*-\s*')
diff --git a/Products/MimetypesRegistry/mime_types/__init__.py b/Products/MimetypesRegistry/mime_types/__init__.py
index 8e30f3a..48b5751 100644
--- a/Products/MimetypesRegistry/mime_types/__init__.py
+++ b/Products/MimetypesRegistry/mime_types/__init__.py
@@ -1,11 +1,11 @@
 # -*- coding: utf-8 -*-
+from mtr_mimetypes import *
+
 import mtr_mimetypes
 import py_mimetypes
 import smi_mimetypes
 import suppl_mimetypes
 
-from mtr_mimetypes import *
-
 
 def initialize(registry):
     smi_mimetypes.initialize(registry)
diff --git a/Products/MimetypesRegistry/mime_types/magic.py b/Products/MimetypesRegistry/mime_types/magic.py
index 5ff16c0..2f0178e 100644
--- a/Products/MimetypesRegistry/mime_types/magic.py
+++ b/Products/MimetypesRegistry/mime_types/magic.py
@@ -11,8 +11,8 @@
 """
 __version__ = '$Revision: 1.2 $'[11:-2]
 
-import struct
 import string
+import struct
 
 
 magic = [
diff --git a/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py b/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
index d726388..bc51f79 100644
--- a/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
@@ -1,8 +1,9 @@
 # -*- coding: utf-8 -*-
-from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from Products.MimetypesRegistry.interfaces import IClassifier
+from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from types import InstanceType
 from zope.interface import implementer
+
 import re
 
 
diff --git a/Products/MimetypesRegistry/mime_types/py_mimetypes.py b/Products/MimetypesRegistry/mime_types/py_mimetypes.py
index 98c91c5..f11c9ef 100644
--- a/Products/MimetypesRegistry/mime_types/py_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/py_mimetypes.py
@@ -1,8 +1,9 @@
 # -*- coding: utf-8 -*-
-from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
-from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path
 from Products.MimetypesRegistry.common import MimeTypeException
+from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path
+from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from zope.contenttype import add_files
+
 import mimetypes as pymimetypes
 import os.path
 
diff --git a/Products/MimetypesRegistry/mime_types/smi_mimetypes.py b/Products/MimetypesRegistry/mime_types/smi_mimetypes.py
index 29b3c2d..5510494 100644
--- a/Products/MimetypesRegistry/mime_types/smi_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/smi_mimetypes.py
@@ -1,8 +1,10 @@
 # -*- coding: utf-8 -*-
-from cPickle import dump, load
+from cPickle import dump
+from cPickle import load
 from stat import ST_MTIME
 from xml.sax import parse
 from xml.sax.handler import ContentHandler
+
 import os
 
 
diff --git a/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py b/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
index 8e22eb4..4b2797c 100644
--- a/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
@@ -1,6 +1,6 @@
 # -*- coding: utf-8 -*-
-from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from Products.MimetypesRegistry.common import MimeTypeException
+from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 
 
 map = {
diff --git a/Products/MimetypesRegistry/mime_types/windows_mimetypes.py b/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
index 062296a..e42f61e 100644
--- a/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
@@ -1,11 +1,12 @@
 # -*- coding: utf-8 -*-
 # Utilities for mime-types and the Windows registry.
 import _winreg
+import logging
+import mimetypes
 import win32api
 import win32con
-import mimetypes
 
-import logging
+
 logger = logging.getLogger('mimetypes.win32')
 
 # "safely" query a value, returning a default when it doesn't exist.
diff --git a/Products/MimetypesRegistry/setuphandlers.py b/Products/MimetypesRegistry/setuphandlers.py
index f986e7f..fa48786 100644
--- a/Products/MimetypesRegistry/setuphandlers.py
+++ b/Products/MimetypesRegistry/setuphandlers.py
@@ -1,8 +1,10 @@
 # -*- coding: utf-8 -*-
 from Products.CMFCore.utils import getToolByName
 from StringIO import StringIO
+
 import logging
 
+
 logger = logging.getLogger('MimetypesRegistry')
 
 
diff --git a/Products/MimetypesRegistry/tests/test_encoding.py b/Products/MimetypesRegistry/tests/test_encoding.py
index e68d797..9d05c60 100644
--- a/Products/MimetypesRegistry/tests/test_encoding.py
+++ b/Products/MimetypesRegistry/tests/test_encoding.py
@@ -1,6 +1,6 @@
 # -*- coding: utf-8 -*-
-from Products.MimetypesRegistry.encoding import guess_encoding
 from plone.app.testing.bbb import PloneTestCase as ATSiteTestCase
+from Products.MimetypesRegistry.encoding import guess_encoding
 
 
 class TestGuessEncoding(ATSiteTestCase):
diff --git a/Products/MimetypesRegistry/tests/test_magic.py b/Products/MimetypesRegistry/tests/test_magic.py
index 2c01b67..cc50517 100644
--- a/Products/MimetypesRegistry/tests/test_magic.py
+++ b/Products/MimetypesRegistry/tests/test_magic.py
@@ -1,8 +1,9 @@
 # -*- coding: utf-8 -*-
 from .utils import input_file_path
+from plone.app.testing.bbb import PloneTestCase as ATSiteTestCase
 from Products.CMFCore.utils import getToolByName
 from Products.MimetypesRegistry.mime_types.magic import guessMime
-from plone.app.testing.bbb import PloneTestCase as ATSiteTestCase
+
 
 samplefiles = [
     ('OOoWriter', 'application/vnd.sun.xml.writer'),
diff --git a/Products/MimetypesRegistry/tests/test_mimetypes.py b/Products/MimetypesRegistry/tests/test_mimetypes.py
index ecb196b..f5172bd 100644
--- a/Products/MimetypesRegistry/tests/test_mimetypes.py
+++ b/Products/MimetypesRegistry/tests/test_mimetypes.py
@@ -1,10 +1,10 @@
 # -*- coding: utf-8 -*-
 from .utils import input_file_path
+from plone.app.testing.bbb import PloneTestCase as ATSiteTestCase
 from Products.CMFCore.utils import getToolByName
 from Products.MimetypesRegistry.mime_types import application_octet_stream
 from Products.MimetypesRegistry.mime_types import text_plain
 from Products.MimetypesRegistry.mime_types import text_xml
-from plone.app.testing.bbb import PloneTestCase as ATSiteTestCase
 
 
 class TestMimeTypesclass(ATSiteTestCase):
diff --git a/Products/MimetypesRegistry/tests/utils.py b/Products/MimetypesRegistry/tests/utils.py
index c76d75c..205923f 100644
--- a/Products/MimetypesRegistry/tests/utils.py
+++ b/Products/MimetypesRegistry/tests/utils.py
@@ -3,6 +3,7 @@
 from os.path import basename
 from os.path import dirname
 from os.path import join
+
 import glob
 import re
 
diff --git a/setup.cfg b/setup.cfg
new file mode 100644
index 0000000..35fdb6d
--- /dev/null
+++ b/setup.cfg
@@ -0,0 +1,11 @@
+[check-manifest]
+ignore =
+    *.cfg
+    bootstrap.py
+
+[isort]
+force_alphabetical_sort=True
+force_single_line=True
+lines_after_imports=2
+line_length=200
+not_skip=__init__.py


Repository: Products.MimetypesRegistry


Branch: refs/heads/master
Date: 2016-10-02T18:00:13+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.MimetypesRegistry/commit/4c7eccd9909631ad68d8ce165eef8833d2035974

autopep8 -ir + manual cleanup

Files changed:
M Products/MimetypesRegistry/mime_types/py_mimetypes.py
M Products/MimetypesRegistry/mime_types/windows_mimetypes.py

diff --git a/Products/MimetypesRegistry/mime_types/py_mimetypes.py b/Products/MimetypesRegistry/mime_types/py_mimetypes.py
index f11c9ef..b1f69db 100644
--- a/Products/MimetypesRegistry/mime_types/py_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/py_mimetypes.py
@@ -20,6 +20,7 @@ def mimes_initialize():
     here = os.path.dirname(os.path.abspath(__file__))
     add_files([os.path.join(here, 'mime.types')])
 
+
 # don't register the mimetype from python mimetypes if matching on of
 # this extensions.
 skip_extensions = ()
diff --git a/Products/MimetypesRegistry/mime_types/windows_mimetypes.py b/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
index e42f61e..2a1b4c6 100644
--- a/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
@@ -10,6 +10,8 @@
 logger = logging.getLogger('mimetypes.win32')
 
 # "safely" query a value, returning a default when it doesn't exist.
+
+
 def _RegQueryValue(key, value, default=None):
     try:
         data, typ = win32api.RegQueryValueEx(key, value)
@@ -22,6 +24,7 @@ def _RegQueryValue(key, value, default=None):
         data = data.rstrip('\0')
     return data
 
+
 def get_desc_for_mimetype(mime_type):
     try:
         hk = win32api.RegOpenKey(win32con.HKEY_CLASSES_ROOT,
@@ -29,11 +32,12 @@ def get_desc_for_mimetype(mime_type):
         desc = _RegQueryValue(hk, "")
     except win32api.error, details:
         logger.info("win32api error fetching description for mime-type %r: %s",
-                     mime_type, details)
+                    mime_type, details)
         desc = None
     logger.debug("mime-type %s has description %s", mime_type, desc)
     return desc
 
+
 def get_ext_for_mimetype(mime_type):
     try:
         hk = win32api.RegOpenKey(win32con.HKEY_CLASSES_ROOT,
@@ -41,11 +45,12 @@ def get_ext_for_mimetype(mime_type):
         ext = _RegQueryValue(hk, "Extension")
     except win32api.error, details:
         logger.info("win32api error fetching extension for mime-type %r: %s",
-                     mime_type, details)
+                    mime_type, details)
         ext = None
     logger.debug("mime-type %s has extension %s", mime_type, ext)
     return ext
 
+
 def get_mime_types():
     try:
         hk = win32api.RegOpenKey(win32con.HKEY_CLASSES_ROOT,
@@ -57,10 +62,12 @@ def get_mime_types():
         items = []
     return [i[0] for i in items if i[0]]
 
+
 def normalize(mt):
     # Some mimetypes might have extra ';q=value' params.
     return mt.lower().split(';')[0]
 
+
 def initialize():
     if not mimetypes.inited:
         mimetypes.init()
@@ -69,12 +76,14 @@ def initialize():
         ext = get_ext_for_mimetype(mt)
         if not ext:
             continue
-        if not mimetypes.types_map.has_key(ext):
+        if ext not in mimetypes.types_map:
             mimetypes.add_type(normalize(mt), ext)
 
-if __name__=='__main__':
+
+if __name__ == '__main__':
     for mt in get_mime_types():
         ext = get_ext_for_mimetype(mt)
         desc = get_desc_for_mimetype(mt)
         print "%s (%s) - %s" % (mt.lower(), desc, ext)
-    import code; code.interact(local=locals())
+    import code
+    code.interact(local=locals())


Repository: Products.MimetypesRegistry


Branch: refs/heads/master
Date: 2016-10-02T18:00:13+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.MimetypesRegistry/commit/140d64b69fbfc4951c1aa0d2e30fd84f1fe8f9d1

remove outdated and unused STRING_TYPES

Files changed:
M Products/MimetypesRegistry/common.py

diff --git a/Products/MimetypesRegistry/common.py b/Products/MimetypesRegistry/common.py
index 7cbf59a..d55dda5 100644
--- a/Products/MimetypesRegistry/common.py
+++ b/Products/MimetypesRegistry/common.py
@@ -1,13 +1,9 @@
 # -*- coding: utf-8 -*-
 from AccessControl import ModuleSecurityInfo
-from types import StringType
-from types import UnicodeType
 
 import logging
 import os.path
 
-
-STRING_TYPES = (UnicodeType, StringType)
 # directory where template for the ZMI are located
 _www = os.path.join(os.path.dirname(__file__), 'www')
 


Repository: Products.MimetypesRegistry


Branch: refs/heads/master
Date: 2016-10-02T18:00:13+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.MimetypesRegistry/commit/1f1d90b8a72a143103489c4f9a501fe750f5c5ef

security decorators

Files changed:
M CHANGES.rst
M Products/MimetypesRegistry/MimeTypeItem.py
M Products/MimetypesRegistry/MimeTypesRegistry.py
M Products/MimetypesRegistry/interfaces.py
M Products/MimetypesRegistry/setuphandlers.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 617606f..39bf08b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,7 +17,11 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Cleanup: isort, autopep8, utf8 headers, manula cleanup.
+  [jensens]
+
+- Remove outdated and unused (whole plone core) STRING_TYPES declaration form ``common.py``.
+  [jensens]
 
 
 2.0.10 (2016-08-09)
diff --git a/Products/MimetypesRegistry/MimeTypeItem.py b/Products/MimetypesRegistry/MimeTypeItem.py
index be7e79c..0eb05b2 100644
--- a/Products/MimetypesRegistry/MimeTypeItem.py
+++ b/Products/MimetypesRegistry/MimeTypeItem.py
@@ -47,26 +47,22 @@ def __cmp__(self, other):
     def __hash__(self):
         return hash(self.name())
 
-    security.declarePublic('name')
-
+    @security.public
     def name(self):
         """ The name of this object """
         return self.__name__
 
-    security.declarePublic('major')
-
+    @security.public
     def major(self):
         """ return the major part of the RFC-2046 name for this mime type """
         return self.normalized().split('/', 1)[0]
 
-    security.declarePublic('minor')
-
+    @security.public
     def minor(self):
         """ return the minor part of the RFC-2046 name for this mime type """
         return self.normalized().split('/', 1)[1]
 
-    security.declarePublic('normalized')
-
+    @security.public
     def normalized(self):
         """ return the main RFC-2046 name for this mime type
 
@@ -75,16 +71,14 @@ def normalized(self):
         """
         return self.mimetypes[0]
 
-    security.declarePublic('urlsafe')
-
+    @security.public
     def urlsafe(self):
         """Return a url safe version of the normalized version of this
         mime type.
         """
         return urllib.quote(self.normalized())
 
-    security.declareProtected(ManagePortal, 'edit')
-
+    @security.protected(ManagePortal)
     def edit(self, name, mimetypes, extensions, icon_path,
              binary=0, globs=None, REQUEST=None):
         """edit this mime type"""
@@ -108,6 +102,7 @@ def edit(self, name, mimetypes, extensions, icon_path,
         if REQUEST is not None:
             REQUEST['RESPONSE'].redirect(self.absolute_url() + '/manage_main')
 
+
 InitializeClass(MimeTypeItem)
 
 
diff --git a/Products/MimetypesRegistry/MimeTypesRegistry.py b/Products/MimetypesRegistry/MimeTypesRegistry.py
index 7bfefa7..6d1d730 100644
--- a/Products/MimetypesRegistry/MimeTypesRegistry.py
+++ b/Products/MimetypesRegistry/MimeTypesRegistry.py
@@ -99,8 +99,7 @@ def __init__(self, id=None):
         initialize(self)
         self._new_style_mtr = 1
 
-    security.declareProtected(ManagePortal, 'register')
-
+    @security.protected(ManagePortal)
     def register(self, mimetype):
         """ Register a new mimetype
 
@@ -115,8 +114,7 @@ def register(self, mimetype):
         for glob in mimetype.globs:
             self.register_glob(glob, mimetype)
 
-    security.declareProtected(ManagePortal, 'register_mimetype')
-
+    @security.protected(ManagePortal)
     def register_mimetype(self, mt, mimetype):
         major, minor = split(mt)
         if not major or not minor or minor == '*':
@@ -128,8 +126,7 @@ def register_mimetype(self, mt, mimetype):
                     mt, mimetype.__class__))
         group[minor] = mimetype
 
-    security.declareProtected(ManagePortal, 'register_extension')
-
+    @security.protected(ManagePortal)
     def register_extension(self, extension, mimetype):
         """ Associate a file's extension to a IMimetype
 
@@ -144,8 +141,7 @@ def register_extension(self, extension, mimetype):
         # we don't validate fmt yet, but its ["txt", "html"]
         self.extensions[extension] = mimetype
 
-    security.declareProtected(ManagePortal, 'register_glob')
-
+    @security.protected(ManagePortal)
     def register_glob(self, glob, mimetype):
         """ Associate a glob to a IMimetype
 
@@ -167,8 +163,7 @@ def register_glob(self, glob, mimetype):
         pattern = re.compile(fnmatch.translate(glob))
         globs[glob] = (pattern, mimetype)
 
-    security.declareProtected(ManagePortal, 'unregister')
-
+    @security.protected(ManagePortal)
     def unregister(self, mimetype):
         """ Unregister a new mimetype
 
@@ -193,8 +188,7 @@ def unregister(self, mimetype):
                 if mt == mimetype:
                     del globs[glob]
 
-    security.declarePublic('mimetypes')
-
+    @security.public
     def mimetypes(self):
         """Return all defined mime types, each one implements at least
         IMimetype
@@ -205,14 +199,12 @@ def mimetypes(self):
                 res[mt] = 1
         return [aq_base(mtitem) for mtitem in res.keys()]
 
-    security.declarePublic('list_mimetypes')
-
+    @security.public
     def list_mimetypes(self):
         """Return all defined mime types, as string"""
         return [str(mt) for mt in self.mimetypes()]
 
-    security.declarePublic('lookup')
-
+    @security.public
     def lookup(self, mimetypestring):
         """Lookup for IMimetypes object matching mimetypestring
 
@@ -238,8 +230,7 @@ def lookup(self, mimetypestring):
                 return ()
         return tuple([aq_base(mtitem) for mtitem in res])
 
-    security.declarePublic('lookupExtension')
-
+    @security.public
     def lookupExtension(self, filename):
         """Lookup for IMimetypes object matching filename
 
@@ -270,8 +261,7 @@ def lookupExtension(self, filename):
             result = aq_base(self.extensions.get(ext.lower()))
         return result
 
-    security.declarePublic('globFilename')
-
+    @security.public
     def globFilename(self, filename):
         """Lookup for IMimetypes object matching filename
 
@@ -288,8 +278,7 @@ def globFilename(self, filename):
                 return aq_base(mimetype)
         return None
 
-    security.declarePublic('lookupGlob')
-
+    @security.public
     def lookupGlob(self, glob):
         globs = getattr(self, 'globs', None)
         if globs is None:
@@ -299,8 +288,7 @@ def lookupGlob(self, glob):
     def _classifiers(self):
         return [mt for mt in self.mimetypes() if IClassifier.providedBy(mt)]
 
-    security.declarePublic('classify')
-
+    @security.public
     def classify(self, data, mimetype=None, filename=None):
         """Classify works as follows:
         1) you tell me the rfc-2046 name and I give you an IMimetype
@@ -404,8 +392,7 @@ def __call__(self, data, **kwargs):
 
         return (data, filename, aq_base(mt))
 
-    security.declarePublic('guess_encoding')
-
+    @security.public
     def guess_encoding(self, data):
         """ Try to guess encoding from a text value.
 
@@ -419,8 +406,7 @@ def guess_encoding(self, data):
             encoding = 'utf-8'
         return encoding
 
-    security.declareProtected(ManagePortal, 'manage_delObjects')
-
+    @security.protected(ManagePortal)
     def manage_delObjects(self, ids, REQUEST=None):
         """ delete the selected mime types """
         for id in ids:
@@ -428,8 +414,7 @@ def manage_delObjects(self, ids, REQUEST=None):
         if REQUEST is not None:
             REQUEST['RESPONSE'].redirect(self.absolute_url() + '/manage_main')
 
-    security.declareProtected(ManagePortal, 'manage_addMimeType')
-
+    @security.protected(ManagePortal)
     def manage_addMimeType(self, id, mimetypes, extensions, icon_path,
                            binary=0, globs=None, REQUEST=None):
         """add a mime type to the tool"""
@@ -439,8 +424,7 @@ def manage_addMimeType(self, id, mimetypes, extensions, icon_path,
         if REQUEST is not None:
             REQUEST['RESPONSE'].redirect(self.absolute_url() + '/manage_main')
 
-    security.declareProtected(ManagePortal, 'manage_editMimeType')
-
+    @security.protected(ManagePortal)
     def manage_editMimeType(self, name, new_name, mimetypes, extensions,
                             icon_path, binary=0, globs=None, REQUEST=None):
         """Edit a mime type by name
@@ -453,6 +437,7 @@ def manage_editMimeType(self, name, new_name, mimetypes, extensions,
         if REQUEST is not None:
             REQUEST['RESPONSE'].redirect(self.absolute_url() + '/manage_main')
 
+
 InitializeClass(MimeTypesRegistry)
 registerToolInterface('mimetypes_registry', IMimetypesRegistryTool)
 
diff --git a/Products/MimetypesRegistry/interfaces.py b/Products/MimetypesRegistry/interfaces.py
index 057c294..8a86c93 100644
--- a/Products/MimetypesRegistry/interfaces.py
+++ b/Products/MimetypesRegistry/interfaces.py
@@ -54,9 +54,9 @@ def classify(data, mimetype=None, filename=None):
     def lookup(mimetypestring):
         """Lookup for imimetypes object matching mimetypestring
 
-        mimetypestring may have an empty minor part or containing a wildcard (*)
-        mimetypestring may be an imimetype object (in this case it will be
-        returned unchanged, else it should be a RFC-2046 name
+        mimetypestring may have an empty minor part or containing a
+        wildcard (*) mimetypestring may be an imimetype object (in this case
+        it will be returned unchanged, else it should be a RFC-2046 name
 
         return a list of mimetypes objects associated with the RFC-2046 name
         return an empty list if no one is known.
diff --git a/Products/MimetypesRegistry/setuphandlers.py b/Products/MimetypesRegistry/setuphandlers.py
index fa48786..9e91b11 100644
--- a/Products/MimetypesRegistry/setuphandlers.py
+++ b/Products/MimetypesRegistry/setuphandlers.py
@@ -1,18 +1,18 @@
 # -*- coding: utf-8 -*-
-from Products.CMFCore.utils import getToolByName
 from StringIO import StringIO
+from zope.componet import getUtility
 
 import logging
 
 
-logger = logging.getLogger('MimetypesRegistry')
+logger = logging.getLogger(__name__)
 
 
 def fixUpSMIGlobs(portal, out=None, reinit=True):
     # This method is used both in migrations where we need the reinit and
     # during site creation, where the registry has already been initialized.
     from Products.MimetypesRegistry.mime_types import smi_mimetypes
-    mtr = getToolByName(portal, 'mimetypes_registry')
+    mtr = getUtility('mimetypes_registry')
     if reinit:
         smi_mimetypes.initialize(mtr)
 
diff --git a/setup.py b/setup.py
index 5571bd5..77f9067 100644
--- a/setup.py
+++ b/setup.py
@@ -39,6 +39,7 @@
         ]
     ),
     install_requires=[
+        'AccessControl>=3.0.0'
         'setuptools',
         'zope.contenttype',
         'zope.interface',


Repository: Products.MimetypesRegistry


Branch: refs/heads/master
Date: 2016-10-02T18:06:36+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.MimetypesRegistry/commit/a4833f61b46a4990837f8dfa432b06d4aa932df1

Overhaul README

Files changed:
M CHANGES.rst
M Products/MimetypesRegistry/MimeTypesRegistry.py
M README.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 39bf08b..751ab68 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,7 +17,7 @@ New features:
 
 Bug fixes:
 
-- Cleanup: isort, autopep8, utf8 headers, manula cleanup.
+- Cleanup: isort, autopep8, utf8 headers, manual cleanup, security decorators.
   [jensens]
 
 - Remove outdated and unused (whole plone core) STRING_TYPES declaration form ``common.py``.
diff --git a/Products/MimetypesRegistry/MimeTypesRegistry.py b/Products/MimetypesRegistry/MimeTypesRegistry.py
index 6d1d730..5e26188 100644
--- a/Products/MimetypesRegistry/MimeTypesRegistry.py
+++ b/Products/MimetypesRegistry/MimeTypesRegistry.py
@@ -10,7 +10,6 @@
 from Products.CMFCore.utils import registerToolInterface
 from Products.CMFCore.utils import UniqueObject
 from Products.MimetypesRegistry.common import _www
-from Products.MimetypesRegistry.common import log
 from Products.MimetypesRegistry.common import MimeTypeException
 from Products.MimetypesRegistry.encoding import guess_encoding
 from Products.MimetypesRegistry.interfaces import IClassifier
@@ -27,10 +26,14 @@
 from zope.interface import implementer
 
 import fnmatch
+import logging
 import os
 import re
 
 
+logger = logging.getLogger(__name__)
+
+
 suffix_map = {
     'tgz': '.tar.gz',
     'taz': '.tar.gz',
@@ -122,8 +125,12 @@ def register_mimetype(self, mt, mimetype):
         group = self._mimetypes.setdefault(major, PersistentMapping())
         if minor in group:
             if group.get(minor) != mimetype:
-                log('Warning: redefining mime type %s (%s)' % (
-                    mt, mimetype.__class__))
+                logger.warn(
+                    'Redefining mime type {0} ({1})'.format(
+                        mt,
+                        mimetype.__class__
+                    )
+                )
         group[minor] = mimetype
 
     @security.protected(ManagePortal)
@@ -136,8 +143,13 @@ def register_extension(self, extension, mimetype):
         mimetype = aq_base(mimetype)
         if extension in self.extensions:
             if self.extensions.get(extension) != mimetype:
-                log('Warning: redefining extension %s from %s to %s' % (
-                    extension, self.extensions[extension], mimetype))
+                logger.warn(
+                    'Redefining extension {0} from {1} to {2}'.format(
+                        extension,
+                        self.extensions[extension],
+                        mimetype
+                    )
+                )
         # we don't validate fmt yet, but its ["txt", "html"]
         self.extensions[extension] = mimetype
 
@@ -157,8 +169,13 @@ def register_glob(self, glob, mimetype):
         if existing is not None:
             regex, mt = existing
             if mt != mimetype:
-                log('Warning: redefining glob %s from %s to %s' % (
-                    glob, mt, mimetype))
+                logger.warn(
+                    'Redefining glob {0} from {1} to {2}'.format(
+                        glob,
+                        mt,
+                        mimetype
+                    )
+                )
         # we don't validate fmt yet, but its ["txt", "html"]
         pattern = re.compile(fnmatch.translate(glob))
         globs[glob] = (pattern, mimetype)
diff --git a/README.rst b/README.rst
index d76f57c..cbd7e8c 100644
--- a/README.rst
+++ b/README.rst
@@ -2,35 +2,29 @@
 Mimetypes Registry
 ==================
 
-Provide a registry of mimetypes, accessible via the ``mimetypes_registry``
-tool. 
+Provide a registry of mimetypes, accessible via the ``mimetypes_registry`` tool.
 
 
 Upgrade from older versions
 ===========================
 
-If you want to use the updated mimetypes registry database from the version
-after 2.0.6 and you don't have important customizations you need to keep, just
-delete the old ``mimetypes_registry`` tool from ZMI and import all steps from
-the ``MimetypesRegistry`` profile.
+If you want to use the updated mimetypes registry database from the version after 2.0.6 and you don't have important customizations you need to keep,
+just delete the old ``mimetypes_registry`` tool from ZMI and import all steps from the ``MimetypesRegistry`` profile.
 
 
 How to update the mimetypes registry from freedesktop.org
 =========================================================
 
-1) Clone the ``shared-mime-info`` repository from freedesktop.org::
+1) Download the latest release from freesdesktops org `shared mime info project page <https://freedesktop.org/wiki/Software/shared-mime-info/>`_.
 
-    $ git clone git://anongit.freedesktop.org/xdg/shared-mime-info
+2) Unpack the tarball
 
-2) Build it::
+3) Copy the ``freedesktop.org.xml`` file to Products.MimetypesRegistry's
+   ``mime_types`` folder.
 
-    $ cd shared-mime-info
-    $ ./autogen.sh
-    $ ./configure 
-    $ make
+4) Add a note to the change log ``CHANGES.rst``.
 
-3) Copy the ``freedesktop.org.xml`` file to Products.MimetypesRegistry's
-   ``mime_type`` folder.
+5) Push to a branch and create a pull request.
 
 
 Authors


Repository: Products.MimetypesRegistry


Branch: refs/heads/master
Date: 2016-10-02T18:40:16+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.MimetypesRegistry/commit/dd58c2eccebd3478705363e76db816403f32b876

Cleanup superfluos common.py

Files changed:
M Products/MimetypesRegistry/MimeTypesRegistry.py
M Products/MimetypesRegistry/common.py
M Products/MimetypesRegistry/interfaces.py
M setup.py

diff --git a/Products/MimetypesRegistry/MimeTypesRegistry.py b/Products/MimetypesRegistry/MimeTypesRegistry.py
index 5e26188..cdae7b1 100644
--- a/Products/MimetypesRegistry/MimeTypesRegistry.py
+++ b/Products/MimetypesRegistry/MimeTypesRegistry.py
@@ -9,7 +9,6 @@
 from Products.CMFCore.permissions import ManagePortal
 from Products.CMFCore.utils import registerToolInterface
 from Products.CMFCore.utils import UniqueObject
-from Products.MimetypesRegistry.common import _www
 from Products.MimetypesRegistry.common import MimeTypeException
 from Products.MimetypesRegistry.encoding import guess_encoding
 from Products.MimetypesRegistry.interfaces import IClassifier
@@ -21,7 +20,6 @@
 from Products.MimetypesRegistry.mime_types import magic
 from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from Products.PageTemplates.PageTemplateFile import PageTemplateFile
-from types import UnicodeType
 from zope.contenttype import guess_content_type
 from zope.interface import implementer
 
@@ -45,6 +43,8 @@
     'Z': 'compress',
 }
 
+_www = os.path.join(os.path.dirname(__file__), 'www')
+
 
 @implementer(IMimetypesRegistry, ISourceAdapter)
 class MimeTypesRegistry(UniqueObject, ActionProviderBase, Folder):
@@ -257,6 +257,7 @@ def lookupExtension(self, filename):
         Return an IMimetype object associated with the file's
         extension or None
         """
+        base = None
         if filename.find('.') != -1:
             base, ext = os.path.splitext(filename)
             ext = ext[1:]  # remove the dot
@@ -265,11 +266,8 @@ def lookupExtension(self, filename):
                 ext = ext[1:]  # remove the dot
         else:
             ext = filename
-            base = None
 
-        # XXX This code below make no sense and may break because base
-        # isn't defined.
-        if ext in self.encodings_map and base:
+        if base is not None and ext in self.encodings_map:
             base, ext = os.path.splitext(base)
             ext = ext[1:]  # remove the dot
 
@@ -286,10 +284,8 @@ def globFilename(self, filename):
 
         Return an IMimetype object associated with the glob's or None
         """
-        globs = getattr(self, 'globs', None)
-        if globs is None:
-            return None
-        for key in globs.keys():
+        globs = getattr(self, 'globs', {})
+        for key in globs:
             glob, mimetype = globs[key]
             if glob.match(filename):
                 return aq_base(mimetype)
@@ -298,9 +294,8 @@ def globFilename(self, filename):
     @security.public
     def lookupGlob(self, glob):
         globs = getattr(self, 'globs', None)
-        if globs is None:
-            return None
-        return aq_base(globs.get(glob))
+        if globs is not None:
+            return aq_base(globs.get(glob))
 
     def _classifiers(self):
         return [mt for mt in self.mimetypes() if IClassifier.providedBy(mt)]
@@ -385,7 +380,7 @@ def __call__(self, data, **kwargs):
         # it is
         mt = self.classify(data, mimetype=mimetype, filename=filename)
 
-        if not mt.binary and not isinstance(data, UnicodeType):
+        if not mt.binary and not isinstance(data, unicode):
             # if no encoding specified, try to guess it from data
             if encoding is None:
                 encoding = self.guess_encoding(data)
@@ -415,7 +410,7 @@ def guess_encoding(self, data):
 
         If no encoding can be guessed, fall back to utf-8.
         """
-        if isinstance(data, type(u'')):
+        if isinstance(data, unicode):
             # data maybe unicode but with another encoding specified
             data = data.encode('UTF-8')
         encoding = guess_encoding(data)
diff --git a/Products/MimetypesRegistry/common.py b/Products/MimetypesRegistry/common.py
index d55dda5..3185183 100644
--- a/Products/MimetypesRegistry/common.py
+++ b/Products/MimetypesRegistry/common.py
@@ -1,23 +1,9 @@
 # -*- coding: utf-8 -*-
-from AccessControl import ModuleSecurityInfo
-
-import logging
-import os.path
-
-# directory where template for the ZMI are located
-_www = os.path.join(os.path.dirname(__file__), 'www')
-
-security = ModuleSecurityInfo()
-security.declarePrivate('logging')
-security.declarePrivate('os')
-security.declarePrivate('time')
-
-logger = logging.getLogger('MimetypesRegistry')
-
-
-def log(msg, severity=logging.INFO, id='MimetypesRegistry'):
-    logger.log(severity, msg)
-
-
-class MimeTypeException(Exception):
-    pass
+import zope.deferredimport
+zope.deferredimport.initialize()
+
+zope.deferredimport.deprecated(
+    "Import from Products.MimetypesRegistry.interfaces instead",
+    MimeTypeException='Products.MimetypesRegistry:'
+                      'interfaces.MimeTypeException',
+)
diff --git a/Products/MimetypesRegistry/interfaces.py b/Products/MimetypesRegistry/interfaces.py
index 8a86c93..a0ab663 100644
--- a/Products/MimetypesRegistry/interfaces.py
+++ b/Products/MimetypesRegistry/interfaces.py
@@ -2,6 +2,10 @@
 from zope.interface import Interface
 
 
+class MimeTypeException(Exception):
+    pass
+
+
 class IMimetype(Interface):
     """Specification for dealing with mimetypes RFC-2046 style"""
 
diff --git a/setup.py b/setup.py
index 77f9067..3023ae1 100644
--- a/setup.py
+++ b/setup.py
@@ -14,9 +14,6 @@
         "Framework :: Zope2",
         "Operating System :: OS Independent",
         "Framework :: Plone",
-        "Framework :: Plone :: 4.0",
-        "Framework :: Plone :: 4.1",
-        "Framework :: Plone :: 4.2",
         "Framework :: Plone :: 4.3",
         "Framework :: Plone :: 5.0",
         "Framework :: Plone :: 5.1",
@@ -33,19 +30,20 @@
     namespace_packages=['Products'],
     include_package_data=True,
     zip_safe=False,
-    extras_require=dict(
-        test=[
-            'plone.app.testing',
-        ]
-    ),
     install_requires=[
         'AccessControl>=3.0.0'
+        'Acquisition',
+        'Products.CMFCore',
         'setuptools',
+        'ZODB3',
         'zope.contenttype',
+        'zope.deferredimport',
         'zope.interface',
-        'Products.CMFCore',
-        'Acquisition',
-        'ZODB3',
         'Zope2',
     ],
+    extras_require=dict(
+        test=[
+            'plone.app.testing',
+        ]
+    ),
 )


Repository: Products.MimetypesRegistry


Branch: refs/heads/master
Date: 2016-10-02T19:23:44+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.MimetypesRegistry/commit/d9b0dd5e5d93f9685135652fd140f0bc738e9419

add woff2 to suppl types

Files changed:
M CHANGES.rst
M Products/MimetypesRegistry/common.py
M Products/MimetypesRegistry/configure.zcml
M Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
M Products/MimetypesRegistry/profiles/default/componentregistry.xml
M Products/MimetypesRegistry/profiles/default/metadata.xml
M Products/MimetypesRegistry/profiles/default/toolset.xml
M Products/MimetypesRegistry/setuphandlers.py
D Products/MimetypesRegistry/profiles/default/mimetypes-registry-various.txt

diff --git a/CHANGES.rst b/CHANGES.rst
index 751ab68..d486950 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,9 @@ New features:
   Downloaded tarball at https://freedesktop.org/wiki/Software/shared-mime-info/
   [jensens]
 
+- Add font/woff2 to supplemtn type, since its not in SMI.
+  [jensens]
+
 Bug fixes:
 
 - Cleanup: isort, autopep8, utf8 headers, manual cleanup, security decorators.
diff --git a/Products/MimetypesRegistry/common.py b/Products/MimetypesRegistry/common.py
index 3185183..f6dd640 100644
--- a/Products/MimetypesRegistry/common.py
+++ b/Products/MimetypesRegistry/common.py
@@ -4,6 +4,6 @@
 
 zope.deferredimport.deprecated(
     "Import from Products.MimetypesRegistry.interfaces instead",
-    MimeTypeException='Products.MimetypesRegistry:'
-                      'interfaces.MimeTypeException',
+    MimeTypeException='Products.MimetypesRegistry.interfaces:'
+                      'MimeTypeException',
 )
diff --git a/Products/MimetypesRegistry/configure.zcml b/Products/MimetypesRegistry/configure.zcml
index eb8290d..0d35b25 100644
--- a/Products/MimetypesRegistry/configure.zcml
+++ b/Products/MimetypesRegistry/configure.zcml
@@ -16,14 +16,8 @@
       directory="profiles/default"
       description="Extension profile for default MimetypesRegistry setup."
       provides="Products.GenericSetup.interfaces.EXTENSION"
+      post_handler=".setuphandlers.post_install"
     />
 
-  <genericsetup:importStep
-      name="mimetypes-registry-various"
-      handler="Products.MimetypesRegistry.setuphandlers.setupMimetypesRegistry"
-      title="MimetypesRegistry setup"
-      description="MimetypesRegistry installation step.">
-    <depends name="componentregistry" />
-  </genericsetup:importStep>
 
 </configure>
diff --git a/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py b/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
index 4b2797c..59d8b7c 100644
--- a/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
@@ -5,8 +5,8 @@
 
 map = {
     # '.extension' : 'mimetype',
-    '.svg': 'image/svg+xml',  # scaleable vector graphics
-    '.pjpg': 'image/pjpeg',  # scaleable vector graphics
+    '.pjpg': 'image/pjpeg',  # progressive jpeg - is this is still a thing?
+    '.woff2': 'font/woff2'
 }
 
 
diff --git a/Products/MimetypesRegistry/profiles/default/componentregistry.xml b/Products/MimetypesRegistry/profiles/default/componentregistry.xml
index e8a2b2c..b92d45c 100644
--- a/Products/MimetypesRegistry/profiles/default/componentregistry.xml
+++ b/Products/MimetypesRegistry/profiles/default/componentregistry.xml
@@ -1,7 +1,10 @@
 <?xml version="1.0"?>
 <componentregistry>
-  <adapters />
+  <adapters/>
   <utilities>
-    <utility interface="Products.MimetypesRegistry.interfaces.IMimetypesRegistryTool" object="mimetypes_registry" />
+    <utility
+        interface="Products.MimetypesRegistry.interfaces.IMimetypesRegistryTool"
+        object="mimetypes_registry"
+    />
   </utilities>
 </componentregistry>
diff --git a/Products/MimetypesRegistry/profiles/default/metadata.xml b/Products/MimetypesRegistry/profiles/default/metadata.xml
index 2692b09..d02ea5c 100644
--- a/Products/MimetypesRegistry/profiles/default/metadata.xml
+++ b/Products/MimetypesRegistry/profiles/default/metadata.xml
@@ -1,4 +1,4 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>1.6</version>
+  <version>2</version>
 </metadata>
diff --git a/Products/MimetypesRegistry/profiles/default/mimetypes-registry-various.txt b/Products/MimetypesRegistry/profiles/default/mimetypes-registry-various.txt
deleted file mode 100644
index e69de29..0000000
diff --git a/Products/MimetypesRegistry/profiles/default/toolset.xml b/Products/MimetypesRegistry/profiles/default/toolset.xml
index 0a40f89..09ee68a 100644
--- a/Products/MimetypesRegistry/profiles/default/toolset.xml
+++ b/Products/MimetypesRegistry/profiles/default/toolset.xml
@@ -1,7 +1,7 @@
 <?xml version="1.0"?>
 <tool-setup>
   <required
-      tool_id="mimetypes_registry"
       class="Products.MimetypesRegistry.MimeTypesRegistry.MimeTypesRegistry"
-      />
+      tool_id="mimetypes_registry"
+  />
 </tool-setup>
diff --git a/Products/MimetypesRegistry/setuphandlers.py b/Products/MimetypesRegistry/setuphandlers.py
index 9e91b11..207ef44 100644
--- a/Products/MimetypesRegistry/setuphandlers.py
+++ b/Products/MimetypesRegistry/setuphandlers.py
@@ -1,6 +1,6 @@
 # -*- coding: utf-8 -*-
-from StringIO import StringIO
-from zope.componet import getUtility
+from Products.CMFCore.utils import getToolByName
+from Products.MimetypesRegistry.mime_types import smi_mimetypes
 
 import logging
 
@@ -8,39 +8,31 @@
 logger = logging.getLogger(__name__)
 
 
-def fixUpSMIGlobs(portal, out=None, reinit=True):
+def fixUpSMIGlobs(context, reinit=True):
     # This method is used both in migrations where we need the reinit and
     # during site creation, where the registry has already been initialized.
-    from Products.MimetypesRegistry.mime_types import smi_mimetypes
-    mtr = getUtility('mimetypes_registry')
+    mtr = getToolByName(context, 'mimetypes_registry')
     if reinit:
         smi_mimetypes.initialize(mtr)
 
     # Now comes the fun part. For every glob, lookup a extension
     # matching the glob and unregister it.
     for glob in mtr.globs.keys():
-        if glob in mtr.extensions:
-            logger.debug(
-                'Found glob %s in extensions registry, removing.' % glob)
-            mti = mtr.extensions[glob]
-            del mtr.extensions[glob]
-            if glob in mti.extensions:
-                logger.debug('Found glob %s in mimetype %s extensions, '
-                             'removing.' % (glob, mti))
-                exts = list(mti.extensions)
-                exts.remove(glob)
-                mti.extensions = tuple(exts)
-                mtr.register(mti)
-
-
-def installMimetypesRegistry(portal):
-    out = StringIO()
-    fixUpSMIGlobs(portal, out, reinit=False)
-
-
-def setupMimetypesRegistry(context):
-    # Only run step if a flag file is present (e.g. not an extension profile)
-    if context.readDataFile('mimetypes-registry-various.txt') is None:
-        return
-    site = context.getSite()
-    installMimetypesRegistry(site)
+        if glob not in mtr.extensions:
+            continue
+        logger.debug(
+            'Found glob %s in extensions registry, removing.' % glob
+        )
+        mti = mtr.extensions[glob]
+        del mtr.extensions[glob]
+        if glob in mti.extensions:
+            logger.debug('Found glob %s in mimetype %s extensions, '
+                         'removing.' % (glob, mti))
+            exts = list(mti.extensions)
+            exts.remove(glob)
+            mti.extensions = tuple(exts)
+            mtr.register(mti)
+
+
+def post_install(context):
+    fixUpSMIGlobs(context, reinit=False)


Repository: Products.MimetypesRegistry


Branch: refs/heads/master
Date: 2016-10-18T10:53:43-04:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.MimetypesRegistry/commit/61acf8327e5c844bff9e5c5676170aaf0ee2c323

Move icons from skins folder to a browser resourceDirectory nameed "mimetype.icons".

Adopt guess_icon_path to return the new location.

Files changed:
A Products/MimetypesRegistry/icons/application.png
A Products/MimetypesRegistry/icons/audio.png
A Products/MimetypesRegistry/icons/avi.png
A Products/MimetypesRegistry/icons/c.png
A Products/MimetypesRegistry/icons/core.png
A Products/MimetypesRegistry/icons/cpp.png
A Products/MimetypesRegistry/icons/deb.png
A Products/MimetypesRegistry/icons/doc.png
A Products/MimetypesRegistry/icons/docx.png
A Products/MimetypesRegistry/icons/down.png
A Products/MimetypesRegistry/icons/dvi.png
A Products/MimetypesRegistry/icons/exe.png
A Products/MimetypesRegistry/icons/f.png
A Products/MimetypesRegistry/icons/font.png
A Products/MimetypesRegistry/icons/gf.png
A Products/MimetypesRegistry/icons/h.png
A Products/MimetypesRegistry/icons/html.png
A Products/MimetypesRegistry/icons/image.png
A Products/MimetypesRegistry/icons/info.png
A Products/MimetypesRegistry/icons/iso.png
A Products/MimetypesRegistry/icons/java.png
A Products/MimetypesRegistry/icons/log.png
A Products/MimetypesRegistry/icons/man.png
A Products/MimetypesRegistry/icons/message.png
A Products/MimetypesRegistry/icons/midi.png
A Products/MimetypesRegistry/icons/mime.png
A Products/MimetypesRegistry/icons/o.png
A Products/MimetypesRegistry/icons/pdf.png
A Products/MimetypesRegistry/icons/pk.png
A Products/MimetypesRegistry/icons/pl.png
A Products/MimetypesRegistry/icons/png.png
A Products/MimetypesRegistry/icons/ppt.png
A Products/MimetypesRegistry/icons/pptx.png
A Products/MimetypesRegistry/icons/ps.png
A Products/MimetypesRegistry/icons/py.png
A Products/MimetypesRegistry/icons/quicktime.png
A Products/MimetypesRegistry/icons/rar.png
A Products/MimetypesRegistry/icons/rpm.png
A Products/MimetypesRegistry/icons/sh.png
A Products/MimetypesRegistry/icons/sxc.png
A Products/MimetypesRegistry/icons/sxd.png
A Products/MimetypesRegistry/icons/sxg.png
A Products/MimetypesRegistry/icons/sxi.png
A Products/MimetypesRegistry/icons/sxm.png
A Products/MimetypesRegistry/icons/sxw.png
A Products/MimetypesRegistry/icons/tar.png
A Products/MimetypesRegistry/icons/tex.png
A Products/MimetypesRegistry/icons/text.png
A Products/MimetypesRegistry/icons/tgz.png
A Products/MimetypesRegistry/icons/txt.png
A Products/MimetypesRegistry/icons/unknown.png
A Products/MimetypesRegistry/icons/up.png
A Products/MimetypesRegistry/icons/vcal.png
A Products/MimetypesRegistry/icons/vcard.png
A Products/MimetypesRegistry/icons/video.png
A Products/MimetypesRegistry/icons/wav.png
A Products/MimetypesRegistry/icons/xls.png
A Products/MimetypesRegistry/icons/xlsx.png
A Products/MimetypesRegistry/icons/zip.png
M CHANGES.rst
M Products/MimetypesRegistry/MimeTypeItem.py
M Products/MimetypesRegistry/__init__.py
M Products/MimetypesRegistry/common.py
M Products/MimetypesRegistry/configure.zcml
D Products/MimetypesRegistry/profiles/default/skins.xml
D Products/MimetypesRegistry/skins/mimetypes_icons/application.png
D Products/MimetypesRegistry/skins/mimetypes_icons/audio.png
D Products/MimetypesRegistry/skins/mimetypes_icons/avi.png
D Products/MimetypesRegistry/skins/mimetypes_icons/c.png
D Products/MimetypesRegistry/skins/mimetypes_icons/core.png
D Products/MimetypesRegistry/skins/mimetypes_icons/cpp.png
D Products/MimetypesRegistry/skins/mimetypes_icons/deb.png
D Products/MimetypesRegistry/skins/mimetypes_icons/doc.png
D Products/MimetypesRegistry/skins/mimetypes_icons/docx.png
D Products/MimetypesRegistry/skins/mimetypes_icons/down.png
D Products/MimetypesRegistry/skins/mimetypes_icons/dvi.png
D Products/MimetypesRegistry/skins/mimetypes_icons/exe.png
D Products/MimetypesRegistry/skins/mimetypes_icons/f.png
D Products/MimetypesRegistry/skins/mimetypes_icons/font.png
D Products/MimetypesRegistry/skins/mimetypes_icons/gf.png
D Products/MimetypesRegistry/skins/mimetypes_icons/h.png
D Products/MimetypesRegistry/skins/mimetypes_icons/html.png
D Products/MimetypesRegistry/skins/mimetypes_icons/image.png
D Products/MimetypesRegistry/skins/mimetypes_icons/info.png
D Products/MimetypesRegistry/skins/mimetypes_icons/iso.png
D Products/MimetypesRegistry/skins/mimetypes_icons/java.png
D Products/MimetypesRegistry/skins/mimetypes_icons/log.png
D Products/MimetypesRegistry/skins/mimetypes_icons/man.png
D Products/MimetypesRegistry/skins/mimetypes_icons/message.png
D Products/MimetypesRegistry/skins/mimetypes_icons/midi.png
D Products/MimetypesRegistry/skins/mimetypes_icons/mime.png
D Products/MimetypesRegistry/skins/mimetypes_icons/o.png
D Products/MimetypesRegistry/skins/mimetypes_icons/pdf.png
D Products/MimetypesRegistry/skins/mimetypes_icons/pk.png
D Products/MimetypesRegistry/skins/mimetypes_icons/pl.png
D Products/MimetypesRegistry/skins/mimetypes_icons/png.png
D Products/MimetypesRegistry/skins/mimetypes_icons/ppt.png
D Products/MimetypesRegistry/skins/mimetypes_icons/pptx.png
D Products/MimetypesRegistry/skins/mimetypes_icons/ps.png
D Products/MimetypesRegistry/skins/mimetypes_icons/py.png
D Products/MimetypesRegistry/skins/mimetypes_icons/quicktime.png
D Products/MimetypesRegistry/skins/mimetypes_icons/rar.png
D Products/MimetypesRegistry/skins/mimetypes_icons/rpm.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sh.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxc.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxd.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxg.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxi.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxm.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxw.png
D Products/MimetypesRegistry/skins/mimetypes_icons/tar.png
D Products/MimetypesRegistry/skins/mimetypes_icons/tex.png
D Products/MimetypesRegistry/skins/mimetypes_icons/text.png
D Products/MimetypesRegistry/skins/mimetypes_icons/tgz.png
D Products/MimetypesRegistry/skins/mimetypes_icons/txt.png
D Products/MimetypesRegistry/skins/mimetypes_icons/unknown.png
D Products/MimetypesRegistry/skins/mimetypes_icons/up.png
D Products/MimetypesRegistry/skins/mimetypes_icons/vcal.png
D Products/MimetypesRegistry/skins/mimetypes_icons/vcard.png
D Products/MimetypesRegistry/skins/mimetypes_icons/video.png
D Products/MimetypesRegistry/skins/mimetypes_icons/wav.png
D Products/MimetypesRegistry/skins/mimetypes_icons/xls.png
D Products/MimetypesRegistry/skins/mimetypes_icons/xlsx.png
D Products/MimetypesRegistry/skins/mimetypes_icons/zip.png

diff --git a/CHANGES.rst b/CHANGES.rst
index d486950..f21d6ec 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,7 +15,11 @@ New features:
   Downloaded tarball at https://freedesktop.org/wiki/Software/shared-mime-info/
   [jensens]
 
-- Add font/woff2 to supplemtn type, since its not in SMI.
+- Add font/woff2 to supplement type, since its not in SMI.
+  [jensens]
+
+- Move icons from skins folder to a browser resourceDirectory nameed "mimetype.icons".
+  Adopt guess_icon_path to return the new location.
   [jensens]
 
 Bug fixes:
@@ -23,7 +27,7 @@ Bug fixes:
 - Cleanup: isort, autopep8, utf8 headers, manual cleanup, security decorators.
   [jensens]
 
-- Remove outdated and unused (whole plone core) STRING_TYPES declaration form ``common.py``.
+- Remove outdated and unused (whole plone core) STRING_TYPES declaration from ``common.py``.
   [jensens]
 
 
diff --git a/Products/MimetypesRegistry/MimeTypeItem.py b/Products/MimetypesRegistry/MimeTypeItem.py
index 0eb05b2..dde7027 100644
--- a/Products/MimetypesRegistry/MimeTypeItem.py
+++ b/Products/MimetypesRegistry/MimeTypeItem.py
@@ -106,7 +106,8 @@ def edit(self, name, mimetypes, extensions, icon_path,
 InitializeClass(MimeTypeItem)
 
 
-ICONS_DIR = os.path.join(os.path.dirname(__file__), 'skins', 'mimetypes_icons')
+ICONS_DIR = os.path.join(os.path.dirname(__file__), 'icons')
+PREFIX = '++resource++mimetype.icons/'
 
 
 def guess_icon_path(mimetype, icons_dir=ICONS_DIR, icon_ext='png'):
@@ -114,8 +115,8 @@ def guess_icon_path(mimetype, icons_dir=ICONS_DIR, icon_ext='png'):
         for ext in mimetype.extensions:
             icon_path = '%s.%s' % (ext, icon_ext)
             if os.path.exists(os.path.join(icons_dir, icon_path)):
-                return icon_path
+                return PREFIX + icon_path
     icon_path = '%s.png' % mimetype.major()
     if os.path.exists(os.path.join(icons_dir, icon_path)):
-        return icon_path
-    return 'unknown.png'
+        return PREFIX + icon_path
+    return PREFIX + 'unknown.png'
diff --git a/Products/MimetypesRegistry/__init__.py b/Products/MimetypesRegistry/__init__.py
index 41bb842..60cb723 100644
--- a/Products/MimetypesRegistry/__init__.py
+++ b/Products/MimetypesRegistry/__init__.py
@@ -2,20 +2,19 @@
 from AccessControl.SecurityInfo import allow_class
 from AccessControl.SecurityInfo import allow_module
 from Products.MimetypesRegistry import MimeTypesRegistry
-from Products.MimetypesRegistry.common import MimeTypeException
+from Products.MimetypesRegistry.interfaces import MimeTypeException  # noqa
 
 
-GLOBALS = globals()
-PKG_NAME = 'MimetypesRegistry'
-tools = (MimeTypesRegistry.MimeTypesRegistry, )
+# remove when Archetypes are removed:
 allow_module('Products.MimetypesRegistry.common')
 allow_class(MimeTypeException)
+# end remove
 
 
 def initialize(context):
     from Products.CMFCore import utils
     utils.ToolInit(
-        "%s Tool" % PKG_NAME,
-        tools=tools,
-        icon="tool.gif",
+        'MimetypesRegistry Tool',
+        tools=(MimeTypesRegistry.MimeTypesRegistry, ),
+        icon='tool.gif',
     ).initialize(context)
diff --git a/Products/MimetypesRegistry/common.py b/Products/MimetypesRegistry/common.py
index f6dd640..0d6eb33 100644
--- a/Products/MimetypesRegistry/common.py
+++ b/Products/MimetypesRegistry/common.py
@@ -1,7 +1,8 @@
 # -*- coding: utf-8 -*-
+# this code is needed by Archetypes only
 import zope.deferredimport
-zope.deferredimport.initialize()
 
+zope.deferredimport.initialize()
 zope.deferredimport.deprecated(
     "Import from Products.MimetypesRegistry.interfaces instead",
     MimeTypeException='Products.MimetypesRegistry.interfaces:'
diff --git a/Products/MimetypesRegistry/configure.zcml b/Products/MimetypesRegistry/configure.zcml
index 0d35b25..f24cd35 100644
--- a/Products/MimetypesRegistry/configure.zcml
+++ b/Products/MimetypesRegistry/configure.zcml
@@ -1,13 +1,12 @@
 <configure
     xmlns="http://namespaces.zope.org/zope"
-    xmlns:cmf="http://namespaces.zope.org/cmf"
+    xmlns:browser="http://namespaces.zope.org/browser"
     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"
     i18n_domain="Products.MimetypesRegistry">
 
-  <cmf:registerDirectory
-      name="skins"
-      directory="skins"
-      recursive="True"
+ <browser:resourceDirectory
+      name="mimetype.icons"
+      directory="icons"
       />
 
   <genericsetup:registerProfile
@@ -19,5 +18,4 @@
       post_handler=".setuphandlers.post_install"
     />
 
-
 </configure>
diff --git a/Products/MimetypesRegistry/icons/application.png b/Products/MimetypesRegistry/icons/application.png
new file mode 100644
index 0000000..006a93a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/application.png differ
diff --git a/Products/MimetypesRegistry/icons/audio.png b/Products/MimetypesRegistry/icons/audio.png
new file mode 100644
index 0000000..6d893cb
Binary files /dev/null and b/Products/MimetypesRegistry/icons/audio.png differ
diff --git a/Products/MimetypesRegistry/icons/avi.png b/Products/MimetypesRegistry/icons/avi.png
new file mode 100644
index 0000000..05b0b59
Binary files /dev/null and b/Products/MimetypesRegistry/icons/avi.png differ
diff --git a/Products/MimetypesRegistry/icons/c.png b/Products/MimetypesRegistry/icons/c.png
new file mode 100644
index 0000000..21b483c
Binary files /dev/null and b/Products/MimetypesRegistry/icons/c.png differ
diff --git a/Products/MimetypesRegistry/icons/core.png b/Products/MimetypesRegistry/icons/core.png
new file mode 100644
index 0000000..11f4c0e
Binary files /dev/null and b/Products/MimetypesRegistry/icons/core.png differ
diff --git a/Products/MimetypesRegistry/icons/cpp.png b/Products/MimetypesRegistry/icons/cpp.png
new file mode 100644
index 0000000..34e1512
Binary files /dev/null and b/Products/MimetypesRegistry/icons/cpp.png differ
diff --git a/Products/MimetypesRegistry/icons/deb.png b/Products/MimetypesRegistry/icons/deb.png
new file mode 100644
index 0000000..8a5c86a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/deb.png differ
diff --git a/Products/MimetypesRegistry/icons/doc.png b/Products/MimetypesRegistry/icons/doc.png
new file mode 100644
index 0000000..93072bc
Binary files /dev/null and b/Products/MimetypesRegistry/icons/doc.png differ
diff --git a/Products/MimetypesRegistry/icons/docx.png b/Products/MimetypesRegistry/icons/docx.png
new file mode 100644
index 0000000..93072bc
Binary files /dev/null and b/Products/MimetypesRegistry/icons/docx.png differ
diff --git a/Products/MimetypesRegistry/icons/down.png b/Products/MimetypesRegistry/icons/down.png
new file mode 100644
index 0000000..5677cff
Binary files /dev/null and b/Products/MimetypesRegistry/icons/down.png differ
diff --git a/Products/MimetypesRegistry/icons/dvi.png b/Products/MimetypesRegistry/icons/dvi.png
new file mode 100644
index 0000000..cca82ce
Binary files /dev/null and b/Products/MimetypesRegistry/icons/dvi.png differ
diff --git a/Products/MimetypesRegistry/icons/exe.png b/Products/MimetypesRegistry/icons/exe.png
new file mode 100644
index 0000000..006a93a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/exe.png differ
diff --git a/Products/MimetypesRegistry/icons/f.png b/Products/MimetypesRegistry/icons/f.png
new file mode 100644
index 0000000..5a11ccf
Binary files /dev/null and b/Products/MimetypesRegistry/icons/f.png differ
diff --git a/Products/MimetypesRegistry/icons/font.png b/Products/MimetypesRegistry/icons/font.png
new file mode 100644
index 0000000..903bc42
Binary files /dev/null and b/Products/MimetypesRegistry/icons/font.png differ
diff --git a/Products/MimetypesRegistry/icons/gf.png b/Products/MimetypesRegistry/icons/gf.png
new file mode 100644
index 0000000..c1e3060
Binary files /dev/null and b/Products/MimetypesRegistry/icons/gf.png differ
diff --git a/Products/MimetypesRegistry/icons/h.png b/Products/MimetypesRegistry/icons/h.png
new file mode 100644
index 0000000..80aeea8
Binary files /dev/null and b/Products/MimetypesRegistry/icons/h.png differ
diff --git a/Products/MimetypesRegistry/icons/html.png b/Products/MimetypesRegistry/icons/html.png
new file mode 100644
index 0000000..e9c191e
Binary files /dev/null and b/Products/MimetypesRegistry/icons/html.png differ
diff --git a/Products/MimetypesRegistry/icons/image.png b/Products/MimetypesRegistry/icons/image.png
new file mode 100644
index 0000000..df6111f
Binary files /dev/null and b/Products/MimetypesRegistry/icons/image.png differ
diff --git a/Products/MimetypesRegistry/icons/info.png b/Products/MimetypesRegistry/icons/info.png
new file mode 100644
index 0000000..08236b9
Binary files /dev/null and b/Products/MimetypesRegistry/icons/info.png differ
diff --git a/Products/MimetypesRegistry/icons/iso.png b/Products/MimetypesRegistry/icons/iso.png
new file mode 100644
index 0000000..27e8edd
Binary files /dev/null and b/Products/MimetypesRegistry/icons/iso.png differ
diff --git a/Products/MimetypesRegistry/icons/java.png b/Products/MimetypesRegistry/icons/java.png
new file mode 100644
index 0000000..2124149
Binary files /dev/null and b/Products/MimetypesRegistry/icons/java.png differ
diff --git a/Products/MimetypesRegistry/icons/log.png b/Products/MimetypesRegistry/icons/log.png
new file mode 100644
index 0000000..dba0d98
Binary files /dev/null and b/Products/MimetypesRegistry/icons/log.png differ
diff --git a/Products/MimetypesRegistry/icons/man.png b/Products/MimetypesRegistry/icons/man.png
new file mode 100644
index 0000000..ff04aa9
Binary files /dev/null and b/Products/MimetypesRegistry/icons/man.png differ
diff --git a/Products/MimetypesRegistry/icons/message.png b/Products/MimetypesRegistry/icons/message.png
new file mode 100644
index 0000000..4c4f71f
Binary files /dev/null and b/Products/MimetypesRegistry/icons/message.png differ
diff --git a/Products/MimetypesRegistry/icons/midi.png b/Products/MimetypesRegistry/icons/midi.png
new file mode 100644
index 0000000..6d893cb
Binary files /dev/null and b/Products/MimetypesRegistry/icons/midi.png differ
diff --git a/Products/MimetypesRegistry/icons/mime.png b/Products/MimetypesRegistry/icons/mime.png
new file mode 100644
index 0000000..f61579a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/mime.png differ
diff --git a/Products/MimetypesRegistry/icons/o.png b/Products/MimetypesRegistry/icons/o.png
new file mode 100644
index 0000000..5a11ccf
Binary files /dev/null and b/Products/MimetypesRegistry/icons/o.png differ
diff --git a/Products/MimetypesRegistry/icons/pdf.png b/Products/MimetypesRegistry/icons/pdf.png
new file mode 100644
index 0000000..64fcbea
Binary files /dev/null and b/Products/MimetypesRegistry/icons/pdf.png differ
diff --git a/Products/MimetypesRegistry/icons/pk.png b/Products/MimetypesRegistry/icons/pk.png
new file mode 100644
index 0000000..6d2505b
Binary files /dev/null and b/Products/MimetypesRegistry/icons/pk.png differ
diff --git a/Products/MimetypesRegistry/icons/pl.png b/Products/MimetypesRegistry/icons/pl.png
new file mode 100644
index 0000000..831a3e2
Binary files /dev/null and b/Products/MimetypesRegistry/icons/pl.png differ
diff --git a/Products/MimetypesRegistry/icons/png.png b/Products/MimetypesRegistry/icons/png.png
new file mode 100644
index 0000000..df6111f
Binary files /dev/null and b/Products/MimetypesRegistry/icons/png.png differ
diff --git a/Products/MimetypesRegistry/icons/ppt.png b/Products/MimetypesRegistry/icons/ppt.png
new file mode 100644
index 0000000..916f461
Binary files /dev/null and b/Products/MimetypesRegistry/icons/ppt.png differ
diff --git a/Products/MimetypesRegistry/icons/pptx.png b/Products/MimetypesRegistry/icons/pptx.png
new file mode 100644
index 0000000..916f461
Binary files /dev/null and b/Products/MimetypesRegistry/icons/pptx.png differ
diff --git a/Products/MimetypesRegistry/icons/ps.png b/Products/MimetypesRegistry/icons/ps.png
new file mode 100644
index 0000000..3b35275
Binary files /dev/null and b/Products/MimetypesRegistry/icons/ps.png differ
diff --git a/Products/MimetypesRegistry/icons/py.png b/Products/MimetypesRegistry/icons/py.png
new file mode 100644
index 0000000..2f8ebb1
Binary files /dev/null and b/Products/MimetypesRegistry/icons/py.png differ
diff --git a/Products/MimetypesRegistry/icons/quicktime.png b/Products/MimetypesRegistry/icons/quicktime.png
new file mode 100644
index 0000000..05b0b59
Binary files /dev/null and b/Products/MimetypesRegistry/icons/quicktime.png differ
diff --git a/Products/MimetypesRegistry/icons/rar.png b/Products/MimetypesRegistry/icons/rar.png
new file mode 100644
index 0000000..8a5c86a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/rar.png differ
diff --git a/Products/MimetypesRegistry/icons/rpm.png b/Products/MimetypesRegistry/icons/rpm.png
new file mode 100644
index 0000000..8a5c86a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/rpm.png differ
diff --git a/Products/MimetypesRegistry/icons/sh.png b/Products/MimetypesRegistry/icons/sh.png
new file mode 100644
index 0000000..f553447
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sh.png differ
diff --git a/Products/MimetypesRegistry/icons/sxc.png b/Products/MimetypesRegistry/icons/sxc.png
new file mode 100644
index 0000000..448d4d6
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxc.png differ
diff --git a/Products/MimetypesRegistry/icons/sxd.png b/Products/MimetypesRegistry/icons/sxd.png
new file mode 100644
index 0000000..c08b5d0
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxd.png differ
diff --git a/Products/MimetypesRegistry/icons/sxg.png b/Products/MimetypesRegistry/icons/sxg.png
new file mode 100644
index 0000000..1c6a4c9
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxg.png differ
diff --git a/Products/MimetypesRegistry/icons/sxi.png b/Products/MimetypesRegistry/icons/sxi.png
new file mode 100644
index 0000000..db0efe6
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxi.png differ
diff --git a/Products/MimetypesRegistry/icons/sxm.png b/Products/MimetypesRegistry/icons/sxm.png
new file mode 100644
index 0000000..4febd8d
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxm.png differ
diff --git a/Products/MimetypesRegistry/icons/sxw.png b/Products/MimetypesRegistry/icons/sxw.png
new file mode 100644
index 0000000..1c6a4c9
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxw.png differ
diff --git a/Products/MimetypesRegistry/icons/tar.png b/Products/MimetypesRegistry/icons/tar.png
new file mode 100644
index 0000000..8a5c86a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/tar.png differ
diff --git a/Products/MimetypesRegistry/icons/tex.png b/Products/MimetypesRegistry/icons/tex.png
new file mode 100644
index 0000000..233b2ff
Binary files /dev/null and b/Products/MimetypesRegistry/icons/tex.png differ
diff --git a/Products/MimetypesRegistry/icons/text.png b/Products/MimetypesRegistry/icons/text.png
new file mode 100644
index 0000000..63c2495
Binary files /dev/null and b/Products/MimetypesRegistry/icons/text.png differ
diff --git a/Products/MimetypesRegistry/icons/tgz.png b/Products/MimetypesRegistry/icons/tgz.png
new file mode 100644
index 0000000..cb01812
Binary files /dev/null and b/Products/MimetypesRegistry/icons/tgz.png differ
diff --git a/Products/MimetypesRegistry/icons/txt.png b/Products/MimetypesRegistry/icons/txt.png
new file mode 100644
index 0000000..63c2495
Binary files /dev/null and b/Products/MimetypesRegistry/icons/txt.png differ
diff --git a/Products/MimetypesRegistry/icons/unknown.png b/Products/MimetypesRegistry/icons/unknown.png
new file mode 100644
index 0000000..7e14136
Binary files /dev/null and b/Products/MimetypesRegistry/icons/unknown.png differ
diff --git a/Products/MimetypesRegistry/icons/up.png b/Products/MimetypesRegistry/icons/up.png
new file mode 100644
index 0000000..e2e15b0
Binary files /dev/null and b/Products/MimetypesRegistry/icons/up.png differ
diff --git a/Products/MimetypesRegistry/icons/vcal.png b/Products/MimetypesRegistry/icons/vcal.png
new file mode 100644
index 0000000..de76f68
Binary files /dev/null and b/Products/MimetypesRegistry/icons/vcal.png differ
diff --git a/Products/MimetypesRegistry/icons/vcard.png b/Products/MimetypesRegistry/icons/vcard.png
new file mode 100644
index 0000000..fdbcbe0
Binary files /dev/null and b/Products/MimetypesRegistry/icons/vcard.png differ
diff --git a/Products/MimetypesRegistry/icons/video.png b/Products/MimetypesRegistry/icons/video.png
new file mode 100644
index 0000000..05b0b59
Binary files /dev/null and b/Products/MimetypesRegistry/icons/video.png differ
diff --git a/Products/MimetypesRegistry/icons/wav.png b/Products/MimetypesRegistry/icons/wav.png
new file mode 100644
index 0000000..6d893cb
Binary files /dev/null and b/Products/MimetypesRegistry/icons/wav.png differ
diff --git a/Products/MimetypesRegistry/icons/xls.png b/Products/MimetypesRegistry/icons/xls.png
new file mode 100644
index 0000000..ea7ae01
Binary files /dev/null and b/Products/MimetypesRegistry/icons/xls.png differ
diff --git a/Products/MimetypesRegistry/icons/xlsx.png b/Products/MimetypesRegistry/icons/xlsx.png
new file mode 100644
index 0000000..ea7ae01
Binary files /dev/null and b/Products/MimetypesRegistry/icons/xlsx.png differ
diff --git a/Products/MimetypesRegistry/icons/zip.png b/Products/MimetypesRegistry/icons/zip.png
new file mode 100644
index 0000000..8a5c86a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/zip.png differ
diff --git a/Products/MimetypesRegistry/profiles/default/skins.xml b/Products/MimetypesRegistry/profiles/default/skins.xml
deleted file mode 100644
index f4e0f55..0000000
--- a/Products/MimetypesRegistry/profiles/default/skins.xml
+++ /dev/null
@@ -1,11 +0,0 @@
-<?xml version="1.0"?>
-<object name="portal_skins">
-  <object
-      name="mimetypes_icons"
-      meta_type="Filesystem Directory View"
-      directory="Products.MimetypesRegistry:skins/mimetypes_icons"
-      />
-  <skin-path name="*">
-    <layer name="mimetypes_icons" insert-after="custom" />
-  </skin-path>
-</object>
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/application.png b/Products/MimetypesRegistry/skins/mimetypes_icons/application.png
deleted file mode 100644
index 006a93a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/application.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/audio.png b/Products/MimetypesRegistry/skins/mimetypes_icons/audio.png
deleted file mode 100644
index 6d893cb..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/audio.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/avi.png b/Products/MimetypesRegistry/skins/mimetypes_icons/avi.png
deleted file mode 100644
index 05b0b59..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/avi.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/c.png b/Products/MimetypesRegistry/skins/mimetypes_icons/c.png
deleted file mode 100644
index 21b483c..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/c.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/core.png b/Products/MimetypesRegistry/skins/mimetypes_icons/core.png
deleted file mode 100644
index 11f4c0e..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/core.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/cpp.png b/Products/MimetypesRegistry/skins/mimetypes_icons/cpp.png
deleted file mode 100644
index 34e1512..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/cpp.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/deb.png b/Products/MimetypesRegistry/skins/mimetypes_icons/deb.png
deleted file mode 100644
index 8a5c86a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/deb.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/doc.png b/Products/MimetypesRegistry/skins/mimetypes_icons/doc.png
deleted file mode 100644
index 93072bc..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/doc.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/docx.png b/Products/MimetypesRegistry/skins/mimetypes_icons/docx.png
deleted file mode 100644
index 93072bc..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/docx.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/down.png b/Products/MimetypesRegistry/skins/mimetypes_icons/down.png
deleted file mode 100644
index 5677cff..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/down.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/dvi.png b/Products/MimetypesRegistry/skins/mimetypes_icons/dvi.png
deleted file mode 100644
index cca82ce..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/dvi.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/exe.png b/Products/MimetypesRegistry/skins/mimetypes_icons/exe.png
deleted file mode 100644
index 006a93a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/exe.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/f.png b/Products/MimetypesRegistry/skins/mimetypes_icons/f.png
deleted file mode 100644
index 5a11ccf..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/f.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/font.png b/Products/MimetypesRegistry/skins/mimetypes_icons/font.png
deleted file mode 100644
index 903bc42..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/font.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/gf.png b/Products/MimetypesRegistry/skins/mimetypes_icons/gf.png
deleted file mode 100644
index c1e3060..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/gf.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/h.png b/Products/MimetypesRegistry/skins/mimetypes_icons/h.png
deleted file mode 100644
index 80aeea8..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/h.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/html.png b/Products/MimetypesRegistry/skins/mimetypes_icons/html.png
deleted file mode 100644
index e9c191e..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/html.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/image.png b/Products/MimetypesRegistry/skins/mimetypes_icons/image.png
deleted file mode 100644
index df6111f..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/image.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/info.png b/Products/MimetypesRegistry/skins/mimetypes_icons/info.png
deleted file mode 100644
index 08236b9..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/info.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/iso.png b/Products/MimetypesRegistry/skins/mimetypes_icons/iso.png
deleted file mode 100644
index 27e8edd..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/iso.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/java.png b/Products/MimetypesRegistry/skins/mimetypes_icons/java.png
deleted file mode 100644
index 2124149..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/java.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/log.png b/Products/MimetypesRegistry/skins/mimetypes_icons/log.png
deleted file mode 100644
index dba0d98..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/log.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/man.png b/Products/MimetypesRegistry/skins/mimetypes_icons/man.png
deleted file mode 100644
index ff04aa9..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/man.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/message.png b/Products/MimetypesRegistry/skins/mimetypes_icons/message.png
deleted file mode 100644
index 4c4f71f..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/message.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/midi.png b/Products/MimetypesRegistry/skins/mimetypes_icons/midi.png
deleted file mode 100644
index 6d893cb..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/midi.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/mime.png b/Products/MimetypesRegistry/skins/mimetypes_icons/mime.png
deleted file mode 100644
index f61579a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/mime.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/o.png b/Products/MimetypesRegistry/skins/mimetypes_icons/o.png
deleted file mode 100644
index 5a11ccf..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/o.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/pdf.png b/Products/MimetypesRegistry/skins/mimetypes_icons/pdf.png
deleted file mode 100644
index 64fcbea..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/pdf.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/pk.png b/Products/MimetypesRegistry/skins/mimetypes_icons/pk.png
deleted file mode 100644
index 6d2505b..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/pk.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/pl.png b/Products/MimetypesRegistry/skins/mimetypes_icons/pl.png
deleted file mode 100644
index 831a3e2..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/pl.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/png.png b/Products/MimetypesRegistry/skins/mimetypes_icons/png.png
deleted file mode 100644
index df6111f..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/png.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/ppt.png b/Products/MimetypesRegistry/skins/mimetypes_icons/ppt.png
deleted file mode 100644
index 916f461..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/ppt.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/pptx.png b/Products/MimetypesRegistry/skins/mimetypes_icons/pptx.png
deleted file mode 100644
index 916f461..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/pptx.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/ps.png b/Products/MimetypesRegistry/skins/mimetypes_icons/ps.png
deleted file mode 100644
index 3b35275..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/ps.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/py.png b/Products/MimetypesRegistry/skins/mimetypes_icons/py.png
deleted file mode 100644
index 2f8ebb1..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/py.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/quicktime.png b/Products/MimetypesRegistry/skins/mimetypes_icons/quicktime.png
deleted file mode 100644
index 05b0b59..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/quicktime.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/rar.png b/Products/MimetypesRegistry/skins/mimetypes_icons/rar.png
deleted file mode 100644
index 8a5c86a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/rar.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/rpm.png b/Products/MimetypesRegistry/skins/mimetypes_icons/rpm.png
deleted file mode 100644
index 8a5c86a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/rpm.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sh.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sh.png
deleted file mode 100644
index f553447..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sh.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxc.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxc.png
deleted file mode 100644
index 448d4d6..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxc.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxd.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxd.png
deleted file mode 100644
index c08b5d0..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxd.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxg.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxg.png
deleted file mode 100644
index 1c6a4c9..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxg.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxi.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxi.png
deleted file mode 100644
index db0efe6..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxi.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxm.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxm.png
deleted file mode 100644
index 4febd8d..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxm.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxw.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxw.png
deleted file mode 100644
index 1c6a4c9..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxw.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/tar.png b/Products/MimetypesRegistry/skins/mimetypes_icons/tar.png
deleted file mode 100644
index 8a5c86a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/tar.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/tex.png b/Products/MimetypesRegistry/skins/mimetypes_icons/tex.png
deleted file mode 100644
index 233b2ff..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/tex.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/text.png b/Products/MimetypesRegistry/skins/mimetypes_icons/text.png
deleted file mode 100644
index 63c2495..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/text.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/tgz.png b/Products/MimetypesRegistry/skins/mimetypes_icons/tgz.png
deleted file mode 100644
index cb01812..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/tgz.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/txt.png b/Products/MimetypesRegistry/skins/mimetypes_icons/txt.png
deleted file mode 100644
index 63c2495..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/txt.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/unknown.png b/Products/MimetypesRegistry/skins/mimetypes_icons/unknown.png
deleted file mode 100644
index 7e14136..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/unknown.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/up.png b/Products/MimetypesRegistry/skins/mimetypes_icons/up.png
deleted file mode 100644
index e2e15b0..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/up.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/vcal.png b/Products/MimetypesRegistry/skins/mimetypes_icons/vcal.png
deleted file mode 100644
index de76f68..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/vcal.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/vcard.png b/Products/MimetypesRegistry/skins/mimetypes_icons/vcard.png
deleted file mode 100644
index fdbcbe0..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/vcard.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/video.png b/Products/MimetypesRegistry/skins/mimetypes_icons/video.png
deleted file mode 100644
index 05b0b59..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/video.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/wav.png b/Products/MimetypesRegistry/skins/mimetypes_icons/wav.png
deleted file mode 100644
index 6d893cb..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/wav.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/xls.png b/Products/MimetypesRegistry/skins/mimetypes_icons/xls.png
deleted file mode 100644
index ea7ae01..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/xls.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/xlsx.png b/Products/MimetypesRegistry/skins/mimetypes_icons/xlsx.png
deleted file mode 100644
index ea7ae01..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/xlsx.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/zip.png b/Products/MimetypesRegistry/skins/mimetypes_icons/zip.png
deleted file mode 100644
index 8a5c86a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/zip.png and /dev/null differ


Repository: Products.MimetypesRegistry


Branch: refs/heads/master
Date: 2016-10-18T16:30:23-04:00
Author: agitator (agitator) <hpeter@agitator.com>
Commit: https://github.com/plone/Products.MimetypesRegistry/commit/8c8f9e9608d77f966c219ef46f3bd50895386746

Merge pull request #8 from plone/cleanup

Cleanup

Files changed:
A Products/MimetypesRegistry/icons/application.png
A Products/MimetypesRegistry/icons/audio.png
A Products/MimetypesRegistry/icons/avi.png
A Products/MimetypesRegistry/icons/c.png
A Products/MimetypesRegistry/icons/core.png
A Products/MimetypesRegistry/icons/cpp.png
A Products/MimetypesRegistry/icons/deb.png
A Products/MimetypesRegistry/icons/doc.png
A Products/MimetypesRegistry/icons/docx.png
A Products/MimetypesRegistry/icons/down.png
A Products/MimetypesRegistry/icons/dvi.png
A Products/MimetypesRegistry/icons/exe.png
A Products/MimetypesRegistry/icons/f.png
A Products/MimetypesRegistry/icons/font.png
A Products/MimetypesRegistry/icons/gf.png
A Products/MimetypesRegistry/icons/h.png
A Products/MimetypesRegistry/icons/html.png
A Products/MimetypesRegistry/icons/image.png
A Products/MimetypesRegistry/icons/info.png
A Products/MimetypesRegistry/icons/iso.png
A Products/MimetypesRegistry/icons/java.png
A Products/MimetypesRegistry/icons/log.png
A Products/MimetypesRegistry/icons/man.png
A Products/MimetypesRegistry/icons/message.png
A Products/MimetypesRegistry/icons/midi.png
A Products/MimetypesRegistry/icons/mime.png
A Products/MimetypesRegistry/icons/o.png
A Products/MimetypesRegistry/icons/pdf.png
A Products/MimetypesRegistry/icons/pk.png
A Products/MimetypesRegistry/icons/pl.png
A Products/MimetypesRegistry/icons/png.png
A Products/MimetypesRegistry/icons/ppt.png
A Products/MimetypesRegistry/icons/pptx.png
A Products/MimetypesRegistry/icons/ps.png
A Products/MimetypesRegistry/icons/py.png
A Products/MimetypesRegistry/icons/quicktime.png
A Products/MimetypesRegistry/icons/rar.png
A Products/MimetypesRegistry/icons/rpm.png
A Products/MimetypesRegistry/icons/sh.png
A Products/MimetypesRegistry/icons/sxc.png
A Products/MimetypesRegistry/icons/sxd.png
A Products/MimetypesRegistry/icons/sxg.png
A Products/MimetypesRegistry/icons/sxi.png
A Products/MimetypesRegistry/icons/sxm.png
A Products/MimetypesRegistry/icons/sxw.png
A Products/MimetypesRegistry/icons/tar.png
A Products/MimetypesRegistry/icons/tex.png
A Products/MimetypesRegistry/icons/text.png
A Products/MimetypesRegistry/icons/tgz.png
A Products/MimetypesRegistry/icons/txt.png
A Products/MimetypesRegistry/icons/unknown.png
A Products/MimetypesRegistry/icons/up.png
A Products/MimetypesRegistry/icons/vcal.png
A Products/MimetypesRegistry/icons/vcard.png
A Products/MimetypesRegistry/icons/video.png
A Products/MimetypesRegistry/icons/wav.png
A Products/MimetypesRegistry/icons/xls.png
A Products/MimetypesRegistry/icons/xlsx.png
A Products/MimetypesRegistry/icons/zip.png
A setup.cfg
M CHANGES.rst
M Products/MimetypesRegistry/MimeTypeItem.py
M Products/MimetypesRegistry/MimeTypesRegistry.py
M Products/MimetypesRegistry/__init__.py
M Products/MimetypesRegistry/common.py
M Products/MimetypesRegistry/configure.zcml
M Products/MimetypesRegistry/encoding.py
M Products/MimetypesRegistry/interfaces.py
M Products/MimetypesRegistry/mime_types/__init__.py
M Products/MimetypesRegistry/mime_types/magic.py
M Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
M Products/MimetypesRegistry/mime_types/py_mimetypes.py
M Products/MimetypesRegistry/mime_types/smi_mimetypes.py
M Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
M Products/MimetypesRegistry/mime_types/windows_mimetypes.py
M Products/MimetypesRegistry/profiles/default/componentregistry.xml
M Products/MimetypesRegistry/profiles/default/metadata.xml
M Products/MimetypesRegistry/profiles/default/toolset.xml
M Products/MimetypesRegistry/setuphandlers.py
M Products/MimetypesRegistry/tests/test_encoding.py
M Products/MimetypesRegistry/tests/test_magic.py
M Products/MimetypesRegistry/tests/test_mimetypes.py
M Products/MimetypesRegistry/tests/utils.py
M Products/__init__.py
M README.rst
M bootstrap.py
M setup.py
D Products/MimetypesRegistry/profiles/default/mimetypes-registry-various.txt
D Products/MimetypesRegistry/profiles/default/skins.xml
D Products/MimetypesRegistry/skins/mimetypes_icons/application.png
D Products/MimetypesRegistry/skins/mimetypes_icons/audio.png
D Products/MimetypesRegistry/skins/mimetypes_icons/avi.png
D Products/MimetypesRegistry/skins/mimetypes_icons/c.png
D Products/MimetypesRegistry/skins/mimetypes_icons/core.png
D Products/MimetypesRegistry/skins/mimetypes_icons/cpp.png
D Products/MimetypesRegistry/skins/mimetypes_icons/deb.png
D Products/MimetypesRegistry/skins/mimetypes_icons/doc.png
D Products/MimetypesRegistry/skins/mimetypes_icons/docx.png
D Products/MimetypesRegistry/skins/mimetypes_icons/down.png
D Products/MimetypesRegistry/skins/mimetypes_icons/dvi.png
D Products/MimetypesRegistry/skins/mimetypes_icons/exe.png
D Products/MimetypesRegistry/skins/mimetypes_icons/f.png
D Products/MimetypesRegistry/skins/mimetypes_icons/font.png
D Products/MimetypesRegistry/skins/mimetypes_icons/gf.png
D Products/MimetypesRegistry/skins/mimetypes_icons/h.png
D Products/MimetypesRegistry/skins/mimetypes_icons/html.png
D Products/MimetypesRegistry/skins/mimetypes_icons/image.png
D Products/MimetypesRegistry/skins/mimetypes_icons/info.png
D Products/MimetypesRegistry/skins/mimetypes_icons/iso.png
D Products/MimetypesRegistry/skins/mimetypes_icons/java.png
D Products/MimetypesRegistry/skins/mimetypes_icons/log.png
D Products/MimetypesRegistry/skins/mimetypes_icons/man.png
D Products/MimetypesRegistry/skins/mimetypes_icons/message.png
D Products/MimetypesRegistry/skins/mimetypes_icons/midi.png
D Products/MimetypesRegistry/skins/mimetypes_icons/mime.png
D Products/MimetypesRegistry/skins/mimetypes_icons/o.png
D Products/MimetypesRegistry/skins/mimetypes_icons/pdf.png
D Products/MimetypesRegistry/skins/mimetypes_icons/pk.png
D Products/MimetypesRegistry/skins/mimetypes_icons/pl.png
D Products/MimetypesRegistry/skins/mimetypes_icons/png.png
D Products/MimetypesRegistry/skins/mimetypes_icons/ppt.png
D Products/MimetypesRegistry/skins/mimetypes_icons/pptx.png
D Products/MimetypesRegistry/skins/mimetypes_icons/ps.png
D Products/MimetypesRegistry/skins/mimetypes_icons/py.png
D Products/MimetypesRegistry/skins/mimetypes_icons/quicktime.png
D Products/MimetypesRegistry/skins/mimetypes_icons/rar.png
D Products/MimetypesRegistry/skins/mimetypes_icons/rpm.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sh.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxc.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxd.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxg.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxi.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxm.png
D Products/MimetypesRegistry/skins/mimetypes_icons/sxw.png
D Products/MimetypesRegistry/skins/mimetypes_icons/tar.png
D Products/MimetypesRegistry/skins/mimetypes_icons/tex.png
D Products/MimetypesRegistry/skins/mimetypes_icons/text.png
D Products/MimetypesRegistry/skins/mimetypes_icons/tgz.png
D Products/MimetypesRegistry/skins/mimetypes_icons/txt.png
D Products/MimetypesRegistry/skins/mimetypes_icons/unknown.png
D Products/MimetypesRegistry/skins/mimetypes_icons/up.png
D Products/MimetypesRegistry/skins/mimetypes_icons/vcal.png
D Products/MimetypesRegistry/skins/mimetypes_icons/vcard.png
D Products/MimetypesRegistry/skins/mimetypes_icons/video.png
D Products/MimetypesRegistry/skins/mimetypes_icons/wav.png
D Products/MimetypesRegistry/skins/mimetypes_icons/xls.png
D Products/MimetypesRegistry/skins/mimetypes_icons/xlsx.png
D Products/MimetypesRegistry/skins/mimetypes_icons/zip.png

diff --git a/CHANGES.rst b/CHANGES.rst
index 617606f..f21d6ec 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,9 +15,20 @@ New features:
   Downloaded tarball at https://freedesktop.org/wiki/Software/shared-mime-info/
   [jensens]
 
+- Add font/woff2 to supplement type, since its not in SMI.
+  [jensens]
+
+- Move icons from skins folder to a browser resourceDirectory nameed "mimetype.icons".
+  Adopt guess_icon_path to return the new location.
+  [jensens]
+
 Bug fixes:
 
-- *add item here*
+- Cleanup: isort, autopep8, utf8 headers, manual cleanup, security decorators.
+  [jensens]
+
+- Remove outdated and unused (whole plone core) STRING_TYPES declaration from ``common.py``.
+  [jensens]
 
 
 2.0.10 (2016-08-09)
diff --git a/Products/MimetypesRegistry/MimeTypeItem.py b/Products/MimetypesRegistry/MimeTypeItem.py
index 2ee08f1..dde7027 100644
--- a/Products/MimetypesRegistry/MimeTypeItem.py
+++ b/Products/MimetypesRegistry/MimeTypeItem.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from AccessControl import ClassSecurityInfo
 from Acquisition import Explicit
 from App.class_init import InitializeClass
@@ -6,6 +7,7 @@
 from Products.CMFCore.permissions import ManagePortal
 from Products.MimetypesRegistry.interfaces import IMimetype
 from zope.interface import implementer
+
 import os
 import urllib
 
@@ -45,26 +47,22 @@ def __cmp__(self, other):
     def __hash__(self):
         return hash(self.name())
 
-    security.declarePublic('name')
-
+    @security.public
     def name(self):
         """ The name of this object """
         return self.__name__
 
-    security.declarePublic('major')
-
+    @security.public
     def major(self):
         """ return the major part of the RFC-2046 name for this mime type """
         return self.normalized().split('/', 1)[0]
 
-    security.declarePublic('minor')
-
+    @security.public
     def minor(self):
         """ return the minor part of the RFC-2046 name for this mime type """
         return self.normalized().split('/', 1)[1]
 
-    security.declarePublic('normalized')
-
+    @security.public
     def normalized(self):
         """ return the main RFC-2046 name for this mime type
 
@@ -73,16 +71,14 @@ def normalized(self):
         """
         return self.mimetypes[0]
 
-    security.declarePublic('urlsafe')
-
+    @security.public
     def urlsafe(self):
         """Return a url safe version of the normalized version of this
         mime type.
         """
         return urllib.quote(self.normalized())
 
-    security.declareProtected(ManagePortal, 'edit')
-
+    @security.protected(ManagePortal)
     def edit(self, name, mimetypes, extensions, icon_path,
              binary=0, globs=None, REQUEST=None):
         """edit this mime type"""
@@ -106,10 +102,12 @@ def edit(self, name, mimetypes, extensions, icon_path,
         if REQUEST is not None:
             REQUEST['RESPONSE'].redirect(self.absolute_url() + '/manage_main')
 
+
 InitializeClass(MimeTypeItem)
 
 
-ICONS_DIR = os.path.join(os.path.dirname(__file__), 'skins', 'mimetypes_icons')
+ICONS_DIR = os.path.join(os.path.dirname(__file__), 'icons')
+PREFIX = '++resource++mimetype.icons/'
 
 
 def guess_icon_path(mimetype, icons_dir=ICONS_DIR, icon_ext='png'):
@@ -117,8 +115,8 @@ def guess_icon_path(mimetype, icons_dir=ICONS_DIR, icon_ext='png'):
         for ext in mimetype.extensions:
             icon_path = '%s.%s' % (ext, icon_ext)
             if os.path.exists(os.path.join(icons_dir, icon_path)):
-                return icon_path
+                return PREFIX + icon_path
     icon_path = '%s.png' % mimetype.major()
     if os.path.exists(os.path.join(icons_dir, icon_path)):
-        return icon_path
-    return 'unknown.png'
+        return PREFIX + icon_path
+    return PREFIX + 'unknown.png'
diff --git a/Products/MimetypesRegistry/MimeTypesRegistry.py b/Products/MimetypesRegistry/MimeTypesRegistry.py
index e84c579..cdae7b1 100644
--- a/Products/MimetypesRegistry/MimeTypesRegistry.py
+++ b/Products/MimetypesRegistry/MimeTypesRegistry.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from AccessControl import ClassSecurityInfo
 from Acquisition import aq_base
 from App.class_init import InitializeClass
@@ -6,12 +7,9 @@
 from Persistence import PersistentMapping
 from Products.CMFCore.ActionProviderBase import ActionProviderBase
 from Products.CMFCore.permissions import ManagePortal
-from Products.CMFCore.utils import UniqueObject
 from Products.CMFCore.utils import registerToolInterface
-from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
+from Products.CMFCore.utils import UniqueObject
 from Products.MimetypesRegistry.common import MimeTypeException
-from Products.MimetypesRegistry.common import _www
-from Products.MimetypesRegistry.common import log
 from Products.MimetypesRegistry.encoding import guess_encoding
 from Products.MimetypesRegistry.interfaces import IClassifier
 from Products.MimetypesRegistry.interfaces import IMimetype
@@ -20,15 +18,20 @@
 from Products.MimetypesRegistry.interfaces import ISourceAdapter
 from Products.MimetypesRegistry.mime_types import initialize
 from Products.MimetypesRegistry.mime_types import magic
+from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from Products.PageTemplates.PageTemplateFile import PageTemplateFile
-from types import UnicodeType
 from zope.contenttype import guess_content_type
 from zope.interface import implementer
+
 import fnmatch
+import logging
 import os
 import re
 
 
+logger = logging.getLogger(__name__)
+
+
 suffix_map = {
     'tgz': '.tar.gz',
     'taz': '.tar.gz',
@@ -40,6 +43,8 @@
     'Z': 'compress',
 }
 
+_www = os.path.join(os.path.dirname(__file__), 'www')
+
 
 @implementer(IMimetypesRegistry, ISourceAdapter)
 class MimeTypesRegistry(UniqueObject, ActionProviderBase, Folder):
@@ -97,8 +102,7 @@ def __init__(self, id=None):
         initialize(self)
         self._new_style_mtr = 1
 
-    security.declareProtected(ManagePortal, 'register')
-
+    @security.protected(ManagePortal)
     def register(self, mimetype):
         """ Register a new mimetype
 
@@ -113,8 +117,7 @@ def register(self, mimetype):
         for glob in mimetype.globs:
             self.register_glob(glob, mimetype)
 
-    security.declareProtected(ManagePortal, 'register_mimetype')
-
+    @security.protected(ManagePortal)
     def register_mimetype(self, mt, mimetype):
         major, minor = split(mt)
         if not major or not minor or minor == '*':
@@ -122,12 +125,15 @@ def register_mimetype(self, mt, mimetype):
         group = self._mimetypes.setdefault(major, PersistentMapping())
         if minor in group:
             if group.get(minor) != mimetype:
-                log('Warning: redefining mime type %s (%s)' % (
-                    mt, mimetype.__class__))
+                logger.warn(
+                    'Redefining mime type {0} ({1})'.format(
+                        mt,
+                        mimetype.__class__
+                    )
+                )
         group[minor] = mimetype
 
-    security.declareProtected(ManagePortal, 'register_extension')
-
+    @security.protected(ManagePortal)
     def register_extension(self, extension, mimetype):
         """ Associate a file's extension to a IMimetype
 
@@ -137,13 +143,17 @@ def register_extension(self, extension, mimetype):
         mimetype = aq_base(mimetype)
         if extension in self.extensions:
             if self.extensions.get(extension) != mimetype:
-                log('Warning: redefining extension %s from %s to %s' % (
-                    extension, self.extensions[extension], mimetype))
+                logger.warn(
+                    'Redefining extension {0} from {1} to {2}'.format(
+                        extension,
+                        self.extensions[extension],
+                        mimetype
+                    )
+                )
         # we don't validate fmt yet, but its ["txt", "html"]
         self.extensions[extension] = mimetype
 
-    security.declareProtected(ManagePortal, 'register_glob')
-
+    @security.protected(ManagePortal)
     def register_glob(self, glob, mimetype):
         """ Associate a glob to a IMimetype
 
@@ -159,14 +169,18 @@ def register_glob(self, glob, mimetype):
         if existing is not None:
             regex, mt = existing
             if mt != mimetype:
-                log('Warning: redefining glob %s from %s to %s' % (
-                    glob, mt, mimetype))
+                logger.warn(
+                    'Redefining glob {0} from {1} to {2}'.format(
+                        glob,
+                        mt,
+                        mimetype
+                    )
+                )
         # we don't validate fmt yet, but its ["txt", "html"]
         pattern = re.compile(fnmatch.translate(glob))
         globs[glob] = (pattern, mimetype)
 
-    security.declareProtected(ManagePortal, 'unregister')
-
+    @security.protected(ManagePortal)
     def unregister(self, mimetype):
         """ Unregister a new mimetype
 
@@ -191,8 +205,7 @@ def unregister(self, mimetype):
                 if mt == mimetype:
                     del globs[glob]
 
-    security.declarePublic('mimetypes')
-
+    @security.public
     def mimetypes(self):
         """Return all defined mime types, each one implements at least
         IMimetype
@@ -203,14 +216,12 @@ def mimetypes(self):
                 res[mt] = 1
         return [aq_base(mtitem) for mtitem in res.keys()]
 
-    security.declarePublic('list_mimetypes')
-
+    @security.public
     def list_mimetypes(self):
         """Return all defined mime types, as string"""
         return [str(mt) for mt in self.mimetypes()]
 
-    security.declarePublic('lookup')
-
+    @security.public
     def lookup(self, mimetypestring):
         """Lookup for IMimetypes object matching mimetypestring
 
@@ -236,8 +247,7 @@ def lookup(self, mimetypestring):
                 return ()
         return tuple([aq_base(mtitem) for mtitem in res])
 
-    security.declarePublic('lookupExtension')
-
+    @security.public
     def lookupExtension(self, filename):
         """Lookup for IMimetypes object matching filename
 
@@ -247,6 +257,7 @@ def lookupExtension(self, filename):
         Return an IMimetype object associated with the file's
         extension or None
         """
+        base = None
         if filename.find('.') != -1:
             base, ext = os.path.splitext(filename)
             ext = ext[1:]  # remove the dot
@@ -255,11 +266,8 @@ def lookupExtension(self, filename):
                 ext = ext[1:]  # remove the dot
         else:
             ext = filename
-            base = None
 
-        # XXX This code below make no sense and may break because base
-        # isn't defined.
-        if ext in self.encodings_map and base:
+        if base is not None and ext in self.encodings_map:
             base, ext = os.path.splitext(base)
             ext = ext[1:]  # remove the dot
 
@@ -268,8 +276,7 @@ def lookupExtension(self, filename):
             result = aq_base(self.extensions.get(ext.lower()))
         return result
 
-    security.declarePublic('globFilename')
-
+    @security.public
     def globFilename(self, filename):
         """Lookup for IMimetypes object matching filename
 
@@ -277,28 +284,23 @@ def globFilename(self, filename):
 
         Return an IMimetype object associated with the glob's or None
         """
-        globs = getattr(self, 'globs', None)
-        if globs is None:
-            return None
-        for key in globs.keys():
+        globs = getattr(self, 'globs', {})
+        for key in globs:
             glob, mimetype = globs[key]
             if glob.match(filename):
                 return aq_base(mimetype)
         return None
 
-    security.declarePublic('lookupGlob')
-
+    @security.public
     def lookupGlob(self, glob):
         globs = getattr(self, 'globs', None)
-        if globs is None:
-            return None
-        return aq_base(globs.get(glob))
+        if globs is not None:
+            return aq_base(globs.get(glob))
 
     def _classifiers(self):
         return [mt for mt in self.mimetypes() if IClassifier.providedBy(mt)]
 
-    security.declarePublic('classify')
-
+    @security.public
     def classify(self, data, mimetype=None, filename=None):
         """Classify works as follows:
         1) you tell me the rfc-2046 name and I give you an IMimetype
@@ -378,7 +380,7 @@ def __call__(self, data, **kwargs):
         # it is
         mt = self.classify(data, mimetype=mimetype, filename=filename)
 
-        if not mt.binary and not isinstance(data, UnicodeType):
+        if not mt.binary and not isinstance(data, unicode):
             # if no encoding specified, try to guess it from data
             if encoding is None:
                 encoding = self.guess_encoding(data)
@@ -402,14 +404,13 @@ def __call__(self, data, **kwargs):
 
         return (data, filename, aq_base(mt))
 
-    security.declarePublic('guess_encoding')
-
+    @security.public
     def guess_encoding(self, data):
         """ Try to guess encoding from a text value.
 
         If no encoding can be guessed, fall back to utf-8.
         """
-        if isinstance(data, type(u'')):
+        if isinstance(data, unicode):
             # data maybe unicode but with another encoding specified
             data = data.encode('UTF-8')
         encoding = guess_encoding(data)
@@ -417,8 +418,7 @@ def guess_encoding(self, data):
             encoding = 'utf-8'
         return encoding
 
-    security.declareProtected(ManagePortal, 'manage_delObjects')
-
+    @security.protected(ManagePortal)
     def manage_delObjects(self, ids, REQUEST=None):
         """ delete the selected mime types """
         for id in ids:
@@ -426,8 +426,7 @@ def manage_delObjects(self, ids, REQUEST=None):
         if REQUEST is not None:
             REQUEST['RESPONSE'].redirect(self.absolute_url() + '/manage_main')
 
-    security.declareProtected(ManagePortal, 'manage_addMimeType')
-
+    @security.protected(ManagePortal)
     def manage_addMimeType(self, id, mimetypes, extensions, icon_path,
                            binary=0, globs=None, REQUEST=None):
         """add a mime type to the tool"""
@@ -437,8 +436,7 @@ def manage_addMimeType(self, id, mimetypes, extensions, icon_path,
         if REQUEST is not None:
             REQUEST['RESPONSE'].redirect(self.absolute_url() + '/manage_main')
 
-    security.declareProtected(ManagePortal, 'manage_editMimeType')
-
+    @security.protected(ManagePortal)
     def manage_editMimeType(self, name, new_name, mimetypes, extensions,
                             icon_path, binary=0, globs=None, REQUEST=None):
         """Edit a mime type by name
@@ -451,6 +449,7 @@ def manage_editMimeType(self, name, new_name, mimetypes, extensions,
         if REQUEST is not None:
             REQUEST['RESPONSE'].redirect(self.absolute_url() + '/manage_main')
 
+
 InitializeClass(MimeTypesRegistry)
 registerToolInterface('mimetypes_registry', IMimetypesRegistryTool)
 
diff --git a/Products/MimetypesRegistry/__init__.py b/Products/MimetypesRegistry/__init__.py
index 1de1b6b..60cb723 100644
--- a/Products/MimetypesRegistry/__init__.py
+++ b/Products/MimetypesRegistry/__init__.py
@@ -1,19 +1,20 @@
-from AccessControl.SecurityInfo import allow_module, allow_class
+# -*- coding: utf-8 -*-
+from AccessControl.SecurityInfo import allow_class
+from AccessControl.SecurityInfo import allow_module
 from Products.MimetypesRegistry import MimeTypesRegistry
-from Products.MimetypesRegistry.common import MimeTypeException
+from Products.MimetypesRegistry.interfaces import MimeTypeException  # noqa
 
 
-GLOBALS = globals()
-PKG_NAME = 'MimetypesRegistry'
-tools = (MimeTypesRegistry.MimeTypesRegistry, )
+# remove when Archetypes are removed:
 allow_module('Products.MimetypesRegistry.common')
 allow_class(MimeTypeException)
+# end remove
 
 
 def initialize(context):
     from Products.CMFCore import utils
     utils.ToolInit(
-        "%s Tool" % PKG_NAME,
-        tools=tools,
-        icon="tool.gif",
+        'MimetypesRegistry Tool',
+        tools=(MimeTypesRegistry.MimeTypesRegistry, ),
+        icon='tool.gif',
     ).initialize(context)
diff --git a/Products/MimetypesRegistry/common.py b/Products/MimetypesRegistry/common.py
index 6bf6406..0d6eb33 100644
--- a/Products/MimetypesRegistry/common.py
+++ b/Products/MimetypesRegistry/common.py
@@ -1,25 +1,10 @@
-from AccessControl import ModuleSecurityInfo
-from types import StringType
-from types import UnicodeType
-import logging
-import os.path
-
-
-STRING_TYPES = (UnicodeType, StringType)
-# directory where template for the ZMI are located
-_www = os.path.join(os.path.dirname(__file__), 'www')
-
-security = ModuleSecurityInfo()
-security.declarePrivate('logging')
-security.declarePrivate('os')
-security.declarePrivate('time')
-
-logger = logging.getLogger('MimetypesRegistry')
-
-
-def log(msg, severity=logging.INFO, id='MimetypesRegistry'):
-    logger.log(severity, msg)
-
-
-class MimeTypeException(Exception):
-    pass
+# -*- coding: utf-8 -*-
+# this code is needed by Archetypes only
+import zope.deferredimport
+
+zope.deferredimport.initialize()
+zope.deferredimport.deprecated(
+    "Import from Products.MimetypesRegistry.interfaces instead",
+    MimeTypeException='Products.MimetypesRegistry.interfaces:'
+                      'MimeTypeException',
+)
diff --git a/Products/MimetypesRegistry/configure.zcml b/Products/MimetypesRegistry/configure.zcml
index eb8290d..f24cd35 100644
--- a/Products/MimetypesRegistry/configure.zcml
+++ b/Products/MimetypesRegistry/configure.zcml
@@ -1,13 +1,12 @@
 <configure
     xmlns="http://namespaces.zope.org/zope"
-    xmlns:cmf="http://namespaces.zope.org/cmf"
+    xmlns:browser="http://namespaces.zope.org/browser"
     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"
     i18n_domain="Products.MimetypesRegistry">
 
-  <cmf:registerDirectory
-      name="skins"
-      directory="skins"
-      recursive="True"
+ <browser:resourceDirectory
+      name="mimetype.icons"
+      directory="icons"
       />
 
   <genericsetup:registerProfile
@@ -16,14 +15,7 @@
       directory="profiles/default"
       description="Extension profile for default MimetypesRegistry setup."
       provides="Products.GenericSetup.interfaces.EXTENSION"
+      post_handler=".setuphandlers.post_install"
     />
 
-  <genericsetup:importStep
-      name="mimetypes-registry-various"
-      handler="Products.MimetypesRegistry.setuphandlers.setupMimetypesRegistry"
-      title="MimetypesRegistry setup"
-      description="MimetypesRegistry installation step.">
-    <depends name="componentregistry" />
-  </genericsetup:importStep>
-
 </configure>
diff --git a/Products/MimetypesRegistry/encoding.py b/Products/MimetypesRegistry/encoding.py
index 3c2f6d1..db2b765 100644
--- a/Products/MimetypesRegistry/encoding.py
+++ b/Products/MimetypesRegistry/encoding.py
@@ -1,5 +1,6 @@
-import re
+# -*- coding: utf-8 -*-
 import encodings
+import re
 
 
 EMACS_ENCODING_RGX = re.compile('[^#]*[#\s]*-\*-\s*coding: ([^\s]*)\s*-\*-\s*')
diff --git a/Products/MimetypesRegistry/icons/application.png b/Products/MimetypesRegistry/icons/application.png
new file mode 100644
index 0000000..006a93a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/application.png differ
diff --git a/Products/MimetypesRegistry/icons/audio.png b/Products/MimetypesRegistry/icons/audio.png
new file mode 100644
index 0000000..6d893cb
Binary files /dev/null and b/Products/MimetypesRegistry/icons/audio.png differ
diff --git a/Products/MimetypesRegistry/icons/avi.png b/Products/MimetypesRegistry/icons/avi.png
new file mode 100644
index 0000000..05b0b59
Binary files /dev/null and b/Products/MimetypesRegistry/icons/avi.png differ
diff --git a/Products/MimetypesRegistry/icons/c.png b/Products/MimetypesRegistry/icons/c.png
new file mode 100644
index 0000000..21b483c
Binary files /dev/null and b/Products/MimetypesRegistry/icons/c.png differ
diff --git a/Products/MimetypesRegistry/icons/core.png b/Products/MimetypesRegistry/icons/core.png
new file mode 100644
index 0000000..11f4c0e
Binary files /dev/null and b/Products/MimetypesRegistry/icons/core.png differ
diff --git a/Products/MimetypesRegistry/icons/cpp.png b/Products/MimetypesRegistry/icons/cpp.png
new file mode 100644
index 0000000..34e1512
Binary files /dev/null and b/Products/MimetypesRegistry/icons/cpp.png differ
diff --git a/Products/MimetypesRegistry/icons/deb.png b/Products/MimetypesRegistry/icons/deb.png
new file mode 100644
index 0000000..8a5c86a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/deb.png differ
diff --git a/Products/MimetypesRegistry/icons/doc.png b/Products/MimetypesRegistry/icons/doc.png
new file mode 100644
index 0000000..93072bc
Binary files /dev/null and b/Products/MimetypesRegistry/icons/doc.png differ
diff --git a/Products/MimetypesRegistry/icons/docx.png b/Products/MimetypesRegistry/icons/docx.png
new file mode 100644
index 0000000..93072bc
Binary files /dev/null and b/Products/MimetypesRegistry/icons/docx.png differ
diff --git a/Products/MimetypesRegistry/icons/down.png b/Products/MimetypesRegistry/icons/down.png
new file mode 100644
index 0000000..5677cff
Binary files /dev/null and b/Products/MimetypesRegistry/icons/down.png differ
diff --git a/Products/MimetypesRegistry/icons/dvi.png b/Products/MimetypesRegistry/icons/dvi.png
new file mode 100644
index 0000000..cca82ce
Binary files /dev/null and b/Products/MimetypesRegistry/icons/dvi.png differ
diff --git a/Products/MimetypesRegistry/icons/exe.png b/Products/MimetypesRegistry/icons/exe.png
new file mode 100644
index 0000000..006a93a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/exe.png differ
diff --git a/Products/MimetypesRegistry/icons/f.png b/Products/MimetypesRegistry/icons/f.png
new file mode 100644
index 0000000..5a11ccf
Binary files /dev/null and b/Products/MimetypesRegistry/icons/f.png differ
diff --git a/Products/MimetypesRegistry/icons/font.png b/Products/MimetypesRegistry/icons/font.png
new file mode 100644
index 0000000..903bc42
Binary files /dev/null and b/Products/MimetypesRegistry/icons/font.png differ
diff --git a/Products/MimetypesRegistry/icons/gf.png b/Products/MimetypesRegistry/icons/gf.png
new file mode 100644
index 0000000..c1e3060
Binary files /dev/null and b/Products/MimetypesRegistry/icons/gf.png differ
diff --git a/Products/MimetypesRegistry/icons/h.png b/Products/MimetypesRegistry/icons/h.png
new file mode 100644
index 0000000..80aeea8
Binary files /dev/null and b/Products/MimetypesRegistry/icons/h.png differ
diff --git a/Products/MimetypesRegistry/icons/html.png b/Products/MimetypesRegistry/icons/html.png
new file mode 100644
index 0000000..e9c191e
Binary files /dev/null and b/Products/MimetypesRegistry/icons/html.png differ
diff --git a/Products/MimetypesRegistry/icons/image.png b/Products/MimetypesRegistry/icons/image.png
new file mode 100644
index 0000000..df6111f
Binary files /dev/null and b/Products/MimetypesRegistry/icons/image.png differ
diff --git a/Products/MimetypesRegistry/icons/info.png b/Products/MimetypesRegistry/icons/info.png
new file mode 100644
index 0000000..08236b9
Binary files /dev/null and b/Products/MimetypesRegistry/icons/info.png differ
diff --git a/Products/MimetypesRegistry/icons/iso.png b/Products/MimetypesRegistry/icons/iso.png
new file mode 100644
index 0000000..27e8edd
Binary files /dev/null and b/Products/MimetypesRegistry/icons/iso.png differ
diff --git a/Products/MimetypesRegistry/icons/java.png b/Products/MimetypesRegistry/icons/java.png
new file mode 100644
index 0000000..2124149
Binary files /dev/null and b/Products/MimetypesRegistry/icons/java.png differ
diff --git a/Products/MimetypesRegistry/icons/log.png b/Products/MimetypesRegistry/icons/log.png
new file mode 100644
index 0000000..dba0d98
Binary files /dev/null and b/Products/MimetypesRegistry/icons/log.png differ
diff --git a/Products/MimetypesRegistry/icons/man.png b/Products/MimetypesRegistry/icons/man.png
new file mode 100644
index 0000000..ff04aa9
Binary files /dev/null and b/Products/MimetypesRegistry/icons/man.png differ
diff --git a/Products/MimetypesRegistry/icons/message.png b/Products/MimetypesRegistry/icons/message.png
new file mode 100644
index 0000000..4c4f71f
Binary files /dev/null and b/Products/MimetypesRegistry/icons/message.png differ
diff --git a/Products/MimetypesRegistry/icons/midi.png b/Products/MimetypesRegistry/icons/midi.png
new file mode 100644
index 0000000..6d893cb
Binary files /dev/null and b/Products/MimetypesRegistry/icons/midi.png differ
diff --git a/Products/MimetypesRegistry/icons/mime.png b/Products/MimetypesRegistry/icons/mime.png
new file mode 100644
index 0000000..f61579a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/mime.png differ
diff --git a/Products/MimetypesRegistry/icons/o.png b/Products/MimetypesRegistry/icons/o.png
new file mode 100644
index 0000000..5a11ccf
Binary files /dev/null and b/Products/MimetypesRegistry/icons/o.png differ
diff --git a/Products/MimetypesRegistry/icons/pdf.png b/Products/MimetypesRegistry/icons/pdf.png
new file mode 100644
index 0000000..64fcbea
Binary files /dev/null and b/Products/MimetypesRegistry/icons/pdf.png differ
diff --git a/Products/MimetypesRegistry/icons/pk.png b/Products/MimetypesRegistry/icons/pk.png
new file mode 100644
index 0000000..6d2505b
Binary files /dev/null and b/Products/MimetypesRegistry/icons/pk.png differ
diff --git a/Products/MimetypesRegistry/icons/pl.png b/Products/MimetypesRegistry/icons/pl.png
new file mode 100644
index 0000000..831a3e2
Binary files /dev/null and b/Products/MimetypesRegistry/icons/pl.png differ
diff --git a/Products/MimetypesRegistry/icons/png.png b/Products/MimetypesRegistry/icons/png.png
new file mode 100644
index 0000000..df6111f
Binary files /dev/null and b/Products/MimetypesRegistry/icons/png.png differ
diff --git a/Products/MimetypesRegistry/icons/ppt.png b/Products/MimetypesRegistry/icons/ppt.png
new file mode 100644
index 0000000..916f461
Binary files /dev/null and b/Products/MimetypesRegistry/icons/ppt.png differ
diff --git a/Products/MimetypesRegistry/icons/pptx.png b/Products/MimetypesRegistry/icons/pptx.png
new file mode 100644
index 0000000..916f461
Binary files /dev/null and b/Products/MimetypesRegistry/icons/pptx.png differ
diff --git a/Products/MimetypesRegistry/icons/ps.png b/Products/MimetypesRegistry/icons/ps.png
new file mode 100644
index 0000000..3b35275
Binary files /dev/null and b/Products/MimetypesRegistry/icons/ps.png differ
diff --git a/Products/MimetypesRegistry/icons/py.png b/Products/MimetypesRegistry/icons/py.png
new file mode 100644
index 0000000..2f8ebb1
Binary files /dev/null and b/Products/MimetypesRegistry/icons/py.png differ
diff --git a/Products/MimetypesRegistry/icons/quicktime.png b/Products/MimetypesRegistry/icons/quicktime.png
new file mode 100644
index 0000000..05b0b59
Binary files /dev/null and b/Products/MimetypesRegistry/icons/quicktime.png differ
diff --git a/Products/MimetypesRegistry/icons/rar.png b/Products/MimetypesRegistry/icons/rar.png
new file mode 100644
index 0000000..8a5c86a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/rar.png differ
diff --git a/Products/MimetypesRegistry/icons/rpm.png b/Products/MimetypesRegistry/icons/rpm.png
new file mode 100644
index 0000000..8a5c86a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/rpm.png differ
diff --git a/Products/MimetypesRegistry/icons/sh.png b/Products/MimetypesRegistry/icons/sh.png
new file mode 100644
index 0000000..f553447
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sh.png differ
diff --git a/Products/MimetypesRegistry/icons/sxc.png b/Products/MimetypesRegistry/icons/sxc.png
new file mode 100644
index 0000000..448d4d6
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxc.png differ
diff --git a/Products/MimetypesRegistry/icons/sxd.png b/Products/MimetypesRegistry/icons/sxd.png
new file mode 100644
index 0000000..c08b5d0
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxd.png differ
diff --git a/Products/MimetypesRegistry/icons/sxg.png b/Products/MimetypesRegistry/icons/sxg.png
new file mode 100644
index 0000000..1c6a4c9
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxg.png differ
diff --git a/Products/MimetypesRegistry/icons/sxi.png b/Products/MimetypesRegistry/icons/sxi.png
new file mode 100644
index 0000000..db0efe6
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxi.png differ
diff --git a/Products/MimetypesRegistry/icons/sxm.png b/Products/MimetypesRegistry/icons/sxm.png
new file mode 100644
index 0000000..4febd8d
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxm.png differ
diff --git a/Products/MimetypesRegistry/icons/sxw.png b/Products/MimetypesRegistry/icons/sxw.png
new file mode 100644
index 0000000..1c6a4c9
Binary files /dev/null and b/Products/MimetypesRegistry/icons/sxw.png differ
diff --git a/Products/MimetypesRegistry/icons/tar.png b/Products/MimetypesRegistry/icons/tar.png
new file mode 100644
index 0000000..8a5c86a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/tar.png differ
diff --git a/Products/MimetypesRegistry/icons/tex.png b/Products/MimetypesRegistry/icons/tex.png
new file mode 100644
index 0000000..233b2ff
Binary files /dev/null and b/Products/MimetypesRegistry/icons/tex.png differ
diff --git a/Products/MimetypesRegistry/icons/text.png b/Products/MimetypesRegistry/icons/text.png
new file mode 100644
index 0000000..63c2495
Binary files /dev/null and b/Products/MimetypesRegistry/icons/text.png differ
diff --git a/Products/MimetypesRegistry/icons/tgz.png b/Products/MimetypesRegistry/icons/tgz.png
new file mode 100644
index 0000000..cb01812
Binary files /dev/null and b/Products/MimetypesRegistry/icons/tgz.png differ
diff --git a/Products/MimetypesRegistry/icons/txt.png b/Products/MimetypesRegistry/icons/txt.png
new file mode 100644
index 0000000..63c2495
Binary files /dev/null and b/Products/MimetypesRegistry/icons/txt.png differ
diff --git a/Products/MimetypesRegistry/icons/unknown.png b/Products/MimetypesRegistry/icons/unknown.png
new file mode 100644
index 0000000..7e14136
Binary files /dev/null and b/Products/MimetypesRegistry/icons/unknown.png differ
diff --git a/Products/MimetypesRegistry/icons/up.png b/Products/MimetypesRegistry/icons/up.png
new file mode 100644
index 0000000..e2e15b0
Binary files /dev/null and b/Products/MimetypesRegistry/icons/up.png differ
diff --git a/Products/MimetypesRegistry/icons/vcal.png b/Products/MimetypesRegistry/icons/vcal.png
new file mode 100644
index 0000000..de76f68
Binary files /dev/null and b/Products/MimetypesRegistry/icons/vcal.png differ
diff --git a/Products/MimetypesRegistry/icons/vcard.png b/Products/MimetypesRegistry/icons/vcard.png
new file mode 100644
index 0000000..fdbcbe0
Binary files /dev/null and b/Products/MimetypesRegistry/icons/vcard.png differ
diff --git a/Products/MimetypesRegistry/icons/video.png b/Products/MimetypesRegistry/icons/video.png
new file mode 100644
index 0000000..05b0b59
Binary files /dev/null and b/Products/MimetypesRegistry/icons/video.png differ
diff --git a/Products/MimetypesRegistry/icons/wav.png b/Products/MimetypesRegistry/icons/wav.png
new file mode 100644
index 0000000..6d893cb
Binary files /dev/null and b/Products/MimetypesRegistry/icons/wav.png differ
diff --git a/Products/MimetypesRegistry/icons/xls.png b/Products/MimetypesRegistry/icons/xls.png
new file mode 100644
index 0000000..ea7ae01
Binary files /dev/null and b/Products/MimetypesRegistry/icons/xls.png differ
diff --git a/Products/MimetypesRegistry/icons/xlsx.png b/Products/MimetypesRegistry/icons/xlsx.png
new file mode 100644
index 0000000..ea7ae01
Binary files /dev/null and b/Products/MimetypesRegistry/icons/xlsx.png differ
diff --git a/Products/MimetypesRegistry/icons/zip.png b/Products/MimetypesRegistry/icons/zip.png
new file mode 100644
index 0000000..8a5c86a
Binary files /dev/null and b/Products/MimetypesRegistry/icons/zip.png differ
diff --git a/Products/MimetypesRegistry/interfaces.py b/Products/MimetypesRegistry/interfaces.py
index 96f57ce..a0ab663 100644
--- a/Products/MimetypesRegistry/interfaces.py
+++ b/Products/MimetypesRegistry/interfaces.py
@@ -1,6 +1,11 @@
+# -*- coding: utf-8 -*-
 from zope.interface import Interface
 
 
+class MimeTypeException(Exception):
+    pass
+
+
 class IMimetype(Interface):
     """Specification for dealing with mimetypes RFC-2046 style"""
 
@@ -53,9 +58,9 @@ def classify(data, mimetype=None, filename=None):
     def lookup(mimetypestring):
         """Lookup for imimetypes object matching mimetypestring
 
-        mimetypestring may have an empty minor part or containing a wildcard (*)
-        mimetypestring may be an imimetype object (in this case it will be
-        returned unchanged, else it should be a RFC-2046 name
+        mimetypestring may have an empty minor part or containing a
+        wildcard (*) mimetypestring may be an imimetype object (in this case
+        it will be returned unchanged, else it should be a RFC-2046 name
 
         return a list of mimetypes objects associated with the RFC-2046 name
         return an empty list if no one is known.
diff --git a/Products/MimetypesRegistry/mime_types/__init__.py b/Products/MimetypesRegistry/mime_types/__init__.py
index b834633..48b5751 100644
--- a/Products/MimetypesRegistry/mime_types/__init__.py
+++ b/Products/MimetypesRegistry/mime_types/__init__.py
@@ -1,10 +1,11 @@
+# -*- coding: utf-8 -*-
+from mtr_mimetypes import *
+
 import mtr_mimetypes
 import py_mimetypes
 import smi_mimetypes
 import suppl_mimetypes
 
-from mtr_mimetypes import *
-
 
 def initialize(registry):
     smi_mimetypes.initialize(registry)
diff --git a/Products/MimetypesRegistry/mime_types/magic.py b/Products/MimetypesRegistry/mime_types/magic.py
index d45bc89..2f0178e 100644
--- a/Products/MimetypesRegistry/mime_types/magic.py
+++ b/Products/MimetypesRegistry/mime_types/magic.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 """
 magic.py
 
@@ -10,8 +11,8 @@
 """
 __version__ = '$Revision: 1.2 $'[11:-2]
 
-import struct
 import string
+import struct
 
 
 magic = [
diff --git a/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py b/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
index d98f774..bc51f79 100644
--- a/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/mtr_mimetypes.py
@@ -1,7 +1,9 @@
-from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
+# -*- coding: utf-8 -*-
 from Products.MimetypesRegistry.interfaces import IClassifier
+from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from types import InstanceType
 from zope.interface import implementer
+
 import re
 
 
diff --git a/Products/MimetypesRegistry/mime_types/py_mimetypes.py b/Products/MimetypesRegistry/mime_types/py_mimetypes.py
index 767a25d..b1f69db 100644
--- a/Products/MimetypesRegistry/mime_types/py_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/py_mimetypes.py
@@ -1,7 +1,9 @@
-from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
-from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path
+# -*- coding: utf-8 -*-
 from Products.MimetypesRegistry.common import MimeTypeException
+from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path
+from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 from zope.contenttype import add_files
+
 import mimetypes as pymimetypes
 import os.path
 
@@ -18,6 +20,7 @@ def mimes_initialize():
     here = os.path.dirname(os.path.abspath(__file__))
     add_files([os.path.join(here, 'mime.types')])
 
+
 # don't register the mimetype from python mimetypes if matching on of
 # this extensions.
 skip_extensions = ()
diff --git a/Products/MimetypesRegistry/mime_types/smi_mimetypes.py b/Products/MimetypesRegistry/mime_types/smi_mimetypes.py
index 924c88e..5510494 100644
--- a/Products/MimetypesRegistry/mime_types/smi_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/smi_mimetypes.py
@@ -1,7 +1,10 @@
-from cPickle import dump, load
+# -*- coding: utf-8 -*-
+from cPickle import dump
+from cPickle import load
 from stat import ST_MTIME
 from xml.sax import parse
 from xml.sax.handler import ContentHandler
+
 import os
 
 
diff --git a/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py b/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
index e0605f9..59d8b7c 100644
--- a/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/suppl_mimetypes.py
@@ -1,11 +1,12 @@
-from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
+# -*- coding: utf-8 -*-
 from Products.MimetypesRegistry.common import MimeTypeException
+from Products.MimetypesRegistry.MimeTypeItem import MimeTypeItem
 
 
 map = {
     # '.extension' : 'mimetype',
-    '.svg': 'image/svg+xml',  # scaleable vector graphics
-    '.pjpg': 'image/pjpeg',  # scaleable vector graphics
+    '.pjpg': 'image/pjpeg',  # progressive jpeg - is this is still a thing?
+    '.woff2': 'font/woff2'
 }
 
 
diff --git a/Products/MimetypesRegistry/mime_types/windows_mimetypes.py b/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
index d173779..2a1b4c6 100644
--- a/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
+++ b/Products/MimetypesRegistry/mime_types/windows_mimetypes.py
@@ -1,13 +1,17 @@
+# -*- coding: utf-8 -*-
 # Utilities for mime-types and the Windows registry.
 import _winreg
+import logging
+import mimetypes
 import win32api
 import win32con
-import mimetypes
 
-import logging
+
 logger = logging.getLogger('mimetypes.win32')
 
 # "safely" query a value, returning a default when it doesn't exist.
+
+
 def _RegQueryValue(key, value, default=None):
     try:
         data, typ = win32api.RegQueryValueEx(key, value)
@@ -20,6 +24,7 @@ def _RegQueryValue(key, value, default=None):
         data = data.rstrip('\0')
     return data
 
+
 def get_desc_for_mimetype(mime_type):
     try:
         hk = win32api.RegOpenKey(win32con.HKEY_CLASSES_ROOT,
@@ -27,11 +32,12 @@ def get_desc_for_mimetype(mime_type):
         desc = _RegQueryValue(hk, "")
     except win32api.error, details:
         logger.info("win32api error fetching description for mime-type %r: %s",
-                     mime_type, details)
+                    mime_type, details)
         desc = None
     logger.debug("mime-type %s has description %s", mime_type, desc)
     return desc
 
+
 def get_ext_for_mimetype(mime_type):
     try:
         hk = win32api.RegOpenKey(win32con.HKEY_CLASSES_ROOT,
@@ -39,11 +45,12 @@ def get_ext_for_mimetype(mime_type):
         ext = _RegQueryValue(hk, "Extension")
     except win32api.error, details:
         logger.info("win32api error fetching extension for mime-type %r: %s",
-                     mime_type, details)
+                    mime_type, details)
         ext = None
     logger.debug("mime-type %s has extension %s", mime_type, ext)
     return ext
 
+
 def get_mime_types():
     try:
         hk = win32api.RegOpenKey(win32con.HKEY_CLASSES_ROOT,
@@ -55,10 +62,12 @@ def get_mime_types():
         items = []
     return [i[0] for i in items if i[0]]
 
+
 def normalize(mt):
     # Some mimetypes might have extra ';q=value' params.
     return mt.lower().split(';')[0]
 
+
 def initialize():
     if not mimetypes.inited:
         mimetypes.init()
@@ -67,12 +76,14 @@ def initialize():
         ext = get_ext_for_mimetype(mt)
         if not ext:
             continue
-        if not mimetypes.types_map.has_key(ext):
+        if ext not in mimetypes.types_map:
             mimetypes.add_type(normalize(mt), ext)
 
-if __name__=='__main__':
+
+if __name__ == '__main__':
     for mt in get_mime_types():
         ext = get_ext_for_mimetype(mt)
         desc = get_desc_for_mimetype(mt)
         print "%s (%s) - %s" % (mt.lower(), desc, ext)
-    import code; code.interact(local=locals())
+    import code
+    code.interact(local=locals())
diff --git a/Products/MimetypesRegistry/profiles/default/componentregistry.xml b/Products/MimetypesRegistry/profiles/default/componentregistry.xml
index e8a2b2c..b92d45c 100644
--- a/Products/MimetypesRegistry/profiles/default/componentregistry.xml
+++ b/Products/MimetypesRegistry/profiles/default/componentregistry.xml
@@ -1,7 +1,10 @@
 <?xml version="1.0"?>
 <componentregistry>
-  <adapters />
+  <adapters/>
   <utilities>
-    <utility interface="Products.MimetypesRegistry.interfaces.IMimetypesRegistryTool" object="mimetypes_registry" />
+    <utility
+        interface="Products.MimetypesRegistry.interfaces.IMimetypesRegistryTool"
+        object="mimetypes_registry"
+    />
   </utilities>
 </componentregistry>
diff --git a/Products/MimetypesRegistry/profiles/default/metadata.xml b/Products/MimetypesRegistry/profiles/default/metadata.xml
index 2692b09..d02ea5c 100644
--- a/Products/MimetypesRegistry/profiles/default/metadata.xml
+++ b/Products/MimetypesRegistry/profiles/default/metadata.xml
@@ -1,4 +1,4 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>1.6</version>
+  <version>2</version>
 </metadata>
diff --git a/Products/MimetypesRegistry/profiles/default/mimetypes-registry-various.txt b/Products/MimetypesRegistry/profiles/default/mimetypes-registry-various.txt
deleted file mode 100644
index e69de29..0000000
diff --git a/Products/MimetypesRegistry/profiles/default/skins.xml b/Products/MimetypesRegistry/profiles/default/skins.xml
deleted file mode 100644
index f4e0f55..0000000
--- a/Products/MimetypesRegistry/profiles/default/skins.xml
+++ /dev/null
@@ -1,11 +0,0 @@
-<?xml version="1.0"?>
-<object name="portal_skins">
-  <object
-      name="mimetypes_icons"
-      meta_type="Filesystem Directory View"
-      directory="Products.MimetypesRegistry:skins/mimetypes_icons"
-      />
-  <skin-path name="*">
-    <layer name="mimetypes_icons" insert-after="custom" />
-  </skin-path>
-</object>
diff --git a/Products/MimetypesRegistry/profiles/default/toolset.xml b/Products/MimetypesRegistry/profiles/default/toolset.xml
index 0a40f89..09ee68a 100644
--- a/Products/MimetypesRegistry/profiles/default/toolset.xml
+++ b/Products/MimetypesRegistry/profiles/default/toolset.xml
@@ -1,7 +1,7 @@
 <?xml version="1.0"?>
 <tool-setup>
   <required
-      tool_id="mimetypes_registry"
       class="Products.MimetypesRegistry.MimeTypesRegistry.MimeTypesRegistry"
-      />
+      tool_id="mimetypes_registry"
+  />
 </tool-setup>
diff --git a/Products/MimetypesRegistry/setuphandlers.py b/Products/MimetypesRegistry/setuphandlers.py
index 084ea97..207ef44 100644
--- a/Products/MimetypesRegistry/setuphandlers.py
+++ b/Products/MimetypesRegistry/setuphandlers.py
@@ -1,43 +1,38 @@
+# -*- coding: utf-8 -*-
 from Products.CMFCore.utils import getToolByName
-from StringIO import StringIO
+from Products.MimetypesRegistry.mime_types import smi_mimetypes
+
 import logging
 
-logger = logging.getLogger('MimetypesRegistry')
+
+logger = logging.getLogger(__name__)
 
 
-def fixUpSMIGlobs(portal, out=None, reinit=True):
+def fixUpSMIGlobs(context, reinit=True):
     # This method is used both in migrations where we need the reinit and
     # during site creation, where the registry has already been initialized.
-    from Products.MimetypesRegistry.mime_types import smi_mimetypes
-    mtr = getToolByName(portal, 'mimetypes_registry')
+    mtr = getToolByName(context, 'mimetypes_registry')
     if reinit:
         smi_mimetypes.initialize(mtr)
 
     # Now comes the fun part. For every glob, lookup a extension
     # matching the glob and unregister it.
     for glob in mtr.globs.keys():
-        if glob in mtr.extensions:
-            logger.debug(
-                'Found glob %s in extensions registry, removing.' % glob)
-            mti = mtr.extensions[glob]
-            del mtr.extensions[glob]
-            if glob in mti.extensions:
-                logger.debug('Found glob %s in mimetype %s extensions, '
-                             'removing.' % (glob, mti))
-                exts = list(mti.extensions)
-                exts.remove(glob)
-                mti.extensions = tuple(exts)
-                mtr.register(mti)
-
-
-def installMimetypesRegistry(portal):
-    out = StringIO()
-    fixUpSMIGlobs(portal, out, reinit=False)
-
-
-def setupMimetypesRegistry(context):
-    # Only run step if a flag file is present (e.g. not an extension profile)
-    if context.readDataFile('mimetypes-registry-various.txt') is None:
-        return
-    site = context.getSite()
-    installMimetypesRegistry(site)
+        if glob not in mtr.extensions:
+            continue
+        logger.debug(
+            'Found glob %s in extensions registry, removing.' % glob
+        )
+        mti = mtr.extensions[glob]
+        del mtr.extensions[glob]
+        if glob in mti.extensions:
+            logger.debug('Found glob %s in mimetype %s extensions, '
+                         'removing.' % (glob, mti))
+            exts = list(mti.extensions)
+            exts.remove(glob)
+            mti.extensions = tuple(exts)
+            mtr.register(mti)
+
+
+def post_install(context):
+    fixUpSMIGlobs(context, reinit=False)
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/application.png b/Products/MimetypesRegistry/skins/mimetypes_icons/application.png
deleted file mode 100644
index 006a93a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/application.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/audio.png b/Products/MimetypesRegistry/skins/mimetypes_icons/audio.png
deleted file mode 100644
index 6d893cb..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/audio.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/avi.png b/Products/MimetypesRegistry/skins/mimetypes_icons/avi.png
deleted file mode 100644
index 05b0b59..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/avi.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/c.png b/Products/MimetypesRegistry/skins/mimetypes_icons/c.png
deleted file mode 100644
index 21b483c..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/c.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/core.png b/Products/MimetypesRegistry/skins/mimetypes_icons/core.png
deleted file mode 100644
index 11f4c0e..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/core.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/cpp.png b/Products/MimetypesRegistry/skins/mimetypes_icons/cpp.png
deleted file mode 100644
index 34e1512..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/cpp.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/deb.png b/Products/MimetypesRegistry/skins/mimetypes_icons/deb.png
deleted file mode 100644
index 8a5c86a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/deb.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/doc.png b/Products/MimetypesRegistry/skins/mimetypes_icons/doc.png
deleted file mode 100644
index 93072bc..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/doc.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/docx.png b/Products/MimetypesRegistry/skins/mimetypes_icons/docx.png
deleted file mode 100644
index 93072bc..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/docx.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/down.png b/Products/MimetypesRegistry/skins/mimetypes_icons/down.png
deleted file mode 100644
index 5677cff..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/down.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/dvi.png b/Products/MimetypesRegistry/skins/mimetypes_icons/dvi.png
deleted file mode 100644
index cca82ce..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/dvi.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/exe.png b/Products/MimetypesRegistry/skins/mimetypes_icons/exe.png
deleted file mode 100644
index 006a93a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/exe.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/f.png b/Products/MimetypesRegistry/skins/mimetypes_icons/f.png
deleted file mode 100644
index 5a11ccf..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/f.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/font.png b/Products/MimetypesRegistry/skins/mimetypes_icons/font.png
deleted file mode 100644
index 903bc42..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/font.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/gf.png b/Products/MimetypesRegistry/skins/mimetypes_icons/gf.png
deleted file mode 100644
index c1e3060..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/gf.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/h.png b/Products/MimetypesRegistry/skins/mimetypes_icons/h.png
deleted file mode 100644
index 80aeea8..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/h.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/html.png b/Products/MimetypesRegistry/skins/mimetypes_icons/html.png
deleted file mode 100644
index e9c191e..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/html.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/image.png b/Products/MimetypesRegistry/skins/mimetypes_icons/image.png
deleted file mode 100644
index df6111f..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/image.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/info.png b/Products/MimetypesRegistry/skins/mimetypes_icons/info.png
deleted file mode 100644
index 08236b9..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/info.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/iso.png b/Products/MimetypesRegistry/skins/mimetypes_icons/iso.png
deleted file mode 100644
index 27e8edd..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/iso.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/java.png b/Products/MimetypesRegistry/skins/mimetypes_icons/java.png
deleted file mode 100644
index 2124149..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/java.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/log.png b/Products/MimetypesRegistry/skins/mimetypes_icons/log.png
deleted file mode 100644
index dba0d98..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/log.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/man.png b/Products/MimetypesRegistry/skins/mimetypes_icons/man.png
deleted file mode 100644
index ff04aa9..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/man.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/message.png b/Products/MimetypesRegistry/skins/mimetypes_icons/message.png
deleted file mode 100644
index 4c4f71f..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/message.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/midi.png b/Products/MimetypesRegistry/skins/mimetypes_icons/midi.png
deleted file mode 100644
index 6d893cb..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/midi.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/mime.png b/Products/MimetypesRegistry/skins/mimetypes_icons/mime.png
deleted file mode 100644
index f61579a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/mime.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/o.png b/Products/MimetypesRegistry/skins/mimetypes_icons/o.png
deleted file mode 100644
index 5a11ccf..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/o.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/pdf.png b/Products/MimetypesRegistry/skins/mimetypes_icons/pdf.png
deleted file mode 100644
index 64fcbea..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/pdf.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/pk.png b/Products/MimetypesRegistry/skins/mimetypes_icons/pk.png
deleted file mode 100644
index 6d2505b..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/pk.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/pl.png b/Products/MimetypesRegistry/skins/mimetypes_icons/pl.png
deleted file mode 100644
index 831a3e2..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/pl.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/png.png b/Products/MimetypesRegistry/skins/mimetypes_icons/png.png
deleted file mode 100644
index df6111f..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/png.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/ppt.png b/Products/MimetypesRegistry/skins/mimetypes_icons/ppt.png
deleted file mode 100644
index 916f461..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/ppt.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/pptx.png b/Products/MimetypesRegistry/skins/mimetypes_icons/pptx.png
deleted file mode 100644
index 916f461..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/pptx.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/ps.png b/Products/MimetypesRegistry/skins/mimetypes_icons/ps.png
deleted file mode 100644
index 3b35275..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/ps.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/py.png b/Products/MimetypesRegistry/skins/mimetypes_icons/py.png
deleted file mode 100644
index 2f8ebb1..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/py.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/quicktime.png b/Products/MimetypesRegistry/skins/mimetypes_icons/quicktime.png
deleted file mode 100644
index 05b0b59..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/quicktime.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/rar.png b/Products/MimetypesRegistry/skins/mimetypes_icons/rar.png
deleted file mode 100644
index 8a5c86a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/rar.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/rpm.png b/Products/MimetypesRegistry/skins/mimetypes_icons/rpm.png
deleted file mode 100644
index 8a5c86a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/rpm.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sh.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sh.png
deleted file mode 100644
index f553447..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sh.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxc.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxc.png
deleted file mode 100644
index 448d4d6..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxc.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxd.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxd.png
deleted file mode 100644
index c08b5d0..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxd.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxg.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxg.png
deleted file mode 100644
index 1c6a4c9..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxg.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxi.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxi.png
deleted file mode 100644
index db0efe6..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxi.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxm.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxm.png
deleted file mode 100644
index 4febd8d..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxm.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/sxw.png b/Products/MimetypesRegistry/skins/mimetypes_icons/sxw.png
deleted file mode 100644
index 1c6a4c9..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/sxw.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/tar.png b/Products/MimetypesRegistry/skins/mimetypes_icons/tar.png
deleted file mode 100644
index 8a5c86a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/tar.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/tex.png b/Products/MimetypesRegistry/skins/mimetypes_icons/tex.png
deleted file mode 100644
index 233b2ff..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/tex.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/text.png b/Products/MimetypesRegistry/skins/mimetypes_icons/text.png
deleted file mode 100644
index 63c2495..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/text.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/tgz.png b/Products/MimetypesRegistry/skins/mimetypes_icons/tgz.png
deleted file mode 100644
index cb01812..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/tgz.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/txt.png b/Products/MimetypesRegistry/skins/mimetypes_icons/txt.png
deleted file mode 100644
index 63c2495..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/txt.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/unknown.png b/Products/MimetypesRegistry/skins/mimetypes_icons/unknown.png
deleted file mode 100644
index 7e14136..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/unknown.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/up.png b/Products/MimetypesRegistry/skins/mimetypes_icons/up.png
deleted file mode 100644
index e2e15b0..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/up.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/vcal.png b/Products/MimetypesRegistry/skins/mimetypes_icons/vcal.png
deleted file mode 100644
index de76f68..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/vcal.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/vcard.png b/Products/MimetypesRegistry/skins/mimetypes_icons/vcard.png
deleted file mode 100644
index fdbcbe0..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/vcard.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/video.png b/Products/MimetypesRegistry/skins/mimetypes_icons/video.png
deleted file mode 100644
index 05b0b59..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/video.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/wav.png b/Products/MimetypesRegistry/skins/mimetypes_icons/wav.png
deleted file mode 100644
index 6d893cb..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/wav.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/xls.png b/Products/MimetypesRegistry/skins/mimetypes_icons/xls.png
deleted file mode 100644
index ea7ae01..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/xls.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/xlsx.png b/Products/MimetypesRegistry/skins/mimetypes_icons/xlsx.png
deleted file mode 100644
index ea7ae01..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/xlsx.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/skins/mimetypes_icons/zip.png b/Products/MimetypesRegistry/skins/mimetypes_icons/zip.png
deleted file mode 100644
index 8a5c86a..0000000
Binary files a/Products/MimetypesRegistry/skins/mimetypes_icons/zip.png and /dev/null differ
diff --git a/Products/MimetypesRegistry/tests/test_encoding.py b/Products/MimetypesRegistry/tests/test_encoding.py
index 3e6cb30..9d05c60 100644
--- a/Products/MimetypesRegistry/tests/test_encoding.py
+++ b/Products/MimetypesRegistry/tests/test_encoding.py
@@ -1,5 +1,6 @@
-from Products.MimetypesRegistry.encoding import guess_encoding
+# -*- coding: utf-8 -*-
 from plone.app.testing.bbb import PloneTestCase as ATSiteTestCase
+from Products.MimetypesRegistry.encoding import guess_encoding
 
 
 class TestGuessEncoding(ATSiteTestCase):
diff --git a/Products/MimetypesRegistry/tests/test_magic.py b/Products/MimetypesRegistry/tests/test_magic.py
index 9b5c094..cc50517 100644
--- a/Products/MimetypesRegistry/tests/test_magic.py
+++ b/Products/MimetypesRegistry/tests/test_magic.py
@@ -1,7 +1,9 @@
+# -*- coding: utf-8 -*-
 from .utils import input_file_path
+from plone.app.testing.bbb import PloneTestCase as ATSiteTestCase
 from Products.CMFCore.utils import getToolByName
 from Products.MimetypesRegistry.mime_types.magic import guessMime
-from plone.app.testing.bbb import PloneTestCase as ATSiteTestCase
+
 
 samplefiles = [
     ('OOoWriter', 'application/vnd.sun.xml.writer'),
diff --git a/Products/MimetypesRegistry/tests/test_mimetypes.py b/Products/MimetypesRegistry/tests/test_mimetypes.py
index 9e2268e..f5172bd 100644
--- a/Products/MimetypesRegistry/tests/test_mimetypes.py
+++ b/Products/MimetypesRegistry/tests/test_mimetypes.py
@@ -1,9 +1,10 @@
+# -*- coding: utf-8 -*-
 from .utils import input_file_path
+from plone.app.testing.bbb import PloneTestCase as ATSiteTestCase
 from Products.CMFCore.utils import getToolByName
 from Products.MimetypesRegistry.mime_types import application_octet_stream
 from Products.MimetypesRegistry.mime_types import text_plain
 from Products.MimetypesRegistry.mime_types import text_xml
-from plone.app.testing.bbb import PloneTestCase as ATSiteTestCase
 
 
 class TestMimeTypesclass(ATSiteTestCase):
diff --git a/Products/MimetypesRegistry/tests/utils.py b/Products/MimetypesRegistry/tests/utils.py
index c6d73c4..205923f 100644
--- a/Products/MimetypesRegistry/tests/utils.py
+++ b/Products/MimetypesRegistry/tests/utils.py
@@ -1,7 +1,9 @@
+# -*- coding: utf-8 -*-
 from os.path import abspath
 from os.path import basename
 from os.path import dirname
 from os.path import join
+
 import glob
 import re
 
diff --git a/Products/__init__.py b/Products/__init__.py
index f48ad10..85880ef 100644
--- a/Products/__init__.py
+++ b/Products/__init__.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 # See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
 try:
     __import__('pkg_resources').declare_namespace(__name__)
diff --git a/README.rst b/README.rst
index d76f57c..cbd7e8c 100644
--- a/README.rst
+++ b/README.rst
@@ -2,35 +2,29 @@
 Mimetypes Registry
 ==================
 
-Provide a registry of mimetypes, accessible via the ``mimetypes_registry``
-tool. 
+Provide a registry of mimetypes, accessible via the ``mimetypes_registry`` tool.
 
 
 Upgrade from older versions
 ===========================
 
-If you want to use the updated mimetypes registry database from the version
-after 2.0.6 and you don't have important customizations you need to keep, just
-delete the old ``mimetypes_registry`` tool from ZMI and import all steps from
-the ``MimetypesRegistry`` profile.
+If you want to use the updated mimetypes registry database from the version after 2.0.6 and you don't have important customizations you need to keep,
+just delete the old ``mimetypes_registry`` tool from ZMI and import all steps from the ``MimetypesRegistry`` profile.
 
 
 How to update the mimetypes registry from freedesktop.org
 =========================================================
 
-1) Clone the ``shared-mime-info`` repository from freedesktop.org::
+1) Download the latest release from freesdesktops org `shared mime info project page <https://freedesktop.org/wiki/Software/shared-mime-info/>`_.
 
-    $ git clone git://anongit.freedesktop.org/xdg/shared-mime-info
+2) Unpack the tarball
 
-2) Build it::
+3) Copy the ``freedesktop.org.xml`` file to Products.MimetypesRegistry's
+   ``mime_types`` folder.
 
-    $ cd shared-mime-info
-    $ ./autogen.sh
-    $ ./configure 
-    $ make
+4) Add a note to the change log ``CHANGES.rst``.
 
-3) Copy the ``freedesktop.org.xml`` file to Products.MimetypesRegistry's
-   ``mime_type`` folder.
+5) Push to a branch and create a pull request.
 
 
 Authors
diff --git a/bootstrap.py b/bootstrap.py
index a629566..1a5e5d5 100644
--- a/bootstrap.py
+++ b/bootstrap.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 ##############################################################################
 #
 # Copyright (c) 2006 Zope Foundation and Contributors.
diff --git a/setup.cfg b/setup.cfg
new file mode 100644
index 0000000..35fdb6d
--- /dev/null
+++ b/setup.cfg
@@ -0,0 +1,11 @@
+[check-manifest]
+ignore =
+    *.cfg
+    bootstrap.py
+
+[isort]
+force_alphabetical_sort=True
+force_single_line=True
+lines_after_imports=2
+line_length=200
+not_skip=__init__.py
diff --git a/setup.py b/setup.py
index fe04beb..3023ae1 100644
--- a/setup.py
+++ b/setup.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from setuptools import find_packages
 from setuptools import setup
 
@@ -13,9 +14,6 @@
         "Framework :: Zope2",
         "Operating System :: OS Independent",
         "Framework :: Plone",
-        "Framework :: Plone :: 4.0",
-        "Framework :: Plone :: 4.1",
-        "Framework :: Plone :: 4.2",
         "Framework :: Plone :: 4.3",
         "Framework :: Plone :: 5.0",
         "Framework :: Plone :: 5.1",
@@ -32,18 +30,20 @@
     namespace_packages=['Products'],
     include_package_data=True,
     zip_safe=False,
-    extras_require=dict(
-        test=[
-            'plone.app.testing',
-        ]
-    ),
     install_requires=[
+        'AccessControl>=3.0.0'
+        'Acquisition',
+        'Products.CMFCore',
         'setuptools',
+        'ZODB3',
         'zope.contenttype',
+        'zope.deferredimport',
         'zope.interface',
-        'Products.CMFCore',
-        'Acquisition',
-        'ZODB3',
         'Zope2',
     ],
+    extras_require=dict(
+        test=[
+            'plone.app.testing',
+        ]
+    ),
 )


