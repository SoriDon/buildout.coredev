Repository: plone.app.theming


Branch: refs/heads/master
Date: 2022-10-02T20:13:33+02:00
Author: petschki (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.theming/commit/c0f31d99fe1175217b264e67c15beb17c50c4a5a

Also update path of `tinymce-styles-css` on copy

Files changed:
M src/plone/app/theming/utils.py

b"diff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py\nindex e494e24..d58355c 100644\n--- a/src/plone/app/theming/utils.py\n+++ b/src/plone/app/theming/utils.py\n@@ -638,7 +638,7 @@ def createThemeFromTemplate(title, description, baseOn='template'):\n         manifest.set('theme', 'rules', rules)\n \n     paths_to_fix = ['development-css', 'production-css', 'tinymce-content-css',\n-                    'development-js', 'production-js']\n+                    'tinymce-styles-css', 'development-js', 'production-js']\n     for var_path in paths_to_fix:\n         if not manifest.has_option('theme', var_path):\n             continue\n"

Repository: plone.app.theming


Branch: refs/heads/master
Date: 2022-10-02T20:13:53+02:00
Author: petschki (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.theming/commit/eb4250e1c1071d1bcbb71dcbda37afb73467868d

update tests

Files changed:
M src/plone/app/theming/tests/another-theme/manifest.cfg
M src/plone/app/theming/tests/secondary-theme/manifest.cfg
M src/plone/app/theming/tests/test_utils.py

b'diff --git a/src/plone/app/theming/tests/another-theme/manifest.cfg b/src/plone/app/theming/tests/another-theme/manifest.cfg\nindex 218a9b08..3057cdfb 100644\n--- a/src/plone/app/theming/tests/another-theme/manifest.cfg\n+++ b/src/plone/app/theming/tests/another-theme/manifest.cfg\n@@ -8,9 +8,10 @@ rules = ++theme++another-test-theme/rules.xml\n enabled-bundles = plone\n disabled-bundles = foobar\n \n-development-css = ++theme++another-theme/less/barceloneta.plone.less\n-production-css = ++theme++another-theme/less/barceloneta-compiled.css\n-tinymce-content-css = ++theme++another-theme/less/barceloneta-compiled.css\n+development-css = ++theme++another-theme/css/barceloneta.css\n+production-css = ++theme++another-theme/css/barceloneta.min.css\n+tinymce-content-css = ++theme++another-theme/css/barceloneta.min.css\n+tinymce-styles-css = ++theme++another-theme/css/custom-format-styles.css\n \n development-js = ++theme++another-theme/script.js\n production-js = ++theme++another-theme/script.min.js\ndiff --git a/src/plone/app/theming/tests/secondary-theme/manifest.cfg b/src/plone/app/theming/tests/secondary-theme/manifest.cfg\nindex 388410f6..70e77207 100644\n--- a/src/plone/app/theming/tests/secondary-theme/manifest.cfg\n+++ b/src/plone/app/theming/tests/secondary-theme/manifest.cfg\n@@ -8,9 +8,10 @@ rules = /++theme++secondary-test-theme/rules.xml\n enabled-bundles = plone\n disabled-bundles = foobar\n \n-development-css = /++theme++secondary-theme/less/barceloneta.plone.less\n-production-css = /++theme++secondary-theme/less/barceloneta-compiled.css\n-tinymce-content-css = /++theme++secondary-theme/less/barceloneta-compiled.css\n+development-css = /++theme++secondary-theme/css/barceloneta.css\n+production-css = /++theme++secondary-theme/css/barceloneta.min.css\n+tinymce-content-css = /++theme++secondary-theme/css/barceloneta.min.css\n+tinymce-styles-css = /++theme++secondary-theme/css/custom-format-styles.css\n \n development-js = /++theme++secondary-theme/script.js\n production-js = /++theme++secondary-theme/script.min.js\ndiff --git a/src/plone/app/theming/tests/test_utils.py b/src/plone/app/theming/tests/test_utils.py\nindex cd6ddf86..2924f7a0 100644\n--- a/src/plone/app/theming/tests/test_utils.py\n+++ b/src/plone/app/theming/tests/test_utils.py\n@@ -242,15 +242,20 @@ def test_createThemeFromTemplate_custom_prefix(self):\n         self.assertEqual(theme.enabled_bundles, [\'plone\'])\n         self.assertEqual(theme.disabled_bundles, [\'foobar\'])\n \n-        expected_dev_css = u"/++%s++%s/less/barceloneta.plone.less" % (\n+        expected_dev_css = u"/++%s++%s/css/barceloneta.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n-        expected_prod_css = u"/++%s++%s/less/barceloneta-compiled.css" % (\n+        expected_prod_css = u"/++%s++%s/css/barceloneta.min.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n-        expected_tinymce = u"/++%s++%s/less/barceloneta-compiled.css" % (\n+        expected_tinymce_content_css = u"/++%s++%s/css/barceloneta.min.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n+        expected_tinymce_styles_css = (\n+            u"/++%s++%s/css/custom-format-styles.css" % (\n+                THEME_RESOURCE_NAME, title.replace(" ", "-"))\n+        )\n         self.assertEqual(theme.development_css, expected_dev_css)\n         self.assertEqual(theme.production_css, expected_prod_css)\n-        self.assertEqual(theme.tinymce_content_css, expected_tinymce)\n+        self.assertEqual(theme.tinymce_content_css, expected_tinymce_content_css)\n+        self.assertEqual(theme.tinymce_styles_css, expected_tinymce_styles_css)\n \n         expected_dev_js = u"/++%s++%s/script.js" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n@@ -285,15 +290,20 @@ def test_createThemeFromTemplate_rel_path(self):\n         self.assertEqual(theme.enabled_bundles, [\'plone\'])\n         self.assertEqual(theme.disabled_bundles, [\'foobar\'])\n \n-        expected_dev_css = u"++%s++%s/less/barceloneta.plone.less" % (\n+        expected_dev_css = u"++%s++%s/css/barceloneta.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n-        expected_prod_css = u"++%s++%s/less/barceloneta-compiled.css" % (\n+        expected_prod_css = u"++%s++%s/css/barceloneta.min.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n-        expected_tinymce = u"++%s++%s/less/barceloneta-compiled.css" % (\n+        expected_tinymce_content_css = u"++%s++%s/css/barceloneta.min.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n+        expected_tinymce_styles_css = (\n+            u"++%s++%s/css/custom-format-styles.css" % (\n+                THEME_RESOURCE_NAME, title.replace(" ", "-"))\n+        )\n         self.assertEqual(theme.development_css, expected_dev_css)\n         self.assertEqual(theme.production_css, expected_prod_css)\n-        self.assertEqual(theme.tinymce_content_css, expected_tinymce)\n+        self.assertEqual(theme.tinymce_content_css, expected_tinymce_content_css)\n+        self.assertEqual(theme.tinymce_styles_css, expected_tinymce_styles_css)\n \n         expected_dev_js = u"++%s++%s/script.js" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n'

Repository: plone.app.theming


Branch: refs/heads/master
Date: 2022-10-02T20:14:04+02:00
Author: petschki (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.theming/commit/76d27d5136ae34936759c74469542578901f7c13

update documentation

Files changed:
M src/plone/app/theming/browser/resources/userguide.rst

b'diff --git a/src/plone/app/theming/browser/resources/userguide.rst b/src/plone/app/theming/browser/resources/userguide.rst\nindex da05fc4..fe2a911 100644\n--- a/src/plone/app/theming/browser/resources/userguide.rst\n+++ b/src/plone/app/theming/browser/resources/userguide.rst\n@@ -452,11 +452,12 @@ This file may look like this::\n     preview = preview.png\n     enabled-bundles = mybundle\n     disabled-bundles = plone\n-    development-css = /++theme++barceloneta/less/barceloneta.plone.less\n-    production-css = /++theme++barceloneta/less/barceloneta-compiled.css\n+    development-css = /++theme++barceloneta/css/barceloneta.css\n+    production-css = /++theme++barceloneta/css/barceloneta.min.css\n     development-js = /++theme++barceloneta/barceloneta.js\n     production-js = /++theme++barceloneta/barceloneta.min.js\n-    tinymce-content-css = /++theme++barceloneta/tinymce-styles.css\n+    tinymce-content-css = /++theme++barceloneta/barceloneta.min.css\n+    tinymce-styles-css = /++theme++barceloneta/custom-styles.css\n \n \n As shown here, the manifest file can be used to provide a more user friendly\n'

Repository: plone.app.theming


Branch: refs/heads/master
Date: 2022-10-02T20:15:26+02:00
Author: petschki (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.theming/commit/948aca7ce10b5af31fb0b1a187008b3ddfc08388

changenote

Files changed:
A news/214.bugfix

b'diff --git a/news/214.bugfix b/news/214.bugfix\nnew file mode 100644\nindex 00000000..34320526\n--- /dev/null\n+++ b/news/214.bugfix\n@@ -0,0 +1,2 @@\n+Fix for `tinymce-styles-css` when copying theme.\n+[petschki]\n'

Repository: plone.app.theming


Branch: refs/heads/master
Date: 2022-10-04T22:20:13+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.theming/commit/b294d3dac26634ba530f545b8c5f157946da29f3

Merge pull request #214 from plone/petschki-update-utils

Fix for `tinymce-styles-css` path when copying theme

Files changed:
A news/214.bugfix
M src/plone/app/theming/browser/resources/userguide.rst
M src/plone/app/theming/tests/another-theme/manifest.cfg
M src/plone/app/theming/tests/secondary-theme/manifest.cfg
M src/plone/app/theming/tests/test_utils.py
M src/plone/app/theming/utils.py

b'diff --git a/news/214.bugfix b/news/214.bugfix\nnew file mode 100644\nindex 00000000..34320526\n--- /dev/null\n+++ b/news/214.bugfix\n@@ -0,0 +1,2 @@\n+Fix for `tinymce-styles-css` when copying theme.\n+[petschki]\ndiff --git a/src/plone/app/theming/browser/resources/userguide.rst b/src/plone/app/theming/browser/resources/userguide.rst\nindex da05fc47..fe2a9119 100644\n--- a/src/plone/app/theming/browser/resources/userguide.rst\n+++ b/src/plone/app/theming/browser/resources/userguide.rst\n@@ -452,11 +452,12 @@ This file may look like this::\n     preview = preview.png\n     enabled-bundles = mybundle\n     disabled-bundles = plone\n-    development-css = /++theme++barceloneta/less/barceloneta.plone.less\n-    production-css = /++theme++barceloneta/less/barceloneta-compiled.css\n+    development-css = /++theme++barceloneta/css/barceloneta.css\n+    production-css = /++theme++barceloneta/css/barceloneta.min.css\n     development-js = /++theme++barceloneta/barceloneta.js\n     production-js = /++theme++barceloneta/barceloneta.min.js\n-    tinymce-content-css = /++theme++barceloneta/tinymce-styles.css\n+    tinymce-content-css = /++theme++barceloneta/barceloneta.min.css\n+    tinymce-styles-css = /++theme++barceloneta/custom-styles.css\n \n \n As shown here, the manifest file can be used to provide a more user friendly\ndiff --git a/src/plone/app/theming/tests/another-theme/manifest.cfg b/src/plone/app/theming/tests/another-theme/manifest.cfg\nindex 218a9b08..3057cdfb 100644\n--- a/src/plone/app/theming/tests/another-theme/manifest.cfg\n+++ b/src/plone/app/theming/tests/another-theme/manifest.cfg\n@@ -8,9 +8,10 @@ rules = ++theme++another-test-theme/rules.xml\n enabled-bundles = plone\n disabled-bundles = foobar\n \n-development-css = ++theme++another-theme/less/barceloneta.plone.less\n-production-css = ++theme++another-theme/less/barceloneta-compiled.css\n-tinymce-content-css = ++theme++another-theme/less/barceloneta-compiled.css\n+development-css = ++theme++another-theme/css/barceloneta.css\n+production-css = ++theme++another-theme/css/barceloneta.min.css\n+tinymce-content-css = ++theme++another-theme/css/barceloneta.min.css\n+tinymce-styles-css = ++theme++another-theme/css/custom-format-styles.css\n \n development-js = ++theme++another-theme/script.js\n production-js = ++theme++another-theme/script.min.js\ndiff --git a/src/plone/app/theming/tests/secondary-theme/manifest.cfg b/src/plone/app/theming/tests/secondary-theme/manifest.cfg\nindex 388410f6..70e77207 100644\n--- a/src/plone/app/theming/tests/secondary-theme/manifest.cfg\n+++ b/src/plone/app/theming/tests/secondary-theme/manifest.cfg\n@@ -8,9 +8,10 @@ rules = /++theme++secondary-test-theme/rules.xml\n enabled-bundles = plone\n disabled-bundles = foobar\n \n-development-css = /++theme++secondary-theme/less/barceloneta.plone.less\n-production-css = /++theme++secondary-theme/less/barceloneta-compiled.css\n-tinymce-content-css = /++theme++secondary-theme/less/barceloneta-compiled.css\n+development-css = /++theme++secondary-theme/css/barceloneta.css\n+production-css = /++theme++secondary-theme/css/barceloneta.min.css\n+tinymce-content-css = /++theme++secondary-theme/css/barceloneta.min.css\n+tinymce-styles-css = /++theme++secondary-theme/css/custom-format-styles.css\n \n development-js = /++theme++secondary-theme/script.js\n production-js = /++theme++secondary-theme/script.min.js\ndiff --git a/src/plone/app/theming/tests/test_utils.py b/src/plone/app/theming/tests/test_utils.py\nindex cd6ddf86..2924f7a0 100644\n--- a/src/plone/app/theming/tests/test_utils.py\n+++ b/src/plone/app/theming/tests/test_utils.py\n@@ -242,15 +242,20 @@ def test_createThemeFromTemplate_custom_prefix(self):\n         self.assertEqual(theme.enabled_bundles, [\'plone\'])\n         self.assertEqual(theme.disabled_bundles, [\'foobar\'])\n \n-        expected_dev_css = u"/++%s++%s/less/barceloneta.plone.less" % (\n+        expected_dev_css = u"/++%s++%s/css/barceloneta.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n-        expected_prod_css = u"/++%s++%s/less/barceloneta-compiled.css" % (\n+        expected_prod_css = u"/++%s++%s/css/barceloneta.min.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n-        expected_tinymce = u"/++%s++%s/less/barceloneta-compiled.css" % (\n+        expected_tinymce_content_css = u"/++%s++%s/css/barceloneta.min.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n+        expected_tinymce_styles_css = (\n+            u"/++%s++%s/css/custom-format-styles.css" % (\n+                THEME_RESOURCE_NAME, title.replace(" ", "-"))\n+        )\n         self.assertEqual(theme.development_css, expected_dev_css)\n         self.assertEqual(theme.production_css, expected_prod_css)\n-        self.assertEqual(theme.tinymce_content_css, expected_tinymce)\n+        self.assertEqual(theme.tinymce_content_css, expected_tinymce_content_css)\n+        self.assertEqual(theme.tinymce_styles_css, expected_tinymce_styles_css)\n \n         expected_dev_js = u"/++%s++%s/script.js" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n@@ -285,15 +290,20 @@ def test_createThemeFromTemplate_rel_path(self):\n         self.assertEqual(theme.enabled_bundles, [\'plone\'])\n         self.assertEqual(theme.disabled_bundles, [\'foobar\'])\n \n-        expected_dev_css = u"++%s++%s/less/barceloneta.plone.less" % (\n+        expected_dev_css = u"++%s++%s/css/barceloneta.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n-        expected_prod_css = u"++%s++%s/less/barceloneta-compiled.css" % (\n+        expected_prod_css = u"++%s++%s/css/barceloneta.min.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n-        expected_tinymce = u"++%s++%s/less/barceloneta-compiled.css" % (\n+        expected_tinymce_content_css = u"++%s++%s/css/barceloneta.min.css" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\n+        expected_tinymce_styles_css = (\n+            u"++%s++%s/css/custom-format-styles.css" % (\n+                THEME_RESOURCE_NAME, title.replace(" ", "-"))\n+        )\n         self.assertEqual(theme.development_css, expected_dev_css)\n         self.assertEqual(theme.production_css, expected_prod_css)\n-        self.assertEqual(theme.tinymce_content_css, expected_tinymce)\n+        self.assertEqual(theme.tinymce_content_css, expected_tinymce_content_css)\n+        self.assertEqual(theme.tinymce_styles_css, expected_tinymce_styles_css)\n \n         expected_dev_js = u"++%s++%s/script.js" % (\n             THEME_RESOURCE_NAME, title.replace(" ", "-"))\ndiff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py\nindex e494e242..d58355c9 100644\n--- a/src/plone/app/theming/utils.py\n+++ b/src/plone/app/theming/utils.py\n@@ -638,7 +638,7 @@ def createThemeFromTemplate(title, description, baseOn=\'template\'):\n         manifest.set(\'theme\', \'rules\', rules)\n \n     paths_to_fix = [\'development-css\', \'production-css\', \'tinymce-content-css\',\n-                    \'development-js\', \'production-js\']\n+                    \'tinymce-styles-css\', \'development-js\', \'production-js\']\n     for var_path in paths_to_fix:\n         if not manifest.has_option(\'theme\', var_path):\n             continue\n'

