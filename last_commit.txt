Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-04-15T11:01:34+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/2732cd643061befc5b7e5c7c6c0eb03dba98ceb7

pythonify default-variables in main_template

Files changed:
M Products/CMFPlone/browser/templates/main_template.pt

b'diff --git a/Products/CMFPlone/browser/templates/main_template.pt b/Products/CMFPlone/browser/templates/main_template.pt\nindex 2b1d3915a..4f8a6cce6 100644\n--- a/Products/CMFPlone/browser/templates/main_template.pt\n+++ b/Products/CMFPlone/browser/templates/main_template.pt\n@@ -5,17 +5,17 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:define="portal_state context/@@plone_portal_state;\n-          context_state context/@@plone_context_state;\n-          plone_view context/@@plone;\n-          plone_layout context/@@plone_layout;\n-          lang portal_state/language;\n+      tal:define="portal_state python:context.restrictedTraverse(\'@@plone_portal_state\');\n+          context_state python:context.restrictedTraverse(\'@@plone_context_state\');\n+          plone_view python:context.restrictedTraverse(\'@@plone\');\n+          plone_layout python:context.restrictedTraverse(\'@@plone_layout\');\n+          lang python:portal_state.language();\n           view nocall:view | nocall: plone_view;\n           dummy python: plone_layout.mark_view(view);\n-          portal_url portal_state/portal_url;\n-          checkPermission nocall: context/portal_membership/checkPermission;\n-          site_properties context/portal_properties/site_properties;\n-          ajax_include_head request/ajax_include_head | nothing;\n+          portal_url python:portal_state.portal_url();\n+          checkPermission python:context.restrictedTraverse(\'portal_membership\').checkPermission;\n+          site_properties python:context.restrictedTraverse(\'portal_properties\').site_properties;\n+          ajax_include_head python:request.get(\'ajax_include_head\', False);\n           ajax_load python:False;"\n       i18n:domain="plone"\n       tal:attributes="lang lang;">\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-04-15T11:09:05+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/f244a0517047e6d0b8079e51c0e23126c8a8fe7f

speed up acquiring the main_template in templates
using "python:context.restrictedTraverse('@@main_template').macros['master']" is not possible because ttw-customized templates do not allow that

Files changed:
M Products/CMFPlone/browser/login/templates/forced_password_change.pt
M Products/CMFPlone/browser/login/templates/initial_login_password_change.pt
M Products/CMFPlone/browser/login/templates/insufficient_privileges.pt
M Products/CMFPlone/browser/login/templates/logged_out.pt
M Products/CMFPlone/browser/login/templates/mail_password_form.pt
M Products/CMFPlone/browser/login/templates/mail_password_response.pt
M Products/CMFPlone/browser/login/templates/pwreset_expired.pt
M Products/CMFPlone/browser/login/templates/pwreset_finish.pt
M Products/CMFPlone/browser/login/templates/pwreset_form.pt
M Products/CMFPlone/browser/login/templates/pwreset_invalid.pt
M Products/CMFPlone/browser/templates/accessibility-info.pt
M Products/CMFPlone/browser/templates/author.pt
M Products/CMFPlone/browser/templates/contact-info.pt
M Products/CMFPlone/browser/templates/error_message.pt
M Products/CMFPlone/browser/templates/five_template.pt
M Products/CMFPlone/browser/templates/search.pt
M Products/CMFPlone/browser/templates/send_feedback_confirm.pt
M Products/CMFPlone/browser/templates/sitemap.pt
M Products/CMFPlone/skins/plone_prefs/prefs_main_template.pt
M Products/CMFPlone/skins/plone_templates/index_html.pt
M Products/CMFPlone/skins/plone_templates/recently_modified.pt
M Products/CMFPlone/skins/plone_templates/recently_published.pt
M Products/CMFPlone/skins/plone_templates/test_rendering.pt

b'diff --git a/Products/CMFPlone/browser/login/templates/forced_password_change.pt b/Products/CMFPlone/browser/login/templates/forced_password_change.pt\nindex d7e90e358..bc40b50ab 100644\n--- a/Products/CMFPlone/browser/login/templates/forced_password_change.pt\n+++ b/Products/CMFPlone/browser/login/templates/forced_password_change.pt\n@@ -3,7 +3,7 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       i18n:domain="plone"\n-      metal:use-macro="context/main_template/macros/master">\n+      metal:use-macro="context/@@main_template/macros/master">\n \n   <metal:title fill-slot="content-title">\n     <h1 class="documentFirstHeading"\ndiff --git a/Products/CMFPlone/browser/login/templates/initial_login_password_change.pt b/Products/CMFPlone/browser/login/templates/initial_login_password_change.pt\nindex 51d54a454..468d24feb 100644\n--- a/Products/CMFPlone/browser/login/templates/initial_login_password_change.pt\n+++ b/Products/CMFPlone/browser/login/templates/initial_login_password_change.pt\n@@ -3,7 +3,7 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       i18n:domain="plone"\n-      metal:use-macro="context/main_template/macros/master">\n+      metal:use-macro="context/@@main_template/macros/master">\n \n   <metal:title fill-slot="content-title">\n     <h1 class="documentFirstHeading"\ndiff --git a/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt b/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt\nindex 107aa2ba8..dc0b859b7 100644\n--- a/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt\n+++ b/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/browser/login/templates/logged_out.pt b/Products/CMFPlone/browser/login/templates/logged_out.pt\nindex c6778e9b3..78ff9004b 100644\n--- a/Products/CMFPlone/browser/login/templates/logged_out.pt\n+++ b/Products/CMFPlone/browser/login/templates/logged_out.pt\n@@ -2,7 +2,7 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/browser/login/templates/mail_password_form.pt b/Products/CMFPlone/browser/login/templates/mail_password_form.pt\nindex e597411f8..da457d9d2 100644\n--- a/Products/CMFPlone/browser/login/templates/mail_password_form.pt\n+++ b/Products/CMFPlone/browser/login/templates/mail_password_form.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/login/templates/mail_password_response.pt b/Products/CMFPlone/browser/login/templates/mail_password_response.pt\nindex c8c601967..10f2d73cc 100644\n--- a/Products/CMFPlone/browser/login/templates/mail_password_response.pt\n+++ b/Products/CMFPlone/browser/login/templates/mail_password_response.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/login/templates/pwreset_expired.pt b/Products/CMFPlone/browser/login/templates/pwreset_expired.pt\nindex e2e1c1c64..061a399ad 100644\n--- a/Products/CMFPlone/browser/login/templates/pwreset_expired.pt\n+++ b/Products/CMFPlone/browser/login/templates/pwreset_expired.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/login/templates/pwreset_finish.pt b/Products/CMFPlone/browser/login/templates/pwreset_finish.pt\nindex bfc05a128..6fb4a4c1a 100644\n--- a/Products/CMFPlone/browser/login/templates/pwreset_finish.pt\n+++ b/Products/CMFPlone/browser/login/templates/pwreset_finish.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/login/templates/pwreset_form.pt b/Products/CMFPlone/browser/login/templates/pwreset_form.pt\nindex 46dda3f39..5a49dd805 100644\n--- a/Products/CMFPlone/browser/login/templates/pwreset_form.pt\n+++ b/Products/CMFPlone/browser/login/templates/pwreset_form.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/login/templates/pwreset_invalid.pt b/Products/CMFPlone/browser/login/templates/pwreset_invalid.pt\nindex 1be9f9f26..f6b7cca79 100644\n--- a/Products/CMFPlone/browser/login/templates/pwreset_invalid.pt\n+++ b/Products/CMFPlone/browser/login/templates/pwreset_invalid.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/templates/accessibility-info.pt b/Products/CMFPlone/browser/templates/accessibility-info.pt\nindex 3806baa2e..f7b350eab 100644\n--- a/Products/CMFPlone/browser/templates/accessibility-info.pt\n+++ b/Products/CMFPlone/browser/templates/accessibility-info.pt\n@@ -3,7 +3,7 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <body>\ndiff --git a/Products/CMFPlone/browser/templates/author.pt b/Products/CMFPlone/browser/templates/author.pt\nindex d4b15dc6e..7edf51c99 100644\n--- a/Products/CMFPlone/browser/templates/author.pt\n+++ b/Products/CMFPlone/browser/templates/author.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/browser/templates/contact-info.pt b/Products/CMFPlone/browser/templates/contact-info.pt\nindex a43024deb..4329ff3c4 100644\n--- a/Products/CMFPlone/browser/templates/contact-info.pt\n+++ b/Products/CMFPlone/browser/templates/contact-info.pt\n@@ -2,7 +2,7 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/browser/templates/error_message.pt b/Products/CMFPlone/browser/templates/error_message.pt\nindex d73e88d70..d1d7be29b 100644\n--- a/Products/CMFPlone/browser/templates/error_message.pt\n+++ b/Products/CMFPlone/browser/templates/error_message.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <body>\ndiff --git a/Products/CMFPlone/browser/templates/five_template.pt b/Products/CMFPlone/browser/templates/five_template.pt\nindex 6110d6620..5ccbd857b 100644\n--- a/Products/CMFPlone/browser/templates/five_template.pt\n+++ b/Products/CMFPlone/browser/templates/five_template.pt\n@@ -1,5 +1,5 @@\n <metal:macro metal:define-macro="page"\n-><html metal:use-macro="context/main_template/macros/master">\n+><html metal:use-macro="context/@@main_template/macros/master">\n <head>\n <metal:slot metal:fill-slot="style_slot"\n ><metal:slot metal:define-slot="style_slot" /></metal:slot>\ndiff --git a/Products/CMFPlone/browser/templates/search.pt b/Products/CMFPlone/browser/templates/search.pt\nindex aa05139b7..bf307ee2d 100644\n--- a/Products/CMFPlone/browser/templates/search.pt\n+++ b/Products/CMFPlone/browser/templates/search.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/browser/templates/send_feedback_confirm.pt b/Products/CMFPlone/browser/templates/send_feedback_confirm.pt\nindex 4246f4353..99c5de6ec 100644\n--- a/Products/CMFPlone/browser/templates/send_feedback_confirm.pt\n+++ b/Products/CMFPlone/browser/templates/send_feedback_confirm.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\n@@ -19,7 +19,7 @@\n         i18n:translate="heading_send_feedback_confirm">\n         Site Administrator has been contacted.\n     </h1>\n-\t\n+\n     <div class="documentDescription" i18n:translate="message_send_feedback_confirm">\n         A mail has now been sent to the site administrator regarding your\n         questions and/or comments.\ndiff --git a/Products/CMFPlone/browser/templates/sitemap.pt b/Products/CMFPlone/browser/templates/sitemap.pt\nindex b773d1f7b..d9d21ce6c 100644\n--- a/Products/CMFPlone/browser/templates/sitemap.pt\n+++ b/Products/CMFPlone/browser/templates/sitemap.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/skins/plone_prefs/prefs_main_template.pt b/Products/CMFPlone/skins/plone_prefs/prefs_main_template.pt\nindex 0d36e82d4..a53478e32 100644\n--- a/Products/CMFPlone/skins/plone_prefs/prefs_main_template.pt\n+++ b/Products/CMFPlone/skins/plone_prefs/prefs_main_template.pt\n@@ -1,5 +1,5 @@\n <metal:page define-macro="master">\n-  <tal:block metal:use-macro="context/main_template/macros/master">\n+  <tal:block metal:use-macro="context/@@main_template/macros/master">\n \n     <metal:block fill-slot="top_slot">\n         <metal:override define-slot="top_slot">\n@@ -21,7 +21,7 @@\n         <metal:slot define-slot="prefs_configlet_wrapper">\n           <metal:slot define-slot="prefs_configlet_content">\n \n-            <metal:block metal:use-macro="context/main_template/macros/content">\n+            <metal:block metal:use-macro="context/@@main_template/macros/content">\n               <metal:override metal:fill-slot="main">\n                 <metal:slot metal:define-slot="prefs_configlet_main" tal:content="nothing">\n                   Page body text\ndiff --git a/Products/CMFPlone/skins/plone_templates/index_html.pt b/Products/CMFPlone/skins/plone_templates/index_html.pt\nindex 7b5e09fb7..bceba801f 100644\n--- a/Products/CMFPlone/skins/plone_templates/index_html.pt\n+++ b/Products/CMFPlone/skins/plone_templates/index_html.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <body>\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_modified.pt b/Products/CMFPlone/skins/plone_templates/recently_modified.pt\nindex 50833f331..7ee649e25 100644\n--- a/Products/CMFPlone/skins/plone_templates/recently_modified.pt\n+++ b/Products/CMFPlone/skins/plone_templates/recently_modified.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <metal:block fill-slot="top_slot"\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_published.pt b/Products/CMFPlone/skins/plone_templates/recently_published.pt\nindex 568603493..cccd879ec 100644\n--- a/Products/CMFPlone/skins/plone_templates/recently_published.pt\n+++ b/Products/CMFPlone/skins/plone_templates/recently_published.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <metal:block fill-slot="top_slot"\ndiff --git a/Products/CMFPlone/skins/plone_templates/test_rendering.pt b/Products/CMFPlone/skins/plone_templates/test_rendering.pt\nindex 37db1de48..a44a0a5d5 100644\n--- a/Products/CMFPlone/skins/plone_templates/test_rendering.pt\n+++ b/Products/CMFPlone/skins/plone_templates/test_rendering.pt\n@@ -5,7 +5,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <body>\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-04-15T16:22:42+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/a36bee347845835203e9d538134e9b4d9f527bff

Merge pull request #2839 from plone/pythonify_templates

Pythonify templates

Files changed:
M Products/CMFPlone/browser/login/templates/forced_password_change.pt
M Products/CMFPlone/browser/login/templates/initial_login_password_change.pt
M Products/CMFPlone/browser/login/templates/insufficient_privileges.pt
M Products/CMFPlone/browser/login/templates/logged_out.pt
M Products/CMFPlone/browser/login/templates/mail_password_form.pt
M Products/CMFPlone/browser/login/templates/mail_password_response.pt
M Products/CMFPlone/browser/login/templates/pwreset_expired.pt
M Products/CMFPlone/browser/login/templates/pwreset_finish.pt
M Products/CMFPlone/browser/login/templates/pwreset_form.pt
M Products/CMFPlone/browser/login/templates/pwreset_invalid.pt
M Products/CMFPlone/browser/templates/accessibility-info.pt
M Products/CMFPlone/browser/templates/author.pt
M Products/CMFPlone/browser/templates/contact-info.pt
M Products/CMFPlone/browser/templates/error_message.pt
M Products/CMFPlone/browser/templates/five_template.pt
M Products/CMFPlone/browser/templates/main_template.pt
M Products/CMFPlone/browser/templates/search.pt
M Products/CMFPlone/browser/templates/send_feedback_confirm.pt
M Products/CMFPlone/browser/templates/sitemap.pt
M Products/CMFPlone/skins/plone_prefs/prefs_main_template.pt
M Products/CMFPlone/skins/plone_templates/index_html.pt
M Products/CMFPlone/skins/plone_templates/recently_modified.pt
M Products/CMFPlone/skins/plone_templates/recently_published.pt
M Products/CMFPlone/skins/plone_templates/test_rendering.pt

b'diff --git a/Products/CMFPlone/browser/login/templates/forced_password_change.pt b/Products/CMFPlone/browser/login/templates/forced_password_change.pt\nindex d7e90e358..bc40b50ab 100644\n--- a/Products/CMFPlone/browser/login/templates/forced_password_change.pt\n+++ b/Products/CMFPlone/browser/login/templates/forced_password_change.pt\n@@ -3,7 +3,7 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       i18n:domain="plone"\n-      metal:use-macro="context/main_template/macros/master">\n+      metal:use-macro="context/@@main_template/macros/master">\n \n   <metal:title fill-slot="content-title">\n     <h1 class="documentFirstHeading"\ndiff --git a/Products/CMFPlone/browser/login/templates/initial_login_password_change.pt b/Products/CMFPlone/browser/login/templates/initial_login_password_change.pt\nindex 51d54a454..468d24feb 100644\n--- a/Products/CMFPlone/browser/login/templates/initial_login_password_change.pt\n+++ b/Products/CMFPlone/browser/login/templates/initial_login_password_change.pt\n@@ -3,7 +3,7 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       i18n:domain="plone"\n-      metal:use-macro="context/main_template/macros/master">\n+      metal:use-macro="context/@@main_template/macros/master">\n \n   <metal:title fill-slot="content-title">\n     <h1 class="documentFirstHeading"\ndiff --git a/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt b/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt\nindex 107aa2ba8..dc0b859b7 100644\n--- a/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt\n+++ b/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/browser/login/templates/logged_out.pt b/Products/CMFPlone/browser/login/templates/logged_out.pt\nindex c6778e9b3..78ff9004b 100644\n--- a/Products/CMFPlone/browser/login/templates/logged_out.pt\n+++ b/Products/CMFPlone/browser/login/templates/logged_out.pt\n@@ -2,7 +2,7 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/browser/login/templates/mail_password_form.pt b/Products/CMFPlone/browser/login/templates/mail_password_form.pt\nindex e597411f8..da457d9d2 100644\n--- a/Products/CMFPlone/browser/login/templates/mail_password_form.pt\n+++ b/Products/CMFPlone/browser/login/templates/mail_password_form.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/login/templates/mail_password_response.pt b/Products/CMFPlone/browser/login/templates/mail_password_response.pt\nindex c8c601967..10f2d73cc 100644\n--- a/Products/CMFPlone/browser/login/templates/mail_password_response.pt\n+++ b/Products/CMFPlone/browser/login/templates/mail_password_response.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/login/templates/pwreset_expired.pt b/Products/CMFPlone/browser/login/templates/pwreset_expired.pt\nindex e2e1c1c64..061a399ad 100644\n--- a/Products/CMFPlone/browser/login/templates/pwreset_expired.pt\n+++ b/Products/CMFPlone/browser/login/templates/pwreset_expired.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/login/templates/pwreset_finish.pt b/Products/CMFPlone/browser/login/templates/pwreset_finish.pt\nindex bfc05a128..6fb4a4c1a 100644\n--- a/Products/CMFPlone/browser/login/templates/pwreset_finish.pt\n+++ b/Products/CMFPlone/browser/login/templates/pwreset_finish.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/login/templates/pwreset_form.pt b/Products/CMFPlone/browser/login/templates/pwreset_form.pt\nindex 46dda3f39..5a49dd805 100644\n--- a/Products/CMFPlone/browser/login/templates/pwreset_form.pt\n+++ b/Products/CMFPlone/browser/login/templates/pwreset_form.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/login/templates/pwreset_invalid.pt b/Products/CMFPlone/browser/login/templates/pwreset_invalid.pt\nindex 1be9f9f26..f6b7cca79 100644\n--- a/Products/CMFPlone/browser/login/templates/pwreset_invalid.pt\n+++ b/Products/CMFPlone/browser/login/templates/pwreset_invalid.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n <body>\n \ndiff --git a/Products/CMFPlone/browser/templates/accessibility-info.pt b/Products/CMFPlone/browser/templates/accessibility-info.pt\nindex 3806baa2e..f7b350eab 100644\n--- a/Products/CMFPlone/browser/templates/accessibility-info.pt\n+++ b/Products/CMFPlone/browser/templates/accessibility-info.pt\n@@ -3,7 +3,7 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <body>\ndiff --git a/Products/CMFPlone/browser/templates/author.pt b/Products/CMFPlone/browser/templates/author.pt\nindex d4b15dc6e..7edf51c99 100644\n--- a/Products/CMFPlone/browser/templates/author.pt\n+++ b/Products/CMFPlone/browser/templates/author.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/browser/templates/contact-info.pt b/Products/CMFPlone/browser/templates/contact-info.pt\nindex a43024deb..4329ff3c4 100644\n--- a/Products/CMFPlone/browser/templates/contact-info.pt\n+++ b/Products/CMFPlone/browser/templates/contact-info.pt\n@@ -2,7 +2,7 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/browser/templates/error_message.pt b/Products/CMFPlone/browser/templates/error_message.pt\nindex d73e88d70..d1d7be29b 100644\n--- a/Products/CMFPlone/browser/templates/error_message.pt\n+++ b/Products/CMFPlone/browser/templates/error_message.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <body>\ndiff --git a/Products/CMFPlone/browser/templates/five_template.pt b/Products/CMFPlone/browser/templates/five_template.pt\nindex 6110d6620..5ccbd857b 100644\n--- a/Products/CMFPlone/browser/templates/five_template.pt\n+++ b/Products/CMFPlone/browser/templates/five_template.pt\n@@ -1,5 +1,5 @@\n <metal:macro metal:define-macro="page"\n-><html metal:use-macro="context/main_template/macros/master">\n+><html metal:use-macro="context/@@main_template/macros/master">\n <head>\n <metal:slot metal:fill-slot="style_slot"\n ><metal:slot metal:define-slot="style_slot" /></metal:slot>\ndiff --git a/Products/CMFPlone/browser/templates/main_template.pt b/Products/CMFPlone/browser/templates/main_template.pt\nindex 2b1d3915a..4f8a6cce6 100644\n--- a/Products/CMFPlone/browser/templates/main_template.pt\n+++ b/Products/CMFPlone/browser/templates/main_template.pt\n@@ -5,17 +5,17 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:define="portal_state context/@@plone_portal_state;\n-          context_state context/@@plone_context_state;\n-          plone_view context/@@plone;\n-          plone_layout context/@@plone_layout;\n-          lang portal_state/language;\n+      tal:define="portal_state python:context.restrictedTraverse(\'@@plone_portal_state\');\n+          context_state python:context.restrictedTraverse(\'@@plone_context_state\');\n+          plone_view python:context.restrictedTraverse(\'@@plone\');\n+          plone_layout python:context.restrictedTraverse(\'@@plone_layout\');\n+          lang python:portal_state.language();\n           view nocall:view | nocall: plone_view;\n           dummy python: plone_layout.mark_view(view);\n-          portal_url portal_state/portal_url;\n-          checkPermission nocall: context/portal_membership/checkPermission;\n-          site_properties context/portal_properties/site_properties;\n-          ajax_include_head request/ajax_include_head | nothing;\n+          portal_url python:portal_state.portal_url();\n+          checkPermission python:context.restrictedTraverse(\'portal_membership\').checkPermission;\n+          site_properties python:context.restrictedTraverse(\'portal_properties\').site_properties;\n+          ajax_include_head python:request.get(\'ajax_include_head\', False);\n           ajax_load python:False;"\n       i18n:domain="plone"\n       tal:attributes="lang lang;">\ndiff --git a/Products/CMFPlone/browser/templates/search.pt b/Products/CMFPlone/browser/templates/search.pt\nindex aa05139b7..bf307ee2d 100644\n--- a/Products/CMFPlone/browser/templates/search.pt\n+++ b/Products/CMFPlone/browser/templates/search.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/browser/templates/send_feedback_confirm.pt b/Products/CMFPlone/browser/templates/send_feedback_confirm.pt\nindex 4246f4353..99c5de6ec 100644\n--- a/Products/CMFPlone/browser/templates/send_feedback_confirm.pt\n+++ b/Products/CMFPlone/browser/templates/send_feedback_confirm.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\n@@ -19,7 +19,7 @@\n         i18n:translate="heading_send_feedback_confirm">\n         Site Administrator has been contacted.\n     </h1>\n-\t\n+\n     <div class="documentDescription" i18n:translate="message_send_feedback_confirm">\n         A mail has now been sent to the site administrator regarding your\n         questions and/or comments.\ndiff --git a/Products/CMFPlone/browser/templates/sitemap.pt b/Products/CMFPlone/browser/templates/sitemap.pt\nindex b773d1f7b..d9d21ce6c 100644\n--- a/Products/CMFPlone/browser/templates/sitemap.pt\n+++ b/Products/CMFPlone/browser/templates/sitemap.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <head>\ndiff --git a/Products/CMFPlone/skins/plone_prefs/prefs_main_template.pt b/Products/CMFPlone/skins/plone_prefs/prefs_main_template.pt\nindex 0d36e82d4..a53478e32 100644\n--- a/Products/CMFPlone/skins/plone_prefs/prefs_main_template.pt\n+++ b/Products/CMFPlone/skins/plone_prefs/prefs_main_template.pt\n@@ -1,5 +1,5 @@\n <metal:page define-macro="master">\n-  <tal:block metal:use-macro="context/main_template/macros/master">\n+  <tal:block metal:use-macro="context/@@main_template/macros/master">\n \n     <metal:block fill-slot="top_slot">\n         <metal:override define-slot="top_slot">\n@@ -21,7 +21,7 @@\n         <metal:slot define-slot="prefs_configlet_wrapper">\n           <metal:slot define-slot="prefs_configlet_content">\n \n-            <metal:block metal:use-macro="context/main_template/macros/content">\n+            <metal:block metal:use-macro="context/@@main_template/macros/content">\n               <metal:override metal:fill-slot="main">\n                 <metal:slot metal:define-slot="prefs_configlet_main" tal:content="nothing">\n                   Page body text\ndiff --git a/Products/CMFPlone/skins/plone_templates/index_html.pt b/Products/CMFPlone/skins/plone_templates/index_html.pt\nindex 7b5e09fb7..bceba801f 100644\n--- a/Products/CMFPlone/skins/plone_templates/index_html.pt\n+++ b/Products/CMFPlone/skins/plone_templates/index_html.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <body>\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_modified.pt b/Products/CMFPlone/skins/plone_templates/recently_modified.pt\nindex 50833f331..7ee649e25 100644\n--- a/Products/CMFPlone/skins/plone_templates/recently_modified.pt\n+++ b/Products/CMFPlone/skins/plone_templates/recently_modified.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <metal:block fill-slot="top_slot"\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_published.pt b/Products/CMFPlone/skins/plone_templates/recently_published.pt\nindex 568603493..cccd879ec 100644\n--- a/Products/CMFPlone/skins/plone_templates/recently_published.pt\n+++ b/Products/CMFPlone/skins/plone_templates/recently_published.pt\n@@ -3,7 +3,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <metal:block fill-slot="top_slot"\ndiff --git a/Products/CMFPlone/skins/plone_templates/test_rendering.pt b/Products/CMFPlone/skins/plone_templates/test_rendering.pt\nindex 37db1de48..a44a0a5d5 100644\n--- a/Products/CMFPlone/skins/plone_templates/test_rendering.pt\n+++ b/Products/CMFPlone/skins/plone_templates/test_rendering.pt\n@@ -5,7 +5,7 @@\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n-      metal:use-macro="context/main_template/macros/master"\n+      metal:use-macro="context/@@main_template/macros/master"\n       i18n:domain="plone">\n \n <body>\n'

