Repository: plone.app.event


Branch: refs/heads/master
Date: 2016-09-27T22:41:01-05:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.event/commit/9edf7469c7b55b35ede349de29fcb9d7bfae3576

Really remove Plone 4 compatibility code

Files changed:
M CHANGES.rst
M README.rst
M docs/installation.rst
M plone/app/event/configure.zcml
M plone/app/event/dx/behaviors.py
M plone/app/event/testing.py
M plone/app/event/tests/test_portlet_calendar.py
M plone/app/event/tests/test_portlet_events.py
M setup.py
D buildout-43.cfg
D plone/app/event/bbb/__init__.py
D plone/app/event/bbb/browser/__init__.py
D plone/app/event/bbb/browser/configure.zcml
D plone/app/event/bbb/browser/controlpanel.py
D plone/app/event/bbb/configure.zcml
D plone/app/event/bbb/interfaces.py
D plone/app/event/bbb/portlets/__init__.py
D plone/app/event/bbb/portlets/configure.zcml
D plone/app/event/bbb/portlets/portlet_calendar.js
D plone/app/event/bbb/portlets/portlet_calendar.pt
D plone/app/event/bbb/portlets/portlet_calendar.py
D plone/app/event/bbb/portlets/portlet_events.pt
D plone/app/event/bbb/portlets/portlet_events.py
D plone/app/event/bbb/profiles/default/controlpanel.xml
D plone/app/event/bbb/profiles/default/jsregistry.xml
D plone/app/event/bbb/profiles/default/metadata.xml
D plone/app/event/bbb/profiles/default/plone.app.event.bbb.txt
D plone/app/event/bbb/profiles/default/registry.xml
D plone/app/event/bbb/setuphandlers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 57da5d2..b7db582 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,8 @@ Changelog
 
 Breaking changes:
 
-- *add item here*
+- Really remove Plone 4 compatibility code.
+  [thet]
 
 New features:
 
diff --git a/README.rst b/README.rst
index 6579029..2f57a90 100644
--- a/README.rst
+++ b/README.rst
@@ -17,8 +17,4 @@ For Standalone installation follow the standard buildout procedure::
     $ ./bin/pip install -U zc.buildout setuptools pip
     $ ./bin/buildout
 
-For Plone 4.3 do::
-
-    $ ./bin/buildout -c buildout-43.cfg
-
 Note, both commands will install a test and development environment.
diff --git a/buildout-43.cfg b/buildout-43.cfg
deleted file mode 100644
index ed83bf5..0000000
--- a/buildout-43.cfg
+++ /dev/null
@@ -1,130 +0,0 @@
-[buildout]
-extends =
-    https://raw.githubusercontent.com/plone/buildout.coredev/4.3/versions.cfg
-parts =
-    instance
-# DEV
-    i18ndude
-    omelette
-    zopepy
-    sphinx
-    checkversions
-# TESTING
-    test
-    coverage-test
-    coverage-report
-    robot
-
-auto-checkout =
-    Products.DateRecurringIndex
-    icalendar
-    jquery.recurrenceinput.js
-    plone.app.event
-    plone.event
-    plone.formwidget.recurrence
-
-extensions += mr.developer
-sources-dir = ${buildout:directory}/devsrc
-develop = .
-versions = versions
-
-# One of: CRITICAL, ERROR, WARNING, INFO, DEBUG, NOTSET
-log-level = INFO
-
-
-[instance]
-recipe = plone.recipe.zope2instance
-user = admin:admin
-environment-vars = zope_i18n_compile_mo_files true
-eggs =
-    Plone
-    Pillow
-    plone.app.event
-# DEVELOPMENT
-    plone.reload
-    plone.app.debugtoolbar
-
-
-# DEVELOPMENT
-
-[sources]
-Products.DateRecurringIndex  = git git@github.com:collective/Products.DateRecurringIndex.git
-icalendar                    = git git@github.com:collective/icalendar.git
-jquery.recurrenceinput.js    = git git@github.com:collective/jquery.recurrenceinput.js.git egg=false
-plone.event                  = git git@github.com:plone/plone.event.git
-plone.formwidget.recurrence  = git git@github.com:plone/plone.formwidget.recurrence.git branch=1.x
-# Looks like, `develop = .` doesn't work well with mr.developer. So we checkout
-# plone.app.event to the buildout directory path.
-plone.app.event = git git@github.com:plone/plone.app.event.git branch=master full-path=${buildout:directory}
-
-[i18ndude]
-unzip = true
-recipe = zc.recipe.egg
-eggs = i18ndude
-
-[omelette]
-recipe = collective.recipe.omelette
-eggs =
-    ${instance:eggs}
-    ${test:eggs}
-    ${robot:eggs}
-
-[zopepy]
-recipe = zc.recipe.egg
-eggs =
-    ${instance:eggs}
-    ${test:eggs}
-    ${robot:eggs}
-interpreter = zopepy
-scripts = zopepy
-
-[sphinx]
-recipe = collective.recipe.sphinxbuilder
-source = ${buildout:directory}/docs
-interpreter = ${buildout:directory}/bin/zopepy
-
-[checkversions]
-recipe=zc.recipe.egg
-eggs=z3c.checkversions [buildout]
-
-
-# TESTING
-
-[environment]
-BUILDOUT_DIR = ${buildout:directory}
-zope_i18n_compile_mo_files = true
-
-[test]
-recipe = zc.recipe.testrunner
-defaults = ['--auto-color', '--auto-progress']
-eggs =
-    Products.DateRecurringIndex [test]
-    icalendar [test]
-    plone.app.event [test]
-    plone.event [test]
-    plone.formwidget.recurrence [test]
-environment = environment
-
-[coverage-test]
-recipe = zc.recipe.testrunner
-eggs = ${test:eggs}
-defaults = ['--coverage', '../../coverage', '-v', '--auto-progress']
-
-[coverage-report]
-recipe = zc.recipe.egg
-eggs = z3c.coverage
-scripts = coveragereport
-arguments = ('coverage', 'report')
-
-[robot]
-recipe = zc.recipe.egg
-eggs =
-    ${instance:eggs}
-    plone.app.robotframework [debug]
-
-
-# ALL
-
-[versions]
-setuptools =
-zc.buildout =
diff --git a/docs/installation.rst b/docs/installation.rst
index 672aa9c..c7f7555 100644
--- a/docs/installation.rst
+++ b/docs/installation.rst
@@ -1,44 +1,6 @@
 Installation
 ============
 
-Compatibility
--------------
-
-plone.app.event 2.0 is a rewrite of plone.app.event 1.x and fixes some issues.  See Changelog.rst.
-
-The following is a compatibility map of all current plone.app.event versions:
-
-===============  ======  ==========  =================  ======================  ==========
-plone.app.event            Plone     plone.app.widgets  plone.app.contenttypes  Archetypes
----------------  ------  ----------  -----------------  ----------------------  ----------
-version          branch
-===============  ======  ==========  =================  ======================  ==========
-1.1.x            1.1.x   Plone 4.3+         No                   1.1.x              Yes
-1.2.x            1.2.x   Plone 4.3+      >= 1.4.0              < 1.2a3              Yes
-2.x              master  Plone 4.3+      >= 1.7.0             >= 1.2a3              No
-===============  ======  ==========  =================  ======================  ==========
-
-
-Buildout files
---------------
-
-- ``buildout.cfg``: Base installation for Plone 5.
-
-- ``buildout-43.cfg``: Base installation for Plone 4.3.
-
-- ``dev.cfg``: Development configuration, including tests, for Plone 5.
-
-- ``test.cfg``: Test build for Plone 5.
-
-- ``test-43.cfg``: Test build for Plone 4.3.
-
-- ``sources.cfg``: mr.developer source definitions.
-
-- ``versions.cfg``: Recommended version requirements.
-
-
-Installation
-------------
 
 ``plone.app.event`` only provides Dexterity behaviors to build own types based on them.  If you want to install a Dexterity based Event type, you can simply use ``plone.app.contenttypes`` 1.2a3 or up.
 
diff --git a/plone/app/event/bbb/__init__.py b/plone/app/event/bbb/__init__.py
deleted file mode 100644
index e69de29..0000000
diff --git a/plone/app/event/bbb/browser/__init__.py b/plone/app/event/bbb/browser/__init__.py
deleted file mode 100644
index e69de29..0000000
diff --git a/plone/app/event/bbb/browser/configure.zcml b/plone/app/event/bbb/browser/configure.zcml
deleted file mode 100644
index f9f3a9e..0000000
--- a/plone/app/event/bbb/browser/configure.zcml
+++ /dev/null
@@ -1,13 +0,0 @@
-<configure
-    xmlns="http://namespaces.zope.org/zope"
-    xmlns:browser="http://namespaces.zope.org/browser">
-
-  <!-- Date and Time Control panel -->
-  <browser:page
-      name="dateandtime-controlpanel"
-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"
-      class=".controlpanel.DateAndTimeControlPanel"
-      permission="plone.app.controlpanel.Site"
-      />
-
-</configure>
diff --git a/plone/app/event/bbb/browser/controlpanel.py b/plone/app/event/bbb/browser/controlpanel.py
deleted file mode 100644
index d2d2f0e..0000000
--- a/plone/app/event/bbb/browser/controlpanel.py
+++ /dev/null
@@ -1,22 +0,0 @@
-from Products.CMFPlone import PloneMessageFactory as _
-from plone.app.event.bbb.interfaces import IDateAndTimeSchema
-from plone.app.registry.browser.controlpanel import ControlPanelFormWrapper
-from plone.app.registry.browser.controlpanel import RegistryEditForm
-
-
-class DateAndTimeControlPanelForm(RegistryEditForm):
-
-    id = "DateAndTimeControlPanel"
-    label = _(u"Date and Time Settings")
-    schema = IDateAndTimeSchema
-    schema_prefix = "plone"
-
-    label = _(u"label_dateandtime_settings", default=u"Date and Time Settings")
-    description = _(
-        u"help_event_settings",
-        default=u"Date and Time related settings like timezone(s), etc."
-    )
-
-
-class DateAndTimeControlPanel(ControlPanelFormWrapper):
-    form = DateAndTimeControlPanelForm
diff --git a/plone/app/event/bbb/configure.zcml b/plone/app/event/bbb/configure.zcml
deleted file mode 100644
index 05e91e7..0000000
--- a/plone/app/event/bbb/configure.zcml
+++ /dev/null
@@ -1,28 +0,0 @@
-<configure
-    xmlns="http://namespaces.zope.org/zope"
-    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"
-    i18n_domain="plone.app.event">
-
-  <include package="plone.app.widgets" />
-
-  <include package=".browser" />
-  <include package=".portlets" />
-
-  <genericsetup:registerProfile
-      name="default"
-      title="plone.app.event (support for Plone 4)"
-      directory="profiles/default"
-      description="plone.app.event framework registration."
-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"
-      provides="Products.GenericSetup.interfaces.EXTENSION"
-      />
-
-  <genericsetup:importStep
-      name="plone.app.event-bbb"
-      handler=".setuphandlers.setup_misc"
-      title="plone.app.event-bbb misc"
-      description="first_weekday setup">
-    <depends name="plone.app.registry" />
-  </genericsetup:importStep>
-
-</configure>
diff --git a/plone/app/event/bbb/interfaces.py b/plone/app/event/bbb/interfaces.py
deleted file mode 100644
index e26313a..0000000
--- a/plone/app/event/bbb/interfaces.py
+++ /dev/null
@@ -1,39 +0,0 @@
-from Products.CMFPlone import PloneMessageFactory as _
-from zope import schema
-from zope.interface import Interface
-
-
-class IDateAndTimeSchema(Interface):
-    """Control panel settings for date and time related settings.
-    """
-
-    portal_timezone = schema.Choice(
-        title=_(u"Portal default timezone"),
-        description=_(
-            u"help_portal_timezone",
-            default=u"The timezone setting of the portal. Users can set "
-                    u"their own timezone, if available timezones are "
-                    u"defined."),
-        required=True,
-        default=None,
-        vocabulary="plone.app.vocabularies.CommonTimezones")
-
-    available_timezones = schema.List(
-        title=_(u"Available timezones"),
-        description=_(
-            u"help_available_timezones",
-            default=u"The timezones, which should be available for the "
-                    u"portal. Can be set for users and events"),
-        required=False,
-        default=[],
-        value_type=schema.Choice(
-            vocabulary="plone.app.vocabularies.Timezones"))
-
-    first_weekday = schema.Choice(
-        title=_(u'label_first_weekday', default=u'First Weekday'),
-        description=_(
-            u'help_first_weekday',
-            default=u'First day in the Week.'),
-        required=True,
-        default=None,
-        vocabulary="plone.app.vocabularies.Weekdays")
\ No newline at end of file
diff --git a/plone/app/event/bbb/portlets/__init__.py b/plone/app/event/bbb/portlets/__init__.py
deleted file mode 100644
index e69de29..0000000
diff --git a/plone/app/event/bbb/portlets/configure.zcml b/plone/app/event/bbb/portlets/configure.zcml
deleted file mode 100644
index d46fdcf..0000000
--- a/plone/app/event/bbb/portlets/configure.zcml
+++ /dev/null
@@ -1,30 +0,0 @@
-<configure xmlns="http://namespaces.zope.org/zope"
-           xmlns:browser="http://namespaces.zope.org/browser"
-           xmlns:plone="http://namespaces.plone.org/plone"
-           i18n_domain="plone.app.event">
-
-  <browser:resource
-      name="plone.app.event.portlet_calendar.js"
-      file="portlet_calendar.js"
-      permission="zope.Public"
-      />
-
-  <plone:portlet
-      name="portlets.Calendar"
-      interface="..portlets.portlet_calendar.ICalendarPortlet"
-      assignment="..portlets.portlet_calendar.Assignment"
-      renderer=".portlet_calendar.Renderer"
-      addview=".portlet_calendar.AddForm"
-      editview=".portlet_calendar.EditForm"
-      />
-
-  <plone:portlet
-      name="portlets.Events"
-      interface="..portlets.portlet_events.IEventsPortlet"
-      assignment="..portlets.portlet_events.Assignment"
-      renderer=".portlet_events.Renderer"
-      addview=".portlet_events.AddForm"
-      editview=".portlet_events.EditForm"
-      />
-
-</configure>
diff --git a/plone/app/event/bbb/portlets/portlet_calendar.js b/plone/app/event/bbb/portlets/portlet_calendar.js
deleted file mode 100644
index d50b880..0000000
--- a/plone/app/event/bbb/portlets/portlet_calendar.js
+++ /dev/null
@@ -1,45 +0,0 @@
-/*jslint browser: true*/
-/*global $, jQuery, plone, portal_url */
-
-(function ($) {
-
-    function load_portlet_calendar(event, elem) {
-        // depends on plone_javascript_variables.js for portal_url
-        event.preventDefault();
-        var pw, elem_data, portlethash, url;
-        pw = elem.closest('.portletWrapper');
-        elem_data = elem.data();
-        portlethash = pw.attr('id');
-        portlethash = portlethash.substring(15, portlethash.length);
-        url = portal_url +
-              '/@@render-portlet?portlethash=' + portlethash +
-              '&year=' + elem_data.year +
-              '&month=' + elem_data.month;
-        $.ajax({
-            url: url,
-            success: function (data) {
-                pw.html(data);
-                rebind_portlet_calendar();
-            }
-        });
-    }
-
-    function rebind_portlet_calendar() {
-        // ajaxify each portletCalendar
-        $('.portletCalendar a.calendarNext').click(function (event) {
-            load_portlet_calendar(event, $(this));
-        });
-        $('.portletCalendar a.calendarPrevious').click(function (event) {
-            load_portlet_calendar(event, $(this));
-        });
-        $('.portletCalendar dd a[title]').tooltip({
-            offset: [-10, 0],
-            tipClass: 'pae_calendar_tooltip'
-        });
-    }
-
-    $(document).ready(function () {
-        rebind_portlet_calendar();
-    });
-
-}(jQuery));
diff --git a/plone/app/event/bbb/portlets/portlet_calendar.pt b/plone/app/event/bbb/portlets/portlet_calendar.pt
deleted file mode 100644
index f67d98b..0000000
--- a/plone/app/event/bbb/portlets/portlet_calendar.pt
+++ /dev/null
@@ -1,83 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      i18n:domain="plone"
-      tal:omit-tag="">
-<dl class="portlet portletCalendar"
-    tal:define="navigation_root_url context/@@plone_portal_state/navigation_root_url;
-                month view/month;
-                year view/year;">
-
-    <dt class="portletHeader">
-      <span class="portletTopLeft"></span>
-      <a href="#" rel="nofollow"
-           class="calendarPrevious"
-           title="Previous month"
-           tal:define="prev_month view/prev_month;
-                       prev_year view/prev_year"
-           tal:attributes="href view/prev_query;
-                           data-year prev_year;
-                           data-month prev_month;"
-           i18n:attributes="title title_previous_month;">&laquo;</a>
-
-        <span i18n:translate="" tal:omit-tag="">
-            <span i18n:name="monthname" i18n:translate=""
-                  tal:content="view/month_name"
-                  tal:omit-tag="">monthname</span>
-            <span i18n:name="year" i18n:translate=""
-                  tal:content="year"
-                  tal:omit-tag="">year</span>
-        </span>
-
-        <a href="#" rel="nofollow"
-           class="calendarNext"
-           title="Next month"
-           tal:define="next_month view/next_month;
-                       next_year view/next_year"
-           tal:attributes="href view/next_query;
-                           data-year next_year;
-                           data-month next_month;"
-           i18n:attributes="title title_next_month;">&raquo;</a>
-        <span class="portletTopRight"></span>
-    </dt>
-
-    <dd class="portletItem">
-        <table class="ploneCalendar" summary="Calendar"
-            i18n:attributes="summary summary_calendar">
-            <caption class="hiddenStructure"
-                i18n:translate="" tal:content="string:month-${month}">monthname</caption>
-            <thead>
-              <tr class="weekdays"><tal:data repeat="weekday view/weekdays">
-                <th scope="col" i18n:translate="" tal:content="weekday">Su</th>
-              </tal:data></tr>
-            </thead>
-            <tbody>
-              <tr tal:repeat="week view/cal_data">
-                <tal:block repeat="day week">
-                <td class="event"
-                  tal:define="today day/today;
-                              next_month day/next_month;
-                              prev_month day/prev_month;
-                              events day/events;
-                              limit python:len(events) if events is not None else 0"
-                  tal:attributes="class python:u'event%s%s%s%s' %
-                              ((' today' if today else ''),
-                              (' cal_next_month' if next_month else ''),
-                              (' cal_prev_month' if prev_month else ''),
-                              (' cal_has_events' if events else ''))">
-                    <a href=""
-                      tal:omit-tag="not:events"
-                      tal:attributes="href python:view.date_events_url(day['date_string']);
-                                      title day/events_string;"
-                      tal:content="day/day">31</a>
-
-                </td>
-                </tal:block>
-              </tr>
-            </tbody>
-        </table>
-        <span class="portletBottomLeft"></span>
-        <span class="portletBottomRight"></span>
-    </dd>
-</dl>
-</html>
diff --git a/plone/app/event/bbb/portlets/portlet_calendar.py b/plone/app/event/bbb/portlets/portlet_calendar.py
deleted file mode 100644
index e153b9d..0000000
--- a/plone/app/event/bbb/portlets/portlet_calendar.py
+++ /dev/null
@@ -1,46 +0,0 @@
-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
-from distutils.version import LooseVersion
-from plone.app.event.portlets.portlet_calendar import Assignment
-from plone.app.event.portlets.portlet_calendar import ICalendarPortlet
-from plone.app.event.portlets.portlet_calendar import Renderer as RendererBase
-from plone.app.portlets import PloneMessageFactory as _
-import pkg_resources
-
-
-version = LooseVersion(pkg_resources.require("plone.app.portlets")[0].version)
-wanted = LooseVersion('3.0')
-
-
-if version >= wanted:
-    P_A_PORTLETS_PRE_3 = False
-    from plone.app.portlets.portlets import base
-else:
-    P_A_PORTLETS_PRE_3 = True
-    from z3c.form import field
-    from plone.app.portlets.browser import z3cformhelper as base
-
-
-class Renderer(RendererBase):
-    render = ViewPageTemplateFile('portlet_calendar.pt')
-
-
-class AddForm(base.AddForm):
-    if P_A_PORTLETS_PRE_3:
-        fields = field.Fields(ICalendarPortlet)
-    else:
-        schema = ICalendarPortlet
-    label = _(u"Add Calendar Portlet")
-    description = _(u"This portlet displays events in a calendar.")
-
-    def create(self, data):
-        return Assignment(state=data.get('state', None),
-                          search_base_uid=data.get('search_base_uid', None))
-
-
-class EditForm(base.EditForm):
-    if P_A_PORTLETS_PRE_3:
-        fields = field.Fields(ICalendarPortlet)
-    else:
-        schema = ICalendarPortlet
-    label = _(u"Edit Calendar Portlet")
-    description = _(u"This portlet displays events in a calendar.")
diff --git a/plone/app/event/bbb/portlets/portlet_events.pt b/plone/app/event/bbb/portlets/portlet_events.pt
deleted file mode 100644
index 835db64..0000000
--- a/plone/app/event/bbb/portlets/portlet_events.pt
+++ /dev/null
@@ -1,71 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      tal:omit-tag="">
-<dl class="portlet portletEvents"
-    i18n:domain="plone.app.event">
-
-    <dt class="portletHeader">
-        <span class="portletTopLeft"></span>
-        <a href=""
-           class="tile"
-           tal:define="next_link view/next_url"
-           tal:omit-tag="not:next_link"
-           tal:attributes="href next_link"
-           i18n:translate="box_events">
-            Upcoming Events
-        </a>
-        <span class="portletTopRight"></span>
-    </dt>
-
-    <tal:events repeat="item view/events">
-    <dd class="portletItem"
-        tal:define="oddrow repeat/item/odd"
-        tal:attributes="class python:'portletItem oddrow' if oddrow else 'portletItem even'">
-        <a href="#" class="tile"
-            tal:attributes="href item/url;
-                            title item/description">
-            <span tal:replace="item/title">
-                Some Event
-            </span>
-        </a>
-        <span class="portletItemDetails">
-            <tal:date replace="structure python:view.formatted_date(item)" />
-            <span class="timezone"
-                tal:define="tz item/timezone"
-                tal:condition="tz">
-                (<tal:tzname replace="tz">TZ</tal:tzname>)
-            </span>
-            <span class="location"
-                tal:condition="item/location"> &mdash;
-                <tal:location content="item/location">Location</tal:location>
-            </span>
-        </span>
-    </dd>
-    </tal:events>
-
-    <dd class="portletFooter"
-        tal:define="prev_link view/prev_url"
-        tal:condition="prev_link">
-        <a href=""
-            tal:attributes="href prev_link"
-            class="tile">
-            <span i18n:translate="box_previous_events">
-                Previous events&hellip;
-            </span>
-        </a>
-    </dd>
-
-    <dd class="portletFooter">
-        <a href=""
-            class="tile"
-            tal:define="next_link view/next_url"
-            tal:attributes="href next_link"
-            i18n:translate="box_upcoming_events">
-            Upcoming events&hellip;
-        </a>
-        <span class="portletBottomLeft"></span>
-        <span class="portletBottomRight"></span>
-    </dd>
-</dl>
-</html>
diff --git a/plone/app/event/bbb/portlets/portlet_events.py b/plone/app/event/bbb/portlets/portlet_events.py
deleted file mode 100644
index d1c6ceb..0000000
--- a/plone/app/event/bbb/portlets/portlet_events.py
+++ /dev/null
@@ -1,47 +0,0 @@
-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
-from distutils.version import LooseVersion
-from plone.app.event.portlets.portlet_events import Assignment
-from plone.app.event.portlets.portlet_events import IEventsPortlet
-from plone.app.event.portlets.portlet_events import Renderer as RendererBase
-from plone.app.portlets import PloneMessageFactory as _
-import pkg_resources
-
-
-version = LooseVersion(pkg_resources.require("plone.app.portlets")[0].version)
-wanted = LooseVersion('3.0')
-
-
-if version >= wanted:
-    P_A_PORTLETS_PRE_3 = False
-    from plone.app.portlets.portlets import base
-else:
-    P_A_PORTLETS_PRE_3 = True
-    from z3c.form import field
-    from plone.app.portlets.browser import z3cformhelper as base
-
-
-class Renderer(RendererBase):
-    render = ViewPageTemplateFile('portlet_events.pt')
-
-
-class AddForm(base.AddForm):
-    if P_A_PORTLETS_PRE_3:
-        fields = field.Fields(IEventsPortlet)
-    else:
-        schema = IEventsPortlet
-    label = _(u"Add Events Portlet")
-    description = _(u"This portlet lists upcoming Events.")
-
-    def create(self, data):
-        return Assignment(count=data.get('count', 5),
-                          state=data.get('state', None),
-                          search_base_uid=data.get('search_base_uid', 5))
-
-
-class EditForm(base.EditForm):
-    if P_A_PORTLETS_PRE_3:
-        fields = field.Fields(IEventsPortlet)
-    else:
-        schema = IEventsPortlet
-    label = _(u"Edit Events Portlet")
-    description = _(u"This portlet lists upcoming Events.")
diff --git a/plone/app/event/bbb/profiles/default/controlpanel.xml b/plone/app/event/bbb/profiles/default/controlpanel.xml
deleted file mode 100644
index 92fc186..0000000
--- a/plone/app/event/bbb/profiles/default/controlpanel.xml
+++ /dev/null
@@ -1,11 +0,0 @@
-<?xml version="1.0"?>
-<object name="portal_controlpanel" meta_type="Plone Control Panel Tool"
-        i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">
-  <configlet title="Date and Time" action_id="DateAndTime" appId="DateAndTime"
-             category="Plone" condition_expr=""
-             icon_expr="string:$portal_url/event_icon.png"
-             url_expr="string:${portal_url}/@@dateandtime-controlpanel" visible="True"
-             i18n:attributes="title">
-    <permission>Plone Site Setup: Site</permission>
-  </configlet>
-</object>
diff --git a/plone/app/event/bbb/profiles/default/jsregistry.xml b/plone/app/event/bbb/profiles/default/jsregistry.xml
deleted file mode 100644
index a89a810..0000000
--- a/plone/app/event/bbb/profiles/default/jsregistry.xml
+++ /dev/null
@@ -1,13 +0,0 @@
-<?xml version="1.0"?>
-<object name="portal_javascripts" meta_type="JavaScripts Registry">
-
-  <javascript
-      cacheable="True"
-      compression="safe"
-      cookable="True"
-      enabled="True"
-      id="++resource++plone.app.event.portlet_calendar.js"
-      inline="False"
-      />
-
-</object>
diff --git a/plone/app/event/bbb/profiles/default/metadata.xml b/plone/app/event/bbb/profiles/default/metadata.xml
deleted file mode 100644
index 18e6296..0000000
--- a/plone/app/event/bbb/profiles/default/metadata.xml
+++ /dev/null
@@ -1,8 +0,0 @@
-<?xml version="1.0"?>
-<metadata>
-  <version>1</version>
-  <dependencies>
-    <dependency>profile-plone.app.widgets:default</dependency>
-    <dependency>profile-plone.app.event:default</dependency>
-  </dependencies>
-</metadata>
diff --git a/plone/app/event/bbb/profiles/default/plone.app.event.bbb.txt b/plone/app/event/bbb/profiles/default/plone.app.event.bbb.txt
deleted file mode 100644
index e69de29..0000000
diff --git a/plone/app/event/bbb/profiles/default/registry.xml b/plone/app/event/bbb/profiles/default/registry.xml
deleted file mode 100644
index f7c746b..0000000
--- a/plone/app/event/bbb/profiles/default/registry.xml
+++ /dev/null
@@ -1,5 +0,0 @@
-<?xml version="1.0"?>
-<registry>
-  <records interface="plone.app.event.bbb.interfaces.IDateAndTimeSchema"
-           prefix="plone" />
-</registry>
diff --git a/plone/app/event/bbb/setuphandlers.py b/plone/app/event/bbb/setuphandlers.py
deleted file mode 100644
index 09e9ce8..0000000
--- a/plone/app/event/bbb/setuphandlers.py
+++ /dev/null
@@ -1,38 +0,0 @@
-from plone.registry.interfaces import IRegistry
-from zope.component import getUtility
-from zope.component.hooks import getSite
-from zope.i18n.locales import locales, LoadLocaleError
-
-
-def first_weekday_setup(context):
-    """Set the first day of the week based on the portal's locale.
-    """
-    reg = getUtility(IRegistry)
-    if "plone.first_weekday" in reg and reg["plone.first_weekday"] is not None:
-        # don't overwrite if it's already set
-        return
-
-    first = 6
-    try:
-        site = getSite()
-        # find the locale implied by the portal's language
-        language = site.Language()
-        parts = (language.split('-') + [None, None])[:3]
-        locale = locales.getLocale(*parts)
-        # look up first day of week
-        gregorian_calendar = locale.dates.calendars.get(u'gregorian', None)
-        if gregorian_calendar is not None:
-            day = gregorian_calendar.week.get('firstDay', 7)
-            first = 6 if day == 0 else day - 1
-    except LoadLocaleError:
-        # If we cannot get the locale, just Sunday as first weekday
-        pass
-
-    # save setting
-    reg['plone.first_weekday'] = first
-
-
-def setup_misc(context):
-    if context.readDataFile('plone.app.event.bbb.txt') is None:
-        return
-    first_weekday_setup(context)
diff --git a/plone/app/event/configure.zcml b/plone/app/event/configure.zcml
index 959d631..c325c32 100644
--- a/plone/app/event/configure.zcml
+++ b/plone/app/event/configure.zcml
@@ -24,7 +24,6 @@
   <include package=".ical" />
   <include file="recurrence.zcml" />
   <include package=".upgrades" />
-  <include package=".bbb" zcml:condition="not-have plone-5" />
 
   <utility
       component=".vocabularies.SynchronizationStrategies"
diff --git a/plone/app/event/dx/behaviors.py b/plone/app/event/dx/behaviors.py
index c4cee50..e5b8c85 100644
--- a/plone/app/event/dx/behaviors.py
+++ b/plone/app/event/dx/behaviors.py
@@ -13,6 +13,7 @@
 from plone.app.event.dx.interfaces import IDXEvent
 from plone.app.event.dx.interfaces import IDXEventRecurrence
 from plone.app.textfield.value import RichTextValue
+from plone.app.z3cform.widget import DatetimeFieldWidget
 from plone.autoform import directives
 from plone.autoform.interfaces import IFormFieldProvider
 from plone.event.interfaces import IEventAccessor
@@ -23,7 +24,6 @@
 from plone.supermodel import model
 from plone.uuid.interfaces import IUUID
 from Products.CMFCore.utils import getToolByName
-from Products.CMFPlone.utils import getFSVersionTuple
 from Products.CMFPlone.utils import safe_unicode
 from z3c.form.browser.checkbox import SingleCheckBoxFieldWidget
 from z3c.form.browser.text import TextFieldWidget
@@ -38,16 +38,6 @@
 from zope.schema.interfaces import IContextAwareDefaultFactory
 
 
-PLONE5 = getFSVersionTuple()[0] >= 5
-
-if PLONE5:
-    # Plone 5
-    from plone.app.z3cform.widget import DatetimeFieldWidget
-else:
-    # Plone 4
-    from plone.app.widgets.dx import DatetimeFieldWidget
-
-
 def first_weekday_sun0():
     return wkday_to_mon1(first_weekday())
 
diff --git a/plone/app/event/testing.py b/plone/app/event/testing.py
index 9239922..8c77026 100644
--- a/plone/app/event/testing.py
+++ b/plone/app/event/testing.py
@@ -1,4 +1,3 @@
-from Products.CMFPlone.utils import getFSVersionTuple
 from plone.app.event.interfaces import IBrowserLayer
 from plone.app.robotframework.testing import AUTOLOGIN_LIBRARY_FIXTURE
 from plone.app.testing import FunctionalTesting
@@ -13,9 +12,6 @@
 import os
 
 
-PLONE5 = getFSVersionTuple()[0] >= 5
-
-
 def set_browserlayer(request):
     """Set the BrowserLayer for the request.
 
@@ -80,8 +76,6 @@ def setUpZope(self, app, configurationContext):
 
     def setUpPloneSite(self, portal):
         self.applyProfile(portal, 'plone.app.event:default')
-        if not PLONE5:
-            self.applyProfile(portal, 'plone.app.event.bbb:default')
         set_timezone(tz='UTC')
 
     def tearDownZope(self, app):
@@ -118,8 +112,6 @@ def setUpZope(self, app, configurationContext):
 
     def setUpPloneSite(self, portal):
         self.applyProfile(portal, 'plone.app.contenttypes:default')
-        if not PLONE5:
-            self.applyProfile(portal, 'plone.app.event.bbb:default')
         self.applyProfile(portal, 'plone.app.event:testing')
         set_timezone(tz='UTC')
 
diff --git a/plone/app/event/tests/test_portlet_calendar.py b/plone/app/event/tests/test_portlet_calendar.py
index 0bd549f..d85de92 100644
--- a/plone/app/event/tests/test_portlet_calendar.py
+++ b/plone/app/event/tests/test_portlet_calendar.py
@@ -1,6 +1,5 @@
 # -*- coding: utf-8 -*-
 from Products.CMFCore.utils import getToolByName
-from Products.CMFPlone.utils import getFSVersionTuple
 from Products.GenericSetup.utils import _getDottedName
 from calendar import monthrange
 from datetime import datetime
@@ -30,11 +29,6 @@
 
 TZNAME = 'Europe/Vienna'
 PTYPE = 'plone.app.event.dx.event'
-PLONE5 = getFSVersionTuple()[0] >= 5
-
-if not PLONE5:
-    from plone.app.event.bbb.portlets \
-        import portlet_calendar as bbb_portlet_calendar
 
 
 class PortletTest(unittest.TestCase):
@@ -97,11 +91,7 @@ def testRenderer(self):
             (context, self.request, view, manager, assignment),
             IPortletRenderer
         )
-        if PLONE5:
-            self.assertTrue(isinstance(renderer, portlet_calendar.Renderer))
-        else:
-            self.assertTrue(isinstance(renderer,
-                                       bbb_portlet_calendar.Renderer))
+        self.assertTrue(isinstance(renderer, portlet_calendar.Renderer))
 
 
 class RendererTest(unittest.TestCase):
diff --git a/plone/app/event/tests/test_portlet_events.py b/plone/app/event/tests/test_portlet_events.py
index 14b4915..c269883 100644
--- a/plone/app/event/tests/test_portlet_events.py
+++ b/plone/app/event/tests/test_portlet_events.py
@@ -1,4 +1,3 @@
-from Products.CMFPlone.utils import getFSVersionTuple
 from Products.CMFCore.utils import getToolByName
 from Products.GenericSetup.utils import _getDottedName
 from datetime import datetime
@@ -30,11 +29,6 @@
 
 TZNAME = 'Australia/Brisbane'
 PTYPE = 'plone.app.event.dx.event'
-PLONE5 = getFSVersionTuple()[0] >= 5
-
-if not PLONE5:
-    from plone.app.event.bbb.portlets \
-        import portlet_events as bbb_portlet_events
 
 
 class PortletTest(unittest.TestCase):
@@ -89,11 +83,7 @@ def testInvokeEditView(self):
 
         mapping['foo'] = portlet_events.Assignment(count=5)
         editview = getMultiAdapter((mapping['foo'], self.request), name='edit')
-        if PLONE5:
-            self.assertTrue(isinstance(editview, portlet_events.EditForm))
-        else:
-            self.assertTrue(isinstance(editview, bbb_portlet_events.EditForm))
-
+        self.assertTrue(isinstance(editview, portlet_events.EditForm))
 
     def testRenderer(self):
         context = self.portal
@@ -107,10 +97,7 @@ def testRenderer(self):
             (context, self.request, view, manager, assignment),
             IPortletRenderer
         )
-        if PLONE5:
-            self.assertTrue(isinstance(renderer, portlet_events.Renderer))
-        else:
-            self.assertTrue(isinstance(renderer, bbb_portlet_events.Renderer))
+        self.assertTrue(isinstance(renderer, portlet_events.Renderer))
 
     def test_disable_dasboard_breaks_event_portlet(self):
         # Bug #8230: disabling the dashboard breaks the event portlet
diff --git a/setup.py b/setup.py
index 4adb6e3..00c8fa5 100644
--- a/setup.py
+++ b/setup.py
@@ -19,6 +19,7 @@
     classifiers=[
         "Development Status :: 4 - Beta",
         "Framework :: Plone",
+        "Framework :: Plone :: 5.1",
         "Programming Language :: Python :: 2.7",
         "License :: OSI Approved :: GNU General Public License v2 (GPLv2)"
     ],
@@ -99,9 +100,6 @@
             'zExceptions',
             'zope.event',
         ],
-        'plone43': [
-            'plone.app.widgets [dexterity] >= 1.7.0',
-        ]
     },
     entry_points="""
     [z3c.autoinclude.plugin]


Repository: plone.app.event


Branch: refs/heads/master
Date: 2016-09-28T00:08:17-05:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.event/commit/f6da96518d18fedd59e694dccc80fbeb9a494afc

Merge pull request #247 from plone/thet-rmplone4compat

Really remove Plone 4 compatibility code

Files changed:
M CHANGES.rst
M README.rst
M docs/installation.rst
M plone/app/event/configure.zcml
M plone/app/event/dx/behaviors.py
M plone/app/event/testing.py
M plone/app/event/tests/test_portlet_calendar.py
M plone/app/event/tests/test_portlet_events.py
M setup.py
D buildout-43.cfg
D plone/app/event/bbb/__init__.py
D plone/app/event/bbb/browser/__init__.py
D plone/app/event/bbb/browser/configure.zcml
D plone/app/event/bbb/browser/controlpanel.py
D plone/app/event/bbb/configure.zcml
D plone/app/event/bbb/interfaces.py
D plone/app/event/bbb/portlets/__init__.py
D plone/app/event/bbb/portlets/configure.zcml
D plone/app/event/bbb/portlets/portlet_calendar.js
D plone/app/event/bbb/portlets/portlet_calendar.pt
D plone/app/event/bbb/portlets/portlet_calendar.py
D plone/app/event/bbb/portlets/portlet_events.pt
D plone/app/event/bbb/portlets/portlet_events.py
D plone/app/event/bbb/profiles/default/controlpanel.xml
D plone/app/event/bbb/profiles/default/jsregistry.xml
D plone/app/event/bbb/profiles/default/metadata.xml
D plone/app/event/bbb/profiles/default/plone.app.event.bbb.txt
D plone/app/event/bbb/profiles/default/registry.xml
D plone/app/event/bbb/setuphandlers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3a2be01..7627fe4 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,8 @@ Changelog
 
 Breaking changes:
 
-- *add item here*
+- Really remove Plone 4 compatibility code.
+  [thet]
 
 New features:
 
diff --git a/README.rst b/README.rst
index 6579029..2f57a90 100644
--- a/README.rst
+++ b/README.rst
@@ -17,8 +17,4 @@ For Standalone installation follow the standard buildout procedure::
     $ ./bin/pip install -U zc.buildout setuptools pip
     $ ./bin/buildout
 
-For Plone 4.3 do::
-
-    $ ./bin/buildout -c buildout-43.cfg
-
 Note, both commands will install a test and development environment.
diff --git a/buildout-43.cfg b/buildout-43.cfg
deleted file mode 100644
index ed83bf5..0000000
--- a/buildout-43.cfg
+++ /dev/null
@@ -1,130 +0,0 @@
-[buildout]
-extends =
-    https://raw.githubusercontent.com/plone/buildout.coredev/4.3/versions.cfg
-parts =
-    instance
-# DEV
-    i18ndude
-    omelette
-    zopepy
-    sphinx
-    checkversions
-# TESTING
-    test
-    coverage-test
-    coverage-report
-    robot
-
-auto-checkout =
-    Products.DateRecurringIndex
-    icalendar
-    jquery.recurrenceinput.js
-    plone.app.event
-    plone.event
-    plone.formwidget.recurrence
-
-extensions += mr.developer
-sources-dir = ${buildout:directory}/devsrc
-develop = .
-versions = versions
-
-# One of: CRITICAL, ERROR, WARNING, INFO, DEBUG, NOTSET
-log-level = INFO
-
-
-[instance]
-recipe = plone.recipe.zope2instance
-user = admin:admin
-environment-vars = zope_i18n_compile_mo_files true
-eggs =
-    Plone
-    Pillow
-    plone.app.event
-# DEVELOPMENT
-    plone.reload
-    plone.app.debugtoolbar
-
-
-# DEVELOPMENT
-
-[sources]
-Products.DateRecurringIndex  = git git@github.com:collective/Products.DateRecurringIndex.git
-icalendar                    = git git@github.com:collective/icalendar.git
-jquery.recurrenceinput.js    = git git@github.com:collective/jquery.recurrenceinput.js.git egg=false
-plone.event                  = git git@github.com:plone/plone.event.git
-plone.formwidget.recurrence  = git git@github.com:plone/plone.formwidget.recurrence.git branch=1.x
-# Looks like, `develop = .` doesn't work well with mr.developer. So we checkout
-# plone.app.event to the buildout directory path.
-plone.app.event = git git@github.com:plone/plone.app.event.git branch=master full-path=${buildout:directory}
-
-[i18ndude]
-unzip = true
-recipe = zc.recipe.egg
-eggs = i18ndude
-
-[omelette]
-recipe = collective.recipe.omelette
-eggs =
-    ${instance:eggs}
-    ${test:eggs}
-    ${robot:eggs}
-
-[zopepy]
-recipe = zc.recipe.egg
-eggs =
-    ${instance:eggs}
-    ${test:eggs}
-    ${robot:eggs}
-interpreter = zopepy
-scripts = zopepy
-
-[sphinx]
-recipe = collective.recipe.sphinxbuilder
-source = ${buildout:directory}/docs
-interpreter = ${buildout:directory}/bin/zopepy
-
-[checkversions]
-recipe=zc.recipe.egg
-eggs=z3c.checkversions [buildout]
-
-
-# TESTING
-
-[environment]
-BUILDOUT_DIR = ${buildout:directory}
-zope_i18n_compile_mo_files = true
-
-[test]
-recipe = zc.recipe.testrunner
-defaults = ['--auto-color', '--auto-progress']
-eggs =
-    Products.DateRecurringIndex [test]
-    icalendar [test]
-    plone.app.event [test]
-    plone.event [test]
-    plone.formwidget.recurrence [test]
-environment = environment
-
-[coverage-test]
-recipe = zc.recipe.testrunner
-eggs = ${test:eggs}
-defaults = ['--coverage', '../../coverage', '-v', '--auto-progress']
-
-[coverage-report]
-recipe = zc.recipe.egg
-eggs = z3c.coverage
-scripts = coveragereport
-arguments = ('coverage', 'report')
-
-[robot]
-recipe = zc.recipe.egg
-eggs =
-    ${instance:eggs}
-    plone.app.robotframework [debug]
-
-
-# ALL
-
-[versions]
-setuptools =
-zc.buildout =
diff --git a/docs/installation.rst b/docs/installation.rst
index 672aa9c..c7f7555 100644
--- a/docs/installation.rst
+++ b/docs/installation.rst
@@ -1,44 +1,6 @@
 Installation
 ============
 
-Compatibility
--------------
-
-plone.app.event 2.0 is a rewrite of plone.app.event 1.x and fixes some issues.  See Changelog.rst.
-
-The following is a compatibility map of all current plone.app.event versions:
-
-===============  ======  ==========  =================  ======================  ==========
-plone.app.event            Plone     plone.app.widgets  plone.app.contenttypes  Archetypes
----------------  ------  ----------  -----------------  ----------------------  ----------
-version          branch
-===============  ======  ==========  =================  ======================  ==========
-1.1.x            1.1.x   Plone 4.3+         No                   1.1.x              Yes
-1.2.x            1.2.x   Plone 4.3+      >= 1.4.0              < 1.2a3              Yes
-2.x              master  Plone 4.3+      >= 1.7.0             >= 1.2a3              No
-===============  ======  ==========  =================  ======================  ==========
-
-
-Buildout files
---------------
-
-- ``buildout.cfg``: Base installation for Plone 5.
-
-- ``buildout-43.cfg``: Base installation for Plone 4.3.
-
-- ``dev.cfg``: Development configuration, including tests, for Plone 5.
-
-- ``test.cfg``: Test build for Plone 5.
-
-- ``test-43.cfg``: Test build for Plone 4.3.
-
-- ``sources.cfg``: mr.developer source definitions.
-
-- ``versions.cfg``: Recommended version requirements.
-
-
-Installation
-------------
 
 ``plone.app.event`` only provides Dexterity behaviors to build own types based on them.  If you want to install a Dexterity based Event type, you can simply use ``plone.app.contenttypes`` 1.2a3 or up.
 
diff --git a/plone/app/event/bbb/__init__.py b/plone/app/event/bbb/__init__.py
deleted file mode 100644
index e69de29..0000000
diff --git a/plone/app/event/bbb/browser/__init__.py b/plone/app/event/bbb/browser/__init__.py
deleted file mode 100644
index e69de29..0000000
diff --git a/plone/app/event/bbb/browser/configure.zcml b/plone/app/event/bbb/browser/configure.zcml
deleted file mode 100644
index f9f3a9e..0000000
--- a/plone/app/event/bbb/browser/configure.zcml
+++ /dev/null
@@ -1,13 +0,0 @@
-<configure
-    xmlns="http://namespaces.zope.org/zope"
-    xmlns:browser="http://namespaces.zope.org/browser">
-
-  <!-- Date and Time Control panel -->
-  <browser:page
-      name="dateandtime-controlpanel"
-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"
-      class=".controlpanel.DateAndTimeControlPanel"
-      permission="plone.app.controlpanel.Site"
-      />
-
-</configure>
diff --git a/plone/app/event/bbb/browser/controlpanel.py b/plone/app/event/bbb/browser/controlpanel.py
deleted file mode 100644
index d2d2f0e..0000000
--- a/plone/app/event/bbb/browser/controlpanel.py
+++ /dev/null
@@ -1,22 +0,0 @@
-from Products.CMFPlone import PloneMessageFactory as _
-from plone.app.event.bbb.interfaces import IDateAndTimeSchema
-from plone.app.registry.browser.controlpanel import ControlPanelFormWrapper
-from plone.app.registry.browser.controlpanel import RegistryEditForm
-
-
-class DateAndTimeControlPanelForm(RegistryEditForm):
-
-    id = "DateAndTimeControlPanel"
-    label = _(u"Date and Time Settings")
-    schema = IDateAndTimeSchema
-    schema_prefix = "plone"
-
-    label = _(u"label_dateandtime_settings", default=u"Date and Time Settings")
-    description = _(
-        u"help_event_settings",
-        default=u"Date and Time related settings like timezone(s), etc."
-    )
-
-
-class DateAndTimeControlPanel(ControlPanelFormWrapper):
-    form = DateAndTimeControlPanelForm
diff --git a/plone/app/event/bbb/configure.zcml b/plone/app/event/bbb/configure.zcml
deleted file mode 100644
index 05e91e7..0000000
--- a/plone/app/event/bbb/configure.zcml
+++ /dev/null
@@ -1,28 +0,0 @@
-<configure
-    xmlns="http://namespaces.zope.org/zope"
-    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"
-    i18n_domain="plone.app.event">
-
-  <include package="plone.app.widgets" />
-
-  <include package=".browser" />
-  <include package=".portlets" />
-
-  <genericsetup:registerProfile
-      name="default"
-      title="plone.app.event (support for Plone 4)"
-      directory="profiles/default"
-      description="plone.app.event framework registration."
-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"
-      provides="Products.GenericSetup.interfaces.EXTENSION"
-      />
-
-  <genericsetup:importStep
-      name="plone.app.event-bbb"
-      handler=".setuphandlers.setup_misc"
-      title="plone.app.event-bbb misc"
-      description="first_weekday setup">
-    <depends name="plone.app.registry" />
-  </genericsetup:importStep>
-
-</configure>
diff --git a/plone/app/event/bbb/interfaces.py b/plone/app/event/bbb/interfaces.py
deleted file mode 100644
index e26313a..0000000
--- a/plone/app/event/bbb/interfaces.py
+++ /dev/null
@@ -1,39 +0,0 @@
-from Products.CMFPlone import PloneMessageFactory as _
-from zope import schema
-from zope.interface import Interface
-
-
-class IDateAndTimeSchema(Interface):
-    """Control panel settings for date and time related settings.
-    """
-
-    portal_timezone = schema.Choice(
-        title=_(u"Portal default timezone"),
-        description=_(
-            u"help_portal_timezone",
-            default=u"The timezone setting of the portal. Users can set "
-                    u"their own timezone, if available timezones are "
-                    u"defined."),
-        required=True,
-        default=None,
-        vocabulary="plone.app.vocabularies.CommonTimezones")
-
-    available_timezones = schema.List(
-        title=_(u"Available timezones"),
-        description=_(
-            u"help_available_timezones",
-            default=u"The timezones, which should be available for the "
-                    u"portal. Can be set for users and events"),
-        required=False,
-        default=[],
-        value_type=schema.Choice(
-            vocabulary="plone.app.vocabularies.Timezones"))
-
-    first_weekday = schema.Choice(
-        title=_(u'label_first_weekday', default=u'First Weekday'),
-        description=_(
-            u'help_first_weekday',
-            default=u'First day in the Week.'),
-        required=True,
-        default=None,
-        vocabulary="plone.app.vocabularies.Weekdays")
\ No newline at end of file
diff --git a/plone/app/event/bbb/portlets/__init__.py b/plone/app/event/bbb/portlets/__init__.py
deleted file mode 100644
index e69de29..0000000
diff --git a/plone/app/event/bbb/portlets/configure.zcml b/plone/app/event/bbb/portlets/configure.zcml
deleted file mode 100644
index d46fdcf..0000000
--- a/plone/app/event/bbb/portlets/configure.zcml
+++ /dev/null
@@ -1,30 +0,0 @@
-<configure xmlns="http://namespaces.zope.org/zope"
-           xmlns:browser="http://namespaces.zope.org/browser"
-           xmlns:plone="http://namespaces.plone.org/plone"
-           i18n_domain="plone.app.event">
-
-  <browser:resource
-      name="plone.app.event.portlet_calendar.js"
-      file="portlet_calendar.js"
-      permission="zope.Public"
-      />
-
-  <plone:portlet
-      name="portlets.Calendar"
-      interface="..portlets.portlet_calendar.ICalendarPortlet"
-      assignment="..portlets.portlet_calendar.Assignment"
-      renderer=".portlet_calendar.Renderer"
-      addview=".portlet_calendar.AddForm"
-      editview=".portlet_calendar.EditForm"
-      />
-
-  <plone:portlet
-      name="portlets.Events"
-      interface="..portlets.portlet_events.IEventsPortlet"
-      assignment="..portlets.portlet_events.Assignment"
-      renderer=".portlet_events.Renderer"
-      addview=".portlet_events.AddForm"
-      editview=".portlet_events.EditForm"
-      />
-
-</configure>
diff --git a/plone/app/event/bbb/portlets/portlet_calendar.js b/plone/app/event/bbb/portlets/portlet_calendar.js
deleted file mode 100644
index d50b880..0000000
--- a/plone/app/event/bbb/portlets/portlet_calendar.js
+++ /dev/null
@@ -1,45 +0,0 @@
-/*jslint browser: true*/
-/*global $, jQuery, plone, portal_url */
-
-(function ($) {
-
-    function load_portlet_calendar(event, elem) {
-        // depends on plone_javascript_variables.js for portal_url
-        event.preventDefault();
-        var pw, elem_data, portlethash, url;
-        pw = elem.closest('.portletWrapper');
-        elem_data = elem.data();
-        portlethash = pw.attr('id');
-        portlethash = portlethash.substring(15, portlethash.length);
-        url = portal_url +
-              '/@@render-portlet?portlethash=' + portlethash +
-              '&year=' + elem_data.year +
-              '&month=' + elem_data.month;
-        $.ajax({
-            url: url,
-            success: function (data) {
-                pw.html(data);
-                rebind_portlet_calendar();
-            }
-        });
-    }
-
-    function rebind_portlet_calendar() {
-        // ajaxify each portletCalendar
-        $('.portletCalendar a.calendarNext').click(function (event) {
-            load_portlet_calendar(event, $(this));
-        });
-        $('.portletCalendar a.calendarPrevious').click(function (event) {
-            load_portlet_calendar(event, $(this));
-        });
-        $('.portletCalendar dd a[title]').tooltip({
-            offset: [-10, 0],
-            tipClass: 'pae_calendar_tooltip'
-        });
-    }
-
-    $(document).ready(function () {
-        rebind_portlet_calendar();
-    });
-
-}(jQuery));
diff --git a/plone/app/event/bbb/portlets/portlet_calendar.pt b/plone/app/event/bbb/portlets/portlet_calendar.pt
deleted file mode 100644
index f67d98b..0000000
--- a/plone/app/event/bbb/portlets/portlet_calendar.pt
+++ /dev/null
@@ -1,83 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      i18n:domain="plone"
-      tal:omit-tag="">
-<dl class="portlet portletCalendar"
-    tal:define="navigation_root_url context/@@plone_portal_state/navigation_root_url;
-                month view/month;
-                year view/year;">
-
-    <dt class="portletHeader">
-      <span class="portletTopLeft"></span>
-      <a href="#" rel="nofollow"
-           class="calendarPrevious"
-           title="Previous month"
-           tal:define="prev_month view/prev_month;
-                       prev_year view/prev_year"
-           tal:attributes="href view/prev_query;
-                           data-year prev_year;
-                           data-month prev_month;"
-           i18n:attributes="title title_previous_month;">&laquo;</a>
-
-        <span i18n:translate="" tal:omit-tag="">
-            <span i18n:name="monthname" i18n:translate=""
-                  tal:content="view/month_name"
-                  tal:omit-tag="">monthname</span>
-            <span i18n:name="year" i18n:translate=""
-                  tal:content="year"
-                  tal:omit-tag="">year</span>
-        </span>
-
-        <a href="#" rel="nofollow"
-           class="calendarNext"
-           title="Next month"
-           tal:define="next_month view/next_month;
-                       next_year view/next_year"
-           tal:attributes="href view/next_query;
-                           data-year next_year;
-                           data-month next_month;"
-           i18n:attributes="title title_next_month;">&raquo;</a>
-        <span class="portletTopRight"></span>
-    </dt>
-
-    <dd class="portletItem">
-        <table class="ploneCalendar" summary="Calendar"
-            i18n:attributes="summary summary_calendar">
-            <caption class="hiddenStructure"
-                i18n:translate="" tal:content="string:month-${month}">monthname</caption>
-            <thead>
-              <tr class="weekdays"><tal:data repeat="weekday view/weekdays">
-                <th scope="col" i18n:translate="" tal:content="weekday">Su</th>
-              </tal:data></tr>
-            </thead>
-            <tbody>
-              <tr tal:repeat="week view/cal_data">
-                <tal:block repeat="day week">
-                <td class="event"
-                  tal:define="today day/today;
-                              next_month day/next_month;
-                              prev_month day/prev_month;
-                              events day/events;
-                              limit python:len(events) if events is not None else 0"
-                  tal:attributes="class python:u'event%s%s%s%s' %
-                              ((' today' if today else ''),
-                              (' cal_next_month' if next_month else ''),
-                              (' cal_prev_month' if prev_month else ''),
-                              (' cal_has_events' if events else ''))">
-                    <a href=""
-                      tal:omit-tag="not:events"
-                      tal:attributes="href python:view.date_events_url(day['date_string']);
-                                      title day/events_string;"
-                      tal:content="day/day">31</a>
-
-                </td>
-                </tal:block>
-              </tr>
-            </tbody>
-        </table>
-        <span class="portletBottomLeft"></span>
-        <span class="portletBottomRight"></span>
-    </dd>
-</dl>
-</html>
diff --git a/plone/app/event/bbb/portlets/portlet_calendar.py b/plone/app/event/bbb/portlets/portlet_calendar.py
deleted file mode 100644
index e153b9d..0000000
--- a/plone/app/event/bbb/portlets/portlet_calendar.py
+++ /dev/null
@@ -1,46 +0,0 @@
-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
-from distutils.version import LooseVersion
-from plone.app.event.portlets.portlet_calendar import Assignment
-from plone.app.event.portlets.portlet_calendar import ICalendarPortlet
-from plone.app.event.portlets.portlet_calendar import Renderer as RendererBase
-from plone.app.portlets import PloneMessageFactory as _
-import pkg_resources
-
-
-version = LooseVersion(pkg_resources.require("plone.app.portlets")[0].version)
-wanted = LooseVersion('3.0')
-
-
-if version >= wanted:
-    P_A_PORTLETS_PRE_3 = False
-    from plone.app.portlets.portlets import base
-else:
-    P_A_PORTLETS_PRE_3 = True
-    from z3c.form import field
-    from plone.app.portlets.browser import z3cformhelper as base
-
-
-class Renderer(RendererBase):
-    render = ViewPageTemplateFile('portlet_calendar.pt')
-
-
-class AddForm(base.AddForm):
-    if P_A_PORTLETS_PRE_3:
-        fields = field.Fields(ICalendarPortlet)
-    else:
-        schema = ICalendarPortlet
-    label = _(u"Add Calendar Portlet")
-    description = _(u"This portlet displays events in a calendar.")
-
-    def create(self, data):
-        return Assignment(state=data.get('state', None),
-                          search_base_uid=data.get('search_base_uid', None))
-
-
-class EditForm(base.EditForm):
-    if P_A_PORTLETS_PRE_3:
-        fields = field.Fields(ICalendarPortlet)
-    else:
-        schema = ICalendarPortlet
-    label = _(u"Edit Calendar Portlet")
-    description = _(u"This portlet displays events in a calendar.")
diff --git a/plone/app/event/bbb/portlets/portlet_events.pt b/plone/app/event/bbb/portlets/portlet_events.pt
deleted file mode 100644
index 835db64..0000000
--- a/plone/app/event/bbb/portlets/portlet_events.pt
+++ /dev/null
@@ -1,71 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      tal:omit-tag="">
-<dl class="portlet portletEvents"
-    i18n:domain="plone.app.event">
-
-    <dt class="portletHeader">
-        <span class="portletTopLeft"></span>
-        <a href=""
-           class="tile"
-           tal:define="next_link view/next_url"
-           tal:omit-tag="not:next_link"
-           tal:attributes="href next_link"
-           i18n:translate="box_events">
-            Upcoming Events
-        </a>
-        <span class="portletTopRight"></span>
-    </dt>
-
-    <tal:events repeat="item view/events">
-    <dd class="portletItem"
-        tal:define="oddrow repeat/item/odd"
-        tal:attributes="class python:'portletItem oddrow' if oddrow else 'portletItem even'">
-        <a href="#" class="tile"
-            tal:attributes="href item/url;
-                            title item/description">
-            <span tal:replace="item/title">
-                Some Event
-            </span>
-        </a>
-        <span class="portletItemDetails">
-            <tal:date replace="structure python:view.formatted_date(item)" />
-            <span class="timezone"
-                tal:define="tz item/timezone"
-                tal:condition="tz">
-                (<tal:tzname replace="tz">TZ</tal:tzname>)
-            </span>
-            <span class="location"
-                tal:condition="item/location"> &mdash;
-                <tal:location content="item/location">Location</tal:location>
-            </span>
-        </span>
-    </dd>
-    </tal:events>
-
-    <dd class="portletFooter"
-        tal:define="prev_link view/prev_url"
-        tal:condition="prev_link">
-        <a href=""
-            tal:attributes="href prev_link"
-            class="tile">
-            <span i18n:translate="box_previous_events">
-                Previous events&hellip;
-            </span>
-        </a>
-    </dd>
-
-    <dd class="portletFooter">
-        <a href=""
-            class="tile"
-            tal:define="next_link view/next_url"
-            tal:attributes="href next_link"
-            i18n:translate="box_upcoming_events">
-            Upcoming events&hellip;
-        </a>
-        <span class="portletBottomLeft"></span>
-        <span class="portletBottomRight"></span>
-    </dd>
-</dl>
-</html>
diff --git a/plone/app/event/bbb/portlets/portlet_events.py b/plone/app/event/bbb/portlets/portlet_events.py
deleted file mode 100644
index d1c6ceb..0000000
--- a/plone/app/event/bbb/portlets/portlet_events.py
+++ /dev/null
@@ -1,47 +0,0 @@
-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
-from distutils.version import LooseVersion
-from plone.app.event.portlets.portlet_events import Assignment
-from plone.app.event.portlets.portlet_events import IEventsPortlet
-from plone.app.event.portlets.portlet_events import Renderer as RendererBase
-from plone.app.portlets import PloneMessageFactory as _
-import pkg_resources
-
-
-version = LooseVersion(pkg_resources.require("plone.app.portlets")[0].version)
-wanted = LooseVersion('3.0')
-
-
-if version >= wanted:
-    P_A_PORTLETS_PRE_3 = False
-    from plone.app.portlets.portlets import base
-else:
-    P_A_PORTLETS_PRE_3 = True
-    from z3c.form import field
-    from plone.app.portlets.browser import z3cformhelper as base
-
-
-class Renderer(RendererBase):
-    render = ViewPageTemplateFile('portlet_events.pt')
-
-
-class AddForm(base.AddForm):
-    if P_A_PORTLETS_PRE_3:
-        fields = field.Fields(IEventsPortlet)
-    else:
-        schema = IEventsPortlet
-    label = _(u"Add Events Portlet")
-    description = _(u"This portlet lists upcoming Events.")
-
-    def create(self, data):
-        return Assignment(count=data.get('count', 5),
-                          state=data.get('state', None),
-                          search_base_uid=data.get('search_base_uid', 5))
-
-
-class EditForm(base.EditForm):
-    if P_A_PORTLETS_PRE_3:
-        fields = field.Fields(IEventsPortlet)
-    else:
-        schema = IEventsPortlet
-    label = _(u"Edit Events Portlet")
-    description = _(u"This portlet lists upcoming Events.")
diff --git a/plone/app/event/bbb/profiles/default/controlpanel.xml b/plone/app/event/bbb/profiles/default/controlpanel.xml
deleted file mode 100644
index 92fc186..0000000
--- a/plone/app/event/bbb/profiles/default/controlpanel.xml
+++ /dev/null
@@ -1,11 +0,0 @@
-<?xml version="1.0"?>
-<object name="portal_controlpanel" meta_type="Plone Control Panel Tool"
-        i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">
-  <configlet title="Date and Time" action_id="DateAndTime" appId="DateAndTime"
-             category="Plone" condition_expr=""
-             icon_expr="string:$portal_url/event_icon.png"
-             url_expr="string:${portal_url}/@@dateandtime-controlpanel" visible="True"
-             i18n:attributes="title">
-    <permission>Plone Site Setup: Site</permission>
-  </configlet>
-</object>
diff --git a/plone/app/event/bbb/profiles/default/jsregistry.xml b/plone/app/event/bbb/profiles/default/jsregistry.xml
deleted file mode 100644
index a89a810..0000000
--- a/plone/app/event/bbb/profiles/default/jsregistry.xml
+++ /dev/null
@@ -1,13 +0,0 @@
-<?xml version="1.0"?>
-<object name="portal_javascripts" meta_type="JavaScripts Registry">
-
-  <javascript
-      cacheable="True"
-      compression="safe"
-      cookable="True"
-      enabled="True"
-      id="++resource++plone.app.event.portlet_calendar.js"
-      inline="False"
-      />
-
-</object>
diff --git a/plone/app/event/bbb/profiles/default/metadata.xml b/plone/app/event/bbb/profiles/default/metadata.xml
deleted file mode 100644
index 18e6296..0000000
--- a/plone/app/event/bbb/profiles/default/metadata.xml
+++ /dev/null
@@ -1,8 +0,0 @@
-<?xml version="1.0"?>
-<metadata>
-  <version>1</version>
-  <dependencies>
-    <dependency>profile-plone.app.widgets:default</dependency>
-    <dependency>profile-plone.app.event:default</dependency>
-  </dependencies>
-</metadata>
diff --git a/plone/app/event/bbb/profiles/default/plone.app.event.bbb.txt b/plone/app/event/bbb/profiles/default/plone.app.event.bbb.txt
deleted file mode 100644
index e69de29..0000000
diff --git a/plone/app/event/bbb/profiles/default/registry.xml b/plone/app/event/bbb/profiles/default/registry.xml
deleted file mode 100644
index f7c746b..0000000
--- a/plone/app/event/bbb/profiles/default/registry.xml
+++ /dev/null
@@ -1,5 +0,0 @@
-<?xml version="1.0"?>
-<registry>
-  <records interface="plone.app.event.bbb.interfaces.IDateAndTimeSchema"
-           prefix="plone" />
-</registry>
diff --git a/plone/app/event/bbb/setuphandlers.py b/plone/app/event/bbb/setuphandlers.py
deleted file mode 100644
index 09e9ce8..0000000
--- a/plone/app/event/bbb/setuphandlers.py
+++ /dev/null
@@ -1,38 +0,0 @@
-from plone.registry.interfaces import IRegistry
-from zope.component import getUtility
-from zope.component.hooks import getSite
-from zope.i18n.locales import locales, LoadLocaleError
-
-
-def first_weekday_setup(context):
-    """Set the first day of the week based on the portal's locale.
-    """
-    reg = getUtility(IRegistry)
-    if "plone.first_weekday" in reg and reg["plone.first_weekday"] is not None:
-        # don't overwrite if it's already set
-        return
-
-    first = 6
-    try:
-        site = getSite()
-        # find the locale implied by the portal's language
-        language = site.Language()
-        parts = (language.split('-') + [None, None])[:3]
-        locale = locales.getLocale(*parts)
-        # look up first day of week
-        gregorian_calendar = locale.dates.calendars.get(u'gregorian', None)
-        if gregorian_calendar is not None:
-            day = gregorian_calendar.week.get('firstDay', 7)
-            first = 6 if day == 0 else day - 1
-    except LoadLocaleError:
-        # If we cannot get the locale, just Sunday as first weekday
-        pass
-
-    # save setting
-    reg['plone.first_weekday'] = first
-
-
-def setup_misc(context):
-    if context.readDataFile('plone.app.event.bbb.txt') is None:
-        return
-    first_weekday_setup(context)
diff --git a/plone/app/event/configure.zcml b/plone/app/event/configure.zcml
index 959d631..c325c32 100644
--- a/plone/app/event/configure.zcml
+++ b/plone/app/event/configure.zcml
@@ -24,7 +24,6 @@
   <include package=".ical" />
   <include file="recurrence.zcml" />
   <include package=".upgrades" />
-  <include package=".bbb" zcml:condition="not-have plone-5" />
 
   <utility
       component=".vocabularies.SynchronizationStrategies"
diff --git a/plone/app/event/dx/behaviors.py b/plone/app/event/dx/behaviors.py
index 325688a..3b35f7c 100644
--- a/plone/app/event/dx/behaviors.py
+++ b/plone/app/event/dx/behaviors.py
@@ -13,6 +13,7 @@
 from plone.app.event.dx.interfaces import IDXEvent
 from plone.app.event.dx.interfaces import IDXEventRecurrence
 from plone.app.textfield.value import RichTextValue
+from plone.app.z3cform.widget import DatetimeFieldWidget
 from plone.autoform import directives
 from plone.autoform.interfaces import IFormFieldProvider
 from plone.event.interfaces import IEventAccessor
@@ -23,7 +24,6 @@
 from plone.supermodel import model
 from plone.uuid.interfaces import IUUID
 from Products.CMFCore.utils import getToolByName
-from Products.CMFPlone.utils import getFSVersionTuple
 from Products.CMFPlone.utils import safe_unicode
 from z3c.form.browser.checkbox import SingleCheckBoxFieldWidget
 from z3c.form.browser.text import TextFieldWidget
@@ -38,16 +38,6 @@
 from zope.schema.interfaces import IContextAwareDefaultFactory
 
 
-PLONE5 = getFSVersionTuple()[0] >= 5
-
-if PLONE5:
-    # Plone 5
-    from plone.app.z3cform.widget import DatetimeFieldWidget
-else:
-    # Plone 4
-    from plone.app.widgets.dx import DatetimeFieldWidget
-
-
 def first_weekday_sun0():
     return wkday_to_mon1(first_weekday())
 
diff --git a/plone/app/event/testing.py b/plone/app/event/testing.py
index 9239922..8c77026 100644
--- a/plone/app/event/testing.py
+++ b/plone/app/event/testing.py
@@ -1,4 +1,3 @@
-from Products.CMFPlone.utils import getFSVersionTuple
 from plone.app.event.interfaces import IBrowserLayer
 from plone.app.robotframework.testing import AUTOLOGIN_LIBRARY_FIXTURE
 from plone.app.testing import FunctionalTesting
@@ -13,9 +12,6 @@
 import os
 
 
-PLONE5 = getFSVersionTuple()[0] >= 5
-
-
 def set_browserlayer(request):
     """Set the BrowserLayer for the request.
 
@@ -80,8 +76,6 @@ def setUpZope(self, app, configurationContext):
 
     def setUpPloneSite(self, portal):
         self.applyProfile(portal, 'plone.app.event:default')
-        if not PLONE5:
-            self.applyProfile(portal, 'plone.app.event.bbb:default')
         set_timezone(tz='UTC')
 
     def tearDownZope(self, app):
@@ -118,8 +112,6 @@ def setUpZope(self, app, configurationContext):
 
     def setUpPloneSite(self, portal):
         self.applyProfile(portal, 'plone.app.contenttypes:default')
-        if not PLONE5:
-            self.applyProfile(portal, 'plone.app.event.bbb:default')
         self.applyProfile(portal, 'plone.app.event:testing')
         set_timezone(tz='UTC')
 
diff --git a/plone/app/event/tests/test_portlet_calendar.py b/plone/app/event/tests/test_portlet_calendar.py
index fd3e72f..433663f 100644
--- a/plone/app/event/tests/test_portlet_calendar.py
+++ b/plone/app/event/tests/test_portlet_calendar.py
@@ -1,6 +1,5 @@
 # -*- coding: utf-8 -*-
 from Products.CMFCore.utils import getToolByName
-from Products.CMFPlone.utils import getFSVersionTuple
 from Products.GenericSetup.utils import _getDottedName
 from calendar import monthrange
 from datetime import datetime
@@ -30,11 +29,6 @@
 
 TZNAME = 'Europe/Vienna'
 PTYPE = 'plone.app.event.dx.event'
-PLONE5 = getFSVersionTuple()[0] >= 5
-
-if not PLONE5:
-    from plone.app.event.bbb.portlets \
-        import portlet_calendar as bbb_portlet_calendar
 
 
 class PortletTest(unittest.TestCase):
@@ -97,11 +91,7 @@ def testRenderer(self):
             (context, self.request, view, manager, assignment),
             IPortletRenderer
         )
-        if PLONE5:
-            self.assertTrue(isinstance(renderer, portlet_calendar.Renderer))
-        else:
-            self.assertTrue(isinstance(renderer,
-                                       bbb_portlet_calendar.Renderer))
+        self.assertTrue(isinstance(renderer, portlet_calendar.Renderer))
 
 
 class RendererTest(unittest.TestCase):
diff --git a/plone/app/event/tests/test_portlet_events.py b/plone/app/event/tests/test_portlet_events.py
index 14b4915..c269883 100644
--- a/plone/app/event/tests/test_portlet_events.py
+++ b/plone/app/event/tests/test_portlet_events.py
@@ -1,4 +1,3 @@
-from Products.CMFPlone.utils import getFSVersionTuple
 from Products.CMFCore.utils import getToolByName
 from Products.GenericSetup.utils import _getDottedName
 from datetime import datetime
@@ -30,11 +29,6 @@
 
 TZNAME = 'Australia/Brisbane'
 PTYPE = 'plone.app.event.dx.event'
-PLONE5 = getFSVersionTuple()[0] >= 5
-
-if not PLONE5:
-    from plone.app.event.bbb.portlets \
-        import portlet_events as bbb_portlet_events
 
 
 class PortletTest(unittest.TestCase):
@@ -89,11 +83,7 @@ def testInvokeEditView(self):
 
         mapping['foo'] = portlet_events.Assignment(count=5)
         editview = getMultiAdapter((mapping['foo'], self.request), name='edit')
-        if PLONE5:
-            self.assertTrue(isinstance(editview, portlet_events.EditForm))
-        else:
-            self.assertTrue(isinstance(editview, bbb_portlet_events.EditForm))
-
+        self.assertTrue(isinstance(editview, portlet_events.EditForm))
 
     def testRenderer(self):
         context = self.portal
@@ -107,10 +97,7 @@ def testRenderer(self):
             (context, self.request, view, manager, assignment),
             IPortletRenderer
         )
-        if PLONE5:
-            self.assertTrue(isinstance(renderer, portlet_events.Renderer))
-        else:
-            self.assertTrue(isinstance(renderer, bbb_portlet_events.Renderer))
+        self.assertTrue(isinstance(renderer, portlet_events.Renderer))
 
     def test_disable_dasboard_breaks_event_portlet(self):
         # Bug #8230: disabling the dashboard breaks the event portlet
diff --git a/setup.py b/setup.py
index 4adb6e3..00c8fa5 100644
--- a/setup.py
+++ b/setup.py
@@ -19,6 +19,7 @@
     classifiers=[
         "Development Status :: 4 - Beta",
         "Framework :: Plone",
+        "Framework :: Plone :: 5.1",
         "Programming Language :: Python :: 2.7",
         "License :: OSI Approved :: GNU General Public License v2 (GPLv2)"
     ],
@@ -99,9 +100,6 @@
             'zExceptions',
             'zope.event',
         ],
-        'plone43': [
-            'plone.app.widgets [dexterity] >= 1.7.0',
-        ]
     },
     entry_points="""
     [z3c.autoinclude.plugin]


