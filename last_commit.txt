Repository: mockup


Branch: refs/heads/master
Date: 2017-08-16T13:15:38+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/mockup/commit/8037b8b1aa508a8cf8d0b2c4e724bc8bd4c89b34

Related Items: Simplify templates a bit.

Files changed:
M CHANGES.rst
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/templates/result.xml
M mockup/patterns/relateditems/templates/selection.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index 3c676156..91c2742b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -9,6 +9,9 @@ New features:
 - Added docs for the structureupdater pattern.
   [thet]
 
+- Related Items: Simplify templates a bit.
+  [thet]
+
 Incompatibile changes:
 
 - * Add item here *
diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js
index 273d2b1d..4667a6ec 100644
--- a/mockup/patterns/relateditems/pattern.js
+++ b/mockup/patterns/relateditems/pattern.js
@@ -271,7 +271,6 @@ define([
               'oneLevelUp': true,
               'Title': _t('One level up'),
               'path': path.slice(0, path.length - 1).join('/') || '/',
-              'portal_type': 'Folder',
               'is_folderish': true,
               'selectable': false
             }].concat(results);
@@ -494,6 +493,16 @@ define([
       Select2.prototype.initializeTags.call(self);
 
       self.options.formatSelection = function(item) {
+
+        item = $.extend(true, {
+            'Title': '',
+            'getIcon': '',
+            'getURL': '',
+            'path': '',
+            'portal_type': '',
+            'review_state': ''
+        }, item);
+
         // activate petterns on the result set.
         var $selection = $(self.applyTemplate('selection', item));
         if (self.options.scanSelection) {
@@ -507,6 +516,18 @@ define([
       self.options.formatResult = function(item) {
         item.selectable = self.isSelectable(item);
 
+        item = $.extend(true, {
+            'Title': '',
+            'getIcon': '',
+            'getURL': '',
+            'is_folderish': false,
+            'oneLevelUp': false,
+            'path': '',
+            'portal_type': '',
+            'review_state': '',
+            'selectable': false,
+        }, item);
+
         if (self.selectedUIDs.indexOf(item.UID) != -1) {
             // do not allow already selected items to be selected again.
             item.selectable = false;
diff --git a/mockup/patterns/relateditems/templates/result.xml b/mockup/patterns/relateditems/templates/result.xml
index 24b7cdcc..c9d89668 100644
--- a/mockup/patterns/relateditems/templates/result.xml
+++ b/mockup/patterns/relateditems/templates/result.xml
@@ -1,12 +1,12 @@
-<div class="pattern-relateditems-result<% if (typeof oneLevelUp !== 'undefined' && oneLevelUp) { %> one-level-up<% } %>">
+<div class="pattern-relateditems-result<% if (oneLevelUp) { %> one-level-up<% } %>">
   <span class="pattern-relateditems-buttons">
   <% if (is_folderish) { %>
     <a class="pattern-relateditems-result-browse" data-path="<%- path %>" title="<%- open_folder %>"></a>
   <% } %>
   </span>
-  <a class="pattern-relateditems-result-select<% if (selectable) { %> selectable<% } else if (browsing && is_folderish) { %> pattern-relateditems-result-browse<% } %><% if (typeof oneLevelUp !== 'undefined' && oneLevelUp) { %> one-level-up<% } %>" data-path="<%- path %>">
-    <% if (typeof getURL !== 'undefined' && ((typeof getIcon !== 'undefined' && getIcon === true) || portal_type === "Image")) { %><img class="pull-right" src="<%- getURL %>/@@images/image/icon "><br><% } %>
-  	<span class="pattern-relateditems-result-title contenttype-<%- portal_type.toLowerCase() %><% if (typeof review_state !== 'undefined') { %> state-<%- review_state %><% } %>"><%- Title %></span>
+  <a class="pattern-relateditems-result-select<% if (selectable) { %> selectable<% } else if (browsing && is_folderish) { %> pattern-relateditems-result-browse<% } %><% if (oneLevelUp) { %> one-level-up<% } %>" data-path="<%- path %>">
+    <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon "><br><% } %>
+    <span class="pattern-relateditems-result-title<%- portal_type ? ' contenttype-' + portal_type.toLowerCase() : '' %><%- review_state ? ' state-' + review_state : '' %>" title="<%- portal_type %>"><%- Title %></span>
     <span class="pattern-relateditems-result-path"><%- path %></span>
   </a>
 </div>
diff --git a/mockup/patterns/relateditems/templates/selection.xml b/mockup/patterns/relateditems/templates/selection.xml
index 7de1040f..93f40993 100644
--- a/mockup/patterns/relateditems/templates/selection.xml
+++ b/mockup/patterns/relateditems/templates/selection.xml
@@ -1,5 +1,5 @@
 <span class="pattern-relateditems-item">
-  <% if (typeof getURL !== 'undefined' && ((typeof getIcon !== 'undefined' && getIcon === true) || portal_type === "Image")) { %><img class="pull-right" src="<%- getURL %>/@@images/image/icon"><br><% } %>
-  <span class="pattern-relateditems-item-title contenttype-<%- portal_type.toLowerCase() %><% if (typeof review_state !== 'undefined') { %> state-<%- review_state %><% } %>"><%- Title %></span>
+  <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon"><br><% } %>
+  <span class="pattern-relateditems-item-title<%- portal_type ? ' contenttype-' + portal_type.toLowerCase() : '' %><%- review_state ? ' state-' + review_state : '' %>" title="<%- portal_type %>"><%- Title %></span>
   <span class="pattern-relateditems-item-path"><%- path %></span>
 </span>


Repository: mockup


Branch: refs/heads/master
Date: 2017-08-18T14:49:30+02:00
Author: agitator (agitator) <agitator@users.noreply.github.com>
Commit: https://github.com/plone/mockup/commit/1142d3797aab58a861c884505173a3b882f5d4ab

Merge pull request #797 from plone/thet-relateditems-simplify-templates

Related Items: Simplify templates a bit.

Files changed:
M CHANGES.rst
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/templates/result.xml
M mockup/patterns/relateditems/templates/selection.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index 3c676156..91c2742b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -9,6 +9,9 @@ New features:
 - Added docs for the structureupdater pattern.
   [thet]
 
+- Related Items: Simplify templates a bit.
+  [thet]
+
 Incompatibile changes:
 
 - * Add item here *
diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js
index 273d2b1d..4667a6ec 100644
--- a/mockup/patterns/relateditems/pattern.js
+++ b/mockup/patterns/relateditems/pattern.js
@@ -271,7 +271,6 @@ define([
               'oneLevelUp': true,
               'Title': _t('One level up'),
               'path': path.slice(0, path.length - 1).join('/') || '/',
-              'portal_type': 'Folder',
               'is_folderish': true,
               'selectable': false
             }].concat(results);
@@ -494,6 +493,16 @@ define([
       Select2.prototype.initializeTags.call(self);
 
       self.options.formatSelection = function(item) {
+
+        item = $.extend(true, {
+            'Title': '',
+            'getIcon': '',
+            'getURL': '',
+            'path': '',
+            'portal_type': '',
+            'review_state': ''
+        }, item);
+
         // activate petterns on the result set.
         var $selection = $(self.applyTemplate('selection', item));
         if (self.options.scanSelection) {
@@ -507,6 +516,18 @@ define([
       self.options.formatResult = function(item) {
         item.selectable = self.isSelectable(item);
 
+        item = $.extend(true, {
+            'Title': '',
+            'getIcon': '',
+            'getURL': '',
+            'is_folderish': false,
+            'oneLevelUp': false,
+            'path': '',
+            'portal_type': '',
+            'review_state': '',
+            'selectable': false,
+        }, item);
+
         if (self.selectedUIDs.indexOf(item.UID) != -1) {
             // do not allow already selected items to be selected again.
             item.selectable = false;
diff --git a/mockup/patterns/relateditems/templates/result.xml b/mockup/patterns/relateditems/templates/result.xml
index 24b7cdcc..c9d89668 100644
--- a/mockup/patterns/relateditems/templates/result.xml
+++ b/mockup/patterns/relateditems/templates/result.xml
@@ -1,12 +1,12 @@
-<div class="pattern-relateditems-result<% if (typeof oneLevelUp !== 'undefined' && oneLevelUp) { %> one-level-up<% } %>">
+<div class="pattern-relateditems-result<% if (oneLevelUp) { %> one-level-up<% } %>">
   <span class="pattern-relateditems-buttons">
   <% if (is_folderish) { %>
     <a class="pattern-relateditems-result-browse" data-path="<%- path %>" title="<%- open_folder %>"></a>
   <% } %>
   </span>
-  <a class="pattern-relateditems-result-select<% if (selectable) { %> selectable<% } else if (browsing && is_folderish) { %> pattern-relateditems-result-browse<% } %><% if (typeof oneLevelUp !== 'undefined' && oneLevelUp) { %> one-level-up<% } %>" data-path="<%- path %>">
-    <% if (typeof getURL !== 'undefined' && ((typeof getIcon !== 'undefined' && getIcon === true) || portal_type === "Image")) { %><img class="pull-right" src="<%- getURL %>/@@images/image/icon "><br><% } %>
-  	<span class="pattern-relateditems-result-title contenttype-<%- portal_type.toLowerCase() %><% if (typeof review_state !== 'undefined') { %> state-<%- review_state %><% } %>"><%- Title %></span>
+  <a class="pattern-relateditems-result-select<% if (selectable) { %> selectable<% } else if (browsing && is_folderish) { %> pattern-relateditems-result-browse<% } %><% if (oneLevelUp) { %> one-level-up<% } %>" data-path="<%- path %>">
+    <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon "><br><% } %>
+    <span class="pattern-relateditems-result-title<%- portal_type ? ' contenttype-' + portal_type.toLowerCase() : '' %><%- review_state ? ' state-' + review_state : '' %>" title="<%- portal_type %>"><%- Title %></span>
     <span class="pattern-relateditems-result-path"><%- path %></span>
   </a>
 </div>
diff --git a/mockup/patterns/relateditems/templates/selection.xml b/mockup/patterns/relateditems/templates/selection.xml
index 7de1040f..93f40993 100644
--- a/mockup/patterns/relateditems/templates/selection.xml
+++ b/mockup/patterns/relateditems/templates/selection.xml
@@ -1,5 +1,5 @@
 <span class="pattern-relateditems-item">
-  <% if (typeof getURL !== 'undefined' && ((typeof getIcon !== 'undefined' && getIcon === true) || portal_type === "Image")) { %><img class="pull-right" src="<%- getURL %>/@@images/image/icon"><br><% } %>
-  <span class="pattern-relateditems-item-title contenttype-<%- portal_type.toLowerCase() %><% if (typeof review_state !== 'undefined') { %> state-<%- review_state %><% } %>"><%- Title %></span>
+  <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon"><br><% } %>
+  <span class="pattern-relateditems-item-title<%- portal_type ? ' contenttype-' + portal_type.toLowerCase() : '' %><%- review_state ? ' state-' + review_state : '' %>" title="<%- portal_type %>"><%- Title %></span>
   <span class="pattern-relateditems-item-path"><%- path %></span>
 </span>


