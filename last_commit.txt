Repository: plone.app.layout


Branch: refs/heads/master
Date: 2019-02-27T17:07:26+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.layout/commit/d51e3f4939477e50a4c6d6831426db1d330c940c

fix tests since the default nav-depth is now 3 for new sites

Files changed:
M plone/app/layout/navigation/tests/test_navtree_provider.py

b"diff --git a/plone/app/layout/navigation/tests/test_navtree_provider.py b/plone/app/layout/navigation/tests/test_navtree_provider.py\nindex e8e431e1..d8233bf0 100644\n--- a/plone/app/layout/navigation/tests/test_navtree_provider.py\n+++ b/plone/app/layout/navigation/tests/test_navtree_provider.py\n@@ -33,8 +33,9 @@ def _get_navtree(self):\n         return adapter.navtree\n \n     def test_default_settings(self):\n+        self.assertEqual(self.registry['plone.navigation_depth'], 3)\n         navtree = self._get_navtree()\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             ['/plone/index_html', '/plone/Members'],\n@@ -57,7 +58,7 @@ def test_generate_tabs_non_folderish(self):\n             title=u'A simple document (\xc3\xa0\xc3\xa8\xc3\xac\xc3\xb2\xc3\xb9)',\n         )\n         navtree = self._get_navtree()\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             ['/plone/index_html', '/plone/Members'],\n@@ -76,7 +77,7 @@ def test_generate_tabs_sorted(self):\n         )\n         navtree = self._get_navtree()\n         # default sorting by position in parent\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             [\n@@ -90,7 +91,7 @@ def test_generate_tabs_sorted(self):\n         # check we can sort by title\n         self.registry['plone.sort_tabs_on'] = u'sortable_title'\n         navtree = self._get_navtree()\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             [\n@@ -104,7 +105,7 @@ def test_generate_tabs_sorted(self):\n         # check we can reverse sorting\n         self.registry['plone.sort_tabs_reversed'] = True\n         navtree = self._get_navtree()\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             [\n@@ -143,7 +144,7 @@ def test_generate_tabs_filter_on_state(self):\n         )\n         self.registry['plone.workflow_states_to_show'] = (u'private', )\n         navtree = self._get_navtree()\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             ['/plone/index_html', '/plone/Members'],\n"

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2019-02-27T17:10:03+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.layout/commit/74d235b10a9f1883e11b9b4bded0652993c31c53

add changelog

Files changed:
A news/187.bugfix

b'diff --git a/news/187.bugfix b/news/187.bugfix\nnew file mode 100644\nindex 00000000..1b3a4789\n--- /dev/null\n+++ b/news/187.bugfix\n@@ -0,0 +1,2 @@\n+Fix tests since the default nav-depth is now 3 for new sites.\n+[pbauer]\n\\ No newline at end of file\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2019-02-28T12:27:48+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.layout/commit/228773c54a79f47e4ec49d9c4277bdb6a241e57a

Merge branch 'master' into enable_dropdown_for_new_sites

Files changed:
A news/184.bugfix
M plone/app/layout/navigation/navtree.py

b'diff --git a/news/184.bugfix b/news/184.bugfix\nnew file mode 100644\nindex 00000000..940cdd3c\n--- /dev/null\n+++ b/news/184.bugfix\n@@ -0,0 +1,2 @@\n+Provide a proper unique id and a review state class for the first level tabs\n+[ale-rt]\ndiff --git a/plone/app/layout/navigation/navtree.py b/plone/app/layout/navigation/navtree.py\nindex bdce29b0..f6606d2d 100644\n--- a/plone/app/layout/navigation/navtree.py\n+++ b/plone/app/layout/navigation/navtree.py\n@@ -376,7 +376,6 @@ class NavTreeProvider(ContentProviderBase):\n     )\n     _item_markup_template = (\n         u\'<li class="{id}{has_sub_class}">\'\n-        u\'{opener}\'\n         u\'<a href="{url}" class="state-{review_state}"{aria_haspopup}>{title}</a>{opener}\'  # noqa: E 501\n         u\'{sub}\'\n         u\'</li>\'\n@@ -426,9 +425,10 @@ def navtree(self):\n             entry = tab.copy()\n             entry.update({\n                 \'path\': \'/\'.join((navtree_path, tab[\'id\'])),\n-                \'uid\': None,\n-                \'review_state\': None,\n+                \'uid\': tab[\'id\'],\n             })\n+            if \'review_state\' not in entry:\n+                entry[\'review_state\'] = None\n             if \'title\' not in entry:\n                 entry[\'title\'] = (\n                     tab.get(\'name\')\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2019-02-28T12:28:19+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.layout/commit/03aeb9343f6496650eb5c14cef71eb68c47ea6f4

Merge pull request #187 from plone/enable_dropdown_for_new_sites

fix tests since the default nav-depth is now 3 for new sites

Files changed:
A news/187.bugfix
M plone/app/layout/navigation/tests/test_navtree_provider.py

b"diff --git a/news/187.bugfix b/news/187.bugfix\nnew file mode 100644\nindex 00000000..1b3a4789\n--- /dev/null\n+++ b/news/187.bugfix\n@@ -0,0 +1,2 @@\n+Fix tests since the default nav-depth is now 3 for new sites.\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/plone/app/layout/navigation/tests/test_navtree_provider.py b/plone/app/layout/navigation/tests/test_navtree_provider.py\nindex e8e431e1..d8233bf0 100644\n--- a/plone/app/layout/navigation/tests/test_navtree_provider.py\n+++ b/plone/app/layout/navigation/tests/test_navtree_provider.py\n@@ -33,8 +33,9 @@ def _get_navtree(self):\n         return adapter.navtree\n \n     def test_default_settings(self):\n+        self.assertEqual(self.registry['plone.navigation_depth'], 3)\n         navtree = self._get_navtree()\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             ['/plone/index_html', '/plone/Members'],\n@@ -57,7 +58,7 @@ def test_generate_tabs_non_folderish(self):\n             title=u'A simple document (\xc3\xa0\xc3\xa8\xc3\xac\xc3\xb2\xc3\xb9)',\n         )\n         navtree = self._get_navtree()\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             ['/plone/index_html', '/plone/Members'],\n@@ -76,7 +77,7 @@ def test_generate_tabs_sorted(self):\n         )\n         navtree = self._get_navtree()\n         # default sorting by position in parent\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             [\n@@ -90,7 +91,7 @@ def test_generate_tabs_sorted(self):\n         # check we can sort by title\n         self.registry['plone.sort_tabs_on'] = u'sortable_title'\n         navtree = self._get_navtree()\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             [\n@@ -104,7 +105,7 @@ def test_generate_tabs_sorted(self):\n         # check we can reverse sorting\n         self.registry['plone.sort_tabs_reversed'] = True\n         navtree = self._get_navtree()\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             [\n@@ -143,7 +144,7 @@ def test_generate_tabs_filter_on_state(self):\n         )\n         self.registry['plone.workflow_states_to_show'] = (u'private', )\n         navtree = self._get_navtree()\n-        self.assertListEqual(sorted(navtree), ['/plone'])\n+        self.assertListEqual(sorted(navtree), ['/plone', '/plone/Members'])\n         self.assertListEqual(\n             [item['path'] for item in navtree['/plone']],\n             ['/plone/index_html', '/plone/Members'],\n"

