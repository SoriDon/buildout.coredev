Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-02T23:47:07+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/1048dfd784f337473b12d50b98b0d8d928893273

Configuring with plone/meta

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/5623f8b3.internal
A tox.ini
M pyproject.toml
M setup.cfg

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 0000000..b4158b8\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 0000000..4f67994\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "5623f8b3"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 0000000..449e951\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/news/5623f8b3.internal b/news/5623f8b3.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/5623f8b3.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615d..9eb73f3 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,43 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex c1ffe14..0da8f8f 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,7 +1,23 @@\n-[check-manifest]\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[bdist_wheel]\n+universal = 0\n+\n+[flake8]\n+doctests = 1\n ignore =\n-    *.cfg\n-    bootstrap.py\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n \n-[bdist_wheel]\n-universal = 1\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 0000000..88b1534\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,54 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --all --test-path={toxinidir} -s plone.app.iterate {posargs}\n+extras =\n+    test\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-02T23:49:38+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/8c04a122b4904fc3b2f5b00bcc1154f280a54cef

chore: pyupgrade

Files changed:
M plone/__init__.py
M plone/app/__init__.py
M plone/app/iterate/__init__.py
M plone/app/iterate/archiver.py
M plone/app/iterate/base.py
M plone/app/iterate/browser/__init__.py
M plone/app/iterate/browser/cancel.py
M plone/app/iterate/browser/checkin.py
M plone/app/iterate/browser/checkout.py
M plone/app/iterate/browser/control.py
M plone/app/iterate/browser/diff.py
M plone/app/iterate/browser/info.py
M plone/app/iterate/containers.py
M plone/app/iterate/dexterity/__init__.py
M plone/app/iterate/dexterity/copier.py
M plone/app/iterate/dexterity/interfaces.py
M plone/app/iterate/dexterity/policy.py
M plone/app/iterate/dexterity/relation.py
M plone/app/iterate/dexterity/utils.py
M plone/app/iterate/event.py
M plone/app/iterate/interfaces.py
M plone/app/iterate/lock.py
M plone/app/iterate/permissions.py
M plone/app/iterate/setuphandlers.py
M plone/app/iterate/subscribers/__init__.py
M plone/app/iterate/subscribers/locking.py
M plone/app/iterate/subscribers/marker.py
M plone/app/iterate/subscribers/metadata.py
M plone/app/iterate/subscribers/versioning.py
M plone/app/iterate/subscribers/workflow.py
M plone/app/iterate/testing.py
M plone/app/iterate/tests/__init__.py
M plone/app/iterate/tests/dxtypes.py
M plone/app/iterate/tests/test_annotations.py
M plone/app/iterate/tests/test_containers.py
M plone/app/iterate/tests/test_interfaces.py
M plone/app/iterate/tests/test_iterate.py
M plone/app/iterate/util.py
M setup.py

b'diff --git a/plone/__init__.py b/plone/__init__.py\nindex ca12a73..05f0beb 100644\n--- a/plone/__init__.py\n+++ b/plone/__init__.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n # See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n try:\n     __import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/__init__.py b/plone/app/__init__.py\nindex ca12a73..05f0beb 100644\n--- a/plone/app/__init__.py\n+++ b/plone/app/__init__.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n # See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n try:\n     __import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/iterate/__init__.py b/plone/app/iterate/__init__.py\nindex 100d0af..2c5ab4d 100644\n--- a/plone/app/iterate/__init__.py\n+++ b/plone/app/iterate/__init__.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\ndiff --git a/plone/app/iterate/archiver.py b/plone/app/iterate/archiver.py\nindex 6293477..13e8f36 100644\n--- a/plone/app/iterate/archiver.py\n+++ b/plone/app/iterate/archiver.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\n@@ -29,7 +28,7 @@\n \n @implementer(interfaces.IObjectArchiver)\n @adapter(interfaces.IIterateAware)\n-class ContentArchiver(object):\n+class ContentArchiver:\n     def __init__(self, context):\n         self.context = context\n         self.repository = getToolByName(context, "portal_repository")\ndiff --git a/plone/app/iterate/base.py b/plone/app/iterate/base.py\nindex 3b6339b..001263e 100644\n--- a/plone/app/iterate/base.py\n+++ b/plone/app/iterate/base.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\n@@ -45,7 +44,7 @@\n \n \n @implementer(ICheckinCheckoutPolicy)\n-class CheckinCheckoutBasePolicyAdapter(object):\n+class CheckinCheckoutBasePolicyAdapter:\n     """Base Checkin Checkout Policy For Content\n \n     - on checkout context is the baseline\n@@ -111,7 +110,7 @@ def getProperties(self, obj, default=None):\n \n @implementer(interfaces.IObjectCopier)\n @component.adapter(interfaces.IIterateAware)\n-class BaseContentCopier(object):\n+class BaseContentCopier:\n     def __init__(self, context):\n         self.context = context\n \ndiff --git a/plone/app/iterate/browser/__init__.py b/plone/app/iterate/browser/__init__.py\nindex ec51c5a..792d600 100644\n--- a/plone/app/iterate/browser/__init__.py\n+++ b/plone/app/iterate/browser/__init__.py\n@@ -1,2 +1 @@\n-# -*- coding: utf-8 -*-\n #\ndiff --git a/plone/app/iterate/browser/cancel.py b/plone/app/iterate/browser/cancel.py\nindex eb75d77..2f1a5a7 100644\n--- a/plone/app/iterate/browser/cancel.py\n+++ b/plone/app/iterate/browser/cancel.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -39,16 +38,16 @@ def __call__(self):\n         context = aq_inner(self.context)\n \n         if "form.button.Cancel" in self.request.form:\n-            control = getMultiAdapter((context, self.request), name=u"iterate_control")\n+            control = getMultiAdapter((context, self.request), name="iterate_control")\n             if not control.cancel_allowed():\n-                raise CheckoutException(u"Not a checkout")\n+                raise CheckoutException("Not a checkout")\n \n             policy = ICheckinCheckoutPolicy(context)\n             baseline = policy.cancelCheckout()\n             baseline.reindexObject()\n \n             IStatusMessage(self.request).addStatusMessage(\n-                _(u"Checkout cancelled"), type="info"\n+                _("Checkout cancelled"), type="info"\n             )\n             view_url = baseline.restrictedTraverse("@@plone_context_state").view_url()\n             self.request.response.redirect(view_url)\ndiff --git a/plone/app/iterate/browser/checkin.py b/plone/app/iterate/browser/checkin.py\nindex 3717ad0..f41245a 100644\n--- a/plone/app/iterate/browser/checkin.py\n+++ b/plone/app/iterate/browser/checkin.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -39,9 +38,9 @@ def __call__(self):\n         context = aq_inner(self.context)\n \n         if "form.button.Checkin" in self.request.form:\n-            control = getMultiAdapter((context, self.request), name=u"iterate_control")\n+            control = getMultiAdapter((context, self.request), name="iterate_control")\n             if not control.checkin_allowed():\n-                raise CheckinException(u"Not a checkout")\n+                raise CheckinException("Not a checkout")\n \n             message = self.request.form.get("checkin_message", "")\n \ndiff --git a/plone/app/iterate/browser/checkout.py b/plone/app/iterate/browser/checkout.py\nindex 73f10f8..b2fb2c3 100644\n--- a/plone/app/iterate/browser/checkout.py\n+++ b/plone/app/iterate/browser/checkout.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -50,9 +49,9 @@ def __call__(self):\n         # We want to redirect to a specific template, else we might\n         # end up downloading a file\n         if "form.button.Checkout" in self.request.form:\n-            control = getMultiAdapter((context, self.request), name=u"iterate_control")\n+            control = getMultiAdapter((context, self.request), name="iterate_control")\n             if not control.checkout_allowed():\n-                raise CheckoutException(u"Not allowed")\n+                raise CheckoutException("Not allowed")\n \n             location = self.request.form.get("checkout_location", None)\n             locator = None\ndiff --git a/plone/app/iterate/browser/control.py b/plone/app/iterate/browser/control.py\nindex 46651e2..8dc11de 100644\n--- a/plone/app/iterate/browser/control.py\n+++ b/plone/app/iterate/browser/control.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\ndiff --git a/plone/app/iterate/browser/diff.py b/plone/app/iterate/browser/diff.py\nindex baa5de3..97744ce 100644\n--- a/plone/app/iterate/browser/diff.py\n+++ b/plone/app/iterate/browser/diff.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n """\n $Id: diff.py 1807 2007-02-06 06:52:46Z hazmat $\n """\ndiff --git a/plone/app/iterate/browser/info.py b/plone/app/iterate/browser/info.py\nindex 300acf4..b0e10ee 100644\n--- a/plone/app/iterate/browser/info.py\n+++ b/plone/app/iterate/browser/info.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n """\n $Id: base.py 1808 2007-02-06 11:39:11Z hazmat $\n """\n@@ -22,7 +21,7 @@\n @implementer(IViewlet)\n class BaseInfoViewlet(BrowserView):\n     def __init__(self, context, request, view, manager):\n-        super(BaseInfoViewlet, self).__init__(context, request)\n+        super().__init__(context, request)\n         self.__parent__ = view\n         self.view = view\n         self.manager = manager\n@@ -61,7 +60,7 @@ def creator_url(self):\n         creator = self.creator()\n         if creator is not None:\n             portal_url = getToolByName(self.context, "portal_url")\n-            return "{0}/author/{1}".format(portal_url(), creator.getId())\n+            return f"{portal_url()}/author/{creator.getId()}"\n \n     @memoize\n     def creator_name(self):\ndiff --git a/plone/app/iterate/containers.py b/plone/app/iterate/containers.py\nindex 9a0c933..c22142c 100644\n--- a/plone/app/iterate/containers.py\n+++ b/plone/app/iterate/containers.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -35,13 +34,13 @@\n \n @implementer(IWCContainerLocator)\n @adapter(IDynamicType)\n-class HomeFolderLocator(object):\n+class HomeFolderLocator:\n     """Locate the current user\'s home folder, if possible."""\n \n     def __init__(self, context):\n         self.context = context\n \n-    title = _(u"Home folder")\n+    title = _("Home folder")\n \n     @property\n     def available(self):\n@@ -53,7 +52,7 @@ def __call__(self):\n \n @implementer(IWCContainerLocator)\n @adapter(IDynamicType)\n-class ParentFolderLocator(object):\n+class ParentFolderLocator:\n     """Locate the parent of the context, if the user has the\n     Add portal content permission.\n     """\n@@ -61,7 +60,7 @@ class ParentFolderLocator(object):\n     def __init__(self, context):\n         self.context = context\n \n-    title = _(u"Parent folder")\n+    title = _("Parent folder")\n \n     @property\n     def available(self):\ndiff --git a/plone/app/iterate/dexterity/__init__.py b/plone/app/iterate/dexterity/__init__.py\nindex 22ba3f6..4eb7b7c 100644\n--- a/plone/app/iterate/dexterity/__init__.py\n+++ b/plone/app/iterate/dexterity/__init__.py\n@@ -1,3 +1 @@\n-# -*- coding: utf-8 -*-\n-\n ITERATE_RELATION_NAME = "iterate-working-copy"\ndiff --git a/plone/app/iterate/dexterity/copier.py b/plone/app/iterate/dexterity/copier.py\nindex 2bc6995..9b50192 100644\n--- a/plone/app/iterate/dexterity/copier.py\n+++ b/plone/app/iterate/dexterity/copier.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n from plone.app.iterate.base import BaseContentCopier\n@@ -170,7 +169,7 @@ def _copyBaseline(self, container):\n         obj = createContentInContainer(\n             container,\n             self.context.portal_type,\n-            id="working_copy_of_{}".format(self.context.id),\n+            id=f"working_copy_of_{self.context.id}",\n         )\n \n         # copy all field values from the baseline to the working copy\ndiff --git a/plone/app/iterate/dexterity/interfaces.py b/plone/app/iterate/dexterity/interfaces.py\nindex 53fdc57..b3eca21 100644\n--- a/plone/app/iterate/dexterity/interfaces.py\n+++ b/plone/app/iterate/dexterity/interfaces.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from plone.app.iterate.interfaces import IIterateAware\n from z3c.relationfield.interfaces import IRelationValue\n \ndiff --git a/plone/app/iterate/dexterity/policy.py b/plone/app/iterate/dexterity/policy.py\nindex e90911c..82ae5b1 100644\n--- a/plone/app/iterate/dexterity/policy.py\n+++ b/plone/app/iterate/dexterity/policy.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from plone.app.iterate.base import CheckinCheckoutBasePolicyAdapter\n from plone.app.iterate.dexterity.interfaces import IDexterityIterateAware\n from plone.app.iterate.dexterity.utils import get_baseline\ndiff --git a/plone/app/iterate/dexterity/relation.py b/plone/app/iterate/dexterity/relation.py\nindex 3180f92..f9f06c7 100644\n--- a/plone/app/iterate/dexterity/relation.py\n+++ b/plone/app/iterate/dexterity/relation.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from plone.app.iterate.dexterity.interfaces import IStagingRelationValue\n from z3c.relationfield import relation\n from zc.relation.interfaces import ICatalog\ndiff --git a/plone/app/iterate/dexterity/utils.py b/plone/app/iterate/dexterity/utils.py\nindex 6f142bb..1973f16 100644\n--- a/plone/app/iterate/dexterity/utils.py\n+++ b/plone/app/iterate/dexterity/utils.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from Acquisition import aq_base\n from Acquisition import aq_inner\n from plone.app.iterate.dexterity import ITERATE_RELATION_NAME\ndiff --git a/plone/app/iterate/event.py b/plone/app/iterate/event.py\nindex 16d6041..3637939 100644\n--- a/plone/app/iterate/event.py\n+++ b/plone/app/iterate/event.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -49,7 +48,7 @@ def __init__(self, wc, baseline, relation, message):\n @implementer(interfaces.IAfterCheckinEvent)\n class AfterCheckinEvent(ObjectEvent):\n     def __init__(self, new_baseline, checkin_message):\n-        super(AfterCheckinEvent, self).__init__(new_baseline)\n+        super().__init__(new_baseline)\n         self.message = checkin_message\n \n \ndiff --git a/plone/app/iterate/interfaces.py b/plone/app/iterate/interfaces.py\nindex 120fee7..749dd4d 100644\n--- a/plone/app/iterate/interfaces.py\n+++ b/plone/app/iterate/interfaces.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -51,7 +50,7 @@ class IIterateAware(Interface):\n #  Lock types\n \n ITERATE_LOCK = LockType(\n-    u"iterate.lock", stealable=False, user_unlockable=False, timeout=MAX_TIMEOUT\n+    "iterate.lock", stealable=False, user_unlockable=False, timeout=MAX_TIMEOUT\n )  # noqa\n \n #################################\n@@ -79,7 +78,7 @@ class ConflictError(CheckinException):\n annotation_key = "ore.iterate"\n \n \n-class keys(object):\n+class keys:\n     # various common keys\n     checkout_user = "checkout_user"\n     checkout_time = "checkout_time"\n@@ -166,10 +165,10 @@ class IWCContainerLocator(Interface):\n     """\n \n     available = schema.Bool(\n-        title=u"Available", description=u"Whether location will be available."\n+        title="Available", description="Whether location will be available."\n     )\n \n-    title = schema.TextLine(title=u"Title", description=u"Title of this location")\n+    title = schema.TextLine(title="Title", description="Title of this location")\n \n     def __call__():\n         """Return a container object, or None if available() is False"""\n@@ -301,15 +300,15 @@ def checkinBackReferences(baseline, wc, references, storage):\n class IIterateSettings(Interface):\n \n     enable_checkout_workflow = schema.Bool(\n-        title=_(u"Enable checkout workflow"),\n-        description=u"",\n+        title=_("Enable checkout workflow"),\n+        description="",\n         default=False,\n         required=False,\n     )\n \n     checkout_workflow_policy = schema.ASCIILine(\n-        title=_(u"Checkout workflow policy"),\n-        description=u"",\n+        title=_("Checkout workflow policy"),\n+        description="",\n         default="checkout_workflow_policy",\n         required=True,\n     )\ndiff --git a/plone/app/iterate/lock.py b/plone/app/iterate/lock.py\nindex 7851c81..ed8bdfe 100644\n--- a/plone/app/iterate/lock.py\n+++ b/plone/app/iterate/lock.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\ndiff --git a/plone/app/iterate/permissions.py b/plone/app/iterate/permissions.py\nindex d829aef..9db107f 100644\n--- a/plone/app/iterate/permissions.py\n+++ b/plone/app/iterate/permissions.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\ndiff --git a/plone/app/iterate/setuphandlers.py b/plone/app/iterate/setuphandlers.py\nindex 0f6a18b..d807d65 100644\n--- a/plone/app/iterate/setuphandlers.py\n+++ b/plone/app/iterate/setuphandlers.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from Products.CMFPlone.interfaces import INonInstallable\n from zope.interface import implementer\n \n@@ -6,15 +5,15 @@\n \n \n @implementer(INonInstallable)\n-class HiddenProfiles(object):\n+class HiddenProfiles:\n     def getNonInstallableProfiles(self):\n         """Prevents uninstall profile from showing up in the profile list\n         when creating a Plone site.\n \n         """\n         return [\n-            u"plone.app.iterate:uninstall",\n-            u"plone.app.iterate:plone.app.iterate",\n+            "plone.app.iterate:uninstall",\n+            "plone.app.iterate:plone.app.iterate",\n         ]\n \n \ndiff --git a/plone/app/iterate/subscribers/__init__.py b/plone/app/iterate/subscribers/__init__.py\nindex c7134b8..c7272a2 100644\n--- a/plone/app/iterate/subscribers/__init__.py\n+++ b/plone/app/iterate/subscribers/__init__.py\n@@ -1,2 +1 @@\n-# -*- coding: utf-8 -*-\n # $Id: __init__.py 1808 2007-02-06 11:39:11Z hazmat $\ndiff --git a/plone/app/iterate/subscribers/locking.py b/plone/app/iterate/subscribers/locking.py\nindex 851b5a8..f64daf5 100644\n--- a/plone/app/iterate/subscribers/locking.py\n+++ b/plone/app/iterate/subscribers/locking.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\ndiff --git a/plone/app/iterate/subscribers/marker.py b/plone/app/iterate/subscribers/marker.py\nindex 53d0ba8..54b5f2c 100644\n--- a/plone/app/iterate/subscribers/marker.py\n+++ b/plone/app/iterate/subscribers/marker.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\ndiff --git a/plone/app/iterate/subscribers/metadata.py b/plone/app/iterate/subscribers/metadata.py\nindex 61edcfb..d4864cb 100644\n--- a/plone/app/iterate/subscribers/metadata.py\n+++ b/plone/app/iterate/subscribers/metadata.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\ndiff --git a/plone/app/iterate/subscribers/versioning.py b/plone/app/iterate/subscribers/versioning.py\nindex 027f60e..b7a1a67 100644\n--- a/plone/app/iterate/subscribers/versioning.py\n+++ b/plone/app/iterate/subscribers/versioning.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\ndiff --git a/plone/app/iterate/subscribers/workflow.py b/plone/app/iterate/subscribers/workflow.py\nindex bce937a..a20f224 100644\n--- a/plone/app/iterate/subscribers/workflow.py\n+++ b/plone/app/iterate/subscribers/workflow.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\ndiff --git a/plone/app/iterate/testing.py b/plone/app/iterate/testing.py\nindex 1a40805..d8ae8ed 100644\n--- a/plone/app/iterate/testing.py\n+++ b/plone/app/iterate/testing.py\n@@ -38,7 +38,7 @@ class DexPloneAppIterateLayer(PloneAppContenttypes):\n \n     def setUpZope(self, app, configurationContext):\n         """Setup Zope with Addons."""\n-        super(DexPloneAppIterateLayer, self).setUpZope(app, configurationContext)\n+        super().setUpZope(app, configurationContext)\n \n         import plone.app.iterate\n \n@@ -46,16 +46,14 @@ def setUpZope(self, app, configurationContext):\n \n     def setUpPloneSite(self, portal):\n         """Setup Plone Site with Addons."""\n-        super(DexPloneAppIterateLayer, self).setUpPloneSite(portal)\n+        super().setUpPloneSite(portal)\n         applyProfile(portal, "plone.app.iterate:default")\n         applyProfile(portal, "plone.app.iterate:testingdx")\n         # with named AND dotted behaviors we need to take care of both\n-        versioning_behavior = set(\n-            [\n+        versioning_behavior = {\n                 "plone.app.versioningbehavior.behaviors.IVersionable",\n                 "plone.versioning",\n-            ],\n-        )\n+        }\n \n         # Disable automatic versioning of core content types\n         for name in ("Document", "Event", "Link", "News Item"):\ndiff --git a/plone/app/iterate/tests/__init__.py b/plone/app/iterate/tests/__init__.py\nindex ec51c5a..792d600 100644\n--- a/plone/app/iterate/tests/__init__.py\n+++ b/plone/app/iterate/tests/__init__.py\n@@ -1,2 +1 @@\n-# -*- coding: utf-8 -*-\n #\ndiff --git a/plone/app/iterate/tests/dxtypes.py b/plone/app/iterate/tests/dxtypes.py\nindex d354fa2..b4dbddd 100644\n--- a/plone/app/iterate/tests/dxtypes.py\n+++ b/plone/app/iterate/tests/dxtypes.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from plone.dexterity.content import Container\n from plone.app.contenttypes.interfaces import IDocument\n from zope.interface import Interface\ndiff --git a/plone/app/iterate/tests/test_annotations.py b/plone/app/iterate/tests/test_annotations.py\nindex e18cd45..19e7748 100644\n--- a/plone/app/iterate/tests/test_annotations.py\n+++ b/plone/app/iterate/tests/test_annotations.py\n@@ -1,5 +1,3 @@\n-# -*- coding: utf-8 -*-\n-\n from plone.app.iterate.interfaces import ICheckinCheckoutPolicy\n from plone.app.iterate.interfaces import IWCContainerLocator\n from plone.app.iterate.testing import PLONEAPPITERATEDEX_INTEGRATION_TESTING\n@@ -30,13 +28,13 @@ def test_annotation_saved_on_checkin(self):\n         obj_annotations = IAnnotations(self.s1)\n         self.assertEqual(obj_annotations, {})\n \n-        obj_annotations["key1"] = u"value1"\n+        obj_annotations["key1"] = "value1"\n         obj_annotations = IAnnotations(self.s1)\n-        self.assertEqual(obj_annotations, {"key1": u"value1"})\n+        self.assertEqual(obj_annotations, {"key1": "value1"})\n \n         # Now, let\'s get a working copy for it.\n         locators = getAdapters((self.s1,), IWCContainerLocator)\n-        location = u"plone.app.iterate.parent"\n+        location = "plone.app.iterate.parent"\n         locator = [c[1] for c in locators if c[0] == location][0]\n \n         policy = ICheckinCheckoutPolicy(self.s1)\n@@ -45,25 +43,25 @@ def test_annotation_saved_on_checkin(self):\n \n         # Annotations should be the same\n         new_annotations = IAnnotations(wc)\n-        self.assertEqual(new_annotations["key1"], u"value1")\n+        self.assertEqual(new_annotations["key1"], "value1")\n \n         # Now, let\'s modify the existing one, and create a new one\n-        new_annotations["key1"] = u"value2"\n-        new_annotations["key2"] = u"value1"\n+        new_annotations["key1"] = "value2"\n+        new_annotations["key2"] = "value1"\n \n         # Check that annotations were stored correctly and original ones were\n         # not overriten\n         new_annotations = IAnnotations(wc)\n-        self.assertEqual(new_annotations["key1"], u"value2")\n-        self.assertEqual(new_annotations["key2"], u"value1")\n+        self.assertEqual(new_annotations["key1"], "value2")\n+        self.assertEqual(new_annotations["key2"], "value1")\n \n         obj_annotations = IAnnotations(self.s1)\n-        self.assertEqual(obj_annotations["key1"], u"value1")\n+        self.assertEqual(obj_annotations["key1"], "value1")\n         self.assertFalse("key2" in obj_annotations)\n \n         # Now, we do a checkin\n         policy = ICheckinCheckoutPolicy(wc)\n-        policy.checkin(u"Commit message")\n+        policy.checkin("Commit message")\n \n         # And finally check that the old object has the same annotations as\n         # its working copy\n@@ -71,5 +69,5 @@ def test_annotation_saved_on_checkin(self):\n         obj_annotations = IAnnotations(self.s1)\n         self.assertTrue("key1" in obj_annotations)\n         self.assertTrue("key2" in obj_annotations)\n-        self.assertEqual(obj_annotations["key1"], u"value2")\n-        self.assertEqual(obj_annotations["key2"], u"value1")\n+        self.assertEqual(obj_annotations["key1"], "value2")\n+        self.assertEqual(obj_annotations["key2"], "value1")\ndiff --git a/plone/app/iterate/tests/test_containers.py b/plone/app/iterate/tests/test_containers.py\nindex 12ad18c..9d81f6b 100644\n--- a/plone/app/iterate/tests/test_containers.py\n+++ b/plone/app/iterate/tests/test_containers.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -89,7 +88,7 @@ def test_container_workflowState(self):\n         bstate = self.wf.getInfoFor(baseline, "review_state")\n         self.assertEqual(bstate, "published")\n \n-        self.assertEquals(len(self.portal.workarea.objectIds()), 0)\n+        self.assertEqual(len(self.portal.workarea.objectIds()), 0)\n         setRoles(self.portal, TEST_USER_ID, ["Owner"])\n \n     def test_container_baselineCreated(self):\n@@ -99,7 +98,7 @@ def test_container_baselineCreated(self):\n \n         wc = ICheckinCheckoutPolicy(doc).checkout(self.portal.workarea)\n \n-        self.assertEquals(wc.id, "working_copy_of_doc1")\n+        self.assertEqual(wc.id, "working_copy_of_doc1")\n         self.assertIn("working_copy_of_doc1", self.portal.workarea.objectIds())\n \n     def test_container_folderOrder(self):\ndiff --git a/plone/app/iterate/tests/test_interfaces.py b/plone/app/iterate/tests/test_interfaces.py\nindex f921b18..29be11a 100644\n--- a/plone/app/iterate/tests/test_interfaces.py\n+++ b/plone/app/iterate/tests/test_interfaces.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from plone.app.iterate.interfaces import IBaseline\n from plone.app.iterate.interfaces import ICheckinCheckoutPolicy\n from plone.app.iterate.interfaces import IIterateAware\n@@ -27,7 +26,7 @@ class TestObjectsProvideCorrectInterfaces(TestCase):\n     layer = PLONEAPPITERATEDEX_INTEGRATION_TESTING\n \n     def setUp(self):\n-        super(TestObjectsProvideCorrectInterfaces, self).setUp()\n+        super().setUp()\n \n         self.portal = self.layer["portal"]\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n@@ -45,7 +44,7 @@ def tearDown(self):\n         self.portal.manage_delObjects([self.folder.id])\n         logout()\n         setRoles(self.portal, TEST_USER_ID, ["Member"])\n-        super(TestObjectsProvideCorrectInterfaces, self).tearDown()\n+        super().tearDown()\n \n     def do_checkout(self):\n         policy = ICheckinCheckoutPolicy(self.obj)\ndiff --git a/plone/app/iterate/tests/test_iterate.py b/plone/app/iterate/tests/test_iterate.py\nindex ecb4125..f0cbd49 100644\n--- a/plone/app/iterate/tests/test_iterate.py\n+++ b/plone/app/iterate/tests/test_iterate.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\ndiff --git a/plone/app/iterate/util.py b/plone/app/iterate/util.py\nindex fac5e9a..6a8af6f 100644\n--- a/plone/app/iterate/util.py\n+++ b/plone/app/iterate/util.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\ndiff --git a/setup.py b/setup.py\nindex b7aea84..6eb5ef0 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from setuptools import find_packages\n from setuptools import setup\n \n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-02T23:50:19+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/7e0ce3e0a8945016319e24f57a1a7de26e1447aa

chore: no need to fallback to pkgutil

Files changed:
M plone/__init__.py
M plone/app/__init__.py

b'diff --git a/plone/__init__.py b/plone/__init__.py\nindex 05f0beb..5284146 100644\n--- a/plone/__init__.py\n+++ b/plone/__init__.py\n@@ -1,7 +1 @@\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/__init__.py b/plone/app/__init__.py\nindex 05f0beb..5284146 100644\n--- a/plone/app/__init__.py\n+++ b/plone/app/__init__.py\n@@ -1,7 +1 @@\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-02T23:52:27+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/b596bafef9f4e9433f7c4a7932ecdddf37c1c0a0

chore: we have git

Files changed:
M plone/app/iterate/browser/diff.py
M plone/app/iterate/browser/info.py
M plone/app/iterate/interfaces.py
M plone/app/iterate/lock.py
M plone/app/iterate/subscribers/__init__.py
M plone/app/iterate/subscribers/locking.py
M plone/app/iterate/subscribers/marker.py
M plone/app/iterate/subscribers/metadata.py
M plone/app/iterate/subscribers/versioning.py
M plone/app/iterate/subscribers/workflow.py

b'diff --git a/plone/app/iterate/browser/diff.py b/plone/app/iterate/browser/diff.py\nindex 97744ce..60ff36f 100644\n--- a/plone/app/iterate/browser/diff.py\n+++ b/plone/app/iterate/browser/diff.py\n@@ -1,7 +1,3 @@\n-"""\n-$Id: diff.py 1807 2007-02-06 06:52:46Z hazmat $\n-"""\n-\n from plone.app.iterate.interfaces import IBaseline\n from plone.app.iterate.interfaces import ICheckinCheckoutPolicy\n from plone.app.iterate.interfaces import IWorkingCopy\ndiff --git a/plone/app/iterate/browser/info.py b/plone/app/iterate/browser/info.py\nindex b0e10ee..b06edc3 100644\n--- a/plone/app/iterate/browser/info.py\n+++ b/plone/app/iterate/browser/info.py\n@@ -1,7 +1,3 @@\n-"""\n-$Id: base.py 1808 2007-02-06 11:39:11Z hazmat $\n-"""\n-\n from AccessControl import getSecurityManager\n from DateTime import DateTime\n from plone.app.iterate.interfaces import IBaseline\ndiff --git a/plone/app/iterate/interfaces.py b/plone/app/iterate/interfaces.py\nindex 749dd4d..32203b8 100644\n--- a/plone/app/iterate/interfaces.py\n+++ b/plone/app/iterate/interfaces.py\n@@ -19,10 +19,6 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-$Id: interfaces.py 1811 2007-02-06 18:40:02Z hazmat $\n-"""\n-\n from plone.app.iterate import PloneMessageFactory as _\n from plone.locking.interfaces import LockType\n from plone.locking.interfaces import MAX_TIMEOUT\ndiff --git a/plone/app/iterate/lock.py b/plone/app/iterate/lock.py\nindex ed8bdfe..4691176 100644\n--- a/plone/app/iterate/lock.py\n+++ b/plone/app/iterate/lock.py\n@@ -21,8 +21,6 @@\n ##################################################################\n """\n Checkin / Checkout Specific DAV Lock Manipulation and Introspection\n-\n-$Id: lock.py 1392 2006-06-20 01:02:17Z hazmat $\n """\n \n from .interfaces import ITERATE_LOCK\ndiff --git a/plone/app/iterate/subscribers/__init__.py b/plone/app/iterate/subscribers/__init__.py\nindex c7272a2..e69de29 100644\n--- a/plone/app/iterate/subscribers/__init__.py\n+++ b/plone/app/iterate/subscribers/__init__.py\n@@ -1 +0,0 @@\n-# $Id: __init__.py 1808 2007-02-06 11:39:11Z hazmat $\ndiff --git a/plone/app/iterate/subscribers/locking.py b/plone/app/iterate/subscribers/locking.py\nindex f64daf5..1acfb49 100644\n--- a/plone/app/iterate/subscribers/locking.py\n+++ b/plone/app/iterate/subscribers/locking.py\n@@ -19,10 +19,6 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-$Id: locking.py 1824 2007-02-08 17:59:41Z hazmat $\n-"""\n-\n from plone.app.iterate import lock\n from plone.locking.interfaces import ILockable\n \ndiff --git a/plone/app/iterate/subscribers/marker.py b/plone/app/iterate/subscribers/marker.py\nindex 54b5f2c..fb294ea 100644\n--- a/plone/app/iterate/subscribers/marker.py\n+++ b/plone/app/iterate/subscribers/marker.py\n@@ -19,10 +19,6 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-$Id: marker.py 1824 2007-02-08 17:59:41Z hazmat $\n-"""\n-\n from plone.app.iterate import interfaces\n from Products.Five.utilities import marker\n \ndiff --git a/plone/app/iterate/subscribers/metadata.py b/plone/app/iterate/subscribers/metadata.py\nindex d4864cb..dce208b 100644\n--- a/plone/app/iterate/subscribers/metadata.py\n+++ b/plone/app/iterate/subscribers/metadata.py\n@@ -19,10 +19,6 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-$Id: metadata.py 1824 2007-02-08 17:59:41Z hazmat $\n-"""\n-\n from AccessControl import getSecurityManager\n from DateTime import DateTime\n from plone.app.iterate.interfaces import keys\ndiff --git a/plone/app/iterate/subscribers/versioning.py b/plone/app/iterate/subscribers/versioning.py\nindex b7a1a67..470824d 100644\n--- a/plone/app/iterate/subscribers/versioning.py\n+++ b/plone/app/iterate/subscribers/versioning.py\n@@ -19,9 +19,6 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-"""\n-\n from plone.app.iterate import interfaces\n \n \ndiff --git a/plone/app/iterate/subscribers/workflow.py b/plone/app/iterate/subscribers/workflow.py\nindex a20f224..3bb95bf 100644\n--- a/plone/app/iterate/subscribers/workflow.py\n+++ b/plone/app/iterate/subscribers/workflow.py\n@@ -20,10 +20,7 @@\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n """\n-$Id: workflow.py 1824 2007-02-08 17:59:41Z hazmat $\n-\n Applies new checkout specific workflows to content that is checked out.\n-\n """\n \n from Acquisition import aq_base\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-02T23:53:14+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/2ed8580793284690d885b196a267d1e7bb6d58d2

chore: isort

Files changed:
M plone/app/iterate/archiver.py
M plone/app/iterate/dexterity/copier.py
M plone/app/iterate/event.py
M plone/app/iterate/interfaces.py
M plone/app/iterate/permissions.py
M plone/app/iterate/subscribers/workflow.py
M plone/app/iterate/tests/dxtypes.py
M plone/app/iterate/tests/test_containers.py
M plone/app/iterate/tests/test_iterate.py

b'diff --git a/plone/app/iterate/archiver.py b/plone/app/iterate/archiver.py\nindex 13e8f36..5b03b82 100644\n--- a/plone/app/iterate/archiver.py\n+++ b/plone/app/iterate/archiver.py\n@@ -19,12 +19,11 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n+from . import interfaces\n from Products.CMFCore.utils import getToolByName\n from zope.component import adapter\n from zope.interface import implementer\n \n-from . import interfaces\n-\n \n @implementer(interfaces.IObjectArchiver)\n @adapter(interfaces.IIterateAware)\ndiff --git a/plone/app/iterate/dexterity/copier.py b/plone/app/iterate/dexterity/copier.py\nindex 9b50192..5a952b0 100644\n--- a/plone/app/iterate/dexterity/copier.py\n+++ b/plone/app/iterate/dexterity/copier.py\n@@ -1,10 +1,11 @@\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n-from plone.app.iterate.base import BaseContentCopier\n from plone.app.iterate import interfaces\n+from plone.app.iterate.base import BaseContentCopier\n from plone.app.iterate.dexterity import ITERATE_RELATION_NAME\n from plone.app.iterate.dexterity.relation import StagingRelationValue\n from plone.app.iterate.event import AfterCheckinEvent\n+from plone.dexterity.utils import createContentInContainer\n from plone.dexterity.utils import iterSchemata\n from Products.CMFCore.utils import getToolByName\n from Products.DCWorkflow.DCWorkflow import DCWorkflowDefinition\n@@ -16,7 +17,6 @@\n from zope.event import notify\n from zope.intid.interfaces import IIntIds\n from zope.schema import getFieldsInOrder\n-from plone.dexterity.utils import createContentInContainer\n \n \n class ContentCopier(BaseContentCopier):\ndiff --git a/plone/app/iterate/event.py b/plone/app/iterate/event.py\nindex 3637939..ab451a2 100644\n--- a/plone/app/iterate/event.py\n+++ b/plone/app/iterate/event.py\n@@ -21,11 +21,10 @@\n ##################################################################\n """\n """\n-from zope.interface.interfaces import ObjectEvent\n+from . import interfaces\n from zope.event import notify\n from zope.interface import implementer\n-\n-from . import interfaces\n+from zope.interface.interfaces import ObjectEvent\n \n \n @implementer(interfaces.ICheckoutEvent)\ndiff --git a/plone/app/iterate/interfaces.py b/plone/app/iterate/interfaces.py\nindex 32203b8..6381d1b 100644\n--- a/plone/app/iterate/interfaces.py\n+++ b/plone/app/iterate/interfaces.py\n@@ -23,9 +23,9 @@\n from plone.locking.interfaces import LockType\n from plone.locking.interfaces import MAX_TIMEOUT\n from zope import schema\n-from zope.interface.interfaces import IObjectEvent\n from zope.interface import Attribute\n from zope.interface import Interface\n+from zope.interface.interfaces import IObjectEvent\n \n import pkg_resources\n \ndiff --git a/plone/app/iterate/permissions.py b/plone/app/iterate/permissions.py\nindex 9db107f..1dcf0ce 100644\n--- a/plone/app/iterate/permissions.py\n+++ b/plone/app/iterate/permissions.py\n@@ -22,6 +22,7 @@\n \n from AccessControl.Permission import addPermission\n \n+\n CheckinPermission = "iterate : Check in content"\n CheckoutPermission = "iterate : Check out content"\n \ndiff --git a/plone/app/iterate/subscribers/workflow.py b/plone/app/iterate/subscribers/workflow.py\nindex 3bb95bf..11bb513 100644\n--- a/plone/app/iterate/subscribers/workflow.py\n+++ b/plone/app/iterate/subscribers/workflow.py\n@@ -27,12 +27,12 @@\n from plone.app.iterate.interfaces import IIterateSettings\n from plone.app.iterate.util import get_storage\n from plone.registry.interfaces import IRegistry\n-from Products.CMFPlacefulWorkflow.PlacefulWorkflowTool import (\n+from Products.CMFPlacefulWorkflow.PlacefulWorkflowTool import (  # noqa\n     WorkflowPolicyConfig_id,\n-)  # noqa\n-from Products.CMFPlacefulWorkflow.WorkflowPolicyConfig import (\n+)\n+from Products.CMFPlacefulWorkflow.WorkflowPolicyConfig import (  # noqa\n     WorkflowPolicyConfig,\n-)  # noqa\n+)\n from zope.component import getUtility\n \n \ndiff --git a/plone/app/iterate/tests/dxtypes.py b/plone/app/iterate/tests/dxtypes.py\nindex b4dbddd..6687e19 100644\n--- a/plone/app/iterate/tests/dxtypes.py\n+++ b/plone/app/iterate/tests/dxtypes.py\n@@ -1,7 +1,7 @@\n-from plone.dexterity.content import Container\n from plone.app.contenttypes.interfaces import IDocument\n-from zope.interface import Interface\n+from plone.dexterity.content import Container\n from zope.interface import implementer\n+from zope.interface import Interface\n \n \n class IFolderishDocument(Interface):\ndiff --git a/plone/app/iterate/tests/test_containers.py b/plone/app/iterate/tests/test_containers.py\nindex 9d81f6b..db3a31e 100644\n--- a/plone/app/iterate/tests/test_containers.py\n+++ b/plone/app/iterate/tests/test_containers.py\n@@ -28,10 +28,10 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n+from plone.dexterity.utils import createContentInContainer\n from zc.relation.interfaces import ICatalog\n-from zope.intid.interfaces import IIntIds\n from zope import component\n-from plone.dexterity.utils import createContentInContainer\n+from zope.intid.interfaces import IIntIds\n \n import unittest\n \n@@ -201,9 +201,9 @@ def test_container_default_page_is_kept_in_folder(self):\n         # the default page.\n         folder = self.portal.docs\n         doc = folder.doc1\n-        from Products.CMFDynamicViewFTI.interfaces import (\n+        from Products.CMFDynamicViewFTI.interfaces import (  # noqa: C901\n             ISelectableBrowserDefault,\n-        )  # noqa: C901\n+        )\n \n         ISelectableBrowserDefault(folder).setDefaultPage("doc1")\n         self.assertEqual(folder.getProperty("default_page", ""), "doc1")\ndiff --git a/plone/app/iterate/tests/test_iterate.py b/plone/app/iterate/tests/test_iterate.py\nindex f0cbd49..f99d533 100644\n--- a/plone/app/iterate/tests/test_iterate.py\n+++ b/plone/app/iterate/tests/test_iterate.py\n@@ -29,8 +29,8 @@\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n from zc.relation.interfaces import ICatalog\n-from zope.intid.interfaces import IIntIds\n from zope import component\n+from zope.intid.interfaces import IIntIds\n \n import unittest\n \n@@ -109,9 +109,9 @@ def test_default_page_is_kept_in_folder(self):\n         # the default page.\n         folder = self.portal.docs\n         doc = folder.doc1\n-        from Products.CMFDynamicViewFTI.interfaces import (\n+        from Products.CMFDynamicViewFTI.interfaces import (  # noqa: C901\n             ISelectableBrowserDefault,\n-        )  # noqa: C901\n+        )\n \n         ISelectableBrowserDefault(folder).setDefaultPage("doc1")\n         self.assertEqual(folder.getProperty("default_page", ""), "doc1")\n@@ -219,9 +219,9 @@ def test_relationship_deleted_on_cancel_checkout(self):\n     def test_baseline_relations_updated_on_checkin(self):\n         # Ensure that relations between the baseline and\n         # and other objects are up-to-date on checkin\n+        from z3c.relationfield import RelationValue\n         from zope.event import notify\n         from zope.lifecycleevent import ObjectModifiedEvent\n-        from z3c.relationfield import RelationValue\n \n         folder = self.portal.docs\n         baseline = folder.doc1\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-02T23:55:18+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/e6ea89e687ce082aa94759d21836c252a6ef1704

chore: remove superfluous noqa

Files changed:
M plone/app/iterate/__init__.py
M plone/app/iterate/interfaces.py
M plone/app/iterate/subscribers/workflow.py
M plone/app/iterate/tests/test_containers.py
M plone/app/iterate/tests/test_iterate.py

b'diff --git a/plone/app/iterate/__init__.py b/plone/app/iterate/__init__.py\nindex 2c5ab4d..ec9198d 100644\n--- a/plone/app/iterate/__init__.py\n+++ b/plone/app/iterate/__init__.py\n@@ -19,10 +19,7 @@\n # along with iterate; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-"""\n-\n-from plone.app.iterate import permissions  # noqa\n+from plone.app.iterate import permissions\n from zope.i18nmessageid import MessageFactory\n \n import logging\n@@ -33,7 +30,7 @@\n \n \n try:\n-    import plone.app.relationfield  # noqa\n+    import plone.app.relationfield\n except ImportError:\n     logger.warn(\n         "Dexterity support for iterate is not available. "\ndiff --git a/plone/app/iterate/interfaces.py b/plone/app/iterate/interfaces.py\nindex 6381d1b..e942422 100644\n--- a/plone/app/iterate/interfaces.py\n+++ b/plone/app/iterate/interfaces.py\n@@ -47,7 +47,7 @@ class IIterateAware(Interface):\n \n ITERATE_LOCK = LockType(\n     "iterate.lock", stealable=False, user_unlockable=False, timeout=MAX_TIMEOUT\n-)  # noqa\n+)\n \n #################################\n #  Exceptions\ndiff --git a/plone/app/iterate/subscribers/workflow.py b/plone/app/iterate/subscribers/workflow.py\nindex 11bb513..3b05e0a 100644\n--- a/plone/app/iterate/subscribers/workflow.py\n+++ b/plone/app/iterate/subscribers/workflow.py\n@@ -27,11 +27,11 @@\n from plone.app.iterate.interfaces import IIterateSettings\n from plone.app.iterate.util import get_storage\n from plone.registry.interfaces import IRegistry\n-from Products.CMFPlacefulWorkflow.PlacefulWorkflowTool import (  # noqa\n-    WorkflowPolicyConfig_id,\n+from Products.CMFPlacefulWorkflow.PlacefulWorkflowTool import (\n+    WorkflowPolicyConfig_id\n )\n-from Products.CMFPlacefulWorkflow.WorkflowPolicyConfig import (  # noqa\n-    WorkflowPolicyConfig,\n+from Products.CMFPlacefulWorkflow.WorkflowPolicyConfig import (\n+    WorkflowPolicyConfig\n )\n from zope.component import getUtility\n \ndiff --git a/plone/app/iterate/tests/test_containers.py b/plone/app/iterate/tests/test_containers.py\nindex db3a31e..3b07099 100644\n--- a/plone/app/iterate/tests/test_containers.py\n+++ b/plone/app/iterate/tests/test_containers.py\n@@ -201,8 +201,8 @@ def test_container_default_page_is_kept_in_folder(self):\n         # the default page.\n         folder = self.portal.docs\n         doc = folder.doc1\n-        from Products.CMFDynamicViewFTI.interfaces import (  # noqa: C901\n-            ISelectableBrowserDefault,\n+        from Products.CMFDynamicViewFTI.interfaces import (\n+            ISelectableBrowserDefault\n         )\n \n         ISelectableBrowserDefault(folder).setDefaultPage("doc1")\ndiff --git a/plone/app/iterate/tests/test_iterate.py b/plone/app/iterate/tests/test_iterate.py\nindex f99d533..70f6076 100644\n--- a/plone/app/iterate/tests/test_iterate.py\n+++ b/plone/app/iterate/tests/test_iterate.py\n@@ -109,8 +109,8 @@ def test_default_page_is_kept_in_folder(self):\n         # the default page.\n         folder = self.portal.docs\n         doc = folder.doc1\n-        from Products.CMFDynamicViewFTI.interfaces import (  # noqa: C901\n-            ISelectableBrowserDefault,\n+        from Products.CMFDynamicViewFTI.interfaces import (\n+            ISelectableBrowserDefault\n         )\n \n         ISelectableBrowserDefault(folder).setDefaultPage("doc1")\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-02T23:55:38+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/4d2d84c61c862d2b9a85d9ae5c3b095366625406

chore: isort

Files changed:
M plone/app/iterate/subscribers/workflow.py
M plone/app/iterate/tests/test_containers.py
M plone/app/iterate/tests/test_iterate.py

b'diff --git a/plone/app/iterate/subscribers/workflow.py b/plone/app/iterate/subscribers/workflow.py\nindex 3b05e0a..37f3022 100644\n--- a/plone/app/iterate/subscribers/workflow.py\n+++ b/plone/app/iterate/subscribers/workflow.py\n@@ -27,12 +27,8 @@\n from plone.app.iterate.interfaces import IIterateSettings\n from plone.app.iterate.util import get_storage\n from plone.registry.interfaces import IRegistry\n-from Products.CMFPlacefulWorkflow.PlacefulWorkflowTool import (\n-    WorkflowPolicyConfig_id\n-)\n-from Products.CMFPlacefulWorkflow.WorkflowPolicyConfig import (\n-    WorkflowPolicyConfig\n-)\n+from Products.CMFPlacefulWorkflow.PlacefulWorkflowTool import WorkflowPolicyConfig_id\n+from Products.CMFPlacefulWorkflow.WorkflowPolicyConfig import WorkflowPolicyConfig\n from zope.component import getUtility\n \n \ndiff --git a/plone/app/iterate/tests/test_containers.py b/plone/app/iterate/tests/test_containers.py\nindex 3b07099..2264684 100644\n--- a/plone/app/iterate/tests/test_containers.py\n+++ b/plone/app/iterate/tests/test_containers.py\n@@ -201,9 +201,7 @@ def test_container_default_page_is_kept_in_folder(self):\n         # the default page.\n         folder = self.portal.docs\n         doc = folder.doc1\n-        from Products.CMFDynamicViewFTI.interfaces import (\n-            ISelectableBrowserDefault\n-        )\n+        from Products.CMFDynamicViewFTI.interfaces import ISelectableBrowserDefault\n \n         ISelectableBrowserDefault(folder).setDefaultPage("doc1")\n         self.assertEqual(folder.getProperty("default_page", ""), "doc1")\ndiff --git a/plone/app/iterate/tests/test_iterate.py b/plone/app/iterate/tests/test_iterate.py\nindex 70f6076..12c12d6 100644\n--- a/plone/app/iterate/tests/test_iterate.py\n+++ b/plone/app/iterate/tests/test_iterate.py\n@@ -109,9 +109,7 @@ def test_default_page_is_kept_in_folder(self):\n         # the default page.\n         folder = self.portal.docs\n         doc = folder.doc1\n-        from Products.CMFDynamicViewFTI.interfaces import (\n-            ISelectableBrowserDefault\n-        )\n+        from Products.CMFDynamicViewFTI.interfaces import ISelectableBrowserDefault\n \n         ISelectableBrowserDefault(folder).setDefaultPage("doc1")\n         self.assertEqual(folder.getProperty("default_page", ""), "doc1")\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-02T23:56:04+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/bd3fee9362d43078bdc1065e8143c2ed3f72e591

chore: black

Files changed:
M plone/app/iterate/browser/cancel.py
M plone/app/iterate/browser/checkin.py
M plone/app/iterate/browser/checkout.py
M plone/app/iterate/browser/info.py
M plone/app/iterate/event.py
M plone/app/iterate/interfaces.py
M plone/app/iterate/testing.py
M plone/app/iterate/tests/test_annotations.py
M plone/app/iterate/tests/test_containers.py
M plone/app/iterate/tests/test_iterate.py

b'diff --git a/plone/app/iterate/browser/cancel.py b/plone/app/iterate/browser/cancel.py\nindex 2f1a5a7..129c5a4 100644\n--- a/plone/app/iterate/browser/cancel.py\n+++ b/plone/app/iterate/browser/cancel.py\n@@ -31,7 +31,6 @@\n \n \n class Cancel(BrowserView):\n-\n     index = ViewPageTemplateFile("cancel.pt")\n \n     def __call__(self):\ndiff --git a/plone/app/iterate/browser/checkin.py b/plone/app/iterate/browser/checkin.py\nindex f41245a..fe422e5 100644\n--- a/plone/app/iterate/browser/checkin.py\n+++ b/plone/app/iterate/browser/checkin.py\n@@ -31,7 +31,6 @@\n \n \n class Checkin(BrowserView):\n-\n     index = ViewPageTemplateFile("checkin.pt")\n \n     def __call__(self):\ndiff --git a/plone/app/iterate/browser/checkout.py b/plone/app/iterate/browser/checkout.py\nindex b2fb2c3..4554cc4 100644\n--- a/plone/app/iterate/browser/checkout.py\n+++ b/plone/app/iterate/browser/checkout.py\n@@ -33,7 +33,6 @@\n \n \n class Checkout(BrowserView):\n-\n     index = ViewPageTemplateFile("checkout.pt")\n \n     def containers(self):\ndiff --git a/plone/app/iterate/browser/info.py b/plone/app/iterate/browser/info.py\nindex b06edc3..28e88cd 100644\n--- a/plone/app/iterate/browser/info.py\n+++ b/plone/app/iterate/browser/info.py\n@@ -94,7 +94,6 @@ def _getReference(self):\n \n \n class BaselineInfoViewlet(BaseInfoViewlet):\n-\n     index = ViewPageTemplateFile("info_baseline.pt")\n \n     def render(self):\n@@ -118,7 +117,6 @@ def _getReference(self):\n \n \n class CheckoutInfoViewlet(BaseInfoViewlet):\n-\n     index = ViewPageTemplateFile("info_checkout.pt")\n \n     def render(self):\ndiff --git a/plone/app/iterate/event.py b/plone/app/iterate/event.py\nindex ab451a2..df34ef2 100644\n--- a/plone/app/iterate/event.py\n+++ b/plone/app/iterate/event.py\n@@ -68,7 +68,6 @@ def __init__(self, wc, baseline, relation):\n \n @implementer(interfaces.IBeforeCheckoutEvent)\n class BeforeCheckoutEvent(ObjectEvent):\n-\n     pass\n \n \ndiff --git a/plone/app/iterate/interfaces.py b/plone/app/iterate/interfaces.py\nindex e942422..22edc85 100644\n--- a/plone/app/iterate/interfaces.py\n+++ b/plone/app/iterate/interfaces.py\n@@ -95,24 +95,24 @@ class ICheckinEvent(IObjectEvent):\n \n \n class IAfterCheckinEvent(IObjectEvent):\n-    """ sent out after an object is checked in """\n+    """sent out after an object is checked in"""\n \n     checkin_message = Attribute("checkin message")\n \n \n class IBeforeCheckoutEvent(IObjectEvent):\n-    """ sent out before a working copy is created """\n+    """sent out before a working copy is created"""\n \n \n class ICheckoutEvent(IObjectEvent):\n-    """ an object is being checked out, event.object is the baseline """\n+    """an object is being checked out, event.object is the baseline"""\n \n     working_copy = Attribute("The object\'s working copy")\n     relation = Attribute("The Working Copy Relation Object")\n \n \n class ICancelCheckoutEvent(IObjectEvent):\n-    """ a working copy is being cancelled """\n+    """a working copy is being cancelled"""\n \n     baseline = Attribute("The working copy\'s baseline")\n \n@@ -294,7 +294,6 @@ def checkinBackReferences(baseline, wc, references, storage):\n \n \n class IIterateSettings(Interface):\n-\n     enable_checkout_workflow = schema.Bool(\n         title=_("Enable checkout workflow"),\n         description="",\ndiff --git a/plone/app/iterate/testing.py b/plone/app/iterate/testing.py\nindex d8ae8ed..7f2a401 100644\n--- a/plone/app/iterate/testing.py\n+++ b/plone/app/iterate/testing.py\n@@ -51,8 +51,8 @@ def setUpPloneSite(self, portal):\n         applyProfile(portal, "plone.app.iterate:testingdx")\n         # with named AND dotted behaviors we need to take care of both\n         versioning_behavior = {\n-                "plone.app.versioningbehavior.behaviors.IVersionable",\n-                "plone.versioning",\n+            "plone.app.versioningbehavior.behaviors.IVersionable",\n+            "plone.versioning",\n         }\n \n         # Disable automatic versioning of core content types\ndiff --git a/plone/app/iterate/tests/test_annotations.py b/plone/app/iterate/tests/test_annotations.py\nindex 19e7748..36b7d48 100644\n--- a/plone/app/iterate/tests/test_annotations.py\n+++ b/plone/app/iterate/tests/test_annotations.py\n@@ -11,7 +11,6 @@\n \n \n class AnnotationsTestCase(unittest.TestCase):\n-\n     layer = PLONEAPPITERATEDEX_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/iterate/tests/test_containers.py b/plone/app/iterate/tests/test_containers.py\nindex 2264684..f295f3a 100644\n--- a/plone/app/iterate/tests/test_containers.py\n+++ b/plone/app/iterate/tests/test_containers.py\n@@ -37,7 +37,6 @@\n \n \n class TestIterations(unittest.TestCase):\n-\n     layer = PLONEAPPITERATEDEX_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/iterate/tests/test_iterate.py b/plone/app/iterate/tests/test_iterate.py\nindex 12c12d6..93b9397 100644\n--- a/plone/app/iterate/tests/test_iterate.py\n+++ b/plone/app/iterate/tests/test_iterate.py\n@@ -36,7 +36,6 @@\n \n \n class TestIterations(unittest.TestCase):\n-\n     layer = PLONEAPPITERATEDEX_INTEGRATION_TESTING\n \n     def setUp(self):\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-02T23:56:57+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/fe71d9090993146d66767523e6ace46475975668

chore: zptlint ZCML/XML

Files changed:
M plone/app/iterate/browser/configure.zcml
M plone/app/iterate/configure.zcml
M plone/app/iterate/dexterity/configure.zcml
M plone/app/iterate/profiles/default/actions.xml
M plone/app/iterate/profiles/default/metadata.xml
M plone/app/iterate/profiles/default/registry.xml
M plone/app/iterate/profiles/test/metadata.xml
M plone/app/iterate/profiles/test/portal_placeful_workflow.xml
M plone/app/iterate/profiles/test/portal_placeful_workflow/working-copy.xml
M plone/app/iterate/profiles/test/workflows.xml
M plone/app/iterate/profiles/test/workflows/workingcopy_workflow/definition.xml
M plone/app/iterate/profiles/testingdx/repositorytool.xml
M plone/app/iterate/profiles/testingdx/types.xml
M plone/app/iterate/profiles/testingdx/types/FolderishDocument.xml
M plone/app/iterate/profiles/to1000/actions.xml
M plone/app/iterate/profiles/uninstall/actions.xml
M plone/app/iterate/profiles/uninstall/metadata.xml
M plone/app/iterate/profiles/uninstall/registry.xml
M plone/app/iterate/subscribers/configure.zcml

b'diff --git a/plone/app/iterate/browser/configure.zcml b/plone/app/iterate/browser/configure.zcml\nindex 3215c38..81e18d6 100644\n--- a/plone/app/iterate/browser/configure.zcml\n+++ b/plone/app/iterate/browser/configure.zcml\n@@ -1,86 +1,87 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <!-- Control view (public) -->\n+  <!-- Control view (public) -->\n \n-    <browser:page\n-        for="*"\n-        name="iterate_control"\n-        class=".control.Control"\n-        permission="zope2.View"\n-        allowed_attributes="checkin_allowed checkout_allowed cancel_allowed"\n-        />\n+  <browser:page\n+      name="iterate_control"\n+      for="*"\n+      class=".control.Control"\n+      allowed_attributes="checkin_allowed checkout_allowed cancel_allowed"\n+      permission="zope2.View"\n+      />\n \n-    <!-- Forms -->\n+  <!-- Forms -->\n \n-    <browser:page\n-        for="..interfaces.IIterateAware"\n-        name="content-checkout"\n-        class=".checkout.Checkout"\n-        template="checkout.pt"\n-        permission="zope2.View"\n-        />\n+  <browser:page\n+      name="content-checkout"\n+      for="..interfaces.IIterateAware"\n+      class=".checkout.Checkout"\n+      template="checkout.pt"\n+      permission="zope2.View"\n+      />\n \n-    <browser:page\n-        for="..interfaces.IIterateAware"\n-        name="content-checkin"\n-        class=".checkin.Checkin"\n-        template="checkin.pt"\n-        permission="cmf.ModifyPortalContent"\n-        />\n+  <browser:page\n+      name="content-checkin"\n+      for="..interfaces.IIterateAware"\n+      class=".checkin.Checkin"\n+      template="checkin.pt"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n-    <browser:page\n-        for="..interfaces.IIterateAware"\n-        name="content-cancel-checkout"\n-        class=".cancel.Cancel"\n-        template="cancel.pt"\n-        permission="cmf.ModifyPortalContent"\n-        />\n+  <browser:page\n+      name="content-cancel-checkout"\n+      for="..interfaces.IIterateAware"\n+      class=".cancel.Cancel"\n+      template="cancel.pt"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n-    <!-- Information -->\n+  <!-- Information -->\n \n-    <browser:page\n-       for="..interfaces.IIterateManagedContent"\n-       class=".diff.DiffView"\n-       name="iterate_diff"\n-       template="diff.pt"\n-       permission="zope2.View"\n-       />\n+  <browser:page\n+      name="iterate_diff"\n+      for="..interfaces.IIterateManagedContent"\n+      class=".diff.DiffView"\n+      template="diff.pt"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.app.iterate.baseline_info"\n-        manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n-        class=".info.BaselineInfoViewlet"\n-        permission="zope2.View"\n-        for="..interfaces.IBaseline"\n-        view="plone.app.layout.globals.interfaces.IViewView"\n-        />\n+  <browser:viewlet\n+      name="plone.app.iterate.baseline_info"\n+      for="..interfaces.IBaseline"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n+      class=".info.BaselineInfoViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.app.iterate.checkout_info"\n-        manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n-        class=".info.CheckoutInfoViewlet"\n-        permission="zope2.View"\n-        for="..interfaces.IWorkingCopy"\n-        view="plone.app.layout.globals.interfaces.IViewView"\n-        />\n+  <browser:viewlet\n+      name="plone.app.iterate.checkout_info"\n+      for="..interfaces.IWorkingCopy"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n+      class=".info.CheckoutInfoViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <!-- Resources -->\n-    <!-- These resources are deprecated.  Remove them in Plone 7. -->\n-    <browser:resource\n-        name="checkin.png"\n-        image="checkin.png"\n-        />\n+  <!-- Resources -->\n+  <!-- These resources are deprecated.  Remove them in Plone 7. -->\n+  <browser:resource\n+      name="checkin.png"\n+      image="checkin.png"\n+      />\n \n-    <browser:resource\n-        name="checkout.png"\n-        image="checkout.png"\n-        />\n+  <browser:resource\n+      name="checkout.png"\n+      image="checkout.png"\n+      />\n \n-    <browser:resource\n-        name="cancel-checkout.png"\n-        image="cancel.png"\n-        />\n+  <browser:resource\n+      name="cancel-checkout.png"\n+      image="cancel.png"\n+      />\n \n </configure>\ndiff --git a/plone/app/iterate/configure.zcml b/plone/app/iterate/configure.zcml\nindex d295c17..44239f3 100644\n--- a/plone/app/iterate/configure.zcml\n+++ b/plone/app/iterate/configure.zcml\n@@ -3,12 +3,25 @@\n     xmlns:five="http://namespaces.zope.org/five"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-  <include package="Products.CMFCore" file="meta.zcml"/>\n-  <include package="Products.GenericSetup" file="meta.zcml"/>\n-  <include package="zope.component" file="meta.zcml"/>\n-  <include package="zope.viewlet" file="meta.zcml"/>\n+  <include\n+      package="Products.CMFCore"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="Products.GenericSetup"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="zope.component"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="zope.viewlet"\n+      file="meta.zcml"\n+      />\n \n   <include package="plone.locking" />\n   <include package="plone.memoize" />\n@@ -22,16 +35,16 @@\n   <include package="zope.component" />\n   <include package="zope.viewlet" />\n \n-  <include package=".subscribers"/>\n-  <include package=".browser"/>\n+  <include package=".subscribers" />\n+  <include package=".browser" />\n \n   <genericsetup:registerProfile\n-    name="default"\n-    title="Working Copy Support (Iterate)"\n-    directory="profiles/default"\n-    description="Adds working copy support (aka. in-place staging) to Plone."\n-    provides="Products.GenericSetup.interfaces.EXTENSION"\n-    />\n+      name="default"\n+      title="Working Copy Support (Iterate)"\n+      description="Adds working copy support (aka. in-place staging) to Plone."\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/default"\n+      />\n \n   <!--\n     Remove, when CMFPlone no more depends on this profile.\n@@ -39,58 +52,58 @@\n     Addon(profile_id=u\'plone.app.iterate:plone.app.iterate\')\n   -->\n   <genericsetup:registerProfile\n-    name="plone.app.iterate"\n-    title="Working Copy Support (Iterate)"\n-    directory="profiles/default"\n-    description="Adds working copy support (aka. in-place staging) to Plone."\n-    provides="Products.GenericSetup.interfaces.EXTENSION"\n-    post_handler=".setuphandlers.deprecate_profile"\n-    />\n+      name="plone.app.iterate"\n+      title="Working Copy Support (Iterate)"\n+      description="Adds working copy support (aka. in-place staging) to Plone."\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/default"\n+      post_handler=".setuphandlers.deprecate_profile"\n+      />\n \n   <genericsetup:registerProfile\n       name="test"\n       title="plone.app.iterate: Test fixture"\n-      directory="profiles/test"\n       description="Extension profile to configure a test fixture"\n-      for="Products.CMFPlone.interfaces.ITestCasePloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="Products.CMFPlone.interfaces.ITestCasePloneSiteRoot"\n+      directory="profiles/test"\n       />\n \n   <genericsetup:registerProfile\n       name="testingdx"\n       title="plone.app.iterate: Test fixture for DX"\n-      directory="profiles/testingdx"\n       description="Adds sample content types for testing"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       for="Products.CMFPlone.interfaces.ITestCasePloneSiteRoot"\n+      directory="profiles/testingdx"\n       />\n \n   <genericsetup:registerProfile\n       name="uninstall"\n       title="Working Copy Support (Iterate) [uninstall]"\n-      directory="profiles/uninstall"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/uninstall"\n       />\n \n   <genericsetup:registerProfile\n       name="to1000"\n       title="Use new icons"\n-      directory="profiles/to1000"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/to1000"\n       />\n \n   <genericsetup:upgradeDepends\n-      source="121"\n-      destination="1000"\n       title="Use new icons"\n       profile="plone.app.iterate:default"\n+      source="121"\n+      destination="1000"\n       import_profile="plone.app.iterate:to1000"\n       />\n \n   <utility\n-      name="plone.app.iterate"\n       factory=".setuphandlers.HiddenProfiles"\n+      name="plone.app.iterate"\n       />\n \n   <adapter factory=".archiver.ContentArchiver" />\n@@ -108,21 +121,24 @@\n \n   <!-- Handle deletions of working copies -->\n   <subscriber\n-     for=".interfaces.IWorkingCopyRelation\n-          zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n-     handler=".event.handleDeletion"\n-     />\n+      for=".interfaces.IWorkingCopyRelation\n+           zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n+      handler=".event.handleDeletion"\n+      />\n \n   <permission\n-    id="plone.app.iterate.CheckInContent"\n-    title="iterate : Check in content"\n-    />\n+      id="plone.app.iterate.CheckInContent"\n+      title="iterate : Check in content"\n+      />\n \n   <permission\n-    id="plone.app.iterate.CheckOutContent"\n-    title="iterate : Check out content"\n-    />\n+      id="plone.app.iterate.CheckOutContent"\n+      title="iterate : Check out content"\n+      />\n \n-  <include package=".dexterity" zcml:condition="installed plone.app.relationfield" />\n+  <include\n+      package=".dexterity"\n+      zcml:condition="installed plone.app.relationfield"\n+      />\n \n </configure>\ndiff --git a/plone/app/iterate/dexterity/configure.zcml b/plone/app/iterate/dexterity/configure.zcml\nindex 42ddbe0..0457c7b 100644\n--- a/plone/app/iterate/dexterity/configure.zcml\n+++ b/plone/app/iterate/dexterity/configure.zcml\n@@ -1,31 +1,32 @@\n <configure\n-        xmlns="http://namespaces.zope.org/zope"\n-        xmlns:zcml="http://namespaces.zope.org/zcml"\n-        xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-        xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n-    <subscriber\n-       for="plone.app.iterate.interfaces.IAfterCheckinEvent"\n-       handler="plone.app.iterate.subscribers.locking.handleCheckin"\n-       />\n+  <subscriber\n+      for="plone.app.iterate.interfaces.IAfterCheckinEvent"\n+      handler="plone.app.iterate.subscribers.locking.handleCheckin"\n+      />\n \n-    <adapter\n-       for="plone.dexterity.interfaces.IDexterityContent"\n-       factory=".copier.ContentCopier"\n-       />\n+  <adapter\n+      factory=".copier.ContentCopier"\n+      for="plone.dexterity.interfaces.IDexterityContent"\n+      />\n \n-    <adapter\n-       for="plone.dexterity.interfaces.IDexterityContainer"\n-       factory=".copier.FolderishContentCopier"\n-       />\n+  <adapter\n+      factory=".copier.FolderishContentCopier"\n+      for="plone.dexterity.interfaces.IDexterityContainer"\n+      />\n \n-    <adapter\n-       for=".interfaces.IDexterityIterateAware"\n-       factory=".policy.CheckinCheckoutPolicyAdapter"\n-       />\n+  <adapter\n+      factory=".policy.CheckinCheckoutPolicyAdapter"\n+      for=".interfaces.IDexterityIterateAware"\n+      />\n \n-    <class class="plone.dexterity.content.DexterityContent">\n-        <implements interface="plone.app.iterate.dexterity.interfaces.IDexterityIterateAware" />\n-    </class>\n+  <class class="plone.dexterity.content.DexterityContent">\n+    <implements interface="plone.app.iterate.dexterity.interfaces.IDexterityIterateAware" />\n+  </class>\n \n </configure>\ndiff --git a/plone/app/iterate/profiles/default/actions.xml b/plone/app/iterate/profiles/default/actions.xml\nindex 49c3118..ec542d3 100644\n--- a/plone/app/iterate/profiles/default/actions.xml\n+++ b/plone/app/iterate/profiles/default/actions.xml\n@@ -1,43 +1,68 @@\n-<?xml version="1.0"?>\n-<object name="portal_actions" meta_type="Plone Actions Tool"\n-   xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n- <object name="object_buttons" meta_type="CMF Action Category">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Plone Actions Tool"\n+        name="portal_actions"\n+>\n+  <object meta_type="CMF Action Category"\n+          name="object_buttons"\n+  >\n \n-  <object name="iterate_checkin" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="">Check in</property>\n-   <property name="description" i18n:translate=""></property>\n-   <property name="url_expr">string:${object_url}/@@content-checkin</property>\n-   <property name="icon_expr">string:box-arrow-in-up-right</property>\n-   <property name="available_expr">python:path(\'object/@@iterate_control\').checkin_allowed()</property>\n-   <property name="permissions">\n-    <element value="View"/>\n-   </property>\n-   <property name="visible">True</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkin"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate=""\n+      >Check in</property>\n+      <property name="description"\n+                i18n:translate=""\n+      />\n+      <property name="url_expr">string:${object_url}/@@content-checkin</property>\n+      <property name="icon_expr">string:box-arrow-in-up-right</property>\n+      <property name="available_expr">python:path(\'object/@@iterate_control\').checkin_allowed()</property>\n+      <property name="permissions">\n+        <element value="View" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n \n-  <object name="iterate_checkout" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="">Check out</property>\n-   <property name="description" i18n:translate=""></property>\n-   <property name="url_expr">string:${object_url}/@@content-checkout</property>\n-   <property name="icon_expr">string:box-arrow-down-left</property>\n-   <property name="available_expr">python:path(\'object/@@iterate_control\').checkout_allowed()</property>\n-   <property name="permissions">\n-    <element value="View"/>\n-   </property>\n-   <property name="visible">True</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkout"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate=""\n+      >Check out</property>\n+      <property name="description"\n+                i18n:translate=""\n+      />\n+      <property name="url_expr">string:${object_url}/@@content-checkout</property>\n+      <property name="icon_expr">string:box-arrow-down-left</property>\n+      <property name="available_expr">python:path(\'object/@@iterate_control\').checkout_allowed()</property>\n+      <property name="permissions">\n+        <element value="View" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n \n-  <object name="iterate_checkout_cancel" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="">Cancel check-out</property>\n-   <property name="description" i18n:translate=""></property>\n-   <property name="url_expr">string:${object_url}/@@content-cancel-checkout</property>\n-   <property name="icon_expr">string:arrow-counterclockwise</property>\n-   <property name="available_expr">python:path(\'object/@@iterate_control\').cancel_allowed()</property>\n-   <property name="permissions">\n-    <element value="Modify portal content"/>\n-   </property>\n-   <property name="visible">True</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkout_cancel"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate=""\n+      >Cancel check-out</property>\n+      <property name="description"\n+                i18n:translate=""\n+      />\n+      <property name="url_expr">string:${object_url}/@@content-cancel-checkout</property>\n+      <property name="icon_expr">string:arrow-counterclockwise</property>\n+      <property name="available_expr">python:path(\'object/@@iterate_control\').cancel_allowed()</property>\n+      <property name="permissions">\n+        <element value="Modify portal content" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n \n- </object>\n+  </object>\n </object>\ndiff --git a/plone/app/iterate/profiles/default/metadata.xml b/plone/app/iterate/profiles/default/metadata.xml\nindex b22370d..f768b5a 100644\n--- a/plone/app/iterate/profiles/default/metadata.xml\n+++ b/plone/app/iterate/profiles/default/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>1000</version>\n </metadata>\ndiff --git a/plone/app/iterate/profiles/default/registry.xml b/plone/app/iterate/profiles/default/registry.xml\nindex bbe73c8..98b50af 100644\n--- a/plone/app/iterate/profiles/default/registry.xml\n+++ b/plone/app/iterate/profiles/default/registry.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n-    <records interface="plone.app.iterate.interfaces.IIterateSettings" />\n+  <records interface="plone.app.iterate.interfaces.IIterateSettings" />\n </registry>\ndiff --git a/plone/app/iterate/profiles/test/metadata.xml b/plone/app/iterate/profiles/test/metadata.xml\nindex e44e88c..0383546 100644\n--- a/plone/app/iterate/profiles/test/metadata.xml\n+++ b/plone/app/iterate/profiles/test/metadata.xml\n@@ -1,3 +1,4 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>1</version>\n   <dependencies>\ndiff --git a/plone/app/iterate/profiles/test/portal_placeful_workflow.xml b/plone/app/iterate/profiles/test/portal_placeful_workflow.xml\nindex 30fbc67..09ebde0 100644\n--- a/plone/app/iterate/profiles/test/portal_placeful_workflow.xml\n+++ b/plone/app/iterate/profiles/test/portal_placeful_workflow.xml\n@@ -1,6 +1,12 @@\n-<?xml version="1.0"?>\r\n-<object name="portal_placeful_workflow" meta_type="Placeful Workflow Tool">\r\n-    <property name="title"></property>\r\n-    <property name="max_chain_length" type="int">1</property>\r\n-    <object name="working-copy" meta_type="WorkflowPolicy" />\r\n-</object>\n\\ No newline at end of file\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Placeful Workflow Tool"\n+        name="portal_placeful_workflow"\n+>\n+  <property name="title" />\n+  <property name="max_chain_length"\n+            type="int"\n+  >1</property>\n+  <object meta_type="WorkflowPolicy"\n+          name="working-copy"\n+  />\n+</object>\ndiff --git a/plone/app/iterate/profiles/test/portal_placeful_workflow/working-copy.xml b/plone/app/iterate/profiles/test/portal_placeful_workflow/working-copy.xml\nindex a999931..b4f399d 100644\n--- a/plone/app/iterate/profiles/test/portal_placeful_workflow/working-copy.xml\n+++ b/plone/app/iterate/profiles/test/portal_placeful_workflow/working-copy.xml\n@@ -1,10 +1,14 @@\n-<?xml version="1.0"?>\r\n-<object name="working-copy" meta_type="WorkflowPolicy">\r\n-    <property name="title">Working Copy</property>\r\n-    <bindings>\r\n-        <default>\r\n-            <bound-workflow workflow_id="workingcopy_workflow" />\r\n-        </default>\r\n-        <type default_chain="true" type_id="Document" />\r\n-    </bindings>\r\n-</object>\r\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="WorkflowPolicy"\n+        name="working-copy"\n+>\n+  <property name="title">Working Copy</property>\n+  <bindings>\n+    <default>\n+      <bound-workflow workflow_id="workingcopy_workflow" />\n+    </default>\n+    <type default_chain="true"\n+          type_id="Document"\n+    />\n+  </bindings>\n+</object>\ndiff --git a/plone/app/iterate/profiles/test/workflows.xml b/plone/app/iterate/profiles/test/workflows.xml\nindex 4ebd2ce..fd63b85 100644\n--- a/plone/app/iterate/profiles/test/workflows.xml\n+++ b/plone/app/iterate/profiles/test/workflows.xml\n@@ -1,4 +1,8 @@\n-<?xml version="1.0" encoding="UTF-8"?>\r\n-<object name="portal_workflow" meta_type="Plone Workflow Tool">\r\n-    <object name="workingcopy_workflow" meta_type="Workflow" />\r\n-</object>\n\\ No newline at end of file\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Workflow Tool"\n+        name="portal_workflow"\n+>\n+  <object meta_type="Workflow"\n+          name="workingcopy_workflow"\n+  />\n+</object>\ndiff --git a/plone/app/iterate/profiles/test/workflows/workingcopy_workflow/definition.xml b/plone/app/iterate/profiles/test/workflows/workingcopy_workflow/definition.xml\nindex d445148..287c82b 100644\n--- a/plone/app/iterate/profiles/test/workflows/workingcopy_workflow/definition.xml\n+++ b/plone/app/iterate/profiles/test/workflows/workingcopy_workflow/definition.xml\n@@ -1,158 +1,238 @@\n-<?xml version="1.0"?>\r\n-<dc-workflow xmlns:i18n="http://xml.zope.org/namespaces/i18n" i18n:domain="plone" workflow_id="workingcopy_workflow"\r\n-    title="test wc workflow" state_variable="review_state" initial_state="draft-copy" i18n:attributes="title">\r\n-\r\n-    <!-- These are the permissions being managed -->\r\n-    <permission>Delete objects</permission>\r\n-    <permission>iterate : Check in content</permission>\r\n-    <permission>iterate : Check out content</permission>\r\n-    <permission>View</permission>\r\n-    <permission>Access contents information</permission>\r\n-    <permission>Modify portal content</permission>\r\n-    <permission>Copy or Move</permission>\r\n-\r\n-    <!-- The various workflow states, with their permission maps -->\r\n-    <state state_id="draft-copy" title="Draft (copy)" i18n:attributes="title">\r\n-        <description i18n:translate="">New version created but not ready for publication</description>\r\n-        <exit-transition transition_id="submit-copy-for-publication" />\r\n-        <permission-map name="Access contents information" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="Modify portal content" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="View" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="iterate : Check in content" acquired="False" />\r\n-        <permission-map name="iterate : Check out content" acquired="False" />\r\n-        <permission-map name="Copy or Move" acquired="False" />\r\n-        <permission-map name="Delete objects" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-    </state>\r\n-    \r\n-    <state state_id="pending-copy" title="Pending (copy)" i18n:attributes="title">\r\n-        <description i18n:translate="">Copy submitted for publication - pending approval</description>\r\n-        <exit-transition transition_id="withdraw-submitted-copy" />\r\n-        <exit-transition transition_id="reject-submitted-copy" />\r\n-        <permission-map name="Access contents information" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="Modify portal content" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="View" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="iterate : Check in content" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="iterate : Check out content" acquired="False" />\r\n-        <permission-map name="Copy or Move" acquired="False" />\r\n-        <permission-map name="Delete objects" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>        \r\n-    </state>\r\n-\r\n-    <!-- Transitions between states, including guard conditions -->\r\n-    <transition transition_id="submit-copy-for-publication" new_state="pending-copy" title="Submit draft content for publication" trigger="USER"\r\n-        before_script="" after_script="" i18n:attributes="title">\r\n-        <description i18n:translate="">\r\n-            Move the content to the pending state where it will be reviewed by an editor by publication.\r\n-        </description>\r\n-        <action url="%(content_url)s/content_status_modify?workflow_action=submit-copy-for-publication" category="workflow"\r\n-            i18n:translate="">Submit</action>\r\n-        <guard>\r\n-            <guard-permission>Modify portal content</guard-permission>\r\n-        </guard>\r\n-    </transition>\r\n-    <transition transition_id="reject-submitted-copy" new_state="draft-copy" title="Editor rejects submitted content"\r\n-        trigger="USER" before_script="" after_script="" i18n:attributes="title">\r\n-        <description i18n:translate="">\r\n-            Revert to draft.\r\n-        </description>\r\n-        <guard>\r\n-            <guard-permission>Review portal content</guard-permission>\r\n-        </guard>\r\n-    </transition>\r\n-    <transition transition_id="withdraw-submitted-copy" new_state="draft-copy" title="Contributor withdraws submitted content"\r\n-        trigger="USER" before_script="" after_script="" i18n:attributes="title">\r\n-        <description i18n:translate="">\r\n-            Revert to draft.\r\n-        </description>\r\n-        <guard>\r\n-            <guard-role>Contributor</guard-role>\r\n-        </guard>\r\n-    </transition>\r\n-\r\n-    <!-- Workflow variables, managed as part of workflow history -->\r\n-    <variable variable_id="action" for_catalog="False" for_status="True" update_always="True">\r\n-        <description>The last transition</description>\r\n-        <default>\r\n-            <expression>transition/getId|nothing</expression>\r\n-        </default>\r\n-        <guard>\r\n-        </guard>\r\n-    </variable>\r\n-    <variable variable_id="actor" for_catalog="False" for_status="True" update_always="True">\r\n-        <description>The ID of the user who performed the last transition</description>\r\n-        <default>\r\n-            <expression>user/getId</expression>\r\n-        </default>\r\n-        <guard>\r\n-        </guard>\r\n-    </variable>\r\n-    <variable variable_id="comments" for_catalog="False" for_status="True" update_always="True">\r\n-        <description>Comments about the last transition</description>\r\n-        <default>\r\n-            <expression>python:state_change.kwargs.get(\'comment\', \'\')</expression>\r\n-        </default>\r\n-        <guard>\r\n-        </guard>\r\n-    </variable>\r\n-    <variable variable_id="review_history" for_catalog="False" for_status="False" update_always="False">\r\n-        <description>Provides access to workflow history</description>\r\n-        <default>\r\n-            <expression>state_change/getHistory</expression>\r\n-        </default>\r\n-        <guard>\r\n-            <guard-permission>Request review</guard-permission>\r\n-            <guard-permission>Review portal content</guard-permission>\r\n-        </guard>\r\n-    </variable>\r\n-    <variable variable_id="time" for_catalog="False" for_status="True" update_always="True">\r\n-        <description>Time of the last transition</description>\r\n-        <default>\r\n-            <expression>state_change/getDateTime</expression>\r\n-        </default>\r\n-        <guard>\r\n-        </guard>\r\n-    </variable>\r\n-\r\n-</dc-workflow>\r\n+<?xml version="1.0" encoding="utf-8"?>\n+<dc-workflow xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+             initial_state="draft-copy"\n+             state_variable="review_state"\n+             title="test wc workflow"\n+             workflow_id="workingcopy_workflow"\n+             i18n:attributes="title"\n+             i18n:domain="plone"\n+>\n+\n+  <!-- These are the permissions being managed -->\n+  <permission>Delete objects</permission>\n+  <permission>iterate : Check in content</permission>\n+  <permission>iterate : Check out content</permission>\n+  <permission>View</permission>\n+  <permission>Access contents information</permission>\n+  <permission>Modify portal content</permission>\n+  <permission>Copy or Move</permission>\n+\n+  <!-- The various workflow states, with their permission maps -->\n+  <state state_id="draft-copy"\n+         title="Draft (copy)"\n+         i18n:attributes="title"\n+  >\n+    <description i18n:translate="">New version created but not ready for publication</description>\n+    <exit-transition transition_id="submit-copy-for-publication" />\n+    <permission-map acquired="False"\n+                    name="Access contents information"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="Modify portal content"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="View"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="iterate : Check in content"\n+    />\n+    <permission-map acquired="False"\n+                    name="iterate : Check out content"\n+    />\n+    <permission-map acquired="False"\n+                    name="Copy or Move"\n+    />\n+    <permission-map acquired="False"\n+                    name="Delete objects"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+  </state>\n+\n+  <state state_id="pending-copy"\n+         title="Pending (copy)"\n+         i18n:attributes="title"\n+  >\n+    <description i18n:translate="">Copy submitted for publication - pending approval</description>\n+    <exit-transition transition_id="withdraw-submitted-copy" />\n+    <exit-transition transition_id="reject-submitted-copy" />\n+    <permission-map acquired="False"\n+                    name="Access contents information"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="Modify portal content"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="View"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="iterate : Check in content"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="iterate : Check out content"\n+    />\n+    <permission-map acquired="False"\n+                    name="Copy or Move"\n+    />\n+    <permission-map acquired="False"\n+                    name="Delete objects"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+  </state>\n+\n+  <!-- Transitions between states, including guard conditions -->\n+  <transition after_script=""\n+              before_script=""\n+              new_state="pending-copy"\n+              title="Submit draft content for publication"\n+              transition_id="submit-copy-for-publication"\n+              trigger="USER"\n+              i18n:attributes="title"\n+  >\n+    <description i18n:translate="">\n+            Move the content to the pending state where it will be reviewed by an editor by publication.\n+        </description>\n+    <action category="workflow"\n+            url="%(content_url)s/content_status_modify?workflow_action=submit-copy-for-publication"\n+            i18n:translate=""\n+    >Submit</action>\n+    <guard>\n+      <guard-permission>Modify portal content</guard-permission>\n+    </guard>\n+  </transition>\n+  <transition after_script=""\n+              before_script=""\n+              new_state="draft-copy"\n+              title="Editor rejects submitted content"\n+              transition_id="reject-submitted-copy"\n+              trigger="USER"\n+              i18n:attributes="title"\n+  >\n+    <description i18n:translate="">\n+            Revert to draft.\n+        </description>\n+    <guard>\n+      <guard-permission>Review portal content</guard-permission>\n+    </guard>\n+  </transition>\n+  <transition after_script=""\n+              before_script=""\n+              new_state="draft-copy"\n+              title="Contributor withdraws submitted content"\n+              transition_id="withdraw-submitted-copy"\n+              trigger="USER"\n+              i18n:attributes="title"\n+  >\n+    <description i18n:translate="">\n+            Revert to draft.\n+        </description>\n+    <guard>\n+      <guard-role>Contributor</guard-role>\n+    </guard>\n+  </transition>\n+\n+  <!-- Workflow variables, managed as part of workflow history -->\n+  <variable for_catalog="False"\n+            for_status="True"\n+            update_always="True"\n+            variable_id="action"\n+  >\n+    <description>The last transition</description>\n+    <default>\n+      <expression>transition/getId|nothing</expression>\n+    </default>\n+    <guard>\n+</guard>\n+  </variable>\n+  <variable for_catalog="False"\n+            for_status="True"\n+            update_always="True"\n+            variable_id="actor"\n+  >\n+    <description>The ID of the user who performed the last transition</description>\n+    <default>\n+      <expression>user/getId</expression>\n+    </default>\n+    <guard>\n+</guard>\n+  </variable>\n+  <variable for_catalog="False"\n+            for_status="True"\n+            update_always="True"\n+            variable_id="comments"\n+  >\n+    <description>Comments about the last transition</description>\n+    <default>\n+      <expression>python:state_change.kwargs.get(\'comment\', \'\')</expression>\n+    </default>\n+    <guard>\n+</guard>\n+  </variable>\n+  <variable for_catalog="False"\n+            for_status="False"\n+            update_always="False"\n+            variable_id="review_history"\n+  >\n+    <description>Provides access to workflow history</description>\n+    <default>\n+      <expression>state_change/getHistory</expression>\n+    </default>\n+    <guard>\n+      <guard-permission>Request review</guard-permission>\n+      <guard-permission>Review portal content</guard-permission>\n+    </guard>\n+  </variable>\n+  <variable for_catalog="False"\n+            for_status="True"\n+            update_always="True"\n+            variable_id="time"\n+  >\n+    <description>Time of the last transition</description>\n+    <default>\n+      <expression>state_change/getDateTime</expression>\n+    </default>\n+    <guard>\n+</guard>\n+  </variable>\n+\n+</dc-workflow>\ndiff --git a/plone/app/iterate/profiles/testingdx/repositorytool.xml b/plone/app/iterate/profiles/testingdx/repositorytool.xml\nindex 4da978c..ac3dd30 100644\n--- a/plone/app/iterate/profiles/testingdx/repositorytool.xml\n+++ b/plone/app/iterate/profiles/testingdx/repositorytool.xml\n@@ -1,9 +1,9 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <repositorytool>\n-    <policymap>\n-        <type name="FolderishDocument">\n-            <policy name="at_edit_autoversion"/>\n-            <policy name="version_on_revert"/>\n-        </type>\n-    </policymap>\n+  <policymap>\n+    <type name="FolderishDocument">\n+      <policy name="at_edit_autoversion" />\n+      <policy name="version_on_revert" />\n+    </type>\n+  </policymap>\n </repositorytool>\ndiff --git a/plone/app/iterate/profiles/testingdx/types.xml b/plone/app/iterate/profiles/testingdx/types.xml\nindex 68faffd..494b373 100644\n--- a/plone/app/iterate/profiles/testingdx/types.xml\n+++ b/plone/app/iterate/profiles/testingdx/types.xml\n@@ -1,6 +1,10 @@\n-<?xml version="1.0"?>\n-<object name="portal_types" meta_type="Plone Types Tool">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n \n-  <object name="FolderishDocument" meta_type="Dexterity FTI" />\n+  <object meta_type="Dexterity FTI"\n+          name="FolderishDocument"\n+  />\n \n </object>\ndiff --git a/plone/app/iterate/profiles/testingdx/types/FolderishDocument.xml b/plone/app/iterate/profiles/testingdx/types/FolderishDocument.xml\nindex 17ed0f4..cac5020 100644\n--- a/plone/app/iterate/profiles/testingdx/types/FolderishDocument.xml\n+++ b/plone/app/iterate/profiles/testingdx/types/FolderishDocument.xml\n@@ -1,28 +1,35 @@\n-<?xml version="1.0"?>\n-<object name="FolderishDocument"\n-   meta_type="Dexterity FTI"\n-   i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="FolderishDocument"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic metadata -->\n-  <property name="title" i18n:translate="">DX Test Folderish Document</property>\n+  <property name="title"\n+            i18n:translate=""\n+  >DX Test Folderish Document</property>\n   <property name="description"\n-    i18n:translate=""></property>\n-  <property name="icon_expr"></property>\n+            i18n:translate=""\n+  />\n+  <property name="icon_expr" />\n   <property name="factory">FolderishDocument</property>\n   <property name="add_view_expr">string:${folder_url}/++add++FolderishDocument</property>\n   <property name="global_allow">True</property>\n   <property name="filter_content_types">False</property>\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="allow_discussion">False</property>\n \n   <!-- class used for content items -->\n   <property name="klass">plone.app.iterate.tests.dxtypes.FolderishDocument</property>\n   <property name="model_file">plone.app.contenttypes.schema:document.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.namefromtitle" />\n     <element value="plone.allowdiscussion" />\n     <element value="plone.excludefromnavigation" />\n@@ -36,28 +43,46 @@\n   </property>\n \n   <!-- View information -->\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n   <property name="immediate_view">view</property>\n   <property name="default_view">view</property>\n   <property name="view_methods">\n-   <element value="view"/>\n+    <element value="view" />\n   </property>\n   <property name="default_view_fallback">False</property>\n   <property name="add_permission">cmf.AddPortalContent</property>\n \n   <!-- Method aliases -->\n-  <alias from="(Default)" to="(dynamic view)" />\n-  <alias from="view" to="(selected layout)" />\n-  <alias from="edit" to="@@edit" />\n-  <alias from="sharing" to="@@sharing" />\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n+  />\n+  <alias from="view"\n+         to="(selected layout)"\n+  />\n+  <alias from="edit"\n+         to="@@edit"\n+  />\n+  <alias from="sharing"\n+         to="@@sharing"\n+  />\n \n   <!-- Actions -->\n-  <action title="View" action_id="view" category="object" condition_expr=""\n-    url_expr="string:${object_url}/" visible="True">\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          title="View"\n+          url_expr="string:${object_url}/"\n+          visible="True"\n+  >\n     <permission value="View" />\n   </action>\n-  <action title="Edit" action_id="edit" category="object" condition_expr=""\n-    url_expr="string:${object_url}/edit" visible="True">\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+  >\n     <permission value="Modify portal content" />\n   </action>\n </object>\ndiff --git a/plone/app/iterate/profiles/to1000/actions.xml b/plone/app/iterate/profiles/to1000/actions.xml\nindex 0d33102..805bf57 100644\n--- a/plone/app/iterate/profiles/to1000/actions.xml\n+++ b/plone/app/iterate/profiles/to1000/actions.xml\n@@ -1,19 +1,32 @@\n-<?xml version="1.0"?>\n-<object name="portal_actions" meta_type="Plone Actions Tool"\n-   xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n- <object name="object_buttons" meta_type="CMF Action Category">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Plone Actions Tool"\n+        name="portal_actions"\n+>\n+  <object meta_type="CMF Action Category"\n+          name="object_buttons"\n+  >\n \n-  <object name="iterate_checkin" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="icon_expr">string:box-arrow-in-up-right</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkin"\n+            i18n:domain="plone"\n+    >\n+      <property name="icon_expr">string:box-arrow-in-up-right</property>\n+    </object>\n \n-  <object name="iterate_checkout" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="icon_expr">string:box-arrow-down-left</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkout"\n+            i18n:domain="plone"\n+    >\n+      <property name="icon_expr">string:box-arrow-down-left</property>\n+    </object>\n \n-  <object name="iterate_checkout_cancel" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="icon_expr">string:arrow-counterclockwise</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkout_cancel"\n+            i18n:domain="plone"\n+    >\n+      <property name="icon_expr">string:arrow-counterclockwise</property>\n+    </object>\n \n- </object>\n+  </object>\n </object>\ndiff --git a/plone/app/iterate/profiles/uninstall/actions.xml b/plone/app/iterate/profiles/uninstall/actions.xml\nindex 1ce03a8..a4fc09c 100644\n--- a/plone/app/iterate/profiles/uninstall/actions.xml\n+++ b/plone/app/iterate/profiles/uninstall/actions.xml\n@@ -1,9 +1,19 @@\n-<?xml version="1.0"?>\n-<object name="portal_actions" meta_type="Plone Actions Tool"\n-        xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n-  <object name="object_buttons" meta_type="CMF Action Category">\n-    <object name="iterate_checkin" remove="true" />\n-    <object name="iterate_checkout" remove="true" />\n-    <object name="iterate_checkout_cancel" remove="true" />\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Plone Actions Tool"\n+        name="portal_actions"\n+>\n+  <object meta_type="CMF Action Category"\n+          name="object_buttons"\n+  >\n+    <object name="iterate_checkin"\n+            remove="true"\n+    />\n+    <object name="iterate_checkout"\n+            remove="true"\n+    />\n+    <object name="iterate_checkout_cancel"\n+            remove="true"\n+    />\n   </object>\n </object>\ndiff --git a/plone/app/iterate/profiles/uninstall/metadata.xml b/plone/app/iterate/profiles/uninstall/metadata.xml\nindex b22370d..f768b5a 100644\n--- a/plone/app/iterate/profiles/uninstall/metadata.xml\n+++ b/plone/app/iterate/profiles/uninstall/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>1000</version>\n </metadata>\ndiff --git a/plone/app/iterate/profiles/uninstall/registry.xml b/plone/app/iterate/profiles/uninstall/registry.xml\nindex bbe11b4..360c80e 100644\n--- a/plone/app/iterate/profiles/uninstall/registry.xml\n+++ b/plone/app/iterate/profiles/uninstall/registry.xml\n@@ -1,4 +1,6 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n-    <records interface="plone.app.iterate.interfaces.IIterateSettings" remove="true" />\n+  <records interface="plone.app.iterate.interfaces.IIterateSettings"\n+           remove="true"\n+  />\n </registry>\ndiff --git a/plone/app/iterate/subscribers/configure.zcml b/plone/app/iterate/subscribers/configure.zcml\nindex ecdc378..e9c4ce7 100644\n--- a/plone/app/iterate/subscribers/configure.zcml\n+++ b/plone/app/iterate/subscribers/configure.zcml\n@@ -1,82 +1,81 @@\n-<configure\n-    xmlns="http://namespaces.zope.org/zope">\n+<configure xmlns="http://namespaces.zope.org/zope">\n \n \n-    <!-- Locking -->\n+  <!-- Locking -->\n \n-    <subscriber\n-       for="..interfaces.ICheckoutEvent"\n-       handler=".locking.handleCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckoutEvent"\n+      handler=".locking.handleCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.ICheckinEvent"\n-       handler=".locking.handleCheckin"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckinEvent"\n+      handler=".locking.handleCheckin"\n+      />\n \n-    <subscriber\n-       for="..interfaces.ICancelCheckoutEvent"\n-       handler=".locking.handleCancelCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICancelCheckoutEvent"\n+      handler=".locking.handleCancelCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.IWorkingCopyDeletedEvent"\n-       handler=".locking.handleWCDeleted"\n-       />\n+  <subscriber\n+      for="..interfaces.IWorkingCopyDeletedEvent"\n+      handler=".locking.handleWCDeleted"\n+      />\n \n-    <!-- Marker  -->\n+  <!-- Marker  -->\n \n-    <subscriber\n-       for="..interfaces.ICheckoutEvent"\n-       handler=".marker.handleCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckoutEvent"\n+      handler=".marker.handleCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.ICheckinEvent"\n-       handler=".marker.handleCheckin"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckinEvent"\n+      handler=".marker.handleCheckin"\n+      />\n \n-    <subscriber\n-       for="..interfaces.ICancelCheckoutEvent"\n-       handler=".marker.handleCancelCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICancelCheckoutEvent"\n+      handler=".marker.handleCancelCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.IWorkingCopyDeletedEvent"\n-       handler=".marker.handleWCDeleted"\n-       />\n+  <subscriber\n+      for="..interfaces.IWorkingCopyDeletedEvent"\n+      handler=".marker.handleWCDeleted"\n+      />\n \n \n-    <!-- Metadata -->\n+  <!-- Metadata -->\n \n-    <subscriber\n-       for="..interfaces.ICheckoutEvent"\n-       handler=".metadata.handleCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckoutEvent"\n+      handler=".metadata.handleCheckout"\n+      />\n \n-    <!-- Versioning -->\n+  <!-- Versioning -->\n \n-    <subscriber\n-       for="..interfaces.IBeforeCheckoutEvent"\n-       handler=".versioning.handleBeforeCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.IBeforeCheckoutEvent"\n+      handler=".versioning.handleBeforeCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.IAfterCheckinEvent"\n-       handler=".versioning.handleAfterCheckin"\n-       />\n+  <subscriber\n+      for="..interfaces.IAfterCheckinEvent"\n+      handler=".versioning.handleAfterCheckin"\n+      />\n \n \n-    <!-- Workflow -->\n+  <!-- Workflow -->\n \n-    <subscriber\n-       for="..interfaces.ICheckoutEvent"\n-       handler=".workflow.handleCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckoutEvent"\n+      handler=".workflow.handleCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.ICheckinEvent"\n-       handler=".workflow.handleCheckin"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckinEvent"\n+      handler=".workflow.handleCheckin"\n+      />\n \n </configure>\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-02T23:58:43+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/58cee8706aa09413aa31cfb0e996120868d60ec8

chore: zptlint PT

Files changed:
M plone/app/iterate/browser/cancel.pt
M plone/app/iterate/browser/checkin.pt
M plone/app/iterate/browser/checkout.pt
M plone/app/iterate/browser/diff.pt
M plone/app/iterate/browser/info_baseline.pt
M plone/app/iterate/browser/info_checkout.pt

b'diff --git a/plone/app/iterate/browser/cancel.pt b/plone/app/iterate/browser/cancel.pt\nindex a1af209..3b25333 100644\n--- a/plone/app/iterate/browser/cancel.pt\n+++ b/plone/app/iterate/browser/cancel.pt\n@@ -1,54 +1,61 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content fill-slot="content">\n-<metal:content define-macro="content">\n-<article id="content">\n-    <form action="#"\n-        method="post"\n-        tal:attributes="action string:${context/absolute_url}/@@content-cancel-checkout">\n-\n-      <h1 class="documentFirstHeading"\n-          i18n:translate="title_cancel">\n-        Cancel check-out of <span i18n:name="object_title" tal:content="context/Title" />.\n-      </h1>\n-\n-      <p i18n:translate="description_cancel">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content fill-slot="content">\n+      <metal:content define-macro="content">\n+        <article id="content">\n+          <form action="#"\n+                method="post"\n+                tal:attributes="\n+                  action string:${context/absolute_url}/@@content-cancel-checkout;\n+                "\n+          >\n+\n+            <h1 class="documentFirstHeading"\n+                i18n:translate="title_cancel"\n+            >\n+        Cancel check-out of\n+              <span tal:content="context/Title"\n+                    i18n:name="object_title"\n+              ></span>.\n+            </h1>\n+\n+            <p i18n:translate="description_cancel">\n         Canceling the check-out will delete this working copy, and any modifications\n         made to it will be lost. The existing version of the content will become\n         unlocked.\n-      </p>\n-\n-      <div class="formControls">\n-\n-        <input\n-            class="destructive"\n-            type="submit"\n-            name="form.button.Cancel"\n-            value="Cancel checkout"\n-            i18n:attributes="value"\n-            />\n-\n-        <input\n-            class="standalone"\n-            type="submit"\n-            name="form.button.Keep"\n-            value="Keep checkout"\n-            i18n:attributes="value"\n-            />\n-\n-      </div>\n-\n-    </form>\n-</article>\n-</metal:content>\n-</metal:content>\n-\n-</body>\n-</html>\n\\ No newline at end of file\n+            </p>\n+\n+            <div class="formControls">\n+\n+              <input class="destructive"\n+                     name="form.button.Cancel"\n+                     type="submit"\n+                     value="Cancel checkout"\n+                     i18n:attributes="value"\n+              />\n+\n+              <input class="standalone"\n+                     name="form.button.Keep"\n+                     type="submit"\n+                     value="Keep checkout"\n+                     i18n:attributes="value"\n+              />\n+\n+            </div>\n+\n+          </form>\n+        </article>\n+      </metal:content>\n+    </metal:content>\n+\n+  </body>\n+</html>\ndiff --git a/plone/app/iterate/browser/checkin.pt b/plone/app/iterate/browser/checkin.pt\nindex ebfa2ed..3feaffb 100644\n--- a/plone/app/iterate/browser/checkin.pt\n+++ b/plone/app/iterate/browser/checkin.pt\n@@ -1,72 +1,83 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content fill-slot="content">\n-<metal:content define-macro="content">\n-<article id="content">\n+    <metal:content fill-slot="content">\n+      <metal:content define-macro="content">\n+        <article id="content">\n \n-    <form action="#"\n-        method="post"\n-        tal:attributes="action string:${context/absolute_url}/@@content-checkin">\n+          <form action="#"\n+                method="post"\n+                tal:attributes="\n+                  action string:${context/absolute_url}/@@content-checkin;\n+                "\n+          >\n \n-    <h1 class="documentFirstHeading"\n-        i18n:translate="title_checkin">\n-        Check in <span i18n:name="object_title" tal:content="here/Title" />\n-    </h1>\n+            <h1 class="documentFirstHeading"\n+                i18n:translate="title_checkin"\n+            >\n+        Check in\n+              <span tal:content="here/Title"\n+                    i18n:name="object_title"\n+              ></span>\n+            </h1>\n \n-    <p i18n:translate="description_checkin">\n+            <p i18n:translate="description_checkin">\n         Checking in this working copy will replace the existing item\n         with the working copy.\n-    </p>\n+            </p>\n \n-    <fieldset>\n+            <fieldset>\n \n-            <div class="field">\n-              <label for="description"\n-                    i18n:translate="label_checkin_message">Check-in Message\n-               </label>\n+              <div class="field">\n+                <label for="description"\n+                       i18n:translate="label_checkin_message"\n+                >Check-in Message\n+                </label>\n \n-              <div class="formHelp" i18n:translate="help_checkin_message">\n+                <div class="formHelp"\n+                     i18n:translate="help_checkin_message"\n+                >\n                   Enter a message to be saved alongside the check-in. This\n                   should explain what was changed, for audit purposes.\n-              </div>\n+                </div>\n \n-              <textarea cols="60"\n-                        rows="3"\n-                        id="checkin_message"\n-                        name="checkin_message"></textarea>\n-            </div>\n+                <textarea id="checkin_message"\n+                          cols="60"\n+                          name="checkin_message"\n+                          rows="3"\n+                ></textarea>\n+              </div>\n \n-            <div class="formControls">\n-                <input\n-                    class="context"\n-                    type="submit"\n-                    name="form.button.Checkin"\n-                    value="Check in"\n-                    i18n:attributes="value"\n-                    />\n+              <div class="formControls">\n+                <input class="context"\n+                       name="form.button.Checkin"\n+                       type="submit"\n+                       value="Check in"\n+                       i18n:attributes="value"\n+                />\n \n-                <input\n-                    class="standalone"\n-                    type="submit"\n-                    name="form.button.Cancel"\n-                    value="Cancel"\n-                    i18n:attributes="value label_cancel"\n-                    />\n-            </div>\n+                <input class="standalone"\n+                       name="form.button.Cancel"\n+                       type="submit"\n+                       value="Cancel"\n+                       i18n:attributes="value label_cancel"\n+                />\n+              </div>\n \n-    </fieldset>\n+            </fieldset>\n \n-    </form>\n-</article>\n-</metal:content>\n-</metal:content>\n+          </form>\n+        </article>\n+      </metal:content>\n+    </metal:content>\n \n-</body>\n-</html>\n\\ No newline at end of file\n+  </body>\n+</html>\ndiff --git a/plone/app/iterate/browser/checkout.pt b/plone/app/iterate/browser/checkout.pt\nindex 2092a55..45b308b 100644\n--- a/plone/app/iterate/browser/checkout.pt\n+++ b/plone/app/iterate/browser/checkout.pt\n@@ -1,95 +1,114 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<div id="content" metal:fill-slot="body"\n-     tal:define="containers python:list(view.containers())">\n-\n-    <form action="#"\n-        method="post"\n-        name="checkout"\n-        tal:attributes="action string:${context/absolute_url}/@@content-checkout">\n-\n-    <h1 i18n:translate="title_checkout">\n-        Check out <span i18n:name="object_title" tal:content="here/Title" />\n-    </h1>\n-\n-    <p i18n:translate="description_checkout">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <div id="content"\n+         metal:fill-slot="body"\n+         tal:define="\n+           containers python:list(view.containers());\n+         "\n+    >\n+\n+      <form action="#"\n+            method="post"\n+            name="checkout"\n+            tal:attributes="\n+              action string:${context/absolute_url}/@@content-checkout;\n+            "\n+      >\n+\n+        <h1 i18n:translate="title_checkout">\n+        Check out\n+          <span tal:content="here/Title"\n+                i18n:name="object_title"\n+          ></span>\n+        </h1>\n+\n+        <p i18n:translate="description_checkout">\n         On check-out, a working copy of the content item will be created in the selected\n         container, and the original will be locked to prevent other users from\n         editing it.\n-    </p>\n-\n-    <tal:one_container tal:condition="python:len(containers)==1">\n-    <input\n-        type="hidden"\n-        name="checkout_location"\n-        tal:define = "item python:containers[0]"\n-        tal:attributes="id string:checkout_location_${item/name};\n-                        value item/name"\n-        />\n-    </tal:one_container>\n-\n-    <fieldset tal:condition="python:len(containers)!=1">\n-\n-        <legend i18n:translate="legend_details">Details</legend>\n-\n-            <div class="field">\n-\n-            <label for="checkout_folder" i18n:translate="label_checkout_folder">\n+        </p>\n+\n+        <tal:one_container tal:condition="python:len(containers)==1">\n+          <input name="checkout_location"\n+                 type="hidden"\n+                 tal:define="\n+                   item python:containers[0];\n+                 "\n+                 tal:attributes="\n+                   id string:checkout_location_${item/name};\n+                   value item/name;\n+                 "\n+          />\n+        </tal:one_container>\n+\n+        <fieldset tal:condition="python:len(containers)!=1">\n+\n+          <legend i18n:translate="legend_details">Details</legend>\n+\n+          <div class="field">\n+\n+            <label for="checkout_folder"\n+                   i18n:translate="label_checkout_folder"\n+            >\n                 Checkout Folder\n             </label>\n-            <div class="formHelp" i18n:translate="help_checkout_folder">\n+            <div class="formHelp"\n+                 i18n:translate="help_checkout_folder"\n+            >\n                 Select the folder to checkout to.\n             </div>\n \n             <div tal:repeat="item view/containers">\n \n-                <input\n-                    type="radio"\n-                    name="checkout_location"\n-                    tal:attributes="id string:checkout_location_${item/name};\n-                                    value item/name"\n-                    />\n-\n-                <label\n-                    tal:attributes="for string:checkout_location_${item/name}"\n-                    tal:content="item/locator/title"\n-                    />\n+              <input name="checkout_location"\n+                     type="radio"\n+                     tal:attributes="\n+                       id string:checkout_location_${item/name};\n+                       value item/name;\n+                     "\n+              />\n \n-           </div>\n+              <label tal:content="item/locator/title"\n+                     tal:attributes="\n+                       for string:checkout_location_${item/name};\n+                     "\n+              ></label>\n \n             </div>\n \n+          </div>\n+\n         </fieldset>\n \n         <div class="formControls">\n \n-            <input\n-                class="context"\n-                type="submit"\n-                name="form.button.Checkout"\n-                value="Check out"\n-                i18n:attributes="value"\n-                />\n-\n-            <input\n-                class="standalone"\n-                type="submit"\n-                name="form.button.Cancel"\n-                value="Cancel"\n-                i18n:attributes="value label_cancel"\n-                />\n+          <input class="context"\n+                 name="form.button.Checkout"\n+                 type="submit"\n+                 value="Check out"\n+                 i18n:attributes="value"\n+          />\n+\n+          <input class="standalone"\n+                 name="form.button.Cancel"\n+                 type="submit"\n+                 value="Cancel"\n+                 i18n:attributes="value label_cancel"\n+          />\n \n         </div>\n \n-    </form>\n+      </form>\n \n-</div>\n+    </div>\n \n-</html>\n+  </body></html>\ndiff --git a/plone/app/iterate/browser/diff.pt b/plone/app/iterate/browser/diff.pt\nindex 4e56911..d486072 100644\n--- a/plone/app/iterate/browser/diff.pt\n+++ b/plone/app/iterate/browser/diff.pt\n@@ -1,118 +1,181 @@\n <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"\n "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n \n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      lang="en-US"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en-US"\n+      i18n:domain="plone"\n+>\n \n-<tal:block metal:fill-slot="base">\n+  <tal:block metal:fill-slot="base">\n     <base href=""\n-          tal:define="current_page_url context/@@plone_context_state/current_page_url"\n-          tal:attributes="href current_page_url" />\n-</tal:block>\n-<tal:block metal:fill-slot="head_slot">\n-    <link rel="stylesheet" type="text/css" href="compare.css"\n-          tal:attributes="href string:${portal_url}/compare.css"/>\n-</tal:block>\n+          tal:define="\n+            current_page_url context/@@plone_context_state/current_page_url;\n+          "\n+          tal:attributes="\n+            href current_page_url;\n+          "\n+    />\n+  </tal:block>\n+  <tal:block metal:fill-slot="head_slot">\n+    <link href="compare.css"\n+          rel="stylesheet"\n+          type="text/css"\n+          tal:attributes="\n+            href string:${portal_url}/compare.css;\n+          "\n+    />\n+  </tal:block>\n \n-<body>\n-  <metal:main metal:fill-slot="main"\n-       tal:define="diffs view/diffs;\n-                   diff_url string:${context/absolute_url}/@@iterate_diff">\n+  <body>\n+    <metal:main metal:fill-slot="main"\n+                tal:define="\n+                  diffs view/diffs;\n+                  diff_url string:${context/absolute_url}/@@iterate_diff;\n+                "\n+    >\n \n-    <h1 class="documentFirstHeading" i18n:translate="">\n+      <h1 class="documentFirstHeading"\n+          i18n:translate=""\n+      >\n         Changes to\n-        <span tal:replace="context/title_or_id" i18n:name="title"/>\n-    </h1>\n+        <span tal:replace="context/title_or_id"\n+              i18n:name="title"\n+        ></span>\n+      </h1>\n \n-    <div id="content-core">\n-        <em tal:condition="diffs/same" i18n:translate="">\n+      <div id="content-core">\n+        <em tal:condition="diffs/same"\n+            i18n:translate=""\n+        >\n             No significant changes found.\n         </em>\n \n         <div tal:condition="not:diffs/same">\n-            <div metal:use-macro="context/diff_legend/macros/diff_legend" />\n+          <div metal:use-macro="context/diff_legend/macros/diff_legend"></div>\n \n-            <form id="diffs"\n-                  action="#"\n-                  tal:repeat="d diffs/getDiffs">\n-              <div class="field"\n-                   tal:condition="not:d/same"\n-                   tal:define="field_label d/label;\n-                               unified exists:d/unified_diff;\n-                               html exists:d/html_diff;\n-                               inline exists:d/inline_diff;\n-                               ndiff exists:d/ndiff;\n-                               inline python: inline and not request.get(\'no_inline\', 0);\n-                               html python: html and not request.get(\'show_unified\', 0)">\n-                <label tal:content="field_label" />\n+          <form id="diffs"\n+                action="#"\n+                tal:repeat="d diffs/getDiffs"\n+          >\n+            <div class="field"\n+                 tal:define="\n+                   field_label d/label;\n+                   unified exists:d/unified_diff;\n+                   html exists:d/html_diff;\n+                   inline exists:d/inline_diff;\n+                   ndiff exists:d/ndiff;\n+                   inline python: inline and not request.get(\'no_inline\', 0);\n+                   html python: html and not request.get(\'show_unified\', 0);\n+                 "\n+                 tal:condition="not:d/same"\n+            >\n+              <label tal:content="field_label"></label>\n \n-                <tal:html condition="inline">\n-                    <br />\n-                    <a href="#"\n-                       tal:attributes="href string:${diff_url}?no_inline:int=1" i18n:translate="">Show code differences</a>\n-                    <br />\n-                    <br />\n-                    <div class="inline-diff"\n-                         tal:content="structure d/inline_diff">[inline diff]</div>\n-                </tal:html>\n-                <tal:html condition="python: html and not inline">\n-                    <br />\n-                    <tal:visual-only tal:condition="exists:d/inline_diff">\n-                        <a href="#"\n-                           tal:attributes="href string:${diff_url}" i18n:translate="">Show visual differences</a>\n-                        <br />\n-                    </tal:visual-only>\n-                    <a href="#"\n-                       tal:attributes="href string:${diff_url}?no_inline:int=1&amp;show_unified:int=1" i18n:translate="">Unified diff format</a>\n-                    <pre tal:content="structure d/html_diff">[html diff]</pre>\n-                </tal:html>\n-                <tal:unified condition="python:unified and not html">\n-                    <br />\n-                    <a href="#"\n-                        tal:condition="exists:d/inline_diff"\n-                        tal:attributes="href string:${diff_url}" i18n:translate="">Show visual differences</a>\n-                    <br />\n-                    <a href="#"\n-                       tal:condition="exists:d/html_diff"\n-                       tal:attributes="href string:${diff_url}?no_inline:int=1" i18n:translate="">Show side by side</a>\n-                    <pre tal:content="d/unified_diff">[unified diff]</pre>\n-                </tal:unified>\n-                <tal:ndiff condition="python:ndiff and not (unified or html)">\n-                    <pre tal:content="d/ndiff">[ndiff]</pre>\n-                </tal:ndiff>\n-                <tal:nodiff condition="python:not (unified or html or ndiff)">\n-                    <span class="diff_chg" i18n:translate="">Field Changed</span>\n-                    <br /><br />\n-                </tal:nodiff>\n-              </div>\n-            </form>\n+              <tal:html condition="inline">\n+                <br />\n+                <a href="#"\n+                   tal:attributes="\n+                     href string:${diff_url}?no_inline:int=1;\n+                   "\n+                   i18n:translate=""\n+                >Show code differences</a>\n+                <br />\n+                <br />\n+                <div class="inline-diff"\n+                     tal:content="structure d/inline_diff"\n+                >[inline diff]</div>\n+              </tal:html>\n+              <tal:html condition="python: html and not inline">\n+                <br />\n+                <tal:visual-only tal:condition="exists:d/inline_diff">\n+                  <a href="#"\n+                     tal:attributes="\n+                       href string:${diff_url};\n+                     "\n+                     i18n:translate=""\n+                  >Show visual differences</a>\n+                  <br />\n+                </tal:visual-only>\n+                <a href="#"\n+                   tal:attributes="\n+                     href string:${diff_url}?no_inline:int=1&amp;show_unified:int=1;\n+                   "\n+                   i18n:translate=""\n+                >Unified diff format</a>\n+                <pre tal:content="structure d/html_diff">[html diff]</pre>\n+              </tal:html>\n+              <tal:unified condition="python:unified and not html">\n+                <br />\n+                <a href="#"\n+                   tal:condition="exists:d/inline_diff"\n+                   tal:attributes="\n+                     href string:${diff_url};\n+                   "\n+                   i18n:translate=""\n+                >Show visual differences</a>\n+                <br />\n+                <a href="#"\n+                   tal:condition="exists:d/html_diff"\n+                   tal:attributes="\n+                     href string:${diff_url}?no_inline:int=1;\n+                   "\n+                   i18n:translate=""\n+                >Show side by side</a>\n+                <pre tal:content="d/unified_diff">[unified diff]</pre>\n+              </tal:unified>\n+              <tal:ndiff condition="python:ndiff and not (unified or html)">\n+                <pre tal:content="d/ndiff">[ndiff]</pre>\n+              </tal:ndiff>\n+              <tal:nodiff condition="python:not (unified or html or ndiff)">\n+                <span class="diff_chg"\n+                      i18n:translate=""\n+                >Field Changed</span>\n+                <br /><br />\n+              </tal:nodiff>\n+            </div>\n+          </form>\n         </div>\n \n         <tal:block tal:condition="diffs/recursive">\n-        <h2 i18n:translate="">Changed files</h2>\n-        <i tal:condition="not:diffs/getSubDiffs">None</i>\n-        <ul tal:condition="diffs/getSubDiffs">\n+          <h2 i18n:translate="">Changed files</h2>\n+          <i tal:condition="not:diffs/getSubDiffs">None</i>\n+          <ul tal:condition="diffs/getSubDiffs">\n             <li tal:repeat="cs diffs/getSubDiffs">\n-                <tal:check condition="not:cs/same">\n-                    <a tal:content="cs/id" tal:attributes="href cs/id">[filename]</a>\n-               </tal:check>\n-           </li>\n-        </ul>\n+              <tal:check condition="not:cs/same">\n+                <a tal:content="cs/id"\n+                   tal:attributes="\n+                     href cs/id;\n+                   "\n+                >[filename]</a>\n+              </tal:check>\n+            </li>\n+          </ul>\n \n-        <h2 i18n:translate="">Removed files</h2>\n-        <em tal:condition="not:diffs/getRemovedItems" i18n:translate="">None</em>\n-        <ul tal:condition="diffs/getRemovedItems">\n-        <li tal:repeat="id diffs/getRemovedItems" tal:content="id">[filename]</li>\n-        </ul>\n+          <h2 i18n:translate="">Removed files</h2>\n+          <em tal:condition="not:diffs/getRemovedItems"\n+              i18n:translate=""\n+          >None</em>\n+          <ul tal:condition="diffs/getRemovedItems">\n+            <li tal:repeat="id diffs/getRemovedItems"\n+                tal:content="id"\n+            >[filename]</li>\n+          </ul>\n \n-        <h2 i18n:translate="">Added files</h2>\n-        <em tal:condition="not:diffs/getAddedItems" i18n:translate="">None</em>\n-        <ul tal:condition="diffs/getAddedItems">\n-        <li tal:repeat="id diffs/getAddedItems"><a tal:content="id" tal:attributes="href id">[filename]</a></li>\n-        </ul>\n+          <h2 i18n:translate="">Added files</h2>\n+          <em tal:condition="not:diffs/getAddedItems"\n+              i18n:translate=""\n+          >None</em>\n+          <ul tal:condition="diffs/getAddedItems">\n+            <li tal:repeat="id diffs/getAddedItems"><a tal:content="id"\n+                 tal:attributes="\n+                   href id;\n+                 "\n+              >[filename]</a></li>\n+          </ul>\n         </tal:block>\n-    </div>\n-  </metal:main>\n-</body>\n+      </div>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/iterate/browser/info_baseline.pt b/plone/app/iterate/browser/info_baseline.pt\nindex 4738777..2728015 100644\n--- a/plone/app/iterate/browser/info_baseline.pt\n+++ b/plone/app/iterate/browser/info_baseline.pt\n@@ -1,26 +1,40 @@\n <div class="portalMessage warning"\n-     tal:define="working_copy view/working_copy;\n-                 isAnon context/@@plone_portal_state/anonymous;"\n+     tal:define="\n+       working_copy view/working_copy;\n+       isAnon context/@@plone_portal_state/anonymous;\n+     "\n+     tal:condition="python: not isAnon"\n      i18n:domain="plone"\n-     tal:condition="python: not isAnon">\n+>\n \n-    <strong i18n:translate="">Warning</strong>\n-    <tal:block i18n:translate="working_copy_info">\n+  <strong i18n:translate="">Warning</strong>\n+  <tal:block i18n:translate="working_copy_info">\n         This item is being edited by\n-        <a i18n:name="creator"\n-           tal:attributes="href view/creator_url"\n-           tal:omit-tag="not: view/creator_url"\n-           tal:content="view/creator_name">john smith</a>\n+    <a tal:content="view/creator_name"\n+       tal:omit-tag="not: view/creator_url"\n+       tal:attributes="\n+         href view/creator_url;\n+       "\n+       i18n:name="creator"\n+    >john smith</a>\n         in\n-        <a i18n:name="working_copy"\n-           i18n:translate="label_working_copy"\n-           tal:attributes="href working_copy/@@plone_context_state/view_url;\n-                           title working_copy/Description">a working copy</a>\n+    <a tal:attributes="\n+         href working_copy/@@plone_context_state/view_url;\n+         title working_copy/Description;\n+       "\n+       i18n:name="working_copy"\n+       i18n:translate="label_working_copy"\n+    >a working copy</a>\n         created on\n-        <span i18n:name="created" tal:content="view/created"/>.\n+    <span tal:content="view/created"\n+          i18n:name="created"\n+    ></span>.\n \n-    </tal:block>\n+  </tal:block>\n \n-    (<a i18n:translate="label_view_changes"\n-         tal:attributes="href string:${context/absolute_url}/@@iterate_diff">View changes</a>)\n+  (<a tal:attributes="\n+       href string:${context/absolute_url}/@@iterate_diff;\n+     "\n+     i18n:translate="label_view_changes"\n+  >View changes</a>)\n </div>\ndiff --git a/plone/app/iterate/browser/info_checkout.pt b/plone/app/iterate/browser/info_checkout.pt\nindex 1eccd5e..9226b01 100644\n--- a/plone/app/iterate/browser/info_checkout.pt\n+++ b/plone/app/iterate/browser/info_checkout.pt\n@@ -1,28 +1,40 @@\n <div class="portalMessage info"\n-     tal:define="baseline view/baseline;"\n-     i18n:domain="plone">\n+     tal:define="\n+       baseline view/baseline;\n+     "\n+     i18n:domain="plone"\n+>\n \n-    <strong i18n:translate="">Warning</strong>\n-    <tal:block i18n:translate="checkout_info">\n+  <strong i18n:translate="">Warning</strong>\n+  <tal:block i18n:translate="checkout_info">\n \n         This is a working copy of\n-        <a i18n:name="baseline_title"\n-            tal:attributes="href baseline/@@plone_context_state/view_url;\n-                            title baseline/Description"\n-            tal:content="baseline/Title"/>, made by\n+    <a tal:content="baseline/Title"\n+       tal:attributes="\n+         href baseline/@@plone_context_state/view_url;\n+         title baseline/Description;\n+       "\n+       i18n:name="baseline_title"\n+    ></a>, made by\n \n-        <a i18n:name="creator"\n-            tal:attributes="href view/creator_url"\n-            tal:omit-tag="not: view/creator_url"\n-            tal:content="view/creator_name">john smith</a>\n+    <a tal:content="view/creator_name"\n+       tal:omit-tag="not: view/creator_url"\n+       tal:attributes="\n+         href view/creator_url;\n+       "\n+       i18n:name="creator"\n+    >john smith</a>\n \n         on\n \n-        <span\n-            i18n:name="created"\n-            tal:content="view/created"/>.\n-    </tal:block>\n+    <span tal:content="view/created"\n+          i18n:name="created"\n+    ></span>.\n+  </tal:block>\n \n-    (<a i18n:translate="view_changes"\n-         tal:attributes="href string:${context/absolute_url}/@@iterate_diff">View changes</a>)\n+  (<a tal:attributes="\n+       href string:${context/absolute_url}/@@iterate_diff;\n+     "\n+     i18n:translate="view_changes"\n+  >View changes</a>)\n </div>\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-03T00:02:45+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/b33ce3115f9b238accec100a3c520600815dda6d

feat: flake8

Files changed:
M plone/app/iterate/__init__.py
M plone/app/iterate/interfaces.py
M plone/app/iterate/testing.py

b'diff --git a/plone/app/iterate/__init__.py b/plone/app/iterate/__init__.py\nindex ec9198d..e6d2027 100644\n--- a/plone/app/iterate/__init__.py\n+++ b/plone/app/iterate/__init__.py\n@@ -19,7 +19,7 @@\n # along with iterate; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-from plone.app.iterate import permissions\n+from plone.app.iterate import permissions  # noqa: F401\n from zope.i18nmessageid import MessageFactory\n \n import logging\n@@ -30,7 +30,7 @@\n \n \n try:\n-    import plone.app.relationfield\n+    import plone.app.relationfield  # noqa: F401\n except ImportError:\n     logger.warn(\n         "Dexterity support for iterate is not available. "\ndiff --git a/plone/app/iterate/interfaces.py b/plone/app/iterate/interfaces.py\nindex 22edc85..974cda0 100644\n--- a/plone/app/iterate/interfaces.py\n+++ b/plone/app/iterate/interfaces.py\n@@ -27,8 +27,6 @@\n from zope.interface import Interface\n from zope.interface.interfaces import IObjectEvent\n \n-import pkg_resources\n-\n \n class IReference(Interface):\n     pass\ndiff --git a/plone/app/iterate/testing.py b/plone/app/iterate/testing.py\nindex 7f2a401..85a209c 100644\n--- a/plone/app/iterate/testing.py\n+++ b/plone/app/iterate/testing.py\n@@ -1,8 +1,6 @@\n """Testing setup for integration and functional tests."""\n from plone.app.contenttypes.testing import PloneAppContenttypes\n from plone.app.testing import applyProfile\n-from plone.app.testing import PLONE_FIXTURE\n-from plone.app.testing import PloneSandboxLayer\n from plone.app.testing.layers import FunctionalTesting\n from plone.app.testing.layers import IntegrationTesting\n \n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-03T00:07:01+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/6563c6cb6bb0a564b3f4eee50d7e7da190b34e1b

feat: configure codespell

Files changed:
M pyproject.toml

b'diff --git a/pyproject.toml b/pyproject.toml\nindex 9eb73f3..75d8543 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,3 +60,6 @@ Zope = [\n   \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n ]\n python-dateutil = [\'dateutil\']\n+\n+[tool.codespell]\n+ignore-words-list = "ore"\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-03T00:07:11+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/6bafe95e84c710207bc7fa4a67fe099410149179

feat: codespell

Files changed:
M CHANGES.rst
M docs/developer.txt
M docs/references.txt
M docs/todo.txt
M plone/app/iterate/tests/dexterity.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 77e746b..975a117 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -377,7 +377,7 @@ Fixes:\n   behavior implementation. This is for Plone 5 iterate support.\n   [vangheem]\n \n-- Don\'t remove aquisition on object for getToolByName call.\n+- Don\'t remove acquisition on object for getToolByName call.\n   [tomgross]\n \n \n@@ -424,7 +424,7 @@ Fixes:\n 2.1.11 (2014-01-27)\n -------------------\n \n-- setted lock timeout to MAX_TIMEOUT to avoid baseline unwanted unlock after 10 minutes\n+- set lock timeout to MAX_TIMEOUT to avoid baseline unwanted unlock after 10 minutes\n   [parruc]\n \n \ndiff --git a/docs/developer.txt b/docs/developer.txt\nindex cda0633..c4b52d5 100644\n--- a/docs/developer.txt\n+++ b/docs/developer.txt\n@@ -47,7 +47,7 @@ Terms::\n    a copy of the baseline, placed in a selectable container.\n \n The default policy adapter its meant to be easily subclassed, see policy.py for details,\n-it does however have alot of responsibilities and maintains a series of invariants which\n+it does however have a lot of responsibilities and maintains a series of invariants which\n any replacement must also maintain, described below. if your business logic can be\n encapsulated in an event subscriber it is much better to integrate it via that mechanism.\n \n@@ -63,7 +63,7 @@ infrastructure between different frameworks. this means currently only one check\n a given content object at a time.\n \n A custom reference class ( see relation.py ) is used to track\n-bookeeping information regarding the checkout via the archetypes\n+bookkeeping information regarding the checkout via the archetypes\n reference engine, and to serve as an annotation property bag to\n store (custom) information about the checkout. it is utilized as a\n reference between the working copy to the baseline ( backref wc ).\ndiff --git a/docs/references.txt b/docs/references.txt\nindex 9bcbeb4..85cae3e 100644\n--- a/docs/references.txt\n+++ b/docs/references.txt\n@@ -35,7 +35,7 @@ adapter also keeps reference state.\n Backreferences\n --------------\n \n-Developers utilizing semantically signifigant backreferences that can\n+Developers utilizing semantically significant backreferences that can\n be modified on the working copy are expected to write a custom\n reference adapter ( see ICheckinCheckoutReference in interfaces.py )\n with implementations for checkoutBackReference and\ndiff --git a/docs/todo.txt b/docs/todo.txt\nindex 127020f..72aba0f 100644\n--- a/docs/todo.txt\n+++ b/docs/todo.txt\n@@ -5,7 +5,7 @@ Todo\n Short Term\n ----------\n \n- - always increment version on checkout (iff doc is not upto date )\n+ - always increment version on checkout (if doc is not up to date )\n    - better offer form option.\n \n  - default event adapter for setting workflow on checked out content\ndiff --git a/plone/app/iterate/tests/dexterity.rst b/plone/app/iterate/tests/dexterity.rst\nindex 2ef8281..67ff0bd 100644\n--- a/plone/app/iterate/tests/dexterity.rst\n+++ b/plone/app/iterate/tests/dexterity.rst\n@@ -13,11 +13,11 @@ If we access the site as an admin TTW::\n     >>> from plone.app.testing.interfaces import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n     >>> browser.addHeader("Authorization", "Basic %s:%s" % (SITE_OWNER_NAME, SITE_OWNER_PASSWORD))\n \n-KeyError with aquisition wrapper\n+KeyError with acquisition wrapper\n =========================================\n \n When an item provides IBaseline (has been checked in at least once) and it is accessed through an\n-Aquisition wrapper you get a KeyError from zope.intid, originating from five.intid.\n+Acquisition wrapper you get a KeyError from zope.intid, originating from five.intid.\n \n     >>> browser.open(portal_url + "/folder_factories")\n     >>> browser.getControl("Folder").click()\n@@ -53,7 +53,7 @@ Checkin\n     >>> browser.url\n     \'http://nohost/plone/my-folder/my-sub-object\'\n \n-Test can view through Aquisition wrapper (repeating test_folder is deliberate here)\n+Test can view through Acquisition wrapper (repeating test_folder is deliberate here)\n \n     >>> browser.open("http://nohost/plone/my-folder/my-sub-object")\n     >>> browser.contents\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-04T00:35:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/28581dfac1dfa9a52bfc3fb19ac6a74d6822c864

feat: drop CMFPlone dependency

Files changed:
M plone/app/iterate/browser/info.py
M plone/app/iterate/setuphandlers.py

b'diff --git a/plone/app/iterate/browser/info.py b/plone/app/iterate/browser/info.py\nindex 28e88cd..c18fcb1 100644\n--- a/plone/app/iterate/browser/info.py\n+++ b/plone/app/iterate/browser/info.py\n@@ -7,12 +7,16 @@\n from plone.memoize.instance import memoize\n from Products.CMFCore.permissions import ModifyPortalContent\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.log import logger\n from Products.Five.browser import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.interface import implementer\n from zope.viewlet.interfaces import IViewlet\n \n+import logging\n+\n+\n+logger = logging.getLogger("Plone")\n+\n \n @implementer(IViewlet)\n class BaseInfoViewlet(BrowserView):\ndiff --git a/plone/app/iterate/setuphandlers.py b/plone/app/iterate/setuphandlers.py\nindex d807d65..f69a2fa 100644\n--- a/plone/app/iterate/setuphandlers.py\n+++ b/plone/app/iterate/setuphandlers.py\n@@ -1,4 +1,4 @@\n-from Products.CMFPlone.interfaces import INonInstallable\n+from plone.base.interfaces.installable import INonInstallable\n from zope.interface import implementer\n \n import warnings\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-04T00:35:41+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/7e24b05e49b6290da1ef9abd3556179a60ed0dd3

feat: configure z3c.dependencychecker

Files changed:
M pyproject.toml

b'diff --git a/pyproject.toml b/pyproject.toml\nindex 75d8543..da71ea6 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,6 +60,7 @@ Zope = [\n   \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n ]\n python-dateutil = [\'dateutil\']\n+ignore-packages = [\'plone.app.relationfield\']\n \n [tool.codespell]\n ignore-words-list = "ore"\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-04T00:35:41+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/a88a4704c5a8cfe88a1b9bd78061ea85685716bc

feat: declare dependencies

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex 6eb5ef0..94d7c69 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -40,7 +40,6 @@\n         "DateTime",\n         "plone.locking",\n         "plone.memoize",\n-        "Products.CMFCore",\n         "Products.CMFEditions",\n         "Products.CMFPlacefulWorkflow",\n         "Products.DCWorkflow",\n@@ -55,12 +54,19 @@\n         "zope.lifecycleevent",\n         "zope.schema",\n         "zope.viewlet",\n+        "persistent",\n+        "plone.base",\n+        "plone.dexterity",\n+        "plone.registry",\n+        "z3c.relationfield",\n+        "zc.relation",\n+        "zope.intid",\n     ],\n     extras_require={\n         "test": [\n             "plone.app.testing",\n-            "plone.app.contenttypes",\n-            "plone.app.robotframework",\n+            "plone.app.contenttypes[test]",\n+            "plone.testing",\n         ],\n     },\n     entry_points="""\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-04T00:40:40+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/d8b2308fc7179ca59a64595f5d6c263e740d9e2d

feat: dexterity support should be always on

Files changed:
M plone/app/iterate/__init__.py
M plone/app/iterate/configure.zcml
M pyproject.toml

b'diff --git a/plone/app/iterate/__init__.py b/plone/app/iterate/__init__.py\nindex e6d2027..0ac0aed 100644\n--- a/plone/app/iterate/__init__.py\n+++ b/plone/app/iterate/__init__.py\n@@ -27,12 +27,3 @@\n \n PloneMessageFactory = MessageFactory("plone")\n logger = logging.getLogger("plone.app.iterate")\n-\n-\n-try:\n-    import plone.app.relationfield  # noqa: F401\n-except ImportError:\n-    logger.warn(\n-        "Dexterity support for iterate is not available. "\n-        "You must install plone.app.relationfield"\n-    )\ndiff --git a/plone/app/iterate/configure.zcml b/plone/app/iterate/configure.zcml\nindex 44239f3..8e4ebe0 100644\n--- a/plone/app/iterate/configure.zcml\n+++ b/plone/app/iterate/configure.zcml\n@@ -37,6 +37,7 @@\n \n   <include package=".subscribers" />\n   <include package=".browser" />\n+  <include package=".dexterity" />\n \n   <genericsetup:registerProfile\n       name="default"\n@@ -136,9 +137,5 @@\n       title="iterate : Check out content"\n       />\n \n-  <include\n-      package=".dexterity"\n-      zcml:condition="installed plone.app.relationfield"\n-      />\n \n </configure>\ndiff --git a/pyproject.toml b/pyproject.toml\nindex da71ea6..75d8543 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,7 +60,6 @@ Zope = [\n   \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n ]\n python-dateutil = [\'dateutil\']\n-ignore-packages = [\'plone.app.relationfield\']\n \n [tool.codespell]\n ignore-words-list = "ore"\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-04T09:58:03+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.iterate/commit/7daa4be583f1029a2062172b49ecfe3eb57f3592

Use one more interface from plone.base instead of CMFPlone.

Files changed:
M plone/app/iterate/configure.zcml

b'diff --git a/plone/app/iterate/configure.zcml b/plone/app/iterate/configure.zcml\nindex 8e4ebe0..f0388e6 100644\n--- a/plone/app/iterate/configure.zcml\n+++ b/plone/app/iterate/configure.zcml\n@@ -66,7 +66,7 @@\n       title="plone.app.iterate: Test fixture"\n       description="Extension profile to configure a test fixture"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n-      for="Products.CMFPlone.interfaces.ITestCasePloneSiteRoot"\n+      for="plone.base.interfaces.ITestCasePloneSiteRoot"\n       directory="profiles/test"\n       />\n \n@@ -75,7 +75,7 @@\n       title="plone.app.iterate: Test fixture for DX"\n       description="Adds sample content types for testing"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n-      for="Products.CMFPlone.interfaces.ITestCasePloneSiteRoot"\n+      for="plone.base.interfaces.ITestCasePloneSiteRoot"\n       directory="profiles/testingdx"\n       />\n \n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-04T10:02:05+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.iterate/commit/53c12228f80faf123e0347345766803c0410833d

Add clearer comment on plone.app.iterate:plone.app.iterate profile.

Files changed:
M plone/app/iterate/configure.zcml

b'diff --git a/plone/app/iterate/configure.zcml b/plone/app/iterate/configure.zcml\nindex f0388e6..e3bd469 100644\n--- a/plone/app/iterate/configure.zcml\n+++ b/plone/app/iterate/configure.zcml\n@@ -48,9 +48,9 @@\n       />\n \n   <!--\n-    Remove, when CMFPlone no more depends on this profile.\n-    Products.CMFPlone/Products/CMFPlone/MigrationTool.py:99:\n-    Addon(profile_id=u\'plone.app.iterate:plone.app.iterate\')\n+    The plone.app.iterate:plone.app.iterate profile is deprecated.\n+    Remove either in Plone 6.1 or 7.0, I am on the fence here.\n+    See https://github.com/plone/plone.app.iterate/issues/99#issuecomment-1484686642\n   -->\n   <genericsetup:registerProfile\n       name="plone.app.iterate"\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-04-04T22:51:19+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/876adb34a561da6f73b0cc6ee1d3c3b65ea0a624

Merge pull request #106 from plone/config-with-default-template-d8edd090

Config with default template

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/5623f8b3.internal
A tox.ini
M CHANGES.rst
M docs/developer.txt
M docs/references.txt
M docs/todo.txt
M plone/__init__.py
M plone/app/__init__.py
M plone/app/iterate/__init__.py
M plone/app/iterate/archiver.py
M plone/app/iterate/base.py
M plone/app/iterate/browser/__init__.py
M plone/app/iterate/browser/cancel.pt
M plone/app/iterate/browser/cancel.py
M plone/app/iterate/browser/checkin.pt
M plone/app/iterate/browser/checkin.py
M plone/app/iterate/browser/checkout.pt
M plone/app/iterate/browser/checkout.py
M plone/app/iterate/browser/configure.zcml
M plone/app/iterate/browser/control.py
M plone/app/iterate/browser/diff.pt
M plone/app/iterate/browser/diff.py
M plone/app/iterate/browser/info.py
M plone/app/iterate/browser/info_baseline.pt
M plone/app/iterate/browser/info_checkout.pt
M plone/app/iterate/configure.zcml
M plone/app/iterate/containers.py
M plone/app/iterate/dexterity/__init__.py
M plone/app/iterate/dexterity/configure.zcml
M plone/app/iterate/dexterity/copier.py
M plone/app/iterate/dexterity/interfaces.py
M plone/app/iterate/dexterity/policy.py
M plone/app/iterate/dexterity/relation.py
M plone/app/iterate/dexterity/utils.py
M plone/app/iterate/event.py
M plone/app/iterate/interfaces.py
M plone/app/iterate/lock.py
M plone/app/iterate/permissions.py
M plone/app/iterate/profiles/default/actions.xml
M plone/app/iterate/profiles/default/metadata.xml
M plone/app/iterate/profiles/default/registry.xml
M plone/app/iterate/profiles/test/metadata.xml
M plone/app/iterate/profiles/test/portal_placeful_workflow.xml
M plone/app/iterate/profiles/test/portal_placeful_workflow/working-copy.xml
M plone/app/iterate/profiles/test/workflows.xml
M plone/app/iterate/profiles/test/workflows/workingcopy_workflow/definition.xml
M plone/app/iterate/profiles/testingdx/repositorytool.xml
M plone/app/iterate/profiles/testingdx/types.xml
M plone/app/iterate/profiles/testingdx/types/FolderishDocument.xml
M plone/app/iterate/profiles/to1000/actions.xml
M plone/app/iterate/profiles/uninstall/actions.xml
M plone/app/iterate/profiles/uninstall/metadata.xml
M plone/app/iterate/profiles/uninstall/registry.xml
M plone/app/iterate/setuphandlers.py
M plone/app/iterate/subscribers/__init__.py
M plone/app/iterate/subscribers/configure.zcml
M plone/app/iterate/subscribers/locking.py
M plone/app/iterate/subscribers/marker.py
M plone/app/iterate/subscribers/metadata.py
M plone/app/iterate/subscribers/versioning.py
M plone/app/iterate/subscribers/workflow.py
M plone/app/iterate/testing.py
M plone/app/iterate/tests/__init__.py
M plone/app/iterate/tests/dexterity.rst
M plone/app/iterate/tests/dxtypes.py
M plone/app/iterate/tests/test_annotations.py
M plone/app/iterate/tests/test_containers.py
M plone/app/iterate/tests/test_interfaces.py
M plone/app/iterate/tests/test_iterate.py
M plone/app/iterate/util.py
M pyproject.toml
M setup.cfg
M setup.py

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 0000000..b4158b8\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 0000000..4f67994\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "5623f8b3"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 0000000..449e951\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/CHANGES.rst b/CHANGES.rst\nindex 77e746b..975a117 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -377,7 +377,7 @@ Fixes:\n   behavior implementation. This is for Plone 5 iterate support.\n   [vangheem]\n \n-- Don\'t remove aquisition on object for getToolByName call.\n+- Don\'t remove acquisition on object for getToolByName call.\n   [tomgross]\n \n \n@@ -424,7 +424,7 @@ Fixes:\n 2.1.11 (2014-01-27)\n -------------------\n \n-- setted lock timeout to MAX_TIMEOUT to avoid baseline unwanted unlock after 10 minutes\n+- set lock timeout to MAX_TIMEOUT to avoid baseline unwanted unlock after 10 minutes\n   [parruc]\n \n \ndiff --git a/docs/developer.txt b/docs/developer.txt\nindex cda0633..c4b52d5 100644\n--- a/docs/developer.txt\n+++ b/docs/developer.txt\n@@ -47,7 +47,7 @@ Terms::\n    a copy of the baseline, placed in a selectable container.\n \n The default policy adapter its meant to be easily subclassed, see policy.py for details,\n-it does however have alot of responsibilities and maintains a series of invariants which\n+it does however have a lot of responsibilities and maintains a series of invariants which\n any replacement must also maintain, described below. if your business logic can be\n encapsulated in an event subscriber it is much better to integrate it via that mechanism.\n \n@@ -63,7 +63,7 @@ infrastructure between different frameworks. this means currently only one check\n a given content object at a time.\n \n A custom reference class ( see relation.py ) is used to track\n-bookeeping information regarding the checkout via the archetypes\n+bookkeeping information regarding the checkout via the archetypes\n reference engine, and to serve as an annotation property bag to\n store (custom) information about the checkout. it is utilized as a\n reference between the working copy to the baseline ( backref wc ).\ndiff --git a/docs/references.txt b/docs/references.txt\nindex 9bcbeb4..85cae3e 100644\n--- a/docs/references.txt\n+++ b/docs/references.txt\n@@ -35,7 +35,7 @@ adapter also keeps reference state.\n Backreferences\n --------------\n \n-Developers utilizing semantically signifigant backreferences that can\n+Developers utilizing semantically significant backreferences that can\n be modified on the working copy are expected to write a custom\n reference adapter ( see ICheckinCheckoutReference in interfaces.py )\n with implementations for checkoutBackReference and\ndiff --git a/docs/todo.txt b/docs/todo.txt\nindex 127020f..72aba0f 100644\n--- a/docs/todo.txt\n+++ b/docs/todo.txt\n@@ -5,7 +5,7 @@ Todo\n Short Term\n ----------\n \n- - always increment version on checkout (iff doc is not upto date )\n+ - always increment version on checkout (if doc is not up to date )\n    - better offer form option.\n \n  - default event adapter for setting workflow on checked out content\ndiff --git a/news/5623f8b3.internal b/news/5623f8b3.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/5623f8b3.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/plone/__init__.py b/plone/__init__.py\nindex ca12a73..5284146 100644\n--- a/plone/__init__.py\n+++ b/plone/__init__.py\n@@ -1,8 +1 @@\n-# -*- coding: utf-8 -*-\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/__init__.py b/plone/app/__init__.py\nindex ca12a73..5284146 100644\n--- a/plone/app/__init__.py\n+++ b/plone/app/__init__.py\n@@ -1,8 +1 @@\n-# -*- coding: utf-8 -*-\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/iterate/__init__.py b/plone/app/iterate/__init__.py\nindex 100d0af..0ac0aed 100644\n--- a/plone/app/iterate/__init__.py\n+++ b/plone/app/iterate/__init__.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -20,10 +19,7 @@\n # along with iterate; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-"""\n-\n-from plone.app.iterate import permissions  # noqa\n+from plone.app.iterate import permissions  # noqa: F401\n from zope.i18nmessageid import MessageFactory\n \n import logging\n@@ -31,12 +27,3 @@\n \n PloneMessageFactory = MessageFactory("plone")\n logger = logging.getLogger("plone.app.iterate")\n-\n-\n-try:\n-    import plone.app.relationfield  # noqa\n-except ImportError:\n-    logger.warn(\n-        "Dexterity support for iterate is not available. "\n-        "You must install plone.app.relationfield"\n-    )\ndiff --git a/plone/app/iterate/archiver.py b/plone/app/iterate/archiver.py\nindex 6293477..5b03b82 100644\n--- a/plone/app/iterate/archiver.py\n+++ b/plone/app/iterate/archiver.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\n@@ -20,16 +19,15 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n+from . import interfaces\n from Products.CMFCore.utils import getToolByName\n from zope.component import adapter\n from zope.interface import implementer\n \n-from . import interfaces\n-\n \n @implementer(interfaces.IObjectArchiver)\n @adapter(interfaces.IIterateAware)\n-class ContentArchiver(object):\n+class ContentArchiver:\n     def __init__(self, context):\n         self.context = context\n         self.repository = getToolByName(context, "portal_repository")\ndiff --git a/plone/app/iterate/base.py b/plone/app/iterate/base.py\nindex 3b6339b..001263e 100644\n--- a/plone/app/iterate/base.py\n+++ b/plone/app/iterate/base.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\n@@ -45,7 +44,7 @@\n \n \n @implementer(ICheckinCheckoutPolicy)\n-class CheckinCheckoutBasePolicyAdapter(object):\n+class CheckinCheckoutBasePolicyAdapter:\n     """Base Checkin Checkout Policy For Content\n \n     - on checkout context is the baseline\n@@ -111,7 +110,7 @@ def getProperties(self, obj, default=None):\n \n @implementer(interfaces.IObjectCopier)\n @component.adapter(interfaces.IIterateAware)\n-class BaseContentCopier(object):\n+class BaseContentCopier:\n     def __init__(self, context):\n         self.context = context\n \ndiff --git a/plone/app/iterate/browser/__init__.py b/plone/app/iterate/browser/__init__.py\nindex ec51c5a..792d600 100644\n--- a/plone/app/iterate/browser/__init__.py\n+++ b/plone/app/iterate/browser/__init__.py\n@@ -1,2 +1 @@\n-# -*- coding: utf-8 -*-\n #\ndiff --git a/plone/app/iterate/browser/cancel.pt b/plone/app/iterate/browser/cancel.pt\nindex a1af209..3b25333 100644\n--- a/plone/app/iterate/browser/cancel.pt\n+++ b/plone/app/iterate/browser/cancel.pt\n@@ -1,54 +1,61 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content fill-slot="content">\n-<metal:content define-macro="content">\n-<article id="content">\n-    <form action="#"\n-        method="post"\n-        tal:attributes="action string:${context/absolute_url}/@@content-cancel-checkout">\n-\n-      <h1 class="documentFirstHeading"\n-          i18n:translate="title_cancel">\n-        Cancel check-out of <span i18n:name="object_title" tal:content="context/Title" />.\n-      </h1>\n-\n-      <p i18n:translate="description_cancel">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content fill-slot="content">\n+      <metal:content define-macro="content">\n+        <article id="content">\n+          <form action="#"\n+                method="post"\n+                tal:attributes="\n+                  action string:${context/absolute_url}/@@content-cancel-checkout;\n+                "\n+          >\n+\n+            <h1 class="documentFirstHeading"\n+                i18n:translate="title_cancel"\n+            >\n+        Cancel check-out of\n+              <span tal:content="context/Title"\n+                    i18n:name="object_title"\n+              ></span>.\n+            </h1>\n+\n+            <p i18n:translate="description_cancel">\n         Canceling the check-out will delete this working copy, and any modifications\n         made to it will be lost. The existing version of the content will become\n         unlocked.\n-      </p>\n-\n-      <div class="formControls">\n-\n-        <input\n-            class="destructive"\n-            type="submit"\n-            name="form.button.Cancel"\n-            value="Cancel checkout"\n-            i18n:attributes="value"\n-            />\n-\n-        <input\n-            class="standalone"\n-            type="submit"\n-            name="form.button.Keep"\n-            value="Keep checkout"\n-            i18n:attributes="value"\n-            />\n-\n-      </div>\n-\n-    </form>\n-</article>\n-</metal:content>\n-</metal:content>\n-\n-</body>\n-</html>\n\\ No newline at end of file\n+            </p>\n+\n+            <div class="formControls">\n+\n+              <input class="destructive"\n+                     name="form.button.Cancel"\n+                     type="submit"\n+                     value="Cancel checkout"\n+                     i18n:attributes="value"\n+              />\n+\n+              <input class="standalone"\n+                     name="form.button.Keep"\n+                     type="submit"\n+                     value="Keep checkout"\n+                     i18n:attributes="value"\n+              />\n+\n+            </div>\n+\n+          </form>\n+        </article>\n+      </metal:content>\n+    </metal:content>\n+\n+  </body>\n+</html>\ndiff --git a/plone/app/iterate/browser/cancel.py b/plone/app/iterate/browser/cancel.py\nindex eb75d77..129c5a4 100644\n--- a/plone/app/iterate/browser/cancel.py\n+++ b/plone/app/iterate/browser/cancel.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -32,23 +31,22 @@\n \n \n class Cancel(BrowserView):\n-\n     index = ViewPageTemplateFile("cancel.pt")\n \n     def __call__(self):\n         context = aq_inner(self.context)\n \n         if "form.button.Cancel" in self.request.form:\n-            control = getMultiAdapter((context, self.request), name=u"iterate_control")\n+            control = getMultiAdapter((context, self.request), name="iterate_control")\n             if not control.cancel_allowed():\n-                raise CheckoutException(u"Not a checkout")\n+                raise CheckoutException("Not a checkout")\n \n             policy = ICheckinCheckoutPolicy(context)\n             baseline = policy.cancelCheckout()\n             baseline.reindexObject()\n \n             IStatusMessage(self.request).addStatusMessage(\n-                _(u"Checkout cancelled"), type="info"\n+                _("Checkout cancelled"), type="info"\n             )\n             view_url = baseline.restrictedTraverse("@@plone_context_state").view_url()\n             self.request.response.redirect(view_url)\ndiff --git a/plone/app/iterate/browser/checkin.pt b/plone/app/iterate/browser/checkin.pt\nindex ebfa2ed..3feaffb 100644\n--- a/plone/app/iterate/browser/checkin.pt\n+++ b/plone/app/iterate/browser/checkin.pt\n@@ -1,72 +1,83 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content fill-slot="content">\n-<metal:content define-macro="content">\n-<article id="content">\n+    <metal:content fill-slot="content">\n+      <metal:content define-macro="content">\n+        <article id="content">\n \n-    <form action="#"\n-        method="post"\n-        tal:attributes="action string:${context/absolute_url}/@@content-checkin">\n+          <form action="#"\n+                method="post"\n+                tal:attributes="\n+                  action string:${context/absolute_url}/@@content-checkin;\n+                "\n+          >\n \n-    <h1 class="documentFirstHeading"\n-        i18n:translate="title_checkin">\n-        Check in <span i18n:name="object_title" tal:content="here/Title" />\n-    </h1>\n+            <h1 class="documentFirstHeading"\n+                i18n:translate="title_checkin"\n+            >\n+        Check in\n+              <span tal:content="here/Title"\n+                    i18n:name="object_title"\n+              ></span>\n+            </h1>\n \n-    <p i18n:translate="description_checkin">\n+            <p i18n:translate="description_checkin">\n         Checking in this working copy will replace the existing item\n         with the working copy.\n-    </p>\n+            </p>\n \n-    <fieldset>\n+            <fieldset>\n \n-            <div class="field">\n-              <label for="description"\n-                    i18n:translate="label_checkin_message">Check-in Message\n-               </label>\n+              <div class="field">\n+                <label for="description"\n+                       i18n:translate="label_checkin_message"\n+                >Check-in Message\n+                </label>\n \n-              <div class="formHelp" i18n:translate="help_checkin_message">\n+                <div class="formHelp"\n+                     i18n:translate="help_checkin_message"\n+                >\n                   Enter a message to be saved alongside the check-in. This\n                   should explain what was changed, for audit purposes.\n-              </div>\n+                </div>\n \n-              <textarea cols="60"\n-                        rows="3"\n-                        id="checkin_message"\n-                        name="checkin_message"></textarea>\n-            </div>\n+                <textarea id="checkin_message"\n+                          cols="60"\n+                          name="checkin_message"\n+                          rows="3"\n+                ></textarea>\n+              </div>\n \n-            <div class="formControls">\n-                <input\n-                    class="context"\n-                    type="submit"\n-                    name="form.button.Checkin"\n-                    value="Check in"\n-                    i18n:attributes="value"\n-                    />\n+              <div class="formControls">\n+                <input class="context"\n+                       name="form.button.Checkin"\n+                       type="submit"\n+                       value="Check in"\n+                       i18n:attributes="value"\n+                />\n \n-                <input\n-                    class="standalone"\n-                    type="submit"\n-                    name="form.button.Cancel"\n-                    value="Cancel"\n-                    i18n:attributes="value label_cancel"\n-                    />\n-            </div>\n+                <input class="standalone"\n+                       name="form.button.Cancel"\n+                       type="submit"\n+                       value="Cancel"\n+                       i18n:attributes="value label_cancel"\n+                />\n+              </div>\n \n-    </fieldset>\n+            </fieldset>\n \n-    </form>\n-</article>\n-</metal:content>\n-</metal:content>\n+          </form>\n+        </article>\n+      </metal:content>\n+    </metal:content>\n \n-</body>\n-</html>\n\\ No newline at end of file\n+  </body>\n+</html>\ndiff --git a/plone/app/iterate/browser/checkin.py b/plone/app/iterate/browser/checkin.py\nindex 3717ad0..fe422e5 100644\n--- a/plone/app/iterate/browser/checkin.py\n+++ b/plone/app/iterate/browser/checkin.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -32,16 +31,15 @@\n \n \n class Checkin(BrowserView):\n-\n     index = ViewPageTemplateFile("checkin.pt")\n \n     def __call__(self):\n         context = aq_inner(self.context)\n \n         if "form.button.Checkin" in self.request.form:\n-            control = getMultiAdapter((context, self.request), name=u"iterate_control")\n+            control = getMultiAdapter((context, self.request), name="iterate_control")\n             if not control.checkin_allowed():\n-                raise CheckinException(u"Not a checkout")\n+                raise CheckinException("Not a checkout")\n \n             message = self.request.form.get("checkin_message", "")\n \ndiff --git a/plone/app/iterate/browser/checkout.pt b/plone/app/iterate/browser/checkout.pt\nindex 2092a55..45b308b 100644\n--- a/plone/app/iterate/browser/checkout.pt\n+++ b/plone/app/iterate/browser/checkout.pt\n@@ -1,95 +1,114 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<div id="content" metal:fill-slot="body"\n-     tal:define="containers python:list(view.containers())">\n-\n-    <form action="#"\n-        method="post"\n-        name="checkout"\n-        tal:attributes="action string:${context/absolute_url}/@@content-checkout">\n-\n-    <h1 i18n:translate="title_checkout">\n-        Check out <span i18n:name="object_title" tal:content="here/Title" />\n-    </h1>\n-\n-    <p i18n:translate="description_checkout">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <div id="content"\n+         metal:fill-slot="body"\n+         tal:define="\n+           containers python:list(view.containers());\n+         "\n+    >\n+\n+      <form action="#"\n+            method="post"\n+            name="checkout"\n+            tal:attributes="\n+              action string:${context/absolute_url}/@@content-checkout;\n+            "\n+      >\n+\n+        <h1 i18n:translate="title_checkout">\n+        Check out\n+          <span tal:content="here/Title"\n+                i18n:name="object_title"\n+          ></span>\n+        </h1>\n+\n+        <p i18n:translate="description_checkout">\n         On check-out, a working copy of the content item will be created in the selected\n         container, and the original will be locked to prevent other users from\n         editing it.\n-    </p>\n-\n-    <tal:one_container tal:condition="python:len(containers)==1">\n-    <input\n-        type="hidden"\n-        name="checkout_location"\n-        tal:define = "item python:containers[0]"\n-        tal:attributes="id string:checkout_location_${item/name};\n-                        value item/name"\n-        />\n-    </tal:one_container>\n-\n-    <fieldset tal:condition="python:len(containers)!=1">\n-\n-        <legend i18n:translate="legend_details">Details</legend>\n-\n-            <div class="field">\n-\n-            <label for="checkout_folder" i18n:translate="label_checkout_folder">\n+        </p>\n+\n+        <tal:one_container tal:condition="python:len(containers)==1">\n+          <input name="checkout_location"\n+                 type="hidden"\n+                 tal:define="\n+                   item python:containers[0];\n+                 "\n+                 tal:attributes="\n+                   id string:checkout_location_${item/name};\n+                   value item/name;\n+                 "\n+          />\n+        </tal:one_container>\n+\n+        <fieldset tal:condition="python:len(containers)!=1">\n+\n+          <legend i18n:translate="legend_details">Details</legend>\n+\n+          <div class="field">\n+\n+            <label for="checkout_folder"\n+                   i18n:translate="label_checkout_folder"\n+            >\n                 Checkout Folder\n             </label>\n-            <div class="formHelp" i18n:translate="help_checkout_folder">\n+            <div class="formHelp"\n+                 i18n:translate="help_checkout_folder"\n+            >\n                 Select the folder to checkout to.\n             </div>\n \n             <div tal:repeat="item view/containers">\n \n-                <input\n-                    type="radio"\n-                    name="checkout_location"\n-                    tal:attributes="id string:checkout_location_${item/name};\n-                                    value item/name"\n-                    />\n-\n-                <label\n-                    tal:attributes="for string:checkout_location_${item/name}"\n-                    tal:content="item/locator/title"\n-                    />\n+              <input name="checkout_location"\n+                     type="radio"\n+                     tal:attributes="\n+                       id string:checkout_location_${item/name};\n+                       value item/name;\n+                     "\n+              />\n \n-           </div>\n+              <label tal:content="item/locator/title"\n+                     tal:attributes="\n+                       for string:checkout_location_${item/name};\n+                     "\n+              ></label>\n \n             </div>\n \n+          </div>\n+\n         </fieldset>\n \n         <div class="formControls">\n \n-            <input\n-                class="context"\n-                type="submit"\n-                name="form.button.Checkout"\n-                value="Check out"\n-                i18n:attributes="value"\n-                />\n-\n-            <input\n-                class="standalone"\n-                type="submit"\n-                name="form.button.Cancel"\n-                value="Cancel"\n-                i18n:attributes="value label_cancel"\n-                />\n+          <input class="context"\n+                 name="form.button.Checkout"\n+                 type="submit"\n+                 value="Check out"\n+                 i18n:attributes="value"\n+          />\n+\n+          <input class="standalone"\n+                 name="form.button.Cancel"\n+                 type="submit"\n+                 value="Cancel"\n+                 i18n:attributes="value label_cancel"\n+          />\n \n         </div>\n \n-    </form>\n+      </form>\n \n-</div>\n+    </div>\n \n-</html>\n+  </body></html>\ndiff --git a/plone/app/iterate/browser/checkout.py b/plone/app/iterate/browser/checkout.py\nindex 73f10f8..4554cc4 100644\n--- a/plone/app/iterate/browser/checkout.py\n+++ b/plone/app/iterate/browser/checkout.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -34,7 +33,6 @@\n \n \n class Checkout(BrowserView):\n-\n     index = ViewPageTemplateFile("checkout.pt")\n \n     def containers(self):\n@@ -50,9 +48,9 @@ def __call__(self):\n         # We want to redirect to a specific template, else we might\n         # end up downloading a file\n         if "form.button.Checkout" in self.request.form:\n-            control = getMultiAdapter((context, self.request), name=u"iterate_control")\n+            control = getMultiAdapter((context, self.request), name="iterate_control")\n             if not control.checkout_allowed():\n-                raise CheckoutException(u"Not allowed")\n+                raise CheckoutException("Not allowed")\n \n             location = self.request.form.get("checkout_location", None)\n             locator = None\ndiff --git a/plone/app/iterate/browser/configure.zcml b/plone/app/iterate/browser/configure.zcml\nindex 3215c38..81e18d6 100644\n--- a/plone/app/iterate/browser/configure.zcml\n+++ b/plone/app/iterate/browser/configure.zcml\n@@ -1,86 +1,87 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <!-- Control view (public) -->\n+  <!-- Control view (public) -->\n \n-    <browser:page\n-        for="*"\n-        name="iterate_control"\n-        class=".control.Control"\n-        permission="zope2.View"\n-        allowed_attributes="checkin_allowed checkout_allowed cancel_allowed"\n-        />\n+  <browser:page\n+      name="iterate_control"\n+      for="*"\n+      class=".control.Control"\n+      allowed_attributes="checkin_allowed checkout_allowed cancel_allowed"\n+      permission="zope2.View"\n+      />\n \n-    <!-- Forms -->\n+  <!-- Forms -->\n \n-    <browser:page\n-        for="..interfaces.IIterateAware"\n-        name="content-checkout"\n-        class=".checkout.Checkout"\n-        template="checkout.pt"\n-        permission="zope2.View"\n-        />\n+  <browser:page\n+      name="content-checkout"\n+      for="..interfaces.IIterateAware"\n+      class=".checkout.Checkout"\n+      template="checkout.pt"\n+      permission="zope2.View"\n+      />\n \n-    <browser:page\n-        for="..interfaces.IIterateAware"\n-        name="content-checkin"\n-        class=".checkin.Checkin"\n-        template="checkin.pt"\n-        permission="cmf.ModifyPortalContent"\n-        />\n+  <browser:page\n+      name="content-checkin"\n+      for="..interfaces.IIterateAware"\n+      class=".checkin.Checkin"\n+      template="checkin.pt"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n-    <browser:page\n-        for="..interfaces.IIterateAware"\n-        name="content-cancel-checkout"\n-        class=".cancel.Cancel"\n-        template="cancel.pt"\n-        permission="cmf.ModifyPortalContent"\n-        />\n+  <browser:page\n+      name="content-cancel-checkout"\n+      for="..interfaces.IIterateAware"\n+      class=".cancel.Cancel"\n+      template="cancel.pt"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n-    <!-- Information -->\n+  <!-- Information -->\n \n-    <browser:page\n-       for="..interfaces.IIterateManagedContent"\n-       class=".diff.DiffView"\n-       name="iterate_diff"\n-       template="diff.pt"\n-       permission="zope2.View"\n-       />\n+  <browser:page\n+      name="iterate_diff"\n+      for="..interfaces.IIterateManagedContent"\n+      class=".diff.DiffView"\n+      template="diff.pt"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.app.iterate.baseline_info"\n-        manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n-        class=".info.BaselineInfoViewlet"\n-        permission="zope2.View"\n-        for="..interfaces.IBaseline"\n-        view="plone.app.layout.globals.interfaces.IViewView"\n-        />\n+  <browser:viewlet\n+      name="plone.app.iterate.baseline_info"\n+      for="..interfaces.IBaseline"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n+      class=".info.BaselineInfoViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.app.iterate.checkout_info"\n-        manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n-        class=".info.CheckoutInfoViewlet"\n-        permission="zope2.View"\n-        for="..interfaces.IWorkingCopy"\n-        view="plone.app.layout.globals.interfaces.IViewView"\n-        />\n+  <browser:viewlet\n+      name="plone.app.iterate.checkout_info"\n+      for="..interfaces.IWorkingCopy"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n+      class=".info.CheckoutInfoViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <!-- Resources -->\n-    <!-- These resources are deprecated.  Remove them in Plone 7. -->\n-    <browser:resource\n-        name="checkin.png"\n-        image="checkin.png"\n-        />\n+  <!-- Resources -->\n+  <!-- These resources are deprecated.  Remove them in Plone 7. -->\n+  <browser:resource\n+      name="checkin.png"\n+      image="checkin.png"\n+      />\n \n-    <browser:resource\n-        name="checkout.png"\n-        image="checkout.png"\n-        />\n+  <browser:resource\n+      name="checkout.png"\n+      image="checkout.png"\n+      />\n \n-    <browser:resource\n-        name="cancel-checkout.png"\n-        image="cancel.png"\n-        />\n+  <browser:resource\n+      name="cancel-checkout.png"\n+      image="cancel.png"\n+      />\n \n </configure>\ndiff --git a/plone/app/iterate/browser/control.py b/plone/app/iterate/browser/control.py\nindex 46651e2..8dc11de 100644\n--- a/plone/app/iterate/browser/control.py\n+++ b/plone/app/iterate/browser/control.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\ndiff --git a/plone/app/iterate/browser/diff.pt b/plone/app/iterate/browser/diff.pt\nindex 4e56911..d486072 100644\n--- a/plone/app/iterate/browser/diff.pt\n+++ b/plone/app/iterate/browser/diff.pt\n@@ -1,118 +1,181 @@\n <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"\n "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n \n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      lang="en-US"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en-US"\n+      i18n:domain="plone"\n+>\n \n-<tal:block metal:fill-slot="base">\n+  <tal:block metal:fill-slot="base">\n     <base href=""\n-          tal:define="current_page_url context/@@plone_context_state/current_page_url"\n-          tal:attributes="href current_page_url" />\n-</tal:block>\n-<tal:block metal:fill-slot="head_slot">\n-    <link rel="stylesheet" type="text/css" href="compare.css"\n-          tal:attributes="href string:${portal_url}/compare.css"/>\n-</tal:block>\n+          tal:define="\n+            current_page_url context/@@plone_context_state/current_page_url;\n+          "\n+          tal:attributes="\n+            href current_page_url;\n+          "\n+    />\n+  </tal:block>\n+  <tal:block metal:fill-slot="head_slot">\n+    <link href="compare.css"\n+          rel="stylesheet"\n+          type="text/css"\n+          tal:attributes="\n+            href string:${portal_url}/compare.css;\n+          "\n+    />\n+  </tal:block>\n \n-<body>\n-  <metal:main metal:fill-slot="main"\n-       tal:define="diffs view/diffs;\n-                   diff_url string:${context/absolute_url}/@@iterate_diff">\n+  <body>\n+    <metal:main metal:fill-slot="main"\n+                tal:define="\n+                  diffs view/diffs;\n+                  diff_url string:${context/absolute_url}/@@iterate_diff;\n+                "\n+    >\n \n-    <h1 class="documentFirstHeading" i18n:translate="">\n+      <h1 class="documentFirstHeading"\n+          i18n:translate=""\n+      >\n         Changes to\n-        <span tal:replace="context/title_or_id" i18n:name="title"/>\n-    </h1>\n+        <span tal:replace="context/title_or_id"\n+              i18n:name="title"\n+        ></span>\n+      </h1>\n \n-    <div id="content-core">\n-        <em tal:condition="diffs/same" i18n:translate="">\n+      <div id="content-core">\n+        <em tal:condition="diffs/same"\n+            i18n:translate=""\n+        >\n             No significant changes found.\n         </em>\n \n         <div tal:condition="not:diffs/same">\n-            <div metal:use-macro="context/diff_legend/macros/diff_legend" />\n+          <div metal:use-macro="context/diff_legend/macros/diff_legend"></div>\n \n-            <form id="diffs"\n-                  action="#"\n-                  tal:repeat="d diffs/getDiffs">\n-              <div class="field"\n-                   tal:condition="not:d/same"\n-                   tal:define="field_label d/label;\n-                               unified exists:d/unified_diff;\n-                               html exists:d/html_diff;\n-                               inline exists:d/inline_diff;\n-                               ndiff exists:d/ndiff;\n-                               inline python: inline and not request.get(\'no_inline\', 0);\n-                               html python: html and not request.get(\'show_unified\', 0)">\n-                <label tal:content="field_label" />\n+          <form id="diffs"\n+                action="#"\n+                tal:repeat="d diffs/getDiffs"\n+          >\n+            <div class="field"\n+                 tal:define="\n+                   field_label d/label;\n+                   unified exists:d/unified_diff;\n+                   html exists:d/html_diff;\n+                   inline exists:d/inline_diff;\n+                   ndiff exists:d/ndiff;\n+                   inline python: inline and not request.get(\'no_inline\', 0);\n+                   html python: html and not request.get(\'show_unified\', 0);\n+                 "\n+                 tal:condition="not:d/same"\n+            >\n+              <label tal:content="field_label"></label>\n \n-                <tal:html condition="inline">\n-                    <br />\n-                    <a href="#"\n-                       tal:attributes="href string:${diff_url}?no_inline:int=1" i18n:translate="">Show code differences</a>\n-                    <br />\n-                    <br />\n-                    <div class="inline-diff"\n-                         tal:content="structure d/inline_diff">[inline diff]</div>\n-                </tal:html>\n-                <tal:html condition="python: html and not inline">\n-                    <br />\n-                    <tal:visual-only tal:condition="exists:d/inline_diff">\n-                        <a href="#"\n-                           tal:attributes="href string:${diff_url}" i18n:translate="">Show visual differences</a>\n-                        <br />\n-                    </tal:visual-only>\n-                    <a href="#"\n-                       tal:attributes="href string:${diff_url}?no_inline:int=1&amp;show_unified:int=1" i18n:translate="">Unified diff format</a>\n-                    <pre tal:content="structure d/html_diff">[html diff]</pre>\n-                </tal:html>\n-                <tal:unified condition="python:unified and not html">\n-                    <br />\n-                    <a href="#"\n-                        tal:condition="exists:d/inline_diff"\n-                        tal:attributes="href string:${diff_url}" i18n:translate="">Show visual differences</a>\n-                    <br />\n-                    <a href="#"\n-                       tal:condition="exists:d/html_diff"\n-                       tal:attributes="href string:${diff_url}?no_inline:int=1" i18n:translate="">Show side by side</a>\n-                    <pre tal:content="d/unified_diff">[unified diff]</pre>\n-                </tal:unified>\n-                <tal:ndiff condition="python:ndiff and not (unified or html)">\n-                    <pre tal:content="d/ndiff">[ndiff]</pre>\n-                </tal:ndiff>\n-                <tal:nodiff condition="python:not (unified or html or ndiff)">\n-                    <span class="diff_chg" i18n:translate="">Field Changed</span>\n-                    <br /><br />\n-                </tal:nodiff>\n-              </div>\n-            </form>\n+              <tal:html condition="inline">\n+                <br />\n+                <a href="#"\n+                   tal:attributes="\n+                     href string:${diff_url}?no_inline:int=1;\n+                   "\n+                   i18n:translate=""\n+                >Show code differences</a>\n+                <br />\n+                <br />\n+                <div class="inline-diff"\n+                     tal:content="structure d/inline_diff"\n+                >[inline diff]</div>\n+              </tal:html>\n+              <tal:html condition="python: html and not inline">\n+                <br />\n+                <tal:visual-only tal:condition="exists:d/inline_diff">\n+                  <a href="#"\n+                     tal:attributes="\n+                       href string:${diff_url};\n+                     "\n+                     i18n:translate=""\n+                  >Show visual differences</a>\n+                  <br />\n+                </tal:visual-only>\n+                <a href="#"\n+                   tal:attributes="\n+                     href string:${diff_url}?no_inline:int=1&amp;show_unified:int=1;\n+                   "\n+                   i18n:translate=""\n+                >Unified diff format</a>\n+                <pre tal:content="structure d/html_diff">[html diff]</pre>\n+              </tal:html>\n+              <tal:unified condition="python:unified and not html">\n+                <br />\n+                <a href="#"\n+                   tal:condition="exists:d/inline_diff"\n+                   tal:attributes="\n+                     href string:${diff_url};\n+                   "\n+                   i18n:translate=""\n+                >Show visual differences</a>\n+                <br />\n+                <a href="#"\n+                   tal:condition="exists:d/html_diff"\n+                   tal:attributes="\n+                     href string:${diff_url}?no_inline:int=1;\n+                   "\n+                   i18n:translate=""\n+                >Show side by side</a>\n+                <pre tal:content="d/unified_diff">[unified diff]</pre>\n+              </tal:unified>\n+              <tal:ndiff condition="python:ndiff and not (unified or html)">\n+                <pre tal:content="d/ndiff">[ndiff]</pre>\n+              </tal:ndiff>\n+              <tal:nodiff condition="python:not (unified or html or ndiff)">\n+                <span class="diff_chg"\n+                      i18n:translate=""\n+                >Field Changed</span>\n+                <br /><br />\n+              </tal:nodiff>\n+            </div>\n+          </form>\n         </div>\n \n         <tal:block tal:condition="diffs/recursive">\n-        <h2 i18n:translate="">Changed files</h2>\n-        <i tal:condition="not:diffs/getSubDiffs">None</i>\n-        <ul tal:condition="diffs/getSubDiffs">\n+          <h2 i18n:translate="">Changed files</h2>\n+          <i tal:condition="not:diffs/getSubDiffs">None</i>\n+          <ul tal:condition="diffs/getSubDiffs">\n             <li tal:repeat="cs diffs/getSubDiffs">\n-                <tal:check condition="not:cs/same">\n-                    <a tal:content="cs/id" tal:attributes="href cs/id">[filename]</a>\n-               </tal:check>\n-           </li>\n-        </ul>\n+              <tal:check condition="not:cs/same">\n+                <a tal:content="cs/id"\n+                   tal:attributes="\n+                     href cs/id;\n+                   "\n+                >[filename]</a>\n+              </tal:check>\n+            </li>\n+          </ul>\n \n-        <h2 i18n:translate="">Removed files</h2>\n-        <em tal:condition="not:diffs/getRemovedItems" i18n:translate="">None</em>\n-        <ul tal:condition="diffs/getRemovedItems">\n-        <li tal:repeat="id diffs/getRemovedItems" tal:content="id">[filename]</li>\n-        </ul>\n+          <h2 i18n:translate="">Removed files</h2>\n+          <em tal:condition="not:diffs/getRemovedItems"\n+              i18n:translate=""\n+          >None</em>\n+          <ul tal:condition="diffs/getRemovedItems">\n+            <li tal:repeat="id diffs/getRemovedItems"\n+                tal:content="id"\n+            >[filename]</li>\n+          </ul>\n \n-        <h2 i18n:translate="">Added files</h2>\n-        <em tal:condition="not:diffs/getAddedItems" i18n:translate="">None</em>\n-        <ul tal:condition="diffs/getAddedItems">\n-        <li tal:repeat="id diffs/getAddedItems"><a tal:content="id" tal:attributes="href id">[filename]</a></li>\n-        </ul>\n+          <h2 i18n:translate="">Added files</h2>\n+          <em tal:condition="not:diffs/getAddedItems"\n+              i18n:translate=""\n+          >None</em>\n+          <ul tal:condition="diffs/getAddedItems">\n+            <li tal:repeat="id diffs/getAddedItems"><a tal:content="id"\n+                 tal:attributes="\n+                   href id;\n+                 "\n+              >[filename]</a></li>\n+          </ul>\n         </tal:block>\n-    </div>\n-  </metal:main>\n-</body>\n+      </div>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/iterate/browser/diff.py b/plone/app/iterate/browser/diff.py\nindex baa5de3..60ff36f 100644\n--- a/plone/app/iterate/browser/diff.py\n+++ b/plone/app/iterate/browser/diff.py\n@@ -1,8 +1,3 @@\n-# -*- coding: utf-8 -*-\n-"""\n-$Id: diff.py 1807 2007-02-06 06:52:46Z hazmat $\n-"""\n-\n from plone.app.iterate.interfaces import IBaseline\n from plone.app.iterate.interfaces import ICheckinCheckoutPolicy\n from plone.app.iterate.interfaces import IWorkingCopy\ndiff --git a/plone/app/iterate/browser/info.py b/plone/app/iterate/browser/info.py\nindex 300acf4..c18fcb1 100644\n--- a/plone/app/iterate/browser/info.py\n+++ b/plone/app/iterate/browser/info.py\n@@ -1,8 +1,3 @@\n-# -*- coding: utf-8 -*-\n-"""\n-$Id: base.py 1808 2007-02-06 11:39:11Z hazmat $\n-"""\n-\n from AccessControl import getSecurityManager\n from DateTime import DateTime\n from plone.app.iterate.interfaces import IBaseline\n@@ -12,17 +7,21 @@\n from plone.memoize.instance import memoize\n from Products.CMFCore.permissions import ModifyPortalContent\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.log import logger\n from Products.Five.browser import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.interface import implementer\n from zope.viewlet.interfaces import IViewlet\n \n+import logging\n+\n+\n+logger = logging.getLogger("Plone")\n+\n \n @implementer(IViewlet)\n class BaseInfoViewlet(BrowserView):\n     def __init__(self, context, request, view, manager):\n-        super(BaseInfoViewlet, self).__init__(context, request)\n+        super().__init__(context, request)\n         self.__parent__ = view\n         self.view = view\n         self.manager = manager\n@@ -61,7 +60,7 @@ def creator_url(self):\n         creator = self.creator()\n         if creator is not None:\n             portal_url = getToolByName(self.context, "portal_url")\n-            return "{0}/author/{1}".format(portal_url(), creator.getId())\n+            return f"{portal_url()}/author/{creator.getId()}"\n \n     @memoize\n     def creator_name(self):\n@@ -99,7 +98,6 @@ def _getReference(self):\n \n \n class BaselineInfoViewlet(BaseInfoViewlet):\n-\n     index = ViewPageTemplateFile("info_baseline.pt")\n \n     def render(self):\n@@ -123,7 +121,6 @@ def _getReference(self):\n \n \n class CheckoutInfoViewlet(BaseInfoViewlet):\n-\n     index = ViewPageTemplateFile("info_checkout.pt")\n \n     def render(self):\ndiff --git a/plone/app/iterate/browser/info_baseline.pt b/plone/app/iterate/browser/info_baseline.pt\nindex 4738777..2728015 100644\n--- a/plone/app/iterate/browser/info_baseline.pt\n+++ b/plone/app/iterate/browser/info_baseline.pt\n@@ -1,26 +1,40 @@\n <div class="portalMessage warning"\n-     tal:define="working_copy view/working_copy;\n-                 isAnon context/@@plone_portal_state/anonymous;"\n+     tal:define="\n+       working_copy view/working_copy;\n+       isAnon context/@@plone_portal_state/anonymous;\n+     "\n+     tal:condition="python: not isAnon"\n      i18n:domain="plone"\n-     tal:condition="python: not isAnon">\n+>\n \n-    <strong i18n:translate="">Warning</strong>\n-    <tal:block i18n:translate="working_copy_info">\n+  <strong i18n:translate="">Warning</strong>\n+  <tal:block i18n:translate="working_copy_info">\n         This item is being edited by\n-        <a i18n:name="creator"\n-           tal:attributes="href view/creator_url"\n-           tal:omit-tag="not: view/creator_url"\n-           tal:content="view/creator_name">john smith</a>\n+    <a tal:content="view/creator_name"\n+       tal:omit-tag="not: view/creator_url"\n+       tal:attributes="\n+         href view/creator_url;\n+       "\n+       i18n:name="creator"\n+    >john smith</a>\n         in\n-        <a i18n:name="working_copy"\n-           i18n:translate="label_working_copy"\n-           tal:attributes="href working_copy/@@plone_context_state/view_url;\n-                           title working_copy/Description">a working copy</a>\n+    <a tal:attributes="\n+         href working_copy/@@plone_context_state/view_url;\n+         title working_copy/Description;\n+       "\n+       i18n:name="working_copy"\n+       i18n:translate="label_working_copy"\n+    >a working copy</a>\n         created on\n-        <span i18n:name="created" tal:content="view/created"/>.\n+    <span tal:content="view/created"\n+          i18n:name="created"\n+    ></span>.\n \n-    </tal:block>\n+  </tal:block>\n \n-    (<a i18n:translate="label_view_changes"\n-         tal:attributes="href string:${context/absolute_url}/@@iterate_diff">View changes</a>)\n+  (<a tal:attributes="\n+       href string:${context/absolute_url}/@@iterate_diff;\n+     "\n+     i18n:translate="label_view_changes"\n+  >View changes</a>)\n </div>\ndiff --git a/plone/app/iterate/browser/info_checkout.pt b/plone/app/iterate/browser/info_checkout.pt\nindex 1eccd5e..9226b01 100644\n--- a/plone/app/iterate/browser/info_checkout.pt\n+++ b/plone/app/iterate/browser/info_checkout.pt\n@@ -1,28 +1,40 @@\n <div class="portalMessage info"\n-     tal:define="baseline view/baseline;"\n-     i18n:domain="plone">\n+     tal:define="\n+       baseline view/baseline;\n+     "\n+     i18n:domain="plone"\n+>\n \n-    <strong i18n:translate="">Warning</strong>\n-    <tal:block i18n:translate="checkout_info">\n+  <strong i18n:translate="">Warning</strong>\n+  <tal:block i18n:translate="checkout_info">\n \n         This is a working copy of\n-        <a i18n:name="baseline_title"\n-            tal:attributes="href baseline/@@plone_context_state/view_url;\n-                            title baseline/Description"\n-            tal:content="baseline/Title"/>, made by\n+    <a tal:content="baseline/Title"\n+       tal:attributes="\n+         href baseline/@@plone_context_state/view_url;\n+         title baseline/Description;\n+       "\n+       i18n:name="baseline_title"\n+    ></a>, made by\n \n-        <a i18n:name="creator"\n-            tal:attributes="href view/creator_url"\n-            tal:omit-tag="not: view/creator_url"\n-            tal:content="view/creator_name">john smith</a>\n+    <a tal:content="view/creator_name"\n+       tal:omit-tag="not: view/creator_url"\n+       tal:attributes="\n+         href view/creator_url;\n+       "\n+       i18n:name="creator"\n+    >john smith</a>\n \n         on\n \n-        <span\n-            i18n:name="created"\n-            tal:content="view/created"/>.\n-    </tal:block>\n+    <span tal:content="view/created"\n+          i18n:name="created"\n+    ></span>.\n+  </tal:block>\n \n-    (<a i18n:translate="view_changes"\n-         tal:attributes="href string:${context/absolute_url}/@@iterate_diff">View changes</a>)\n+  (<a tal:attributes="\n+       href string:${context/absolute_url}/@@iterate_diff;\n+     "\n+     i18n:translate="view_changes"\n+  >View changes</a>)\n </div>\ndiff --git a/plone/app/iterate/configure.zcml b/plone/app/iterate/configure.zcml\nindex d295c17..e3bd469 100644\n--- a/plone/app/iterate/configure.zcml\n+++ b/plone/app/iterate/configure.zcml\n@@ -3,12 +3,25 @@\n     xmlns:five="http://namespaces.zope.org/five"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-  <include package="Products.CMFCore" file="meta.zcml"/>\n-  <include package="Products.GenericSetup" file="meta.zcml"/>\n-  <include package="zope.component" file="meta.zcml"/>\n-  <include package="zope.viewlet" file="meta.zcml"/>\n+  <include\n+      package="Products.CMFCore"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="Products.GenericSetup"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="zope.component"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="zope.viewlet"\n+      file="meta.zcml"\n+      />\n \n   <include package="plone.locking" />\n   <include package="plone.memoize" />\n@@ -22,75 +35,76 @@\n   <include package="zope.component" />\n   <include package="zope.viewlet" />\n \n-  <include package=".subscribers"/>\n-  <include package=".browser"/>\n+  <include package=".subscribers" />\n+  <include package=".browser" />\n+  <include package=".dexterity" />\n \n   <genericsetup:registerProfile\n-    name="default"\n-    title="Working Copy Support (Iterate)"\n-    directory="profiles/default"\n-    description="Adds working copy support (aka. in-place staging) to Plone."\n-    provides="Products.GenericSetup.interfaces.EXTENSION"\n-    />\n+      name="default"\n+      title="Working Copy Support (Iterate)"\n+      description="Adds working copy support (aka. in-place staging) to Plone."\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/default"\n+      />\n \n   <!--\n-    Remove, when CMFPlone no more depends on this profile.\n-    Products.CMFPlone/Products/CMFPlone/MigrationTool.py:99:\n-    Addon(profile_id=u\'plone.app.iterate:plone.app.iterate\')\n+    The plone.app.iterate:plone.app.iterate profile is deprecated.\n+    Remove either in Plone 6.1 or 7.0, I am on the fence here.\n+    See https://github.com/plone/plone.app.iterate/issues/99#issuecomment-1484686642\n   -->\n   <genericsetup:registerProfile\n-    name="plone.app.iterate"\n-    title="Working Copy Support (Iterate)"\n-    directory="profiles/default"\n-    description="Adds working copy support (aka. in-place staging) to Plone."\n-    provides="Products.GenericSetup.interfaces.EXTENSION"\n-    post_handler=".setuphandlers.deprecate_profile"\n-    />\n+      name="plone.app.iterate"\n+      title="Working Copy Support (Iterate)"\n+      description="Adds working copy support (aka. in-place staging) to Plone."\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/default"\n+      post_handler=".setuphandlers.deprecate_profile"\n+      />\n \n   <genericsetup:registerProfile\n       name="test"\n       title="plone.app.iterate: Test fixture"\n-      directory="profiles/test"\n       description="Extension profile to configure a test fixture"\n-      for="Products.CMFPlone.interfaces.ITestCasePloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.ITestCasePloneSiteRoot"\n+      directory="profiles/test"\n       />\n \n   <genericsetup:registerProfile\n       name="testingdx"\n       title="plone.app.iterate: Test fixture for DX"\n-      directory="profiles/testingdx"\n       description="Adds sample content types for testing"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n-      for="Products.CMFPlone.interfaces.ITestCasePloneSiteRoot"\n+      for="plone.base.interfaces.ITestCasePloneSiteRoot"\n+      directory="profiles/testingdx"\n       />\n \n   <genericsetup:registerProfile\n       name="uninstall"\n       title="Working Copy Support (Iterate) [uninstall]"\n-      directory="profiles/uninstall"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/uninstall"\n       />\n \n   <genericsetup:registerProfile\n       name="to1000"\n       title="Use new icons"\n-      directory="profiles/to1000"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/to1000"\n       />\n \n   <genericsetup:upgradeDepends\n-      source="121"\n-      destination="1000"\n       title="Use new icons"\n       profile="plone.app.iterate:default"\n+      source="121"\n+      destination="1000"\n       import_profile="plone.app.iterate:to1000"\n       />\n \n   <utility\n-      name="plone.app.iterate"\n       factory=".setuphandlers.HiddenProfiles"\n+      name="plone.app.iterate"\n       />\n \n   <adapter factory=".archiver.ContentArchiver" />\n@@ -108,21 +122,20 @@\n \n   <!-- Handle deletions of working copies -->\n   <subscriber\n-     for=".interfaces.IWorkingCopyRelation\n-          zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n-     handler=".event.handleDeletion"\n-     />\n+      for=".interfaces.IWorkingCopyRelation\n+           zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n+      handler=".event.handleDeletion"\n+      />\n \n   <permission\n-    id="plone.app.iterate.CheckInContent"\n-    title="iterate : Check in content"\n-    />\n+      id="plone.app.iterate.CheckInContent"\n+      title="iterate : Check in content"\n+      />\n \n   <permission\n-    id="plone.app.iterate.CheckOutContent"\n-    title="iterate : Check out content"\n-    />\n+      id="plone.app.iterate.CheckOutContent"\n+      title="iterate : Check out content"\n+      />\n \n-  <include package=".dexterity" zcml:condition="installed plone.app.relationfield" />\n \n </configure>\ndiff --git a/plone/app/iterate/containers.py b/plone/app/iterate/containers.py\nindex 9a0c933..c22142c 100644\n--- a/plone/app/iterate/containers.py\n+++ b/plone/app/iterate/containers.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -35,13 +34,13 @@\n \n @implementer(IWCContainerLocator)\n @adapter(IDynamicType)\n-class HomeFolderLocator(object):\n+class HomeFolderLocator:\n     """Locate the current user\'s home folder, if possible."""\n \n     def __init__(self, context):\n         self.context = context\n \n-    title = _(u"Home folder")\n+    title = _("Home folder")\n \n     @property\n     def available(self):\n@@ -53,7 +52,7 @@ def __call__(self):\n \n @implementer(IWCContainerLocator)\n @adapter(IDynamicType)\n-class ParentFolderLocator(object):\n+class ParentFolderLocator:\n     """Locate the parent of the context, if the user has the\n     Add portal content permission.\n     """\n@@ -61,7 +60,7 @@ class ParentFolderLocator(object):\n     def __init__(self, context):\n         self.context = context\n \n-    title = _(u"Parent folder")\n+    title = _("Parent folder")\n \n     @property\n     def available(self):\ndiff --git a/plone/app/iterate/dexterity/__init__.py b/plone/app/iterate/dexterity/__init__.py\nindex 22ba3f6..4eb7b7c 100644\n--- a/plone/app/iterate/dexterity/__init__.py\n+++ b/plone/app/iterate/dexterity/__init__.py\n@@ -1,3 +1 @@\n-# -*- coding: utf-8 -*-\n-\n ITERATE_RELATION_NAME = "iterate-working-copy"\ndiff --git a/plone/app/iterate/dexterity/configure.zcml b/plone/app/iterate/dexterity/configure.zcml\nindex 42ddbe0..0457c7b 100644\n--- a/plone/app/iterate/dexterity/configure.zcml\n+++ b/plone/app/iterate/dexterity/configure.zcml\n@@ -1,31 +1,32 @@\n <configure\n-        xmlns="http://namespaces.zope.org/zope"\n-        xmlns:zcml="http://namespaces.zope.org/zcml"\n-        xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-        xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n-    <subscriber\n-       for="plone.app.iterate.interfaces.IAfterCheckinEvent"\n-       handler="plone.app.iterate.subscribers.locking.handleCheckin"\n-       />\n+  <subscriber\n+      for="plone.app.iterate.interfaces.IAfterCheckinEvent"\n+      handler="plone.app.iterate.subscribers.locking.handleCheckin"\n+      />\n \n-    <adapter\n-       for="plone.dexterity.interfaces.IDexterityContent"\n-       factory=".copier.ContentCopier"\n-       />\n+  <adapter\n+      factory=".copier.ContentCopier"\n+      for="plone.dexterity.interfaces.IDexterityContent"\n+      />\n \n-    <adapter\n-       for="plone.dexterity.interfaces.IDexterityContainer"\n-       factory=".copier.FolderishContentCopier"\n-       />\n+  <adapter\n+      factory=".copier.FolderishContentCopier"\n+      for="plone.dexterity.interfaces.IDexterityContainer"\n+      />\n \n-    <adapter\n-       for=".interfaces.IDexterityIterateAware"\n-       factory=".policy.CheckinCheckoutPolicyAdapter"\n-       />\n+  <adapter\n+      factory=".policy.CheckinCheckoutPolicyAdapter"\n+      for=".interfaces.IDexterityIterateAware"\n+      />\n \n-    <class class="plone.dexterity.content.DexterityContent">\n-        <implements interface="plone.app.iterate.dexterity.interfaces.IDexterityIterateAware" />\n-    </class>\n+  <class class="plone.dexterity.content.DexterityContent">\n+    <implements interface="plone.app.iterate.dexterity.interfaces.IDexterityIterateAware" />\n+  </class>\n \n </configure>\ndiff --git a/plone/app/iterate/dexterity/copier.py b/plone/app/iterate/dexterity/copier.py\nindex 2bc6995..5a952b0 100644\n--- a/plone/app/iterate/dexterity/copier.py\n+++ b/plone/app/iterate/dexterity/copier.py\n@@ -1,11 +1,11 @@\n-# -*- coding: utf-8 -*-\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n-from plone.app.iterate.base import BaseContentCopier\n from plone.app.iterate import interfaces\n+from plone.app.iterate.base import BaseContentCopier\n from plone.app.iterate.dexterity import ITERATE_RELATION_NAME\n from plone.app.iterate.dexterity.relation import StagingRelationValue\n from plone.app.iterate.event import AfterCheckinEvent\n+from plone.dexterity.utils import createContentInContainer\n from plone.dexterity.utils import iterSchemata\n from Products.CMFCore.utils import getToolByName\n from Products.DCWorkflow.DCWorkflow import DCWorkflowDefinition\n@@ -17,7 +17,6 @@\n from zope.event import notify\n from zope.intid.interfaces import IIntIds\n from zope.schema import getFieldsInOrder\n-from plone.dexterity.utils import createContentInContainer\n \n \n class ContentCopier(BaseContentCopier):\n@@ -170,7 +169,7 @@ def _copyBaseline(self, container):\n         obj = createContentInContainer(\n             container,\n             self.context.portal_type,\n-            id="working_copy_of_{}".format(self.context.id),\n+            id=f"working_copy_of_{self.context.id}",\n         )\n \n         # copy all field values from the baseline to the working copy\ndiff --git a/plone/app/iterate/dexterity/interfaces.py b/plone/app/iterate/dexterity/interfaces.py\nindex 53fdc57..b3eca21 100644\n--- a/plone/app/iterate/dexterity/interfaces.py\n+++ b/plone/app/iterate/dexterity/interfaces.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from plone.app.iterate.interfaces import IIterateAware\n from z3c.relationfield.interfaces import IRelationValue\n \ndiff --git a/plone/app/iterate/dexterity/policy.py b/plone/app/iterate/dexterity/policy.py\nindex e90911c..82ae5b1 100644\n--- a/plone/app/iterate/dexterity/policy.py\n+++ b/plone/app/iterate/dexterity/policy.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from plone.app.iterate.base import CheckinCheckoutBasePolicyAdapter\n from plone.app.iterate.dexterity.interfaces import IDexterityIterateAware\n from plone.app.iterate.dexterity.utils import get_baseline\ndiff --git a/plone/app/iterate/dexterity/relation.py b/plone/app/iterate/dexterity/relation.py\nindex 3180f92..f9f06c7 100644\n--- a/plone/app/iterate/dexterity/relation.py\n+++ b/plone/app/iterate/dexterity/relation.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from plone.app.iterate.dexterity.interfaces import IStagingRelationValue\n from z3c.relationfield import relation\n from zc.relation.interfaces import ICatalog\ndiff --git a/plone/app/iterate/dexterity/utils.py b/plone/app/iterate/dexterity/utils.py\nindex 6f142bb..1973f16 100644\n--- a/plone/app/iterate/dexterity/utils.py\n+++ b/plone/app/iterate/dexterity/utils.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from Acquisition import aq_base\n from Acquisition import aq_inner\n from plone.app.iterate.dexterity import ITERATE_RELATION_NAME\ndiff --git a/plone/app/iterate/event.py b/plone/app/iterate/event.py\nindex 16d6041..df34ef2 100644\n--- a/plone/app/iterate/event.py\n+++ b/plone/app/iterate/event.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -22,11 +21,10 @@\n ##################################################################\n """\n """\n-from zope.interface.interfaces import ObjectEvent\n+from . import interfaces\n from zope.event import notify\n from zope.interface import implementer\n-\n-from . import interfaces\n+from zope.interface.interfaces import ObjectEvent\n \n \n @implementer(interfaces.ICheckoutEvent)\n@@ -49,7 +47,7 @@ def __init__(self, wc, baseline, relation, message):\n @implementer(interfaces.IAfterCheckinEvent)\n class AfterCheckinEvent(ObjectEvent):\n     def __init__(self, new_baseline, checkin_message):\n-        super(AfterCheckinEvent, self).__init__(new_baseline)\n+        super().__init__(new_baseline)\n         self.message = checkin_message\n \n \n@@ -70,7 +68,6 @@ def __init__(self, wc, baseline, relation):\n \n @implementer(interfaces.IBeforeCheckoutEvent)\n class BeforeCheckoutEvent(ObjectEvent):\n-\n     pass\n \n \ndiff --git a/plone/app/iterate/interfaces.py b/plone/app/iterate/interfaces.py\nindex 120fee7..974cda0 100644\n--- a/plone/app/iterate/interfaces.py\n+++ b/plone/app/iterate/interfaces.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -20,19 +19,13 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-$Id: interfaces.py 1811 2007-02-06 18:40:02Z hazmat $\n-"""\n-\n from plone.app.iterate import PloneMessageFactory as _\n from plone.locking.interfaces import LockType\n from plone.locking.interfaces import MAX_TIMEOUT\n from zope import schema\n-from zope.interface.interfaces import IObjectEvent\n from zope.interface import Attribute\n from zope.interface import Interface\n-\n-import pkg_resources\n+from zope.interface.interfaces import IObjectEvent\n \n \n class IReference(Interface):\n@@ -51,8 +44,8 @@ class IIterateAware(Interface):\n #  Lock types\n \n ITERATE_LOCK = LockType(\n-    u"iterate.lock", stealable=False, user_unlockable=False, timeout=MAX_TIMEOUT\n-)  # noqa\n+    "iterate.lock", stealable=False, user_unlockable=False, timeout=MAX_TIMEOUT\n+)\n \n #################################\n #  Exceptions\n@@ -79,7 +72,7 @@ class ConflictError(CheckinException):\n annotation_key = "ore.iterate"\n \n \n-class keys(object):\n+class keys:\n     # various common keys\n     checkout_user = "checkout_user"\n     checkout_time = "checkout_time"\n@@ -100,24 +93,24 @@ class ICheckinEvent(IObjectEvent):\n \n \n class IAfterCheckinEvent(IObjectEvent):\n-    """ sent out after an object is checked in """\n+    """sent out after an object is checked in"""\n \n     checkin_message = Attribute("checkin message")\n \n \n class IBeforeCheckoutEvent(IObjectEvent):\n-    """ sent out before a working copy is created """\n+    """sent out before a working copy is created"""\n \n \n class ICheckoutEvent(IObjectEvent):\n-    """ an object is being checked out, event.object is the baseline """\n+    """an object is being checked out, event.object is the baseline"""\n \n     working_copy = Attribute("The object\'s working copy")\n     relation = Attribute("The Working Copy Relation Object")\n \n \n class ICancelCheckoutEvent(IObjectEvent):\n-    """ a working copy is being cancelled """\n+    """a working copy is being cancelled"""\n \n     baseline = Attribute("The working copy\'s baseline")\n \n@@ -166,10 +159,10 @@ class IWCContainerLocator(Interface):\n     """\n \n     available = schema.Bool(\n-        title=u"Available", description=u"Whether location will be available."\n+        title="Available", description="Whether location will be available."\n     )\n \n-    title = schema.TextLine(title=u"Title", description=u"Title of this location")\n+    title = schema.TextLine(title="Title", description="Title of this location")\n \n     def __call__():\n         """Return a container object, or None if available() is False"""\n@@ -299,17 +292,16 @@ def checkinBackReferences(baseline, wc, references, storage):\n \n \n class IIterateSettings(Interface):\n-\n     enable_checkout_workflow = schema.Bool(\n-        title=_(u"Enable checkout workflow"),\n-        description=u"",\n+        title=_("Enable checkout workflow"),\n+        description="",\n         default=False,\n         required=False,\n     )\n \n     checkout_workflow_policy = schema.ASCIILine(\n-        title=_(u"Checkout workflow policy"),\n-        description=u"",\n+        title=_("Checkout workflow policy"),\n+        description="",\n         default="checkout_workflow_policy",\n         required=True,\n     )\ndiff --git a/plone/app/iterate/lock.py b/plone/app/iterate/lock.py\nindex 7851c81..4691176 100644\n--- a/plone/app/iterate/lock.py\n+++ b/plone/app/iterate/lock.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -22,8 +21,6 @@\n ##################################################################\n """\n Checkin / Checkout Specific DAV Lock Manipulation and Introspection\n-\n-$Id: lock.py 1392 2006-06-20 01:02:17Z hazmat $\n """\n \n from .interfaces import ITERATE_LOCK\ndiff --git a/plone/app/iterate/permissions.py b/plone/app/iterate/permissions.py\nindex d829aef..1dcf0ce 100644\n--- a/plone/app/iterate/permissions.py\n+++ b/plone/app/iterate/permissions.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -23,6 +22,7 @@\n \n from AccessControl.Permission import addPermission\n \n+\n CheckinPermission = "iterate : Check in content"\n CheckoutPermission = "iterate : Check out content"\n \ndiff --git a/plone/app/iterate/profiles/default/actions.xml b/plone/app/iterate/profiles/default/actions.xml\nindex 49c3118..ec542d3 100644\n--- a/plone/app/iterate/profiles/default/actions.xml\n+++ b/plone/app/iterate/profiles/default/actions.xml\n@@ -1,43 +1,68 @@\n-<?xml version="1.0"?>\n-<object name="portal_actions" meta_type="Plone Actions Tool"\n-   xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n- <object name="object_buttons" meta_type="CMF Action Category">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Plone Actions Tool"\n+        name="portal_actions"\n+>\n+  <object meta_type="CMF Action Category"\n+          name="object_buttons"\n+  >\n \n-  <object name="iterate_checkin" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="">Check in</property>\n-   <property name="description" i18n:translate=""></property>\n-   <property name="url_expr">string:${object_url}/@@content-checkin</property>\n-   <property name="icon_expr">string:box-arrow-in-up-right</property>\n-   <property name="available_expr">python:path(\'object/@@iterate_control\').checkin_allowed()</property>\n-   <property name="permissions">\n-    <element value="View"/>\n-   </property>\n-   <property name="visible">True</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkin"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate=""\n+      >Check in</property>\n+      <property name="description"\n+                i18n:translate=""\n+      />\n+      <property name="url_expr">string:${object_url}/@@content-checkin</property>\n+      <property name="icon_expr">string:box-arrow-in-up-right</property>\n+      <property name="available_expr">python:path(\'object/@@iterate_control\').checkin_allowed()</property>\n+      <property name="permissions">\n+        <element value="View" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n \n-  <object name="iterate_checkout" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="">Check out</property>\n-   <property name="description" i18n:translate=""></property>\n-   <property name="url_expr">string:${object_url}/@@content-checkout</property>\n-   <property name="icon_expr">string:box-arrow-down-left</property>\n-   <property name="available_expr">python:path(\'object/@@iterate_control\').checkout_allowed()</property>\n-   <property name="permissions">\n-    <element value="View"/>\n-   </property>\n-   <property name="visible">True</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkout"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate=""\n+      >Check out</property>\n+      <property name="description"\n+                i18n:translate=""\n+      />\n+      <property name="url_expr">string:${object_url}/@@content-checkout</property>\n+      <property name="icon_expr">string:box-arrow-down-left</property>\n+      <property name="available_expr">python:path(\'object/@@iterate_control\').checkout_allowed()</property>\n+      <property name="permissions">\n+        <element value="View" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n \n-  <object name="iterate_checkout_cancel" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="">Cancel check-out</property>\n-   <property name="description" i18n:translate=""></property>\n-   <property name="url_expr">string:${object_url}/@@content-cancel-checkout</property>\n-   <property name="icon_expr">string:arrow-counterclockwise</property>\n-   <property name="available_expr">python:path(\'object/@@iterate_control\').cancel_allowed()</property>\n-   <property name="permissions">\n-    <element value="Modify portal content"/>\n-   </property>\n-   <property name="visible">True</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkout_cancel"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate=""\n+      >Cancel check-out</property>\n+      <property name="description"\n+                i18n:translate=""\n+      />\n+      <property name="url_expr">string:${object_url}/@@content-cancel-checkout</property>\n+      <property name="icon_expr">string:arrow-counterclockwise</property>\n+      <property name="available_expr">python:path(\'object/@@iterate_control\').cancel_allowed()</property>\n+      <property name="permissions">\n+        <element value="Modify portal content" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n \n- </object>\n+  </object>\n </object>\ndiff --git a/plone/app/iterate/profiles/default/metadata.xml b/plone/app/iterate/profiles/default/metadata.xml\nindex b22370d..f768b5a 100644\n--- a/plone/app/iterate/profiles/default/metadata.xml\n+++ b/plone/app/iterate/profiles/default/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>1000</version>\n </metadata>\ndiff --git a/plone/app/iterate/profiles/default/registry.xml b/plone/app/iterate/profiles/default/registry.xml\nindex bbe73c8..98b50af 100644\n--- a/plone/app/iterate/profiles/default/registry.xml\n+++ b/plone/app/iterate/profiles/default/registry.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n-    <records interface="plone.app.iterate.interfaces.IIterateSettings" />\n+  <records interface="plone.app.iterate.interfaces.IIterateSettings" />\n </registry>\ndiff --git a/plone/app/iterate/profiles/test/metadata.xml b/plone/app/iterate/profiles/test/metadata.xml\nindex e44e88c..0383546 100644\n--- a/plone/app/iterate/profiles/test/metadata.xml\n+++ b/plone/app/iterate/profiles/test/metadata.xml\n@@ -1,3 +1,4 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>1</version>\n   <dependencies>\ndiff --git a/plone/app/iterate/profiles/test/portal_placeful_workflow.xml b/plone/app/iterate/profiles/test/portal_placeful_workflow.xml\nindex 30fbc67..09ebde0 100644\n--- a/plone/app/iterate/profiles/test/portal_placeful_workflow.xml\n+++ b/plone/app/iterate/profiles/test/portal_placeful_workflow.xml\n@@ -1,6 +1,12 @@\n-<?xml version="1.0"?>\r\n-<object name="portal_placeful_workflow" meta_type="Placeful Workflow Tool">\r\n-    <property name="title"></property>\r\n-    <property name="max_chain_length" type="int">1</property>\r\n-    <object name="working-copy" meta_type="WorkflowPolicy" />\r\n-</object>\n\\ No newline at end of file\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Placeful Workflow Tool"\n+        name="portal_placeful_workflow"\n+>\n+  <property name="title" />\n+  <property name="max_chain_length"\n+            type="int"\n+  >1</property>\n+  <object meta_type="WorkflowPolicy"\n+          name="working-copy"\n+  />\n+</object>\ndiff --git a/plone/app/iterate/profiles/test/portal_placeful_workflow/working-copy.xml b/plone/app/iterate/profiles/test/portal_placeful_workflow/working-copy.xml\nindex a999931..b4f399d 100644\n--- a/plone/app/iterate/profiles/test/portal_placeful_workflow/working-copy.xml\n+++ b/plone/app/iterate/profiles/test/portal_placeful_workflow/working-copy.xml\n@@ -1,10 +1,14 @@\n-<?xml version="1.0"?>\r\n-<object name="working-copy" meta_type="WorkflowPolicy">\r\n-    <property name="title">Working Copy</property>\r\n-    <bindings>\r\n-        <default>\r\n-            <bound-workflow workflow_id="workingcopy_workflow" />\r\n-        </default>\r\n-        <type default_chain="true" type_id="Document" />\r\n-    </bindings>\r\n-</object>\r\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="WorkflowPolicy"\n+        name="working-copy"\n+>\n+  <property name="title">Working Copy</property>\n+  <bindings>\n+    <default>\n+      <bound-workflow workflow_id="workingcopy_workflow" />\n+    </default>\n+    <type default_chain="true"\n+          type_id="Document"\n+    />\n+  </bindings>\n+</object>\ndiff --git a/plone/app/iterate/profiles/test/workflows.xml b/plone/app/iterate/profiles/test/workflows.xml\nindex 4ebd2ce..fd63b85 100644\n--- a/plone/app/iterate/profiles/test/workflows.xml\n+++ b/plone/app/iterate/profiles/test/workflows.xml\n@@ -1,4 +1,8 @@\n-<?xml version="1.0" encoding="UTF-8"?>\r\n-<object name="portal_workflow" meta_type="Plone Workflow Tool">\r\n-    <object name="workingcopy_workflow" meta_type="Workflow" />\r\n-</object>\n\\ No newline at end of file\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Workflow Tool"\n+        name="portal_workflow"\n+>\n+  <object meta_type="Workflow"\n+          name="workingcopy_workflow"\n+  />\n+</object>\ndiff --git a/plone/app/iterate/profiles/test/workflows/workingcopy_workflow/definition.xml b/plone/app/iterate/profiles/test/workflows/workingcopy_workflow/definition.xml\nindex d445148..287c82b 100644\n--- a/plone/app/iterate/profiles/test/workflows/workingcopy_workflow/definition.xml\n+++ b/plone/app/iterate/profiles/test/workflows/workingcopy_workflow/definition.xml\n@@ -1,158 +1,238 @@\n-<?xml version="1.0"?>\r\n-<dc-workflow xmlns:i18n="http://xml.zope.org/namespaces/i18n" i18n:domain="plone" workflow_id="workingcopy_workflow"\r\n-    title="test wc workflow" state_variable="review_state" initial_state="draft-copy" i18n:attributes="title">\r\n-\r\n-    <!-- These are the permissions being managed -->\r\n-    <permission>Delete objects</permission>\r\n-    <permission>iterate : Check in content</permission>\r\n-    <permission>iterate : Check out content</permission>\r\n-    <permission>View</permission>\r\n-    <permission>Access contents information</permission>\r\n-    <permission>Modify portal content</permission>\r\n-    <permission>Copy or Move</permission>\r\n-\r\n-    <!-- The various workflow states, with their permission maps -->\r\n-    <state state_id="draft-copy" title="Draft (copy)" i18n:attributes="title">\r\n-        <description i18n:translate="">New version created but not ready for publication</description>\r\n-        <exit-transition transition_id="submit-copy-for-publication" />\r\n-        <permission-map name="Access contents information" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="Modify portal content" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="View" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="iterate : Check in content" acquired="False" />\r\n-        <permission-map name="iterate : Check out content" acquired="False" />\r\n-        <permission-map name="Copy or Move" acquired="False" />\r\n-        <permission-map name="Delete objects" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-    </state>\r\n-    \r\n-    <state state_id="pending-copy" title="Pending (copy)" i18n:attributes="title">\r\n-        <description i18n:translate="">Copy submitted for publication - pending approval</description>\r\n-        <exit-transition transition_id="withdraw-submitted-copy" />\r\n-        <exit-transition transition_id="reject-submitted-copy" />\r\n-        <permission-map name="Access contents information" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="Modify portal content" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="View" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="iterate : Check in content" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>\r\n-        <permission-map name="iterate : Check out content" acquired="False" />\r\n-        <permission-map name="Copy or Move" acquired="False" />\r\n-        <permission-map name="Delete objects" acquired="False">\r\n-            <permission-role>Editor</permission-role>\r\n-            <permission-role>Site Administrator</permission-role>\r\n-            <permission-role>Contributor</permission-role>\r\n-            <permission-role>Manager</permission-role>\r\n-        </permission-map>        \r\n-    </state>\r\n-\r\n-    <!-- Transitions between states, including guard conditions -->\r\n-    <transition transition_id="submit-copy-for-publication" new_state="pending-copy" title="Submit draft content for publication" trigger="USER"\r\n-        before_script="" after_script="" i18n:attributes="title">\r\n-        <description i18n:translate="">\r\n-            Move the content to the pending state where it will be reviewed by an editor by publication.\r\n-        </description>\r\n-        <action url="%(content_url)s/content_status_modify?workflow_action=submit-copy-for-publication" category="workflow"\r\n-            i18n:translate="">Submit</action>\r\n-        <guard>\r\n-            <guard-permission>Modify portal content</guard-permission>\r\n-        </guard>\r\n-    </transition>\r\n-    <transition transition_id="reject-submitted-copy" new_state="draft-copy" title="Editor rejects submitted content"\r\n-        trigger="USER" before_script="" after_script="" i18n:attributes="title">\r\n-        <description i18n:translate="">\r\n-            Revert to draft.\r\n-        </description>\r\n-        <guard>\r\n-            <guard-permission>Review portal content</guard-permission>\r\n-        </guard>\r\n-    </transition>\r\n-    <transition transition_id="withdraw-submitted-copy" new_state="draft-copy" title="Contributor withdraws submitted content"\r\n-        trigger="USER" before_script="" after_script="" i18n:attributes="title">\r\n-        <description i18n:translate="">\r\n-            Revert to draft.\r\n-        </description>\r\n-        <guard>\r\n-            <guard-role>Contributor</guard-role>\r\n-        </guard>\r\n-    </transition>\r\n-\r\n-    <!-- Workflow variables, managed as part of workflow history -->\r\n-    <variable variable_id="action" for_catalog="False" for_status="True" update_always="True">\r\n-        <description>The last transition</description>\r\n-        <default>\r\n-            <expression>transition/getId|nothing</expression>\r\n-        </default>\r\n-        <guard>\r\n-        </guard>\r\n-    </variable>\r\n-    <variable variable_id="actor" for_catalog="False" for_status="True" update_always="True">\r\n-        <description>The ID of the user who performed the last transition</description>\r\n-        <default>\r\n-            <expression>user/getId</expression>\r\n-        </default>\r\n-        <guard>\r\n-        </guard>\r\n-    </variable>\r\n-    <variable variable_id="comments" for_catalog="False" for_status="True" update_always="True">\r\n-        <description>Comments about the last transition</description>\r\n-        <default>\r\n-            <expression>python:state_change.kwargs.get(\'comment\', \'\')</expression>\r\n-        </default>\r\n-        <guard>\r\n-        </guard>\r\n-    </variable>\r\n-    <variable variable_id="review_history" for_catalog="False" for_status="False" update_always="False">\r\n-        <description>Provides access to workflow history</description>\r\n-        <default>\r\n-            <expression>state_change/getHistory</expression>\r\n-        </default>\r\n-        <guard>\r\n-            <guard-permission>Request review</guard-permission>\r\n-            <guard-permission>Review portal content</guard-permission>\r\n-        </guard>\r\n-    </variable>\r\n-    <variable variable_id="time" for_catalog="False" for_status="True" update_always="True">\r\n-        <description>Time of the last transition</description>\r\n-        <default>\r\n-            <expression>state_change/getDateTime</expression>\r\n-        </default>\r\n-        <guard>\r\n-        </guard>\r\n-    </variable>\r\n-\r\n-</dc-workflow>\r\n+<?xml version="1.0" encoding="utf-8"?>\n+<dc-workflow xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+             initial_state="draft-copy"\n+             state_variable="review_state"\n+             title="test wc workflow"\n+             workflow_id="workingcopy_workflow"\n+             i18n:attributes="title"\n+             i18n:domain="plone"\n+>\n+\n+  <!-- These are the permissions being managed -->\n+  <permission>Delete objects</permission>\n+  <permission>iterate : Check in content</permission>\n+  <permission>iterate : Check out content</permission>\n+  <permission>View</permission>\n+  <permission>Access contents information</permission>\n+  <permission>Modify portal content</permission>\n+  <permission>Copy or Move</permission>\n+\n+  <!-- The various workflow states, with their permission maps -->\n+  <state state_id="draft-copy"\n+         title="Draft (copy)"\n+         i18n:attributes="title"\n+  >\n+    <description i18n:translate="">New version created but not ready for publication</description>\n+    <exit-transition transition_id="submit-copy-for-publication" />\n+    <permission-map acquired="False"\n+                    name="Access contents information"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="Modify portal content"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="View"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="iterate : Check in content"\n+    />\n+    <permission-map acquired="False"\n+                    name="iterate : Check out content"\n+    />\n+    <permission-map acquired="False"\n+                    name="Copy or Move"\n+    />\n+    <permission-map acquired="False"\n+                    name="Delete objects"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+  </state>\n+\n+  <state state_id="pending-copy"\n+         title="Pending (copy)"\n+         i18n:attributes="title"\n+  >\n+    <description i18n:translate="">Copy submitted for publication - pending approval</description>\n+    <exit-transition transition_id="withdraw-submitted-copy" />\n+    <exit-transition transition_id="reject-submitted-copy" />\n+    <permission-map acquired="False"\n+                    name="Access contents information"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="Modify portal content"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="View"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="iterate : Check in content"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+    <permission-map acquired="False"\n+                    name="iterate : Check out content"\n+    />\n+    <permission-map acquired="False"\n+                    name="Copy or Move"\n+    />\n+    <permission-map acquired="False"\n+                    name="Delete objects"\n+    >\n+      <permission-role>Editor</permission-role>\n+      <permission-role>Site Administrator</permission-role>\n+      <permission-role>Contributor</permission-role>\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+  </state>\n+\n+  <!-- Transitions between states, including guard conditions -->\n+  <transition after_script=""\n+              before_script=""\n+              new_state="pending-copy"\n+              title="Submit draft content for publication"\n+              transition_id="submit-copy-for-publication"\n+              trigger="USER"\n+              i18n:attributes="title"\n+  >\n+    <description i18n:translate="">\n+            Move the content to the pending state where it will be reviewed by an editor by publication.\n+        </description>\n+    <action category="workflow"\n+            url="%(content_url)s/content_status_modify?workflow_action=submit-copy-for-publication"\n+            i18n:translate=""\n+    >Submit</action>\n+    <guard>\n+      <guard-permission>Modify portal content</guard-permission>\n+    </guard>\n+  </transition>\n+  <transition after_script=""\n+              before_script=""\n+              new_state="draft-copy"\n+              title="Editor rejects submitted content"\n+              transition_id="reject-submitted-copy"\n+              trigger="USER"\n+              i18n:attributes="title"\n+  >\n+    <description i18n:translate="">\n+            Revert to draft.\n+        </description>\n+    <guard>\n+      <guard-permission>Review portal content</guard-permission>\n+    </guard>\n+  </transition>\n+  <transition after_script=""\n+              before_script=""\n+              new_state="draft-copy"\n+              title="Contributor withdraws submitted content"\n+              transition_id="withdraw-submitted-copy"\n+              trigger="USER"\n+              i18n:attributes="title"\n+  >\n+    <description i18n:translate="">\n+            Revert to draft.\n+        </description>\n+    <guard>\n+      <guard-role>Contributor</guard-role>\n+    </guard>\n+  </transition>\n+\n+  <!-- Workflow variables, managed as part of workflow history -->\n+  <variable for_catalog="False"\n+            for_status="True"\n+            update_always="True"\n+            variable_id="action"\n+  >\n+    <description>The last transition</description>\n+    <default>\n+      <expression>transition/getId|nothing</expression>\n+    </default>\n+    <guard>\n+</guard>\n+  </variable>\n+  <variable for_catalog="False"\n+            for_status="True"\n+            update_always="True"\n+            variable_id="actor"\n+  >\n+    <description>The ID of the user who performed the last transition</description>\n+    <default>\n+      <expression>user/getId</expression>\n+    </default>\n+    <guard>\n+</guard>\n+  </variable>\n+  <variable for_catalog="False"\n+            for_status="True"\n+            update_always="True"\n+            variable_id="comments"\n+  >\n+    <description>Comments about the last transition</description>\n+    <default>\n+      <expression>python:state_change.kwargs.get(\'comment\', \'\')</expression>\n+    </default>\n+    <guard>\n+</guard>\n+  </variable>\n+  <variable for_catalog="False"\n+            for_status="False"\n+            update_always="False"\n+            variable_id="review_history"\n+  >\n+    <description>Provides access to workflow history</description>\n+    <default>\n+      <expression>state_change/getHistory</expression>\n+    </default>\n+    <guard>\n+      <guard-permission>Request review</guard-permission>\n+      <guard-permission>Review portal content</guard-permission>\n+    </guard>\n+  </variable>\n+  <variable for_catalog="False"\n+            for_status="True"\n+            update_always="True"\n+            variable_id="time"\n+  >\n+    <description>Time of the last transition</description>\n+    <default>\n+      <expression>state_change/getDateTime</expression>\n+    </default>\n+    <guard>\n+</guard>\n+  </variable>\n+\n+</dc-workflow>\ndiff --git a/plone/app/iterate/profiles/testingdx/repositorytool.xml b/plone/app/iterate/profiles/testingdx/repositorytool.xml\nindex 4da978c..ac3dd30 100644\n--- a/plone/app/iterate/profiles/testingdx/repositorytool.xml\n+++ b/plone/app/iterate/profiles/testingdx/repositorytool.xml\n@@ -1,9 +1,9 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <repositorytool>\n-    <policymap>\n-        <type name="FolderishDocument">\n-            <policy name="at_edit_autoversion"/>\n-            <policy name="version_on_revert"/>\n-        </type>\n-    </policymap>\n+  <policymap>\n+    <type name="FolderishDocument">\n+      <policy name="at_edit_autoversion" />\n+      <policy name="version_on_revert" />\n+    </type>\n+  </policymap>\n </repositorytool>\ndiff --git a/plone/app/iterate/profiles/testingdx/types.xml b/plone/app/iterate/profiles/testingdx/types.xml\nindex 68faffd..494b373 100644\n--- a/plone/app/iterate/profiles/testingdx/types.xml\n+++ b/plone/app/iterate/profiles/testingdx/types.xml\n@@ -1,6 +1,10 @@\n-<?xml version="1.0"?>\n-<object name="portal_types" meta_type="Plone Types Tool">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n \n-  <object name="FolderishDocument" meta_type="Dexterity FTI" />\n+  <object meta_type="Dexterity FTI"\n+          name="FolderishDocument"\n+  />\n \n </object>\ndiff --git a/plone/app/iterate/profiles/testingdx/types/FolderishDocument.xml b/plone/app/iterate/profiles/testingdx/types/FolderishDocument.xml\nindex 17ed0f4..cac5020 100644\n--- a/plone/app/iterate/profiles/testingdx/types/FolderishDocument.xml\n+++ b/plone/app/iterate/profiles/testingdx/types/FolderishDocument.xml\n@@ -1,28 +1,35 @@\n-<?xml version="1.0"?>\n-<object name="FolderishDocument"\n-   meta_type="Dexterity FTI"\n-   i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="FolderishDocument"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic metadata -->\n-  <property name="title" i18n:translate="">DX Test Folderish Document</property>\n+  <property name="title"\n+            i18n:translate=""\n+  >DX Test Folderish Document</property>\n   <property name="description"\n-    i18n:translate=""></property>\n-  <property name="icon_expr"></property>\n+            i18n:translate=""\n+  />\n+  <property name="icon_expr" />\n   <property name="factory">FolderishDocument</property>\n   <property name="add_view_expr">string:${folder_url}/++add++FolderishDocument</property>\n   <property name="global_allow">True</property>\n   <property name="filter_content_types">False</property>\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="allow_discussion">False</property>\n \n   <!-- class used for content items -->\n   <property name="klass">plone.app.iterate.tests.dxtypes.FolderishDocument</property>\n   <property name="model_file">plone.app.contenttypes.schema:document.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.namefromtitle" />\n     <element value="plone.allowdiscussion" />\n     <element value="plone.excludefromnavigation" />\n@@ -36,28 +43,46 @@\n   </property>\n \n   <!-- View information -->\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n   <property name="immediate_view">view</property>\n   <property name="default_view">view</property>\n   <property name="view_methods">\n-   <element value="view"/>\n+    <element value="view" />\n   </property>\n   <property name="default_view_fallback">False</property>\n   <property name="add_permission">cmf.AddPortalContent</property>\n \n   <!-- Method aliases -->\n-  <alias from="(Default)" to="(dynamic view)" />\n-  <alias from="view" to="(selected layout)" />\n-  <alias from="edit" to="@@edit" />\n-  <alias from="sharing" to="@@sharing" />\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n+  />\n+  <alias from="view"\n+         to="(selected layout)"\n+  />\n+  <alias from="edit"\n+         to="@@edit"\n+  />\n+  <alias from="sharing"\n+         to="@@sharing"\n+  />\n \n   <!-- Actions -->\n-  <action title="View" action_id="view" category="object" condition_expr=""\n-    url_expr="string:${object_url}/" visible="True">\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          title="View"\n+          url_expr="string:${object_url}/"\n+          visible="True"\n+  >\n     <permission value="View" />\n   </action>\n-  <action title="Edit" action_id="edit" category="object" condition_expr=""\n-    url_expr="string:${object_url}/edit" visible="True">\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+  >\n     <permission value="Modify portal content" />\n   </action>\n </object>\ndiff --git a/plone/app/iterate/profiles/to1000/actions.xml b/plone/app/iterate/profiles/to1000/actions.xml\nindex 0d33102..805bf57 100644\n--- a/plone/app/iterate/profiles/to1000/actions.xml\n+++ b/plone/app/iterate/profiles/to1000/actions.xml\n@@ -1,19 +1,32 @@\n-<?xml version="1.0"?>\n-<object name="portal_actions" meta_type="Plone Actions Tool"\n-   xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n- <object name="object_buttons" meta_type="CMF Action Category">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Plone Actions Tool"\n+        name="portal_actions"\n+>\n+  <object meta_type="CMF Action Category"\n+          name="object_buttons"\n+  >\n \n-  <object name="iterate_checkin" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="icon_expr">string:box-arrow-in-up-right</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkin"\n+            i18n:domain="plone"\n+    >\n+      <property name="icon_expr">string:box-arrow-in-up-right</property>\n+    </object>\n \n-  <object name="iterate_checkout" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="icon_expr">string:box-arrow-down-left</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkout"\n+            i18n:domain="plone"\n+    >\n+      <property name="icon_expr">string:box-arrow-down-left</property>\n+    </object>\n \n-  <object name="iterate_checkout_cancel" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="icon_expr">string:arrow-counterclockwise</property>\n-  </object>\n+    <object meta_type="CMF Action"\n+            name="iterate_checkout_cancel"\n+            i18n:domain="plone"\n+    >\n+      <property name="icon_expr">string:arrow-counterclockwise</property>\n+    </object>\n \n- </object>\n+  </object>\n </object>\ndiff --git a/plone/app/iterate/profiles/uninstall/actions.xml b/plone/app/iterate/profiles/uninstall/actions.xml\nindex 1ce03a8..a4fc09c 100644\n--- a/plone/app/iterate/profiles/uninstall/actions.xml\n+++ b/plone/app/iterate/profiles/uninstall/actions.xml\n@@ -1,9 +1,19 @@\n-<?xml version="1.0"?>\n-<object name="portal_actions" meta_type="Plone Actions Tool"\n-        xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n-  <object name="object_buttons" meta_type="CMF Action Category">\n-    <object name="iterate_checkin" remove="true" />\n-    <object name="iterate_checkout" remove="true" />\n-    <object name="iterate_checkout_cancel" remove="true" />\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Plone Actions Tool"\n+        name="portal_actions"\n+>\n+  <object meta_type="CMF Action Category"\n+          name="object_buttons"\n+  >\n+    <object name="iterate_checkin"\n+            remove="true"\n+    />\n+    <object name="iterate_checkout"\n+            remove="true"\n+    />\n+    <object name="iterate_checkout_cancel"\n+            remove="true"\n+    />\n   </object>\n </object>\ndiff --git a/plone/app/iterate/profiles/uninstall/metadata.xml b/plone/app/iterate/profiles/uninstall/metadata.xml\nindex b22370d..f768b5a 100644\n--- a/plone/app/iterate/profiles/uninstall/metadata.xml\n+++ b/plone/app/iterate/profiles/uninstall/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>1000</version>\n </metadata>\ndiff --git a/plone/app/iterate/profiles/uninstall/registry.xml b/plone/app/iterate/profiles/uninstall/registry.xml\nindex bbe11b4..360c80e 100644\n--- a/plone/app/iterate/profiles/uninstall/registry.xml\n+++ b/plone/app/iterate/profiles/uninstall/registry.xml\n@@ -1,4 +1,6 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n-    <records interface="plone.app.iterate.interfaces.IIterateSettings" remove="true" />\n+  <records interface="plone.app.iterate.interfaces.IIterateSettings"\n+           remove="true"\n+  />\n </registry>\ndiff --git a/plone/app/iterate/setuphandlers.py b/plone/app/iterate/setuphandlers.py\nindex 0f6a18b..f69a2fa 100644\n--- a/plone/app/iterate/setuphandlers.py\n+++ b/plone/app/iterate/setuphandlers.py\n@@ -1,20 +1,19 @@\n-# -*- coding: utf-8 -*-\n-from Products.CMFPlone.interfaces import INonInstallable\n+from plone.base.interfaces.installable import INonInstallable\n from zope.interface import implementer\n \n import warnings\n \n \n @implementer(INonInstallable)\n-class HiddenProfiles(object):\n+class HiddenProfiles:\n     def getNonInstallableProfiles(self):\n         """Prevents uninstall profile from showing up in the profile list\n         when creating a Plone site.\n \n         """\n         return [\n-            u"plone.app.iterate:uninstall",\n-            u"plone.app.iterate:plone.app.iterate",\n+            "plone.app.iterate:uninstall",\n+            "plone.app.iterate:plone.app.iterate",\n         ]\n \n \ndiff --git a/plone/app/iterate/subscribers/__init__.py b/plone/app/iterate/subscribers/__init__.py\nindex c7134b8..e69de29 100644\n--- a/plone/app/iterate/subscribers/__init__.py\n+++ b/plone/app/iterate/subscribers/__init__.py\n@@ -1,2 +0,0 @@\n-# -*- coding: utf-8 -*-\n-# $Id: __init__.py 1808 2007-02-06 11:39:11Z hazmat $\ndiff --git a/plone/app/iterate/subscribers/configure.zcml b/plone/app/iterate/subscribers/configure.zcml\nindex ecdc378..e9c4ce7 100644\n--- a/plone/app/iterate/subscribers/configure.zcml\n+++ b/plone/app/iterate/subscribers/configure.zcml\n@@ -1,82 +1,81 @@\n-<configure\n-    xmlns="http://namespaces.zope.org/zope">\n+<configure xmlns="http://namespaces.zope.org/zope">\n \n \n-    <!-- Locking -->\n+  <!-- Locking -->\n \n-    <subscriber\n-       for="..interfaces.ICheckoutEvent"\n-       handler=".locking.handleCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckoutEvent"\n+      handler=".locking.handleCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.ICheckinEvent"\n-       handler=".locking.handleCheckin"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckinEvent"\n+      handler=".locking.handleCheckin"\n+      />\n \n-    <subscriber\n-       for="..interfaces.ICancelCheckoutEvent"\n-       handler=".locking.handleCancelCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICancelCheckoutEvent"\n+      handler=".locking.handleCancelCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.IWorkingCopyDeletedEvent"\n-       handler=".locking.handleWCDeleted"\n-       />\n+  <subscriber\n+      for="..interfaces.IWorkingCopyDeletedEvent"\n+      handler=".locking.handleWCDeleted"\n+      />\n \n-    <!-- Marker  -->\n+  <!-- Marker  -->\n \n-    <subscriber\n-       for="..interfaces.ICheckoutEvent"\n-       handler=".marker.handleCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckoutEvent"\n+      handler=".marker.handleCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.ICheckinEvent"\n-       handler=".marker.handleCheckin"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckinEvent"\n+      handler=".marker.handleCheckin"\n+      />\n \n-    <subscriber\n-       for="..interfaces.ICancelCheckoutEvent"\n-       handler=".marker.handleCancelCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICancelCheckoutEvent"\n+      handler=".marker.handleCancelCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.IWorkingCopyDeletedEvent"\n-       handler=".marker.handleWCDeleted"\n-       />\n+  <subscriber\n+      for="..interfaces.IWorkingCopyDeletedEvent"\n+      handler=".marker.handleWCDeleted"\n+      />\n \n \n-    <!-- Metadata -->\n+  <!-- Metadata -->\n \n-    <subscriber\n-       for="..interfaces.ICheckoutEvent"\n-       handler=".metadata.handleCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckoutEvent"\n+      handler=".metadata.handleCheckout"\n+      />\n \n-    <!-- Versioning -->\n+  <!-- Versioning -->\n \n-    <subscriber\n-       for="..interfaces.IBeforeCheckoutEvent"\n-       handler=".versioning.handleBeforeCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.IBeforeCheckoutEvent"\n+      handler=".versioning.handleBeforeCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.IAfterCheckinEvent"\n-       handler=".versioning.handleAfterCheckin"\n-       />\n+  <subscriber\n+      for="..interfaces.IAfterCheckinEvent"\n+      handler=".versioning.handleAfterCheckin"\n+      />\n \n \n-    <!-- Workflow -->\n+  <!-- Workflow -->\n \n-    <subscriber\n-       for="..interfaces.ICheckoutEvent"\n-       handler=".workflow.handleCheckout"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckoutEvent"\n+      handler=".workflow.handleCheckout"\n+      />\n \n-    <subscriber\n-       for="..interfaces.ICheckinEvent"\n-       handler=".workflow.handleCheckin"\n-       />\n+  <subscriber\n+      for="..interfaces.ICheckinEvent"\n+      handler=".workflow.handleCheckin"\n+      />\n \n </configure>\ndiff --git a/plone/app/iterate/subscribers/locking.py b/plone/app/iterate/subscribers/locking.py\nindex 851b5a8..1acfb49 100644\n--- a/plone/app/iterate/subscribers/locking.py\n+++ b/plone/app/iterate/subscribers/locking.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\n@@ -20,10 +19,6 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-$Id: locking.py 1824 2007-02-08 17:59:41Z hazmat $\n-"""\n-\n from plone.app.iterate import lock\n from plone.locking.interfaces import ILockable\n \ndiff --git a/plone/app/iterate/subscribers/marker.py b/plone/app/iterate/subscribers/marker.py\nindex 53d0ba8..fb294ea 100644\n--- a/plone/app/iterate/subscribers/marker.py\n+++ b/plone/app/iterate/subscribers/marker.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\n@@ -20,10 +19,6 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-$Id: marker.py 1824 2007-02-08 17:59:41Z hazmat $\n-"""\n-\n from plone.app.iterate import interfaces\n from Products.Five.utilities import marker\n \ndiff --git a/plone/app/iterate/subscribers/metadata.py b/plone/app/iterate/subscribers/metadata.py\nindex 61edcfb..dce208b 100644\n--- a/plone/app/iterate/subscribers/metadata.py\n+++ b/plone/app/iterate/subscribers/metadata.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\n@@ -20,10 +19,6 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-$Id: metadata.py 1824 2007-02-08 17:59:41Z hazmat $\n-"""\n-\n from AccessControl import getSecurityManager\n from DateTime import DateTime\n from plone.app.iterate.interfaces import keys\ndiff --git a/plone/app/iterate/subscribers/versioning.py b/plone/app/iterate/subscribers/versioning.py\nindex 027f60e..470824d 100644\n--- a/plone/app/iterate/subscribers/versioning.py\n+++ b/plone/app/iterate/subscribers/versioning.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\n@@ -20,9 +19,6 @@\n # along with CMFDeployment; if not, write to the Free Software\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n-"""\n-"""\n-\n from plone.app.iterate import interfaces\n \n \ndiff --git a/plone/app/iterate/subscribers/workflow.py b/plone/app/iterate/subscribers/workflow.py\nindex bce937a..37f3022 100644\n--- a/plone/app/iterate/subscribers/workflow.py\n+++ b/plone/app/iterate/subscribers/workflow.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\n@@ -21,22 +20,15 @@\n # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n ##################################################################\n """\n-$Id: workflow.py 1824 2007-02-08 17:59:41Z hazmat $\n-\n Applies new checkout specific workflows to content that is checked out.\n-\n """\n \n from Acquisition import aq_base\n from plone.app.iterate.interfaces import IIterateSettings\n from plone.app.iterate.util import get_storage\n from plone.registry.interfaces import IRegistry\n-from Products.CMFPlacefulWorkflow.PlacefulWorkflowTool import (\n-    WorkflowPolicyConfig_id,\n-)  # noqa\n-from Products.CMFPlacefulWorkflow.WorkflowPolicyConfig import (\n-    WorkflowPolicyConfig,\n-)  # noqa\n+from Products.CMFPlacefulWorkflow.PlacefulWorkflowTool import WorkflowPolicyConfig_id\n+from Products.CMFPlacefulWorkflow.WorkflowPolicyConfig import WorkflowPolicyConfig\n from zope.component import getUtility\n \n \ndiff --git a/plone/app/iterate/testing.py b/plone/app/iterate/testing.py\nindex 1a40805..85a209c 100644\n--- a/plone/app/iterate/testing.py\n+++ b/plone/app/iterate/testing.py\n@@ -1,8 +1,6 @@\n """Testing setup for integration and functional tests."""\n from plone.app.contenttypes.testing import PloneAppContenttypes\n from plone.app.testing import applyProfile\n-from plone.app.testing import PLONE_FIXTURE\n-from plone.app.testing import PloneSandboxLayer\n from plone.app.testing.layers import FunctionalTesting\n from plone.app.testing.layers import IntegrationTesting\n \n@@ -38,7 +36,7 @@ class DexPloneAppIterateLayer(PloneAppContenttypes):\n \n     def setUpZope(self, app, configurationContext):\n         """Setup Zope with Addons."""\n-        super(DexPloneAppIterateLayer, self).setUpZope(app, configurationContext)\n+        super().setUpZope(app, configurationContext)\n \n         import plone.app.iterate\n \n@@ -46,16 +44,14 @@ def setUpZope(self, app, configurationContext):\n \n     def setUpPloneSite(self, portal):\n         """Setup Plone Site with Addons."""\n-        super(DexPloneAppIterateLayer, self).setUpPloneSite(portal)\n+        super().setUpPloneSite(portal)\n         applyProfile(portal, "plone.app.iterate:default")\n         applyProfile(portal, "plone.app.iterate:testingdx")\n         # with named AND dotted behaviors we need to take care of both\n-        versioning_behavior = set(\n-            [\n-                "plone.app.versioningbehavior.behaviors.IVersionable",\n-                "plone.versioning",\n-            ],\n-        )\n+        versioning_behavior = {\n+            "plone.app.versioningbehavior.behaviors.IVersionable",\n+            "plone.versioning",\n+        }\n \n         # Disable automatic versioning of core content types\n         for name in ("Document", "Event", "Link", "News Item"):\ndiff --git a/plone/app/iterate/tests/__init__.py b/plone/app/iterate/tests/__init__.py\nindex ec51c5a..792d600 100644\n--- a/plone/app/iterate/tests/__init__.py\n+++ b/plone/app/iterate/tests/__init__.py\n@@ -1,2 +1 @@\n-# -*- coding: utf-8 -*-\n #\ndiff --git a/plone/app/iterate/tests/dexterity.rst b/plone/app/iterate/tests/dexterity.rst\nindex 2ef8281..67ff0bd 100644\n--- a/plone/app/iterate/tests/dexterity.rst\n+++ b/plone/app/iterate/tests/dexterity.rst\n@@ -13,11 +13,11 @@ If we access the site as an admin TTW::\n     >>> from plone.app.testing.interfaces import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n     >>> browser.addHeader("Authorization", "Basic %s:%s" % (SITE_OWNER_NAME, SITE_OWNER_PASSWORD))\n \n-KeyError with aquisition wrapper\n+KeyError with acquisition wrapper\n =========================================\n \n When an item provides IBaseline (has been checked in at least once) and it is accessed through an\n-Aquisition wrapper you get a KeyError from zope.intid, originating from five.intid.\n+Acquisition wrapper you get a KeyError from zope.intid, originating from five.intid.\n \n     >>> browser.open(portal_url + "/folder_factories")\n     >>> browser.getControl("Folder").click()\n@@ -53,7 +53,7 @@ Checkin\n     >>> browser.url\n     \'http://nohost/plone/my-folder/my-sub-object\'\n \n-Test can view through Aquisition wrapper (repeating test_folder is deliberate here)\n+Test can view through Acquisition wrapper (repeating test_folder is deliberate here)\n \n     >>> browser.open("http://nohost/plone/my-folder/my-sub-object")\n     >>> browser.contents\ndiff --git a/plone/app/iterate/tests/dxtypes.py b/plone/app/iterate/tests/dxtypes.py\nindex d354fa2..6687e19 100644\n--- a/plone/app/iterate/tests/dxtypes.py\n+++ b/plone/app/iterate/tests/dxtypes.py\n@@ -1,8 +1,7 @@\n-# -*- coding: utf-8 -*-\n-from plone.dexterity.content import Container\n from plone.app.contenttypes.interfaces import IDocument\n-from zope.interface import Interface\n+from plone.dexterity.content import Container\n from zope.interface import implementer\n+from zope.interface import Interface\n \n \n class IFolderishDocument(Interface):\ndiff --git a/plone/app/iterate/tests/test_annotations.py b/plone/app/iterate/tests/test_annotations.py\nindex e18cd45..36b7d48 100644\n--- a/plone/app/iterate/tests/test_annotations.py\n+++ b/plone/app/iterate/tests/test_annotations.py\n@@ -1,5 +1,3 @@\n-# -*- coding: utf-8 -*-\n-\n from plone.app.iterate.interfaces import ICheckinCheckoutPolicy\n from plone.app.iterate.interfaces import IWCContainerLocator\n from plone.app.iterate.testing import PLONEAPPITERATEDEX_INTEGRATION_TESTING\n@@ -13,7 +11,6 @@\n \n \n class AnnotationsTestCase(unittest.TestCase):\n-\n     layer = PLONEAPPITERATEDEX_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -30,13 +27,13 @@ def test_annotation_saved_on_checkin(self):\n         obj_annotations = IAnnotations(self.s1)\n         self.assertEqual(obj_annotations, {})\n \n-        obj_annotations["key1"] = u"value1"\n+        obj_annotations["key1"] = "value1"\n         obj_annotations = IAnnotations(self.s1)\n-        self.assertEqual(obj_annotations, {"key1": u"value1"})\n+        self.assertEqual(obj_annotations, {"key1": "value1"})\n \n         # Now, let\'s get a working copy for it.\n         locators = getAdapters((self.s1,), IWCContainerLocator)\n-        location = u"plone.app.iterate.parent"\n+        location = "plone.app.iterate.parent"\n         locator = [c[1] for c in locators if c[0] == location][0]\n \n         policy = ICheckinCheckoutPolicy(self.s1)\n@@ -45,25 +42,25 @@ def test_annotation_saved_on_checkin(self):\n \n         # Annotations should be the same\n         new_annotations = IAnnotations(wc)\n-        self.assertEqual(new_annotations["key1"], u"value1")\n+        self.assertEqual(new_annotations["key1"], "value1")\n \n         # Now, let\'s modify the existing one, and create a new one\n-        new_annotations["key1"] = u"value2"\n-        new_annotations["key2"] = u"value1"\n+        new_annotations["key1"] = "value2"\n+        new_annotations["key2"] = "value1"\n \n         # Check that annotations were stored correctly and original ones were\n         # not overriten\n         new_annotations = IAnnotations(wc)\n-        self.assertEqual(new_annotations["key1"], u"value2")\n-        self.assertEqual(new_annotations["key2"], u"value1")\n+        self.assertEqual(new_annotations["key1"], "value2")\n+        self.assertEqual(new_annotations["key2"], "value1")\n \n         obj_annotations = IAnnotations(self.s1)\n-        self.assertEqual(obj_annotations["key1"], u"value1")\n+        self.assertEqual(obj_annotations["key1"], "value1")\n         self.assertFalse("key2" in obj_annotations)\n \n         # Now, we do a checkin\n         policy = ICheckinCheckoutPolicy(wc)\n-        policy.checkin(u"Commit message")\n+        policy.checkin("Commit message")\n \n         # And finally check that the old object has the same annotations as\n         # its working copy\n@@ -71,5 +68,5 @@ def test_annotation_saved_on_checkin(self):\n         obj_annotations = IAnnotations(self.s1)\n         self.assertTrue("key1" in obj_annotations)\n         self.assertTrue("key2" in obj_annotations)\n-        self.assertEqual(obj_annotations["key1"], u"value2")\n-        self.assertEqual(obj_annotations["key2"], u"value1")\n+        self.assertEqual(obj_annotations["key1"], "value2")\n+        self.assertEqual(obj_annotations["key2"], "value1")\ndiff --git a/plone/app/iterate/tests/test_containers.py b/plone/app/iterate/tests/test_containers.py\nindex 12ad18c..f295f3a 100644\n--- a/plone/app/iterate/tests/test_containers.py\n+++ b/plone/app/iterate/tests/test_containers.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -29,16 +28,15 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n+from plone.dexterity.utils import createContentInContainer\n from zc.relation.interfaces import ICatalog\n-from zope.intid.interfaces import IIntIds\n from zope import component\n-from plone.dexterity.utils import createContentInContainer\n+from zope.intid.interfaces import IIntIds\n \n import unittest\n \n \n class TestIterations(unittest.TestCase):\n-\n     layer = PLONEAPPITERATEDEX_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -89,7 +87,7 @@ def test_container_workflowState(self):\n         bstate = self.wf.getInfoFor(baseline, "review_state")\n         self.assertEqual(bstate, "published")\n \n-        self.assertEquals(len(self.portal.workarea.objectIds()), 0)\n+        self.assertEqual(len(self.portal.workarea.objectIds()), 0)\n         setRoles(self.portal, TEST_USER_ID, ["Owner"])\n \n     def test_container_baselineCreated(self):\n@@ -99,7 +97,7 @@ def test_container_baselineCreated(self):\n \n         wc = ICheckinCheckoutPolicy(doc).checkout(self.portal.workarea)\n \n-        self.assertEquals(wc.id, "working_copy_of_doc1")\n+        self.assertEqual(wc.id, "working_copy_of_doc1")\n         self.assertIn("working_copy_of_doc1", self.portal.workarea.objectIds())\n \n     def test_container_folderOrder(self):\n@@ -202,9 +200,7 @@ def test_container_default_page_is_kept_in_folder(self):\n         # the default page.\n         folder = self.portal.docs\n         doc = folder.doc1\n-        from Products.CMFDynamicViewFTI.interfaces import (\n-            ISelectableBrowserDefault,\n-        )  # noqa: C901\n+        from Products.CMFDynamicViewFTI.interfaces import ISelectableBrowserDefault\n \n         ISelectableBrowserDefault(folder).setDefaultPage("doc1")\n         self.assertEqual(folder.getProperty("default_page", ""), "doc1")\ndiff --git a/plone/app/iterate/tests/test_interfaces.py b/plone/app/iterate/tests/test_interfaces.py\nindex f921b18..29be11a 100644\n--- a/plone/app/iterate/tests/test_interfaces.py\n+++ b/plone/app/iterate/tests/test_interfaces.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from plone.app.iterate.interfaces import IBaseline\n from plone.app.iterate.interfaces import ICheckinCheckoutPolicy\n from plone.app.iterate.interfaces import IIterateAware\n@@ -27,7 +26,7 @@ class TestObjectsProvideCorrectInterfaces(TestCase):\n     layer = PLONEAPPITERATEDEX_INTEGRATION_TESTING\n \n     def setUp(self):\n-        super(TestObjectsProvideCorrectInterfaces, self).setUp()\n+        super().setUp()\n \n         self.portal = self.layer["portal"]\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n@@ -45,7 +44,7 @@ def tearDown(self):\n         self.portal.manage_delObjects([self.folder.id])\n         logout()\n         setRoles(self.portal, TEST_USER_ID, ["Member"])\n-        super(TestObjectsProvideCorrectInterfaces, self).tearDown()\n+        super().tearDown()\n \n     def do_checkout(self):\n         policy = ICheckinCheckoutPolicy(self.obj)\ndiff --git a/plone/app/iterate/tests/test_iterate.py b/plone/app/iterate/tests/test_iterate.py\nindex ecb4125..93b9397 100644\n--- a/plone/app/iterate/tests/test_iterate.py\n+++ b/plone/app/iterate/tests/test_iterate.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006 ObjectRealms, LLC\n@@ -30,14 +29,13 @@\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n from zc.relation.interfaces import ICatalog\n-from zope.intid.interfaces import IIntIds\n from zope import component\n+from zope.intid.interfaces import IIntIds\n \n import unittest\n \n \n class TestIterations(unittest.TestCase):\n-\n     layer = PLONEAPPITERATEDEX_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -110,9 +108,7 @@ def test_default_page_is_kept_in_folder(self):\n         # the default page.\n         folder = self.portal.docs\n         doc = folder.doc1\n-        from Products.CMFDynamicViewFTI.interfaces import (\n-            ISelectableBrowserDefault,\n-        )  # noqa: C901\n+        from Products.CMFDynamicViewFTI.interfaces import ISelectableBrowserDefault\n \n         ISelectableBrowserDefault(folder).setDefaultPage("doc1")\n         self.assertEqual(folder.getProperty("default_page", ""), "doc1")\n@@ -220,9 +216,9 @@ def test_relationship_deleted_on_cancel_checkout(self):\n     def test_baseline_relations_updated_on_checkin(self):\n         # Ensure that relations between the baseline and\n         # and other objects are up-to-date on checkin\n+        from z3c.relationfield import RelationValue\n         from zope.event import notify\n         from zope.lifecycleevent import ObjectModifiedEvent\n-        from z3c.relationfield import RelationValue\n \n         folder = self.portal.docs\n         baseline = folder.doc1\ndiff --git a/plone/app/iterate/util.py b/plone/app/iterate/util.py\nindex fac5e9a..6a8af6f 100644\n--- a/plone/app/iterate/util.py\n+++ b/plone/app/iterate/util.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n ##################################################################\n #\n # (C) Copyright 2006-2007 ObjectRealms, LLC\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615d..75d8543 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,46 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\n+\n+[tool.codespell]\n+ignore-words-list = "ore"\ndiff --git a/setup.cfg b/setup.cfg\nindex c1ffe14..0da8f8f 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,7 +1,23 @@\n-[check-manifest]\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[bdist_wheel]\n+universal = 0\n+\n+[flake8]\n+doctests = 1\n ignore =\n-    *.cfg\n-    bootstrap.py\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n \n-[bdist_wheel]\n-universal = 1\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/setup.py b/setup.py\nindex b7aea84..94d7c69 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from setuptools import find_packages\n from setuptools import setup\n \n@@ -41,7 +40,6 @@\n         "DateTime",\n         "plone.locking",\n         "plone.memoize",\n-        "Products.CMFCore",\n         "Products.CMFEditions",\n         "Products.CMFPlacefulWorkflow",\n         "Products.DCWorkflow",\n@@ -56,12 +54,19 @@\n         "zope.lifecycleevent",\n         "zope.schema",\n         "zope.viewlet",\n+        "persistent",\n+        "plone.base",\n+        "plone.dexterity",\n+        "plone.registry",\n+        "z3c.relationfield",\n+        "zc.relation",\n+        "zope.intid",\n     ],\n     extras_require={\n         "test": [\n             "plone.app.testing",\n-            "plone.app.contenttypes",\n-            "plone.app.robotframework",\n+            "plone.app.contenttypes[test]",\n+            "plone.testing",\n         ],\n     },\n     entry_points="""\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 0000000..88b1534\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,54 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --all --test-path={toxinidir} -s plone.app.iterate {posargs}\n+extras =\n+    test\n'

