Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2019-10-01T16:14:28+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/d7837ea9b173f08dd58bf3bf0aaf2426552c53a2

proactive clear schema cache to avoid side effects with cached ftis

Files changed:
A news/531.bugfix
M plone/app/contenttypes/migration/dxmigration.py

b'diff --git a/news/531.bugfix b/news/531.bugfix\nnew file mode 100644\nindex 00000000..72354ad7\n--- /dev/null\n+++ b/news/531.bugfix\n@@ -0,0 +1 @@\n+Clear schema cache after migration step ``migrate_to_pa_event``. [jensens]\n\\ No newline at end of file\ndiff --git a/plone/app/contenttypes/migration/dxmigration.py b/plone/app/contenttypes/migration/dxmigration.py\nindex 25e24a25..b356ddbd 100644\n--- a/plone/app/contenttypes/migration/dxmigration.py\n+++ b/plone/app/contenttypes/migration/dxmigration.py\n@@ -3,6 +3,7 @@\n from plone.app.contenttypes.migration.field_migrators import datetime_fixer\n from plone.dexterity.interfaces import IDexterityContent\n from plone.dexterity.interfaces import IDexterityFTI\n+from plone.dexterity.schema import SCHEMA_CACHE\n from plone.event.utils import default_timezone\n from plone.folder.interfaces import IOrdering\n from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2Base\n@@ -47,6 +48,7 @@ def migrate_to_pa_event(context):\n     )\n     portal = getSite()\n     migrate(portal, DXOldEventMigrator)\n+    SCHEMA_CACHE.clear()\n \n \n class DXOldEventMigrator(ContentMigrator):\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2019-10-01T19:45:10+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/bce2072705d7e10f57b083c6e3cb538400c73865

Merge pull request #531 from plone/jensens-clear-schema-cache-2

proactive clear schema cache to avoid side effects with cached ftis

Files changed:
A news/531.bugfix
M plone/app/contenttypes/migration/dxmigration.py

b'diff --git a/news/531.bugfix b/news/531.bugfix\nnew file mode 100644\nindex 00000000..72354ad7\n--- /dev/null\n+++ b/news/531.bugfix\n@@ -0,0 +1 @@\n+Clear schema cache after migration step ``migrate_to_pa_event``. [jensens]\n\\ No newline at end of file\ndiff --git a/plone/app/contenttypes/migration/dxmigration.py b/plone/app/contenttypes/migration/dxmigration.py\nindex 25e24a25..b356ddbd 100644\n--- a/plone/app/contenttypes/migration/dxmigration.py\n+++ b/plone/app/contenttypes/migration/dxmigration.py\n@@ -3,6 +3,7 @@\n from plone.app.contenttypes.migration.field_migrators import datetime_fixer\n from plone.dexterity.interfaces import IDexterityContent\n from plone.dexterity.interfaces import IDexterityFTI\n+from plone.dexterity.schema import SCHEMA_CACHE\n from plone.event.utils import default_timezone\n from plone.folder.interfaces import IOrdering\n from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2Base\n@@ -47,6 +48,7 @@ def migrate_to_pa_event(context):\n     )\n     portal = getSite()\n     migrate(portal, DXOldEventMigrator)\n+    SCHEMA_CACHE.clear()\n \n \n class DXOldEventMigrator(ContentMigrator):\n'

