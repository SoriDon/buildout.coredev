Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-10-23T17:46:28+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/5a852f97c4c98cd16921e8db266b28e493148fbe

Removed generateUniqueId.py skins script

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testNavigationView.py
D Products/CMFPlone/skins/plone_scripts/generateUniqueId.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 3ab206f5f..eb017f23b 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,6 +10,11 @@ Changelog\n \n Breaking changes:\n \n+- Removed generateUniqueId.py skins script (after it was added to Products.Archetypes).\n+  This script is no longer available outside Archetypes world.\n+  #1801\n+  [jensens]\n+\n - Remove all dependencies on plone.app.controlpanel.\n   Third party code need either to depend on plone.app.controlpanel 4.0,\n   which is a backward compatibility package only, or also update to not depend on it anymore.\n@@ -27,7 +32,7 @@ Breaking changes:\n \n - Removed isExpired.py skin script. #1801\n   [reinhardt]\n-  \n+\n - Removed redirectToReferrer.py skin script. #1801\n   [tlotze]\n \n@@ -74,7 +79,7 @@ Bug fixes:\n \n - remove plone.app.folder dependency\n   [petschki]\n-  \n+\n - move GopipIndex Class to plone.folder\n   [petschki]\n \ndiff --git a/Products/CMFPlone/skins/plone_scripts/generateUniqueId.py b/Products/CMFPlone/skins/plone_scripts/generateUniqueId.py\ndeleted file mode 100644\nindex da3abd0f3..000000000\n--- a/Products/CMFPlone/skins/plone_scripts/generateUniqueId.py\n+++ /dev/null\n@@ -1,23 +0,0 @@\n-## Script (Python) "generateUniqueId"\n-##bind container=container\n-##bind context=context\n-##bind namespace=\n-##bind script=script\n-##bind subpath=traverse_subpath\n-##parameters=type_name=None\n-##title=\n-\n-from DateTime import DateTime\n-from random import random\n-\n-now = DateTime()\n-time = \'%s.%s\' % (now.strftime(\'%Y-%m-%d\'), str(now.millis())[7:])\n-rand = str(random())[2:6]\n-prefix = \'\'\n-suffix = \'\'\n-\n-if type_name is not None:\n-    prefix = type_name.replace(\' \', \'_\') + \'.\'\n-prefix = prefix.lower()\n-\n-return prefix + time + rand + suffix\ndiff --git a/Products/CMFPlone/tests/testNavigationView.py b/Products/CMFPlone/tests/testNavigationView.py\nindex 3108e4417..7c2080a90 100644\n--- a/Products/CMFPlone/tests/testNavigationView.py\n+++ b/Products/CMFPlone/tests/testNavigationView.py\n@@ -14,6 +14,9 @@\n from zope.component import getUtility\n from zope.interface import directlyProvides\n \n+import random\n+import string\n+\n portal_name = PloneTestCase.portal_name\n \n \n@@ -181,10 +184,12 @@ def testTopLevelWithNavigationRoot(self):\n                          \'/plone/folder2/folder21/doc211\')\n \n     def testTopLevelWithPortalFactory(self):\n-        id = self.portal.generateUniqueId(\'Document\')\n+        cid = \'\'.join(\n+            [random.choice(string.ascii_lowercase) for x in range(10)]\n+        )\n         typeName = \'Document\'\n         newObject = self.portal.folder1.restrictedTraverse(\n-            \'portal_factory/\' + typeName + \'/\' + id)\n+            \'portal_factory/\' + typeName + \'/\' + cid)\n         # Will raise a KeyError unless bug is fixed\n         view = self.view_class(newObject, self.request)\n         view.navigationTree()\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-10-24T09:31:12+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/f80809340cb8263ed5a217d8f311e26b2c98d1ef

Merge pull request #2600 from plone/1801-rm-generate-unique-id

Removed generateUniqueId.py skins script

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testNavigationView.py
D Products/CMFPlone/skins/plone_scripts/generateUniqueId.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 3ab206f5f..eb017f23b 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,6 +10,11 @@ Changelog\n \n Breaking changes:\n \n+- Removed generateUniqueId.py skins script (after it was added to Products.Archetypes).\n+  This script is no longer available outside Archetypes world.\n+  #1801\n+  [jensens]\n+\n - Remove all dependencies on plone.app.controlpanel.\n   Third party code need either to depend on plone.app.controlpanel 4.0,\n   which is a backward compatibility package only, or also update to not depend on it anymore.\n@@ -27,7 +32,7 @@ Breaking changes:\n \n - Removed isExpired.py skin script. #1801\n   [reinhardt]\n-  \n+\n - Removed redirectToReferrer.py skin script. #1801\n   [tlotze]\n \n@@ -74,7 +79,7 @@ Bug fixes:\n \n - remove plone.app.folder dependency\n   [petschki]\n-  \n+\n - move GopipIndex Class to plone.folder\n   [petschki]\n \ndiff --git a/Products/CMFPlone/skins/plone_scripts/generateUniqueId.py b/Products/CMFPlone/skins/plone_scripts/generateUniqueId.py\ndeleted file mode 100644\nindex da3abd0f3..000000000\n--- a/Products/CMFPlone/skins/plone_scripts/generateUniqueId.py\n+++ /dev/null\n@@ -1,23 +0,0 @@\n-## Script (Python) "generateUniqueId"\n-##bind container=container\n-##bind context=context\n-##bind namespace=\n-##bind script=script\n-##bind subpath=traverse_subpath\n-##parameters=type_name=None\n-##title=\n-\n-from DateTime import DateTime\n-from random import random\n-\n-now = DateTime()\n-time = \'%s.%s\' % (now.strftime(\'%Y-%m-%d\'), str(now.millis())[7:])\n-rand = str(random())[2:6]\n-prefix = \'\'\n-suffix = \'\'\n-\n-if type_name is not None:\n-    prefix = type_name.replace(\' \', \'_\') + \'.\'\n-prefix = prefix.lower()\n-\n-return prefix + time + rand + suffix\ndiff --git a/Products/CMFPlone/tests/testNavigationView.py b/Products/CMFPlone/tests/testNavigationView.py\nindex 3108e4417..7c2080a90 100644\n--- a/Products/CMFPlone/tests/testNavigationView.py\n+++ b/Products/CMFPlone/tests/testNavigationView.py\n@@ -14,6 +14,9 @@\n from zope.component import getUtility\n from zope.interface import directlyProvides\n \n+import random\n+import string\n+\n portal_name = PloneTestCase.portal_name\n \n \n@@ -181,10 +184,12 @@ def testTopLevelWithNavigationRoot(self):\n                          \'/plone/folder2/folder21/doc211\')\n \n     def testTopLevelWithPortalFactory(self):\n-        id = self.portal.generateUniqueId(\'Document\')\n+        cid = \'\'.join(\n+            [random.choice(string.ascii_lowercase) for x in range(10)]\n+        )\n         typeName = \'Document\'\n         newObject = self.portal.folder1.restrictedTraverse(\n-            \'portal_factory/\' + typeName + \'/\' + id)\n+            \'portal_factory/\' + typeName + \'/\' + cid)\n         # Will raise a KeyError unless bug is fixed\n         view = self.view_class(newObject, self.request)\n         view.navigationTree()\n'

