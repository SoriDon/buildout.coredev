Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-09-27T13:40:19+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.restapi/commit/333802b97dc38c2a8f972fdc78b6986a9a519eac

No longer hardcode ZSERVER_PORT to 55001 in tests.

This is no longer needed, since we update normalize the http-examples output in test_documentation.py.
Also, without hardcoded port, it becomes possible to introduce tox and run it in parallel, if we want.

Files changed:
M base.cfg

b"diff --git a/base.cfg b/base.cfg\nindex 75e631dc7..1426235b3 100644\n--- a/base.cfg\n+++ b/base.cfg\n@@ -72,7 +72,6 @@ initialization =\n     # necessary to explicitly call time.tzset().\n     import time\n     time.tzset()\n-    os.environ['ZSERVER_PORT'] = '55001'\n defaults = ['-s', 'plone.restapi', '--auto-color', '--auto-progress']\n \n [test-coverage]\n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-09-27T13:43:30+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.restapi/commit/0b699ea4ba2093e50dda033f9f0e660acc6338b4

http-examples: normalize unstable behavior name to look like the new expected name.

Uglier, but closer to reality.

Files changed:
A news/1226.bugfix
M src/plone/restapi/tests/http-examples/types_document.resp
M src/plone/restapi/tests/http-examples/types_document_get_field.resp
M src/plone/restapi/tests/http-examples/types_document_post_field.resp
M src/plone/restapi/tests/http-examples/types_document_put.req
M src/plone/restapi/tests/test_documentation.py

b'diff --git a/news/1226.bugfix b/news/1226.bugfix\nnew file mode 100644\nindex 000000000..68f15065b\n--- /dev/null\n+++ b/news/1226.bugfix\n@@ -0,0 +1,3 @@\n+Normalize unstable generated behavior names in http-examples output.\n+No longer hardcode port 55001 for the tests.\n+[maurits]\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/tests/http-examples/types_document.resp b/src/plone/restapi/tests/http-examples/types_document.resp\nindex 36fbd264a..ddb61a645 100644\n--- a/src/plone/restapi/tests/http-examples/types_document.resp\n+++ b/src/plone/restapi/tests/http-examples/types_document.resp\n@@ -97,7 +97,7 @@ Content-Type: application/json+schema\n             }\n         },\n         "author_email": {\n-            "behavior": "plone.dexterity.schema.generated.plone_0_Document",\n+            "behavior": "plone.dexterity.schema.generated.plone_5_1234567890_2_123456_0_Document",\n             "description": "Email of the author",\n             "factory": "Email",\n             "title": "Author email",\ndiff --git a/src/plone/restapi/tests/http-examples/types_document_get_field.resp b/src/plone/restapi/tests/http-examples/types_document_get_field.resp\nindex c328ab6a4..de919785e 100644\n--- a/src/plone/restapi/tests/http-examples/types_document_get_field.resp\n+++ b/src/plone/restapi/tests/http-examples/types_document_get_field.resp\n@@ -2,7 +2,7 @@ HTTP/1.1 200 OK\n Content-Type: application/json\n \n {\n-    "behavior": "plone.dexterity.schema.generated.plone_0_Document",\n+    "behavior": "plone.dexterity.schema.generated.plone_5_1234567890_2_123456_0_Document",\n     "description": "Email of the author",\n     "factory": "Email",\n     "title": "Author email",\ndiff --git a/src/plone/restapi/tests/http-examples/types_document_post_field.resp b/src/plone/restapi/tests/http-examples/types_document_post_field.resp\nindex 7f142efe0..16caa7dfe 100644\n--- a/src/plone/restapi/tests/http-examples/types_document_post_field.resp\n+++ b/src/plone/restapi/tests/http-examples/types_document_post_field.resp\n@@ -2,7 +2,7 @@ HTTP/1.1 201 Created\n Content-Type: application/json\n \n {\n-    "behavior": "plone.dexterity.schema.generated.plone_0_Document",\n+    "behavior": "plone.dexterity.schema.generated.plone_5_1234567890_2_123456_0_Document",\n     "description": "Email of the author",\n     "factory": "Email",\n     "title": "Author email",\ndiff --git a/src/plone/restapi/tests/http-examples/types_document_put.req b/src/plone/restapi/tests/http-examples/types_document_put.req\nindex 22a316388..423676245 100644\n--- a/src/plone/restapi/tests/http-examples/types_document_put.req\n+++ b/src/plone/restapi/tests/http-examples/types_document_put.req\n@@ -54,7 +54,7 @@ Content-Type: application/json\n             }\n         },\n         "author_email": {\n-            "behavior": "plone.dexterity.schema.generated.plone_0_Document",\n+            "behavior": "plone.dexterity.schema.generated.plone_5_1234567890_2_123456_0_Document",\n             "description": "Email of the author",\n             "factory": "Email",\n             "title": "Author email",\ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex 29ffd75dc..2dcde89b9 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -516,11 +516,15 @@ def test_documentation_types_document_crud(self):\n         )\n         # With plone.dexterity 2.10+ we get an unstable behavior name like this:\n         # plone.dexterity.schema.generated.plone_5_1630611587_2_523689_0_Document\n-        # Replace it.\n+        # In older versions, we got this:\n+        # plone.dexterity.schema.generated.plone_0_Document\n+        # Normalize this to look like the new name\n         document_schema_re = re.compile(\n-            r"^plone.dexterity.schema.generated.plone_.*_Document$"\n+            r"^plone.dexterity.schema.generated.plone_5_\\d*_2_\\d*_0_Document$"\n+        )\n+        stable_behavior = (\n+            "plone.dexterity.schema.generated.plone_5_1234567890_2_123456_0_Document"\n         )\n-        stable_behavior = "plone.dexterity.schema.generated.plone_0_Document"\n         json_response = response.json()\n         response_text_override = ""\n         behavior = json_response.get("behavior")\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-09-27T15:31:04+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.restapi/commit/815dbce489ca5d57fde3e23528258ed6c1de5dbb

Merge pull request #1226 from plone/maurits/http-examples-normalize

Further normalise http-examples, and no port hardcoding

Files changed:
A news/1226.bugfix
M base.cfg
M src/plone/restapi/tests/http-examples/types_document.resp
M src/plone/restapi/tests/http-examples/types_document_get_field.resp
M src/plone/restapi/tests/http-examples/types_document_post_field.resp
M src/plone/restapi/tests/http-examples/types_document_put.req
M src/plone/restapi/tests/test_documentation.py

b'diff --git a/base.cfg b/base.cfg\nindex 75e631dc7..1426235b3 100644\n--- a/base.cfg\n+++ b/base.cfg\n@@ -72,7 +72,6 @@ initialization =\n     # necessary to explicitly call time.tzset().\n     import time\n     time.tzset()\n-    os.environ[\'ZSERVER_PORT\'] = \'55001\'\n defaults = [\'-s\', \'plone.restapi\', \'--auto-color\', \'--auto-progress\']\n \n [test-coverage]\ndiff --git a/news/1226.bugfix b/news/1226.bugfix\nnew file mode 100644\nindex 000000000..68f15065b\n--- /dev/null\n+++ b/news/1226.bugfix\n@@ -0,0 +1,3 @@\n+Normalize unstable generated behavior names in http-examples output.\n+No longer hardcode port 55001 for the tests.\n+[maurits]\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/tests/http-examples/types_document.resp b/src/plone/restapi/tests/http-examples/types_document.resp\nindex 36fbd264a..ddb61a645 100644\n--- a/src/plone/restapi/tests/http-examples/types_document.resp\n+++ b/src/plone/restapi/tests/http-examples/types_document.resp\n@@ -97,7 +97,7 @@ Content-Type: application/json+schema\n             }\n         },\n         "author_email": {\n-            "behavior": "plone.dexterity.schema.generated.plone_0_Document",\n+            "behavior": "plone.dexterity.schema.generated.plone_5_1234567890_2_123456_0_Document",\n             "description": "Email of the author",\n             "factory": "Email",\n             "title": "Author email",\ndiff --git a/src/plone/restapi/tests/http-examples/types_document_get_field.resp b/src/plone/restapi/tests/http-examples/types_document_get_field.resp\nindex c328ab6a4..de919785e 100644\n--- a/src/plone/restapi/tests/http-examples/types_document_get_field.resp\n+++ b/src/plone/restapi/tests/http-examples/types_document_get_field.resp\n@@ -2,7 +2,7 @@ HTTP/1.1 200 OK\n Content-Type: application/json\n \n {\n-    "behavior": "plone.dexterity.schema.generated.plone_0_Document",\n+    "behavior": "plone.dexterity.schema.generated.plone_5_1234567890_2_123456_0_Document",\n     "description": "Email of the author",\n     "factory": "Email",\n     "title": "Author email",\ndiff --git a/src/plone/restapi/tests/http-examples/types_document_post_field.resp b/src/plone/restapi/tests/http-examples/types_document_post_field.resp\nindex 7f142efe0..16caa7dfe 100644\n--- a/src/plone/restapi/tests/http-examples/types_document_post_field.resp\n+++ b/src/plone/restapi/tests/http-examples/types_document_post_field.resp\n@@ -2,7 +2,7 @@ HTTP/1.1 201 Created\n Content-Type: application/json\n \n {\n-    "behavior": "plone.dexterity.schema.generated.plone_0_Document",\n+    "behavior": "plone.dexterity.schema.generated.plone_5_1234567890_2_123456_0_Document",\n     "description": "Email of the author",\n     "factory": "Email",\n     "title": "Author email",\ndiff --git a/src/plone/restapi/tests/http-examples/types_document_put.req b/src/plone/restapi/tests/http-examples/types_document_put.req\nindex 22a316388..423676245 100644\n--- a/src/plone/restapi/tests/http-examples/types_document_put.req\n+++ b/src/plone/restapi/tests/http-examples/types_document_put.req\n@@ -54,7 +54,7 @@ Content-Type: application/json\n             }\n         },\n         "author_email": {\n-            "behavior": "plone.dexterity.schema.generated.plone_0_Document",\n+            "behavior": "plone.dexterity.schema.generated.plone_5_1234567890_2_123456_0_Document",\n             "description": "Email of the author",\n             "factory": "Email",\n             "title": "Author email",\ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex 29ffd75dc..2dcde89b9 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -516,11 +516,15 @@ def test_documentation_types_document_crud(self):\n         )\n         # With plone.dexterity 2.10+ we get an unstable behavior name like this:\n         # plone.dexterity.schema.generated.plone_5_1630611587_2_523689_0_Document\n-        # Replace it.\n+        # In older versions, we got this:\n+        # plone.dexterity.schema.generated.plone_0_Document\n+        # Normalize this to look like the new name\n         document_schema_re = re.compile(\n-            r"^plone.dexterity.schema.generated.plone_.*_Document$"\n+            r"^plone.dexterity.schema.generated.plone_5_\\d*_2_\\d*_0_Document$"\n+        )\n+        stable_behavior = (\n+            "plone.dexterity.schema.generated.plone_5_1234567890_2_123456_0_Document"\n         )\n-        stable_behavior = "plone.dexterity.schema.generated.plone_0_Document"\n         json_response = response.json()\n         response_text_override = ""\n         behavior = json_response.get("behavior")\n'

