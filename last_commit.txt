Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2019-04-08T16:35:08+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.Archetypes/commit/107a89b86ec6bfe50137f20861d863d904b2253e

Make QueryStringWidgetTests more robust/independent of implementation details

Files changed:
A news/124.bugfix
M Products/Archetypes/tests/test_pawidgets.py

b'diff --git a/Products/Archetypes/tests/test_pawidgets.py b/Products/Archetypes/tests/test_pawidgets.py\nindex 1b6d2f67..9e7ab0c5 100644\n--- a/Products/Archetypes/tests/test_pawidgets.py\n+++ b/Products/Archetypes/tests/test_pawidgets.py\n@@ -599,23 +599,16 @@ def test_widget(self):\n         ]\n \n         widget = QueryStringWidget()\n-\n-        self.assertEqual(\n+        base_args = widget._base_args(self.context, self.field, self.request)\n+        self.assertDictContainsSubset(\n             {\n                 \'name\': \'fieldname\',\n                 \'value\': \'[{"query": "string1"}, {"query": "string2"}]\',\n                 \'pattern\': \'querystring\',\n-                \'pattern_options\': {\n-                    \'indexOptionsUrl\': \'/@@qsOptions\',\n-                    \'previewCountURL\': \'/@@querybuildernumberofresults\',\n-                    \'previewURL\': \'/@@querybuilder_html_results\',\n-                    \'patternAjaxSelectOptions\': None,\n-                    \'patternDateOptions\': None,\n-                    \'patternRelateditemsOptions\': None,\n-                },\n             },\n-            widget._base_args(self.context, self.field, self.request),\n+            base_args,\n         )\n+        self.assertIn(\'pattern_options\', base_args.keys())\n \n \n class TinyMCEWidgetTests(unittest.TestCase):\ndiff --git a/news/124.bugfix b/news/124.bugfix\nnew file mode 100644\nindex 00000000..493cfe73\n--- /dev/null\n+++ b/news/124.bugfix\n@@ -0,0 +1,4 @@\n+Problem: refactoring plone.app.widgets is not easy with too detailed expectations on the output of the pattern_options.\n+Its also outside the scope of this test.\n+Solution: check if there are pattern_options, but now what they are exactly.\n+[jensens]\n'

Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2019-04-09T09:37:30+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.Archetypes/commit/5b7ca0a0fcf951e9d18a08b2e47b98d03bbbd843

Merge pull request #124 from plone/jensens/more-robust-pawidgets-test

Make QueryStringWidgetTests more robust/independent of implementation details

Files changed:
A news/124.bugfix
M Products/Archetypes/tests/test_pawidgets.py

b'diff --git a/Products/Archetypes/tests/test_pawidgets.py b/Products/Archetypes/tests/test_pawidgets.py\nindex 1b6d2f67..9e7ab0c5 100644\n--- a/Products/Archetypes/tests/test_pawidgets.py\n+++ b/Products/Archetypes/tests/test_pawidgets.py\n@@ -599,23 +599,16 @@ def test_widget(self):\n         ]\n \n         widget = QueryStringWidget()\n-\n-        self.assertEqual(\n+        base_args = widget._base_args(self.context, self.field, self.request)\n+        self.assertDictContainsSubset(\n             {\n                 \'name\': \'fieldname\',\n                 \'value\': \'[{"query": "string1"}, {"query": "string2"}]\',\n                 \'pattern\': \'querystring\',\n-                \'pattern_options\': {\n-                    \'indexOptionsUrl\': \'/@@qsOptions\',\n-                    \'previewCountURL\': \'/@@querybuildernumberofresults\',\n-                    \'previewURL\': \'/@@querybuilder_html_results\',\n-                    \'patternAjaxSelectOptions\': None,\n-                    \'patternDateOptions\': None,\n-                    \'patternRelateditemsOptions\': None,\n-                },\n             },\n-            widget._base_args(self.context, self.field, self.request),\n+            base_args,\n         )\n+        self.assertIn(\'pattern_options\', base_args.keys())\n \n \n class TinyMCEWidgetTests(unittest.TestCase):\ndiff --git a/news/124.bugfix b/news/124.bugfix\nnew file mode 100644\nindex 00000000..493cfe73\n--- /dev/null\n+++ b/news/124.bugfix\n@@ -0,0 +1,4 @@\n+Problem: refactoring plone.app.widgets is not easy with too detailed expectations on the output of the pattern_options.\n+Its also outside the scope of this test.\n+Solution: check if there are pattern_options, but now what they are exactly.\n+[jensens]\n'

