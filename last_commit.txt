Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-08-01T15:49:54+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.layout/commit/1a54f9bd7d6f7a9890fe319a8f44a1b19793bd2e

fix test, the Title in the portal is set through the registry

Files changed:
M plone/app/layout/globals/tests/test_portal.py

b'diff --git a/plone/app/layout/globals/tests/test_portal.py b/plone/app/layout/globals/tests/test_portal.py\nindex a029337b..33209c94 100644\n--- a/plone/app/layout/globals/tests/test_portal.py\n+++ b/plone/app/layout/globals/tests/test_portal.py\n@@ -65,7 +65,9 @@ def test_navigation_root_path(self):\n         self.assertEqual(view.navigation_root_path(), getNavigationRoot(self.folder))\n \n     def test_navigation_root_title(self):\n-        self.portal.Title = "Portal title"\n+        registry = getUtility(IRegistry)\n+        self.site_settings = registry.forInterface(ISiteSchema, prefix="plone")\n+        self.site_settings.site_title = "Portal title"\n         self.assertEqual(self.view.navigation_root_title(), "Portal title")\n         members = self.portal["Members"]\n         # mark a folder "between" self.folder and self.portal with\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-08-01T15:51:24+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.layout/commit/f9819d61dec67b3efec4405e60f70eef4423ba97

get the title from the registry in case the navigation root is the portal object

Files changed:
M plone/app/layout/globals/portal.py

b'diff --git a/plone/app/layout/globals/portal.py b/plone/app/layout/globals/portal.py\nindex 07a5a6ea..ce4f02e6 100644\n--- a/plone/app/layout/globals/portal.py\n+++ b/plone/app/layout/globals/portal.py\n@@ -8,6 +8,7 @@\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.interfaces import ISiteRoot\n from Products.CMFCore.utils import getToolByName\n+from Products.CMFPlone.interfaces import IPloneSiteRoot\n from plone.base.interfaces import ISearchSchema\n from plone.base.interfaces import ISiteSchema\n from Products.Five.browser import BrowserView\n@@ -51,6 +52,10 @@ def navigation_root(self):\n \n     @memoize\n     def navigation_root_title(self):\n+        navigation_root = self.navigation_root()\n+        if IPloneSiteRoot.providedBy(navigation_root):\n+            return self.portal_title()\n+\n         title = self.navigation_root().Title\n         if callable(title):\n             return title()\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-08-01T15:52:13+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.layout/commit/b65a6a56ae92b2a7de94bc379d5994d914c1e06b

changelog

Files changed:
A news/317.bugfix

b'diff --git a/news/317.bugfix b/news/317.bugfix\nnew file mode 100644\nindex 00000000..d58b0b42\n--- /dev/null\n+++ b/news/317.bugfix\n@@ -0,0 +1,2 @@\n+get the title of the navigation root from the registry when the navigation root object is the portal object\n+[erral]\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-08-19T00:44:36+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.layout/commit/e86d94a0f5ab0d4c2210026f291b88b56c754bad

Merge pull request #319 from plone/erral-issue-317

get the title from the registry in case the navigation root is the portal object

Files changed:
A news/317.bugfix
M plone/app/layout/globals/portal.py
M plone/app/layout/globals/tests/test_portal.py

b'diff --git a/news/317.bugfix b/news/317.bugfix\nnew file mode 100644\nindex 00000000..d58b0b42\n--- /dev/null\n+++ b/news/317.bugfix\n@@ -0,0 +1,2 @@\n+get the title of the navigation root from the registry when the navigation root object is the portal object\n+[erral]\ndiff --git a/plone/app/layout/globals/portal.py b/plone/app/layout/globals/portal.py\nindex 07a5a6ea..ce4f02e6 100644\n--- a/plone/app/layout/globals/portal.py\n+++ b/plone/app/layout/globals/portal.py\n@@ -8,6 +8,7 @@\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.interfaces import ISiteRoot\n from Products.CMFCore.utils import getToolByName\n+from Products.CMFPlone.interfaces import IPloneSiteRoot\n from plone.base.interfaces import ISearchSchema\n from plone.base.interfaces import ISiteSchema\n from Products.Five.browser import BrowserView\n@@ -51,6 +52,10 @@ def navigation_root(self):\n \n     @memoize\n     def navigation_root_title(self):\n+        navigation_root = self.navigation_root()\n+        if IPloneSiteRoot.providedBy(navigation_root):\n+            return self.portal_title()\n+\n         title = self.navigation_root().Title\n         if callable(title):\n             return title()\ndiff --git a/plone/app/layout/globals/tests/test_portal.py b/plone/app/layout/globals/tests/test_portal.py\nindex a029337b..33209c94 100644\n--- a/plone/app/layout/globals/tests/test_portal.py\n+++ b/plone/app/layout/globals/tests/test_portal.py\n@@ -65,7 +65,9 @@ def test_navigation_root_path(self):\n         self.assertEqual(view.navigation_root_path(), getNavigationRoot(self.folder))\n \n     def test_navigation_root_title(self):\n-        self.portal.Title = "Portal title"\n+        registry = getUtility(IRegistry)\n+        self.site_settings = registry.forInterface(ISiteSchema, prefix="plone")\n+        self.site_settings.site_title = "Portal title"\n         self.assertEqual(self.view.navigation_root_title(), "Portal title")\n         members = self.portal["Members"]\n         # mark a folder "between" self.folder and self.portal with\n'

