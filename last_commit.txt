Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-05-01T23:46:43+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/fe47327de7c7b46b01b77dc117341cf0ec23c802

Moved recently_modified and recently_published skin templates to browser views.

This gets rid of the `plone_templates` skin layer.
Part of https://github.com/plone/Products.CMFPlone/issues/3515
Needs an upgrade step.

Files changed:
A Products/CMFPlone/browser/templates/recently_modified.pt
A Products/CMFPlone/browser/templates/recently_published.pt
A news/3515.bugfix.1
M Products/CMFPlone/browser/configure.zcml
M Products/CMFPlone/profiles/default/skins.xml
D Products/CMFPlone/skins/plone_templates/recently_modified.pt
D Products/CMFPlone/skins/plone_templates/recently_modified.pt.metadata
D Products/CMFPlone/skins/plone_templates/recently_published.pt
D Products/CMFPlone/skins/plone_templates/recently_published.pt.metadata

b'diff --git a/Products/CMFPlone/browser/configure.zcml b/Products/CMFPlone/browser/configure.zcml\nindex e450097538..009ec8f691 100644\n--- a/Products/CMFPlone/browser/configure.zcml\n+++ b/Products/CMFPlone/browser/configure.zcml\n@@ -293,4 +293,18 @@\n       permission="zope.Public"\n       />\n \n+  <browser:page\n+      for="*"\n+      name="recently_modified"\n+      template="templates/recently_modified.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:page\n+      for="*"\n+      name="recently_published"\n+      template="templates/recently_published.pt"\n+      permission="zope2.View"\n+      />\n+\n </configure>\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_modified.pt b/Products/CMFPlone/browser/templates/recently_modified.pt\nsimilarity index 95%\nrename from Products/CMFPlone/skins/plone_templates/recently_modified.pt\nrename to Products/CMFPlone/browser/templates/recently_modified.pt\nindex 7ee649e256..9393d9cfd7 100644\n--- a/Products/CMFPlone/skins/plone_templates/recently_modified.pt\n+++ b/Products/CMFPlone/browser/templates/recently_modified.pt\n@@ -15,7 +15,6 @@\n      tal:define="path context/@@plone_portal_state/navigation_root_path;\n                  results python:container.portal_catalog(sort_on=\'modified\',sort_order=\'reverse\',path=path);\n                  Batch python:modules[\'Products.CMFPlone\'].Batch;\n-                 DateTime python:modules[\'DateTime\'].DateTime;\n                  b_start python:request.get(\'b_start\',0);\n                  normalizeString nocall:context/@@plone/normalizeString;\n                  toLocalizedTime nocall:context/@@plone/toLocalizedTime;">\n@@ -30,8 +29,7 @@\n     </div>\n \n     <div id="content-core"\n-         tal:define="site_properties context/portal_properties/site_properties;\n-                     isAnon context/@@plone_portal_state/anonymous;\n+         tal:define="isAnon context/@@plone_portal_state/anonymous;\n                      portal context/@@plone_portal_state/portal;\n                      show_about python:not isAnon or context.portal_registry[\'plone.allow_anon_views_about\'];">\n         <form name="searchresults" action="" method="post" tal:condition="results"\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_published.pt b/Products/CMFPlone/browser/templates/recently_published.pt\nsimilarity index 95%\nrename from Products/CMFPlone/skins/plone_templates/recently_published.pt\nrename to Products/CMFPlone/browser/templates/recently_published.pt\nindex cccd879ec9..07f0eca6c7 100644\n--- a/Products/CMFPlone/skins/plone_templates/recently_published.pt\n+++ b/Products/CMFPlone/browser/templates/recently_published.pt\n@@ -14,7 +14,6 @@\n <metal:main fill-slot="main"\n      tal:define="results python:container.portal_catalog(sort_on=\'modified\',sort_order=\'reverse\',review_state=\'published\');\n                  Batch python:modules[\'Products.CMFPlone\'].Batch;\n-                 DateTime python:modules[\'DateTime\'].DateTime;\n                  b_start python:request.get(\'b_start\',0);\n                  toLocalizedTime nocall:context/@@plone/toLocalizedTime;\n                  normalize nocall:context/@@plone/normalizeString;">\n@@ -29,8 +28,7 @@\n     </div>\n \n     <div id="content-core"\n-         tal:define="site_properties context/portal_properties/site_properties;\n-                     isAnon context/@@plone_portal_state/anonymous;\n+         tal:define="isAnon context/@@plone_portal_state/anonymous;\n                      portal context/@@plone_portal_state/portal;\n                      show_about python:not isAnon or context.portal_registry[\'plone.allow_anon_views_about\'];\n                      image_scale portal/@@image_scale">\ndiff --git a/Products/CMFPlone/profiles/default/skins.xml b/Products/CMFPlone/profiles/default/skins.xml\nindex 0a115c2ebc..4dd376ef0a 100644\n--- a/Products/CMFPlone/profiles/default/skins.xml\n+++ b/Products/CMFPlone/profiles/default/skins.xml\n@@ -7,14 +7,11 @@\n     directory="Products.CMFPlone:skins/plone_images"/>\n  <object name="plone_scripts" meta_type="Filesystem Directory View"\n     directory="Products.CMFPlone:skins/plone_scripts"/>\n- <object name="plone_templates" meta_type="Filesystem Directory View"\n-    directory="Products.CMFPlone:skins/plone_templates"/>\n  <object name="plone_wysiwyg" meta_type="Filesystem Directory View"\n     directory="Products.CMFPlone:skins/plone_wysiwyg"/>\n  <skin-path name="Plone Default">\n   <layer name="custom"/>\n   <layer name="plone_wysiwyg"/>\n-  <layer name="plone_templates"/>\n   <layer name="plone_scripts"/>\n   <layer name="plone_images"/>\n  </skin-path>\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_modified.pt.metadata b/Products/CMFPlone/skins/plone_templates/recently_modified.pt.metadata\ndeleted file mode 100644\nindex 5d68938f48..0000000000\n--- a/Products/CMFPlone/skins/plone_templates/recently_modified.pt.metadata\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-[default]\n-title=Recently modified\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_published.pt.metadata b/Products/CMFPlone/skins/plone_templates/recently_published.pt.metadata\ndeleted file mode 100644\nindex 3e086cc76a..0000000000\n--- a/Products/CMFPlone/skins/plone_templates/recently_published.pt.metadata\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-[default]\n-title=Recently published\ndiff --git a/news/3515.bugfix.1 b/news/3515.bugfix.1\nnew file mode 100644\nindex 0000000000..7288e59239\n--- /dev/null\n+++ b/news/3515.bugfix.1\n@@ -0,0 +1,2 @@\n+Moved ``recently_modified`` and ``recently_published`` skin templates to browser views.\n+[maurits]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-05-02T16:55:37+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/80c2c5a0c21904f2ab40fe4d59df52d5a465790a

Merge pull request #3516 from plone/maurits-remove-plone_templates-layer

Moved recently_modified/published skin templates to browser views

Files changed:
A Products/CMFPlone/browser/templates/recently_modified.pt
A Products/CMFPlone/browser/templates/recently_published.pt
A news/3515.bugfix.1
M Products/CMFPlone/browser/configure.zcml
M Products/CMFPlone/profiles/default/skins.xml
D Products/CMFPlone/skins/plone_templates/recently_modified.pt
D Products/CMFPlone/skins/plone_templates/recently_modified.pt.metadata
D Products/CMFPlone/skins/plone_templates/recently_published.pt
D Products/CMFPlone/skins/plone_templates/recently_published.pt.metadata

b'diff --git a/Products/CMFPlone/browser/configure.zcml b/Products/CMFPlone/browser/configure.zcml\nindex e450097538..009ec8f691 100644\n--- a/Products/CMFPlone/browser/configure.zcml\n+++ b/Products/CMFPlone/browser/configure.zcml\n@@ -293,4 +293,18 @@\n       permission="zope.Public"\n       />\n \n+  <browser:page\n+      for="*"\n+      name="recently_modified"\n+      template="templates/recently_modified.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:page\n+      for="*"\n+      name="recently_published"\n+      template="templates/recently_published.pt"\n+      permission="zope2.View"\n+      />\n+\n </configure>\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_modified.pt b/Products/CMFPlone/browser/templates/recently_modified.pt\nsimilarity index 95%\nrename from Products/CMFPlone/skins/plone_templates/recently_modified.pt\nrename to Products/CMFPlone/browser/templates/recently_modified.pt\nindex 7ee649e256..9393d9cfd7 100644\n--- a/Products/CMFPlone/skins/plone_templates/recently_modified.pt\n+++ b/Products/CMFPlone/browser/templates/recently_modified.pt\n@@ -15,7 +15,6 @@\n      tal:define="path context/@@plone_portal_state/navigation_root_path;\n                  results python:container.portal_catalog(sort_on=\'modified\',sort_order=\'reverse\',path=path);\n                  Batch python:modules[\'Products.CMFPlone\'].Batch;\n-                 DateTime python:modules[\'DateTime\'].DateTime;\n                  b_start python:request.get(\'b_start\',0);\n                  normalizeString nocall:context/@@plone/normalizeString;\n                  toLocalizedTime nocall:context/@@plone/toLocalizedTime;">\n@@ -30,8 +29,7 @@\n     </div>\n \n     <div id="content-core"\n-         tal:define="site_properties context/portal_properties/site_properties;\n-                     isAnon context/@@plone_portal_state/anonymous;\n+         tal:define="isAnon context/@@plone_portal_state/anonymous;\n                      portal context/@@plone_portal_state/portal;\n                      show_about python:not isAnon or context.portal_registry[\'plone.allow_anon_views_about\'];">\n         <form name="searchresults" action="" method="post" tal:condition="results"\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_published.pt b/Products/CMFPlone/browser/templates/recently_published.pt\nsimilarity index 95%\nrename from Products/CMFPlone/skins/plone_templates/recently_published.pt\nrename to Products/CMFPlone/browser/templates/recently_published.pt\nindex cccd879ec9..07f0eca6c7 100644\n--- a/Products/CMFPlone/skins/plone_templates/recently_published.pt\n+++ b/Products/CMFPlone/browser/templates/recently_published.pt\n@@ -14,7 +14,6 @@\n <metal:main fill-slot="main"\n      tal:define="results python:container.portal_catalog(sort_on=\'modified\',sort_order=\'reverse\',review_state=\'published\');\n                  Batch python:modules[\'Products.CMFPlone\'].Batch;\n-                 DateTime python:modules[\'DateTime\'].DateTime;\n                  b_start python:request.get(\'b_start\',0);\n                  toLocalizedTime nocall:context/@@plone/toLocalizedTime;\n                  normalize nocall:context/@@plone/normalizeString;">\n@@ -29,8 +28,7 @@\n     </div>\n \n     <div id="content-core"\n-         tal:define="site_properties context/portal_properties/site_properties;\n-                     isAnon context/@@plone_portal_state/anonymous;\n+         tal:define="isAnon context/@@plone_portal_state/anonymous;\n                      portal context/@@plone_portal_state/portal;\n                      show_about python:not isAnon or context.portal_registry[\'plone.allow_anon_views_about\'];\n                      image_scale portal/@@image_scale">\ndiff --git a/Products/CMFPlone/profiles/default/skins.xml b/Products/CMFPlone/profiles/default/skins.xml\nindex 0a115c2ebc..4dd376ef0a 100644\n--- a/Products/CMFPlone/profiles/default/skins.xml\n+++ b/Products/CMFPlone/profiles/default/skins.xml\n@@ -7,14 +7,11 @@\n     directory="Products.CMFPlone:skins/plone_images"/>\n  <object name="plone_scripts" meta_type="Filesystem Directory View"\n     directory="Products.CMFPlone:skins/plone_scripts"/>\n- <object name="plone_templates" meta_type="Filesystem Directory View"\n-    directory="Products.CMFPlone:skins/plone_templates"/>\n  <object name="plone_wysiwyg" meta_type="Filesystem Directory View"\n     directory="Products.CMFPlone:skins/plone_wysiwyg"/>\n  <skin-path name="Plone Default">\n   <layer name="custom"/>\n   <layer name="plone_wysiwyg"/>\n-  <layer name="plone_templates"/>\n   <layer name="plone_scripts"/>\n   <layer name="plone_images"/>\n  </skin-path>\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_modified.pt.metadata b/Products/CMFPlone/skins/plone_templates/recently_modified.pt.metadata\ndeleted file mode 100644\nindex 5d68938f48..0000000000\n--- a/Products/CMFPlone/skins/plone_templates/recently_modified.pt.metadata\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-[default]\n-title=Recently modified\ndiff --git a/Products/CMFPlone/skins/plone_templates/recently_published.pt.metadata b/Products/CMFPlone/skins/plone_templates/recently_published.pt.metadata\ndeleted file mode 100644\nindex 3e086cc76a..0000000000\n--- a/Products/CMFPlone/skins/plone_templates/recently_published.pt.metadata\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-[default]\n-title=Recently published\ndiff --git a/news/3515.bugfix.1 b/news/3515.bugfix.1\nnew file mode 100644\nindex 0000000000..7288e59239\n--- /dev/null\n+++ b/news/3515.bugfix.1\n@@ -0,0 +1,2 @@\n+Moved ``recently_modified`` and ``recently_published`` skin templates to browser views.\n+[maurits]\n'

