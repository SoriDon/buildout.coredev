Repository: plone.app.widgets


Branch: refs/heads/master
Date: 2016-02-18T16:21:33-08:00
Author: Alec Mitchell (alecpm) <alecpm@gmail.com>
Commit: https://github.com/plone/plone.app.widgets/commit/6f3d0eeda997d747a47e9d57f18c3523acbc6683

Revert "Ensure vocabulary lookup works on add forms for related items widget, and with add forms using schema groups."

This reverts commit 59f74d53482f5092ee7dd0c6d9c29d2637ea168c.

Files changed:
M CHANGES.rst
M plone/app/widgets/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d8ba9e2..5b1e48c 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -12,8 +12,7 @@ New:
 
 Fixes:
 
-- Ensure vocabulary lookup works on add forms for related items widget.
-  [alecm]
+- *add item here*
 
 
 2.0.3 (2016-02-14)
diff --git a/plone/app/widgets/utils.py b/plone/app/widgets/utils.py
index 49bccc4..7a164e9 100644
--- a/plone/app/widgets/utils.py
+++ b/plone/app/widgets/utils.py
@@ -1,6 +1,5 @@
 # -*- coding: utf-8 -*-
 
-from Acquisition import aq_base
 from Products.CMFCore.interfaces import ISiteRoot
 from Products.CMFCore.utils import getToolByName
 from datetime import datetime
@@ -123,8 +122,7 @@ def get_relateditems_options(context, value, separator, vocabulary_name,
     options = get_ajaxselect_options(context, value, separator,
                                      vocabulary_name, vocabulary_view,
                                      field_name)
-    if IAddForm.providedBy(context):
-        context = context.context
+
     request = getRequest()
     msgstr = translate(_(u'Search'), context=request)
     options.setdefault('searchText', msgstr)
@@ -206,10 +204,3 @@ def get_context_url(context):
     else:
         url = get_portal_url(context)
     return url
-
-
-def get_widget_form(widget):
-    form = getattr(widget, 'form', None)
-    if getattr(aq_base(form), 'parentForm', None) is not None:
-        form = form.parentForm
-    return form


Repository: plone.app.widgets


Branch: refs/heads/master
Date: 2016-02-18T16:21:36-08:00
Author: Alec Mitchell (alecpm) <alecpm@gmail.com>
Commit: https://github.com/plone/plone.app.widgets/commit/b5b617a0d227ac26a114958680ccd60ee06c191e

Revert "Fix options merging issues in TinyMCE widget."

This reverts commit 9eabc0998743392845f9fdd51c008521a5482b1a.

Files changed:
M plone/app/widgets/utils.py

diff --git a/plone/app/widgets/utils.py b/plone/app/widgets/utils.py
index 7a164e9..5901dc8 100644
--- a/plone/app/widgets/utils.py
+++ b/plone/app/widgets/utils.py
@@ -160,15 +160,15 @@ def get_tinymce_options(context, field, request):
     We're just going to be looking up settings from
     plone pattern options
     """
-    options = {}
+    args = {'pattern_options': {}}
     try:
         pattern_options = getMultiAdapter(
             (context, request, field),
             name="plone_settings").tinymce()['data-pat-tinymce']
-        options = json.loads(pattern_options)
+        args['pattern_options'] = json.loads(pattern_options)
     except (ComponentLookupError, AttributeError):
         pass
-    return options
+    return args
 
 
 def get_portal():


Repository: plone.app.widgets


Branch: refs/heads/master
Date: 2016-02-18T16:21:38-08:00
Author: Alec Mitchell (alecpm) <alecpm@gmail.com>
Commit: https://github.com/plone/plone.app.widgets/commit/05b4e81617f7a2981be89817a12b337596c5a7d6

Revert "Add navigation root support to related items widget. Fix incorrect options merge for TinyMCE widget."

This reverts commit 211126c131a78a9c3054a652d0c2b8924c77bd54.

Files changed:
M CHANGES.rst
M plone/app/widgets/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5b1e48c..0c8f956 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,9 +6,7 @@ Changelog
 
 New:
 
-- Add navigation root support to related items widget. Fix incorrect options
-  merge for TinyMCE widget.
-  [alecm]
+- *add item here*
 
 Fixes:
 
diff --git a/plone/app/widgets/utils.py b/plone/app/widgets/utils.py
index 5901dc8..daec100 100644
--- a/plone/app/widgets/utils.py
+++ b/plone/app/widgets/utils.py
@@ -119,7 +119,8 @@ def get_ajaxselect_options(context, value, separator, vocabulary_name,
 
 def get_relateditems_options(context, value, separator, vocabulary_name,
                              vocabulary_view, field_name=None):
-    options = get_ajaxselect_options(context, value, separator,
+    portal = get_portal()
+    options = get_ajaxselect_options(portal, value, separator,
                                      vocabulary_name, vocabulary_view,
                                      field_name)
 
@@ -133,12 +134,6 @@ def get_relateditems_options(context, value, separator, vocabulary_name,
                        context=request)
     options.setdefault('homeText', msgstr)
     options.setdefault('folderTypes', ['Folder'])
-
-    nav_root = getNavigationRootObject(context, get_portal())
-    options['rootPath'] = (
-        '/'.join(nav_root.getPhysicalPath()) if nav_root else '/'
-    )
-
     return options
 
 


