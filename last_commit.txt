Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-11-11T23:23:39-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/065cfc9b5fc210831e895862c577a7e6318d80fe

remove canSelectDefaultPage script

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testPloneView.py
D Products/CMFPlone/skins/plone_scripts/canSelectDefaultPage.py
D Products/CMFPlone/tests/testBrowserDefaultScripts.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 403ef56..7214fd5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -25,6 +25,7 @@ Breaking changes:
 
     - ``add_ext_editor.py``
     - ``author_find_content.py``
+    - ``canSelectDefaultPage.py`` with tests
     - ``create_query_string.py``
     - ``formatColumns.py`` with tests
     - ``getAllowedTypes.py``
diff --git a/Products/CMFPlone/skins/plone_scripts/canSelectDefaultPage.py b/Products/CMFPlone/skins/plone_scripts/canSelectDefaultPage.py
deleted file mode 100644
index a041399..0000000
--- a/Products/CMFPlone/skins/plone_scripts/canSelectDefaultPage.py
+++ /dev/null
@@ -1,20 +0,0 @@
-## Script (Python) "canSelectDefaultPage"
-##title=Find out if a default page can be selected on this folderish item
-##bind container=container
-##bind context=context
-##bind namespace=
-##bind script=script
-##bind subpath=traverse_subpath
-##parameters=
-
-from AccessControl import Unauthorized
-
-# It's silly but because this is often called on the parent folder, we must
-# ensure we have permission.
-try:
-    if not context.isPrincipiaFolderish:
-        return False
-except Unauthorized:
-        return False
-
-return context.canSetDefaultPage()
diff --git a/Products/CMFPlone/tests/testBrowserDefaultScripts.py b/Products/CMFPlone/tests/testBrowserDefaultScripts.py
deleted file mode 100644
index 3af67b2..0000000
--- a/Products/CMFPlone/tests/testBrowserDefaultScripts.py
+++ /dev/null
@@ -1,10 +0,0 @@
-# -*- coding: utf-8 -*-
-from plone.app.testing.bbb import PloneTestCase
-
-
-class TestBrowserDefaultScripts(PloneTestCase):
-    """Tests the browser default and folder-default page scripts"""
-
-    def testSetDefaultPageWithoutPage(self):
-        # Make sure we can't define a default page if no object in folder
-        self.assertTrue(self.folder.canSelectDefaultPage())
diff --git a/Products/CMFPlone/tests/testPloneView.py b/Products/CMFPlone/tests/testPloneView.py
index 97b7db7..88ed8da 100644
--- a/Products/CMFPlone/tests/testPloneView.py
+++ b/Products/CMFPlone/tests/testPloneView.py
@@ -42,7 +42,7 @@ def testIsStructuralFolderWithNonStructuralFolder(self):
     def testIsDefaultPageInFolder(self):
         view = Plone(self.folder.test, self.app.REQUEST)
         self.assertFalse(view.isDefaultPageInFolder())
-        self.assertTrue(self.folder.canSelectDefaultPage())
+        self.assertTrue(self.folder.canSetDefaultPage())
         self.folder.setDefaultPage('test')
         # re-create the view, because the old value is cached
         self._invalidateRequestMemoizations()


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-11-12T20:53:31+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/88abc7f2f10e0107a3d663c16b1aad9bd42bf4be

Merge pull request #1832 from plone/davisagli-cleanup-scripts

remove canSelectDefaultPage script

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testPloneView.py
D Products/CMFPlone/skins/plone_scripts/canSelectDefaultPage.py
D Products/CMFPlone/tests/testBrowserDefaultScripts.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 403ef56..7214fd5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -25,6 +25,7 @@ Breaking changes:
 
     - ``add_ext_editor.py``
     - ``author_find_content.py``
+    - ``canSelectDefaultPage.py`` with tests
     - ``create_query_string.py``
     - ``formatColumns.py`` with tests
     - ``getAllowedTypes.py``
diff --git a/Products/CMFPlone/skins/plone_scripts/canSelectDefaultPage.py b/Products/CMFPlone/skins/plone_scripts/canSelectDefaultPage.py
deleted file mode 100644
index a041399..0000000
--- a/Products/CMFPlone/skins/plone_scripts/canSelectDefaultPage.py
+++ /dev/null
@@ -1,20 +0,0 @@
-## Script (Python) "canSelectDefaultPage"
-##title=Find out if a default page can be selected on this folderish item
-##bind container=container
-##bind context=context
-##bind namespace=
-##bind script=script
-##bind subpath=traverse_subpath
-##parameters=
-
-from AccessControl import Unauthorized
-
-# It's silly but because this is often called on the parent folder, we must
-# ensure we have permission.
-try:
-    if not context.isPrincipiaFolderish:
-        return False
-except Unauthorized:
-        return False
-
-return context.canSetDefaultPage()
diff --git a/Products/CMFPlone/tests/testBrowserDefaultScripts.py b/Products/CMFPlone/tests/testBrowserDefaultScripts.py
deleted file mode 100644
index 3af67b2..0000000
--- a/Products/CMFPlone/tests/testBrowserDefaultScripts.py
+++ /dev/null
@@ -1,10 +0,0 @@
-# -*- coding: utf-8 -*-
-from plone.app.testing.bbb import PloneTestCase
-
-
-class TestBrowserDefaultScripts(PloneTestCase):
-    """Tests the browser default and folder-default page scripts"""
-
-    def testSetDefaultPageWithoutPage(self):
-        # Make sure we can't define a default page if no object in folder
-        self.assertTrue(self.folder.canSelectDefaultPage())
diff --git a/Products/CMFPlone/tests/testPloneView.py b/Products/CMFPlone/tests/testPloneView.py
index 97b7db7..88ed8da 100644
--- a/Products/CMFPlone/tests/testPloneView.py
+++ b/Products/CMFPlone/tests/testPloneView.py
@@ -42,7 +42,7 @@ def testIsStructuralFolderWithNonStructuralFolder(self):
     def testIsDefaultPageInFolder(self):
         view = Plone(self.folder.test, self.app.REQUEST)
         self.assertFalse(view.isDefaultPageInFolder())
-        self.assertTrue(self.folder.canSelectDefaultPage())
+        self.assertTrue(self.folder.canSetDefaultPage())
         self.folder.setDefaultPage('test')
         # re-create the view, because the old value is cached
         self._invalidateRequestMemoizations()


