Repository: plone.restapi


Branch: refs/heads/master
Date: 2019-02-04T19:38:54+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/plone.restapi/commit/c90dc42cf2ab574f91cc8e09cc725fa1e1f83970

Revert "Standardize errors data structure of email-notification endpoint"

This reverts commit 53d0d670fa6a6d12f278eafce0e542185f9f4e95.

Files changed:
M CHANGES.rst
M src/plone/restapi/services/email_notification/post.py
M src/plone/restapi/tests/test_services_email_notification.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 611034a5..c09eb81c 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -18,9 +18,6 @@ Bugfixes:\n   and `648 <https://github.com/plone/plone.restapi/issues/648>`_.\n   [maurits, gforcada]\n \n-- Standardize errors data structure of email-notification endpoint.\n-  [cekk]\n-\n \n 3.5.0 (2018-11-06)\n ------------------\ndiff --git a/src/plone/restapi/services/email_notification/post.py b/src/plone/restapi/services/email_notification/post.py\nindex 6c7681b9..3419e488 100644\n--- a/src/plone/restapi/services/email_notification/post.py\n+++ b/src/plone/restapi/services/email_notification/post.py\n@@ -1,8 +1,7 @@\n # -*- coding: utf-8 -*-\n-from plone.restapi.deserializer import json_body\n from plone.restapi.services import Service\n-from zExceptions import BadRequest\n from zope.component import getMultiAdapter\n+from plone.restapi.deserializer import json_body\n from zope.interface import alsoProvides\n \n import plone\n@@ -19,12 +18,18 @@ def reply(self):\n         subject = data.get('subject', '')\n \n         if not sender_from_address or not message:\n-            raise BadRequest('Missing from or message parameters')\n+            self.request.response.setStatus(400)\n+            return dict(error=dict(\n+                type='BadRequest',\n+                message='Missing from or message parameters'))\n \n         overview_controlpanel = getMultiAdapter((self.context, self.request),\n                                                 name='overview-controlpanel')\n         if overview_controlpanel.mailhost_warning():\n-            raise BadRequest('MailHost is not configured.')\n+            self.request.response.setStatus(400)\n+            return dict(error=dict(\n+                type='BadRequest',\n+                message='MailHost is not configured.'))\n \n         # Disable CSRF protection\n         if 'IDisableCSRFProtection' in dir(plone.protect.interfaces):\n@@ -36,10 +41,10 @@ def reply(self):\n \n         contact_info_view.send_message(\n             dict(\n-                message=message,\n-                subject=subject,\n-                sender_from_address=sender_from_address,\n-                sender_fullname=sender_fullname\n+              message=message,\n+              subject=subject,\n+              sender_from_address=sender_from_address,\n+              sender_fullname=sender_fullname\n             )\n         )\n \ndiff --git a/src/plone/restapi/tests/test_services_email_notification.py b/src/plone/restapi/tests/test_services_email_notification.py\nindex 0e6ce006..9bd05135 100644\n--- a/src/plone/restapi/tests/test_services_email_notification.py\n+++ b/src/plone/restapi/tests/test_services_email_notification.py\n@@ -49,19 +49,6 @@ def setUp(self):\n     def tearDown(self):\n         self.api_session.close()\n \n-    def test_email_notification_missing_parameters(self):\n-        response = self.api_session.post(\n-            '/@email-notification',\n-            json={\n-                'message': 'Just want to say hi.'\n-            })\n-        transaction.commit()\n-        self.assertEqual(response.status_code, 400)\n-        self.assertEqual(self.mailhost.messages, [])\n-        error = response.json()\n-        self.assertEqual(error['message'],\n-                         'Missing from or message parameters')\n-\n     def test_email_notification(self):\n         response = self.api_session.post(\n             '/@email-notification',\n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2019-02-04T21:37:12+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/plone.restapi/commit/50470f629fc65d013f008afd4962205cce4aa965

Pep8 fix.

Files changed:
M src/plone/restapi/services/content/tus.py

b'diff --git a/src/plone/restapi/services/content/tus.py b/src/plone/restapi/services/content/tus.py\nindex 49139a99..5bf9d612 100644\n--- a/src/plone/restapi/services/content/tus.py\n+++ b/src/plone/restapi/services/content/tus.py\n@@ -37,7 +37,7 @@ class UploadOptions(Service):\n \n     def reply(self):\n         for name, value in TUS_OPTIONS_RESPONSE_HEADERS.items():\n-                    self.request.response.setHeader(name, value)\n+            self.request.response.setHeader(name, value)\n         return super(UploadOptions, self).reply()\n \n \n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2019-02-04T22:13:36+01:00
Author: Timo Stollenwerk (tisto) <tisto@users.noreply.github.com>
Commit: https://github.com/plone/plone.restapi/commit/542e05d01d8d8fe7a4890d807a2a1680dfb10063

Merge pull request #666 from plone/revert-fix-email-notification-errors

Revert "Standardize errors data structure of email-notification endpoâ€¦

Files changed:
M CHANGES.rst
M src/plone/restapi/services/content/tus.py
M src/plone/restapi/services/email_notification/post.py
M src/plone/restapi/tests/test_services_email_notification.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 611034a5..c09eb81c 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -18,9 +18,6 @@ Bugfixes:\n   and `648 <https://github.com/plone/plone.restapi/issues/648>`_.\n   [maurits, gforcada]\n \n-- Standardize errors data structure of email-notification endpoint.\n-  [cekk]\n-\n \n 3.5.0 (2018-11-06)\n ------------------\ndiff --git a/src/plone/restapi/services/content/tus.py b/src/plone/restapi/services/content/tus.py\nindex 49139a99..5bf9d612 100644\n--- a/src/plone/restapi/services/content/tus.py\n+++ b/src/plone/restapi/services/content/tus.py\n@@ -37,7 +37,7 @@ class UploadOptions(Service):\n \n     def reply(self):\n         for name, value in TUS_OPTIONS_RESPONSE_HEADERS.items():\n-                    self.request.response.setHeader(name, value)\n+            self.request.response.setHeader(name, value)\n         return super(UploadOptions, self).reply()\n \n \ndiff --git a/src/plone/restapi/services/email_notification/post.py b/src/plone/restapi/services/email_notification/post.py\nindex 6c7681b9..3419e488 100644\n--- a/src/plone/restapi/services/email_notification/post.py\n+++ b/src/plone/restapi/services/email_notification/post.py\n@@ -1,8 +1,7 @@\n # -*- coding: utf-8 -*-\n-from plone.restapi.deserializer import json_body\n from plone.restapi.services import Service\n-from zExceptions import BadRequest\n from zope.component import getMultiAdapter\n+from plone.restapi.deserializer import json_body\n from zope.interface import alsoProvides\n \n import plone\n@@ -19,12 +18,18 @@ def reply(self):\n         subject = data.get('subject', '')\n \n         if not sender_from_address or not message:\n-            raise BadRequest('Missing from or message parameters')\n+            self.request.response.setStatus(400)\n+            return dict(error=dict(\n+                type='BadRequest',\n+                message='Missing from or message parameters'))\n \n         overview_controlpanel = getMultiAdapter((self.context, self.request),\n                                                 name='overview-controlpanel')\n         if overview_controlpanel.mailhost_warning():\n-            raise BadRequest('MailHost is not configured.')\n+            self.request.response.setStatus(400)\n+            return dict(error=dict(\n+                type='BadRequest',\n+                message='MailHost is not configured.'))\n \n         # Disable CSRF protection\n         if 'IDisableCSRFProtection' in dir(plone.protect.interfaces):\n@@ -36,10 +41,10 @@ def reply(self):\n \n         contact_info_view.send_message(\n             dict(\n-                message=message,\n-                subject=subject,\n-                sender_from_address=sender_from_address,\n-                sender_fullname=sender_fullname\n+              message=message,\n+              subject=subject,\n+              sender_from_address=sender_from_address,\n+              sender_fullname=sender_fullname\n             )\n         )\n \ndiff --git a/src/plone/restapi/tests/test_services_email_notification.py b/src/plone/restapi/tests/test_services_email_notification.py\nindex 0e6ce006..9bd05135 100644\n--- a/src/plone/restapi/tests/test_services_email_notification.py\n+++ b/src/plone/restapi/tests/test_services_email_notification.py\n@@ -49,19 +49,6 @@ def setUp(self):\n     def tearDown(self):\n         self.api_session.close()\n \n-    def test_email_notification_missing_parameters(self):\n-        response = self.api_session.post(\n-            '/@email-notification',\n-            json={\n-                'message': 'Just want to say hi.'\n-            })\n-        transaction.commit()\n-        self.assertEqual(response.status_code, 400)\n-        self.assertEqual(self.mailhost.messages, [])\n-        error = response.json()\n-        self.assertEqual(error['message'],\n-                         'Missing from or message parameters')\n-\n     def test_email_notification(self):\n         response = self.api_session.post(\n             '/@email-notification',\n"

