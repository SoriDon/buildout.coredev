Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-12-12T19:10:18+01:00
Author: Sebastian Gottfried (sebasgo) <sebastian.gottfried@posteo.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/6b0416f938aec7ae23818383730fede013a23891

WorkflowTool: Include Inactive Content In Worklists

WorkflowTool.getWorklistsResults uses the catalog to gather its results.
By default the catalog tool excludes inactive content from the search
results if the current user lacks the permission to view inactive
content in the current context. This can result in incomplete results,
since the method is supposed to return the work list results for the
whole site.

This commit bypasses the the catalog's inactive content filter.

Files changed:
M CHANGES.rst
M Products/CMFPlone/WorkflowTool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0d74031..2fd2efb 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -221,6 +221,8 @@ Bug fixes:
   Define ``barcelonetaPath`` if ``plonetheme.barceloneta`` is available (but not necessarily installed).
   [jensens]
 
+- Include inactive content in worklists.  [sebasgo]
+
 5.1a2 (2016-08-19)
 ------------------
 
diff --git a/Products/CMFPlone/WorkflowTool.py b/Products/CMFPlone/WorkflowTool.py
index c9a026d..a94ce43 100644
--- a/Products/CMFPlone/WorkflowTool.py
+++ b/Products/CMFPlone/WorkflowTool.py
@@ -232,6 +232,10 @@ def getWorklistsResults(self):
                     # content in *all* languages
                     if 'Language' not in catalog_vars:
                         catalog_vars['Language'] = 'all'
+                    # Include inactive content in result list. This is
+                    # especially important for content scheduled to go public
+                    # in the future, but needs to be reviewed before this.
+                    catalog_vars['show_inactive'] = True
                     for result in catalog.searchResults(catalog_vars):
                         o = result.getObject()
                         if o \


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-12-12T22:21:05+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/e3863a759bb7ceeaa62fdea4e21393dfcc0581e3

Merge pull request #1873 from sebasgo/master

WorkflowTool: Include Inactive Content In Worklists

Files changed:
M CHANGES.rst
M Products/CMFPlone/WorkflowTool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0d74031..2fd2efb 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -221,6 +221,8 @@ Bug fixes:
   Define ``barcelonetaPath`` if ``plonetheme.barceloneta`` is available (but not necessarily installed).
   [jensens]
 
+- Include inactive content in worklists.  [sebasgo]
+
 5.1a2 (2016-08-19)
 ------------------
 
diff --git a/Products/CMFPlone/WorkflowTool.py b/Products/CMFPlone/WorkflowTool.py
index c9a026d..a94ce43 100644
--- a/Products/CMFPlone/WorkflowTool.py
+++ b/Products/CMFPlone/WorkflowTool.py
@@ -232,6 +232,10 @@ def getWorklistsResults(self):
                     # content in *all* languages
                     if 'Language' not in catalog_vars:
                         catalog_vars['Language'] = 'all'
+                    # Include inactive content in result list. This is
+                    # especially important for content scheduled to go public
+                    # in the future, but needs to be reviewed before this.
+                    catalog_vars['show_inactive'] = True
                     for result in catalog.searchResults(catalog_vars):
                         o = result.getObject()
                         if o \


