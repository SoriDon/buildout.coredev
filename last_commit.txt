Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2016-01-29T14:31:28+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.ATContentTypes/commit/bbb95d3923008f51bbdd79e13b7c2350b99368c0

Prevent topic-criteria from having unicode as id.

Files changed:
M CHANGES.rst
M Products/ATContentTypes/criteria/base.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a20da66..a6374a1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,10 @@ New:
 
 Fixes:
 
-- *add item here*
+- Prevent topic-criteria from having unicode as id. A unicode-id broke
+  indexing the criteria in ZCatalog since obj.getPhysicalPath() prefers
+  obj.id over obj.getId() in zope4.
+  [pbauer]
 
 
 2.2.10 (2015-12-21)
diff --git a/Products/ATContentTypes/criteria/base.py b/Products/ATContentTypes/criteria/base.py
index bb475cc..dfd06db 100644
--- a/Products/ATContentTypes/criteria/base.py
+++ b/Products/ATContentTypes/criteria/base.py
@@ -61,7 +61,8 @@ def __init__(self, id=None, field=None, oid=None):
             id = oid
         assert id
         NonRefCatalogContent.__init__(self, id)
-        self.getField('id').set(self, id)
+        if not self.id == id:
+            self.id = id
         self.getField('field').set(self, field)
 
     security.declareProtected(View, 'getId')


Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2016-02-01T21:38:39+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/Products.ATContentTypes/commit/fa51ba8ea14659ec48ae6e480e188b8d7208cdb8

Merge pull request #30 from plone/thet-zope4

Prevent topic-criteria from having unicode as id.

Files changed:
M CHANGES.rst
M Products/ATContentTypes/criteria/base.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a20da66..a6374a1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,10 @@ New:
 
 Fixes:
 
-- *add item here*
+- Prevent topic-criteria from having unicode as id. A unicode-id broke
+  indexing the criteria in ZCatalog since obj.getPhysicalPath() prefers
+  obj.id over obj.getId() in zope4.
+  [pbauer]
 
 
 2.2.10 (2015-12-21)
diff --git a/Products/ATContentTypes/criteria/base.py b/Products/ATContentTypes/criteria/base.py
index bb475cc..dfd06db 100644
--- a/Products/ATContentTypes/criteria/base.py
+++ b/Products/ATContentTypes/criteria/base.py
@@ -61,7 +61,8 @@ def __init__(self, id=None, field=None, oid=None):
             id = oid
         assert id
         NonRefCatalogContent.__init__(self, id)
-        self.getField('id').set(self, id)
+        if not self.id == id:
+            self.id = id
         self.getField('field').set(self, field)
 
     security.declareProtected(View, 'getId')


