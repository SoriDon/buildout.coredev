Repository: plone.app.content


Branch: refs/heads/master
Date: 2022-11-03T12:08:53+01:00
Author: Sébastien Verbois (sverbois) <sebastien.verbois@imio.be>
Commit: https://github.com/plone/plone.app.content/commit/a9906e5444af6c1163cb72e366c391480153c6c0

Fix cancel button on @@select_default_view

Files changed:
A news/256.bugfix
M plone/app/content/browser/selection.py

b'diff --git a/news/256.bugfix b/news/256.bugfix\nnew file mode 100644\nindex 00000000..d6a07939\n--- /dev/null\n+++ b/news/256.bugfix\n@@ -0,0 +1 @@\n+- Fix cancel button on @@select_default_view [sverbois]\n\\ No newline at end of file\ndiff --git a/plone/app/content/browser/selection.py b/plone/app/content/browser/selection.py\nindex e0426c89..1d5a7327 100644\n--- a/plone/app/content/browser/selection.py\n+++ b/plone/app/content/browser/selection.py\n@@ -42,19 +42,25 @@ def __call__(self):\n             (self.context, self.request), name="plone_context_state"\n         )\n \n-        templateId = self.request.form.get("templateId", False)\n-        if templateId:\n+        template_id = self.request.form.get("templateId")\n+        context_view_url = self.context_state.object_url() + "/view"\n+\n+        if self.request.form.get("form.button.Cancel"):\n+            self.request.response.redirect(context_view_url)\n+\n+        if self.request.form.get("form.button.Save") and not template_id:\n+            IStatusMessage(self.request).add("Please select a template.", type="warning")\n+\n+        if self.request.form.get("form.button.Save") and template_id:\n             # Make sure this is a valid template\n-            if not self.isValidTemplate(templateId):\n+            if not self.isValidTemplate(template_id):\n                 IStatusMessage(self.request).add("Invalid view.", type="error")\n                 return self.index()\n             # Update the template\n-            self.context.setLayout(templateId)\n+            self.context.setLayout(template_id)\n             IStatusMessage(self.request).add("View changed.")\n-\n-        if templateId or self.request.form.get("form.buttons.Cancel", False):\n-            # Redirect to view\n-            self.request.response.redirect("%s/view" % self.context_state.object_url())\n+            # Redirect to context view\n+            self.request.response.redirect(context_view_url)\n \n         return self.index()\n \n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2022-11-03T13:08:47+01:00
Author: Sébastien Verbois (sverbois) <sebastien.verbois@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/a6f042e2ddd03c8d79e851a4aa941dd8bc58c61c

Remove dash in news item

Files changed:
M news/256.bugfix

b'diff --git a/news/256.bugfix b/news/256.bugfix\nindex d6a0793..15070fd 100644\n--- a/news/256.bugfix\n+++ b/news/256.bugfix\n@@ -1 +1 @@\n-- Fix cancel button on @@select_default_view [sverbois]\n\\ No newline at end of file\n+Fix cancel button on @@select_default_view [sverbois]\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2022-11-04T17:37:09+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/2b52e7cdedb1fba0600625b7775e7cd59fc5a40d

Merge pull request #257 from plone/select-default-view

Fix cancel button on @@select_default_view

Files changed:
A news/256.bugfix
M plone/app/content/browser/selection.py

b'diff --git a/news/256.bugfix b/news/256.bugfix\nnew file mode 100644\nindex 00000000..15070fdd\n--- /dev/null\n+++ b/news/256.bugfix\n@@ -0,0 +1 @@\n+Fix cancel button on @@select_default_view [sverbois]\ndiff --git a/plone/app/content/browser/selection.py b/plone/app/content/browser/selection.py\nindex e0426c89..1d5a7327 100644\n--- a/plone/app/content/browser/selection.py\n+++ b/plone/app/content/browser/selection.py\n@@ -42,19 +42,25 @@ def __call__(self):\n             (self.context, self.request), name="plone_context_state"\n         )\n \n-        templateId = self.request.form.get("templateId", False)\n-        if templateId:\n+        template_id = self.request.form.get("templateId")\n+        context_view_url = self.context_state.object_url() + "/view"\n+\n+        if self.request.form.get("form.button.Cancel"):\n+            self.request.response.redirect(context_view_url)\n+\n+        if self.request.form.get("form.button.Save") and not template_id:\n+            IStatusMessage(self.request).add("Please select a template.", type="warning")\n+\n+        if self.request.form.get("form.button.Save") and template_id:\n             # Make sure this is a valid template\n-            if not self.isValidTemplate(templateId):\n+            if not self.isValidTemplate(template_id):\n                 IStatusMessage(self.request).add("Invalid view.", type="error")\n                 return self.index()\n             # Update the template\n-            self.context.setLayout(templateId)\n+            self.context.setLayout(template_id)\n             IStatusMessage(self.request).add("View changed.")\n-\n-        if templateId or self.request.form.get("form.buttons.Cancel", False):\n-            # Redirect to view\n-            self.request.response.redirect("%s/view" % self.context_state.object_url())\n+            # Redirect to context view\n+            self.request.response.redirect(context_view_url)\n \n         return self.index()\n \n'

