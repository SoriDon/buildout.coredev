Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2021-11-14T21:44:57+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.portlets/commit/2b83bc32a8a2b13b36b9212a64c98eb5596a4daf

dot imports

Files changed:
M plone/__init__.py
M plone/app/__init__.py
M plone/app/portlets/assignable.py
M plone/app/portlets/browser/adding.py
M plone/app/portlets/browser/editmanager.py
M plone/app/portlets/browser/formhelper.py
M plone/app/portlets/browser/manage.py
M plone/app/portlets/browser/traversal.py
M plone/app/portlets/browser/utils.py
M plone/app/portlets/checker.py
M plone/app/portlets/dashboard.py
M plone/app/portlets/exportimport/__init__.py
M plone/app/portlets/exportimport/portlets.py
M plone/app/portlets/manager.py
M plone/app/portlets/metaconfigure.py
M plone/app/portlets/metadirectives.py
M plone/app/portlets/portlets/__init__.py
M plone/app/portlets/portlets/actions.py
M plone/app/portlets/portlets/base.py
M plone/app/portlets/portlets/classic.py
M plone/app/portlets/portlets/language.py
M plone/app/portlets/portlets/login.py
M plone/app/portlets/portlets/navigation.py
M plone/app/portlets/portlets/news.py
M plone/app/portlets/portlets/recent.py
M plone/app/portlets/portlets/review.py
M plone/app/portlets/portlets/rss.py
M plone/app/portlets/portlets/search.py
M plone/app/portlets/storage.py

b'diff --git a/plone/__init__.py b/plone/__init__.py\nindex 05f0bebb..5284146e 100644\n--- a/plone/__init__.py\n+++ b/plone/__init__.py\n@@ -1,7 +1 @@\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/__init__.py b/plone/app/__init__.py\nindex 05f0bebb..5284146e 100644\n--- a/plone/app/__init__.py\n+++ b/plone/app/__init__.py\n@@ -1,7 +1 @@\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/portlets/assignable.py b/plone/app/portlets/assignable.py\nindex b6b0471d..902b34b8 100644\n--- a/plone/app/portlets/assignable.py\n+++ b/plone/app/portlets/assignable.py\n@@ -1,4 +1,4 @@\n-from plone.app.portlets.storage import PortletAssignmentMapping\n+from .storage import PortletAssignmentMapping\n from plone.portlets.constants import CONTEXT_ASSIGNMENT_KEY\n from plone.portlets.constants import CONTEXT_CATEGORY\n from plone.portlets.interfaces import ILocalPortletAssignable\ndiff --git a/plone/app/portlets/browser/adding.py b/plone/app/portlets/browser/adding.py\nindex 48340277..656babe3 100644\n--- a/plone/app/portlets/browser/adding.py\n+++ b/plone/app/portlets/browser/adding.py\n@@ -1,9 +1,9 @@\n+from ..interfaces import IPortletPermissionChecker\n+from .interfaces import IPortletAdding\n from Acquisition import aq_base\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n from OFS.SimpleItem import SimpleItem\n-from plone.app.portlets.browser.interfaces import IPortletAdding\n-from plone.app.portlets.interfaces import IPortletPermissionChecker\n from Products.CMFCore.utils import getToolByName\n from Products.Five import BrowserView\n from warnings import warn\ndiff --git a/plone/app/portlets/browser/editmanager.py b/plone/app/portlets/browser/editmanager.py\nindex 80a4851a..5e5842b2 100644\n--- a/plone/app/portlets/browser/editmanager.py\n+++ b/plone/app/portlets/browser/editmanager.py\n@@ -1,14 +1,14 @@\n+from ..interfaces import IDashboard\n+from ..interfaces import IPortletPermissionChecker\n+from .interfaces import IManageColumnPortletsView\n+from .interfaces import IManageContextualPortletsView\n+from .interfaces import IManageDashboardPortletsView\n from AccessControl import Unauthorized\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n from Acquisition import Explicit\n from Acquisition.interfaces import IAcquirer\n from five.customerize.zpt import TTWViewTemplateRenderer\n-from plone.app.portlets.browser.interfaces import IManageColumnPortletsView\n-from plone.app.portlets.browser.interfaces import IManageContextualPortletsView\n-from plone.app.portlets.browser.interfaces import IManageDashboardPortletsView\n-from plone.app.portlets.interfaces import IDashboard\n-from plone.app.portlets.interfaces import IPortletPermissionChecker\n from plone.memoize.view import memoize\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n from plone.portlets.constants import CONTEXT_CATEGORY\ndiff --git a/plone/app/portlets/browser/formhelper.py b/plone/app/portlets/browser/formhelper.py\nindex 7740d25a..3a104c73 100644\n--- a/plone/app/portlets/browser/formhelper.py\n+++ b/plone/app/portlets/browser/formhelper.py\n@@ -1,11 +1,11 @@\n+from .. import PloneMessageFactory as _\n+from ..browser.interfaces import IPortletAddForm\n+from ..browser.interfaces import IPortletEditForm\n+from ..interfaces import IPortletPermissionChecker\n from Acquisition import aq_base\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n from Acquisition.interfaces import IAcquirer\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.browser.interfaces import IPortletAddForm\n-from plone.app.portlets.browser.interfaces import IPortletEditForm\n-from plone.app.portlets.interfaces import IPortletPermissionChecker\n from plone.autoform.form import AutoExtensibleForm\n from Products.CMFCore.utils import getToolByName\n from Products.Five.browser import BrowserView\ndiff --git a/plone/app/portlets/browser/manage.py b/plone/app/portlets/browser/manage.py\nindex 916bf7b0..0face36a 100644\n--- a/plone/app/portlets/browser/manage.py\n+++ b/plone/app/portlets/browser/manage.py\n@@ -1,17 +1,17 @@\n+from ..interfaces import IPortletPermissionChecker\n+from ..interfaces import ITopbarManagePortlets\n+from ..storage import GroupDashboardPortletAssignmentMapping\n+from ..storage import PortletAssignmentMapping\n+from ..storage import UserPortletAssignmentMapping\n+from .interfaces import IManageContentTypePortletsView\n+from .interfaces import IManageContextualPortletsView\n+from .interfaces import IManageDashboardPortletsView\n+from .interfaces import IManageGroupPortletsView\n+from .interfaces import IManagePortletsView\n from AccessControl import Unauthorized\n from Acquisition import aq_base\n from Acquisition import aq_inner\n from plone.app.portlets import utils\n-from plone.app.portlets.browser.interfaces import IManageContentTypePortletsView\n-from plone.app.portlets.browser.interfaces import IManageContextualPortletsView\n-from plone.app.portlets.browser.interfaces import IManageDashboardPortletsView\n-from plone.app.portlets.browser.interfaces import IManageGroupPortletsView\n-from plone.app.portlets.browser.interfaces import IManagePortletsView\n-from plone.app.portlets.interfaces import IPortletPermissionChecker\n-from plone.app.portlets.interfaces import ITopbarManagePortlets\n-from plone.app.portlets.storage import GroupDashboardPortletAssignmentMapping\n-from plone.app.portlets.storage import PortletAssignmentMapping\n-from plone.app.portlets.storage import UserPortletAssignmentMapping\n from plone.memoize.view import memoize\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n from plone.portlets.constants import CONTEXT_CATEGORY\ndiff --git a/plone/app/portlets/browser/traversal.py b/plone/app/portlets/browser/traversal.py\nindex 8a50bb28..310b3b8f 100644\n--- a/plone/app/portlets/browser/traversal.py\n+++ b/plone/app/portlets/browser/traversal.py\n@@ -1,6 +1,6 @@\n-from plone.app.portlets.storage import GroupDashboardPortletAssignmentMapping\n-from plone.app.portlets.storage import PortletAssignmentMapping\n-from plone.app.portlets.storage import UserPortletAssignmentMapping\n+from ..storage import GroupDashboardPortletAssignmentMapping\n+from ..storage import PortletAssignmentMapping\n+from ..storage import UserPortletAssignmentMapping\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n from plone.portlets.constants import GROUP_CATEGORY\n from plone.portlets.constants import USER_CATEGORY\ndiff --git a/plone/app/portlets/browser/utils.py b/plone/app/portlets/browser/utils.py\nindex c86749f8..d4a32dbd 100644\n--- a/plone/app/portlets/browser/utils.py\n+++ b/plone/app/portlets/browser/utils.py\n@@ -1,5 +1,5 @@\n-from plone.app.portlets.interfaces import IDeferredPortletRenderer\n-from plone.app.portlets.utils import assignment_from_key\n+from ..interfaces import IDeferredPortletRenderer\n+from ..utils import assignment_from_key\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletRenderer\n from plone.portlets.utils import unhashPortletInfo\ndiff --git a/plone/app/portlets/checker.py b/plone/app/portlets/checker.py\nindex 274deeef..079a7055 100644\n--- a/plone/app/portlets/checker.py\n+++ b/plone/app/portlets/checker.py\n@@ -1,9 +1,9 @@\n+from .interfaces import IGroupDashboardPortletAssignmentMapping\n+from .interfaces import IPortletPermissionChecker\n+from .interfaces import IUserPortletAssignmentMapping\n from AccessControl import getSecurityManager\n from AccessControl import Unauthorized\n from Acquisition import aq_inner\n-from plone.app.portlets.interfaces import IGroupDashboardPortletAssignmentMapping\n-from plone.app.portlets.interfaces import IPortletPermissionChecker\n-from plone.app.portlets.interfaces import IUserPortletAssignmentMapping\n from plone.portlets.interfaces import IPortletAssignmentMapping\n from zope.component import adapter\n from zope.interface import implementer\ndiff --git a/plone/app/portlets/dashboard.py b/plone/app/portlets/dashboard.py\nindex cf1cce8e..a712053f 100644\n--- a/plone/app/portlets/dashboard.py\n+++ b/plone/app/portlets/dashboard.py\n@@ -1,6 +1,6 @@\n-from plone.app.portlets import portlets\n-from plone.app.portlets.interfaces import IDefaultDashboard\n-from plone.app.portlets.storage import UserPortletAssignmentMapping\n+from . import portlets\n+from .interfaces import IDefaultDashboard\n+from .storage import UserPortletAssignmentMapping\n from plone.portlets.constants import USER_CATEGORY\n from plone.portlets.interfaces import IPortletManager\n from Products.PluggableAuthService.interfaces.authservice import IPropertiedUser\ndiff --git a/plone/app/portlets/exportimport/__init__.py b/plone/app/portlets/exportimport/__init__.py\nindex 792d6005..e69de29b 100644\n--- a/plone/app/portlets/exportimport/__init__.py\n+++ b/plone/app/portlets/exportimport/__init__.py\n@@ -1 +0,0 @@\n-#\ndiff --git a/plone/app/portlets/exportimport/portlets.py b/plone/app/portlets/exportimport/portlets.py\nindex f0e30a51..6c404fac 100644\n--- a/plone/app/portlets/exportimport/portlets.py\n+++ b/plone/app/portlets/exportimport/portlets.py\n@@ -76,13 +76,11 @@\n \n """\n \n+from ..interfaces import IDefaultPortletManager\n+from ..interfaces import IPortletTypeInterface\n+from ..utils import assignment_mapping_from_key\n+from .interfaces import IPortletAssignmentExportImportHandler\n from operator import attrgetter\n-from plone.app.portlets.exportimport.interfaces import (\n-    IPortletAssignmentExportImportHandler,\n-)\n-from plone.app.portlets.interfaces import IDefaultPortletManager\n-from plone.app.portlets.interfaces import IPortletTypeInterface\n-from plone.app.portlets.utils import assignment_mapping_from_key\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n from plone.portlets.constants import CONTEXT_CATEGORY\n from plone.portlets.constants import GROUP_CATEGORY\ndiff --git a/plone/app/portlets/manager.py b/plone/app/portlets/manager.py\nindex e7f3e943..90743b7d 100644\n--- a/plone/app/portlets/manager.py\n+++ b/plone/app/portlets/manager.py\n@@ -1,8 +1,8 @@\n+from .interfaces import IColumn\n+from .interfaces import IDashboard\n from Acquisition import aq_acquire\n from Acquisition import aq_inner\n from Acquisition import Explicit\n-from plone.app.portlets.interfaces import IColumn\n-from plone.app.portlets.interfaces import IDashboard\n from plone.portlets.interfaces import IPortletRenderer\n from plone.portlets.manager import PortletManagerRenderer as BasePortletManagerRenderer\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\ndiff --git a/plone/app/portlets/metaconfigure.py b/plone/app/portlets/metaconfigure.py\nindex 2296c7cb..2dff5aae 100644\n--- a/plone/app/portlets/metaconfigure.py\n+++ b/plone/app/portlets/metaconfigure.py\n@@ -1,5 +1,5 @@\n-from plone.app.portlets.browser.interfaces import IPortletAdding\n-from plone.app.portlets.interfaces import IPortletTypeInterface\n+from .browser.interfaces import IPortletAdding\n+from .interfaces import IPortletTypeInterface\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletRenderer\n from Products.Five.browser.metaconfigure import page\ndiff --git a/plone/app/portlets/metadirectives.py b/plone/app/portlets/metadirectives.py\nindex 051bd9a2..c00664cb 100644\n--- a/plone/app/portlets/metadirectives.py\n+++ b/plone/app/portlets/metadirectives.py\n@@ -1,4 +1,4 @@\n-from plone.app.portlets import PloneMessageFactory as _\n+from . import PloneMessageFactory as _\n from plone.portlets.interfaces import IPortletManager\n from zope import schema\n from zope.configuration import fields as configuration_fields\ndiff --git a/plone/app/portlets/portlets/__init__.py b/plone/app/portlets/portlets/__init__.py\nindex 792d6005..e69de29b 100644\n--- a/plone/app/portlets/portlets/__init__.py\n+++ b/plone/app/portlets/portlets/__init__.py\n@@ -1 +0,0 @@\n-#\ndiff --git a/plone/app/portlets/portlets/actions.py b/plone/app/portlets/portlets/actions.py\nindex afb24374..7e8d3c14 100644\n--- a/plone/app/portlets/portlets/actions.py\n+++ b/plone/app/portlets/portlets/actions.py\n@@ -1,6 +1,6 @@\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from Acquisition import aq_inner\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.memoize import view as pm_view\n from plone.portlets.interfaces import IPortletDataProvider\ndiff --git a/plone/app/portlets/portlets/base.py b/plone/app/portlets/portlets/base.py\nindex 05840a15..cfe507cb 100644\n--- a/plone/app/portlets/portlets/base.py\n+++ b/plone/app/portlets/portlets/base.py\n@@ -1,9 +1,7 @@\n+from ..browser.formhelper import AddForm\n+from ..browser.formhelper import EditForm\n+from ..browser.formhelper import NullAddForm\n from OFS.SimpleItem import SimpleItem\n-\n-# Convenience imports\n-from plone.app.portlets.browser.formhelper import AddForm\n-from plone.app.portlets.browser.formhelper import EditForm\n-from plone.app.portlets.browser.formhelper import NullAddForm\n from plone.app.portlets.interfaces import IDeferredPortletRenderer\n from plone.portlets.interfaces import IPortletAssignment\n from plone.portlets.interfaces import IPortletRenderer\ndiff --git a/plone/app/portlets/portlets/classic.py b/plone/app/portlets/portlets/classic.py\nindex 6d9e45c3..9a1b1ea2 100644\n--- a/plone/app/portlets/portlets/classic.py\n+++ b/plone/app/portlets/portlets/classic.py\n@@ -1,5 +1,5 @@\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\ndiff --git a/plone/app/portlets/portlets/language.py b/plone/app/portlets/portlets/language.py\nindex 368a3c03..23906b7d 100644\n--- a/plone/app/portlets/portlets/language.py\n+++ b/plone/app/portlets/portlets/language.py\n@@ -1,6 +1,6 @@\n from plone.app.i18n.locales.browser.selector import LanguageSelector\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getMultiAdapter\ndiff --git a/plone/app/portlets/portlets/login.py b/plone/app/portlets/portlets/login.py\nindex 9314e23a..3f6cc1ac 100644\n--- a/plone/app/portlets/portlets/login.py\n+++ b/plone/app/portlets/portlets/login.py\n@@ -1,5 +1,5 @@\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from plone.memoize.instance import memoize\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.CMFCore.utils import getToolByName\ndiff --git a/plone/app/portlets/portlets/navigation.py b/plone/app/portlets/portlets/navigation.py\nindex a32b7ce7..0e9378cc 100644\n--- a/plone/app/portlets/portlets/navigation.py\n+++ b/plone/app/portlets/portlets/navigation.py\n@@ -1,3 +1,5 @@\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from Acquisition import aq_base\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n@@ -8,8 +10,6 @@\n from plone.app.layout.navigation.navtree import buildFolderTree\n from plone.app.layout.navigation.root import getNavigationRoot\n from plone.app.layout.navigation.root import getNavigationRootObject\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n from plone.app.uuid.utils import uuidToObject\n from plone.app.vocabularies.catalog import CatalogSource\n from plone.i18n.normalizer.interfaces import IIDNormalizer\ndiff --git a/plone/app/portlets/portlets/news.py b/plone/app/portlets/portlets/news.py\nindex ec3aabd2..0075ee9d 100644\n--- a/plone/app/portlets/portlets/news.py\n+++ b/plone/app/portlets/portlets/news.py\n@@ -1,8 +1,8 @@\n+from .. import PloneMessageFactory as _\n+from ..cache import render_cachekey\n+from ..portlets import base\n from Acquisition import aq_inner\n from plone.app.layout.navigation.root import getNavigationRootObject\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.cache import render_cachekey\n-from plone.app.portlets.portlets import base\n from plone.app.z3cform.widget import SelectFieldWidget\n from plone.autoform.directives import widget\n from plone.memoize import ram\ndiff --git a/plone/app/portlets/portlets/recent.py b/plone/app/portlets/portlets/recent.py\nindex e0178218..1893c525 100644\n--- a/plone/app/portlets/portlets/recent.py\n+++ b/plone/app/portlets/portlets/recent.py\n@@ -1,8 +1,8 @@\n+from .. import PloneMessageFactory as _\n+from ..cache import render_cachekey\n+from ..portlets import base\n from Acquisition import aq_inner\n from plone.app.layout.navigation.root import getNavigationRoot\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.cache import render_cachekey\n-from plone.app.portlets.portlets import base\n from plone.memoize import ram\n from plone.memoize.compress import xhtml_compress\n from plone.memoize.instance import memoize\ndiff --git a/plone/app/portlets/portlets/review.py b/plone/app/portlets/portlets/review.py\nindex e59d8360..cba8d97f 100644\n--- a/plone/app/portlets/portlets/review.py\n+++ b/plone/app/portlets/portlets/review.py\n@@ -1,7 +1,7 @@\n+from .. import PloneMessageFactory as _\n+from ..browser import formhelper\n+from ..portlets import base\n from Acquisition import aq_inner\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.browser import formhelper\n-from plone.app.portlets.portlets import base\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.memoize.instance import memoize\n from plone.portlets.interfaces import IPortletDataProvider\ndiff --git a/plone/app/portlets/portlets/rss.py b/plone/app/portlets/portlets/rss.py\nindex 6cf4ce12..c53a37bd 100644\n--- a/plone/app/portlets/portlets/rss.py\n+++ b/plone/app/portlets/portlets/rss.py\n@@ -1,8 +1,8 @@\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from DateTime import DateTime\n from DateTime.interfaces import DateTimeError\n from logging import getLogger\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.Five.browser.pagetemplatefile import ZopeTwoPageTemplateFile\n from urllib.parse import urlparse\ndiff --git a/plone/app/portlets/portlets/search.py b/plone/app/portlets/portlets/search.py\nindex f4813280..db7b3a68 100644\n--- a/plone/app/portlets/portlets/search.py\n+++ b/plone/app/portlets/portlets/search.py\n@@ -1,6 +1,6 @@\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from plone.app.layout.navigation.root import getNavigationRoot\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\ndiff --git a/plone/app/portlets/storage.py b/plone/app/portlets/storage.py\nindex 8a4eba53..fd3dd3f6 100644\n--- a/plone/app/portlets/storage.py\n+++ b/plone/app/portlets/storage.py\n@@ -1,8 +1,8 @@\n+from .portlets.interfaces import IGroupDashboardPortletAssignmentMapping\n+from .portlets.interfaces import IUserPortletAssignmentMapping\n from Acquisition import aq_base\n from BTrees.OOBTree import OOBTree\n from OFS.SimpleItem import SimpleItem\n-from plone.app.portlets.interfaces import IGroupDashboardPortletAssignmentMapping\n-from plone.app.portlets.interfaces import IUserPortletAssignmentMapping\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.portlets import constants\n from plone.portlets.constants import CONTEXT_ASSIGNMENT_KEY\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2021-11-14T22:26:30+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.portlets/commit/f92ce54ff5443f170870e0888d8f32a6b64f5a6d

move traces of portlets from plone.app.layout

Files changed:
A plone/app/portlets/browser/templates/footer.pt
A plone/app/portlets/browser/templates/manage_portlets_fallback.pt
A plone/app/portlets/browser/viewlets.py
A plone/app/portlets/dashboard/__init__.py
A plone/app/portlets/dashboard/configure.zcml
A plone/app/portlets/dashboard/dashboard.pt
A plone/app/portlets/dashboard/dashboard.py
A plone/app/portlets/dashboard/user_actions.pt
A plone/app/portlets/dashboard/user_actions.py
M plone/app/portlets/browser/configure.zcml
M plone/app/portlets/configure.zcml
M plone/app/portlets/storage.py
D plone/app/portlets/dashboard.py

b'diff --git a/plone/app/portlets/browser/configure.zcml b/plone/app/portlets/browser/configure.zcml\nindex 8ba32160..ea8adbee 100644\n--- a/plone/app/portlets/browser/configure.zcml\n+++ b/plone/app/portlets/browser/configure.zcml\n@@ -227,4 +227,23 @@\n         permission="zope2.View"\n         />\n \n+    <!-- Portlets Footer -->\n+    <browser:viewlet\n+        name="plone.footer"\n+        for="*"\n+        manager="plone.app.layout.viewlets.interfaces.IPortalFooter"\n+        class=".viewlets.FooterViewlet"\n+        permission="zope.Public"\n+        />\n+\n+    <!-- Manage portlets Fallback link -->\n+    <browser:viewlet\n+        name="plone.manage_portlets_fallback"\n+        for="plone.portlets.interfaces.ILocalPortletAssignable"\n+        view="plone.app.layout.globals.interfaces.IViewView"\n+        manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n+        class=".viewlets.ManagePortletsFallbackViewlet"\n+        permission="zope2.View"\n+        />\n+\n </configure>\ndiff --git a/plone/app/portlets/browser/templates/footer.pt b/plone/app/portlets/browser/templates/footer.pt\nnew file mode 100644\nindex 00000000..df16ba9d\n--- /dev/null\n+++ b/plone/app/portlets/browser/templates/footer.pt\n@@ -0,0 +1,5 @@\n+<div class="row">\n+\t<div class="col-xs-12">\n+\t\t<div tal:on-error="nothing" tal:replace="structure view/render_footer_portlets" />\n+\t</div>\n+</div>\ndiff --git a/plone/app/portlets/browser/templates/manage_portlets_fallback.pt b/plone/app/portlets/browser/templates/manage_portlets_fallback.pt\nnew file mode 100644\nindex 00000000..ec5592d9\n--- /dev/null\n+++ b/plone/app/portlets/browser/templates/manage_portlets_fallback.pt\n@@ -0,0 +1,14 @@\n+<div tal:condition="view/available" class="row managePortlets-row">\n+\t<tal:comment tal:condition="nothing">\n+\t\t**********\n+\t\tNEEDED COL\n+\t\t**********\n+\t</tal:comment>\n+    <a class="managePortletsFallback"\n+        tal:attributes="href string:${view/object_url}/@@manage-portlets"\n+        i18n:domain="plone"\n+        i18n:translate="manage_portlets_link">\n+        Manage portlets\n+    </a>\n+\n+</div>\n\\ No newline at end of file\ndiff --git a/plone/app/portlets/browser/viewlets.py b/plone/app/portlets/browser/viewlets.py\nnew file mode 100644\nindex 00000000..6a365f00\n--- /dev/null\n+++ b/plone/app/portlets/browser/viewlets.py\n@@ -0,0 +1,68 @@\n+from zope.component import getMultiAdapter\n+from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n+from plone.app.layout.viewlets.common import ViewletBase\n+from AccessControl import getSecurityManager\n+from datetime import date\n+\n+\n+class ManagePortletsFallbackViewlet(ViewletBase):\n+    """Manage portlets fallback link that sits below content"""\n+\n+    index = ViewPageTemplateFile("templates/manage_portlets_fallback.pt")\n+\n+    def update(self):\n+        plonelayout = getMultiAdapter(\n+            (self.context, self.request), name=u"plone_layout"\n+        )\n+        context_state = getMultiAdapter(\n+            (self.context, self.request), name=u"plone_context_state"\n+        )\n+\n+        self.portlet_assignable = context_state.portlet_assignable()\n+        self.sl = plonelayout.have_portlets("plone.leftcolumn", self.context)\n+        self.sr = plonelayout.have_portlets("plone.rightcolumn", self.context)\n+        self.object_url = context_state.object_url()\n+\n+    def available(self):\n+        secman = getSecurityManager()\n+        has_manage_portlets_permission = secman.checkPermission(\n+            "Portlets: Manage portlets", self.context\n+        )\n+        if not has_manage_portlets_permission:\n+            return False\n+        return bool(not self.sl and not self.sr and self.portlet_assignable)\n+\n+class FooterViewlet(ViewletBase):\n+    index = ViewPageTemplateFile("templates/footer.pt")\n+\n+    def update(self):\n+        super(FooterViewlet, self).update()\n+        self.year = date.today().year\n+\n+    def render_footer_portlets(self):\n+        """\n+        You might ask, why is this necessary. Well, let me tell you a story...\n+\n+        plone.app.portlets, in order to provide @@manage-portlets on a context,\n+        overrides the IPortletRenderer for the IManageContextualPortletsView\n+        view.\n+        See plone.portlets and plone.app.portlets\n+\n+        Seems fine right? Well, most of the time it is. Except, here.\n+        Previously, we were just using the syntax like\n+        `provider:plone.footerportlets` to render the footer portlets.\n+        Since this tal expression was inside a viewlet,\n+        the view is no longer IManageContextualPortletsView when\n+        visiting @@manage-portlets. Instead, it was IViewlet.\n+        See zope.contentprovider\n+\n+        In to fix this short coming, we render the portlet column by\n+        manually doing the multi adapter lookup and then manually\n+        doing the rendering for the content provider.\n+        See zope.contentprovider\n+        """\n+        portlet_manager = getMultiAdapter(\n+            (self.context, self.request, self.__parent__), name="plone.footerportlets"\n+        )\n+        portlet_manager.update()\n+        return portlet_manager.render()\ndiff --git a/plone/app/portlets/configure.zcml b/plone/app/portlets/configure.zcml\nindex 5a153bce..b4b59569 100644\n--- a/plone/app/portlets/configure.zcml\n+++ b/plone/app/portlets/configure.zcml\n@@ -12,6 +12,7 @@\n     <include file="permissions.zcml" />\n \n     <include package=".browser" />\n+    <include package=".dashboard" />\n     <include package=".exportimport" />\n     <include package=".portlets" />\n \ndiff --git a/plone/app/portlets/dashboard.py b/plone/app/portlets/dashboard/__init__.py\nsimilarity index 94%\nrename from plone/app/portlets/dashboard.py\nrename to plone/app/portlets/dashboard/__init__.py\nindex a712053f..38c106b7 100644\n--- a/plone/app/portlets/dashboard.py\n+++ b/plone/app/portlets/dashboard/__init__.py\n@@ -1,6 +1,6 @@\n-from . import portlets\n-from .interfaces import IDefaultDashboard\n-from .storage import UserPortletAssignmentMapping\n+from .. import portlets\n+from ..interfaces import IDefaultDashboard\n+from ..storage import UserPortletAssignmentMapping\n from plone.portlets.constants import USER_CATEGORY\n from plone.portlets.interfaces import IPortletManager\n from Products.PluggableAuthService.interfaces.authservice import IPropertiedUser\ndiff --git a/plone/app/portlets/dashboard/configure.zcml b/plone/app/portlets/dashboard/configure.zcml\nnew file mode 100644\nindex 00000000..c206737c\n--- /dev/null\n+++ b/plone/app/portlets/dashboard/configure.zcml\n@@ -0,0 +1,22 @@\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser">\n+\n+    <browser:page\n+        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n+        name="dashboard"\n+        permission="plone.app.portlets.ViewDashboard"\n+        class=".dashboard.DashboardView"\n+        template="dashboard.pt"\n+        />\n+\n+    <!-- this view provides a not-js fallback for the user dropdown menu.\n+    It has been placed here to be near the personal bar code -->\n+    <browser:page\n+        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n+        name="useractions"\n+        permission="zope2.View"\n+        class=".user_actions.UserActionsView"\n+        template="user_actions.pt"\n+        />\n+</configure>\ndiff --git a/plone/app/portlets/dashboard/dashboard.pt b/plone/app/portlets/dashboard/dashboard.pt\nnew file mode 100644\nindex 00000000..71de849a\n--- /dev/null\n+++ b/plone/app/portlets/dashboard/dashboard.pt\n@@ -0,0 +1,70 @@\n+<html\n+    xmlns="http://www.w3.org/1999/xhtml"\n+    xml:lang="en"\n+    xmlns:tal="http://xml.zope.org/namespaces/tal"\n+    xmlns:metal="http://xml.zope.org/namespaces/metal"\n+    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+    lang="en"\n+    metal:use-macro="context/main_template/macros/master"\n+    i18n:domain="plone">\n+\n+  <body>\n+\n+    <metal:b fill-slot="content-title">\n+      <h1\n+          class="documentFirstHeading"\n+          i18n:translate="heading_dashboard"\n+          tal:define="memberinfo context/portal_membership/getMemberInfo;\n+                  member context/@@plone_portal_state/member;\n+                  name python:memberinfo[\'fullname\'] or member.getId() or member.getId()">\n+        <span\n+            tal:replace="name"\n+            i18n:name="user_name" />\n+        &#8217;s dashboard\n+      </h1>\n+    </metal:b>\n+\n+    <metal:b fill-slot="content-core">\n+      <tal:b metal:define-macro="content-core">\n+\n+        <div class="autotabs">\n+          <nav class="autotoc-nav nav nav-tabs mb-3">\n+            <span class="nav-item">\n+              <a\n+                  class="active nav-link"\n+                  href="${context/@@plone_portal_state/navigation_root_url}/dashboard"\n+                  i18n:translate="label_dashboard">Dashboard</a>\n+            </span>\n+            <span class="nav-item">\n+              <a\n+                  href="${context/@@plone_portal_state/navigation_root_url}/@@manage-dashboard?_authenticator=${view/auth_token}"\n+                  class="nav-link"\n+                  i18n:translate="label_edit">Edit</a>\n+            </span>\n+          </nav>\n+\n+\n+          <div\n+              id="dashboard"\n+              class="row row-cols-1 row-cols-md-2 gy-2">\n+            <div\n+                id="dashboard-portlets1"\n+                tal:content="structure provider:plone.dashboard1" />\n+            <div\n+                id="dashboard-portlets2"\n+                tal:content="structure provider:plone.dashboard2" />\n+            <div\n+                id="dashboard-portlets3"\n+                tal:content="structure provider:plone.dashboard3" />\n+            <div\n+                id="dashboard-portlets4"\n+                tal:content="structure provider:plone.dashboard4" />\n+          </div>\n+\n+        </div>\n+\n+      </tal:b>\n+    </metal:b>\n+\n+  </body>\n+</html>\ndiff --git a/plone/app/portlets/dashboard/dashboard.py b/plone/app/portlets/dashboard/dashboard.py\nnew file mode 100644\nindex 00000000..abc42837\n--- /dev/null\n+++ b/plone/app/portlets/dashboard/dashboard.py\n@@ -0,0 +1,72 @@\n+# -*- coding: utf-8 -*-\n+from AccessControl import getSecurityManager\n+from plone.memoize.instance import memoize\n+from plone.portlets.constants import GROUP_CATEGORY\n+from plone.portlets.constants import USER_CATEGORY\n+from plone.portlets.interfaces import IPortletManager\n+from plone.protect.authenticator import createToken\n+from Products.CMFCore.utils import getToolByName\n+from Products.CMFPlone import PloneMessageFactory as _\n+from Products.Five.browser import BrowserView\n+from Products.statusmessages.interfaces import IStatusMessage\n+from zope.component import getUtility\n+from zope.interface import implementer\n+from zope.interface import Interface\n+\n+\n+class IDashboard(Interface):\n+    """the dashboard display columns of portlet to the loggedin user"""\n+\n+\n+@implementer(IDashboard)\n+class DashboardView(BrowserView):\n+    """Power the dashboard"""\n+\n+    def __call__(self):\n+        self.request.set("disable_border", 1)\n+        self.request.set("disable_plone.leftcolumn", 1)\n+        self.request.set("disable_plone.rightcolumn", 1)\n+        if self.can_edit() and self.empty():\n+            message = _(\n+                u"info_empty_dashboard",\n+                default=u"Your dashboard is currently empty. Click the"\n+                " <em>edit</em> tab to assign some personal"\n+                " portlets.",\n+            )\n+            IStatusMessage(self.request).add(message)\n+        return self.index()\n+\n+    @property\n+    def auth_token(self):\n+        return createToken()\n+\n+    @memoize\n+    def can_edit(self):\n+        return bool(\n+            getSecurityManager().checkPermission(\n+                "Portlets: Manage own portlets", self.context\n+            )\n+        )\n+\n+    @memoize\n+    def empty(self):\n+        dashboards = [\n+            getUtility(IPortletManager, name=name)\n+            for name in [\n+                "plone.dashboard1",\n+                "plone.dashboard2",\n+                "plone.dashboard3",\n+                "plone.dashboard4",\n+            ]\n+        ]\n+\n+        portal_membership = getToolByName(self.context, "portal_membership")\n+        member = portal_membership.getAuthenticatedMember()\n+        userid = member.getId()\n+\n+        num_portlets = 0\n+        for dashboard in dashboards:\n+            num_portlets += len(dashboard.get(USER_CATEGORY, {}).get(userid, {}))\n+            for groupid in member.getGroups():\n+                num_portlets += len(dashboard.get(GROUP_CATEGORY, {}).get(groupid, {}))\n+        return num_portlets == 0\ndiff --git a/plone/app/portlets/dashboard/user_actions.pt b/plone/app/portlets/dashboard/user_actions.pt\nnew file mode 100644\nindex 00000000..ce532f1f\n--- /dev/null\n+++ b/plone/app/portlets/dashboard/user_actions.pt\n@@ -0,0 +1,35 @@\n+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      i18n:domain="plone">\n+\n+<head>\n+    <metal:block fill-slot="top_slot"\n+                 tal:define="dummy python:request.set(\'disable_border\',1);\n+                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n+</head>\n+\n+<body>\n+\n+<metal:main fill-slot="main">\n+<h1 i18n:translate="" class="documentFirstHeading">User Actions</h1>\n+<ul id="user-actions">\n+    <li tal:repeat="action view/user_actions">\n+        <a href=""\n+           tal:attributes="href action/url;\n+                           target action/link_target|nothing;\n+                           id string:personaltoolspage-${action/id};"\n+           tal:content="action/title"\n+           i18n:translate="">\n+            action title\n+        </a>\n+    </li>\n+</ul>\n+</metal:main>\n+\n+</body>\n+</html>\ndiff --git a/plone/app/portlets/dashboard/user_actions.py b/plone/app/portlets/dashboard/user_actions.py\nnew file mode 100644\nindex 00000000..64e10f96\n--- /dev/null\n+++ b/plone/app/portlets/dashboard/user_actions.py\n@@ -0,0 +1,15 @@\n+# -*- coding: utf-8 -*-\n+from Products.Five.browser import BrowserView\n+from zope.component import getMultiAdapter\n+\n+\n+class UserActionsView(BrowserView):\n+    """Power the useraction fallback page"""\n+\n+    def user_actions(self):\n+        context_state = getMultiAdapter(\n+            (self.context, self.request), name=u"plone_context_state"\n+        )\n+\n+        actions = context_state.actions("user")\n+        return actions\ndiff --git a/plone/app/portlets/storage.py b/plone/app/portlets/storage.py\nindex fd3dd3f6..dca4820b 100644\n--- a/plone/app/portlets/storage.py\n+++ b/plone/app/portlets/storage.py\n@@ -1,5 +1,5 @@\n-from .portlets.interfaces import IGroupDashboardPortletAssignmentMapping\n-from .portlets.interfaces import IUserPortletAssignmentMapping\n+from .interfaces import IGroupDashboardPortletAssignmentMapping\n+from .interfaces import IUserPortletAssignmentMapping\n from Acquisition import aq_base\n from BTrees.OOBTree import OOBTree\n from OFS.SimpleItem import SimpleItem\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2021-11-14T23:09:46+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.portlets/commit/d2c375a4fc61ea4783977c8a3fef1ea2dc4fe599

Document changes

Files changed:
A news/160.breaking

b'diff --git a/news/160.breaking b/news/160.breaking\nnew file mode 100644\nindex 00000000..3875ecf5\n--- /dev/null\n+++ b/news/160.breaking\n@@ -0,0 +1,4 @@\n+Move most (hard dependency) portlet related from `plone.app.layout`:\n+Dashboard, Portlet related viewlets.\n+A first step towards a Portlet-as-an-Addon story.\n+[jensens]\n\\ No newline at end of file\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2021-11-19T09:39:31+01:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.portlets/commit/045a2397fa10ce867cc948d8aaf6b7b64ee34070

Merge pull request #160 from plone/refactor

Move all portlet related from p.a.layout

Files changed:
A news/160.breaking
A plone/app/portlets/browser/templates/footer.pt
A plone/app/portlets/browser/templates/manage_portlets_fallback.pt
A plone/app/portlets/browser/viewlets.py
A plone/app/portlets/dashboard/__init__.py
A plone/app/portlets/dashboard/configure.zcml
A plone/app/portlets/dashboard/dashboard.pt
A plone/app/portlets/dashboard/dashboard.py
A plone/app/portlets/dashboard/user_actions.pt
A plone/app/portlets/dashboard/user_actions.py
M plone/__init__.py
M plone/app/__init__.py
M plone/app/portlets/assignable.py
M plone/app/portlets/browser/adding.py
M plone/app/portlets/browser/configure.zcml
M plone/app/portlets/browser/editmanager.py
M plone/app/portlets/browser/formhelper.py
M plone/app/portlets/browser/manage.py
M plone/app/portlets/browser/traversal.py
M plone/app/portlets/browser/utils.py
M plone/app/portlets/checker.py
M plone/app/portlets/configure.zcml
M plone/app/portlets/exportimport/__init__.py
M plone/app/portlets/exportimport/portlets.py
M plone/app/portlets/manager.py
M plone/app/portlets/metaconfigure.py
M plone/app/portlets/metadirectives.py
M plone/app/portlets/portlets/__init__.py
M plone/app/portlets/portlets/actions.py
M plone/app/portlets/portlets/base.py
M plone/app/portlets/portlets/classic.py
M plone/app/portlets/portlets/language.py
M plone/app/portlets/portlets/login.py
M plone/app/portlets/portlets/navigation.py
M plone/app/portlets/portlets/news.py
M plone/app/portlets/portlets/recent.py
M plone/app/portlets/portlets/review.py
M plone/app/portlets/portlets/rss.py
M plone/app/portlets/portlets/search.py
M plone/app/portlets/storage.py
D plone/app/portlets/dashboard.py

b'diff --git a/news/160.breaking b/news/160.breaking\nnew file mode 100644\nindex 00000000..3875ecf5\n--- /dev/null\n+++ b/news/160.breaking\n@@ -0,0 +1,4 @@\n+Move most (hard dependency) portlet related from `plone.app.layout`:\n+Dashboard, Portlet related viewlets.\n+A first step towards a Portlet-as-an-Addon story.\n+[jensens]\n\\ No newline at end of file\ndiff --git a/plone/__init__.py b/plone/__init__.py\nindex 05f0bebb..5284146e 100644\n--- a/plone/__init__.py\n+++ b/plone/__init__.py\n@@ -1,7 +1 @@\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/__init__.py b/plone/app/__init__.py\nindex 05f0bebb..5284146e 100644\n--- a/plone/app/__init__.py\n+++ b/plone/app/__init__.py\n@@ -1,7 +1 @@\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/portlets/assignable.py b/plone/app/portlets/assignable.py\nindex b6b0471d..902b34b8 100644\n--- a/plone/app/portlets/assignable.py\n+++ b/plone/app/portlets/assignable.py\n@@ -1,4 +1,4 @@\n-from plone.app.portlets.storage import PortletAssignmentMapping\n+from .storage import PortletAssignmentMapping\n from plone.portlets.constants import CONTEXT_ASSIGNMENT_KEY\n from plone.portlets.constants import CONTEXT_CATEGORY\n from plone.portlets.interfaces import ILocalPortletAssignable\ndiff --git a/plone/app/portlets/browser/adding.py b/plone/app/portlets/browser/adding.py\nindex 48340277..656babe3 100644\n--- a/plone/app/portlets/browser/adding.py\n+++ b/plone/app/portlets/browser/adding.py\n@@ -1,9 +1,9 @@\n+from ..interfaces import IPortletPermissionChecker\n+from .interfaces import IPortletAdding\n from Acquisition import aq_base\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n from OFS.SimpleItem import SimpleItem\n-from plone.app.portlets.browser.interfaces import IPortletAdding\n-from plone.app.portlets.interfaces import IPortletPermissionChecker\n from Products.CMFCore.utils import getToolByName\n from Products.Five import BrowserView\n from warnings import warn\ndiff --git a/plone/app/portlets/browser/configure.zcml b/plone/app/portlets/browser/configure.zcml\nindex 8ba32160..ea8adbee 100644\n--- a/plone/app/portlets/browser/configure.zcml\n+++ b/plone/app/portlets/browser/configure.zcml\n@@ -227,4 +227,23 @@\n         permission="zope2.View"\n         />\n \n+    <!-- Portlets Footer -->\n+    <browser:viewlet\n+        name="plone.footer"\n+        for="*"\n+        manager="plone.app.layout.viewlets.interfaces.IPortalFooter"\n+        class=".viewlets.FooterViewlet"\n+        permission="zope.Public"\n+        />\n+\n+    <!-- Manage portlets Fallback link -->\n+    <browser:viewlet\n+        name="plone.manage_portlets_fallback"\n+        for="plone.portlets.interfaces.ILocalPortletAssignable"\n+        view="plone.app.layout.globals.interfaces.IViewView"\n+        manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n+        class=".viewlets.ManagePortletsFallbackViewlet"\n+        permission="zope2.View"\n+        />\n+\n </configure>\ndiff --git a/plone/app/portlets/browser/editmanager.py b/plone/app/portlets/browser/editmanager.py\nindex 80a4851a..5e5842b2 100644\n--- a/plone/app/portlets/browser/editmanager.py\n+++ b/plone/app/portlets/browser/editmanager.py\n@@ -1,14 +1,14 @@\n+from ..interfaces import IDashboard\n+from ..interfaces import IPortletPermissionChecker\n+from .interfaces import IManageColumnPortletsView\n+from .interfaces import IManageContextualPortletsView\n+from .interfaces import IManageDashboardPortletsView\n from AccessControl import Unauthorized\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n from Acquisition import Explicit\n from Acquisition.interfaces import IAcquirer\n from five.customerize.zpt import TTWViewTemplateRenderer\n-from plone.app.portlets.browser.interfaces import IManageColumnPortletsView\n-from plone.app.portlets.browser.interfaces import IManageContextualPortletsView\n-from plone.app.portlets.browser.interfaces import IManageDashboardPortletsView\n-from plone.app.portlets.interfaces import IDashboard\n-from plone.app.portlets.interfaces import IPortletPermissionChecker\n from plone.memoize.view import memoize\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n from plone.portlets.constants import CONTEXT_CATEGORY\ndiff --git a/plone/app/portlets/browser/formhelper.py b/plone/app/portlets/browser/formhelper.py\nindex 7740d25a..3a104c73 100644\n--- a/plone/app/portlets/browser/formhelper.py\n+++ b/plone/app/portlets/browser/formhelper.py\n@@ -1,11 +1,11 @@\n+from .. import PloneMessageFactory as _\n+from ..browser.interfaces import IPortletAddForm\n+from ..browser.interfaces import IPortletEditForm\n+from ..interfaces import IPortletPermissionChecker\n from Acquisition import aq_base\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n from Acquisition.interfaces import IAcquirer\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.browser.interfaces import IPortletAddForm\n-from plone.app.portlets.browser.interfaces import IPortletEditForm\n-from plone.app.portlets.interfaces import IPortletPermissionChecker\n from plone.autoform.form import AutoExtensibleForm\n from Products.CMFCore.utils import getToolByName\n from Products.Five.browser import BrowserView\ndiff --git a/plone/app/portlets/browser/manage.py b/plone/app/portlets/browser/manage.py\nindex 916bf7b0..0face36a 100644\n--- a/plone/app/portlets/browser/manage.py\n+++ b/plone/app/portlets/browser/manage.py\n@@ -1,17 +1,17 @@\n+from ..interfaces import IPortletPermissionChecker\n+from ..interfaces import ITopbarManagePortlets\n+from ..storage import GroupDashboardPortletAssignmentMapping\n+from ..storage import PortletAssignmentMapping\n+from ..storage import UserPortletAssignmentMapping\n+from .interfaces import IManageContentTypePortletsView\n+from .interfaces import IManageContextualPortletsView\n+from .interfaces import IManageDashboardPortletsView\n+from .interfaces import IManageGroupPortletsView\n+from .interfaces import IManagePortletsView\n from AccessControl import Unauthorized\n from Acquisition import aq_base\n from Acquisition import aq_inner\n from plone.app.portlets import utils\n-from plone.app.portlets.browser.interfaces import IManageContentTypePortletsView\n-from plone.app.portlets.browser.interfaces import IManageContextualPortletsView\n-from plone.app.portlets.browser.interfaces import IManageDashboardPortletsView\n-from plone.app.portlets.browser.interfaces import IManageGroupPortletsView\n-from plone.app.portlets.browser.interfaces import IManagePortletsView\n-from plone.app.portlets.interfaces import IPortletPermissionChecker\n-from plone.app.portlets.interfaces import ITopbarManagePortlets\n-from plone.app.portlets.storage import GroupDashboardPortletAssignmentMapping\n-from plone.app.portlets.storage import PortletAssignmentMapping\n-from plone.app.portlets.storage import UserPortletAssignmentMapping\n from plone.memoize.view import memoize\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n from plone.portlets.constants import CONTEXT_CATEGORY\ndiff --git a/plone/app/portlets/browser/templates/footer.pt b/plone/app/portlets/browser/templates/footer.pt\nnew file mode 100644\nindex 00000000..df16ba9d\n--- /dev/null\n+++ b/plone/app/portlets/browser/templates/footer.pt\n@@ -0,0 +1,5 @@\n+<div class="row">\n+\t<div class="col-xs-12">\n+\t\t<div tal:on-error="nothing" tal:replace="structure view/render_footer_portlets" />\n+\t</div>\n+</div>\ndiff --git a/plone/app/portlets/browser/templates/manage_portlets_fallback.pt b/plone/app/portlets/browser/templates/manage_portlets_fallback.pt\nnew file mode 100644\nindex 00000000..ec5592d9\n--- /dev/null\n+++ b/plone/app/portlets/browser/templates/manage_portlets_fallback.pt\n@@ -0,0 +1,14 @@\n+<div tal:condition="view/available" class="row managePortlets-row">\n+\t<tal:comment tal:condition="nothing">\n+\t\t**********\n+\t\tNEEDED COL\n+\t\t**********\n+\t</tal:comment>\n+    <a class="managePortletsFallback"\n+        tal:attributes="href string:${view/object_url}/@@manage-portlets"\n+        i18n:domain="plone"\n+        i18n:translate="manage_portlets_link">\n+        Manage portlets\n+    </a>\n+\n+</div>\n\\ No newline at end of file\ndiff --git a/plone/app/portlets/browser/traversal.py b/plone/app/portlets/browser/traversal.py\nindex 8a50bb28..310b3b8f 100644\n--- a/plone/app/portlets/browser/traversal.py\n+++ b/plone/app/portlets/browser/traversal.py\n@@ -1,6 +1,6 @@\n-from plone.app.portlets.storage import GroupDashboardPortletAssignmentMapping\n-from plone.app.portlets.storage import PortletAssignmentMapping\n-from plone.app.portlets.storage import UserPortletAssignmentMapping\n+from ..storage import GroupDashboardPortletAssignmentMapping\n+from ..storage import PortletAssignmentMapping\n+from ..storage import UserPortletAssignmentMapping\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n from plone.portlets.constants import GROUP_CATEGORY\n from plone.portlets.constants import USER_CATEGORY\ndiff --git a/plone/app/portlets/browser/utils.py b/plone/app/portlets/browser/utils.py\nindex c86749f8..d4a32dbd 100644\n--- a/plone/app/portlets/browser/utils.py\n+++ b/plone/app/portlets/browser/utils.py\n@@ -1,5 +1,5 @@\n-from plone.app.portlets.interfaces import IDeferredPortletRenderer\n-from plone.app.portlets.utils import assignment_from_key\n+from ..interfaces import IDeferredPortletRenderer\n+from ..utils import assignment_from_key\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletRenderer\n from plone.portlets.utils import unhashPortletInfo\ndiff --git a/plone/app/portlets/browser/viewlets.py b/plone/app/portlets/browser/viewlets.py\nnew file mode 100644\nindex 00000000..6a365f00\n--- /dev/null\n+++ b/plone/app/portlets/browser/viewlets.py\n@@ -0,0 +1,68 @@\n+from zope.component import getMultiAdapter\n+from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n+from plone.app.layout.viewlets.common import ViewletBase\n+from AccessControl import getSecurityManager\n+from datetime import date\n+\n+\n+class ManagePortletsFallbackViewlet(ViewletBase):\n+    """Manage portlets fallback link that sits below content"""\n+\n+    index = ViewPageTemplateFile("templates/manage_portlets_fallback.pt")\n+\n+    def update(self):\n+        plonelayout = getMultiAdapter(\n+            (self.context, self.request), name=u"plone_layout"\n+        )\n+        context_state = getMultiAdapter(\n+            (self.context, self.request), name=u"plone_context_state"\n+        )\n+\n+        self.portlet_assignable = context_state.portlet_assignable()\n+        self.sl = plonelayout.have_portlets("plone.leftcolumn", self.context)\n+        self.sr = plonelayout.have_portlets("plone.rightcolumn", self.context)\n+        self.object_url = context_state.object_url()\n+\n+    def available(self):\n+        secman = getSecurityManager()\n+        has_manage_portlets_permission = secman.checkPermission(\n+            "Portlets: Manage portlets", self.context\n+        )\n+        if not has_manage_portlets_permission:\n+            return False\n+        return bool(not self.sl and not self.sr and self.portlet_assignable)\n+\n+class FooterViewlet(ViewletBase):\n+    index = ViewPageTemplateFile("templates/footer.pt")\n+\n+    def update(self):\n+        super(FooterViewlet, self).update()\n+        self.year = date.today().year\n+\n+    def render_footer_portlets(self):\n+        """\n+        You might ask, why is this necessary. Well, let me tell you a story...\n+\n+        plone.app.portlets, in order to provide @@manage-portlets on a context,\n+        overrides the IPortletRenderer for the IManageContextualPortletsView\n+        view.\n+        See plone.portlets and plone.app.portlets\n+\n+        Seems fine right? Well, most of the time it is. Except, here.\n+        Previously, we were just using the syntax like\n+        `provider:plone.footerportlets` to render the footer portlets.\n+        Since this tal expression was inside a viewlet,\n+        the view is no longer IManageContextualPortletsView when\n+        visiting @@manage-portlets. Instead, it was IViewlet.\n+        See zope.contentprovider\n+\n+        In to fix this short coming, we render the portlet column by\n+        manually doing the multi adapter lookup and then manually\n+        doing the rendering for the content provider.\n+        See zope.contentprovider\n+        """\n+        portlet_manager = getMultiAdapter(\n+            (self.context, self.request, self.__parent__), name="plone.footerportlets"\n+        )\n+        portlet_manager.update()\n+        return portlet_manager.render()\ndiff --git a/plone/app/portlets/checker.py b/plone/app/portlets/checker.py\nindex 274deeef..079a7055 100644\n--- a/plone/app/portlets/checker.py\n+++ b/plone/app/portlets/checker.py\n@@ -1,9 +1,9 @@\n+from .interfaces import IGroupDashboardPortletAssignmentMapping\n+from .interfaces import IPortletPermissionChecker\n+from .interfaces import IUserPortletAssignmentMapping\n from AccessControl import getSecurityManager\n from AccessControl import Unauthorized\n from Acquisition import aq_inner\n-from plone.app.portlets.interfaces import IGroupDashboardPortletAssignmentMapping\n-from plone.app.portlets.interfaces import IPortletPermissionChecker\n-from plone.app.portlets.interfaces import IUserPortletAssignmentMapping\n from plone.portlets.interfaces import IPortletAssignmentMapping\n from zope.component import adapter\n from zope.interface import implementer\ndiff --git a/plone/app/portlets/configure.zcml b/plone/app/portlets/configure.zcml\nindex 5a153bce..b4b59569 100644\n--- a/plone/app/portlets/configure.zcml\n+++ b/plone/app/portlets/configure.zcml\n@@ -12,6 +12,7 @@\n     <include file="permissions.zcml" />\n \n     <include package=".browser" />\n+    <include package=".dashboard" />\n     <include package=".exportimport" />\n     <include package=".portlets" />\n \ndiff --git a/plone/app/portlets/dashboard.py b/plone/app/portlets/dashboard/__init__.py\nsimilarity index 91%\nrename from plone/app/portlets/dashboard.py\nrename to plone/app/portlets/dashboard/__init__.py\nindex cf1cce8e..38c106b7 100644\n--- a/plone/app/portlets/dashboard.py\n+++ b/plone/app/portlets/dashboard/__init__.py\n@@ -1,6 +1,6 @@\n-from plone.app.portlets import portlets\n-from plone.app.portlets.interfaces import IDefaultDashboard\n-from plone.app.portlets.storage import UserPortletAssignmentMapping\n+from .. import portlets\n+from ..interfaces import IDefaultDashboard\n+from ..storage import UserPortletAssignmentMapping\n from plone.portlets.constants import USER_CATEGORY\n from plone.portlets.interfaces import IPortletManager\n from Products.PluggableAuthService.interfaces.authservice import IPropertiedUser\ndiff --git a/plone/app/portlets/dashboard/configure.zcml b/plone/app/portlets/dashboard/configure.zcml\nnew file mode 100644\nindex 00000000..c206737c\n--- /dev/null\n+++ b/plone/app/portlets/dashboard/configure.zcml\n@@ -0,0 +1,22 @@\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser">\n+\n+    <browser:page\n+        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n+        name="dashboard"\n+        permission="plone.app.portlets.ViewDashboard"\n+        class=".dashboard.DashboardView"\n+        template="dashboard.pt"\n+        />\n+\n+    <!-- this view provides a not-js fallback for the user dropdown menu.\n+    It has been placed here to be near the personal bar code -->\n+    <browser:page\n+        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n+        name="useractions"\n+        permission="zope2.View"\n+        class=".user_actions.UserActionsView"\n+        template="user_actions.pt"\n+        />\n+</configure>\ndiff --git a/plone/app/portlets/dashboard/dashboard.pt b/plone/app/portlets/dashboard/dashboard.pt\nnew file mode 100644\nindex 00000000..71de849a\n--- /dev/null\n+++ b/plone/app/portlets/dashboard/dashboard.pt\n@@ -0,0 +1,70 @@\n+<html\n+    xmlns="http://www.w3.org/1999/xhtml"\n+    xml:lang="en"\n+    xmlns:tal="http://xml.zope.org/namespaces/tal"\n+    xmlns:metal="http://xml.zope.org/namespaces/metal"\n+    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+    lang="en"\n+    metal:use-macro="context/main_template/macros/master"\n+    i18n:domain="plone">\n+\n+  <body>\n+\n+    <metal:b fill-slot="content-title">\n+      <h1\n+          class="documentFirstHeading"\n+          i18n:translate="heading_dashboard"\n+          tal:define="memberinfo context/portal_membership/getMemberInfo;\n+                  member context/@@plone_portal_state/member;\n+                  name python:memberinfo[\'fullname\'] or member.getId() or member.getId()">\n+        <span\n+            tal:replace="name"\n+            i18n:name="user_name" />\n+        &#8217;s dashboard\n+      </h1>\n+    </metal:b>\n+\n+    <metal:b fill-slot="content-core">\n+      <tal:b metal:define-macro="content-core">\n+\n+        <div class="autotabs">\n+          <nav class="autotoc-nav nav nav-tabs mb-3">\n+            <span class="nav-item">\n+              <a\n+                  class="active nav-link"\n+                  href="${context/@@plone_portal_state/navigation_root_url}/dashboard"\n+                  i18n:translate="label_dashboard">Dashboard</a>\n+            </span>\n+            <span class="nav-item">\n+              <a\n+                  href="${context/@@plone_portal_state/navigation_root_url}/@@manage-dashboard?_authenticator=${view/auth_token}"\n+                  class="nav-link"\n+                  i18n:translate="label_edit">Edit</a>\n+            </span>\n+          </nav>\n+\n+\n+          <div\n+              id="dashboard"\n+              class="row row-cols-1 row-cols-md-2 gy-2">\n+            <div\n+                id="dashboard-portlets1"\n+                tal:content="structure provider:plone.dashboard1" />\n+            <div\n+                id="dashboard-portlets2"\n+                tal:content="structure provider:plone.dashboard2" />\n+            <div\n+                id="dashboard-portlets3"\n+                tal:content="structure provider:plone.dashboard3" />\n+            <div\n+                id="dashboard-portlets4"\n+                tal:content="structure provider:plone.dashboard4" />\n+          </div>\n+\n+        </div>\n+\n+      </tal:b>\n+    </metal:b>\n+\n+  </body>\n+</html>\ndiff --git a/plone/app/portlets/dashboard/dashboard.py b/plone/app/portlets/dashboard/dashboard.py\nnew file mode 100644\nindex 00000000..abc42837\n--- /dev/null\n+++ b/plone/app/portlets/dashboard/dashboard.py\n@@ -0,0 +1,72 @@\n+# -*- coding: utf-8 -*-\n+from AccessControl import getSecurityManager\n+from plone.memoize.instance import memoize\n+from plone.portlets.constants import GROUP_CATEGORY\n+from plone.portlets.constants import USER_CATEGORY\n+from plone.portlets.interfaces import IPortletManager\n+from plone.protect.authenticator import createToken\n+from Products.CMFCore.utils import getToolByName\n+from Products.CMFPlone import PloneMessageFactory as _\n+from Products.Five.browser import BrowserView\n+from Products.statusmessages.interfaces import IStatusMessage\n+from zope.component import getUtility\n+from zope.interface import implementer\n+from zope.interface import Interface\n+\n+\n+class IDashboard(Interface):\n+    """the dashboard display columns of portlet to the loggedin user"""\n+\n+\n+@implementer(IDashboard)\n+class DashboardView(BrowserView):\n+    """Power the dashboard"""\n+\n+    def __call__(self):\n+        self.request.set("disable_border", 1)\n+        self.request.set("disable_plone.leftcolumn", 1)\n+        self.request.set("disable_plone.rightcolumn", 1)\n+        if self.can_edit() and self.empty():\n+            message = _(\n+                u"info_empty_dashboard",\n+                default=u"Your dashboard is currently empty. Click the"\n+                " <em>edit</em> tab to assign some personal"\n+                " portlets.",\n+            )\n+            IStatusMessage(self.request).add(message)\n+        return self.index()\n+\n+    @property\n+    def auth_token(self):\n+        return createToken()\n+\n+    @memoize\n+    def can_edit(self):\n+        return bool(\n+            getSecurityManager().checkPermission(\n+                "Portlets: Manage own portlets", self.context\n+            )\n+        )\n+\n+    @memoize\n+    def empty(self):\n+        dashboards = [\n+            getUtility(IPortletManager, name=name)\n+            for name in [\n+                "plone.dashboard1",\n+                "plone.dashboard2",\n+                "plone.dashboard3",\n+                "plone.dashboard4",\n+            ]\n+        ]\n+\n+        portal_membership = getToolByName(self.context, "portal_membership")\n+        member = portal_membership.getAuthenticatedMember()\n+        userid = member.getId()\n+\n+        num_portlets = 0\n+        for dashboard in dashboards:\n+            num_portlets += len(dashboard.get(USER_CATEGORY, {}).get(userid, {}))\n+            for groupid in member.getGroups():\n+                num_portlets += len(dashboard.get(GROUP_CATEGORY, {}).get(groupid, {}))\n+        return num_portlets == 0\ndiff --git a/plone/app/portlets/dashboard/user_actions.pt b/plone/app/portlets/dashboard/user_actions.pt\nnew file mode 100644\nindex 00000000..ce532f1f\n--- /dev/null\n+++ b/plone/app/portlets/dashboard/user_actions.pt\n@@ -0,0 +1,35 @@\n+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      i18n:domain="plone">\n+\n+<head>\n+    <metal:block fill-slot="top_slot"\n+                 tal:define="dummy python:request.set(\'disable_border\',1);\n+                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n+</head>\n+\n+<body>\n+\n+<metal:main fill-slot="main">\n+<h1 i18n:translate="" class="documentFirstHeading">User Actions</h1>\n+<ul id="user-actions">\n+    <li tal:repeat="action view/user_actions">\n+        <a href=""\n+           tal:attributes="href action/url;\n+                           target action/link_target|nothing;\n+                           id string:personaltoolspage-${action/id};"\n+           tal:content="action/title"\n+           i18n:translate="">\n+            action title\n+        </a>\n+    </li>\n+</ul>\n+</metal:main>\n+\n+</body>\n+</html>\ndiff --git a/plone/app/portlets/dashboard/user_actions.py b/plone/app/portlets/dashboard/user_actions.py\nnew file mode 100644\nindex 00000000..64e10f96\n--- /dev/null\n+++ b/plone/app/portlets/dashboard/user_actions.py\n@@ -0,0 +1,15 @@\n+# -*- coding: utf-8 -*-\n+from Products.Five.browser import BrowserView\n+from zope.component import getMultiAdapter\n+\n+\n+class UserActionsView(BrowserView):\n+    """Power the useraction fallback page"""\n+\n+    def user_actions(self):\n+        context_state = getMultiAdapter(\n+            (self.context, self.request), name=u"plone_context_state"\n+        )\n+\n+        actions = context_state.actions("user")\n+        return actions\ndiff --git a/plone/app/portlets/exportimport/__init__.py b/plone/app/portlets/exportimport/__init__.py\nindex 792d6005..e69de29b 100644\n--- a/plone/app/portlets/exportimport/__init__.py\n+++ b/plone/app/portlets/exportimport/__init__.py\n@@ -1 +0,0 @@\n-#\ndiff --git a/plone/app/portlets/exportimport/portlets.py b/plone/app/portlets/exportimport/portlets.py\nindex f0e30a51..6c404fac 100644\n--- a/plone/app/portlets/exportimport/portlets.py\n+++ b/plone/app/portlets/exportimport/portlets.py\n@@ -76,13 +76,11 @@\n \n """\n \n+from ..interfaces import IDefaultPortletManager\n+from ..interfaces import IPortletTypeInterface\n+from ..utils import assignment_mapping_from_key\n+from .interfaces import IPortletAssignmentExportImportHandler\n from operator import attrgetter\n-from plone.app.portlets.exportimport.interfaces import (\n-    IPortletAssignmentExportImportHandler,\n-)\n-from plone.app.portlets.interfaces import IDefaultPortletManager\n-from plone.app.portlets.interfaces import IPortletTypeInterface\n-from plone.app.portlets.utils import assignment_mapping_from_key\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n from plone.portlets.constants import CONTEXT_CATEGORY\n from plone.portlets.constants import GROUP_CATEGORY\ndiff --git a/plone/app/portlets/manager.py b/plone/app/portlets/manager.py\nindex e7f3e943..90743b7d 100644\n--- a/plone/app/portlets/manager.py\n+++ b/plone/app/portlets/manager.py\n@@ -1,8 +1,8 @@\n+from .interfaces import IColumn\n+from .interfaces import IDashboard\n from Acquisition import aq_acquire\n from Acquisition import aq_inner\n from Acquisition import Explicit\n-from plone.app.portlets.interfaces import IColumn\n-from plone.app.portlets.interfaces import IDashboard\n from plone.portlets.interfaces import IPortletRenderer\n from plone.portlets.manager import PortletManagerRenderer as BasePortletManagerRenderer\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\ndiff --git a/plone/app/portlets/metaconfigure.py b/plone/app/portlets/metaconfigure.py\nindex 2296c7cb..2dff5aae 100644\n--- a/plone/app/portlets/metaconfigure.py\n+++ b/plone/app/portlets/metaconfigure.py\n@@ -1,5 +1,5 @@\n-from plone.app.portlets.browser.interfaces import IPortletAdding\n-from plone.app.portlets.interfaces import IPortletTypeInterface\n+from .browser.interfaces import IPortletAdding\n+from .interfaces import IPortletTypeInterface\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletRenderer\n from Products.Five.browser.metaconfigure import page\ndiff --git a/plone/app/portlets/metadirectives.py b/plone/app/portlets/metadirectives.py\nindex 051bd9a2..c00664cb 100644\n--- a/plone/app/portlets/metadirectives.py\n+++ b/plone/app/portlets/metadirectives.py\n@@ -1,4 +1,4 @@\n-from plone.app.portlets import PloneMessageFactory as _\n+from . import PloneMessageFactory as _\n from plone.portlets.interfaces import IPortletManager\n from zope import schema\n from zope.configuration import fields as configuration_fields\ndiff --git a/plone/app/portlets/portlets/__init__.py b/plone/app/portlets/portlets/__init__.py\nindex 792d6005..e69de29b 100644\n--- a/plone/app/portlets/portlets/__init__.py\n+++ b/plone/app/portlets/portlets/__init__.py\n@@ -1 +0,0 @@\n-#\ndiff --git a/plone/app/portlets/portlets/actions.py b/plone/app/portlets/portlets/actions.py\nindex afb24374..7e8d3c14 100644\n--- a/plone/app/portlets/portlets/actions.py\n+++ b/plone/app/portlets/portlets/actions.py\n@@ -1,6 +1,6 @@\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from Acquisition import aq_inner\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.memoize import view as pm_view\n from plone.portlets.interfaces import IPortletDataProvider\ndiff --git a/plone/app/portlets/portlets/base.py b/plone/app/portlets/portlets/base.py\nindex 05840a15..cfe507cb 100644\n--- a/plone/app/portlets/portlets/base.py\n+++ b/plone/app/portlets/portlets/base.py\n@@ -1,9 +1,7 @@\n+from ..browser.formhelper import AddForm\n+from ..browser.formhelper import EditForm\n+from ..browser.formhelper import NullAddForm\n from OFS.SimpleItem import SimpleItem\n-\n-# Convenience imports\n-from plone.app.portlets.browser.formhelper import AddForm\n-from plone.app.portlets.browser.formhelper import EditForm\n-from plone.app.portlets.browser.formhelper import NullAddForm\n from plone.app.portlets.interfaces import IDeferredPortletRenderer\n from plone.portlets.interfaces import IPortletAssignment\n from plone.portlets.interfaces import IPortletRenderer\ndiff --git a/plone/app/portlets/portlets/classic.py b/plone/app/portlets/portlets/classic.py\nindex 6d9e45c3..9a1b1ea2 100644\n--- a/plone/app/portlets/portlets/classic.py\n+++ b/plone/app/portlets/portlets/classic.py\n@@ -1,5 +1,5 @@\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\ndiff --git a/plone/app/portlets/portlets/language.py b/plone/app/portlets/portlets/language.py\nindex 368a3c03..23906b7d 100644\n--- a/plone/app/portlets/portlets/language.py\n+++ b/plone/app/portlets/portlets/language.py\n@@ -1,6 +1,6 @@\n from plone.app.i18n.locales.browser.selector import LanguageSelector\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getMultiAdapter\ndiff --git a/plone/app/portlets/portlets/login.py b/plone/app/portlets/portlets/login.py\nindex 9314e23a..3f6cc1ac 100644\n--- a/plone/app/portlets/portlets/login.py\n+++ b/plone/app/portlets/portlets/login.py\n@@ -1,5 +1,5 @@\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from plone.memoize.instance import memoize\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.CMFCore.utils import getToolByName\ndiff --git a/plone/app/portlets/portlets/navigation.py b/plone/app/portlets/portlets/navigation.py\nindex a32b7ce7..0e9378cc 100644\n--- a/plone/app/portlets/portlets/navigation.py\n+++ b/plone/app/portlets/portlets/navigation.py\n@@ -1,3 +1,5 @@\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from Acquisition import aq_base\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n@@ -8,8 +10,6 @@\n from plone.app.layout.navigation.navtree import buildFolderTree\n from plone.app.layout.navigation.root import getNavigationRoot\n from plone.app.layout.navigation.root import getNavigationRootObject\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n from plone.app.uuid.utils import uuidToObject\n from plone.app.vocabularies.catalog import CatalogSource\n from plone.i18n.normalizer.interfaces import IIDNormalizer\ndiff --git a/plone/app/portlets/portlets/news.py b/plone/app/portlets/portlets/news.py\nindex ec3aabd2..0075ee9d 100644\n--- a/plone/app/portlets/portlets/news.py\n+++ b/plone/app/portlets/portlets/news.py\n@@ -1,8 +1,8 @@\n+from .. import PloneMessageFactory as _\n+from ..cache import render_cachekey\n+from ..portlets import base\n from Acquisition import aq_inner\n from plone.app.layout.navigation.root import getNavigationRootObject\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.cache import render_cachekey\n-from plone.app.portlets.portlets import base\n from plone.app.z3cform.widget import SelectFieldWidget\n from plone.autoform.directives import widget\n from plone.memoize import ram\ndiff --git a/plone/app/portlets/portlets/recent.py b/plone/app/portlets/portlets/recent.py\nindex e0178218..1893c525 100644\n--- a/plone/app/portlets/portlets/recent.py\n+++ b/plone/app/portlets/portlets/recent.py\n@@ -1,8 +1,8 @@\n+from .. import PloneMessageFactory as _\n+from ..cache import render_cachekey\n+from ..portlets import base\n from Acquisition import aq_inner\n from plone.app.layout.navigation.root import getNavigationRoot\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.cache import render_cachekey\n-from plone.app.portlets.portlets import base\n from plone.memoize import ram\n from plone.memoize.compress import xhtml_compress\n from plone.memoize.instance import memoize\ndiff --git a/plone/app/portlets/portlets/review.py b/plone/app/portlets/portlets/review.py\nindex e59d8360..cba8d97f 100644\n--- a/plone/app/portlets/portlets/review.py\n+++ b/plone/app/portlets/portlets/review.py\n@@ -1,7 +1,7 @@\n+from .. import PloneMessageFactory as _\n+from ..browser import formhelper\n+from ..portlets import base\n from Acquisition import aq_inner\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.browser import formhelper\n-from plone.app.portlets.portlets import base\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.memoize.instance import memoize\n from plone.portlets.interfaces import IPortletDataProvider\ndiff --git a/plone/app/portlets/portlets/rss.py b/plone/app/portlets/portlets/rss.py\nindex 6cf4ce12..c53a37bd 100644\n--- a/plone/app/portlets/portlets/rss.py\n+++ b/plone/app/portlets/portlets/rss.py\n@@ -1,8 +1,8 @@\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from DateTime import DateTime\n from DateTime.interfaces import DateTimeError\n from logging import getLogger\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.Five.browser.pagetemplatefile import ZopeTwoPageTemplateFile\n from urllib.parse import urlparse\ndiff --git a/plone/app/portlets/portlets/search.py b/plone/app/portlets/portlets/search.py\nindex f4813280..db7b3a68 100644\n--- a/plone/app/portlets/portlets/search.py\n+++ b/plone/app/portlets/portlets/search.py\n@@ -1,6 +1,6 @@\n+from .. import PloneMessageFactory as _\n+from ..portlets import base\n from plone.app.layout.navigation.root import getNavigationRoot\n-from plone.app.portlets import PloneMessageFactory as _\n-from plone.app.portlets.portlets import base\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\ndiff --git a/plone/app/portlets/storage.py b/plone/app/portlets/storage.py\nindex 8a4eba53..dca4820b 100644\n--- a/plone/app/portlets/storage.py\n+++ b/plone/app/portlets/storage.py\n@@ -1,8 +1,8 @@\n+from .interfaces import IGroupDashboardPortletAssignmentMapping\n+from .interfaces import IUserPortletAssignmentMapping\n from Acquisition import aq_base\n from BTrees.OOBTree import OOBTree\n from OFS.SimpleItem import SimpleItem\n-from plone.app.portlets.interfaces import IGroupDashboardPortletAssignmentMapping\n-from plone.app.portlets.interfaces import IUserPortletAssignmentMapping\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.portlets import constants\n from plone.portlets.constants import CONTEXT_ASSIGNMENT_KEY\n'

