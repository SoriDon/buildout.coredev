Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-02-25T20:42:32+02:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/40c716b67e121d0017eb718066dd5452491fa592

Fix detection of initial login time

Files changed:
A news/3447.bugfix
M Products/CMFPlone/browser/login/password_reset.py

b"diff --git a/Products/CMFPlone/browser/login/password_reset.py b/Products/CMFPlone/browser/login/password_reset.py\nindex 7594dc5461..98ebe496cd 100644\n--- a/Products/CMFPlone/browser/login/password_reset.py\n+++ b/Products/CMFPlone/browser/login/password_reset.py\n@@ -1,4 +1,5 @@\n from AccessControl.SecurityManagement import getSecurityManager\n+from DateTime import DateTime\n from email.header import Header\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.memoize import view\n@@ -108,8 +109,9 @@ def _auto_login(self, userid, password):\n             # with the given userid\n             user = getSecurityManager().getUser()\n \n-        login_time = user.getProperty('login_time', None)\n-        if login_time is None:\n+        default = DateTime('2000/01/01')\n+        login_time = user.getProperty('login_time', default)\n+        if login_time == default:\n             notify(UserInitialLoginInEvent(user))\n         else:\n             notify(UserLoggedInEvent(user))\ndiff --git a/news/3447.bugfix b/news/3447.bugfix\nnew file mode 100644\nindex 0000000000..ab80f61905\n--- /dev/null\n+++ b/news/3447.bugfix\n@@ -0,0 +1 @@\n+Fix detection of initial login time [MrTango]\n\\ No newline at end of file\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-03-04T18:13:16+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/adbd2c05350d4a3ffa0d82d12d45913e97537eac

Merge pull request #3448 from plone/mrtango-fix-initial-user-login-detection-6

Fix detection of initial login time

Files changed:
A news/3447.bugfix
M Products/CMFPlone/browser/login/password_reset.py

b"diff --git a/Products/CMFPlone/browser/login/password_reset.py b/Products/CMFPlone/browser/login/password_reset.py\nindex 7594dc5461..98ebe496cd 100644\n--- a/Products/CMFPlone/browser/login/password_reset.py\n+++ b/Products/CMFPlone/browser/login/password_reset.py\n@@ -1,4 +1,5 @@\n from AccessControl.SecurityManagement import getSecurityManager\n+from DateTime import DateTime\n from email.header import Header\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.memoize import view\n@@ -108,8 +109,9 @@ def _auto_login(self, userid, password):\n             # with the given userid\n             user = getSecurityManager().getUser()\n \n-        login_time = user.getProperty('login_time', None)\n-        if login_time is None:\n+        default = DateTime('2000/01/01')\n+        login_time = user.getProperty('login_time', default)\n+        if login_time == default:\n             notify(UserInitialLoginInEvent(user))\n         else:\n             notify(UserLoggedInEvent(user))\ndiff --git a/news/3447.bugfix b/news/3447.bugfix\nnew file mode 100644\nindex 0000000000..ab80f61905\n--- /dev/null\n+++ b/news/3447.bugfix\n@@ -0,0 +1 @@\n+Fix detection of initial login time [MrTango]\n\\ No newline at end of file\n"

