Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-10-29T11:10:50-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/48a4aa3380a6781acfab613eed7140d3513e3dd6

Don't create default content folders for Volto (#3665)

Files changed:
A news/3628.bugfix
M Products/CMFPlone/browser/admin.py
M Products/CMFPlone/factory.py

b'diff --git a/Products/CMFPlone/browser/admin.py b/Products/CMFPlone/browser/admin.py\nindex 8478f0c692..98d4a3256c 100644\n--- a/Products/CMFPlone/browser/admin.py\n+++ b/Products/CMFPlone/browser/admin.py\n@@ -160,10 +160,8 @@ class AddPloneSite(BrowserView):\n     # Let\'s have a separate list for Volto.\n     volto_default_extension_profiles = (\n         \'plone.app.caching:default\',\n-        # We could choose to not install Barceloneta:\n         \'plonetheme.barceloneta:default\',\n         \'plone.volto:default\',\n-        \'plone.volto:default-homepage\'\n     )\n \n     def profiles(self):\n@@ -294,6 +292,7 @@ def __call__(self):\n             else:\n                 # we have a keymanager, check csrf protection manually now\n                 checkCSRF(self.request)\n+\n             site = addPloneSite(\n                 context, site_id,\n                 title=form.get(\'title\', \'\'),\ndiff --git a/Products/CMFPlone/factory.py b/Products/CMFPlone/factory.py\nindex 8e0e6e2702..51b7493ac8 100644\n--- a/Products/CMFPlone/factory.py\n+++ b/Products/CMFPlone/factory.py\n@@ -117,7 +117,7 @@ def zmi_constructor(context):\n \n def addPloneSite(context, site_id, title=\'Plone site\', description=\'\',\n                  profile_id=_DEFAULT_PROFILE,\n-                 content_profile_id=_CONTENT_PROFILE, snapshot=False,\n+                 content_profile_id=None, snapshot=False,\n                  extension_ids=(), setup_content=True,\n                  default_language=\'en\', portal_timezone=\'UTC\'):\n     """Add a PloneSite to the context."""\n@@ -154,7 +154,20 @@ def addPloneSite(context, site_id, title=\'Plone site\', description=\'\',\n \n         # Install default content types profile if user do not select "example content"\n         # during site creation.\n-        content_types_profile = content_profile_id if setup_content else _TYPES_PROFILE\n+        content_types_profile = (\n+            content_profile_id\n+            if setup_content and content_profile_id\n+            else _TYPES_PROFILE\n+        )\n+        if setup_content:\n+            if content_profile_id:\n+                content_types_profile = content_profile_id\n+            elif "plone.volto:default" in extension_ids:\n+                content_types_profile = "plone.volto:default-homepage"\n+            else:\n+                content_types_profile = _CONTENT_PROFILE\n+        else:\n+            content_types_profile = _TYPES_PROFILE\n \n         setup_tool.runAllImportStepsFromProfile(f\'profile-{content_types_profile}\')\n \ndiff --git a/news/3628.bugfix b/news/3628.bugfix\nnew file mode 100644\nindex 0000000000..d02000a4c5\n--- /dev/null\n+++ b/news/3628.bugfix\n@@ -0,0 +1 @@\n+Don\'t create news, events, and users folders for Volto sites. [davisagli]\n'

