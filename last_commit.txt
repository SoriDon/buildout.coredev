Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2023-03-25T22:19:07+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/9982d5648929d8fb612713b032f4944c7c7d0bd4

Configuring with plone/meta

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/47959565.internal
A tox.ini
M pyproject.toml
M setup.cfg

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 0000000..b4158b8\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 0000000..07dde25\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "47959565"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 0000000..582f8ac\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.2\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/news/47959565.internal b/news/47959565.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/47959565.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615d..9eb73f3 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,43 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 6064072..0da8f8f 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,13 +1,23 @@\n-[check-manifest]\n-ignore =\n-    *.cfg\n-\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n \n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 0000000..358665e\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,53 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --test-path={toxinidir} -s plone.app.contentrules\n+extras =\n+    test\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2023-03-25T22:20:50+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/924a6595a2530de36e8bcdd45730609d6773b2a9

chore: black

Files changed:
M plone/app/contentrules/browser/adding.py
M plone/app/contentrules/browser/assignments.py
M plone/app/contentrules/browser/formhelper.py
M plone/app/contentrules/exportimport/rules.py
M plone/app/contentrules/handlers.py
M plone/app/contentrules/rule.py
M plone/app/contentrules/testing.py
M plone/app/contentrules/tests/test_cascading_rule.py
M plone/app/contentrules/tests/test_configuration.py
M plone/app/contentrules/tests/test_rule_assignment_mapping.py
M plone/app/contentrules/tests/test_rule_management_views.py

b'diff --git a/plone/app/contentrules/browser/adding.py b/plone/app/contentrules/browser/adding.py\nindex febf16c..3d39be0 100644\n--- a/plone/app/contentrules/browser/adding.py\n+++ b/plone/app/contentrules/browser/adding.py\n@@ -18,7 +18,6 @@\n \n @implementer(IRuleAdding)\n class RuleAdding(SimpleItem, BrowserView):\n-\n     context = None\n     request = None\n     contentName = None\n@@ -73,7 +72,6 @@ def nextURL(self):\n \n \n class RuleElementAdding(SimpleItem, BrowserView):\n-\n     context = None\n     request = None\n     contentName = None\n@@ -115,7 +113,6 @@ def hasCustomAddView(self):\n \n @implementer(IRuleConditionAdding)\n class RuleConditionAdding(RuleElementAdding):\n-\n     # This is necessary so that context.absolute_url() works properly on the\n     # add form, which in turn fixes the <base /> URL\n     id = "+condition"\n@@ -128,7 +125,6 @@ def add(self, content):\n \n @implementer(IRuleActionAdding)\n class RuleActionAdding(RuleElementAdding):\n-\n     # This is necessary so that context.absolute_url() works properly on the\n     # add form, which in turn fixes the <base /> URL\n     id = "+action"\ndiff --git a/plone/app/contentrules/browser/assignments.py b/plone/app/contentrules/browser/assignments.py\nindex ec50215..617137c 100644\n--- a/plone/app/contentrules/browser/assignments.py\n+++ b/plone/app/contentrules/browser/assignments.py\n@@ -95,7 +95,6 @@ def type_name(self):\n \n     @memoize\n     def acquired_rules(self):\n-\n         # Short circuit if this is the root of the portal\n         if ISiteRoot.providedBy(self.context):\n             return []\ndiff --git a/plone/app/contentrules/browser/formhelper.py b/plone/app/contentrules/browser/formhelper.py\nindex 7dafd6f..8a11d81 100644\n--- a/plone/app/contentrules/browser/formhelper.py\n+++ b/plone/app/contentrules/browser/formhelper.py\n@@ -153,5 +153,4 @@ def nextURL(self):\n \n \n class ContentRuleFormWrapper(layout.FormWrapper):\n-\n     index = ViewPageTemplateFile("templates/contentrules-pageform.pt")\ndiff --git a/plone/app/contentrules/exportimport/rules.py b/plone/app/contentrules/exportimport/rules.py\nindex c34ac83..4633736 100644\n--- a/plone/app/contentrules/exportimport/rules.py\n+++ b/plone/app/contentrules/exportimport/rules.py\n@@ -50,7 +50,6 @@ def __init__(self, element):\n         self.descriptor = getUtility(IRuleElement, name=data.element)\n \n     def import_element(self, node):\n-\n         if self.descriptor.schema is None:\n             return\n \n@@ -152,7 +151,6 @@ def _initRules(self, node):\n \n         for child in node.childNodes:\n             if child.nodeName == "rule":\n-\n                 rule = None\n                 name = child.getAttribute("name")\n                 if name:\ndiff --git a/plone/app/contentrules/handlers.py b/plone/app/contentrules/handlers.py\nindex b9b62ec..f93fa94 100644\n--- a/plone/app/contentrules/handlers.py\n+++ b/plone/app/contentrules/handlers.py\n@@ -102,7 +102,6 @@ def execute(context, event):\n \n     # Prepare to break hard if a rule demanded execution be stopped\n     try:\n-\n         # Try to execute rules in the context. It may not work if the context\n         # is not a rule executor, but we may still want to bubble events\n         executor = IRuleExecutor(context, None)\ndiff --git a/plone/app/contentrules/rule.py b/plone/app/contentrules/rule.py\nindex a7a652b..05fecbc 100644\n--- a/plone/app/contentrules/rule.py\n+++ b/plone/app/contentrules/rule.py\n@@ -40,7 +40,6 @@ def insert_assignment(rule, path):\n \n # Events that keep track of rule-to-assignment mappings\n def rule_removed(rule, event):\n-\n     storage = queryUtility(IRuleStorage)\n     rule_name = rule.__name__\n \n@@ -57,7 +56,6 @@ def rule_removed(rule, event):\n \n \n def container_moved(container, event):\n-\n     if event.oldParent is None or event.newParent is None or event.oldName is None:\n         return\n \n@@ -87,7 +85,6 @@ def container_moved(container, event):\n \n \n def container_removed(container, event):\n-\n     assignable = IRuleAssignmentManager(container, None)\n     storage = queryUtility(IRuleStorage)\n \ndiff --git a/plone/app/contentrules/testing.py b/plone/app/contentrules/testing.py\nindex 1839443..8cadf08 100644\n--- a/plone/app/contentrules/testing.py\n+++ b/plone/app/contentrules/testing.py\n@@ -8,7 +8,6 @@\n \n \n class PloneAppContentrulesLayer(PloneSandboxLayer):\n-\n     defaultBases = (PLONE_APP_CONTENTTYPES_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\ndiff --git a/plone/app/contentrules/tests/test_cascading_rule.py b/plone/app/contentrules/tests/test_cascading_rule.py\nindex efeac84..07e7475 100644\n--- a/plone/app/contentrules/tests/test_cascading_rule.py\n+++ b/plone/app/contentrules/tests/test_cascading_rule.py\n@@ -11,7 +11,6 @@\n \n \n class TestCascadingRule(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTRULES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contentrules/tests/test_configuration.py b/plone/app/contentrules/tests/test_configuration.py\nindex 5e0d50b..4c29cf4 100644\n--- a/plone/app/contentrules/tests/test_configuration.py\n+++ b/plone/app/contentrules/tests/test_configuration.py\n@@ -19,7 +19,6 @@\n \n \n class TestGenericSetup(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTRULES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contentrules/tests/test_rule_assignment_mapping.py b/plone/app/contentrules/tests/test_rule_assignment_mapping.py\nindex 4b62a7c..b248d70 100644\n--- a/plone/app/contentrules/tests/test_rule_assignment_mapping.py\n+++ b/plone/app/contentrules/tests/test_rule_assignment_mapping.py\n@@ -20,7 +20,6 @@\n \n \n class TestRuleAssignmentMapping(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTRULES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contentrules/tests/test_rule_management_views.py b/plone/app/contentrules/tests/test_rule_management_views.py\nindex f96137f..3f1592f 100644\n--- a/plone/app/contentrules/tests/test_rule_management_views.py\n+++ b/plone/app/contentrules/tests/test_rule_management_views.py\n@@ -10,7 +10,6 @@\n \n \n class DummyModifiedRule(Rule):\n-\n     title = "My test rule"\n     description = "Test my rule"\n     event = IObjectModifiedEvent\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2023-03-25T22:21:30+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/a0f5a110038b23e58ecaff071e61109b71531bf5

chore: zpretty ZCML/XML

Files changed:
M plone/app/contentrules/actions/configure.zcml
M plone/app/contentrules/browser/configure.zcml
M plone/app/contentrules/conditions/configure.zcml
M plone/app/contentrules/configure.zcml
M plone/app/contentrules/exportimport/configure.zcml
M plone/app/contentrules/tests/profiles/testing/contentrules.xml
M plone/app/contentrules/tests/profiles/testing/export_steps.xml
M plone/app/contentrules/tests/profiles/testing/import_steps.xml
M plone/app/contentrules/tests/testing.zcml

b'diff --git a/plone/app/contentrules/actions/configure.zcml b/plone/app/contentrules/actions/configure.zcml\nindex db5c2a0..5b7a965 100644\n--- a/plone/app/contentrules/actions/configure.zcml\n+++ b/plone/app/contentrules/actions/configure.zcml\n@@ -2,238 +2,239 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <!-- Logger action -->\n+  <!-- Logger action -->\n \n-    <adapter factory=".logger.LoggerActionExecutor" />\n+  <adapter factory=".logger.LoggerActionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+  <browser:page\n       name="plone.actions.Logger"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n       class=".logger.LoggerAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.actions.logger.ILoggerAction"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.actions.logger.ILoggerAction"\n       class=".logger.LoggerEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleAction\n-        name="plone.actions.Logger"\n-        title="Logger"\n-        description="Log a particular event"\n-        for="*"\n-        event="*"\n-        addview="plone.actions.Logger"\n-        editview="edit"\n-        schema=".logger.ILoggerAction"\n-        factory=".logger.LoggerAction"\n-        />\n-\n-    <!-- Notify action -->\n-\n-    <adapter factory=".notify.NotifyActionExecutor" />\n-\n-    <browser:page\n-        for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-        name="plone.actions.Notify"\n-        class=".notify.NotifyAddFormView"\n-        permission="plone.app.contentrules.ManageContentRules"\n-      />\n-\n-    <browser:page\n-        for="plone.app.contentrules.actions.notify.INotifyAction"\n-        name="edit"\n-        class=".notify.NotifyEditFormView"\n-        permission="plone.app.contentrules.ManageContentRules"\n-      />\n-\n-    <plone:ruleAction\n-        name="plone.actions.Notify"\n-        title="Notify user"\n-        description="Return a portal message to the user"\n-        for="*"\n-        event="*"\n-        addview="plone.actions.Notify"\n-        editview="edit"\n-        schema=".notify.INotifyAction"\n-        factory=".notify.NotifyAction"\n-        />\n-\n-    <!-- Copy to folder action -->\n-\n-     <adapter factory=".copy.CopyActionExecutor" />\n-\n-     <browser:page\n-       for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-       name="plone.actions.Copy"\n-       class=".copy.CopyAddFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <browser:page\n-       for="plone.app.contentrules.actions.copy.ICopyAction"\n-       name="edit"\n-       class=".copy.CopyEditFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <plone:ruleAction\n-         name="plone.actions.Copy"\n-         title="Copy to folder"\n-         description="Copy the triggering item to a specific folder"\n-         for="*"\n-         event="zope.interface.interfaces.IObjectEvent"\n-         addview="plone.actions.Copy"\n-         editview="edit"\n-         schema=".copy.ICopyAction"\n-         factory=".copy.CopyAction"\n-         />\n-\n-    <!-- Move to folder action -->\n-\n-     <adapter factory=".move.MoveActionExecutor" />\n-\n-     <browser:page\n-       for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-       name="plone.actions.Move"\n-       class=".move.MoveAddFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <browser:page\n-       for="plone.app.contentrules.actions.move.IMoveAction"\n-       name="edit"\n-       class=".move.MoveEditFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <plone:ruleAction\n-         name="plone.actions.Move"\n-         title="Move to folder"\n-         description="Move the triggering item to a specific folder"\n-         for="*"\n-         event="zope.interface.interfaces.IObjectEvent"\n-         addview="plone.actions.Move"\n-         editview="edit"\n-         schema=".move.IMoveAction"\n-         factory=".move.MoveAction"\n-         />\n-\n-    <!-- Delete action (no configurable options) -->\n-\n-     <adapter factory=".delete.DeleteActionExecutor" />\n-\n-     <browser:page\n-       for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-       name="plone.actions.Delete"\n-       class=".delete.DeleteAddForm"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <plone:ruleAction\n-         name="plone.actions.Delete"\n-         title="Delete object"\n-         description="Delete the triggering item"\n-         for="*"\n-         event="zope.interface.interfaces.IObjectEvent"\n-         addview="plone.actions.Delete"\n-         schema=".delete.IDeleteAction"\n-         factory=".delete.DeleteAction"\n-         />\n-\n-    <!-- Transition workflow action -->\n-\n-     <adapter factory=".workflow.WorkflowActionExecutor" />\n-\n-     <browser:page\n-       for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-       name="plone.actions.Workflow"\n-       class=".workflow.WorkflowAddFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <browser:page\n-       for="plone.app.contentrules.actions.workflow.IWorkflowAction"\n-       name="edit"\n-       class=".workflow.WorkflowEditFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <plone:ruleAction\n-         name="plone.actions.Workflow"\n-         title="Transition workflow state"\n-         description="Perform a workflow transition on the triggering object"\n-         for="*"\n-         event="zope.interface.interfaces.IObjectEvent"\n-         addview="plone.actions.Workflow"\n-         editview="edit"\n-         schema=".workflow.IWorkflowAction"\n-         factory=".workflow.WorkflowAction"\n-         />\n-\n-    <!-- Email action definition -->\n-\n-     <adapter factory=".mail.MailActionExecutor" />\n-\n-     <browser:page\n-       for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-       name="plone.actions.Mail"\n-       class=".mail.MailAddFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <browser:page\n-       for="plone.app.contentrules.actions.mail.IMailAction"\n-       name="edit"\n-       class=".mail.MailEditFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <plone:ruleAction\n-         name="plone.actions.Mail"\n-         title="Send email"\n-         description="Send an email on the triggering object"\n-         for="*"\n-         event="*"\n-         addview="plone.actions.Mail"\n-         editview="edit"\n-         schema=".mail.IMailAction"\n-         factory=".mail.MailAction"\n-         />\n-\n-    <!-- Versioning action -->\n-\n-    <adapter factory=".versioning.VersioningActionExecutor" />\n-\n-    <browser:page\n-        for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-        name="plone.actions.Versioning"\n-        class=".versioning.VersioningAddFormView"\n-        permission="plone.app.contentrules.ManageContentRules"\n-      />\n-\n-    <browser:page\n-        for="plone.app.contentrules.actions.versioning.IVersioningAction"\n-        name="edit"\n-        class=".versioning.VersioningEditFormView"\n-        permission="plone.app.contentrules.ManageContentRules"\n-      />\n-\n-    <plone:ruleAction\n-        name="plone.actions.Versioning"\n-        title="Version object"\n-        description="Store a new version of the object"\n-        for="*"\n-        event="*"\n-        addview="plone.actions.Versioning"\n-        editview="edit"\n-        schema=".versioning.IVersioningAction"\n-        factory=".versioning.VersioningAction"\n-        />\n+  <plone:ruleAction\n+      name="plone.actions.Logger"\n+      title="Logger"\n+      description="Log a particular event"\n+      for="*"\n+      event="*"\n+      schema=".logger.ILoggerAction"\n+      factory=".logger.LoggerAction"\n+      addview="plone.actions.Logger"\n+      editview="edit"\n+      />\n+\n+  <!-- Notify action -->\n+\n+  <adapter factory=".notify.NotifyActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Notify"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".notify.NotifyAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.notify.INotifyAction"\n+      class=".notify.NotifyEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Notify"\n+      title="Notify user"\n+      description="Return a portal message to the user"\n+      for="*"\n+      event="*"\n+      schema=".notify.INotifyAction"\n+      factory=".notify.NotifyAction"\n+      addview="plone.actions.Notify"\n+      editview="edit"\n+      />\n+\n+  <!-- Copy to folder action -->\n+\n+  <adapter factory=".copy.CopyActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Copy"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".copy.CopyAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.copy.ICopyAction"\n+      class=".copy.CopyEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Copy"\n+      title="Copy to folder"\n+      description="Copy the triggering item to a specific folder"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".copy.ICopyAction"\n+      factory=".copy.CopyAction"\n+      addview="plone.actions.Copy"\n+      editview="edit"\n+      />\n+\n+  <!-- Move to folder action -->\n+\n+  <adapter factory=".move.MoveActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Move"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".move.MoveAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.move.IMoveAction"\n+      class=".move.MoveEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Move"\n+      title="Move to folder"\n+      description="Move the triggering item to a specific folder"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".move.IMoveAction"\n+      factory=".move.MoveAction"\n+      addview="plone.actions.Move"\n+      editview="edit"\n+      />\n+\n+  <!-- Delete action (no configurable options) -->\n+\n+  <adapter factory=".delete.DeleteActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Delete"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".delete.DeleteAddForm"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Delete"\n+      title="Delete object"\n+      description="Delete the triggering item"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".delete.IDeleteAction"\n+      factory=".delete.DeleteAction"\n+      addview="plone.actions.Delete"\n+      />\n+\n+  <!-- Transition workflow action -->\n+\n+  <adapter factory=".workflow.WorkflowActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Workflow"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".workflow.WorkflowAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.workflow.IWorkflowAction"\n+      class=".workflow.WorkflowEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Workflow"\n+      title="Transition workflow state"\n+      description="Perform a workflow transition on the triggering object"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".workflow.IWorkflowAction"\n+      factory=".workflow.WorkflowAction"\n+      addview="plone.actions.Workflow"\n+      editview="edit"\n+      />\n+\n+  <!-- Email action definition -->\n+\n+  <adapter factory=".mail.MailActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Mail"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".mail.MailAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.mail.IMailAction"\n+      class=".mail.MailEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Mail"\n+      title="Send email"\n+      description="Send an email on the triggering object"\n+      for="*"\n+      event="*"\n+      schema=".mail.IMailAction"\n+      factory=".mail.MailAction"\n+      addview="plone.actions.Mail"\n+      editview="edit"\n+      />\n+\n+  <!-- Versioning action -->\n+\n+  <adapter factory=".versioning.VersioningActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Versioning"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".versioning.VersioningAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.versioning.IVersioningAction"\n+      class=".versioning.VersioningEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Versioning"\n+      title="Version object"\n+      description="Store a new version of the object"\n+      for="*"\n+      event="*"\n+      schema=".versioning.IVersioningAction"\n+      factory=".versioning.VersioningAction"\n+      addview="plone.actions.Versioning"\n+      editview="edit"\n+      />\n \n </configure>\ndiff --git a/plone/app/contentrules/browser/configure.zcml b/plone/app/contentrules/browser/configure.zcml\nindex 3f59775..46f3d75 100644\n--- a/plone/app/contentrules/browser/configure.zcml\n+++ b/plone/app/contentrules/browser/configure.zcml\n@@ -1,196 +1,200 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <!-- Site-wide information -->\n-    <browser:page\n-        for="*"\n-        name="plone_contentrules_info"\n-        class=".info.ContentRulesInfo"\n-        allowed_interface=".interfaces.IContentRulesInfo"\n-        permission="zope.Public"\n-        />\n+  <!-- Site-wide information -->\n+  <browser:page\n+      name="plone_contentrules_info"\n+      for="*"\n+      class=".info.ContentRulesInfo"\n+      allowed_interface=".interfaces.IContentRulesInfo"\n+      permission="zope.Public"\n+      />\n \n-    <!-- Adding views for rules and elements -->\n-    <browser:view\n-      for="Products.CMFCore.interfaces.ISiteRoot"\n+  <!-- Adding views for rules and elements -->\n+  <browser:view\n       name="+rule"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n       class=".adding.RuleAdding"\n       allowed_interface="plone.app.contentrules.browser.interfaces.IRuleAdding"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <class class=".adding.RuleAdding">\n-      <require\n+  <class class=".adding.RuleAdding">\n+    <require\n         permission="plone.app.contentrules.ManageContentRules"\n-        interface=".interfaces.IRuleAdding" />\n-    </class>\n+        interface=".interfaces.IRuleAdding"\n+        />\n+  </class>\n \n-    <browser:view\n-      for="plone.contentrules.rule.interfaces.IRule"\n+  <browser:view\n       name="+condition"\n+      for="plone.contentrules.rule.interfaces.IRule"\n       class=".adding.RuleConditionAdding"\n       allowed_interface=".interfaces.IRuleConditionAdding"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <class class=".adding.RuleConditionAdding">\n-      <require\n+  <class class=".adding.RuleConditionAdding">\n+    <require\n         permission="plone.app.contentrules.ManageContentRules"\n-        interface=".interfaces.IRuleConditionAdding" />\n-    </class>\n+        interface=".interfaces.IRuleConditionAdding"\n+        />\n+  </class>\n \n-    <browser:view\n-      for="plone.contentrules.rule.interfaces.IRule"\n+  <browser:view\n       name="+action"\n+      for="plone.contentrules.rule.interfaces.IRule"\n       class=".adding.RuleActionAdding"\n       allowed_interface=".interfaces.IRuleActionAdding"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <class class=".adding.RuleActionAdding">\n-      <require\n+  <class class=".adding.RuleActionAdding">\n+    <require\n         permission="plone.app.contentrules.ManageContentRules"\n-        interface=".interfaces.IRuleActionAdding" />\n-    </class>\n+        interface=".interfaces.IRuleActionAdding"\n+        />\n+  </class>\n \n-    <!-- Add and edit form for rules -->\n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleAdding"\n+  <!-- Add and edit form for rules -->\n+  <browser:page\n       name="plone.ContentRule"\n+      for="plone.app.contentrules.browser.interfaces.IRuleAdding"\n       class=".rule.RuleAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.contentrules.rule.interfaces.IRule"\n+  <browser:page\n       name="edit"\n+      for="plone.contentrules.rule.interfaces.IRule"\n       class=".rule.RuleEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <!-- Manage rules -->\n+  <!-- Manage rules -->\n \n-    <browser:page\n-      for="Products.CMFCore.interfaces.ISiteRoot"\n+  <browser:page\n       name="rules-controlpanel"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n-      permission="plone.app.contentrules.ManageContentRules"\n       allowed_attributes="template"\n+      permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n+  <browser:page\n       name="manage-elements"\n       for="plone.contentrules.rule.interfaces.IRule"\n       class=".elements.ManageElements"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.contentrules.engine.interfaces.IRuleAssignable"\n+  <browser:page\n       name="manage-content-rules"\n+      for="plone.contentrules.engine.interfaces.IRuleAssignable"\n       class=".assignments.ManageAssignments"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n+  <browser:page\n       name="contentrule-enable"\n+      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n       attribute="enable_rule"\n       permission="plone.app.contentrules.ManageContentRules"\n-    />\n+      />\n \n-    <browser:page\n-      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n+  <browser:page\n       name="contentrule-disable"\n+      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n       attribute="disable_rule"\n       permission="plone.app.contentrules.ManageContentRules"\n-    />\n+      />\n \n-    <browser:page\n-      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n+  <browser:page\n       name="contentrule-delete"\n+      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n       attribute="delete_rule"\n       permission="plone.app.contentrules.ManageContentRules"\n-    />\n+      />\n \n-    <browser:page\n-      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n+  <browser:page\n       name="contentrule-globally-enable"\n+      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n       attribute="globally_enable"\n       permission="plone.app.contentrules.ManageContentRules"\n-    />\n+      />\n \n-    <browser:page\n-      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n+  <browser:page\n       name="contentrule-globally-disable"\n+      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n       attribute="globally_disable"\n       permission="plone.app.contentrules.ManageContentRules"\n-    />\n+      />\n \n-    <!-- Namespace for rules, and for actions and conditions -->\n+  <!-- Namespace for rules, and for actions and conditions -->\n \n-    <adapter\n-        factory=".traversal.RuleNamespace"\n-        name="rule"\n-        />\n-    <adapter\n-        factory=".traversal.RuleConditionNamespace"\n-        name="condition"\n-        />\n-    <adapter\n-        factory=".traversal.RuleActionNamespace"\n-        name="action"\n-        />\n+  <adapter\n+      factory=".traversal.RuleNamespace"\n+      name="rule"\n+      />\n+  <adapter\n+      factory=".traversal.RuleConditionNamespace"\n+      name="condition"\n+      />\n+  <adapter\n+      factory=".traversal.RuleActionNamespace"\n+      name="action"\n+      />\n \n-    <!-- When we access rules and elements, we still want to use a CMF/Plone\n+  <!-- When we access rules and elements, we still want to use a CMF/Plone\n     main_template -->\n \n-    <configure package="Products.CMFPlone.browser">\n+  <configure package="Products.CMFPlone.browser">\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.app.contentrules.browser.interfaces.IRuleAdding"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.app.contentrules.browser.interfaces.IRuleElementAdding"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.contentrules.rule.interfaces.IRule"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.contentrules.rule.interfaces.IRuleElementData"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-    </configure>\n+  </configure>\n \n-    <!-- Rule breadcrumb -->\n+  <!-- Rule breadcrumb -->\n \n   <browser:page\n-      for="plone.contentrules.rule.interfaces.IRule"\n       name="breadcrumbs_view"\n+      for="plone.contentrules.rule.interfaces.IRule"\n       class=".navigation.RuleBreadcrumbs"\n-      permission="zope.Public"\n       allowed_attributes="breadcrumbs"\n+      permission="zope.Public"\n       />\n \n </configure>\ndiff --git a/plone/app/contentrules/conditions/configure.zcml b/plone/app/contentrules/conditions/configure.zcml\nindex a56032f..8622bec 100644\n--- a/plone/app/contentrules/conditions/configure.zcml\n+++ b/plone/app/contentrules/conditions/configure.zcml\n@@ -2,220 +2,224 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <!-- needed since Plone 4.1 to use cmf permissions in ZCML declaration. -->\n+  <!-- needed since Plone 4.1 to use cmf permissions in ZCML declaration. -->\n \n-    <include package="Products.CMFCore" file="permissions.zcml"\n-             xmlns:zcml="http://namespaces.zope.org/zcml"\n-             zcml:condition="have plone-41" />\n+  <include\n+      xmlns:zcml="http://namespaces.zope.org/zcml"\n+      package="Products.CMFCore"\n+      file="permissions.zcml"\n+      zcml:condition="have plone-41"\n+      />\n \n-    <!-- Portal type condition -->\n+  <!-- Portal type condition -->\n \n-    <adapter factory=".portaltype.PortalTypeConditionExecutor" />\n+  <adapter factory=".portaltype.PortalTypeConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.PortalType"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".portaltype.PortalTypeAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.portaltype.IPortalTypeCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.portaltype.IPortalTypeCondition"\n       class=".portaltype.PortalTypeEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.PortalType"\n-        title="Content type"\n-        description="Apply only when the current content object is of a particular type"\n-        for="*"\n-        event="zope.interface.interfaces.IObjectEvent"\n-        addview="plone.conditions.PortalType"\n-        editview="edit"\n-        schema=".portaltype.IPortalTypeCondition"\n-        factory=".portaltype.PortalTypeCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.PortalType"\n+      title="Content type"\n+      description="Apply only when the current content object is of a particular type"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".portaltype.IPortalTypeCondition"\n+      factory=".portaltype.PortalTypeCondition"\n+      addview="plone.conditions.PortalType"\n+      editview="edit"\n+      />\n \n-    <!-- File extension condition -->\n+  <!-- File extension condition -->\n \n-    <adapter factory=".fileextension.FileExtensionConditionExecutor" />\n+  <adapter factory=".fileextension.FileExtensionConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.FileExtension"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".fileextension.FileExtensionAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.fileextension.IFileExtensionCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.fileextension.IFileExtensionCondition"\n       class=".fileextension.FileExtensionEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.FileExtension"\n-        title="File Extension"\n-        description="Apply only to a particular file extension"\n-        for="*"\n-        event="zope.interface.interfaces.IObjectEvent"\n-        addview="plone.conditions.FileExtension"\n-        editview="edit"\n-        schema=".fileextension.IFileExtensionCondition"\n-        factory=".fileextension.FileExtensionCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.FileExtension"\n+      title="File Extension"\n+      description="Apply only to a particular file extension"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".fileextension.IFileExtensionCondition"\n+      factory=".fileextension.FileExtensionCondition"\n+      addview="plone.conditions.FileExtension"\n+      editview="edit"\n+      />\n \n-    <!-- Workflow state condition (for any object) -->\n+  <!-- Workflow state condition (for any object) -->\n \n-    <adapter factory=".wfstate.WorkflowStateConditionExecutor" />\n+  <adapter factory=".wfstate.WorkflowStateConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.WorkflowState"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".wfstate.WorkflowStateAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.wfstate.IWorkflowStateCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.wfstate.IWorkflowStateCondition"\n       class=".wfstate.WorkflowStateEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.WorkflowState"\n-        title="Workflow state"\n-        description="Apply only to a objects in a particular workflow state"\n-        for="*"\n-        event="zope.interface.interfaces.IObjectEvent"\n-        addview="plone.conditions.WorkflowState"\n-        editview="edit"\n-        schema=".wfstate.IWorkflowStateCondition"\n-        factory=".wfstate.WorkflowStateCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.WorkflowState"\n+      title="Workflow state"\n+      description="Apply only to a objects in a particular workflow state"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".wfstate.IWorkflowStateCondition"\n+      factory=".wfstate.WorkflowStateCondition"\n+      addview="plone.conditions.WorkflowState"\n+      editview="edit"\n+      />\n \n-    <!-- Workflow transition condition (for any object) -->\n+  <!-- Workflow transition condition (for any object) -->\n \n-    <adapter factory=".wftransition.WorkflowTransitionConditionExecutor" />\n+  <adapter factory=".wftransition.WorkflowTransitionConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.WorkflowTransition"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".wftransition.WorkflowTransitionAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.wftransition.IWorkflowTransitionCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.wftransition.IWorkflowTransitionCondition"\n       class=".wftransition.WorkflowTransitionEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.WorkflowTransition"\n-        title="Workflow transition"\n-        description="Apply only when the executed transition was as specified"\n-        for="*"\n-        event="Products.CMFCore.interfaces.IActionSucceededEvent"\n-        addview="plone.conditions.WorkflowTransition"\n-        editview="edit"\n-        schema=".wftransition.IWorkflowTransitionCondition"\n-        factory=".wftransition.WorkflowTransitionCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.WorkflowTransition"\n+      title="Workflow transition"\n+      description="Apply only when the executed transition was as specified"\n+      for="*"\n+      event="Products.CMFCore.interfaces.IActionSucceededEvent"\n+      schema=".wftransition.IWorkflowTransitionCondition"\n+      factory=".wftransition.WorkflowTransitionCondition"\n+      addview="plone.conditions.WorkflowTransition"\n+      editview="edit"\n+      />\n \n-    <!-- Group condition -->\n-    <adapter factory=".group.GroupConditionExecutor" />\n+  <!-- Group condition -->\n+  <adapter factory=".group.GroupConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.Group"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".group.GroupAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.group.IGroupCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.group.IGroupCondition"\n       class=".group.GroupEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.Group"\n-        title="User\'s group"\n-        description="Apply only when the current user is in the given group"\n-        for="*"\n-        event="*"\n-        addview="plone.conditions.Group"\n-        editview="edit"\n-        schema=".group.IGroupCondition"\n-        factory=".group.GroupCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.Group"\n+      title="User\'s group"\n+      description="Apply only when the current user is in the given group"\n+      for="*"\n+      event="*"\n+      schema=".group.IGroupCondition"\n+      factory=".group.GroupCondition"\n+      addview="plone.conditions.Group"\n+      editview="edit"\n+      />\n \n-    <!-- Role condition -->\n-    <adapter factory=".role.RoleConditionExecutor" />\n+  <!-- Role condition -->\n+  <adapter factory=".role.RoleConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.Role"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".role.RoleAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.role.IRoleCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.role.IRoleCondition"\n       class=".role.RoleEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.Role"\n-        title="User\'s role"\n-        description="Apply only when the current user has the given role"\n-        for="*"\n-        event="*"\n-        addview="plone.conditions.Role"\n-        editview="edit"\n-        schema=".role.IRoleCondition"\n-        factory=".role.RoleCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.Role"\n+      title="User\'s role"\n+      description="Apply only when the current user has the given role"\n+      for="*"\n+      event="*"\n+      schema=".role.IRoleCondition"\n+      factory=".role.RoleCondition"\n+      addview="plone.conditions.Role"\n+      editview="edit"\n+      />\n \n-    <!-- TALES expression condition -->\n+  <!-- TALES expression condition -->\n \n-    <adapter factory=".talesexpression.TalesExpressionConditionExecutor" />\n+  <adapter factory=".talesexpression.TalesExpressionConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.TalesExpression"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".talesexpression.TalesExpressionAddFormView"\n       permission="cmf.ManagePortal"\n       />\n \n-    <browser:page\n-      for=".talesexpression.ITalesExpressionCondition"\n+  <browser:page\n       name="edit"\n+      for=".talesexpression.ITalesExpressionCondition"\n       class=".talesexpression.TalesExpressionEditFormView"\n       permission="cmf.ManagePortal"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.TalesExpression"\n-        title="TALES expression"\n-        description="Apply only when the result of a TALES expression is True"\n-        for="*"\n-        event="*"\n-        addview="plone.conditions.TalesExpression"\n-        editview="edit"\n-        schema=".talesexpression.ITalesExpressionCondition"\n-        factory=".talesexpression.TalesExpressionCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.TalesExpression"\n+      title="TALES expression"\n+      description="Apply only when the result of a TALES expression is True"\n+      for="*"\n+      event="*"\n+      schema=".talesexpression.ITalesExpressionCondition"\n+      factory=".talesexpression.TalesExpressionCondition"\n+      addview="plone.conditions.TalesExpression"\n+      editview="edit"\n+      />\n \n </configure>\ndiff --git a/plone/app/contentrules/configure.zcml b/plone/app/contentrules/configure.zcml\nindex eca3cbe..ba2ca30 100644\n--- a/plone/app/contentrules/configure.zcml\n+++ b/plone/app/contentrules/configure.zcml\n@@ -2,162 +2,166 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <include package="zope.annotation" />\n-    <include package="plone.contentrules" />\n-    <include package="plone.contentrules" file="meta.zcml" />\n-    <include package="plone.stringinterp" />\n+  <include package="zope.annotation" />\n+  <include package="plone.contentrules" />\n+  <include\n+      package="plone.contentrules"\n+      file="meta.zcml"\n+      />\n+  <include package="plone.stringinterp" />\n \n-    <!-- Create permissions -->\n+  <!-- Create permissions -->\n \n-    <permission\n-        id="plone.app.contentrules.ManageContentRules"\n-        title="Content rules: Manage rules"\n-       />\n+  <permission\n+      id="plone.app.contentrules.ManageContentRules"\n+      title="Content rules: Manage rules"\n+      />\n \n-    <include package=".browser" />\n-    <include package=".actions" />\n-    <include package=".conditions" />\n-    <include package=".exportimport" />\n+  <include package=".browser" />\n+  <include package=".actions" />\n+  <include package=".conditions" />\n+  <include package=".exportimport" />\n \n-    <!-- Make any folder and the portal root a possible container for rules -->\n+  <!-- Make any folder and the portal root a possible container for rules -->\n \n-    <class class="Products.CMFPlone.Portal.PloneSite">\n-        <implements interface="plone.contentrules.engine.interfaces.IRuleAssignable" />\n-    </class>\n+  <class class="Products.CMFPlone.Portal.PloneSite">\n+    <implements interface="plone.contentrules.engine.interfaces.IRuleAssignable" />\n+  </class>\n \n-    <!-- Let rules be annotatable - used to keep track of rule-to-assignment mappings -->\n+  <!-- Let rules be annotatable - used to keep track of rule-to-assignment mappings -->\n \n-    <class class="plone.app.contentrules.rule.Rule">\n-        <implements interface="zope.annotation.interfaces.IAttributeAnnotatable" />\n-    </class>\n+  <class class="plone.app.contentrules.rule.Rule">\n+    <implements interface="zope.annotation.interfaces.IAttributeAnnotatable" />\n+  </class>\n \n-    <!-- Make the object related events selectable -->\n+  <!-- Make the object related events selectable -->\n \n-    <interface\n+  <interface\n       interface="zope.lifecycleevent.interfaces.IObjectAddedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="Object added to this container"\n       />\n \n-    <interface\n+  <interface\n       interface="zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="Object removed from this container"\n       />\n \n-    <interface\n+  <interface\n       interface="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="Object modified"\n       />\n \n-    <interface\n+  <interface\n       interface="zope.lifecycleevent.interfaces.IObjectCopiedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="Object copied"\n       />\n \n-    <interface\n+  <interface\n       interface="Products.CMFCore.interfaces.IActionSucceededEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="Workflow state changed"\n       />\n \n-    <interface\n+  <interface\n       interface="Products.PluggableAuthService.interfaces.events.IUserLoggedInEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="User Logged in"\n       />\n \n-    <interface\n+  <interface\n       interface="Products.PluggableAuthService.interfaces.events.IUserLoggedOutEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="User Logged out"\n       />\n \n-    <interface\n+  <interface\n       interface="Products.PluggableAuthService.interfaces.events.IPrincipalCreatedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="User Created"\n       />\n \n-    <interface\n+  <interface\n       interface="Products.PluggableAuthService.interfaces.events.IPrincipalDeletedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="User Removed"\n       />\n \n-   <!-- Register handlers -->\n+  <!-- Register handlers -->\n \n-    <!-- Rule triggers -->\n-    <subscriber\n+  <!-- Rule triggers -->\n+  <subscriber\n       for="zope.lifecycleevent.interfaces.IObjectAddedEvent"\n       handler=".handlers.added"\n       />\n-    <subscriber\n-      zcml:condition="installed Products.Archetypes"\n+  <subscriber\n       for="Products.Archetypes.interfaces.IObjectInitializedEvent"\n       handler=".handlers.archetypes_initialized"\n+      zcml:condition="installed Products.Archetypes"\n       />\n-    <subscriber\n+  <subscriber\n       for="zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n       handler=".handlers.removed"\n       />\n-    <subscriber\n+  <subscriber\n       for="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n       handler=".handlers.modified"\n       />\n-     <subscriber\n+  <subscriber\n       for="zope.lifecycleevent.interfaces.IObjectCopiedEvent"\n       handler=".handlers.copied"\n       />\n-    <subscriber\n+  <subscriber\n       for="Products.CMFCore.interfaces.IActionSucceededEvent"\n       handler=".handlers.workflow_action"\n       />\n-    <subscriber\n+  <subscriber\n       for="Products.PluggableAuthService.interfaces.events.IUserLoggedInEvent"\n       handler=".handlers.user_logged_in"\n-    />\n-    <subscriber\n+      />\n+  <subscriber\n       for="Products.PluggableAuthService.interfaces.events.IUserLoggedOutEvent"\n       handler=".handlers.user_logged_out"\n-    />\n-    <subscriber\n+      />\n+  <subscriber\n       for="Products.PluggableAuthService.interfaces.events.IPrincipalCreatedEvent"\n       handler=".handlers.user_created"\n-    />\n-    <!-- Cleanup -->\n-    <subscriber\n-       for="zope.publisher.interfaces.IEndRequestEvent"\n-       handler=".handlers.close"\n-       />\n-\n-    <!-- Rule-to-assignment mappings -->\n-    <subscriber\n-        for="plone.contentrules.engine.interfaces.IRuleAssignable\n-             zope.lifecycleevent.interfaces.IObjectMovedEvent"\n-        handler=".rule.container_moved"\n-        />\n-    <subscriber\n-        for="plone.contentrules.engine.interfaces.IRuleAssignable\n-             zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n-        handler=".rule.container_removed"\n-        />\n-    <subscriber\n-        for="plone.contentrules.rule.interfaces.IRule\n-             zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n-        handler=".rule.rule_removed"\n-        />\n-\n-    <!-- Register a name chooser explicitly -->\n-\n-    <adapter\n+      />\n+  <!-- Cleanup -->\n+  <subscriber\n+      for="zope.publisher.interfaces.IEndRequestEvent"\n+      handler=".handlers.close"\n+      />\n+\n+  <!-- Rule-to-assignment mappings -->\n+  <subscriber\n+      for="plone.contentrules.engine.interfaces.IRuleAssignable\n+           zope.lifecycleevent.interfaces.IObjectMovedEvent"\n+      handler=".rule.container_moved"\n+      />\n+  <subscriber\n+      for="plone.contentrules.engine.interfaces.IRuleAssignable\n+           zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n+      handler=".rule.container_removed"\n+      />\n+  <subscriber\n+      for="plone.contentrules.rule.interfaces.IRule\n+           zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n+      handler=".rule.rule_removed"\n+      />\n+\n+  <!-- Register a name chooser explicitly -->\n+\n+  <adapter\n+      factory=".namechooser.RuleNameChooser"\n       provides="zope.container.interfaces.INameChooser"\n       for="plone.contentrules.engine.interfaces.IRuleStorage"\n-      factory=".namechooser.RuleNameChooser"\n       />\n \n </configure>\ndiff --git a/plone/app/contentrules/exportimport/configure.zcml b/plone/app/contentrules/exportimport/configure.zcml\nindex 729381e..2419b22 100644\n--- a/plone/app/contentrules/exportimport/configure.zcml\n+++ b/plone/app/contentrules/exportimport/configure.zcml\n@@ -1,33 +1,33 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <adapter\n-        factory=".rules.RulesXMLAdapter"\n-        name="plone.contentrules"\n-        />\n+  <adapter\n+      factory=".rules.RulesXMLAdapter"\n+      name="plone.contentrules"\n+      />\n \n-    <adapter\n-        factory=".rules.PropertyRuleElementExportImportHandler"\n-        />\n+  <adapter factory=".rules.PropertyRuleElementExportImportHandler" />\n \n-    <!-- Register import and export steps -->\n-    <genericsetup:importStep\n-        name="contentrules"\n-        title="Content rules"\n-        description="Import content rule definitions and assignments"\n-        handler=".rules.importRules">\n-        <depends name="componentregistry"/>\n-        <depends name="content"/>\n-        <depends name="workflow"/>\n-    </genericsetup:importStep>\n+  <!-- Register import and export steps -->\n+  <genericsetup:importStep\n+      name="contentrules"\n+      title="Content rules"\n+      description="Import content rule definitions and assignments"\n+      handler=".rules.importRules"\n+      >\n+    <depends name="componentregistry" />\n+    <depends name="content" />\n+    <depends name="workflow" />\n+  </genericsetup:importStep>\n \n-    <genericsetup:exportStep\n-        name="contentrules"\n-        title="Content rules"\n-        description="Export content rule definitions and assignments"\n-        handler=".rules.exportRules"\n-        />\n+  <genericsetup:exportStep\n+      name="contentrules"\n+      title="Content rules"\n+      description="Export content rule definitions and assignments"\n+      handler=".rules.exportRules"\n+      />\n \n </configure>\ndiff --git a/plone/app/contentrules/tests/profiles/testing/contentrules.xml b/plone/app/contentrules/tests/profiles/testing/contentrules.xml\nindex 9446c81..ae7c2a8 100644\n--- a/plone/app/contentrules/tests/profiles/testing/contentrules.xml\n+++ b/plone/app/contentrules/tests/profiles/testing/contentrules.xml\n@@ -1,137 +1,132 @@\n <?xml version="1.0" encoding="utf-8"?>\n <contentrules>\n \n-    <rule\n+  <rule description="A test rule"\n+        enabled="True"\n+        event="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n         name="test1"\n+        stop-after="False"\n         title="Test rule 1"\n-        description="A test rule"\n-        event="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n-        enabled="True"\n-        stop-after="False">\n-        <conditions>\n-            <condition type="plone.conditions.PortalType">\n-                <property name="check_types">\n-                    <element>Document</element>\n-                    <element>News Item</element>\n-                </property>\n-            </condition>\n-            <condition type="plone.conditions.Role">\n-                <property name="role_names">\n-                    <element>Manager</element>\n-                </property>\n-            </condition>\n-        </conditions>\n-        <actions>\n-            <action type="plone.actions.Notify">\n-                <property name="message">A message: Hej d\xc3\xa5</property>\n-                <property name="message_type">info</property>\n-            </action>\n-        </actions>\n-    </rule>\n+  >\n+    <conditions>\n+      <condition type="plone.conditions.PortalType">\n+        <property name="check_types">\n+          <element>Document</element>\n+          <element>News Item</element>\n+        </property>\n+      </condition>\n+      <condition type="plone.conditions.Role">\n+        <property name="role_names">\n+          <element>Manager</element>\n+        </property>\n+      </condition>\n+    </conditions>\n+    <actions>\n+      <action type="plone.actions.Notify">\n+        <property name="message">A message: Hej d\xc3\xa5</property>\n+        <property name="message_type">info</property>\n+      </action>\n+    </actions>\n+  </rule>\n \n-    <rule\n+  <rule description="Another test rule"\n+        enabled="False"\n+        event="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n         name="test2"\n+        stop-after="True"\n         title="Test rule 2"\n-        description="Another test rule"\n-        event="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n-        enabled="False"\n-        stop-after="True">\n-        <conditions>\n-            <condition type="plone.conditions.PortalType">\n-                <property name="check_types">\n-                    <element>Event</element>\n-                </property>\n-            </condition>\n-        </conditions>\n-        <actions>\n-            <action type="plone.actions.Workflow">\n-                <property name="transition">publish</property>\n-            </action>\n-        </actions>\n-    </rule>\n+  >\n+    <conditions>\n+      <condition type="plone.conditions.PortalType">\n+        <property name="check_types">\n+          <element>Event</element>\n+        </property>\n+      </condition>\n+    </conditions>\n+    <actions>\n+      <action type="plone.actions.Workflow">\n+        <property name="transition">publish</property>\n+      </action>\n+    </actions>\n+  </rule>\n \n-    <rule\n+  <rule description="Third test rule"\n+        event="zope.lifecycleevent.interfaces.IObjectMovedEvent"\n         name="test3"\n         title="Test rule 3"\n-        description="Third test rule"\n-        event="zope.lifecycleevent.interfaces.IObjectMovedEvent"\n-        />\n+  />\n \n-    <rule\n+  <rule description="We move published events in a folder"\n+        enabled="True"\n+        event="Products.CMFCore.interfaces.IActionSucceededEvent"\n         name="test4"\n+        stop-after="True"\n         title="Test rule 4"\n-        description="We move published events in a folder"\n-        event="Products.CMFCore.interfaces.IActionSucceededEvent"\n-        enabled="True"\n-        stop-after="True">\n-        <conditions>\n-            <condition type="plone.conditions.PortalType">\n-                <property name="check_types">\n-                    <element>Event</element>\n-                </property>\n-            </condition>\n-            <condition type="plone.conditions.WorkflowTransition">\n-                <property name="wf_transitions">\n-                    <element>publish</element>\n-                </property>\n-            </condition>\n-        </conditions>\n-        <actions>\n-            <action type="plone.actions.Move">\n-                <property name="target_folder">/events</property>\n-            </action>\n-        </actions>\n-    </rule>\n+  >\n+    <conditions>\n+      <condition type="plone.conditions.PortalType">\n+        <property name="check_types">\n+          <element>Event</element>\n+        </property>\n+      </condition>\n+      <condition type="plone.conditions.WorkflowTransition">\n+        <property name="wf_transitions">\n+          <element>publish</element>\n+        </property>\n+      </condition>\n+    </conditions>\n+    <actions>\n+      <action type="plone.actions.Move">\n+        <property name="target_folder">/events</property>\n+      </action>\n+    </actions>\n+  </rule>\n \n-    <rule\n-        name="test5"\n-        title="Test rule 5"\n+  <rule cascading="True"\n         description="Auto publish events"\n-        event="zope.lifecycleevent.interfaces.IObjectAddedEvent"\n         enabled="True"\n-        cascading="True" stop-after="False">\n-        <conditions>\n-            <condition type="plone.conditions.PortalType">\n-                <property name="check_types">\n-                    <element>Event</element>\n-                </property>\n-            </condition>\n-        </conditions>\n-        <actions>\n-            <action type="plone.actions.Workflow">\n-                <property name="transition">publish</property>\n-            </action>\n-        </actions>\n-    </rule>\n-\n-    <assignment\n-        location="/news"\n-        name="test1"\n-        enabled="True"\n-        bubbles="False"\n-        />\n-    <assignment\n-        location="/news"\n-        name="test2"\n-        enabled="False"\n-        bubbles="True"\n-        insert-before="test1"\n-        />\n-    <assignment\n-        location="/news"\n-        name="test3"\n-        insert-before="*"\n-        />\n-    <assignment\n-        location="/"\n-        name="test4"\n-        insert-before="*"\n-        enabled="False"\n-        />\n-    <assignment\n-        location="/"\n+        event="zope.lifecycleevent.interfaces.IObjectAddedEvent"\n         name="test5"\n-        enabled="False"\n-        />\n+        stop-after="False"\n+        title="Test rule 5"\n+  >\n+    <conditions>\n+      <condition type="plone.conditions.PortalType">\n+        <property name="check_types">\n+          <element>Event</element>\n+        </property>\n+      </condition>\n+    </conditions>\n+    <actions>\n+      <action type="plone.actions.Workflow">\n+        <property name="transition">publish</property>\n+      </action>\n+    </actions>\n+  </rule>\n+\n+  <assignment bubbles="False"\n+              enabled="True"\n+              location="/news"\n+              name="test1"\n+  />\n+  <assignment bubbles="True"\n+              enabled="False"\n+              insert-before="test1"\n+              location="/news"\n+              name="test2"\n+  />\n+  <assignment insert-before="*"\n+              location="/news"\n+              name="test3"\n+  />\n+  <assignment enabled="False"\n+              insert-before="*"\n+              location="/"\n+              name="test4"\n+  />\n+  <assignment enabled="False"\n+              location="/"\n+              name="test5"\n+  />\n \n </contentrules>\ndiff --git a/plone/app/contentrules/tests/profiles/testing/export_steps.xml b/plone/app/contentrules/tests/profiles/testing/export_steps.xml\nindex a4a9cde..b3bd0b4 100644\n--- a/plone/app/contentrules/tests/profiles/testing/export_steps.xml\n+++ b/plone/app/contentrules/tests/profiles/testing/export_steps.xml\n@@ -1,8 +1,9 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <export-steps>\n- <export-step id="contentrules"\n-              handler="plone.app.contentrules.exportimport.rules.exportRules"\n-              title="Content rules">\n+  <export-step id="contentrules"\n+               handler="plone.app.contentrules.exportimport.rules.exportRules"\n+               title="Content rules"\n+  >\n     Export content rules\n  </export-step>\n </export-steps>\ndiff --git a/plone/app/contentrules/tests/profiles/testing/import_steps.xml b/plone/app/contentrules/tests/profiles/testing/import_steps.xml\nindex c73d85b..9de5d35 100644\n--- a/plone/app/contentrules/tests/profiles/testing/import_steps.xml\n+++ b/plone/app/contentrules/tests/profiles/testing/import_steps.xml\n@@ -1,9 +1,11 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <import-steps>\n- <import-step id="contentrules" version="20081221-01"\n+  <import-step id="contentrules"\n                handler="plone.app.contentrules.exportimport.rules.importRules"\n-               title="Content rules">\n-    <dependency step="componentregistry"/>\n+               title="Content rules"\n+               version="20081221-01"\n+  >\n+    <dependency step="componentregistry" />\n     Import content rules\n- </import-step>\n+  </import-step>\n </import-steps>\ndiff --git a/plone/app/contentrules/tests/testing.zcml b/plone/app/contentrules/tests/testing.zcml\nindex 80dcd4d..a3667e7 100644\n--- a/plone/app/contentrules/tests/testing.zcml\n+++ b/plone/app/contentrules/tests/testing.zcml\n@@ -1,15 +1,17 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:gs="http://namespaces.zope.org/genericsetup"\n-           package="plone.app.contentrules"\n-           i18n_domain="plone">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:gs="http://namespaces.zope.org/genericsetup"\n+    package="plone.app.contentrules"\n+    i18n_domain="plone"\n+    >\n \n-    <gs:registerProfile\n-        name="testing"\n-        title="plone.app.contentrules testing"\n-        description="Used for testing only"\n-        directory="tests/profiles/testing"\n-        for="Products.CMFCore.interfaces.ISiteRoot"\n-        provides="Products.GenericSetup.interfaces.EXTENSION"\n-        />\n+  <gs:registerProfile\n+      name="testing"\n+      title="plone.app.contentrules testing"\n+      description="Used for testing only"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      directory="tests/profiles/testing"\n+      />\n \n </configure>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2023-03-25T22:23:25+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/70e1d94c8be7dc558ef4cd5958a2fc0a79588e2d

chore: zpretty PT

Files changed:
M plone/app/contentrules/actions/templates/mail.pt
M plone/app/contentrules/browser/templates/contentrules-pageform.pt
M plone/app/contentrules/browser/templates/controlpanel.pt
M plone/app/contentrules/browser/templates/manage-assignments.pt
M plone/app/contentrules/browser/templates/manage-elements.pt

b'diff --git a/plone/app/contentrules/actions/templates/mail.pt b/plone/app/contentrules/actions/templates/mail.pt\nindex 4b1f48f..b30ccb1 100644\n--- a/plone/app/contentrules/actions/templates/mail.pt\n+++ b/plone/app/contentrules/actions/templates/mail.pt\n@@ -1,29 +1,32 @@\n <metal:block use-macro="context/@@ploneform-macros/titlelessform" />\n <tal:i18n i18n:domain="plone">\n-<h1 i18n:translate="title_contentrules_mailsub">Substitutions</h1>\n+  <h1 i18n:translate="title_contentrules_mailsub">Substitutions</h1>\n \n-<p i18n:translate="description-contentrules-mailsub">\n+  <p i18n:translate="description-contentrules-mailsub">\n     Some content in the subject, email source, email recipient and message\n     may be replaced with "$&#123;&#125;" variables from the table below.\n-</p>\n+  </p>\n \n-<table class="listing">\n-<thead>\n-    <tr>\n+  <table class="listing">\n+    <thead>\n+      <tr>\n         <th i18n:translate="category-contentrules-mailsub">Category</th>\n         <th i18n:translate="variable-contentrules-mailsub">Variable</th>\n         <th i18n:translate="substitution-contentrules-mailsub">Substitution</th>\n-    </tr>\n-</thead>\n-<tbody>\n-<tal:block tal:define="sublist here/@@stringinterp_info/substitutionList"\n-     tal:repeat="category sublist">\n-     <tr tal:repeat="item python:category[\'items\']">\n-         <td tal:content="category/category">All Content</td>\n-         <td>${<span tal:replace="item/id">url</span>}</td>\n-         <td tal:content="item/description">URL</td>\n-     </tr>\n-</tal:block>\n-</tbody>\n-</table>\n+      </tr>\n+    </thead>\n+    <tbody>\n+      <tal:block tal:define="\n+                   sublist here/@@stringinterp_info/substitutionList;\n+                 "\n+                 tal:repeat="category sublist"\n+      >\n+        <tr tal:repeat="item python:category[\'items\']">\n+          <td tal:content="category/category">All Content</td>\n+          <td>${<span tal:replace="item/id">url</span>}</td>\n+          <td tal:content="item/description">URL</td>\n+        </tr>\n+      </tal:block>\n+    </tbody>\n+  </table>\n </tal:i18n>\ndiff --git a/plone/app/contentrules/browser/templates/contentrules-pageform.pt b/plone/app/contentrules/browser/templates/contentrules-pageform.pt\nindex b8c5f0c..4f392ae 100644\n--- a/plone/app/contentrules/browser/templates/contentrules-pageform.pt\n+++ b/plone/app/contentrules/browser/templates/contentrules-pageform.pt\n@@ -1,32 +1,39 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      xml:lang="en" lang="en"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      lang="en"\n       metal:use-macro="context/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n-<div metal:fill-slot="prefs_configlet_main">\n+  <body>\n+    <div metal:fill-slot="prefs_configlet_main">\n \n-    <a id="setup-link" class="link-parent"\n-       tal:attributes="href string:$portal_url/@@overview-controlpanel"\n-       i18n:translate="">\n+      <a class="link-parent"\n+         id="setup-link"\n+         tal:attributes="\n+           href string:$portal_url/@@overview-controlpanel;\n+         "\n+         i18n:translate=""\n+      >\n         Site Setup\n-    </a>\n+      </a>\n \n-    <h1 class="documentFirstHeading"\n-        tal:content="view/label">View Title</h1>\n+      <h1 class="documentFirstHeading"\n+          tal:content="view/label"\n+      >View Title</h1>\n \n-    <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n       Portal status message\n-    </div>\n+      </div>\n \n-    <div id="content-core">\n+      <div id="content-core">\n         <div id="layout-contents">\n-            <span tal:replace="structure view/contents" />\n+          <span tal:replace="structure view/contents"></span>\n         </div>\n-    </div>\n+      </div>\n \n-</div>\n-</body>\n+    </div>\n+  </body>\n </html>\ndiff --git a/plone/app/contentrules/browser/templates/controlpanel.pt b/plone/app/contentrules/browser/templates/controlpanel.pt\nindex e8d3593..021f1f6 100644\n--- a/plone/app/contentrules/browser/templates/controlpanel.pt\n+++ b/plone/app/contentrules/browser/templates/controlpanel.pt\n@@ -1,223 +1,346 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      lang="en"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      lang="en"\n       metal:use-macro="here/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:main metal:fill-slot="prefs_configlet_main"\n-     tal:define="rules view/registeredRules">\n+    <metal:main metal:fill-slot="prefs_configlet_main"\n+                tal:define="\n+                  rules view/registeredRules;\n+                "\n+    >\n \n-  <header>\n-    <h1 class="documentFirstHeading"\n-        i18n:translate="title_manage_contentrules">Content Rules</h1>\n+      <header>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="title_manage_contentrules"\n+        >Content Rules</h1>\n \n-    <p i18n:translate="description-contentrules-controlpanel" class="lead">\n+        <p class="lead"\n+           i18n:translate="description-contentrules-controlpanel"\n+        >\n         Use the form below to define, change or remove content rules. Rules\n         will automatically perform actions on content when certain triggers\n         take place. After defining rules, you may want to go to a folder\n         to assign them, using the "rules" item in the actions menu.\n-    </p>\n-\n-    <div id="fieldset-global">\n-      <form name="ruleSettings" method="POST"\n-           tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n-          <span tal:replace="structure context/@@authenticator/authenticator"/>\n-          <div class="form-check">\n-              <input type="hidden" name="global_disable:boolean:default" value="" />\n-              <input type="checkbox"\n-                     class="form-check-input"\n+        </p>\n+\n+        <div id="fieldset-global">\n+          <form method="POST"\n+                name="ruleSettings"\n+                tal:attributes="\n+                  action string:${context/absolute_url}/@@rules-controlpanel;\n+                "\n+          >\n+            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+            <div class="form-check">\n+              <input name="global_disable:boolean:default"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input class="form-check-input"\n                      id="rules_disable_globally"\n                      name="global_disable:boolean"\n+                     type="checkbox"\n                      value="True"\n-                     tal:attributes="checked python:view.globally_disabled() and \'checked\' or None" />\n-              <label class="form-check-label" for="rules_disable_globally" i18n:translate="">Disable globally</label>\n-              <div class="form-text" i18n:translate="">\n+                     tal:attributes="\n+                       checked python:view.globally_disabled() and \'checked\' or None;\n+                     "\n+              />\n+              <label class="form-check-label"\n+                     for="rules_disable_globally"\n+                     i18n:translate=""\n+              >Disable globally</label>\n+              <div class="form-text"\n+                   i18n:translate=""\n+              >\n                   Whether or not content rules should be disabled globally. If this is selected,\n                   no rules will be executed anywhere in the portal.\n               </div>\n-          </div>\n+            </div>\n \n-          <noscript>\n-          <!-- we\'ll use js to submit this normally -->\n-            <div class="formControls">\n-                <input type="submit"\n+            <noscript>\n+              <!-- we\'ll use js to submit this normally -->\n+              <div class="formControls">\n+                <input class="btn btn-primary"\n                        name="form.button.SaveSettings"\n-                       class="btn btn-primary"\n+                       type="submit"\n                        value="Save"\n-                       i18n:attributes="value label_save;" />\n-            </div>\n-          </noscript>\n-      </form>\n+                       i18n:attributes="value label_save;"\n+                />\n+              </div>\n+            </noscript>\n+          </form>\n \n-    </div>\n+        </div>\n \n \n-  </header>\n+      </header>\n \n-  <div id="content-core">\n-    <div id="translated-text" style="display:none">\n-      <span id="trns_form_error" i18n:translate="">\n+      <div id="content-core">\n+        <div id="translated-text"\n+             style="display:none"\n+        >\n+          <span id="trns_form_error"\n+                i18n:translate=""\n+          >\n         There was an error saving content rules.\n-      </span>\n-      <span id="trns_form_success" i18n:translate="">\n+          </span>\n+          <span id="trns_form_success"\n+                i18n:translate=""\n+          >\n         Content rule settings updated.\n-      </span>\n-      <span id="trns_form_success_enabled" i18n:translate="">\n+          </span>\n+          <span id="trns_form_success_enabled"\n+                i18n:translate=""\n+          >\n         Content rule enabled\n-      </span>\n-      <span id="trns_form_success_disabled" i18n:translate="">\n+          </span>\n+          <span id="trns_form_success_disabled"\n+                i18n:translate=""\n+          >\n         Content rule disabled\n-      </span>\n-      <span id="trns_form_success_deleted" i18n:translate="">\n+          </span>\n+          <span id="trns_form_success_deleted"\n+                i18n:translate=""\n+          >\n         Content rule deleted\n-      </span>\n-    </div>\n+          </span>\n+        </div>\n \n \n-    <div class="card">\n-      <fieldset id="fieldset-rules" class="card-body"\n-                tal:define="rules rules|view/registeredRules;">\n+        <div class="card">\n+          <fieldset class="card-body"\n+                    id="fieldset-rules"\n+                    tal:define="\n+                      rules rules|view/registeredRules;\n+                    "\n+          >\n \n-          <div class="filters row row-cols-lg-auto g-3 align-items-center" tal:condition="rules">\n-            <span class="type-filters">\n-              <label class="col-form-label pe-3" i18n:translate="">Filter rules:</label>\n-              <span class="filter-option"\n-                    tal:repeat="rule view/ruleTypesToShow">\n+            <div class="filters row row-cols-lg-auto g-3 align-items-center"\n+                 tal:condition="rules"\n+            >\n+              <span class="type-filters">\n+                <label class="col-form-label pe-3"\n+                       i18n:translate=""\n+                >Filter rules:</label>\n+                <span class="filter-option"\n+                      tal:repeat="rule view/ruleTypesToShow"\n+                >\n                   <div class="form-check form-check-inline">\n-                    <input id="all" class="form-check-input" type="checkbox"\n-                            tal:attributes="id rule/id"\n-                            />\n+                    <input class="form-check-input"\n+                           id="all"\n+                           type="checkbox"\n+                           tal:attributes="\n+                             id rule/id;\n+                           "\n+                    />\n                     <label class="form-check-label"\n-                            for="all"\n-                            tal:attributes="for rule/id"\n-                            tal:content="rule/title">\n-                            All</label>\n+                           for="all"\n+                           tal:content="rule/title"\n+                           tal:attributes="\n+                             for rule/id;\n+                           "\n+                    >\n+                      All</label>\n                   </div>\n+                </span>\n               </span>\n-            </span>\n-            <span class="state-filters">\n-              <span class="filter-option"\n-                    tal:repeat="state view/statesToShow">\n+              <span class="state-filters">\n+                <span class="filter-option"\n+                      tal:repeat="state view/statesToShow"\n+                >\n                   <div class="form-check form-check-inline">\n-                    <input id="all" class="form-check-input" type="checkbox"\n-                            tal:attributes="id state/id"\n-                            />\n+                    <input class="form-check-input"\n+                           id="all"\n+                           type="checkbox"\n+                           tal:attributes="\n+                             id state/id;\n+                           "\n+                    />\n                     <label class="form-check-label"\n-                            for="all"\n-                            tal:attributes="for state/id"\n-                            tal:content="state/title">\n-                            All</label>\n+                           for="all"\n+                           tal:content="state/title"\n+                           tal:attributes="\n+                             for state/id;\n+                           "\n+                    >\n+                      All</label>\n                   </div>\n+                </span>\n               </span>\n-            </span>\n-          </div>\n-\n-          <div class="visualClear"><!-- --></div>\n-          <div id="rules_table_form"\n-                metal:define-macro="rules_table_form">\n-          <table  class="listing nosort controlpanel-listing table mb-0"\n-                  tal:condition="rules">\n-              <thead class="">\n+            </div>\n+\n+            <div class="visualClear"><!-- --></div>\n+            <div id="rules_table_form"\n+                 metal:define-macro="rules_table_form"\n+            >\n+              <table class="listing nosort controlpanel-listing table mb-0"\n+                     tal:condition="rules"\n+              >\n+                <thead class="">\n                   <tr>\n-                      <th scope="col" i18n:translate="label_contentrules_rule_listing">Content rule</th>\n-                      <th scope="col" i18n:translate="label_contentrules_rule_event">Event</th>\n-                      <th scope="col"><span class="ps-2" i18n:translate="label_contentrules_rule_status">Status</span></th>\n-                      <th scope="col" i18n:translate="label_contentrules_rule_actions">Actions</th>\n+                    <th scope="col"\n+                        i18n:translate="label_contentrules_rule_listing"\n+                    >Content rule</th>\n+                    <th scope="col"\n+                        i18n:translate="label_contentrules_rule_event"\n+                    >Event</th>\n+                    <th scope="col"><span class="ps-2"\n+                            i18n:translate="label_contentrules_rule_status"\n+                      >Status</span></th>\n+                    <th scope="col"\n+                        i18n:translate="label_contentrules_rule_actions"\n+                    >Actions</th>\n                   </tr>\n-              </thead>\n-              <tbody>\n+                </thead>\n+                <tbody>\n                   <tal:rules repeat="rule view/registeredRules">\n-                  <tr tal:define="oddrow repeat/rule/odd"\n-                      tal:attributes="class python:(oddrow and \'even \' or \'odd \') + rule[\'row_class\'];">\n+                    <tr tal:define="\n+                          oddrow repeat/rule/odd;\n+                        "\n+                        tal:attributes="\n+                          class python:(oddrow and \'even \' or \'odd \') + rule[\'row_class\'];\n+                        "\n+                    >\n                       <td>\n                         <h5 class="rule-title">\n-                          <span\n-                              tal:replace="rule/title">Rule Title</span>\n+                          <span tal:replace="rule/title">Rule Title</span>\n                         </h5>\n-                          <div tal:content="rule/description">\n+                        <div tal:content="rule/description">\n                               Rule Description.\n-                          </div>\n+                        </div>\n                       </td>\n                       <td>\n-                          <span class="trigger"\n-                                tal:content="rule/trigger"\n-                                i18n:translate="">trigger</span>\n+                        <span class="trigger"\n+                              tal:content="rule/trigger"\n+                              i18n:translate=""\n+                        >trigger</span>\n                       </td>\n                       <td class="status">\n \n-                        <form style="display: inline" method="POST"\n-                              tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n-                        <span tal:replace="structure context/@@authenticator/authenticator"/>\n-                        <input type="hidden"\n-                              name="rule-id"\n-                              tal:attributes="value rule/id">\n-                        <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link ${python: rule[\'enabled\'] and \'d-none\'}" type="submit" value="Enable"\n-                              name="form.button.EnableRule"\n-                              tal:attributes="data-value rule/id;\n-                                              data-url string:$portal_url/@@contentrule-enable"\n-                              i18n:attributes="value label_enable;">\n-                              <tal:icon tal:replace="structure python:icons.tag(\'square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="enabled">Enabled</span>\n-                        </button>\n-                        <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link ${python: not rule[\'enabled\'] and \'d-none\'}" type="submit" value="Disable"\n-                              name="form.button.DisableRule"\n-                              tal:attributes="data-value rule/id;\n-                                              data-url string:$portal_url/@@contentrule-disable"\n-                              i18n:attributes="value label_disable;">\n-                              <tal:icon tal:replace="structure python:icons.tag(\'check-square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="enabled">Enabled</span>\n-                            </button>\n+                        <form method="POST"\n+                              style="display: inline"\n+                              tal:attributes="\n+                                action string:${context/absolute_url}/@@rules-controlpanel;\n+                              "\n+                        >\n+                          <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                          <input name="rule-id"\n+                                 type="hidden"\n+                                 tal:attributes="\n+                                   value rule/id;\n+                                 "\n+                          />\n+                          <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link ${python: rule[\'enabled\'] and \'d-none\'}"\n+                                  name="form.button.EnableRule"\n+                                  type="submit"\n+                                  value="Enable"\n+                                  tal:attributes="\n+                                    data-value rule/id;\n+                                    data-url string:$portal_url/@@contentrule-enable;\n+                                  "\n+                                  i18n:attributes="value label_enable;"\n+                          >\n+                            <tal:icon tal:replace="structure python:icons.tag(\'square\', tag_alt=\'Toggle to show\')" /><span class="ms-2"\n+                                  i18n:translate="enabled"\n+                            >Enabled</span>\n+                          </button>\n+                          <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link ${python: not rule[\'enabled\'] and \'d-none\'}"\n+                                  name="form.button.DisableRule"\n+                                  type="submit"\n+                                  value="Disable"\n+                                  tal:attributes="\n+                                    data-value rule/id;\n+                                    data-url string:$portal_url/@@contentrule-disable;\n+                                  "\n+                                  i18n:attributes="value label_disable;"\n+                          >\n+                            <tal:icon tal:replace="structure python:icons.tag(\'check-square\', tag_alt=\'Toggle to show\')" /><span class="ms-2"\n+                                  i18n:translate="enabled"\n+                            >Enabled</span>\n+                          </button>\n                         </form>\n \n-                        <span\n-                          class="badge bg-warning text-dark icon-contentrule-enabled-unassigned"\n-                          alt="unassigned"\n-                          title="this rule has not been assigned"\n-                          tal:condition="python:not rule[\'assigned\']"\n-                          i18n:attributes="alt label_contentrules_rule_unassigned;\n-                                          title title_contentrule_rule_unassigned;">\n-                          <tal:icon tal:replace="structure python:icons.tag(\'exclamation-triangle-fill\', tag_alt=\'not assigned\')" /><span class="ms-2" i18n:translate="">not assigned</span>\n-                    </span>\n+                        <span class="badge bg-warning text-dark icon-contentrule-enabled-unassigned"\n+                              alt="unassigned"\n+                              title="this rule has not been assigned"\n+                              tal:condition="python:not rule[\'assigned\']"\n+                              i18n:attributes="alt label_contentrules_rule_unassigned;\n+                                          title title_contentrule_rule_unassigned;"\n+                        >\n+                          <tal:icon tal:replace="structure python:icons.tag(\'exclamation-triangle-fill\', tag_alt=\'not assigned\')" /><span class="ms-2"\n+                                i18n:translate=""\n+                          >not assigned</span>\n+                        </span>\n \n \n \n                       </td>\n                       <td>\n-                        <form style="display: inline" method="POST"\n-                              tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n-                        <span tal:replace="structure context/@@authenticator/authenticator"/>\n-                        <input type="hidden"\n-                              name="rule-id"\n-                              tal:attributes="value rule/id">\n-                        <a href="" class="btn btn-sm btn-primary"\n-                        tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements" i18n:translate="">Configure</a>\n-                        <a href="" class="btn btn-sm btn-secondary"\n-                              tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@edit" i18n:translate="">Edit</a>\n-\n-                        <button class="destructive btn-rule-action btn-rule-delete btn btn-sm btn-danger" type="submit" value="Delete"\n-                              tal:attributes="data-value rule/id;\n-                                              data-url string:$portal_url/@@contentrule-delete"\n-                              name="form.button.DeleteRule"\n-                              i18n:translate=""\n-                              i18n:attributes="value label_delete;">Delete</button>\n+                        <form method="POST"\n+                              style="display: inline"\n+                              tal:attributes="\n+                                action string:${context/absolute_url}/@@rules-controlpanel;\n+                              "\n+                        >\n+                          <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                          <input name="rule-id"\n+                                 type="hidden"\n+                                 tal:attributes="\n+                                   value rule/id;\n+                                 "\n+                          />\n+                          <a class="btn btn-sm btn-primary"\n+                             href=""\n+                             tal:attributes="\n+                               href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements;\n+                             "\n+                             i18n:translate=""\n+                          >Configure</a>\n+                          <a class="btn btn-sm btn-secondary"\n+                             href=""\n+                             tal:attributes="\n+                               href string:${context/absolute_url}/++rule++${rule/id}/@@edit;\n+                             "\n+                             i18n:translate=""\n+                          >Edit</a>\n+\n+                          <button class="destructive btn-rule-action btn-rule-delete btn btn-sm btn-danger"\n+                                  name="form.button.DeleteRule"\n+                                  type="submit"\n+                                  value="Delete"\n+                                  tal:attributes="\n+                                    data-value rule/id;\n+                                    data-url string:$portal_url/@@contentrule-delete;\n+                                  "\n+                                  i18n:attributes="value label_delete;"\n+                                  i18n:translate=""\n+                          >Delete</button>\n                         </form>\n                       </td>\n-                  </tr>\n+                    </tr>\n                   </tal:rules>\n-              </tbody>\n-          </table>\n-          </div>\n-        </fieldset>\n-      </div>\n-      <div class="mt-3">\n-        <a id="#addcontentrule" tal:attributes="href string:${context/absolute_url}/+rule/plone.ContentRule;"\n-            class="plone-btn plone-btn-primary btn btn-success"\n-            i18n:translate="label_contentrule_add">Add content rule</a>\n+                </tbody>\n+              </table>\n+            </div>\n+          </fieldset>\n+        </div>\n+        <div class="mt-3">\n+          <a class="plone-btn plone-btn-primary btn btn-success"\n+             id="#addcontentrule"\n+             tal:attributes="\n+               href string:${context/absolute_url}/+rule/plone.ContentRule;\n+             "\n+             i18n:translate="label_contentrule_add"\n+          >Add content rule</a>\n+        </div>\n       </div>\n-    </div>\n-</metal:main>\n-</body>\n+    </metal:main>\n+  </body>\n </html>\n-\ndiff --git a/plone/app/contentrules/browser/templates/manage-assignments.pt b/plone/app/contentrules/browser/templates/manage-assignments.pt\nindex a7672b7..4a31eb4 100644\n--- a/plone/app/contentrules/browser/templates/manage-assignments.pt\n+++ b/plone/app/contentrules/browser/templates/manage-assignments.pt\n@@ -1,263 +1,364 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      lang="en"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<head>\n-</head>\n+  <head>\n+  </head>\n \n-<body>\n+  <body>\n \n-<metal:body fill-slot="body"\n-    tal:define="icons python:context.restrictedTraverse(\'@@iconresolver\')">\n+    <metal:body fill-slot="body"\n+                tal:define="\n+                  icons python:context.restrictedTraverse(\'@@iconresolver\');\n+                "\n+    >\n \n-      <link rel="stylesheet" type="text/css" media="all"\n-          href="++resource++manage-contentrules.css"\n-          tal:attributes="href string:${context/portal_url}/++resource++manage-contentrules.css" />\n+      <link href="++resource++manage-contentrules.css"\n+            media="all"\n+            rel="stylesheet"\n+            type="text/css"\n+            tal:attributes="\n+              href string:${context/portal_url}/++resource++manage-contentrules.css;\n+            "\n+      />\n \n-    <div tal:condition="not:view/globally_enabled"\n-         class="alert alert-info">\n+      <div class="alert alert-info"\n+           tal:condition="not:view/globally_enabled"\n+      >\n         <strong i18n:translate="">\n             Info\n         </strong>\n         <span i18n:translate="warning_contentrules_disabled">\n             Content rules are disabled globally. No assigned rules will execute\n             until they are re-enabled. Use the\n-            <a href=""\n-               i18n:name="controlpanel_link"\n-               i18n:translate="contentrules_control_panel"\n-               tal:attributes="href string:${portal_url}/@@rules-controlpanel">\n+          <a href=""\n+             tal:attributes="\n+               href string:${portal_url}/@@rules-controlpanel;\n+             "\n+             i18n:name="controlpanel_link"\n+             i18n:translate="contentrules_control_panel"\n+          >\n                 content rules control panel\n-            </a>to enable them again.\n+          </a>to enable them again.\n         </span>\n-    </div>\n+      </div>\n \n-    <article id="content">\n+      <article id="content">\n         <header>\n-            <h1 class="documentFirstHeading"\n-                i18n:translate="title_contentrules_assigned">\n-                Content rules for <q i18n:name="context" tal:content="context/Title">title</q>\n-            </h1>\n+          <h1 class="documentFirstHeading"\n+              i18n:translate="title_contentrules_assigned"\n+          >\n+                Content rules for\n+            <q tal:content="context/Title"\n+               i18n:name="context"\n+            >title</q>\n+          </h1>\n \n-            <div class="lead">\n+          <div class="lead">\n \n-                <span i18n:translate="description_contentrules_assigned" tal:condition="view/has_rules">\n+            <span tal:condition="view/has_rules"\n+                  i18n:translate="description_contentrules_assigned"\n+            >\n                     The following content rules are active in this\n-                    <span i18n:name="type_name" tal:content="view/type_name" />.\n-                </span>\n-                <span i18n:translate="description_contentrules_assigned_norules" tal:condition="not:view/has_rules">\n+              <span tal:content="view/type_name"\n+                    i18n:name="type_name"\n+              ></span>.\n+            </span>\n+            <span tal:condition="not:view/has_rules"\n+                  i18n:translate="description_contentrules_assigned_norules"\n+            >\n                     There are currently no active content rules in this\n-                    <span i18n:name="type_name" tal:content="view/type_name" />.\n-                </span>\n+              <span tal:content="view/type_name"\n+                    i18n:name="type_name"\n+              ></span>.\n+            </span>\n \n-                <span i18n:translate="contentrules_controlpanel_link">\n+            <span i18n:translate="contentrules_controlpanel_link">\n                     Use the\n-                    <a i18n:name="controlpanel_link"\n-                       i18n:translate="contentrules_control_panel"\n-                       tal:attributes="href string:${portal_url}/@@rules-controlpanel">\n+              <a tal:attributes="\n+                   href string:${portal_url}/@@rules-controlpanel;\n+                 "\n+                 i18n:name="controlpanel_link"\n+                 i18n:translate="contentrules_control_panel"\n+              >\n                         content rules control panel\n-                    </a>\n+              </a>\n                     to create new rules or delete or modify existing ones.\n-                </span>\n+            </span>\n \n \n-            </div>\n+          </div>\n \n \n         </header>\n \n         <div id="content-core">\n-            <div class="active">\n-                <div tal:define="acquired_rules view/acquired_rules"\n-                     tal:condition="acquired_rules">\n-                    <table class="table listing nosort">\n-                        <thead>\n-                            <tr>\n-                                <th i18n:translate="label_contentrules_from_parent">\n+          <div class="active">\n+            <div tal:define="\n+                   acquired_rules view/acquired_rules;\n+                 "\n+                 tal:condition="acquired_rules"\n+            >\n+              <table class="table listing nosort">\n+                <thead>\n+                  <tr>\n+                    <th i18n:translate="label_contentrules_from_parent">\n                                     Content rules from parent folders\n-                                </th>\n-                                <th class="smallcolumn" i18n:translate="label_contentrules_active">Active</th>\n-                            </tr>\n-                        </thead>\n-                        <tbody>\n-                            <tal:rules repeat="rule acquired_rules">\n-                                <tr tal:define="oddrow repeat/rule/odd"\n-                                    tal:attributes="class python:oddrow and \'even\' or \'odd\'">\n-                                    <td>\n-                                        <dl>\n-                                            <dt><a tal:attributes="href rule/url">\n-                                                <span tal:replace="rule/title" />\n-                                                (<span class="trigger"\n-                                                    i18n:translate=""\n-                                                    tal:content="rule/trigger">trigger</span>)</a></dt>\n-                                            <dd tal:content="rule/description">\n+                    </th>\n+                    <th class="smallcolumn"\n+                        i18n:translate="label_contentrules_active"\n+                    >Active</th>\n+                  </tr>\n+                </thead>\n+                <tbody>\n+                  <tal:rules repeat="rule acquired_rules">\n+                    <tr tal:define="\n+                          oddrow repeat/rule/odd;\n+                        "\n+                        tal:attributes="\n+                          class python:oddrow and \'even\' or \'odd\';\n+                        "\n+                    >\n+                      <td>\n+                        <dl>\n+                          <dt><a tal:attributes="\n+                                 href rule/url;\n+                               ">\n+                              <span tal:replace="rule/title"></span>\n+                              (<span class="trigger"\n+                                    tal:content="rule/trigger"\n+                                    i18n:translate=""\n+                              >trigger</span>)</a></dt>\n+                          <dd tal:content="rule/description">\n                                                 Rule Description.\n-                                            </dd>\n-                                        </dl>\n-                                    </td>\n-                                    <td class="checker">\n-                                        <tal:icon tal:condition="rule/enabled"\n-                                            i18n:attributes="alt label_contentrules_active;"\n-                                            tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n-                                    </td>\n-                                </tr>\n-                            </tal:rules>\n-                        </tbody>\n-                    </table>\n-                </div>\n+                          </dd>\n+                        </dl>\n+                      </td>\n+                      <td class="checker">\n+                        <tal:icon tal:condition="rule/enabled"\n+                                  tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')"\n+                                  i18n:attributes="alt label_contentrules_active;"\n+                        />\n+                      </td>\n+                    </tr>\n+                  </tal:rules>\n+                </tbody>\n+              </table>\n+            </div>\n \n-                <div id="assignable-content-rules" class="mb-4"\n-                    tal:define="assignable_rules view/assignable_rules"\n-                    tal:condition="assignable_rules">\n-                    <div class="col-form-label" i18n:translate="contentrules_available_rules">\n+            <div class="mb-4"\n+                 id="assignable-content-rules"\n+                 tal:define="\n+                   assignable_rules view/assignable_rules;\n+                 "\n+                 tal:condition="assignable_rules"\n+            >\n+              <div class="col-form-label"\n+                   i18n:translate="contentrules_available_rules"\n+              >\n                         Available content rules:\n-                    </div>\n-                    <form class="row row-cols-auto g-3 align-items-center"\n-                        tal:attributes="action string:${view/view_url}" method="post">\n-                            <div class="col-auto">\n-                                <select class="form-select" name="rule_id" size="1" id="select-rules">\n-                                    <tal:options repeat="rule assignable_rules">\n-                                        <option tal:attributes="value rule/id"\n-                                                tal:content="rule/title">Addable rule name</option>\n-                                    </tal:options>\n-                                </select>\n-                            </div>\n+              </div>\n+              <form class="row row-cols-auto g-3 align-items-center"\n+                    method="post"\n+                    tal:attributes="\n+                      action string:${view/view_url};\n+                    "\n+              >\n+                <div class="col-auto">\n+                  <select class="form-select"\n+                          id="select-rules"\n+                          name="rule_id"\n+                          size="1"\n+                  >\n+                    <tal:options repeat="rule assignable_rules">\n+                      <option tal:content="rule/title"\n+                              tal:attributes="\n+                                value rule/id;\n+                              "\n+                      >Addable rule name</option>\n+                    </tal:options>\n+                  </select>\n+                </div>\n \n-                            <div class="col-auto">\n-                                <button class="context btn btn-primary"\n-                                    type="submit"\n-                                    name="form.button.AddAssignment"\n-                                    value="Add"\n-                                    i18n:attributes="value label_add;"\n-                                    i18n:translate="label_add">Add</button>\n-                            </div>\n-                    </form>\n+                <div class="col-auto">\n+                  <button class="context btn btn-primary"\n+                          name="form.button.AddAssignment"\n+                          type="submit"\n+                          value="Add"\n+                          i18n:attributes="value label_add;"\n+                          i18n:translate="label_add"\n+                  >Add</button>\n                 </div>\n+              </form>\n+            </div>\n \n \n-                <div class="clearfix"></div>\n+            <div class="clearfix"></div>\n \n-                <form class="mb-3" tal:attributes="action view/view_url" method="post"\n-                      tal:define="assigned_rules view/assigned_rules" tal:condition="assigned_rules">\n-                    <table class="table listing nosort">\n-                        <thead>\n-                            <tr>\n-                                <th class="smallcolumn">&nbsp;</th>\n-                                <th i18n:translate="label_contentrules_active_assignments">\n+            <form class="mb-3"\n+                  method="post"\n+                  tal:define="\n+                    assigned_rules view/assigned_rules;\n+                  "\n+                  tal:condition="assigned_rules"\n+                  tal:attributes="\n+                    action view/view_url;\n+                  "\n+            >\n+              <table class="table listing nosort">\n+                <thead>\n+                  <tr>\n+                    <th class="smallcolumn">&nbsp;</th>\n+                    <th i18n:translate="label_contentrules_active_assignments">\n                                     Active content rules in this\n-                                    <span i18n:name="content_type"\n-                                          tal:replace="view/type_name" />\n-                                </th>\n-                                <th class="smallcolumn">\n+                      <span tal:replace="view/type_name"\n+                            i18n:name="content_type"\n+                      ></span>\n+                    </th>\n+                    <th class="smallcolumn">\n                                     &nbsp;\n-                                </th>\n-                                <th class="smallcolumn" i18n:translate="label_contentrules_subfolders">\n+                    </th>\n+                    <th class="smallcolumn"\n+                        i18n:translate="label_contentrules_subfolders"\n+                    >\n                                     Applies to subfolders?\n-                                </th>\n-                                <th class="smallcolumn" i18n:translate="label_contentrules_assignment_enabled">\n+                    </th>\n+                    <th class="smallcolumn"\n+                        i18n:translate="label_contentrules_assignment_enabled"\n+                    >\n                                     Enabled here?\n-                                </th>\n-                                <th class="smallcolumn" i18n:translate="label_contentrules_rule_enabled_question">\n+                    </th>\n+                    <th class="smallcolumn"\n+                        i18n:translate="label_contentrules_rule_enabled_question"\n+                    >\n                                     Enabled?\n-                                </th>\n-                            </tr>\n-                        </thead>\n-                        <tbody>\n-                            <tal:rules repeat="rule assigned_rules">\n-                            <tr tal:define="oddrow repeat/rule/odd"\n-                                tal:attributes="class python:oddrow and \'even\' or \'odd\'">\n-                                <td>\n-                                    <input type="checkbox"\n-                                           name="rule_ids:list"\n-                                           tal:attributes="value rule/id" />\n-                                </td>\n-                                <td>\n-                                    <dl>\n-                                        <dt><a tal:attributes="href rule/url">\n-                                            <span tal:replace="rule/title" />\n-                                            (<span class="trigger"\n-                                                i18n:translate=""\n-                                                tal:content="rule/trigger">trigger</span>)</a></dt>\n-                                        <dd tal:content="rule/description">\n+                    </th>\n+                  </tr>\n+                </thead>\n+                <tbody>\n+                  <tal:rules repeat="rule assigned_rules">\n+                    <tr tal:define="\n+                          oddrow repeat/rule/odd;\n+                        "\n+                        tal:attributes="\n+                          class python:oddrow and \'even\' or \'odd\';\n+                        "\n+                    >\n+                      <td>\n+                        <input name="rule_ids:list"\n+                               type="checkbox"\n+                               tal:attributes="\n+                                 value rule/id;\n+                               "\n+                        />\n+                      </td>\n+                      <td>\n+                        <dl>\n+                          <dt><a tal:attributes="\n+                                 href rule/url;\n+                               ">\n+                              <span tal:replace="rule/title"></span>\n+                              (<span class="trigger"\n+                                    tal:content="rule/trigger"\n+                                    i18n:translate=""\n+                              >trigger</span>)</a></dt>\n+                          <dd tal:content="rule/description">\n                                             Rule Description.\n-                                        </dd>\n-                                    </dl>\n-                                </td>\n-                                <td class="text-center">\n-                                    <a tal:condition="not:repeat/rule/start"\n-                                       title="Move up"\n-                                       i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id}">\n-                                        <tal:icon tal:replace="structure python:icons.tag(\'caret-up-fill\', tag_class=\'\', tag_alt=\'\')" />\n-                                    </a>\n-                                    <a tal:condition="not:repeat/rule/end"\n-                                       title="Move down"\n-                                       i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id}">\n-                                        <tal:icon tal:replace="structure python:icons.tag(\'caret-down-fill\', tag_class=\'\', tag_alt=\'\')" />\n-                                    </a>\n-                                </td>\n-                                <td class="checker listingCheckbox">\n-                                    <tal:icon tal:condition="rule/bubbles"\n-                                        i18n:attributes="alt label_contentrules_active;"\n-                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n-                                </td>\n-                                <td class="checker listingCheckbox">\n-                                    <tal:icon tal:condition="rule/enabled"\n-                                        i18n:attributes="alt label_contentrules_active;"\n-                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n-                                </td>\n-                                <td class="checker listingCheckbox">\n-                                    <tal:icon tal:condition="rule/global_enabled"\n-                                        i18n:attributes="alt label_contentrules_active;"\n-                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n-                                </td>\n-                            </tr>\n-                            </tal:rules>\n-                        </tbody>\n-                    </table>\n+                          </dd>\n+                        </dl>\n+                      </td>\n+                      <td class="text-center">\n+                        <a title="Move up"\n+                           tal:condition="not:repeat/rule/start"\n+                           tal:attributes="\n+                             href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id};\n+                           "\n+                           i18n:attributes="title"\n+                        >\n+                          <tal:icon tal:replace="structure python:icons.tag(\'caret-up-fill\', tag_class=\'\', tag_alt=\'\')" />\n+                        </a>\n+                        <a title="Move down"\n+                           tal:condition="not:repeat/rule/end"\n+                           tal:attributes="\n+                             href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id};\n+                           "\n+                           i18n:attributes="title"\n+                        >\n+                          <tal:icon tal:replace="structure python:icons.tag(\'caret-down-fill\', tag_class=\'\', tag_alt=\'\')" />\n+                        </a>\n+                      </td>\n+                      <td class="checker listingCheckbox">\n+                        <tal:icon tal:condition="rule/bubbles"\n+                                  tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')"\n+                                  i18n:attributes="alt label_contentrules_active;"\n+                        />\n+                      </td>\n+                      <td class="checker listingCheckbox">\n+                        <tal:icon tal:condition="rule/enabled"\n+                                  tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')"\n+                                  i18n:attributes="alt label_contentrules_active;"\n+                        />\n+                      </td>\n+                      <td class="checker listingCheckbox">\n+                        <tal:icon tal:condition="rule/global_enabled"\n+                                  tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')"\n+                                  i18n:attributes="alt label_contentrules_active;"\n+                        />\n+                      </td>\n+                    </tr>\n+                  </tal:rules>\n+                </tbody>\n+              </table>\n \n-                    <div class="formControls">\n-                        <button name="form.button.Enable"\n-                               class="context btn btn-primary"\n-                               type="submit"\n-                               value="Enable"\n-                               i18n:attributes="value label_enable;"\n-                               i18n:translate="label_enable">Enable</button>\n-                        <button name="form.button.Disable"\n-                               class="standalone btn btn-primary"\n-                               type="submit"\n-                               value="Disable"\n-                               i18n:attributes="value label_disable;"\n-                               i18n:translate="label_disable">Disable</button>\n-                        <button name="form.button.Bubble"\n-                               class="standalone btn btn-primary"\n-                               type="submit"\n-                               value="Apply to subfolders"\n-                               i18n:attributes="value label_apply_to_subfolders;"\n-                               i18n:translate="label_apply_to_subfolders">Apply to subfolders</button>\n-                        <button name="form.button.NoBubble"\n-                               class="standalone btn btn-primary"\n-                               type="submit"\n-                               value="Disable apply to subfolders"\n-                               i18n:attributes="value label_disable_apply_to_subfolders;"\n-                               i18n:translate="label_disable_apply_to_subfolders">Disable apply to subfolders</button>\n-                        <button name="form.button.Delete"\n-                               class="destructive btn btn-danger"\n-                               type="submit"\n-                               value="Unassign"\n-                               i18n:attributes="value label_unassign;"\n-                               i18n:translate="label_unassign">Unassign</button>\n-                    </div>\n-                </form>\n-            </div>\n+              <div class="formControls">\n+                <button class="context btn btn-primary"\n+                        name="form.button.Enable"\n+                        type="submit"\n+                        value="Enable"\n+                        i18n:attributes="value label_enable;"\n+                        i18n:translate="label_enable"\n+                >Enable</button>\n+                <button class="standalone btn btn-primary"\n+                        name="form.button.Disable"\n+                        type="submit"\n+                        value="Disable"\n+                        i18n:attributes="value label_disable;"\n+                        i18n:translate="label_disable"\n+                >Disable</button>\n+                <button class="standalone btn btn-primary"\n+                        name="form.button.Bubble"\n+                        type="submit"\n+                        value="Apply to subfolders"\n+                        i18n:attributes="value label_apply_to_subfolders;"\n+                        i18n:translate="label_apply_to_subfolders"\n+                >Apply to subfolders</button>\n+                <button class="standalone btn btn-primary"\n+                        name="form.button.NoBubble"\n+                        type="submit"\n+                        value="Disable apply to subfolders"\n+                        i18n:attributes="value label_disable_apply_to_subfolders;"\n+                        i18n:translate="label_disable_apply_to_subfolders"\n+                >Disable apply to subfolders</button>\n+                <button class="destructive btn btn-danger"\n+                        name="form.button.Delete"\n+                        type="submit"\n+                        value="Unassign"\n+                        i18n:attributes="value label_unassign;"\n+                        i18n:translate="label_unassign"\n+                >Unassign</button>\n+              </div>\n+            </form>\n+          </div>\n         </div>\n \n-    </article>\n+      </article>\n \n-</metal:body>\n-</body>\n+    </metal:body>\n+  </body>\n </html>\ndiff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex 62f672d..b4e13aa 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -1,296 +1,398 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-    xml:lang="en"\n-    lang="en"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    metal:use-macro="here/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="here/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-    <body>\n+  <body>\n \n-        <metal:main metal:fill-slot="prefs_configlet_main">\n+    <metal:main metal:fill-slot="prefs_configlet_main">\n \n-            <header>\n-                <h1 class="documentFirstHeading">\n-                    <span i18n:translate="title_edit_contentrule">Edit content rule</span>:\n-                    <span tal:replace="view/rule_title"></span>\n-                </h1>\n+      <header>\n+        <h1 class="documentFirstHeading">\n+          <span i18n:translate="title_edit_contentrule">Edit content rule</span>:\n+          <span tal:replace="view/rule_title"></span>\n+        </h1>\n \n-                <p i18n:translate="contentrules_description_execution"\n-                    class="lead">\n+        <p class="lead"\n+           i18n:translate="contentrules_description_execution"\n+        >\n                     Rules execute when a triggering event occurs. Rule actions will only\n                     be invoked if all the rule\'s conditions are met. You can add new\n                     actions and conditions using the buttons below.\n-                </p>\n-                <a href=""\n-                    class="link-parent d-block"\n-                    tal:attributes="href string:${portal_url}/@@rules-controlpanel"\n-                    i18n:translate="go_to_contentrules_overview">\n+        </p>\n+        <a class="link-parent d-block"\n+           href=""\n+           tal:attributes="\n+             href string:${portal_url}/@@rules-controlpanel;\n+           "\n+           i18n:translate="go_to_contentrules_overview"\n+        >\n                     Up to rule overview\n-                </a>\n-            </header>\n+        </a>\n+      </header>\n \n-            <div id="content-core" class="pat-contentrules-elements">\n+      <div class="pat-contentrules-elements"\n+           id="content-core"\n+      >\n \n-                <div class="row row-cols-1 row-cols-md-2">\n-                    <fieldset id="configure-conditions" class="col"\n-                        tal:define="conditions view/conditions">\n-                        <legend i18n:translate="if_all_conditions_met" class="float-none">\n+        <div class="row row-cols-1 row-cols-md-2">\n+          <fieldset class="col"\n+                    id="configure-conditions"\n+                    tal:define="\n+                      conditions view/conditions;\n+                    "\n+          >\n+            <legend class="float-none"\n+                    i18n:translate="if_all_conditions_met"\n+            >\n                             If all of the following conditions are met:\n-                        </legend>\n+            </legend>\n \n-                        <div tal:condition="not:conditions"\n-                            class="alert alert-info">\n-                            <strong i18n:translate="">Info</strong>\n-                            <span i18n:translate="">\n+            <div class="alert alert-info"\n+                 tal:condition="not:conditions"\n+            >\n+              <strong i18n:translate="">Info</strong>\n+              <span i18n:translate="">\n                                 There is not any additional condition checked on this rule.\n-                            </span>\n-                        </div>\n+              </span>\n+            </div>\n \n-                        <form class="mb-3"\n-                            tal:attributes="action view/view_url"\n-                            method="post"\n-                            tal:define="auth_token context/@@authenticator/token"\n-                            tal:repeat="condition conditions">\n-                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                            <a tal:attributes="name string:condition++${condition/idx}"></a>\n-                            <input type="hidden"\n-                                name="element_id:int"\n-                                tal:attributes="value condition/idx" />\n+            <form class="mb-3"\n+                  method="post"\n+                  tal:define="\n+                    auth_token context/@@authenticator/token;\n+                  "\n+                  tal:repeat="condition conditions"\n+                  tal:attributes="\n+                    action view/view_url;\n+                  "\n+            >\n+              <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+              <a tal:attributes="\n+                   name string:condition++${condition/idx};\n+                 "></a>\n+              <input name="element_id:int"\n+                     type="hidden"\n+                     tal:attributes="\n+                       value condition/idx;\n+                     "\n+              />\n \n-                            <div class="card">\n-                                <div class="card-body row">\n-                                    <div class="col">\n-                                        <h5 class="card-title"\n-                                        tal:content="condition/title"\n-                                        i18n:translate="">Transition was publish.</h5>\n-                                    </div>\n-                                    <div class="col-auto">\n-                                        <div class="rule-operations">\n-                                            <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n-                                                class="pat-plone-modal btn btn-sm btn-primary"\n-                                                tal:condition="condition/editview"\n-                                                i18n:translate="label_edit">Edit</a>\n-                                            <button type="submit"\n-                                                name="form.button.DeleteCondition"\n-                                                value="Remove"\n-                                                class="context btn btn-sm btn-danger"\n-                                                i18n:attributes="value label_remove;"\n-                                                i18n:translate="label_remove">Remove</button>\n-                                            <button tal:attributes="disabled python:condition[\'first\'] and \'disabled\' or None"\n-                                                type="submit"\n-                                                name="form.button.MoveConditionUp"\n-                                                value="&uarr;"\n-                                                class="context btn btn-sm btn-primary">&uarr;</button>\n-                                            <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n-                                                type="submit"\n-                                                name="form.button.MoveConditionDown"\n-                                                value="&darr;"\n-                                                class="context btn btn-sm btn-primary">&darr;</button>\n-                                        </div>\n-                                    </div>\n-                                    <p class="card-text" tal:content="condition/summary">\n+              <div class="card">\n+                <div class="card-body row">\n+                  <div class="col">\n+                    <h5 class="card-title"\n+                        tal:content="condition/title"\n+                        i18n:translate=""\n+                    >Transition was publish.</h5>\n+                  </div>\n+                  <div class="col-auto">\n+                    <div class="rule-operations">\n+                      <a class="pat-plone-modal btn btn-sm btn-primary"\n+                         tal:condition="condition/editview"\n+                         tal:attributes="\n+                           href string:${condition/editview}?_authenticator=${auth_token};\n+                         "\n+                         i18n:translate="label_edit"\n+                      >Edit</a>\n+                      <button class="context btn btn-sm btn-danger"\n+                              name="form.button.DeleteCondition"\n+                              type="submit"\n+                              value="Remove"\n+                              i18n:attributes="value label_remove;"\n+                              i18n:translate="label_remove"\n+                      >Remove</button>\n+                      <button class="context btn btn-sm btn-primary"\n+                              name="form.button.MoveConditionUp"\n+                              type="submit"\n+                              value="&uarr;"\n+                              tal:attributes="\n+                                disabled python:condition[\'first\'] and \'disabled\' or None;\n+                              "\n+                      >&uarr;</button>\n+                      <button class="context btn btn-sm btn-primary"\n+                              name="form.button.MoveConditionDown"\n+                              type="submit"\n+                              value="&darr;"\n+                              tal:attributes="\n+                                disabled python:condition[\'last\'] and \'disabled\' or None;\n+                              "\n+                      >&darr;</button>\n+                    </div>\n+                  </div>\n+                  <p class="card-text"\n+                     tal:content="condition/summary"\n+                  >\n                                         Something happened\n-                                    </p>\n-                                </div>\n-                            </div>\n-                        </form>\n+                  </p>\n+                </div>\n+              </div>\n+            </form>\n \n-                        <form class="mb-3"\n-                            tal:attributes="action string:${view/base_url}/+condition"\n-                            method="get"\n-                            id="add-condition">\n-                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                            <div class="input-group">\n+            <form class="mb-3"\n+                  id="add-condition"\n+                  method="get"\n+                  tal:attributes="\n+                    action string:${view/base_url}/+condition;\n+                  "\n+            >\n+              <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+              <div class="input-group">\n \n-                                <span class="input-group-text" i18n:translate="contentrules_condition"\n-                                    for="contentrules-add-condition">\n+                <span class="input-group-text"\n+                      for="contentrules-add-condition"\n+                      i18n:translate="contentrules_condition"\n+                >\n                                     Condition:\n-                                </span>\n+                </span>\n \n-                                <select name=":action"\n-                                    size="1"\n-                                    id="contentrules-add-condition"\n-                                    class="form-select"\n-                                    aria-label="Add condition"\n-                                    i18n:attributes="aria-label contentrules_add_condition">\n-                                    <tal:block repeat="condition view/addable_conditions">\n-                                        <option tal:attributes="value condition/addview"\n-                                            i18n:translate=""\n-                                            tal:content="condition/title" />\n-                                    </tal:block>\n-                                </select>\n-                                <button class="context allowMultiSubmit btn btn-success"\n-                                    type="submit"\n-                                    name="form.button.AddCondition"\n-                                    value="Add"\n-                                    i18n:attributes="value label_add;"\n-                                    i18n:translate="label_add">Add</button>\n-                            </div>\n-                            &nbsp; <!-- For Safari -->\n-                        </form>\n-                    </fieldset>\n+                <select class="form-select"\n+                        id="contentrules-add-condition"\n+                        aria-label="Add condition"\n+                        name=":action"\n+                        size="1"\n+                        i18n:attributes="aria-label contentrules_add_condition"\n+                >\n+                  <tal:block repeat="condition view/addable_conditions">\n+                    <option tal:content="condition/title"\n+                            tal:attributes="\n+                              value condition/addview;\n+                            "\n+                            i18n:translate=""\n+                    ></option>\n+                  </tal:block>\n+                </select>\n+                <button class="context allowMultiSubmit btn btn-success"\n+                        name="form.button.AddCondition"\n+                        type="submit"\n+                        value="Add"\n+                        i18n:attributes="value label_add;"\n+                        i18n:translate="label_add"\n+                >Add</button>\n+              </div>\n+                            &nbsp;\n+              <!-- For Safari -->\n+            </form>\n+          </fieldset>\n \n-                    <fieldset id="configure-actions" class="col"\n-                        tal:define="actions view/actions">\n-                        <legend i18n:translate="contentrules_perform_actions" class="float-none">\n+          <fieldset class="col"\n+                    id="configure-actions"\n+                    tal:define="\n+                      actions view/actions;\n+                    "\n+          >\n+            <legend class="float-none"\n+                    i18n:translate="contentrules_perform_actions"\n+            >\n                             Perform the following actions:\n-                        </legend>\n+            </legend>\n \n-                        <div tal:condition="not:actions"\n-                            class="alert alert-warning">\n-                            <strong i18n:translate="">Warning</strong>\n-                            <span i18n:translate="">\n+            <div class="alert alert-warning"\n+                 tal:condition="not:actions"\n+            >\n+              <strong i18n:translate="">Warning</strong>\n+              <span i18n:translate="">\n                                 There is not any action performed by this rule.\n                                 Click on Add button to setup an action.\n-                            </span>\n-                        </div>\n-                        <form class="mb-3"\n-                            tal:attributes="action view/view_url"\n-                            method="post"\n-                            tal:define="auth_token context/@@authenticator/token"\n-                            tal:repeat="action actions">\n-                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                            <a tal:attributes="name string:action++${action/idx}"></a>\n-                            <input type="hidden"\n-                                name="element_id:int"\n-                                tal:attributes="value action/idx" />\n+              </span>\n+            </div>\n+            <form class="mb-3"\n+                  method="post"\n+                  tal:define="\n+                    auth_token context/@@authenticator/token;\n+                  "\n+                  tal:repeat="action actions"\n+                  tal:attributes="\n+                    action view/view_url;\n+                  "\n+            >\n+              <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+              <a tal:attributes="\n+                   name string:action++${action/idx};\n+                 "></a>\n+              <input name="element_id:int"\n+                     type="hidden"\n+                     tal:attributes="\n+                       value action/idx;\n+                     "\n+              />\n \n-                            <div class="card">\n-                                <div class="card-body row">\n-                                    <div class="col">\n-                                        <h5 class="card-title"\n-                                        tal:content="action/title"\n-                                        i18n:translate="">Move to folder</h5>\n-                                    </div>\n-                                    <div class="col-auto">\n-                                        <div class="rule-operations">\n-                                            <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}"\n-                                                class="pat-plone-modal btn btn-sm btn-primary"\n-                                                tal:condition="action/editview"\n-                                                i18n:translate="label_edit">Edit</a>\n-                                            <button type="submit"\n-                                                name="form.button.DeleteAction"\n-                                                value="Remove"\n-                                                class="context btn btn-sm btn-danger"\n-                                                i18n:attributes="value label_remove;"\n-                                                i18n:translate="label_remove">Remove</button>\n-                                            <button tal:attributes="disabled python:action[\'first\'] and \'disabled\' or None"\n-                                                type="submit"\n-                                                name="form.button.MoveActionUp"\n-                                                value="&uarr;"\n-                                                class="context btn btn-sm btn-primary">&uarr;</button>\n-                                            <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n-                                                type="submit"\n-                                                name="form.button.MoveActionDown"\n-                                                value="&darr;"\n-                                                class="context btn btn-sm btn-primary">&darr;</button>\n-                                        </div>\n-                                    </div>\n-                                    <p class="card-text" tal:content="action/summary">\n+              <div class="card">\n+                <div class="card-body row">\n+                  <div class="col">\n+                    <h5 class="card-title"\n+                        tal:content="action/title"\n+                        i18n:translate=""\n+                    >Move to folder</h5>\n+                  </div>\n+                  <div class="col-auto">\n+                    <div class="rule-operations">\n+                      <a class="pat-plone-modal btn btn-sm btn-primary"\n+                         tal:condition="action/editview"\n+                         tal:attributes="\n+                           href string:${action/editview}?_authenticator=${auth_token};\n+                         "\n+                         i18n:translate="label_edit"\n+                      >Edit</a>\n+                      <button class="context btn btn-sm btn-danger"\n+                              name="form.button.DeleteAction"\n+                              type="submit"\n+                              value="Remove"\n+                              i18n:attributes="value label_remove;"\n+                              i18n:translate="label_remove"\n+                      >Remove</button>\n+                      <button class="context btn btn-sm btn-primary"\n+                              name="form.button.MoveActionUp"\n+                              type="submit"\n+                              value="&uarr;"\n+                              tal:attributes="\n+                                disabled python:action[\'first\'] and \'disabled\' or None;\n+                              "\n+                      >&uarr;</button>\n+                      <button class="context btn btn-sm btn-primary"\n+                              name="form.button.MoveActionDown"\n+                              type="submit"\n+                              value="&darr;"\n+                              tal:attributes="\n+                                disabled python:action[\'last\'] and \'disabled\' or None;\n+                              "\n+                      >&darr;</button>\n+                    </div>\n+                  </div>\n+                  <p class="card-text"\n+                     tal:content="action/summary"\n+                  >\n                                         Something happened\n-                                    </p>\n-                                </div>\n-                            </div>\n+                  </p>\n+                </div>\n+              </div>\n \n \n-                        </form>\n+            </form>\n \n-                        <form class="mb-3"\n-                            tal:attributes="action string:${view/base_url}/+action"\n-                            method="get"\n-                            id="add-action">\n-                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                            <div class="input-group">\n+            <form class="mb-3"\n+                  id="add-action"\n+                  method="get"\n+                  tal:attributes="\n+                    action string:${view/base_url}/+action;\n+                  "\n+            >\n+              <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+              <div class="input-group">\n \n-                                <span class="input-group-text"\n-                                    i18n:translate="contentrules_action"\n-                                    for="contentrules-add-action">Action:</span>\n+                <span class="input-group-text"\n+                      for="contentrules-add-action"\n+                      i18n:translate="contentrules_action"\n+                >Action:</span>\n \n-                                <select name=":action"\n-                                    size="1"\n-                                    id="contentrules-add-action"\n-                                    class="form-select"\n-                                    aria-label="Add action"\n-                                    i18n:attributes="aria-label contentrules_add_action">\n-                                    <tal:block repeat="action view/addable_actions">\n-                                        <option tal:attributes="value action/addview"\n-                                            i18n:translate=""\n-                                            tal:content="action/title"></option>\n-                                    </tal:block>\n-                                </select>\n-                                <button class="context allowMultiSubmit btn btn-success"\n-                                    type="submit"\n-                                    name="form.button.AddAction"\n-                                    value="Add"\n-                                    i18n:attributes="value label_add;"\n-                                    i18n:translate="label_add">Add</button>\n-                            </div>\n-                            &nbsp; <!-- For Safari -->\n-                        </form>\n-                    </fieldset>\n-                </div>\n+                <select class="form-select"\n+                        id="contentrules-add-action"\n+                        aria-label="Add action"\n+                        name=":action"\n+                        size="1"\n+                        i18n:attributes="aria-label contentrules_add_action"\n+                >\n+                  <tal:block repeat="action view/addable_actions">\n+                    <option tal:content="action/title"\n+                            tal:attributes="\n+                              value action/addview;\n+                            "\n+                            i18n:translate=""\n+                    ></option>\n+                  </tal:block>\n+                </select>\n+                <button class="context allowMultiSubmit btn btn-success"\n+                        name="form.button.AddAction"\n+                        type="submit"\n+                        value="Add"\n+                        i18n:attributes="value label_add;"\n+                        i18n:translate="label_add"\n+                >Add</button>\n+              </div>\n+                            &nbsp;\n+              <!-- For Safari -->\n+            </form>\n+          </fieldset>\n+        </div>\n \n \n \n-                <tal:assignments define="assignments view/assignments">\n+        <tal:assignments define="\n+                           assignments view/assignments;\n+                         ">\n \n-                    <fieldset id="manage-assignments" class="col">\n-                        <legend i18n:translate="label_contentrules_rule_assignments" class="float-none">Assignments</legend>\n+          <fieldset class="col"\n+                    id="manage-assignments"\n+          >\n+            <legend class="float-none"\n+                    i18n:translate="label_contentrules_rule_assignments"\n+            >Assignments</legend>\n \n \n-                        <tal:noassignments condition="not:assignments">\n-                            <div class="alert alert-info">\n-                                <strong i18n:translate="">This rule is not assigned to any location</strong>\n-                                <tal:enabled condition="view/rule_enabled">\n-                                    <div i18n:translate="">\n+            <tal:noassignments condition="not:assignments">\n+              <div class="alert alert-info">\n+                <strong i18n:translate="">This rule is not assigned to any location</strong>\n+                <tal:enabled condition="view/rule_enabled">\n+                  <div i18n:translate="">\n                                         The rule is enabled but will perform nothing since it is not assigned anywhere.\n-                                    </div>\n-                                </tal:enabled>\n-                            </div>\n+                  </div>\n+                </tal:enabled>\n+              </div>\n \n-                                <tal:enabled condition="view/rule_enabled">\n-                                    <p i18n:translate="">\n+              <tal:enabled condition="view/rule_enabled">\n+                <p i18n:translate="">\n                                         Go to the folder where you want the rule to apply, or at the site root,\n                                         click on \'rule\' tab, and then locally setup the rules.\n-                                    </p>\n+                </p>\n \n-                                    <form class="mb-3"\n-                                        tal:attributes="action view/view_url"\n-                                        method="post">\n-                                        <span tal:replace="structure context/@@authenticator/authenticator" />\n-                                        <input type="submit"\n-                                            class="btn btn-primary"\n-                                            value="Apply rule on the whole site"\n-                                            name="form.button.ApplyOnWholeSite"\n-                                            i18n:attributes="value" />\n-                                    </form>\n-                                </tal:enabled>\n-                        </tal:noassignments>\n-                        <tal:assignments condition="nocall:assignments">\n-                            <div class="card">\n-                                <div class="card-header">\n-                                    <span i18n:translate="description_contentrules_rule_assignments">\n+                <form class="mb-3"\n+                      method="post"\n+                      tal:attributes="\n+                        action view/view_url;\n+                      "\n+                >\n+                  <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                  <input class="btn btn-primary"\n+                         name="form.button.ApplyOnWholeSite"\n+                         type="submit"\n+                         value="Apply rule on the whole site"\n+                         i18n:attributes="value"\n+                  />\n+                </form>\n+              </tal:enabled>\n+            </tal:noassignments>\n+            <tal:assignments condition="nocall:assignments">\n+              <div class="card">\n+                <div class="card-header">\n+                  <span i18n:translate="description_contentrules_rule_assignments">\n                                         This rule is assigned to the following locations:\n-                                    </span>\n-                                </div>\n-                                <ul class="list-group list-group-flush">\n-                                <tal:items repeat="assignment assignments">\n-                                    <li class="list-group-item">\n-                                        <a tal:attributes="href string:${assignment/url}/@@manage-content-rules">\n-                                            <tal:icon tal:replace="structure python:icons.tag(assignment[\'icon\'])" /><span class="ms-2" tal:content="assignment/title">title</span>\n-                                        </a>&nbsp;\n-                                    </li>\n-                                </tal:items>\n-                                </ul>\n-                            </div>\n-                        </tal:assignments>\n-                    </fieldset>\n+                  </span>\n+                </div>\n+                <ul class="list-group list-group-flush">\n+                  <tal:items repeat="assignment assignments">\n+                    <li class="list-group-item">\n+                      <a tal:attributes="\n+                           href string:${assignment/url}/@@manage-content-rules;\n+                         ">\n+                        <tal:icon tal:replace="structure python:icons.tag(assignment[\'icon\'])" /><span class="ms-2"\n+                              tal:content="assignment/title"\n+                        >title</span>\n+                      </a>&nbsp;\n+                    </li>\n+                  </tal:items>\n+                </ul>\n+              </div>\n+            </tal:assignments>\n+          </fieldset>\n \n-                </tal:assignments>\n+        </tal:assignments>\n \n-            </div>\n-        </metal:main>\n-    </body>\n+      </div>\n+    </metal:main>\n+  </body>\n </html>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2023-03-25T22:26:58+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/bb2c124adaec4c0b315d69bc50532220abf35a89

feat: flake8

Files changed:
M plone/app/contentrules/exportimport/rules.py
M plone/app/contentrules/tests/test_action_delete.py
M plone/app/contentrules/tests/test_action_logger.py
M plone/app/contentrules/tests/test_action_mail.py
M plone/app/contentrules/tests/test_rule_assignment_mapping.py

b'diff --git a/plone/app/contentrules/exportimport/rules.py b/plone/app/contentrules/exportimport/rules.py\nindex 4633736..2ebe9b4 100644\n--- a/plone/app/contentrules/exportimport/rules.py\n+++ b/plone/app/contentrules/exportimport/rules.py\n@@ -28,9 +28,7 @@\n from zope.container.interfaces import INameChooser\n from zope.interface import implementer\n from zope.interface import Interface\n-from zope.schema.interfaces import ICollection\n from zope.schema.interfaces import IField\n-from zope.schema.interfaces import IFromUnicode\n \n \n def as_bool(string, default=False):\ndiff --git a/plone/app/contentrules/tests/test_action_delete.py b/plone/app/contentrules/tests/test_action_delete.py\nindex b4275ad..d1b5d5c 100644\n--- a/plone/app/contentrules/tests/test_action_delete.py\n+++ b/plone/app/contentrules/tests/test_action_delete.py\n@@ -1,10 +1,6 @@\n from plone.app.contentrules.actions.delete import DeleteAction\n from plone.app.contentrules.rule import Rule\n from plone.app.contentrules.tests.base import ContentRulesTestCase\n-from plone.app.testing import login\n-from plone.app.testing import setRoles\n-from plone.app.testing import TEST_USER_ID\n-from plone.app.testing import TEST_USER_NAME\n from plone.contentrules.engine.interfaces import IRuleStorage\n from plone.contentrules.rule.interfaces import IExecutable\n from plone.contentrules.rule.interfaces import IRuleAction\ndiff --git a/plone/app/contentrules/tests/test_action_logger.py b/plone/app/contentrules/tests/test_action_logger.py\nindex 7de104d..80fa32a 100644\n--- a/plone/app/contentrules/tests/test_action_logger.py\n+++ b/plone/app/contentrules/tests/test_action_logger.py\n@@ -2,7 +2,6 @@\n from plone.app.contentrules.actions.logger import LoggerEditFormView\n from plone.app.contentrules.rule import Rule\n from plone.app.contentrules.tests.base import ContentRulesTestCase\n-from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n from plone.contentrules.engine.interfaces import IRuleStorage\n from plone.contentrules.rule.interfaces import IExecutable\ndiff --git a/plone/app/contentrules/tests/test_action_mail.py b/plone/app/contentrules/tests/test_action_mail.py\nindex f42ec2f..0d737cc 100644\n--- a/plone/app/contentrules/tests/test_action_mail.py\n+++ b/plone/app/contentrules/tests/test_action_mail.py\n@@ -1,4 +1,3 @@\n-from Acquisition import aq_base\n from email import message_from_bytes\n from plone.app.contentrules.actions.mail import MailAction\n from plone.app.contentrules.actions.mail import MailAddFormView\n@@ -12,9 +11,7 @@\n from plone.contentrules.rule.interfaces import IExecutable\n from plone.contentrules.rule.interfaces import IRuleAction\n from plone.registry.interfaces import IRegistry\n-from Products.MailHost.interfaces import IMailHost\n from zope.component import getMultiAdapter\n-from zope.component import getSiteManager\n from zope.component import getUtility\n from zope.interface import implementer\n from zope.interface.interfaces import IObjectEvent\ndiff --git a/plone/app/contentrules/tests/test_rule_assignment_mapping.py b/plone/app/contentrules/tests/test_rule_assignment_mapping.py\nindex b248d70..b5fa04e 100644\n--- a/plone/app/contentrules/tests/test_rule_assignment_mapping.py\n+++ b/plone/app/contentrules/tests/test_rule_assignment_mapping.py\n@@ -5,7 +5,6 @@\n from plone.app.contentrules.testing import (  # noqa: E501\n     PLONE_APP_CONTENTRULES_FUNCTIONAL_TESTING,\n )\n-from plone.app.contentrules.tests.base import ContentRulesTestCase\n from plone.app.testing import login\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2023-03-25T22:27:18+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/482830ae700bf8b5d76ca534955d57a28ded03b4

chore: drop old file

Files changed:
D buildout.cfg

b'diff --git a/buildout.cfg b/buildout.cfg\ndeleted file mode 100644\nindex 704737b..0000000\n--- a/buildout.cfg\n+++ /dev/null\n@@ -1,23 +0,0 @@\n-[buildout]\n-extensions = mr.developer\n-auto-checkout = *\n-extends = https://raw.githubusercontent.com/collective/buildout.plonetest/master/test-5.x.cfg\n-          https://raw.githubusercontent.com/plone/buildout.coredev/5.2/versions.cfg\n-package-name = plone.app.contentrules\n-package-extras = [test]\n-\n-[remotes]\n-plone = https://github.com/plone\n-plone_push = git@github.com:plone\n-zope = https://github.com/zopefoundation\n-zope_push = git@github.com:zopefoundation\n-\n-[sources]\n-Products.CMFCore = git ${remotes:zope}/Products.CMFCore.git pushurl=${remotes:zope_push}/Products.CMFCore.git branch=master\n-Products.CMFFormController = git ${remotes:plone}/Products.CMFFormController.git pushurl=${remotes:plone_push}/Products.CMFFormController.git branch=master\n-Products.CMFPlone = git ${remotes:plone}/Products.CMFPlone.git pushurl=${remotes:plone_push}/Products.CMFPlone.git branch=master\n-Products.GenericSetup = git ${remotes:zope}/Products.GenericSetup.git pushurl=${remotes:zope_push}/Products.GenericSetup.git branch=master\n-Products.PlonePAS = git ${remotes:plone}/Products.PlonePAS.git pushurl=${remotes:plone_push}/Products.PlonePAS.git branch=master\n-\n-[versions]\n-plone.app.contentrules =\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2023-03-25T22:30:07+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/7dc12fb989875bc059014c377f7f7f3808fae8a7

feat: codespell

Files changed:
M CHANGES.rst
M plone/app/contentrules/browser/formhelper.py
M plone/app/contentrules/browser/interfaces.py
M plone/app/contentrules/exportimport/rules.py
M plone/app/contentrules/rule.py
M plone/app/contentrules/tests/test_configuration.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 2af1e2a..dbbb483 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -176,7 +176,7 @@ Bug fixes:\n - Migrate all tests to use dexterity\n   [pbauer]\n \n-- Work around issue where new item is moved before it\'s completely addeed\n+- Work around issue where new item is moved before it\'s completely added\n   [davisagli]\n \n - Fix all tests with py3 and py2\n@@ -394,7 +394,7 @@ Fixes:\n   [thomasdesvenain]\n \n - Fixed reordering of actions / conditions.\n-  This occured when \'jq\' was not defined as \'jQuery\'.\n+  This occurred when \'jq\' was not defined as \'jQuery\'.\n   [thomasdesvenain]\n \n - User that manage a rule can now allow actions executed by this rule\n@@ -537,7 +537,7 @@ Fixes:\n   [thomasdesvenain]\n \n - ContainerModified event is excluded from \'modified\' event handling.\n-  This avoids for example adding a comment to lauch \'modified\' rules registered for it.\n+  This avoids for example adding a comment to launch \'modified\' rules registered for it.\n   [thomasdesvenain]\n \n \ndiff --git a/plone/app/contentrules/browser/formhelper.py b/plone/app/contentrules/browser/formhelper.py\nindex 8a11d81..9d00238 100644\n--- a/plone/app/contentrules/browser/formhelper.py\n+++ b/plone/app/contentrules/browser/formhelper.py\n@@ -24,7 +24,7 @@ class AddForm(AutoExtensibleForm, form.AddForm):\n \n     Sub-classes should define create() and set the form_fields class variable.\n \n-    Notice the suble difference between AddForm and NullAddform in that the\n+    Notice the subtle difference between AddForm and NullAddform in that the\n     create template method for AddForm takes as a parameter a dict \'data\':\n \n         def create(self, data):\ndiff --git a/plone/app/contentrules/browser/interfaces.py b/plone/app/contentrules/browser/interfaces.py\nindex a59d47d..5b90a2f 100644\n--- a/plone/app/contentrules/browser/interfaces.py\n+++ b/plone/app/contentrules/browser/interfaces.py\n@@ -13,7 +13,7 @@ class IContentRulesControlPanel(Interface):\n     """Marker interface for rules control panel view"""\n \n     def globally_disabled():\n-        """Wether content rules are globally disabled or not"""\n+        """Whether content rules are globally disabled or not"""\n \n \n class IRuleAdding(IAdding):\ndiff --git a/plone/app/contentrules/exportimport/rules.py b/plone/app/contentrules/exportimport/rules.py\nindex 2ebe9b4..d62a22c 100644\n--- a/plone/app/contentrules/exportimport/rules.py\n+++ b/plone/app/contentrules/exportimport/rules.py\n@@ -301,7 +301,7 @@ def _extractRules(self):\n             fragment.appendChild(rule_node)\n             assignment_paths.update(get_assignments(rule))\n         # Export assignments last - this is necessary to ensure they\n-        # are orderd properly\n+        # are ordered properly\n \n         site_path_length = len("/".join(site.getPhysicalPath()))\n         for path in sorted(assignment_paths):\ndiff --git a/plone/app/contentrules/rule.py b/plone/app/contentrules/rule.py\nindex 05fecbc..1b1a3c5 100644\n--- a/plone/app/contentrules/rule.py\n+++ b/plone/app/contentrules/rule.py\n@@ -14,7 +14,7 @@\n \n \n class Rule(SimpleItem, BaseRule):\n-    """A Zope 2 version of a rule, subject to acqusition, but otherwise\n+    """A Zope 2 version of a rule, subject to acquisition, but otherwise\n     identical.\n     """\n \ndiff --git a/plone/app/contentrules/tests/test_configuration.py b/plone/app/contentrules/tests/test_configuration.py\nindex 4c29cf4..c695be1 100644\n--- a/plone/app/contentrules/tests/test_configuration.py\n+++ b/plone/app/contentrules/tests/test_configuration.py\n@@ -92,7 +92,7 @@ def testImportTwice(self):\n         # Ensure rules, actions/conditions and assignments are not duplicated\n         # if the profile is re-imported; see bug #8027.\n         portal_setup = self.portal.portal_setup\n-        time.sleep(1)  # avoid timestamp colission\n+        time.sleep(1)  # avoid timestamp collision\n         portal_setup.runAllImportStepsFromProfile(\n             "profile-plone.app.contentrules:testing"\n         )\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2023-03-25T22:38:38+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/24d1ee2ec38d264167a41e51587b398de21aadb3

feat: drop last Archetypes references

Files changed:
M plone/app/contentrules/configure.zcml

b'diff --git a/plone/app/contentrules/configure.zcml b/plone/app/contentrules/configure.zcml\nindex ba2ca30..934e82f 100644\n--- a/plone/app/contentrules/configure.zcml\n+++ b/plone/app/contentrules/configure.zcml\n@@ -100,11 +100,6 @@\n       for="zope.lifecycleevent.interfaces.IObjectAddedEvent"\n       handler=".handlers.added"\n       />\n-  <subscriber\n-      for="Products.Archetypes.interfaces.IObjectInitializedEvent"\n-      handler=".handlers.archetypes_initialized"\n-      zcml:condition="installed Products.Archetypes"\n-      />\n   <subscriber\n       for="zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n       handler=".handlers.removed"\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2023-03-25T23:07:47+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/07f0490709d10395749c67df8b88aacac5edc01e

feat: declare dependencies

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex 08fbc9e..0972dd3 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -34,34 +34,39 @@\n     include_package_data=True,\n     zip_safe=False,\n     python_requires=">=3.8",\n-    extras_require={"test": ["plone.app.testing", "plone.app.contenttypes[test]"]},\n+    extras_require={\n+        "test": [\n+            "plone.app.testing",\n+            "plone.app.contenttypes[test]",\n+            "plone.dexterity",\n+            "plone.testing",\n+        ]\n+    },\n     install_requires=[\n+        "BTrees",\n+        "Products.MailHost",\n+        "Products.PluggableAuthService",\n+        "lxml",\n+        "plone.app.contenttypes",\n+        "plone.app.discussion",\n+        "plone.app.uuid",\n+        "plone.registry",\n+        "plone.supermodel",\n+        "plone.z3cform",\n+        "z3c.form",\n         "setuptools",\n+        "plone.base",\n         "plone.contentrules",\n         "plone.memoize",\n         "plone.stringinterp",\n         "plone.uuid",\n         "plone.autoform",\n-        "plone.app.z3cform",\n         "plone.app.vocabularies",\n-        "transaction",\n         "zope.annotation",\n         "zope.browser",\n-        "zope.component",\n-        "zope.container",\n-        "zope.event",\n-        "zope.i18nmessageid",\n-        "zope.interface",\n-        "zope.lifecycleevent",\n-        "zope.publisher >= 3.11.0",\n-        "zope.schema",\n-        "zope.site",\n-        "zope.traversing",\n-        "Acquisition",\n-        "Products.CMFCore",\n+        "Products.CMFPlone",\n         "Products.GenericSetup >= 2.0",\n         "Products.statusmessages",\n-        "ZODB",\n         "Zope",\n     ],\n )\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2023-03-26T10:58:33+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/d69ceb41afad48d793b82754ee0542cc59960ac2

Merge pull request #76 from plone/config-with-default-template-32fcf34d

Config with default template

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/47959565.internal
A tox.ini
M CHANGES.rst
M plone/app/contentrules/actions/configure.zcml
M plone/app/contentrules/actions/templates/mail.pt
M plone/app/contentrules/browser/adding.py
M plone/app/contentrules/browser/assignments.py
M plone/app/contentrules/browser/configure.zcml
M plone/app/contentrules/browser/formhelper.py
M plone/app/contentrules/browser/interfaces.py
M plone/app/contentrules/browser/templates/contentrules-pageform.pt
M plone/app/contentrules/browser/templates/controlpanel.pt
M plone/app/contentrules/browser/templates/manage-assignments.pt
M plone/app/contentrules/browser/templates/manage-elements.pt
M plone/app/contentrules/conditions/configure.zcml
M plone/app/contentrules/configure.zcml
M plone/app/contentrules/exportimport/configure.zcml
M plone/app/contentrules/exportimport/rules.py
M plone/app/contentrules/handlers.py
M plone/app/contentrules/rule.py
M plone/app/contentrules/testing.py
M plone/app/contentrules/tests/profiles/testing/contentrules.xml
M plone/app/contentrules/tests/profiles/testing/export_steps.xml
M plone/app/contentrules/tests/profiles/testing/import_steps.xml
M plone/app/contentrules/tests/test_action_delete.py
M plone/app/contentrules/tests/test_action_logger.py
M plone/app/contentrules/tests/test_action_mail.py
M plone/app/contentrules/tests/test_cascading_rule.py
M plone/app/contentrules/tests/test_configuration.py
M plone/app/contentrules/tests/test_rule_assignment_mapping.py
M plone/app/contentrules/tests/test_rule_management_views.py
M plone/app/contentrules/tests/testing.zcml
M pyproject.toml
M setup.cfg
M setup.py
D buildout.cfg

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 0000000..b4158b8\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 0000000..07dde25\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "47959565"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 0000000..582f8ac\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.2\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/CHANGES.rst b/CHANGES.rst\nindex 2af1e2a..dbbb483 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -176,7 +176,7 @@ Bug fixes:\n - Migrate all tests to use dexterity\n   [pbauer]\n \n-- Work around issue where new item is moved before it\'s completely addeed\n+- Work around issue where new item is moved before it\'s completely added\n   [davisagli]\n \n - Fix all tests with py3 and py2\n@@ -394,7 +394,7 @@ Fixes:\n   [thomasdesvenain]\n \n - Fixed reordering of actions / conditions.\n-  This occured when \'jq\' was not defined as \'jQuery\'.\n+  This occurred when \'jq\' was not defined as \'jQuery\'.\n   [thomasdesvenain]\n \n - User that manage a rule can now allow actions executed by this rule\n@@ -537,7 +537,7 @@ Fixes:\n   [thomasdesvenain]\n \n - ContainerModified event is excluded from \'modified\' event handling.\n-  This avoids for example adding a comment to lauch \'modified\' rules registered for it.\n+  This avoids for example adding a comment to launch \'modified\' rules registered for it.\n   [thomasdesvenain]\n \n \ndiff --git a/buildout.cfg b/buildout.cfg\ndeleted file mode 100644\nindex 704737b..0000000\n--- a/buildout.cfg\n+++ /dev/null\n@@ -1,23 +0,0 @@\n-[buildout]\n-extensions = mr.developer\n-auto-checkout = *\n-extends = https://raw.githubusercontent.com/collective/buildout.plonetest/master/test-5.x.cfg\n-          https://raw.githubusercontent.com/plone/buildout.coredev/5.2/versions.cfg\n-package-name = plone.app.contentrules\n-package-extras = [test]\n-\n-[remotes]\n-plone = https://github.com/plone\n-plone_push = git@github.com:plone\n-zope = https://github.com/zopefoundation\n-zope_push = git@github.com:zopefoundation\n-\n-[sources]\n-Products.CMFCore = git ${remotes:zope}/Products.CMFCore.git pushurl=${remotes:zope_push}/Products.CMFCore.git branch=master\n-Products.CMFFormController = git ${remotes:plone}/Products.CMFFormController.git pushurl=${remotes:plone_push}/Products.CMFFormController.git branch=master\n-Products.CMFPlone = git ${remotes:plone}/Products.CMFPlone.git pushurl=${remotes:plone_push}/Products.CMFPlone.git branch=master\n-Products.GenericSetup = git ${remotes:zope}/Products.GenericSetup.git pushurl=${remotes:zope_push}/Products.GenericSetup.git branch=master\n-Products.PlonePAS = git ${remotes:plone}/Products.PlonePAS.git pushurl=${remotes:plone_push}/Products.PlonePAS.git branch=master\n-\n-[versions]\n-plone.app.contentrules =\ndiff --git a/news/47959565.internal b/news/47959565.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/47959565.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/plone/app/contentrules/actions/configure.zcml b/plone/app/contentrules/actions/configure.zcml\nindex db5c2a0..5b7a965 100644\n--- a/plone/app/contentrules/actions/configure.zcml\n+++ b/plone/app/contentrules/actions/configure.zcml\n@@ -2,238 +2,239 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <!-- Logger action -->\n+  <!-- Logger action -->\n \n-    <adapter factory=".logger.LoggerActionExecutor" />\n+  <adapter factory=".logger.LoggerActionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+  <browser:page\n       name="plone.actions.Logger"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n       class=".logger.LoggerAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.actions.logger.ILoggerAction"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.actions.logger.ILoggerAction"\n       class=".logger.LoggerEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleAction\n-        name="plone.actions.Logger"\n-        title="Logger"\n-        description="Log a particular event"\n-        for="*"\n-        event="*"\n-        addview="plone.actions.Logger"\n-        editview="edit"\n-        schema=".logger.ILoggerAction"\n-        factory=".logger.LoggerAction"\n-        />\n-\n-    <!-- Notify action -->\n-\n-    <adapter factory=".notify.NotifyActionExecutor" />\n-\n-    <browser:page\n-        for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-        name="plone.actions.Notify"\n-        class=".notify.NotifyAddFormView"\n-        permission="plone.app.contentrules.ManageContentRules"\n-      />\n-\n-    <browser:page\n-        for="plone.app.contentrules.actions.notify.INotifyAction"\n-        name="edit"\n-        class=".notify.NotifyEditFormView"\n-        permission="plone.app.contentrules.ManageContentRules"\n-      />\n-\n-    <plone:ruleAction\n-        name="plone.actions.Notify"\n-        title="Notify user"\n-        description="Return a portal message to the user"\n-        for="*"\n-        event="*"\n-        addview="plone.actions.Notify"\n-        editview="edit"\n-        schema=".notify.INotifyAction"\n-        factory=".notify.NotifyAction"\n-        />\n-\n-    <!-- Copy to folder action -->\n-\n-     <adapter factory=".copy.CopyActionExecutor" />\n-\n-     <browser:page\n-       for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-       name="plone.actions.Copy"\n-       class=".copy.CopyAddFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <browser:page\n-       for="plone.app.contentrules.actions.copy.ICopyAction"\n-       name="edit"\n-       class=".copy.CopyEditFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <plone:ruleAction\n-         name="plone.actions.Copy"\n-         title="Copy to folder"\n-         description="Copy the triggering item to a specific folder"\n-         for="*"\n-         event="zope.interface.interfaces.IObjectEvent"\n-         addview="plone.actions.Copy"\n-         editview="edit"\n-         schema=".copy.ICopyAction"\n-         factory=".copy.CopyAction"\n-         />\n-\n-    <!-- Move to folder action -->\n-\n-     <adapter factory=".move.MoveActionExecutor" />\n-\n-     <browser:page\n-       for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-       name="plone.actions.Move"\n-       class=".move.MoveAddFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <browser:page\n-       for="plone.app.contentrules.actions.move.IMoveAction"\n-       name="edit"\n-       class=".move.MoveEditFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <plone:ruleAction\n-         name="plone.actions.Move"\n-         title="Move to folder"\n-         description="Move the triggering item to a specific folder"\n-         for="*"\n-         event="zope.interface.interfaces.IObjectEvent"\n-         addview="plone.actions.Move"\n-         editview="edit"\n-         schema=".move.IMoveAction"\n-         factory=".move.MoveAction"\n-         />\n-\n-    <!-- Delete action (no configurable options) -->\n-\n-     <adapter factory=".delete.DeleteActionExecutor" />\n-\n-     <browser:page\n-       for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-       name="plone.actions.Delete"\n-       class=".delete.DeleteAddForm"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <plone:ruleAction\n-         name="plone.actions.Delete"\n-         title="Delete object"\n-         description="Delete the triggering item"\n-         for="*"\n-         event="zope.interface.interfaces.IObjectEvent"\n-         addview="plone.actions.Delete"\n-         schema=".delete.IDeleteAction"\n-         factory=".delete.DeleteAction"\n-         />\n-\n-    <!-- Transition workflow action -->\n-\n-     <adapter factory=".workflow.WorkflowActionExecutor" />\n-\n-     <browser:page\n-       for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-       name="plone.actions.Workflow"\n-       class=".workflow.WorkflowAddFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <browser:page\n-       for="plone.app.contentrules.actions.workflow.IWorkflowAction"\n-       name="edit"\n-       class=".workflow.WorkflowEditFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <plone:ruleAction\n-         name="plone.actions.Workflow"\n-         title="Transition workflow state"\n-         description="Perform a workflow transition on the triggering object"\n-         for="*"\n-         event="zope.interface.interfaces.IObjectEvent"\n-         addview="plone.actions.Workflow"\n-         editview="edit"\n-         schema=".workflow.IWorkflowAction"\n-         factory=".workflow.WorkflowAction"\n-         />\n-\n-    <!-- Email action definition -->\n-\n-     <adapter factory=".mail.MailActionExecutor" />\n-\n-     <browser:page\n-       for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-       name="plone.actions.Mail"\n-       class=".mail.MailAddFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <browser:page\n-       for="plone.app.contentrules.actions.mail.IMailAction"\n-       name="edit"\n-       class=".mail.MailEditFormView"\n-       permission="plone.app.contentrules.ManageContentRules"\n-       />\n-\n-     <plone:ruleAction\n-         name="plone.actions.Mail"\n-         title="Send email"\n-         description="Send an email on the triggering object"\n-         for="*"\n-         event="*"\n-         addview="plone.actions.Mail"\n-         editview="edit"\n-         schema=".mail.IMailAction"\n-         factory=".mail.MailAction"\n-         />\n-\n-    <!-- Versioning action -->\n-\n-    <adapter factory=".versioning.VersioningActionExecutor" />\n-\n-    <browser:page\n-        for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n-        name="plone.actions.Versioning"\n-        class=".versioning.VersioningAddFormView"\n-        permission="plone.app.contentrules.ManageContentRules"\n-      />\n-\n-    <browser:page\n-        for="plone.app.contentrules.actions.versioning.IVersioningAction"\n-        name="edit"\n-        class=".versioning.VersioningEditFormView"\n-        permission="plone.app.contentrules.ManageContentRules"\n-      />\n-\n-    <plone:ruleAction\n-        name="plone.actions.Versioning"\n-        title="Version object"\n-        description="Store a new version of the object"\n-        for="*"\n-        event="*"\n-        addview="plone.actions.Versioning"\n-        editview="edit"\n-        schema=".versioning.IVersioningAction"\n-        factory=".versioning.VersioningAction"\n-        />\n+  <plone:ruleAction\n+      name="plone.actions.Logger"\n+      title="Logger"\n+      description="Log a particular event"\n+      for="*"\n+      event="*"\n+      schema=".logger.ILoggerAction"\n+      factory=".logger.LoggerAction"\n+      addview="plone.actions.Logger"\n+      editview="edit"\n+      />\n+\n+  <!-- Notify action -->\n+\n+  <adapter factory=".notify.NotifyActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Notify"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".notify.NotifyAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.notify.INotifyAction"\n+      class=".notify.NotifyEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Notify"\n+      title="Notify user"\n+      description="Return a portal message to the user"\n+      for="*"\n+      event="*"\n+      schema=".notify.INotifyAction"\n+      factory=".notify.NotifyAction"\n+      addview="plone.actions.Notify"\n+      editview="edit"\n+      />\n+\n+  <!-- Copy to folder action -->\n+\n+  <adapter factory=".copy.CopyActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Copy"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".copy.CopyAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.copy.ICopyAction"\n+      class=".copy.CopyEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Copy"\n+      title="Copy to folder"\n+      description="Copy the triggering item to a specific folder"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".copy.ICopyAction"\n+      factory=".copy.CopyAction"\n+      addview="plone.actions.Copy"\n+      editview="edit"\n+      />\n+\n+  <!-- Move to folder action -->\n+\n+  <adapter factory=".move.MoveActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Move"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".move.MoveAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.move.IMoveAction"\n+      class=".move.MoveEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Move"\n+      title="Move to folder"\n+      description="Move the triggering item to a specific folder"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".move.IMoveAction"\n+      factory=".move.MoveAction"\n+      addview="plone.actions.Move"\n+      editview="edit"\n+      />\n+\n+  <!-- Delete action (no configurable options) -->\n+\n+  <adapter factory=".delete.DeleteActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Delete"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".delete.DeleteAddForm"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Delete"\n+      title="Delete object"\n+      description="Delete the triggering item"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".delete.IDeleteAction"\n+      factory=".delete.DeleteAction"\n+      addview="plone.actions.Delete"\n+      />\n+\n+  <!-- Transition workflow action -->\n+\n+  <adapter factory=".workflow.WorkflowActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Workflow"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".workflow.WorkflowAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.workflow.IWorkflowAction"\n+      class=".workflow.WorkflowEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Workflow"\n+      title="Transition workflow state"\n+      description="Perform a workflow transition on the triggering object"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".workflow.IWorkflowAction"\n+      factory=".workflow.WorkflowAction"\n+      addview="plone.actions.Workflow"\n+      editview="edit"\n+      />\n+\n+  <!-- Email action definition -->\n+\n+  <adapter factory=".mail.MailActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Mail"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".mail.MailAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.mail.IMailAction"\n+      class=".mail.MailEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Mail"\n+      title="Send email"\n+      description="Send an email on the triggering object"\n+      for="*"\n+      event="*"\n+      schema=".mail.IMailAction"\n+      factory=".mail.MailAction"\n+      addview="plone.actions.Mail"\n+      editview="edit"\n+      />\n+\n+  <!-- Versioning action -->\n+\n+  <adapter factory=".versioning.VersioningActionExecutor" />\n+\n+  <browser:page\n+      name="plone.actions.Versioning"\n+      for="plone.app.contentrules.browser.interfaces.IRuleActionAdding"\n+      class=".versioning.VersioningAddFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <browser:page\n+      name="edit"\n+      for="plone.app.contentrules.actions.versioning.IVersioningAction"\n+      class=".versioning.VersioningEditFormView"\n+      permission="plone.app.contentrules.ManageContentRules"\n+      />\n+\n+  <plone:ruleAction\n+      name="plone.actions.Versioning"\n+      title="Version object"\n+      description="Store a new version of the object"\n+      for="*"\n+      event="*"\n+      schema=".versioning.IVersioningAction"\n+      factory=".versioning.VersioningAction"\n+      addview="plone.actions.Versioning"\n+      editview="edit"\n+      />\n \n </configure>\ndiff --git a/plone/app/contentrules/actions/templates/mail.pt b/plone/app/contentrules/actions/templates/mail.pt\nindex 4b1f48f..b30ccb1 100644\n--- a/plone/app/contentrules/actions/templates/mail.pt\n+++ b/plone/app/contentrules/actions/templates/mail.pt\n@@ -1,29 +1,32 @@\n <metal:block use-macro="context/@@ploneform-macros/titlelessform" />\n <tal:i18n i18n:domain="plone">\n-<h1 i18n:translate="title_contentrules_mailsub">Substitutions</h1>\n+  <h1 i18n:translate="title_contentrules_mailsub">Substitutions</h1>\n \n-<p i18n:translate="description-contentrules-mailsub">\n+  <p i18n:translate="description-contentrules-mailsub">\n     Some content in the subject, email source, email recipient and message\n     may be replaced with "$&#123;&#125;" variables from the table below.\n-</p>\n+  </p>\n \n-<table class="listing">\n-<thead>\n-    <tr>\n+  <table class="listing">\n+    <thead>\n+      <tr>\n         <th i18n:translate="category-contentrules-mailsub">Category</th>\n         <th i18n:translate="variable-contentrules-mailsub">Variable</th>\n         <th i18n:translate="substitution-contentrules-mailsub">Substitution</th>\n-    </tr>\n-</thead>\n-<tbody>\n-<tal:block tal:define="sublist here/@@stringinterp_info/substitutionList"\n-     tal:repeat="category sublist">\n-     <tr tal:repeat="item python:category[\'items\']">\n-         <td tal:content="category/category">All Content</td>\n-         <td>${<span tal:replace="item/id">url</span>}</td>\n-         <td tal:content="item/description">URL</td>\n-     </tr>\n-</tal:block>\n-</tbody>\n-</table>\n+      </tr>\n+    </thead>\n+    <tbody>\n+      <tal:block tal:define="\n+                   sublist here/@@stringinterp_info/substitutionList;\n+                 "\n+                 tal:repeat="category sublist"\n+      >\n+        <tr tal:repeat="item python:category[\'items\']">\n+          <td tal:content="category/category">All Content</td>\n+          <td>${<span tal:replace="item/id">url</span>}</td>\n+          <td tal:content="item/description">URL</td>\n+        </tr>\n+      </tal:block>\n+    </tbody>\n+  </table>\n </tal:i18n>\ndiff --git a/plone/app/contentrules/browser/adding.py b/plone/app/contentrules/browser/adding.py\nindex febf16c..3d39be0 100644\n--- a/plone/app/contentrules/browser/adding.py\n+++ b/plone/app/contentrules/browser/adding.py\n@@ -18,7 +18,6 @@\n \n @implementer(IRuleAdding)\n class RuleAdding(SimpleItem, BrowserView):\n-\n     context = None\n     request = None\n     contentName = None\n@@ -73,7 +72,6 @@ def nextURL(self):\n \n \n class RuleElementAdding(SimpleItem, BrowserView):\n-\n     context = None\n     request = None\n     contentName = None\n@@ -115,7 +113,6 @@ def hasCustomAddView(self):\n \n @implementer(IRuleConditionAdding)\n class RuleConditionAdding(RuleElementAdding):\n-\n     # This is necessary so that context.absolute_url() works properly on the\n     # add form, which in turn fixes the <base /> URL\n     id = "+condition"\n@@ -128,7 +125,6 @@ def add(self, content):\n \n @implementer(IRuleActionAdding)\n class RuleActionAdding(RuleElementAdding):\n-\n     # This is necessary so that context.absolute_url() works properly on the\n     # add form, which in turn fixes the <base /> URL\n     id = "+action"\ndiff --git a/plone/app/contentrules/browser/assignments.py b/plone/app/contentrules/browser/assignments.py\nindex ec50215..617137c 100644\n--- a/plone/app/contentrules/browser/assignments.py\n+++ b/plone/app/contentrules/browser/assignments.py\n@@ -95,7 +95,6 @@ def type_name(self):\n \n     @memoize\n     def acquired_rules(self):\n-\n         # Short circuit if this is the root of the portal\n         if ISiteRoot.providedBy(self.context):\n             return []\ndiff --git a/plone/app/contentrules/browser/configure.zcml b/plone/app/contentrules/browser/configure.zcml\nindex 3f59775..46f3d75 100644\n--- a/plone/app/contentrules/browser/configure.zcml\n+++ b/plone/app/contentrules/browser/configure.zcml\n@@ -1,196 +1,200 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <!-- Site-wide information -->\n-    <browser:page\n-        for="*"\n-        name="plone_contentrules_info"\n-        class=".info.ContentRulesInfo"\n-        allowed_interface=".interfaces.IContentRulesInfo"\n-        permission="zope.Public"\n-        />\n+  <!-- Site-wide information -->\n+  <browser:page\n+      name="plone_contentrules_info"\n+      for="*"\n+      class=".info.ContentRulesInfo"\n+      allowed_interface=".interfaces.IContentRulesInfo"\n+      permission="zope.Public"\n+      />\n \n-    <!-- Adding views for rules and elements -->\n-    <browser:view\n-      for="Products.CMFCore.interfaces.ISiteRoot"\n+  <!-- Adding views for rules and elements -->\n+  <browser:view\n       name="+rule"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n       class=".adding.RuleAdding"\n       allowed_interface="plone.app.contentrules.browser.interfaces.IRuleAdding"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <class class=".adding.RuleAdding">\n-      <require\n+  <class class=".adding.RuleAdding">\n+    <require\n         permission="plone.app.contentrules.ManageContentRules"\n-        interface=".interfaces.IRuleAdding" />\n-    </class>\n+        interface=".interfaces.IRuleAdding"\n+        />\n+  </class>\n \n-    <browser:view\n-      for="plone.contentrules.rule.interfaces.IRule"\n+  <browser:view\n       name="+condition"\n+      for="plone.contentrules.rule.interfaces.IRule"\n       class=".adding.RuleConditionAdding"\n       allowed_interface=".interfaces.IRuleConditionAdding"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <class class=".adding.RuleConditionAdding">\n-      <require\n+  <class class=".adding.RuleConditionAdding">\n+    <require\n         permission="plone.app.contentrules.ManageContentRules"\n-        interface=".interfaces.IRuleConditionAdding" />\n-    </class>\n+        interface=".interfaces.IRuleConditionAdding"\n+        />\n+  </class>\n \n-    <browser:view\n-      for="plone.contentrules.rule.interfaces.IRule"\n+  <browser:view\n       name="+action"\n+      for="plone.contentrules.rule.interfaces.IRule"\n       class=".adding.RuleActionAdding"\n       allowed_interface=".interfaces.IRuleActionAdding"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <class class=".adding.RuleActionAdding">\n-      <require\n+  <class class=".adding.RuleActionAdding">\n+    <require\n         permission="plone.app.contentrules.ManageContentRules"\n-        interface=".interfaces.IRuleActionAdding" />\n-    </class>\n+        interface=".interfaces.IRuleActionAdding"\n+        />\n+  </class>\n \n-    <!-- Add and edit form for rules -->\n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleAdding"\n+  <!-- Add and edit form for rules -->\n+  <browser:page\n       name="plone.ContentRule"\n+      for="plone.app.contentrules.browser.interfaces.IRuleAdding"\n       class=".rule.RuleAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.contentrules.rule.interfaces.IRule"\n+  <browser:page\n       name="edit"\n+      for="plone.contentrules.rule.interfaces.IRule"\n       class=".rule.RuleEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <!-- Manage rules -->\n+  <!-- Manage rules -->\n \n-    <browser:page\n-      for="Products.CMFCore.interfaces.ISiteRoot"\n+  <browser:page\n       name="rules-controlpanel"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n-      permission="plone.app.contentrules.ManageContentRules"\n       allowed_attributes="template"\n+      permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n+  <browser:page\n       name="manage-elements"\n       for="plone.contentrules.rule.interfaces.IRule"\n       class=".elements.ManageElements"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.contentrules.engine.interfaces.IRuleAssignable"\n+  <browser:page\n       name="manage-content-rules"\n+      for="plone.contentrules.engine.interfaces.IRuleAssignable"\n       class=".assignments.ManageAssignments"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n+  <browser:page\n       name="contentrule-enable"\n+      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n       attribute="enable_rule"\n       permission="plone.app.contentrules.ManageContentRules"\n-    />\n+      />\n \n-    <browser:page\n-      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n+  <browser:page\n       name="contentrule-disable"\n+      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n       attribute="disable_rule"\n       permission="plone.app.contentrules.ManageContentRules"\n-    />\n+      />\n \n-    <browser:page\n-      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n+  <browser:page\n       name="contentrule-delete"\n+      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n       attribute="delete_rule"\n       permission="plone.app.contentrules.ManageContentRules"\n-    />\n+      />\n \n-    <browser:page\n-      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n+  <browser:page\n       name="contentrule-globally-enable"\n+      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n       attribute="globally_enable"\n       permission="plone.app.contentrules.ManageContentRules"\n-    />\n+      />\n \n-    <browser:page\n-      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n+  <browser:page\n       name="contentrule-globally-disable"\n+      for="plone.base.interfaces.siteroot.IPloneSiteRoot"\n       class=".controlpanel.ContentRulesControlPanel"\n       attribute="globally_disable"\n       permission="plone.app.contentrules.ManageContentRules"\n-    />\n+      />\n \n-    <!-- Namespace for rules, and for actions and conditions -->\n+  <!-- Namespace for rules, and for actions and conditions -->\n \n-    <adapter\n-        factory=".traversal.RuleNamespace"\n-        name="rule"\n-        />\n-    <adapter\n-        factory=".traversal.RuleConditionNamespace"\n-        name="condition"\n-        />\n-    <adapter\n-        factory=".traversal.RuleActionNamespace"\n-        name="action"\n-        />\n+  <adapter\n+      factory=".traversal.RuleNamespace"\n+      name="rule"\n+      />\n+  <adapter\n+      factory=".traversal.RuleConditionNamespace"\n+      name="condition"\n+      />\n+  <adapter\n+      factory=".traversal.RuleActionNamespace"\n+      name="action"\n+      />\n \n-    <!-- When we access rules and elements, we still want to use a CMF/Plone\n+  <!-- When we access rules and elements, we still want to use a CMF/Plone\n     main_template -->\n \n-    <configure package="Products.CMFPlone.browser">\n+  <configure package="Products.CMFPlone.browser">\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.app.contentrules.browser.interfaces.IRuleAdding"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.app.contentrules.browser.interfaces.IRuleElementAdding"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.contentrules.rule.interfaces.IRule"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.contentrules.rule.interfaces.IRuleElementData"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-    </configure>\n+  </configure>\n \n-    <!-- Rule breadcrumb -->\n+  <!-- Rule breadcrumb -->\n \n   <browser:page\n-      for="plone.contentrules.rule.interfaces.IRule"\n       name="breadcrumbs_view"\n+      for="plone.contentrules.rule.interfaces.IRule"\n       class=".navigation.RuleBreadcrumbs"\n-      permission="zope.Public"\n       allowed_attributes="breadcrumbs"\n+      permission="zope.Public"\n       />\n \n </configure>\ndiff --git a/plone/app/contentrules/browser/formhelper.py b/plone/app/contentrules/browser/formhelper.py\nindex 7dafd6f..9d00238 100644\n--- a/plone/app/contentrules/browser/formhelper.py\n+++ b/plone/app/contentrules/browser/formhelper.py\n@@ -24,7 +24,7 @@ class AddForm(AutoExtensibleForm, form.AddForm):\n \n     Sub-classes should define create() and set the form_fields class variable.\n \n-    Notice the suble difference between AddForm and NullAddform in that the\n+    Notice the subtle difference between AddForm and NullAddform in that the\n     create template method for AddForm takes as a parameter a dict \'data\':\n \n         def create(self, data):\n@@ -153,5 +153,4 @@ def nextURL(self):\n \n \n class ContentRuleFormWrapper(layout.FormWrapper):\n-\n     index = ViewPageTemplateFile("templates/contentrules-pageform.pt")\ndiff --git a/plone/app/contentrules/browser/interfaces.py b/plone/app/contentrules/browser/interfaces.py\nindex a59d47d..5b90a2f 100644\n--- a/plone/app/contentrules/browser/interfaces.py\n+++ b/plone/app/contentrules/browser/interfaces.py\n@@ -13,7 +13,7 @@ class IContentRulesControlPanel(Interface):\n     """Marker interface for rules control panel view"""\n \n     def globally_disabled():\n-        """Wether content rules are globally disabled or not"""\n+        """Whether content rules are globally disabled or not"""\n \n \n class IRuleAdding(IAdding):\ndiff --git a/plone/app/contentrules/browser/templates/contentrules-pageform.pt b/plone/app/contentrules/browser/templates/contentrules-pageform.pt\nindex b8c5f0c..4f392ae 100644\n--- a/plone/app/contentrules/browser/templates/contentrules-pageform.pt\n+++ b/plone/app/contentrules/browser/templates/contentrules-pageform.pt\n@@ -1,32 +1,39 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      xml:lang="en" lang="en"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      lang="en"\n       metal:use-macro="context/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n-<div metal:fill-slot="prefs_configlet_main">\n+  <body>\n+    <div metal:fill-slot="prefs_configlet_main">\n \n-    <a id="setup-link" class="link-parent"\n-       tal:attributes="href string:$portal_url/@@overview-controlpanel"\n-       i18n:translate="">\n+      <a class="link-parent"\n+         id="setup-link"\n+         tal:attributes="\n+           href string:$portal_url/@@overview-controlpanel;\n+         "\n+         i18n:translate=""\n+      >\n         Site Setup\n-    </a>\n+      </a>\n \n-    <h1 class="documentFirstHeading"\n-        tal:content="view/label">View Title</h1>\n+      <h1 class="documentFirstHeading"\n+          tal:content="view/label"\n+      >View Title</h1>\n \n-    <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n       Portal status message\n-    </div>\n+      </div>\n \n-    <div id="content-core">\n+      <div id="content-core">\n         <div id="layout-contents">\n-            <span tal:replace="structure view/contents" />\n+          <span tal:replace="structure view/contents"></span>\n         </div>\n-    </div>\n+      </div>\n \n-</div>\n-</body>\n+    </div>\n+  </body>\n </html>\ndiff --git a/plone/app/contentrules/browser/templates/controlpanel.pt b/plone/app/contentrules/browser/templates/controlpanel.pt\nindex e8d3593..021f1f6 100644\n--- a/plone/app/contentrules/browser/templates/controlpanel.pt\n+++ b/plone/app/contentrules/browser/templates/controlpanel.pt\n@@ -1,223 +1,346 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      lang="en"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      lang="en"\n       metal:use-macro="here/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:main metal:fill-slot="prefs_configlet_main"\n-     tal:define="rules view/registeredRules">\n+    <metal:main metal:fill-slot="prefs_configlet_main"\n+                tal:define="\n+                  rules view/registeredRules;\n+                "\n+    >\n \n-  <header>\n-    <h1 class="documentFirstHeading"\n-        i18n:translate="title_manage_contentrules">Content Rules</h1>\n+      <header>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="title_manage_contentrules"\n+        >Content Rules</h1>\n \n-    <p i18n:translate="description-contentrules-controlpanel" class="lead">\n+        <p class="lead"\n+           i18n:translate="description-contentrules-controlpanel"\n+        >\n         Use the form below to define, change or remove content rules. Rules\n         will automatically perform actions on content when certain triggers\n         take place. After defining rules, you may want to go to a folder\n         to assign them, using the "rules" item in the actions menu.\n-    </p>\n-\n-    <div id="fieldset-global">\n-      <form name="ruleSettings" method="POST"\n-           tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n-          <span tal:replace="structure context/@@authenticator/authenticator"/>\n-          <div class="form-check">\n-              <input type="hidden" name="global_disable:boolean:default" value="" />\n-              <input type="checkbox"\n-                     class="form-check-input"\n+        </p>\n+\n+        <div id="fieldset-global">\n+          <form method="POST"\n+                name="ruleSettings"\n+                tal:attributes="\n+                  action string:${context/absolute_url}/@@rules-controlpanel;\n+                "\n+          >\n+            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+            <div class="form-check">\n+              <input name="global_disable:boolean:default"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input class="form-check-input"\n                      id="rules_disable_globally"\n                      name="global_disable:boolean"\n+                     type="checkbox"\n                      value="True"\n-                     tal:attributes="checked python:view.globally_disabled() and \'checked\' or None" />\n-              <label class="form-check-label" for="rules_disable_globally" i18n:translate="">Disable globally</label>\n-              <div class="form-text" i18n:translate="">\n+                     tal:attributes="\n+                       checked python:view.globally_disabled() and \'checked\' or None;\n+                     "\n+              />\n+              <label class="form-check-label"\n+                     for="rules_disable_globally"\n+                     i18n:translate=""\n+              >Disable globally</label>\n+              <div class="form-text"\n+                   i18n:translate=""\n+              >\n                   Whether or not content rules should be disabled globally. If this is selected,\n                   no rules will be executed anywhere in the portal.\n               </div>\n-          </div>\n+            </div>\n \n-          <noscript>\n-          <!-- we\'ll use js to submit this normally -->\n-            <div class="formControls">\n-                <input type="submit"\n+            <noscript>\n+              <!-- we\'ll use js to submit this normally -->\n+              <div class="formControls">\n+                <input class="btn btn-primary"\n                        name="form.button.SaveSettings"\n-                       class="btn btn-primary"\n+                       type="submit"\n                        value="Save"\n-                       i18n:attributes="value label_save;" />\n-            </div>\n-          </noscript>\n-      </form>\n+                       i18n:attributes="value label_save;"\n+                />\n+              </div>\n+            </noscript>\n+          </form>\n \n-    </div>\n+        </div>\n \n \n-  </header>\n+      </header>\n \n-  <div id="content-core">\n-    <div id="translated-text" style="display:none">\n-      <span id="trns_form_error" i18n:translate="">\n+      <div id="content-core">\n+        <div id="translated-text"\n+             style="display:none"\n+        >\n+          <span id="trns_form_error"\n+                i18n:translate=""\n+          >\n         There was an error saving content rules.\n-      </span>\n-      <span id="trns_form_success" i18n:translate="">\n+          </span>\n+          <span id="trns_form_success"\n+                i18n:translate=""\n+          >\n         Content rule settings updated.\n-      </span>\n-      <span id="trns_form_success_enabled" i18n:translate="">\n+          </span>\n+          <span id="trns_form_success_enabled"\n+                i18n:translate=""\n+          >\n         Content rule enabled\n-      </span>\n-      <span id="trns_form_success_disabled" i18n:translate="">\n+          </span>\n+          <span id="trns_form_success_disabled"\n+                i18n:translate=""\n+          >\n         Content rule disabled\n-      </span>\n-      <span id="trns_form_success_deleted" i18n:translate="">\n+          </span>\n+          <span id="trns_form_success_deleted"\n+                i18n:translate=""\n+          >\n         Content rule deleted\n-      </span>\n-    </div>\n+          </span>\n+        </div>\n \n \n-    <div class="card">\n-      <fieldset id="fieldset-rules" class="card-body"\n-                tal:define="rules rules|view/registeredRules;">\n+        <div class="card">\n+          <fieldset class="card-body"\n+                    id="fieldset-rules"\n+                    tal:define="\n+                      rules rules|view/registeredRules;\n+                    "\n+          >\n \n-          <div class="filters row row-cols-lg-auto g-3 align-items-center" tal:condition="rules">\n-            <span class="type-filters">\n-              <label class="col-form-label pe-3" i18n:translate="">Filter rules:</label>\n-              <span class="filter-option"\n-                    tal:repeat="rule view/ruleTypesToShow">\n+            <div class="filters row row-cols-lg-auto g-3 align-items-center"\n+                 tal:condition="rules"\n+            >\n+              <span class="type-filters">\n+                <label class="col-form-label pe-3"\n+                       i18n:translate=""\n+                >Filter rules:</label>\n+                <span class="filter-option"\n+                      tal:repeat="rule view/ruleTypesToShow"\n+                >\n                   <div class="form-check form-check-inline">\n-                    <input id="all" class="form-check-input" type="checkbox"\n-                            tal:attributes="id rule/id"\n-                            />\n+                    <input class="form-check-input"\n+                           id="all"\n+                           type="checkbox"\n+                           tal:attributes="\n+                             id rule/id;\n+                           "\n+                    />\n                     <label class="form-check-label"\n-                            for="all"\n-                            tal:attributes="for rule/id"\n-                            tal:content="rule/title">\n-                            All</label>\n+                           for="all"\n+                           tal:content="rule/title"\n+                           tal:attributes="\n+                             for rule/id;\n+                           "\n+                    >\n+                      All</label>\n                   </div>\n+                </span>\n               </span>\n-            </span>\n-            <span class="state-filters">\n-              <span class="filter-option"\n-                    tal:repeat="state view/statesToShow">\n+              <span class="state-filters">\n+                <span class="filter-option"\n+                      tal:repeat="state view/statesToShow"\n+                >\n                   <div class="form-check form-check-inline">\n-                    <input id="all" class="form-check-input" type="checkbox"\n-                            tal:attributes="id state/id"\n-                            />\n+                    <input class="form-check-input"\n+                           id="all"\n+                           type="checkbox"\n+                           tal:attributes="\n+                             id state/id;\n+                           "\n+                    />\n                     <label class="form-check-label"\n-                            for="all"\n-                            tal:attributes="for state/id"\n-                            tal:content="state/title">\n-                            All</label>\n+                           for="all"\n+                           tal:content="state/title"\n+                           tal:attributes="\n+                             for state/id;\n+                           "\n+                    >\n+                      All</label>\n                   </div>\n+                </span>\n               </span>\n-            </span>\n-          </div>\n-\n-          <div class="visualClear"><!-- --></div>\n-          <div id="rules_table_form"\n-                metal:define-macro="rules_table_form">\n-          <table  class="listing nosort controlpanel-listing table mb-0"\n-                  tal:condition="rules">\n-              <thead class="">\n+            </div>\n+\n+            <div class="visualClear"><!-- --></div>\n+            <div id="rules_table_form"\n+                 metal:define-macro="rules_table_form"\n+            >\n+              <table class="listing nosort controlpanel-listing table mb-0"\n+                     tal:condition="rules"\n+              >\n+                <thead class="">\n                   <tr>\n-                      <th scope="col" i18n:translate="label_contentrules_rule_listing">Content rule</th>\n-                      <th scope="col" i18n:translate="label_contentrules_rule_event">Event</th>\n-                      <th scope="col"><span class="ps-2" i18n:translate="label_contentrules_rule_status">Status</span></th>\n-                      <th scope="col" i18n:translate="label_contentrules_rule_actions">Actions</th>\n+                    <th scope="col"\n+                        i18n:translate="label_contentrules_rule_listing"\n+                    >Content rule</th>\n+                    <th scope="col"\n+                        i18n:translate="label_contentrules_rule_event"\n+                    >Event</th>\n+                    <th scope="col"><span class="ps-2"\n+                            i18n:translate="label_contentrules_rule_status"\n+                      >Status</span></th>\n+                    <th scope="col"\n+                        i18n:translate="label_contentrules_rule_actions"\n+                    >Actions</th>\n                   </tr>\n-              </thead>\n-              <tbody>\n+                </thead>\n+                <tbody>\n                   <tal:rules repeat="rule view/registeredRules">\n-                  <tr tal:define="oddrow repeat/rule/odd"\n-                      tal:attributes="class python:(oddrow and \'even \' or \'odd \') + rule[\'row_class\'];">\n+                    <tr tal:define="\n+                          oddrow repeat/rule/odd;\n+                        "\n+                        tal:attributes="\n+                          class python:(oddrow and \'even \' or \'odd \') + rule[\'row_class\'];\n+                        "\n+                    >\n                       <td>\n                         <h5 class="rule-title">\n-                          <span\n-                              tal:replace="rule/title">Rule Title</span>\n+                          <span tal:replace="rule/title">Rule Title</span>\n                         </h5>\n-                          <div tal:content="rule/description">\n+                        <div tal:content="rule/description">\n                               Rule Description.\n-                          </div>\n+                        </div>\n                       </td>\n                       <td>\n-                          <span class="trigger"\n-                                tal:content="rule/trigger"\n-                                i18n:translate="">trigger</span>\n+                        <span class="trigger"\n+                              tal:content="rule/trigger"\n+                              i18n:translate=""\n+                        >trigger</span>\n                       </td>\n                       <td class="status">\n \n-                        <form style="display: inline" method="POST"\n-                              tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n-                        <span tal:replace="structure context/@@authenticator/authenticator"/>\n-                        <input type="hidden"\n-                              name="rule-id"\n-                              tal:attributes="value rule/id">\n-                        <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link ${python: rule[\'enabled\'] and \'d-none\'}" type="submit" value="Enable"\n-                              name="form.button.EnableRule"\n-                              tal:attributes="data-value rule/id;\n-                                              data-url string:$portal_url/@@contentrule-enable"\n-                              i18n:attributes="value label_enable;">\n-                              <tal:icon tal:replace="structure python:icons.tag(\'square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="enabled">Enabled</span>\n-                        </button>\n-                        <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link ${python: not rule[\'enabled\'] and \'d-none\'}" type="submit" value="Disable"\n-                              name="form.button.DisableRule"\n-                              tal:attributes="data-value rule/id;\n-                                              data-url string:$portal_url/@@contentrule-disable"\n-                              i18n:attributes="value label_disable;">\n-                              <tal:icon tal:replace="structure python:icons.tag(\'check-square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="enabled">Enabled</span>\n-                            </button>\n+                        <form method="POST"\n+                              style="display: inline"\n+                              tal:attributes="\n+                                action string:${context/absolute_url}/@@rules-controlpanel;\n+                              "\n+                        >\n+                          <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                          <input name="rule-id"\n+                                 type="hidden"\n+                                 tal:attributes="\n+                                   value rule/id;\n+                                 "\n+                          />\n+                          <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link ${python: rule[\'enabled\'] and \'d-none\'}"\n+                                  name="form.button.EnableRule"\n+                                  type="submit"\n+                                  value="Enable"\n+                                  tal:attributes="\n+                                    data-value rule/id;\n+                                    data-url string:$portal_url/@@contentrule-enable;\n+                                  "\n+                                  i18n:attributes="value label_enable;"\n+                          >\n+                            <tal:icon tal:replace="structure python:icons.tag(\'square\', tag_alt=\'Toggle to show\')" /><span class="ms-2"\n+                                  i18n:translate="enabled"\n+                            >Enabled</span>\n+                          </button>\n+                          <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link ${python: not rule[\'enabled\'] and \'d-none\'}"\n+                                  name="form.button.DisableRule"\n+                                  type="submit"\n+                                  value="Disable"\n+                                  tal:attributes="\n+                                    data-value rule/id;\n+                                    data-url string:$portal_url/@@contentrule-disable;\n+                                  "\n+                                  i18n:attributes="value label_disable;"\n+                          >\n+                            <tal:icon tal:replace="structure python:icons.tag(\'check-square\', tag_alt=\'Toggle to show\')" /><span class="ms-2"\n+                                  i18n:translate="enabled"\n+                            >Enabled</span>\n+                          </button>\n                         </form>\n \n-                        <span\n-                          class="badge bg-warning text-dark icon-contentrule-enabled-unassigned"\n-                          alt="unassigned"\n-                          title="this rule has not been assigned"\n-                          tal:condition="python:not rule[\'assigned\']"\n-                          i18n:attributes="alt label_contentrules_rule_unassigned;\n-                                          title title_contentrule_rule_unassigned;">\n-                          <tal:icon tal:replace="structure python:icons.tag(\'exclamation-triangle-fill\', tag_alt=\'not assigned\')" /><span class="ms-2" i18n:translate="">not assigned</span>\n-                    </span>\n+                        <span class="badge bg-warning text-dark icon-contentrule-enabled-unassigned"\n+                              alt="unassigned"\n+                              title="this rule has not been assigned"\n+                              tal:condition="python:not rule[\'assigned\']"\n+                              i18n:attributes="alt label_contentrules_rule_unassigned;\n+                                          title title_contentrule_rule_unassigned;"\n+                        >\n+                          <tal:icon tal:replace="structure python:icons.tag(\'exclamation-triangle-fill\', tag_alt=\'not assigned\')" /><span class="ms-2"\n+                                i18n:translate=""\n+                          >not assigned</span>\n+                        </span>\n \n \n \n                       </td>\n                       <td>\n-                        <form style="display: inline" method="POST"\n-                              tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n-                        <span tal:replace="structure context/@@authenticator/authenticator"/>\n-                        <input type="hidden"\n-                              name="rule-id"\n-                              tal:attributes="value rule/id">\n-                        <a href="" class="btn btn-sm btn-primary"\n-                        tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements" i18n:translate="">Configure</a>\n-                        <a href="" class="btn btn-sm btn-secondary"\n-                              tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@edit" i18n:translate="">Edit</a>\n-\n-                        <button class="destructive btn-rule-action btn-rule-delete btn btn-sm btn-danger" type="submit" value="Delete"\n-                              tal:attributes="data-value rule/id;\n-                                              data-url string:$portal_url/@@contentrule-delete"\n-                              name="form.button.DeleteRule"\n-                              i18n:translate=""\n-                              i18n:attributes="value label_delete;">Delete</button>\n+                        <form method="POST"\n+                              style="display: inline"\n+                              tal:attributes="\n+                                action string:${context/absolute_url}/@@rules-controlpanel;\n+                              "\n+                        >\n+                          <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                          <input name="rule-id"\n+                                 type="hidden"\n+                                 tal:attributes="\n+                                   value rule/id;\n+                                 "\n+                          />\n+                          <a class="btn btn-sm btn-primary"\n+                             href=""\n+                             tal:attributes="\n+                               href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements;\n+                             "\n+                             i18n:translate=""\n+                          >Configure</a>\n+                          <a class="btn btn-sm btn-secondary"\n+                             href=""\n+                             tal:attributes="\n+                               href string:${context/absolute_url}/++rule++${rule/id}/@@edit;\n+                             "\n+                             i18n:translate=""\n+                          >Edit</a>\n+\n+                          <button class="destructive btn-rule-action btn-rule-delete btn btn-sm btn-danger"\n+                                  name="form.button.DeleteRule"\n+                                  type="submit"\n+                                  value="Delete"\n+                                  tal:attributes="\n+                                    data-value rule/id;\n+                                    data-url string:$portal_url/@@contentrule-delete;\n+                                  "\n+                                  i18n:attributes="value label_delete;"\n+                                  i18n:translate=""\n+                          >Delete</button>\n                         </form>\n                       </td>\n-                  </tr>\n+                    </tr>\n                   </tal:rules>\n-              </tbody>\n-          </table>\n-          </div>\n-        </fieldset>\n-      </div>\n-      <div class="mt-3">\n-        <a id="#addcontentrule" tal:attributes="href string:${context/absolute_url}/+rule/plone.ContentRule;"\n-            class="plone-btn plone-btn-primary btn btn-success"\n-            i18n:translate="label_contentrule_add">Add content rule</a>\n+                </tbody>\n+              </table>\n+            </div>\n+          </fieldset>\n+        </div>\n+        <div class="mt-3">\n+          <a class="plone-btn plone-btn-primary btn btn-success"\n+             id="#addcontentrule"\n+             tal:attributes="\n+               href string:${context/absolute_url}/+rule/plone.ContentRule;\n+             "\n+             i18n:translate="label_contentrule_add"\n+          >Add content rule</a>\n+        </div>\n       </div>\n-    </div>\n-</metal:main>\n-</body>\n+    </metal:main>\n+  </body>\n </html>\n-\ndiff --git a/plone/app/contentrules/browser/templates/manage-assignments.pt b/plone/app/contentrules/browser/templates/manage-assignments.pt\nindex a7672b7..4a31eb4 100644\n--- a/plone/app/contentrules/browser/templates/manage-assignments.pt\n+++ b/plone/app/contentrules/browser/templates/manage-assignments.pt\n@@ -1,263 +1,364 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      lang="en"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<head>\n-</head>\n+  <head>\n+  </head>\n \n-<body>\n+  <body>\n \n-<metal:body fill-slot="body"\n-    tal:define="icons python:context.restrictedTraverse(\'@@iconresolver\')">\n+    <metal:body fill-slot="body"\n+                tal:define="\n+                  icons python:context.restrictedTraverse(\'@@iconresolver\');\n+                "\n+    >\n \n-      <link rel="stylesheet" type="text/css" media="all"\n-          href="++resource++manage-contentrules.css"\n-          tal:attributes="href string:${context/portal_url}/++resource++manage-contentrules.css" />\n+      <link href="++resource++manage-contentrules.css"\n+            media="all"\n+            rel="stylesheet"\n+            type="text/css"\n+            tal:attributes="\n+              href string:${context/portal_url}/++resource++manage-contentrules.css;\n+            "\n+      />\n \n-    <div tal:condition="not:view/globally_enabled"\n-         class="alert alert-info">\n+      <div class="alert alert-info"\n+           tal:condition="not:view/globally_enabled"\n+      >\n         <strong i18n:translate="">\n             Info\n         </strong>\n         <span i18n:translate="warning_contentrules_disabled">\n             Content rules are disabled globally. No assigned rules will execute\n             until they are re-enabled. Use the\n-            <a href=""\n-               i18n:name="controlpanel_link"\n-               i18n:translate="contentrules_control_panel"\n-               tal:attributes="href string:${portal_url}/@@rules-controlpanel">\n+          <a href=""\n+             tal:attributes="\n+               href string:${portal_url}/@@rules-controlpanel;\n+             "\n+             i18n:name="controlpanel_link"\n+             i18n:translate="contentrules_control_panel"\n+          >\n                 content rules control panel\n-            </a>to enable them again.\n+          </a>to enable them again.\n         </span>\n-    </div>\n+      </div>\n \n-    <article id="content">\n+      <article id="content">\n         <header>\n-            <h1 class="documentFirstHeading"\n-                i18n:translate="title_contentrules_assigned">\n-                Content rules for <q i18n:name="context" tal:content="context/Title">title</q>\n-            </h1>\n+          <h1 class="documentFirstHeading"\n+              i18n:translate="title_contentrules_assigned"\n+          >\n+                Content rules for\n+            <q tal:content="context/Title"\n+               i18n:name="context"\n+            >title</q>\n+          </h1>\n \n-            <div class="lead">\n+          <div class="lead">\n \n-                <span i18n:translate="description_contentrules_assigned" tal:condition="view/has_rules">\n+            <span tal:condition="view/has_rules"\n+                  i18n:translate="description_contentrules_assigned"\n+            >\n                     The following content rules are active in this\n-                    <span i18n:name="type_name" tal:content="view/type_name" />.\n-                </span>\n-                <span i18n:translate="description_contentrules_assigned_norules" tal:condition="not:view/has_rules">\n+              <span tal:content="view/type_name"\n+                    i18n:name="type_name"\n+              ></span>.\n+            </span>\n+            <span tal:condition="not:view/has_rules"\n+                  i18n:translate="description_contentrules_assigned_norules"\n+            >\n                     There are currently no active content rules in this\n-                    <span i18n:name="type_name" tal:content="view/type_name" />.\n-                </span>\n+              <span tal:content="view/type_name"\n+                    i18n:name="type_name"\n+              ></span>.\n+            </span>\n \n-                <span i18n:translate="contentrules_controlpanel_link">\n+            <span i18n:translate="contentrules_controlpanel_link">\n                     Use the\n-                    <a i18n:name="controlpanel_link"\n-                       i18n:translate="contentrules_control_panel"\n-                       tal:attributes="href string:${portal_url}/@@rules-controlpanel">\n+              <a tal:attributes="\n+                   href string:${portal_url}/@@rules-controlpanel;\n+                 "\n+                 i18n:name="controlpanel_link"\n+                 i18n:translate="contentrules_control_panel"\n+              >\n                         content rules control panel\n-                    </a>\n+              </a>\n                     to create new rules or delete or modify existing ones.\n-                </span>\n+            </span>\n \n \n-            </div>\n+          </div>\n \n \n         </header>\n \n         <div id="content-core">\n-            <div class="active">\n-                <div tal:define="acquired_rules view/acquired_rules"\n-                     tal:condition="acquired_rules">\n-                    <table class="table listing nosort">\n-                        <thead>\n-                            <tr>\n-                                <th i18n:translate="label_contentrules_from_parent">\n+          <div class="active">\n+            <div tal:define="\n+                   acquired_rules view/acquired_rules;\n+                 "\n+                 tal:condition="acquired_rules"\n+            >\n+              <table class="table listing nosort">\n+                <thead>\n+                  <tr>\n+                    <th i18n:translate="label_contentrules_from_parent">\n                                     Content rules from parent folders\n-                                </th>\n-                                <th class="smallcolumn" i18n:translate="label_contentrules_active">Active</th>\n-                            </tr>\n-                        </thead>\n-                        <tbody>\n-                            <tal:rules repeat="rule acquired_rules">\n-                                <tr tal:define="oddrow repeat/rule/odd"\n-                                    tal:attributes="class python:oddrow and \'even\' or \'odd\'">\n-                                    <td>\n-                                        <dl>\n-                                            <dt><a tal:attributes="href rule/url">\n-                                                <span tal:replace="rule/title" />\n-                                                (<span class="trigger"\n-                                                    i18n:translate=""\n-                                                    tal:content="rule/trigger">trigger</span>)</a></dt>\n-                                            <dd tal:content="rule/description">\n+                    </th>\n+                    <th class="smallcolumn"\n+                        i18n:translate="label_contentrules_active"\n+                    >Active</th>\n+                  </tr>\n+                </thead>\n+                <tbody>\n+                  <tal:rules repeat="rule acquired_rules">\n+                    <tr tal:define="\n+                          oddrow repeat/rule/odd;\n+                        "\n+                        tal:attributes="\n+                          class python:oddrow and \'even\' or \'odd\';\n+                        "\n+                    >\n+                      <td>\n+                        <dl>\n+                          <dt><a tal:attributes="\n+                                 href rule/url;\n+                               ">\n+                              <span tal:replace="rule/title"></span>\n+                              (<span class="trigger"\n+                                    tal:content="rule/trigger"\n+                                    i18n:translate=""\n+                              >trigger</span>)</a></dt>\n+                          <dd tal:content="rule/description">\n                                                 Rule Description.\n-                                            </dd>\n-                                        </dl>\n-                                    </td>\n-                                    <td class="checker">\n-                                        <tal:icon tal:condition="rule/enabled"\n-                                            i18n:attributes="alt label_contentrules_active;"\n-                                            tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n-                                    </td>\n-                                </tr>\n-                            </tal:rules>\n-                        </tbody>\n-                    </table>\n-                </div>\n+                          </dd>\n+                        </dl>\n+                      </td>\n+                      <td class="checker">\n+                        <tal:icon tal:condition="rule/enabled"\n+                                  tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')"\n+                                  i18n:attributes="alt label_contentrules_active;"\n+                        />\n+                      </td>\n+                    </tr>\n+                  </tal:rules>\n+                </tbody>\n+              </table>\n+            </div>\n \n-                <div id="assignable-content-rules" class="mb-4"\n-                    tal:define="assignable_rules view/assignable_rules"\n-                    tal:condition="assignable_rules">\n-                    <div class="col-form-label" i18n:translate="contentrules_available_rules">\n+            <div class="mb-4"\n+                 id="assignable-content-rules"\n+                 tal:define="\n+                   assignable_rules view/assignable_rules;\n+                 "\n+                 tal:condition="assignable_rules"\n+            >\n+              <div class="col-form-label"\n+                   i18n:translate="contentrules_available_rules"\n+              >\n                         Available content rules:\n-                    </div>\n-                    <form class="row row-cols-auto g-3 align-items-center"\n-                        tal:attributes="action string:${view/view_url}" method="post">\n-                            <div class="col-auto">\n-                                <select class="form-select" name="rule_id" size="1" id="select-rules">\n-                                    <tal:options repeat="rule assignable_rules">\n-                                        <option tal:attributes="value rule/id"\n-                                                tal:content="rule/title">Addable rule name</option>\n-                                    </tal:options>\n-                                </select>\n-                            </div>\n+              </div>\n+              <form class="row row-cols-auto g-3 align-items-center"\n+                    method="post"\n+                    tal:attributes="\n+                      action string:${view/view_url};\n+                    "\n+              >\n+                <div class="col-auto">\n+                  <select class="form-select"\n+                          id="select-rules"\n+                          name="rule_id"\n+                          size="1"\n+                  >\n+                    <tal:options repeat="rule assignable_rules">\n+                      <option tal:content="rule/title"\n+                              tal:attributes="\n+                                value rule/id;\n+                              "\n+                      >Addable rule name</option>\n+                    </tal:options>\n+                  </select>\n+                </div>\n \n-                            <div class="col-auto">\n-                                <button class="context btn btn-primary"\n-                                    type="submit"\n-                                    name="form.button.AddAssignment"\n-                                    value="Add"\n-                                    i18n:attributes="value label_add;"\n-                                    i18n:translate="label_add">Add</button>\n-                            </div>\n-                    </form>\n+                <div class="col-auto">\n+                  <button class="context btn btn-primary"\n+                          name="form.button.AddAssignment"\n+                          type="submit"\n+                          value="Add"\n+                          i18n:attributes="value label_add;"\n+                          i18n:translate="label_add"\n+                  >Add</button>\n                 </div>\n+              </form>\n+            </div>\n \n \n-                <div class="clearfix"></div>\n+            <div class="clearfix"></div>\n \n-                <form class="mb-3" tal:attributes="action view/view_url" method="post"\n-                      tal:define="assigned_rules view/assigned_rules" tal:condition="assigned_rules">\n-                    <table class="table listing nosort">\n-                        <thead>\n-                            <tr>\n-                                <th class="smallcolumn">&nbsp;</th>\n-                                <th i18n:translate="label_contentrules_active_assignments">\n+            <form class="mb-3"\n+                  method="post"\n+                  tal:define="\n+                    assigned_rules view/assigned_rules;\n+                  "\n+                  tal:condition="assigned_rules"\n+                  tal:attributes="\n+                    action view/view_url;\n+                  "\n+            >\n+              <table class="table listing nosort">\n+                <thead>\n+                  <tr>\n+                    <th class="smallcolumn">&nbsp;</th>\n+                    <th i18n:translate="label_contentrules_active_assignments">\n                                     Active content rules in this\n-                                    <span i18n:name="content_type"\n-                                          tal:replace="view/type_name" />\n-                                </th>\n-                                <th class="smallcolumn">\n+                      <span tal:replace="view/type_name"\n+                            i18n:name="content_type"\n+                      ></span>\n+                    </th>\n+                    <th class="smallcolumn">\n                                     &nbsp;\n-                                </th>\n-                                <th class="smallcolumn" i18n:translate="label_contentrules_subfolders">\n+                    </th>\n+                    <th class="smallcolumn"\n+                        i18n:translate="label_contentrules_subfolders"\n+                    >\n                                     Applies to subfolders?\n-                                </th>\n-                                <th class="smallcolumn" i18n:translate="label_contentrules_assignment_enabled">\n+                    </th>\n+                    <th class="smallcolumn"\n+                        i18n:translate="label_contentrules_assignment_enabled"\n+                    >\n                                     Enabled here?\n-                                </th>\n-                                <th class="smallcolumn" i18n:translate="label_contentrules_rule_enabled_question">\n+                    </th>\n+                    <th class="smallcolumn"\n+                        i18n:translate="label_contentrules_rule_enabled_question"\n+                    >\n                                     Enabled?\n-                                </th>\n-                            </tr>\n-                        </thead>\n-                        <tbody>\n-                            <tal:rules repeat="rule assigned_rules">\n-                            <tr tal:define="oddrow repeat/rule/odd"\n-                                tal:attributes="class python:oddrow and \'even\' or \'odd\'">\n-                                <td>\n-                                    <input type="checkbox"\n-                                           name="rule_ids:list"\n-                                           tal:attributes="value rule/id" />\n-                                </td>\n-                                <td>\n-                                    <dl>\n-                                        <dt><a tal:attributes="href rule/url">\n-                                            <span tal:replace="rule/title" />\n-                                            (<span class="trigger"\n-                                                i18n:translate=""\n-                                                tal:content="rule/trigger">trigger</span>)</a></dt>\n-                                        <dd tal:content="rule/description">\n+                    </th>\n+                  </tr>\n+                </thead>\n+                <tbody>\n+                  <tal:rules repeat="rule assigned_rules">\n+                    <tr tal:define="\n+                          oddrow repeat/rule/odd;\n+                        "\n+                        tal:attributes="\n+                          class python:oddrow and \'even\' or \'odd\';\n+                        "\n+                    >\n+                      <td>\n+                        <input name="rule_ids:list"\n+                               type="checkbox"\n+                               tal:attributes="\n+                                 value rule/id;\n+                               "\n+                        />\n+                      </td>\n+                      <td>\n+                        <dl>\n+                          <dt><a tal:attributes="\n+                                 href rule/url;\n+                               ">\n+                              <span tal:replace="rule/title"></span>\n+                              (<span class="trigger"\n+                                    tal:content="rule/trigger"\n+                                    i18n:translate=""\n+                              >trigger</span>)</a></dt>\n+                          <dd tal:content="rule/description">\n                                             Rule Description.\n-                                        </dd>\n-                                    </dl>\n-                                </td>\n-                                <td class="text-center">\n-                                    <a tal:condition="not:repeat/rule/start"\n-                                       title="Move up"\n-                                       i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id}">\n-                                        <tal:icon tal:replace="structure python:icons.tag(\'caret-up-fill\', tag_class=\'\', tag_alt=\'\')" />\n-                                    </a>\n-                                    <a tal:condition="not:repeat/rule/end"\n-                                       title="Move down"\n-                                       i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id}">\n-                                        <tal:icon tal:replace="structure python:icons.tag(\'caret-down-fill\', tag_class=\'\', tag_alt=\'\')" />\n-                                    </a>\n-                                </td>\n-                                <td class="checker listingCheckbox">\n-                                    <tal:icon tal:condition="rule/bubbles"\n-                                        i18n:attributes="alt label_contentrules_active;"\n-                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n-                                </td>\n-                                <td class="checker listingCheckbox">\n-                                    <tal:icon tal:condition="rule/enabled"\n-                                        i18n:attributes="alt label_contentrules_active;"\n-                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n-                                </td>\n-                                <td class="checker listingCheckbox">\n-                                    <tal:icon tal:condition="rule/global_enabled"\n-                                        i18n:attributes="alt label_contentrules_active;"\n-                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n-                                </td>\n-                            </tr>\n-                            </tal:rules>\n-                        </tbody>\n-                    </table>\n+                          </dd>\n+                        </dl>\n+                      </td>\n+                      <td class="text-center">\n+                        <a title="Move up"\n+                           tal:condition="not:repeat/rule/start"\n+                           tal:attributes="\n+                             href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id};\n+                           "\n+                           i18n:attributes="title"\n+                        >\n+                          <tal:icon tal:replace="structure python:icons.tag(\'caret-up-fill\', tag_class=\'\', tag_alt=\'\')" />\n+                        </a>\n+                        <a title="Move down"\n+                           tal:condition="not:repeat/rule/end"\n+                           tal:attributes="\n+                             href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id};\n+                           "\n+                           i18n:attributes="title"\n+                        >\n+                          <tal:icon tal:replace="structure python:icons.tag(\'caret-down-fill\', tag_class=\'\', tag_alt=\'\')" />\n+                        </a>\n+                      </td>\n+                      <td class="checker listingCheckbox">\n+                        <tal:icon tal:condition="rule/bubbles"\n+                                  tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')"\n+                                  i18n:attributes="alt label_contentrules_active;"\n+                        />\n+                      </td>\n+                      <td class="checker listingCheckbox">\n+                        <tal:icon tal:condition="rule/enabled"\n+                                  tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')"\n+                                  i18n:attributes="alt label_contentrules_active;"\n+                        />\n+                      </td>\n+                      <td class="checker listingCheckbox">\n+                        <tal:icon tal:condition="rule/global_enabled"\n+                                  tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')"\n+                                  i18n:attributes="alt label_contentrules_active;"\n+                        />\n+                      </td>\n+                    </tr>\n+                  </tal:rules>\n+                </tbody>\n+              </table>\n \n-                    <div class="formControls">\n-                        <button name="form.button.Enable"\n-                               class="context btn btn-primary"\n-                               type="submit"\n-                               value="Enable"\n-                               i18n:attributes="value label_enable;"\n-                               i18n:translate="label_enable">Enable</button>\n-                        <button name="form.button.Disable"\n-                               class="standalone btn btn-primary"\n-                               type="submit"\n-                               value="Disable"\n-                               i18n:attributes="value label_disable;"\n-                               i18n:translate="label_disable">Disable</button>\n-                        <button name="form.button.Bubble"\n-                               class="standalone btn btn-primary"\n-                               type="submit"\n-                               value="Apply to subfolders"\n-                               i18n:attributes="value label_apply_to_subfolders;"\n-                               i18n:translate="label_apply_to_subfolders">Apply to subfolders</button>\n-                        <button name="form.button.NoBubble"\n-                               class="standalone btn btn-primary"\n-                               type="submit"\n-                               value="Disable apply to subfolders"\n-                               i18n:attributes="value label_disable_apply_to_subfolders;"\n-                               i18n:translate="label_disable_apply_to_subfolders">Disable apply to subfolders</button>\n-                        <button name="form.button.Delete"\n-                               class="destructive btn btn-danger"\n-                               type="submit"\n-                               value="Unassign"\n-                               i18n:attributes="value label_unassign;"\n-                               i18n:translate="label_unassign">Unassign</button>\n-                    </div>\n-                </form>\n-            </div>\n+              <div class="formControls">\n+                <button class="context btn btn-primary"\n+                        name="form.button.Enable"\n+                        type="submit"\n+                        value="Enable"\n+                        i18n:attributes="value label_enable;"\n+                        i18n:translate="label_enable"\n+                >Enable</button>\n+                <button class="standalone btn btn-primary"\n+                        name="form.button.Disable"\n+                        type="submit"\n+                        value="Disable"\n+                        i18n:attributes="value label_disable;"\n+                        i18n:translate="label_disable"\n+                >Disable</button>\n+                <button class="standalone btn btn-primary"\n+                        name="form.button.Bubble"\n+                        type="submit"\n+                        value="Apply to subfolders"\n+                        i18n:attributes="value label_apply_to_subfolders;"\n+                        i18n:translate="label_apply_to_subfolders"\n+                >Apply to subfolders</button>\n+                <button class="standalone btn btn-primary"\n+                        name="form.button.NoBubble"\n+                        type="submit"\n+                        value="Disable apply to subfolders"\n+                        i18n:attributes="value label_disable_apply_to_subfolders;"\n+                        i18n:translate="label_disable_apply_to_subfolders"\n+                >Disable apply to subfolders</button>\n+                <button class="destructive btn btn-danger"\n+                        name="form.button.Delete"\n+                        type="submit"\n+                        value="Unassign"\n+                        i18n:attributes="value label_unassign;"\n+                        i18n:translate="label_unassign"\n+                >Unassign</button>\n+              </div>\n+            </form>\n+          </div>\n         </div>\n \n-    </article>\n+      </article>\n \n-</metal:body>\n-</body>\n+    </metal:body>\n+  </body>\n </html>\ndiff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex 62f672d..b4e13aa 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -1,296 +1,398 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-    xml:lang="en"\n-    lang="en"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    metal:use-macro="here/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="here/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-    <body>\n+  <body>\n \n-        <metal:main metal:fill-slot="prefs_configlet_main">\n+    <metal:main metal:fill-slot="prefs_configlet_main">\n \n-            <header>\n-                <h1 class="documentFirstHeading">\n-                    <span i18n:translate="title_edit_contentrule">Edit content rule</span>:\n-                    <span tal:replace="view/rule_title"></span>\n-                </h1>\n+      <header>\n+        <h1 class="documentFirstHeading">\n+          <span i18n:translate="title_edit_contentrule">Edit content rule</span>:\n+          <span tal:replace="view/rule_title"></span>\n+        </h1>\n \n-                <p i18n:translate="contentrules_description_execution"\n-                    class="lead">\n+        <p class="lead"\n+           i18n:translate="contentrules_description_execution"\n+        >\n                     Rules execute when a triggering event occurs. Rule actions will only\n                     be invoked if all the rule\'s conditions are met. You can add new\n                     actions and conditions using the buttons below.\n-                </p>\n-                <a href=""\n-                    class="link-parent d-block"\n-                    tal:attributes="href string:${portal_url}/@@rules-controlpanel"\n-                    i18n:translate="go_to_contentrules_overview">\n+        </p>\n+        <a class="link-parent d-block"\n+           href=""\n+           tal:attributes="\n+             href string:${portal_url}/@@rules-controlpanel;\n+           "\n+           i18n:translate="go_to_contentrules_overview"\n+        >\n                     Up to rule overview\n-                </a>\n-            </header>\n+        </a>\n+      </header>\n \n-            <div id="content-core" class="pat-contentrules-elements">\n+      <div class="pat-contentrules-elements"\n+           id="content-core"\n+      >\n \n-                <div class="row row-cols-1 row-cols-md-2">\n-                    <fieldset id="configure-conditions" class="col"\n-                        tal:define="conditions view/conditions">\n-                        <legend i18n:translate="if_all_conditions_met" class="float-none">\n+        <div class="row row-cols-1 row-cols-md-2">\n+          <fieldset class="col"\n+                    id="configure-conditions"\n+                    tal:define="\n+                      conditions view/conditions;\n+                    "\n+          >\n+            <legend class="float-none"\n+                    i18n:translate="if_all_conditions_met"\n+            >\n                             If all of the following conditions are met:\n-                        </legend>\n+            </legend>\n \n-                        <div tal:condition="not:conditions"\n-                            class="alert alert-info">\n-                            <strong i18n:translate="">Info</strong>\n-                            <span i18n:translate="">\n+            <div class="alert alert-info"\n+                 tal:condition="not:conditions"\n+            >\n+              <strong i18n:translate="">Info</strong>\n+              <span i18n:translate="">\n                                 There is not any additional condition checked on this rule.\n-                            </span>\n-                        </div>\n+              </span>\n+            </div>\n \n-                        <form class="mb-3"\n-                            tal:attributes="action view/view_url"\n-                            method="post"\n-                            tal:define="auth_token context/@@authenticator/token"\n-                            tal:repeat="condition conditions">\n-                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                            <a tal:attributes="name string:condition++${condition/idx}"></a>\n-                            <input type="hidden"\n-                                name="element_id:int"\n-                                tal:attributes="value condition/idx" />\n+            <form class="mb-3"\n+                  method="post"\n+                  tal:define="\n+                    auth_token context/@@authenticator/token;\n+                  "\n+                  tal:repeat="condition conditions"\n+                  tal:attributes="\n+                    action view/view_url;\n+                  "\n+            >\n+              <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+              <a tal:attributes="\n+                   name string:condition++${condition/idx};\n+                 "></a>\n+              <input name="element_id:int"\n+                     type="hidden"\n+                     tal:attributes="\n+                       value condition/idx;\n+                     "\n+              />\n \n-                            <div class="card">\n-                                <div class="card-body row">\n-                                    <div class="col">\n-                                        <h5 class="card-title"\n-                                        tal:content="condition/title"\n-                                        i18n:translate="">Transition was publish.</h5>\n-                                    </div>\n-                                    <div class="col-auto">\n-                                        <div class="rule-operations">\n-                                            <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n-                                                class="pat-plone-modal btn btn-sm btn-primary"\n-                                                tal:condition="condition/editview"\n-                                                i18n:translate="label_edit">Edit</a>\n-                                            <button type="submit"\n-                                                name="form.button.DeleteCondition"\n-                                                value="Remove"\n-                                                class="context btn btn-sm btn-danger"\n-                                                i18n:attributes="value label_remove;"\n-                                                i18n:translate="label_remove">Remove</button>\n-                                            <button tal:attributes="disabled python:condition[\'first\'] and \'disabled\' or None"\n-                                                type="submit"\n-                                                name="form.button.MoveConditionUp"\n-                                                value="&uarr;"\n-                                                class="context btn btn-sm btn-primary">&uarr;</button>\n-                                            <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n-                                                type="submit"\n-                                                name="form.button.MoveConditionDown"\n-                                                value="&darr;"\n-                                                class="context btn btn-sm btn-primary">&darr;</button>\n-                                        </div>\n-                                    </div>\n-                                    <p class="card-text" tal:content="condition/summary">\n+              <div class="card">\n+                <div class="card-body row">\n+                  <div class="col">\n+                    <h5 class="card-title"\n+                        tal:content="condition/title"\n+                        i18n:translate=""\n+                    >Transition was publish.</h5>\n+                  </div>\n+                  <div class="col-auto">\n+                    <div class="rule-operations">\n+                      <a class="pat-plone-modal btn btn-sm btn-primary"\n+                         tal:condition="condition/editview"\n+                         tal:attributes="\n+                           href string:${condition/editview}?_authenticator=${auth_token};\n+                         "\n+                         i18n:translate="label_edit"\n+                      >Edit</a>\n+                      <button class="context btn btn-sm btn-danger"\n+                              name="form.button.DeleteCondition"\n+                              type="submit"\n+                              value="Remove"\n+                              i18n:attributes="value label_remove;"\n+                              i18n:translate="label_remove"\n+                      >Remove</button>\n+                      <button class="context btn btn-sm btn-primary"\n+                              name="form.button.MoveConditionUp"\n+                              type="submit"\n+                              value="&uarr;"\n+                              tal:attributes="\n+                                disabled python:condition[\'first\'] and \'disabled\' or None;\n+                              "\n+                      >&uarr;</button>\n+                      <button class="context btn btn-sm btn-primary"\n+                              name="form.button.MoveConditionDown"\n+                              type="submit"\n+                              value="&darr;"\n+                              tal:attributes="\n+                                disabled python:condition[\'last\'] and \'disabled\' or None;\n+                              "\n+                      >&darr;</button>\n+                    </div>\n+                  </div>\n+                  <p class="card-text"\n+                     tal:content="condition/summary"\n+                  >\n                                         Something happened\n-                                    </p>\n-                                </div>\n-                            </div>\n-                        </form>\n+                  </p>\n+                </div>\n+              </div>\n+            </form>\n \n-                        <form class="mb-3"\n-                            tal:attributes="action string:${view/base_url}/+condition"\n-                            method="get"\n-                            id="add-condition">\n-                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                            <div class="input-group">\n+            <form class="mb-3"\n+                  id="add-condition"\n+                  method="get"\n+                  tal:attributes="\n+                    action string:${view/base_url}/+condition;\n+                  "\n+            >\n+              <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+              <div class="input-group">\n \n-                                <span class="input-group-text" i18n:translate="contentrules_condition"\n-                                    for="contentrules-add-condition">\n+                <span class="input-group-text"\n+                      for="contentrules-add-condition"\n+                      i18n:translate="contentrules_condition"\n+                >\n                                     Condition:\n-                                </span>\n+                </span>\n \n-                                <select name=":action"\n-                                    size="1"\n-                                    id="contentrules-add-condition"\n-                                    class="form-select"\n-                                    aria-label="Add condition"\n-                                    i18n:attributes="aria-label contentrules_add_condition">\n-                                    <tal:block repeat="condition view/addable_conditions">\n-                                        <option tal:attributes="value condition/addview"\n-                                            i18n:translate=""\n-                                            tal:content="condition/title" />\n-                                    </tal:block>\n-                                </select>\n-                                <button class="context allowMultiSubmit btn btn-success"\n-                                    type="submit"\n-                                    name="form.button.AddCondition"\n-                                    value="Add"\n-                                    i18n:attributes="value label_add;"\n-                                    i18n:translate="label_add">Add</button>\n-                            </div>\n-                            &nbsp; <!-- For Safari -->\n-                        </form>\n-                    </fieldset>\n+                <select class="form-select"\n+                        id="contentrules-add-condition"\n+                        aria-label="Add condition"\n+                        name=":action"\n+                        size="1"\n+                        i18n:attributes="aria-label contentrules_add_condition"\n+                >\n+                  <tal:block repeat="condition view/addable_conditions">\n+                    <option tal:content="condition/title"\n+                            tal:attributes="\n+                              value condition/addview;\n+                            "\n+                            i18n:translate=""\n+                    ></option>\n+                  </tal:block>\n+                </select>\n+                <button class="context allowMultiSubmit btn btn-success"\n+                        name="form.button.AddCondition"\n+                        type="submit"\n+                        value="Add"\n+                        i18n:attributes="value label_add;"\n+                        i18n:translate="label_add"\n+                >Add</button>\n+              </div>\n+                            &nbsp;\n+              <!-- For Safari -->\n+            </form>\n+          </fieldset>\n \n-                    <fieldset id="configure-actions" class="col"\n-                        tal:define="actions view/actions">\n-                        <legend i18n:translate="contentrules_perform_actions" class="float-none">\n+          <fieldset class="col"\n+                    id="configure-actions"\n+                    tal:define="\n+                      actions view/actions;\n+                    "\n+          >\n+            <legend class="float-none"\n+                    i18n:translate="contentrules_perform_actions"\n+            >\n                             Perform the following actions:\n-                        </legend>\n+            </legend>\n \n-                        <div tal:condition="not:actions"\n-                            class="alert alert-warning">\n-                            <strong i18n:translate="">Warning</strong>\n-                            <span i18n:translate="">\n+            <div class="alert alert-warning"\n+                 tal:condition="not:actions"\n+            >\n+              <strong i18n:translate="">Warning</strong>\n+              <span i18n:translate="">\n                                 There is not any action performed by this rule.\n                                 Click on Add button to setup an action.\n-                            </span>\n-                        </div>\n-                        <form class="mb-3"\n-                            tal:attributes="action view/view_url"\n-                            method="post"\n-                            tal:define="auth_token context/@@authenticator/token"\n-                            tal:repeat="action actions">\n-                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                            <a tal:attributes="name string:action++${action/idx}"></a>\n-                            <input type="hidden"\n-                                name="element_id:int"\n-                                tal:attributes="value action/idx" />\n+              </span>\n+            </div>\n+            <form class="mb-3"\n+                  method="post"\n+                  tal:define="\n+                    auth_token context/@@authenticator/token;\n+                  "\n+                  tal:repeat="action actions"\n+                  tal:attributes="\n+                    action view/view_url;\n+                  "\n+            >\n+              <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+              <a tal:attributes="\n+                   name string:action++${action/idx};\n+                 "></a>\n+              <input name="element_id:int"\n+                     type="hidden"\n+                     tal:attributes="\n+                       value action/idx;\n+                     "\n+              />\n \n-                            <div class="card">\n-                                <div class="card-body row">\n-                                    <div class="col">\n-                                        <h5 class="card-title"\n-                                        tal:content="action/title"\n-                                        i18n:translate="">Move to folder</h5>\n-                                    </div>\n-                                    <div class="col-auto">\n-                                        <div class="rule-operations">\n-                                            <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}"\n-                                                class="pat-plone-modal btn btn-sm btn-primary"\n-                                                tal:condition="action/editview"\n-                                                i18n:translate="label_edit">Edit</a>\n-                                            <button type="submit"\n-                                                name="form.button.DeleteAction"\n-                                                value="Remove"\n-                                                class="context btn btn-sm btn-danger"\n-                                                i18n:attributes="value label_remove;"\n-                                                i18n:translate="label_remove">Remove</button>\n-                                            <button tal:attributes="disabled python:action[\'first\'] and \'disabled\' or None"\n-                                                type="submit"\n-                                                name="form.button.MoveActionUp"\n-                                                value="&uarr;"\n-                                                class="context btn btn-sm btn-primary">&uarr;</button>\n-                                            <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n-                                                type="submit"\n-                                                name="form.button.MoveActionDown"\n-                                                value="&darr;"\n-                                                class="context btn btn-sm btn-primary">&darr;</button>\n-                                        </div>\n-                                    </div>\n-                                    <p class="card-text" tal:content="action/summary">\n+              <div class="card">\n+                <div class="card-body row">\n+                  <div class="col">\n+                    <h5 class="card-title"\n+                        tal:content="action/title"\n+                        i18n:translate=""\n+                    >Move to folder</h5>\n+                  </div>\n+                  <div class="col-auto">\n+                    <div class="rule-operations">\n+                      <a class="pat-plone-modal btn btn-sm btn-primary"\n+                         tal:condition="action/editview"\n+                         tal:attributes="\n+                           href string:${action/editview}?_authenticator=${auth_token};\n+                         "\n+                         i18n:translate="label_edit"\n+                      >Edit</a>\n+                      <button class="context btn btn-sm btn-danger"\n+                              name="form.button.DeleteAction"\n+                              type="submit"\n+                              value="Remove"\n+                              i18n:attributes="value label_remove;"\n+                              i18n:translate="label_remove"\n+                      >Remove</button>\n+                      <button class="context btn btn-sm btn-primary"\n+                              name="form.button.MoveActionUp"\n+                              type="submit"\n+                              value="&uarr;"\n+                              tal:attributes="\n+                                disabled python:action[\'first\'] and \'disabled\' or None;\n+                              "\n+                      >&uarr;</button>\n+                      <button class="context btn btn-sm btn-primary"\n+                              name="form.button.MoveActionDown"\n+                              type="submit"\n+                              value="&darr;"\n+                              tal:attributes="\n+                                disabled python:action[\'last\'] and \'disabled\' or None;\n+                              "\n+                      >&darr;</button>\n+                    </div>\n+                  </div>\n+                  <p class="card-text"\n+                     tal:content="action/summary"\n+                  >\n                                         Something happened\n-                                    </p>\n-                                </div>\n-                            </div>\n+                  </p>\n+                </div>\n+              </div>\n \n \n-                        </form>\n+            </form>\n \n-                        <form class="mb-3"\n-                            tal:attributes="action string:${view/base_url}/+action"\n-                            method="get"\n-                            id="add-action">\n-                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                            <div class="input-group">\n+            <form class="mb-3"\n+                  id="add-action"\n+                  method="get"\n+                  tal:attributes="\n+                    action string:${view/base_url}/+action;\n+                  "\n+            >\n+              <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+              <div class="input-group">\n \n-                                <span class="input-group-text"\n-                                    i18n:translate="contentrules_action"\n-                                    for="contentrules-add-action">Action:</span>\n+                <span class="input-group-text"\n+                      for="contentrules-add-action"\n+                      i18n:translate="contentrules_action"\n+                >Action:</span>\n \n-                                <select name=":action"\n-                                    size="1"\n-                                    id="contentrules-add-action"\n-                                    class="form-select"\n-                                    aria-label="Add action"\n-                                    i18n:attributes="aria-label contentrules_add_action">\n-                                    <tal:block repeat="action view/addable_actions">\n-                                        <option tal:attributes="value action/addview"\n-                                            i18n:translate=""\n-                                            tal:content="action/title"></option>\n-                                    </tal:block>\n-                                </select>\n-                                <button class="context allowMultiSubmit btn btn-success"\n-                                    type="submit"\n-                                    name="form.button.AddAction"\n-                                    value="Add"\n-                                    i18n:attributes="value label_add;"\n-                                    i18n:translate="label_add">Add</button>\n-                            </div>\n-                            &nbsp; <!-- For Safari -->\n-                        </form>\n-                    </fieldset>\n-                </div>\n+                <select class="form-select"\n+                        id="contentrules-add-action"\n+                        aria-label="Add action"\n+                        name=":action"\n+                        size="1"\n+                        i18n:attributes="aria-label contentrules_add_action"\n+                >\n+                  <tal:block repeat="action view/addable_actions">\n+                    <option tal:content="action/title"\n+                            tal:attributes="\n+                              value action/addview;\n+                            "\n+                            i18n:translate=""\n+                    ></option>\n+                  </tal:block>\n+                </select>\n+                <button class="context allowMultiSubmit btn btn-success"\n+                        name="form.button.AddAction"\n+                        type="submit"\n+                        value="Add"\n+                        i18n:attributes="value label_add;"\n+                        i18n:translate="label_add"\n+                >Add</button>\n+              </div>\n+                            &nbsp;\n+              <!-- For Safari -->\n+            </form>\n+          </fieldset>\n+        </div>\n \n \n \n-                <tal:assignments define="assignments view/assignments">\n+        <tal:assignments define="\n+                           assignments view/assignments;\n+                         ">\n \n-                    <fieldset id="manage-assignments" class="col">\n-                        <legend i18n:translate="label_contentrules_rule_assignments" class="float-none">Assignments</legend>\n+          <fieldset class="col"\n+                    id="manage-assignments"\n+          >\n+            <legend class="float-none"\n+                    i18n:translate="label_contentrules_rule_assignments"\n+            >Assignments</legend>\n \n \n-                        <tal:noassignments condition="not:assignments">\n-                            <div class="alert alert-info">\n-                                <strong i18n:translate="">This rule is not assigned to any location</strong>\n-                                <tal:enabled condition="view/rule_enabled">\n-                                    <div i18n:translate="">\n+            <tal:noassignments condition="not:assignments">\n+              <div class="alert alert-info">\n+                <strong i18n:translate="">This rule is not assigned to any location</strong>\n+                <tal:enabled condition="view/rule_enabled">\n+                  <div i18n:translate="">\n                                         The rule is enabled but will perform nothing since it is not assigned anywhere.\n-                                    </div>\n-                                </tal:enabled>\n-                            </div>\n+                  </div>\n+                </tal:enabled>\n+              </div>\n \n-                                <tal:enabled condition="view/rule_enabled">\n-                                    <p i18n:translate="">\n+              <tal:enabled condition="view/rule_enabled">\n+                <p i18n:translate="">\n                                         Go to the folder where you want the rule to apply, or at the site root,\n                                         click on \'rule\' tab, and then locally setup the rules.\n-                                    </p>\n+                </p>\n \n-                                    <form class="mb-3"\n-                                        tal:attributes="action view/view_url"\n-                                        method="post">\n-                                        <span tal:replace="structure context/@@authenticator/authenticator" />\n-                                        <input type="submit"\n-                                            class="btn btn-primary"\n-                                            value="Apply rule on the whole site"\n-                                            name="form.button.ApplyOnWholeSite"\n-                                            i18n:attributes="value" />\n-                                    </form>\n-                                </tal:enabled>\n-                        </tal:noassignments>\n-                        <tal:assignments condition="nocall:assignments">\n-                            <div class="card">\n-                                <div class="card-header">\n-                                    <span i18n:translate="description_contentrules_rule_assignments">\n+                <form class="mb-3"\n+                      method="post"\n+                      tal:attributes="\n+                        action view/view_url;\n+                      "\n+                >\n+                  <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                  <input class="btn btn-primary"\n+                         name="form.button.ApplyOnWholeSite"\n+                         type="submit"\n+                         value="Apply rule on the whole site"\n+                         i18n:attributes="value"\n+                  />\n+                </form>\n+              </tal:enabled>\n+            </tal:noassignments>\n+            <tal:assignments condition="nocall:assignments">\n+              <div class="card">\n+                <div class="card-header">\n+                  <span i18n:translate="description_contentrules_rule_assignments">\n                                         This rule is assigned to the following locations:\n-                                    </span>\n-                                </div>\n-                                <ul class="list-group list-group-flush">\n-                                <tal:items repeat="assignment assignments">\n-                                    <li class="list-group-item">\n-                                        <a tal:attributes="href string:${assignment/url}/@@manage-content-rules">\n-                                            <tal:icon tal:replace="structure python:icons.tag(assignment[\'icon\'])" /><span class="ms-2" tal:content="assignment/title">title</span>\n-                                        </a>&nbsp;\n-                                    </li>\n-                                </tal:items>\n-                                </ul>\n-                            </div>\n-                        </tal:assignments>\n-                    </fieldset>\n+                  </span>\n+                </div>\n+                <ul class="list-group list-group-flush">\n+                  <tal:items repeat="assignment assignments">\n+                    <li class="list-group-item">\n+                      <a tal:attributes="\n+                           href string:${assignment/url}/@@manage-content-rules;\n+                         ">\n+                        <tal:icon tal:replace="structure python:icons.tag(assignment[\'icon\'])" /><span class="ms-2"\n+                              tal:content="assignment/title"\n+                        >title</span>\n+                      </a>&nbsp;\n+                    </li>\n+                  </tal:items>\n+                </ul>\n+              </div>\n+            </tal:assignments>\n+          </fieldset>\n \n-                </tal:assignments>\n+        </tal:assignments>\n \n-            </div>\n-        </metal:main>\n-    </body>\n+      </div>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/contentrules/conditions/configure.zcml b/plone/app/contentrules/conditions/configure.zcml\nindex a56032f..8622bec 100644\n--- a/plone/app/contentrules/conditions/configure.zcml\n+++ b/plone/app/contentrules/conditions/configure.zcml\n@@ -2,220 +2,224 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <!-- needed since Plone 4.1 to use cmf permissions in ZCML declaration. -->\n+  <!-- needed since Plone 4.1 to use cmf permissions in ZCML declaration. -->\n \n-    <include package="Products.CMFCore" file="permissions.zcml"\n-             xmlns:zcml="http://namespaces.zope.org/zcml"\n-             zcml:condition="have plone-41" />\n+  <include\n+      xmlns:zcml="http://namespaces.zope.org/zcml"\n+      package="Products.CMFCore"\n+      file="permissions.zcml"\n+      zcml:condition="have plone-41"\n+      />\n \n-    <!-- Portal type condition -->\n+  <!-- Portal type condition -->\n \n-    <adapter factory=".portaltype.PortalTypeConditionExecutor" />\n+  <adapter factory=".portaltype.PortalTypeConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.PortalType"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".portaltype.PortalTypeAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.portaltype.IPortalTypeCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.portaltype.IPortalTypeCondition"\n       class=".portaltype.PortalTypeEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.PortalType"\n-        title="Content type"\n-        description="Apply only when the current content object is of a particular type"\n-        for="*"\n-        event="zope.interface.interfaces.IObjectEvent"\n-        addview="plone.conditions.PortalType"\n-        editview="edit"\n-        schema=".portaltype.IPortalTypeCondition"\n-        factory=".portaltype.PortalTypeCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.PortalType"\n+      title="Content type"\n+      description="Apply only when the current content object is of a particular type"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".portaltype.IPortalTypeCondition"\n+      factory=".portaltype.PortalTypeCondition"\n+      addview="plone.conditions.PortalType"\n+      editview="edit"\n+      />\n \n-    <!-- File extension condition -->\n+  <!-- File extension condition -->\n \n-    <adapter factory=".fileextension.FileExtensionConditionExecutor" />\n+  <adapter factory=".fileextension.FileExtensionConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.FileExtension"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".fileextension.FileExtensionAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.fileextension.IFileExtensionCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.fileextension.IFileExtensionCondition"\n       class=".fileextension.FileExtensionEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.FileExtension"\n-        title="File Extension"\n-        description="Apply only to a particular file extension"\n-        for="*"\n-        event="zope.interface.interfaces.IObjectEvent"\n-        addview="plone.conditions.FileExtension"\n-        editview="edit"\n-        schema=".fileextension.IFileExtensionCondition"\n-        factory=".fileextension.FileExtensionCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.FileExtension"\n+      title="File Extension"\n+      description="Apply only to a particular file extension"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".fileextension.IFileExtensionCondition"\n+      factory=".fileextension.FileExtensionCondition"\n+      addview="plone.conditions.FileExtension"\n+      editview="edit"\n+      />\n \n-    <!-- Workflow state condition (for any object) -->\n+  <!-- Workflow state condition (for any object) -->\n \n-    <adapter factory=".wfstate.WorkflowStateConditionExecutor" />\n+  <adapter factory=".wfstate.WorkflowStateConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.WorkflowState"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".wfstate.WorkflowStateAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.wfstate.IWorkflowStateCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.wfstate.IWorkflowStateCondition"\n       class=".wfstate.WorkflowStateEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.WorkflowState"\n-        title="Workflow state"\n-        description="Apply only to a objects in a particular workflow state"\n-        for="*"\n-        event="zope.interface.interfaces.IObjectEvent"\n-        addview="plone.conditions.WorkflowState"\n-        editview="edit"\n-        schema=".wfstate.IWorkflowStateCondition"\n-        factory=".wfstate.WorkflowStateCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.WorkflowState"\n+      title="Workflow state"\n+      description="Apply only to a objects in a particular workflow state"\n+      for="*"\n+      event="zope.interface.interfaces.IObjectEvent"\n+      schema=".wfstate.IWorkflowStateCondition"\n+      factory=".wfstate.WorkflowStateCondition"\n+      addview="plone.conditions.WorkflowState"\n+      editview="edit"\n+      />\n \n-    <!-- Workflow transition condition (for any object) -->\n+  <!-- Workflow transition condition (for any object) -->\n \n-    <adapter factory=".wftransition.WorkflowTransitionConditionExecutor" />\n+  <adapter factory=".wftransition.WorkflowTransitionConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.WorkflowTransition"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".wftransition.WorkflowTransitionAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.wftransition.IWorkflowTransitionCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.wftransition.IWorkflowTransitionCondition"\n       class=".wftransition.WorkflowTransitionEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.WorkflowTransition"\n-        title="Workflow transition"\n-        description="Apply only when the executed transition was as specified"\n-        for="*"\n-        event="Products.CMFCore.interfaces.IActionSucceededEvent"\n-        addview="plone.conditions.WorkflowTransition"\n-        editview="edit"\n-        schema=".wftransition.IWorkflowTransitionCondition"\n-        factory=".wftransition.WorkflowTransitionCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.WorkflowTransition"\n+      title="Workflow transition"\n+      description="Apply only when the executed transition was as specified"\n+      for="*"\n+      event="Products.CMFCore.interfaces.IActionSucceededEvent"\n+      schema=".wftransition.IWorkflowTransitionCondition"\n+      factory=".wftransition.WorkflowTransitionCondition"\n+      addview="plone.conditions.WorkflowTransition"\n+      editview="edit"\n+      />\n \n-    <!-- Group condition -->\n-    <adapter factory=".group.GroupConditionExecutor" />\n+  <!-- Group condition -->\n+  <adapter factory=".group.GroupConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.Group"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".group.GroupAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.group.IGroupCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.group.IGroupCondition"\n       class=".group.GroupEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.Group"\n-        title="User\'s group"\n-        description="Apply only when the current user is in the given group"\n-        for="*"\n-        event="*"\n-        addview="plone.conditions.Group"\n-        editview="edit"\n-        schema=".group.IGroupCondition"\n-        factory=".group.GroupCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.Group"\n+      title="User\'s group"\n+      description="Apply only when the current user is in the given group"\n+      for="*"\n+      event="*"\n+      schema=".group.IGroupCondition"\n+      factory=".group.GroupCondition"\n+      addview="plone.conditions.Group"\n+      editview="edit"\n+      />\n \n-    <!-- Role condition -->\n-    <adapter factory=".role.RoleConditionExecutor" />\n+  <!-- Role condition -->\n+  <adapter factory=".role.RoleConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.Role"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".role.RoleAddFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <browser:page\n-      for="plone.app.contentrules.conditions.role.IRoleCondition"\n+  <browser:page\n       name="edit"\n+      for="plone.app.contentrules.conditions.role.IRoleCondition"\n       class=".role.RoleEditFormView"\n       permission="plone.app.contentrules.ManageContentRules"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.Role"\n-        title="User\'s role"\n-        description="Apply only when the current user has the given role"\n-        for="*"\n-        event="*"\n-        addview="plone.conditions.Role"\n-        editview="edit"\n-        schema=".role.IRoleCondition"\n-        factory=".role.RoleCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.Role"\n+      title="User\'s role"\n+      description="Apply only when the current user has the given role"\n+      for="*"\n+      event="*"\n+      schema=".role.IRoleCondition"\n+      factory=".role.RoleCondition"\n+      addview="plone.conditions.Role"\n+      editview="edit"\n+      />\n \n-    <!-- TALES expression condition -->\n+  <!-- TALES expression condition -->\n \n-    <adapter factory=".talesexpression.TalesExpressionConditionExecutor" />\n+  <adapter factory=".talesexpression.TalesExpressionConditionExecutor" />\n \n-    <browser:page\n-      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n+  <browser:page\n       name="plone.conditions.TalesExpression"\n+      for="plone.app.contentrules.browser.interfaces.IRuleConditionAdding"\n       class=".talesexpression.TalesExpressionAddFormView"\n       permission="cmf.ManagePortal"\n       />\n \n-    <browser:page\n-      for=".talesexpression.ITalesExpressionCondition"\n+  <browser:page\n       name="edit"\n+      for=".talesexpression.ITalesExpressionCondition"\n       class=".talesexpression.TalesExpressionEditFormView"\n       permission="cmf.ManagePortal"\n       />\n \n-    <plone:ruleCondition\n-        name="plone.conditions.TalesExpression"\n-        title="TALES expression"\n-        description="Apply only when the result of a TALES expression is True"\n-        for="*"\n-        event="*"\n-        addview="plone.conditions.TalesExpression"\n-        editview="edit"\n-        schema=".talesexpression.ITalesExpressionCondition"\n-        factory=".talesexpression.TalesExpressionCondition"\n-        />\n+  <plone:ruleCondition\n+      name="plone.conditions.TalesExpression"\n+      title="TALES expression"\n+      description="Apply only when the result of a TALES expression is True"\n+      for="*"\n+      event="*"\n+      schema=".talesexpression.ITalesExpressionCondition"\n+      factory=".talesexpression.TalesExpressionCondition"\n+      addview="plone.conditions.TalesExpression"\n+      editview="edit"\n+      />\n \n </configure>\ndiff --git a/plone/app/contentrules/configure.zcml b/plone/app/contentrules/configure.zcml\nindex eca3cbe..934e82f 100644\n--- a/plone/app/contentrules/configure.zcml\n+++ b/plone/app/contentrules/configure.zcml\n@@ -2,162 +2,161 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <include package="zope.annotation" />\n-    <include package="plone.contentrules" />\n-    <include package="plone.contentrules" file="meta.zcml" />\n-    <include package="plone.stringinterp" />\n+  <include package="zope.annotation" />\n+  <include package="plone.contentrules" />\n+  <include\n+      package="plone.contentrules"\n+      file="meta.zcml"\n+      />\n+  <include package="plone.stringinterp" />\n \n-    <!-- Create permissions -->\n+  <!-- Create permissions -->\n \n-    <permission\n-        id="plone.app.contentrules.ManageContentRules"\n-        title="Content rules: Manage rules"\n-       />\n+  <permission\n+      id="plone.app.contentrules.ManageContentRules"\n+      title="Content rules: Manage rules"\n+      />\n \n-    <include package=".browser" />\n-    <include package=".actions" />\n-    <include package=".conditions" />\n-    <include package=".exportimport" />\n+  <include package=".browser" />\n+  <include package=".actions" />\n+  <include package=".conditions" />\n+  <include package=".exportimport" />\n \n-    <!-- Make any folder and the portal root a possible container for rules -->\n+  <!-- Make any folder and the portal root a possible container for rules -->\n \n-    <class class="Products.CMFPlone.Portal.PloneSite">\n-        <implements interface="plone.contentrules.engine.interfaces.IRuleAssignable" />\n-    </class>\n+  <class class="Products.CMFPlone.Portal.PloneSite">\n+    <implements interface="plone.contentrules.engine.interfaces.IRuleAssignable" />\n+  </class>\n \n-    <!-- Let rules be annotatable - used to keep track of rule-to-assignment mappings -->\n+  <!-- Let rules be annotatable - used to keep track of rule-to-assignment mappings -->\n \n-    <class class="plone.app.contentrules.rule.Rule">\n-        <implements interface="zope.annotation.interfaces.IAttributeAnnotatable" />\n-    </class>\n+  <class class="plone.app.contentrules.rule.Rule">\n+    <implements interface="zope.annotation.interfaces.IAttributeAnnotatable" />\n+  </class>\n \n-    <!-- Make the object related events selectable -->\n+  <!-- Make the object related events selectable -->\n \n-    <interface\n+  <interface\n       interface="zope.lifecycleevent.interfaces.IObjectAddedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="Object added to this container"\n       />\n \n-    <interface\n+  <interface\n       interface="zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="Object removed from this container"\n       />\n \n-    <interface\n+  <interface\n       interface="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="Object modified"\n       />\n \n-    <interface\n+  <interface\n       interface="zope.lifecycleevent.interfaces.IObjectCopiedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="Object copied"\n       />\n \n-    <interface\n+  <interface\n       interface="Products.CMFCore.interfaces.IActionSucceededEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="Workflow state changed"\n       />\n \n-    <interface\n+  <interface\n       interface="Products.PluggableAuthService.interfaces.events.IUserLoggedInEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="User Logged in"\n       />\n \n-    <interface\n+  <interface\n       interface="Products.PluggableAuthService.interfaces.events.IUserLoggedOutEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="User Logged out"\n       />\n \n-    <interface\n+  <interface\n       interface="Products.PluggableAuthService.interfaces.events.IPrincipalCreatedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="User Created"\n       />\n \n-    <interface\n+  <interface\n       interface="Products.PluggableAuthService.interfaces.events.IPrincipalDeletedEvent"\n       type="plone.contentrules.rule.interfaces.IRuleEventType"\n       name="User Removed"\n       />\n \n-   <!-- Register handlers -->\n+  <!-- Register handlers -->\n \n-    <!-- Rule triggers -->\n-    <subscriber\n+  <!-- Rule triggers -->\n+  <subscriber\n       for="zope.lifecycleevent.interfaces.IObjectAddedEvent"\n       handler=".handlers.added"\n       />\n-    <subscriber\n-      zcml:condition="installed Products.Archetypes"\n-      for="Products.Archetypes.interfaces.IObjectInitializedEvent"\n-      handler=".handlers.archetypes_initialized"\n-      />\n-    <subscriber\n+  <subscriber\n       for="zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n       handler=".handlers.removed"\n       />\n-    <subscriber\n+  <subscriber\n       for="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n       handler=".handlers.modified"\n       />\n-     <subscriber\n+  <subscriber\n       for="zope.lifecycleevent.interfaces.IObjectCopiedEvent"\n       handler=".handlers.copied"\n       />\n-    <subscriber\n+  <subscriber\n       for="Products.CMFCore.interfaces.IActionSucceededEvent"\n       handler=".handlers.workflow_action"\n       />\n-    <subscriber\n+  <subscriber\n       for="Products.PluggableAuthService.interfaces.events.IUserLoggedInEvent"\n       handler=".handlers.user_logged_in"\n-    />\n-    <subscriber\n+      />\n+  <subscriber\n       for="Products.PluggableAuthService.interfaces.events.IUserLoggedOutEvent"\n       handler=".handlers.user_logged_out"\n-    />\n-    <subscriber\n+      />\n+  <subscriber\n       for="Products.PluggableAuthService.interfaces.events.IPrincipalCreatedEvent"\n       handler=".handlers.user_created"\n-    />\n-    <!-- Cleanup -->\n-    <subscriber\n-       for="zope.publisher.interfaces.IEndRequestEvent"\n-       handler=".handlers.close"\n-       />\n-\n-    <!-- Rule-to-assignment mappings -->\n-    <subscriber\n-        for="plone.contentrules.engine.interfaces.IRuleAssignable\n-             zope.lifecycleevent.interfaces.IObjectMovedEvent"\n-        handler=".rule.container_moved"\n-        />\n-    <subscriber\n-        for="plone.contentrules.engine.interfaces.IRuleAssignable\n-             zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n-        handler=".rule.container_removed"\n-        />\n-    <subscriber\n-        for="plone.contentrules.rule.interfaces.IRule\n-             zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n-        handler=".rule.rule_removed"\n-        />\n-\n-    <!-- Register a name chooser explicitly -->\n-\n-    <adapter\n+      />\n+  <!-- Cleanup -->\n+  <subscriber\n+      for="zope.publisher.interfaces.IEndRequestEvent"\n+      handler=".handlers.close"\n+      />\n+\n+  <!-- Rule-to-assignment mappings -->\n+  <subscriber\n+      for="plone.contentrules.engine.interfaces.IRuleAssignable\n+           zope.lifecycleevent.interfaces.IObjectMovedEvent"\n+      handler=".rule.container_moved"\n+      />\n+  <subscriber\n+      for="plone.contentrules.engine.interfaces.IRuleAssignable\n+           zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n+      handler=".rule.container_removed"\n+      />\n+  <subscriber\n+      for="plone.contentrules.rule.interfaces.IRule\n+           zope.lifecycleevent.interfaces.IObjectRemovedEvent"\n+      handler=".rule.rule_removed"\n+      />\n+\n+  <!-- Register a name chooser explicitly -->\n+\n+  <adapter\n+      factory=".namechooser.RuleNameChooser"\n       provides="zope.container.interfaces.INameChooser"\n       for="plone.contentrules.engine.interfaces.IRuleStorage"\n-      factory=".namechooser.RuleNameChooser"\n       />\n \n </configure>\ndiff --git a/plone/app/contentrules/exportimport/configure.zcml b/plone/app/contentrules/exportimport/configure.zcml\nindex 729381e..2419b22 100644\n--- a/plone/app/contentrules/exportimport/configure.zcml\n+++ b/plone/app/contentrules/exportimport/configure.zcml\n@@ -1,33 +1,33 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <adapter\n-        factory=".rules.RulesXMLAdapter"\n-        name="plone.contentrules"\n-        />\n+  <adapter\n+      factory=".rules.RulesXMLAdapter"\n+      name="plone.contentrules"\n+      />\n \n-    <adapter\n-        factory=".rules.PropertyRuleElementExportImportHandler"\n-        />\n+  <adapter factory=".rules.PropertyRuleElementExportImportHandler" />\n \n-    <!-- Register import and export steps -->\n-    <genericsetup:importStep\n-        name="contentrules"\n-        title="Content rules"\n-        description="Import content rule definitions and assignments"\n-        handler=".rules.importRules">\n-        <depends name="componentregistry"/>\n-        <depends name="content"/>\n-        <depends name="workflow"/>\n-    </genericsetup:importStep>\n+  <!-- Register import and export steps -->\n+  <genericsetup:importStep\n+      name="contentrules"\n+      title="Content rules"\n+      description="Import content rule definitions and assignments"\n+      handler=".rules.importRules"\n+      >\n+    <depends name="componentregistry" />\n+    <depends name="content" />\n+    <depends name="workflow" />\n+  </genericsetup:importStep>\n \n-    <genericsetup:exportStep\n-        name="contentrules"\n-        title="Content rules"\n-        description="Export content rule definitions and assignments"\n-        handler=".rules.exportRules"\n-        />\n+  <genericsetup:exportStep\n+      name="contentrules"\n+      title="Content rules"\n+      description="Export content rule definitions and assignments"\n+      handler=".rules.exportRules"\n+      />\n \n </configure>\ndiff --git a/plone/app/contentrules/exportimport/rules.py b/plone/app/contentrules/exportimport/rules.py\nindex c34ac83..d62a22c 100644\n--- a/plone/app/contentrules/exportimport/rules.py\n+++ b/plone/app/contentrules/exportimport/rules.py\n@@ -28,9 +28,7 @@\n from zope.container.interfaces import INameChooser\n from zope.interface import implementer\n from zope.interface import Interface\n-from zope.schema.interfaces import ICollection\n from zope.schema.interfaces import IField\n-from zope.schema.interfaces import IFromUnicode\n \n \n def as_bool(string, default=False):\n@@ -50,7 +48,6 @@ def __init__(self, element):\n         self.descriptor = getUtility(IRuleElement, name=data.element)\n \n     def import_element(self, node):\n-\n         if self.descriptor.schema is None:\n             return\n \n@@ -152,7 +149,6 @@ def _initRules(self, node):\n \n         for child in node.childNodes:\n             if child.nodeName == "rule":\n-\n                 rule = None\n                 name = child.getAttribute("name")\n                 if name:\n@@ -305,7 +301,7 @@ def _extractRules(self):\n             fragment.appendChild(rule_node)\n             assignment_paths.update(get_assignments(rule))\n         # Export assignments last - this is necessary to ensure they\n-        # are orderd properly\n+        # are ordered properly\n \n         site_path_length = len("/".join(site.getPhysicalPath()))\n         for path in sorted(assignment_paths):\ndiff --git a/plone/app/contentrules/handlers.py b/plone/app/contentrules/handlers.py\nindex b9b62ec..f93fa94 100644\n--- a/plone/app/contentrules/handlers.py\n+++ b/plone/app/contentrules/handlers.py\n@@ -102,7 +102,6 @@ def execute(context, event):\n \n     # Prepare to break hard if a rule demanded execution be stopped\n     try:\n-\n         # Try to execute rules in the context. It may not work if the context\n         # is not a rule executor, but we may still want to bubble events\n         executor = IRuleExecutor(context, None)\ndiff --git a/plone/app/contentrules/rule.py b/plone/app/contentrules/rule.py\nindex a7a652b..1b1a3c5 100644\n--- a/plone/app/contentrules/rule.py\n+++ b/plone/app/contentrules/rule.py\n@@ -14,7 +14,7 @@\n \n \n class Rule(SimpleItem, BaseRule):\n-    """A Zope 2 version of a rule, subject to acqusition, but otherwise\n+    """A Zope 2 version of a rule, subject to acquisition, but otherwise\n     identical.\n     """\n \n@@ -40,7 +40,6 @@ def insert_assignment(rule, path):\n \n # Events that keep track of rule-to-assignment mappings\n def rule_removed(rule, event):\n-\n     storage = queryUtility(IRuleStorage)\n     rule_name = rule.__name__\n \n@@ -57,7 +56,6 @@ def rule_removed(rule, event):\n \n \n def container_moved(container, event):\n-\n     if event.oldParent is None or event.newParent is None or event.oldName is None:\n         return\n \n@@ -87,7 +85,6 @@ def container_moved(container, event):\n \n \n def container_removed(container, event):\n-\n     assignable = IRuleAssignmentManager(container, None)\n     storage = queryUtility(IRuleStorage)\n \ndiff --git a/plone/app/contentrules/testing.py b/plone/app/contentrules/testing.py\nindex 1839443..8cadf08 100644\n--- a/plone/app/contentrules/testing.py\n+++ b/plone/app/contentrules/testing.py\n@@ -8,7 +8,6 @@\n \n \n class PloneAppContentrulesLayer(PloneSandboxLayer):\n-\n     defaultBases = (PLONE_APP_CONTENTTYPES_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\ndiff --git a/plone/app/contentrules/tests/profiles/testing/contentrules.xml b/plone/app/contentrules/tests/profiles/testing/contentrules.xml\nindex 9446c81..ae7c2a8 100644\n--- a/plone/app/contentrules/tests/profiles/testing/contentrules.xml\n+++ b/plone/app/contentrules/tests/profiles/testing/contentrules.xml\n@@ -1,137 +1,132 @@\n <?xml version="1.0" encoding="utf-8"?>\n <contentrules>\n \n-    <rule\n+  <rule description="A test rule"\n+        enabled="True"\n+        event="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n         name="test1"\n+        stop-after="False"\n         title="Test rule 1"\n-        description="A test rule"\n-        event="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n-        enabled="True"\n-        stop-after="False">\n-        <conditions>\n-            <condition type="plone.conditions.PortalType">\n-                <property name="check_types">\n-                    <element>Document</element>\n-                    <element>News Item</element>\n-                </property>\n-            </condition>\n-            <condition type="plone.conditions.Role">\n-                <property name="role_names">\n-                    <element>Manager</element>\n-                </property>\n-            </condition>\n-        </conditions>\n-        <actions>\n-            <action type="plone.actions.Notify">\n-                <property name="message">A message: Hej d\xc3\xa5</property>\n-                <property name="message_type">info</property>\n-            </action>\n-        </actions>\n-    </rule>\n+  >\n+    <conditions>\n+      <condition type="plone.conditions.PortalType">\n+        <property name="check_types">\n+          <element>Document</element>\n+          <element>News Item</element>\n+        </property>\n+      </condition>\n+      <condition type="plone.conditions.Role">\n+        <property name="role_names">\n+          <element>Manager</element>\n+        </property>\n+      </condition>\n+    </conditions>\n+    <actions>\n+      <action type="plone.actions.Notify">\n+        <property name="message">A message: Hej d\xc3\xa5</property>\n+        <property name="message_type">info</property>\n+      </action>\n+    </actions>\n+  </rule>\n \n-    <rule\n+  <rule description="Another test rule"\n+        enabled="False"\n+        event="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n         name="test2"\n+        stop-after="True"\n         title="Test rule 2"\n-        description="Another test rule"\n-        event="zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n-        enabled="False"\n-        stop-after="True">\n-        <conditions>\n-            <condition type="plone.conditions.PortalType">\n-                <property name="check_types">\n-                    <element>Event</element>\n-                </property>\n-            </condition>\n-        </conditions>\n-        <actions>\n-            <action type="plone.actions.Workflow">\n-                <property name="transition">publish</property>\n-            </action>\n-        </actions>\n-    </rule>\n+  >\n+    <conditions>\n+      <condition type="plone.conditions.PortalType">\n+        <property name="check_types">\n+          <element>Event</element>\n+        </property>\n+      </condition>\n+    </conditions>\n+    <actions>\n+      <action type="plone.actions.Workflow">\n+        <property name="transition">publish</property>\n+      </action>\n+    </actions>\n+  </rule>\n \n-    <rule\n+  <rule description="Third test rule"\n+        event="zope.lifecycleevent.interfaces.IObjectMovedEvent"\n         name="test3"\n         title="Test rule 3"\n-        description="Third test rule"\n-        event="zope.lifecycleevent.interfaces.IObjectMovedEvent"\n-        />\n+  />\n \n-    <rule\n+  <rule description="We move published events in a folder"\n+        enabled="True"\n+        event="Products.CMFCore.interfaces.IActionSucceededEvent"\n         name="test4"\n+        stop-after="True"\n         title="Test rule 4"\n-        description="We move published events in a folder"\n-        event="Products.CMFCore.interfaces.IActionSucceededEvent"\n-        enabled="True"\n-        stop-after="True">\n-        <conditions>\n-            <condition type="plone.conditions.PortalType">\n-                <property name="check_types">\n-                    <element>Event</element>\n-                </property>\n-            </condition>\n-            <condition type="plone.conditions.WorkflowTransition">\n-                <property name="wf_transitions">\n-                    <element>publish</element>\n-                </property>\n-            </condition>\n-        </conditions>\n-        <actions>\n-            <action type="plone.actions.Move">\n-                <property name="target_folder">/events</property>\n-            </action>\n-        </actions>\n-    </rule>\n+  >\n+    <conditions>\n+      <condition type="plone.conditions.PortalType">\n+        <property name="check_types">\n+          <element>Event</element>\n+        </property>\n+      </condition>\n+      <condition type="plone.conditions.WorkflowTransition">\n+        <property name="wf_transitions">\n+          <element>publish</element>\n+        </property>\n+      </condition>\n+    </conditions>\n+    <actions>\n+      <action type="plone.actions.Move">\n+        <property name="target_folder">/events</property>\n+      </action>\n+    </actions>\n+  </rule>\n \n-    <rule\n-        name="test5"\n-        title="Test rule 5"\n+  <rule cascading="True"\n         description="Auto publish events"\n-        event="zope.lifecycleevent.interfaces.IObjectAddedEvent"\n         enabled="True"\n-        cascading="True" stop-after="False">\n-        <conditions>\n-            <condition type="plone.conditions.PortalType">\n-                <property name="check_types">\n-                    <element>Event</element>\n-                </property>\n-            </condition>\n-        </conditions>\n-        <actions>\n-            <action type="plone.actions.Workflow">\n-                <property name="transition">publish</property>\n-            </action>\n-        </actions>\n-    </rule>\n-\n-    <assignment\n-        location="/news"\n-        name="test1"\n-        enabled="True"\n-        bubbles="False"\n-        />\n-    <assignment\n-        location="/news"\n-        name="test2"\n-        enabled="False"\n-        bubbles="True"\n-        insert-before="test1"\n-        />\n-    <assignment\n-        location="/news"\n-        name="test3"\n-        insert-before="*"\n-        />\n-    <assignment\n-        location="/"\n-        name="test4"\n-        insert-before="*"\n-        enabled="False"\n-        />\n-    <assignment\n-        location="/"\n+        event="zope.lifecycleevent.interfaces.IObjectAddedEvent"\n         name="test5"\n-        enabled="False"\n-        />\n+        stop-after="False"\n+        title="Test rule 5"\n+  >\n+    <conditions>\n+      <condition type="plone.conditions.PortalType">\n+        <property name="check_types">\n+          <element>Event</element>\n+        </property>\n+      </condition>\n+    </conditions>\n+    <actions>\n+      <action type="plone.actions.Workflow">\n+        <property name="transition">publish</property>\n+      </action>\n+    </actions>\n+  </rule>\n+\n+  <assignment bubbles="False"\n+              enabled="True"\n+              location="/news"\n+              name="test1"\n+  />\n+  <assignment bubbles="True"\n+              enabled="False"\n+              insert-before="test1"\n+              location="/news"\n+              name="test2"\n+  />\n+  <assignment insert-before="*"\n+              location="/news"\n+              name="test3"\n+  />\n+  <assignment enabled="False"\n+              insert-before="*"\n+              location="/"\n+              name="test4"\n+  />\n+  <assignment enabled="False"\n+              location="/"\n+              name="test5"\n+  />\n \n </contentrules>\ndiff --git a/plone/app/contentrules/tests/profiles/testing/export_steps.xml b/plone/app/contentrules/tests/profiles/testing/export_steps.xml\nindex a4a9cde..b3bd0b4 100644\n--- a/plone/app/contentrules/tests/profiles/testing/export_steps.xml\n+++ b/plone/app/contentrules/tests/profiles/testing/export_steps.xml\n@@ -1,8 +1,9 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <export-steps>\n- <export-step id="contentrules"\n-              handler="plone.app.contentrules.exportimport.rules.exportRules"\n-              title="Content rules">\n+  <export-step id="contentrules"\n+               handler="plone.app.contentrules.exportimport.rules.exportRules"\n+               title="Content rules"\n+  >\n     Export content rules\n  </export-step>\n </export-steps>\ndiff --git a/plone/app/contentrules/tests/profiles/testing/import_steps.xml b/plone/app/contentrules/tests/profiles/testing/import_steps.xml\nindex c73d85b..9de5d35 100644\n--- a/plone/app/contentrules/tests/profiles/testing/import_steps.xml\n+++ b/plone/app/contentrules/tests/profiles/testing/import_steps.xml\n@@ -1,9 +1,11 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <import-steps>\n- <import-step id="contentrules" version="20081221-01"\n+  <import-step id="contentrules"\n                handler="plone.app.contentrules.exportimport.rules.importRules"\n-               title="Content rules">\n-    <dependency step="componentregistry"/>\n+               title="Content rules"\n+               version="20081221-01"\n+  >\n+    <dependency step="componentregistry" />\n     Import content rules\n- </import-step>\n+  </import-step>\n </import-steps>\ndiff --git a/plone/app/contentrules/tests/test_action_delete.py b/plone/app/contentrules/tests/test_action_delete.py\nindex b4275ad..d1b5d5c 100644\n--- a/plone/app/contentrules/tests/test_action_delete.py\n+++ b/plone/app/contentrules/tests/test_action_delete.py\n@@ -1,10 +1,6 @@\n from plone.app.contentrules.actions.delete import DeleteAction\n from plone.app.contentrules.rule import Rule\n from plone.app.contentrules.tests.base import ContentRulesTestCase\n-from plone.app.testing import login\n-from plone.app.testing import setRoles\n-from plone.app.testing import TEST_USER_ID\n-from plone.app.testing import TEST_USER_NAME\n from plone.contentrules.engine.interfaces import IRuleStorage\n from plone.contentrules.rule.interfaces import IExecutable\n from plone.contentrules.rule.interfaces import IRuleAction\ndiff --git a/plone/app/contentrules/tests/test_action_logger.py b/plone/app/contentrules/tests/test_action_logger.py\nindex 7de104d..80fa32a 100644\n--- a/plone/app/contentrules/tests/test_action_logger.py\n+++ b/plone/app/contentrules/tests/test_action_logger.py\n@@ -2,7 +2,6 @@\n from plone.app.contentrules.actions.logger import LoggerEditFormView\n from plone.app.contentrules.rule import Rule\n from plone.app.contentrules.tests.base import ContentRulesTestCase\n-from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n from plone.contentrules.engine.interfaces import IRuleStorage\n from plone.contentrules.rule.interfaces import IExecutable\ndiff --git a/plone/app/contentrules/tests/test_action_mail.py b/plone/app/contentrules/tests/test_action_mail.py\nindex f42ec2f..0d737cc 100644\n--- a/plone/app/contentrules/tests/test_action_mail.py\n+++ b/plone/app/contentrules/tests/test_action_mail.py\n@@ -1,4 +1,3 @@\n-from Acquisition import aq_base\n from email import message_from_bytes\n from plone.app.contentrules.actions.mail import MailAction\n from plone.app.contentrules.actions.mail import MailAddFormView\n@@ -12,9 +11,7 @@\n from plone.contentrules.rule.interfaces import IExecutable\n from plone.contentrules.rule.interfaces import IRuleAction\n from plone.registry.interfaces import IRegistry\n-from Products.MailHost.interfaces import IMailHost\n from zope.component import getMultiAdapter\n-from zope.component import getSiteManager\n from zope.component import getUtility\n from zope.interface import implementer\n from zope.interface.interfaces import IObjectEvent\ndiff --git a/plone/app/contentrules/tests/test_cascading_rule.py b/plone/app/contentrules/tests/test_cascading_rule.py\nindex efeac84..07e7475 100644\n--- a/plone/app/contentrules/tests/test_cascading_rule.py\n+++ b/plone/app/contentrules/tests/test_cascading_rule.py\n@@ -11,7 +11,6 @@\n \n \n class TestCascadingRule(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTRULES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contentrules/tests/test_configuration.py b/plone/app/contentrules/tests/test_configuration.py\nindex 5e0d50b..c695be1 100644\n--- a/plone/app/contentrules/tests/test_configuration.py\n+++ b/plone/app/contentrules/tests/test_configuration.py\n@@ -19,7 +19,6 @@\n \n \n class TestGenericSetup(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTRULES_FUNCTIONAL_TESTING\n \n     def setUp(self):\n@@ -93,7 +92,7 @@ def testImportTwice(self):\n         # Ensure rules, actions/conditions and assignments are not duplicated\n         # if the profile is re-imported; see bug #8027.\n         portal_setup = self.portal.portal_setup\n-        time.sleep(1)  # avoid timestamp colission\n+        time.sleep(1)  # avoid timestamp collision\n         portal_setup.runAllImportStepsFromProfile(\n             "profile-plone.app.contentrules:testing"\n         )\ndiff --git a/plone/app/contentrules/tests/test_rule_assignment_mapping.py b/plone/app/contentrules/tests/test_rule_assignment_mapping.py\nindex 4b62a7c..b5fa04e 100644\n--- a/plone/app/contentrules/tests/test_rule_assignment_mapping.py\n+++ b/plone/app/contentrules/tests/test_rule_assignment_mapping.py\n@@ -5,7 +5,6 @@\n from plone.app.contentrules.testing import (  # noqa: E501\n     PLONE_APP_CONTENTRULES_FUNCTIONAL_TESTING,\n )\n-from plone.app.contentrules.tests.base import ContentRulesTestCase\n from plone.app.testing import login\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n@@ -20,7 +19,6 @@\n \n \n class TestRuleAssignmentMapping(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTRULES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contentrules/tests/test_rule_management_views.py b/plone/app/contentrules/tests/test_rule_management_views.py\nindex f96137f..3f1592f 100644\n--- a/plone/app/contentrules/tests/test_rule_management_views.py\n+++ b/plone/app/contentrules/tests/test_rule_management_views.py\n@@ -10,7 +10,6 @@\n \n \n class DummyModifiedRule(Rule):\n-\n     title = "My test rule"\n     description = "Test my rule"\n     event = IObjectModifiedEvent\ndiff --git a/plone/app/contentrules/tests/testing.zcml b/plone/app/contentrules/tests/testing.zcml\nindex 80dcd4d..a3667e7 100644\n--- a/plone/app/contentrules/tests/testing.zcml\n+++ b/plone/app/contentrules/tests/testing.zcml\n@@ -1,15 +1,17 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:gs="http://namespaces.zope.org/genericsetup"\n-           package="plone.app.contentrules"\n-           i18n_domain="plone">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:gs="http://namespaces.zope.org/genericsetup"\n+    package="plone.app.contentrules"\n+    i18n_domain="plone"\n+    >\n \n-    <gs:registerProfile\n-        name="testing"\n-        title="plone.app.contentrules testing"\n-        description="Used for testing only"\n-        directory="tests/profiles/testing"\n-        for="Products.CMFCore.interfaces.ISiteRoot"\n-        provides="Products.GenericSetup.interfaces.EXTENSION"\n-        />\n+  <gs:registerProfile\n+      name="testing"\n+      title="plone.app.contentrules testing"\n+      description="Used for testing only"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      directory="tests/profiles/testing"\n+      />\n \n </configure>\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615d..9eb73f3 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,43 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 6064072..0da8f8f 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,13 +1,23 @@\n-[check-manifest]\n-ignore =\n-    *.cfg\n-\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n \n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/setup.py b/setup.py\nindex 08fbc9e..0972dd3 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -34,34 +34,39 @@\n     include_package_data=True,\n     zip_safe=False,\n     python_requires=">=3.8",\n-    extras_require={"test": ["plone.app.testing", "plone.app.contenttypes[test]"]},\n+    extras_require={\n+        "test": [\n+            "plone.app.testing",\n+            "plone.app.contenttypes[test]",\n+            "plone.dexterity",\n+            "plone.testing",\n+        ]\n+    },\n     install_requires=[\n+        "BTrees",\n+        "Products.MailHost",\n+        "Products.PluggableAuthService",\n+        "lxml",\n+        "plone.app.contenttypes",\n+        "plone.app.discussion",\n+        "plone.app.uuid",\n+        "plone.registry",\n+        "plone.supermodel",\n+        "plone.z3cform",\n+        "z3c.form",\n         "setuptools",\n+        "plone.base",\n         "plone.contentrules",\n         "plone.memoize",\n         "plone.stringinterp",\n         "plone.uuid",\n         "plone.autoform",\n-        "plone.app.z3cform",\n         "plone.app.vocabularies",\n-        "transaction",\n         "zope.annotation",\n         "zope.browser",\n-        "zope.component",\n-        "zope.container",\n-        "zope.event",\n-        "zope.i18nmessageid",\n-        "zope.interface",\n-        "zope.lifecycleevent",\n-        "zope.publisher >= 3.11.0",\n-        "zope.schema",\n-        "zope.site",\n-        "zope.traversing",\n-        "Acquisition",\n-        "Products.CMFCore",\n+        "Products.CMFPlone",\n         "Products.GenericSetup >= 2.0",\n         "Products.statusmessages",\n-        "ZODB",\n         "Zope",\n     ],\n )\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 0000000..358665e\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,53 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --test-path={toxinidir} -s plone.app.contentrules\n+extras =\n+    test\n'

