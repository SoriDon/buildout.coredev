Repository: plone.formwidget.recurrence


Branch: refs/heads/master
Date: 2016-01-28T18:39:08+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.formwidget.recurrence/commit/6e0c655cc9d7a79038734d2641a488ef10e2ef44

Restructure tests: Move example type into own submodule.

Files changed:
A plone/formwidget/recurrence/tests/at_example/__init__.py
A plone/formwidget/recurrence/tests/at_example/configure.zcml
A plone/formwidget/recurrence/tests/at_example/content.py
A plone/formwidget/recurrence/tests/at_example/profiles/sample_types/archetype_tool.xml
A plone/formwidget/recurrence/tests/at_example/profiles/sample_types/metadata.xml
A plone/formwidget/recurrence/tests/at_example/profiles/sample_types/types.xml
A plone/formwidget/recurrence/tests/at_example/profiles/sample_types/types/RecurrenceType.xml
M CHANGES.rst
M plone/formwidget/recurrence/tests/__init__.py
M plone/formwidget/recurrence/tests/base.py
D plone/formwidget/recurrence/tests/configure.zcml
D plone/formwidget/recurrence/tests/examples/RecurrenceType.py
D plone/formwidget/recurrence/tests/examples/__init__.py
D plone/formwidget/recurrence/tests/profiles/sample_types/archetype_tool.xml
D plone/formwidget/recurrence/tests/profiles/sample_types/metadata.xml
D plone/formwidget/recurrence/tests/profiles/sample_types/types.xml
D plone/formwidget/recurrence/tests/profiles/sample_types/types/RecurrenceType.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index cd3f482..62e0464 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Restructure tests: Move example type into own submodule.
+  [thet]
 
 
 2.0.2 (2015-12-03)
diff --git a/plone/formwidget/recurrence/tests/__init__.py b/plone/formwidget/recurrence/tests/__init__.py
index 98042c0..e69de29 100644
--- a/plone/formwidget/recurrence/tests/__init__.py
+++ b/plone/formwidget/recurrence/tests/__init__.py
@@ -1,21 +0,0 @@
-from Products.Archetypes import atapi
-
-packageName = __name__
-
-def initialize(context):
-    """Register content types through Archetypes with Zope and the CMF.
-    """
-    from Products.CMFCore.utils import ContentInit
-    from Products.CMFCore.permissions import AddPortalContent
-    from plone.formwidget.recurrence.tests import examples
-
-    content_types, constructors, ftis = atapi.process_types(
-        atapi.listTypes(packageName), packageName)
-
-    for atype, constructor, fti in zip(content_types, constructors, ftis):
-        ContentInit("%s: %s" % (packageName, atype.portal_type),
-            content_types      = (atype,),
-            permission         = AddPortalContent,
-            extra_constructors = (constructor,),
-            fti = (fti,),
-            ).initialize(context)
diff --git a/plone/formwidget/recurrence/tests/at_example/__init__.py b/plone/formwidget/recurrence/tests/at_example/__init__.py
new file mode 100644
index 0000000..e798aea
--- /dev/null
+++ b/plone/formwidget/recurrence/tests/at_example/__init__.py
@@ -0,0 +1,23 @@
+from Products.Archetypes import atapi
+
+packageName = __name__
+
+
+def initialize(context):
+    """Register content types through Archetypes with Zope and the CMF.
+    """
+    from Products.CMFCore.utils import ContentInit
+    from Products.CMFCore.permissions import AddPortalContent
+    from plone.formwidget.recurrence.tests.at_example import content  # noqa
+
+    content_types, constructors, ftis = atapi.process_types(
+        atapi.listTypes(packageName), packageName)
+
+    for atype, constructor, fti in zip(content_types, constructors, ftis):
+        ContentInit(
+            "%s: %s" % (packageName, atype.portal_type),
+            content_types=(atype,),
+            permission = AddPortalContent,
+            extra_constructors = (constructor,),
+            fti = (fti,),
+        ).initialize(context)
diff --git a/plone/formwidget/recurrence/tests/at_example/configure.zcml b/plone/formwidget/recurrence/tests/at_example/configure.zcml
new file mode 100644
index 0000000..006c3e7
--- /dev/null
+++ b/plone/formwidget/recurrence/tests/at_example/configure.zcml
@@ -0,0 +1,16 @@
+<configure
+    xmlns="http://namespaces.zope.org/zope"
+    xmlns:five="http://namespaces.zope.org/five"
+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"
+    i18n_domain="plone">
+
+  <five:registerPackage package="." initialize=".initialize" />
+  <genericsetup:registerProfile
+      name="sample_types"
+      title="Example content type for Recurrence Widget"
+      directory="profiles/sample_types"
+      description='Extension profile for the plone.formwidget.recurrence package.'
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
+</configure>
diff --git a/plone/formwidget/recurrence/tests/at_example/content.py b/plone/formwidget/recurrence/tests/at_example/content.py
new file mode 100644
index 0000000..9f12a1a
--- /dev/null
+++ b/plone/formwidget/recurrence/tests/at_example/content.py
@@ -0,0 +1,31 @@
+from Products.Archetypes.atapi import BaseSchema
+from Products.Archetypes.atapi import LinesField
+from Products.Archetypes.atapi import Schema
+from Products.Archetypes.atapi import registerType
+from Products.Archetypes.examples.SimpleType import SimpleType
+from plone.formwidget.recurrence.at.widget import RecurrenceWidget
+
+
+schema = BaseSchema.copy() + Schema((
+    LinesField(
+        'rec',
+        widget=RecurrenceWidget(
+            label='Recurrence',
+            startField='test_start_field',
+            startYear='test_start_year',
+            startMonth='test_start_month',
+            startDay='test_start_day',
+            first_day=4,
+        ),
+    ),
+))
+
+
+class RecurrenceType(SimpleType):
+    """A simple archetype"""
+    schema = schema
+    archetype_name = meta_type = "RecurrenceType"
+    portal_type = 'RecurrenceType'
+
+
+registerType(RecurrenceType, 'plone.formwidget.recurrence.tests.at_example')
diff --git a/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/archetype_tool.xml b/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/archetype_tool.xml
new file mode 100644
index 0000000..623d1ee
--- /dev/null
+++ b/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/archetype_tool.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0"?>
+<archetypetool>
+ <catalogmap>
+  <type portal_type="RecurrenceType">
+   <catalog value="portal_catalog"/>
+  </type>
+ </catalogmap>
+</archetypetool>
diff --git a/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/metadata.xml b/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/metadata.xml
new file mode 100644
index 0000000..cf4492a
--- /dev/null
+++ b/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/metadata.xml
@@ -0,0 +1,4 @@
+<?xml version="1.0"?>
+<metadata>
+  <version>1</version>
+</metadata>
diff --git a/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/types.xml b/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/types.xml
new file mode 100644
index 0000000..7845b26
--- /dev/null
+++ b/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/types.xml
@@ -0,0 +1,4 @@
+<?xml version="1.0"?>
+<object name="portal_types" meta_type="Plone Types Tool">
+ <object name="RecurrenceType" meta_type="Factory-based Type Information"/>
+</object>
diff --git a/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/types/RecurrenceType.xml b/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/types/RecurrenceType.xml
new file mode 100644
index 0000000..db35b69
--- /dev/null
+++ b/plone/formwidget/recurrence/tests/at_example/profiles/sample_types/types/RecurrenceType.xml
@@ -0,0 +1,36 @@
+<?xml version="1.0"?>
+<object name="RecurrenceType" meta_type="Factory-based Type Information"
+   xmlns:i18n="http://xml.zope.org/namespaces/i18n">
+ <property name="title">Recurrence Type</property>
+ <property name="description">A simple archetype with a recurrence field</property>
+ <property name="content_icon">document_icon.gif</property>
+ <property name="content_meta_type">RecurrenceType</property>
+ <property name="product">plone.formwidget.recurrence.tests.at_example</property>
+ <property name="factory">addRecurrenceType</property>
+ <property name="immediate_view">base_edit</property>
+ <property name="global_allow">True</property>
+ <property name="filter_content_types">False</property>
+ <property name="allowed_content_types"/>
+ <property name="allow_discussion">False</property>
+ <alias from="(Default)" to="base_view"/>
+ <alias from="edit" to="base_edit"/>
+ <action title="View" action_id="view" category="object" condition_expr=""
+    url_expr="string:${object_url}/base_view" visible="True">
+  <permission value="View"/>
+ </action>
+ <action title="Edit" action_id="edit" category="object" condition_expr=""
+    url_expr="string:${object_url}/base_edit" visible="True">
+  <permission value="Modify portal content"/>
+ </action>
+ <action title="Properties" action_id="metadata" category="object"
+    condition_expr="" url_expr="string:${object_url}/base_metadata"
+    visible="True">
+  <permission value="Modify portal content"/>
+ </action>
+ <action title="References" action_id="references" category="object"
+    condition_expr="object/archetype_tool/has_graphviz"
+    url_expr="string:${object_url}/reference_graph" visible="True">
+  <permission value="Modify portal content"/>
+  <permission value="Review portal content"/>
+ </action>
+</object>
diff --git a/plone/formwidget/recurrence/tests/base.py b/plone/formwidget/recurrence/tests/base.py
index 79a5216..7185684 100644
--- a/plone/formwidget/recurrence/tests/base.py
+++ b/plone/formwidget/recurrence/tests/base.py
@@ -5,18 +5,12 @@
 from plone.app.testing import PLONE_FIXTURE
 from plone.app.testing import PloneSandboxLayer
 from plone.testing import z2
-from zope.interface import Interface
-
 import unittest
 
 
 PLONE5 = getFSVersionTuple()[0] >= 5
 
 
-class DemoProfile(Interface):
-    """Marker interface for our demo GS profile."""
-
-
 class PloneFormwidgetRecurrenceLayer(PloneSandboxLayer):
 
     defaultBases = (PLONE_FIXTURE,)
@@ -27,9 +21,9 @@ def setUpZope(self, app, configurationContext):
         import plone.formwidget.recurrence
         self.loadZCML(package=plone.formwidget.recurrence)
 
-        import plone.formwidget.recurrence.tests  # install AT example types
-        self.loadZCML(package=plone.formwidget.recurrence.tests)
-        z2.installProduct(app, 'plone.formwidget.recurrence.tests')
+        import plone.formwidget.recurrence.tests.at_example  # install AT example types  # noqa
+        self.loadZCML(package=plone.formwidget.recurrence.tests.at_example)
+        z2.installProduct(app, 'plone.formwidget.recurrence.tests.at_example')
 
         z2.installProduct(app, 'Products.ATContentTypes')
 
@@ -42,14 +36,14 @@ def setUpPloneSite(self, portal):
         # install at example types
         self.applyProfile(
             portal,
-            'plone.formwidget.recurrence.tests:sample_types'
+            'plone.formwidget.recurrence.tests.at_example:sample_types'
         )
 
         self.applyProfile(portal, 'plone.formwidget.recurrence:default')
 
     def tearDownZope(self, app):
         """Tear down Zope."""
-        z2.uninstallProduct(app, 'plone.formwidget.recurrence.tests')
+        z2.uninstallProduct(app, 'plone.formwidget.recurrence.tests.at_example')  # noqa
 
 
 FIXTURE = PloneFormwidgetRecurrenceLayer()
diff --git a/plone/formwidget/recurrence/tests/configure.zcml b/plone/formwidget/recurrence/tests/configure.zcml
deleted file mode 100644
index ba54ace..0000000
--- a/plone/formwidget/recurrence/tests/configure.zcml
+++ /dev/null
@@ -1,18 +0,0 @@
-<configure
-    xmlns="http://namespaces.zope.org/zope"
-    xmlns:five="http://namespaces.zope.org/five"
-    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"
-    i18n_domain="plone">
-
-  <five:registerPackage package="." initialize=".initialize" />
-
-  <genericsetup:registerProfile
-      name="sample_types"
-      title="Example content type for Recurrence Widget"
-      directory="profiles/sample_types"
-      description='Extension profile for the plone.formwidget.recurrence package.'
-      provides="Products.GenericSetup.interfaces.EXTENSION"
-      for=".base.DemoProfile"
-      />
-
-</configure>
diff --git a/plone/formwidget/recurrence/tests/examples/RecurrenceType.py b/plone/formwidget/recurrence/tests/examples/RecurrenceType.py
deleted file mode 100644
index 34dfe2f..0000000
--- a/plone/formwidget/recurrence/tests/examples/RecurrenceType.py
+++ /dev/null
@@ -1,31 +0,0 @@
-from Products.Archetypes.atapi import BaseSchema
-from Products.Archetypes.atapi import LinesField
-from Products.Archetypes.atapi import Schema
-from Products.Archetypes.atapi import registerType
-from Products.Archetypes.examples.SimpleType import SimpleType
-from plone.formwidget.recurrence.at.widget import RecurrenceWidget
-
-
-schema = BaseSchema.copy() + Schema((
-    LinesField(
-        'rec',
-        widget=RecurrenceWidget(
-            label='Recurrence',
-            startField='test_start_field',
-            startYear='test_start_year',
-            startMonth='test_start_month',
-            startDay='test_start_day',
-            first_day=4,
-        ),
-    ),
-))
-
-
-class RecurrenceType(SimpleType):
-    """A simple archetype"""
-    schema = schema
-    archetype_name = meta_type = "RecurrenceType"
-    portal_type = 'RecurrenceType'
-
-
-registerType(RecurrenceType, 'plone.formwidget.recurrence.tests')
diff --git a/plone/formwidget/recurrence/tests/examples/__init__.py b/plone/formwidget/recurrence/tests/examples/__init__.py
deleted file mode 100644
index b2d7403..0000000
--- a/plone/formwidget/recurrence/tests/examples/__init__.py
+++ /dev/null
@@ -1 +0,0 @@
-import RecurrenceType
diff --git a/plone/formwidget/recurrence/tests/profiles/sample_types/archetype_tool.xml b/plone/formwidget/recurrence/tests/profiles/sample_types/archetype_tool.xml
deleted file mode 100644
index 623d1ee..0000000
--- a/plone/formwidget/recurrence/tests/profiles/sample_types/archetype_tool.xml
+++ /dev/null
@@ -1,8 +0,0 @@
-<?xml version="1.0"?>
-<archetypetool>
- <catalogmap>
-  <type portal_type="RecurrenceType">
-   <catalog value="portal_catalog"/>
-  </type>
- </catalogmap>
-</archetypetool>
diff --git a/plone/formwidget/recurrence/tests/profiles/sample_types/metadata.xml b/plone/formwidget/recurrence/tests/profiles/sample_types/metadata.xml
deleted file mode 100644
index cf4492a..0000000
--- a/plone/formwidget/recurrence/tests/profiles/sample_types/metadata.xml
+++ /dev/null
@@ -1,4 +0,0 @@
-<?xml version="1.0"?>
-<metadata>
-  <version>1</version>
-</metadata>
diff --git a/plone/formwidget/recurrence/tests/profiles/sample_types/types.xml b/plone/formwidget/recurrence/tests/profiles/sample_types/types.xml
deleted file mode 100644
index 7845b26..0000000
--- a/plone/formwidget/recurrence/tests/profiles/sample_types/types.xml
+++ /dev/null
@@ -1,4 +0,0 @@
-<?xml version="1.0"?>
-<object name="portal_types" meta_type="Plone Types Tool">
- <object name="RecurrenceType" meta_type="Factory-based Type Information"/>
-</object>
diff --git a/plone/formwidget/recurrence/tests/profiles/sample_types/types/RecurrenceType.xml b/plone/formwidget/recurrence/tests/profiles/sample_types/types/RecurrenceType.xml
deleted file mode 100644
index 2ab32d8..0000000
--- a/plone/formwidget/recurrence/tests/profiles/sample_types/types/RecurrenceType.xml
+++ /dev/null
@@ -1,36 +0,0 @@
-<?xml version="1.0"?>
-<object name="RecurrenceType" meta_type="Factory-based Type Information"
-   xmlns:i18n="http://xml.zope.org/namespaces/i18n">
- <property name="title">Recurrence Type</property>
- <property name="description">A simple archetype with a recurrence field</property>
- <property name="content_icon">document_icon.gif</property>
- <property name="content_meta_type">RecurrenceType</property>
- <property name="product">plone.formwidget.recurrence.tests</property>
- <property name="factory">addRecurrenceType</property>
- <property name="immediate_view">base_edit</property>
- <property name="global_allow">True</property>
- <property name="filter_content_types">False</property>
- <property name="allowed_content_types"/>
- <property name="allow_discussion">False</property>
- <alias from="(Default)" to="base_view"/>
- <alias from="edit" to="base_edit"/>
- <action title="View" action_id="view" category="object" condition_expr=""
-    url_expr="string:${object_url}/base_view" visible="True">
-  <permission value="View"/>
- </action>
- <action title="Edit" action_id="edit" category="object" condition_expr=""
-    url_expr="string:${object_url}/base_edit" visible="True">
-  <permission value="Modify portal content"/>
- </action>
- <action title="Properties" action_id="metadata" category="object"
-    condition_expr="" url_expr="string:${object_url}/base_metadata"
-    visible="True">
-  <permission value="Modify portal content"/>
- </action>
- <action title="References" action_id="references" category="object"
-    condition_expr="object/archetype_tool/has_graphviz"
-    url_expr="string:${object_url}/reference_graph" visible="True">
-  <permission value="Modify portal content"/>
-  <permission value="Review portal content"/>
- </action>
-</object>


