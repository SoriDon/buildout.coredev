Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-03T18:00:03-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.portlets/commit/7c3e497beb72cac49fc56337250f157146f57e96

Avoid acquisition breaking the Review list portlet. fixes gh-171

Files changed:
A news/171.bugfix
M plone/app/portlets/portlets/review.py

b'diff --git a/news/171.bugfix b/news/171.bugfix\nnew file mode 100644\nindex 00000000..7c596f76\n--- /dev/null\n+++ b/news/171.bugfix\n@@ -0,0 +1,2 @@\n+Avoid acquisition breaking the Review list portlet.\n+[frapell]\ndiff --git a/plone/app/portlets/portlets/review.py b/plone/app/portlets/portlets/review.py\nindex cba8d97f..1c00c23c 100644\n--- a/plone/app/portlets/portlets/review.py\n+++ b/plone/app/portlets/portlets/review.py\n@@ -1,6 +1,7 @@\n from .. import PloneMessageFactory as _\n from ..browser import formhelper\n from ..portlets import base\n+from Acquisition import aq_base\n from Acquisition import aq_inner\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.memoize.instance import memoize\n@@ -118,7 +119,7 @@ def _data(self):\n                 creator_name = creator.getProperty("fullname", "") or creator_id\n             else:\n                 creator_name = creator_id\n-            hasImage = True if getattr(obj, "image", None) else False\n+            hasImage = True if getattr(aq_base(obj), "image", None) else False\n             images = obj.restrictedTraverse("@@images") if hasImage else None\n             items.append(\n                 dict(\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-06T10:05:44-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.portlets/commit/c70daa91e65c31556f12e2dd817cef7dd37e605f

Merge pull request #172 from plone/frapell-issue-171

Avoid acquisition breaking the Review list portlet. fixes gh-171

Files changed:
A news/171.bugfix
M plone/app/portlets/portlets/review.py

b'diff --git a/news/171.bugfix b/news/171.bugfix\nnew file mode 100644\nindex 00000000..7c596f76\n--- /dev/null\n+++ b/news/171.bugfix\n@@ -0,0 +1,2 @@\n+Avoid acquisition breaking the Review list portlet.\n+[frapell]\ndiff --git a/plone/app/portlets/portlets/review.py b/plone/app/portlets/portlets/review.py\nindex cba8d97f..1c00c23c 100644\n--- a/plone/app/portlets/portlets/review.py\n+++ b/plone/app/portlets/portlets/review.py\n@@ -1,6 +1,7 @@\n from .. import PloneMessageFactory as _\n from ..browser import formhelper\n from ..portlets import base\n+from Acquisition import aq_base\n from Acquisition import aq_inner\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.memoize.instance import memoize\n@@ -118,7 +119,7 @@ def _data(self):\n                 creator_name = creator.getProperty("fullname", "") or creator_id\n             else:\n                 creator_name = creator_id\n-            hasImage = True if getattr(obj, "image", None) else False\n+            hasImage = True if getattr(aq_base(obj), "image", None) else False\n             images = obj.restrictedTraverse("@@images") if hasImage else None\n             items.append(\n                 dict(\n'

