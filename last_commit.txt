Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-01-05T10:51:35+01:00
Author: Albert Ormazabal Blanc (aormazabal) <aormazabal@tda.ad>
Commit: https://github.com/plone/Products.CMFPlone/commit/78be06f7b5a1eef31aa7d52600a8bb48a6e0250c

add **{'data-bundle': name} attribute in PloneStyleResource and PloneScriptResource declarations

Files changed:
M Products/CMFPlone/resources/browser/resource.py

b'diff --git a/Products/CMFPlone/resources/browser/resource.py b/Products/CMFPlone/resources/browser/resource.py\nindex 9c4735cab1..c07f71f20a 100644\n--- a/Products/CMFPlone/resources/browser/resource.py\n+++ b/Products/CMFPlone/resources/browser/resource.py\n@@ -187,6 +187,7 @@ def check_dependencies(bundle_name, depends, bundles):\n                     async_=record.load_async or None,\n                     defer=record.load_defer or None,\n                     integrity=not external,\n+                    **{\'data-bundle\': name},\n                 )\n             if record.csscompilation:\n                 depends = check_dependencies(name, record.depends, css_names)\n@@ -206,6 +207,7 @@ def check_dependencies(bundle_name, depends, bundles):\n                     url=record.csscompilation if external else None,\n                     media="all",\n                     rel="stylesheet",\n+                    **{\'data-bundle\': name},\n                 )\n \n         # Collect theme data\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-01-05T10:53:52+01:00
Author: Albert Ormazabal Blanc (aormazabal) <aormazabal@tda.ad>
Commit: https://github.com/plone/Products.CMFPlone/commit/fd4c12c3e85335550a8990cf05198628b85d9c13

Upgrade webresource version to 1.2. This version admits additional attrs in web resources

Files changed:
M setup.py

b"diff --git a/setup.py b/setup.py\nindex 1689e18523..3349dd119f 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -107,7 +107,7 @@\n         'Products.statusmessages',\n         'setuptools>=36.2',\n         'plone.autoinclude',\n-        'webresource>=1.1',\n+        'webresource>=1.2',\n         'Zope[wsgi] >= 5.0',\n         'zope.app.locales >= 3.6.0',\n         'zope.cachedescriptors',\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-01-05T11:17:09+01:00
Author: Albert Ormazabal Blanc (aormazabal) <aormazabal@tda.ad>
Commit: https://github.com/plone/Products.CMFPlone/commit/d56f1140d8aa114a9e36e7070509b36803c2b9f3

docs

Files changed:
A news/3707.feature

b'diff --git a/news/3707.feature b/news/3707.feature\nnew file mode 100644\nindex 0000000000..39b41e832f\n--- /dev/null\n+++ b/news/3707.feature\n@@ -0,0 +1 @@\n+Add data-bundle attributes on javascript and styles resources.  [aormazabal]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-01-10T19:13:51+01:00
Author: Albert Ormazabal Blanc (aormazabal) <aormazabal@tda.ad>
Commit: https://github.com/plone/Products.CMFPlone/commit/c67de9dc1eb71fb632e2dcb6770cfad7470520f0

add some tests to check data-bundle attribute on Styles and Javascript resources

Files changed:
M Products/CMFPlone/tests/testResourceRegistries.py

b'diff --git a/Products/CMFPlone/tests/testResourceRegistries.py b/Products/CMFPlone/tests/testResourceRegistries.py\nindex ca3a8dd0ee..211bce6912 100644\n--- a/Products/CMFPlone/tests/testResourceRegistries.py\n+++ b/Products/CMFPlone/tests/testResourceRegistries.py\n@@ -82,6 +82,13 @@ def test_scripts_viewlet(self):\n         self.assertIn("++plone++static/bundle-plone/bundle.min.js", results)\n         self.assertIn("http://nohost/plone/++webresource++", results)\n \n+    def test_scripts_data_bundle_attr(self):\n+        scripts = ScriptsView(self.layer["portal"], self.layer["request"], None)\n+        self._make_test_bundle()\n+        scripts.update()\n+        result = scripts.render()\n+        self.assertIn(\'data-bundle="foobar"\', result)\n+\n     def test_scripts_viewlet_anonymous(self):\n         logout()\n         scripts = ScriptsView(self.layer["portal"], self.layer["request"], None)\n@@ -188,6 +195,25 @@ def test_styles_viewlet(self):\n         self.assertIn("++theme++barceloneta/css/barceloneta.min.css", results)\n         self.assertIn("http://nohost/plone/++webresource++", results)\n \n+    def test_styles_data_bundle_attr(self):\n+        styles = StylesView(self.layer["portal"], self.layer["request"], None)\n+\n+        # add some bundle to test with\n+        registry = getUtility(IRegistry)\n+\n+        bundles = registry.collectionOfInterface(\n+            IBundleRegistry, prefix="plone.bundles"\n+        )\n+        bundle = bundles.add("foobar")\n+        bundle.name = "foobar"\n+        bundle.jscompilation = "http://foo.bar/foobar.js"\n+        bundle.csscompilation = "http://foo.bar/foobar.css"\n+        bundle.resources = ["foobar"]\n+\n+        styles.update()\n+        results = styles.render()\n+        self.assertIn(\'data-bundle="foobar"\', results)\n+\n     def test_styles_viewlet_anonymous(self):\n         logout()\n         styles = StylesView(self.layer["portal"], self.layer["request"], None)\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-01-11T17:01:44+01:00
Author: Albert (aormazabal) <aormazabal@tda.ad>
Commit: https://github.com/plone/Products.CMFPlone/commit/545c25758eb438738f1465cd193fc8b386ef45d1

Merge pull request #3708 from plone/webresource_databundle_attr

Add data-bundle attributes on javascript and styles resources

Files changed:
A news/3707.feature
M Products/CMFPlone/resources/browser/resource.py
M Products/CMFPlone/tests/testResourceRegistries.py
M setup.py

b'diff --git a/Products/CMFPlone/resources/browser/resource.py b/Products/CMFPlone/resources/browser/resource.py\nindex 9c4735cab1..c07f71f20a 100644\n--- a/Products/CMFPlone/resources/browser/resource.py\n+++ b/Products/CMFPlone/resources/browser/resource.py\n@@ -187,6 +187,7 @@ def check_dependencies(bundle_name, depends, bundles):\n                     async_=record.load_async or None,\n                     defer=record.load_defer or None,\n                     integrity=not external,\n+                    **{\'data-bundle\': name},\n                 )\n             if record.csscompilation:\n                 depends = check_dependencies(name, record.depends, css_names)\n@@ -206,6 +207,7 @@ def check_dependencies(bundle_name, depends, bundles):\n                     url=record.csscompilation if external else None,\n                     media="all",\n                     rel="stylesheet",\n+                    **{\'data-bundle\': name},\n                 )\n \n         # Collect theme data\ndiff --git a/Products/CMFPlone/tests/testResourceRegistries.py b/Products/CMFPlone/tests/testResourceRegistries.py\nindex ca3a8dd0ee..211bce6912 100644\n--- a/Products/CMFPlone/tests/testResourceRegistries.py\n+++ b/Products/CMFPlone/tests/testResourceRegistries.py\n@@ -82,6 +82,13 @@ def test_scripts_viewlet(self):\n         self.assertIn("++plone++static/bundle-plone/bundle.min.js", results)\n         self.assertIn("http://nohost/plone/++webresource++", results)\n \n+    def test_scripts_data_bundle_attr(self):\n+        scripts = ScriptsView(self.layer["portal"], self.layer["request"], None)\n+        self._make_test_bundle()\n+        scripts.update()\n+        result = scripts.render()\n+        self.assertIn(\'data-bundle="foobar"\', result)\n+\n     def test_scripts_viewlet_anonymous(self):\n         logout()\n         scripts = ScriptsView(self.layer["portal"], self.layer["request"], None)\n@@ -188,6 +195,25 @@ def test_styles_viewlet(self):\n         self.assertIn("++theme++barceloneta/css/barceloneta.min.css", results)\n         self.assertIn("http://nohost/plone/++webresource++", results)\n \n+    def test_styles_data_bundle_attr(self):\n+        styles = StylesView(self.layer["portal"], self.layer["request"], None)\n+\n+        # add some bundle to test with\n+        registry = getUtility(IRegistry)\n+\n+        bundles = registry.collectionOfInterface(\n+            IBundleRegistry, prefix="plone.bundles"\n+        )\n+        bundle = bundles.add("foobar")\n+        bundle.name = "foobar"\n+        bundle.jscompilation = "http://foo.bar/foobar.js"\n+        bundle.csscompilation = "http://foo.bar/foobar.css"\n+        bundle.resources = ["foobar"]\n+\n+        styles.update()\n+        results = styles.render()\n+        self.assertIn(\'data-bundle="foobar"\', results)\n+\n     def test_styles_viewlet_anonymous(self):\n         logout()\n         styles = StylesView(self.layer["portal"], self.layer["request"], None)\ndiff --git a/news/3707.feature b/news/3707.feature\nnew file mode 100644\nindex 0000000000..39b41e832f\n--- /dev/null\n+++ b/news/3707.feature\n@@ -0,0 +1 @@\n+Add data-bundle attributes on javascript and styles resources.  [aormazabal]\n\\ No newline at end of file\ndiff --git a/setup.py b/setup.py\nindex 1689e18523..3349dd119f 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -107,7 +107,7 @@\n         \'Products.statusmessages\',\n         \'setuptools>=36.2\',\n         \'plone.autoinclude\',\n-        \'webresource>=1.1\',\n+        \'webresource>=1.2\',\n         \'Zope[wsgi] >= 5.0\',\n         \'zope.app.locales >= 3.6.0\',\n         \'zope.cachedescriptors\',\n'

