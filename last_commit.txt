Repository: plone.app.layout


Branch: refs/heads/master
Date: 2017-10-04T14:47:01+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/e43b6470e1981ff172a8d66e763a39747091372d

Toolbar: Use pattern variavbles to configure the toolbar and submenu widths from plone.lessvariables.

Files changed:
M CHANGES.rst
M plone/app/layout/viewlets/toolbar.pt
M plone/app/layout/viewlets/toolbar.py

diff --git a/CHANGES.rst b/CHANGES.rst
index cc88f9b..5a91134 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Toolbar: Use pattern variavbles to configure the toolbar and submenu widths from plone.lessvariables.
+  [thet]
 
 Bug fixes:
 
diff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt
index 5e6a6c5..b0f86ae 100644
--- a/plone/app/layout/viewlets/toolbar.pt
+++ b/plone/app/layout/viewlets/toolbar.pt
@@ -3,7 +3,7 @@
                      personal_bar python: view.get_personal_bar()"
          tal:condition="context_state/is_toolbar_visible"
          i18n:domain="plone">
-  <div id="edit-zone" role="toolbar" class="pat-toolbar">
+  <div id="edit-zone" role="toolbar" class="pat-toolbar" data-pat-toolbar="${view/get_options}">
     <div class="plone-toolbar-container">
       <a class="plone-toolbar-logo">
         <img alt="Plone Toolbar" tal:attributes="src view/get_toolbar_logo" />
diff --git a/plone/app/layout/viewlets/toolbar.py b/plone/app/layout/viewlets/toolbar.py
index f2e5bcf..b9d0107 100644
--- a/plone/app/layout/viewlets/toolbar.py
+++ b/plone/app/layout/viewlets/toolbar.py
@@ -8,6 +8,8 @@
 from zope.component import getMultiAdapter
 from zope.component import getUtility
 
+import json
+
 
 class ToolbarViewletManager(OrderedViewletManager):
     custom_template = ViewPageTemplateFile('toolbar.pt')
@@ -34,6 +36,25 @@ def portal_state(self):
             name='plone_portal_state'
         )
 
+    def get_options(self):
+        registry = getUtility(IRegistry)
+        options = {}
+
+        lessvars = registry.get('plone.lessvariables', {})
+
+        toolbar_width = lessvars.get('plone-left-toolbar-expanded', None)
+        submenu_width = lessvars.get('plone-toolbar-submenu-width', None)
+        desktop_width = lessvars.get('plone-screen-sm-min', None)
+
+        if toolbar_width:
+            options['toolbar_width'] = toolbar_width
+        if submenu_width:
+            options['submenu_width'] = submenu_width
+        if desktop_width:
+            options['desktop_width'] = desktop_width
+
+        return json.dumps(options)
+
     def get_personal_bar(self):
         viewlet = PersonalBarViewlet(
             self.context,


Repository: plone.app.layout


Branch: refs/heads/master
Date: 2017-10-05T12:00:22+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/b626f2d9b9ce7245644f58f49d909589322efc5d

Merge pull request #133 from plone/thet-toolbarfix

Toolbar related fixes

Files changed:
M CHANGES.rst
M plone/app/layout/viewlets/toolbar.pt
M plone/app/layout/viewlets/toolbar.py

diff --git a/CHANGES.rst b/CHANGES.rst
index cc88f9b..5a91134 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Toolbar: Use pattern variavbles to configure the toolbar and submenu widths from plone.lessvariables.
+  [thet]
 
 Bug fixes:
 
diff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt
index 5e6a6c5..b0f86ae 100644
--- a/plone/app/layout/viewlets/toolbar.pt
+++ b/plone/app/layout/viewlets/toolbar.pt
@@ -3,7 +3,7 @@
                      personal_bar python: view.get_personal_bar()"
          tal:condition="context_state/is_toolbar_visible"
          i18n:domain="plone">
-  <div id="edit-zone" role="toolbar" class="pat-toolbar">
+  <div id="edit-zone" role="toolbar" class="pat-toolbar" data-pat-toolbar="${view/get_options}">
     <div class="plone-toolbar-container">
       <a class="plone-toolbar-logo">
         <img alt="Plone Toolbar" tal:attributes="src view/get_toolbar_logo" />
diff --git a/plone/app/layout/viewlets/toolbar.py b/plone/app/layout/viewlets/toolbar.py
index f2e5bcf..b9d0107 100644
--- a/plone/app/layout/viewlets/toolbar.py
+++ b/plone/app/layout/viewlets/toolbar.py
@@ -8,6 +8,8 @@
 from zope.component import getMultiAdapter
 from zope.component import getUtility
 
+import json
+
 
 class ToolbarViewletManager(OrderedViewletManager):
     custom_template = ViewPageTemplateFile('toolbar.pt')
@@ -34,6 +36,25 @@ def portal_state(self):
             name='plone_portal_state'
         )
 
+    def get_options(self):
+        registry = getUtility(IRegistry)
+        options = {}
+
+        lessvars = registry.get('plone.lessvariables', {})
+
+        toolbar_width = lessvars.get('plone-left-toolbar-expanded', None)
+        submenu_width = lessvars.get('plone-toolbar-submenu-width', None)
+        desktop_width = lessvars.get('plone-screen-sm-min', None)
+
+        if toolbar_width:
+            options['toolbar_width'] = toolbar_width
+        if submenu_width:
+            options['submenu_width'] = submenu_width
+        if desktop_width:
+            options['desktop_width'] = desktop_width
+
+        return json.dumps(options)
+
     def get_personal_bar(self):
         viewlet = PersonalBarViewlet(
             self.context,


