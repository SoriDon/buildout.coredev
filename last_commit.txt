Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-08-14T09:11:16+02:00
Author: Katja Suess (ksuess) <k.suess@rohberg.ch>
Commit: https://github.com/plone/Products.CMFPlone/commit/341ebc54752c226b8d646358c9a2035988913b8d

Breadcrumbs: url of subfolder of hidden folder

folder hidden by IHideFromBreadcrumbs

Files changed:
M Products/CMFPlone/browser/navigation.py
M Products/CMFPlone/tests/testNavigationView.py

b"diff --git a/Products/CMFPlone/browser/navigation.py b/Products/CMFPlone/browser/navigation.py\nindex c05a4f1cb..cef96142a 100644\n--- a/Products/CMFPlone/browser/navigation.py\n+++ b/Products/CMFPlone/browser/navigation.py\n@@ -240,8 +240,8 @@ def breadcrumbs(self):\n         if IHideFromBreadcrumbs.providedBy(context):\n             return base\n \n-        if base:\n-            item_url = '%s/%s' % (base[-1]['absolute_url'], name)\n+        # if base:\n+        #     item_url = '%s/%s' % (base[-1]['absolute_url'], name)\n \n         rootPath = getNavigationRoot(context)\n         itemPath = '/'.join(context.getPhysicalPath())\ndiff --git a/Products/CMFPlone/tests/testNavigationView.py b/Products/CMFPlone/tests/testNavigationView.py\nindex bc343ce22..62f3e4436 100644\n--- a/Products/CMFPlone/tests/testNavigationView.py\n+++ b/Products/CMFPlone/tests/testNavigationView.py\n@@ -768,9 +768,25 @@ def testBreadcrumbsFilterByInterface(self):\n         directlyProvides(self.portal.folder1, IHideFromBreadcrumbs)\n         newcrumbs = view.breadcrumbs()\n         self.assertEqual(len(crumbs) - 1, len(newcrumbs))\n-        self.assertEqual(newcrumbs[0]['absolute_url'],\n+        self.assertEqual(newcrumbs[-1]['absolute_url'],\n                          self.portal.folder1.doc11.absolute_url())\n \n+    def testBreadcrumbsFilterByInterface2(self):\n+        # Test url of subfolder of hidden folder.\n+        self.portal.folder1.invokeFactory('Folder', 'subfolder11')\n+        directlyProvides(self.portal.folder1.subfolder11, IHideFromBreadcrumbs)\n+        self.portal.folder1.subfolder11.invokeFactory('Folder', 'subfolder111')\n+        self.portal.folder1.subfolder11.subfolder111.invokeFactory(\n+            'Document', 'doc1111')\n+        doc1111 = self.portal.folder1.subfolder11.subfolder111.doc1111\n+        view = self.view_class(doc1111, self.request)\n+        newcrumbs = view.breadcrumbs()\n+        self.assertEqual(\n+            newcrumbs[-2]['absolute_url'],\n+            self.portal.folder1.subfolder11.subfolder111.absolute_url()\n+            )\n+\n+\n \n def test_suite():\n     from unittest import TestSuite, makeSuite\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-08-14T09:25:19+02:00
Author: Katja Suess (ksuess) <k.suess@rohberg.ch>
Commit: https://github.com/plone/Products.CMFPlone/commit/c3159056db3e00b2e2de806ca06d4f8af4e4a9b5

add changelog entry

Files changed:
A news/2935.bugfix

b'diff --git a/news/2935.bugfix b/news/2935.bugfix\nnew file mode 100644\nindex 000000000..4bf7d0131\n--- /dev/null\n+++ b/news/2935.bugfix\n@@ -0,0 +1 @@\n+Breadcrumbs: consider hidden folders when creating urls [ksuess]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-08-15T09:59:57+02:00
Author: Katja Suess (ksuess) <k.suess@rohberg.ch>
Commit: https://github.com/plone/Products.CMFPlone/commit/1edce815b43153e7e931d965e67d1e4a913e28b7

remove changing of url for subfolder of hidden folder

Files changed:
M Products/CMFPlone/browser/navigation.py

b"diff --git a/Products/CMFPlone/browser/navigation.py b/Products/CMFPlone/browser/navigation.py\nindex cef96142a..90b17e3ca 100644\n--- a/Products/CMFPlone/browser/navigation.py\n+++ b/Products/CMFPlone/browser/navigation.py\n@@ -240,9 +240,6 @@ def breadcrumbs(self):\n         if IHideFromBreadcrumbs.providedBy(context):\n             return base\n \n-        # if base:\n-        #     item_url = '%s/%s' % (base[-1]['absolute_url'], name)\n-\n         rootPath = getNavigationRoot(context)\n         itemPath = '/'.join(context.getPhysicalPath())\n \n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-08-16T09:49:31+02:00
Author: Katja SÃ¼ss (ksuess) <k.suess@rohberg.ch>
Commit: https://github.com/plone/Products.CMFPlone/commit/8681303364fc8dc34d42e81d93e82502ea7f903f

Merge pull request #2936 from plone/breadcrumbs-with-hidden-folder

Breadcrumbs: url of subfolder of hidden folder

Files changed:
A news/2935.bugfix
M Products/CMFPlone/browser/navigation.py
M Products/CMFPlone/tests/testNavigationView.py

b"diff --git a/Products/CMFPlone/browser/navigation.py b/Products/CMFPlone/browser/navigation.py\nindex c05a4f1cb..90b17e3ca 100644\n--- a/Products/CMFPlone/browser/navigation.py\n+++ b/Products/CMFPlone/browser/navigation.py\n@@ -240,9 +240,6 @@ def breadcrumbs(self):\n         if IHideFromBreadcrumbs.providedBy(context):\n             return base\n \n-        if base:\n-            item_url = '%s/%s' % (base[-1]['absolute_url'], name)\n-\n         rootPath = getNavigationRoot(context)\n         itemPath = '/'.join(context.getPhysicalPath())\n \ndiff --git a/Products/CMFPlone/tests/testNavigationView.py b/Products/CMFPlone/tests/testNavigationView.py\nindex bc343ce22..62f3e4436 100644\n--- a/Products/CMFPlone/tests/testNavigationView.py\n+++ b/Products/CMFPlone/tests/testNavigationView.py\n@@ -768,9 +768,25 @@ def testBreadcrumbsFilterByInterface(self):\n         directlyProvides(self.portal.folder1, IHideFromBreadcrumbs)\n         newcrumbs = view.breadcrumbs()\n         self.assertEqual(len(crumbs) - 1, len(newcrumbs))\n-        self.assertEqual(newcrumbs[0]['absolute_url'],\n+        self.assertEqual(newcrumbs[-1]['absolute_url'],\n                          self.portal.folder1.doc11.absolute_url())\n \n+    def testBreadcrumbsFilterByInterface2(self):\n+        # Test url of subfolder of hidden folder.\n+        self.portal.folder1.invokeFactory('Folder', 'subfolder11')\n+        directlyProvides(self.portal.folder1.subfolder11, IHideFromBreadcrumbs)\n+        self.portal.folder1.subfolder11.invokeFactory('Folder', 'subfolder111')\n+        self.portal.folder1.subfolder11.subfolder111.invokeFactory(\n+            'Document', 'doc1111')\n+        doc1111 = self.portal.folder1.subfolder11.subfolder111.doc1111\n+        view = self.view_class(doc1111, self.request)\n+        newcrumbs = view.breadcrumbs()\n+        self.assertEqual(\n+            newcrumbs[-2]['absolute_url'],\n+            self.portal.folder1.subfolder11.subfolder111.absolute_url()\n+            )\n+\n+\n \n def test_suite():\n     from unittest import TestSuite, makeSuite\ndiff --git a/news/2935.bugfix b/news/2935.bugfix\nnew file mode 100644\nindex 000000000..4bf7d0131\n--- /dev/null\n+++ b/news/2935.bugfix\n@@ -0,0 +1 @@\n+Breadcrumbs: consider hidden folders when creating urls [ksuess]\n"

