Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2023-02-13T14:36:43+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/3ee28f82fe053973b98f20dacc626b728eda3f48

Configuring with plone/meta

Files changed:
A .pre-commit-config.yaml
A news/7d54a267.internal
M .meta.toml
M setup.cfg
M tox.ini

b'diff --git a/.meta.toml b/.meta.toml\nindex f05ca65..ff81c0f 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -2,7 +2,7 @@\n # https://github.com/plone/meta/tree/master/config/default\n [meta]\n template = "default"\n-commit-id = "78307cdf"\n+commit-id = "5bac025e"\n \n [check-manifest]\n additional-ignores = [\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 0000000..99f9928\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,40 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/ambv/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.1\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.1"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/news/7d54a267.internal b/news/7d54a267.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/7d54a267.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/setup.cfg b/setup.cfg\nindex 31f90ee..6387117 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -22,6 +22,7 @@ ignore =\n ignore =\n     .editorconfig\n     .meta.toml\n+    .pre-commit-config.yaml\n     tox.ini\n     lint-requirements.txt\n     *.txt\ndiff --git a/tox.ini b/tox.ini\nindex c4810c9..0c9dc5e 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -6,45 +6,50 @@ envlist =\n     lint\n \n [testenv]\n-py_files = git ls-files "*.py"\n-text_files = git ls-files "*.rst" "*.md"\n allowlist_externals =\n     sh\n \n [testenv:format]\n-description = automatically reformat python code\n+description = automatically reformat code\n skip_install = true\n deps =\n-    pyupgrade\n-    isort\n-    black\n-    -c lint-requirements.txt\n+    pre-commit\n commands =\n-    sh -c \'{[testenv]py_files} | xargs pyupgrade --py38-plus\'\n-    sh -c \'{[testenv]py_files} | xargs isort\'\n-    sh -c \'{[testenv]py_files} | xargs black\'\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n \n [testenv:lint]\n description = run linters that will help improve the code style\n skip_install = true\n deps =\n-    flake8\n-    codespell\n-    tomli  # needed for codespell to read pyproject.toml\n-    check-manifest\n-    pyroma\n-    -c lint-requirements.txt\n+    pre-commit\n commands =\n-    sh -c \'{[testenv]py_files} | xargs flake8\'\n-    sh -c \'{[testenv]py_files} | xargs codespell\'\n-    sh -c \'{[testenv]text_files} | xargs codespell\'\n-    check-manifest\n-    pyroma -n 10 .\n+    pre-commit run -a\n \n [testenv:dependencies]\n description = check if the package defines all its dependencies\n deps =\n-    z3c.dependencychecker\n-    -c lint-requirements.txt\n+    z3c.dependencychecker==2.10\n commands =\n     dependencychecker\n+\n+[testenv:dependencies-graph]\n+description = generate a graph with the distribution dependencies\n+deps =\n+    pipdeptree==2.3.3\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    sh -c \'pipdeptree --exclude setuptools,pipdeptree,wheel --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+description = run the tests of the distribution\n+deps =\n+    Products.CMFPlacefulWorkflow[test]\n+    pytest\n+    gocept.pytestlayer\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    pip install -e .[test]\n+    pytest\n'

Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2023-02-13T14:36:43+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/77f6fac63b41c1bd8338e5920f91e6ed85a64db2

test extra: depend on the test extra of plone.app.contenttypes.

Otherwise we get an ImportError for plone.app.robotframework, even though we do not use it ourselves.

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex 3c24967..ae57407 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -35,7 +35,7 @@\n     python_requires=">=3.8",\n     extras_require=dict(\n         test=[\n-            "plone.app.contenttypes",\n+            "plone.app.contenttypes[test]",\n             "plone.app.testing",\n             "plone.testing",\n             "transaction",\n'

Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2023-02-13T14:36:44+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/51181357f67d69d6246961499b5cb704411c5453

formatting and linting

Files changed:
M Products/CMFPlacefulWorkflow/DefaultWorkflowPolicy.py
M Products/CMFPlacefulWorkflow/browser/placeful_workflow_configuration.pt
M Products/CMFPlacefulWorkflow/browser/placeful_workflow_policy_mapping.pt
M Products/CMFPlacefulWorkflow/browser/workflow_policies_controlpanel.pt
M Products/CMFPlacefulWorkflow/exportimport/workflow_policies.py
M Products/CMFPlacefulWorkflow/testing.py
M Products/CMFPlacefulWorkflow/tests/CMFPlacefulWorkflowTestCase.py
M Products/CMFPlacefulWorkflow/tests/exportimport.txt
M Products/CMFPlacefulWorkflow/www/add_workflow_policy.zpt
M Products/CMFPlacefulWorkflow/www/add_workflow_policy_config_form.zpt
M Products/CMFPlacefulWorkflow/www/define_local_workflow_policy.zpt
M Products/CMFPlacefulWorkflow/www/manage_workflow_policy_config.zpt

b'diff --git a/Products/CMFPlacefulWorkflow/DefaultWorkflowPolicy.py b/Products/CMFPlacefulWorkflow/DefaultWorkflowPolicy.py\nindex be399b2..0cf0bcb 100644\n--- a/Products/CMFPlacefulWorkflow/DefaultWorkflowPolicy.py\n+++ b/Products/CMFPlacefulWorkflow/DefaultWorkflowPolicy.py\n@@ -40,7 +40,6 @@\n \n @implementer(IWorkflowPolicyDefinition)\n class DefaultWorkflowPolicyDefinition(SimpleItemWithProperties):\n-\n     meta_type = "WorkflowPolicy"\n     id = "default_workflow_policy"\n     _isAWorkflowPolicy = 1\ndiff --git a/Products/CMFPlacefulWorkflow/browser/placeful_workflow_configuration.pt b/Products/CMFPlacefulWorkflow/browser/placeful_workflow_configuration.pt\nindex 1a2eb0d..b936bb8 100644\n--- a/Products/CMFPlacefulWorkflow/browser/placeful_workflow_configuration.pt\n+++ b/Products/CMFPlacefulWorkflow/browser/placeful_workflow_configuration.pt\n@@ -1,205 +1,282 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      xml:lang="en"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="cmfplacefulworkflow">\n-\n-    <metal:main metal:fill-slot="main"\n-         tal:define="wf_list context/portal_workflow/objectIds;\n-                     pwtool context/portal_placeful_workflow;\n-                     config python: pwtool.getWorkflowPolicyConfig(context);\n-                     siteroot python: pwtool.isSiteRoot(context);">\n-      <header>\n-        <h1 i18n:translate="heading_workflow_policies">\n+      xml:lang="en"\n+      i18n:domain="cmfplacefulworkflow"\n+>\n+\n+  <metal:main metal:fill-slot="main"\n+              tal:define="\n+                wf_list context/portal_workflow/objectIds;\n+                pwtool context/portal_placeful_workflow;\n+                config python: pwtool.getWorkflowPolicyConfig(context);\n+                siteroot python: pwtool.isSiteRoot(context);\n+              "\n+  >\n+    <header>\n+      <h1 i18n:translate="heading_workflow_policies">\n           Workflow policies\' local configuration management\n-        </h1>\n+      </h1>\n \n-        <p class="lead" i18n:translate="description_workflow_policies">\n+      <p class="lead"\n+         i18n:translate="description_workflow_policies"\n+      >\n           Set your workflow policies\' local configuration for this folder and below.\n-        </p>\n-      </header>\n+      </p>\n+    </header>\n \n-      <div id="content-core">\n-        <tal:site tal:condition="siteroot">\n+    <div id="content-core">\n+      <tal:site tal:condition="siteroot">\n \n-        <div class="alert alert-warning mb-5" i18n:translate="">\n+        <div class="alert alert-warning mb-5"\n+             i18n:translate=""\n+        >\n           You are viewing the root of your site. Local workflow\n           configuration is only available in subfolders of your site.\n         </div>\n \n-        </tal:site>\n+      </tal:site>\n \n-        <tal:nosite tal:condition="not:siteroot">\n+      <tal:nosite tal:condition="not:siteroot">\n \n-        <form\n-          tal:condition="python:not config and context.isPrincipiaFolderish"\n-          action="@@placeful-workflow-configuration" method="POST">\n-          <button type="submit" name="add_wp_for_type" class="btn btn-primary"\n-            i18n:translate="description_add_workflow_policy_for_type">\n+        <form action="@@placeful-workflow-configuration"\n+              method="POST"\n+              tal:condition="python:not config and context.isPrincipiaFolderish"\n+        >\n+          <button class="btn btn-primary"\n+                  name="add_wp_for_type"\n+                  type="submit"\n+                  i18n:translate="description_add_workflow_policy_for_type"\n+          >\n             Add a workflow policy\'s local configuration in the\n             <span tal:replace="python:context.translate(context.portal_type)"\n-              i18n:name="portal_type">portal type</span>\n+                  i18n:name="portal_type"\n+            >portal type</span>\n           </button>\n         </form>\n \n-        <form\n-          tal:condition="python:not context.isPrincipiaFolderish and context is not container"\n-          action="@@placeful-workflow-configuration" method="POST">\n-          <button type="submit" name="add_wp_local_config" class="btn btn-primary"\n-            i18n:translate="description_add_workflow_policy">\n+        <form action="@@placeful-workflow-configuration"\n+              method="POST"\n+              tal:condition="python:not context.isPrincipiaFolderish and context is not container"\n+        >\n+          <button class="btn btn-primary"\n+                  name="add_wp_local_config"\n+                  type="submit"\n+                  i18n:translate="description_add_workflow_policy"\n+          >\n             Add Workflow policy\'s local configuration\n           </button>\n         </form>\n \n         <form id="edit_form"\n-          name="edit_form"\n-          method="POST"\n-          action="${context/absolute_url}/@@placeful-workflow-configuration"\n-          tal:condition="config">\n+              action="${context/absolute_url}/@@placeful-workflow-configuration"\n+              method="POST"\n+              name="edit_form"\n+              tal:condition="config"\n+        >\n \n-          <tal:defines\n-            tal:define="\n-              policies pwtool/getWorkflowPolicyInfos;\n-              policy_in_id config/getPolicyInId;\n-              policy_below_id config/getPolicyBelowId;">\n+          <tal:defines tal:define="\n+                         policies pwtool/getWorkflowPolicyInfos;\n+                         policy_in_id config/getPolicyInId;\n+                         policy_below_id config/getPolicyBelowId;\n+                       ">\n \n-          <h3 i18n:translate="legend_publishing_details">Workflow policies</h3>\n+            <h3 i18n:translate="legend_publishing_details">Workflow policies</h3>\n \n-          <strong i18n:translate="label_in_this_folder">For this Folder</strong>\n+            <strong i18n:translate="label_in_this_folder">For this Folder</strong>\n \n-          <div class="mb-3 form-text"\n-            i18n:translate="description_in_this_folder">\n+            <div class="mb-3 form-text"\n+                 i18n:translate="description_in_this_folder"\n+            >\n             Modify the workflows of this folder and below. If you don\'t want\n             to modify the workflow of this Folder use \'Below this Folder\' section.\n-          </div>\n-\n-          <div class="mb-3 form-check" tal:repeat="policy policies">\n-\n-            <input type="radio" class="form-check-input" name="policy_in"\n-              value="policy" id="cb_policy"\n-              tal:attributes="\n-                id python: \'cb_policy_\' + policy[\'id\'];\n-                value policy/id;\n-                checked python: policy[\'id\'] == policy_in_id" />\n-\n-            <label class="form-check-label" for="cb_policy"\n-              tal:attributes="for python: \'cb_policy_\' + policy[\'id\']"\n-              tal:content="policy/title"\n-              i18n:domain="cmfplacefulworkflow"\n-              i18n:translate="">Policy Label</label>\n-\n-            <div class="form-text" tal:condition="policy/description"\n-              tal:content="policy/description">Workflow policy description</div>\n-\n-          </div>\n-\n-          <div class="mb-3 form-check">\n+            </div>\n \n-            <input type="radio" class="form-check-input" name="policy_in"\n-              id="cb_default_policy" title="" checked="checked"\n-              tal:attributes="value python:\'\'; checked not:config/getPolicyIn" />\n+            <div class="mb-3 form-check"\n+                 tal:repeat="policy policies"\n+            >\n+\n+              <input class="form-check-input"\n+                     id="cb_policy"\n+                     name="policy_in"\n+                     type="radio"\n+                     value="policy"\n+                     tal:attributes="\n+                       id python: \'cb_policy_\' + policy[\'id\'];\n+                       value policy/id;\n+                       checked python: policy[\'id\'] == policy_in_id;\n+                     "\n+              />\n+\n+              <label class="form-check-label"\n+                     for="cb_policy"\n+                     tal:content="policy/title"\n+                     tal:attributes="\n+                       for python: \'cb_policy_\' + policy[\'id\'];\n+                     "\n+                     i18n:domain="cmfplacefulworkflow"\n+                     i18n:translate=""\n+              >Policy Label</label>\n+\n+              <div class="form-text"\n+                   tal:condition="policy/description"\n+                   tal:content="policy/description"\n+              >Workflow policy description</div>\n \n-            <label for="cb_default_policy" class="form-check-label" i18n:translate="label_default_policy">Default Policy</label>\n+            </div>\n \n-            <div class="form-text"\n-              i18n:translate="help_default_workflow_policy">\n+            <div class="mb-3 form-check">\n+\n+              <input class="form-check-input"\n+                     id="cb_default_policy"\n+                     checked="checked"\n+                     name="policy_in"\n+                     title=""\n+                     type="radio"\n+                     tal:attributes="\n+                       value python:\'\';\n+                       checked not:config/getPolicyIn;\n+                     "\n+              />\n+\n+              <label class="form-check-label"\n+                     for="cb_default_policy"\n+                     i18n:translate="label_default_policy"\n+              >Default Policy</label>\n+\n+              <div class="form-text"\n+                   i18n:translate="help_default_workflow_policy"\n+              >\n               The default workflow policy.\n-            </div>\n+              </div>\n \n-          </div>\n+            </div>\n \n-          <strong i18n:translate="label_below_this_folder">Below this Folder</strong>\n+            <strong i18n:translate="label_below_this_folder">Below this Folder</strong>\n \n-          <div class="mb-3 form-text"\n-            i18n:translate="description_below_this_folder">\n+            <div class="mb-3 form-text"\n+                 i18n:translate="description_below_this_folder"\n+            >\n             Modify the workflows only below this Folder. If you want to\n             modify the workflow of this Folder use \'For this Folder\' section.\n-          </div>\n-\n-          <div class="mb-3 form-check" tal:repeat="policy policies">\n-\n-            <input type="radio" class="form-check-input" name="policy_below"\n-              value="policy" id="cb_policy"\n-              tal:attributes="\n-                id python: \'cb_policy_below_\' + policy[\'id\'];\n-                value policy/id;\n-                checked python: policy[\'id\'] == policy_below_id" />\n-\n-            <label for="cb_policy" class="form-check-label"\n-              tal:attributes="for python: \'cb_policy_below_\' + policy[\'id\']"\n-              tal:content="policy/title"\n-              i18n:domain="cmfplacefulworkflow"\n-              i18n:translate="">Policy Label</label>\n-\n-            <div class="form-text" tal:content="policy/description">\n-              Workflow policy description\n             </div>\n \n-          </div>\n-\n-          <div class="mb-3 form-check">\n-\n-            <input type="radio"\n-              class="form-check-input"\n-              name="policy_below"\n-              id="cb_default_policy_below"\n-              title=""\n-              checked="1"\n-              tal:attributes="value python:\'\';\n-                checked not: config/getPolicyBelow" />\n+            <div class="mb-3 form-check"\n+                 tal:repeat="policy policies"\n+            >\n+\n+              <input class="form-check-input"\n+                     id="cb_policy"\n+                     name="policy_below"\n+                     type="radio"\n+                     value="policy"\n+                     tal:attributes="\n+                       id python: \'cb_policy_below_\' + policy[\'id\'];\n+                       value policy/id;\n+                       checked python: policy[\'id\'] == policy_below_id;\n+                     "\n+              />\n+\n+              <label class="form-check-label"\n+                     for="cb_policy"\n+                     tal:content="policy/title"\n+                     tal:attributes="\n+                       for python: \'cb_policy_below_\' + policy[\'id\'];\n+                     "\n+                     i18n:domain="cmfplacefulworkflow"\n+                     i18n:translate=""\n+              >Policy Label</label>\n+\n+              <div class="form-text"\n+                   tal:content="policy/description"\n+              >\n+              Workflow policy description\n+              </div>\n \n-            <label for="cb_default_policy_below" class="form-check-label"\n-              i18n:translate="label_default_policy">Default Policy</label>\n+            </div>\n \n-            <div class="form-text" i18n:translate="help_default_workflow_policy">\n+            <div class="mb-3 form-check">\n+\n+              <input class="form-check-input"\n+                     id="cb_default_policy_below"\n+                     checked="1"\n+                     name="policy_below"\n+                     title=""\n+                     type="radio"\n+                     tal:attributes="\n+                       value python:\'\';\n+                       checked not: config/getPolicyBelow;\n+                     "\n+              />\n+\n+              <label class="form-check-label"\n+                     for="cb_default_policy_below"\n+                     i18n:translate="label_default_policy"\n+              >Default Policy</label>\n+\n+              <div class="form-text"\n+                   i18n:translate="help_default_workflow_policy"\n+              >\n               The default workflow policy.\n-            </div>\n+              </div>\n \n-          </div>\n+            </div>\n \n-          <strong i18n:translate="label_update_security">Update security</strong>\n+            <strong i18n:translate="label_update_security">Update security</strong>\n \n-          <div class="mb-3 form-text"\n-            i18n:translate="description_update_security">\n+            <div class="mb-3 form-text"\n+                 i18n:translate="description_update_security"\n+            >\n             Update catalog security (update role mappings). Note that updating catalog\n             security might be a very long operation if there are a lot of brains to be\n             re-indexed. This operation can be done afterwards as a separate upgrade step.\n-          </div>\n-\n-          <div class="mb-3 form-check">\n-\n-            <input type="checkbox" checked="checked" class="form-check-input"\n-              name="update_security" value="update_security" id="cb_update_security" />\n+            </div>\n \n-            <label for="cb_update_security" class="form-check-label"\n-              i18n:domain="cmfplacefulworkflow"\n-              i18n:translate="">Update catalog role mappings</label>\n+            <div class="mb-3 form-check">\n \n-          </div>\n+              <input class="form-check-input"\n+                     id="cb_update_security"\n+                     checked="checked"\n+                     name="update_security"\n+                     type="checkbox"\n+                     value="update_security"\n+              />\n \n-          <div class="mb-3" i18n:domain="plone">\n+              <label class="form-check-label"\n+                     for="cb_update_security"\n+                     i18n:domain="cmfplacefulworkflow"\n+                     i18n:translate=""\n+              >Update catalog role mappings</label>\n \n-            <input class="btn btn-primary"\n-              type="submit"\n-              name="submit"\n-              value="Save"\n-              i18n:attributes="value label_save;" />\n+            </div>\n \n-            <input class="btn btn-secondary"\n-              type="submit"\n-              name="submit"\n-              value="Cancel"\n-              i18n:attributes="value label_cancel;" />\n-          </div>\n+            <div class="mb-3"\n+                 i18n:domain="plone"\n+            >\n+\n+              <input class="btn btn-primary"\n+                     name="submit"\n+                     type="submit"\n+                     value="Save"\n+                     i18n:attributes="value label_save;"\n+              />\n+\n+              <input class="btn btn-secondary"\n+                     name="submit"\n+                     type="submit"\n+                     value="Cancel"\n+                     i18n:attributes="value label_cancel;"\n+              />\n+            </div>\n \n-        </tal:defines>\n+          </tal:defines>\n         </form>\n \n-        </tal:nosite>\n-      </div>\n+      </tal:nosite>\n+    </div>\n \n-    </metal:main>\n+  </metal:main>\n </html>\ndiff --git a/Products/CMFPlacefulWorkflow/browser/placeful_workflow_policy_mapping.pt b/Products/CMFPlacefulWorkflow/browser/placeful_workflow_policy_mapping.pt\nindex 21854ea..5ef5699 100644\n--- a/Products/CMFPlacefulWorkflow/browser/placeful_workflow_policy_mapping.pt\n+++ b/Products/CMFPlacefulWorkflow/browser/placeful_workflow_policy_mapping.pt\n@@ -1,193 +1,256 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      xml:lang="en"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/prefs_main_template/macros/master"\n-      i18n:domain="cmfplacefulworkflow">\n-\n-\n-    <metal:main metal:fill-slot="prefs_configlet_main"\n-         tal:define="allowedContentTypes allowedSortedContentTypes|context/allowedContentTypes;\n-                     wfpid python:request.get(\'wfpid\');\n-                     wf_policy python:context.portal_placeful_workflow.getWorkflowPolicyById(wfpid);\n-                     wtool context/portal_workflow;\n-                     wf_list python: [{\'id\': obj.getId(), \'title\': obj.title_or_id()} for obj in wtool.objectValues()];">\n-\n-        <span tal:define="dummy python:request.response.setHeader(\'pragma\',\'no-cache\')" />\n-\n-        <header>\n-\n-          <h1>\n-            <span tal:replace="wfpid" tal:condition="python:not wf_policy.getTitle()" />\n-            <span tal:condition="python:wf_policy.getTitle()">\n-                <span tal:replace="python:wf_policy.getTitle()" />\n-            </span>\n-          </h1>\n-\n-          <p i18n:translate="description_workflow_custom_mapping">\n+      xml:lang="en"\n+      i18n:domain="cmfplacefulworkflow"\n+>\n+\n+\n+  <metal:main metal:fill-slot="prefs_configlet_main"\n+              tal:define="\n+                allowedContentTypes allowedSortedContentTypes|context/allowedContentTypes;\n+                wfpid python:request.get(\'wfpid\');\n+                wf_policy python:context.portal_placeful_workflow.getWorkflowPolicyById(wfpid);\n+                wtool context/portal_workflow;\n+                wf_list python: [{\'id\': obj.getId(), \'title\': obj.title_or_id()} for obj in wtool.objectValues()];\n+              "\n+  >\n+\n+    <span tal:define="\n+            dummy python:request.response.setHeader(\'pragma\',\'no-cache\');\n+          "></span>\n+\n+    <header>\n+\n+      <h1>\n+        <span tal:condition="python:not wf_policy.getTitle()"\n+              tal:replace="wfpid"\n+        ></span>\n+        <span tal:condition="python:wf_policy.getTitle()">\n+          <span tal:replace="python:wf_policy.getTitle()"></span>\n+        </span>\n+      </h1>\n+\n+      <p i18n:translate="description_workflow_custom_mapping">\n               Custom workflow policy which maps content types to workflows.\n-          </p>\n-\n-          <a href=""\n-            class="link-parent"\n-            tal:attributes="href string:$portal_url/@@workflow-policies-controlpanel"\n-            i18n:translate="label_up_to_placeful_workflow">\n+      </p>\n+\n+      <a class="link-parent"\n+         href=""\n+         tal:attributes="\n+           href string:$portal_url/@@workflow-policies-controlpanel;\n+         "\n+         i18n:translate="label_up_to_placeful_workflow"\n+      >\n             Up to Placeful Workflow\n-          </a>\n+      </a>\n \n-        </header>\n+    </header>\n \n-        <div id="content-core">\n-          <form name="prefs-workflow-policy-mapping_set"\n-                action="${context/absolute_url}/@@placeful-workflow-policy-mapping"\n-                method="post">\n+    <div id="content-core">\n+      <form action="${context/absolute_url}/@@placeful-workflow-policy-mapping"\n+            method="post"\n+            name="prefs-workflow-policy-mapping_set"\n+      >\n \n-              <fieldset>\n+        <fieldset>\n \n-                  <legend i18n:translate="legend_workflow_policy_details">\n+          <legend i18n:translate="legend_workflow_policy_details">\n                       Workflow Policy Details\n-                  </legend>\n-\n-                  <div class="mb-3">\n-\n-                      <label class="form-label"\n-                        for="title"\n-                        i18n:domain="plone">\n-                        <span tal:omit-tag="" i18n:translate="label_title">Title</span>\n-                        <span class="fieldRequired"\n-                          title="Required"\n-                          i18n:domain="plone"\n-                          i18n:attributes="title title_required;"\n-                          i18n:translate="label_required">\n+          </legend>\n+\n+          <div class="mb-3">\n+\n+            <label class="form-label"\n+                   for="title"\n+                   i18n:domain="plone"\n+            >\n+              <span tal:omit-tag=""\n+                    i18n:translate="label_title"\n+              >Title</span>\n+              <span class="fieldRequired"\n+                    title="Required"\n+                    i18n:attributes="title title_required;"\n+                    i18n:domain="plone"\n+                    i18n:translate="label_required"\n+              >\n                           (Required)\n-                        </span>\n-                      </label>\n-\n-                      <input type="text"\n-                              id="title"\n-                              name="title"\n-                              value=""\n-                              class="form-control"\n-                              tal:attributes="value python:request.get(\'title\',wf_policy.getTitle())" />\n-                  </div>\n-\n-                  <div class="mb-3">\n-\n-                      <label for="description"\n-                            class="form-label"\n-                            i18n:domain="plone"\n-                            i18n:translate="label_description">\n+              </span>\n+            </label>\n+\n+            <input class="form-control"\n+                   id="title"\n+                   name="title"\n+                   type="text"\n+                   value=""\n+                   tal:attributes="\n+                     value python:request.get(\'title\',wf_policy.getTitle());\n+                   "\n+            />\n+          </div>\n+\n+          <div class="mb-3">\n+\n+            <label class="form-label"\n+                   for="description"\n+                   i18n:domain="plone"\n+                   i18n:translate="label_description"\n+            >\n                           Description\n-                      </label>\n-\n-                      <textarea cols="80"\n-                                rows="2"\n-                                class="form-control"\n-                                id="description"\n-                                name="description"\n-                                tal:content="python:request.get(\'description\',wf_policy.getDescription())">\n+            </label>\n+\n+            <textarea class="form-control"\n+                      id="description"\n+                      cols="80"\n+                      name="description"\n+                      rows="2"\n+                      tal:content="python:request.get(\'description\',wf_policy.getDescription())"\n+            >\n                           Workflow Policy Description.\n-                      </textarea>\n+            </textarea>\n \n-                      <div class="form-text"\n-                            i18n:translate="help_workflow_policy_description">\n+            <div class="form-text"\n+                 i18n:translate="help_workflow_policy_description"\n+            >\n                           A brief description of the workflow policy.\n-                      </div>\n+            </div>\n \n-                  </div>\n+          </div>\n \n-                  <div class="mb-3">\n+          <div class="mb-3">\n \n-                      <label for="default_workflow_id"\n-                            class="form-label"\n-                            i18n:translate="label_default_workflow">\n+            <label class="form-label"\n+                   for="default_workflow_id"\n+                   i18n:translate="label_default_workflow"\n+            >\n                           Default Workflow\n-                      </label>\n-\n-                      <select id="select_workflow"\n-                              class="form-select"\n-                              name="default_workflow_id">\n-\n-                          <option tal:repeat="wf wf_list"\n-                                  tal:attributes="value wf/id;\n-                                                  selected python:\'selected\' if (wf[\'id\'],)==wf_policy.getDefaultChain(context) else None"\n-                                  tal:content="wf/title"\n-                                  i18n:domain="plone"\n-                                  i18n:translate="">\n+            </label>\n+\n+            <select class="form-select"\n+                    id="select_workflow"\n+                    name="default_workflow_id"\n+            >\n+\n+              <option tal:repeat="wf wf_list"\n+                      tal:content="wf/title"\n+                      tal:attributes="\n+                        value wf/id;\n+                        selected python:\'selected\' if (wf[\'id\'],)==wf_policy.getDefaultChain(context) else None;\n+                      "\n+                      i18n:domain="plone"\n+                      i18n:translate=""\n+              >\n                               example_workflow\n-                          </option>\n-                      </select>\n+              </option>\n+            </select>\n \n-                      <div class="form-text"\n-                            i18n:translate="help_default_workflow_for_types">\n+            <div class="form-text"\n+                 i18n:translate="help_default_workflow_for_types"\n+            >\n                           Default workflow for content types.\n-                      </div>\n-                  </div>\n-\n-                  <div class="mb-3"\n-                    summary="Workflow to content type mapping."\n-                    i18n:attributes="summary summary_workflow_type_mapping;">\n-\n-                      <label for="workflow_id" class="form-label"\n-                        summary="Workflow to content type mapping."\n-                        i18n:attributes="summary summary_workflow_type_mapping;"\n-                        i18n:translate="label_workflow_by_type">\n+            </div>\n+          </div>\n+\n+          <div class="mb-3"\n+               summary="Workflow to content type mapping."\n+               i18n:attributes="summary summary_workflow_type_mapping;"\n+          >\n+\n+            <label class="form-label"\n+                   for="workflow_id"\n+                   summary="Workflow to content type mapping."\n+                   i18n:attributes="summary summary_workflow_type_mapping;"\n+                   i18n:translate="label_workflow_by_type"\n+            >\n                           Workflows by type\n-                      </label>\n-\n-                      <tal:ctype tal:repeat="ctype allowedContentTypes">\n-                        <div class="input-group mb-3"\n-                          tal:define="ctype_title ctype/Title;\n-                          ctype_id ctype/getId;\n-\n-                          chain python:wf_policy.getChainFor(ctype_id, managescreen=True) or (\'backward compatibility\',);">\n-                          <label class="input-group-text"\n-                            for="select_workflow"\n-                            tal:content="ctype_title"\n-                            tal:attributes="for python: \'select_workflow_\' + ctype_id"\n-                            i18n:translate="">Title</label>\n-                          <select id="select_workflow" name="workflow_id" class="form-select"\n-                            tal:attributes="name string:wf.${ctype_id}:record;id python: \'select_workflow_\' + ctype_id" >\n-                            <option value="acquisition"\n-                              tal:attributes="selected python:\'selected\' if chain is None else None;"\n-                              i18n:translate="label_mapping_acquire_workflow">Acquire workflow from above</option>\n-                            <option value=""\n-                              tal:attributes="selected python:\'selected\' if chain == () else None;"\n-                              i18n:translate="label_mapping_no_workflow">No workflow</option>\n-\n-                            <option value="(Default)"\n-                              tal:attributes="selected python:\'selected\' if chain == \'(Default)\' else None;"\n-                              i18n:translate="label_mapping_default_worflow">Default workflow for the policy</option>\n-                            <option tal:repeat="wf wf_list"\n-                              tal:attributes="value wf/id;\n-                                selected python:\'selected\' if (wf[\'id\'],) == chain else None"\n-                              tal:content="wf/title"\n-                              i18n:domain="plone"\n-                              i18n:translate="">workflow_id</option>\n-                          </select>\n-                        </div>\n-                      </tal:ctype>\n-\n-                      <div class="form-text" i18n:translate="help_workflow_assign_all_types">\n+            </label>\n+\n+            <tal:ctype tal:repeat="ctype allowedContentTypes">\n+              <div class="input-group mb-3"\n+                   tal:define="\n+                     ctype_title ctype/Title;\n+                     ctype_id ctype/getId;\n+                     chain python:wf_policy.getChainFor(ctype_id, managescreen=True) or (\'backward compatibility\',);\n+                   "\n+              >\n+                <label class="input-group-text"\n+                       for="select_workflow"\n+                       tal:content="ctype_title"\n+                       tal:attributes="\n+                         for python: \'select_workflow_\' + ctype_id;\n+                       "\n+                       i18n:translate=""\n+                >Title</label>\n+                <select class="form-select"\n+                        id="select_workflow"\n+                        name="workflow_id"\n+                        tal:attributes="\n+                          name string:wf.${ctype_id}:record;\n+                          id python: \'select_workflow_\' + ctype_id;\n+                        "\n+                >\n+                  <option value="acquisition"\n+                          tal:attributes="\n+                            selected python:\'selected\' if chain is None else None;\n+                          "\n+                          i18n:translate="label_mapping_acquire_workflow"\n+                  >Acquire workflow from above</option>\n+                  <option value=""\n+                          tal:attributes="\n+                            selected python:\'selected\' if chain == () else None;\n+                          "\n+                          i18n:translate="label_mapping_no_workflow"\n+                  >No workflow</option>\n+\n+                  <option value="(Default)"\n+                          tal:attributes="\n+                            selected python:\'selected\' if chain == \'(Default)\' else None;\n+                          "\n+                          i18n:translate="label_mapping_default_worflow"\n+                  >Default workflow for the policy</option>\n+                  <option tal:repeat="wf wf_list"\n+                          tal:content="wf/title"\n+                          tal:attributes="\n+                            value wf/id;\n+                            selected python:\'selected\' if (wf[\'id\'],) == chain else None;\n+                          "\n+                          i18n:domain="plone"\n+                          i18n:translate=""\n+                  >workflow_id</option>\n+                </select>\n+              </div>\n+            </tal:ctype>\n+\n+            <div class="form-text"\n+                 i18n:translate="help_workflow_assign_all_types"\n+            >\n                         You can assign a workflow for all content types.\n-                      </div>\n-\n-                      <input type="hidden" value="" name="wfpid" tal:attributes="value wfpid" />\n-\n-                  </div>\n-                  <div class="formControls">\n-                      <input class="btn btn-primary"\n-                              type="submit"\n-                              name="submit"\n-                              value="Save"\n-                              i18n:domain="plone"\n-                              i18n:attributes="value label_save;" />\n-                  </div>\n-              </fieldset>\n-          </form>\n-        </div>\n-    </metal:main>\n+            </div>\n+\n+            <input name="wfpid"\n+                   type="hidden"\n+                   value=""\n+                   tal:attributes="\n+                     value wfpid;\n+                   "\n+            />\n+\n+          </div>\n+          <div class="formControls">\n+            <input class="btn btn-primary"\n+                   name="submit"\n+                   type="submit"\n+                   value="Save"\n+                   i18n:attributes="value label_save;"\n+                   i18n:domain="plone"\n+            />\n+          </div>\n+        </fieldset>\n+      </form>\n+    </div>\n+  </metal:main>\n \n </html>\ndiff --git a/Products/CMFPlacefulWorkflow/browser/workflow_policies_controlpanel.pt b/Products/CMFPlacefulWorkflow/browser/workflow_policies_controlpanel.pt\nindex e57bc03..44eb098 100644\n--- a/Products/CMFPlacefulWorkflow/browser/workflow_policies_controlpanel.pt\n+++ b/Products/CMFPlacefulWorkflow/browser/workflow_policies_controlpanel.pt\n@@ -1,147 +1,221 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      xml:lang="en"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/prefs_main_template/macros/master"\n-      i18n:domain="cmfplacefulworkflow">\n+      xml:lang="en"\n+      i18n:domain="cmfplacefulworkflow"\n+>\n \n-    <metal:main metal:fill-slot="prefs_configlet_main"\n-         tal:define="errors python:request.get(\'errors\', {});">\n+  <metal:main metal:fill-slot="prefs_configlet_main"\n+              tal:define="\n+                errors python:request.get(\'errors\', {});\n+              "\n+  >\n \n-        <span tal:define="dummy python:request.response.setHeader(\'pragma\',\'no-cache\')" />\n+    <span tal:define="\n+            dummy python:request.response.setHeader(\'pragma\',\'no-cache\');\n+          "></span>\n \n \n-        <header>\n-            <h1 i18n:translate="title_workflow_policy_setup">\n+    <header>\n+      <h1 i18n:translate="title_workflow_policy_setup">\n                 Workflow Policies Setup\n-            </h1>\n-            <p i18n:translate="description_workflow_policy_setup">\n+      </h1>\n+      <p i18n:translate="description_workflow_policy_setup">\n                 Here you can create and configure your workflow policies.\n                 A policy modifies workflows for any items in or below\n                 a specific folder. To apply a policy you have to add a\n                 local workflow policy configuration to the desired\n                 folder using the \'policy\' item in the \'state\' drop-down\n                 menu.\n-            </p>\n-        </header>\n-\n-        <div id="content">\n-\n-                <form action=""\n-                      name=""\n-                      method="post"\n-                      tal:attributes="action string:${context/absolute_url}/@@workflow-policies-controlpanel"\n-                      tal:define="wfp python:context.portal_placeful_workflow;">\n-\n-                    <fieldset class="mb-3">\n-                        <legend i18n:translate="legend_workflow_policies">Existing Workflow Policies</legend>\n-\n-                        <div tal:repeat="wfpid python:wfp.getWorkflowPolicyIds()"\n-                             class="form-check">\n-\n-                            <tal:wfp tal:define="wfp python:wfp.getWorkflowPolicyById(wfpid)">\n-\n-                            <input type="checkbox" class="form-check-input" id="policy_id" name="policy_ids:list"\n-                                   tal:attributes="id wfpid; value wfpid" />\n-\n-                            <label for="policy_id"\n-                                   tal:attributes="for wfpid">\n-                                <a href="@@placeful-workflow-policy-mapping"\n-                                   tal:attributes="href python:\'@@placeful-workflow-policy-mapping?wfpid=\'+wfpid"\n-                                   tal:content="python:wfp.getTitle() or wfp.getId()"\n-                                   i18n:translate="">\n+      </p>\n+    </header>\n+\n+    <div id="content">\n+\n+      <form action=""\n+            method="post"\n+            name=""\n+            tal:define="\n+              wfp python:context.portal_placeful_workflow;\n+            "\n+            tal:attributes="\n+              action string:${context/absolute_url}/@@workflow-policies-controlpanel;\n+            "\n+      >\n+\n+        <fieldset class="mb-3">\n+          <legend i18n:translate="legend_workflow_policies">Existing Workflow Policies</legend>\n+\n+          <div class="form-check"\n+               tal:repeat="wfpid python:wfp.getWorkflowPolicyIds()"\n+          >\n+\n+            <tal:wfp tal:define="\n+                       wfp python:wfp.getWorkflowPolicyById(wfpid);\n+                     ">\n+\n+              <input class="form-check-input"\n+                     id="policy_id"\n+                     name="policy_ids:list"\n+                     type="checkbox"\n+                     tal:attributes="\n+                       id wfpid;\n+                       value wfpid;\n+                     "\n+              />\n+\n+              <label for="policy_id"\n+                     tal:attributes="\n+                       for wfpid;\n+                     "\n+              >\n+                <a href="@@placeful-workflow-policy-mapping"\n+                   tal:content="python:wfp.getTitle() or wfp.getId()"\n+                   tal:attributes="\n+                     href python:\'@@placeful-workflow-policy-mapping?wfpid=\'+wfpid;\n+                   "\n+                   i18n:translate=""\n+                >\n                                     Title of the policy mapping\n-                                </a>\n-                            </label>\n+                </a>\n+              </label>\n \n-                            <div class="form-text"\n-                                 tal:content="python:wfp.getDescription()">\n+              <div class="form-text"\n+                   tal:content="python:wfp.getDescription()"\n+              >\n                                 Description of the policy mapping\n-                            </div>\n-\n-                            </tal:wfp>\n-\n-                        </div>\n-\n-                        <div class="formControls"\n-                             tal:condition="python:wfp.getWorkflowPolicyIds()">\n-                            <input class="btn btn-danger" type="submit" name="delete" value="Remove selected"\n-                                   i18n:attributes="value label_remove_selected;"\n-                                   />\n-                        </div>\n-                    </fieldset>\n-\n-                    <fieldset class="mb-3">\n-                        <legend i18n:translate="legend_add_workflow_policy">Add a workflow policy</legend>\n-                        <div class="mb-3"\n-                             tal:define="error errors/policy_id | nothing;"\n-                             tal:attributes="class python:\'field error mb-3\' if error else \'mb-3\'">\n-\n-                            <label class="form-label">\n-                              <span tal:omit-tag="" i18n:translate="label_new_policy_id">New policy Id</span>\n-                              <span class="fieldRequired" title="Required"\n-                                    i18n:domain="plone"\n-                                    i18n:attributes="title title_required;"\n-                                    i18n:translate="label_required">(Required)</span>\n-                            </label>\n-\n-                            <input name="policy_id" class="form-control" value="" size="30" />\n-\n-                            <div class="form-text" id=""\n-                                 i18n:translate="description_new_policy_id">\n+              </div>\n+\n+            </tal:wfp>\n+\n+          </div>\n+\n+          <div class="formControls"\n+               tal:condition="python:wfp.getWorkflowPolicyIds()"\n+          >\n+            <input class="btn btn-danger"\n+                   name="delete"\n+                   type="submit"\n+                   value="Remove selected"\n+                   i18n:attributes="value label_remove_selected;"\n+            />\n+          </div>\n+        </fieldset>\n+\n+        <fieldset class="mb-3">\n+          <legend i18n:translate="legend_add_workflow_policy">Add a workflow policy</legend>\n+          <div class="mb-3"\n+               tal:define="\n+                 error errors/policy_id | nothing;\n+               "\n+               tal:attributes="\n+                 class python:\'field error mb-3\' if error else \'mb-3\';\n+               "\n+          >\n+\n+            <label class="form-label">\n+              <span tal:omit-tag=""\n+                    i18n:translate="label_new_policy_id"\n+              >New policy Id</span>\n+              <span class="fieldRequired"\n+                    title="Required"\n+                    i18n:attributes="title title_required;"\n+                    i18n:domain="plone"\n+                    i18n:translate="label_required"\n+              >(Required)</span>\n+            </label>\n+\n+            <input class="form-control"\n+                   name="policy_id"\n+                   size="30"\n+                   value=""\n+            />\n+\n+            <div class="form-text"\n+                 id=""\n+                 i18n:translate="description_new_policy_id"\n+            >\n                                 Enter an id for the new workflow policy\n-                            </div>\n-\n-                            <div tal:content="error">Validation error output</div>\n-\n-                        </div>\n-                        <div class="mb-3"\n-                             tal:define="error errors/policy_id | nothing;"\n-                             tal:attributes="class python:\'field error mb-3\' if error else \'field mb-3\'">\n-\n-                            <label class="form-label">\n-                              <span tal:omit-tag="" i18n:translate="label_duplicate_policy_id">Duplicate another policy</span>\n-                              <span class="fieldRequired" title="Required"\n-                                i18n:domain="plone"\n-                                i18n:attributes="title title_required;"\n-                                i18n:translate="label_required">(Required)</span>\n-                            </label>\n-\n-                            <select name="policy_duplicate_id" class="form-select">\n-                              <option value="empty"\n-                                      i18n:translate="label_no_policy_duplicated">\n+            </div>\n+\n+            <div tal:content="error">Validation error output</div>\n+\n+          </div>\n+          <div class="mb-3"\n+               tal:define="\n+                 error errors/policy_id | nothing;\n+               "\n+               tal:attributes="\n+                 class python:\'field error mb-3\' if error else \'field mb-3\';\n+               "\n+          >\n+\n+            <label class="form-label">\n+              <span tal:omit-tag=""\n+                    i18n:translate="label_duplicate_policy_id"\n+              >Duplicate another policy</span>\n+              <span class="fieldRequired"\n+                    title="Required"\n+                    i18n:attributes="title title_required;"\n+                    i18n:domain="plone"\n+                    i18n:translate="label_required"\n+              >(Required)</span>\n+            </label>\n+\n+            <select class="form-select"\n+                    name="policy_duplicate_id"\n+            >\n+              <option value="empty"\n+                      i18n:translate="label_no_policy_duplicated"\n+              >\n                                   No policy duplicated\n-                              </option>\n-                              <option value="portal_workflow"\n-                                      i18n:translate="label_duplicate_portal_workflow">Global workflow</option>\n-                              <option tal:repeat="wfpid python:wfp.getWorkflowPolicyIds()"\n-                                      tal:attributes="value wfpid"\n-                                      tal:content="python:wfp.getWorkflowPolicyById(wfpid).getTitle()">WF policy id</option>\n-                            </select>\n-\n-                            <div class="form-text" id=""\n-                                 i18n:translate="description_duplicate_policy_id">\n+              </option>\n+              <option value="portal_workflow"\n+                      i18n:translate="label_duplicate_portal_workflow"\n+              >Global workflow</option>\n+              <option tal:repeat="wfpid python:wfp.getWorkflowPolicyIds()"\n+                      tal:content="python:wfp.getWorkflowPolicyById(wfpid).getTitle()"\n+                      tal:attributes="\n+                        value wfpid;\n+                      "\n+              >WF policy id</option>\n+            </select>\n+\n+            <div class="form-text"\n+                 id=""\n+                 i18n:translate="description_duplicate_policy_id"\n+            >\n                                 Choose a policy to copy when creating the new policy.\n                                 You also can choose to start with an empty policy.\n-                            </div>\n-\n-                            <div tal:content="error">Validation error output</div>\n-\n-                        </div>\n-\n-                        <div class="formControls">\n-                            <input type="submit" class="btn btn-primary" name="add" value="Add"\n-                                   i18n:attributes="value label_add;"\n-                                   />\n-                        </div>\n-\n-                        <input type="hidden" name="form_submitted" value="1" tal:attributes="value template/id" />\n-                    </fieldset>\n-                </form>\n-\n-        </div>\n-\n-    </metal:main>\n+            </div>\n+\n+            <div tal:content="error">Validation error output</div>\n+\n+          </div>\n+\n+          <div class="formControls">\n+            <input class="btn btn-primary"\n+                   name="add"\n+                   type="submit"\n+                   value="Add"\n+                   i18n:attributes="value label_add;"\n+            />\n+          </div>\n+\n+          <input name="form_submitted"\n+                 type="hidden"\n+                 value="1"\n+                 tal:attributes="\n+                   value template/id;\n+                 "\n+          />\n+        </fieldset>\n+      </form>\n+\n+    </div>\n+\n+  </metal:main>\n </html>\ndiff --git a/Products/CMFPlacefulWorkflow/exportimport/workflow_policies.py b/Products/CMFPlacefulWorkflow/exportimport/workflow_policies.py\nindex 6aa042f..0781f80 100644\n--- a/Products/CMFPlacefulWorkflow/exportimport/workflow_policies.py\n+++ b/Products/CMFPlacefulWorkflow/exportimport/workflow_policies.py\n@@ -32,14 +32,12 @@\n \n \n class PlacefulWorkflowXMLAdapter(FolderXMLAdapter):\n-\n     _LOGGER_ID = "placeful_workflow"\n \n     body = property(XMLAdapterBase._exportBody, XMLAdapterBase._importBody)\n \n \n class WorkflowPoliciesXMLAdapter(WorkflowToolXMLAdapter):\n-\n     _LOGGER_ID = "placeful_workflow"\n \n     @property\ndiff --git a/Products/CMFPlacefulWorkflow/testing.py b/Products/CMFPlacefulWorkflow/testing.py\nindex feabb1c..f9d5752 100644\n--- a/Products/CMFPlacefulWorkflow/testing.py\n+++ b/Products/CMFPlacefulWorkflow/testing.py\n@@ -14,7 +14,6 @@\n \n \n class ProductsCmfplacefulworkflowLayer(PloneSandboxLayer):\n-\n     defaultBases = (PLONE_APP_CONTENTTYPES_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\ndiff --git a/Products/CMFPlacefulWorkflow/tests/CMFPlacefulWorkflowTestCase.py b/Products/CMFPlacefulWorkflow/tests/CMFPlacefulWorkflowTestCase.py\nindex 2f74b5d..6c67023 100644\n--- a/Products/CMFPlacefulWorkflow/tests/CMFPlacefulWorkflowTestCase.py\n+++ b/Products/CMFPlacefulWorkflow/tests/CMFPlacefulWorkflowTestCase.py\n@@ -25,7 +25,6 @@\n \n \n class CMFPlacefulWorkflowTestCase(unittest.TestCase):\n-\n     layer = PRODUCTS_CMFPLACEFULWORKFLOW_FUNCTIONAL_TESTING\n \n     def getPermissionsOfRole(self, role):\ndiff --git a/Products/CMFPlacefulWorkflow/tests/exportimport.txt b/Products/CMFPlacefulWorkflow/tests/exportimport.txt\nindex 19bffd3..3a69ce5 100644\n--- a/Products/CMFPlacefulWorkflow/tests/exportimport.txt\n+++ b/Products/CMFPlacefulWorkflow/tests/exportimport.txt\n@@ -1,6 +1,6 @@\n ;-*-Doctest-*-\n =================================================\n-GenericSetup Exmport/Import Handlers for Policies\n+GenericSetup Export/Import Handlers for Policies\n =================================================\n \n Placeful workflow policies can be imported and exported through\ndiff --git a/Products/CMFPlacefulWorkflow/www/add_workflow_policy.zpt b/Products/CMFPlacefulWorkflow/www/add_workflow_policy.zpt\nindex a18c44d..c2bacf6 100644\n--- a/Products/CMFPlacefulWorkflow/www/add_workflow_policy.zpt\n+++ b/Products/CMFPlacefulWorkflow/www/add_workflow_policy.zpt\n@@ -1,41 +1,74 @@\n-<form action="manage_addWorkflowPolicy" method="POST">\n+<form action="manage_addWorkflowPolicy"\n+      method="POST"\n+>\n \n-<h3>Add Workflow policy</h3>\n+  <h3>Add Workflow policy</h3>\n \n-<table cellspacing="0" cellpadding="2" border="0">\n-  <tr>\n-    <td align="left" valign="top">\n-    <div class="form-label">\n+  <table border="0"\n+         cellpadding="2"\n+         cellspacing="0"\n+  >\n+    <tr>\n+      <td align="left"\n+          valign="top"\n+      >\n+        <div class="form-label">\n     Id\n-    </div>\n-    </td>\n-    <td align="left" valign="top">\n-    <input type="text" name="id" size="40" />\n-    </td>\n-  </tr>\n-  <tr>\n-    <td align="left" valign="top">\n-    <div class="form-label"><label>Type</label></div>\n-    </td>\n-    <td align="left" valign="top">\n-    <div tal:repeat="wptype options/workflow_policy_types">\n-      <input type="radio" name="workflow_policy_type" value="id" id="id"\n-             tal:attributes="name wptype;id wptype;">\n-      <label for="ids"\n-             tal:attributes="for wptype"\n-             tal:content="wptype">Id</label><br />\n-    </div>\n-    </td>\n-  </tr>\n-  <tr>\n-    <td align="left" valign="top">\n-    </td>\n-    <td align="left" valign="top">\n-    <div class="form-element">\n-    <input class="form-element" type="submit" name="submit"\n-     value=" Add " />\n-    </div>\n-    </td>\n-  </tr>\n-</table>\n+        </div>\n+      </td>\n+      <td align="left"\n+          valign="top"\n+      >\n+        <input name="id"\n+               size="40"\n+               type="text"\n+        />\n+      </td>\n+    </tr>\n+    <tr>\n+      <td align="left"\n+          valign="top"\n+      >\n+        <div class="form-label"><label>Type</label></div>\n+      </td>\n+      <td align="left"\n+          valign="top"\n+      >\n+        <div tal:repeat="wptype options/workflow_policy_types">\n+          <input id="id"\n+                 name="workflow_policy_type"\n+                 type="radio"\n+                 value="id"\n+                 tal:attributes="\n+                   name wptype;\n+                   id wptype;\n+                 "\n+          />\n+          <label for="ids"\n+                 tal:content="wptype"\n+                 tal:attributes="\n+                   for wptype;\n+                 "\n+          >Id</label><br />\n+        </div>\n+      </td>\n+    </tr>\n+    <tr>\n+      <td align="left"\n+          valign="top"\n+      >\n+      </td>\n+      <td align="left"\n+          valign="top"\n+      >\n+        <div class="form-element">\n+          <input class="form-element"\n+                 name="submit"\n+                 type="submit"\n+                 value=" Add "\n+          />\n+        </div>\n+      </td>\n+    </tr>\n+  </table>\n </form>\ndiff --git a/Products/CMFPlacefulWorkflow/www/add_workflow_policy_config_form.zpt b/Products/CMFPlacefulWorkflow/www/add_workflow_policy_config_form.zpt\nindex 837049c..e9643f0 100644\n--- a/Products/CMFPlacefulWorkflow/www/add_workflow_policy_config_form.zpt\n+++ b/Products/CMFPlacefulWorkflow/www/add_workflow_policy_config_form.zpt\n@@ -1,19 +1,31 @@\n <h1 tal:replace="structure here/manage_page_header">Header</h1>\n-<h2 tal:define="manage_tabs_message options/manage_tabs_message | nothing"\n-    tal:replace="structure here/manage_tabs">Tabs</h2>\n+<h2 tal:define="\n+      manage_tabs_message options/manage_tabs_message | nothing;\n+    "\n+    tal:replace="structure here/manage_tabs"\n+>Tabs</h2>\n \n-<h3> Add Workflow Policy Configuration </h3>\n+<h3>\n+  Add Workflow Policy Configuration\n+</h3>\n \n <p class="form-help">\n-<form action="manage_addWorkflowPolicyConfig" method="post">\n+  <form action="manage_addWorkflowPolicyConfig"\n+        method="post"\n+  >\n   Workflow Policy Configurations for this object and below:&nbsp;&nbsp;&nbsp;\n-  <input class="form-element" type="submit" name="submit" value=" Add" />\n-</form>\n+    <input class="form-element"\n+           name="submit"\n+           type="submit"\n+           value=" Add"\n+    />\n+  </form>\n </p>\n \n <div style="color: red;font-size: 150%;"\n-     tal:condition="python:len(here.objectIds(\'Workflow Policy Configuration\')) > 0">\n-  /!\\ A Workflow Policy Configuration already exist in this object !<br/>\n+     tal:condition="python:len(here.objectIds(\'Workflow Policy Configuration\')) &gt; 0"\n+>\n+  /!\\ A Workflow Policy Configuration already exist in this object !<br />\n   Please remove it before adding a new one.\n </div>\n \ndiff --git a/Products/CMFPlacefulWorkflow/www/define_local_workflow_policy.zpt b/Products/CMFPlacefulWorkflow/www/define_local_workflow_policy.zpt\nindex 3fa02ce..be6bd6b 100644\n--- a/Products/CMFPlacefulWorkflow/www/define_local_workflow_policy.zpt\n+++ b/Products/CMFPlacefulWorkflow/www/define_local_workflow_policy.zpt\n@@ -1,58 +1,103 @@\n <h1 tal:replace="structure here/manage_page_header">Header</h1>\n-<h2 tal:define="manage_tabs_message options/manage_tabs_message | nothing"\n-    tal:replace="structure here/manage_tabs">Tabs</h2>\n+<h2 tal:define="\n+      manage_tabs_message options/manage_tabs_message | nothing;\n+    "\n+    tal:replace="structure here/manage_tabs"\n+>Tabs</h2>\n \n \n <h3>Workflows by type</h3>\n \n-<form action="manage_changeWorkflows" method="POST">\n+<form action="manage_changeWorkflows"\n+      method="POST"\n+>\n \n-<table>\n-  <tr>\n-    <td align="left" valign="top">\n-      <div class="form-label">Workflow Policy Title</div>\n-    </td>\n-    <td align="left" valign="top">\n-      <input type="text" name="title" value="getTitle" size="40"\n-             tal:attributes="value here/getTitle"/>\n-    </td>\n-  </tr>\n-  <tr>\n-    <td align="left" valign="top">\n-      <div class="form-label">Workflow Policy Description</div>\n-    </td>\n-    <td align="left" valign="top">\n-      <input type="text" name="description" size="40" value="getDescription"\n-             tal:attributes="value here/getDescription" />\n-    </td>\n-  </tr>\n+  <table>\n+    <tr>\n+      <td align="left"\n+          valign="top"\n+      >\n+        <div class="form-label">Workflow Policy Title</div>\n+      </td>\n+      <td align="left"\n+          valign="top"\n+      >\n+        <input name="title"\n+               size="40"\n+               type="text"\n+               value="getTitle"\n+               tal:attributes="\n+                 value here/getTitle;\n+               "\n+        />\n+      </td>\n+    </tr>\n+    <tr>\n+      <td align="left"\n+          valign="top"\n+      >\n+        <div class="form-label">Workflow Policy Description</div>\n+      </td>\n+      <td align="left"\n+          valign="top"\n+      >\n+        <input name="description"\n+               size="40"\n+               type="text"\n+               value="getDescription"\n+               tal:attributes="\n+                 value here/getDescription;\n+               "\n+        />\n+      </td>\n+    </tr>\n \n-  <tr tal:repeat="tinfo options/types_info">\n-    <td class="form-label">\n-      <a tal:attributes="href string:${here/portal_url}/portal_types/${tinfo/id}/manage_workspace">\n-        <span tal:replace="tinfo/id"/>\n-        <span tal:condition="tinfo/title"\n-              tal:replace="string:(${tinfo/title})"/>\n-      </a>\n-    </td>\n-    <td class="form-element">\n-      <input type="text" name="id;" value="chain;" size="70"\n-             tal:attributes="name string:chain_${tinfo/id};\n-                             value tinfo/chain"/>\n-    </td>\n-  </tr>\n+    <tr tal:repeat="tinfo options/types_info">\n+      <td class="form-label">\n+        <a tal:attributes="\n+             href string:${here/portal_url}/portal_types/${tinfo/id}/manage_workspace;\n+           ">\n+          <span tal:replace="tinfo/id"></span>\n+          <span tal:condition="tinfo/title"\n+                tal:replace="string:(${tinfo/title})"\n+          ></span>\n+        </a>\n+      </td>\n+      <td class="form-element">\n+        <input name="id;"\n+               size="70"\n+               type="text"\n+               value="chain;"\n+               tal:attributes="\n+                 name string:chain_${tinfo/id};\n+                 value tinfo/chain;\n+               "\n+        />\n+      </td>\n+    </tr>\n \n-  <tr>\n-    <td class="form-label" align="left">(Default)</td>\n-    <td class="form-element">\n-      <input type="text" name="default_chain" value="default_chain;" size="70"\n-             tal:attributes="value options/default_chain"/>\n-    </td>\n-  </tr>\n+    <tr>\n+      <td class="form-label"\n+          align="left"\n+      >(Default)</td>\n+      <td class="form-element">\n+        <input name="default_chain"\n+               size="70"\n+               type="text"\n+               value="default_chain;"\n+               tal:attributes="\n+                 value options/default_chain;\n+               "\n+        />\n+      </td>\n+    </tr>\n \n-</table>\n+  </table>\n \n-<input type="submit" name="submit" value="Change" />\n+  <input name="submit"\n+         type="submit"\n+         value="Change"\n+  />\n \n </form>\n \n@@ -64,9 +109,16 @@\n     workflow-aware objects in this portal.\n   </div>\n \n-  <form action="/portal_workflow/updateRoleMappings" method="POST"\n-        tal:attributes="action string:${here/portal_url}/portal_workflow/updateRoleMappings">\n-    <input type="submit" name="submit" value="Update security settings" />\n+  <form action="/portal_workflow/updateRoleMappings"\n+        method="POST"\n+        tal:attributes="\n+          action string:${here/portal_url}/portal_workflow/updateRoleMappings;\n+        "\n+  >\n+    <input name="submit"\n+           type="submit"\n+           value="Update security settings"\n+    />\n   </form>\n </div>\n \ndiff --git a/Products/CMFPlacefulWorkflow/www/manage_workflow_policy_config.zpt b/Products/CMFPlacefulWorkflow/www/manage_workflow_policy_config.zpt\nindex 6a66f1f..68d53b8 100644\n--- a/Products/CMFPlacefulWorkflow/www/manage_workflow_policy_config.zpt\n+++ b/Products/CMFPlacefulWorkflow/www/manage_workflow_policy_config.zpt\n@@ -1,6 +1,9 @@\n <h1 tal:replace="structure here/manage_page_header">Header</h1>\n-<h2 tal:define="manage_tabs_message options/manage_tabs_message | nothing"\n-    tal:replace="structure here/manage_tabs">Tabs</h2>\n+<h2 tal:define="\n+      manage_tabs_message options/manage_tabs_message | nothing;\n+    "\n+    tal:replace="structure here/manage_tabs"\n+>Tabs</h2>\n \n <h3>Manage workflow policy configuration</h3>\n \n@@ -8,65 +11,120 @@\n Workflow Policy Configurations for this folder and below.\n </p>\n \n-<form action="manage_makeChanges" method="POST"\n-      tal:define="policies here/portal_placeful_workflow/objectValues">\n-<table cellspacing="0" cellpadding="2" border="1">\n-  <tr>\n-    <td align="left" valign="middle">\n-      <div class="form-label">Workflow Policy in this folder</div>\n-    </td>\n-    <td align="left" valign="top">\n+<form action="manage_makeChanges"\n+      method="POST"\n+      tal:define="\n+        policies here/portal_placeful_workflow/objectValues;\n+      "\n+>\n+  <table border="1"\n+         cellpadding="2"\n+         cellspacing="0"\n+  >\n+    <tr>\n+      <td align="left"\n+          valign="middle"\n+      >\n+        <div class="form-label">Workflow Policy in this folder</div>\n+      </td>\n+      <td align="left"\n+          valign="top"\n+      >\n \n-      <input type="radio" name="workflow_policy_in" id="cb_in_default_policy" value=""\n-             tal:attributes="checked python:test(here.getPolicyInId() == \'\', \'checked\', None)"/>\n-      <label for="cb_default_policy">No policy: fallback to above policy or default site policy</label><br/>\n+        <input id="cb_in_default_policy"\n+               name="workflow_policy_in"\n+               type="radio"\n+               value=""\n+               tal:attributes="\n+                 checked python:test(here.getPolicyInId() == \'\', \'checked\', None);\n+               "\n+        />\n+        <label for="cb_default_policy">No policy: fallback to above policy or default site policy</label><br />\n \n-      <tal:block tal:repeat="policy policies">\n-        <input type="radio" name="workflow_policy_in" id="cb_in_value" value=""\n-               tal:attributes="value policy/getId;\n-                               id string:cb_in_${policy/getId};\n-                               checked python:test(policy.getId() == here.getPolicyInId(), \'checked\', None)"/>\n-        <label for="cb_in_value"\n-               tal:attributes="for string:cb_in_${policy/getId};"\n-               tal:content="policy/title_or_id"></label><br/>\n-      </tal:block>\n+        <tal:block tal:repeat="policy policies">\n+          <input id="cb_in_value"\n+                 name="workflow_policy_in"\n+                 type="radio"\n+                 value=""\n+                 tal:attributes="\n+                   value policy/getId;\n+                   id string:cb_in_${policy/getId};\n+                   checked python:test(policy.getId() == here.getPolicyInId(), \'checked\', None);\n+                 "\n+          />\n+          <label for="cb_in_value"\n+                 tal:content="policy/title_or_id"\n+                 tal:attributes="\n+                   for string:cb_in_${policy/getId};\n+                 "\n+          ></label><br />\n+        </tal:block>\n \n-    </td>\n-  </tr>\n-  <tr>\n-    <td align="left" valign="middle">\n-      <div class="form-label">Workflow Policy below this folder</div>\n-    </td>\n-    <td align="left" valign="top">\n+      </td>\n+    </tr>\n+    <tr>\n+      <td align="left"\n+          valign="middle"\n+      >\n+        <div class="form-label">Workflow Policy below this folder</div>\n+      </td>\n+      <td align="left"\n+          valign="top"\n+      >\n \n-      <input type="radio" name="workflow_policy_below" id="cb_below_default_policy" value=""\n-             tal:attributes="checked python:test(here.getPolicyBelowId() == \'\', \'checked\', None)"/>\n-      <label for="cb_default_policy">No policy: fallback to above policy or default site policy</label><br/>\n+        <input id="cb_below_default_policy"\n+               name="workflow_policy_below"\n+               type="radio"\n+               value=""\n+               tal:attributes="\n+                 checked python:test(here.getPolicyBelowId() == \'\', \'checked\', None);\n+               "\n+        />\n+        <label for="cb_default_policy">No policy: fallback to above policy or default site policy</label><br />\n \n-      <tal:block tal:repeat="policy policies">\n-        <input type="radio" name="workflow_policy_below" id="cb_below_value" value=""\n-               tal:attributes="value policy/getId;\n-                               id string:cb_below_${policy/getId};\n-                               checked python:test(policy.getId() == here.getPolicyBelowId(), \'checked\', None)"/>\n-        <label for="cb_below_value"\n-               tal:attributes="for string:cb_below_${policy/getId};"\n-               tal:content="policy/title_or_id"></label><br/>\n-      </tal:block>\n-    </td>\n-  </tr>\n-</table>\n-<table cellspacing="0" cellpadding="2" border="0">\n-  <tr>\n-    <td align="left" valign="top">\n-    </td>\n-    <td align="left" valign="top">\n-    <div class="form-element">\n-    <input class="form-element" type="submit" name="submit"\n-           value="Save Changes" />\n-    </div>\n-    </td>\n-  </tr>\n-</table>\n+        <tal:block tal:repeat="policy policies">\n+          <input id="cb_below_value"\n+                 name="workflow_policy_below"\n+                 type="radio"\n+                 value=""\n+                 tal:attributes="\n+                   value policy/getId;\n+                   id string:cb_below_${policy/getId};\n+                   checked python:test(policy.getId() == here.getPolicyBelowId(), \'checked\', None);\n+                 "\n+          />\n+          <label for="cb_below_value"\n+                 tal:content="policy/title_or_id"\n+                 tal:attributes="\n+                   for string:cb_below_${policy/getId};\n+                 "\n+          ></label><br />\n+        </tal:block>\n+      </td>\n+    </tr>\n+  </table>\n+  <table border="0"\n+         cellpadding="2"\n+         cellspacing="0"\n+  >\n+    <tr>\n+      <td align="left"\n+          valign="top"\n+      >\n+      </td>\n+      <td align="left"\n+          valign="top"\n+      >\n+        <div class="form-element">\n+          <input class="form-element"\n+                 name="submit"\n+                 type="submit"\n+                 value="Save Changes"\n+          />\n+        </div>\n+      </td>\n+    </tr>\n+  </table>\n </form>\n \n <h1 tal:replace="structure here/manage_page_footer">Footer</h1>\n'

Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2023-02-13T14:36:44+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/ce8ce3013aaeeb26e8e07ae9ba4a2bbe0f999a17

Rename test file so pytest finds it.

`bin/test -s Products.CMFPlacefulWorkflow` ran 25 tests, and pytest only 3.
With `bin/test -vvv` I saw that tests were found in `Products.CMFPlacefulWorkflow.tests.testCMFPlacefulWorkflow`.
Apparently `testCMFPlacefulWorkflow.py` is ignored by pytest, and you fix this by letting it start with `test_`.

Files changed:
A Products/CMFPlacefulWorkflow/tests/test_CMFPlacefulWorkflow.py
D Products/CMFPlacefulWorkflow/tests/testCMFPlacefulWorkflow.py

b'diff --git a/Products/CMFPlacefulWorkflow/tests/testCMFPlacefulWorkflow.py b/Products/CMFPlacefulWorkflow/tests/test_CMFPlacefulWorkflow.py\nsimilarity index 100%\nrename from Products/CMFPlacefulWorkflow/tests/testCMFPlacefulWorkflow.py\nrename to Products/CMFPlacefulWorkflow/tests/test_CMFPlacefulWorkflow.py\n'

