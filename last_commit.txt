Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-02-02T10:19:15+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/f8482e8d5ca4cbcfe26ed788f877f1b1396bbe78

Fix editing modal property when editing an action

Files changed:
A news/3709.bugfix
M Products/CMFPlone/controlpanel/browser/actions.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/actions.py b/Products/CMFPlone/controlpanel/browser/actions.py\nindex 4f66ab1e0a..dff7f3648c 100644\n--- a/Products/CMFPlone/controlpanel/browser/actions.py\n+++ b/Products/CMFPlone/controlpanel/browser/actions.py\n@@ -14,6 +14,8 @@\n from zope.interface import implementer\n from zope.lifecycleevent import ObjectCreatedEvent\n \n+import json\n+\n \n class ActionListControlPanel(BrowserView):\n     """Control panel for the portal actions."""\n@@ -163,6 +165,14 @@ def set_position(self, value):\n \n     position = property(get_position, set_position)\n \n+    def get_modal(self):\n+        return json.loads(self.context.modal)\n+\n+    def set_modal(self, value):\n+        self.context.modal = json.dumps(value)\n+\n+    modal = property(get_modal, set_modal)\n+\n \n class ActionControlPanel(AutoExtensibleForm, form.EditForm):\n     """A form to edit a portal action."""\ndiff --git a/news/3709.bugfix b/news/3709.bugfix\nnew file mode 100644\nindex 0000000000..b820562c53\n--- /dev/null\n+++ b/news/3709.bugfix\n@@ -0,0 +1,2 @@\n+Fix editing `modal` property of an action in `@@actions-controlpanel`.\n+[petschki]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-02-03T13:02:40+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/cd095abc3a5921f292147f4b6b2d407ca73e47e4

Get/set action modal: do not use json dumps/loads.

This actually does the wrong thing.

Files changed:
M Products/CMFPlone/controlpanel/browser/actions.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/actions.py b/Products/CMFPlone/controlpanel/browser/actions.py\nindex dff7f3648c..8b105155e9 100644\n--- a/Products/CMFPlone/controlpanel/browser/actions.py\n+++ b/Products/CMFPlone/controlpanel/browser/actions.py\n@@ -166,10 +166,10 @@ def set_position(self, value):\n     position = property(get_position, set_position)\n \n     def get_modal(self):\n-        return json.loads(self.context.modal)\n+        return self.context.modal\n \n     def set_modal(self, value):\n-        self.context.modal = json.dumps(value)\n+        self.context.modal = value\n \n     modal = property(get_modal, set_modal)\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-02-03T13:17:47+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/9d4c402c8e2b97033e717de189b15ef520093a05

When modal property does not yet exist, create it.

Files changed:
M Products/CMFPlone/controlpanel/browser/actions.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/actions.py b/Products/CMFPlone/controlpanel/browser/actions.py\nindex 8b105155e9..f8bd8cd049 100644\n--- a/Products/CMFPlone/controlpanel/browser/actions.py\n+++ b/Products/CMFPlone/controlpanel/browser/actions.py\n@@ -1,6 +1,7 @@\n from plone.autoform.form import AutoExtensibleForm\n from plone.base.interfaces import IActionSchema\n from plone.base.interfaces import INewActionSchema\n+from plone.base.utils import base_hasattr\n from Products.CMFCore.ActionInformation import Action\n from Products.CMFCore.interfaces import IAction\n from Products.CMFCore.interfaces import IActionCategory\n@@ -169,7 +170,15 @@ def get_modal(self):\n         return self.context.modal\n \n     def set_modal(self, value):\n-        self.context.modal = value\n+        # This property may not exist yet on the context.\n+        if not self.context.hasProperty("modal"):\n+            if base_hasattr(self.context, "modal"):\n+                # We cannot define a property when an attribute with the same\n+                # name already exists.\n+                delattr(self.context, "modal")\n+            self.context._setProperty(\'modal\', value, \'string\')\n+        else:\n+            self.context._setPropValue(\'modal\', value)\n \n     modal = property(get_modal, set_modal)\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-02-04T14:41:58+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/40a56e73a0944473e19f9d8eacc4136c9b9c6ce7

Merge pull request #3719 from plone/controlpanel-actions-modal-settings

Show `modal` property when editing an action

Files changed:
A news/3709.bugfix
M Products/CMFPlone/controlpanel/browser/actions.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/actions.py b/Products/CMFPlone/controlpanel/browser/actions.py\nindex 4f66ab1e0a..f8bd8cd049 100644\n--- a/Products/CMFPlone/controlpanel/browser/actions.py\n+++ b/Products/CMFPlone/controlpanel/browser/actions.py\n@@ -1,6 +1,7 @@\n from plone.autoform.form import AutoExtensibleForm\n from plone.base.interfaces import IActionSchema\n from plone.base.interfaces import INewActionSchema\n+from plone.base.utils import base_hasattr\n from Products.CMFCore.ActionInformation import Action\n from Products.CMFCore.interfaces import IAction\n from Products.CMFCore.interfaces import IActionCategory\n@@ -14,6 +15,8 @@\n from zope.interface import implementer\n from zope.lifecycleevent import ObjectCreatedEvent\n \n+import json\n+\n \n class ActionListControlPanel(BrowserView):\n     """Control panel for the portal actions."""\n@@ -163,6 +166,22 @@ def set_position(self, value):\n \n     position = property(get_position, set_position)\n \n+    def get_modal(self):\n+        return self.context.modal\n+\n+    def set_modal(self, value):\n+        # This property may not exist yet on the context.\n+        if not self.context.hasProperty("modal"):\n+            if base_hasattr(self.context, "modal"):\n+                # We cannot define a property when an attribute with the same\n+                # name already exists.\n+                delattr(self.context, "modal")\n+            self.context._setProperty(\'modal\', value, \'string\')\n+        else:\n+            self.context._setPropValue(\'modal\', value)\n+\n+    modal = property(get_modal, set_modal)\n+\n \n class ActionControlPanel(AutoExtensibleForm, form.EditForm):\n     """A form to edit a portal action."""\ndiff --git a/news/3709.bugfix b/news/3709.bugfix\nnew file mode 100644\nindex 0000000000..b820562c53\n--- /dev/null\n+++ b/news/3709.bugfix\n@@ -0,0 +1,2 @@\n+Fix editing `modal` property of an action in `@@actions-controlpanel`.\n+[petschki]\n'

