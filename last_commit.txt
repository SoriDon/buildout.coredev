Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-03-16T09:25:47+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/3061816dce48b25a75c7f77af764541508847ee5

Fixed tests when run with zope.component 5+.

See https://github.com/plone/plone.app.users/pull/107

Files changed:
A news/500.bugfix
M Products/CMFPlone/tests/testSecurity.py

b'diff --git a/Products/CMFPlone/tests/testSecurity.py b/Products/CMFPlone/tests/testSecurity.py\nindex ee2fa5c467..5286d8ee2a 100644\n--- a/Products/CMFPlone/tests/testSecurity.py\n+++ b/Products/CMFPlone/tests/testSecurity.py\n@@ -159,7 +159,8 @@ def get_admin_browser(self):\n         return browser\n \n     def test_plonetool(self):\n-        base_url = self.layer["portal"].absolute_url() + "/plone_utils"\n+        portal_url = self.layer["portal"].absolute_url()\n+        base_url = portal_url + "/plone_utils"\n         browser = self.get_admin_browser()\n         method_names = (\n             "addPortalMessage",\n@@ -173,6 +174,9 @@ def test_plonetool(self):\n             "normalizeString",\n             "getEmptyTitle",\n         )\n+        # First open a url that actually works.\n+        # This avoids an error with zope.component 5+.\n+        browser.open(portal_url)\n         for method_name in method_names:\n             with self.assertRaises(NotFound):\n                 browser.open(base_url + "/" + method_name)\n@@ -226,6 +230,9 @@ def test_hotfix_20160419(self):\n             "propertyLabel",\n             "propertyDescription",\n         )\n+        # First open a url that actually works.\n+        # This avoids an error with zope.component 5+.\n+        browser.open(portal_url)\n         for method_name in method_names:\n             with self.assertRaises(NotFound):\n                 browser.open(portal_url + "/" + method_name)\ndiff --git a/news/500.bugfix b/news/500.bugfix\nnew file mode 100644\nindex 0000000000..c9f39b6b50\n--- /dev/null\n+++ b/news/500.bugfix\n@@ -0,0 +1,2 @@\n+Fixed tests when run with ``zope.component`` 5+.\n+[maurits]\n'

