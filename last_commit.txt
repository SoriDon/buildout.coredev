Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2022-04-06T12:19:25+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.portlet.collection/commit/2d72a77c1b052a10f412de38df3cfb8b2fdd101d

Use @@iconresolver to display icons

Files changed:
M plone/portlet/collection/collection.pt

b'diff --git a/plone/portlet/collection/collection.pt b/plone/portlet/collection/collection.pt\nindex 3f38ff4..e829fbc 100644\n--- a/plone/portlet/collection/collection.pt\n+++ b/plone/portlet/collection/collection.pt\n@@ -8,7 +8,9 @@\n       tal:define="collection_url view/collection_url;\n                   plone_view context/@@plone;\n                   toLocalizedTime nocall:plone_view/toLocalizedTime;\n-                  viewActions python:context.portal_registry.get(\'plone.types_use_view_action_in_listings\', []);"\n+                  viewActions python:context.portal_registry.get(\'plone.types_use_view_action_in_listings\', []);\n+                  icons nocall:context/@@iconresolver;\n+                  normalizeString nocall:plone_view/normalizeString;"\n       tal:attributes="class string:card portlet portletCollection ${view/css_class}">\n \n     <div class="card-header">\n@@ -40,9 +42,11 @@\n               tal:attributes="href itemUrl;\n                               class  string:tile $item_type_class $item_wf_state_class;\n                               title obj/Description">\n-            <img class="mime-icon" tal:condition="python:item_type ==\'File\' and not supress_icon"\n-                tal:attributes="href obj/getURL;\n-                                src python:view.getMimeTypeIcon(obj);">\n+\n+            <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')" />\n+            <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'mimetype-{obj.mime_type}\')" />\n             <img tal:condition="python: obj.getIcon and thumb_scale and not supress_thumb"\n                 tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)" />\n \n'

Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2022-04-06T12:20:45+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.portlet.collection/commit/a012bbfb3bc4812dc5f186fc392ecb4bb7cebb20

changenote

Files changed:
A news/31.bugfix

b'diff --git a/news/31.bugfix b/news/31.bugfix\nnew file mode 100644\nindex 0000000..d14c37b\n--- /dev/null\n+++ b/news/31.bugfix\n@@ -0,0 +1,2 @@\n+Use @@iconresolver to display icons\n+[pbauer]\n\\ No newline at end of file\n'

Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2022-04-06T12:45:09+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.portlet.collection/commit/1a5848a17a76370f177c2f7845c3e8fdb88bac6a

fix test

Files changed:
M plone/portlet/collection/tests/functional.txt

b'diff --git a/plone/portlet/collection/tests/functional.txt b/plone/portlet/collection/tests/functional.txt\nindex 8169497..734684a 100644\n--- a/plone/portlet/collection/tests/functional.txt\n+++ b/plone/portlet/collection/tests/functional.txt\n@@ -93,6 +93,10 @@ Go to the home page and see if the portlet looks OK.\n     <ul>\n     <li class="portletItem odd">\n     <a href="http://nohost/plone/test-document" class="tile contenttype-document state-private" title="">\n+    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="plone-icon  bi bi-file-earmark-text" viewbox="0 0 16 16" aria-labelledby="title">\n+    <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>\n+    <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>\n+    <title/></svg>\n     Test Document\n     </a>\n     </li>\n'

Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2022-04-06T12:46:07+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.portlet.collection/commit/63dcfa6b99bd92ddc6b805e89ca33116c445f85b

Merge pull request #31 from plone/show_icons

Use @@iconresolver to display icons

Files changed:
A news/31.bugfix
M plone/portlet/collection/collection.pt
M plone/portlet/collection/tests/functional.txt

b'diff --git a/news/31.bugfix b/news/31.bugfix\nnew file mode 100644\nindex 0000000..d14c37b\n--- /dev/null\n+++ b/news/31.bugfix\n@@ -0,0 +1,2 @@\n+Use @@iconresolver to display icons\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/plone/portlet/collection/collection.pt b/plone/portlet/collection/collection.pt\nindex 3f38ff4..e829fbc 100644\n--- a/plone/portlet/collection/collection.pt\n+++ b/plone/portlet/collection/collection.pt\n@@ -8,7 +8,9 @@\n       tal:define="collection_url view/collection_url;\n                   plone_view context/@@plone;\n                   toLocalizedTime nocall:plone_view/toLocalizedTime;\n-                  viewActions python:context.portal_registry.get(\'plone.types_use_view_action_in_listings\', []);"\n+                  viewActions python:context.portal_registry.get(\'plone.types_use_view_action_in_listings\', []);\n+                  icons nocall:context/@@iconresolver;\n+                  normalizeString nocall:plone_view/normalizeString;"\n       tal:attributes="class string:card portlet portletCollection ${view/css_class}">\n \n     <div class="card-header">\n@@ -40,9 +42,11 @@\n               tal:attributes="href itemUrl;\n                               class  string:tile $item_type_class $item_wf_state_class;\n                               title obj/Description">\n-            <img class="mime-icon" tal:condition="python:item_type ==\'File\' and not supress_icon"\n-                tal:attributes="href obj/getURL;\n-                                src python:view.getMimeTypeIcon(obj);">\n+\n+            <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')" />\n+            <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'mimetype-{obj.mime_type}\')" />\n             <img tal:condition="python: obj.getIcon and thumb_scale and not supress_thumb"\n                 tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)" />\n \ndiff --git a/plone/portlet/collection/tests/functional.txt b/plone/portlet/collection/tests/functional.txt\nindex 8169497..734684a 100644\n--- a/plone/portlet/collection/tests/functional.txt\n+++ b/plone/portlet/collection/tests/functional.txt\n@@ -93,6 +93,10 @@ Go to the home page and see if the portlet looks OK.\n     <ul>\n     <li class="portletItem odd">\n     <a href="http://nohost/plone/test-document" class="tile contenttype-document state-private" title="">\n+    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="plone-icon  bi bi-file-earmark-text" viewbox="0 0 16 16" aria-labelledby="title">\n+    <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>\n+    <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>\n+    <title/></svg>\n     Test Document\n     </a>\n     </li>\n'

