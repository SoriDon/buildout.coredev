Repository: plone.app.users


Branch: refs/heads/master
Date: 2021-12-20T23:14:59+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.users/commit/b3613289df82b14899f2823d63f8801e02fceb8b

Test fix: remove deprecated ustring handling, which is only needed on Python 2.

Part of https://github.com/plone/Products.CMFPlone/issues/3305

Files changed:
A news/3305.bugfix
M plone/app/users/tests/personal_preferences_prefs_user_details.rst
M plone/app/users/tests/test_doctests.py
M plone/app/users/tests/userdata_prefs_user_details.rst

b'diff --git a/news/3305.bugfix b/news/3305.bugfix\nnew file mode 100644\nindex 0000000..520e3ff\n--- /dev/null\n+++ b/news/3305.bugfix\n@@ -0,0 +1,2 @@\n+Test fix: remove deprecated ustring handling, which is only needed on Python 2.\n+[maurits]\ndiff --git a/plone/app/users/tests/personal_preferences_prefs_user_details.rst b/plone/app/users/tests/personal_preferences_prefs_user_details.rst\nindex 3dca17c..6514165 100644\n--- a/plone/app/users/tests/personal_preferences_prefs_user_details.rst\n+++ b/plone/app/users/tests/personal_preferences_prefs_user_details.rst\n@@ -114,7 +114,5 @@ form::\n     >>> browser.getControl(\'Cancel\').click()\n     >>> \'Changes canceled.\' in browser.contents\n     True\n-    >>> import six\n-    >>> searchstring = \'?userid:utf8:ustring=test_user_1_\' if six.PY2 else \'?userid=test_user_1_\'\n-    >>> searchstring in browser.url\n+    >>> \'?userid=test_user_1_\' in browser.url\n     True\ndiff --git a/plone/app/users/tests/test_doctests.py b/plone/app/users/tests/test_doctests.py\nindex e4f4f34..57bd419 100644\n--- a/plone/app/users/tests/test_doctests.py\n+++ b/plone/app/users/tests/test_doctests.py\n@@ -3,8 +3,6 @@\n from plone.testing import layered\n \n import doctest\n-import re\n-import six\n import unittest\n \n \n@@ -30,16 +28,6 @@\n )\n \n \n-class Py23DocChecker(doctest.OutputChecker):\n-    def check_output(self, want, got, optionflags):\n-        if six.PY2:\n-            got = got.replace(\'Unauthorized\', \'zExceptions.unauthorized.Unauthorized\')\n-            got = got.replace(\':utf8:ustring\', \'\')\n-            got = re.sub("u\'(.*?)\'", "\'\\\\1\'", got)\n-            want = re.sub("b\'(.*?)\'", "\'\\\\1\'", want)\n-        return doctest.OutputChecker.check_output(self, want, got, optionflags)\n-\n-\n def test_suite():\n     suite = unittest.TestSuite()\n     suite.addTests([\n@@ -48,7 +36,6 @@ def test_suite():\n                 \'tests/{0}\'.format(test_file),\n                 package=\'plone.app.users\',\n                 optionflags=optionflags,\n-                checker=Py23DocChecker(),\n             ),\n             layer=PLONE_APP_USERS_FUNCTIONAL_TESTING)\n         for test_file in doc_tests\ndiff --git a/plone/app/users/tests/userdata_prefs_user_details.rst b/plone/app/users/tests/userdata_prefs_user_details.rst\nindex 02f3dea..3c3dd2c 100644\n--- a/plone/app/users/tests/userdata_prefs_user_details.rst\n+++ b/plone/app/users/tests/userdata_prefs_user_details.rst\n@@ -15,10 +15,6 @@ Set Up\n     >>> membership = portal.portal_membership\n \n     >>> user_information_url = \'http://nohost/plone/@@user-information?userid={0}\'.format(TEST_USER_ID)\n-    >>> import six\n-    >>> if six.PY2:\n-    ...     user_information_url = \'http://nohost/plone/@@user-information?userid:utf8:ustring=test_user_1_\'\n-\n     >>> browser = Browser(app)\n     >>> browser.handleErrors = False\n \n'

Repository: plone.app.users


Branch: refs/heads/master
Date: 2021-12-22T11:56:39+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.users/commit/cbc647498d2d28da25b3cd3e078b5b33299839c3

Merge pull request #105 from plone/maurits-cleanup-ustring

Test fix: remove deprecated ustring handling, which is only needed on Py2

Files changed:
A news/3305.bugfix
M plone/app/users/tests/personal_preferences_prefs_user_details.rst
M plone/app/users/tests/test_doctests.py
M plone/app/users/tests/userdata_prefs_user_details.rst

b'diff --git a/news/3305.bugfix b/news/3305.bugfix\nnew file mode 100644\nindex 0000000..520e3ff\n--- /dev/null\n+++ b/news/3305.bugfix\n@@ -0,0 +1,2 @@\n+Test fix: remove deprecated ustring handling, which is only needed on Python 2.\n+[maurits]\ndiff --git a/plone/app/users/tests/personal_preferences_prefs_user_details.rst b/plone/app/users/tests/personal_preferences_prefs_user_details.rst\nindex 3dca17c..6514165 100644\n--- a/plone/app/users/tests/personal_preferences_prefs_user_details.rst\n+++ b/plone/app/users/tests/personal_preferences_prefs_user_details.rst\n@@ -114,7 +114,5 @@ form::\n     >>> browser.getControl(\'Cancel\').click()\n     >>> \'Changes canceled.\' in browser.contents\n     True\n-    >>> import six\n-    >>> searchstring = \'?userid:utf8:ustring=test_user_1_\' if six.PY2 else \'?userid=test_user_1_\'\n-    >>> searchstring in browser.url\n+    >>> \'?userid=test_user_1_\' in browser.url\n     True\ndiff --git a/plone/app/users/tests/test_doctests.py b/plone/app/users/tests/test_doctests.py\nindex e4f4f34..57bd419 100644\n--- a/plone/app/users/tests/test_doctests.py\n+++ b/plone/app/users/tests/test_doctests.py\n@@ -3,8 +3,6 @@\n from plone.testing import layered\n \n import doctest\n-import re\n-import six\n import unittest\n \n \n@@ -30,16 +28,6 @@\n )\n \n \n-class Py23DocChecker(doctest.OutputChecker):\n-    def check_output(self, want, got, optionflags):\n-        if six.PY2:\n-            got = got.replace(\'Unauthorized\', \'zExceptions.unauthorized.Unauthorized\')\n-            got = got.replace(\':utf8:ustring\', \'\')\n-            got = re.sub("u\'(.*?)\'", "\'\\\\1\'", got)\n-            want = re.sub("b\'(.*?)\'", "\'\\\\1\'", want)\n-        return doctest.OutputChecker.check_output(self, want, got, optionflags)\n-\n-\n def test_suite():\n     suite = unittest.TestSuite()\n     suite.addTests([\n@@ -48,7 +36,6 @@ def test_suite():\n                 \'tests/{0}\'.format(test_file),\n                 package=\'plone.app.users\',\n                 optionflags=optionflags,\n-                checker=Py23DocChecker(),\n             ),\n             layer=PLONE_APP_USERS_FUNCTIONAL_TESTING)\n         for test_file in doc_tests\ndiff --git a/plone/app/users/tests/userdata_prefs_user_details.rst b/plone/app/users/tests/userdata_prefs_user_details.rst\nindex 02f3dea..3c3dd2c 100644\n--- a/plone/app/users/tests/userdata_prefs_user_details.rst\n+++ b/plone/app/users/tests/userdata_prefs_user_details.rst\n@@ -15,10 +15,6 @@ Set Up\n     >>> membership = portal.portal_membership\n \n     >>> user_information_url = \'http://nohost/plone/@@user-information?userid={0}\'.format(TEST_USER_ID)\n-    >>> import six\n-    >>> if six.PY2:\n-    ...     user_information_url = \'http://nohost/plone/@@user-information?userid:utf8:ustring=test_user_1_\'\n-\n     >>> browser = Browser(app)\n     >>> browser.handleErrors = False\n \n'

