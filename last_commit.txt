Repository: plone.app.caching


Branch: refs/heads/master
Date: 2022-11-04T10:41:15+01:00
Author: SÃ©bastien Verbois (sverbois) <sebastien.verbois@imio.be>
Commit: https://github.com/plone/plone.app.caching/commit/d0aac88bd60c59a768fa13fb9b1337cd0de4a9ba

Add missing quotation mark in Etag 304 Response

Files changed:
A news/104.bugfix
M plone/app/caching/operations/utils.py
M plone/app/caching/tests/test_operation_utils.py

b'diff --git a/news/104.bugfix b/news/104.bugfix\nnew file mode 100644\nindex 0000000..899fb77\n--- /dev/null\n+++ b/news/104.bugfix\n@@ -0,0 +1 @@\n+Add missing quotation mark in Etag 304 Response [sverbois]\ndiff --git a/plone/app/caching/operations/utils.py b/plone/app/caching/operations/utils.py\nindex 2d8327f..1c25c41 100644\n--- a/plone/app/caching/operations/utils.py\n+++ b/plone/app/caching/operations/utils.py\n@@ -302,7 +302,7 @@ def notModified(published, request, response, etag=None, lastModified=None):\n     """\n \n     if etag is not None:\n-        response.setHeader("ETag", etag, literal=1)\n+        response.setHeader("ETag", f\'"{etag}"\', literal=1)\n \n     # Specs say that Last-Modified MUST NOT be included in a 304\n     # and Cache-Control/Expires MUST NOT be included unless they\ndiff --git a/plone/app/caching/tests/test_operation_utils.py b/plone/app/caching/tests/test_operation_utils.py\nindex 4a60ee1..9e2a657 100644\n--- a/plone/app/caching/tests/test_operation_utils.py\n+++ b/plone/app/caching/tests/test_operation_utils.py\n@@ -529,7 +529,7 @@ def test_notModified_full(self):\n         body = notModified(published, request, response, etag=etag, lastModified=now)\n \n         self.assertEqual("", body)\n-        self.assertEqual(etag, response.getHeader("ETag", literal=1))\n+        self.assertEqual(\'"|foo|bar|"\', response.getHeader("ETag", literal=1))\n         self.assertIsNone(response.getHeader("Last-Modified"))\n         self.assertIsNone(response.getHeader("Expires"))\n         self.assertIsNone(response.getHeader("Cache-Control"))\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2022-11-04T17:38:55+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.caching/commit/95db3ea7747f96770c8df97f9da49b9d21482873

Merge pull request #105 from plone/fix-304-etag

Add missing quotation mark in Etag 304 Response

Files changed:
A news/104.bugfix
M plone/app/caching/operations/utils.py
M plone/app/caching/tests/test_operation_utils.py

b'diff --git a/news/104.bugfix b/news/104.bugfix\nnew file mode 100644\nindex 0000000..899fb77\n--- /dev/null\n+++ b/news/104.bugfix\n@@ -0,0 +1 @@\n+Add missing quotation mark in Etag 304 Response [sverbois]\ndiff --git a/plone/app/caching/operations/utils.py b/plone/app/caching/operations/utils.py\nindex 2d8327f..1c25c41 100644\n--- a/plone/app/caching/operations/utils.py\n+++ b/plone/app/caching/operations/utils.py\n@@ -302,7 +302,7 @@ def notModified(published, request, response, etag=None, lastModified=None):\n     """\n \n     if etag is not None:\n-        response.setHeader("ETag", etag, literal=1)\n+        response.setHeader("ETag", f\'"{etag}"\', literal=1)\n \n     # Specs say that Last-Modified MUST NOT be included in a 304\n     # and Cache-Control/Expires MUST NOT be included unless they\ndiff --git a/plone/app/caching/tests/test_operation_utils.py b/plone/app/caching/tests/test_operation_utils.py\nindex 4a60ee1..9e2a657 100644\n--- a/plone/app/caching/tests/test_operation_utils.py\n+++ b/plone/app/caching/tests/test_operation_utils.py\n@@ -529,7 +529,7 @@ def test_notModified_full(self):\n         body = notModified(published, request, response, etag=etag, lastModified=now)\n \n         self.assertEqual("", body)\n-        self.assertEqual(etag, response.getHeader("ETag", literal=1))\n+        self.assertEqual(\'"|foo|bar|"\', response.getHeader("ETag", literal=1))\n         self.assertIsNone(response.getHeader("Last-Modified"))\n         self.assertIsNone(response.getHeader("Expires"))\n         self.assertIsNone(response.getHeader("Cache-Control"))\n'

