Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-11-21T22:21:07+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.restapi/commit/4f2ed6652a8d8dadf22a33db408481d76d9a70bf

fix: pas plugin was missing after install

Files changed:
A news/1269.bugfix
M src/plone/restapi/configure.zcml
M src/plone/restapi/setuphandlers.py
D src/plone/restapi/profiles/default/plone.restapi_various.txt

b'diff --git a/news/1269.bugfix b/news/1269.bugfix\nnew file mode 100644\nindex 000000000..8c048557f\n--- /dev/null\n+++ b/news/1269.bugfix\n@@ -0,0 +1 @@\n+Fix installation of JWT PAS plugin with default profile. [jensens]\ndiff --git a/src/plone/restapi/configure.zcml b/src/plone/restapi/configure.zcml\nindex 9f5fcaf2c..5fcfb0e47 100644\n--- a/src/plone/restapi/configure.zcml\n+++ b/src/plone/restapi/configure.zcml\n@@ -37,6 +37,7 @@\n       description="RESTful hypermedia API for Plone."\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       directory="profiles/default"\n+      post_handler=".setuphandlers.post_install_default"\n       />\n \n   <genericsetup:registerProfile\n@@ -73,14 +74,6 @@\n       directory="profiles/blocks"\n       />\n \n-  <!-- Register "various" import step -->\n-  <genericsetup:importStep\n-      name="plone.restapi"\n-      title="plone.restapi special import handlers"\n-      description=""\n-      handler="plone.restapi.setuphandlers.import_various"\n-      />\n-\n   <genericsetup:registerProfile\n       name="uninstall"\n       title="plone.restapi"\ndiff --git a/src/plone/restapi/profiles/default/plone.restapi_various.txt b/src/plone/restapi/profiles/default/plone.restapi_various.txt\ndeleted file mode 100644\nindex e69de29bb..000000000\ndiff --git a/src/plone/restapi/setuphandlers.py b/src/plone/restapi/setuphandlers.py\nindex 661f7eea7..2755e39a5 100644\n--- a/src/plone/restapi/setuphandlers.py\n+++ b/src/plone/restapi/setuphandlers.py\n@@ -6,6 +6,7 @@\n from Products.PluggableAuthService.interfaces.authservice import (\n     IPluggableAuthService,\n )  # noqa: E501\n+from zope.component.hooks import getSite\n from zope.interface import implementer\n \n \n@@ -45,10 +46,7 @@ def install_pas_plugin(context):\n         uf_parent = aq_parent(uf_parent)\n \n \n-def import_various(context):\n-    """Miscellanous steps import handle"""\n-    if context.readDataFile("plone.restapi_various.txt") is None:\n-        return\n-\n-    site = context.getSite()\n+def post_install_default(context):\n+    """Post install of default profile"""\n+    site = getSite()\n     install_pas_plugin(site)\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-11-22T21:57:18+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.restapi/commit/1c0f3d1c6a19d03b1377e4dfbcf3813feeb71862

Merge pull request #1269 from plone/fix-install-pasplugin

fix: pas plugin was missing after install

Files changed:
A news/1269.bugfix
M src/plone/restapi/configure.zcml
M src/plone/restapi/setuphandlers.py
D src/plone/restapi/profiles/default/plone.restapi_various.txt

b'diff --git a/news/1269.bugfix b/news/1269.bugfix\nnew file mode 100644\nindex 000000000..8c048557f\n--- /dev/null\n+++ b/news/1269.bugfix\n@@ -0,0 +1 @@\n+Fix installation of JWT PAS plugin with default profile. [jensens]\ndiff --git a/src/plone/restapi/configure.zcml b/src/plone/restapi/configure.zcml\nindex 9f5fcaf2c..5fcfb0e47 100644\n--- a/src/plone/restapi/configure.zcml\n+++ b/src/plone/restapi/configure.zcml\n@@ -37,6 +37,7 @@\n       description="RESTful hypermedia API for Plone."\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       directory="profiles/default"\n+      post_handler=".setuphandlers.post_install_default"\n       />\n \n   <genericsetup:registerProfile\n@@ -73,14 +74,6 @@\n       directory="profiles/blocks"\n       />\n \n-  <!-- Register "various" import step -->\n-  <genericsetup:importStep\n-      name="plone.restapi"\n-      title="plone.restapi special import handlers"\n-      description=""\n-      handler="plone.restapi.setuphandlers.import_various"\n-      />\n-\n   <genericsetup:registerProfile\n       name="uninstall"\n       title="plone.restapi"\ndiff --git a/src/plone/restapi/profiles/default/plone.restapi_various.txt b/src/plone/restapi/profiles/default/plone.restapi_various.txt\ndeleted file mode 100644\nindex e69de29bb..000000000\ndiff --git a/src/plone/restapi/setuphandlers.py b/src/plone/restapi/setuphandlers.py\nindex 661f7eea7..2755e39a5 100644\n--- a/src/plone/restapi/setuphandlers.py\n+++ b/src/plone/restapi/setuphandlers.py\n@@ -6,6 +6,7 @@\n from Products.PluggableAuthService.interfaces.authservice import (\n     IPluggableAuthService,\n )  # noqa: E501\n+from zope.component.hooks import getSite\n from zope.interface import implementer\n \n \n@@ -45,10 +46,7 @@ def install_pas_plugin(context):\n         uf_parent = aq_parent(uf_parent)\n \n \n-def import_various(context):\n-    """Miscellanous steps import handle"""\n-    if context.readDataFile("plone.restapi_various.txt") is None:\n-        return\n-\n-    site = context.getSite()\n+def post_install_default(context):\n+    """Post install of default profile"""\n+    site = getSite()\n     install_pas_plugin(site)\n'

