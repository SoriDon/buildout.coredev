Repository: mockup


Branch: refs/heads/master
Date: 2017-06-14T16:00:50-06:00
Author: Sean Upton (seanupton) <sdupton@gmail.com>
Commit: https://github.com/plone/mockup/commit/4e9101d7fda53dc2904c2178038af9e8dc4ebc56

formunloadalert pattern incorrectly used Function.prototype.apply where
call (single argument) was intended in modal close scenario; this lead
to exception, now fixed.

Files changed:
M CHANGES.rst
M mockup/patterns/formunloadalert/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 26ed1ab3..64dad350 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -50,6 +50,11 @@ New features:
 
 Bug fixes:
 
+- formunloadalert: Fixed incorrect use of Function.prototype.apply,
+  when call() was seemingly intended; fixes case where modal close leads to
+  exception.  Fixes `issue 776 <https://github.com/plone/mockup/issues/776>`_.
+  [seanupton]
+
 - In the insert link/image modal, pass use the correct related items widget options from the ``linkModal`` attribute.
   [thet]
 
diff --git a/mockup/patterns/formunloadalert/pattern.js b/mockup/patterns/formunloadalert/pattern.js
index 1988efaa..f79d3992 100644
--- a/mockup/patterns/formunloadalert/pattern.js
+++ b/mockup/patterns/formunloadalert/pattern.js
@@ -65,7 +65,7 @@ define([
         $modal.data('patternPloneModal').on('hide', function(e) {
           var modal = $modal.data('patternPloneModal');
           if (modal) {
-            modal._suppressHide = self._handleUnload.apply(self, e);
+            modal._suppressHide = self._handleUnload.call(self, e);
           }
         });
       } else {


Repository: mockup


Branch: refs/heads/master
Date: 2017-06-14T16:05:49-06:00
Author: Sean Upton (seanupton) <sdupton@gmail.com>
Commit: https://github.com/plone/mockup/commit/d28449d58d39e9b7d95af82b54aa2b13a575002b

Fix #777, modal duplicate window.confirm on close of modal form

Files changed:
M CHANGES.rst
M mockup/patterns/modal/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 64dad350..9cb139ae 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -50,6 +50,10 @@ New features:
 
 Bug fixes:
 
+- modal: Fixed duplicate window.confirm on form unload.
+  Fixes `issue 777 <https://github.com/plone/mockup/issues/777>`_.
+  [seanupton]
+
 - formunloadalert: Fixed incorrect use of Function.prototype.apply,
   when call() was seemingly intended; fixes case where modal close leads to
   exception.  Fixes `issue 776 <https://github.com/plone/mockup/issues/776>`_.
diff --git a/mockup/patterns/modal/pattern.js b/mockup/patterns/modal/pattern.js
index 21673a4f..c3dbadea 100644
--- a/mockup/patterns/modal/pattern.js
+++ b/mockup/patterns/modal/pattern.js
@@ -872,6 +872,7 @@ define([
       }
       self.$wrapper.remove();
       if ($('.plone-modal', $('body')).size() < 1) {
+        self._suppressHide = undefined;
         self.backdrop.hide();
         $('body').removeClass('plone-modal-open');
         $(window.parent).off('resize.plone-modal.patterns');


Repository: mockup


Branch: refs/heads/master
Date: 2017-06-17T09:51:47+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/mockup/commit/350df36af1d4ae5b82491e288f1f5a41432b18b7

Merge pull request #778 from upiq/master

Fix two issues with form modals

Files changed:
M CHANGES.rst
M mockup/patterns/formunloadalert/pattern.js
M mockup/patterns/modal/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 26ed1ab3..9cb139ae 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -50,6 +50,15 @@ New features:
 
 Bug fixes:
 
+- modal: Fixed duplicate window.confirm on form unload.
+  Fixes `issue 777 <https://github.com/plone/mockup/issues/777>`_.
+  [seanupton]
+
+- formunloadalert: Fixed incorrect use of Function.prototype.apply,
+  when call() was seemingly intended; fixes case where modal close leads to
+  exception.  Fixes `issue 776 <https://github.com/plone/mockup/issues/776>`_.
+  [seanupton]
+
 - In the insert link/image modal, pass use the correct related items widget options from the ``linkModal`` attribute.
   [thet]
 
diff --git a/mockup/patterns/formunloadalert/pattern.js b/mockup/patterns/formunloadalert/pattern.js
index 1988efaa..f79d3992 100644
--- a/mockup/patterns/formunloadalert/pattern.js
+++ b/mockup/patterns/formunloadalert/pattern.js
@@ -65,7 +65,7 @@ define([
         $modal.data('patternPloneModal').on('hide', function(e) {
           var modal = $modal.data('patternPloneModal');
           if (modal) {
-            modal._suppressHide = self._handleUnload.apply(self, e);
+            modal._suppressHide = self._handleUnload.call(self, e);
           }
         });
       } else {
diff --git a/mockup/patterns/modal/pattern.js b/mockup/patterns/modal/pattern.js
index 21673a4f..c3dbadea 100644
--- a/mockup/patterns/modal/pattern.js
+++ b/mockup/patterns/modal/pattern.js
@@ -872,6 +872,7 @@ define([
       }
       self.$wrapper.remove();
       if ($('.plone-modal', $('body')).size() < 1) {
+        self._suppressHide = undefined;
         self.backdrop.hide();
         $('body').removeClass('plone-modal-open');
         $(window.parent).off('resize.plone-modal.patterns');


