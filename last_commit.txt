Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-12-13T10:31:46+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/ab23d5190daead3b67ae403d6e279becf0717ed4

fixes #1846

Files changed:
M CHANGES.rst
M Products/CMFPlone/_scripts/_generate_gruntfile.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2fd2efb..77026ef 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -223,6 +223,9 @@ Bug fixes:
 
 - Include inactive content in worklists.  [sebasgo]
 
+- Fix #1846 plone-compile-resources: Missing Support for Sites in Mountpoints
+  [jensens]
+
 5.1a2 (2016-08-19)
 ------------------
 
diff --git a/Products/CMFPlone/_scripts/_generate_gruntfile.py b/Products/CMFPlone/_scripts/_generate_gruntfile.py
index c9a6340..7d8da1e 100644
--- a/Products/CMFPlone/_scripts/_generate_gruntfile.py
+++ b/Products/CMFPlone/_scripts/_generate_gruntfile.py
@@ -38,7 +38,11 @@
     compile_path = os.environ['COMPILE_DIR']
 print('Target compile path: {0}'.format(compile_path or 'fetch from bundles'))
 
-portal = app[site_id]  # noqa
+# app was injected by the script calling instance
+current = app  # noqa
+for part in site_id.split('/'):
+    current = current[part]
+portal = current
 setSite(portal)
 
 # start the juicy stuff


