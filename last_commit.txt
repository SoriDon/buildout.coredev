Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2017-02-05T20:42:33+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.ATContentTypes/commit/ad1c90b036fb4559f48e9eed6d956db2d8107978

Fix doctest

The last line results in "KeyError: 0" since data is a list of ZPublisher.HTTPRequest.record instances which calls self.__dict__[key] on __getitem__.

Files changed:
M CHANGES.rst
M Products/ATContentTypes/tool/topic.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c7e15c2..89c97ff 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- Fix tests on Zope 4. [davisagli]
+- Fix tests on Zope 4. 
+  [davisagli, pbauer, mauritsvanrees]
 
 
 2.3.2 (2017-01-20)
diff --git a/Products/ATContentTypes/tool/topic.py b/Products/ATContentTypes/tool/topic.py
index 721d875..4a0961a 100644
--- a/Products/ATContentTypes/tool/topic.py
+++ b/Products/ATContentTypes/tool/topic.py
@@ -317,14 +317,14 @@ def manage_saveTopicSetup(self, REQUEST=None):
 
         data = REQUEST.get('index', [])
         for index in data:
-            enabled = 'enabled' in index
+            enabled = 'enabled' in index.keys()
             criteria = index.get('criteria', ())
             self.updateIndex(index['index'], index['friendlyName'], index[
                              'description'], enabled, criteria)
 
         meta = REQUEST.get('metadata', [])
         for metadata in meta:
-            enabled = 'enabled' in metadata
+            enabled = 'enabled' in metadata.keys()
             self.updateMetadata(
                 metadata['index'],
                 metadata['friendlyName'],


Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2017-02-05T20:43:12+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.ATContentTypes/commit/5fb71953e842243a470619f0fde00e6782a130c4

Merge pull request #41 from plone/plonezope4

Fix doctest

Files changed:
M CHANGES.rst
M Products/ATContentTypes/tool/topic.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c7e15c2..89c97ff 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- Fix tests on Zope 4. [davisagli]
+- Fix tests on Zope 4. 
+  [davisagli, pbauer, mauritsvanrees]
 
 
 2.3.2 (2017-01-20)
diff --git a/Products/ATContentTypes/tool/topic.py b/Products/ATContentTypes/tool/topic.py
index 721d875..4a0961a 100644
--- a/Products/ATContentTypes/tool/topic.py
+++ b/Products/ATContentTypes/tool/topic.py
@@ -317,14 +317,14 @@ def manage_saveTopicSetup(self, REQUEST=None):
 
         data = REQUEST.get('index', [])
         for index in data:
-            enabled = 'enabled' in index
+            enabled = 'enabled' in index.keys()
             criteria = index.get('criteria', ())
             self.updateIndex(index['index'], index['friendlyName'], index[
                              'description'], enabled, criteria)
 
         meta = REQUEST.get('metadata', [])
         for metadata in meta:
-            enabled = 'enabled' in metadata
+            enabled = 'enabled' in metadata.keys()
             self.updateMetadata(
                 metadata['index'],
                 metadata['friendlyName'],


