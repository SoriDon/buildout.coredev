Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2022-06-09T00:06:04+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.schemaeditor/commit/39c07ec6cfccc210e1b2bbfa2a543fb0980b2189

Robot tests: wait until overlay is closed.

Use the correct selector to check for the overlay: it is no longer `div.overlay`, but `div.modal-wrapper`.
Wait only 8 seconds instead of 60 for this check to be true.
Also use 'Wait For Then Click Element' for good measure.

This is an attempt to make robot tests more stable
I still sometimes see a test fail, becase the popup/modal/overlay is still open after clicking a button.  This might fix it.

Update: no it does not.  But the updated checks at least make it clear that a popup is still open, which is the reason why some other expected text is not visible.

Files changed:
M plone/schemaeditor/tests/robot/test_fields.robot

b'diff --git a/plone/schemaeditor/tests/robot/test_fields.robot b/plone/schemaeditor/tests/robot/test_fields.robot\nindex deb9f09..0657a03 100644\n--- a/plone/schemaeditor/tests/robot/test_fields.robot\n+++ b/plone/schemaeditor/tests/robot/test_fields.robot\n@@ -20,9 +20,8 @@ Add a content type\n     Input text for sure  form-widgets-title  New style Article\n     Set Focus to Element  form-widgets-id\n     Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-id  new_style_article\n-    Set Focus To Element  css=.modal-footer #form-buttons-add\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-add\n-    Click button  css=.modal-footer #form-buttons-add\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n+    Wait overlay is closed\n     Wait until page contains  New style Article\n \n \n@@ -37,13 +36,12 @@ Add a choice field with a named vocabulary\n     Input text for sure  form-widgets-description  Spoken languages\n     Wait until keyword succeeds  10  1  Select From List By Label  form-widgets-factory  Multiple Choice\n     Wait until keyword succeeds  10  1  Click button  css=.modal-footer #form-buttons-add\n+    Wait overlay is closed\n     Wait until page contains element  css=div[data-field_id="languages"] a.fieldSettings\n \n     Open field settings  languages\n     Select from list by value  form-widgets-vocabularyName  plone.app.vocabularies.AvailableContentLanguages\n-    Set Focus To Element  css=.modal-footer #form-buttons-save\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-save\n-    Click button  css=.modal-footer #form-buttons-save\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-save\n     Wait overlay is closed\n     Page should contain  Fran\xc3\xa7ais\n \n@@ -55,9 +53,8 @@ Add a choice field with vocabulary values\n     Add field  Hobbies  hobbies  Multiple Choice\n     Open field settings  hobbies\n     Input text  form-widgets-values  Chess\\nSoccer\\nBaseball\\nVideo games\n-    Set Focus To Element  css=.modal-footer #form-buttons-save\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-save\n-    Click button  css=.modal-footer #form-buttons-save\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-save\n+    Wait overlay is closed\n     Wait until page contains element  form-widgets-hobbies-3\n \n #fail on jenkins\n@@ -93,9 +90,7 @@ Add a fieldSet and move a field into this fieldset\n     Input text for sure  form-widgets-label  Personal information\n     Set Focus to Element  form-widgets-__name__\n     Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  personal_information\n-    Set Focus To Element  css=.modal-footer #form-buttons-add\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-add\n-    Click button  css=.modal-footer #form-buttons-add\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n     Wait overlay is closed\n     Wait until page contains  Personal information\n \n@@ -131,7 +126,7 @@ Delete field\n     Go to dexterity types configuration\n     Add content type  Somebody  somebody\n     Add field  Phone  phone  Text line (String)\n-    Wait until page contains element  css=#fieldset-0 #formfield-form-widgets-phone\n+    Wait For Element  css=#fieldset-0 #formfield-form-widgets-phone\n     Click link  css=div.fieldControls .schemaeditor-delete-field\n     Handle alert\n     Wait Until Keyword Succeeds  10  1  Page Should Not Contain Element  css=#formfield-form-widgets-phone\n@@ -157,7 +152,7 @@ Delete field\n *** Keywords ***\n \n Wait overlay is closed\n-    Wait until keyword succeeds  60  1  Page should not contain element  css=div.overlay\n+    Wait until keyword succeeds  8  1  Page should not contain element  css=div.modal-wrapper\n \n Go to dexterity types configuration\n     Enable autologin as  Manager\n@@ -171,9 +166,8 @@ Add content type\n     Input text for sure  form-widgets-title  ${title}\n     Set Focus to Element  form-widgets-id\n     Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-id  ${id}\n-    Set Focus To Element  css=.modal-footer #form-buttons-add\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-add\n-    Click button  css=.modal-footer #form-buttons-add\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n+    Wait overlay is closed\n     Wait until page contains  ${title}\n     Go to  ${PLONE_URL}/@@dexterity-types/${id}/@@fields\n     Wait until page contains  Fields\n@@ -187,13 +181,11 @@ Add field\n     Set Focus to Element  form-widgets-__name__\n     Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  ${field_id}\n     Select from list by label  form-widgets-factory  ${field_type}\n-    Set Focus To Element  css=.modal-footer #form-buttons-add\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-add\n-    Click button  css=.modal-footer #form-buttons-add\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n     Wait overlay is closed\n \n Open field settings\n     [Arguments]    ${field_id}\n     ${locator}  Set Variable  //div[@data-field_id=\'${field_id}\']//a[contains(@class, \'fieldSettings pat-plone-modal\')]\n-    Wait until element is visible  xpath=${locator}\n+    Wait For Element  xpath=${locator}\n     Click Overlay Link  xpath=${locator}\n'

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2022-06-09T09:13:56+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.schemaeditor/commit/43cbb5357e53a0db8c9b53b3ff7042a0f0b0cba7

Merge pull request #90 from plone/fix-robottests-2

Robot tests: wait until overlay is closed.

Files changed:
M plone/schemaeditor/tests/robot/test_fields.robot

b'diff --git a/plone/schemaeditor/tests/robot/test_fields.robot b/plone/schemaeditor/tests/robot/test_fields.robot\nindex deb9f09..0657a03 100644\n--- a/plone/schemaeditor/tests/robot/test_fields.robot\n+++ b/plone/schemaeditor/tests/robot/test_fields.robot\n@@ -20,9 +20,8 @@ Add a content type\n     Input text for sure  form-widgets-title  New style Article\n     Set Focus to Element  form-widgets-id\n     Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-id  new_style_article\n-    Set Focus To Element  css=.modal-footer #form-buttons-add\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-add\n-    Click button  css=.modal-footer #form-buttons-add\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n+    Wait overlay is closed\n     Wait until page contains  New style Article\n \n \n@@ -37,13 +36,12 @@ Add a choice field with a named vocabulary\n     Input text for sure  form-widgets-description  Spoken languages\n     Wait until keyword succeeds  10  1  Select From List By Label  form-widgets-factory  Multiple Choice\n     Wait until keyword succeeds  10  1  Click button  css=.modal-footer #form-buttons-add\n+    Wait overlay is closed\n     Wait until page contains element  css=div[data-field_id="languages"] a.fieldSettings\n \n     Open field settings  languages\n     Select from list by value  form-widgets-vocabularyName  plone.app.vocabularies.AvailableContentLanguages\n-    Set Focus To Element  css=.modal-footer #form-buttons-save\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-save\n-    Click button  css=.modal-footer #form-buttons-save\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-save\n     Wait overlay is closed\n     Page should contain  Fran\xc3\xa7ais\n \n@@ -55,9 +53,8 @@ Add a choice field with vocabulary values\n     Add field  Hobbies  hobbies  Multiple Choice\n     Open field settings  hobbies\n     Input text  form-widgets-values  Chess\\nSoccer\\nBaseball\\nVideo games\n-    Set Focus To Element  css=.modal-footer #form-buttons-save\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-save\n-    Click button  css=.modal-footer #form-buttons-save\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-save\n+    Wait overlay is closed\n     Wait until page contains element  form-widgets-hobbies-3\n \n #fail on jenkins\n@@ -93,9 +90,7 @@ Add a fieldSet and move a field into this fieldset\n     Input text for sure  form-widgets-label  Personal information\n     Set Focus to Element  form-widgets-__name__\n     Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  personal_information\n-    Set Focus To Element  css=.modal-footer #form-buttons-add\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-add\n-    Click button  css=.modal-footer #form-buttons-add\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n     Wait overlay is closed\n     Wait until page contains  Personal information\n \n@@ -131,7 +126,7 @@ Delete field\n     Go to dexterity types configuration\n     Add content type  Somebody  somebody\n     Add field  Phone  phone  Text line (String)\n-    Wait until page contains element  css=#fieldset-0 #formfield-form-widgets-phone\n+    Wait For Element  css=#fieldset-0 #formfield-form-widgets-phone\n     Click link  css=div.fieldControls .schemaeditor-delete-field\n     Handle alert\n     Wait Until Keyword Succeeds  10  1  Page Should Not Contain Element  css=#formfield-form-widgets-phone\n@@ -157,7 +152,7 @@ Delete field\n *** Keywords ***\n \n Wait overlay is closed\n-    Wait until keyword succeeds  60  1  Page should not contain element  css=div.overlay\n+    Wait until keyword succeeds  8  1  Page should not contain element  css=div.modal-wrapper\n \n Go to dexterity types configuration\n     Enable autologin as  Manager\n@@ -171,9 +166,8 @@ Add content type\n     Input text for sure  form-widgets-title  ${title}\n     Set Focus to Element  form-widgets-id\n     Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-id  ${id}\n-    Set Focus To Element  css=.modal-footer #form-buttons-add\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-add\n-    Click button  css=.modal-footer #form-buttons-add\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n+    Wait overlay is closed\n     Wait until page contains  ${title}\n     Go to  ${PLONE_URL}/@@dexterity-types/${id}/@@fields\n     Wait until page contains  Fields\n@@ -187,13 +181,11 @@ Add field\n     Set Focus to Element  form-widgets-__name__\n     Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  ${field_id}\n     Select from list by label  form-widgets-factory  ${field_type}\n-    Set Focus To Element  css=.modal-footer #form-buttons-add\n-    Wait Until Element Is Visible  css=.modal-footer #form-buttons-add\n-    Click button  css=.modal-footer #form-buttons-add\n+    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n     Wait overlay is closed\n \n Open field settings\n     [Arguments]    ${field_id}\n     ${locator}  Set Variable  //div[@data-field_id=\'${field_id}\']//a[contains(@class, \'fieldSettings pat-plone-modal\')]\n-    Wait until element is visible  xpath=${locator}\n+    Wait For Element  xpath=${locator}\n     Click Overlay Link  xpath=${locator}\n'

