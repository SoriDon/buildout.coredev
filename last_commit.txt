Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-06-08T18:59:48+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/b562ddb290b7852c2d21ec1b57e5a0b30859f64e

Fixed KeyError ``productname`` when there is a broken add-on in the add-ons control panel.

Fixes https://github.com/plone/Products.CMFPlone/issues/2065.

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/browser/quickinstaller.pt
M Products/CMFPlone/controlpanel/browser/quickinstaller.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 85334cebf..2fdbd6b2d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -38,6 +38,10 @@ New features:
 
 Bug fixes:
 
+- Fixed KeyError ``productname`` when there is a broken add-on in the add-ons control panel.
+  Fixes `issue 2065 <https://github.com/plone/Products.CMFPlone/issues/2065>`_.
+  [maurits]
+
 - Fix ``test_tinymce.robot`` test to work with latest related items changes.
   [thet]
 
diff --git a/Products/CMFPlone/controlpanel/browser/quickinstaller.pt b/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
index 857642a42..f1488bcad 100644
--- a/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
+++ b/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
@@ -207,7 +207,7 @@
             <ul class="configlets">
               <li tal:repeat="product products">
                 <h3>
-                  <span tal:replace="product/productname" i18n:translate="">
+                  <span tal:replace="product/product_id" i18n:translate="">
                     Add-on Name
                   </span>
                 </h3>
diff --git a/Products/CMFPlone/controlpanel/browser/quickinstaller.py b/Products/CMFPlone/controlpanel/browser/quickinstaller.py
index db4cc8c99..49a73f0be 100644
--- a/Products/CMFPlone/controlpanel/browser/quickinstaller.py
+++ b/Products/CMFPlone/controlpanel/browser/quickinstaller.py
@@ -617,7 +617,7 @@ def get_addons(self, apply_filter=None, product_name=None):
         if apply_filter == 'broken':
             all_broken = self.errors.values()
             for broken in all_broken:
-                filtered[broken['productname']] = broken
+                filtered[broken['product_id']] = broken
         else:
             for product_id, addon in addons.items():
                 if product_name and addon['id'] != product_name:


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-06-09T11:25:59+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/df956e56245f0aad86f1af1623696d1412be4d47

Merge pull request #2067 from plone/issue-2065-qi-broken-product

Fixed KeyError productname for broken add-on

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/browser/quickinstaller.pt
M Products/CMFPlone/controlpanel/browser/quickinstaller.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 85334cebf..2fdbd6b2d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -38,6 +38,10 @@ New features:
 
 Bug fixes:
 
+- Fixed KeyError ``productname`` when there is a broken add-on in the add-ons control panel.
+  Fixes `issue 2065 <https://github.com/plone/Products.CMFPlone/issues/2065>`_.
+  [maurits]
+
 - Fix ``test_tinymce.robot`` test to work with latest related items changes.
   [thet]
 
diff --git a/Products/CMFPlone/controlpanel/browser/quickinstaller.pt b/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
index 857642a42..f1488bcad 100644
--- a/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
+++ b/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
@@ -207,7 +207,7 @@
             <ul class="configlets">
               <li tal:repeat="product products">
                 <h3>
-                  <span tal:replace="product/productname" i18n:translate="">
+                  <span tal:replace="product/product_id" i18n:translate="">
                     Add-on Name
                   </span>
                 </h3>
diff --git a/Products/CMFPlone/controlpanel/browser/quickinstaller.py b/Products/CMFPlone/controlpanel/browser/quickinstaller.py
index db4cc8c99..49a73f0be 100644
--- a/Products/CMFPlone/controlpanel/browser/quickinstaller.py
+++ b/Products/CMFPlone/controlpanel/browser/quickinstaller.py
@@ -617,7 +617,7 @@ def get_addons(self, apply_filter=None, product_name=None):
         if apply_filter == 'broken':
             all_broken = self.errors.values()
             for broken in all_broken:
-                filtered[broken['productname']] = broken
+                filtered[broken['product_id']] = broken
         else:
             for product_id, addon in addons.items():
                 if product_name and addon['id'] != product_name:


