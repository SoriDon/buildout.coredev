Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2022-08-15T15:16:40-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/5d81fb5df81c1a1486461a77da065b988a64ef4c

Preserve order of behaviors during installation

Files changed:
A news/403.bugfix
M src/plone/app/multilingual/browser/setup.py
M src/plone/app/multilingual/setuphandlers.py

b'diff --git a/news/403.bugfix b/news/403.bugfix\nnew file mode 100644\nindex 000000000..8e35448af\n--- /dev/null\n+++ b/news/403.bugfix\n@@ -0,0 +1 @@\n+- Fix installation to preserve existing order of behaviors. [davisagli]\ndiff --git a/src/plone/app/multilingual/browser/setup.py b/src/plone/app/multilingual/browser/setup.py\nindex 90d0391ad..230261ac8 100644\n--- a/src/plone/app/multilingual/browser/setup.py\n+++ b/src/plone/app/multilingual/browser/setup.py\n@@ -284,6 +284,6 @@ def ensure_translatable(self, type_):\n \n         if IDexterityFTI.providedBy(fti):\n             behaviors = list(fti.behaviors)\n-            behaviors.append("plone.translatable")\n-            behaviors = tuple(set(behaviors))\n-            fti._updateProperty("behaviors", behaviors)\n+            if "plone.translatable" not in behaviors:\n+                behaviors.append("plone.translatable")\n+            fti._updateProperty("behaviors", tuple(behaviors))\ndiff --git a/src/plone/app/multilingual/setuphandlers.py b/src/plone/app/multilingual/setuphandlers.py\nindex 549edf77b..357325798 100644\n--- a/src/plone/app/multilingual/setuphandlers.py\n+++ b/src/plone/app/multilingual/setuphandlers.py\n@@ -58,14 +58,10 @@ def enable_translatable_behavior(portal):\n     )\n     for fti in dx_ftis:\n         # Enable translatable behavior for all types\n-        behaviors = list(fti.behaviors)\n-        behaviors.extend(\n-            [\n-                "plone.translatable",\n-            ]\n-        )\n-        behaviors = tuple(set(behaviors))\n-        fti._updateProperty("behaviors", behaviors)\n+        if "plone.translatable" not in fti.behaviors:\n+            behaviors = list(fti.behaviors)\n+            behaviors.append("plone.translatable")\n+            fti._updateProperty("behaviors", tuple(behaviors))\n \n \n def step_uninstall_various(context):\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2022-08-16T13:32:01+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.multilingual/commit/fe108ae12f69c4776e8c3212e5d7a914de2c1cca

Merge pull request #404 from plone/fix-install-behaviors

Preserve order of behaviors during installation

Files changed:
A news/403.bugfix
M src/plone/app/multilingual/browser/setup.py
M src/plone/app/multilingual/setuphandlers.py

b'diff --git a/news/403.bugfix b/news/403.bugfix\nnew file mode 100644\nindex 000000000..8e35448af\n--- /dev/null\n+++ b/news/403.bugfix\n@@ -0,0 +1 @@\n+- Fix installation to preserve existing order of behaviors. [davisagli]\ndiff --git a/src/plone/app/multilingual/browser/setup.py b/src/plone/app/multilingual/browser/setup.py\nindex 90d0391ad..230261ac8 100644\n--- a/src/plone/app/multilingual/browser/setup.py\n+++ b/src/plone/app/multilingual/browser/setup.py\n@@ -284,6 +284,6 @@ def ensure_translatable(self, type_):\n \n         if IDexterityFTI.providedBy(fti):\n             behaviors = list(fti.behaviors)\n-            behaviors.append("plone.translatable")\n-            behaviors = tuple(set(behaviors))\n-            fti._updateProperty("behaviors", behaviors)\n+            if "plone.translatable" not in behaviors:\n+                behaviors.append("plone.translatable")\n+            fti._updateProperty("behaviors", tuple(behaviors))\ndiff --git a/src/plone/app/multilingual/setuphandlers.py b/src/plone/app/multilingual/setuphandlers.py\nindex 549edf77b..357325798 100644\n--- a/src/plone/app/multilingual/setuphandlers.py\n+++ b/src/plone/app/multilingual/setuphandlers.py\n@@ -58,14 +58,10 @@ def enable_translatable_behavior(portal):\n     )\n     for fti in dx_ftis:\n         # Enable translatable behavior for all types\n-        behaviors = list(fti.behaviors)\n-        behaviors.extend(\n-            [\n-                "plone.translatable",\n-            ]\n-        )\n-        behaviors = tuple(set(behaviors))\n-        fti._updateProperty("behaviors", behaviors)\n+        if "plone.translatable" not in fti.behaviors:\n+            behaviors = list(fti.behaviors)\n+            behaviors.append("plone.translatable")\n+            fti._updateProperty("behaviors", tuple(behaviors))\n \n \n def step_uninstall_various(context):\n'

