Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2018-10-04T23:30:25-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/6d64dee6b9f5ae35bfe0eacd83ad3b1b41810e4d

close files

Files changed:
M plone/app/contenttypes/tests/test_behaviors_leadimage.py
M plone/app/contenttypes/tests/test_collection.py
M plone/app/contenttypes/tests/test_file.py
M plone/app/contenttypes/tests/test_image.py
M plone/app/contenttypes/tests/test_indexes.py

b"diff --git a/plone/app/contenttypes/tests/test_behaviors_leadimage.py b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\nindex f397118f..98a380a4 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n@@ -62,7 +62,8 @@ def test_lead_image_viewlet_shows_up(self):\n         file_ctl = self.browser.getControl(\n             name='form.widgets.ILeadImageBehavior.image'\n         )\n-        file_ctl.add_file(io.FileIO(file_path), 'image/png', 'image.jpg')\n+        with io.FileIO(file_path) as f:\n+            file_ctl.add_file(f, 'image/png', 'image.jpg')\n         # Image caption\n         self.browser.getControl(\n             name='form.widgets.ILeadImageBehavior.image_caption'\ndiff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py\nindex b8467b92..5f3569fc 100644\n--- a/plone/app/contenttypes/tests/test_collection.py\n+++ b/plone/app/contenttypes/tests/test_collection.py\n@@ -36,8 +36,10 @@\n def dummy_image():\n     from plone.namedfile.file import NamedBlobImage\n     filename = os.path.join(os.path.dirname(__file__), u'image.png')\n+    with open(filename, 'rb') as f:\n+        image_data = f.read() \n     return NamedBlobImage(\n-        data=open(filename, 'rb').read(),\n+        data=image_data,\n         filename=filename\n     )\n \ndiff --git a/plone/app/contenttypes/tests/test_file.py b/plone/app/contenttypes/tests/test_file.py\nindex e58bd90a..ad3050ed 100644\n--- a/plone/app/contenttypes/tests/test_file.py\n+++ b/plone/app/contenttypes/tests/test_file.py\n@@ -133,7 +133,8 @@ def test_add_file(self):\n         self.browser.getControl(name=widget).value = 'This is my file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        file_ctl.add_file(io.FileIO(file_path), 'image/png', 'image.jpg')\n+        with io.FileIO(file_path) as f:\n+            file_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('image.jpg/view'))\n         self.assertTrue('My file' in self.browser.contents)\n@@ -148,7 +149,8 @@ def test_shortname_file(self):\n         self.browser.getControl(name=widget).value = 'my-special-file'\n         file_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        file_ctl.add_file(io.FileIO(file_path), 'image/png', 'image.jpg')\n+        with io.FileIO(file_path) as f:\n+            file_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('my-special-file/view'))\n \n@@ -162,7 +164,8 @@ def test_mime_icon_pdf_for_file_(self):\n         self.browser.getControl(name=widget).value = 'This is my pdf file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'file.pdf')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        file_ctl.add_file(io.FileIO(file_path), 'application/pdf', 'file.pdf')\n+        with io.FileIO(file_path) as f:\n+            file_ctl.add_file(f, 'application/pdf', 'file.pdf')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('file.pdf/view'))\n         self.assertTrue('pdf.png' in self.browser.contents)\n@@ -181,8 +184,8 @@ def test_alternative_mime_icon_doc_for_file(self):\n         self.browser.getControl(name=widget).value = 'This is my doc file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'file.doc')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        file_ctl.add_file(io.FileIO(file_path), 'application/msword',\n-                          'file.doc')\n+        with io.FileIO(file_path) as f:\n+            file_ctl.add_file(f, 'application/msword', 'file.doc')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('file.doc/view'))\n         self.assertTrue('custom.png' in self.browser.contents)\n@@ -197,9 +200,11 @@ def test_mime_icon_odt_for_file_(self):\n         self.browser.getControl(name=widget).value = 'This is my odt file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'file.odt')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        file_ctl.add_file(io.FileIO(file_path),\n-                          'application/vnd.oasis.opendocument.text',\n-                          'file.odt')\n+        with io.FileIO(file_path) as f:\n+            file_ctl.add_file(\n+                f,\n+                'application/vnd.oasis.opendocument.text',\n+                'file.odt')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('file.odt/view'))\n         self.assertTrue('application.png' in self.browser.contents)\ndiff --git a/plone/app/contenttypes/tests/test_image.py b/plone/app/contenttypes/tests/test_image.py\nindex 1ab94e94..41217b19 100644\n--- a/plone/app/contenttypes/tests/test_image.py\n+++ b/plone/app/contenttypes/tests/test_image.py\n@@ -22,8 +22,10 @@\n def dummy_image(filename=u'image.jpg'):\n     from plone.namedfile.file import NamedBlobImage\n     filename = os.path.join(os.path.dirname(__file__), filename)\n+    with open(filename, 'rb') as f:\n+        image_data = f.read()\n     return NamedBlobImage(\n-        data=open(filename, 'rb').read(),\n+        data=image_data,\n         filename=filename\n     )\n \n@@ -153,7 +155,8 @@ def test_add_image(self):\n         self.browser.getControl(name=widget).value = 'my-special-image.jpg'\n         image_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         image_ctl = self.browser.getControl(name='form.widgets.image')\n-        image_ctl.add_file(io.FileIO(image_path), 'image/png', 'image.jpg')\n+        with io.FileIO(image_path) as f:\n+            image_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('image.jpg/view'))\n         self.assertIn('My image', self.browser.contents)\n@@ -169,7 +172,8 @@ def test_add_image_with_shortname(self):\n         self.browser.getControl(name=widget).value = 'my-special-image.jpg'\n         image_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         image_ctl = self.browser.getControl(name='form.widgets.image')\n-        image_ctl.add_file(io.FileIO(image_path), 'image/png', 'image.jpg')\n+        with io.FileIO(image_path) as f:\n+            image_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('my-special-image.jpg/view'))\n \n@@ -185,7 +189,8 @@ def test_image_view_fullscreen(self):\n         self.browser.getControl(name=widget).value = 'This is my image.'\n         image_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         image_ctl = self.browser.getControl(name='form.widgets.image')\n-        image_ctl.add_file(io.FileIO(image_path), 'image/png', 'image.jpg')\n+        with io.FileIO(image_path) as f:\n+            image_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.browser.getLink('Click to view full-size image').click()\n         self.assertTrue(\ndiff --git a/plone/app/contenttypes/tests/test_indexes.py b/plone/app/contenttypes/tests/test_indexes.py\nindex f8181db6..e10eef5d 100644\n--- a/plone/app/contenttypes/tests/test_indexes.py\n+++ b/plone/app/contenttypes/tests/test_indexes.py\n@@ -379,8 +379,11 @@ def test_getobjsize_file(self):\n         from plone.namedfile.file import NamedBlobFile\n \n         filename = os.path.join(os.path.dirname(__file__), u'image.jpg')\n-        test_file = NamedBlobFile(data=open(filename, 'rb').read(),\n-                                  filename=filename)\n+        with open(filename, 'rb') as f:\n+            file_data = f.read()\n+        test_file = NamedBlobFile(\n+            data=file_data,\n+            filename=filename)\n \n         primary_field_info = IPrimaryFieldInfo(self.file)\n         primary_field_info.field.set(self.file, test_file)\n"

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2018-10-05T18:38:41-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/e8529be4b7773a823bd711ae8ab1778d4ea82cd5

open files as binary

Files changed:
M plone/app/contenttypes/tests/test_behaviors_leadimage.py
M plone/app/contenttypes/tests/test_file.py
M plone/app/contenttypes/tests/test_image.py

b"diff --git a/plone/app/contenttypes/tests/test_behaviors_leadimage.py b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\nindex 98a380a4..a42331db 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n@@ -62,7 +62,7 @@ def test_lead_image_viewlet_shows_up(self):\n         file_ctl = self.browser.getControl(\n             name='form.widgets.ILeadImageBehavior.image'\n         )\n-        with io.FileIO(file_path) as f:\n+        with io.FileIO(file_path, 'rb') as f:\n             file_ctl.add_file(f, 'image/png', 'image.jpg')\n         # Image caption\n         self.browser.getControl(\ndiff --git a/plone/app/contenttypes/tests/test_file.py b/plone/app/contenttypes/tests/test_file.py\nindex ad3050ed..022c0aa0 100644\n--- a/plone/app/contenttypes/tests/test_file.py\n+++ b/plone/app/contenttypes/tests/test_file.py\n@@ -133,7 +133,7 @@ def test_add_file(self):\n         self.browser.getControl(name=widget).value = 'This is my file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        with io.FileIO(file_path) as f:\n+        with io.FileIO(file_path, 'rb') as f:\n             file_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('image.jpg/view'))\n@@ -149,7 +149,7 @@ def test_shortname_file(self):\n         self.browser.getControl(name=widget).value = 'my-special-file'\n         file_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        with io.FileIO(file_path) as f:\n+        with io.FileIO(file_path, 'rb') as f:\n             file_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('my-special-file/view'))\n@@ -164,7 +164,7 @@ def test_mime_icon_pdf_for_file_(self):\n         self.browser.getControl(name=widget).value = 'This is my pdf file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'file.pdf')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        with io.FileIO(file_path) as f:\n+        with io.FileIO(file_path, 'rb') as f:\n             file_ctl.add_file(f, 'application/pdf', 'file.pdf')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('file.pdf/view'))\n@@ -184,7 +184,7 @@ def test_alternative_mime_icon_doc_for_file(self):\n         self.browser.getControl(name=widget).value = 'This is my doc file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'file.doc')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        with io.FileIO(file_path) as f:\n+        with io.FileIO(file_path, 'rb') as f:\n             file_ctl.add_file(f, 'application/msword', 'file.doc')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('file.doc/view'))\n@@ -200,7 +200,7 @@ def test_mime_icon_odt_for_file_(self):\n         self.browser.getControl(name=widget).value = 'This is my odt file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'file.odt')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        with io.FileIO(file_path) as f:\n+        with io.FileIO(file_path, 'rb') as f:\n             file_ctl.add_file(\n                 f,\n                 'application/vnd.oasis.opendocument.text',\ndiff --git a/plone/app/contenttypes/tests/test_image.py b/plone/app/contenttypes/tests/test_image.py\nindex 41217b19..9974c82e 100644\n--- a/plone/app/contenttypes/tests/test_image.py\n+++ b/plone/app/contenttypes/tests/test_image.py\n@@ -155,7 +155,7 @@ def test_add_image(self):\n         self.browser.getControl(name=widget).value = 'my-special-image.jpg'\n         image_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         image_ctl = self.browser.getControl(name='form.widgets.image')\n-        with io.FileIO(image_path) as f:\n+        with io.FileIO(image_path, 'rb') as f:\n             image_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('image.jpg/view'))\n@@ -172,7 +172,7 @@ def test_add_image_with_shortname(self):\n         self.browser.getControl(name=widget).value = 'my-special-image.jpg'\n         image_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         image_ctl = self.browser.getControl(name='form.widgets.image')\n-        with io.FileIO(image_path) as f:\n+        with io.FileIO(image_path, 'rb') as f:\n             image_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('my-special-image.jpg/view'))\n@@ -189,7 +189,7 @@ def test_image_view_fullscreen(self):\n         self.browser.getControl(name=widget).value = 'This is my image.'\n         image_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         image_ctl = self.browser.getControl(name='form.widgets.image')\n-        with io.FileIO(image_path) as f:\n+        with io.FileIO(image_path, 'rb') as f:\n             image_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.browser.getLink('Click to view full-size image').click()\n"

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2018-10-23T21:19:48+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/7af8175c832b597777bf2a0cb35cddb23eaf22bc

Update CHANGES.rst

Files changed:
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 3a51f5f6..7ac83a4d 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -35,6 +35,8 @@ Bug fixes:\n   (see plone/Products.CMFPlone#2540)\n   [ale-rt]\n \n+- Fix resource warnings. \n+  [davisagli] \n \n 1.4.12 (2018-09-23)\n -------------------\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2018-10-23T21:21:29+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/a4a8ba8b7643fc7afbf23ae02e3b66684a211d6f

Merge pull request #495 from plone/fix-ResourceWarning

close files

Files changed:
M CHANGES.rst
M plone/app/contenttypes/tests/test_behaviors_leadimage.py
M plone/app/contenttypes/tests/test_collection.py
M plone/app/contenttypes/tests/test_file.py
M plone/app/contenttypes/tests/test_image.py
M plone/app/contenttypes/tests/test_indexes.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 3a51f5f6..7ac83a4d 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -35,6 +35,8 @@ Bug fixes:\n   (see plone/Products.CMFPlone#2540)\n   [ale-rt]\n \n+- Fix resource warnings. \n+  [davisagli] \n \n 1.4.12 (2018-09-23)\n -------------------\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_leadimage.py b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\nindex f397118f..a42331db 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n@@ -62,7 +62,8 @@ def test_lead_image_viewlet_shows_up(self):\n         file_ctl = self.browser.getControl(\n             name='form.widgets.ILeadImageBehavior.image'\n         )\n-        file_ctl.add_file(io.FileIO(file_path), 'image/png', 'image.jpg')\n+        with io.FileIO(file_path, 'rb') as f:\n+            file_ctl.add_file(f, 'image/png', 'image.jpg')\n         # Image caption\n         self.browser.getControl(\n             name='form.widgets.ILeadImageBehavior.image_caption'\ndiff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py\nindex b8467b92..5f3569fc 100644\n--- a/plone/app/contenttypes/tests/test_collection.py\n+++ b/plone/app/contenttypes/tests/test_collection.py\n@@ -36,8 +36,10 @@\n def dummy_image():\n     from plone.namedfile.file import NamedBlobImage\n     filename = os.path.join(os.path.dirname(__file__), u'image.png')\n+    with open(filename, 'rb') as f:\n+        image_data = f.read() \n     return NamedBlobImage(\n-        data=open(filename, 'rb').read(),\n+        data=image_data,\n         filename=filename\n     )\n \ndiff --git a/plone/app/contenttypes/tests/test_file.py b/plone/app/contenttypes/tests/test_file.py\nindex e58bd90a..022c0aa0 100644\n--- a/plone/app/contenttypes/tests/test_file.py\n+++ b/plone/app/contenttypes/tests/test_file.py\n@@ -133,7 +133,8 @@ def test_add_file(self):\n         self.browser.getControl(name=widget).value = 'This is my file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        file_ctl.add_file(io.FileIO(file_path), 'image/png', 'image.jpg')\n+        with io.FileIO(file_path, 'rb') as f:\n+            file_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('image.jpg/view'))\n         self.assertTrue('My file' in self.browser.contents)\n@@ -148,7 +149,8 @@ def test_shortname_file(self):\n         self.browser.getControl(name=widget).value = 'my-special-file'\n         file_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        file_ctl.add_file(io.FileIO(file_path), 'image/png', 'image.jpg')\n+        with io.FileIO(file_path, 'rb') as f:\n+            file_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('my-special-file/view'))\n \n@@ -162,7 +164,8 @@ def test_mime_icon_pdf_for_file_(self):\n         self.browser.getControl(name=widget).value = 'This is my pdf file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'file.pdf')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        file_ctl.add_file(io.FileIO(file_path), 'application/pdf', 'file.pdf')\n+        with io.FileIO(file_path, 'rb') as f:\n+            file_ctl.add_file(f, 'application/pdf', 'file.pdf')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('file.pdf/view'))\n         self.assertTrue('pdf.png' in self.browser.contents)\n@@ -181,8 +184,8 @@ def test_alternative_mime_icon_doc_for_file(self):\n         self.browser.getControl(name=widget).value = 'This is my doc file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'file.doc')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        file_ctl.add_file(io.FileIO(file_path), 'application/msword',\n-                          'file.doc')\n+        with io.FileIO(file_path, 'rb') as f:\n+            file_ctl.add_file(f, 'application/msword', 'file.doc')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('file.doc/view'))\n         self.assertTrue('custom.png' in self.browser.contents)\n@@ -197,9 +200,11 @@ def test_mime_icon_odt_for_file_(self):\n         self.browser.getControl(name=widget).value = 'This is my odt file.'\n         file_path = os.path.join(os.path.dirname(__file__), 'file.odt')\n         file_ctl = self.browser.getControl(name='form.widgets.file')\n-        file_ctl.add_file(io.FileIO(file_path),\n-                          'application/vnd.oasis.opendocument.text',\n-                          'file.odt')\n+        with io.FileIO(file_path, 'rb') as f:\n+            file_ctl.add_file(\n+                f,\n+                'application/vnd.oasis.opendocument.text',\n+                'file.odt')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('file.odt/view'))\n         self.assertTrue('application.png' in self.browser.contents)\ndiff --git a/plone/app/contenttypes/tests/test_image.py b/plone/app/contenttypes/tests/test_image.py\nindex 1ab94e94..9974c82e 100644\n--- a/plone/app/contenttypes/tests/test_image.py\n+++ b/plone/app/contenttypes/tests/test_image.py\n@@ -22,8 +22,10 @@\n def dummy_image(filename=u'image.jpg'):\n     from plone.namedfile.file import NamedBlobImage\n     filename = os.path.join(os.path.dirname(__file__), filename)\n+    with open(filename, 'rb') as f:\n+        image_data = f.read()\n     return NamedBlobImage(\n-        data=open(filename, 'rb').read(),\n+        data=image_data,\n         filename=filename\n     )\n \n@@ -153,7 +155,8 @@ def test_add_image(self):\n         self.browser.getControl(name=widget).value = 'my-special-image.jpg'\n         image_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         image_ctl = self.browser.getControl(name='form.widgets.image')\n-        image_ctl.add_file(io.FileIO(image_path), 'image/png', 'image.jpg')\n+        with io.FileIO(image_path, 'rb') as f:\n+            image_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('image.jpg/view'))\n         self.assertIn('My image', self.browser.contents)\n@@ -169,7 +172,8 @@ def test_add_image_with_shortname(self):\n         self.browser.getControl(name=widget).value = 'my-special-image.jpg'\n         image_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         image_ctl = self.browser.getControl(name='form.widgets.image')\n-        image_ctl.add_file(io.FileIO(image_path), 'image/png', 'image.jpg')\n+        with io.FileIO(image_path, 'rb') as f:\n+            image_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.assertTrue(self.browser.url.endswith('my-special-image.jpg/view'))\n \n@@ -185,7 +189,8 @@ def test_image_view_fullscreen(self):\n         self.browser.getControl(name=widget).value = 'This is my image.'\n         image_path = os.path.join(os.path.dirname(__file__), 'image.jpg')\n         image_ctl = self.browser.getControl(name='form.widgets.image')\n-        image_ctl.add_file(io.FileIO(image_path), 'image/png', 'image.jpg')\n+        with io.FileIO(image_path, 'rb') as f:\n+            image_ctl.add_file(f, 'image/png', 'image.jpg')\n         self.browser.getControl('Save').click()\n         self.browser.getLink('Click to view full-size image').click()\n         self.assertTrue(\ndiff --git a/plone/app/contenttypes/tests/test_indexes.py b/plone/app/contenttypes/tests/test_indexes.py\nindex f8181db6..e10eef5d 100644\n--- a/plone/app/contenttypes/tests/test_indexes.py\n+++ b/plone/app/contenttypes/tests/test_indexes.py\n@@ -379,8 +379,11 @@ def test_getobjsize_file(self):\n         from plone.namedfile.file import NamedBlobFile\n \n         filename = os.path.join(os.path.dirname(__file__), u'image.jpg')\n-        test_file = NamedBlobFile(data=open(filename, 'rb').read(),\n-                                  filename=filename)\n+        with open(filename, 'rb') as f:\n+            file_data = f.read()\n+        test_file = NamedBlobFile(\n+            data=file_data,\n+            filename=filename)\n \n         primary_field_info = IPrimaryFieldInfo(self.file)\n         primary_field_info.field.set(self.file, test_file)\n"

