Repository: plone.testing


Branch: refs/heads/master
Date: 2018-06-22T16:04:25+02:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.testing/commit/084d3164c856ec8499a64a9ccb35822ffb062351

Fix the Zope exception hook when using the ZServer layer.

Files changed:
M CHANGES.rst
M src/plone/testing/z2.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 2da271b..e47dd40 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -16,6 +16,8 @@ Bug fixes:\n \n - Fix most of the code smells Jenkins complains about.\n \n+- Fix the Zope exception hook when using the ZServer layer.\n+\n \n 6.0.0 (2018-02-05)\n ------------------\ndiff --git a/src/plone/testing/z2.py b/src/plone/testing/z2.py\nindex 0df6166..17f7a83 100644\n--- a/src/plone/testing/z2.py\n+++ b/src/plone/testing/z2.py\n@@ -988,6 +988,7 @@ def setUp(self):\n \n         self._shutdown = False\n \n+        self.setUpExceptionHook()\n         self.setUpServer()\n \n         self.thread = Thread(\n@@ -1006,10 +1007,20 @@ def tearDown(self):\n         time.sleep(0.5)\n \n         self.tearDownServer()\n+        self.tearDownExceptionHook()\n \n         del self[\'host\']\n         del self[\'port\']\n \n+    def setUpExceptionHook(self):\n+        from ZServer.ZPublisher.exceptionhook import EXCEPTION_HOOK\n+        import Zope2\n+        Zope2.zpublisher_exception_hook = EXCEPTION_HOOK\n+\n+    def tearDownExceptionHook(self):\n+        import Zope2\n+        Zope2.zpublisher_exception_hook = None\n+\n     def setUpServer(self):\n         """Create a ZServer server instance and save it in self.zserver\n         """\n'

Repository: plone.testing


Branch: refs/heads/master
Date: 2018-06-22T16:28:35+01:00
Author: David Glick (davisagli) <david.glick@plone.org>
Commit: https://github.com/plone/plone.testing/commit/cc2f0633c08d223c1020c7a3dbf80ca7fda96cf3

Merge pull request #49 from plone/fix-zserver-exception-hook

Fix the Zope exception hook when using the ZServer layer.

Files changed:
M CHANGES.rst
M src/plone/testing/z2.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 2da271b..e47dd40 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -16,6 +16,8 @@ Bug fixes:\n \n - Fix most of the code smells Jenkins complains about.\n \n+- Fix the Zope exception hook when using the ZServer layer.\n+\n \n 6.0.0 (2018-02-05)\n ------------------\ndiff --git a/src/plone/testing/z2.py b/src/plone/testing/z2.py\nindex 0df6166..17f7a83 100644\n--- a/src/plone/testing/z2.py\n+++ b/src/plone/testing/z2.py\n@@ -988,6 +988,7 @@ def setUp(self):\n \n         self._shutdown = False\n \n+        self.setUpExceptionHook()\n         self.setUpServer()\n \n         self.thread = Thread(\n@@ -1006,10 +1007,20 @@ def tearDown(self):\n         time.sleep(0.5)\n \n         self.tearDownServer()\n+        self.tearDownExceptionHook()\n \n         del self[\'host\']\n         del self[\'port\']\n \n+    def setUpExceptionHook(self):\n+        from ZServer.ZPublisher.exceptionhook import EXCEPTION_HOOK\n+        import Zope2\n+        Zope2.zpublisher_exception_hook = EXCEPTION_HOOK\n+\n+    def tearDownExceptionHook(self):\n+        import Zope2\n+        Zope2.zpublisher_exception_hook = None\n+\n     def setUpServer(self):\n         """Create a ZServer server instance and save it in self.zserver\n         """\n'

