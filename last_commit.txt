Repository: mockup


Branch: refs/heads/master
Date: 2019-02-13T14:43:26+01:00
Author: Davi Lima (davilima6) <davilima6@gmail.com>
Commit: https://github.com/plone/mockup/commit/c103c74a0753011672c1b2915d82b5a763a403d7

Add author to previous changelog

Files changed:
M news/887.feature

b'diff --git a/news/887.feature b/news/887.feature\nindex b2bcfb878..b6e666ea6 100644\n--- a/news/887.feature\n+++ b/news/887.feature\n@@ -2,3 +2,4 @@\n   [davilima6]\n \n * Upgrade moment.js from version 2.10.6 to 2.24.0\n+  [davilima6]\n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-13T14:43:57+01:00
Author: Davi Lima (davilima6) <davilima6@gmail.com>
Commit: https://github.com/plone/mockup/commit/4c0a8ee49d3d9a38939eaa86e9585ebb09ccb80c

Improve fallback mechanism for Moment.js locales

Files changed:
M mockup/patterns/moment/pattern.js

b"diff --git a/mockup/patterns/moment/pattern.js b/mockup/patterns/moment/pattern.js\nindex cfb5080ee..c3c663f9f 100644\n--- a/mockup/patterns/moment/pattern.js\n+++ b/mockup/patterns/moment/pattern.js\n@@ -86,7 +86,6 @@ define([\n   'mockup-i18n',\n   'moment'\n ], function($, Base, i18n, moment) {\n-\n   lazyLoadMomentLocale();\n \n   var Moment = Base.extend({\n@@ -150,12 +149,28 @@ define([\n });\n \n function lazyLoadMomentLocale() {\n-  var lang = document.querySelector('html').lang || 'en';\n+  var BUILTIN_FALLBACK = 'en';\n+  var lang = document.querySelector('html').lang || BUILTIN_FALLBACK;\n \n   if (lang === 'en') {\n     // English locale is built-in, no need to load\n     return;\n   }\n \n+  var MOMENT_LOCALES =\n+    'ar-sa ar-tn ar az be bg bn bo br bs ca cs cv cy da de-at de dv el ' +\n+    'en-au en-ca en-gb en-ie en-nz eo es et eu fa fi fo fr-ca fr-ch fr fy ' +\n+    'gd gl he hi hr hu hy-am id is it ja jv ka kk km ko lb lo lt lv me mk ml ' +\n+    'mr ms-my ms my nb ne nl nn pl pt-br pt ro ru se si sk sl sq sr-cyrl ' +\n+    'sr sv sw ta te th tl-ph tlh tr tzl tzm-latn tzm uk uz vi zh-cn zh-tw';\n+\n+  lang = MOMENT_LOCALES.split(' ').includes(lang) ? lang : lang.split('-')[0];\n+  lang = MOMENT_LOCALES.split(' ').includes(lang) ? lang : BUILTIN_FALLBACK;\n+\n+  if (lang === BUILTIN_FALLBACK) {\n+    // English locale is built-in, no need to load\n+    return;\n+  }\n+\n   require(['moment-url/' + lang]);\n }\n"

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-13T14:47:29+01:00
Author: Davi Lima (davilima6) <davilima6@gmail.com>
Commit: https://github.com/plone/mockup/commit/515fe9a7b9ddebc8150c5f885669dd29f3430642

Add towncrier entry (changelog)

Files changed:
A news/890.fix

b'diff --git a/news/890.fix b/news/890.fix\nnew file mode 100644\nindex 000000000..7a628c519\n--- /dev/null\n+++ b/news/890.fix\n@@ -0,0 +1,2 @@\n+* Improve fallback mechanism for Moment.js locale selection \n+  [davilima6]\n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-13T15:02:55+01:00
Author: Davi Lima (davilima6) <davilima6@gmail.com>
Commit: https://github.com/plone/mockup/commit/39f2fa0df512510f725d7c9e32406a92aa680407

Reference source of MOMENT_LOCALES array

Files changed:
M mockup/patterns/moment/pattern.js

b"diff --git a/mockup/patterns/moment/pattern.js b/mockup/patterns/moment/pattern.js\nindex c3c663f9f..d56a00a3c 100644\n--- a/mockup/patterns/moment/pattern.js\n+++ b/mockup/patterns/moment/pattern.js\n@@ -157,6 +157,7 @@ function lazyLoadMomentLocale() {\n     return;\n   }\n \n+  // Taken from https://github.com/moment/moment/blob/3147fbc486209f0b479dc0b29672d4c2ef39cf43/src/test/moment/format.js#L463-L468\n   var MOMENT_LOCALES =\n     'ar-sa ar-tn ar az be bg bn bo br bs ca cs cv cy da de-at de dv el ' +\n     'en-au en-ca en-gb en-ie en-nz eo es et eu fa fi fo fr-ca fr-ch fr fy ' +\n"

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-15T15:40:45+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/mockup/commit/394625d1a17dbcc1b0d833efbac9257712dd116e

Merge pull request #890 from plone/momentjsLazyLoadLocales

Momentjs: improve fallback for lazy load locales

Files changed:
A news/890.fix
M mockup/patterns/moment/pattern.js
M news/887.feature

b"diff --git a/mockup/patterns/moment/pattern.js b/mockup/patterns/moment/pattern.js\nindex cfb5080ee..d56a00a3c 100644\n--- a/mockup/patterns/moment/pattern.js\n+++ b/mockup/patterns/moment/pattern.js\n@@ -86,7 +86,6 @@ define([\n   'mockup-i18n',\n   'moment'\n ], function($, Base, i18n, moment) {\n-\n   lazyLoadMomentLocale();\n \n   var Moment = Base.extend({\n@@ -150,12 +149,29 @@ define([\n });\n \n function lazyLoadMomentLocale() {\n-  var lang = document.querySelector('html').lang || 'en';\n+  var BUILTIN_FALLBACK = 'en';\n+  var lang = document.querySelector('html').lang || BUILTIN_FALLBACK;\n \n   if (lang === 'en') {\n     // English locale is built-in, no need to load\n     return;\n   }\n \n+  // Taken from https://github.com/moment/moment/blob/3147fbc486209f0b479dc0b29672d4c2ef39cf43/src/test/moment/format.js#L463-L468\n+  var MOMENT_LOCALES =\n+    'ar-sa ar-tn ar az be bg bn bo br bs ca cs cv cy da de-at de dv el ' +\n+    'en-au en-ca en-gb en-ie en-nz eo es et eu fa fi fo fr-ca fr-ch fr fy ' +\n+    'gd gl he hi hr hu hy-am id is it ja jv ka kk km ko lb lo lt lv me mk ml ' +\n+    'mr ms-my ms my nb ne nl nn pl pt-br pt ro ru se si sk sl sq sr-cyrl ' +\n+    'sr sv sw ta te th tl-ph tlh tr tzl tzm-latn tzm uk uz vi zh-cn zh-tw';\n+\n+  lang = MOMENT_LOCALES.split(' ').includes(lang) ? lang : lang.split('-')[0];\n+  lang = MOMENT_LOCALES.split(' ').includes(lang) ? lang : BUILTIN_FALLBACK;\n+\n+  if (lang === BUILTIN_FALLBACK) {\n+    // English locale is built-in, no need to load\n+    return;\n+  }\n+\n   require(['moment-url/' + lang]);\n }\ndiff --git a/news/887.feature b/news/887.feature\nindex b2bcfb878..b6e666ea6 100644\n--- a/news/887.feature\n+++ b/news/887.feature\n@@ -2,3 +2,4 @@\n   [davilima6]\n \n * Upgrade moment.js from version 2.10.6 to 2.24.0\n+  [davilima6]\ndiff --git a/news/890.fix b/news/890.fix\nnew file mode 100644\nindex 000000000..7a628c519\n--- /dev/null\n+++ b/news/890.fix\n@@ -0,0 +1,2 @@\n+* Improve fallback mechanism for Moment.js locale selection \n+  [davilima6]\n"

