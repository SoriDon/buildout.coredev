Repository: mockup


Branch: refs/heads/master
Date: 2019-02-09T10:22:53+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/mockup/commit/4002a4da40e39f2e08be069c2a9467930138dcd7

Improve relateditems patern UX

Files changed:
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/pattern.relateditems.less
M mockup/patterns/relateditems/templates/recentlyused.xml
M mockup/patterns/relateditems/templates/result.xml
M mockup/patterns/relateditems/templates/selection.xml
M mockup/patterns/tinymce/less/pattern.tinymce.less

b'diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js\nindex ddbedc8a0..f3f25f840 100644\n--- a/mockup/patterns/relateditems/pattern.js\n+++ b/mockup/patterns/relateditems/pattern.js\n@@ -683,7 +683,6 @@ define([\n                 // Select2 3.5.4 throws an error in some cases in\n                 // updateSelection, ``this.selection.find(".select2-search-choice").remove();``\n                 // No idea why, hard to track.\n-                console.log(data);\n               }\n \n               if (self.openAfterInit) {\n@@ -718,8 +717,21 @@ define([\n       self.$toolbar = $(\'<div class="toolbar ui-offset-parent" />\');\n       self.$container.prepend(self.$toolbar);\n \n-      self.$el.on(\'select2-selecting\', function(event) {\n-        event.preventDefault();\n+      $(document).on(\'keyup\', self.$el, function(event) {\n+        var path;\n+        // Number 39 is the "arrow right" key on the keyboard\n+        if (event.which === 39) {\n+          event.stopPropagation();\n+          path = $(\'.select2-highlighted .pattern-relateditems-result-browse\').data(\'path\');\n+          self.browseTo(path);\n+        }\n+\n+        // Number 37 is the "arrow left" key on the keyboard\n+        if (event.which === 37) {\n+          event.stopPropagation();\n+          path = $(\'.pattern-relateditems-result.one-level-up .pattern-relateditems-result-browse\').data(\'path\');\n+          self.browseTo(path);\n+        }\n       });\n \n       self.renderToolbar();\ndiff --git a/mockup/patterns/relateditems/pattern.relateditems.less b/mockup/patterns/relateditems/pattern.relateditems.less\nindex 2dad96dd3..c5d8fd861 100644\n--- a/mockup/patterns/relateditems/pattern.relateditems.less\n+++ b/mockup/patterns/relateditems/pattern.relateditems.less\n@@ -104,20 +104,60 @@\n                 margin-bottom: 0;\n             }\n         }\n+        .pattern-relateditems-recentlyused-select {\n+            display: flex;\n+            justify-content: space-between;\n+            padding: 3px;\n+            .pattern-relateditems-recentlyused-info{\n+                flex-grow: 2;\n+                hyphens: auto;\n+                white-space: normal;\n+                .pattern-relateditems-item-title {\n+                    line-height: 1.2;\n+                }\n+            }\n+            .pattern-relateditems-recentlyused-image {\n+                flex: 0 0 auto;\n+            }\n+        }\n+    }\n+    .toolbar .dropdown-menu {\n+        min-width: 310px;\n     }\n-\n }\n \n-.pattern-relateditems-dropdown {\n-    .select2-results {\n-        .select2-highlighted {\n-            color: #000;\n-            background: #d8d8d8;\n+.pattern-relateditems-item {\n+    display: flex;\n+\n+    .pattern-relateditems-result-info {\n+        flex-grow: 2;\n+        margin: 0.4em 0.4em 0.4em 1.5em;\n+        hyphens: auto;\n+        .pattern-relateditems-item-title {\n+            line-height: 1.2;\n+            &::before {\n+                height: auto;\n+                width: auto;\n+            }\n         }\n+    }\n+}\n \n-        .select2-selected {\n-            display: list-item;\n-        }\n+.pattern-relateditems-dropdown .select2-results {\n+    max-height: 350px;\n+    background-color: #fffef2;\n+\n+    .select2-result-label {\n+        padding: 0;\n+    }\n+\n+    .select2-highlighted {\n+        color: #000;\n+        background: #d8d8d8;\n+    }\n+\n+    .select2-selected {\n+        display: list-item;\n     }\n }\n \n@@ -130,41 +170,83 @@\n     margin-top: 2px;\n }\n \n+.pat-relateditems .select2-choices {\n+    display: flex;\n+    justify-content: flex-start;\n+    flex-flow: row wrap;\n+    padding: 0.2em;\n+    > li {\n+        flex: 1 1 100%;\n+    }\n+}\n \n+.select2-choices .select2-search-choice.select2-search-choice-focus {\n+    border-left: 0.5em solid #286090 !important;\n+}\n \n-.pattern-relateditems-result {\n-    padding: 0.2em;\n+.select2-container-multi .select2-choices .select2-search-choice {\n+    background-image: none;\n+    background-color: #eee;\n+    padding: 0;\n+    margin: 0.2em;\n+\n+    .select2-search-choice-close {\n+        text-decoration: none;\n+        border-bottom: 0 solid transparent !important;\n+        top: 0.4rem;\n+        left: 0.4rem;\n+        right: auto;\n+    }\n \n+    .pattern-relateditems-item-image {\n+        flex: 0 0 auto;\n+    }\n+}\n+\n+.pattern-relateditems-result {\n+    display: flex;\n+    justify-content: space-between;\n+    margin-bottom: 0.3em;\n     a {\n         &:hover {\n             text-decoration: none;\n         }\n     }\n \n-    .pattern-relateditems-buttons {\n-        display: inline-block;\n-        width: 1.5em;\n-        font-size: 1.5em;\n-        vertical-align: top;\n-        a {\n-            .glyphicon;\n-            .glyphicon-folder-close;\n+    .pattern-relateditems-result-info {\n+        padding: 0.2em;\n+    }\n+\n+    .pattern-relateditems-result-browse-wrapper {\n+        flex: 2 1 fill;\n+        display: flex;\n+        justify-content: flex-start;\n+\n+        .pattern-relateditems-result-select {\n+\n+            &:not(.selectable):not(.one-level-up) {\n+                opacity: 0.6;\n+            }\n+        }\n+\n+        .pattern-relateditems-result-browse {\n+            font-size: 210%;\n+            margin: 0 0.1em 0 0.05em;\n+            padding: 0 0.15em;\n+            display: inline;\n+            line-height: 1.2em;\n             &:hover {\n-                .glyphicon-folder-open;\n+                background-color: lighten(#d8d8d8, 5%) ;\n             }\n-            &:hover:before {\n-                color:purple;\n+            span {\n+                vertical-align: middle;\n             }\n         }\n-    }\n \n-    .pattern-relateditems-result-select {\n-        display: inline-block;\n-        &:not(.selectable):not(.one-level-up) {\n-            opacity: 0.6;\n-        }\n     }\n \n+\n+\n }\n \n .pattern-relateditems-recentlyused-path,\ndiff --git a/mockup/patterns/relateditems/templates/recentlyused.xml b/mockup/patterns/relateditems/templates/recentlyused.xml\nindex b463351e1..0b1eab9ab 100644\n--- a/mockup/patterns/relateditems/templates/recentlyused.xml\n+++ b/mockup/patterns/relateditems/templates/recentlyused.xml\n@@ -1,7 +1,13 @@\n-<div class="pattern-relateditems-recentlyused">\n+<li class="pattern-relateditems-recentlyused">\n   <a class="pattern-relateditems-recentlyused-select" data-uid="<%- UID %>">\n-    <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon "><br><% } %>\n-    <span class="pattern-relateditems-recentlyused-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n-    <span class="pattern-relateditems-recentlyused-path"><%- path %></span>\n+    <div class="pattern-relateditems-recentlyused-info">\n+      <span class="pattern-relateditems-recentlyused-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+      <span class="pattern-relateditems-recentlyused-path"><%- path %></span>\n+    </div>\n+    <% if (getURL && (getIcon || portal_type === "Image")) { %>\n+    <div class="pattern-relateditems-recentlyused-image">\n+      <img src="<%- getURL %>/@@images/image/tile">\n+    </div>\n+    <% } %>\n   </a>\n-</div>\n+</li>\ndiff --git a/mockup/patterns/relateditems/templates/result.xml b/mockup/patterns/relateditems/templates/result.xml\nindex c9d896687..e58269b0d 100644\n--- a/mockup/patterns/relateditems/templates/result.xml\n+++ b/mockup/patterns/relateditems/templates/result.xml\n@@ -1,12 +1,18 @@\n <div class="pattern-relateditems-result<% if (oneLevelUp) { %> one-level-up<% } %>">\n-  <span class="pattern-relateditems-buttons">\n-  <% if (is_folderish) { %>\n-    <a class="pattern-relateditems-result-browse" data-path="<%- path %>" title="<%- open_folder %>"></a>\n+  <div class="pattern-relateditems-result-browse-wrapper">\n+    <a class="pattern-relateditems-result-select<% if (selectable) { %> selectable<% } %><% if (oneLevelUp) { %> one-level-up<% } %>" data-path="<%- path %>">\n+      <div class="pattern-relateditems-result-info">\n+        <span class="pattern-relateditems-result-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+        <span class="pattern-relateditems-result-path"><%- path %></span>\n+      </div>\n+    <% if (is_folderish) { %>\n+      <a class="pattern-relateditems-result-browse" data-path="<%- path %>" title="<%- open_folder %>"><span class="<% if (oneLevelUp) { %>icon-left-circle<% } else { %>icon-right-circle<% } %>"></span></a>\n+    <% } %>\n+    </a>\n+  </div>\n+  <% if (getURL && (getIcon || portal_type === "Image")) { %>\n+  <div class="pattern-relateditems-result-image">\n+    <img src="<%- getURL %>/@@images/image/thumb">\n+  </div>\n   <% } %>\n-  </span>\n-  <a class="pattern-relateditems-result-select<% if (selectable) { %> selectable<% } else if (browsing && is_folderish) { %> pattern-relateditems-result-browse<% } %><% if (oneLevelUp) { %> one-level-up<% } %>" data-path="<%- path %>">\n-    <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon "><br><% } %>\n-    <span class="pattern-relateditems-result-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n-    <span class="pattern-relateditems-result-path"><%- path %></span>\n-  </a>\n </div>\ndiff --git a/mockup/patterns/relateditems/templates/selection.xml b/mockup/patterns/relateditems/templates/selection.xml\nindex 93f409935..c23c9fe37 100644\n--- a/mockup/patterns/relateditems/templates/selection.xml\n+++ b/mockup/patterns/relateditems/templates/selection.xml\n@@ -1,5 +1,11 @@\n-<span class="pattern-relateditems-item">\n-  <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon"><br><% } %>\n-  <span class="pattern-relateditems-item-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n-  <span class="pattern-relateditems-item-path"><%- path %></span>\n-</span>\n+<div class="pattern-relateditems-item">\n+  <div class="pattern-relateditems-result-info">\n+    <span class="pattern-relateditems-item-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+    <span class="pattern-relateditems-item-path"><%- path %></span>\n+  </div>\n+  <% if (getURL && (getIcon || portal_type === "Image")) { %>\n+  <div class="pattern-relateditems-item-image">\n+    <img src="<%- getURL %>/@@images/image/thumb">\n+  </div>\n+  <% } %>\n+</div>\ndiff --git a/mockup/patterns/tinymce/less/pattern.tinymce.less b/mockup/patterns/tinymce/less/pattern.tinymce.less\nindex 15633442a..7953fb29b 100644\n--- a/mockup/patterns/tinymce/less/pattern.tinymce.less\n+++ b/mockup/patterns/tinymce/less/pattern.tinymce.less\n@@ -110,11 +110,6 @@ div.linkModal {\n     }\n }\n \n-.pattern-relateditems-result-image img{\n-    max-height: 30px;\n-    max-width: 80px;\n-}\n-\n .mce-item-table td {\n \tmin-width: 0.6em;  // enforce a min-width while editing for tables with visual aid turned on\n }\n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-09T10:28:07+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/mockup/commit/746eef893cd6cfdc0b8c0be72d06f280f5c32e15

Improve relateditems patern UX

Files changed:
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/pattern.relateditems.less
M mockup/patterns/relateditems/templates/recentlyused.xml
M mockup/patterns/relateditems/templates/result.xml
M mockup/patterns/relateditems/templates/selection.xml
M mockup/patterns/tinymce/less/pattern.tinymce.less

b'diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js\nindex ddbedc8a0..f3f25f840 100644\n--- a/mockup/patterns/relateditems/pattern.js\n+++ b/mockup/patterns/relateditems/pattern.js\n@@ -683,7 +683,6 @@ define([\n                 // Select2 3.5.4 throws an error in some cases in\n                 // updateSelection, ``this.selection.find(".select2-search-choice").remove();``\n                 // No idea why, hard to track.\n-                console.log(data);\n               }\n \n               if (self.openAfterInit) {\n@@ -718,8 +717,21 @@ define([\n       self.$toolbar = $(\'<div class="toolbar ui-offset-parent" />\');\n       self.$container.prepend(self.$toolbar);\n \n-      self.$el.on(\'select2-selecting\', function(event) {\n-        event.preventDefault();\n+      $(document).on(\'keyup\', self.$el, function(event) {\n+        var path;\n+        // Number 39 is the "arrow right" key on the keyboard\n+        if (event.which === 39) {\n+          event.stopPropagation();\n+          path = $(\'.select2-highlighted .pattern-relateditems-result-browse\').data(\'path\');\n+          self.browseTo(path);\n+        }\n+\n+        // Number 37 is the "arrow left" key on the keyboard\n+        if (event.which === 37) {\n+          event.stopPropagation();\n+          path = $(\'.pattern-relateditems-result.one-level-up .pattern-relateditems-result-browse\').data(\'path\');\n+          self.browseTo(path);\n+        }\n       });\n \n       self.renderToolbar();\ndiff --git a/mockup/patterns/relateditems/pattern.relateditems.less b/mockup/patterns/relateditems/pattern.relateditems.less\nindex 2dad96dd3..c5d8fd861 100644\n--- a/mockup/patterns/relateditems/pattern.relateditems.less\n+++ b/mockup/patterns/relateditems/pattern.relateditems.less\n@@ -104,20 +104,60 @@\n                 margin-bottom: 0;\n             }\n         }\n+        .pattern-relateditems-recentlyused-select {\n+            display: flex;\n+            justify-content: space-between;\n+            padding: 3px;\n+            .pattern-relateditems-recentlyused-info{\n+                flex-grow: 2;\n+                hyphens: auto;\n+                white-space: normal;\n+                .pattern-relateditems-item-title {\n+                    line-height: 1.2;\n+                }\n+            }\n+            .pattern-relateditems-recentlyused-image {\n+                flex: 0 0 auto;\n+            }\n+        }\n+    }\n+    .toolbar .dropdown-menu {\n+        min-width: 310px;\n     }\n-\n }\n \n-.pattern-relateditems-dropdown {\n-    .select2-results {\n-        .select2-highlighted {\n-            color: #000;\n-            background: #d8d8d8;\n+.pattern-relateditems-item {\n+    display: flex;\n+\n+    .pattern-relateditems-result-info {\n+        flex-grow: 2;\n+        margin: 0.4em 0.4em 0.4em 1.5em;\n+        hyphens: auto;\n+        .pattern-relateditems-item-title {\n+            line-height: 1.2;\n+            &::before {\n+                height: auto;\n+                width: auto;\n+            }\n         }\n+    }\n+}\n \n-        .select2-selected {\n-            display: list-item;\n-        }\n+.pattern-relateditems-dropdown .select2-results {\n+    max-height: 350px;\n+    background-color: #fffef2;\n+\n+    .select2-result-label {\n+        padding: 0;\n+    }\n+\n+    .select2-highlighted {\n+        color: #000;\n+        background: #d8d8d8;\n+    }\n+\n+    .select2-selected {\n+        display: list-item;\n     }\n }\n \n@@ -130,41 +170,83 @@\n     margin-top: 2px;\n }\n \n+.pat-relateditems .select2-choices {\n+    display: flex;\n+    justify-content: flex-start;\n+    flex-flow: row wrap;\n+    padding: 0.2em;\n+    > li {\n+        flex: 1 1 100%;\n+    }\n+}\n \n+.select2-choices .select2-search-choice.select2-search-choice-focus {\n+    border-left: 0.5em solid #286090 !important;\n+}\n \n-.pattern-relateditems-result {\n-    padding: 0.2em;\n+.select2-container-multi .select2-choices .select2-search-choice {\n+    background-image: none;\n+    background-color: #eee;\n+    padding: 0;\n+    margin: 0.2em;\n+\n+    .select2-search-choice-close {\n+        text-decoration: none;\n+        border-bottom: 0 solid transparent !important;\n+        top: 0.4rem;\n+        left: 0.4rem;\n+        right: auto;\n+    }\n \n+    .pattern-relateditems-item-image {\n+        flex: 0 0 auto;\n+    }\n+}\n+\n+.pattern-relateditems-result {\n+    display: flex;\n+    justify-content: space-between;\n+    margin-bottom: 0.3em;\n     a {\n         &:hover {\n             text-decoration: none;\n         }\n     }\n \n-    .pattern-relateditems-buttons {\n-        display: inline-block;\n-        width: 1.5em;\n-        font-size: 1.5em;\n-        vertical-align: top;\n-        a {\n-            .glyphicon;\n-            .glyphicon-folder-close;\n+    .pattern-relateditems-result-info {\n+        padding: 0.2em;\n+    }\n+\n+    .pattern-relateditems-result-browse-wrapper {\n+        flex: 2 1 fill;\n+        display: flex;\n+        justify-content: flex-start;\n+\n+        .pattern-relateditems-result-select {\n+\n+            &:not(.selectable):not(.one-level-up) {\n+                opacity: 0.6;\n+            }\n+        }\n+\n+        .pattern-relateditems-result-browse {\n+            font-size: 210%;\n+            margin: 0 0.1em 0 0.05em;\n+            padding: 0 0.15em;\n+            display: inline;\n+            line-height: 1.2em;\n             &:hover {\n-                .glyphicon-folder-open;\n+                background-color: lighten(#d8d8d8, 5%) ;\n             }\n-            &:hover:before {\n-                color:purple;\n+            span {\n+                vertical-align: middle;\n             }\n         }\n-    }\n \n-    .pattern-relateditems-result-select {\n-        display: inline-block;\n-        &:not(.selectable):not(.one-level-up) {\n-            opacity: 0.6;\n-        }\n     }\n \n+\n+\n }\n \n .pattern-relateditems-recentlyused-path,\ndiff --git a/mockup/patterns/relateditems/templates/recentlyused.xml b/mockup/patterns/relateditems/templates/recentlyused.xml\nindex b463351e1..0b1eab9ab 100644\n--- a/mockup/patterns/relateditems/templates/recentlyused.xml\n+++ b/mockup/patterns/relateditems/templates/recentlyused.xml\n@@ -1,7 +1,13 @@\n-<div class="pattern-relateditems-recentlyused">\n+<li class="pattern-relateditems-recentlyused">\n   <a class="pattern-relateditems-recentlyused-select" data-uid="<%- UID %>">\n-    <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon "><br><% } %>\n-    <span class="pattern-relateditems-recentlyused-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n-    <span class="pattern-relateditems-recentlyused-path"><%- path %></span>\n+    <div class="pattern-relateditems-recentlyused-info">\n+      <span class="pattern-relateditems-recentlyused-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+      <span class="pattern-relateditems-recentlyused-path"><%- path %></span>\n+    </div>\n+    <% if (getURL && (getIcon || portal_type === "Image")) { %>\n+    <div class="pattern-relateditems-recentlyused-image">\n+      <img src="<%- getURL %>/@@images/image/tile">\n+    </div>\n+    <% } %>\n   </a>\n-</div>\n+</li>\ndiff --git a/mockup/patterns/relateditems/templates/result.xml b/mockup/patterns/relateditems/templates/result.xml\nindex c9d896687..e58269b0d 100644\n--- a/mockup/patterns/relateditems/templates/result.xml\n+++ b/mockup/patterns/relateditems/templates/result.xml\n@@ -1,12 +1,18 @@\n <div class="pattern-relateditems-result<% if (oneLevelUp) { %> one-level-up<% } %>">\n-  <span class="pattern-relateditems-buttons">\n-  <% if (is_folderish) { %>\n-    <a class="pattern-relateditems-result-browse" data-path="<%- path %>" title="<%- open_folder %>"></a>\n+  <div class="pattern-relateditems-result-browse-wrapper">\n+    <a class="pattern-relateditems-result-select<% if (selectable) { %> selectable<% } %><% if (oneLevelUp) { %> one-level-up<% } %>" data-path="<%- path %>">\n+      <div class="pattern-relateditems-result-info">\n+        <span class="pattern-relateditems-result-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+        <span class="pattern-relateditems-result-path"><%- path %></span>\n+      </div>\n+    <% if (is_folderish) { %>\n+      <a class="pattern-relateditems-result-browse" data-path="<%- path %>" title="<%- open_folder %>"><span class="<% if (oneLevelUp) { %>icon-left-circle<% } else { %>icon-right-circle<% } %>"></span></a>\n+    <% } %>\n+    </a>\n+  </div>\n+  <% if (getURL && (getIcon || portal_type === "Image")) { %>\n+  <div class="pattern-relateditems-result-image">\n+    <img src="<%- getURL %>/@@images/image/thumb">\n+  </div>\n   <% } %>\n-  </span>\n-  <a class="pattern-relateditems-result-select<% if (selectable) { %> selectable<% } else if (browsing && is_folderish) { %> pattern-relateditems-result-browse<% } %><% if (oneLevelUp) { %> one-level-up<% } %>" data-path="<%- path %>">\n-    <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon "><br><% } %>\n-    <span class="pattern-relateditems-result-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n-    <span class="pattern-relateditems-result-path"><%- path %></span>\n-  </a>\n </div>\ndiff --git a/mockup/patterns/relateditems/templates/selection.xml b/mockup/patterns/relateditems/templates/selection.xml\nindex 93f409935..c23c9fe37 100644\n--- a/mockup/patterns/relateditems/templates/selection.xml\n+++ b/mockup/patterns/relateditems/templates/selection.xml\n@@ -1,5 +1,11 @@\n-<span class="pattern-relateditems-item">\n-  <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon"><br><% } %>\n-  <span class="pattern-relateditems-item-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n-  <span class="pattern-relateditems-item-path"><%- path %></span>\n-</span>\n+<div class="pattern-relateditems-item">\n+  <div class="pattern-relateditems-result-info">\n+    <span class="pattern-relateditems-item-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+    <span class="pattern-relateditems-item-path"><%- path %></span>\n+  </div>\n+  <% if (getURL && (getIcon || portal_type === "Image")) { %>\n+  <div class="pattern-relateditems-item-image">\n+    <img src="<%- getURL %>/@@images/image/thumb">\n+  </div>\n+  <% } %>\n+</div>\ndiff --git a/mockup/patterns/tinymce/less/pattern.tinymce.less b/mockup/patterns/tinymce/less/pattern.tinymce.less\nindex 15633442a..7953fb29b 100644\n--- a/mockup/patterns/tinymce/less/pattern.tinymce.less\n+++ b/mockup/patterns/tinymce/less/pattern.tinymce.less\n@@ -110,11 +110,6 @@ div.linkModal {\n     }\n }\n \n-.pattern-relateditems-result-image img{\n-    max-height: 30px;\n-    max-width: 80px;\n-}\n-\n .mce-item-table td {\n \tmin-width: 0.6em;  // enforce a min-width while editing for tables with visual aid turned on\n }\n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-09T10:29:44+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/mockup/commit/c70097f6b1820592ca4f4e8e105a1a8aed86b3db

Merge remote-tracking branch 'remotes/origin/mrtango-improve-relateditems-ux' into mrtango-improve-relateditems-ux

Files changed:


b''

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-09T13:56:03+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/mockup/commit/07ab64fb8b0c366386f9b1b2f270608df60586bb

Finish keyboard navigation in relateditems pattern

Files changed:
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/select2/pattern.js

b'diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js\nindex f3f25f840..fda069fdf 100644\n--- a/mockup/patterns/relateditems/pattern.js\n+++ b/mockup/patterns/relateditems/pattern.js\n@@ -10,7 +10,7 @@\n  *    favorites(array): Array of objects. These are favorites, which can be used to quickly jump to different locations. Objects have the attributes "title" and "path". Default: []\n  *    maximumSelectionSize(integer): The maximum number of items that can be selected in a multi-select control. If this number is less than 1 selection is not limited. (-1)\n  *    minimumInputLength: Select2 option. Number of characters necessary to start a search. Default: 0.\n- *    mode(string): Initial widget mode. Possible values: \'search\', \'browse\'. If set to \'search\', the catalog is searched for a searchterm. If set to \'browse\', browsing starts at basePath. Default: \'search\'.\n+ *    mode(string): Initial widget mode. Possible values: are \'auto\', \'search\' and \'browse\'. If set to \'search\', the catalog is searched for a searchterm. If set to \'browse\', browsing starts at basePath. Default: \'auto\'.\n  *    orderable(boolean): Whether or not items should be drag-and-drop sortable. (true)\n  *    pageSize(int): Batch size to break down big result sets into multiple pages. (10).\n  *    recentlyUsed(boolen): Show the recently used items dropdown (false).\n@@ -286,7 +286,7 @@ define([\n \n           // Filter out items:\n           // While browsing: always include folderish items\n-          // Browsing and searching: Only include selectable items, which are not already selected.\n+          // Browsing and searching: Only include folders and selectable items which are not already selected.\n           results = results.filter(\n             function (item) {\n               if (\n@@ -718,18 +718,26 @@ define([\n       self.$container.prepend(self.$toolbar);\n \n       $(document).on(\'keyup\', self.$el, function(event) {\n-        var path;\n+        var path, browsableItem;\n         // Number 39 is the "arrow right" key on the keyboard\n-        if (event.which === 39) {\n+        if (event.which === 39 && Select2.prototype.opened.call(self)) {\n           event.stopPropagation();\n-          path = $(\'.select2-highlighted .pattern-relateditems-result-browse\').data(\'path\');\n+          browsableItem = $(\'.select2-highlighted .pattern-relateditems-result-browse\');\n+          if (browsableItem.length !== 1) {\n+            return\n+          }\n+          path = browsableItem.data(\'path\');\n           self.browseTo(path);\n         }\n \n         // Number 37 is the "arrow left" key on the keyboard\n-        if (event.which === 37) {\n+        if (event.which === 37 && Select2.prototype.opened.call(self)) {\n           event.stopPropagation();\n-          path = $(\'.pattern-relateditems-result.one-level-up .pattern-relateditems-result-browse\').data(\'path\');\n+          browsableItem = $(\'.pattern-relateditems-result.one-level-up .pattern-relateditems-result-browse\');\n+          if (browsableItem.length !== 1) {\n+            return\n+          }\n+          path = browsableItem.data(\'path\');\n           self.browseTo(path);\n         }\n       });\ndiff --git a/mockup/patterns/select2/pattern.js b/mockup/patterns/select2/pattern.js\nindex 173bb9d1d..986de4a83 100644\n--- a/mockup/patterns/select2/pattern.js\n+++ b/mockup/patterns/select2/pattern.js\n@@ -212,6 +212,12 @@ define([\n         self.$select2.addClass(\'select2-orderable\');\n       }\n     },\n+    opened: function () {\n+      var self = this,\n+        state;\n+      state = self.$el.parent().find(\'.select2-dropdown-open\').length === 1;\n+      return state;\n+    },\n     init: function() {\n       var self = this;\n \n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-10T13:28:56+01:00
Author: Davi Lima (davilima6) <davilima6@gmail.com>
Commit: https://github.com/plone/mockup/commit/59e12b614f8de9fcab525bd9eb53b305ba466f32

Add some refactorings

Files changed:
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/pattern.relateditems.less
M mockup/patterns/select2/pattern.js

b'diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js\nindex fda069fdf..8f1895f57 100644\n--- a/mockup/patterns/relateditems/pattern.js\n+++ b/mockup/patterns/relateditems/pattern.js\n@@ -10,10 +10,10 @@\n  *    favorites(array): Array of objects. These are favorites, which can be used to quickly jump to different locations. Objects have the attributes "title" and "path". Default: []\n  *    maximumSelectionSize(integer): The maximum number of items that can be selected in a multi-select control. If this number is less than 1 selection is not limited. (-1)\n  *    minimumInputLength: Select2 option. Number of characters necessary to start a search. Default: 0.\n- *    mode(string): Initial widget mode. Possible values: are \'auto\', \'search\' and \'browse\'. If set to \'search\', the catalog is searched for a searchterm. If set to \'browse\', browsing starts at basePath. Default: \'auto\'.\n+ *    mode(string): Initial widget mode. Possible values: are \'auto\', \'search\' and \'browse\'. If set to \'search\', the catalog is searched for a searchterm. If set to \'browse\', browsing starts at basePath. Default: \'auto\', which means the combination of both.\n  *    orderable(boolean): Whether or not items should be drag-and-drop sortable. (true)\n  *    pageSize(int): Batch size to break down big result sets into multiple pages. (10).\n- *    recentlyUsed(boolen): Show the recently used items dropdown (false).\n+ *    recentlyUsed(boolean): Show the recently used items dropdown (false).\n  *    recentlyUsedMaxItems(integer): Maximum items to keep in recently used list. 0: no restriction. (20).\n  *    rootPath(string): Only display breadcrumb path elements deeper than this path. Default: "/"\n  *    rootUrl(string): Visible URL up to the rootPath. This is prepended to the currentPath to generate submission URLs.\n@@ -119,6 +119,11 @@ define([\n ) {\n   \'use strict\';\n \n+  var KEY = {\n+    LEFT: 37,\n+    RIGHT: 39\n+  };\n+\n   var RelatedItems = Base.extend({\n     name: \'relateditems\',\n     trigger: \'.pat-relateditems\',\n@@ -286,12 +291,13 @@ define([\n \n           // Filter out items:\n           // While browsing: always include folderish items\n-          // Browsing and searching: Only include folders and selectable items which are not already selected.\n+          // Browsing and searching: Only include selectable items which are not already selected, and all folders\n+          // even if they\'re selected, as we need them available for browsing/selecting their children\n           results = results.filter(\n             function (item) {\n               if (\n                 (this.browsing && item.is_folderish) ||\n-                (this.isSelectable(item) && this.selectedUIDs.indexOf(item.UID) == -1)\n+                (this.isSelectable(item) && !this.selectedUIDs.includes(item.UID))\n               ) {\n                 return true;\n               }\n@@ -543,7 +549,7 @@ define([\n       if (self.options.selectableTypes === null) {\n         return true;\n       } else {\n-        return _.indexOf(self.options.selectableTypes, item.portal_type) > -1;\n+        return self.options.selectableTypes.includes(item.portal_type);\n       }\n     },\n \n@@ -612,7 +618,7 @@ define([\n             \'selectable\': false,\n         }, item);\n \n-        if (self.selectedUIDs.indexOf(item.UID) != -1) {\n+        if (self.selectedUIDs.includes(item.UID)) {\n             // do not allow already selected items to be selected again.\n             item.selectable = false;\n         }\n@@ -695,16 +701,11 @@ define([\n             false\n           );\n         }\n-\n       };\n \n       self.options.tokenizer = function (input) {\n         if (this.options.mode === \'auto\') {\n-          if (input) {\n-            this.browsing = false;\n-          } else {\n-            this.browsing = true;\n-          }\n+          this.browsing = input ? false : true;\n         }\n       }.bind(this);\n \n@@ -716,34 +717,35 @@ define([\n \n       self.$toolbar = $(\'<div class="toolbar ui-offset-parent" />\');\n       self.$container.prepend(self.$toolbar);\n+      self.renderToolbar();\n \n       $(document).on(\'keyup\', self.$el, function(event) {\n-        var path, browsableItem;\n-        // Number 39 is the "arrow right" key on the keyboard\n-        if (event.which === 39 && Select2.prototype.opened.call(self)) {\n-          event.stopPropagation();\n-          browsableItem = $(\'.select2-highlighted .pattern-relateditems-result-browse\');\n-          if (browsableItem.length !== 1) {\n-            return\n-          }\n-          path = browsableItem.data(\'path\');\n-          self.browseTo(path);\n+        var isOpen = Select2.prototype.opened.call(self);\n+\n+        if (!isOpen) {\n+          return;\n         }\n \n-        // Number 37 is the "arrow left" key on the keyboard\n-        if (event.which === 37 && Select2.prototype.opened.call(self)) {\n+        if ((event.which === KEY.LEFT) || (event.which === KEY.RIGHT)) {\n           event.stopPropagation();\n-          browsableItem = $(\'.pattern-relateditems-result.one-level-up .pattern-relateditems-result-browse\');\n+\n+          var selectorContext =\n+            event.which === KEY.LEFT\n+              ? \'.pattern-relateditems-result.one-level-up\'\n+              : \'.select2-highlighted\';\n+\n+          var browsableItemSelector = \'.pattern-relateditems-result-browse\';\n+          var browsableItem = $(browsableItemSelector, selectorContext);\n+\n           if (browsableItem.length !== 1) {\n-            return\n+            return;\n           }\n-          path = browsableItem.data(\'path\');\n+\n+          var path = browsableItem.data(\'path\');\n+\n           self.browseTo(path);\n         }\n       });\n-\n-      self.renderToolbar();\n-\n     }\n   });\n \ndiff --git a/mockup/patterns/relateditems/pattern.relateditems.less b/mockup/patterns/relateditems/pattern.relateditems.less\nindex c5d8fd861..4083ce482 100644\n--- a/mockup/patterns/relateditems/pattern.relateditems.less\n+++ b/mockup/patterns/relateditems/pattern.relateditems.less\n@@ -207,6 +207,7 @@\n     display: flex;\n     justify-content: space-between;\n     margin-bottom: 0.3em;\n+\n     a {\n         &:hover {\n             text-decoration: none;\n@@ -223,7 +224,6 @@\n         justify-content: flex-start;\n \n         .pattern-relateditems-result-select {\n-\n             &:not(.selectable):not(.one-level-up) {\n                 opacity: 0.6;\n             }\n@@ -235,6 +235,7 @@\n             padding: 0 0.15em;\n             display: inline;\n             line-height: 1.2em;\n+\n             &:hover {\n                 background-color: lighten(#d8d8d8, 5%) ;\n             }\n@@ -242,17 +243,15 @@\n                 vertical-align: middle;\n             }\n         }\n-\n     }\n-\n-\n-\n }\n \n-.pattern-relateditems-recentlyused-path,\n-.pattern-relateditems-item-path,\n-.pattern-relateditems-result-path {\n-    font-size: 0.8em;\n-    display: block;\n-    color: #444;\n+.pattern-relateditems {\n+    &-recentlyused-path,\n+    &-item-path,\n+    &-result-path {\n+        font-size: 0.8em;\n+        display: block;\n+        color: #444;\n+    }\n }\ndiff --git a/mockup/patterns/select2/pattern.js b/mockup/patterns/select2/pattern.js\nindex 986de4a83..90791699b 100644\n--- a/mockup/patterns/select2/pattern.js\n+++ b/mockup/patterns/select2/pattern.js\n@@ -213,10 +213,9 @@ define([\n       }\n     },\n     opened: function () {\n-      var self = this,\n-        state;\n-      state = self.$el.parent().find(\'.select2-dropdown-open\').length === 1;\n-      return state;\n+      var self = this;\n+      var isOpen = $(\'.select2-dropdown-open\', self.$el.parent()).length === 1;\n+      return isOpen;\n     },\n     init: function() {\n       var self = this;\n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-10T13:40:16+01:00
Author: Davi Lima (davilima6) <davilima6@gmail.com>
Commit: https://github.com/plone/mockup/commit/f4fc6b3e6db0276153bc780fb9ef240d62de8721

Add some templates refactoring

Files changed:
M mockup/patterns/relateditems/templates/recentlyused.xml
M mockup/patterns/relateditems/templates/result.xml
M mockup/patterns/relateditems/templates/selection.xml

b'diff --git a/mockup/patterns/relateditems/templates/recentlyused.xml b/mockup/patterns/relateditems/templates/recentlyused.xml\nindex 0b1eab9ab..410569890 100644\n--- a/mockup/patterns/relateditems/templates/recentlyused.xml\n+++ b/mockup/patterns/relateditems/templates/recentlyused.xml\n@@ -1,13 +1,17 @@\n <li class="pattern-relateditems-recentlyused">\n   <a class="pattern-relateditems-recentlyused-select" data-uid="<%- UID %>">\n     <div class="pattern-relateditems-recentlyused-info">\n-      <span class="pattern-relateditems-recentlyused-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+      <span\n+        class="pattern-relateditems-recentlyused-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n+        title="<%- portal_type %>">\n+        <%- Title %>\n+      </span>\n       <span class="pattern-relateditems-recentlyused-path"><%- path %></span>\n     </div>\n     <% if (getURL && (getIcon || portal_type === "Image")) { %>\n-    <div class="pattern-relateditems-recentlyused-image">\n-      <img src="<%- getURL %>/@@images/image/tile">\n-    </div>\n+      <div class="pattern-relateditems-recentlyused-image">\n+        <img src="<%- getURL %>/@@images/image/tile" />\n+      </div>\n     <% } %>\n   </a>\n </li>\ndiff --git a/mockup/patterns/relateditems/templates/result.xml b/mockup/patterns/relateditems/templates/result.xml\nindex e58269b0d..5921b6811 100644\n--- a/mockup/patterns/relateditems/templates/result.xml\n+++ b/mockup/patterns/relateditems/templates/result.xml\n@@ -1,18 +1,29 @@\n-<div class="pattern-relateditems-result<% if (oneLevelUp) { %> one-level-up<% } %>">\n+<div class="pattern-relateditems-result <%- oneLevelUp ? \'one-level-up\' : \'\' %>">\n   <div class="pattern-relateditems-result-browse-wrapper">\n-    <a class="pattern-relateditems-result-select<% if (selectable) { %> selectable<% } %><% if (oneLevelUp) { %> one-level-up<% } %>" data-path="<%- path %>">\n+    <a\n+      class="pattern-relateditems-result-select <%- selectable ? \'selectable\' : \'\' %> <%- oneLevelUp ? \'one-level-up\' : \'\' %>"\n+      data-path="<%- path %>">\n       <div class="pattern-relateditems-result-info">\n-        <span class="pattern-relateditems-result-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+        <span\n+          class="pattern-relateditems-result-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n+          title="<%- portal_type %>">\n+          <%- Title %>\n+        </span>\n         <span class="pattern-relateditems-result-path"><%- path %></span>\n       </div>\n-    <% if (is_folderish) { %>\n-      <a class="pattern-relateditems-result-browse" data-path="<%- path %>" title="<%- open_folder %>"><span class="<% if (oneLevelUp) { %>icon-left-circle<% } else { %>icon-right-circle<% } %>"></span></a>\n-    <% } %>\n+      <% if (is_folderish) { %>\n+        <a\n+          class="pattern-relateditems-result-browse"\n+          data-path="<%- path %>"\n+          title="<%- open_folder %>">\n+          <span class="<%- oneLevelUp ? \'icon-left-circle\' : \'icon-right-circle\' %>"></span>\n+        </a>\n+      <% } %>\n     </a>\n   </div>\n   <% if (getURL && (getIcon || portal_type === "Image")) { %>\n-  <div class="pattern-relateditems-result-image">\n-    <img src="<%- getURL %>/@@images/image/thumb">\n-  </div>\n+    <div class="pattern-relateditems-result-image">\n+      <img src="<%- getURL %>/@@images/image/thumb" />\n+    </div>\n   <% } %>\n </div>\ndiff --git a/mockup/patterns/relateditems/templates/selection.xml b/mockup/patterns/relateditems/templates/selection.xml\nindex c23c9fe37..36c3fa35d 100644\n--- a/mockup/patterns/relateditems/templates/selection.xml\n+++ b/mockup/patterns/relateditems/templates/selection.xml\n@@ -1,11 +1,15 @@\n <div class="pattern-relateditems-item">\n   <div class="pattern-relateditems-result-info">\n-    <span class="pattern-relateditems-item-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+    <span\n+      class="pattern-relateditems-item-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n+      title="<%- portal_type %>">\n+      <%- Title %>\n+    </span>\n     <span class="pattern-relateditems-item-path"><%- path %></span>\n   </div>\n   <% if (getURL && (getIcon || portal_type === "Image")) { %>\n-  <div class="pattern-relateditems-item-image">\n-    <img src="<%- getURL %>/@@images/image/thumb">\n-  </div>\n+    <div class="pattern-relateditems-item-image">\n+      <img src="<%- getURL %>/@@images/image/thumb" />\n+    </div>\n   <% } %>\n </div>\n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-10T13:40:16+01:00
Author: Davi Lima (davilima6) <davilima6@gmail.com>
Commit: https://github.com/plone/mockup/commit/96002dedf03eef0fee47256b654ee9a4641418fb

Update lock after changing jquery.recurrenceinput.js to use master branch

Files changed:
M yarn.lock

b'diff --git a/yarn.lock b/yarn.lock\nindex a8c4a5bee..75cd353c7 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -2764,9 +2764,9 @@ jqtree@>=0.16:\n   version "1.4.1"\n   resolved "https://github.com/carhartl/jquery-cookie.git#7f88a4e631aba8a8c688fd8999ce6b9bcfd50718"\n \n-"jquery.recurrenceinput.js@https://github.com/collective/jquery.recurrenceinput.js.git#thet-npm":\n+"jquery.recurrenceinput.js@https://github.com/collective/jquery.recurrenceinput.js.git#master":\n   version "1.6.0"\n-  resolved "https://github.com/collective/jquery.recurrenceinput.js.git#84af75b92770dff10767cb2ade40c134ca1e8047"\n+  resolved "https://github.com/collective/jquery.recurrenceinput.js.git#deaec1116575d81698778f87d8c08f02487aadf9"\n   dependencies:\n     jquery ""\n \n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-13T17:42:07+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/mockup/commit/972408cdfad56c840d287988e313c43f39ba4b83

optimze css for relateditems pattern

Files changed:
M mockup/patterns/relateditems/pattern.relateditems.less

b'diff --git a/mockup/patterns/relateditems/pattern.relateditems.less b/mockup/patterns/relateditems/pattern.relateditems.less\nindex c5d8fd861..fe0d966a2 100644\n--- a/mockup/patterns/relateditems/pattern.relateditems.less\n+++ b/mockup/patterns/relateditems/pattern.relateditems.less\n@@ -112,9 +112,6 @@\n                 flex-grow: 2;\n                 hyphens: auto;\n                 white-space: normal;\n-                .pattern-relateditems-item-title {\n-                    line-height: 1.2;\n-                }\n             }\n             .pattern-relateditems-recentlyused-image {\n                 flex: 0 0 auto;\n@@ -124,36 +121,39 @@\n     .toolbar .dropdown-menu {\n         min-width: 310px;\n     }\n-}\n-\n-.pattern-relateditems-item {\n-    display: flex;\n \n     .pattern-relateditems-result-info {\n         flex-grow: 2;\n         margin: 0.4em 0.4em 0.4em 1.5em;\n         hyphens: auto;\n-        .pattern-relateditems-item-title {\n-            line-height: 1.2;\n-            &::before {\n-                height: auto;\n-                width: auto;\n-            }\n-        }\n+    }\n+\n+    .pattern-relateditems-item {\n+        display: flex;\n     }\n }\n \n+\n .pattern-relateditems-dropdown .select2-results {\n     max-height: 350px;\n-    background-color: #fffef2;\n+    background-color: #fff;\n+\n+    .select2-result {\n+        background-color: transparent;\n+    }\n+\n+    .select2-result:nth-child(odd) {\n+        background-color: #f7f7f7;\n+    }\n \n     .select2-result-label {\n         padding: 0;\n     }\n \n-    .select2-highlighted {\n-        color: #000;\n-        background: #d8d8d8;\n+    .select2-result.select2-highlighted {\n+        //color: auto;\n+        //background: auto;\n+        border-left: 0.5em solid #007bb3 !important;\n     }\n \n     .select2-selected {\n@@ -174,6 +174,7 @@\n     display: flex;\n     justify-content: flex-start;\n     flex-flow: row wrap;\n+    align-items: stretch;\n     padding: 0.2em;\n     > li {\n         flex: 1 1 100%;\n@@ -189,6 +190,8 @@\n     background-color: #eee;\n     padding: 0;\n     margin: 0.2em;\n+    // make choices list compact:\n+    //flex: 1 1 auto;\n \n     .select2-search-choice-close {\n         text-decoration: none;\n@@ -206,7 +209,7 @@\n .pattern-relateditems-result {\n     display: flex;\n     justify-content: space-between;\n-    margin-bottom: 0.3em;\n+    margin-bottom: 0.15em;\n     a {\n         &:hover {\n             text-decoration: none;\n@@ -214,7 +217,7 @@\n     }\n \n     .pattern-relateditems-result-info {\n-        padding: 0.2em;\n+        padding: 0.4em;\n     }\n \n     .pattern-relateditems-result-browse-wrapper {\n@@ -230,11 +233,10 @@\n         }\n \n         .pattern-relateditems-result-browse {\n-            font-size: 210%;\n-            margin: 0 0.1em 0 0.05em;\n-            padding: 0 0.15em;\n-            display: inline;\n-            line-height: 1.2em;\n+            font-size:170%;\n+            margin:0 0.1em 0 0;\n+            padding:0 0.15em 0 0.1em;\n+            line-height:1.8em;\n             &:hover {\n                 background-color: lighten(#d8d8d8, 5%) ;\n             }\n@@ -242,11 +244,34 @@\n                 vertical-align: middle;\n             }\n         }\n-\n     }\n+}\n \n+.pattern-relateditems-result-title {\n+    font-size: 124%;\n+    line-height: 1.2;\n+    padding: 0;\n+    &[class*="contenttype-"]::before {\n+        font-size:92%;\n+        width:15px;\n+        height:25px;\n+        vertical-align:middle;\n+    }\n+}\n+.pattern-relateditems-result-path {\n+    margin-top: -5px;\n+}\n \n-\n+// keep images at 128x128 even if the thumb size is set heigher\n+#content-core {\n+    .pattern-relateditems-result-image,\n+    .pattern-relateditems-recentlyused-image,\n+    .pattern-relateditems-item-image {\n+        img {\n+            max-width: 128px;\n+            max-height: 128px;\n+        }\n+    }\n }\n \n .pattern-relateditems-recentlyused-path,\n@@ -255,4 +280,5 @@\n     font-size: 0.8em;\n     display: block;\n     color: #444;\n+    padding-left: 0.2em;\n }\n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-13T17:46:39+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/mockup/commit/c6f9e4a9867c2a144a40afab72b29a08178e691e

Merge remote-tracking branch 'refs/remotes/origin/mrtango-improve-relateditems-ux' into mrtango-improve-relateditems-ux

Files changed:
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/pattern.relateditems.less
M mockup/patterns/relateditems/templates/recentlyused.xml
M mockup/patterns/relateditems/templates/result.xml
M mockup/patterns/relateditems/templates/selection.xml
M mockup/patterns/select2/pattern.js
M yarn.lock

b'diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js\nindex fda069fdf..8f1895f57 100644\n--- a/mockup/patterns/relateditems/pattern.js\n+++ b/mockup/patterns/relateditems/pattern.js\n@@ -10,10 +10,10 @@\n  *    favorites(array): Array of objects. These are favorites, which can be used to quickly jump to different locations. Objects have the attributes "title" and "path". Default: []\n  *    maximumSelectionSize(integer): The maximum number of items that can be selected in a multi-select control. If this number is less than 1 selection is not limited. (-1)\n  *    minimumInputLength: Select2 option. Number of characters necessary to start a search. Default: 0.\n- *    mode(string): Initial widget mode. Possible values: are \'auto\', \'search\' and \'browse\'. If set to \'search\', the catalog is searched for a searchterm. If set to \'browse\', browsing starts at basePath. Default: \'auto\'.\n+ *    mode(string): Initial widget mode. Possible values: are \'auto\', \'search\' and \'browse\'. If set to \'search\', the catalog is searched for a searchterm. If set to \'browse\', browsing starts at basePath. Default: \'auto\', which means the combination of both.\n  *    orderable(boolean): Whether or not items should be drag-and-drop sortable. (true)\n  *    pageSize(int): Batch size to break down big result sets into multiple pages. (10).\n- *    recentlyUsed(boolen): Show the recently used items dropdown (false).\n+ *    recentlyUsed(boolean): Show the recently used items dropdown (false).\n  *    recentlyUsedMaxItems(integer): Maximum items to keep in recently used list. 0: no restriction. (20).\n  *    rootPath(string): Only display breadcrumb path elements deeper than this path. Default: "/"\n  *    rootUrl(string): Visible URL up to the rootPath. This is prepended to the currentPath to generate submission URLs.\n@@ -119,6 +119,11 @@ define([\n ) {\n   \'use strict\';\n \n+  var KEY = {\n+    LEFT: 37,\n+    RIGHT: 39\n+  };\n+\n   var RelatedItems = Base.extend({\n     name: \'relateditems\',\n     trigger: \'.pat-relateditems\',\n@@ -286,12 +291,13 @@ define([\n \n           // Filter out items:\n           // While browsing: always include folderish items\n-          // Browsing and searching: Only include folders and selectable items which are not already selected.\n+          // Browsing and searching: Only include selectable items which are not already selected, and all folders\n+          // even if they\'re selected, as we need them available for browsing/selecting their children\n           results = results.filter(\n             function (item) {\n               if (\n                 (this.browsing && item.is_folderish) ||\n-                (this.isSelectable(item) && this.selectedUIDs.indexOf(item.UID) == -1)\n+                (this.isSelectable(item) && !this.selectedUIDs.includes(item.UID))\n               ) {\n                 return true;\n               }\n@@ -543,7 +549,7 @@ define([\n       if (self.options.selectableTypes === null) {\n         return true;\n       } else {\n-        return _.indexOf(self.options.selectableTypes, item.portal_type) > -1;\n+        return self.options.selectableTypes.includes(item.portal_type);\n       }\n     },\n \n@@ -612,7 +618,7 @@ define([\n             \'selectable\': false,\n         }, item);\n \n-        if (self.selectedUIDs.indexOf(item.UID) != -1) {\n+        if (self.selectedUIDs.includes(item.UID)) {\n             // do not allow already selected items to be selected again.\n             item.selectable = false;\n         }\n@@ -695,16 +701,11 @@ define([\n             false\n           );\n         }\n-\n       };\n \n       self.options.tokenizer = function (input) {\n         if (this.options.mode === \'auto\') {\n-          if (input) {\n-            this.browsing = false;\n-          } else {\n-            this.browsing = true;\n-          }\n+          this.browsing = input ? false : true;\n         }\n       }.bind(this);\n \n@@ -716,34 +717,35 @@ define([\n \n       self.$toolbar = $(\'<div class="toolbar ui-offset-parent" />\');\n       self.$container.prepend(self.$toolbar);\n+      self.renderToolbar();\n \n       $(document).on(\'keyup\', self.$el, function(event) {\n-        var path, browsableItem;\n-        // Number 39 is the "arrow right" key on the keyboard\n-        if (event.which === 39 && Select2.prototype.opened.call(self)) {\n-          event.stopPropagation();\n-          browsableItem = $(\'.select2-highlighted .pattern-relateditems-result-browse\');\n-          if (browsableItem.length !== 1) {\n-            return\n-          }\n-          path = browsableItem.data(\'path\');\n-          self.browseTo(path);\n+        var isOpen = Select2.prototype.opened.call(self);\n+\n+        if (!isOpen) {\n+          return;\n         }\n \n-        // Number 37 is the "arrow left" key on the keyboard\n-        if (event.which === 37 && Select2.prototype.opened.call(self)) {\n+        if ((event.which === KEY.LEFT) || (event.which === KEY.RIGHT)) {\n           event.stopPropagation();\n-          browsableItem = $(\'.pattern-relateditems-result.one-level-up .pattern-relateditems-result-browse\');\n+\n+          var selectorContext =\n+            event.which === KEY.LEFT\n+              ? \'.pattern-relateditems-result.one-level-up\'\n+              : \'.select2-highlighted\';\n+\n+          var browsableItemSelector = \'.pattern-relateditems-result-browse\';\n+          var browsableItem = $(browsableItemSelector, selectorContext);\n+\n           if (browsableItem.length !== 1) {\n-            return\n+            return;\n           }\n-          path = browsableItem.data(\'path\');\n+\n+          var path = browsableItem.data(\'path\');\n+\n           self.browseTo(path);\n         }\n       });\n-\n-      self.renderToolbar();\n-\n     }\n   });\n \ndiff --git a/mockup/patterns/relateditems/pattern.relateditems.less b/mockup/patterns/relateditems/pattern.relateditems.less\nindex fe0d966a2..5cf7c3360 100644\n--- a/mockup/patterns/relateditems/pattern.relateditems.less\n+++ b/mockup/patterns/relateditems/pattern.relateditems.less\n@@ -226,7 +226,6 @@\n         justify-content: flex-start;\n \n         .pattern-relateditems-result-select {\n-\n             &:not(.selectable):not(.one-level-up) {\n                 opacity: 0.6;\n             }\n@@ -274,11 +273,13 @@\n     }\n }\n \n-.pattern-relateditems-recentlyused-path,\n-.pattern-relateditems-item-path,\n-.pattern-relateditems-result-path {\n-    font-size: 0.8em;\n-    display: block;\n-    color: #444;\n-    padding-left: 0.2em;\n+.pattern-relateditems {\n+    &-recentlyused-path,\n+    &-item-path,\n+    &-result-path {\n+        font-size: 0.8em;\n+        display: block;\n+        color: #444;\n+        padding-left: 0.2em;\n+    }\n }\ndiff --git a/mockup/patterns/relateditems/templates/recentlyused.xml b/mockup/patterns/relateditems/templates/recentlyused.xml\nindex 0b1eab9ab..410569890 100644\n--- a/mockup/patterns/relateditems/templates/recentlyused.xml\n+++ b/mockup/patterns/relateditems/templates/recentlyused.xml\n@@ -1,13 +1,17 @@\n <li class="pattern-relateditems-recentlyused">\n   <a class="pattern-relateditems-recentlyused-select" data-uid="<%- UID %>">\n     <div class="pattern-relateditems-recentlyused-info">\n-      <span class="pattern-relateditems-recentlyused-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+      <span\n+        class="pattern-relateditems-recentlyused-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n+        title="<%- portal_type %>">\n+        <%- Title %>\n+      </span>\n       <span class="pattern-relateditems-recentlyused-path"><%- path %></span>\n     </div>\n     <% if (getURL && (getIcon || portal_type === "Image")) { %>\n-    <div class="pattern-relateditems-recentlyused-image">\n-      <img src="<%- getURL %>/@@images/image/tile">\n-    </div>\n+      <div class="pattern-relateditems-recentlyused-image">\n+        <img src="<%- getURL %>/@@images/image/tile" />\n+      </div>\n     <% } %>\n   </a>\n </li>\ndiff --git a/mockup/patterns/relateditems/templates/result.xml b/mockup/patterns/relateditems/templates/result.xml\nindex e58269b0d..5921b6811 100644\n--- a/mockup/patterns/relateditems/templates/result.xml\n+++ b/mockup/patterns/relateditems/templates/result.xml\n@@ -1,18 +1,29 @@\n-<div class="pattern-relateditems-result<% if (oneLevelUp) { %> one-level-up<% } %>">\n+<div class="pattern-relateditems-result <%- oneLevelUp ? \'one-level-up\' : \'\' %>">\n   <div class="pattern-relateditems-result-browse-wrapper">\n-    <a class="pattern-relateditems-result-select<% if (selectable) { %> selectable<% } %><% if (oneLevelUp) { %> one-level-up<% } %>" data-path="<%- path %>">\n+    <a\n+      class="pattern-relateditems-result-select <%- selectable ? \'selectable\' : \'\' %> <%- oneLevelUp ? \'one-level-up\' : \'\' %>"\n+      data-path="<%- path %>">\n       <div class="pattern-relateditems-result-info">\n-        <span class="pattern-relateditems-result-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+        <span\n+          class="pattern-relateditems-result-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n+          title="<%- portal_type %>">\n+          <%- Title %>\n+        </span>\n         <span class="pattern-relateditems-result-path"><%- path %></span>\n       </div>\n-    <% if (is_folderish) { %>\n-      <a class="pattern-relateditems-result-browse" data-path="<%- path %>" title="<%- open_folder %>"><span class="<% if (oneLevelUp) { %>icon-left-circle<% } else { %>icon-right-circle<% } %>"></span></a>\n-    <% } %>\n+      <% if (is_folderish) { %>\n+        <a\n+          class="pattern-relateditems-result-browse"\n+          data-path="<%- path %>"\n+          title="<%- open_folder %>">\n+          <span class="<%- oneLevelUp ? \'icon-left-circle\' : \'icon-right-circle\' %>"></span>\n+        </a>\n+      <% } %>\n     </a>\n   </div>\n   <% if (getURL && (getIcon || portal_type === "Image")) { %>\n-  <div class="pattern-relateditems-result-image">\n-    <img src="<%- getURL %>/@@images/image/thumb">\n-  </div>\n+    <div class="pattern-relateditems-result-image">\n+      <img src="<%- getURL %>/@@images/image/thumb" />\n+    </div>\n   <% } %>\n </div>\ndiff --git a/mockup/patterns/relateditems/templates/selection.xml b/mockup/patterns/relateditems/templates/selection.xml\nindex c23c9fe37..36c3fa35d 100644\n--- a/mockup/patterns/relateditems/templates/selection.xml\n+++ b/mockup/patterns/relateditems/templates/selection.xml\n@@ -1,11 +1,15 @@\n <div class="pattern-relateditems-item">\n   <div class="pattern-relateditems-result-info">\n-    <span class="pattern-relateditems-item-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n+    <span\n+      class="pattern-relateditems-item-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n+      title="<%- portal_type %>">\n+      <%- Title %>\n+    </span>\n     <span class="pattern-relateditems-item-path"><%- path %></span>\n   </div>\n   <% if (getURL && (getIcon || portal_type === "Image")) { %>\n-  <div class="pattern-relateditems-item-image">\n-    <img src="<%- getURL %>/@@images/image/thumb">\n-  </div>\n+    <div class="pattern-relateditems-item-image">\n+      <img src="<%- getURL %>/@@images/image/thumb" />\n+    </div>\n   <% } %>\n </div>\ndiff --git a/mockup/patterns/select2/pattern.js b/mockup/patterns/select2/pattern.js\nindex 986de4a83..90791699b 100644\n--- a/mockup/patterns/select2/pattern.js\n+++ b/mockup/patterns/select2/pattern.js\n@@ -213,10 +213,9 @@ define([\n       }\n     },\n     opened: function () {\n-      var self = this,\n-        state;\n-      state = self.$el.parent().find(\'.select2-dropdown-open\').length === 1;\n-      return state;\n+      var self = this;\n+      var isOpen = $(\'.select2-dropdown-open\', self.$el.parent()).length === 1;\n+      return isOpen;\n     },\n     init: function() {\n       var self = this;\ndiff --git a/yarn.lock b/yarn.lock\nindex a8c4a5bee..75cd353c7 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -2764,9 +2764,9 @@ jqtree@>=0.16:\n   version "1.4.1"\n   resolved "https://github.com/carhartl/jquery-cookie.git#7f88a4e631aba8a8c688fd8999ce6b9bcfd50718"\n \n-"jquery.recurrenceinput.js@https://github.com/collective/jquery.recurrenceinput.js.git#thet-npm":\n+"jquery.recurrenceinput.js@https://github.com/collective/jquery.recurrenceinput.js.git#master":\n   version "1.6.0"\n-  resolved "https://github.com/collective/jquery.recurrenceinput.js.git#84af75b92770dff10767cb2ade40c134ca1e8047"\n+  resolved "https://github.com/collective/jquery.recurrenceinput.js.git#deaec1116575d81698778f87d8c08f02487aadf9"\n   dependencies:\n     jquery ""\n \n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-14T20:03:06+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/mockup/commit/4e2fc8ebb74575f2456526354b12c00a77cc3459

Finalize improvemants

Files changed:
A news/889.bugfix
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/pattern.relateditems.less
M mockup/patterns/relateditems/templates/result.xml

b'diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js\nindex 8f1895f57..adf1a0abc 100644\n--- a/mockup/patterns/relateditems/pattern.js\n+++ b/mockup/patterns/relateditems/pattern.js\n@@ -217,7 +217,9 @@ define([\n       // let\'s give all the options possible to the template generation\n       var options = $.extend(true, {}, self.options, item, {\n         \'browsing\': self.browsing,\n-        \'open_folder\': _t(\'Open folder\')\n+        \'open_folder\': _t(\'Open folder\'),\n+        \'urrent_directory\': _t(\'current directory:\'),\n+        \'one_level_up\': _t(\'Go one level up\')\n       });\n       options._item = item;\n       return _.template(template)(options);\n@@ -316,6 +318,7 @@ define([\n               \'oneLevelUp\': true,\n               \'Title\': _t(\'One level up\'),\n               \'path\': path.slice(0, path.length - 1).join(\'/\') || \'/\',\n+              \'currentPath\': this.currentPath,\n               \'is_folderish\': true,\n               \'selectable\': false\n             }].concat(results);\n@@ -378,6 +381,12 @@ define([\n \n       $(\'.dropdown-toggle\', self.$toolbar).dropdown();\n \n+      // unbind mouseup event from select2 to override the behavior:\n+      $(".pattern-relateditems-dropdown").unbind("mouseup");\n+      $(".pattern-relateditems-dropdown").bind("mouseup", function(e) {\n+          e.stopPropagation();\n+      });\n+\n       $(\'button.mode.search\', self.$toolbar).on(\'click\', function(e) {\n         e.preventDefault();\n         if (self.browsing) {\n@@ -603,6 +612,8 @@ define([\n \n       Select2.prototype.initializeOrdering.call(self);\n \n+\n+\n       self.options.formatResult = function(item) {\n         item.selectable = self.isSelectable(item);\n \n@@ -627,6 +638,7 @@ define([\n \n         $(\'.pattern-relateditems-result-select\', result).on(\'click\', function(event) {\n           event.preventDefault();\n+          // event.stopPropagation();\n           if ($(this).is(\'.selectable\')) {\n             var $parent = $(this).parents(\'.pattern-relateditems-result\');\n             if ($parent.is(\'.pattern-relateditems-active\')) {\n@@ -717,6 +729,11 @@ define([\n \n       self.$toolbar = $(\'<div class="toolbar ui-offset-parent" />\');\n       self.$container.prepend(self.$toolbar);\n+      self.$el.on(\'select2-selecting\', function(event) {\n+        if (!self.isSelectable(event.choice)) {\n+          event.preventDefault();\n+        }\n+      });\n       self.renderToolbar();\n \n       $(document).on(\'keyup\', self.$el, function(event) {\ndiff --git a/mockup/patterns/relateditems/pattern.relateditems.less b/mockup/patterns/relateditems/pattern.relateditems.less\nindex 5cf7c3360..b2fd9250e 100644\n--- a/mockup/patterns/relateditems/pattern.relateditems.less\n+++ b/mockup/patterns/relateditems/pattern.relateditems.less\n@@ -151,9 +151,8 @@\n     }\n \n     .select2-result.select2-highlighted {\n-        //color: auto;\n-        //background: auto;\n-        border-left: 0.5em solid #007bb3 !important;\n+        border-left: 0.3em solid #007bb3 !important;\n+        border-right: 0.3em solid #007bb3 !important;\n     }\n \n     .select2-selected {\n@@ -232,7 +231,7 @@\n         }\n \n         .pattern-relateditems-result-browse {\n-            font-size:170%;\n+            font-size: 2.1rem;\n             margin:0 0.1em 0 0;\n             padding:0 0.15em 0 0.1em;\n             line-height:1.8em;\n@@ -244,19 +243,27 @@\n             }\n         }\n     }\n+    &.one-level-up{\n+        background-color: #ddd;\n+        .pattern-relateditems-result-browse-wrapper {\n+            flex-direction: row-reverse;\n+        }\n+    }\n }\n \n+.pattern-relateditems-item-title,\n .pattern-relateditems-result-title {\n-    font-size: 124%;\n+    font-size: 1.6rem;\n     line-height: 1.2;\n     padding: 0;\n     &[class*="contenttype-"]::before {\n-        font-size:92%;\n-        width:15px;\n+        font-size:1.46rem;\n+        width:14px;\n         height:25px;\n         vertical-align:middle;\n     }\n }\n+\n .pattern-relateditems-result-path {\n     margin-top: -5px;\n }\n@@ -272,6 +279,15 @@\n         }\n     }\n }\n+// modal is not inside content-core\n+.pattern-relateditems-result-image,\n+.pattern-relateditems-recentlyused-image,\n+.pattern-relateditems-item-image {\n+    img {\n+        max-width: 128px;\n+        max-height: 128px;\n+    }\n+}\n \n .pattern-relateditems {\n     &-recentlyused-path,\ndiff --git a/mockup/patterns/relateditems/templates/result.xml b/mockup/patterns/relateditems/templates/result.xml\nindex 5921b6811..45c7398e9 100644\n--- a/mockup/patterns/relateditems/templates/result.xml\n+++ b/mockup/patterns/relateditems/templates/result.xml\n@@ -1,29 +1,41 @@\n <div class="pattern-relateditems-result <%- oneLevelUp ? \'one-level-up\' : \'\' %>">\n   <div class="pattern-relateditems-result-browse-wrapper">\n+  <% if (!oneLevelUp) { %>\n     <a\n-      class="pattern-relateditems-result-select <%- selectable ? \'selectable\' : \'\' %> <%- oneLevelUp ? \'one-level-up\' : \'\' %>"\n+      class="pattern-relateditems-result-select<%- selectable ? \' selectable\' : \'\' %><%- oneLevelUp ? \' one-level-up\' : \'\' %>"\n       data-path="<%- path %>">\n+  <% } %>\n       <div class="pattern-relateditems-result-info">\n         <span\n           class="pattern-relateditems-result-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n           title="<%- portal_type %>">\n           <%- Title %>\n         </span>\n-        <span class="pattern-relateditems-result-path"><%- path %></span>\n+        <span class="pattern-relateditems-result-path"><%- oneLevelUp ? currentPath : path %></span>\n       </div>\n       <% if (is_folderish) { %>\n         <a\n           class="pattern-relateditems-result-browse"\n           data-path="<%- path %>"\n-          title="<%- open_folder %>">\n+          title="<%- oneLevelUp ? one_level_up : open_folder %>">\n           <span class="<%- oneLevelUp ? \'icon-left-circle\' : \'icon-right-circle\' %>"></span>\n         </a>\n       <% } %>\n+  <% if (!oneLevelUp) { %>\n     </a>\n+  <% } %>\n   </div>\n   <% if (getURL && (getIcon || portal_type === "Image")) { %>\n+    <% if (!oneLevelUp) { %>\n+    <a\n+      class="pattern-relateditems-result-select<%- selectable ? \' selectable\' : \'\' %><%- oneLevelUp ? \' one-level-up\' : \'\' %>"\n+      data-path="<%- path %>">\n+    <% } %>\n     <div class="pattern-relateditems-result-image">\n       <img src="<%- getURL %>/@@images/image/thumb" />\n     </div>\n+    <% if (!oneLevelUp) { %>\n+    </a>\n+    <% } %>\n   <% } %>\n </div>\ndiff --git a/news/889.bugfix b/news/889.bugfix\nnew file mode 100644\nindex 000000000..77795dac3\n--- /dev/null\n+++ b/news/889.bugfix\n@@ -0,0 +1,2 @@\n+- Improve relateditems pattern UX\n+  [MrTango]\n\\ No newline at end of file\n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-16T10:16:54+01:00
Author: Davi Lima (davilima6) <davilima6@gmail.com>
Commit: https://github.com/plone/mockup/commit/f3a92411e4faf4a25f6898d204cab49a4f4bd5ae

Do not use  as IE11 does not support it without a shim

Files changed:
M mockup/patterns/relateditems/pattern.js

b"diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js\nindex adf1a0abc..c53675ca2 100644\n--- a/mockup/patterns/relateditems/pattern.js\n+++ b/mockup/patterns/relateditems/pattern.js\n@@ -299,7 +299,7 @@ define([\n             function (item) {\n               if (\n                 (this.browsing && item.is_folderish) ||\n-                (this.isSelectable(item) && !this.selectedUIDs.includes(item.UID))\n+                (this.isSelectable(item) && this.selectedUIDs.indexOf(item.UID) === -1)\n               ) {\n                 return true;\n               }\n@@ -558,7 +558,7 @@ define([\n       if (self.options.selectableTypes === null) {\n         return true;\n       } else {\n-        return self.options.selectableTypes.includes(item.portal_type);\n+        return self.options.selectableTypes.indexOf(item.portal_type) !== -1;\n       }\n     },\n \n@@ -629,7 +629,7 @@ define([\n             'selectable': false,\n         }, item);\n \n-        if (self.selectedUIDs.includes(item.UID)) {\n+        if (self.selectedUIDs.indexOf(item.UID) !== -1) {\n             // do not allow already selected items to be selected again.\n             item.selectable = false;\n         }\n"

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-18T15:32:37+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/mockup/commit/175c69337686f0ca46c973e8e8946754c011d3ba

fix pattern-relateditems test

Files changed:
M mockup/tests/pattern-relateditems-test.js

b'diff --git a/mockup/tests/pattern-relateditems-test.js b/mockup/tests/pattern-relateditems-test.js\nindex 1563b029c..c9165c52e 100644\n--- a/mockup/tests/pattern-relateditems-test.js\n+++ b/mockup/tests/pattern-relateditems-test.js\n@@ -187,7 +187,6 @@ define([\n       expect($(\'.pattern-relateditems-container .toolbar .path-wrapper\'), $container).to.have.length(1);\n     });\n \n-\n     it(\'auto roundtrip\', function () {\n       initializePattern({\'selectableTypes\': [\'Image\', \'Folder\'], \'pageSize\': 100});\n       var clock = sinon.useFakeTimers();\n@@ -198,7 +197,7 @@ define([\n       clock.tick(1000);\n \n       // Only Images and Folders should be shown.\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(5);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(5);\n \n       // Select first folder\n       $(\'a.pattern-relateditems-result-select[data-path="/folder1"]\').click();\n@@ -207,15 +206,15 @@ define([\n       // Still, this folder should be shown in the result list - only not selectable.\n       $(\'.select2-search-field input.select2-input\').click();\n       clock.tick(1000);\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(5);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(5);\n \n       // Browse into second folder which contains images\n       $(\'.pattern-relateditems-result-browse[data-path="/folder2"]\').click();\n       clock.tick(1000);\n \n       // 1 "One level up" and 2 images\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(3);\n-      expect($(\'.pattern-relateditems-result-select\')[0].text).to.contain(\'One level up\');\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(2);\n+      expect($(\'.pattern-relateditems-result\')[0].textContent).to.contain(\'One level up\');\n \n       // Select first image\n       $(\'a.pattern-relateditems-result-select[data-path="/folder2/image17"]\').click();\n@@ -224,11 +223,11 @@ define([\n       // Browse one level up\n       $(\'.select2-search-field input.select2-input\').click();\n       clock.tick(1000);\n-      $(\'a.pattern-relateditems-result-select\')[0].click();\n+      $(\'.pattern-relateditems-result.one-level-up a.pattern-relateditems-result-browse\')[0].click();\n       clock.tick(1000);\n \n       // Again, 5 items on root.\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(5);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(5);\n \n       // Input a search term and enter search mode\n       $input = $(\'.select2-search-field input.select2-input\');\n@@ -238,15 +237,15 @@ define([\n       clock.tick(1000);\n \n       // Searching for folder 2 brings up 2 items: folder2 itself and the not-yet-selected image.\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(2);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(2);\n \n       // We can even browse into folders in search mode\n       $(\'.pattern-relateditems-result-browse[data-path="/folder2"]\').click();\n       clock.tick(1000);\n \n-      // Being in folder 2, we see again two items...\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(2);\n-      expect($(\'.pattern-relateditems-result-select\')[0].text).to.contain(\'One level up\');\n+      // Being in folder 2, we see again one item...\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(1);\n+      expect($(\'.pattern-relateditems-result\')[0].textContent).to.contain(\'One level up\');\n \n       // Selecting the image will add it to the selected items.\n       $(\'a.pattern-relateditems-result-select[data-path="/folder2/image18"]\').click();\n@@ -267,7 +266,7 @@ define([\n \n       // result list must have expected length\n       // Only Images and Folders.\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(5);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(5);\n \n \n       // PT 2\n@@ -284,7 +283,7 @@ define([\n       clock.tick(1000);\n \n       // result list must have expected length\n-      expect($(\'.pattern-relateditems-result-select.selectable\')).to.have.length(2);\n+      expect($(\'.pattern-relateditems-result-select.selectable .pattern-relateditems-result-info\')).to.have.length(2);\n \n       // add another one\n       $(\'a.pattern-relateditems-result-select[data-path="/image2"]\').click();\n@@ -300,7 +299,7 @@ define([\n       var keyup = $.Event(\'keyup-change\');\n       $input.trigger(keyup);\n       clock.tick(1000);\n-      expect($(\'.pattern-relateditems-result-select.selectable\')).to.have.length(2);\n+      expect($(\'.pattern-relateditems-result-select.selectable .pattern-relateditems-result-info\')).to.have.length(2);\n \n       // add first from result\n       $(\'a.pattern-relateditems-result-select[data-path="/image3"]\').click();\n@@ -319,7 +318,7 @@ define([\n       clock.tick(1000);\n \n       // result list must have expected length\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(11);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(11);\n \n \n       //  // PT 2\n@@ -336,7 +335,7 @@ define([\n       clock.tick(1000);\n \n       //  // result list must have expected length\n-      expect($(\'.pattern-relateditems-result-select.selectable\')).to.have.length(10);\n+      expect($(\'.pattern-relateditems-result-select.selectable .pattern-relateditems-result-info\')).to.have.length(10);\n \n       //  // add another one\n       $(\'a.pattern-relateditems-result-select[data-path="/document2"]\').click();\n@@ -352,7 +351,7 @@ define([\n       var keyup = $.Event(\'keyup-change\');\n       $input.trigger(keyup);\n       clock.tick(1000);\n-      expect($(\'.pattern-relateditems-result-select.selectable\')).to.have.length(1);\n+      expect($(\'.pattern-relateditems-result-select.selectable .pattern-relateditems-result-info\')).to.have.length(1);\n \n       //  // add first from result\n       $(\'a.pattern-relateditems-result-select[data-path="/folder2/document15"]\').click();\n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-02-18T19:59:38+01:00
Author: Maik Derstappen (MrTango) <md@derico.de>
Commit: https://github.com/plone/mockup/commit/40a192a0902cf69a0719c315f53fc6360d3ffb1d

Merge pull request #889 from plone/mrtango-improve-relateditems-ux

Improve Related Items UX

Files changed:
A news/889.bugfix
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/pattern.relateditems.less
M mockup/patterns/relateditems/templates/recentlyused.xml
M mockup/patterns/relateditems/templates/result.xml
M mockup/patterns/relateditems/templates/selection.xml
M mockup/patterns/select2/pattern.js
M mockup/patterns/tinymce/less/pattern.tinymce.less
M mockup/tests/pattern-relateditems-test.js

b'diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js\nindex ddbedc8a0..c53675ca2 100644\n--- a/mockup/patterns/relateditems/pattern.js\n+++ b/mockup/patterns/relateditems/pattern.js\n@@ -10,10 +10,10 @@\n  *    favorites(array): Array of objects. These are favorites, which can be used to quickly jump to different locations. Objects have the attributes "title" and "path". Default: []\n  *    maximumSelectionSize(integer): The maximum number of items that can be selected in a multi-select control. If this number is less than 1 selection is not limited. (-1)\n  *    minimumInputLength: Select2 option. Number of characters necessary to start a search. Default: 0.\n- *    mode(string): Initial widget mode. Possible values: \'search\', \'browse\'. If set to \'search\', the catalog is searched for a searchterm. If set to \'browse\', browsing starts at basePath. Default: \'search\'.\n+ *    mode(string): Initial widget mode. Possible values: are \'auto\', \'search\' and \'browse\'. If set to \'search\', the catalog is searched for a searchterm. If set to \'browse\', browsing starts at basePath. Default: \'auto\', which means the combination of both.\n  *    orderable(boolean): Whether or not items should be drag-and-drop sortable. (true)\n  *    pageSize(int): Batch size to break down big result sets into multiple pages. (10).\n- *    recentlyUsed(boolen): Show the recently used items dropdown (false).\n+ *    recentlyUsed(boolean): Show the recently used items dropdown (false).\n  *    recentlyUsedMaxItems(integer): Maximum items to keep in recently used list. 0: no restriction. (20).\n  *    rootPath(string): Only display breadcrumb path elements deeper than this path. Default: "/"\n  *    rootUrl(string): Visible URL up to the rootPath. This is prepended to the currentPath to generate submission URLs.\n@@ -119,6 +119,11 @@ define([\n ) {\n   \'use strict\';\n \n+  var KEY = {\n+    LEFT: 37,\n+    RIGHT: 39\n+  };\n+\n   var RelatedItems = Base.extend({\n     name: \'relateditems\',\n     trigger: \'.pat-relateditems\',\n@@ -212,7 +217,9 @@ define([\n       // let\'s give all the options possible to the template generation\n       var options = $.extend(true, {}, self.options, item, {\n         \'browsing\': self.browsing,\n-        \'open_folder\': _t(\'Open folder\')\n+        \'open_folder\': _t(\'Open folder\'),\n+        \'urrent_directory\': _t(\'current directory:\'),\n+        \'one_level_up\': _t(\'Go one level up\')\n       });\n       options._item = item;\n       return _.template(template)(options);\n@@ -286,12 +293,13 @@ define([\n \n           // Filter out items:\n           // While browsing: always include folderish items\n-          // Browsing and searching: Only include selectable items, which are not already selected.\n+          // Browsing and searching: Only include selectable items which are not already selected, and all folders\n+          // even if they\'re selected, as we need them available for browsing/selecting their children\n           results = results.filter(\n             function (item) {\n               if (\n                 (this.browsing && item.is_folderish) ||\n-                (this.isSelectable(item) && this.selectedUIDs.indexOf(item.UID) == -1)\n+                (this.isSelectable(item) && this.selectedUIDs.indexOf(item.UID) === -1)\n               ) {\n                 return true;\n               }\n@@ -310,6 +318,7 @@ define([\n               \'oneLevelUp\': true,\n               \'Title\': _t(\'One level up\'),\n               \'path\': path.slice(0, path.length - 1).join(\'/\') || \'/\',\n+              \'currentPath\': this.currentPath,\n               \'is_folderish\': true,\n               \'selectable\': false\n             }].concat(results);\n@@ -372,6 +381,12 @@ define([\n \n       $(\'.dropdown-toggle\', self.$toolbar).dropdown();\n \n+      // unbind mouseup event from select2 to override the behavior:\n+      $(".pattern-relateditems-dropdown").unbind("mouseup");\n+      $(".pattern-relateditems-dropdown").bind("mouseup", function(e) {\n+          e.stopPropagation();\n+      });\n+\n       $(\'button.mode.search\', self.$toolbar).on(\'click\', function(e) {\n         e.preventDefault();\n         if (self.browsing) {\n@@ -543,7 +558,7 @@ define([\n       if (self.options.selectableTypes === null) {\n         return true;\n       } else {\n-        return _.indexOf(self.options.selectableTypes, item.portal_type) > -1;\n+        return self.options.selectableTypes.indexOf(item.portal_type) !== -1;\n       }\n     },\n \n@@ -597,6 +612,8 @@ define([\n \n       Select2.prototype.initializeOrdering.call(self);\n \n+\n+\n       self.options.formatResult = function(item) {\n         item.selectable = self.isSelectable(item);\n \n@@ -612,7 +629,7 @@ define([\n             \'selectable\': false,\n         }, item);\n \n-        if (self.selectedUIDs.indexOf(item.UID) != -1) {\n+        if (self.selectedUIDs.indexOf(item.UID) !== -1) {\n             // do not allow already selected items to be selected again.\n             item.selectable = false;\n         }\n@@ -621,6 +638,7 @@ define([\n \n         $(\'.pattern-relateditems-result-select\', result).on(\'click\', function(event) {\n           event.preventDefault();\n+          // event.stopPropagation();\n           if ($(this).is(\'.selectable\')) {\n             var $parent = $(this).parents(\'.pattern-relateditems-result\');\n             if ($parent.is(\'.pattern-relateditems-active\')) {\n@@ -683,7 +701,6 @@ define([\n                 // Select2 3.5.4 throws an error in some cases in\n                 // updateSelection, ``this.selection.find(".select2-search-choice").remove();``\n                 // No idea why, hard to track.\n-                console.log(data);\n               }\n \n               if (self.openAfterInit) {\n@@ -696,16 +713,11 @@ define([\n             false\n           );\n         }\n-\n       };\n \n       self.options.tokenizer = function (input) {\n         if (this.options.mode === \'auto\') {\n-          if (input) {\n-            this.browsing = false;\n-          } else {\n-            this.browsing = true;\n-          }\n+          this.browsing = input ? false : true;\n         }\n       }.bind(this);\n \n@@ -717,13 +729,40 @@ define([\n \n       self.$toolbar = $(\'<div class="toolbar ui-offset-parent" />\');\n       self.$container.prepend(self.$toolbar);\n-\n       self.$el.on(\'select2-selecting\', function(event) {\n-        event.preventDefault();\n+        if (!self.isSelectable(event.choice)) {\n+          event.preventDefault();\n+        }\n       });\n-\n       self.renderToolbar();\n \n+      $(document).on(\'keyup\', self.$el, function(event) {\n+        var isOpen = Select2.prototype.opened.call(self);\n+\n+        if (!isOpen) {\n+          return;\n+        }\n+\n+        if ((event.which === KEY.LEFT) || (event.which === KEY.RIGHT)) {\n+          event.stopPropagation();\n+\n+          var selectorContext =\n+            event.which === KEY.LEFT\n+              ? \'.pattern-relateditems-result.one-level-up\'\n+              : \'.select2-highlighted\';\n+\n+          var browsableItemSelector = \'.pattern-relateditems-result-browse\';\n+          var browsableItem = $(browsableItemSelector, selectorContext);\n+\n+          if (browsableItem.length !== 1) {\n+            return;\n+          }\n+\n+          var path = browsableItem.data(\'path\');\n+\n+          self.browseTo(path);\n+        }\n+      });\n     }\n   });\n \ndiff --git a/mockup/patterns/relateditems/pattern.relateditems.less b/mockup/patterns/relateditems/pattern.relateditems.less\nindex 2dad96dd3..b2fd9250e 100644\n--- a/mockup/patterns/relateditems/pattern.relateditems.less\n+++ b/mockup/patterns/relateditems/pattern.relateditems.less\n@@ -104,20 +104,59 @@\n                 margin-bottom: 0;\n             }\n         }\n+        .pattern-relateditems-recentlyused-select {\n+            display: flex;\n+            justify-content: space-between;\n+            padding: 3px;\n+            .pattern-relateditems-recentlyused-info{\n+                flex-grow: 2;\n+                hyphens: auto;\n+                white-space: normal;\n+            }\n+            .pattern-relateditems-recentlyused-image {\n+                flex: 0 0 auto;\n+            }\n+        }\n+    }\n+    .toolbar .dropdown-menu {\n+        min-width: 310px;\n     }\n \n+    .pattern-relateditems-result-info {\n+        flex-grow: 2;\n+        margin: 0.4em 0.4em 0.4em 1.5em;\n+        hyphens: auto;\n+    }\n+\n+    .pattern-relateditems-item {\n+        display: flex;\n+    }\n }\n \n-.pattern-relateditems-dropdown {\n-    .select2-results {\n-        .select2-highlighted {\n-            color: #000;\n-            background: #d8d8d8;\n-        }\n \n-        .select2-selected {\n-            display: list-item;\n-        }\n+.pattern-relateditems-dropdown .select2-results {\n+    max-height: 350px;\n+    background-color: #fff;\n+\n+    .select2-result {\n+        background-color: transparent;\n+    }\n+\n+    .select2-result:nth-child(odd) {\n+        background-color: #f7f7f7;\n+    }\n+\n+    .select2-result-label {\n+        padding: 0;\n+    }\n+\n+    .select2-result.select2-highlighted {\n+        border-left: 0.3em solid #007bb3 !important;\n+        border-right: 0.3em solid #007bb3 !important;\n+    }\n+\n+    .select2-selected {\n+        display: list-item;\n     }\n }\n \n@@ -130,47 +169,133 @@\n     margin-top: 2px;\n }\n \n+.pat-relateditems .select2-choices {\n+    display: flex;\n+    justify-content: flex-start;\n+    flex-flow: row wrap;\n+    align-items: stretch;\n+    padding: 0.2em;\n+    > li {\n+        flex: 1 1 100%;\n+    }\n+}\n \n+.select2-choices .select2-search-choice.select2-search-choice-focus {\n+    border-left: 0.5em solid #286090 !important;\n+}\n \n-.pattern-relateditems-result {\n-    padding: 0.2em;\n+.select2-container-multi .select2-choices .select2-search-choice {\n+    background-image: none;\n+    background-color: #eee;\n+    padding: 0;\n+    margin: 0.2em;\n+    // make choices list compact:\n+    //flex: 1 1 auto;\n+\n+    .select2-search-choice-close {\n+        text-decoration: none;\n+        border-bottom: 0 solid transparent !important;\n+        top: 0.4rem;\n+        left: 0.4rem;\n+        right: auto;\n+    }\n \n+    .pattern-relateditems-item-image {\n+        flex: 0 0 auto;\n+    }\n+}\n+\n+.pattern-relateditems-result {\n+    display: flex;\n+    justify-content: space-between;\n+    margin-bottom: 0.15em;\n     a {\n         &:hover {\n             text-decoration: none;\n         }\n     }\n \n-    .pattern-relateditems-buttons {\n-        display: inline-block;\n-        width: 1.5em;\n-        font-size: 1.5em;\n-        vertical-align: top;\n-        a {\n-            .glyphicon;\n-            .glyphicon-folder-close;\n+    .pattern-relateditems-result-info {\n+        padding: 0.4em;\n+    }\n+\n+    .pattern-relateditems-result-browse-wrapper {\n+        flex: 2 1 fill;\n+        display: flex;\n+        justify-content: flex-start;\n+\n+        .pattern-relateditems-result-select {\n+            &:not(.selectable):not(.one-level-up) {\n+                opacity: 0.6;\n+            }\n+        }\n+\n+        .pattern-relateditems-result-browse {\n+            font-size: 2.1rem;\n+            margin:0 0.1em 0 0;\n+            padding:0 0.15em 0 0.1em;\n+            line-height:1.8em;\n             &:hover {\n-                .glyphicon-folder-open;\n+                background-color: lighten(#d8d8d8, 5%) ;\n             }\n-            &:hover:before {\n-                color:purple;\n+            span {\n+                vertical-align: middle;\n             }\n         }\n     }\n-\n-    .pattern-relateditems-result-select {\n-        display: inline-block;\n-        &:not(.selectable):not(.one-level-up) {\n-            opacity: 0.6;\n+    &.one-level-up{\n+        background-color: #ddd;\n+        .pattern-relateditems-result-browse-wrapper {\n+            flex-direction: row-reverse;\n         }\n     }\n+}\n \n+.pattern-relateditems-item-title,\n+.pattern-relateditems-result-title {\n+    font-size: 1.6rem;\n+    line-height: 1.2;\n+    padding: 0;\n+    &[class*="contenttype-"]::before {\n+        font-size:1.46rem;\n+        width:14px;\n+        height:25px;\n+        vertical-align:middle;\n+    }\n }\n \n-.pattern-relateditems-recentlyused-path,\n-.pattern-relateditems-item-path,\n .pattern-relateditems-result-path {\n-    font-size: 0.8em;\n-    display: block;\n-    color: #444;\n+    margin-top: -5px;\n+}\n+\n+// keep images at 128x128 even if the thumb size is set heigher\n+#content-core {\n+    .pattern-relateditems-result-image,\n+    .pattern-relateditems-recentlyused-image,\n+    .pattern-relateditems-item-image {\n+        img {\n+            max-width: 128px;\n+            max-height: 128px;\n+        }\n+    }\n+}\n+// modal is not inside content-core\n+.pattern-relateditems-result-image,\n+.pattern-relateditems-recentlyused-image,\n+.pattern-relateditems-item-image {\n+    img {\n+        max-width: 128px;\n+        max-height: 128px;\n+    }\n+}\n+\n+.pattern-relateditems {\n+    &-recentlyused-path,\n+    &-item-path,\n+    &-result-path {\n+        font-size: 0.8em;\n+        display: block;\n+        color: #444;\n+        padding-left: 0.2em;\n+    }\n }\ndiff --git a/mockup/patterns/relateditems/templates/recentlyused.xml b/mockup/patterns/relateditems/templates/recentlyused.xml\nindex b463351e1..410569890 100644\n--- a/mockup/patterns/relateditems/templates/recentlyused.xml\n+++ b/mockup/patterns/relateditems/templates/recentlyused.xml\n@@ -1,7 +1,17 @@\n-<div class="pattern-relateditems-recentlyused">\n+<li class="pattern-relateditems-recentlyused">\n   <a class="pattern-relateditems-recentlyused-select" data-uid="<%- UID %>">\n-    <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon "><br><% } %>\n-    <span class="pattern-relateditems-recentlyused-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n-    <span class="pattern-relateditems-recentlyused-path"><%- path %></span>\n+    <div class="pattern-relateditems-recentlyused-info">\n+      <span\n+        class="pattern-relateditems-recentlyused-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n+        title="<%- portal_type %>">\n+        <%- Title %>\n+      </span>\n+      <span class="pattern-relateditems-recentlyused-path"><%- path %></span>\n+    </div>\n+    <% if (getURL && (getIcon || portal_type === "Image")) { %>\n+      <div class="pattern-relateditems-recentlyused-image">\n+        <img src="<%- getURL %>/@@images/image/tile" />\n+      </div>\n+    <% } %>\n   </a>\n-</div>\n+</li>\ndiff --git a/mockup/patterns/relateditems/templates/result.xml b/mockup/patterns/relateditems/templates/result.xml\nindex c9d896687..45c7398e9 100644\n--- a/mockup/patterns/relateditems/templates/result.xml\n+++ b/mockup/patterns/relateditems/templates/result.xml\n@@ -1,12 +1,41 @@\n-<div class="pattern-relateditems-result<% if (oneLevelUp) { %> one-level-up<% } %>">\n-  <span class="pattern-relateditems-buttons">\n-  <% if (is_folderish) { %>\n-    <a class="pattern-relateditems-result-browse" data-path="<%- path %>" title="<%- open_folder %>"></a>\n+<div class="pattern-relateditems-result <%- oneLevelUp ? \'one-level-up\' : \'\' %>">\n+  <div class="pattern-relateditems-result-browse-wrapper">\n+  <% if (!oneLevelUp) { %>\n+    <a\n+      class="pattern-relateditems-result-select<%- selectable ? \' selectable\' : \'\' %><%- oneLevelUp ? \' one-level-up\' : \'\' %>"\n+      data-path="<%- path %>">\n+  <% } %>\n+      <div class="pattern-relateditems-result-info">\n+        <span\n+          class="pattern-relateditems-result-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n+          title="<%- portal_type %>">\n+          <%- Title %>\n+        </span>\n+        <span class="pattern-relateditems-result-path"><%- oneLevelUp ? currentPath : path %></span>\n+      </div>\n+      <% if (is_folderish) { %>\n+        <a\n+          class="pattern-relateditems-result-browse"\n+          data-path="<%- path %>"\n+          title="<%- oneLevelUp ? one_level_up : open_folder %>">\n+          <span class="<%- oneLevelUp ? \'icon-left-circle\' : \'icon-right-circle\' %>"></span>\n+        </a>\n+      <% } %>\n+  <% if (!oneLevelUp) { %>\n+    </a>\n+  <% } %>\n+  </div>\n+  <% if (getURL && (getIcon || portal_type === "Image")) { %>\n+    <% if (!oneLevelUp) { %>\n+    <a\n+      class="pattern-relateditems-result-select<%- selectable ? \' selectable\' : \'\' %><%- oneLevelUp ? \' one-level-up\' : \'\' %>"\n+      data-path="<%- path %>">\n+    <% } %>\n+    <div class="pattern-relateditems-result-image">\n+      <img src="<%- getURL %>/@@images/image/thumb" />\n+    </div>\n+    <% if (!oneLevelUp) { %>\n+    </a>\n+    <% } %>\n   <% } %>\n-  </span>\n-  <a class="pattern-relateditems-result-select<% if (selectable) { %> selectable<% } else if (browsing && is_folderish) { %> pattern-relateditems-result-browse<% } %><% if (oneLevelUp) { %> one-level-up<% } %>" data-path="<%- path %>">\n-    <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon "><br><% } %>\n-    <span class="pattern-relateditems-result-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n-    <span class="pattern-relateditems-result-path"><%- path %></span>\n-  </a>\n </div>\ndiff --git a/mockup/patterns/relateditems/templates/selection.xml b/mockup/patterns/relateditems/templates/selection.xml\nindex 93f409935..36c3fa35d 100644\n--- a/mockup/patterns/relateditems/templates/selection.xml\n+++ b/mockup/patterns/relateditems/templates/selection.xml\n@@ -1,5 +1,15 @@\n-<span class="pattern-relateditems-item">\n-  <% if (getURL && (getIcon || portal_type === "Image")) { %><img src="<%- getURL %>/@@images/image/icon"><br><% } %>\n-  <span class="pattern-relateditems-item-title<%- portal_type ? \' contenttype-\' + portal_type.toLowerCase() : \'\' %><%- review_state ? \' state-\' + review_state : \'\' %>" title="<%- portal_type %>"><%- Title %></span>\n-  <span class="pattern-relateditems-item-path"><%- path %></span>\n-</span>\n+<div class="pattern-relateditems-item">\n+  <div class="pattern-relateditems-result-info">\n+    <span\n+      class="pattern-relateditems-item-title <%- portal_type ? \'contenttype-\' + portal_type.toLowerCase() : \'\' %> <%- review_state ? \'state-\' + review_state : \'\' %>"\n+      title="<%- portal_type %>">\n+      <%- Title %>\n+    </span>\n+    <span class="pattern-relateditems-item-path"><%- path %></span>\n+  </div>\n+  <% if (getURL && (getIcon || portal_type === "Image")) { %>\n+    <div class="pattern-relateditems-item-image">\n+      <img src="<%- getURL %>/@@images/image/thumb" />\n+    </div>\n+  <% } %>\n+</div>\ndiff --git a/mockup/patterns/select2/pattern.js b/mockup/patterns/select2/pattern.js\nindex 173bb9d1d..90791699b 100644\n--- a/mockup/patterns/select2/pattern.js\n+++ b/mockup/patterns/select2/pattern.js\n@@ -212,6 +212,11 @@ define([\n         self.$select2.addClass(\'select2-orderable\');\n       }\n     },\n+    opened: function () {\n+      var self = this;\n+      var isOpen = $(\'.select2-dropdown-open\', self.$el.parent()).length === 1;\n+      return isOpen;\n+    },\n     init: function() {\n       var self = this;\n \ndiff --git a/mockup/patterns/tinymce/less/pattern.tinymce.less b/mockup/patterns/tinymce/less/pattern.tinymce.less\nindex 15633442a..7953fb29b 100644\n--- a/mockup/patterns/tinymce/less/pattern.tinymce.less\n+++ b/mockup/patterns/tinymce/less/pattern.tinymce.less\n@@ -110,11 +110,6 @@ div.linkModal {\n     }\n }\n \n-.pattern-relateditems-result-image img{\n-    max-height: 30px;\n-    max-width: 80px;\n-}\n-\n .mce-item-table td {\n \tmin-width: 0.6em;  // enforce a min-width while editing for tables with visual aid turned on\n }\ndiff --git a/mockup/tests/pattern-relateditems-test.js b/mockup/tests/pattern-relateditems-test.js\nindex 1563b029c..c9165c52e 100644\n--- a/mockup/tests/pattern-relateditems-test.js\n+++ b/mockup/tests/pattern-relateditems-test.js\n@@ -187,7 +187,6 @@ define([\n       expect($(\'.pattern-relateditems-container .toolbar .path-wrapper\'), $container).to.have.length(1);\n     });\n \n-\n     it(\'auto roundtrip\', function () {\n       initializePattern({\'selectableTypes\': [\'Image\', \'Folder\'], \'pageSize\': 100});\n       var clock = sinon.useFakeTimers();\n@@ -198,7 +197,7 @@ define([\n       clock.tick(1000);\n \n       // Only Images and Folders should be shown.\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(5);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(5);\n \n       // Select first folder\n       $(\'a.pattern-relateditems-result-select[data-path="/folder1"]\').click();\n@@ -207,15 +206,15 @@ define([\n       // Still, this folder should be shown in the result list - only not selectable.\n       $(\'.select2-search-field input.select2-input\').click();\n       clock.tick(1000);\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(5);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(5);\n \n       // Browse into second folder which contains images\n       $(\'.pattern-relateditems-result-browse[data-path="/folder2"]\').click();\n       clock.tick(1000);\n \n       // 1 "One level up" and 2 images\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(3);\n-      expect($(\'.pattern-relateditems-result-select\')[0].text).to.contain(\'One level up\');\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(2);\n+      expect($(\'.pattern-relateditems-result\')[0].textContent).to.contain(\'One level up\');\n \n       // Select first image\n       $(\'a.pattern-relateditems-result-select[data-path="/folder2/image17"]\').click();\n@@ -224,11 +223,11 @@ define([\n       // Browse one level up\n       $(\'.select2-search-field input.select2-input\').click();\n       clock.tick(1000);\n-      $(\'a.pattern-relateditems-result-select\')[0].click();\n+      $(\'.pattern-relateditems-result.one-level-up a.pattern-relateditems-result-browse\')[0].click();\n       clock.tick(1000);\n \n       // Again, 5 items on root.\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(5);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(5);\n \n       // Input a search term and enter search mode\n       $input = $(\'.select2-search-field input.select2-input\');\n@@ -238,15 +237,15 @@ define([\n       clock.tick(1000);\n \n       // Searching for folder 2 brings up 2 items: folder2 itself and the not-yet-selected image.\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(2);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(2);\n \n       // We can even browse into folders in search mode\n       $(\'.pattern-relateditems-result-browse[data-path="/folder2"]\').click();\n       clock.tick(1000);\n \n-      // Being in folder 2, we see again two items...\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(2);\n-      expect($(\'.pattern-relateditems-result-select\')[0].text).to.contain(\'One level up\');\n+      // Being in folder 2, we see again one item...\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(1);\n+      expect($(\'.pattern-relateditems-result\')[0].textContent).to.contain(\'One level up\');\n \n       // Selecting the image will add it to the selected items.\n       $(\'a.pattern-relateditems-result-select[data-path="/folder2/image18"]\').click();\n@@ -267,7 +266,7 @@ define([\n \n       // result list must have expected length\n       // Only Images and Folders.\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(5);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(5);\n \n \n       // PT 2\n@@ -284,7 +283,7 @@ define([\n       clock.tick(1000);\n \n       // result list must have expected length\n-      expect($(\'.pattern-relateditems-result-select.selectable\')).to.have.length(2);\n+      expect($(\'.pattern-relateditems-result-select.selectable .pattern-relateditems-result-info\')).to.have.length(2);\n \n       // add another one\n       $(\'a.pattern-relateditems-result-select[data-path="/image2"]\').click();\n@@ -300,7 +299,7 @@ define([\n       var keyup = $.Event(\'keyup-change\');\n       $input.trigger(keyup);\n       clock.tick(1000);\n-      expect($(\'.pattern-relateditems-result-select.selectable\')).to.have.length(2);\n+      expect($(\'.pattern-relateditems-result-select.selectable .pattern-relateditems-result-info\')).to.have.length(2);\n \n       // add first from result\n       $(\'a.pattern-relateditems-result-select[data-path="/image3"]\').click();\n@@ -319,7 +318,7 @@ define([\n       clock.tick(1000);\n \n       // result list must have expected length\n-      expect($(\'.pattern-relateditems-result-select\')).to.have.length(11);\n+      expect($(\'.pattern-relateditems-result-select .pattern-relateditems-result-info\')).to.have.length(11);\n \n \n       //  // PT 2\n@@ -336,7 +335,7 @@ define([\n       clock.tick(1000);\n \n       //  // result list must have expected length\n-      expect($(\'.pattern-relateditems-result-select.selectable\')).to.have.length(10);\n+      expect($(\'.pattern-relateditems-result-select.selectable .pattern-relateditems-result-info\')).to.have.length(10);\n \n       //  // add another one\n       $(\'a.pattern-relateditems-result-select[data-path="/document2"]\').click();\n@@ -352,7 +351,7 @@ define([\n       var keyup = $.Event(\'keyup-change\');\n       $input.trigger(keyup);\n       clock.tick(1000);\n-      expect($(\'.pattern-relateditems-result-select.selectable\')).to.have.length(1);\n+      expect($(\'.pattern-relateditems-result-select.selectable .pattern-relateditems-result-info\')).to.have.length(1);\n \n       //  // add first from result\n       $(\'a.pattern-relateditems-result-select[data-path="/folder2/document15"]\').click();\ndiff --git a/news/889.bugfix b/news/889.bugfix\nnew file mode 100644\nindex 000000000..77795dac3\n--- /dev/null\n+++ b/news/889.bugfix\n@@ -0,0 +1,2 @@\n+- Improve relateditems pattern UX\n+  [MrTango]\n\\ No newline at end of file\n'

