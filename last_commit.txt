Repository: plone.app.collection


Branch: refs/heads/master
Date: 2016-08-31T19:05:13+03:00
Author: ichim-david (ichim-david) <ichim.david@gmail.com>
Commit: https://github.com/plone/plone.app.collection/commit/96de56093eeed85df299e5d0ba1435327a52de77

summary_view.pt failed on obj/@@images when a Comment was found

Files changed:
M plone/app/collection/browser/templates/summary_view.pt

diff --git a/plone/app/collection/browser/templates/summary_view.pt b/plone/app/collection/browser/templates/summary_view.pt
index 05cf2e5..babba8c 100644
--- a/plone/app/collection/browser/templates/summary_view.pt
+++ b/plone/app/collection/browser/templates/summary_view.pt
@@ -18,12 +18,12 @@
         <div class="tileItem visualIEFloatFix"
              tal:define="obj item/getObject">
             <a href="#"
-                  tal:condition="obj/image|nothing"
+                  tal:define="scales obj/@@images|nothing"
+                  tal:condition="scales"
                   tal:attributes="href item/getURL">
                   <div class="tileImage">
                       <img src="" alt=""
-                           tal:define="scales obj/@@images;
-                                       scale python:scales.scale('image', 'thumb')"
+                           tal:define="scale python:scales.scale('image', 'thumb') if scales else None"
                            tal:replace="structure python:scale and scale.tag(css_class='tileImage') or None" />
                   </div>
             </a>


Repository: plone.app.collection


Branch: refs/heads/master
Date: 2016-08-31T19:05:56+03:00
Author: ichim-david (ichim-david) <ichim.david@gmail.com>
Commit: https://github.com/plone/plone.app.collection/commit/af764e24526678c31f45d46b25c4318f1c2bcedc

Added Changes.rst entry for summary.pt Discussion Item fix

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 8b0554f..a9057de 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Fix summary view for results with Discussion Items
+  [ichim-david]
+
 - Check with getattr if item isPrincipiaFolderish as Comment does
   not have this attribute which would render an AttributeError
   [ichim-david]


Repository: plone.app.collection


Branch: refs/heads/master
Date: 2016-08-31T22:02:36+03:00
Author: ichim-david (ichim-david) <ichim.david@gmail.com>
Commit: https://github.com/plone/plone.app.collection/commit/44a41f9f60dbeca38e570fbe92ef1bc599e50967

Merge pull request #41 from ichim-david/master

Port summary_view fix to master branch

Files changed:
M CHANGES.rst
M plone/app/collection/browser/templates/summary_view.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 8b0554f..a9057de 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Fix summary view for results with Discussion Items
+  [ichim-david]
+
 - Check with getattr if item isPrincipiaFolderish as Comment does
   not have this attribute which would render an AttributeError
   [ichim-david]
diff --git a/plone/app/collection/browser/templates/summary_view.pt b/plone/app/collection/browser/templates/summary_view.pt
index 05cf2e5..babba8c 100644
--- a/plone/app/collection/browser/templates/summary_view.pt
+++ b/plone/app/collection/browser/templates/summary_view.pt
@@ -18,12 +18,12 @@
         <div class="tileItem visualIEFloatFix"
              tal:define="obj item/getObject">
             <a href="#"
-                  tal:condition="obj/image|nothing"
+                  tal:define="scales obj/@@images|nothing"
+                  tal:condition="scales"
                   tal:attributes="href item/getURL">
                   <div class="tileImage">
                       <img src="" alt=""
-                           tal:define="scales obj/@@images;
-                                       scale python:scales.scale('image', 'thumb')"
+                           tal:define="scale python:scales.scale('image', 'thumb') if scales else None"
                            tal:replace="structure python:scale and scale.tag(css_class='tileImage') or None" />
                   </div>
             </a>


