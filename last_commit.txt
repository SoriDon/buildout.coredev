Repository: plone.restapi


Branch: refs/heads/master
Date: 2018-11-18T10:29:25-05:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.restapi/commit/b710cc26411520ad1d1f1c9148516b9649534370

Fix some differences with http test output in Python 3:

* Keep space after JSON items
* Use port 55001 on travis
* Be sure to flush file before writing request body

Files changed:
M .travis.yml
M src/plone/restapi/services/__init__.py
M src/plone/restapi/tests/test_documentation.py

b'diff --git a/.travis.yml b/.travis.yml\nindex 7e180279..ef01483a 100644\n--- a/.travis.yml\n+++ b/.travis.yml\n@@ -14,6 +14,7 @@ env:\n   global:\n     - secure: "tj9kO7Uyn7AY2Z6zhdOggLSYheaD8e+qKA7ZXvdWTrL2HtPAtnNJK8keQGj1JLQyy6bRfoOCt51aL8+Lc0fzcACaLFpAPjleSLtUChphPOh/dqTu1QX5oL0SxZ94B4ZC5+qfaSAQHMwbiiWUW0us9QtJpxQQmiJUekqiTdQDNEo="\n     - secure: "j06un+j2gHjlGfg+xMcvKG2osf1HSzBq/cPPNIonnjGQY3GJfT/YRzYnHe5LJPPt7IJDD7hAEPentRJ4C0zP66U6gcQ2HjWPsMIcvzlgnXoT2QaaCVkMA9YS4WOsN0C5iY/R64GjFwR7J+/bgeG64XvfhpuQ/UBP2+U68PqSBtM="\n+    - ZSERVER_PORT=55001\n matrix:\n   include:\n   - python: "2.7"\ndiff --git a/src/plone/restapi/services/__init__.py b/src/plone/restapi/services/__init__.py\nindex 2416c256..48311be5 100644\n--- a/src/plone/restapi/services/__init__.py\n+++ b/src/plone/restapi/services/__init__.py\n@@ -19,7 +19,8 @@ def render(self):\n         content = self.reply()\n         if content is not _no_content_marker:\n             self.request.response.setHeader("Content-Type", self.content_type)\n-            return json.dumps(content, indent=2, sort_keys=True)\n+            return json.dumps(\n+                content, indent=2, sort_keys=True, separators=(\', \', \': \'))\n \n     def check_permission(self):\n         sm = getSecurityManager()\ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex e0ee2df2..89a2bbe8 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -132,6 +132,7 @@ def save_request_and_response_for_docs(name, response):\n                 # ever decide to dump that header\n                 response.request.prepare_body(data=body, files=None)\n \n+            req.flush()\n             if (isinstance(response.request.body, six.text_type)\n                     or not hasattr(req, \'buffer\')):\n                 req.write(response.request.body)\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2018-11-18T19:14:04+01:00
Author: Timo Stollenwerk (tisto) <tisto@users.noreply.github.com>
Commit: https://github.com/plone/plone.restapi/commit/ecb1c89df129dad3abc088d24d4dd994a3ae9260

Merge pull request #640 from plone/test-fixes

Fix some differences with http test output in Python 3

Files changed:
M .travis.yml
M src/plone/restapi/services/__init__.py
M src/plone/restapi/tests/test_documentation.py

b'diff --git a/.travis.yml b/.travis.yml\nindex 7e180279..ef01483a 100644\n--- a/.travis.yml\n+++ b/.travis.yml\n@@ -14,6 +14,7 @@ env:\n   global:\n     - secure: "tj9kO7Uyn7AY2Z6zhdOggLSYheaD8e+qKA7ZXvdWTrL2HtPAtnNJK8keQGj1JLQyy6bRfoOCt51aL8+Lc0fzcACaLFpAPjleSLtUChphPOh/dqTu1QX5oL0SxZ94B4ZC5+qfaSAQHMwbiiWUW0us9QtJpxQQmiJUekqiTdQDNEo="\n     - secure: "j06un+j2gHjlGfg+xMcvKG2osf1HSzBq/cPPNIonnjGQY3GJfT/YRzYnHe5LJPPt7IJDD7hAEPentRJ4C0zP66U6gcQ2HjWPsMIcvzlgnXoT2QaaCVkMA9YS4WOsN0C5iY/R64GjFwR7J+/bgeG64XvfhpuQ/UBP2+U68PqSBtM="\n+    - ZSERVER_PORT=55001\n matrix:\n   include:\n   - python: "2.7"\ndiff --git a/src/plone/restapi/services/__init__.py b/src/plone/restapi/services/__init__.py\nindex 2416c256..48311be5 100644\n--- a/src/plone/restapi/services/__init__.py\n+++ b/src/plone/restapi/services/__init__.py\n@@ -19,7 +19,8 @@ def render(self):\n         content = self.reply()\n         if content is not _no_content_marker:\n             self.request.response.setHeader("Content-Type", self.content_type)\n-            return json.dumps(content, indent=2, sort_keys=True)\n+            return json.dumps(\n+                content, indent=2, sort_keys=True, separators=(\', \', \': \'))\n \n     def check_permission(self):\n         sm = getSecurityManager()\ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex e0ee2df2..89a2bbe8 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -132,6 +132,7 @@ def save_request_and_response_for_docs(name, response):\n                 # ever decide to dump that header\n                 response.request.prepare_body(data=body, files=None)\n \n+            req.flush()\n             if (isinstance(response.request.body, six.text_type)\n                     or not hasattr(req, \'buffer\')):\n                 req.write(response.request.body)\n'

