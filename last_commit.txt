Repository: mockup


Branch: refs/heads/master
Date: 2016-10-06T12:31:17-05:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/mockup/commit/e8b94c20ebd9762a6a9af9be7922ebd25af5a3b7

dont open dropdown when hitting enter anywhere in the form. refs: http://stackoverflow.com/a/39902207/1337474

Files changed:
M mockup/patterns/relateditems/pattern.relateditems.less
M mockup/patterns/relateditems/templates/toolbar.xml

diff --git a/mockup/patterns/relateditems/pattern.relateditems.less b/mockup/patterns/relateditems/pattern.relateditems.less
index 3078384..443b9ae 100644
--- a/mockup/patterns/relateditems/pattern.relateditems.less
+++ b/mockup/patterns/relateditems/pattern.relateditems.less
@@ -29,10 +29,8 @@
 
     .btn:extend(.btn all){}
     .btn-default:extend(.btn-default all){}
-    .btn-danger:extend(.btn-danger all){}
     .btn-primary:extend(.btn-primary all){}
     .btn-group:extend(.btn-group all){}
-    .btn-success:extend(.btn-success all){}
     .input-group:extend(.input-group all){}
     .input-group-addon:extend(.input-group-addon all){}
     .input-group-btn:extend(.input-group-btn all){}
diff --git a/mockup/patterns/relateditems/templates/toolbar.xml b/mockup/patterns/relateditems/templates/toolbar.xml
index dc0d217..153deda 100644
--- a/mockup/patterns/relateditems/templates/toolbar.xml
+++ b/mockup/patterns/relateditems/templates/toolbar.xml
@@ -10,7 +10,7 @@
 <div class="controls pull-right">
   <% if (favorites.length > 0) { %>
   <div class="favorites dropdown pull-right">
-    <button class="favorites dropdown-toggle btn btn-primary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
+    <button type="button" class="favorites dropdown-toggle btn btn-primary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
       <span class="glyphicon glyphicon-star"/>
       <%- favText %>
       <span class="caret"/>


Repository: mockup


Branch: refs/heads/master
Date: 2016-10-07T10:13:53-05:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/mockup/commit/c7c14b673fded50b7f9564e291b321ba0bf1f797

Calculate all paths relative to the rootPath, so that breadcrumbs navigation and favorites do not show paths outside the rootPath.

Files changed:
M CHANGES.rst
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/templates/toolbar.xml
M mockup/patterns/tinymce/pattern.js
M mockup/tests/pattern-relateditems-test.js

diff --git a/CHANGES.rst b/CHANGES.rst
index ff09741..1ed55c6 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -46,6 +46,7 @@ New:
 
     - Adapt TinyMCE pattern to related item changes and remove now obsolete selection and result templates.
 
+    - Calculate all paths relative to the ``rootPath``, so that breadcrumbs navigation and favorites do not show paths outside the rootPath.
   [thet]
 
 
diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js
index 7b0d267..f690aca 100644
--- a/mockup/patterns/relateditems/pattern.js
+++ b/mockup/patterns/relateditems/pattern.js
@@ -122,7 +122,7 @@ define([
       // more options
       upload: false,
       attributes: ['UID', 'Title', 'portal_type', 'path', 'getURL', 'getIcon', 'is_folderish', 'review_state'],  // used by utils.QueryHelper
-      basePath: undefined,
+      basePath: '',
       closeOnSelect: true,
       dropdownCssClass: 'pattern-relateditems-dropdown',
       favorites: [],
@@ -190,7 +190,7 @@ define([
         baseCriteria.push({
           i: 'path',
           o: 'plone.app.querystring.operation.string.path',
-          v: this.currentPath
+          v: this.options.rootPath + this.currentPath
         });
 
       }
@@ -214,14 +214,10 @@ define([
     setBreadCrumbs: function () {
       var self = this;
       var path = self.currentPath;
-      var root = self.options.rootPath.replace(/\/$/, '');
       var html;
 
-      // strip site root from path
-      path = path.indexOf(root) === 0 ? path.slice(root.length) : path;
-
       var paths = path.split('/');
-      var itemPath = root;
+      var itemPath = '';
       var itemsHtml = '';
       _.each(paths, function(node) {
         if (node !== '') {
@@ -236,7 +232,9 @@ define([
       // favorites
       var favoritesHtml = '';
       _.each(self.options.favorites, function (item) {
-        favoritesHtml = favoritesHtml + self.applyTemplate('favorite', item);
+        var item_copy = _.clone(item)
+        item_copy.path = item_copy.path.substr(self.options.rootPath.length) || '/';
+        favoritesHtml = favoritesHtml + self.applyTemplate('favorite', item_copy);
       });
 
       html = self.applyTemplate('toolbar', {
@@ -246,7 +244,6 @@ define([
         searchText: _t('Current path:'),
         searchModeText: _t('Search'),
         browseModeText: _t('Browse'),
-        rootPath: self.options.rootPath
       });
 
       self.$toolbar.html(html);
@@ -339,7 +336,7 @@ define([
               // url: self.currentUrl() + self.options.uploadAllowView,  // not working yet
               dataType: 'JSON',
               data: {
-                path: self.currentPath
+                path: self.options.rootPath + self.currentPath
               },
               type: 'GET',
               success: function (result) {
@@ -402,7 +399,11 @@ define([
       var self = this;
 
       self.browsing = self.options.mode === 'browse';
-      self.currentPath = self.options.basePath || self.options.rootPath;
+
+      // Remove trailing slash
+      self.options.rootPath = self.options.rootPath.replace(/\/$/, '');
+      // Substract rootPath from basePath with is the relative currentPath. Has a leading slash. Or use '/'
+      self.currentPath = self.options.basePath.substr(self.options.rootPath.length) || '/';
 
       self.setQuery();
 
diff --git a/mockup/patterns/relateditems/templates/toolbar.xml b/mockup/patterns/relateditems/templates/toolbar.xml
index 153deda..4b55322 100644
--- a/mockup/patterns/relateditems/templates/toolbar.xml
+++ b/mockup/patterns/relateditems/templates/toolbar.xml
@@ -4,7 +4,7 @@
 </div>
 <div class="path-wrapper">
   <span class="pattern-relateditems-path-label"><%- searchText %></span>
-  <a class="crumb" href="<%- rootPath %>"><span class="glyphicon glyphicon-home"/></a>
+  <a class="crumb" href="/"><span class="glyphicon glyphicon-home"/></a>
   <%= items %>
 </div>
 <div class="controls pull-right">
diff --git a/mockup/patterns/tinymce/pattern.js b/mockup/patterns/tinymce/pattern.js
index a69a34b..fe49647 100644
--- a/mockup/patterns/tinymce/pattern.js
+++ b/mockup/patterns/tinymce/pattern.js
@@ -8,7 +8,6 @@
  *    targetList(array): TODO ([ {text: "Open in this window / frame", value: ""}, {text: "Open in new window", value: "_blank"}, {text: "Open in parent window / frame", value: "_parent"}, {text: "Open in top frame (replaces all frames)", value: "_top"}])
  *    imageTypes(string): TODO ('Image')
  *    folderTypes(string): TODO ('Folder,Plone Site')
- *    linkableTypes(string): TODO ('Document,Event,File,Folder,Image,News Item,Topic')
  *    tiny(object): TODO ({ plugins: [ "advlist autolink lists charmap print preview anchor", "usearchreplace visualblocks code fullscreen autoresize", "insertdatetime media table contextmenu paste plonelink ploneimage" ], menubar: "edit table format tools view insert",
  toolbar: "undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | unlink plonelink ploneimage", autoresize_max_height: 1500 })
  *    prependToUrl(string): Text to prepend to generated internal urls. ('')
diff --git a/mockup/tests/pattern-relateditems-test.js b/mockup/tests/pattern-relateditems-test.js
index 25de272..59c81b9 100644
--- a/mockup/tests/pattern-relateditems-test.js
+++ b/mockup/tests/pattern-relateditems-test.js
@@ -63,7 +63,6 @@ define([
       }
       this.server.respondWith(/relateditems-test.json/, function(xhr, id) {
 
-
         var addUrls = function(list) {
           /* add getURL value */
           for (var i = 0; i < list.length; i = i + 1) {
@@ -349,7 +348,6 @@ define([
     it('use favorites', function () {
       var pattern = initializePattern({'favorites': [{'title': 'root', 'path': '/'}, {'title': 'folder1', 'path': '/folder1'}]});
       var clock = sinon.useFakeTimers();
-      var $input;
 
       // open up result list by clicking on "browse"
       $('button.favorites', $container).click();


Repository: mockup


Branch: refs/heads/master
Date: 2016-10-07T14:34:54-05:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/mockup/commit/e853cc4618ff1b9cbe8dcab92e37a5396bf210b9

open select2 after browsing somewhere

Files changed:
M CHANGES.rst
M mockup/patterns/relateditems/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 1ed55c6..0ba3368 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -26,7 +26,7 @@ New:
 
     - Let "browse" mode start from current path.
 
-    - Immediately open select2 results when clicking on "Browse" or "Search".
+    - Immediately open select2 results when clicking on "Browse" or "Search" or browsing somewhere.
 
     - Show only selectable items in "search" mode, if defined.
 
diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js
index f690aca..8da5207 100644
--- a/mockup/patterns/relateditems/pattern.js
+++ b/mockup/patterns/relateditems/pattern.js
@@ -358,10 +358,10 @@ define([
       self.emit('before-browse');
       self.currentPath = path;
       self.$el.select2('close');
-      self.$el.select2('open');
-      self.emit('after-browse');
       self.setBreadCrumbs();
       self.setQuery();
+      self.$el.select2('open');
+      self.emit('after-browse');
     },
 
     selectItem: function(item) {


Repository: mockup


Branch: refs/heads/master
Date: 2016-10-22T23:31:25-04:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/mockup/commit/a688771219769aae1a8bd89f956b024e1edd1cba

Merge pull request #717 from plone/thet-a-lot

relatedItems enhancements

Files changed:
M CHANGES.rst
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/pattern.relateditems.less
M mockup/patterns/relateditems/templates/toolbar.xml
M mockup/patterns/tinymce/pattern.js
M mockup/tests/pattern-relateditems-test.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 076104d..beb60db 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -31,7 +31,7 @@ New:
 
     - Let "browse" mode start from current path.
 
-    - Immediately open select2 results when clicking on "Browse" or "Search".
+    - Immediately open select2 results when clicking on "Browse" or "Search" or browsing somewhere.
 
     - Show only selectable items in "search" mode, if defined.
 
@@ -51,6 +51,7 @@ New:
 
     - Adapt TinyMCE pattern to related item changes and remove now obsolete selection and result templates.
 
+    - Calculate all paths relative to the ``rootPath``, so that breadcrumbs navigation and favorites do not show paths outside the rootPath.
   [thet]
 
 
diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js
index 7b0d267..8da5207 100644
--- a/mockup/patterns/relateditems/pattern.js
+++ b/mockup/patterns/relateditems/pattern.js
@@ -122,7 +122,7 @@ define([
       // more options
       upload: false,
       attributes: ['UID', 'Title', 'portal_type', 'path', 'getURL', 'getIcon', 'is_folderish', 'review_state'],  // used by utils.QueryHelper
-      basePath: undefined,
+      basePath: '',
       closeOnSelect: true,
       dropdownCssClass: 'pattern-relateditems-dropdown',
       favorites: [],
@@ -190,7 +190,7 @@ define([
         baseCriteria.push({
           i: 'path',
           o: 'plone.app.querystring.operation.string.path',
-          v: this.currentPath
+          v: this.options.rootPath + this.currentPath
         });
 
       }
@@ -214,14 +214,10 @@ define([
     setBreadCrumbs: function () {
       var self = this;
       var path = self.currentPath;
-      var root = self.options.rootPath.replace(/\/$/, '');
       var html;
 
-      // strip site root from path
-      path = path.indexOf(root) === 0 ? path.slice(root.length) : path;
-
       var paths = path.split('/');
-      var itemPath = root;
+      var itemPath = '';
       var itemsHtml = '';
       _.each(paths, function(node) {
         if (node !== '') {
@@ -236,7 +232,9 @@ define([
       // favorites
       var favoritesHtml = '';
       _.each(self.options.favorites, function (item) {
-        favoritesHtml = favoritesHtml + self.applyTemplate('favorite', item);
+        var item_copy = _.clone(item)
+        item_copy.path = item_copy.path.substr(self.options.rootPath.length) || '/';
+        favoritesHtml = favoritesHtml + self.applyTemplate('favorite', item_copy);
       });
 
       html = self.applyTemplate('toolbar', {
@@ -246,7 +244,6 @@ define([
         searchText: _t('Current path:'),
         searchModeText: _t('Search'),
         browseModeText: _t('Browse'),
-        rootPath: self.options.rootPath
       });
 
       self.$toolbar.html(html);
@@ -339,7 +336,7 @@ define([
               // url: self.currentUrl() + self.options.uploadAllowView,  // not working yet
               dataType: 'JSON',
               data: {
-                path: self.currentPath
+                path: self.options.rootPath + self.currentPath
               },
               type: 'GET',
               success: function (result) {
@@ -361,10 +358,10 @@ define([
       self.emit('before-browse');
       self.currentPath = path;
       self.$el.select2('close');
-      self.$el.select2('open');
-      self.emit('after-browse');
       self.setBreadCrumbs();
       self.setQuery();
+      self.$el.select2('open');
+      self.emit('after-browse');
     },
 
     selectItem: function(item) {
@@ -402,7 +399,11 @@ define([
       var self = this;
 
       self.browsing = self.options.mode === 'browse';
-      self.currentPath = self.options.basePath || self.options.rootPath;
+
+      // Remove trailing slash
+      self.options.rootPath = self.options.rootPath.replace(/\/$/, '');
+      // Substract rootPath from basePath with is the relative currentPath. Has a leading slash. Or use '/'
+      self.currentPath = self.options.basePath.substr(self.options.rootPath.length) || '/';
 
       self.setQuery();
 
diff --git a/mockup/patterns/relateditems/pattern.relateditems.less b/mockup/patterns/relateditems/pattern.relateditems.less
index 3078384..443b9ae 100644
--- a/mockup/patterns/relateditems/pattern.relateditems.less
+++ b/mockup/patterns/relateditems/pattern.relateditems.less
@@ -29,10 +29,8 @@
 
     .btn:extend(.btn all){}
     .btn-default:extend(.btn-default all){}
-    .btn-danger:extend(.btn-danger all){}
     .btn-primary:extend(.btn-primary all){}
     .btn-group:extend(.btn-group all){}
-    .btn-success:extend(.btn-success all){}
     .input-group:extend(.input-group all){}
     .input-group-addon:extend(.input-group-addon all){}
     .input-group-btn:extend(.input-group-btn all){}
diff --git a/mockup/patterns/relateditems/templates/toolbar.xml b/mockup/patterns/relateditems/templates/toolbar.xml
index dc0d217..4b55322 100644
--- a/mockup/patterns/relateditems/templates/toolbar.xml
+++ b/mockup/patterns/relateditems/templates/toolbar.xml
@@ -4,13 +4,13 @@
 </div>
 <div class="path-wrapper">
   <span class="pattern-relateditems-path-label"><%- searchText %></span>
-  <a class="crumb" href="<%- rootPath %>"><span class="glyphicon glyphicon-home"/></a>
+  <a class="crumb" href="/"><span class="glyphicon glyphicon-home"/></a>
   <%= items %>
 </div>
 <div class="controls pull-right">
   <% if (favorites.length > 0) { %>
   <div class="favorites dropdown pull-right">
-    <button class="favorites dropdown-toggle btn btn-primary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
+    <button type="button" class="favorites dropdown-toggle btn btn-primary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
       <span class="glyphicon glyphicon-star"/>
       <%- favText %>
       <span class="caret"/>
diff --git a/mockup/patterns/tinymce/pattern.js b/mockup/patterns/tinymce/pattern.js
index a69a34b..fe49647 100644
--- a/mockup/patterns/tinymce/pattern.js
+++ b/mockup/patterns/tinymce/pattern.js
@@ -8,7 +8,6 @@
  *    targetList(array): TODO ([ {text: "Open in this window / frame", value: ""}, {text: "Open in new window", value: "_blank"}, {text: "Open in parent window / frame", value: "_parent"}, {text: "Open in top frame (replaces all frames)", value: "_top"}])
  *    imageTypes(string): TODO ('Image')
  *    folderTypes(string): TODO ('Folder,Plone Site')
- *    linkableTypes(string): TODO ('Document,Event,File,Folder,Image,News Item,Topic')
  *    tiny(object): TODO ({ plugins: [ "advlist autolink lists charmap print preview anchor", "usearchreplace visualblocks code fullscreen autoresize", "insertdatetime media table contextmenu paste plonelink ploneimage" ], menubar: "edit table format tools view insert",
  toolbar: "undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | unlink plonelink ploneimage", autoresize_max_height: 1500 })
  *    prependToUrl(string): Text to prepend to generated internal urls. ('')
diff --git a/mockup/tests/pattern-relateditems-test.js b/mockup/tests/pattern-relateditems-test.js
index 25de272..59c81b9 100644
--- a/mockup/tests/pattern-relateditems-test.js
+++ b/mockup/tests/pattern-relateditems-test.js
@@ -63,7 +63,6 @@ define([
       }
       this.server.respondWith(/relateditems-test.json/, function(xhr, id) {
 
-
         var addUrls = function(list) {
           /* add getURL value */
           for (var i = 0; i < list.length; i = i + 1) {
@@ -349,7 +348,6 @@ define([
     it('use favorites', function () {
       var pattern = initializePattern({'favorites': [{'title': 'root', 'path': '/'}, {'title': 'folder1', 'path': '/folder1'}]});
       var clock = sinon.useFakeTimers();
-      var $input;
 
       // open up result list by clicking on "browse"
       $('button.favorites', $container).click();


