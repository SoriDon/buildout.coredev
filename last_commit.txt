Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-04-04T17:56:41-03:00
Author: hvelarde (hvelarde) <hector.velarde@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/6996f1e0b52ee80518d3475408dee15e277cb6c8

Add constraint to avoid filling twitter_username field with strings starting with a "@" character

Files changed:
M CHANGES.rst
M Products/CMFPlone/interfaces/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1589697..c65bdd2 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,7 +18,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Add constraint to avoid filling ``twitter_username`` field with strings starting with a "@" character.
+  [hvelarde]
 
 
 5.1b3 (2017-04-03)
diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py
index df458aa..bf60265 100644
--- a/Products/CMFPlone/interfaces/controlpanel.py
+++ b/Products/CMFPlone/interfaces/controlpanel.py
@@ -5,6 +5,7 @@
 from zope import schema
 from zope.interface import implementer
 from zope.interface import Interface
+from zope.interface import Invalid
 from zope.schema.vocabulary import SimpleTerm
 from zope.schema.vocabulary import SimpleVocabulary
 
@@ -1457,6 +1458,13 @@ class IUserGroupsSettingsSchema(Interface):
     )
 
 
+def validate_twitter_username(value):
+    if value and value.startswith('@'):
+        raise Invalid(
+            u'Twitter username should not include the "@" prefix character.')
+    return True
+
+
 class ISocialMediaSchema(Interface):
 
     share_social_data = schema.Bool(
@@ -1467,10 +1475,15 @@ class ISocialMediaSchema(Interface):
         default=True)
 
     twitter_username = schema.ASCIILine(
-        title=_(u'Twitter Username'),
-        description=_(u'To identify things like Twitter Cards. Do not include the \'@\' prefix character.'),
+        title=_(u'Twitter username'),
+        description=_(
+            u'To identify things like Twitter Cards. '
+            u'Do not include the "@" prefix character.'
+        ),
         required=False,
-        default='')
+        default='',
+        constraint=validate_twitter_username,
+    )
 
     facebook_app_id = schema.ASCIILine(
         title=_(u'Facebook App ID'),


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-04-05T19:01:29+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/6c0a1f985444b0e3d739984a2482e77d5cb3c815

Merge branch 'master' into issue_1981

Files changed:
M Products/CMFPlone/browser/templates/plone-addsite.pt
M Products/CMFPlone/profiles/default/metadata.xml

diff --git a/Products/CMFPlone/browser/templates/plone-addsite.pt b/Products/CMFPlone/browser/templates/plone-addsite.pt
index 1ff975d..1d8a602 100644
--- a/Products/CMFPlone/browser/templates/plone-addsite.pt
+++ b/Products/CMFPlone/browser/templates/plone-addsite.pt
@@ -46,8 +46,8 @@
         </label>
 
         <div class="formHelp" i18n:translate="">
-          The id of the site. This ends up as part of the URL.<br />
-          No special characters are allowed.
+          The ID of the site. This ends up as part of the URL.<br />
+          No special characters or spaces are allowed.
         </div>
 
         <input type="text" name="site_id" size="20" id="site_id"
diff --git a/Products/CMFPlone/profiles/default/metadata.xml b/Products/CMFPlone/profiles/default/metadata.xml
index 85b1925..3f3cb12 100644
--- a/Products/CMFPlone/profiles/default/metadata.xml
+++ b/Products/CMFPlone/profiles/default/metadata.xml
@@ -1,4 +1,4 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>5106</version>
+  <version>5107</version>
 </metadata>


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-04-05T19:02:27+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/78320d4d97fe664bd399710da35eab95d71ff53a

Merge pull request #1983 from plone/issue_1981

Add constraint to avoid filling twitter_username field with strings starting with a "@" character

Files changed:
M CHANGES.rst
M Products/CMFPlone/interfaces/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1589697..c65bdd2 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,7 +18,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Add constraint to avoid filling ``twitter_username`` field with strings starting with a "@" character.
+  [hvelarde]
 
 
 5.1b3 (2017-04-03)
diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py
index df458aa..bf60265 100644
--- a/Products/CMFPlone/interfaces/controlpanel.py
+++ b/Products/CMFPlone/interfaces/controlpanel.py
@@ -5,6 +5,7 @@
 from zope import schema
 from zope.interface import implementer
 from zope.interface import Interface
+from zope.interface import Invalid
 from zope.schema.vocabulary import SimpleTerm
 from zope.schema.vocabulary import SimpleVocabulary
 
@@ -1457,6 +1458,13 @@ class IUserGroupsSettingsSchema(Interface):
     )
 
 
+def validate_twitter_username(value):
+    if value and value.startswith('@'):
+        raise Invalid(
+            u'Twitter username should not include the "@" prefix character.')
+    return True
+
+
 class ISocialMediaSchema(Interface):
 
     share_social_data = schema.Bool(
@@ -1467,10 +1475,15 @@ class ISocialMediaSchema(Interface):
         default=True)
 
     twitter_username = schema.ASCIILine(
-        title=_(u'Twitter Username'),
-        description=_(u'To identify things like Twitter Cards. Do not include the \'@\' prefix character.'),
+        title=_(u'Twitter username'),
+        description=_(
+            u'To identify things like Twitter Cards. '
+            u'Do not include the "@" prefix character.'
+        ),
         required=False,
-        default='')
+        default='',
+        constraint=validate_twitter_username,
+    )
 
     facebook_app_id = schema.ASCIILine(
         title=_(u'Facebook App ID'),


