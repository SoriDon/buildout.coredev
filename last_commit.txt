Repository: plone.restapi


Branch: refs/heads/master
Date: 2019-03-04T15:05:37+01:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/a430318248b601219307ad409c6264749c177a9d

Add group roles to @groups serializer

Files changed:
A news/682.feature
M src/plone/restapi/serializer/group.py
M src/plone/restapi/tests/http-examples/groups.resp
M src/plone/restapi/tests/http-examples/groups_created.resp
M src/plone/restapi/tests/http-examples/groups_filtered_by_groupname.resp
M src/plone/restapi/tests/http-examples/groups_get.resp
M src/plone/restapi/tests/http-examples/principals.resp
M src/plone/restapi/tests/test_services_groups.py

b'diff --git a/news/682.feature b/news/682.feature\nnew file mode 100644\nindex 00000000..8c0d430a\n--- /dev/null\n+++ b/news/682.feature\n@@ -0,0 +1,2 @@\n+- Add group roles to @groups serializer\n+  [sneridagh]\ndiff --git a/src/plone/restapi/serializer/group.py b/src/plone/restapi/serializer/group.py\nindex ab60834f..a547787d 100644\n--- a/src/plone/restapi/serializer/group.py\n+++ b/src/plone/restapi/serializer/group.py\n@@ -28,6 +28,7 @@ def __call__(self):\n             \'email\': group.getProperty(\'email\'),\n             \'title\': group.getProperty(\'title\'),\n             \'description\': group.getProperty(\'description\'),\n+            \'roles\': group.getRoles(),\n         }\n \n \ndiff --git a/src/plone/restapi/tests/http-examples/groups.resp b/src/plone/restapi/tests/http-examples/groups.resp\nindex 4900bf9e..6f24788b 100644\n--- a/src/plone/restapi/tests/http-examples/groups.resp\n+++ b/src/plone/restapi/tests/http-examples/groups.resp\n@@ -8,6 +8,10 @@ Content-Type: application/json\n     "email": "", \n     "groupname": "Administrators", \n     "id": "Administrators", \n+    "roles": [\n+      "Manager", \n+      "Authenticated"\n+    ], \n     "title": "Administrators"\n   }, \n   {\n@@ -16,6 +20,10 @@ Content-Type: application/json\n     "email": "", \n     "groupname": "Reviewers", \n     "id": "Reviewers", \n+    "roles": [\n+      "Reviewer", \n+      "Authenticated"\n+    ], \n     "title": "Reviewers"\n   }, \n   {\n@@ -24,6 +32,10 @@ Content-Type: application/json\n     "email": "", \n     "groupname": "Site Administrators", \n     "id": "Site Administrators", \n+    "roles": [\n+      "Site Administrator", \n+      "Authenticated"\n+    ], \n     "title": "Site Administrators"\n   }, \n   {\n@@ -32,6 +44,9 @@ Content-Type: application/json\n     "email": "ploneteam@plone.org", \n     "groupname": "ploneteam", \n     "id": "ploneteam", \n+    "roles": [\n+      "Authenticated"\n+    ], \n     "title": "Plone Team"\n   }, \n   {\n@@ -40,6 +55,7 @@ Content-Type: application/json\n     "email": "", \n     "groupname": "AuthenticatedUsers", \n     "id": "AuthenticatedUsers", \n+    "roles": [], \n     "title": "Authenticated Users (Virtual Group)"\n   }\n ]\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/tests/http-examples/groups_created.resp b/src/plone/restapi/tests/http-examples/groups_created.resp\nindex d7611e18..db08b74d 100644\n--- a/src/plone/restapi/tests/http-examples/groups_created.resp\n+++ b/src/plone/restapi/tests/http-examples/groups_created.resp\n@@ -8,6 +8,10 @@ Location: http://localhost:55001/plone/@groups/fwt\n   "email": "fwt@plone.org", \n   "groupname": "fwt", \n   "id": "fwt", \n+  "roles": [\n+    "Manager", \n+    "Authenticated"\n+  ], \n   "title": "Framework Team", \n   "users": {\n     "@id": "http://localhost:55001/plone/@groups", \ndiff --git a/src/plone/restapi/tests/http-examples/groups_filtered_by_groupname.resp b/src/plone/restapi/tests/http-examples/groups_filtered_by_groupname.resp\nindex d4358609..2932114e 100644\n--- a/src/plone/restapi/tests/http-examples/groups_filtered_by_groupname.resp\n+++ b/src/plone/restapi/tests/http-examples/groups_filtered_by_groupname.resp\n@@ -8,6 +8,9 @@ Content-Type: application/json\n     "email": "ploneteam@plone.org", \n     "groupname": "ploneteam", \n     "id": "ploneteam", \n+    "roles": [\n+      "Authenticated"\n+    ], \n     "title": "Plone Team"\n   }\n ]\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/tests/http-examples/groups_get.resp b/src/plone/restapi/tests/http-examples/groups_get.resp\nindex 32616b25..656466e0 100644\n--- a/src/plone/restapi/tests/http-examples/groups_get.resp\n+++ b/src/plone/restapi/tests/http-examples/groups_get.resp\n@@ -7,6 +7,9 @@ Content-Type: application/json\n   "email": "ploneteam@plone.org", \n   "groupname": "ploneteam", \n   "id": "ploneteam", \n+  "roles": [\n+    "Authenticated"\n+  ], \n   "title": "Plone Team", \n   "users": {\n     "@id": "http://localhost:55001/plone/@groups/ploneteam", \ndiff --git a/src/plone/restapi/tests/http-examples/principals.resp b/src/plone/restapi/tests/http-examples/principals.resp\nindex 6ca70dbb..ed94e761 100644\n--- a/src/plone/restapi/tests/http-examples/principals.resp\n+++ b/src/plone/restapi/tests/http-examples/principals.resp\n@@ -9,6 +9,9 @@ Content-Type: application/json\n       "email": "ploneteam@plone.org", \n       "groupname": "ploneteam", \n       "id": "ploneteam", \n+      "roles": [\n+        "Authenticated"\n+      ], \n       "title": "Plone Team"\n     }\n   ], \ndiff --git a/src/plone/restapi/tests/test_services_groups.py b/src/plone/restapi/tests/test_services_groups.py\nindex cf265f93..d4735d86 100644\n--- a/src/plone/restapi/tests/test_services_groups.py\n+++ b/src/plone/restapi/tests/test_services_groups.py\n@@ -62,6 +62,8 @@ def test_list_groups(self):\n         self.assertEqual(\'Plone Team\', ptgroup.get(\'title\'))\n         self.assertEqual(\'We are Plone\', ptgroup.get(\'description\'))\n \n+        self.assertEqual(ptgroup.get(\'roles\'), [\'Authenticated\'])\n+\n         # We don\'t want the group members listed in the overview as there\n         # might be loads.\n         self.assertTrue(\n'

