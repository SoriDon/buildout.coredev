Repository: plone.app.theming


Branch: refs/heads/master
Date: 2016-02-29T09:35:12-06:00
Author: nathan.vangheem () <nathan.vangheem@wildcardcorp.com>
Commit: https://github.com/plone/plone.app.theming/commit/73cd1d3bb0af3b1b515c3aac46b7419dc480c564

fix case where wrong theme could show up selected in control panel

Files changed:
M CHANGES.rst
M src/plone/app/theming/browser/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7b0ef28..f9e3218 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Handle potential scenarios where wrong theme would show selected in the theming
+  control panel
+  [vangheem]
 
 
 1.2.17 (2016-02-11)
diff --git a/src/plone/app/theming/browser/controlpanel.py b/src/plone/app/theming/browser/controlpanel.py
index 61bc5f0..46cd766 100644
--- a/src/plone/app/theming/browser/controlpanel.py
+++ b/src/plone/app/theming/browser/controlpanel.py
@@ -57,6 +57,7 @@ def _setup(self):
         self.availableThemes = getAvailableThemes()
         self.selectedTheme = self.getSelectedTheme(
             self.availableThemes,
+            self.theme_settings.currentTheme,
             self.theme_settings.rules
         )
         self.overlay = ''
@@ -390,7 +391,13 @@ def update(self):
 
         return True
 
-    def getSelectedTheme(self, themes, rules):
+    def getSelectedTheme(self, themes, themeName, rules):
+        for item in themes:
+            if item.__name__ == themeName:
+                return item.__name__
+
+        # BBB: If currentTheme isn't set, look for a theme with a rules file
+        # matching that of the current theme. Same as what policy does
         for item in themes:
             if item.rules == rules:
                 return item.__name__


Repository: plone.app.theming


Branch: refs/heads/master
Date: 2016-02-29T23:27:39+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.theming/commit/05263ff5fc088a0622d82f354348fe1b10cdcf98

Merge pull request #97 from plone/rules-conflict

fix case where wrong theme could show up selected in control panel

Files changed:
M CHANGES.rst
M src/plone/app/theming/browser/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7b0ef28..f9e3218 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Handle potential scenarios where wrong theme would show selected in the theming
+  control panel
+  [vangheem]
 
 
 1.2.17 (2016-02-11)
diff --git a/src/plone/app/theming/browser/controlpanel.py b/src/plone/app/theming/browser/controlpanel.py
index 61bc5f0..46cd766 100644
--- a/src/plone/app/theming/browser/controlpanel.py
+++ b/src/plone/app/theming/browser/controlpanel.py
@@ -57,6 +57,7 @@ def _setup(self):
         self.availableThemes = getAvailableThemes()
         self.selectedTheme = self.getSelectedTheme(
             self.availableThemes,
+            self.theme_settings.currentTheme,
             self.theme_settings.rules
         )
         self.overlay = ''
@@ -390,7 +391,13 @@ def update(self):
 
         return True
 
-    def getSelectedTheme(self, themes, rules):
+    def getSelectedTheme(self, themes, themeName, rules):
+        for item in themes:
+            if item.__name__ == themeName:
+                return item.__name__
+
+        # BBB: If currentTheme isn't set, look for a theme with a rules file
+        # matching that of the current theme. Same as what policy does
         for item in themes:
             if item.rules == rules:
                 return item.__name__


