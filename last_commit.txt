Repository: plone.app.mosaic


Branch: refs/heads/es6
Date: 2022-06-01T08:10:35+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.mosaic/commit/f1d8999ab3faabd3f9f1bc04ff92c926e1bf7142

update dependencies

Files changed:
M package.json

b'diff --git a/package.json b/package.json\nindex 587aa816..9e7f5f3e 100644\n--- a/package.json\n+++ b/package.json\n@@ -8,8 +8,8 @@\n         "yarn": "^1.3.2"\n     },\n     "dependencies": {\n-        "@patternslib/patternslib": "^8.0.3",\n-        "@plone/mockup": "^5.0.0-alpha.6"\n+        "@patternslib/patternslib": "8.1.0-alpha.1",\n+        "@plone/mockup": "^5.0.0-alpha.7"\n     },\n     "devDependencies": {\n         "@babel/core": "^7.18.0",\n@@ -42,7 +42,6 @@\n         "sass-loader": "^13.0.0",\n         "style-loader": "^3.3.0",\n         "terser-webpack-plugin": "^5.3.1",\n-        "underscore": "git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626",\n         "webpack": "^5.72.1",\n         "webpack-bundle-analyzer": "^4.4.2",\n         "webpack-cli": "^4.9.2",\n'

Repository: plone.app.mosaic


Branch: refs/heads/es6
Date: 2022-06-01T08:10:38+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.mosaic/commit/2efbf5df889024f4723919a46bb7ab16792db1ac

yarn install

Files changed:
M yarn.lock

b'diff --git a/yarn.lock b/yarn.lock\nindex 03a320f1..a0428ad1 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -1537,47 +1537,10 @@\n     codejar "^3.5.0"\n     prismjs "^1.27.0"\n \n-"@patternslib/patternslib@^7.4.0":\n-  version "7.12.0"\n-  resolved "https://registry.yarnpkg.com/@patternslib/patternslib/-/patternslib-7.12.0.tgz#c1584d5b95ea6af6c147089fc5320aeb21b57fd6"\n-  integrity sha512-sKM2CQw9JXBSN559b1m4Y7AHdPXetHNNHoitCnn0D3vJdCsVqStLvKaC3n27T/5vrgZyEvylKY64MFalfVKTJw==\n-  dependencies:\n-    "@fullcalendar/adaptive" "^5.10.1"\n-    "@fullcalendar/core" "^5.10.1"\n-    "@fullcalendar/daygrid" "^5.10.1"\n-    "@fullcalendar/interaction" "^5.10.1"\n-    "@fullcalendar/list" "^5.10.1"\n-    "@fullcalendar/luxon" "^5.10.1"\n-    "@fullcalendar/timegrid" "^5.10.1"\n-    "@juggle/resize-observer" "^3.3.1"\n-    "@stomp/stompjs" "^6.1.2"\n-    google-code-prettify "^1.0.5"\n-    imagesloaded "^4.1.4"\n-    intersection-observer "^0.12.0"\n-    jquery "^3.6.0"\n-    jquery-jcrop "^0.9.13"\n-    luxon "^1.27.0"\n-    masonry-layout "^4.2.2"\n-    moment "^2.29.3"\n-    moment-timezone "^0.5.34"\n-    photoswipe "^4.1.3"\n-    pikaday "^1.8.0"\n-    promise-polyfill "^8.2.3"\n-    screenfull "^6.0.1"\n-    select2 "^3.5.1"\n-    showdown "^2.1.0"\n-    showdown-prettify "^1.3.0"\n-    slick-carousel "^1.8.1"\n-    slides "git+https://github.com/Patternslib/slides.git"\n-    spectrum-colorpicker "^1.8.0"\n-    tippy.js "^6.3.7"\n-    url-polyfill "^1.1.9"\n-    whatwg-fetch "^3.4.0"\n-\n-"@patternslib/patternslib@^8.0.2":\n-  version "8.0.2"\n-  resolved "https://registry.yarnpkg.com/@patternslib/patternslib/-/patternslib-8.0.2.tgz#e062e369008b41e07ffb59395d3d82ae9a210b0f"\n-  integrity sha512-U4tr0jMMsJh0AWKFihQkDqMAtiL4g5uyQU8USkX96vYbeGLXrfYcJynv3DVWc/SqHjqqs+98epJO8/USfefZcg==\n+"@patternslib/patternslib@8.1.0-alpha.1":\n+  version "8.1.0-alpha.1"\n+  resolved "https://registry.yarnpkg.com/@patternslib/patternslib/-/patternslib-8.1.0-alpha.1.tgz#d13ac7bc79e3390be0489cffed07eb2a720afe8d"\n+  integrity sha512-WArZZsicmFlEoxS52BzFVJP1mNoSh+0mEIRZgEYhAnKD5jCHOzz0x0YnM/KCQWoBILLR7VsIu8HlcP1vo4/p7g==\n   dependencies:\n     "@fullcalendar/adaptive" "^5.11.0"\n     "@fullcalendar/core" "^5.11.0"\n@@ -1611,18 +1574,18 @@\n     url-polyfill "^1.1.9"\n     whatwg-fetch "^3.4.0"\n \n-"@patternslib/patternslib@^8.0.3":\n-  version "8.0.3"\n-  resolved "https://registry.yarnpkg.com/@patternslib/patternslib/-/patternslib-8.0.3.tgz#d21a630075243d9dd9cdd0fcecc0d2f5f17e4e7b"\n-  integrity sha512-ollp15PAXIAkzrYR7bizVhK9pOV//M4xDHBq4CP8XYKRnTUcMANr0+cJgSTUiGxGdO9BX39/DEzPSPS5If62Og==\n+"@patternslib/patternslib@^7.4.0":\n+  version "7.12.0"\n+  resolved "https://registry.yarnpkg.com/@patternslib/patternslib/-/patternslib-7.12.0.tgz#c1584d5b95ea6af6c147089fc5320aeb21b57fd6"\n+  integrity sha512-sKM2CQw9JXBSN559b1m4Y7AHdPXetHNNHoitCnn0D3vJdCsVqStLvKaC3n27T/5vrgZyEvylKY64MFalfVKTJw==\n   dependencies:\n-    "@fullcalendar/adaptive" "^5.11.0"\n-    "@fullcalendar/core" "^5.11.0"\n-    "@fullcalendar/daygrid" "^5.11.0"\n-    "@fullcalendar/interaction" "^5.11.0"\n-    "@fullcalendar/list" "^5.11.0"\n-    "@fullcalendar/luxon2" "^5.11.0"\n-    "@fullcalendar/timegrid" "^5.11.0"\n+    "@fullcalendar/adaptive" "^5.10.1"\n+    "@fullcalendar/core" "^5.10.1"\n+    "@fullcalendar/daygrid" "^5.10.1"\n+    "@fullcalendar/interaction" "^5.10.1"\n+    "@fullcalendar/list" "^5.10.1"\n+    "@fullcalendar/luxon" "^5.10.1"\n+    "@fullcalendar/timegrid" "^5.10.1"\n     "@juggle/resize-observer" "^3.3.1"\n     "@stomp/stompjs" "^6.1.2"\n     google-code-prettify "^1.0.5"\n@@ -1630,7 +1593,7 @@\n     intersection-observer "^0.12.0"\n     jquery "^3.6.0"\n     jquery-jcrop "^0.9.13"\n-    luxon "^2.3.2"\n+    luxon "^1.27.0"\n     masonry-layout "^4.2.2"\n     moment "^2.29.3"\n     moment-timezone "^0.5.34"\n@@ -1648,14 +1611,15 @@\n     url-polyfill "^1.1.9"\n     whatwg-fetch "^3.4.0"\n \n-"@plone/mockup@^5.0.0-alpha.6":\n-  version "5.0.0-alpha.6"\n-  resolved "https://registry.yarnpkg.com/@plone/mockup/-/mockup-5.0.0-alpha.6.tgz#161de9ec304bb63fef651b81192fc9430f298840"\n-  integrity sha512-HHhJ4+cZs7ep9003Oh1UqdbfCw5m9/0o/0o2XWtWwAJJts+yLAl4/Cafoxycsez3C2nCI9ExgENPRMUIudMikQ==\n+"@plone/mockup@^5.0.0-alpha.7":\n+  version "5.0.0-alpha.7"\n+  resolved "https://registry.yarnpkg.com/@plone/mockup/-/mockup-5.0.0-alpha.7.tgz#4c0806d31bfbc83713e0d8127d369ab76013aa32"\n+  integrity sha512-pYRVX/J7fJY2vI5jVArko0st2OfZVpyzfFASBox4C5BUJwXU4vo8m6EgEpD71ivZKta74lnZ02qIgezSavXxNg==\n   dependencies:\n     "@patternslib/pat-code-editor" "^2.1.2"\n-    "@patternslib/patternslib" "^8.0.2"\n+    "@patternslib/patternslib" "8.1.0-alpha.1"\n     backbone "1.4.1"\n+    backbone.paginator "2.0.8"\n     bootstrap "^5.2.0-beta1"\n     bootstrap-icons "^1.8.2"\n     cs-jqtree-contextmenu "0.1.0"\n@@ -1684,7 +1648,7 @@\n     sortablejs "^1.15.0"\n     tinymce "^5.10.2"\n     tinymce-i18n "^20.12.25"\n-    underscore "^1.13.3"\n+    underscore "git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626"\n \n "@polka/url@^1.0.0-next.20":\n   version "1.0.0-next.21"\n@@ -2522,7 +2486,15 @@ babel-preset-jest@^28.0.2:\n     babel-plugin-jest-hoist "^28.0.2"\n     babel-preset-current-node-syntax "^1.0.0"\n \n-backbone@1.4.1:\n+backbone.paginator@2.0.8:\n+  version "2.0.8"\n+  resolved "https://registry.yarnpkg.com/backbone.paginator/-/backbone.paginator-2.0.8.tgz#3a7e34f0a8b97b096333587ed3048556b9eafdcb"\n+  integrity sha512-8XS2CTbjnwMbJ/3Traa1te2RPecOGbZ9tc52T89pzo6NXlVEJDFnC++dp7CQLBUZpgk3g0veX8mUbEF4wbD2NQ==\n+  dependencies:\n+    backbone "1.1.2 || 1.2.3 || ^1.3.2"\n+    underscore "^1.8.0"\n+\n+"backbone@1.1.2 || 1.2.3 || ^1.3.2", backbone@1.4.1:\n   version "1.4.1"\n   resolved "https://registry.yarnpkg.com/backbone/-/backbone-1.4.1.tgz#099a78184bc07b034048a8332229c2ccca1e3e62"\n   integrity sha512-ADy1ztN074YkWbHi8ojJVFe3vAanO/lrzMGZWUClIP7oDD/Pjy2vrASraUP+2EVCfIiTtCW4FChVow01XneivA==\n@@ -7484,12 +7456,7 @@ undefsafe@^2.0.5:\n   resolved "https://registry.yarnpkg.com/undefsafe/-/undefsafe-2.0.5.tgz#38733b9327bdcd226db889fb723a6efd162e6e2c"\n   integrity sha512-WxONCrssBM8TSPRqN5EmsjVrsv4A8X12J4ArBiiayv3DyyG3ZlIg6yysuuSYdZsVz3TKcTg2fd//Ujd4CHV1iA==\n \n-underscore@>=1.8.3, underscore@^1.13.3:\n-  version "1.13.3"\n-  resolved "https://registry.yarnpkg.com/underscore/-/underscore-1.13.3.tgz#54bc95f7648c5557897e5e968d0f76bc062c34ee"\n-  integrity sha512-QvjkYpiD+dJJraRA8+dGAU4i7aBbb2s0S3jA45TFOvg2VgqvdCDd/3N6CqA8gluk1W91GLoXg5enMUx560QzuA==\n-\n-"underscore@git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626":\n+underscore@>=1.8.3, underscore@^1.8.0, "underscore@git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626":\n   version "1.13.3"\n   resolved "git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626"\n \n'

Repository: plone.app.mosaic


Branch: refs/heads/es6
Date: 2022-06-01T08:10:47+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.mosaic/commit/c862d721f29bc7a2e8dcd0af6c9d5c72c57be4bf

tiny initialization fix

Files changed:
M resources/js/mosaic.tile.js

b'diff --git a/resources/js/mosaic.tile.js b/resources/js/mosaic.tile.js\nindex 442d8c51..607ba787 100644\n--- a/resources/js/mosaic.tile.js\n+++ b/resources/js/mosaic.tile.js\n@@ -994,9 +994,6 @@ class Tile {\n         const TinyMCE = (\n             await import("@plone/mockup/src/pat/tinymce/tinymce")\n         ).default;\n-        // const implementation = (\n-        //     await import("@plone/mockup/src/pat/tinymce/tinymce--implementation")\n-        // ).default;\n \n         // deep copy the options to get correct tiny settings!\n         var tiny_options = JSON.parse(JSON.stringify(self.mosaic.options.tinymce));\n@@ -1008,7 +1005,7 @@ class Tile {\n \n         const tiny_instance = new TinyMCE($content, tiny_options);\n         await tiny_instance.init()\n-        self.tinymce = tiny_instance.instance;\n+        self.tinymce = tiny_instance.instance.tiny;\n \n         log.info(`Setup wysiwyg for "${id}"`);\n \n'

Repository: plone.app.mosaic


Branch: refs/heads/es6
Date: 2022-06-01T08:10:57+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.mosaic/commit/74925c44349aff92d89319aa1803270342e669fc

focus fix on tinymce-tile

Files changed:
M resources/js/mosaic.layout.js

b'diff --git a/resources/js/mosaic.layout.js b/resources/js/mosaic.layout.js\nindex 036000ac..28bb0794 100644\n--- a/resources/js/mosaic.layout.js\n+++ b/resources/js/mosaic.layout.js\n@@ -392,8 +392,6 @@ export default class LayoutManager {\n             if (e.keyCode === 17) {\n                 $(".mosaic-panel", self.mosaic.document).removeClass("inner-subcolumn");\n             }\n-            // re-focus active tinymce to reposition toolbar\n-            $(".mce-edit-focus").trigger("focus");\n         };\n \n         // Keydown handler\n'

Repository: plone.app.mosaic


Branch: refs/heads/es6
Date: 2022-06-01T08:11:12+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.mosaic/commit/87e3b822b3abee357293ef8bd5a847cf6856ea17

properties overlay (todo)

Files changed:
M resources/js/mosaic.overlay.js

b'diff --git a/resources/js/mosaic.overlay.js b/resources/js/mosaic.overlay.js\nindex 8c6e3c94..e639d6aa 100644\n--- a/resources/js/mosaic.overlay.js\n+++ b/resources/js/mosaic.overlay.js\n@@ -1,6 +1,9 @@\n // This plugin is used to display an overlay\n import $ from "jquery";\n import Modal from "@plone/mockup/src/pat/modal/modal";\n+import logging from "@patternslib/patternslib/src/core/logging";\n+\n+const log = logging.getLogger("pat-mosaic/overlay");\n \n export default class Overlay {\n     constructor(options, panels) {\n@@ -85,7 +88,8 @@ export default class Overlay {\n                         ".mosaic-" + field_tile.name + "-tile"\n                     ).length !== 0\n                 ) {\n-                    $("#" + field_tile.id).addClass("mosaic-hidden");\n+                    log.info(`Hide field.tile ${field_tile.id}`);\n+                    self.modal.$modal.find("#" + field_tile.id).addClass("mosaic-hidden");\n                 }\n             }\n \n'

