Repository: plone.app.workflow


Branch: refs/heads/python3
Date: 2018-06-24T14:25:54+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.workflow/commit/80c1a3c077f0f814cb62785ae9baee95b0e5c2c8

fix tests for py3

Files changed:
M plone/app/workflow/tests/sharingpage.rst
M plone/app/workflow/tests/test_functional.py
M plone/app/workflow/tests/test_sharing_view.py

b'diff --git a/plone/app/workflow/tests/sharingpage.rst b/plone/app/workflow/tests/sharingpage.rst\nindex d210b40..e008166 100644\n--- a/plone/app/workflow/tests/sharingpage.rst\n+++ b/plone/app/workflow/tests/sharingpage.rst\n@@ -37,7 +37,7 @@ We shouldn\'t see the Sharing tab\n     >>> browser.getLink(\'Sharing\')\n     Traceback (most recent call last):\n     ...\n-    LinkNotFoundError\n+    zope.testbrowser.browser.LinkNotFoundError\n \n Manager\n -------\n@@ -157,7 +157,7 @@ Sharing tab.\n     >>> browser.getLink(\'Sharing\')\n     Traceback (most recent call last):\n     ...\n-    LinkNotFoundError\n+    zope.testbrowser.browser.LinkNotFoundError\n \n Delegated Editor\n ----------------\n@@ -198,7 +198,7 @@ A delegated Contributor cannot assign any further rights.\n     >>> browser.getLink(\'Sharing\').click()\n     Traceback (most recent call last):\n     ...\n-    LinkNotFoundError\n+    zope.testbrowser.browser.LinkNotFoundError\n \n Delegated Reviewer\n ------------------\ndiff --git a/plone/app/workflow/tests/test_functional.py b/plone/app/workflow/tests/test_functional.py\nindex 25719e8..b219a0c 100644\n--- a/plone/app/workflow/tests/test_functional.py\n+++ b/plone/app/workflow/tests/test_functional.py\n@@ -8,6 +8,8 @@\n from Products.CMFCore.utils import getToolByName\n \n import doctest\n+import re\n+import six\n import transaction\n import unittest\n \n@@ -37,6 +39,13 @@ def setup(doctest):\n     transaction.commit()\n \n \n+class Py23DocChecker(doctest.OutputChecker):\n+    def check_output(self, want, got, optionflags):\n+        if six.PY2:\n+            want = re.sub(\'zope.testbrowser.browser.LinkNotFoundError\', \'LinkNotFoundError\', want)  # noqa: E501\n+        return doctest.OutputChecker.check_output(self, want, got, optionflags)\n+\n+\n def test_suite():\n     suite = unittest.TestSuite()\n     tests = [\n@@ -46,6 +55,7 @@ def test_suite():\n                 package=\'plone.app.workflow\',\n                 optionflags=optionflags,\n                 setUp=setup,\n+                checker=Py23DocChecker(),\n             ),\n             layer=PLONE_APP_WORKFLOW_FUNCTIONAL_TESTING,\n         )\ndiff --git a/plone/app/workflow/tests/test_sharing_view.py b/plone/app/workflow/tests/test_sharing_view.py\nindex a0eeec7..50ef580 100644\n--- a/plone/app/workflow/tests/test_sharing_view.py\n+++ b/plone/app/workflow/tests/test_sharing_view.py\n@@ -13,6 +13,7 @@\n from zope.interface import implementer\n from zope.interface import Interface\n \n+import six\n import unittest\n \n \n@@ -88,9 +89,12 @@ def test_search_with_nonascii_users(self):\n         view = getMultiAdapter((self.portal, self.request), name=\'sharing\')\n         results = view.role_settings()\n         self.assertTrue(len(results))\n+        expected = u\'\xc3\x84\xc3\x9c\xc3\x9f\'\n+        if six.PY2:\n+            expected = expected.encode(\'utf8\')\n         self.assertEqual(\n             results[-1].get(\'title\'),\n-            b\'\\xc3\\x84\\xc3\\x9c\\xc3\\x9f\',\n+            expected,\n             msg="Umlaute",\n         )\n \n'

