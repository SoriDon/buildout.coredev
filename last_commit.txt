Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-07-05T15:17:11+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.restapi/commit/2af027cabbf913c74a5cd83405867e9e03d39fd4

Fix PAS plugin markup for Zope4+

Files changed:
A news/1157.bugfix
M src/plone/restapi/pas/add_plugin.zpt
M src/plone/restapi/pas/config.zpt

b'diff --git a/news/1157.bugfix b/news/1157.bugfix\nnew file mode 100644\nindex 000000000..7255d6c20\n--- /dev/null\n+++ b/news/1157.bugfix\n@@ -0,0 +1 @@\n+Fix PAS plugin ZMI markup for Zope4+. [jensens]\ndiff --git a/src/plone/restapi/pas/add_plugin.zpt b/src/plone/restapi/pas/add_plugin.zpt\nindex c960d9ba4..b7e8c3636 100644\n--- a/src/plone/restapi/pas/add_plugin.zpt\n+++ b/src/plone/restapi/pas/add_plugin.zpt\n@@ -1,33 +1,36 @@\n-<html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal">\n-  <body>\n-    <h1 tal:replace="structure here/manage_page_header">Header</h1>\n+<h1 tal:replace="structure here/manage_page_header">Header</h1>\n \n-    <h2 tal:define="form_title string:JWT Authentication Plugin"\n-        tal:replace="structure here/manage_form_title">Form Title</h2>\n+<main class="container-fluid">\n+\n+  <h2 tal:define="form_title string:Add JWT Authentication Plugin"\n+      tal:replace="structure here/manage_form_title">Form Title</h2>\n \n     <p class="form-help">\n-      Plone PAS plugin for authentication with JSON web tokens (JWT)\n+      Plone PAS plugin for authentication with JSON web tokens (JWT).\n     </p>\n \n-    <form action="addJWTAuthenticationPlugin" method="post">\n-      <table>\n-        <tr>\n-          <td class="form-label">Id</td>\n-          <td><input type="text" name="id_" tal:attributes="value request/id|string:jwt_auth"/></td>\n-        </tr>\n-        <tr>\n-          <td class="form-label">Title</td>\n-          <td><input type="text" name="title"/></td>\n-        </tr>\n-        <tr>\n-          <td colspan="2">\n-            <div class="form-element">\n-              <input type="submit" value="Add"/>\n-            </div>\n-          </td>\n-        </tr>\n-      </table>\n-    </form>\n-  </body>\n-</html>\n\\ No newline at end of file\n+    <form action="addJWTAuthenticationPlugin" method="post" enctype="multipart/form-data">\n+\n+      <div class="form-group row">\n+        <label for="id_" class="form-label col-sm-3 col-md-2">Id</label>\n+        <div class="col-sm-9 col-md-10">\n+          <input id="id_" name="id" class="form-control" type="text" tal:attributes="value request/id|string:jwt_auth" />\n+        </div>\n+      </div>\n+\n+      <div class="form-group row form-optional">\n+        <label for="title" class="form-label col-sm-3 col-md-2">Title</label>\n+        <div class="col-sm-9 col-md-10">\n+          <input id="title" name="title" class="form-control" type="text" tal:attributes="value request/title|string:JWT Authentication" />\n+        </div>\n+      </div>\n+\n+      <div class="zmi-controls">\n+        <input class="btn btn-primary" type="submit" name="submit" value="Add" />\n+      </div>\n+\n+  </form>\n+\n+</main>\n+\n+<h1 tal:replace="structure here/manage_page_footer">Footer</h1>\ndiff --git a/src/plone/restapi/pas/config.zpt b/src/plone/restapi/pas/config.zpt\nindex 46e5fd619..bfe372989 100644\n--- a/src/plone/restapi/pas/config.zpt\n+++ b/src/plone/restapi/pas/config.zpt\n@@ -1,47 +1,50 @@\n <h1 tal:replace="structure here/manage_page_header"> PAGE HEADER </h1>\n-<h2 tal:replace="structure here/manage_tabs"> PAGE HEADER </h2>\n+<h2 tal:define="global manage_tabs_message request/manage_tabs_message | nothing;\n+                form_title string:JWT Authentication"\n+    tal:replace="structure here/manage_tabs"> TABS </h2>\n \n-<h3>JWT Authentication</h3>\n+<main class="container-fluid">\n+  <p class="form-help">\n+    Choose the functionality this Plone JWT Authentication Plugin will perform.\n+  </p>\n+  <form action="manage_updateConfig" method="post">\n+    <div class="form-group">\n+      <label class="form-label" for="token_timeout">Token Validity Timeout (in seconds)</label>\n+      <input type="text"       \n+             name="token_timeout"\n+             class="form-control"\n+             tal:attributes="value context/token_timeout|nothing"/>\n+      <small class="form-text text-muted">After this, the token is invalid and the user must login again. Set to 0 for the token to remain valid indefinitely.</small>\n+    </div>\n+    \n+    <div class="form-group">\n+      <div class="form-check">\n+        <input class="form-check-input" \n+               type="checkbox" value="" \n+               name="use_keyring" \n+               id="use_keyring" \n+               tal:attributes="checked python: context.use_keyring and \'checked\'">\n+        <label class="form-check-label" for="use_keyring">Use Keyring</label>\n+        <small class="form-text text-muted">If enabled, tokens are signed with a secret from Plone\'s keyring. If you want tokens that remain valid indefinitely you should disable this.</small>\n+      </div>\n+    </div>\n \n-    <p class="form-help">\n-      Plone PAS plugin for authentication with JSON web tokens (JWT).\n-    </p>\n+    <div class="form-group">\n+      <div class="form-check">\n+        <input class="form-check-input" \n+               type="checkbox" value="" \n+               name="store_tokens" \n+               id="store_tokens" \n+               tal:attributes="checked python: context.store_tokens and \'checked\'">\n+        <label class="form-check-label" for="store_tokens">Store tokens</label>\n+        <small class="form-text text-muted">By default tokens are not stored on the server and thus can\'t be invalidated. If enabled, tokens that don\'t expire can be invalidated.</small>\n+      </div>\n+    </div>\n+    <div class="zmi-controls">\n+      <button class="btn btn-primary" type="submit">Update</button>\n+    </div>\n+  </form>\n \n-    <form action="manage_updateConfig" method="post">\n-      <table>\n-        <tr valign="top">\n-          <td><div class="form-label">Token Validity Timeout (in seconds)</div>\n-          <div class="form-help">After this, the token is invalid and the user\n-          must login again. Set to 0 for the token to remain valid indefinitely.</div>\n-          </td>\n-          <td><input type="text" name="token_timeout"\n-                     tal:attributes="value context/token_timeout|nothing"/></td>\n-        </tr>\n-        <tr>\n-          <td align="left" valign="top">\n-            <input type="checkbox" name="use_keyring" id="use-keyring"\n-                   tal:attributes="checked python: context.use_keyring and \'checked\'"/>&nbsp;<label class="form-label" for="use-keyring">Use Keyring</label>\n-            <div class="form-help">If enabled, tokens are signed with a secret from\n-            Plone\'s keyring. If you want tokens that remain valid indefinitely you should disable this.</div>\n-          </td>\n-        </tr>\n-        <tr>\n-          <td align="left" valign="top">\n-            <input type="checkbox" name="store_tokens" id="store-tokens"\n-                   tal:attributes="checked python: context.store_tokens and \'checked\'"/>&nbsp;<label class="form-label" for="store-tokens">Store tokens</label>\n-            <div class="form-help">By default tokens are not stored on the server and\n-            thus can\'t be invalidated. If enabled, tokens that don\'t expire can be invalidated.</div>\n-          </td>\n-        </tr>\n-        <tr>\n-          <td colspan="2">\n-            <div class="form-element">\n-              <input type="submit" value="Update"/>\n-            </div>\n-          </td>\n-        </tr>\n-      </table>\n-    </form>\n+</main>\n \n-\n-<h1 tal:replace="structure here/manage_page_footer"> PAGE FOOTER </h1>\n\\ No newline at end of file\n+<h2 tal:replace="structure here/manage_page_footer"> PAGE FOOTER </h2>\n\\ No newline at end of file\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-07-05T16:20:24+02:00
Author: agitator (agitator) <agitator@users.noreply.github.com>
Commit: https://github.com/plone/plone.restapi/commit/6915b48f33c5605332535e610dc767b685da495a

Merge pull request #1157 from plone/fix-pas-xmi-zpt

Fix PAS plugin markup for Zope4+

Files changed:
A news/1157.bugfix
M src/plone/restapi/pas/add_plugin.zpt
M src/plone/restapi/pas/config.zpt

b'diff --git a/news/1157.bugfix b/news/1157.bugfix\nnew file mode 100644\nindex 000000000..7255d6c20\n--- /dev/null\n+++ b/news/1157.bugfix\n@@ -0,0 +1 @@\n+Fix PAS plugin ZMI markup for Zope4+. [jensens]\ndiff --git a/src/plone/restapi/pas/add_plugin.zpt b/src/plone/restapi/pas/add_plugin.zpt\nindex c960d9ba4..b7e8c3636 100644\n--- a/src/plone/restapi/pas/add_plugin.zpt\n+++ b/src/plone/restapi/pas/add_plugin.zpt\n@@ -1,33 +1,36 @@\n-<html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal">\n-  <body>\n-    <h1 tal:replace="structure here/manage_page_header">Header</h1>\n+<h1 tal:replace="structure here/manage_page_header">Header</h1>\n \n-    <h2 tal:define="form_title string:JWT Authentication Plugin"\n-        tal:replace="structure here/manage_form_title">Form Title</h2>\n+<main class="container-fluid">\n+\n+  <h2 tal:define="form_title string:Add JWT Authentication Plugin"\n+      tal:replace="structure here/manage_form_title">Form Title</h2>\n \n     <p class="form-help">\n-      Plone PAS plugin for authentication with JSON web tokens (JWT)\n+      Plone PAS plugin for authentication with JSON web tokens (JWT).\n     </p>\n \n-    <form action="addJWTAuthenticationPlugin" method="post">\n-      <table>\n-        <tr>\n-          <td class="form-label">Id</td>\n-          <td><input type="text" name="id_" tal:attributes="value request/id|string:jwt_auth"/></td>\n-        </tr>\n-        <tr>\n-          <td class="form-label">Title</td>\n-          <td><input type="text" name="title"/></td>\n-        </tr>\n-        <tr>\n-          <td colspan="2">\n-            <div class="form-element">\n-              <input type="submit" value="Add"/>\n-            </div>\n-          </td>\n-        </tr>\n-      </table>\n-    </form>\n-  </body>\n-</html>\n\\ No newline at end of file\n+    <form action="addJWTAuthenticationPlugin" method="post" enctype="multipart/form-data">\n+\n+      <div class="form-group row">\n+        <label for="id_" class="form-label col-sm-3 col-md-2">Id</label>\n+        <div class="col-sm-9 col-md-10">\n+          <input id="id_" name="id" class="form-control" type="text" tal:attributes="value request/id|string:jwt_auth" />\n+        </div>\n+      </div>\n+\n+      <div class="form-group row form-optional">\n+        <label for="title" class="form-label col-sm-3 col-md-2">Title</label>\n+        <div class="col-sm-9 col-md-10">\n+          <input id="title" name="title" class="form-control" type="text" tal:attributes="value request/title|string:JWT Authentication" />\n+        </div>\n+      </div>\n+\n+      <div class="zmi-controls">\n+        <input class="btn btn-primary" type="submit" name="submit" value="Add" />\n+      </div>\n+\n+  </form>\n+\n+</main>\n+\n+<h1 tal:replace="structure here/manage_page_footer">Footer</h1>\ndiff --git a/src/plone/restapi/pas/config.zpt b/src/plone/restapi/pas/config.zpt\nindex 46e5fd619..bfe372989 100644\n--- a/src/plone/restapi/pas/config.zpt\n+++ b/src/plone/restapi/pas/config.zpt\n@@ -1,47 +1,50 @@\n <h1 tal:replace="structure here/manage_page_header"> PAGE HEADER </h1>\n-<h2 tal:replace="structure here/manage_tabs"> PAGE HEADER </h2>\n+<h2 tal:define="global manage_tabs_message request/manage_tabs_message | nothing;\n+                form_title string:JWT Authentication"\n+    tal:replace="structure here/manage_tabs"> TABS </h2>\n \n-<h3>JWT Authentication</h3>\n+<main class="container-fluid">\n+  <p class="form-help">\n+    Choose the functionality this Plone JWT Authentication Plugin will perform.\n+  </p>\n+  <form action="manage_updateConfig" method="post">\n+    <div class="form-group">\n+      <label class="form-label" for="token_timeout">Token Validity Timeout (in seconds)</label>\n+      <input type="text"       \n+             name="token_timeout"\n+             class="form-control"\n+             tal:attributes="value context/token_timeout|nothing"/>\n+      <small class="form-text text-muted">After this, the token is invalid and the user must login again. Set to 0 for the token to remain valid indefinitely.</small>\n+    </div>\n+    \n+    <div class="form-group">\n+      <div class="form-check">\n+        <input class="form-check-input" \n+               type="checkbox" value="" \n+               name="use_keyring" \n+               id="use_keyring" \n+               tal:attributes="checked python: context.use_keyring and \'checked\'">\n+        <label class="form-check-label" for="use_keyring">Use Keyring</label>\n+        <small class="form-text text-muted">If enabled, tokens are signed with a secret from Plone\'s keyring. If you want tokens that remain valid indefinitely you should disable this.</small>\n+      </div>\n+    </div>\n \n-    <p class="form-help">\n-      Plone PAS plugin for authentication with JSON web tokens (JWT).\n-    </p>\n+    <div class="form-group">\n+      <div class="form-check">\n+        <input class="form-check-input" \n+               type="checkbox" value="" \n+               name="store_tokens" \n+               id="store_tokens" \n+               tal:attributes="checked python: context.store_tokens and \'checked\'">\n+        <label class="form-check-label" for="store_tokens">Store tokens</label>\n+        <small class="form-text text-muted">By default tokens are not stored on the server and thus can\'t be invalidated. If enabled, tokens that don\'t expire can be invalidated.</small>\n+      </div>\n+    </div>\n+    <div class="zmi-controls">\n+      <button class="btn btn-primary" type="submit">Update</button>\n+    </div>\n+  </form>\n \n-    <form action="manage_updateConfig" method="post">\n-      <table>\n-        <tr valign="top">\n-          <td><div class="form-label">Token Validity Timeout (in seconds)</div>\n-          <div class="form-help">After this, the token is invalid and the user\n-          must login again. Set to 0 for the token to remain valid indefinitely.</div>\n-          </td>\n-          <td><input type="text" name="token_timeout"\n-                     tal:attributes="value context/token_timeout|nothing"/></td>\n-        </tr>\n-        <tr>\n-          <td align="left" valign="top">\n-            <input type="checkbox" name="use_keyring" id="use-keyring"\n-                   tal:attributes="checked python: context.use_keyring and \'checked\'"/>&nbsp;<label class="form-label" for="use-keyring">Use Keyring</label>\n-            <div class="form-help">If enabled, tokens are signed with a secret from\n-            Plone\'s keyring. If you want tokens that remain valid indefinitely you should disable this.</div>\n-          </td>\n-        </tr>\n-        <tr>\n-          <td align="left" valign="top">\n-            <input type="checkbox" name="store_tokens" id="store-tokens"\n-                   tal:attributes="checked python: context.store_tokens and \'checked\'"/>&nbsp;<label class="form-label" for="store-tokens">Store tokens</label>\n-            <div class="form-help">By default tokens are not stored on the server and\n-            thus can\'t be invalidated. If enabled, tokens that don\'t expire can be invalidated.</div>\n-          </td>\n-        </tr>\n-        <tr>\n-          <td colspan="2">\n-            <div class="form-element">\n-              <input type="submit" value="Update"/>\n-            </div>\n-          </td>\n-        </tr>\n-      </table>\n-    </form>\n+</main>\n \n-\n-<h1 tal:replace="structure here/manage_page_footer"> PAGE FOOTER </h1>\n\\ No newline at end of file\n+<h2 tal:replace="structure here/manage_page_footer"> PAGE FOOTER </h2>\n\\ No newline at end of file\n'

