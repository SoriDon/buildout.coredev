Repository: plone.versioncheck


Branch: refs/heads/master
Date: 2017-05-08T16:14:21+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.versioncheck/commit/fab729f3275e6b61e277d4736bd4f5e0854785f0

Fix: Default versions section name versions was not respected.

Files changed:
M CHANGES.rst
M src/plone/versioncheck/parser.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 772425b..b2f1b5f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.6.4 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fix: Default versions section name ``versions`` was not respected.
+  [jensens]
 
 
 1.6.3 (2017-05-05)
diff --git a/src/plone/versioncheck/parser.py b/src/plone/versioncheck/parser.py
index 57dab93..e3fac26 100644
--- a/src/plone/versioncheck/parser.py
+++ b/src/plone/versioncheck/parser.py
@@ -72,9 +72,15 @@ def _extract_versions_section(  # NOQA: C901
         else:
             sys.stderr.write('\n  fresh from server')
     # first read own versions section
+    current_version_section_name = buildout['buildout'].get(
+        'versions',
+        'versions',
+    )
     if version_section_name is None:
-        version_section_name = buildout['buildout'].get('versions')
-    elif version_section_name != buildout['buildout'].get('versions'):
+        # initial name
+        version_section_name = current_version_section_name
+    elif version_section_name != current_version_section_name:
+        # name changed, not sure if this works as expected! - jensens
         sys.stderr.write(
             '\nName of [versions] (versions = versions) has changed.'
             '\nGlobal versions section name: "{gname}"'


