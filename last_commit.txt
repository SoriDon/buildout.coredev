Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2017-10-21T13:20:48+02:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.ATContentTypes/commit/d91d86781b5fcd28ab33dd842b9a80e3f9b11930

fix test

Files changed:
M Products/ATContentTypes/tests/http_access.txt

diff --git a/Products/ATContentTypes/tests/http_access.txt b/Products/ATContentTypes/tests/http_access.txt
index 42deea04..d9c1790e 100644
--- a/Products/ATContentTypes/tests/http_access.txt
+++ b/Products/ATContentTypes/tests/http_access.txt
@@ -249,12 +249,11 @@ ATImage
   ... """ % (imgpath, user_name, user_password))
   HTTP/1.1 200 OK
   Accept-Ranges: none
-  Connection: close
   Content-Length: 105
   Content-Type: image/gif
-  Date: ...
   Etag: ts...
   Last-Modified: ...
+  ...
   <BLANKLINE>
 
 HTTP Range request


Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2017-10-21T13:20:48+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.ATContentTypes/commit/8846595dd65b59e1b3b862d85582ed0a4979f0b7

do not call views in tal

Files changed:
M Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt

diff --git a/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt b/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt
index 7b8f99cc..10397b4f 100644
--- a/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt
+++ b/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt
@@ -39,8 +39,8 @@
                         toLocalizedTime nocall: context/@@plone/toLocalizedTime;
                         show_about python:not isAnon or context.portal_registry['plone.allow_anon_views_about'];
                         navigation_root_url context/@@plone_portal_state/navigation_root_url;
-                        pas_member context/@@pas_member;
-                        layout_view context/@@plone_layout;">
+                        pas_member nocall:context/@@pas_member;
+                        layout_view nocall:context/@@plone_layout;">
     <tal:listing condition="batch">
 
         <div metal:define-slot="entries">
@@ -52,7 +52,7 @@
                                    item_type item/portal_type;
                                    item_type_title item/Type;
                                    item_modified item/ModificationDate;
-                                   item_created item/CreationDate;                                   
+                                   item_created item/CreationDate;
                                    item_type_class python:'contenttype-' + normalizeString(item_type);
                                    item_wf_state item/review_state|python: context.portal_workflow.getInfoFor(item, 'review_state', '');
                                    item_wf_state_class python:'state-' + normalizeString(item_wf_state);


Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2017-10-21T13:30:02+02:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.ATContentTypes/commit/a1df98c8e775001e08774807bddacd1ead53b9a0

Fix checkPermission call (it was acquired from portal_membership until CMF 2.3)

Files changed:
M CHANGES.rst
M Products/ATContentTypes/tests/test_portal_factory.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7058f777..b0785c24 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,14 @@ New features:
 
 Bug fixes:
 
+- Zope4 compatibility: 
+   
+  - Do not call views in TAL.
+
+  - Fix checkPermission call (it was acquired from portal_membership until CMF 2.3).
+
+  [davisagli, pbauer]
+  
 - Added verbosity to the multiple GS profiles popping up.
   Mark all as ``old`` and ``backward compatibility``.
   This hopefully reduces the error rate in site setup.
diff --git a/Products/ATContentTypes/tests/test_portal_factory.py b/Products/ATContentTypes/tests/test_portal_factory.py
index 55e723d9..26baaff2 100644
--- a/Products/ATContentTypes/tests/test_portal_factory.py
+++ b/Products/ATContentTypes/tests/test_portal_factory.py
@@ -168,9 +168,8 @@ def testCopyPermission(self):
         pm = self.portal.portal_membership
         pm.addMember('editor', 'secret', ['Editor'], [])
         self.login('editor')
-        member = pm.getMemberById('editor')
-        self.assertTrue(member.checkPermission(Permissions.copy_or_move,
-                                               self.portal))
+        self.assertTrue(
+            pm.checkPermission(Permissions.copy_or_move, self.portal))
         security = getSecurityManager()
         self.assertTrue(security.validate(
             self.portal, self.portal, 'manage_copyObjects'))
@@ -182,9 +181,8 @@ def testRenamePermission(self):
         pm = self.portal.portal_membership
         pm.addMember('editor', 'secret', ['Editor'], [])
         self.login('editor')
-        member = pm.getMemberById('editor')
-        self.assertTrue(member.checkPermission(ModifyPortalContent,
-                                               self.portal))
+        self.assertTrue(
+            pm.checkPermission(ModifyPortalContent, self.portal))
         security = getSecurityManager()
         self.assertTrue(security.validate(
             self.portal, self.portal, 'manage_renameObjects'))


Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2017-10-21T14:54:58+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.ATContentTypes/commit/640d35291493710a6985069ef9390d8d29e82da5

Merge pull request #50 from plone/plonezope4

fix test with zope4

Files changed:
M CHANGES.rst
M Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt
M Products/ATContentTypes/tests/http_access.txt
M Products/ATContentTypes/tests/test_portal_factory.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7058f777..b0785c24 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,14 @@ New features:
 
 Bug fixes:
 
+- Zope4 compatibility: 
+   
+  - Do not call views in TAL.
+
+  - Fix checkPermission call (it was acquired from portal_membership until CMF 2.3).
+
+  [davisagli, pbauer]
+  
 - Added verbosity to the multiple GS profiles popping up.
   Mark all as ``old`` and ``backward compatibility``.
   This hopefully reduces the error rate in site setup.
diff --git a/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt b/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt
index 7b8f99cc..10397b4f 100644
--- a/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt
+++ b/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt
@@ -39,8 +39,8 @@
                         toLocalizedTime nocall: context/@@plone/toLocalizedTime;
                         show_about python:not isAnon or context.portal_registry['plone.allow_anon_views_about'];
                         navigation_root_url context/@@plone_portal_state/navigation_root_url;
-                        pas_member context/@@pas_member;
-                        layout_view context/@@plone_layout;">
+                        pas_member nocall:context/@@pas_member;
+                        layout_view nocall:context/@@plone_layout;">
     <tal:listing condition="batch">
 
         <div metal:define-slot="entries">
@@ -52,7 +52,7 @@
                                    item_type item/portal_type;
                                    item_type_title item/Type;
                                    item_modified item/ModificationDate;
-                                   item_created item/CreationDate;                                   
+                                   item_created item/CreationDate;
                                    item_type_class python:'contenttype-' + normalizeString(item_type);
                                    item_wf_state item/review_state|python: context.portal_workflow.getInfoFor(item, 'review_state', '');
                                    item_wf_state_class python:'state-' + normalizeString(item_wf_state);
diff --git a/Products/ATContentTypes/tests/http_access.txt b/Products/ATContentTypes/tests/http_access.txt
index 42deea04..d9c1790e 100644
--- a/Products/ATContentTypes/tests/http_access.txt
+++ b/Products/ATContentTypes/tests/http_access.txt
@@ -249,12 +249,11 @@ ATImage
   ... """ % (imgpath, user_name, user_password))
   HTTP/1.1 200 OK
   Accept-Ranges: none
-  Connection: close
   Content-Length: 105
   Content-Type: image/gif
-  Date: ...
   Etag: ts...
   Last-Modified: ...
+  ...
   <BLANKLINE>
 
 HTTP Range request
diff --git a/Products/ATContentTypes/tests/test_portal_factory.py b/Products/ATContentTypes/tests/test_portal_factory.py
index 55e723d9..26baaff2 100644
--- a/Products/ATContentTypes/tests/test_portal_factory.py
+++ b/Products/ATContentTypes/tests/test_portal_factory.py
@@ -168,9 +168,8 @@ def testCopyPermission(self):
         pm = self.portal.portal_membership
         pm.addMember('editor', 'secret', ['Editor'], [])
         self.login('editor')
-        member = pm.getMemberById('editor')
-        self.assertTrue(member.checkPermission(Permissions.copy_or_move,
-                                               self.portal))
+        self.assertTrue(
+            pm.checkPermission(Permissions.copy_or_move, self.portal))
         security = getSecurityManager()
         self.assertTrue(security.validate(
             self.portal, self.portal, 'manage_copyObjects'))
@@ -182,9 +181,8 @@ def testRenamePermission(self):
         pm = self.portal.portal_membership
         pm.addMember('editor', 'secret', ['Editor'], [])
         self.login('editor')
-        member = pm.getMemberById('editor')
-        self.assertTrue(member.checkPermission(ModifyPortalContent,
-                                               self.portal))
+        self.assertTrue(
+            pm.checkPermission(ModifyPortalContent, self.portal))
         security = getSecurityManager()
         self.assertTrue(security.validate(
             self.portal, self.portal, 'manage_renameObjects'))


