Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-05-16T11:22:40+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/1c4078aa59eb6977478d33e063cb8c8a167445c3

Show link to @@migrate_to_volto in the view @@plone-upgrade when the option is available.

Files changed:
A news/3528.feature
M Products/CMFPlone/browser/admin.py
M Products/CMFPlone/browser/templates/plone-upgrade.pt

b'diff --git a/Products/CMFPlone/browser/admin.py b/Products/CMFPlone/browser/admin.py\nindex dfa3df808c..972a6c4789 100644\n--- a/Products/CMFPlone/browser/admin.py\n+++ b/Products/CMFPlone/browser/admin.py\n@@ -343,3 +343,16 @@ def __call__(self):\n             )\n \n         return self.index()\n+\n+    def can_migrate_to_volto(self):\n+        if not HAS_VOLTO:\n+            return False\n+        pm = getattr(self.context, \'portal_migration\')\n+        if pm.getInstanceVersion() < "6005":\n+            return False\n+        try:\n+            from plone.volto.browser import migrate_to_volto\n+        except ImportError:\n+            return False\n+        installer = get_installer(self.context, self.request)\n+        return not installer.is_product_installed("plone.volto")\ndiff --git a/Products/CMFPlone/browser/templates/plone-upgrade.pt b/Products/CMFPlone/browser/templates/plone-upgrade.pt\nindex c4a09be6dd..21b66bbe9e 100644\n--- a/Products/CMFPlone/browser/templates/plone-upgrade.pt\n+++ b/Products/CMFPlone/browser/templates/plone-upgrade.pt\n@@ -70,6 +70,16 @@\n               </dd>\n             </dl>\n \n+            <tal:volto tal:condition="python: versions[\'equal\'] and view.can_migrate_to_volto()">\n+              <p class="alert-success p-2" i18n:translate="">\n+                You can prepare your site for Volto, the default frontend of Plone 6!\n+              </p>\n+              <a class="p-2" i18n:translate=""\n+                 tal:attributes="href string:${context/absolute_url}/@@migrate_to_volto">\n+                Click here if you want to learn more.\n+              </a>\n+            </tal:volto>\n+\n           </div>\n           <form tal:condition="versions/instance_lt"\n                 action="#"\ndiff --git a/news/3528.feature b/news/3528.feature\nnew file mode 100644\nindex 0000000000..6b0488bd07\n--- /dev/null\n+++ b/news/3528.feature\n@@ -0,0 +1,2 @@\n+Show link to the Volto-migration (@@migrate_to_volto) in the view @@plone-upgrade when the option is available.\n+[pbauer]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-01T11:21:43+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/58b5d65ab2ee219e9cc4ec7acf40842610fe876a

Merge pull request #3529 from plone/migrate_to_volto

Show link to @@migrate_to_volto after upgrade to Plone 6

Files changed:
A news/3528.feature
M Products/CMFPlone/browser/admin.py
M Products/CMFPlone/browser/templates/plone-upgrade.pt

b'diff --git a/Products/CMFPlone/browser/admin.py b/Products/CMFPlone/browser/admin.py\nindex dfa3df808c..972a6c4789 100644\n--- a/Products/CMFPlone/browser/admin.py\n+++ b/Products/CMFPlone/browser/admin.py\n@@ -343,3 +343,16 @@ def __call__(self):\n             )\n \n         return self.index()\n+\n+    def can_migrate_to_volto(self):\n+        if not HAS_VOLTO:\n+            return False\n+        pm = getattr(self.context, \'portal_migration\')\n+        if pm.getInstanceVersion() < "6005":\n+            return False\n+        try:\n+            from plone.volto.browser import migrate_to_volto\n+        except ImportError:\n+            return False\n+        installer = get_installer(self.context, self.request)\n+        return not installer.is_product_installed("plone.volto")\ndiff --git a/Products/CMFPlone/browser/templates/plone-upgrade.pt b/Products/CMFPlone/browser/templates/plone-upgrade.pt\nindex c4a09be6dd..21b66bbe9e 100644\n--- a/Products/CMFPlone/browser/templates/plone-upgrade.pt\n+++ b/Products/CMFPlone/browser/templates/plone-upgrade.pt\n@@ -70,6 +70,16 @@\n               </dd>\n             </dl>\n \n+            <tal:volto tal:condition="python: versions[\'equal\'] and view.can_migrate_to_volto()">\n+              <p class="alert-success p-2" i18n:translate="">\n+                You can prepare your site for Volto, the default frontend of Plone 6!\n+              </p>\n+              <a class="p-2" i18n:translate=""\n+                 tal:attributes="href string:${context/absolute_url}/@@migrate_to_volto">\n+                Click here if you want to learn more.\n+              </a>\n+            </tal:volto>\n+\n           </div>\n           <form tal:condition="versions/instance_lt"\n                 action="#"\ndiff --git a/news/3528.feature b/news/3528.feature\nnew file mode 100644\nindex 0000000000..6b0488bd07\n--- /dev/null\n+++ b/news/3528.feature\n@@ -0,0 +1,2 @@\n+Show link to the Volto-migration (@@migrate_to_volto) in the view @@plone-upgrade when the option is available.\n+[pbauer]\n\\ No newline at end of file\n'

