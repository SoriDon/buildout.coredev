Repository: five.intid


Branch: refs/heads/master
Date: 2019-05-24T11:02:49+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/five.intid/commit/4751fd65d50dfb73087bc195e0874486cb9eb356

Catch KeyError when traversing to fix creating relations during Copy&amp;Paste in Zope 4
Fixes https://github.com/plone/Products.CMFPlone/issues/2866

Files changed:
A news/12.bugfix
M five/intid/keyreference.py

b'diff --git a/five/intid/keyreference.py b/five/intid/keyreference.py\nindex 46e9f02..9da2f4a 100644\n--- a/five/intid/keyreference.py\n+++ b/five/intid/keyreference.py\n@@ -110,7 +110,7 @@ def wrapped_object(self):\n             return self.object\n         try:\n             obj = self.root.unrestrictedTraverse(self.path)\n-        except (NotFound, AttributeError,):\n+        except (NotFound, AttributeError, KeyError):\n             return self.object\n         chain = aq_chain(obj)\n         # Try to ensure we have a request at the acquisition root\ndiff --git a/news/12.bugfix b/news/12.bugfix\nnew file mode 100644\nindex 0000000..4fdceee\n--- /dev/null\n+++ b/news/12.bugfix\n@@ -0,0 +1,3 @@\n+Also catch KeyError when traversing to fix creating relations during Copy&Paste in Zope 4.\n+Fixes https://github.com/plone/Products.CMFPlone/issues/2866\n+[pbauer]\n\\ No newline at end of file\n'

Repository: five.intid


Branch: refs/heads/master
Date: 2019-05-24T12:51:48+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/five.intid/commit/80c9d1f23192fcc8879a0d776826cdc0eed7428e

implement suggestion by ale-rt

Files changed:
M five/intid/keyreference.py

b'diff --git a/five/intid/keyreference.py b/five/intid/keyreference.py\nindex 9da2f4a..f623565 100644\n--- a/five/intid/keyreference.py\n+++ b/five/intid/keyreference.py\n@@ -108,9 +108,8 @@ def root(self):\n     def wrapped_object(self):\n         if self.path is None:\n             return self.object\n-        try:\n-            obj = self.root.unrestrictedTraverse(self.path)\n-        except (NotFound, AttributeError, KeyError):\n+        obj = self.root.unrestrictedTraverse(self.path, None)\n+        if obj is None:\n             return self.object\n         chain = aq_chain(obj)\n         # Try to ensure we have a request at the acquisition root\n'

Repository: five.intid


Branch: refs/heads/master
Date: 2019-06-19T11:05:15+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/five.intid/commit/06805c0dddfc5fc7d990f1e4aeb9d3627990e11a

Merge pull request #12 from plone/fix_copy_paste

Catch KeyError when traversing to fix creating relations during Copy&amp;Paste in Zope 4

Files changed:
A news/12.bugfix
M five/intid/keyreference.py

b'diff --git a/five/intid/keyreference.py b/five/intid/keyreference.py\nindex 46e9f02..f623565 100644\n--- a/five/intid/keyreference.py\n+++ b/five/intid/keyreference.py\n@@ -108,9 +108,8 @@ def root(self):\n     def wrapped_object(self):\n         if self.path is None:\n             return self.object\n-        try:\n-            obj = self.root.unrestrictedTraverse(self.path)\n-        except (NotFound, AttributeError,):\n+        obj = self.root.unrestrictedTraverse(self.path, None)\n+        if obj is None:\n             return self.object\n         chain = aq_chain(obj)\n         # Try to ensure we have a request at the acquisition root\ndiff --git a/news/12.bugfix b/news/12.bugfix\nnew file mode 100644\nindex 0000000..4fdceee\n--- /dev/null\n+++ b/news/12.bugfix\n@@ -0,0 +1,3 @@\n+Also catch KeyError when traversing to fix creating relations during Copy&Paste in Zope 4.\n+Fixes https://github.com/plone/Products.CMFPlone/issues/2866\n+[pbauer]\n\\ No newline at end of file\n'

