Repository: plone.app.discussion


Branch: refs/heads/master
Date: 2022-05-10T21:32:46+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.discussion/commit/245a2d9be32be275b86642a8dd6c32f553469d18

Grant Site Administrators the same workflow permissions as Managers.

They were missing permissions on pending comments.
Fixes https://github.com/plone/plone.app.discussion/issues/199

Files changed:
A news/199.bugfix
M plone/app/discussion/profiles/default/metadata.xml
M plone/app/discussion/profiles/default/workflows/comment_review_workflow/definition.xml
M plone/app/discussion/upgrades.zcml

b'diff --git a/news/199.bugfix b/news/199.bugfix\nnew file mode 100644\nindex 00000000..4d0dd3ef\n--- /dev/null\n+++ b/news/199.bugfix\n@@ -0,0 +1,3 @@\n+Grant Site Administrators the same workflow permissions as Managers.\n+They were missing permissions on pending comments.\n+[maurits]\ndiff --git a/plone/app/discussion/profiles/default/metadata.xml b/plone/app/discussion/profiles/default/metadata.xml\nindex 57deab7e..c5a929bb 100644\n--- a/plone/app/discussion/profiles/default/metadata.xml\n+++ b/plone/app/discussion/profiles/default/metadata.xml\n@@ -1,5 +1,5 @@\n <metadata>\n- <version>1004</version>\n+ <version>1005</version>\n  <dependencies>\n   <dependency>profile-plone.resource:default</dependency>\n   <dependency>profile-plone.app.registry:default</dependency>\ndiff --git a/plone/app/discussion/profiles/default/workflows/comment_review_workflow/definition.xml b/plone/app/discussion/profiles/default/workflows/comment_review_workflow/definition.xml\nindex af19e9e3..439fdb60 100644\n--- a/plone/app/discussion/profiles/default/workflows/comment_review_workflow/definition.xml\n+++ b/plone/app/discussion/profiles/default/workflows/comment_review_workflow/definition.xml\n@@ -20,11 +20,13 @@\n                      <permission-role>Manager</permission-role>\n                      <permission-role>Owner</permission-role>\n                      <permission-role>Reviewer</permission-role>\n+                     <permission-role>Site Administrator</permission-role>\n                  </permission-map>\n                  <permission-map name="Modify portal content" acquired="False">\n                      <permission-role>Manager</permission-role>\n                      <permission-role>Owner</permission-role>\n                      <permission-role>Reviewer</permission-role>\n+                     <permission-role>Site Administrator</permission-role>\n                  </permission-map>\n                  <permission-map name="Reply to item" acquired="False">\n                  </permission-map>\n@@ -32,6 +34,7 @@\n                      <permission-role>Manager</permission-role>\n                      <permission-role>Owner</permission-role>\n                      <permission-role>Reviewer</permission-role>\n+                     <permission-role>Site Administrator</permission-role>\n                  </permission-map>\n              </state>\n              <state state_id="published" title="Published">\n@@ -43,6 +46,7 @@\n                  </permission-map>\n                  <permission-map name="Modify portal content" acquired="False">\n                      <permission-role>Manager</permission-role>\n+                     <permission-role>Site Administrator</permission-role>\n                  </permission-map>\n                  <permission-map name="Reply to item" acquired="True">\n                  </permission-map>\ndiff --git a/plone/app/discussion/upgrades.zcml b/plone/app/discussion/upgrades.zcml\nindex 5ab5da53..5bd6e864 100644\n--- a/plone/app/discussion/upgrades.zcml\n+++ b/plone/app/discussion/upgrades.zcml\n@@ -87,6 +87,12 @@\n       title="Add \'View comments\' permission"\n       import_steps="rolemap" />\n \n-\n+  <genericsetup:upgradeStep\n+      source="1004"\n+      destination="1005"\n+      profile="plone.app.discussion:default"\n+      title="Grant Site Administrator permissions on pending comments"\n+      handler=".upgrades.upgrade_comment_workflows"\n+      />\n \n </configure>\n'

Repository: plone.app.discussion


Branch: refs/heads/master
Date: 2022-05-10T21:36:50+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.discussion/commit/1ea81e4a90fc16c49029acdf38bb6db57858c660

Increase metadata version to 2000.

We need to leave some room for another upgrade step in Plone 5.2.

Files changed:
M plone/app/discussion/profiles/default/metadata.xml
M plone/app/discussion/upgrades.zcml

b'diff --git a/plone/app/discussion/profiles/default/metadata.xml b/plone/app/discussion/profiles/default/metadata.xml\nindex c5a929bb..141a440c 100644\n--- a/plone/app/discussion/profiles/default/metadata.xml\n+++ b/plone/app/discussion/profiles/default/metadata.xml\n@@ -1,5 +1,5 @@\n <metadata>\n- <version>1005</version>\n+ <version>2000</version>\n  <dependencies>\n   <dependency>profile-plone.resource:default</dependency>\n   <dependency>profile-plone.app.registry:default</dependency>\ndiff --git a/plone/app/discussion/upgrades.zcml b/plone/app/discussion/upgrades.zcml\nindex 5bd6e864..20b288e0 100644\n--- a/plone/app/discussion/upgrades.zcml\n+++ b/plone/app/discussion/upgrades.zcml\n@@ -73,26 +73,19 @@\n         />\n   </genericsetup:upgradeSteps>\n \n-  <genericsetup:upgradeDepends\n-      source="1002"\n-      destination="1003"\n-      profile="plone.app.discussion:default"\n-      title="Update controlpanel icon"\n-      import_steps="controlpanel" />\n-\n+  <genericsetup:upgradeSteps\n+      source="1999"\n+      destination="2000"\n+      profile="plone.app.discussion:default">\n     <genericsetup:upgradeDepends\n-      source="1003"\n-      destination="1004"\n-      profile="plone.app.discussion:default"\n-      title="Add \'View comments\' permission"\n-      import_steps="rolemap" />\n-\n-  <genericsetup:upgradeStep\n-      source="1004"\n-      destination="1005"\n-      profile="plone.app.discussion:default"\n-      title="Grant Site Administrator permissions on pending comments"\n-      handler=".upgrades.upgrade_comment_workflows"\n-      />\n+        title="Update controlpanel icon"\n+        import_steps="controlpanel" />\n+    <genericsetup:upgradeDepends\n+        title="Add \'View comments\' permission"\n+        import_steps="rolemap" />\n+    <genericsetup:upgradeStep\n+        title="Grant Site Administrator permissions on pending comments"\n+        handler=".upgrades.upgrade_comment_workflows" />\n+  </genericsetup:upgradeSteps>\n \n </configure>\n'

Repository: plone.app.discussion


Branch: refs/heads/master
Date: 2022-05-11T01:51:34+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.discussion/commit/0439e9ea24187ffc55a948a05eac7f446d618beb

Merge pull request #200 from plone/maurits-site-administrators-master

Grant Site Administrators same workflow permissions as Managers [master]

Files changed:
A news/199.bugfix
M plone/app/discussion/profiles/default/metadata.xml
M plone/app/discussion/profiles/default/workflows/comment_review_workflow/definition.xml
M plone/app/discussion/upgrades.zcml

b'diff --git a/news/199.bugfix b/news/199.bugfix\nnew file mode 100644\nindex 00000000..4d0dd3ef\n--- /dev/null\n+++ b/news/199.bugfix\n@@ -0,0 +1,3 @@\n+Grant Site Administrators the same workflow permissions as Managers.\n+They were missing permissions on pending comments.\n+[maurits]\ndiff --git a/plone/app/discussion/profiles/default/metadata.xml b/plone/app/discussion/profiles/default/metadata.xml\nindex 57deab7e..141a440c 100644\n--- a/plone/app/discussion/profiles/default/metadata.xml\n+++ b/plone/app/discussion/profiles/default/metadata.xml\n@@ -1,5 +1,5 @@\n <metadata>\n- <version>1004</version>\n+ <version>2000</version>\n  <dependencies>\n   <dependency>profile-plone.resource:default</dependency>\n   <dependency>profile-plone.app.registry:default</dependency>\ndiff --git a/plone/app/discussion/profiles/default/workflows/comment_review_workflow/definition.xml b/plone/app/discussion/profiles/default/workflows/comment_review_workflow/definition.xml\nindex af19e9e3..439fdb60 100644\n--- a/plone/app/discussion/profiles/default/workflows/comment_review_workflow/definition.xml\n+++ b/plone/app/discussion/profiles/default/workflows/comment_review_workflow/definition.xml\n@@ -20,11 +20,13 @@\n                      <permission-role>Manager</permission-role>\n                      <permission-role>Owner</permission-role>\n                      <permission-role>Reviewer</permission-role>\n+                     <permission-role>Site Administrator</permission-role>\n                  </permission-map>\n                  <permission-map name="Modify portal content" acquired="False">\n                      <permission-role>Manager</permission-role>\n                      <permission-role>Owner</permission-role>\n                      <permission-role>Reviewer</permission-role>\n+                     <permission-role>Site Administrator</permission-role>\n                  </permission-map>\n                  <permission-map name="Reply to item" acquired="False">\n                  </permission-map>\n@@ -32,6 +34,7 @@\n                      <permission-role>Manager</permission-role>\n                      <permission-role>Owner</permission-role>\n                      <permission-role>Reviewer</permission-role>\n+                     <permission-role>Site Administrator</permission-role>\n                  </permission-map>\n              </state>\n              <state state_id="published" title="Published">\n@@ -43,6 +46,7 @@\n                  </permission-map>\n                  <permission-map name="Modify portal content" acquired="False">\n                      <permission-role>Manager</permission-role>\n+                     <permission-role>Site Administrator</permission-role>\n                  </permission-map>\n                  <permission-map name="Reply to item" acquired="True">\n                  </permission-map>\ndiff --git a/plone/app/discussion/upgrades.zcml b/plone/app/discussion/upgrades.zcml\nindex 5ab5da53..20b288e0 100644\n--- a/plone/app/discussion/upgrades.zcml\n+++ b/plone/app/discussion/upgrades.zcml\n@@ -73,20 +73,19 @@\n         />\n   </genericsetup:upgradeSteps>\n \n-  <genericsetup:upgradeDepends\n-      source="1002"\n-      destination="1003"\n-      profile="plone.app.discussion:default"\n-      title="Update controlpanel icon"\n-      import_steps="controlpanel" />\n-\n+  <genericsetup:upgradeSteps\n+      source="1999"\n+      destination="2000"\n+      profile="plone.app.discussion:default">\n     <genericsetup:upgradeDepends\n-      source="1003"\n-      destination="1004"\n-      profile="plone.app.discussion:default"\n-      title="Add \'View comments\' permission"\n-      import_steps="rolemap" />\n-\n-\n+        title="Update controlpanel icon"\n+        import_steps="controlpanel" />\n+    <genericsetup:upgradeDepends\n+        title="Add \'View comments\' permission"\n+        import_steps="rolemap" />\n+    <genericsetup:upgradeStep\n+        title="Grant Site Administrator permissions on pending comments"\n+        handler=".upgrades.upgrade_comment_workflows" />\n+  </genericsetup:upgradeSteps>\n \n </configure>\n'

