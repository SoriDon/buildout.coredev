Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2019-05-06T16:39:50-05:00
Author: Jens Vagelpohl (dataflake) <jens@mineralware.com>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/1b1971b55d22361085e1bdbfc4c255d85f8385cb

Try to look up a suitable log file for the ``logtail`` verb (fixes #85)

Files changed:
M buildout.cfg
M src/plone/recipe/zope2instance/ctl.py

b"diff --git a/buildout.cfg b/buildout.cfg\nindex bcc8f23..b1753f6 100644\n--- a/buildout.cfg\n+++ b/buildout.cfg\n@@ -3,8 +3,12 @@ index = https://pypi.python.org/simple/\n extends = https://zopefoundation.github.io/Zope/releases/master/versions-prod.cfg\n versions = versions\n develop = .\n-parts = test\n+parts = test tox\n \n [test]\n recipe = zc.recipe.testrunner\n eggs = plone.recipe.zope2instance\n+\n+[tox]\n+recipe = zc.recipe.egg\n+eggs = tox\ndiff --git a/src/plone/recipe/zope2instance/ctl.py b/src/plone/recipe/zope2instance/ctl.py\nindex dc39944..af4422f 100644\n--- a/src/plone/recipe/zope2instance/ctl.py\n+++ b/src/plone/recipe/zope2instance/ctl.py\n@@ -35,6 +35,7 @@\n from zdaemon.zdoptions import ZDOptions\n from Zope2.Startup.options import ConditionalSchemaParser\n import csv\n+import logging\n import os\n import os.path\n import pkg_resources\n@@ -959,6 +960,23 @@ def main(args=None):\n             options.python, options.interpreter, script, options.wsgi\n         ]\n \n+        # Try to find the log file from the WSGI configuration\n+        # Requires loading the logging configuration from the WSGI config\n+        try:\n+            logging.config.fileConfig(options.wsgi)\n+\n+            # The root logger is the only one we can identify and get\n+            # reliably as we cannot know what the other loggers' names are\n+            root_logger = logging.getLogger()\n+\n+            for handler in root_logger.handlers:\n+                # Try to find a FileHandler and (ab)use its file target\n+                if isinstance(handler, logging.FileHandler):\n+                    options.logfile = handler.baseFilename\n+                    break\n+        except Exception:\n+            pass  # Give up\n+\n     c = ZopeCmd(options)\n \n     # Mix in any additional commands supplied by other packages:\n"

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2019-05-06T16:43:55-05:00
Author: Jens Vagelpohl (dataflake) <jens@mineralware.com>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/c39943e2ea34ca8569b9792276ee1b249963532b

- change log entry

Files changed:
A news/85.bugfix

b'diff --git a/news/85.bugfix b/news/85.bugfix\nnew file mode 100644\nindex 0000000..67dbeb4\n--- /dev/null\n+++ b/news/85.bugfix\n@@ -0,0 +1 @@\n+Try to look up a suitable log file for the ``logtail`` verb\n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2019-05-06T16:44:44-05:00
Author: Jens Vagelpohl (dataflake) <jens@mineralware.com>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/62f7bf178782ae850e7275ba7e882078f0b468a8

- remove inadvertent checkin

Files changed:
M buildout.cfg

b'diff --git a/buildout.cfg b/buildout.cfg\nindex b1753f6..bcc8f23 100644\n--- a/buildout.cfg\n+++ b/buildout.cfg\n@@ -3,12 +3,8 @@ index = https://pypi.python.org/simple/\n extends = https://zopefoundation.github.io/Zope/releases/master/versions-prod.cfg\n versions = versions\n develop = .\n-parts = test tox\n+parts = test\n \n [test]\n recipe = zc.recipe.testrunner\n eggs = plone.recipe.zope2instance\n-\n-[tox]\n-recipe = zc.recipe.egg\n-eggs = tox\n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2019-05-10T13:00:49+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/e539531ef4723d1162a8aa8efe193c4482978d15

Merge pull request #104 from plone/issue_85

Try to look up a suitable log file for the ``logtail`` verb

Files changed:
A news/85.bugfix
M src/plone/recipe/zope2instance/ctl.py

b"diff --git a/news/85.bugfix b/news/85.bugfix\nnew file mode 100644\nindex 0000000..67dbeb4\n--- /dev/null\n+++ b/news/85.bugfix\n@@ -0,0 +1 @@\n+Try to look up a suitable log file for the ``logtail`` verb\ndiff --git a/src/plone/recipe/zope2instance/ctl.py b/src/plone/recipe/zope2instance/ctl.py\nindex 9c326c6..0782e9f 100644\n--- a/src/plone/recipe/zope2instance/ctl.py\n+++ b/src/plone/recipe/zope2instance/ctl.py\n@@ -35,6 +35,7 @@\n from zdaemon.zdoptions import ZDOptions\n from Zope2.Startup.options import ConditionalSchemaParser\n import csv\n+import logging\n import os\n import os.path\n import pkg_resources\n@@ -967,6 +968,23 @@ def main(args=None):\n             options.python, options.interpreter, script, options.wsgi\n         ]\n \n+        # Try to find the log file from the WSGI configuration\n+        # Requires loading the logging configuration from the WSGI config\n+        try:\n+            logging.config.fileConfig(options.wsgi)\n+\n+            # The root logger is the only one we can identify and get\n+            # reliably as we cannot know what the other loggers' names are\n+            root_logger = logging.getLogger()\n+\n+            for handler in root_logger.handlers:\n+                # Try to find a FileHandler and (ab)use its file target\n+                if isinstance(handler, logging.FileHandler):\n+                    options.logfile = handler.baseFilename\n+                    break\n+        except Exception:\n+            pass  # Give up\n+\n     c = ZopeCmd(options)\n \n     # Mix in any additional commands supplied by other packages:\n"

