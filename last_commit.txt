Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-09-25T07:16:29+02:00
Author: Timo Stollenwerk (tisto) <tisto@users.noreply.github.com>
Commit: https://github.com/plone/plone.restapi/commit/9c8c546c590dd0ebabb3f8146dc45bf30fefc6cc

Rename ci.yml -&gt; tests.yml. Enable zpretty check on gh actions (#1224)

* Rename ci.yml -&gt; tests.yml. Enable zpretty check on gh actions

* Add zpretty-run, fix zpretty issues

Files changed:
M .github/workflows/flake8.yml
M .github/workflows/zpretty.yml
M base.cfg
M src/plone/restapi/services/configure.zcml

b'diff --git a/.github/workflows/flake8.yml b/.github/workflows/flake8.yml\nindex 97c7dfa40..73f73f091 100644\n--- a/.github/workflows/flake8.yml\n+++ b/.github/workflows/flake8.yml\n@@ -1,4 +1,4 @@\n-name: Flake8\n+name: Flake 8\n on: [push]\n jobs:\n   build:\ndiff --git a/.github/workflows/zpretty.yml b/.github/workflows/zpretty.yml\nindex a32990122..ef53ff490 100644\n--- a/.github/workflows/zpretty.yml\n+++ b/.github/workflows/zpretty.yml\n@@ -34,7 +34,6 @@ jobs:\n       - name: run zpretty\n         run: find src/ -name *.zcml | xargs zpretty -i\n \n-      # XXX: this doesn\'t work on gh actions (https://github.com/plone/plone.restapi/pull/1119/checks?check_run_id=2686474411)\n-      # # run git diff\n-      # - name: run git diff\n-      #   run: git diff --exit-code\n+      # run git diff\n+      - name: run git diff\n+        run: git diff --exit-code\ndiff --git a/base.cfg b/base.cfg\nindex d7bf7c8f4..75e631dc7 100644\n--- a/base.cfg\n+++ b/base.cfg\n@@ -16,6 +16,7 @@ parts =\n     sphinx-python\n     deploy-to-heroku\n     omelette\n+    zpretty\n develop = .\n sources-dir = extras\n auto-checkout =\n@@ -67,7 +68,7 @@ recipe = zc.recipe.testrunner\n eggs = ${instance:eggs}\n initialization =\n     os.environ[\'TZ\'] = \'UTC\'\n-    # In Python 3.8+, for the TZ environment variable to be used, it\'s \n+    # In Python 3.8+, for the TZ environment variable to be used, it\'s\n     # necessary to explicitly call time.tzset().\n     import time\n     time.tzset()\n@@ -195,6 +196,14 @@ mode = 755\n recipe = collective.recipe.omelette\n eggs = ${instance:eggs}\n \n+[zpretty]\n+recipe = collective.recipe.template\n+input = inline:\n+    #!/bin/bash\n+    find src -name \'*.zcml\' | xargs bin/zpretty -i\n+output = ${buildout:directory}/bin/zpretty-run\n+mode = 755\n+\n [sources]\n plone.rest = git git://github.com/plone/plone.rest.git pushurl=git@github.com:plone/plone.rest.git branch=master\n plone.schema = git git://github.com/plone/plone.schema.git pushurl=git@github.com:plone/plone.schema.git branch=newjsonschemafield\ndiff --git a/src/plone/restapi/services/configure.zcml b/src/plone/restapi/services/configure.zcml\nindex 283c150fd..7c9287335 100644\n--- a/src/plone/restapi/services/configure.zcml\n+++ b/src/plone/restapi/services/configure.zcml\n@@ -23,19 +23,19 @@\n   <include package=".contextnavigation" />\n   <include package=".history" />\n   <include package=".locking" />\n-  <include package=".principals"/>\n-  <include package=".querysources"/>\n-  <include package=".querystring"/>\n-  <include package=".querystringsearch"/>\n-  <include package=".registry"/>\n-  <include package=".roles"/>\n-  <include package=".search"/>\n-  <include package=".system"/>\n-  <include package=".sources"/>\n-  <include package=".types"/>\n-  <include package=".users"/>\n-  <include package=".vocabularies"/>\n-  <include package=".workflow"/>\n+  <include package=".principals" />\n+  <include package=".querysources" />\n+  <include package=".querystring" />\n+  <include package=".querystringsearch" />\n+  <include package=".registry" />\n+  <include package=".roles" />\n+  <include package=".search" />\n+  <include package=".system" />\n+  <include package=".sources" />\n+  <include package=".types" />\n+  <include package=".users" />\n+  <include package=".vocabularies" />\n+  <include package=".workflow" />\n   <include\n       package=".workingcopy"\n       zcml:condition="have plone-5"\n'

