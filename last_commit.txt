Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-06-06T11:10:42+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/ad995a7ad11f0c0ba98c81fe75cac8ac99004e7f

Added publishing patch from Products.PloneHotfix20160419.

This avoids publishing some methods inherited from Zope or CMF.

Files changed:
A Products/CMFPlone/patches/publishing.py
M CHANGES.rst
M Products/CMFPlone/patches/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d152580..13acad4 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -38,6 +38,9 @@ New features:
 
 Bug fixes:
 
+- Added publishing patch from Products.PloneHotfix20160419.
+  This avoids publishing some methods inherited from Zope or CMF.  [maurits]
+
 - Remove whitespaces in ``Products/CMFPlone/browser/templates/plone-frontpage.pt``.
   [svx]
 
diff --git a/Products/CMFPlone/patches/__init__.py b/Products/CMFPlone/patches/__init__.py
index 30becca..ec14a45 100644
--- a/Products/CMFPlone/patches/__init__.py
+++ b/Products/CMFPlone/patches/__init__.py
@@ -27,3 +27,5 @@
 
 import templatecookcheck        # Make sure templates aren't re-read in
 # production sites
+
+import publishing
diff --git a/Products/CMFPlone/patches/publishing.py b/Products/CMFPlone/patches/publishing.py
new file mode 100644
index 0000000..3eae7e0
--- /dev/null
+++ b/Products/CMFPlone/patches/publishing.py
@@ -0,0 +1,64 @@
+# From Products.PloneHotfix20160419
+from OFS.ZDOM import Document
+from OFS.ZDOM import Node
+from Products.CMFPlone.Portal import PloneSite
+
+
+try:
+    from plone.dexterity.content import Item
+    from plone.dexterity.content import Container
+except ImportError:
+    class Item(object):
+        pass
+
+    class Container(object):
+        pass
+
+try:
+    from Products.ATContentTypes.content.base import ATCTContent
+    from Products.ATContentTypes.content.base import ATCTBTreeFolder
+except ImportError:
+
+    class ATCTContent(object):
+        pass
+
+    class ATCTBTreeFolder(object):
+        pass
+
+
+klasses = (
+    Node,
+    Document,
+    PloneSite,
+    Item,
+    Container,
+    ATCTContent,
+    ATCTBTreeFolder
+)
+methods = (
+    'EffectiveDate',
+    'ExpirationDate',
+    'getAttributes',
+    'getChildNodes',
+    'getFirstChild',
+    'getLastChild',
+    'getLayout',
+    'getNextSibling',
+    'getNodeName',
+    'getNodeType',
+    'getNodeValue',
+    'getOwnerDocument',
+    'getParentNode',
+    'getPhysicalPath',
+    'getPreviousSibling',
+    'getTagName',
+    'hasChildNodes',
+    'Type'
+)
+
+for klass in klasses:
+    for method_name in methods:
+        method = getattr(klass, method_name, None)
+        if (method is not None and hasattr(method, 'im_func') and
+                hasattr(method.im_func, '__doc__')):
+            del method.im_func.__doc__


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-06-06T20:53:17+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/fc832fbe4f8594c55383495a5b29fd70c436369d

Merge pull request #1626 from plone/maurits-hotfix-20160419-zope-cmf-master

Added publishing patch from Products.PloneHotfix20160419. [master]

Files changed:
A Products/CMFPlone/patches/publishing.py
M CHANGES.rst
M Products/CMFPlone/patches/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d152580..13acad4 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -38,6 +38,9 @@ New features:
 
 Bug fixes:
 
+- Added publishing patch from Products.PloneHotfix20160419.
+  This avoids publishing some methods inherited from Zope or CMF.  [maurits]
+
 - Remove whitespaces in ``Products/CMFPlone/browser/templates/plone-frontpage.pt``.
   [svx]
 
diff --git a/Products/CMFPlone/patches/__init__.py b/Products/CMFPlone/patches/__init__.py
index 30becca..ec14a45 100644
--- a/Products/CMFPlone/patches/__init__.py
+++ b/Products/CMFPlone/patches/__init__.py
@@ -27,3 +27,5 @@
 
 import templatecookcheck        # Make sure templates aren't re-read in
 # production sites
+
+import publishing
diff --git a/Products/CMFPlone/patches/publishing.py b/Products/CMFPlone/patches/publishing.py
new file mode 100644
index 0000000..3eae7e0
--- /dev/null
+++ b/Products/CMFPlone/patches/publishing.py
@@ -0,0 +1,64 @@
+# From Products.PloneHotfix20160419
+from OFS.ZDOM import Document
+from OFS.ZDOM import Node
+from Products.CMFPlone.Portal import PloneSite
+
+
+try:
+    from plone.dexterity.content import Item
+    from plone.dexterity.content import Container
+except ImportError:
+    class Item(object):
+        pass
+
+    class Container(object):
+        pass
+
+try:
+    from Products.ATContentTypes.content.base import ATCTContent
+    from Products.ATContentTypes.content.base import ATCTBTreeFolder
+except ImportError:
+
+    class ATCTContent(object):
+        pass
+
+    class ATCTBTreeFolder(object):
+        pass
+
+
+klasses = (
+    Node,
+    Document,
+    PloneSite,
+    Item,
+    Container,
+    ATCTContent,
+    ATCTBTreeFolder
+)
+methods = (
+    'EffectiveDate',
+    'ExpirationDate',
+    'getAttributes',
+    'getChildNodes',
+    'getFirstChild',
+    'getLastChild',
+    'getLayout',
+    'getNextSibling',
+    'getNodeName',
+    'getNodeType',
+    'getNodeValue',
+    'getOwnerDocument',
+    'getParentNode',
+    'getPhysicalPath',
+    'getPreviousSibling',
+    'getTagName',
+    'hasChildNodes',
+    'Type'
+)
+
+for klass in klasses:
+    for method_name in methods:
+        method = getattr(klass, method_name, None)
+        if (method is not None and hasattr(method, 'im_func') and
+                hasattr(method.im_func, '__doc__')):
+            del method.im_func.__doc__


