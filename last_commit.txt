Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-02-08T18:34:18+02:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.autoinclude/commit/41015d8e00133a2e4af04ce031f346ae88678be0

replace dash with lowdash in project_name

Files changed:
A news/16.bugfix
M src/plone/autoinclude/loader.py

b'diff --git a/news/16.bugfix b/news/16.bugfix\nnew file mode 100644\nindex 0000000..4680b4a\n--- /dev/null\n+++ b/news/16.bugfix\n@@ -0,0 +1 @@\n+Replace dash with lowdash in project_name, as Python Project are normally divided by dash and modul name uses lowdash [MrTango]\ndiff --git a/src/plone/autoinclude/loader.py b/src/plone/autoinclude/loader.py\nindex ae48635..b105234 100644\n--- a/src/plone/autoinclude/loader.py\n+++ b/src/plone/autoinclude/loader.py\n@@ -30,7 +30,7 @@ def load_z3c_packages(target=""):\n         # we can include it.\n         if target and ep.module_name != target:\n             continue\n-        module_name = ep.dist.project_name\n+        module_name = ep.dist.project_name.replace("-", "_")\n         if module_name not in _known_module_names:\n             try:\n                 dist = importlib.import_module(module_name)\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-02-08T18:47:12+02:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.autoinclude/commit/1738f5c231e9294ec6b7d3a6bd7ec463910c8915

add example.plone-dash-addon tst

Files changed:
A test-packages/example.plone-dash-addon/MANIFEST.in
A test-packages/example.plone-dash-addon/setup.py
A test-packages/example.plone-dash-addon/src/example/__init__.py
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/__init__.py
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/__init__.py
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/configure.zcml
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/permissions.zcml
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py

b'diff --git a/test-packages/example.plone-dash-addon/MANIFEST.in b/test-packages/example.plone-dash-addon/MANIFEST.in\nnew file mode 100644\nindex 0000000..46b2653\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/MANIFEST.in\n@@ -0,0 +1,2 @@\n+recursive-include src *.py\n+recursive-include src *.zcml\ndiff --git a/test-packages/example.plone-dash-addon/setup.py b/test-packages/example.plone-dash-addon/setup.py\nnew file mode 100644\nindex 0000000..4137ef8\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/setup.py\n@@ -0,0 +1,26 @@\n+# -*- coding: utf-8 -*-\n+from setuptools import find_packages\n+from setuptools import setup\n+\n+\n+setup(\n+    name="example.plone-dash-addon",\n+    version="1.0a1",\n+    description="An add-on for Plone",\n+    long_description="long_description",\n+    author="Maurits van Rees",\n+    author_email="m.van.rees@zestsoftware.nl",\n+    license="GPL version 2",\n+    packages=find_packages("src", exclude=["ez_setup"]),\n+    namespace_packages=["example"],\n+    package_dir={"": "src"},\n+    include_package_data=True,\n+    zip_safe=False,\n+    install_requires=[\n+        "setuptools",\n+    ],\n+    entry_points="""\n+    [z3c.autoinclude.plugin]\n+    target = plone\n+    """,\n+)\ndiff --git a/test-packages/example.plone-dash-addon/src/example/__init__.py b/test-packages/example.plone-dash-addon/src/example/__init__.py\nnew file mode 100644\nindex 0000000..03d08ff\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/__init__.py\n@@ -0,0 +1,2 @@\n+# -*- coding: utf-8 -*-\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/__init__.py b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/__init__.py\nnew file mode 100644\nindex 0000000..792d600\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/__init__.py\n@@ -0,0 +1 @@\n+#\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/__init__.py b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/__init__.py\nnew file mode 100644\nindex 0000000..e69de29\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/configure.zcml b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/configure.zcml\nnew file mode 100644\nindex 0000000..bc13ca5\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/configure.zcml\n@@ -0,0 +1,5 @@\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser">\n+\n+</configure>\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\nnew file mode 100644\nindex 0000000..9a0b516\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\n@@ -0,0 +1,20 @@\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n+    xmlns:i18n="http://namespaces.zope.org/i18n"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    i18n_domain="example.ploneaddon">\n+\n+  <!--\n+    Be careful if you use general includeDependencies, it can have side effects!\n+    Better import explicit packages or configurations ;)\n+  -->\n+  <!--<includeDependencies package="." />-->\n+\n+  <include package=".browser" />\n+\n+  <include file="permissions.zcml" />\n+\n+  <!-- FOR TESTS: This is configure.zcml from example.plone-dash-addon. -->\n+\n+</configure>\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/permissions.zcml b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/permissions.zcml\nnew file mode 100644\nindex 0000000..b61941c\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/permissions.zcml\n@@ -0,0 +1,4 @@\n+<configure\n+  xmlns="http://namespaces.zope.org/zope">\n+\n+</configure>\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\nnew file mode 100644\nindex 0000000..de3c844\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\n@@ -0,0 +1,11 @@\n+from example.basetestpackage.package_base import PackageTestCase\n+\n+import unittest\n+\n+\n+class TestPackage(PackageTestCase, unittest.TestCase):\n+    project_name = "example.plone-dash-addon"\n+    meta_files = []\n+    configure_files = ["configure.zcml", "permissions.zcml", "browser/configure.zcml"]\n+    overrides_files = []\n+    standard_z3c_autoinclude = True\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-02-08T19:53:43+02:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.autoinclude/commit/a93231dd1c33b7c754890741758502af2ddd8075

Add tests

Files changed:
M buildout.cfg
M src/plone/autoinclude/loader.py
M src/plone/autoinclude/tests/test_loader.py
M test-packages/example.plone-dash-addon/setup.py
M tox.ini

b'diff --git a/buildout.cfg b/buildout.cfg\nindex 8677651..ddf6112 100644\n--- a/buildout.cfg\n+++ b/buildout.cfg\n@@ -7,6 +7,7 @@ develop =\n     ../../test-packages/example.different\n     ../../test-packages/example.different2\n     ../../test-packages/example.metaoverrides\n+    ../../test-packages/example.plone-dash-addon\n     ../../test-packages/example.ploneaddon\n     ../../test-packages/example.ploneintegration\n     ../../test-packages/example.zopeaddon\ndiff --git a/src/plone/autoinclude/loader.py b/src/plone/autoinclude/loader.py\nindex b105234..134066c 100644\n--- a/src/plone/autoinclude/loader.py\n+++ b/src/plone/autoinclude/loader.py\n@@ -78,7 +78,7 @@ def load_own_packages(target=""):\n             if target and eps["target"].module_name != target:\n                 # entry point defines target X but we only want target Y.\n                 continue\n-            module_name = wsdist.project_name\n+            module_name = wsdist.project_name.replace("-", "_")\n         if "module" in eps:\n             # We could load the dist with ep.load(), but we do it differently.\n             module_name = eps["module"].module_name\ndiff --git a/src/plone/autoinclude/tests/test_loader.py b/src/plone/autoinclude/tests/test_loader.py\nindex 7fcf1a9..1ff9ffc 100644\n--- a/src/plone/autoinclude/tests/test_loader.py\n+++ b/src/plone/autoinclude/tests/test_loader.py\n@@ -61,11 +61,12 @@ def test_load_z3c_packages(self):\n             "example.multipleeps",\n         ]:\n             self.assertIn(package, packages.keys())\n+\n         package = packages["example.ploneaddon"]\n         import example.ploneaddon\n-\n         self.assertEqual(package, example.ploneaddon)\n \n+\n     def test_load_own_packages(self):\n         from plone.autoinclude.loader import load_own_packages\n \n@@ -73,13 +74,18 @@ def test_load_own_packages(self):\n         for package in [\n             "example.somethingelse2",\n             "example.multipleeps",\n+            "example.plone_dash_addon",\n         ]:\n             self.assertIn(package, packages.keys())\n         package = packages["example.somethingelse2"]\n         import example.somethingelse2\n-\n         self.assertEqual(package, example.somethingelse2)\n \n+        package = packages["example.plone_dash_addon"]\n+        import example.plone_dash_addon\n+        self.assertEqual(package, example.plone_dash_addon)\n+\n+\n     def test_get_zcml_file(self):\n         from plone.autoinclude.loader import get_zcml_file\n \ndiff --git a/test-packages/example.plone-dash-addon/setup.py b/test-packages/example.plone-dash-addon/setup.py\nindex 4137ef8..7f1f867 100644\n--- a/test-packages/example.plone-dash-addon/setup.py\n+++ b/test-packages/example.plone-dash-addon/setup.py\n@@ -20,7 +20,7 @@\n         "setuptools",\n     ],\n     entry_points="""\n-    [z3c.autoinclude.plugin]\n+    [plone.autoinclude.plugin]\n     target = plone\n     """,\n )\ndiff --git a/tox.ini b/tox.ini\nindex b052794..bb86d17 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -29,6 +29,7 @@ deps =\n     -e test-packages/example.different2\n     -e test-packages/example.metaoverrides\n     -e test-packages/example.ploneaddon\n+    -e test-packages/example.plone-dash-addon\n     -e test-packages/example.ploneintegration\n     -e test-packages/example.zopeaddon\n     -e test-packages/example.zopeintegration\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-02-08T20:49:45+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.autoinclude/commit/29834450693adf8b85dd0bc7726b4e4444c9c8a6

Update ploneintegration tests to include example.plone_dash_addon files.

Files changed:
M test-packages/example.ploneintegration/src/example/ploneintegration/tests.py

b'diff --git a/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py b/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py\nindex a61d332..eb0efce 100644\n--- a/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py\n+++ b/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py\n@@ -14,6 +14,11 @@ class TestIntegration(IntegrationTestCase, unittest.TestCase):\n     }\n     configure_files = {\n         "example.ploneintegration": ["configure.zcml"],\n+        "example.plone_dash_addon": [\n+            "configure.zcml",\n+            "permissions.zcml",\n+            "browser/configure.zcml",\n+        ],\n         "example.ploneaddon": [\n             "configure.zcml",\n             "permissions.zcml",\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-02-08T20:54:01+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.autoinclude/commit/56b5d87e710f36b25946fc3110818a8c391ecc9d

fix lint by running black

Files changed:
M src/plone/autoinclude/tests/test_loader.py

b'diff --git a/src/plone/autoinclude/tests/test_loader.py b/src/plone/autoinclude/tests/test_loader.py\nindex 1ff9ffc..8d10be1 100644\n--- a/src/plone/autoinclude/tests/test_loader.py\n+++ b/src/plone/autoinclude/tests/test_loader.py\n@@ -64,8 +64,8 @@ def test_load_z3c_packages(self):\n \n         package = packages["example.ploneaddon"]\n         import example.ploneaddon\n-        self.assertEqual(package, example.ploneaddon)\n \n+        self.assertEqual(package, example.ploneaddon)\n \n     def test_load_own_packages(self):\n         from plone.autoinclude.loader import load_own_packages\n@@ -79,12 +79,13 @@ def test_load_own_packages(self):\n             self.assertIn(package, packages.keys())\n         package = packages["example.somethingelse2"]\n         import example.somethingelse2\n+\n         self.assertEqual(package, example.somethingelse2)\n \n         package = packages["example.plone_dash_addon"]\n         import example.plone_dash_addon\n-        self.assertEqual(package, example.plone_dash_addon)\n \n+        self.assertEqual(package, example.plone_dash_addon)\n \n     def test_get_zcml_file(self):\n         from plone.autoinclude.loader import get_zcml_file\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-02-08T21:01:32+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.autoinclude/commit/a9dfdd2504f3fc26a5e24203194b4df468af50ff

Fixed buildout tests for example.plone-dash-addon.

Files changed:
M buildout.cfg
M test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml
M test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py

b'diff --git a/buildout.cfg b/buildout.cfg\nindex ddf6112..12bec50 100644\n--- a/buildout.cfg\n+++ b/buildout.cfg\n@@ -36,6 +36,7 @@ eggs =\n     example.different\n     example.different2\n     example.metaoverrides\n+    example.plone-dash-addon\n     example.ploneaddon\n     example.ploneintegration\n     example.zopeaddon\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\nindex 9a0b516..558aa27 100644\n--- a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\n@@ -15,6 +15,6 @@\n \n   <include file="permissions.zcml" />\n \n-  <!-- FOR TESTS: This is configure.zcml from example.plone-dash-addon. -->\n+  <!-- FOR TESTS: This is configure.zcml from example.plone_dash_addon. -->\n \n </configure>\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\nindex de3c844..9d319f7 100644\n--- a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\n@@ -4,7 +4,7 @@\n \n \n class TestPackage(PackageTestCase, unittest.TestCase):\n-    project_name = "example.plone-dash-addon"\n+    project_name = "example.plone_dash_addon"\n     meta_files = []\n     configure_files = ["configure.zcml", "permissions.zcml", "browser/configure.zcml"]\n     overrides_files = []\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-02-08T21:15:29+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.autoinclude/commit/30a4ad72d68a472805f73eb4a4d9ec28e18b186c

Add test-packages/ExampleCamelCase

I wondered if this would need to be handled as `examplecamelcase`, so all lowercase.
But it seems to work fine with camel case.

Files changed:
A test-packages/ExampleCamelCase/MANIFEST.in
A test-packages/ExampleCamelCase/setup.py
A test-packages/ExampleCamelCase/src/ExampleCamelCase/__init__.py
A test-packages/ExampleCamelCase/src/ExampleCamelCase/configure.zcml
A test-packages/ExampleCamelCase/src/ExampleCamelCase/tests.py
M buildout.cfg
M test-packages/example.ploneintegration/src/example/ploneintegration/tests.py
M tox.ini

b'diff --git a/buildout.cfg b/buildout.cfg\nindex 12bec50..ace6e25 100644\n--- a/buildout.cfg\n+++ b/buildout.cfg\n@@ -13,6 +13,7 @@ develop =\n     ../../test-packages/example.zopeaddon\n     ../../test-packages/example.zopeintegration\n     ../../test-packages/example.multipleeps\n+    ../../test-packages/ExampleCamelCase\n     ../../test-packages/namespaceexample.native\n     ../../test-packages/namespaceexample.pkgutilns\n parts =\n@@ -42,5 +43,6 @@ eggs =\n     example.zopeaddon\n     example.zopeintegration\n     example.multipleeps\n+    ExampleCamelCase\n     namespaceexample.native\n     namespaceexample.pkgutilns\ndiff --git a/test-packages/ExampleCamelCase/MANIFEST.in b/test-packages/ExampleCamelCase/MANIFEST.in\nnew file mode 100644\nindex 0000000..46b2653\n--- /dev/null\n+++ b/test-packages/ExampleCamelCase/MANIFEST.in\n@@ -0,0 +1,2 @@\n+recursive-include src *.py\n+recursive-include src *.zcml\ndiff --git a/test-packages/ExampleCamelCase/setup.py b/test-packages/ExampleCamelCase/setup.py\nnew file mode 100644\nindex 0000000..a2d9da3\n--- /dev/null\n+++ b/test-packages/ExampleCamelCase/setup.py\n@@ -0,0 +1,25 @@\n+# -*- coding: utf-8 -*-\n+from setuptools import find_packages\n+from setuptools import setup\n+\n+\n+setup(\n+    name="ExampleCamelCase",\n+    version="1.0a1",\n+    description="An add-on for Plone",\n+    long_description="long_description",\n+    author="Maurits van Rees",\n+    author_email="m.van.rees@zestsoftware.nl",\n+    license="GPL version 2",\n+    packages=find_packages("src", exclude=["ez_setup"]),\n+    package_dir={"": "src"},\n+    include_package_data=True,\n+    zip_safe=False,\n+    install_requires=[\n+        "setuptools",\n+    ],\n+    entry_points="""\n+    [z3c.autoinclude.plugin]\n+    target = plone\n+    """,\n+)\ndiff --git a/test-packages/ExampleCamelCase/src/ExampleCamelCase/__init__.py b/test-packages/ExampleCamelCase/src/ExampleCamelCase/__init__.py\nnew file mode 100644\nindex 0000000..792d600\n--- /dev/null\n+++ b/test-packages/ExampleCamelCase/src/ExampleCamelCase/__init__.py\n@@ -0,0 +1 @@\n+#\ndiff --git a/test-packages/ExampleCamelCase/src/ExampleCamelCase/configure.zcml b/test-packages/ExampleCamelCase/src/ExampleCamelCase/configure.zcml\nnew file mode 100644\nindex 0000000..ee31a9d\n--- /dev/null\n+++ b/test-packages/ExampleCamelCase/src/ExampleCamelCase/configure.zcml\n@@ -0,0 +1,10 @@\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n+    xmlns:i18n="http://namespaces.zope.org/i18n"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    i18n_domain="ExampleCamelCase">\n+\n+  <!-- FOR TESTS: This is configure.zcml from ExampleCamelCase. -->\n+\n+</configure>\ndiff --git a/test-packages/ExampleCamelCase/src/ExampleCamelCase/tests.py b/test-packages/ExampleCamelCase/src/ExampleCamelCase/tests.py\nnew file mode 100644\nindex 0000000..a16a408\n--- /dev/null\n+++ b/test-packages/ExampleCamelCase/src/ExampleCamelCase/tests.py\n@@ -0,0 +1,11 @@\n+from example.basetestpackage.package_base import PackageTestCase\n+\n+import unittest\n+\n+\n+class TestPackage(PackageTestCase, unittest.TestCase):\n+    project_name = "ExampleCamelCase"\n+    meta_files = []\n+    configure_files = ["configure.zcml"]\n+    overrides_files = []\n+    standard_z3c_autoinclude = True\ndiff --git a/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py b/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py\nindex eb0efce..5665a9e 100644\n--- a/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py\n+++ b/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py\n@@ -14,6 +14,7 @@ class TestIntegration(IntegrationTestCase, unittest.TestCase):\n     }\n     configure_files = {\n         "example.ploneintegration": ["configure.zcml"],\n+        "ExampleCamelCase": ["configure.zcml"],\n         "example.plone_dash_addon": [\n             "configure.zcml",\n             "permissions.zcml",\ndiff --git a/tox.ini b/tox.ini\nindex bb86d17..dd99932 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -34,6 +34,7 @@ deps =\n     -e test-packages/example.zopeaddon\n     -e test-packages/example.zopeintegration\n     -e test-packages/example.multipleeps\n+    -e test-packages/ExampleCamelCase\n     -e test-packages/namespaceexample.native\n     -e test-packages/namespaceexample.pkgutilns\n # extras =\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-02-08T21:23:01+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.autoinclude/commit/700c1f05fe4ce3e5e87e487a25ba892f21aca3e6

GHA: only test main branch on push.

Other branches will be tested when they have a pull request.
On https://github.com/plone/plone.autoinclude/pull/16 I saw 34 GitHub Actions tests,
half of them for the PR, and half for a push to the branch.
That is wasteful.

Files changed:
M .github/workflows/tests.yml

b"diff --git a/.github/workflows/tests.yml b/.github/workflows/tests.yml\nindex ad2e11a..a3db986 100644\n--- a/.github/workflows/tests.yml\n+++ b/.github/workflows/tests.yml\n@@ -4,6 +4,8 @@ name: tests\n \n on:\n   push:\n+    branches:\n+      - main\n   pull_request:\n   schedule:\n     - cron: '13 7 * * 0'  # run once a week on Sunday\n"

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-02-09T11:50:36+02:00
Author: Maik Derstappen (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.autoinclude/commit/a99c88fa97ae9e870c2c56855a76fbcc217babd6

Merge pull request #16 from plone/mrtango-fix-loader-when-dash-in-projectname

replace dash with lowdash in project_name

Files changed:
A news/16.bugfix
A test-packages/ExampleCamelCase/MANIFEST.in
A test-packages/ExampleCamelCase/setup.py
A test-packages/ExampleCamelCase/src/ExampleCamelCase/__init__.py
A test-packages/ExampleCamelCase/src/ExampleCamelCase/configure.zcml
A test-packages/ExampleCamelCase/src/ExampleCamelCase/tests.py
A test-packages/example.plone-dash-addon/MANIFEST.in
A test-packages/example.plone-dash-addon/setup.py
A test-packages/example.plone-dash-addon/src/example/__init__.py
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/__init__.py
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/__init__.py
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/configure.zcml
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/permissions.zcml
A test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py
M .github/workflows/tests.yml
M buildout.cfg
M src/plone/autoinclude/loader.py
M src/plone/autoinclude/tests/test_loader.py
M test-packages/example.ploneintegration/src/example/ploneintegration/tests.py
M tox.ini

b'diff --git a/.github/workflows/tests.yml b/.github/workflows/tests.yml\nindex ad2e11a..a3db986 100644\n--- a/.github/workflows/tests.yml\n+++ b/.github/workflows/tests.yml\n@@ -4,6 +4,8 @@ name: tests\n \n on:\n   push:\n+    branches:\n+      - main\n   pull_request:\n   schedule:\n     - cron: \'13 7 * * 0\'  # run once a week on Sunday\ndiff --git a/buildout.cfg b/buildout.cfg\nindex 8677651..ace6e25 100644\n--- a/buildout.cfg\n+++ b/buildout.cfg\n@@ -7,11 +7,13 @@ develop =\n     ../../test-packages/example.different\n     ../../test-packages/example.different2\n     ../../test-packages/example.metaoverrides\n+    ../../test-packages/example.plone-dash-addon\n     ../../test-packages/example.ploneaddon\n     ../../test-packages/example.ploneintegration\n     ../../test-packages/example.zopeaddon\n     ../../test-packages/example.zopeintegration\n     ../../test-packages/example.multipleeps\n+    ../../test-packages/ExampleCamelCase\n     ../../test-packages/namespaceexample.native\n     ../../test-packages/namespaceexample.pkgutilns\n parts =\n@@ -35,10 +37,12 @@ eggs =\n     example.different\n     example.different2\n     example.metaoverrides\n+    example.plone-dash-addon\n     example.ploneaddon\n     example.ploneintegration\n     example.zopeaddon\n     example.zopeintegration\n     example.multipleeps\n+    ExampleCamelCase\n     namespaceexample.native\n     namespaceexample.pkgutilns\ndiff --git a/news/16.bugfix b/news/16.bugfix\nnew file mode 100644\nindex 0000000..4680b4a\n--- /dev/null\n+++ b/news/16.bugfix\n@@ -0,0 +1 @@\n+Replace dash with lowdash in project_name, as Python Project are normally divided by dash and modul name uses lowdash [MrTango]\ndiff --git a/src/plone/autoinclude/loader.py b/src/plone/autoinclude/loader.py\nindex ae48635..134066c 100644\n--- a/src/plone/autoinclude/loader.py\n+++ b/src/plone/autoinclude/loader.py\n@@ -30,7 +30,7 @@ def load_z3c_packages(target=""):\n         # we can include it.\n         if target and ep.module_name != target:\n             continue\n-        module_name = ep.dist.project_name\n+        module_name = ep.dist.project_name.replace("-", "_")\n         if module_name not in _known_module_names:\n             try:\n                 dist = importlib.import_module(module_name)\n@@ -78,7 +78,7 @@ def load_own_packages(target=""):\n             if target and eps["target"].module_name != target:\n                 # entry point defines target X but we only want target Y.\n                 continue\n-            module_name = wsdist.project_name\n+            module_name = wsdist.project_name.replace("-", "_")\n         if "module" in eps:\n             # We could load the dist with ep.load(), but we do it differently.\n             module_name = eps["module"].module_name\ndiff --git a/src/plone/autoinclude/tests/test_loader.py b/src/plone/autoinclude/tests/test_loader.py\nindex 7fcf1a9..8d10be1 100644\n--- a/src/plone/autoinclude/tests/test_loader.py\n+++ b/src/plone/autoinclude/tests/test_loader.py\n@@ -61,6 +61,7 @@ def test_load_z3c_packages(self):\n             "example.multipleeps",\n         ]:\n             self.assertIn(package, packages.keys())\n+\n         package = packages["example.ploneaddon"]\n         import example.ploneaddon\n \n@@ -73,6 +74,7 @@ def test_load_own_packages(self):\n         for package in [\n             "example.somethingelse2",\n             "example.multipleeps",\n+            "example.plone_dash_addon",\n         ]:\n             self.assertIn(package, packages.keys())\n         package = packages["example.somethingelse2"]\n@@ -80,6 +82,11 @@ def test_load_own_packages(self):\n \n         self.assertEqual(package, example.somethingelse2)\n \n+        package = packages["example.plone_dash_addon"]\n+        import example.plone_dash_addon\n+\n+        self.assertEqual(package, example.plone_dash_addon)\n+\n     def test_get_zcml_file(self):\n         from plone.autoinclude.loader import get_zcml_file\n \ndiff --git a/test-packages/ExampleCamelCase/MANIFEST.in b/test-packages/ExampleCamelCase/MANIFEST.in\nnew file mode 100644\nindex 0000000..46b2653\n--- /dev/null\n+++ b/test-packages/ExampleCamelCase/MANIFEST.in\n@@ -0,0 +1,2 @@\n+recursive-include src *.py\n+recursive-include src *.zcml\ndiff --git a/test-packages/ExampleCamelCase/setup.py b/test-packages/ExampleCamelCase/setup.py\nnew file mode 100644\nindex 0000000..a2d9da3\n--- /dev/null\n+++ b/test-packages/ExampleCamelCase/setup.py\n@@ -0,0 +1,25 @@\n+# -*- coding: utf-8 -*-\n+from setuptools import find_packages\n+from setuptools import setup\n+\n+\n+setup(\n+    name="ExampleCamelCase",\n+    version="1.0a1",\n+    description="An add-on for Plone",\n+    long_description="long_description",\n+    author="Maurits van Rees",\n+    author_email="m.van.rees@zestsoftware.nl",\n+    license="GPL version 2",\n+    packages=find_packages("src", exclude=["ez_setup"]),\n+    package_dir={"": "src"},\n+    include_package_data=True,\n+    zip_safe=False,\n+    install_requires=[\n+        "setuptools",\n+    ],\n+    entry_points="""\n+    [z3c.autoinclude.plugin]\n+    target = plone\n+    """,\n+)\ndiff --git a/test-packages/ExampleCamelCase/src/ExampleCamelCase/__init__.py b/test-packages/ExampleCamelCase/src/ExampleCamelCase/__init__.py\nnew file mode 100644\nindex 0000000..792d600\n--- /dev/null\n+++ b/test-packages/ExampleCamelCase/src/ExampleCamelCase/__init__.py\n@@ -0,0 +1 @@\n+#\ndiff --git a/test-packages/ExampleCamelCase/src/ExampleCamelCase/configure.zcml b/test-packages/ExampleCamelCase/src/ExampleCamelCase/configure.zcml\nnew file mode 100644\nindex 0000000..ee31a9d\n--- /dev/null\n+++ b/test-packages/ExampleCamelCase/src/ExampleCamelCase/configure.zcml\n@@ -0,0 +1,10 @@\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n+    xmlns:i18n="http://namespaces.zope.org/i18n"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    i18n_domain="ExampleCamelCase">\n+\n+  <!-- FOR TESTS: This is configure.zcml from ExampleCamelCase. -->\n+\n+</configure>\ndiff --git a/test-packages/ExampleCamelCase/src/ExampleCamelCase/tests.py b/test-packages/ExampleCamelCase/src/ExampleCamelCase/tests.py\nnew file mode 100644\nindex 0000000..a16a408\n--- /dev/null\n+++ b/test-packages/ExampleCamelCase/src/ExampleCamelCase/tests.py\n@@ -0,0 +1,11 @@\n+from example.basetestpackage.package_base import PackageTestCase\n+\n+import unittest\n+\n+\n+class TestPackage(PackageTestCase, unittest.TestCase):\n+    project_name = "ExampleCamelCase"\n+    meta_files = []\n+    configure_files = ["configure.zcml"]\n+    overrides_files = []\n+    standard_z3c_autoinclude = True\ndiff --git a/test-packages/example.plone-dash-addon/MANIFEST.in b/test-packages/example.plone-dash-addon/MANIFEST.in\nnew file mode 100644\nindex 0000000..46b2653\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/MANIFEST.in\n@@ -0,0 +1,2 @@\n+recursive-include src *.py\n+recursive-include src *.zcml\ndiff --git a/test-packages/example.plone-dash-addon/setup.py b/test-packages/example.plone-dash-addon/setup.py\nnew file mode 100644\nindex 0000000..7f1f867\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/setup.py\n@@ -0,0 +1,26 @@\n+# -*- coding: utf-8 -*-\n+from setuptools import find_packages\n+from setuptools import setup\n+\n+\n+setup(\n+    name="example.plone-dash-addon",\n+    version="1.0a1",\n+    description="An add-on for Plone",\n+    long_description="long_description",\n+    author="Maurits van Rees",\n+    author_email="m.van.rees@zestsoftware.nl",\n+    license="GPL version 2",\n+    packages=find_packages("src", exclude=["ez_setup"]),\n+    namespace_packages=["example"],\n+    package_dir={"": "src"},\n+    include_package_data=True,\n+    zip_safe=False,\n+    install_requires=[\n+        "setuptools",\n+    ],\n+    entry_points="""\n+    [plone.autoinclude.plugin]\n+    target = plone\n+    """,\n+)\ndiff --git a/test-packages/example.plone-dash-addon/src/example/__init__.py b/test-packages/example.plone-dash-addon/src/example/__init__.py\nnew file mode 100644\nindex 0000000..03d08ff\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/__init__.py\n@@ -0,0 +1,2 @@\n+# -*- coding: utf-8 -*-\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/__init__.py b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/__init__.py\nnew file mode 100644\nindex 0000000..792d600\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/__init__.py\n@@ -0,0 +1 @@\n+#\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/__init__.py b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/__init__.py\nnew file mode 100644\nindex 0000000..e69de29\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/configure.zcml b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/configure.zcml\nnew file mode 100644\nindex 0000000..bc13ca5\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/browser/configure.zcml\n@@ -0,0 +1,5 @@\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser">\n+\n+</configure>\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\nnew file mode 100644\nindex 0000000..558aa27\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\n@@ -0,0 +1,20 @@\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n+    xmlns:i18n="http://namespaces.zope.org/i18n"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    i18n_domain="example.ploneaddon">\n+\n+  <!--\n+    Be careful if you use general includeDependencies, it can have side effects!\n+    Better import explicit packages or configurations ;)\n+  -->\n+  <!--<includeDependencies package="." />-->\n+\n+  <include package=".browser" />\n+\n+  <include file="permissions.zcml" />\n+\n+  <!-- FOR TESTS: This is configure.zcml from example.plone_dash_addon. -->\n+\n+</configure>\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/permissions.zcml b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/permissions.zcml\nnew file mode 100644\nindex 0000000..b61941c\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/permissions.zcml\n@@ -0,0 +1,4 @@\n+<configure\n+  xmlns="http://namespaces.zope.org/zope">\n+\n+</configure>\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\nnew file mode 100644\nindex 0000000..9d319f7\n--- /dev/null\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\n@@ -0,0 +1,11 @@\n+from example.basetestpackage.package_base import PackageTestCase\n+\n+import unittest\n+\n+\n+class TestPackage(PackageTestCase, unittest.TestCase):\n+    project_name = "example.plone_dash_addon"\n+    meta_files = []\n+    configure_files = ["configure.zcml", "permissions.zcml", "browser/configure.zcml"]\n+    overrides_files = []\n+    standard_z3c_autoinclude = True\ndiff --git a/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py b/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py\nindex a61d332..5665a9e 100644\n--- a/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py\n+++ b/test-packages/example.ploneintegration/src/example/ploneintegration/tests.py\n@@ -14,6 +14,12 @@ class TestIntegration(IntegrationTestCase, unittest.TestCase):\n     }\n     configure_files = {\n         "example.ploneintegration": ["configure.zcml"],\n+        "ExampleCamelCase": ["configure.zcml"],\n+        "example.plone_dash_addon": [\n+            "configure.zcml",\n+            "permissions.zcml",\n+            "browser/configure.zcml",\n+        ],\n         "example.ploneaddon": [\n             "configure.zcml",\n             "permissions.zcml",\ndiff --git a/tox.ini b/tox.ini\nindex b052794..dd99932 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -29,10 +29,12 @@ deps =\n     -e test-packages/example.different2\n     -e test-packages/example.metaoverrides\n     -e test-packages/example.ploneaddon\n+    -e test-packages/example.plone-dash-addon\n     -e test-packages/example.ploneintegration\n     -e test-packages/example.zopeaddon\n     -e test-packages/example.zopeintegration\n     -e test-packages/example.multipleeps\n+    -e test-packages/ExampleCamelCase\n     -e test-packages/namespaceexample.native\n     -e test-packages/namespaceexample.pkgutilns\n # extras =\n'

