Repository: plone.app.robotframework


Branch: refs/heads/master
Date: 2018-10-09T23:46:42-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.robotframework/commit/28546ae38042d868b4bcd4d26367603a3a061c31

Read files as binary

Files changed:
M CHANGES.rst
M src/plone/app/robotframework/content.py
M src/plone/app/robotframework/testing.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 42a9551..0e3d07e 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Read files as binary in Python 3.\n+  [davisagli]\n \n \n 1.3.0 (2018-10-01)\ndiff --git a/src/plone/app/robotframework/content.py b/src/plone/app/robotframework/content.py\nindex 2324e7a..c03fa07 100644\n--- a/src/plone/app/robotframework/content.py\n+++ b/src/plone/app/robotframework/content.py\n@@ -93,8 +93,10 @@ def create_content(self, *args, **kwargs):\n             if portal_type in (\'File\', ) and \'file\' not in kwargs:\n                 pdf_file = os.path.join(\n                     os.path.dirname(__file__), \'content\', u\'file.pdf\')\n+                with open(pdf_file, \'rb\') as f:\n+                    file_data = f.read()\n                 value = NamedBlobFile(\n-                    data=open(pdf_file, \'r\').read(),\n+                    data=file_data,\n                     contentType=\'application/pdf\',\n                     filename=u\'file.pdf\'\n                 )\n@@ -216,16 +218,20 @@ def set_field_value(self, uid, field, value, field_type):\n             if field_type == \'file\':\n                 pdf_file = os.path.join(\n                     os.path.dirname(__file__), \'content\', u\'file.pdf\')\n+                with open(pdf_file, \'rb\') as f:\n+                    file_data = f.read()\n                 value = NamedBlobFile(\n-                    data=open(pdf_file, \'r\').read(),\n+                    data=file_data,\n                     contentType=\'application/pdf\',\n                     filename=u\'file.pdf\'\n                 )\n             if field_type == \'image\':\n                 image_file = os.path.join(\n                     os.path.dirname(__file__), u\'image.jpg\')\n+                with open(image_file, \'rb\') as f:\n+                    image_data = f.read()\n                 value = NamedBlobImage(\n-                    data=open(image_file, \'r\').read(),\n+                    data=image_data,\n                     contentType=\'image/jpg\',\n                     filename=u\'image.jpg\'\n                 )\ndiff --git a/src/plone/app/robotframework/testing.py b/src/plone/app/robotframework/testing.py\nindex 25ee8d2..180842f 100644\n--- a/src/plone/app/robotframework/testing.py\n+++ b/src/plone/app/robotframework/testing.py\n@@ -1,9 +1,5 @@\n # -*- coding: utf-8 -*-\n-"""Test layers required to run plone.app.robotframework tests.\n-\n-This module is located below tests directory to avoid confusing it with any\n-re-usable resources of plone.app.robotframework.\n-"""\n+"""Test layers required to run plone.app.robotframework tests."""\n from Acquisition import aq_base\n from plone.app.robotframework.autologin import AutoLogin\n from plone.app.robotframework.content import Content\n'

Repository: plone.app.robotframework


Branch: refs/heads/master
Date: 2018-10-10T21:26:31-04:00
Author: David Glick (davisagli) <dglick@salesforce.com>
Commit: https://github.com/plone/plone.app.robotframework/commit/fa8501e9049404e550761475175fa3499e4c98c2

Merge pull request #93 from plone/fix-file-read

Read files as binary in Python 3

Files changed:
M CHANGES.rst
M src/plone/app/robotframework/content.py
M src/plone/app/robotframework/testing.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 42a9551..0e3d07e 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Read files as binary in Python 3.\n+  [davisagli]\n \n \n 1.3.0 (2018-10-01)\ndiff --git a/src/plone/app/robotframework/content.py b/src/plone/app/robotframework/content.py\nindex 2324e7a..c03fa07 100644\n--- a/src/plone/app/robotframework/content.py\n+++ b/src/plone/app/robotframework/content.py\n@@ -93,8 +93,10 @@ def create_content(self, *args, **kwargs):\n             if portal_type in (\'File\', ) and \'file\' not in kwargs:\n                 pdf_file = os.path.join(\n                     os.path.dirname(__file__), \'content\', u\'file.pdf\')\n+                with open(pdf_file, \'rb\') as f:\n+                    file_data = f.read()\n                 value = NamedBlobFile(\n-                    data=open(pdf_file, \'r\').read(),\n+                    data=file_data,\n                     contentType=\'application/pdf\',\n                     filename=u\'file.pdf\'\n                 )\n@@ -216,16 +218,20 @@ def set_field_value(self, uid, field, value, field_type):\n             if field_type == \'file\':\n                 pdf_file = os.path.join(\n                     os.path.dirname(__file__), \'content\', u\'file.pdf\')\n+                with open(pdf_file, \'rb\') as f:\n+                    file_data = f.read()\n                 value = NamedBlobFile(\n-                    data=open(pdf_file, \'r\').read(),\n+                    data=file_data,\n                     contentType=\'application/pdf\',\n                     filename=u\'file.pdf\'\n                 )\n             if field_type == \'image\':\n                 image_file = os.path.join(\n                     os.path.dirname(__file__), u\'image.jpg\')\n+                with open(image_file, \'rb\') as f:\n+                    image_data = f.read()\n                 value = NamedBlobImage(\n-                    data=open(image_file, \'r\').read(),\n+                    data=image_data,\n                     contentType=\'image/jpg\',\n                     filename=u\'image.jpg\'\n                 )\ndiff --git a/src/plone/app/robotframework/testing.py b/src/plone/app/robotframework/testing.py\nindex 25ee8d2..180842f 100644\n--- a/src/plone/app/robotframework/testing.py\n+++ b/src/plone/app/robotframework/testing.py\n@@ -1,9 +1,5 @@\n # -*- coding: utf-8 -*-\n-"""Test layers required to run plone.app.robotframework tests.\n-\n-This module is located below tests directory to avoid confusing it with any\n-re-usable resources of plone.app.robotframework.\n-"""\n+"""Test layers required to run plone.app.robotframework tests."""\n from Acquisition import aq_base\n from plone.app.robotframework.autologin import AutoLogin\n from plone.app.robotframework.content import Content\n'

