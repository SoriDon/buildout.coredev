Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-03-17T10:34:56+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.multilingual/commit/3c70daab184f4417a80f213dc3b91a19151bc832

use plone.base

Files changed:
A news/411.bugfix
M README.rst
M src/plone/app/multilingual/browser/configure.zcml
M src/plone/app/multilingual/browser/controlpanel.py
M src/plone/app/multilingual/browser/menu.py
M src/plone/app/multilingual/browser/setup.py
M src/plone/app/multilingual/configure.zcml
M src/plone/app/multilingual/dx/cloner.py
M src/plone/app/multilingual/dx/configure.zcml
M src/plone/app/multilingual/profiles/default/registry.xml
M src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml
M src/plone/app/multilingual/setuphandlers.py
M src/plone/app/multilingual/tests/test_selector.py
M src/plone/app/multilingual/tests/test_uninstall.py
M src/plone/app/multilingual/upgrades.py
M src/plone/app/multilingual/upgrades.zcml

b'diff --git a/README.rst b/README.rst\nindex fb92fbb9f..c68d0c2c7 100644\n--- a/README.rst\n+++ b/README.rst\n@@ -288,13 +288,13 @@ The different aspects involved on a translation are adapted, so it\'s possible to\n Language get/set via an unified adapter\n ---------------------------------------\n \n-In order to access and modify the language of a content type regardless the type (Archetypes/Dexterity) there is a interface/adapter::\n+In order to access and modify the language of a content type there is a interface/adapter::\n \n-    Products.CMFPlone.interfaces.ILanguage\n+    plone.base.interfaces.ILanguage\n \n You can use::\n \n-    from Products.CMFPlone.interfaces import ILanguage\n+    from plone.base.interfaces import ILanguage\n     language = ILanguage(context).get_language()\n \n or in case you want to set the language of a content::\ndiff --git a/news/411.bugfix b/news/411.bugfix\nnew file mode 100644\nindex 000000000..7100d250d\n--- /dev/null\n+++ b/news/411.bugfix\n@@ -0,0 +1,2 @@\n+Use plone.base imports. Removes deprecation warnings.\n+[jensens]\ndiff --git a/src/plone/app/multilingual/browser/configure.zcml b/src/plone/app/multilingual/browser/configure.zcml\nindex 3cb5f8b06..a8a45c7e3 100644\n--- a/src/plone/app/multilingual/browser/configure.zcml\n+++ b/src/plone/app/multilingual/browser/configure.zcml\n@@ -81,7 +81,7 @@\n   <!-- Control panel -->\n   <browser:page\n     name="language-controlpanel"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+    for="plone.base.interfaces.IPloneSiteRoot"\n     class=".controlpanel.LanguageControlPanel"\n     permission="plone.app.controlpanel.Language"\n     layer="..interfaces.IPloneAppMultilingualInstalled"\n@@ -90,14 +90,14 @@\n   <!-- Migration Tab -->\n   <browser:page\n       name="lp-migration"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.MigrationView"\n       permission="plone.app.multilingual.ManageTranslations"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n \n   <browser:page\n       name="multilingual-map"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.multilingualMapView"\n       permission="plone.app.multilingual.ManageTranslations"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -106,7 +106,7 @@\n   <browser:viewlet\n       zcml:condition="installed plone.app.controlpanel"\n       name="plone.app.multilingual.supported-languages-notice"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       view="plone.app.controlpanel.interfaces.IPloneControlPanelView"\n       manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n       class=".viewlets.OneLanguageConfiguredNoticeViewlet"\n@@ -116,8 +116,8 @@\n   <browser:viewlet\n       zcml:condition="not-installed plone.app.controlpanel"\n       name="plone.app.multilingual.supported-languages-notice"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      view="Products.CMFPlone.interfaces.controlpanel.IPloneControlPanelView"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n+      view="plone.base.interfaces.controlpanel.IPloneControlPanelView"\n       manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n       class=".viewlets.OneLanguageConfiguredNoticeViewlet"\n       template="templates/languages-notice.pt"\n@@ -172,7 +172,7 @@\n   <!-- Not Translated Yet -->\n   <browser:page\n       name="not_translated_yet"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".helper_views.not_translated_yet"\n       permission="zope.Public"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -180,14 +180,14 @@\n   <!-- Multilingual Map ajax helper -->\n   <browser:page\n       name="multilingual-map-ajax"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.multilingualMapViewJSON"\n       permission="plone.app.multilingual.ManageTranslations"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n \n   <!-- Default browser view -->\n   <browser:view\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".switcher.LanguageSwitcher"\n       name="language-switcher"\n       permission="zope.Public"\n@@ -258,7 +258,7 @@\n   <!-- Optional initial step - reindex Language index -->\n   <browser:page\n       name="reindex-language-index"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMReindexLanguageIndex"\n       permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -266,7 +266,7 @@\n   <!-- Step 1 - Relocates the content if needed -->\n   <browser:page\n       name="relocate-content"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.moveContentToProperRLF"\n       permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -274,7 +274,7 @@\n   <!-- Step 2 - Migrate multilingual catalog info -->\n   <browser:page\n       name="transfer-lp-catalog"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMView"\n       permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -282,7 +282,7 @@\n   <!-- Step 3  - Cleanup tasks after migration -->\n   <browser:page\n       name="after-migration-cleanup"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMAfterView"\n       permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -299,7 +299,7 @@\n   <!-- To delete -->\n   <browser:page\n       name="lp-migration-after"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.MigrationViewAfter"\n       permission="plone.app.multilingual.ManageTranslations"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\ndiff --git a/src/plone/app/multilingual/browser/controlpanel.py b/src/plone/app/multilingual/browser/controlpanel.py\nindex 98ef2422f..76d88e482 100644\n--- a/src/plone/app/multilingual/browser/controlpanel.py\n+++ b/src/plone/app/multilingual/browser/controlpanel.py\n@@ -6,9 +6,7 @@\n from plone.app.uuid.utils import uuidToObject\n from plone.base.interfaces import ILanguage\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.controlpanel.browser.language import (  # noqa\n-    LanguageControlPanelForm,\n-)\n+from Products.CMFPlone.controlpanel.browser.language import LanguageControlPanelForm\n from Products.Five import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.statusmessages.interfaces import IStatusMessage\ndiff --git a/src/plone/app/multilingual/browser/menu.py b/src/plone/app/multilingual/browser/menu.py\nindex e6c236f45..5c14a5ade 100644\n--- a/src/plone/app/multilingual/browser/menu.py\n+++ b/src/plone/app/multilingual/browser/menu.py\n@@ -12,15 +12,14 @@\n from plone.app.multilingual.interfaces import IPloneAppMultilingualInstalled\n from plone.app.multilingual.interfaces import ITG\n from plone.app.multilingual.interfaces import ITranslatable\n-from plone.app.multilingual.interfaces import ITranslationManager\n from plone.app.multilingual.interfaces import LANGUAGE_INDEPENDENT\n from plone.app.multilingual.permissions import ManageTranslations\n from plone.base.interfaces import ILanguage\n from plone.memoize import view\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.defaultpage import is_default_page\n-from Products.CMFPlone.utils import safe_unicode\n+from plone.base.defaultpage import is_default_page\n+from plone.base.utils import safe_text\n from zope.browsermenu.menu import BrowserMenu\n from zope.browsermenu.menu import BrowserSubMenuItem\n from zope.component import getUtility\n@@ -97,9 +96,8 @@ def getMenuItems(self, context, request):\n         )\n         for brain in results:\n             assets_folder_url = brain.getURL() + "/folder_contents"\n-            assets_folder_title = safe_unicode(brain.Title)\n+            assets_folder_title = safe_text(brain.Title)\n             break\n-\n         # Menu items\n         results = []\n         results_folder = []\ndiff --git a/src/plone/app/multilingual/browser/setup.py b/src/plone/app/multilingual/browser/setup.py\nindex 9125e1d89..06e9c259d 100644\n--- a/src/plone/app/multilingual/browser/setup.py\n+++ b/src/plone/app/multilingual/browser/setup.py\n@@ -2,7 +2,6 @@\n from plone.app.dexterity.behaviors.exclfromnav import IExcludeFromNavigation\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.app.multilingual import _\n-from plone.app.multilingual.dx.interfaces import IDexterityTranslatable\n from plone.app.multilingual.interfaces import ITranslatable\n from plone.app.multilingual.interfaces import ITranslationManager\n from plone.app.multilingual.interfaces import LANGUAGE_INDEPENDENT\n@@ -12,7 +11,7 @@\n from plone.i18n.locales.languages import _combinedlanguagelist\n from plone.i18n.locales.languages import _languagelist\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import _createObjectByType\n+from plone.base.utils import unrestricted_construct_instance\n from Products.Five import BrowserView\n from zope.component.hooks import getSite\n from zope.event import notify\n@@ -148,8 +147,8 @@ def setUpLanguage(self, code, name):\n         )\n \n         if folder is None:\n-            _createObjectByType(self.folder_type, self.context, folderId)\n-            _createObjectByType(\n+            unrestricted_construct_instance(self.folder_type, self.context, folderId)\n+            unrestricted_construct_instance(\n                 self.folder_type_language_independent,\n                 self.context[folderId],\n                 assets_folder_id,\ndiff --git a/src/plone/app/multilingual/configure.zcml b/src/plone/app/multilingual/configure.zcml\nindex e2541fcd1..98dd5f8e7 100644\n--- a/src/plone/app/multilingual/configure.zcml\n+++ b/src/plone/app/multilingual/configure.zcml\n@@ -137,7 +137,7 @@\n   <utility\n       factory=".setuphandlers.HiddenProfiles"\n       name="plone.app.multilingual"\n-      provides="Products.CMFPlone.interfaces.INonInstallable"/>\n+      provides="plone.base.interfaces.INonInstallable"/>\n \n   <genericsetup:registerProfile\n       name="default"\n@@ -145,7 +145,7 @@\n       description="Install to enable multilingual content support with plone.app.multilingual"\n       directory="profiles/default"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       post_handler=".setuphandlers.init_pam"/>\n \n   <genericsetup:registerProfile\n@@ -154,7 +154,7 @@\n       description="Uninstall, removes multilingual content support with plone.app.multilingual"\n       directory="profiles/uninstall"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"/>\n+      for="plone.base.interfaces.IPloneSiteRoot"/>\n \n   <genericsetup:importStep\n       name="plone.app.multilingual_default"\ndiff --git a/src/plone/app/multilingual/dx/cloner.py b/src/plone/app/multilingual/dx/cloner.py\nindex 0906eaf76..340692ac3 100644\n--- a/src/plone/app/multilingual/dx/cloner.py\n+++ b/src/plone/app/multilingual/dx/cloner.py\n@@ -4,7 +4,7 @@\n from plone.app.multilingual.interfaces import ITranslationManager\n from plone.base.interfaces import ILanguage\n from plone.dexterity.utils import iterSchemata\n-from Products.CMFPlone.utils import safe_unicode\n+from plone.base.utils import safe_text\n from z3c.relationfield import RelationValue\n from z3c.relationfield.interfaces import IRelationList\n from z3c.relationfield.interfaces import IRelationValue\n@@ -96,7 +96,7 @@ def copy_fields(self, translation):\n                         field_changed = value != translation_value\n                     if field_changed:\n                         changed = True\n-                        setattr(translation_adapter, field_name, safe_unicode(value))\n+                        setattr(translation_adapter, field_name, safe_text(value))\n \n         # If at least one field has been copied over to the translation\n         # we need to inform subscriber to trigger an ObjectModifiedEvent\ndiff --git a/src/plone/app/multilingual/dx/configure.zcml b/src/plone/app/multilingual/dx/configure.zcml\nindex bbd9c0c02..9d4e60c32 100644\n--- a/src/plone/app/multilingual/dx/configure.zcml\n+++ b/src/plone/app/multilingual/dx/configure.zcml\n@@ -43,7 +43,7 @@\n \n   <adapter\n       for="plone.dexterity.interfaces.IDexterityContent"\n-      provides="Products.CMFPlone.interfaces.ILanguage"\n+      provides="plone.base.interfaces.ILanguage"\n       factory=".language.Language"/>\n \n   <adapter\ndiff --git a/src/plone/app/multilingual/profiles/default/registry.xml b/src/plone/app/multilingual/profiles/default/registry.xml\nindex c191098d9..d10517d7f 100644\n--- a/src/plone/app/multilingual/profiles/default/registry.xml\n+++ b/src/plone/app/multilingual/profiles/default/registry.xml\n@@ -2,12 +2,12 @@\n <registry>\n \n   <records prefix="plone.bundles/multilingual"\n-            interface=\'Products.CMFPlone.interfaces.IBundleRegistry\'>\n+            interface=\'plone.base.interfaces.IBundleRegistry\'>\n     <value key="enabled">True</value>\n     <value key="csscompilation">++resource++plone.app.multilingual.stylesheet/multilingual.css</value>\n   </records>\n \n-  <records interface="Products.CMFPlone.interfaces.ITinyMCEResourceTypesSchema" prefix="plone">\n+  <records interface="plone.base.interfaces.ITinyMCEResourceTypesSchema" prefix="plone">\n     <value key="contains_objects" purge="false"><element>LIF</element></value>\n   </records>\n \ndiff --git a/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml b/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\nindex deb3fe62f..9f9fe2c53 100644\n--- a/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\n+++ b/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\n@@ -3,19 +3,19 @@\n \n   <!-- remove old resource and bundle registration -->\n   <record name="plone.bundles/plone-legacy.resources"\n-          interface="Products.CMFPlone.interfaces.resources.IBundleRegistry" field="resources">\n+          interface="plone.base.interfaces.resources.IBundleRegistry" field="resources">\n     <value purge="false">\n       <element remove="true">multilingual</element>\n     </value>\n   </record>\n   <records prefix="plone.resources/multilingual"\n-           interface=\'Products.CMFPlone.interfaces.IResourceRegistry\'\n+           interface=\'plone.base.interfaces.IResourceRegistry\'\n            remove="true">\n   </records>\n \n   <!-- register new bundle -->\n   <records prefix="plone.bundles/multilingual"\n-            interface=\'Products.CMFPlone.interfaces.IBundleRegistry\'>\n+            interface=\'plone.base.interfaces.IBundleRegistry\'>\n     <value key="enabled">True</value>\n     <value key="compile">False</value>\n     <value key="merge_with">logged-in</value>\ndiff --git a/src/plone/app/multilingual/setuphandlers.py b/src/plone/app/multilingual/setuphandlers.py\nindex 5e2ba5ab1..3bdde1df1 100644\n--- a/src/plone/app/multilingual/setuphandlers.py\n+++ b/src/plone/app/multilingual/setuphandlers.py\n@@ -1,22 +1,11 @@\n from logging import getLogger\n from plone.app.multilingual.browser.setup import SetupMultilingualSite\n-from plone.app.multilingual.interfaces import ITranslatable\n from plone.app.multilingual.itg import addAttributeTG\n from plone.base.interfaces import INonInstallable\n-from Products.CMFPlone.utils import getToolByName\n+from Products.CMFCore.utils import getToolByName\n from zope.component.hooks import getSite\n from zope.interface import implementer\n \n-import pkg_resources\n-\n-\n-try:\n-    pkg_resources.get_distribution("plone.app.contenttypes")\n-except pkg_resources.DistributionNotFound:\n-    HAS_PLONE_APP_CONTENTTYPES = False\n-else:\n-    HAS_PLONE_APP_CONTENTTYPES = True\n-\n \n @implementer(INonInstallable)\n class HiddenProfiles:\ndiff --git a/src/plone/app/multilingual/tests/test_selector.py b/src/plone/app/multilingual/tests/test_selector.py\nindex a25c49b7a..eea4f1850 100644\n--- a/src/plone/app/multilingual/tests/test_selector.py\n+++ b/src/plone/app/multilingual/tests/test_selector.py\n@@ -16,7 +16,7 @@\n from plone.registry.interfaces import IRegistry\n from plone.testing.z2 import Browser\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import safe_nativestring\n+from plone.base.utils import safe_text\n from urllib.parse import parse_qs\n from urllib.parse import urlparse\n from zope.component import getUtility\n@@ -759,9 +759,9 @@ def assertUrlsEqual(self, url1, url2):\n         """The order of query-strings is sometimes random in python 3\n         This compares urls disregarding the order.\n         """\n-        parsed_url_1 = urlparse(safe_nativestring(url1))\n+        parsed_url_1 = urlparse(safe_text(url1))\n         parse_qs_1 = parse_qs(parsed_url_1.query)\n-        parsed_url_2 = urlparse(safe_nativestring(url2))\n+        parsed_url_2 = urlparse(safe_text(url2))\n         parse_qs_2 = parse_qs(parsed_url_2.query)\n         self.assertEqual(parsed_url_1[0], parsed_url_2[0])\n         self.assertEqual(parsed_url_1[1], parsed_url_2[1])\ndiff --git a/src/plone/app/multilingual/tests/test_uninstall.py b/src/plone/app/multilingual/tests/test_uninstall.py\nindex 28df6bba4..cbce1e51a 100644\n--- a/src/plone/app/multilingual/tests/test_uninstall.py\n+++ b/src/plone/app/multilingual/tests/test_uninstall.py\n@@ -1,10 +1,8 @@\n from plone import api\n-from plone.app.multilingual.testing import (  # noqa\n-    PLONE_APP_MULTILINGUAL_INTEGRATION_TESTING,\n-)\n+from plone.app.multilingual.testing import PLONE_APP_MULTILINGUAL_INTEGRATION_TESTING\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n-from Products.CMFPlone.utils import get_installer\n+from plone.base.utils import get_installer\n \n import unittest\n \ndiff --git a/src/plone/app/multilingual/upgrades.py b/src/plone/app/multilingual/upgrades.py\nindex 77cdf6842..e9cc710ea 100644\n--- a/src/plone/app/multilingual/upgrades.py\n+++ b/src/plone/app/multilingual/upgrades.py\n@@ -2,7 +2,7 @@\n from plone.base.interfaces import ILanguage\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import _createObjectByType\n+from plone.base.utils import unrestricted_construct_instance\n from time import time\n from zope.component import getUtility\n \n@@ -70,7 +70,7 @@ def migration_pam_1_to_2(context):\n         old = portal[old_id]\n         logger.info(f"{code} - Phase 2: Moving objects into new LRF...")\n \n-        _createObjectByType(type_name, portal, code)\n+        unrestricted_construct_instance(type_name, portal, code)\n         new = portal[code]\n         new.setTitle(name)\n         ILanguage(new).set_language(code)\ndiff --git a/src/plone/app/multilingual/upgrades.zcml b/src/plone/app/multilingual/upgrades.zcml\nindex adbc8be97..3ff68e0b2 100644\n--- a/src/plone/app/multilingual/upgrades.zcml\n+++ b/src/plone/app/multilingual/upgrades.zcml\n@@ -24,7 +24,7 @@\n       name="to_3"\n       title="Update new registry key"\n       directory="profiles/upgrades/to_3"\n-      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n \n@@ -40,7 +40,7 @@\n       name="to_4"\n       title="Update bundle registration"\n       directory="profiles/upgrades/to_4"\n-      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n \n@@ -56,7 +56,7 @@\n       name="to_1000"\n       title="Update to 1000"\n       directory="profiles/upgrades/to_1000"\n-      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n \n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-03-17T11:12:05+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.multilingual/commit/6325639b06040519ce4f33faa7d75a0b3a0e4276

Merge pull request #411 from plone/plonebase

use plone.base

Files changed:
A news/411.bugfix
M README.rst
M src/plone/app/multilingual/browser/configure.zcml
M src/plone/app/multilingual/browser/controlpanel.py
M src/plone/app/multilingual/browser/menu.py
M src/plone/app/multilingual/browser/setup.py
M src/plone/app/multilingual/configure.zcml
M src/plone/app/multilingual/dx/cloner.py
M src/plone/app/multilingual/dx/configure.zcml
M src/plone/app/multilingual/profiles/default/registry.xml
M src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml
M src/plone/app/multilingual/setuphandlers.py
M src/plone/app/multilingual/tests/test_selector.py
M src/plone/app/multilingual/tests/test_uninstall.py
M src/plone/app/multilingual/upgrades.py
M src/plone/app/multilingual/upgrades.zcml

b'diff --git a/README.rst b/README.rst\nindex fb92fbb9f..c68d0c2c7 100644\n--- a/README.rst\n+++ b/README.rst\n@@ -288,13 +288,13 @@ The different aspects involved on a translation are adapted, so it\'s possible to\n Language get/set via an unified adapter\n ---------------------------------------\n \n-In order to access and modify the language of a content type regardless the type (Archetypes/Dexterity) there is a interface/adapter::\n+In order to access and modify the language of a content type there is a interface/adapter::\n \n-    Products.CMFPlone.interfaces.ILanguage\n+    plone.base.interfaces.ILanguage\n \n You can use::\n \n-    from Products.CMFPlone.interfaces import ILanguage\n+    from plone.base.interfaces import ILanguage\n     language = ILanguage(context).get_language()\n \n or in case you want to set the language of a content::\ndiff --git a/news/411.bugfix b/news/411.bugfix\nnew file mode 100644\nindex 000000000..7100d250d\n--- /dev/null\n+++ b/news/411.bugfix\n@@ -0,0 +1,2 @@\n+Use plone.base imports. Removes deprecation warnings.\n+[jensens]\ndiff --git a/src/plone/app/multilingual/browser/configure.zcml b/src/plone/app/multilingual/browser/configure.zcml\nindex 3cb5f8b06..a8a45c7e3 100644\n--- a/src/plone/app/multilingual/browser/configure.zcml\n+++ b/src/plone/app/multilingual/browser/configure.zcml\n@@ -81,7 +81,7 @@\n   <!-- Control panel -->\n   <browser:page\n     name="language-controlpanel"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+    for="plone.base.interfaces.IPloneSiteRoot"\n     class=".controlpanel.LanguageControlPanel"\n     permission="plone.app.controlpanel.Language"\n     layer="..interfaces.IPloneAppMultilingualInstalled"\n@@ -90,14 +90,14 @@\n   <!-- Migration Tab -->\n   <browser:page\n       name="lp-migration"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.MigrationView"\n       permission="plone.app.multilingual.ManageTranslations"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n \n   <browser:page\n       name="multilingual-map"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.multilingualMapView"\n       permission="plone.app.multilingual.ManageTranslations"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -106,7 +106,7 @@\n   <browser:viewlet\n       zcml:condition="installed plone.app.controlpanel"\n       name="plone.app.multilingual.supported-languages-notice"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       view="plone.app.controlpanel.interfaces.IPloneControlPanelView"\n       manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n       class=".viewlets.OneLanguageConfiguredNoticeViewlet"\n@@ -116,8 +116,8 @@\n   <browser:viewlet\n       zcml:condition="not-installed plone.app.controlpanel"\n       name="plone.app.multilingual.supported-languages-notice"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      view="Products.CMFPlone.interfaces.controlpanel.IPloneControlPanelView"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n+      view="plone.base.interfaces.controlpanel.IPloneControlPanelView"\n       manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n       class=".viewlets.OneLanguageConfiguredNoticeViewlet"\n       template="templates/languages-notice.pt"\n@@ -172,7 +172,7 @@\n   <!-- Not Translated Yet -->\n   <browser:page\n       name="not_translated_yet"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".helper_views.not_translated_yet"\n       permission="zope.Public"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -180,14 +180,14 @@\n   <!-- Multilingual Map ajax helper -->\n   <browser:page\n       name="multilingual-map-ajax"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.multilingualMapViewJSON"\n       permission="plone.app.multilingual.ManageTranslations"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n \n   <!-- Default browser view -->\n   <browser:view\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".switcher.LanguageSwitcher"\n       name="language-switcher"\n       permission="zope.Public"\n@@ -258,7 +258,7 @@\n   <!-- Optional initial step - reindex Language index -->\n   <browser:page\n       name="reindex-language-index"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMReindexLanguageIndex"\n       permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -266,7 +266,7 @@\n   <!-- Step 1 - Relocates the content if needed -->\n   <browser:page\n       name="relocate-content"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.moveContentToProperRLF"\n       permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -274,7 +274,7 @@\n   <!-- Step 2 - Migrate multilingual catalog info -->\n   <browser:page\n       name="transfer-lp-catalog"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMView"\n       permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -282,7 +282,7 @@\n   <!-- Step 3  - Cleanup tasks after migration -->\n   <browser:page\n       name="after-migration-cleanup"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMAfterView"\n       permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\n@@ -299,7 +299,7 @@\n   <!-- To delete -->\n   <browser:page\n       name="lp-migration-after"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.MigrationViewAfter"\n       permission="plone.app.multilingual.ManageTranslations"\n       layer="..interfaces.IPloneAppMultilingualInstalled"/>\ndiff --git a/src/plone/app/multilingual/browser/controlpanel.py b/src/plone/app/multilingual/browser/controlpanel.py\nindex 98ef2422f..76d88e482 100644\n--- a/src/plone/app/multilingual/browser/controlpanel.py\n+++ b/src/plone/app/multilingual/browser/controlpanel.py\n@@ -6,9 +6,7 @@\n from plone.app.uuid.utils import uuidToObject\n from plone.base.interfaces import ILanguage\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.controlpanel.browser.language import (  # noqa\n-    LanguageControlPanelForm,\n-)\n+from Products.CMFPlone.controlpanel.browser.language import LanguageControlPanelForm\n from Products.Five import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.statusmessages.interfaces import IStatusMessage\ndiff --git a/src/plone/app/multilingual/browser/menu.py b/src/plone/app/multilingual/browser/menu.py\nindex e6c236f45..5c14a5ade 100644\n--- a/src/plone/app/multilingual/browser/menu.py\n+++ b/src/plone/app/multilingual/browser/menu.py\n@@ -12,15 +12,14 @@\n from plone.app.multilingual.interfaces import IPloneAppMultilingualInstalled\n from plone.app.multilingual.interfaces import ITG\n from plone.app.multilingual.interfaces import ITranslatable\n-from plone.app.multilingual.interfaces import ITranslationManager\n from plone.app.multilingual.interfaces import LANGUAGE_INDEPENDENT\n from plone.app.multilingual.permissions import ManageTranslations\n from plone.base.interfaces import ILanguage\n from plone.memoize import view\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.defaultpage import is_default_page\n-from Products.CMFPlone.utils import safe_unicode\n+from plone.base.defaultpage import is_default_page\n+from plone.base.utils import safe_text\n from zope.browsermenu.menu import BrowserMenu\n from zope.browsermenu.menu import BrowserSubMenuItem\n from zope.component import getUtility\n@@ -97,9 +96,8 @@ def getMenuItems(self, context, request):\n         )\n         for brain in results:\n             assets_folder_url = brain.getURL() + "/folder_contents"\n-            assets_folder_title = safe_unicode(brain.Title)\n+            assets_folder_title = safe_text(brain.Title)\n             break\n-\n         # Menu items\n         results = []\n         results_folder = []\ndiff --git a/src/plone/app/multilingual/browser/setup.py b/src/plone/app/multilingual/browser/setup.py\nindex 9125e1d89..06e9c259d 100644\n--- a/src/plone/app/multilingual/browser/setup.py\n+++ b/src/plone/app/multilingual/browser/setup.py\n@@ -2,7 +2,6 @@\n from plone.app.dexterity.behaviors.exclfromnav import IExcludeFromNavigation\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.app.multilingual import _\n-from plone.app.multilingual.dx.interfaces import IDexterityTranslatable\n from plone.app.multilingual.interfaces import ITranslatable\n from plone.app.multilingual.interfaces import ITranslationManager\n from plone.app.multilingual.interfaces import LANGUAGE_INDEPENDENT\n@@ -12,7 +11,7 @@\n from plone.i18n.locales.languages import _combinedlanguagelist\n from plone.i18n.locales.languages import _languagelist\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import _createObjectByType\n+from plone.base.utils import unrestricted_construct_instance\n from Products.Five import BrowserView\n from zope.component.hooks import getSite\n from zope.event import notify\n@@ -148,8 +147,8 @@ def setUpLanguage(self, code, name):\n         )\n \n         if folder is None:\n-            _createObjectByType(self.folder_type, self.context, folderId)\n-            _createObjectByType(\n+            unrestricted_construct_instance(self.folder_type, self.context, folderId)\n+            unrestricted_construct_instance(\n                 self.folder_type_language_independent,\n                 self.context[folderId],\n                 assets_folder_id,\ndiff --git a/src/plone/app/multilingual/configure.zcml b/src/plone/app/multilingual/configure.zcml\nindex e2541fcd1..98dd5f8e7 100644\n--- a/src/plone/app/multilingual/configure.zcml\n+++ b/src/plone/app/multilingual/configure.zcml\n@@ -137,7 +137,7 @@\n   <utility\n       factory=".setuphandlers.HiddenProfiles"\n       name="plone.app.multilingual"\n-      provides="Products.CMFPlone.interfaces.INonInstallable"/>\n+      provides="plone.base.interfaces.INonInstallable"/>\n \n   <genericsetup:registerProfile\n       name="default"\n@@ -145,7 +145,7 @@\n       description="Install to enable multilingual content support with plone.app.multilingual"\n       directory="profiles/default"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n       post_handler=".setuphandlers.init_pam"/>\n \n   <genericsetup:registerProfile\n@@ -154,7 +154,7 @@\n       description="Uninstall, removes multilingual content support with plone.app.multilingual"\n       directory="profiles/uninstall"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n-      for="Products.CMFPlone.interfaces.IPloneSiteRoot"/>\n+      for="plone.base.interfaces.IPloneSiteRoot"/>\n \n   <genericsetup:importStep\n       name="plone.app.multilingual_default"\ndiff --git a/src/plone/app/multilingual/dx/cloner.py b/src/plone/app/multilingual/dx/cloner.py\nindex 0906eaf76..340692ac3 100644\n--- a/src/plone/app/multilingual/dx/cloner.py\n+++ b/src/plone/app/multilingual/dx/cloner.py\n@@ -4,7 +4,7 @@\n from plone.app.multilingual.interfaces import ITranslationManager\n from plone.base.interfaces import ILanguage\n from plone.dexterity.utils import iterSchemata\n-from Products.CMFPlone.utils import safe_unicode\n+from plone.base.utils import safe_text\n from z3c.relationfield import RelationValue\n from z3c.relationfield.interfaces import IRelationList\n from z3c.relationfield.interfaces import IRelationValue\n@@ -96,7 +96,7 @@ def copy_fields(self, translation):\n                         field_changed = value != translation_value\n                     if field_changed:\n                         changed = True\n-                        setattr(translation_adapter, field_name, safe_unicode(value))\n+                        setattr(translation_adapter, field_name, safe_text(value))\n \n         # If at least one field has been copied over to the translation\n         # we need to inform subscriber to trigger an ObjectModifiedEvent\ndiff --git a/src/plone/app/multilingual/dx/configure.zcml b/src/plone/app/multilingual/dx/configure.zcml\nindex bbd9c0c02..9d4e60c32 100644\n--- a/src/plone/app/multilingual/dx/configure.zcml\n+++ b/src/plone/app/multilingual/dx/configure.zcml\n@@ -43,7 +43,7 @@\n \n   <adapter\n       for="plone.dexterity.interfaces.IDexterityContent"\n-      provides="Products.CMFPlone.interfaces.ILanguage"\n+      provides="plone.base.interfaces.ILanguage"\n       factory=".language.Language"/>\n \n   <adapter\ndiff --git a/src/plone/app/multilingual/profiles/default/registry.xml b/src/plone/app/multilingual/profiles/default/registry.xml\nindex c191098d9..d10517d7f 100644\n--- a/src/plone/app/multilingual/profiles/default/registry.xml\n+++ b/src/plone/app/multilingual/profiles/default/registry.xml\n@@ -2,12 +2,12 @@\n <registry>\n \n   <records prefix="plone.bundles/multilingual"\n-            interface=\'Products.CMFPlone.interfaces.IBundleRegistry\'>\n+            interface=\'plone.base.interfaces.IBundleRegistry\'>\n     <value key="enabled">True</value>\n     <value key="csscompilation">++resource++plone.app.multilingual.stylesheet/multilingual.css</value>\n   </records>\n \n-  <records interface="Products.CMFPlone.interfaces.ITinyMCEResourceTypesSchema" prefix="plone">\n+  <records interface="plone.base.interfaces.ITinyMCEResourceTypesSchema" prefix="plone">\n     <value key="contains_objects" purge="false"><element>LIF</element></value>\n   </records>\n \ndiff --git a/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml b/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\nindex deb3fe62f..9f9fe2c53 100644\n--- a/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\n+++ b/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\n@@ -3,19 +3,19 @@\n \n   <!-- remove old resource and bundle registration -->\n   <record name="plone.bundles/plone-legacy.resources"\n-          interface="Products.CMFPlone.interfaces.resources.IBundleRegistry" field="resources">\n+          interface="plone.base.interfaces.resources.IBundleRegistry" field="resources">\n     <value purge="false">\n       <element remove="true">multilingual</element>\n     </value>\n   </record>\n   <records prefix="plone.resources/multilingual"\n-           interface=\'Products.CMFPlone.interfaces.IResourceRegistry\'\n+           interface=\'plone.base.interfaces.IResourceRegistry\'\n            remove="true">\n   </records>\n \n   <!-- register new bundle -->\n   <records prefix="plone.bundles/multilingual"\n-            interface=\'Products.CMFPlone.interfaces.IBundleRegistry\'>\n+            interface=\'plone.base.interfaces.IBundleRegistry\'>\n     <value key="enabled">True</value>\n     <value key="compile">False</value>\n     <value key="merge_with">logged-in</value>\ndiff --git a/src/plone/app/multilingual/setuphandlers.py b/src/plone/app/multilingual/setuphandlers.py\nindex 5e2ba5ab1..3bdde1df1 100644\n--- a/src/plone/app/multilingual/setuphandlers.py\n+++ b/src/plone/app/multilingual/setuphandlers.py\n@@ -1,22 +1,11 @@\n from logging import getLogger\n from plone.app.multilingual.browser.setup import SetupMultilingualSite\n-from plone.app.multilingual.interfaces import ITranslatable\n from plone.app.multilingual.itg import addAttributeTG\n from plone.base.interfaces import INonInstallable\n-from Products.CMFPlone.utils import getToolByName\n+from Products.CMFCore.utils import getToolByName\n from zope.component.hooks import getSite\n from zope.interface import implementer\n \n-import pkg_resources\n-\n-\n-try:\n-    pkg_resources.get_distribution("plone.app.contenttypes")\n-except pkg_resources.DistributionNotFound:\n-    HAS_PLONE_APP_CONTENTTYPES = False\n-else:\n-    HAS_PLONE_APP_CONTENTTYPES = True\n-\n \n @implementer(INonInstallable)\n class HiddenProfiles:\ndiff --git a/src/plone/app/multilingual/tests/test_selector.py b/src/plone/app/multilingual/tests/test_selector.py\nindex a25c49b7a..eea4f1850 100644\n--- a/src/plone/app/multilingual/tests/test_selector.py\n+++ b/src/plone/app/multilingual/tests/test_selector.py\n@@ -16,7 +16,7 @@\n from plone.registry.interfaces import IRegistry\n from plone.testing.z2 import Browser\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import safe_nativestring\n+from plone.base.utils import safe_text\n from urllib.parse import parse_qs\n from urllib.parse import urlparse\n from zope.component import getUtility\n@@ -759,9 +759,9 @@ def assertUrlsEqual(self, url1, url2):\n         """The order of query-strings is sometimes random in python 3\n         This compares urls disregarding the order.\n         """\n-        parsed_url_1 = urlparse(safe_nativestring(url1))\n+        parsed_url_1 = urlparse(safe_text(url1))\n         parse_qs_1 = parse_qs(parsed_url_1.query)\n-        parsed_url_2 = urlparse(safe_nativestring(url2))\n+        parsed_url_2 = urlparse(safe_text(url2))\n         parse_qs_2 = parse_qs(parsed_url_2.query)\n         self.assertEqual(parsed_url_1[0], parsed_url_2[0])\n         self.assertEqual(parsed_url_1[1], parsed_url_2[1])\ndiff --git a/src/plone/app/multilingual/tests/test_uninstall.py b/src/plone/app/multilingual/tests/test_uninstall.py\nindex 28df6bba4..cbce1e51a 100644\n--- a/src/plone/app/multilingual/tests/test_uninstall.py\n+++ b/src/plone/app/multilingual/tests/test_uninstall.py\n@@ -1,10 +1,8 @@\n from plone import api\n-from plone.app.multilingual.testing import (  # noqa\n-    PLONE_APP_MULTILINGUAL_INTEGRATION_TESTING,\n-)\n+from plone.app.multilingual.testing import PLONE_APP_MULTILINGUAL_INTEGRATION_TESTING\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n-from Products.CMFPlone.utils import get_installer\n+from plone.base.utils import get_installer\n \n import unittest\n \ndiff --git a/src/plone/app/multilingual/upgrades.py b/src/plone/app/multilingual/upgrades.py\nindex 77cdf6842..e9cc710ea 100644\n--- a/src/plone/app/multilingual/upgrades.py\n+++ b/src/plone/app/multilingual/upgrades.py\n@@ -2,7 +2,7 @@\n from plone.base.interfaces import ILanguage\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import _createObjectByType\n+from plone.base.utils import unrestricted_construct_instance\n from time import time\n from zope.component import getUtility\n \n@@ -70,7 +70,7 @@ def migration_pam_1_to_2(context):\n         old = portal[old_id]\n         logger.info(f"{code} - Phase 2: Moving objects into new LRF...")\n \n-        _createObjectByType(type_name, portal, code)\n+        unrestricted_construct_instance(type_name, portal, code)\n         new = portal[code]\n         new.setTitle(name)\n         ILanguage(new).set_language(code)\ndiff --git a/src/plone/app/multilingual/upgrades.zcml b/src/plone/app/multilingual/upgrades.zcml\nindex adbc8be97..3ff68e0b2 100644\n--- a/src/plone/app/multilingual/upgrades.zcml\n+++ b/src/plone/app/multilingual/upgrades.zcml\n@@ -24,7 +24,7 @@\n       name="to_3"\n       title="Update new registry key"\n       directory="profiles/upgrades/to_3"\n-      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n \n@@ -40,7 +40,7 @@\n       name="to_4"\n       title="Update bundle registration"\n       directory="profiles/upgrades/to_4"\n-      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n \n@@ -56,7 +56,7 @@\n       name="to_1000"\n       title="Update to 1000"\n       directory="profiles/upgrades/to_1000"\n-      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n \n'

