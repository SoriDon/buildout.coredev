Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2017-06-21T10:10:38+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.Archetypes/commit/83a04f005552f99c9c0ec16df4579d5eba1f84f4

Prevent AttributeError on deleting a Reference from a object that is gone.
Fixes https://github.com/plone/plone.app.contenttypes/issues/41

Files changed:
M CHANGES.rst
M Products/Archetypes/ReferenceEngine.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4f95beed..ef472c6b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Prevent AttributeError on deleting a Reference from a object that is gone.
+  Fixes https://github.com/plone/plone.app.contenttypes/issues/41
+  [pbauer]
 
 
 1.14.1 (2017-06-16)
diff --git a/Products/Archetypes/ReferenceEngine.py b/Products/Archetypes/ReferenceEngine.py
index 36003c05..36c9e8cd 100644
--- a/Products/Archetypes/ReferenceEngine.py
+++ b/Products/Archetypes/ReferenceEngine.py
@@ -555,6 +555,8 @@ def _getUUIDFor(self, object):
     def _deleteReference(self, referenceObject):
         try:
             sobj = referenceObject.getSourceObject()
+            if sobj is None:
+                return
             referenceObject.delHook(self, sobj,
                                     referenceObject.getTargetObject())
         except ReferenceException:


Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2017-07-04T17:49:39+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.Archetypes/commit/51bca84f0a3f7ff54a330e4fcba8afe7fda7b654

Merge pull request #91 from plone/fix_delete_reference

Prevent AttributeError on deleting a Reference

Files changed:
M CHANGES.rst
M Products/Archetypes/ReferenceEngine.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4f95beed..ef472c6b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Prevent AttributeError on deleting a Reference from a object that is gone.
+  Fixes https://github.com/plone/plone.app.contenttypes/issues/41
+  [pbauer]
 
 
 1.14.1 (2017-06-16)
diff --git a/Products/Archetypes/ReferenceEngine.py b/Products/Archetypes/ReferenceEngine.py
index 36003c05..36c9e8cd 100644
--- a/Products/Archetypes/ReferenceEngine.py
+++ b/Products/Archetypes/ReferenceEngine.py
@@ -555,6 +555,8 @@ def _getUUIDFor(self, object):
     def _deleteReference(self, referenceObject):
         try:
             sobj = referenceObject.getSourceObject()
+            if sobj is None:
+                return
             referenceObject.delHook(self, sobj,
                                     referenceObject.getTargetObject())
         except ReferenceException:


