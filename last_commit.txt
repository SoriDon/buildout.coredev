Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2017-04-19T11:40:27+02:00
Author: Paul Grunewald (pgrunewald) <paul.grunewald@tu-dresden.de>
Commit: https://github.com/plone/Products.Archetypes/commit/dd6d8a4a9a07ab73d5a6a808808385daba58bb92

Fix bug with Widget's postback attribute

Files changed:
M CHANGES.rst
M Products/Archetypes/skins/archetypes/widgets/field.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 735e829..b251bd9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix bugs with Widget's postback attribute, that prevented fields from
+  being populated with the submitted empty value in the case of an error.
+  [pgrunewald]
 
 
 1.14.0 (2017-04-01)
diff --git a/Products/Archetypes/skins/archetypes/widgets/field.pt b/Products/Archetypes/skins/archetypes/widgets/field.pt
index 94f00d5..939554f 100644
--- a/Products/Archetypes/skins/archetypes/widgets/field.pt
+++ b/Products/Archetypes/skins/archetypes/widgets/field.pt
@@ -67,8 +67,7 @@
                     edit_accessor python:field.getEditAccessor(here);
                     getMethod python:(widget.populate and (edit_accessor or accessor)) or None;
                     value python:getMethod and getMethod();
-                    value python:widget.postback and request.get(fieldName, value);
-                    value python:value == '' and (getMethod and getMethod()) or value;
+                    value python:request.get(fieldName, value) if widget.postback else value;
                     portal python:context.portal_url.getPortalObject();
                     visCondition python:field.widget.testCondition(context.aq_inner.getParentNode(), portal, context);
                     error_id python:errors.get(fieldName)">


Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2017-04-19T15:55:26+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.Archetypes/commit/580f8042761eb1b8487f97f053fb67ea0bbb53f6

Merge pull request #81 from plone/fix-postback-master

Fix bug with Widget's postback attribute

Files changed:
M CHANGES.rst
M Products/Archetypes/skins/archetypes/widgets/field.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 735e829..b251bd9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix bugs with Widget's postback attribute, that prevented fields from
+  being populated with the submitted empty value in the case of an error.
+  [pgrunewald]
 
 
 1.14.0 (2017-04-01)
diff --git a/Products/Archetypes/skins/archetypes/widgets/field.pt b/Products/Archetypes/skins/archetypes/widgets/field.pt
index 94f00d5..939554f 100644
--- a/Products/Archetypes/skins/archetypes/widgets/field.pt
+++ b/Products/Archetypes/skins/archetypes/widgets/field.pt
@@ -67,8 +67,7 @@
                     edit_accessor python:field.getEditAccessor(here);
                     getMethod python:(widget.populate and (edit_accessor or accessor)) or None;
                     value python:getMethod and getMethod();
-                    value python:widget.postback and request.get(fieldName, value);
-                    value python:value == '' and (getMethod and getMethod()) or value;
+                    value python:request.get(fieldName, value) if widget.postback else value;
                     portal python:context.portal_url.getPortalObject();
                     visCondition python:field.widget.testCondition(context.aq_inner.getParentNode(), portal, context);
                     error_id python:errors.get(fieldName)">


