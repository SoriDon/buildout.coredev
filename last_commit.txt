Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2022-08-06T20:59:33+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/fda639026b9e7f5d0ee462a5738d8a8ba9711a40

build mime-type icon url with absolute url

Files changed:
A news/44.bugfix
M plone/app/contentlisting/contentlisting.py

b'diff --git a/news/44.bugfix b/news/44.bugfix\nnew file mode 100644\nindex 0000000..550fb40\n--- /dev/null\n+++ b/news/44.bugfix\n@@ -0,0 +1,2 @@\n+Build mime-type icon url with the absolute url. Fixes #44\n+[erral]\ndiff --git a/plone/app/contentlisting/contentlisting.py b/plone/app/contentlisting/contentlisting.py\nindex cab5f87..fda2a36 100644\n--- a/plone/app/contentlisting/contentlisting.py\n+++ b/plone/app/contentlisting/contentlisting.py\n@@ -1,7 +1,7 @@\n from Acquisition import aq_base\n from plone.app.contentlisting.interfaces import IContentListing\n from plone.app.contentlisting.interfaces import IContentListingObject\n-from plone.app.layout.navigation.root import getNavigationRoot\n+from plone.app.layout.navigation.root import getNavigationRootObject\n from plone.base.interfaces import INavigationSchema\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.registry.interfaces import IRegistry\n@@ -162,7 +162,9 @@ def isVisibleInNav(self):\n \n     def MimeTypeIcon(self):\n         mimeicon = None\n-        navroot = getNavigationRoot(self._brain)\n+        portal_url_object = getToolByName(self._brain, \'portal_url\')\n+        portal = portal_url_object.getPortalObject()\n+        navroot = getNavigationRootObject(self._brain, portal)\n         contenttype = aq_base(\n             getattr(self._brain, "mime_type", None),\n         )\n@@ -174,7 +176,7 @@ def MimeTypeIcon(self):\n             ctype = mtt.lookup(contenttype)\n             if ctype:\n                 mimeicon = os.path.join(\n-                    navroot,\n+                    navroot.absolute_url(),\n                     guess_icon_path(ctype[0]),\n                 )\n \n'

Repository: plone.app.contentlisting


Branch: refs/heads/master
Date: 2022-08-13T17:16:33+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contentlisting/commit/e22a68a058eaa3ed5613c619c4a6bcdaac9b65aa

Merge pull request #46 from plone/erral-issue-44-master

build mime-type icon url with absolute url

Files changed:
A news/44.bugfix
M plone/app/contentlisting/contentlisting.py

b'diff --git a/news/44.bugfix b/news/44.bugfix\nnew file mode 100644\nindex 0000000..550fb40\n--- /dev/null\n+++ b/news/44.bugfix\n@@ -0,0 +1,2 @@\n+Build mime-type icon url with the absolute url. Fixes #44\n+[erral]\ndiff --git a/plone/app/contentlisting/contentlisting.py b/plone/app/contentlisting/contentlisting.py\nindex cab5f87..fda2a36 100644\n--- a/plone/app/contentlisting/contentlisting.py\n+++ b/plone/app/contentlisting/contentlisting.py\n@@ -1,7 +1,7 @@\n from Acquisition import aq_base\n from plone.app.contentlisting.interfaces import IContentListing\n from plone.app.contentlisting.interfaces import IContentListingObject\n-from plone.app.layout.navigation.root import getNavigationRoot\n+from plone.app.layout.navigation.root import getNavigationRootObject\n from plone.base.interfaces import INavigationSchema\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.registry.interfaces import IRegistry\n@@ -162,7 +162,9 @@ def isVisibleInNav(self):\n \n     def MimeTypeIcon(self):\n         mimeicon = None\n-        navroot = getNavigationRoot(self._brain)\n+        portal_url_object = getToolByName(self._brain, \'portal_url\')\n+        portal = portal_url_object.getPortalObject()\n+        navroot = getNavigationRootObject(self._brain, portal)\n         contenttype = aq_base(\n             getattr(self._brain, "mime_type", None),\n         )\n@@ -174,7 +176,7 @@ def MimeTypeIcon(self):\n             ctype = mtt.lookup(contenttype)\n             if ctype:\n                 mimeicon = os.path.join(\n-                    navroot,\n+                    navroot.absolute_url(),\n                     guess_icon_path(ctype[0]),\n                 )\n \n'

