Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-10-21T16:09:22-07:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/1103582e9984979797b4ba2aaeda296752ef0d39

Fix the test coverage for getNavigationRoot (#3659)

When moving the navtree properties to the registry part of the test
coverage was lost.
This patch shows that even if the registry does not contain the
plone.root record a sane value is returned.

Some tests were still using the navtree properties and they were passing by chance.

Files changed:
M Products/CMFPlone/tests/testNavTree.py

b'diff --git a/Products/CMFPlone/tests/testNavTree.py b/Products/CMFPlone/tests/testNavTree.py\nindex efd469252c..1b4997b48a 100644\n--- a/Products/CMFPlone/tests/testNavTree.py\n+++ b/Products/CMFPlone/tests/testNavTree.py\n@@ -531,19 +531,17 @@ def testCurrentParent(self):\n class TestNavigationRoot(PloneTestCase.PloneTestCase):\n \n     def testGetNavigationRootPropertyNotSet(self):\n-        self.portal.portal_registry[\'plone.root\'] = \'/\'\n+        del self.portal.portal_registry.records["plone.root"]\n         root = getNavigationRoot(self.portal)\n         self.assertEqual(root, \'/\'.join(self.portal.getPhysicalPath()))\n \n     def testGetNavigationRootPropertyEmptyNoVirtualHost(self):\n-        self.portal.portal_properties.navtree_properties \\\n-            .manage_changeProperties(root=\'\')\n+        self.portal.portal_registry[\'plone.root\'] = \'\'\n         root = getNavigationRoot(self.portal)\n         self.assertEqual(root, \'/\'.join(self.portal.getPhysicalPath()))\n \n     def testGetNavigationRootPropertyIsRoot(self):\n-        self.portal.portal_properties.navtree_properties \\\n-            .manage_changeProperties(root=\'/\')\n+        self.portal.portal_registry[\'plone.root\'] = \'/\'\n         root = getNavigationRoot(self.portal)\n         self.assertEqual(root, \'/\'.join(self.portal.getPhysicalPath()))\n \n@@ -551,7 +549,7 @@ def testGetNavigationRootPropertyIsFolder(self):\n         folderPath = \'/\'.join(self.folder.getPhysicalPath())\n         portalPath = \'/\'.join(self.portal.getPhysicalPath())\n         relativePath = folderPath[len(portalPath):]\n-        self.portal.portal_registry[\'plone.root\'] = str(relativePath)\n+        self.portal.portal_registry[\'plone.root\'] = relativePath\n         root = getNavigationRoot(self.portal)\n         self.assertEqual(root, folderPath)\n \n'

