Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2017-09-01T17:29:38+02:00
Author: Slavisa Karalic (karalics) <slavisa.karalic@gmail.com>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/bc590deaf95b9a24d4eba29d4387d36edd70be80

Fixing potential UnicodeError

Files changed:
M CHANGES.rst
M plone/formwidget/namedfile/converter.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2cc2aa0..1ed42f7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fixing UnicodeError when the @@z3cform_validate_field view sends
+  a filename with type unicode. (collective.easyform in our case)
 
 
 2.0.3 (2017-07-03)
diff --git a/plone/formwidget/namedfile/converter.py b/plone/formwidget/namedfile/converter.py
index 28dd4d4..66b89a3 100644
--- a/plone/formwidget/namedfile/converter.py
+++ b/plone/formwidget/namedfile/converter.py
@@ -45,6 +45,8 @@ def toFieldValue(self, value):
                 return self.field.missing_value
 
         else:
+            if isinstance(value, unicode):
+                value = value.encode('utf-8')
             return self.field._type(data=str(value))
 
 


Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2017-09-04T11:55:38+02:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/879a536b60ca3d8e2c2a7fc60707744b4ee26832

Merge pull request #29 from karalics/master

Fixing potential UnicodeError

Files changed:
M CHANGES.rst
M plone/formwidget/namedfile/converter.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2cc2aa0..1ed42f7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fixing UnicodeError when the @@z3cform_validate_field view sends
+  a filename with type unicode. (collective.easyform in our case)
 
 
 2.0.3 (2017-07-03)
diff --git a/plone/formwidget/namedfile/converter.py b/plone/formwidget/namedfile/converter.py
index 28dd4d4..66b89a3 100644
--- a/plone/formwidget/namedfile/converter.py
+++ b/plone/formwidget/namedfile/converter.py
@@ -45,6 +45,8 @@ def toFieldValue(self, value):
                 return self.field.missing_value
 
         else:
+            if isinstance(value, unicode):
+                value = value.encode('utf-8')
             return self.field._type(data=str(value))
 
 


