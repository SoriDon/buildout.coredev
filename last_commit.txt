Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-05-06T16:19:17+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.restapi/commit/b8f44be638fde577c99144234be04667f6720b26

translate addon titles

Files changed:
A news/1412.bugfix
M src/plone/restapi/services/addons/addons.py

b'diff --git a/news/1412.bugfix b/news/1412.bugfix\nnew file mode 100644\nindex 000000000..9fed2e25e\n--- /dev/null\n+++ b/news/1412.bugfix\n@@ -0,0 +1,2 @@\n+Translate addon titles on @addon controlpanel\n+[erral]\ndiff --git a/src/plone/restapi/services/addons/addons.py b/src/plone/restapi/services/addons/addons.py\nindex 8f6a50846..d00562c38 100644\n--- a/src/plone/restapi/services/addons/addons.py\n+++ b/src/plone/restapi/services/addons/addons.py\n@@ -5,6 +5,7 @@\n from Products.GenericSetup import EXTENSION\n from Products.GenericSetup.tool import UNKNOWN\n from zope.component import getAllUtilitiesRegisteredFor\n+from zope.i18n import translate\n \n import logging\n import pkg_resources\n@@ -31,7 +32,7 @@ def serializeAddon(self, addon):\n         return {\n             "@id": "{}/@addons/{}".format(self.context.absolute_url(), addon["id"]),\n             "id": addon["id"],\n-            "title": addon["title"],\n+            "title": translate(addon["title"], context=self.request),\n             "description": addon["description"],\n             "install_profile_id": addon["install_profile_id"],\n             "is_installed": addon["is_installed"],\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-05-06T16:59:48+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.restapi/commit/baa018e65dff1766cf8723b05ef956a107b0ee8f

tests

Files changed:
A src/plone/restapi/tests/http-examples/translated_messages_addons.req
A src/plone/restapi/tests/http-examples/translated_messages_addons.resp
M docs/source/i18n.md
M src/plone/restapi/services/addons/addons.py
M src/plone/restapi/tests/test_documentation.py

b'diff --git a/docs/source/i18n.md b/docs/source/i18n.md\nindex 46642e50b..e4b498430 100644\n--- a/docs/source/i18n.md\n+++ b/docs/source/i18n.md\n@@ -83,3 +83,17 @@ All the relevant messages will be shown translated:\n ```{literalinclude} ../../src/plone/restapi/tests/http-examples/translated_messages_object_history.resp\n :language: http\n ```\n+\n+The same happens in the `@addons` endpoint.\n+All addon names and descriptions will be shown translated:\n+\n+```{eval-rst}\n+..  http:example:: curl httpie python-requests\n+    :request: ../../src/plone/restapi/tests/http-examples/translated_messages_addons.req\n+```\n+\n+\xe2\x80\xa6and the response:\n+\n+```{literalinclude} ../../src/plone/restapi/tests/http-examples/translated_messages_addons.resp\n+:language: http\n+```\ndiff --git a/src/plone/restapi/services/addons/addons.py b/src/plone/restapi/services/addons/addons.py\nindex d00562c38..64e70d85a 100644\n--- a/src/plone/restapi/services/addons/addons.py\n+++ b/src/plone/restapi/services/addons/addons.py\n@@ -33,7 +33,7 @@ def serializeAddon(self, addon):\n             "@id": "{}/@addons/{}".format(self.context.absolute_url(), addon["id"]),\n             "id": addon["id"],\n             "title": translate(addon["title"], context=self.request),\n-            "description": addon["description"],\n+            "description": translate(addon["description"], context=self.request),\n             "install_profile_id": addon["install_profile_id"],\n             "is_installed": addon["is_installed"],\n             "profile_type": addon["profile_type"],\ndiff --git a/src/plone/restapi/tests/http-examples/translated_messages_addons.req b/src/plone/restapi/tests/http-examples/translated_messages_addons.req\nnew file mode 100644\nindex 000000000..d4ee5f8f9\n--- /dev/null\n+++ b/src/plone/restapi/tests/http-examples/translated_messages_addons.req\n@@ -0,0 +1,4 @@\n+GET /plone/@addons HTTP/1.1\n+Accept: application/json\n+Accept-Language: es\n+Authorization: Basic YWRtaW46c2VjcmV0\ndiff --git a/src/plone/restapi/tests/http-examples/translated_messages_addons.resp b/src/plone/restapi/tests/http-examples/translated_messages_addons.resp\nnew file mode 100644\nindex 000000000..005f86376\n--- /dev/null\n+++ b/src/plone/restapi/tests/http-examples/translated_messages_addons.resp\n@@ -0,0 +1,91 @@\n+HTTP/1.1 200 OK\n+Content-Type: application/json\n+\n+{\n+    "items": [\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/Products.CMFPlacefulWorkflow",\n+            "description": "Agrega a Plone la capacidad de cambiar las cadenas de flujo de trabajo para los tipos en cada objeto. Tiene dependencias de los tipos b\\u00e1sicos de Plone.",\n+            "id": "Products.CMFPlacefulWorkflow",\n+            "install_profile_id": "Products.CMFPlacefulWorkflow:CMFPlacefulWorkflow",\n+            "is_installed": false,\n+            "profile_type": "default",\n+            "title": "Soporte de Pol\\u00edtica de Flujo de trabajo (CMFPlacefulWorkflow)",\n+            "uninstall_profile_id": "Products.CMFPlacefulWorkflow:uninstall",\n+            "upgrade_info": {},\n+            "version": "2.0.4"\n+        },\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/collective.MockMailHost",\n+            "description": "Installs the collective.MockMailHost package",\n+            "id": "collective.MockMailHost",\n+            "install_profile_id": "collective.MockMailHost:default",\n+            "is_installed": true,\n+            "profile_type": "default",\n+            "title": "collective.MockMailHost",\n+            "uninstall_profile_id": "",\n+            "upgrade_info": {\n+                "available": false,\n+                "hasProfile": true,\n+                "installedVersion": "2.0.0",\n+                "newVersion": "2.0.0",\n+                "required": false\n+            },\n+            "version": "2.0.0"\n+        },\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/plone.app.iterate",\n+            "description": "A\\u00f1ade soporte de copia de trabajo (modificaciones in situ) a Plone.",\n+            "id": "plone.app.iterate",\n+            "install_profile_id": "plone.app.iterate:default",\n+            "is_installed": false,\n+            "profile_type": "default",\n+            "title": "Soporte de Copia de Trabajo (Repetir)",\n+            "uninstall_profile_id": "plone.app.iterate:uninstall",\n+            "upgrade_info": {},\n+            "version": "4.0.2"\n+        },\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/plone.app.multilingual",\n+            "description": "Instalar para activar el soporte de contenido multiling\\u00fce con plone.app.multilingual",\n+            "id": "plone.app.multilingual",\n+            "install_profile_id": "plone.app.multilingual:default",\n+            "is_installed": false,\n+            "profile_type": "default",\n+            "title": "Soporte Multiidioma",\n+            "uninstall_profile_id": "plone.app.multilingual:uninstall",\n+            "upgrade_info": {},\n+            "version": "5.6.4"\n+        },\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/plone.restapi",\n+            "description": "RESTful hypermedia API for Plone.",\n+            "id": "plone.restapi",\n+            "install_profile_id": "plone.restapi:default",\n+            "is_installed": true,\n+            "profile_type": "default",\n+            "title": "plone.restapi",\n+            "uninstall_profile_id": "plone.restapi:uninstall",\n+            "upgrade_info": {\n+                "available": false,\n+                "hasProfile": true,\n+                "installedVersion": "0006",\n+                "newVersion": "0006",\n+                "required": false\n+            },\n+            "version": "8.22.1.dev0"\n+        },\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/plone.session",\n+            "description": "Soporte opcional de refresco de plone.session.",\n+            "id": "plone.session",\n+            "install_profile_id": "plone.session:default",\n+            "is_installed": false,\n+            "profile_type": "default",\n+            "title": "Soporte de actualizaci\\u00f3n de sesi\\u00f3n",\n+            "uninstall_profile_id": "plone.session:uninstall",\n+            "upgrade_info": {},\n+            "version": "3.7.5"\n+        }\n+    ]\n+}\ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex fe6d391de..ee4ff0f23 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -1644,6 +1644,10 @@ def test_translate_messages_object_history(self):\n             "translated_messages_object_history", response\n         )\n \n+    def test_translate_messages_addons(self):\n+        response = self.api_session.get("/@addons")\n+        save_request_and_response_for_docs("translated_messages_addons", response)\n+\n \n class TestCommenting(TestDocumentationBase):\n \n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-05-06T21:33:43+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.restapi/commit/fe0b704c2607643c32b38dc2d974d8034113a959

Merge pull request #1413 from plone/erral-issue-1412

translate addon titles in @addon endpoint

Files changed:
A news/1412.bugfix
A src/plone/restapi/tests/http-examples/translated_messages_addons.req
A src/plone/restapi/tests/http-examples/translated_messages_addons.resp
M docs/source/i18n.md
M src/plone/restapi/services/addons/addons.py
M src/plone/restapi/tests/test_documentation.py

b'diff --git a/docs/source/i18n.md b/docs/source/i18n.md\nindex 46642e50b..e4b498430 100644\n--- a/docs/source/i18n.md\n+++ b/docs/source/i18n.md\n@@ -83,3 +83,17 @@ All the relevant messages will be shown translated:\n ```{literalinclude} ../../src/plone/restapi/tests/http-examples/translated_messages_object_history.resp\n :language: http\n ```\n+\n+The same happens in the `@addons` endpoint.\n+All addon names and descriptions will be shown translated:\n+\n+```{eval-rst}\n+..  http:example:: curl httpie python-requests\n+    :request: ../../src/plone/restapi/tests/http-examples/translated_messages_addons.req\n+```\n+\n+\xe2\x80\xa6and the response:\n+\n+```{literalinclude} ../../src/plone/restapi/tests/http-examples/translated_messages_addons.resp\n+:language: http\n+```\ndiff --git a/news/1412.bugfix b/news/1412.bugfix\nnew file mode 100644\nindex 000000000..9fed2e25e\n--- /dev/null\n+++ b/news/1412.bugfix\n@@ -0,0 +1,2 @@\n+Translate addon titles on @addon controlpanel\n+[erral]\ndiff --git a/src/plone/restapi/services/addons/addons.py b/src/plone/restapi/services/addons/addons.py\nindex 8f6a50846..64e70d85a 100644\n--- a/src/plone/restapi/services/addons/addons.py\n+++ b/src/plone/restapi/services/addons/addons.py\n@@ -5,6 +5,7 @@\n from Products.GenericSetup import EXTENSION\n from Products.GenericSetup.tool import UNKNOWN\n from zope.component import getAllUtilitiesRegisteredFor\n+from zope.i18n import translate\n \n import logging\n import pkg_resources\n@@ -31,8 +32,8 @@ def serializeAddon(self, addon):\n         return {\n             "@id": "{}/@addons/{}".format(self.context.absolute_url(), addon["id"]),\n             "id": addon["id"],\n-            "title": addon["title"],\n-            "description": addon["description"],\n+            "title": translate(addon["title"], context=self.request),\n+            "description": translate(addon["description"], context=self.request),\n             "install_profile_id": addon["install_profile_id"],\n             "is_installed": addon["is_installed"],\n             "profile_type": addon["profile_type"],\ndiff --git a/src/plone/restapi/tests/http-examples/translated_messages_addons.req b/src/plone/restapi/tests/http-examples/translated_messages_addons.req\nnew file mode 100644\nindex 000000000..d4ee5f8f9\n--- /dev/null\n+++ b/src/plone/restapi/tests/http-examples/translated_messages_addons.req\n@@ -0,0 +1,4 @@\n+GET /plone/@addons HTTP/1.1\n+Accept: application/json\n+Accept-Language: es\n+Authorization: Basic YWRtaW46c2VjcmV0\ndiff --git a/src/plone/restapi/tests/http-examples/translated_messages_addons.resp b/src/plone/restapi/tests/http-examples/translated_messages_addons.resp\nnew file mode 100644\nindex 000000000..005f86376\n--- /dev/null\n+++ b/src/plone/restapi/tests/http-examples/translated_messages_addons.resp\n@@ -0,0 +1,91 @@\n+HTTP/1.1 200 OK\n+Content-Type: application/json\n+\n+{\n+    "items": [\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/Products.CMFPlacefulWorkflow",\n+            "description": "Agrega a Plone la capacidad de cambiar las cadenas de flujo de trabajo para los tipos en cada objeto. Tiene dependencias de los tipos b\\u00e1sicos de Plone.",\n+            "id": "Products.CMFPlacefulWorkflow",\n+            "install_profile_id": "Products.CMFPlacefulWorkflow:CMFPlacefulWorkflow",\n+            "is_installed": false,\n+            "profile_type": "default",\n+            "title": "Soporte de Pol\\u00edtica de Flujo de trabajo (CMFPlacefulWorkflow)",\n+            "uninstall_profile_id": "Products.CMFPlacefulWorkflow:uninstall",\n+            "upgrade_info": {},\n+            "version": "2.0.4"\n+        },\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/collective.MockMailHost",\n+            "description": "Installs the collective.MockMailHost package",\n+            "id": "collective.MockMailHost",\n+            "install_profile_id": "collective.MockMailHost:default",\n+            "is_installed": true,\n+            "profile_type": "default",\n+            "title": "collective.MockMailHost",\n+            "uninstall_profile_id": "",\n+            "upgrade_info": {\n+                "available": false,\n+                "hasProfile": true,\n+                "installedVersion": "2.0.0",\n+                "newVersion": "2.0.0",\n+                "required": false\n+            },\n+            "version": "2.0.0"\n+        },\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/plone.app.iterate",\n+            "description": "A\\u00f1ade soporte de copia de trabajo (modificaciones in situ) a Plone.",\n+            "id": "plone.app.iterate",\n+            "install_profile_id": "plone.app.iterate:default",\n+            "is_installed": false,\n+            "profile_type": "default",\n+            "title": "Soporte de Copia de Trabajo (Repetir)",\n+            "uninstall_profile_id": "plone.app.iterate:uninstall",\n+            "upgrade_info": {},\n+            "version": "4.0.2"\n+        },\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/plone.app.multilingual",\n+            "description": "Instalar para activar el soporte de contenido multiling\\u00fce con plone.app.multilingual",\n+            "id": "plone.app.multilingual",\n+            "install_profile_id": "plone.app.multilingual:default",\n+            "is_installed": false,\n+            "profile_type": "default",\n+            "title": "Soporte Multiidioma",\n+            "uninstall_profile_id": "plone.app.multilingual:uninstall",\n+            "upgrade_info": {},\n+            "version": "5.6.4"\n+        },\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/plone.restapi",\n+            "description": "RESTful hypermedia API for Plone.",\n+            "id": "plone.restapi",\n+            "install_profile_id": "plone.restapi:default",\n+            "is_installed": true,\n+            "profile_type": "default",\n+            "title": "plone.restapi",\n+            "uninstall_profile_id": "plone.restapi:uninstall",\n+            "upgrade_info": {\n+                "available": false,\n+                "hasProfile": true,\n+                "installedVersion": "0006",\n+                "newVersion": "0006",\n+                "required": false\n+            },\n+            "version": "8.22.1.dev0"\n+        },\n+        {\n+            "@id": "http://localhost:55001/plone/@addons/plone.session",\n+            "description": "Soporte opcional de refresco de plone.session.",\n+            "id": "plone.session",\n+            "install_profile_id": "plone.session:default",\n+            "is_installed": false,\n+            "profile_type": "default",\n+            "title": "Soporte de actualizaci\\u00f3n de sesi\\u00f3n",\n+            "uninstall_profile_id": "plone.session:uninstall",\n+            "upgrade_info": {},\n+            "version": "3.7.5"\n+        }\n+    ]\n+}\ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex fe6d391de..ee4ff0f23 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -1644,6 +1644,10 @@ def test_translate_messages_object_history(self):\n             "translated_messages_object_history", response\n         )\n \n+    def test_translate_messages_addons(self):\n+        response = self.api_session.get("/@addons")\n+        save_request_and_response_for_docs("translated_messages_addons", response)\n+\n \n class TestCommenting(TestDocumentationBase):\n \n'

