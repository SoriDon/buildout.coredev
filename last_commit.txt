Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-17T13:52:48+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/0d284d9bb0b22830886ccb52239a751cfd964f32

Configuring with plone/meta

Files changed:
A .pre-commit-config.yaml
A news/66035512.internal
M .meta.toml
M setup.cfg
M tox.ini

b'diff --git a/.meta.toml b/.meta.toml\nindex 6323538..c1877f3 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -2,7 +2,7 @@\n # https://github.com/plone/meta/tree/master/config/default\n [meta]\n template = "default"\n-commit-id = "0e4e67b6"\n+commit-id = "66035512"\n \n [dependencies]\n mappings = [\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 0000000..99f9928\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,40 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/ambv/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.1\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.1"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/news/66035512.internal b/news/66035512.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/66035512.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/setup.cfg b/setup.cfg\nindex 28522d5..e70eb25 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,11 +1,3 @@\n-[build_sphinx]\n-source-dir = docs/source\n-build-dir  = docs\n-all_files  = 1\n-\n-[upload_sphinx]\n-upload-dir = docs/html\n-\n # Generated from:\n # https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n@@ -27,5 +19,6 @@ ignore =\n ignore =\n     .editorconfig\n     .meta.toml\n+    .pre-commit-config.yaml\n     tox.ini\n     lint-requirements.txt\ndiff --git a/tox.ini b/tox.ini\nindex 5cad975..6a42494 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -6,50 +6,50 @@ envlist =\n     lint\n \n [testenv]\n-py_files = git ls-files "*.py"\n-text_files = git ls-files "*.rst" "*.md"\n-xml_files = git ls-files "*.xml"\n-zcml_files = git ls-files "*.zcml"\n allowlist_externals =\n     sh\n \n [testenv:format]\n-description = automatically reformat python code\n+description = automatically reformat code\n skip_install = true\n deps =\n-    pyupgrade\n-    isort\n-    black\n-    zpretty\n-    -c lint-requirements.txt\n+    pre-commit\n commands =\n-    sh -c \'{[testenv]py_files} | xargs pyupgrade --py38-plus\'\n-    sh -c \'{[testenv]py_files} | xargs isort\'\n-    sh -c \'{[testenv]py_files} | xargs black\'\n-    sh -c \'{[testenv]xml_files} | xargs zpretty -x -i\'\n-    sh -c \'{[testenv]zcml_files} | xargs zpretty -z -i\'\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n \n [testenv:lint]\n description = run linters that will help improve the code style\n skip_install = true\n deps =\n-    flake8\n-    codespell\n-    tomli  # needed for codespell to read pyproject.toml\n-    check-manifest\n-    pyroma\n-    -c lint-requirements.txt\n+    pre-commit\n commands =\n-    sh -c \'{[testenv]py_files} | xargs flake8\'\n-    sh -c \'{[testenv]py_files} | xargs codespell\'\n-    sh -c \'{[testenv]text_files} | xargs codespell\'\n-    check-manifest\n-    pyroma -n 10 .\n+    pre-commit run -a\n \n [testenv:dependencies]\n description = check if the package defines all its dependencies\n deps =\n-    z3c.dependencychecker\n-    -c lint-requirements.txt\n+    z3c.dependencychecker==2.10\n commands =\n     dependencychecker\n+\n+[testenv:dependencies-graph]\n+description = generate a graph with the distribution dependencies\n+deps =\n+    pipdeptree==2.3.3\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    sh -c \'pipdeptree --exclude setuptools,pipdeptree,wheel --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+description = run the tests of the distribution\n+deps =\n+    plone.app.caching[test]\n+    pytest\n+    gocept.pytestlayer\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    pip install -e .[test]\n+    pytest\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-17T14:05:31+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/5b7c554c3fc795c36ae902a7504ab6520a445cea

Fix quotes in controlpanel.pt.

Files changed:
M plone/app/caching/browser/controlpanel.pt

b'diff --git a/plone/app/caching/browser/controlpanel.pt b/plone/app/caching/browser/controlpanel.pt\nindex 1b8c69f..e290744 100644\n--- a/plone/app/caching/browser/controlpanel.pt\n+++ b/plone/app/caching/browser/controlpanel.pt\n@@ -629,7 +629,7 @@\n                                                     </div>\n                                                     <div style="white-space: nowrap" class="discreet rulesetParameterLink" tal:condition="operationInfo/hasOptions">\n                                                         <a  class="editGlobalOperationParameters pat-plone-modal"\n-                                                            data-pat-plone-modal=\'{"actionOptions": {"disableAjaxFormSubmit":true}}\'\n+                                                            data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n                                                             i18n:translate="link_view_edit"\n                                                             tal:attributes="href string:${context/absolute_url}/@@${view/__name__}/edit-operation-global/${operationName}"\n                                                             >View/edit</a>\n@@ -638,13 +638,13 @@\n                                                     <div style="white-space: nowrap" class="discreet rulesetParameterLink"  tal:condition="operationInfo/hasOptions">\n                                                         <tal:block define="hasRulesetOptions python:view.hasRulesetOptions(operationInfo[\'type\'], ruleType[\'name\'])">\n                                                             <a  class="editRulesetOperationParameters pat-plone-modal"\n-                                                                data-pat-plone-modal=\'{"actionOptions": {"disableAjaxFormSubmit":true}}\'\n+                                                                data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n                                                                 tal:condition="hasRulesetOptions"\n                                                                 i18n:translate="link_view_edit_clear"\n                                                                 tal:attributes="href string:${context/absolute_url}/@@${view/__name__}/edit-operation-ruleset/${operationName}/${ruleType/name}"\n                                                                 >View/edit/clear</a>\n                                                             <a  class="editRulesetOperationParameters pat-plone-modal"\n-                                                                data-pat-plone-modal=\'{"actionOptions": {"disableAjaxFormSubmit":true}}\'\n+                                                                data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n                                                                 tal:condition="not:hasRulesetOptions"\n                                                                 i18n:translate="link_create"\n                                                                 tal:attributes="href string:${context/absolute_url}/@@${view/__name__}/edit-operation-ruleset/${operationName}/${ruleType/name}"\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-17T14:06:19+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/6e1d74902f004ed40e6435f7dcb9b54aa7c4d1d5

format with zpretty

Files changed:
M plone/app/caching/browser/controlpanel.pt
M plone/app/caching/browser/edit.pt
M plone/app/caching/browser/import.pt
M plone/app/caching/browser/purge.pt
M plone/app/caching/browser/ramcache.pt

b'diff --git a/plone/app/caching/browser/controlpanel.pt b/plone/app/caching/browser/controlpanel.pt\nindex e290744..8c2748c 100644\n--- a/plone/app/caching/browser/controlpanel.pt\n+++ b/plone/app/caching/browser/controlpanel.pt\n@@ -1,16 +1,18 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<div metal:fill-slot="prefs_configlet_main">\n+    <div metal:fill-slot="prefs_configlet_main">\n \n-<script type="text/javascript">\n+      <script type="text/javascript">\n (function($) {\n \n     if($.fn.prepOverlay){\n@@ -26,279 +28,400 @@\n     }\n \n })(jQuery);\n-</script>\n+      </script>\n \n-    <div class="autotabs">\n+      <div class="autotabs">\n         <ul class="nav nav-tabs">\n-            <li class="nav-item">\n-                <a href=""\n-                   class="nav-link active"\n-                   tal:attributes="href string:${portal_url}/@@caching-controlpanel"\n-                   i18n:translate="label_settings">Change settings</a>\n-              </li>\n-              <li class="nav-item">\n-                <a class="nav-link"\n-                   href=""\n-                   tal:attributes="href string:${portal_url}/@@caching-controlpanel-import"\n-                   i18n:translate="label_import">Import settings</a>\n-              </li>\n-              <li tal:condition="view/purgingEnabled" class="nav-item">\n-                <a class="nav-link"\n-                   href=""\n-                   tal:attributes="href string:${portal_url}/@@caching-controlpanel-purge"\n-                   i18n:translate="label_purging">Purge caching proxy</a>\n-              </li>\n-              <li class="nav-item">\n-                <a class="nav-link"\n-                   href=""\n-                   tal:attributes="href string:${portal_url}/@@caching-controlpanel-ramcache"\n-                   i18n:translate="label_ramcache">RAM cache</a>\n-              </li>\n+          <li class="nav-item">\n+            <a class="nav-link active"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel;\n+               "\n+               i18n:translate="label_settings"\n+            >Change settings</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-import;\n+               "\n+               i18n:translate="label_import"\n+            >Import settings</a>\n+          </li>\n+          <li class="nav-item"\n+              tal:condition="view/purgingEnabled"\n+          >\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-purge;\n+               "\n+               i18n:translate="label_purging"\n+            >Purge caching proxy</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-ramcache;\n+               "\n+               i18n:translate="label_ramcache"\n+            >RAM cache</a>\n+          </li>\n         </ul>\n-    </div>\n+      </div>\n \n-    <div class="alert alert-info"\n-         role="alert"\n-        tal:condition="not: view/settings/enabled">\n+      <div class="alert alert-info"\n+           role="alert"\n+           tal:condition="not: view/settings/enabled"\n+      >\n         <strong i18n:translate="">\n             Info\n         </strong>\n         <span tal:omit-tag=""\n-            i18n:translate="label_caching_first_time_here?">\n+              i18n:translate="label_caching_first_time_here?"\n+        >\n             First time here? We recommend that you get started by\n-            <a href="@@caching-controlpanel-import"\n-               tal:attributes="href string:${context/absolute_url}/@@caching-controlpanel-import"\n-               title="Import caching rules"\n-               i18n:name="link"\n-               i18n:attributes="title label_import_caching_rules"\n-               i18n:translate="label_caching_first_time_here_link"\n-               >importing a preconfigured set of caching rules</a>.\n+          <a href="@@caching-controlpanel-import"\n+             title="Import caching rules"\n+             tal:attributes="\n+               href string:${context/absolute_url}/@@caching-controlpanel-import;\n+             "\n+             i18n:attributes="title label_import_caching_rules"\n+             i18n:name="link"\n+             i18n:translate="label_caching_first_time_here_link"\n+          >importing a preconfigured set of caching rules</a>.\n         </span>\n-    </div>\n+      </div>\n \n-    <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n     Portal status message\n-    </div>\n+      </div>\n \n \n-            <div class="configlet">\n+      <div class="configlet">\n \n-                <h1 class="documentFirstHeading"\n-                    i18n:translate="heading_caching_settings">Caching settings</h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="heading_caching_settings"\n+        >Caching settings</h1>\n \n \n-                <p i18n:translate="description_cache_settings" class="documentDescription">\n+        <p class="documentDescription"\n+           i18n:translate="description_cache_settings"\n+        >\n                     Control how pages, images, style sheets and other resources are\n                     cached.\n-                </p>\n-\n-\n-                <form\n-                    name="settings"\n-                    method="post"\n-                    class="enableFormTabbing pat-formunloadalert pat-autotoc"\n-                    data-pat-autotoc="levels: legend; section: fieldset; className: autotabs"\n-                    tal:attributes="action request/URL"\n-                    tal:define="errors view/errors">\n-\n-\n-                    <!-- Field set: global settings -->\n-                    <fieldset id="fieldset-global-settings">\n-                        <legend\n-                            id="fieldsetlegend-global-settings"\n-                            i18n:translate="legend_global_settings">Global settings</legend>\n-\n-                        <div\n-                            class="form-check"\n-                            tal:define="selected python:request.get(\'enabled\', view.settings.enabled)">\n-\n-                            <input type="hidden" value="" name="enabled:boolean:default" />\n-                            <input class="form-check-input"\n-                                type="checkbox" value="1" name="enabled:boolean" id="enabled"\n-                                tal:attributes="checked python:\'checked\' if selected else None"\n-                                />\n-                            <label class="form-check-label"\n-                                   for="enabled" i18n:translate="label_enabled">Enable caching</label>\n-                            <div class="form-text" i18n:translate="help_enabled">\n+        </p>\n+\n+\n+        <form class="enableFormTabbing pat-formunloadalert pat-autotoc"\n+              method="post"\n+              name="settings"\n+              data-pat-autotoc="levels: legend; section: fieldset; className: autotabs"\n+              tal:define="\n+                errors view/errors;\n+              "\n+              tal:attributes="\n+                action request/URL;\n+              "\n+        >\n+\n+\n+          <!-- Field set: global settings -->\n+          <fieldset id="fieldset-global-settings">\n+            <legend id="fieldsetlegend-global-settings"\n+                    i18n:translate="legend_global_settings"\n+            >Global settings</legend>\n+\n+            <div class="form-check"\n+                 tal:define="\n+                   selected python:request.get(\'enabled\', view.settings.enabled);\n+                 "\n+            >\n+\n+              <input name="enabled:boolean:default"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input class="form-check-input"\n+                     id="enabled"\n+                     name="enabled:boolean"\n+                     type="checkbox"\n+                     value="1"\n+                     tal:attributes="\n+                       checked python:\'checked\' if selected else None;\n+                     "\n+              />\n+              <label class="form-check-label"\n+                     for="enabled"\n+                     i18n:translate="label_enabled"\n+              >Enable caching</label>\n+              <div class="form-text"\n+                   i18n:translate="help_enabled"\n+              >\n                                 If this option is disabled, no caching will take place.\n-                            </div>\n+              </div>\n \n-                        </div>\n+            </div>\n \n-                    </fieldset>\n+          </fieldset>\n \n-                    <!-- Field set: caching proxies -->\n-                    <fieldset id="fieldset-caching-proxies">\n-                        <legend\n-                            id="fieldsetlegend-caching-proxies"\n-                            i18n:translate="legend_caching_proxies">Caching proxies</legend>\n+          <!-- Field set: caching proxies -->\n+          <fieldset id="fieldset-caching-proxies">\n+            <legend id="fieldsetlegend-caching-proxies"\n+                    i18n:translate="legend_caching_proxies"\n+            >Caching proxies</legend>\n \n-                        <div class="discreet" i18n:translate="description_caching_proxies">\n+            <div class="discreet"\n+                 i18n:translate="description_caching_proxies"\n+            >\n                             High-performance sites will often place a caching reverse\n                             proxy such as Varnish or Squid in front of Zope. The caching\n                             operations configured elsewhere on this screen can often take\n                             advantage of such a proxy by instructing it to cache certain\n                             content in a certain way, whilst passing requests for other\n                             content through to Plone always. Plone can also send so-called\n-                            <code>PURGE</code> requests to a caching proxy when content\n+              <code>PURGE</code>\n+               requests to a caching proxy when content\n                             changes, reducing the risk of a stale response from a cached\n                             copy.\n-                        </div>\n+            </div>\n \n-                        <div class="mb-3 field form-check"\n-                            tal:define="selected python:request.get(\'purgingEnabled\', view.purgingSettings.enabled)">\n-\n-                            <input type="hidden" value="" name="purgingEnabled:boolean:default" />\n-                            <input class="form-check-input"\n-                                   type="checkbox" value="1" name="purgingEnabled:boolean" id="purgingEnabled"\n-                                tal:attributes="checked python:\'checked\' if selected else None"\n-                                />\n-                            <label class="form-check-label"\n-                                   for="purgingEnabled" i18n:translate="label_purging_enabled">Enable purging</label>\n-                            <div class="form-text" i18n:translate="help_purging_enabled">\n+            <div class="mb-3 field form-check"\n+                 tal:define="\n+                   selected python:request.get(\'purgingEnabled\', view.purgingSettings.enabled);\n+                 "\n+            >\n+\n+              <input name="purgingEnabled:boolean:default"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input class="form-check-input"\n+                     id="purgingEnabled"\n+                     name="purgingEnabled:boolean"\n+                     type="checkbox"\n+                     value="1"\n+                     tal:attributes="\n+                       checked python:\'checked\' if selected else None;\n+                     "\n+              />\n+              <label class="form-check-label"\n+                     for="purgingEnabled"\n+                     i18n:translate="label_purging_enabled"\n+              >Enable purging</label>\n+              <div class="form-text"\n+                   i18n:translate="help_purging_enabled"\n+              >\n                                 Enable this option if you have configured a caching proxy\n                                 in front of Plone, and the proxy supports HTTP\n-                                <code>PURGE</code> requests.\n-                            </div>\n-\n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                             tal:define="error errors/cachingProxies | nothing;\n-                                        selected python:request.get(\'cachingProxies\', view.purgingSettings.cachingProxies)"\n-                        >\n+                <code>PURGE</code>\n+                 requests.\n+              </div>\n \n-                            <label class="form-label"\n-                                   for="cachingProxies" i18n:translate="label_caching_proxies">Caching proxies</label>\n-\n-                            <div tal:replace="error" tal:condition="error" />\n-\n-                            <textarea class="form-control"\n-                                cols="40" rows="4" id="cachingProxies" name="cachingProxies:lines"\n-                                tal:content="python:\'\\n\'.join(selected or [])"\n-                                ></textarea>\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_caching_proxies">\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/cachingProxies | nothing;\n+                   selected python:request.get(\'cachingProxies\', view.purgingSettings.cachingProxies);\n+                 "\n+            >\n+\n+              <label class="form-label"\n+                     for="cachingProxies"\n+                     i18n:translate="label_caching_proxies"\n+              >Caching proxies</label>\n+\n+              <div tal:condition="error"\n+                   tal:replace="error"\n+              ></div>\n+\n+              <textarea class="form-control"\n+                        id="cachingProxies"\n+                        cols="40"\n+                        name="cachingProxies:lines"\n+                        rows="4"\n+                        tal:content="python:\'\\n\'.join(selected or [])"\n+              ></textarea>\n+\n+              <div class="form-text"\n+                   i18n:translate="help_caching_proxies"\n+              >\n                                 Enter the domain name of each caching proxy, one per\n                                 line. For example, if you have Varnish running on the\n                                 local machine on port 1234, you could enter\n-                                <code>http://localhost:1234</code>. The domain name must\n+                <code>http://localhost:1234</code>. The domain name must\n                                 be reachable by the Zope process, but does not need to\n                                 be reachable from users\' local machines.\n-                            </div>\n+              </div>\n \n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                            tal:define="error errors/purgedContentTypes | nothing;\n-                                        selected python:request.get(\'purgedContentTypes\', view.ploneSettings.purgedContentTypes)"\n-                        >\n-\n-                            <label class="form-label"\n-                                   for="purgedContentTypes" i18n:translate="label_purged_content_types">Content types to purge</label>\n-\n-                            <div tal:replace="error" tal:condition="error" />\n-\n-                            <select class="form-select"\n-                                    size="6" multiple="multiple" id="purgedContentTypes" name="purgedContentTypes:list">\n-                                <option\n-                                    tal:repeat="contentType view/contentTypes"\n-                                    tal:attributes="value    contentType/name;\n-                                                    title    contentType/description;\n-                                                    selected python:\'selected\' if contentType[\'name\'] in selected else None;"\n-                                    tal:content="contentType/title"\n-                                    i18n:attributes="title" i18n:translate=""/>\n-                            </select>\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_purged_content_types">\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/purgedContentTypes | nothing;\n+                   selected python:request.get(\'purgedContentTypes\', view.ploneSettings.purgedContentTypes);\n+                 "\n+            >\n+\n+              <label class="form-label"\n+                     for="purgedContentTypes"\n+                     i18n:translate="label_purged_content_types"\n+              >Content types to purge</label>\n+\n+              <div tal:condition="error"\n+                   tal:replace="error"\n+              ></div>\n+\n+              <select class="form-select"\n+                      id="purgedContentTypes"\n+                      multiple="multiple"\n+                      name="purgedContentTypes:list"\n+                      size="6"\n+              >\n+                <option tal:repeat="contentType view/contentTypes"\n+                        tal:content="contentType/title"\n+                        tal:attributes="\n+                          value    contentType/name;\n+                          title    contentType/description;\n+                          selected python:\'selected\' if contentType[\'name\'] in selected else None;\n+                        "\n+                        i18n:attributes="title"\n+                        i18n:translate=""\n+                ></option>\n+              </select>\n+\n+              <div class="form-text"\n+                   i18n:translate="help_purged_content_types"\n+              >\n                                 If you have enabled purging, Plone can automatically purge\n                                 the views of content items when they are modified or\n                                 removed. Select the types to automatically purge below.\n-                                <strong>Note:</strong> although a content items\'s view\n+                <strong>Note:</strong>\n+                 although a content items\'s view\n                                 can be purged easily, it is not always possible to purge\n                                 every page where that item may appear. Items that appear\n-                                in dynamic listings (such as <em>Collection</em> portlets),\n+                                in dynamic listings (such as\n+                <em>Collection</em>\n+                 portlets),\n                                 the navigation tree and other navigational aids may appear\n                                 out of date if you have cached the pages where those\n                                 items would appear.\n-                            </div>\n+              </div>\n \n-                        </div>\n+            </div>\n \n-                        <div class="mb-3 field form-check"\n-                            tal:define="selected python:request.get(\'virtualHosting\', view.purgingSettings.virtualHosting)">\n-\n-                            <input type="hidden" value="" name="virtualHosting:boolean:default" />\n-                            <input class="form-check-input"\n-                                   type="checkbox" value="1" name="virtualHosting:boolean" id="virtualHosting"\n-                                tal:attributes="checked python:\'checked\' if selected else None"\n-                                />\n-                            <label class="form-check-label"\n-                                   for="virtualHosting" i18n:translate="label_virtual_hosting">Virtual host rewriting takes place in front of the caching proxy</label>\n-                            <div class="form-text" i18n:translate="help_virtual_hosting">\n+            <div class="mb-3 field form-check"\n+                 tal:define="\n+                   selected python:request.get(\'virtualHosting\', view.purgingSettings.virtualHosting);\n+                 "\n+            >\n+\n+              <input name="virtualHosting:boolean:default"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input class="form-check-input"\n+                     id="virtualHosting"\n+                     name="virtualHosting:boolean"\n+                     type="checkbox"\n+                     value="1"\n+                     tal:attributes="\n+                       checked python:\'checked\' if selected else None;\n+                     "\n+              />\n+              <label class="form-check-label"\n+                     for="virtualHosting"\n+                     i18n:translate="label_virtual_hosting"\n+              >Virtual host rewriting takes place in front of the caching proxy</label>\n+              <div class="form-text"\n+                   i18n:translate="help_virtual_hosting"\n+              >\n                                 Enable this if you are using virtual hosting with Zope\'s\n                                 VirtualHostMonster and you perform URL rewriting (to\n                                 incorporate the special virtual hosting tokens such as\n-                                <code>VirtualHostBase</code> and\n-                                <code>VirtualHostRoot</code> in the URL) <em>before</em>\n+                <code>VirtualHostBase</code>\n+                 and\n+                <code>VirtualHostRoot</code>\n+                in the URL)\n+                <em>before</em>\n                                 the request is passed to the caching proxy, e.g. in an\n                                 Apache web server that receives requests and passes them\n                                 on to a Varnish caching proxy. Disable this option if you\n                                 are not using virtual hosting, or if the caching proxy is\n                                 in front of whatever performs the rewrite (or is itself\n                                 performing the rewrites), disable this option.\n-                            </div>\n-\n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                            tal:define="error errors/domains | nothing;\n-                                        selected python:request.get(\'domains\', view.purgingSettings.domains)"\n-                        >\n-\n-                            <label class="form-label"\n-                                   for="domains" i18n:translate="label_domains">Externally facing domains</label>\n+              </div>\n \n-                            <div tal:replace="error" tal:condition="error" />\n-\n-                            <textarea class="form-control"\n-                                cols="40" rows="4" id="domains" name="domains:lines"\n-                                tal:content="python:\'\\n\'.join(selected or [])"\n-                                ></textarea>\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_domains">\n-                                <p>\n-                                If you have enabled <em>Virtual host rewriting takes place\n-                                front of the caching proxy</em> above, and your site is\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/domains | nothing;\n+                   selected python:request.get(\'domains\', view.purgingSettings.domains);\n+                 "\n+            >\n+\n+              <label class="form-label"\n+                     for="domains"\n+                     i18n:translate="label_domains"\n+              >Externally facing domains</label>\n+\n+              <div tal:condition="error"\n+                   tal:replace="error"\n+              ></div>\n+\n+              <textarea class="form-control"\n+                        id="domains"\n+                        cols="40"\n+                        name="domains:lines"\n+                        rows="4"\n+                        tal:content="python:\'\\n\'.join(selected or [])"\n+              ></textarea>\n+\n+              <div class="form-text"\n+                   i18n:translate="help_domains"\n+              >\n+                <p>\n+                                If you have enabled\n+                  <em>Virtual host rewriting takes place\n+                    front of the caching proxy</em>\n+                   above, and your site is\n                                 reachable via multiple domains (e.g.\n-                                <code>http://example.com:80</code> vs.\n-                                <code>http://www.example.com:80</code>), enter all available\n+                  <code>http://example.com:80</code>\n+                   vs.\n+                  <code>http://www.example.com:80</code>), enter all available\n                                 domains here, one per line. This will ensure that purge\n                                 requests are sent for all domains where applicable. Note\n                                 that it is more efficient to configure the front-most web\n                                 server to simply redirect all requests to a single domain,\n                                 so that Zope only "sees" a single domain.\n-                                </p>\n-                                <p>\n+                </p>\n+                <p>\n                                 It is safe to leave this list blank if you are not using\n                                 a caching proxy, if you are not using virtual hosting,\n                                 if virtual host rewriting takes place behind the caching\n                                 proxy, or if you only have a single virtually hosted\n                                 domain name.\n-                                </p>\n-                            </div>\n+                </p>\n+              </div>\n \n-                        </div>\n+            </div>\n \n-                    </fieldset>\n+          </fieldset>\n \n-                    <!-- Field set: memory -->\n-                    <fieldset id="fieldset-ram">\n-                        <legend\n-                            id="fieldsetlegend-ram"\n-                            i18n:translate="legend_ram">In-memory cache</legend>\n+          <!-- Field set: memory -->\n+          <fieldset id="fieldset-ram">\n+            <legend id="fieldsetlegend-ram"\n+                    i18n:translate="legend_ram"\n+            >In-memory cache</legend>\n \n-                        <div class="discreet" i18n:translate="description_ram">\n+            <div class="discreet"\n+                 i18n:translate="description_ram"\n+            >\n                             Plone maintains a cache of certain pages and\n                             fragments of pages in memory to speed up\n                             rendering. Certain caching operations, when\n@@ -314,254 +437,364 @@\n                             load balancer so that they always reach the same\n                             back-end instance. As an alternative, you can\n                             integrate a shared cache such as\n-                            <em>memcached</em>. See the documentation for\n+              <em>memcached</em>. See the documentation for\n                             details.\n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                            tal:define="error errors/ramCacheMaxEntries | nothing"\n-                        >\n-\n-                            <label class="form-label"\n-                                for="ramCacheMaxEntries"\n-                                i18n:translate="label_ram_max_entries">Maximum entries in the cache</label>\n-\n-                            <span class="fieldRequired" i18n:translate="">(Required)</span>\n-\n-                            <div tal:condition="error" tal:content="error" />\n-\n-                            <input class="form-control"\n-                                name="ramCacheMaxEntries" id="ramCacheMaxEntries" size="6"\n-                                tal:attributes="value request/ramCacheMaxEntries | view/ramCache/maxEntries | nothing" />\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_ram_max_entries">\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/ramCacheMaxEntries | nothing;\n+                 "\n+            >\n+\n+              <label class="form-label"\n+                     for="ramCacheMaxEntries"\n+                     i18n:translate="label_ram_max_entries"\n+              >Maximum entries in the cache</label>\n+\n+              <span class="fieldRequired"\n+                    i18n:translate=""\n+              >(Required)</span>\n+\n+              <div tal:condition="error"\n+                   tal:content="error"\n+              ></div>\n+\n+              <input class="form-control"\n+                     id="ramCacheMaxEntries"\n+                     name="ramCacheMaxEntries"\n+                     size="6"\n+                     tal:attributes="\n+                       value request/ramCacheMaxEntries | view/ramCache/maxEntries | nothing;\n+                     "\n+              />\n+\n+              <div class="form-text"\n+                   i18n:translate="help_ram_max_entries"\n+              >\n                                 Use this to control how many items can be\n                                 placed in the cache. The more items you allow,\n                                 the higher the potential memory consumption.\n-                            </div>\n-\n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                            tal:define="error errors/ramCacheMaxAge | nothing"\n-                        >\n-\n-                            <label\n-                                for="ramCacheMaxAge"\n-                                i18n:translate="label_ram_max_age">Maximum age of entries in the cache</label>\n-\n-                            <span class="fieldRequired" i18n:translate="">(Required)</span>\n+              </div>\n \n-                            <div tal:condition="error" tal:content="error" />\n-\n-                            <input class="form-control"\n-                                name="ramCacheMaxAge" id="ramCacheMaxAge" size="6"\n-                                tal:attributes="value request/ramCacheMaxAge | view/ramCache/maxAge | nothing" />\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_ram_max_age">\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/ramCacheMaxAge | nothing;\n+                 "\n+            >\n+\n+              <label for="ramCacheMaxAge"\n+                     i18n:translate="label_ram_max_age"\n+              >Maximum age of entries in the cache</label>\n+\n+              <span class="fieldRequired"\n+                    i18n:translate=""\n+              >(Required)</span>\n+\n+              <div tal:condition="error"\n+                   tal:content="error"\n+              ></div>\n+\n+              <input class="form-control"\n+                     id="ramCacheMaxAge"\n+                     name="ramCacheMaxAge"\n+                     size="6"\n+                     tal:attributes="\n+                       value request/ramCacheMaxAge | view/ramCache/maxAge | nothing;\n+                     "\n+              />\n+\n+              <div class="form-text"\n+                   i18n:translate="help_ram_max_age"\n+              >\n                                 Enter the maximum time, in seconds, that an item\n                                 may remain in the cache before being purged.\n-                            </div>\n+              </div>\n \n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                            tal:define="error errors/ramCacheCleanupInterval | nothing"\n-                        >\n-\n-                            <label\n-                                for="ramCacheCleanupInterval"\n-                                i18n:translate="label_ram_cleanup_interval">Cleanup interval</label>\n-\n-                            <span class="fieldRequired" i18n:translate="">(Required)</span>\n-\n-                            <div tal:condition="error" tal:content="error" />\n-\n-                            <input class="form-control"\n-                                name="ramCacheCleanupInterval" id="ramCacheCleanupInterval" size="6"\n-                                tal:attributes="value request/ramCacheCleanupInterval | view/ramCache/cleanupInterval | nothing" />\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_ram_cleanup_interval">\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/ramCacheCleanupInterval | nothing;\n+                 "\n+            >\n+\n+              <label for="ramCacheCleanupInterval"\n+                     i18n:translate="label_ram_cleanup_interval"\n+              >Cleanup interval</label>\n+\n+              <span class="fieldRequired"\n+                    i18n:translate=""\n+              >(Required)</span>\n+\n+              <div tal:condition="error"\n+                   tal:content="error"\n+              ></div>\n+\n+              <input class="form-control"\n+                     id="ramCacheCleanupInterval"\n+                     name="ramCacheCleanupInterval"\n+                     size="6"\n+                     tal:attributes="\n+                       value request/ramCacheCleanupInterval | view/ramCache/cleanupInterval | nothing;\n+                     "\n+              />\n+\n+              <div class="form-text"\n+                   i18n:translate="help_ram_cleanup_interval"\n+              >\n                                 Enter the time, in seconds, before attempts\n                                 to clean up the cache. A lower value may reduce\n                                 memory consumption by purging items frequently,\n                                 but can also slow down the system by tying up\n                                 the cache with maintenance tasks for too long.\n-                            </div>\n+              </div>\n \n-                        </div>\n+            </div>\n \n-                    </fieldset>\n-\n-                    <!-- Field set: mappings -->\n-                    <fieldset id="fieldset-mappings">\n-                        <legend\n-                            id="fieldsetlegend-mappings"\n-                            i18n:translate="legend_mappings">Caching operations</legend>\n-\n-                        <div class="discreet" i18n:translate="description_mappings">\n-                            <p>\n-                            Caching can be controlled by mapping <em>rulesets</em> to\n-                            <em>caching operations</em>.\n-                            </p>\n-                            <p>\n-                            A <strong>ruleset</strong> is a name given to a resource\n+          </fieldset>\n+\n+          <!-- Field set: mappings -->\n+          <fieldset id="fieldset-mappings">\n+            <legend id="fieldsetlegend-mappings"\n+                    i18n:translate="legend_mappings"\n+            >Caching operations</legend>\n+\n+            <div class="discreet"\n+                 i18n:translate="description_mappings"\n+            >\n+              <p>\n+                            Caching can be controlled by mapping\n+                <em>rulesets</em>\n+                 to\n+                <em>caching operations</em>.\n+              </p>\n+              <p>\n+                            A\n+                <strong>ruleset</strong>\n+                 is a name given to a resource\n                             published by Plone, such as a view. Rulesets are declared by\n                             the developers who write those views. You can think of them as\n                             a way to give hints about how something should be cached,\n                             without actually implementing the caching operations.\n-                            </p>\n-                            <p>\n+              </p>\n+              <p>\n                             The exact caching operations to use are mapped to\n                             rulesets in the table below. Caching operations will often\n                             set response headers to tell the users\'s web browser and/or\n                             a caching proxy how to cache content. They may also intercept\n                             a response to return a cached copy or instruct the browser to use\n                             its own cached copy, if it is considered to be current.\n-                            </p>\n-                        </div>\n-                        <div class="mb-3 field">\n-                            <label i18n:translate="label_mappings">Ruleset mappings</label>\n-                            <div class="form-text" i18n:translate="help_main_mappings">\n+              </p>\n+            </div>\n+            <div class="mb-3 field">\n+              <label i18n:translate="label_mappings">Ruleset mappings</label>\n+              <div class="form-text"\n+                   i18n:translate="help_main_mappings"\n+              >\n                                 Use the table below to map rulesets to caching\n                                 operations.\n-                            </div>\n-\n-                            <table class="table table-striped table-responsive" id="rulesetMappingsTable">\n-                                <thead>\n-                                    <tr>\n-                                        <th class="col-9"\n-                                            i18n:translate="heading_ruleset">Ruleset</th>\n-                                        <th class="col-3"\n-                                            i18n:translate="heading_operation">Operation</th>\n-                                    </tr>\n-                                </thead>\n-                                <tbody>\n-                                    <tr tal:repeat="ruleType view/ruleTypes">\n-                                        <td>\n-                                            <label class="form-label"\n-                                                tal:content="ruleType/title" i18n:translate=""/>\n-                                            <p class="form-text" tal:content="ruleType/description" i18n:translate=""/>\n-                                        </td>\n-                                        <td tal:define="selected python:request.get(\'operations\', view.operationMapping).get(ruleType[\'safeName\'], None)">\n-                                            <select class="form-select"\n-                                                size="1"\n-                                                tal:attributes="id   string:operation-${ruleType/name};\n-                                                                name string:operations.${ruleType/safeName}:record;">\n-                                                <option\n-                                                    value=""\n-                                                    tal:attributes="selected python:\'selected\' if selected is None else None"\n-                                                    i18n:translate="value_not_used"\n-                                                    >(Not used)</option>\n-                                                <option\n-                                                    tal:repeat="operationType view/operationTypes"\n-                                                    tal:attributes="value    operationType/name;\n-                                                                    title    operationType/description;\n-                                                                    selected python:\'selected\' if operationType[\'name\'] == selected else None;"\n-                                                    tal:content="operationType/title"\n-                                                    />\n-                                            </select>\n-                                        </td>\n-                                    </tr>\n-                                </tbody>\n-                            </table>\n-                        </div>\n+              </div>\n+\n+              <table class="table table-striped table-responsive"\n+                     id="rulesetMappingsTable"\n+              >\n+                <thead>\n+                  <tr>\n+                    <th class="col-9"\n+                        i18n:translate="heading_ruleset"\n+                    >Ruleset</th>\n+                    <th class="col-3"\n+                        i18n:translate="heading_operation"\n+                    >Operation</th>\n+                  </tr>\n+                </thead>\n+                <tbody>\n+                  <tr tal:repeat="ruleType view/ruleTypes">\n+                    <td>\n+                      <label class="form-label"\n+                             tal:content="ruleType/title"\n+                             i18n:translate=""\n+                      ></label>\n+                      <p class="form-text"\n+                         tal:content="ruleType/description"\n+                         i18n:translate=""\n+                      ></p>\n+                    </td>\n+                    <td tal:define="\n+                          selected python:request.get(\'operations\', view.operationMapping).get(ruleType[\'safeName\'], None);\n+                        ">\n+                      <select class="form-select"\n+                              size="1"\n+                              tal:attributes="\n+                                id   string:operation-${ruleType/name};\n+                                name string:operations.${ruleType/safeName}:record;\n+                              "\n+                      >\n+                        <option value=""\n+                                tal:attributes="\n+                                  selected python:\'selected\' if selected is None else None;\n+                                "\n+                                i18n:translate="value_not_used"\n+                        >(Not used)</option>\n+                        <option tal:repeat="operationType view/operationTypes"\n+                                tal:content="operationType/title"\n+                                tal:attributes="\n+                                  value    operationType/name;\n+                                  title    operationType/description;\n+                                  selected python:\'selected\' if operationType[\'name\'] == selected else None;\n+                                "\n+                        ></option>\n+                      </select>\n+                    </td>\n+                  </tr>\n+                </tbody>\n+              </table>\n+            </div>\n \n-                        <div class="mb-3 field">\n-                            <label class="form-label"\n-                                i18n:translate="label_template_mappings">Legacy template mappings</label>\n-                            <div class="form-text" i18n:translate="help_template_mappings">\n-                                <p>\n-                                Legacy page templates defined in the <em>portal_skins</em>\n+            <div class="mb-3 field">\n+              <label class="form-label"\n+                     i18n:translate="label_template_mappings"\n+              >Legacy template mappings</label>\n+              <div class="form-text"\n+                   i18n:translate="help_template_mappings"\n+              >\n+                <p>\n+                                Legacy page templates defined in the\n+                  <em>portal_skins</em>\n                                 tool in the ZMI, or created or customised through the web cannot be\n                                 associated with rulesets in the usual way. There are two options:\n-                                </p>\n-                                <ul>\n-                                    <li>If the template is the <em>default type</em> of a content type\n+                </p>\n+                <ul>\n+                  <li>If the template is the\n+                    <em>default type</em>\n+                     of a content type\n                                         it is possible to associate the type class or an interface it\n-                                        provides with a ruleset.</li>\n-                                    <li>You can also associate a specific page template (by name) or\n-                                        content type with a ruleset using the options below.</li>\n-                                </ul>\n-                                <p>\n-                                <strong>Note:</strong> By default, folder-like content types are\n-                                associated with the ruleset <code>plone.content.folderView</code>,\n+                    provides with a ruleset.</li>\n+                  <li>You can also associate a specific page template (by name) or\n+                    content type with a ruleset using the options below.</li>\n+                </ul>\n+                <p>\n+                  <strong>Note:</strong>\n+                   By default, folder-like content types are\n+                                associated with the ruleset\n+                  <code>plone.content.folderView</code>,\n                                 and item-like content types are associated with the ruleset\n-                                <code>plone.content.itemView</code>. Any settings entered below or\n+                  <code>plone.content.itemView</code>. Any settings entered below or\n                                 set via an explicit cache ruleset (in a ZCML file) will override these\n                                 defaults.\n-                                </p>\n-                                <p>\n-                                <strong>Note:</strong> You can only use each template name or\n+                </p>\n+                <p>\n+                  <strong>Note:</strong>\n+                   You can only use each template name or\n                                 content type once!\n-                                </p>\n-                            </div>\n-\n-                            <table class="table table-striped table-responsive" id="templateMappingsTable">\n-                                <thead>\n-                                    <tr>\n-                                        <th class="col-6"\n-                                            i18n:translate="heading_ruleset">Ruleset</th>\n-                                        <th class="col-3"\n-                                            i18n:translate="heading_content_types">Content types</th>\n-                                        <th class="col-3"\n-                                            i18n:translate="heading_templates">Templates</th>\n-                                    </tr>\n-                                </thead>\n-                                <tbody>\n-                                    <tal:block repeat="ruleType view/ruleTypes">\n-                                        <tr tal:define="contentTypeError python:errors.get(\'contenttypes\', {}).get(ruleType[\'name\'], None);\n-                                                        templateError    python:errors.get(\'templates\', {}).get(ruleType[\'name\'], None);">\n-                                            <td>\n-                                                <div tal:content="ruleType/title" i18n:translate=""/>\n-                                                <p class="discreet" tal:content="ruleType/description" i18n:translate=""/>\n-                                                <div class="invalid-feedback" tal:condition="python:contentTypeError or templateError">\n-                                                    <div tal:content="contentTypeError" tal:condition="contentTypeError" />\n-                                                    <div tal:content="templateError" tal:condition="templateError" />\n-                                                </div>\n-                                            </td>\n-                                            <td tal:define="selected python:request.get(\'contenttypes\', view.reverseContentTypeMapping).get(ruleType[\'safeName\'], [])">\n-                                                <div class="invalid-feedback" tal:omit-tag="not:contentTypeError">\n-                                                    <select class="form-select"\n-                                                        size="6"\n-                                                        multiple="multiple"\n-                                                        tal:attributes="id   string:contenttypes-${ruleType/name};\n-                                                                        name string:contenttypes.${ruleType/safeName}:record:list;">\n-                                                        <option\n-                                                            tal:repeat="contentType view/contentTypes"\n-                                                            tal:attributes="value    contentType/name;\n-                                                                            title    contentType/description;\n-                                                                            selected python:\'selected\' if contentType[\'name\'] in selected else None;"\n-                                                            tal:content="contentType/title"\n-                                                            i18n:attributes="title" i18n:translate="" />\n-                                                    </select>\n-                                                </div>\n-                                            </td>\n-                                            <td tal:define="selected python:request.get(\'templates\', view.reverseTemplateMapping).get(ruleType[\'safeName\'], \'\')">\n-                                                <div class="invalid-feedback" tal:omit-tag="not:templateError">\n-                                                    <textarea class="form-control"\n-                                                        cols="40" rows="4"\n-                                                        tal:attributes="id   string:templates-${ruleType/name};\n-                                                                        name string:templates.${ruleType/safeName}:record:lines"\n-                                                        tal:content="python:\'\\n\'.join(selected or [])"\n-                                                        ></textarea>\n-                                                </div>\n-                                            </td>\n-                                        </tr>\n-                                    </tal:block>\n-                                </tbody>\n-                            </table>\n+                </p>\n+              </div>\n+\n+              <table class="table table-striped table-responsive"\n+                     id="templateMappingsTable"\n+              >\n+                <thead>\n+                  <tr>\n+                    <th class="col-6"\n+                        i18n:translate="heading_ruleset"\n+                    >Ruleset</th>\n+                    <th class="col-3"\n+                        i18n:translate="heading_content_types"\n+                    >Content types</th>\n+                    <th class="col-3"\n+                        i18n:translate="heading_templates"\n+                    >Templates</th>\n+                  </tr>\n+                </thead>\n+                <tbody>\n+                  <tal:block repeat="ruleType view/ruleTypes">\n+                    <tr tal:define="\n+                          contentTypeError python:errors.get(\'contenttypes\', {}).get(ruleType[\'name\'], None);\n+                          templateError    python:errors.get(\'templates\', {}).get(ruleType[\'name\'], None);\n+                        ">\n+                      <td>\n+                        <div tal:content="ruleType/title"\n+                             i18n:translate=""\n+                        ></div>\n+                        <p class="discreet"\n+                           tal:content="ruleType/description"\n+                           i18n:translate=""\n+                        ></p>\n+                        <div class="invalid-feedback"\n+                             tal:condition="python:contentTypeError or templateError"\n+                        >\n+                          <div tal:condition="contentTypeError"\n+                               tal:content="contentTypeError"\n+                          ></div>\n+                          <div tal:condition="templateError"\n+                               tal:content="templateError"\n+                          ></div>\n                         </div>\n-                    </fieldset>\n-\n-                    <!-- Field set: detailed settings -->\n-                    <fieldset id="fieldset-detailed-settings">\n-                        <legend\n-                            id="fieldsetlegend-detailed-settings"\n-                            i18n:translate="legend_detailed_settings">Detailed settings</legend>\n-\n-                        <div class="discreet" i18n:translate="description_detailed_settings">\n-                            <p>\n+                      </td>\n+                      <td tal:define="\n+                            selected python:request.get(\'contenttypes\', view.reverseContentTypeMapping).get(ruleType[\'safeName\'], []);\n+                          ">\n+                        <div class="invalid-feedback"\n+                             tal:omit-tag="not:contentTypeError"\n+                        >\n+                          <select class="form-select"\n+                                  multiple="multiple"\n+                                  size="6"\n+                                  tal:attributes="\n+                                    id   string:contenttypes-${ruleType/name};\n+                                    name string:contenttypes.${ruleType/safeName}:record:list;\n+                                  "\n+                          >\n+                            <option tal:repeat="contentType view/contentTypes"\n+                                    tal:content="contentType/title"\n+                                    tal:attributes="\n+                                      value    contentType/name;\n+                                      title    contentType/description;\n+                                      selected python:\'selected\' if contentType[\'name\'] in selected else None;\n+                                    "\n+                                    i18n:attributes="title"\n+                                    i18n:translate=""\n+                            ></option>\n+                          </select>\n+                        </div>\n+                      </td>\n+                      <td tal:define="\n+                            selected python:request.get(\'templates\', view.reverseTemplateMapping).get(ruleType[\'safeName\'], \'\');\n+                          ">\n+                        <div class="invalid-feedback"\n+                             tal:omit-tag="not:templateError"\n+                        >\n+                          <textarea class="form-control"\n+                                    cols="40"\n+                                    rows="4"\n+                                    tal:content="python:\'\\n\'.join(selected or [])"\n+                                    tal:attributes="\n+                                      id   string:templates-${ruleType/name};\n+                                      name string:templates.${ruleType/safeName}:record:lines;\n+                                    "\n+                          ></textarea>\n+                        </div>\n+                      </td>\n+                    </tr>\n+                  </tal:block>\n+                </tbody>\n+              </table>\n+            </div>\n+          </fieldset>\n+\n+          <!-- Field set: detailed settings -->\n+          <fieldset id="fieldset-detailed-settings">\n+            <legend id="fieldsetlegend-detailed-settings"\n+                    i18n:translate="legend_detailed_settings"\n+            >Detailed settings</legend>\n+\n+            <div class="discreet"\n+                 i18n:translate="description_detailed_settings"\n+            >\n+              <p>\n                             Many caching operations accept parameters to influence their\n                             behaviour. For example, an operation which returns a page\n                             cached in RAM may accept a parameter specifying the timeout\n@@ -569,128 +802,160 @@\n                             however, will have "sensible defaults", so that  they work\n                             acceptably even when no parameters have been set. Note also\n                             that not all operations support parameters.\n-                            </p>\n-                            <p>\n+              </p>\n+              <p>\n                             Parameters can be set at two levels. By default, parameters\n                             apply to all uses of particular operation. Thus, if you have\n                             assigned an operation to more than one ruleset, the\n-                            <em>same</em> parameters will be used. However, you can also\n+                <em>same</em>\n+                 parameters will be used. However, you can also\n                             override the parameters for a particular ruleset.\n-                            </p>\n-                            <p>\n+              </p>\n+              <p>\n                             Use the table below to access parameters for a particular\n-                            operation or ruleset. <strong>Warning:</strong> If you have\n+                            operation or ruleset.\n+                <strong>Warning:</strong>\n+                 If you have\n                             made changes elsewhere in this form, you should save them\n                             before configuring any operation parameters. Otherwise, you\n                             will lose your changes.\n-                            </p>\n-                        </div>\n-                        <div class="mb-3 field">\n-                            <label class="form-label"\n-                                   i18n:translate="label_operation_parameters">Operation parameters</label>\n-                            <div class="form-text" i18n:translate="help_operation_parameters">\n+              </p>\n+            </div>\n+            <div class="mb-3 field">\n+              <label class="form-label"\n+                     i18n:translate="label_operation_parameters"\n+              >Operation parameters</label>\n+              <div class="form-text"\n+                   i18n:translate="help_operation_parameters"\n+              >\n                                 Use the table below to create, clear and edit operation\n                                 parameters. If you clear the ruleset-specific parameters for\n                                 a given operation, it will fall back on the global operation\n                                 parameters.\n-                            </div>\n-\n-                            <table class="table table-striped table-responsive" id="operationParametersTable">\n-                                <thead>\n-                                    <tr>\n-                                        <th class="col-9"\n-                                            i18n:translate="heading_ruleset">Ruleset</th>\n-                                        <th class="col-3"\n-                                            i18n:translate="heading_operation">Operation</th>\n-                                    </tr>\n-                                </thead>\n-                                <tbody>\n-                                    <tr tal:repeat="ruleType view/ruleTypes">\n-                                        <td>\n-                                            <div class="form-label"\n-                                                 tal:content="ruleType/title" i18n:translate=""/>\n-                                            <p class="form-text"\n-                                               tal:content="ruleType/description" i18n:translate=""/>\n-                                        </td>\n-                                        <td tal:define="operationName python:view.operationMapping.get(ruleType[\'safeName\'], None)">\n-                                            <tal:block condition="not:operationName" i18n:translate="help_not_mapped">\n+              </div>\n+\n+              <table class="table table-striped table-responsive"\n+                     id="operationParametersTable"\n+              >\n+                <thead>\n+                  <tr>\n+                    <th class="col-9"\n+                        i18n:translate="heading_ruleset"\n+                    >Ruleset</th>\n+                    <th class="col-3"\n+                        i18n:translate="heading_operation"\n+                    >Operation</th>\n+                  </tr>\n+                </thead>\n+                <tbody>\n+                  <tr tal:repeat="ruleType view/ruleTypes">\n+                    <td>\n+                      <div class="form-label"\n+                           tal:content="ruleType/title"\n+                           i18n:translate=""\n+                      ></div>\n+                      <p class="form-text"\n+                         tal:content="ruleType/description"\n+                         i18n:translate=""\n+                      ></p>\n+                    </td>\n+                    <td tal:define="\n+                          operationName python:view.operationMapping.get(ruleType[\'safeName\'], None);\n+                        ">\n+                      <tal:block condition="not:operationName"\n+                                 i18n:translate="help_not_mapped"\n+                      >\n                                                 Not mapped\n-                                            </tal:block>\n-                                            <tal:block condition="operationName">\n-                                                <tal:block\n-                                                    define="operationInfo python:view.operationTypesLookup.get(operationName, None)"\n-                                                    condition="operationInfo">\n-                                                    <div tal:content="operationInfo/title" />\n-                                                    <div\n-                                                        class="discreet"\n-                                                        tal:condition="not:operationInfo/hasOptions"\n-                                                        i18n:translate="help_no_options">\n+                      </tal:block>\n+                      <tal:block condition="operationName">\n+                        <tal:block define="\n+                                     operationInfo python:view.operationTypesLookup.get(operationName, None);\n+                                   "\n+                                   condition="operationInfo"\n+                        >\n+                          <div tal:content="operationInfo/title"></div>\n+                          <div class="discreet"\n+                               tal:condition="not:operationInfo/hasOptions"\n+                               i18n:translate="help_no_options"\n+                          >\n                                                         No parameters\n-                                                    </div>\n-                                                    <div style="white-space: nowrap" class="discreet rulesetParameterLink" tal:condition="operationInfo/hasOptions">\n-                                                        <a  class="editGlobalOperationParameters pat-plone-modal"\n-                                                            data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n-                                                            i18n:translate="link_view_edit"\n-                                                            tal:attributes="href string:${context/absolute_url}/@@${view/__name__}/edit-operation-global/${operationName}"\n-                                                            >View/edit</a>\n-                                                        <span i18n:translate="label_global">global parameters</span>\n-                                                    </div>\n-                                                    <div style="white-space: nowrap" class="discreet rulesetParameterLink"  tal:condition="operationInfo/hasOptions">\n-                                                        <tal:block define="hasRulesetOptions python:view.hasRulesetOptions(operationInfo[\'type\'], ruleType[\'name\'])">\n-                                                            <a  class="editRulesetOperationParameters pat-plone-modal"\n-                                                                data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n-                                                                tal:condition="hasRulesetOptions"\n-                                                                i18n:translate="link_view_edit_clear"\n-                                                                tal:attributes="href string:${context/absolute_url}/@@${view/__name__}/edit-operation-ruleset/${operationName}/${ruleType/name}"\n-                                                                >View/edit/clear</a>\n-                                                            <a  class="editRulesetOperationParameters pat-plone-modal"\n-                                                                data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n-                                                                tal:condition="not:hasRulesetOptions"\n-                                                                i18n:translate="link_create"\n-                                                                tal:attributes="href string:${context/absolute_url}/@@${view/__name__}/edit-operation-ruleset/${operationName}/${ruleType/name}"\n-                                                                >Create</a>\n-                                                        </tal:block>\n-                                                        <span i18n:translate="label_ruleset">per-ruleset parameters</span>\n-                                                    </div>\n-                                                </tal:block>\n-                                            </tal:block>\n-                                        </td>\n-                                    </tr>\n-                                </tbody>\n-                            </table>\n-                        </div>\n+                          </div>\n+                          <div class="discreet rulesetParameterLink"\n+                               style="white-space: nowrap"\n+                               tal:condition="operationInfo/hasOptions"\n+                          >\n+                            <a class="editGlobalOperationParameters pat-plone-modal"\n+                               data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n+                               tal:attributes="\n+                                 href string:${context/absolute_url}/@@${view/__name__}/edit-operation-global/${operationName};\n+                               "\n+                               i18n:translate="link_view_edit"\n+                            >View/edit</a>\n+                            <span i18n:translate="label_global">global parameters</span>\n+                          </div>\n+                          <div class="discreet rulesetParameterLink"\n+                               style="white-space: nowrap"\n+                               tal:condition="operationInfo/hasOptions"\n+                          >\n+                            <tal:block define="\n+                                         hasRulesetOptions python:view.hasRulesetOptions(operationInfo[\'type\'], ruleType[\'name\']);\n+                                       ">\n+                              <a class="editRulesetOperationParameters pat-plone-modal"\n+                                 data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n+                                 tal:condition="hasRulesetOptions"\n+                                 tal:attributes="\n+                                   href string:${context/absolute_url}/@@${view/__name__}/edit-operation-ruleset/${operationName}/${ruleType/name};\n+                                 "\n+                                 i18n:translate="link_view_edit_clear"\n+                              >View/edit/clear</a>\n+                              <a class="editRulesetOperationParameters pat-plone-modal"\n+                                 data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n+                                 tal:condition="not:hasRulesetOptions"\n+                                 tal:attributes="\n+                                   href string:${context/absolute_url}/@@${view/__name__}/edit-operation-ruleset/${operationName}/${ruleType/name};\n+                                 "\n+                                 i18n:translate="link_create"\n+                              >Create</a>\n+                            </tal:block>\n+                            <span i18n:translate="label_ruleset">per-ruleset parameters</span>\n+                          </div>\n+                        </tal:block>\n+                      </tal:block>\n+                    </td>\n+                  </tr>\n+                </tbody>\n+              </table>\n+            </div>\n \n-                    </fieldset>\n+          </fieldset>\n \n-                    <div class="formControls">\n-                        <button\n-                            type="submit"\n-                            name="form.button.Save"\n-                            class="btn btn-primary"\n-                            value="Save"\n-                            i18n:attributes="value"\n-                            i18n:translate=""\n-                        >\n+          <div class="formControls">\n+            <button class="btn btn-primary"\n+                    name="form.button.Save"\n+                    type="submit"\n+                    value="Save"\n+                    i18n:attributes="value"\n+                    i18n:translate=""\n+            >\n                             Save\n-                        </button>\n-\n-                        <button\n-                            type="submit"\n-                            name="form.button.Cancel"\n-                            class="btn btn-secondary"\n-                            value="Cancel"\n-                            i18n:attributes="value"\n-                            i18n:translate=""\n-                        >\n+            </button>\n+\n+            <button class="btn btn-secondary"\n+                    name="form.button.Cancel"\n+                    type="submit"\n+                    value="Cancel"\n+                    i18n:attributes="value"\n+                    i18n:translate=""\n+            >\n                             Cancel\n-                        </button>\n+            </button>\n \n-                    </div>\n+          </div>\n \n-                    <input tal:replace="structure context/@@authenticator/authenticator" />\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-                </form>\n-            </div>\n-        </div>\n-</body>\n+        </form>\n+      </div>\n+    </div>\n+  </body>\n </html>\ndiff --git a/plone/app/caching/browser/edit.pt b/plone/app/caching/browser/edit.pt\nindex 77667c5..96926da 100644\n--- a/plone/app/caching/browser/edit.pt\n+++ b/plone/app/caching/browser/edit.pt\n@@ -1,20 +1,24 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n-<metal:block fill-slot="prefs_configlet_main">\n+  <body>\n+    <metal:block fill-slot="prefs_configlet_main">\n \n-    <h1 class="documentFirstHeading" tal:content="view/title">View Title</h1>\n+      <h1 class="documentFirstHeading"\n+          tal:content="view/title"\n+      >View Title</h1>\n \n-    <div id="content-core">\n+      <div id="content-core">\n         <metal:block use-macro="context/@@ploneform-macros/titlelessform" />\n-    </div>\n+      </div>\n \n-</metal:block>\n-</body>\n+    </metal:block>\n+  </body>\n </html>\ndiff --git a/plone/app/caching/browser/import.pt b/plone/app/caching/browser/import.pt\nindex 7a672b4..03d6982 100644\n--- a/plone/app/caching/browser/import.pt\n+++ b/plone/app/caching/browser/import.pt\n@@ -1,136 +1,181 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n-\n-<body>\n-\n-<div metal:fill-slot="prefs_configlet_main">\n-\n-            <div class="autotabs">\n-                <ul class="nav nav-tabs">\n-                    <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel"\n-                           i18n:translate="label_settings">Change settings</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link active"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-import"\n-                           i18n:translate="label_import">Import settings</a>\n-                      </li>\n-                      <li tal:condition="view/purgingEnabled" class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-purge"\n-                           i18n:translate="label_purging">Purge caching proxy</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-ramcache"\n-                           i18n:translate="label_ramcache">RAM cache</a>\n-                      </li>\n-                </ul>\n-            </div>\n-\n-            <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+\n+  <body>\n+\n+    <div metal:fill-slot="prefs_configlet_main">\n+\n+      <div class="autotabs">\n+        <ul class="nav nav-tabs">\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel;\n+               "\n+               i18n:translate="label_settings"\n+            >Change settings</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link active"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-import;\n+               "\n+               i18n:translate="label_import"\n+            >Import settings</a>\n+          </li>\n+          <li class="nav-item"\n+              tal:condition="view/purgingEnabled"\n+          >\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-purge;\n+               "\n+               i18n:translate="label_purging"\n+            >Purge caching proxy</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-ramcache;\n+               "\n+               i18n:translate="label_ramcache"\n+            >RAM cache</a>\n+          </li>\n+        </ul>\n+      </div>\n+\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n             Portal status message\n-            </div>\n+      </div>\n \n-            <div class="configlet">\n+      <div class="configlet">\n \n-                <h1 class="documentFirstHeading"\n-                    i18n:translate="heading_caching_import">Import caching profiles</h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="heading_caching_import"\n+        >Import caching profiles</h1>\n \n-                <a id="setup-link" class="link-parent"\n-                    tal:attributes="href string:${portal_url}/@@overview-controlpanel"\n-                    i18n:translate="label_up_to_plone_setup">\n+        <a class="link-parent"\n+           id="setup-link"\n+           tal:attributes="\n+             href string:${portal_url}/@@overview-controlpanel;\n+           "\n+           i18n:translate="label_up_to_plone_setup"\n+        >\n                         Up to Site Setup\n-                </a>\n+        </a>\n \n-                <p class="form-text"\n-                    i18n:translate="description_caching_ipmort">\n+        <p class="form-text"\n+           i18n:translate="description_caching_ipmort"\n+        >\n                     Choose a profile below to import cache settings. Additional\n                     profiles may be installed by third party products.\n-                    <strong>Warning:</strong> This may overwrite existing\n+          <strong>Warning:</strong>\n+           This may overwrite existing\n                     settings.\n-                </p>\n-\n-                <form name="profiles" tal:attributes="action request/URL" method="post"\n-                    class="pat-formunloadalert"\n-                    tal:define="errors view/errors">\n-\n-                    <div class="mb-3 field form-check ${python:\'error\' if errors else \'\'}">\n-\n-                        <div\n-                            class="invalid-feedback"\n-                            tal:condition="errors/profile | nothing"\n-                            tal:content="errors/profile"\n-                            />\n-\n-                        <div tal:repeat="profile view/profiles">\n-\n-                            <input class="form-check-input"\n-                                type="radio"\n-                                name="profile"\n-                                tal:attributes="id string:profile-${repeat/profile/index};\n-                                                value profile/id"\n-                                />\n-\n-                            <label class="form-check-label"\n-                                tal:attributes="for string:profile-${repeat/profile/index}"\n-                                tal:content="profile/title" i18n:translate=""\n-                                />\n-\n-                            <p class="discreet" tal:content="profile/description" i18n:translate=""/>\n-\n-                        </div>\n-                    </div>\n-\n-                    <div class="field">\n-                        <input type="hidden" name="snapshot:boolean:default" value="" />\n-                        <input\n-                            type="checkbox"\n-                            name="snapshot:boolean"\n-                            id="snapshot"\n-                            value="1"\n-                            tal:attributes="checked python:\'checked\' if request.get(\'snapshot\', True) else None"\n-                            />\n-\n-                        <label for="snapshot" i18n:translate="label_snapshot">\n+        </p>\n+\n+        <form class="pat-formunloadalert"\n+              method="post"\n+              name="profiles"\n+              tal:define="\n+                errors view/errors;\n+              "\n+              tal:attributes="\n+                action request/URL;\n+              "\n+        >\n+\n+          <div class="mb-3 field form-check ${python:\'error\' if errors else \'\'}">\n+\n+            <div class="invalid-feedback"\n+                 tal:condition="errors/profile | nothing"\n+                 tal:content="errors/profile"\n+            ></div>\n+\n+            <div tal:repeat="profile view/profiles">\n+\n+              <input class="form-check-input"\n+                     name="profile"\n+                     type="radio"\n+                     tal:attributes="\n+                       id string:profile-${repeat/profile/index};\n+                       value profile/id;\n+                     "\n+              />\n+\n+              <label class="form-check-label"\n+                     tal:content="profile/title"\n+                     tal:attributes="\n+                       for string:profile-${repeat/profile/index};\n+                     "\n+                     i18n:translate=""\n+              ></label>\n+\n+              <p class="discreet"\n+                 tal:content="profile/description"\n+                 i18n:translate=""\n+              ></p>\n+\n+            </div>\n+          </div>\n+\n+          <div class="field">\n+            <input name="snapshot:boolean:default"\n+                   type="hidden"\n+                   value=""\n+            />\n+            <input id="snapshot"\n+                   name="snapshot:boolean"\n+                   type="checkbox"\n+                   value="1"\n+                   tal:attributes="\n+                     checked python:\'checked\' if request.get(\'snapshot\', True) else None;\n+                   "\n+            />\n+\n+            <label for="snapshot"\n+                   i18n:translate="label_snapshot"\n+            >\n                             Take a snapshot of the site prior to importing new\n                             setting.\n-                        </label>\n-                        <div class="formHelp" i18n:translate="help_snapshot">\n+            </label>\n+            <div class="formHelp"\n+                 i18n:translate="help_snapshot"\n+            >\n                             This allows rollback to a previous state via the\n-                            <em>portal_setup</em> tool.\n-                        </div>\n-                    </div>\n-\n-                    <div class="formControls">\n-                        <button\n-                            class="btn btn-primary"\n-                            type="submit"\n-                            name="form.button.Import"\n-                            value="Import"\n-                            i18n:attributes="value"\n-                            i18n:translate=""\n-                        >\n+              <em>portal_setup</em>\n+               tool.\n+            </div>\n+          </div>\n+\n+          <div class="formControls">\n+            <button class="btn btn-primary"\n+                    name="form.button.Import"\n+                    type="submit"\n+                    value="Import"\n+                    i18n:attributes="value"\n+                    i18n:translate=""\n+            >\n                             Import\n-                        </button>\n-                    </div>\n+            </button>\n+          </div>\n \n-                    <input tal:replace="structure context/@@authenticator/authenticator" />\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-                </form>\n-            </div>\n+        </form>\n+      </div>\n     </div>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/caching/browser/purge.pt b/plone/app/caching/browser/purge.pt\nindex decbe3d..4bf8ef4 100644\n--- a/plone/app/caching/browser/purge.pt\n+++ b/plone/app/caching/browser/purge.pt\n@@ -1,145 +1,198 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n-\n-<body>\n-\n-<div metal:fill-slot="prefs_configlet_main">\n-\n-            <div class="autotabs">\n-                <ul class="nav nav-tabs">\n-                    <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel"\n-                           i18n:translate="label_settings">Change settings</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-import"\n-                           i18n:translate="label_import">Import settings</a>\n-                      </li>\n-                      <li tal:condition="view/purgingEnabled" class="nav-item">\n-                        <a class="nav-link active"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-purge"\n-                           i18n:translate="label_purging">Purge caching proxy</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-ramcache"\n-                           i18n:translate="label_ramcache">RAM cache</a>\n-                      </li>\n-                </ul>\n-            </div>\n-\n-            <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+\n+  <body>\n+\n+    <div metal:fill-slot="prefs_configlet_main">\n+\n+      <div class="autotabs">\n+        <ul class="nav nav-tabs">\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel;\n+               "\n+               i18n:translate="label_settings"\n+            >Change settings</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-import;\n+               "\n+               i18n:translate="label_import"\n+            >Import settings</a>\n+          </li>\n+          <li class="nav-item"\n+              tal:condition="view/purgingEnabled"\n+          >\n+            <a class="nav-link active"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-purge;\n+               "\n+               i18n:translate="label_purging"\n+            >Purge caching proxy</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-ramcache;\n+               "\n+               i18n:translate="label_ramcache"\n+            >RAM cache</a>\n+          </li>\n+        </ul>\n+      </div>\n+\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n             Portal status message\n-            </div>\n+      </div>\n \n-            <div class="configlet">\n+      <div class="configlet">\n \n-                <h1 class="documentFirstHeading"\n-                    i18n:translate="heading_caching_purging">Purge caching proxy</h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="heading_caching_purging"\n+        >Purge caching proxy</h1>\n \n-                <a id="setup-link" class="link-parent"\n-                    tal:attributes="href string:${portal_url}/@@overview-controlpanel"\n-                    i18n:translate="label_up_to_plone_setup">\n+        <a class="link-parent"\n+           id="setup-link"\n+           tal:attributes="\n+             href string:${portal_url}/@@overview-controlpanel;\n+           "\n+           i18n:translate="label_up_to_plone_setup"\n+        >\n                         Up to Site Setup\n-                </a>\n+        </a>\n \n-                <p class="form-text"\n-                    i18n:translate="description_cache_purging">\n+        <p class="form-text"\n+           i18n:translate="description_cache_purging"\n+        >\n                     If you have enabled a caching proxy, it may end up caching\n                     objects which are no longer current. Plone will attempt\n                     to automatically purge objects when they change, but if\n                     you are seeing stale objects in your cache, you can purge\n                     them manually below.\n-                </p>\n-\n-                <div class="alert alert-info"\n-                     tal:condition="view/purgeLog | nothing">\n-                    <strong i18n:translate="heading_purged">Status</strong>\n-                    <span tal:omit-tag="" i18n:translate="description_purged">\n+        </p>\n+\n+        <div class="alert alert-info"\n+             tal:condition="view/purgeLog | nothing"\n+        >\n+          <strong i18n:translate="heading_purged">Status</strong>\n+          <span tal:omit-tag=""\n+                i18n:translate="description_purged"\n+          >\n                         The following items were purged:\n-                    </span>\n-                    <ul>\n-                      <li tal:repeat="log view/purgeLog" tal:content="log" />\n-                    </ul>\n-                </div>\n-\n-                <form name="purge" tal:attributes="action string:${request/URL}" method="post"\n-                    class="pat-formunloadalert"\n-                    tal:define="errors view/errors">\n-\n-                    <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                         tal:define="error errors/urls | nothing"\n-                    >\n-\n-                        <label class="form-label"\n-                               for="purgeURLs" i18n:translate="label_urls">URLs to purge</label>\n-\n-\n-                        <div class="invalid-feedback"\n-                             tal:content="error" tal:condition="error" />\n-\n-                        <textarea class="form-control"\n-                                  id="purgeURLs" name="urls:lines" cols="40" rows="4"></textarea>\n-\n-                        <div class="form-text" i18n:translate="help_urls">\n+          </span>\n+          <ul>\n+            <li tal:repeat="log view/purgeLog"\n+                tal:content="log"\n+            ></li>\n+          </ul>\n+        </div>\n+\n+        <form class="pat-formunloadalert"\n+              method="post"\n+              name="purge"\n+              tal:define="\n+                errors view/errors;\n+              "\n+              tal:attributes="\n+                action string:${request/URL};\n+              "\n+        >\n+\n+          <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+               tal:define="\n+                 error errors/urls | nothing;\n+               "\n+          >\n+\n+            <label class="form-label"\n+                   for="purgeURLs"\n+                   i18n:translate="label_urls"\n+            >URLs to purge</label>\n+\n+\n+            <div class="invalid-feedback"\n+                 tal:condition="error"\n+                 tal:content="error"\n+            ></div>\n+\n+            <textarea class="form-control"\n+                      id="purgeURLs"\n+                      cols="40"\n+                      name="urls:lines"\n+                      rows="4"\n+            ></textarea>\n+\n+            <div class="form-text"\n+                 i18n:translate="help_urls"\n+            >\n                             Enter URLs to purge, one per line, below. You can\n                             either enter a full URL including a domain, or a path\n-                            relative to the site root, starting with a <em>/</em>.\n-                        </div>\n-                    </div>\n-\n-                    <div class="mb-3 field form-check">\n-                        <input type="hidden" name="synchronous:boolean:default" value="" />\n-                        <input class="form-check-input"\n-                            type="checkbox"\n-                            name="synchronous:boolean"\n-                            id="purgeSynchronous"\n-                            value="1"\n-                            checked="checked"\n-                            />\n-\n-                        <label class="form-check-label"\n-                               for="purgeSynchronous" i18n:translate="label_synchronous">\n+                            relative to the site root, starting with a\n+              <em>/</em>.\n+            </div>\n+          </div>\n+\n+          <div class="mb-3 field form-check">\n+            <input name="synchronous:boolean:default"\n+                   type="hidden"\n+                   value=""\n+            />\n+            <input class="form-check-input"\n+                   id="purgeSynchronous"\n+                   checked="checked"\n+                   name="synchronous:boolean"\n+                   type="checkbox"\n+                   value="1"\n+            />\n+\n+            <label class="form-check-label"\n+                   for="purgeSynchronous"\n+                   i18n:translate="label_synchronous"\n+            >\n                             Purge synchronously\n-                        </label>\n-                        <div class="form-text" i18n:translate="help_synchronous">\n+            </label>\n+            <div class="form-text"\n+                 i18n:translate="help_synchronous"\n+            >\n                             Select this option to wait while the purge completes.\n                             This allows you to see the results of the purges.\n                             Purging asynchronously will return immediately, but\n                             you will need to check your caching proxy\'s log files\n                             to see if the purge actually succeeded.\n-                        </div>\n-                    </div>\n-\n-                    <div class="formControls">\n-                        <button\n-                            type="submit"\n-                            name="form.button.Purge"\n-                            class="btn btn-primary"\n-                            value="Purge"\n-                            i18n:attributes="value"\n-                            i18n:translate=""\n-                        >\n+            </div>\n+          </div>\n+\n+          <div class="formControls">\n+            <button class="btn btn-primary"\n+                    name="form.button.Purge"\n+                    type="submit"\n+                    value="Purge"\n+                    i18n:attributes="value"\n+                    i18n:translate=""\n+            >\n                             Purge\n-                        </button>\n-                    </div>\n+            </button>\n+          </div>\n \n-                    <input tal:replace="structure context/@@authenticator/authenticator" />\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-                </form>\n-            </div>\n+        </form>\n+      </div>\n \n-</div>\n-</body>\n+    </div>\n+  </body>\n </html>\ndiff --git a/plone/app/caching/browser/ramcache.pt b/plone/app/caching/browser/ramcache.pt\nindex 18147b8..bc1813d 100644\n--- a/plone/app/caching/browser/ramcache.pt\n+++ b/plone/app/caching/browser/ramcache.pt\n@@ -1,110 +1,143 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<div metal:fill-slot="prefs_configlet_main">\n+    <div metal:fill-slot="prefs_configlet_main">\n \n-            <div class="autotabs">\n-                <ul class="nav nav-tabs">\n-                    <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel"\n-                           i18n:translate="label_settings">Change settings</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-import"\n-                           i18n:translate="label_import">Import settings</a>\n-                      </li>\n-                      <li tal:condition="view/purgingEnabled" class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-purge"\n-                           i18n:translate="label_purging">Purge caching proxy</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link active"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-ramcache"\n-                           i18n:translate="label_ramcache">RAM cache</a>\n-                      </li>\n-                </ul>\n-            </div>\n+      <div class="autotabs">\n+        <ul class="nav nav-tabs">\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel;\n+               "\n+               i18n:translate="label_settings"\n+            >Change settings</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-import;\n+               "\n+               i18n:translate="label_import"\n+            >Import settings</a>\n+          </li>\n+          <li class="nav-item"\n+              tal:condition="view/purgingEnabled"\n+          >\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-purge;\n+               "\n+               i18n:translate="label_purging"\n+            >Purge caching proxy</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link active"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-ramcache;\n+               "\n+               i18n:translate="label_ramcache"\n+            >RAM cache</a>\n+          </li>\n+        </ul>\n+      </div>\n \n-            <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n             Portal status message\n-            </div>\n+      </div>\n \n-            <div class="configlet">\n+      <div class="configlet">\n \n-                <h1 class="documentFirstHeading"\n-                    i18n:translate="heading_ramcache_stats">RAM cache statistics</h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="heading_ramcache_stats"\n+        >RAM cache statistics</h1>\n \n-                <a id="setup-link" class="link-parent"\n-                    tal:attributes="href string:${portal_url}/@@overview-controlpanel"\n-                    i18n:translate="label_up_to_plone_setup">\n+        <a class="link-parent"\n+           id="setup-link"\n+           tal:attributes="\n+             href string:${portal_url}/@@overview-controlpanel;\n+           "\n+           i18n:translate="label_up_to_plone_setup"\n+        >\n                         Up to Site Setup\n-                </a>\n+        </a>\n \n-                <p class="form-text"\n-                    i18n:translate="description_ramcache_stats">\n+        <p class="form-text"\n+           i18n:translate="description_ramcache_stats"\n+        >\n                     The table below shows statistics for the default RAM\n-                    cache. You can use the <em>Purge</em> button to manually\n+                    cache. You can use the\n+          <em>Purge</em>\n+           button to manually\n                     clear the cache if you suspect there are stale items there.\n-                </p>\n+        </p>\n \n-                <form name="purge" tal:attributes="action string:${request/URL}" method="post"\n-                    class="pat-formunloadalert"\n-                    tal:define="errors view/errors">\n+        <form class="pat-formunloadalert"\n+              method="post"\n+              name="purge"\n+              tal:define="\n+                errors view/errors;\n+              "\n+              tal:attributes="\n+                action string:${request/URL};\n+              "\n+        >\n \n-                  <table class="table table-striped table-responsive"\n-                         tal:define="stats view/ramCache/getStatistics"\n-                         summary="RAM cache statistics"\n-                         i18n:attributes="summary heading_ramcache_stats;">\n-                    <thead>\n-                      <th i18n:translate="label_cache_key">Key</th>\n-                      <th i18n:translate="label_cache_hits">Hits</th>\n-                      <th i18n:translate="label_cache_misses">Misses</th>\n-                      <th i18n:translate="label_cache_size_bytes">Size (bytes)</th>\n-                      <th i18n:translate="label_cache_entries">Entries</th>\n-                    </thead>\n-                    <tbody>\n-                      <tr tal:repeat="data stats">\n-                        <td><span tal:content="data/path">&nbsp;</span></td>\n-                        <td><span tal:content="data/hits">&nbsp;</span></td>\n-                        <td><span tal:content="data/misses">&nbsp;</span></td>\n-                        <td><span tal:content="data/size">&nbsp;</span></td>\n-                        <td><span tal:content="data/entries">&nbsp;</span></td>\n-                      </tr>\n-                    </tbody>\n-                  </table>\n+          <table class="table table-striped table-responsive"\n+                 summary="RAM cache statistics"\n+                 tal:define="\n+                   stats view/ramCache/getStatistics;\n+                 "\n+                 i18n:attributes="summary heading_ramcache_stats;"\n+          >\n+            <thead>\n+              <th i18n:translate="label_cache_key">Key</th>\n+              <th i18n:translate="label_cache_hits">Hits</th>\n+              <th i18n:translate="label_cache_misses">Misses</th>\n+              <th i18n:translate="label_cache_size_bytes">Size (bytes)</th>\n+              <th i18n:translate="label_cache_entries">Entries</th>\n+            </thead>\n+            <tbody>\n+              <tr tal:repeat="data stats">\n+                <td><span tal:content="data/path">&nbsp;</span></td>\n+                <td><span tal:content="data/hits">&nbsp;</span></td>\n+                <td><span tal:content="data/misses">&nbsp;</span></td>\n+                <td><span tal:content="data/size">&nbsp;</span></td>\n+                <td><span tal:content="data/entries">&nbsp;</span></td>\n+              </tr>\n+            </tbody>\n+          </table>\n \n-                    <div class="formControls">\n-                        <button\n-                            class="btn btn-primary"\n-                            type="submit"\n-                            name="form.button.Purge"\n-                            value="Purge"\n-                            i18n:attributes="value"\n-                            i18n:translate=""\n-                        >\n+          <div class="formControls">\n+            <button class="btn btn-primary"\n+                    name="form.button.Purge"\n+                    type="submit"\n+                    value="Purge"\n+                    i18n:attributes="value"\n+                    i18n:translate=""\n+            >\n                           Purge\n-                        </button>\n-                    </div>\n+            </button>\n+          </div>\n \n-                    <input tal:replace="structure context/@@authenticator/authenticator" />\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-                </form>\n-            </div>\n+        </form>\n+      </div>\n \n-</div>\n-</body>\n+    </div>\n+  </body>\n </html>\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-17T14:06:44+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/947cbe3b978fb1780fc1229060ed0e6f8c2dc799

format

Files changed:
M plone/app/caching/browser/controlpanel.py
M plone/app/caching/browser/edit.py
M plone/app/caching/lookup.py
M plone/app/caching/operations/utils.py
M plone/app/caching/purge.py
M plone/app/caching/setuphandlers.py
M plone/app/caching/testing.py
M plone/app/caching/tests/test_etags.py
M plone/app/caching/tests/test_integration.py
M plone/app/caching/tests/test_lastmodified.py
M plone/app/caching/tests/test_lookup.py
M plone/app/caching/tests/test_operation_parameters.py
M plone/app/caching/tests/test_operation_utils.py
M plone/app/caching/tests/test_profile_with_caching_proxy.py
M plone/app/caching/tests/test_profile_without_caching_proxy.py
M plone/app/caching/tests/test_purge.py
M plone/app/caching/tests/test_utils.py

b'diff --git a/plone/app/caching/browser/controlpanel.py b/plone/app/caching/browser/controlpanel.py\nindex c7415a0..a79fa3a 100644\n--- a/plone/app/caching/browser/controlpanel.py\n+++ b/plone/app/caching/browser/controlpanel.py\n@@ -110,7 +110,6 @@ def publishTraverse(self, request, name):\n             self.editOperationName = name\n \n             if self.editGlobal:\n-\n                 operation = queryUtility(\n                     ICachingOperationType, name=self.editOperationName\n                 )\n@@ -163,7 +162,6 @@ def update(self):\n                 )\n \n     def processSave(self):\n-\n         form = self.request.form\n \n         # Form data\n@@ -215,7 +213,10 @@ def processSave(self):\n                         contentType,\n                     )\n                     error_ruleset = contentTypeRulesetMapping[contentType]\n-                    self.errors.setdefault("contenttypes", {},)[ruleset] = _(\n+                    self.errors.setdefault(\n+                        "contenttypes",\n+                        {},\n+                    )[ruleset] = _(\n                         "Content type ${error_content_type} is already mapped to "\n                         "the rule ${ruleset}.",\n                         mapping={\n@@ -237,7 +238,10 @@ def processSave(self):\n                     continue\n \n                 if template in templateRulesetMapping:\n-                    self.errors.setdefault("templates", {},)[ruleset] = _(\n+                    self.errors.setdefault(\n+                        "templates",\n+                        {},\n+                    )[ruleset] = _(\n                         "Template ${template} is already mapped to the rule "\n                         "${ruleset}.",\n                         mapping={\n@@ -630,7 +634,6 @@ def update(self):\n                 self.processPurge()\n \n     def processPurge(self):\n-\n         if self.ramCache is None:\n             IStatusMessage(self.request).addStatusMessage(\n                 _("RAM cache not installed."), "error"\ndiff --git a/plone/app/caching/browser/edit.py b/plone/app/caching/browser/edit.py\nindex da3bf84..b667df8 100644\n--- a/plone/app/caching/browser/edit.py\n+++ b/plone/app/caching/browser/edit.py\n@@ -75,7 +75,6 @@ def __init__(\n         self.ruleset = ruleset\n \n     def update(self):\n-\n         self.registry = getUtility(IRegistry)\n \n         # If we were using plone.z3cform, this would be done with\n@@ -170,10 +169,8 @@ def applyChanges(self, data):\n         """Save changes in the given data dictionary to the registry."""\n \n         for key, value in data.items():\n-\n             # Lazily create per-ruleset records if necessary\n             if key not in self.registry.records:\n-\n                 # This should only ever happen if we have a not-yet-creted\n                 # ruleset-specific record\n                 assert self.rulesetName in key\n@@ -195,7 +192,6 @@ def applyChanges(self, data):\n                 self.registry[key] = value\n \n     def cloneField(self, field):\n-\n         # XXX: The field may sometimes not have data for reasons known only\n         # to Jim.\n         try:\ndiff --git a/plone/app/caching/lookup.py b/plone/app/caching/lookup.py\nindex 1c2ae31..d19402c 100644\n--- a/plone/app/caching/lookup.py\n+++ b/plone/app/caching/lookup.py\n@@ -54,7 +54,6 @@ def __init__(self, published, request):\n         self.request = request\n \n     def __call__(self):\n-\n         # 1. Attempt to look up a ruleset using the default lookup\n         ruleset = lookup(self.published)\n         if ruleset is not None:\ndiff --git a/plone/app/caching/operations/utils.py b/plone/app/caching/operations/utils.py\nindex c5a6091..7821b49 100644\n--- a/plone/app/caching/operations/utils.py\n+++ b/plone/app/caching/operations/utils.py\n@@ -399,7 +399,6 @@ def isModified(request, etag=None, lastModified=None):\n \n     # Check the modification date\n     if ifModifiedSince and lastModified is not None:\n-\n         # Attempt to get a date\n \n         ifModifiedSince = ifModifiedSince.split(";")[0]\ndiff --git a/plone/app/caching/purge.py b/plone/app/caching/purge.py\nindex 40d8154..dbfe0ca 100644\n--- a/plone/app/caching/purge.py\n+++ b/plone/app/caching/purge.py\n@@ -160,7 +160,6 @@ def getAbsolutePaths(self):\n \n     @memoize\n     def _getRoot(self):\n-\n         plone_utils = getToolByName(self.context, "plone_utils", None)\n         if plone_utils is None:\n             return\ndiff --git a/plone/app/caching/setuphandlers.py b/plone/app/caching/setuphandlers.py\nindex 0ef14b5..6029e58 100644\n--- a/plone/app/caching/setuphandlers.py\n+++ b/plone/app/caching/setuphandlers.py\n@@ -13,7 +13,6 @@ def enableExplicitMode():\n \n \n def importVarious(context):\n-\n     if not context.readDataFile("plone.app.caching.txt"):\n         return\n \ndiff --git a/plone/app/caching/testing.py b/plone/app/caching/testing.py\nindex f474824..f9608c4 100644\n--- a/plone/app/caching/testing.py\n+++ b/plone/app/caching/testing.py\n@@ -37,7 +37,6 @@ def stopThreads(self, wait=False):\n \n class PloneAppCachingBase(PloneSandboxLayer):\n     def setUpZope(self, app, configurationContext):\n-\n         # Load ZCML\n         import plone.app.caching\n \n@@ -57,7 +56,6 @@ def tearDownZope(self, app):\n \n \n class PloneAppCaching(PloneAppCachingBase):\n-\n     defaultBases = (PLONE_APP_CONTENTTYPES_FIXTURE,)\n \n \ndiff --git a/plone/app/caching/tests/test_etags.py b/plone/app/caching/tests/test_etags.py\nindex 986b4b0..83e281d 100644\n--- a/plone/app/caching/tests/test_etags.py\n+++ b/plone/app/caching/tests/test_etags.py\n@@ -31,7 +31,6 @@ def __init__(self, parent=None):\n \n \n class TestETags(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/caching/tests/test_integration.py b/plone/app/caching/tests/test_integration.py\nindex 10d134f..7e00036 100644\n--- a/plone/app/caching/tests/test_integration.py\n+++ b/plone/app/caching/tests/test_integration.py\n@@ -175,7 +175,6 @@ def test_disabled(self):\n         # self.assertTrue(\'Cache-Control\' in browser.headers)\n \n     def test_auto_purge_content_types(self):\n-\n         setRoles(self.portal, TEST_USER_ID, ("Manager",))\n \n         # Non-folder content\ndiff --git a/plone/app/caching/tests/test_lastmodified.py b/plone/app/caching/tests/test_lastmodified.py\nindex bcd4f29..a67a6c0 100644\n--- a/plone/app/caching/tests/test_lastmodified.py\n+++ b/plone/app/caching/tests/test_lastmodified.py\n@@ -24,7 +24,6 @@ def register(self, object):\n \n \n class TestLastModified(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -148,7 +147,6 @@ def test_CatalogableDublinCoreLastModified(self):\n \n         @implementer(ICatalogableDublinCore)\n         class Dummy:\n-\n             _mod = None\n \n             def modified(self):\n@@ -172,7 +170,6 @@ def test_DCTimesLastModified(self):\n \n         @implementer(IDCTimes)\n         class Dummy:\n-\n             _mod = None\n \n             @property\ndiff --git a/plone/app/caching/tests/test_lookup.py b/plone/app/caching/tests/test_lookup.py\nindex 9f8a2ec..5c46781 100644\n--- a/plone/app/caching/tests/test_lookup.py\n+++ b/plone/app/caching/tests/test_lookup.py\n@@ -76,7 +76,6 @@ class DummyView(BrowserView):\n \n \n class TestContentItemLookup(unittest.TestCase):\n-\n     layer = IMPLICIT_RULESET_REGISTRY_UNIT_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/caching/tests/test_operation_parameters.py b/plone/app/caching/tests/test_operation_parameters.py\nindex 3b989f0..0f5923a 100644\n--- a/plone/app/caching/tests/test_operation_parameters.py\n+++ b/plone/app/caching/tests/test_operation_parameters.py\n@@ -35,7 +35,6 @@ def tearDown(self):\n         setRequest(None)\n \n     def test_anon_only(self):\n-\n         # Add folder content\n         setRoles(self.portal, TEST_USER_ID, ("Manager",))\n         self.portal.invokeFactory("Folder", "f1")\ndiff --git a/plone/app/caching/tests/test_operation_utils.py b/plone/app/caching/tests/test_operation_utils.py\nindex ff5ce36..9661e69 100644\n--- a/plone/app/caching/tests/test_operation_utils.py\n+++ b/plone/app/caching/tests/test_operation_utils.py\n@@ -40,7 +40,6 @@ def normalize_response_cache(value):\n \n \n class ResponseModificationHelpersTest(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -392,7 +391,6 @@ def test_cacheInRAM_etag_alternate_key(self):\n \n \n class ResponseInterceptorHelpersTest(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -537,7 +535,6 @@ def test_notModified_full(self):\n \n \n class CacheCheckHelpersTest(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -841,7 +838,6 @@ def test_visibleToRole_permission(self):\n \n \n class MiscHelpersTest(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -1264,7 +1260,6 @@ def test_parseETags_multiple_quoted_weak_disallowed(self):\n \n \n class RAMCacheTest(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/caching/tests/test_profile_with_caching_proxy.py b/plone/app/caching/tests/test_profile_with_caching_proxy.py\nindex ca724c3..8df999a 100644\n--- a/plone/app/caching/tests/test_profile_with_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_with_caching_proxy.py\n@@ -304,7 +304,6 @@ def test_composite_viewsxx(self):\n         self.assertEqual("200 OK", browser.headers["Status"].upper())\n \n     def test_content_feeds(self):\n-\n         catalog = self.portal["portal_catalog"]\n         skins_tool = self.portal["portal_skins"]\n \n@@ -405,7 +404,6 @@ def test_content_feeds(self):\n         self.assertIsNone(browser.headers.get("X-RAMCache"))\n \n     def test_content_files(self):\n-\n         # Add folder content\n         setRoles(self.portal, TEST_USER_ID, ("Manager",))\n         self.portal.invokeFactory("Folder", "f1")\ndiff --git a/plone/app/caching/tests/test_profile_without_caching_proxy.py b/plone/app/caching/tests/test_profile_without_caching_proxy.py\nindex 4ce78dd..07a0585 100644\n--- a/plone/app/caching/tests/test_profile_without_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_without_caching_proxy.py\n@@ -56,7 +56,6 @@ def tearDown(self):\n         setRequest(None)\n \n     def test_composite_views(self):\n-\n         catalog = self.portal["portal_catalog"]\n         default_skin = self.portal["portal_skins"].default_skin\n \n@@ -276,7 +275,6 @@ def test_composite_views(self):\n         self.assertEqual("200 OK", browser.headers["Status"].upper())\n \n     def test_content_feeds(self):\n-\n         catalog = self.portal["portal_catalog"]\n         default_skin = self.portal["portal_skins"].default_skin\n \n@@ -377,7 +375,6 @@ def test_content_feeds(self):\n         self.assertIsNone(browser.headers.get("X-RAMCache"))\n \n     def test_content_files(self):\n-\n         # Add folder content\n         setRoles(self.portal, TEST_USER_ID, ("Manager",))\n         self.portal.invokeFactory("Folder", "f1")\ndiff --git a/plone/app/caching/tests/test_purge.py b/plone/app/caching/tests/test_purge.py\nindex 3b433a1..a37acc6 100644\n--- a/plone/app/caching/tests/test_purge.py\n+++ b/plone/app/caching/tests/test_purge.py\n@@ -92,7 +92,6 @@ def getParentNode(self):\n \n @implementer(IBrowserDefault)\n class FauxContent(FauxNonContent):\n-\n     portal_type = "testtype"\n \n     def defaultView(self):\n@@ -105,7 +104,6 @@ class FauxDiscussable(Explicit):\n \n \n class TestPurgeRedispatch(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -182,7 +180,6 @@ def test_removed(self):\n \n \n class TestContentPurgePaths(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def test_no_default_view(self):\n@@ -230,7 +227,6 @@ def test_parent_default_view(self):\n \n \n class TestDiscussionItemPurgePaths(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -319,11 +315,9 @@ def getDiscussionThread(self, item):\n \n \n class TestScalesPurgePaths(unittest.TestCase):\n-\n     layer = PLONE_APP_CACHING_FUNCTIONAL_TESTING\n \n     def setUp(self):\n-\n         self.portal = self.layer["portal"]\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n         self.portal.invokeFactory("Folder", "media")\n@@ -346,7 +340,6 @@ def setUp(self):\n         @implementer(IBehaviorAssignable)\n         @adapter(IDocument)\n         class TestingAssignable:\n-\n             enabled = [ILeadImageBehavior]\n             name = "plone.leadimage"\n \ndiff --git a/plone/app/caching/tests/test_utils.py b/plone/app/caching/tests/test_utils.py\nindex 0b36c3d..2a8c003 100644\n--- a/plone/app/caching/tests/test_utils.py\n+++ b/plone/app/caching/tests/test_utils.py\n@@ -98,7 +98,6 @@ def getTypeInfo(self):\n \n \n class TestIsPurged(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -155,7 +154,6 @@ def test_listed(self):\n \n \n class TestGetObjectDefaultPath(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def test_not_content(self):\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-17T14:27:21+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/9287fa1ce265da5afb043d4cdfddaa0d8ce7a668

Removed codespell: I can't get it to ignore some words.

I also see it failing in the few other packages where we already use codespell.
Maybe a new version does something different?

I tried adding this in `.meta.toml`:

```
[codespell]
additional-ignores = "discreet,Ordner"
```

Reasons:

- 'discreet' is a css class, so should not be changed into 'discrete'.
- 'Ordner' is a German word in a test file.

This results in the following lines in `pyproject.toml`:

```
[tool.codespell]
ignore-words-list = "discreet,Ordner"
```

This does not do anything.  `codespell` even complains that `discreet` and `Ordner` are used in `pyproject.toml`!

```
[tool.codespell]
ignore-words-list = ['discreet', 'ordner']
```

`codespell` has [config](https://github.com/codespell-project/codespell/blob/master/pyproject.toml#L95-L99) with a different notation that uses itself, but it is commented out:

```
```

Files changed:
M .pre-commit-config.yaml

b'diff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex 99f9928..93c32af 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -26,10 +26,6 @@ repos:\n     rev: 6.0.0\n     hooks:\n     -   id: flake8\n--   repo: https://github.com/codespell-project/codespell\n-    rev: v2.2.2\n-    hooks:\n-    -   id: codespell\n -   repo: https://github.com/mgedmin/check-manifest\n     rev: "0.49"\n     hooks:\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-17T14:35:32+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/c17cf8387a1e9b661db1e1a08780a94245889ca9

news snippet.

Files changed:
M news/66035512.internal

b'diff --git a/news/66035512.internal b/news/66035512.internal\nindex c08f539..a84095d 100644\n--- a/news/66035512.internal\n+++ b/news/66035512.internal\n@@ -1,2 +1,2 @@\n-Update configuration files.\n+Update configuration files to plone/meta.\n [plone devs]\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-24T22:54:55+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/82b57b28740ab9c35a90a69077166d5e6645f241

Configuring with plone/meta

Files changed:
A news/cbbcff93.internal
M .meta.toml
M .pre-commit-config.yaml

b'diff --git a/.meta.toml b/.meta.toml\nindex c1877f3..7edb202 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -2,7 +2,7 @@\n # https://github.com/plone/meta/tree/master/config/default\n [meta]\n template = "default"\n-commit-id = "66035512"\n+commit-id = "cbbcff93"\n \n [dependencies]\n mappings = [\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex 93c32af..a3085c9 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -14,7 +14,7 @@ repos:\n     rev: 5.12.0\n     hooks:\n     -   id: isort\n--   repo: https://github.com/ambv/black\n+-   repo: https://github.com/psf/black\n     rev: 23.1.0\n     hooks:\n     -   id: black\n@@ -26,6 +26,12 @@ repos:\n     rev: 6.0.0\n     hooks:\n     -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n -   repo: https://github.com/mgedmin/check-manifest\n     rev: "0.49"\n     hooks:\ndiff --git a/news/cbbcff93.internal b/news/cbbcff93.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/cbbcff93.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-24T22:58:42+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/6870d184a6374b90bde53635eb14bac1ef1de004

Configure codespell

Files changed:
M .meta.toml
M pyproject.toml
D news/66035512.internal

b'diff --git a/.meta.toml b/.meta.toml\nindex 7edb202..c666367 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -10,3 +10,6 @@ mappings = [\n     "python-dateutil = [\'dateutil\']",\n     ]\n ignores = "[\'zope.dublincore\']"\n+\n+[codespell]\n+additional-ignores = "discreet,ordner"\ndiff --git a/news/66035512.internal b/news/66035512.internal\ndeleted file mode 100644\nindex a84095d..0000000\n--- a/news/66035512.internal\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-Update configuration files to plone/meta.\n-[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 9a3db87..35be7aa 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -46,3 +46,6 @@ target-version = ["py38"]\n ignore-packages = [\'zope.dublincore\']\n Zope = [\'OFS\', \'Products.Five\', \'Products.PageTemplates\', \'ZPublisher\']\n python-dateutil = [\'dateutil\']\n+\n+[tool.codespell]\n+ignore-words-list = "discreet,ordner"\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-24T23:01:59+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/2564c6935ae83bfecf1412072029f727e17b018c

config check-manifest

Files changed:
M .meta.toml

b'diff --git a/.meta.toml b/.meta.toml\nindex c666367..84474c2 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -11,5 +11,13 @@ mappings = [\n     ]\n ignores = "[\'zope.dublincore\']"\n \n+[check-manifest]\n+additional-ignores = [\n+    ".tox",\n+    "constraints-mxdev.txt",\n+    "instance",\n+    "requirements-mxdev.txt",\n+    ]\n+\n [codespell]\n additional-ignores = "discreet,ordner"\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-24T23:02:16+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/c310660ccd4907c32bdc4101250c368f05945e42

Configuring with plone/meta

Files changed:
M pyproject.toml
M setup.cfg

b'diff --git a/pyproject.toml b/pyproject.toml\nindex 35be7aa..22f22ec 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -42,10 +42,10 @@ profile = "plone"\n [tool.black]\n target-version = ["py38"]\n \n+[tool.codespell]\n+ignore-words-list = "discreet,ordner"\n+\n [tool.dependencychecker]\n ignore-packages = [\'zope.dublincore\']\n Zope = [\'OFS\', \'Products.Five\', \'Products.PageTemplates\', \'ZPublisher\']\n python-dateutil = [\'dateutil\']\n-\n-[tool.codespell]\n-ignore-words-list = "discreet,ordner"\ndiff --git a/setup.cfg b/setup.cfg\nindex e70eb25..d9ca197 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -22,3 +22,7 @@ ignore =\n     .pre-commit-config.yaml\n     tox.ini\n     lint-requirements.txt\n+    .tox\n+    constraints-mxdev.txt\n+    instance\n+    requirements-mxdev.txt\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-24T23:22:27+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/af2d7a2a76056995d06a3fe603d70c814868a725

Merge branch 'master' into config-with-default-template-2564c693

Files changed:
A CHANGES.md
A Makefile
A README.md
A docs/changelog_template.jinja
A instance.yaml
A mx.ini
A requirements.txt
M .gitignore
M .meta.toml
M MANIFEST.in
M pyproject.toml
M setup.cfg
M setup.py
D CHANGES.rst
D CONTRIBUTING.rst
D README.rst
D docs/README.rst
D docs/caching-control-panel.rst
D docs/caching-profiles.rst
D docs/caching-proxies.rst
D docs/composite-views.rst
D docs/conf.py
D docs/etags.rst
D docs/index.rst
D docs/ram-cache.rst
D docs/restapi.rst
D docs/rulesets-and-caching-operations.rst
D news/1.bugfix

b'diff --git a/.gitignore b/.gitignore\nindex aafcd8e..e1a30dc 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -8,11 +8,12 @@ develop-eggs/\n downloads/\n eggs/\n include/\n+instance/\n lib/\n parts/\n var/\n-docs/Makefile\n-docs/make.bat\n-docs/doctrees\n-docs/html\n-\n+# Tox\n+.tox\n+# mxdev\n+constraints-mxdev.txt\n+requirements-mxdev.txt\ndiff --git a/.meta.toml b/.meta.toml\nindex 84474c2..15742c4 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -15,7 +15,9 @@ ignores = "[\'zope.dublincore\']"\n additional-ignores = [\n     ".tox",\n     "constraints-mxdev.txt",\n-    "instance",\n+    "instance.yaml",\n+    "Makefile",\n+    "mx.ini",\n     "requirements-mxdev.txt",\n     ]\n \ndiff --git a/CHANGES.rst b/CHANGES.md\nsimilarity index 77%\nrename from CHANGES.rst\nrename to CHANGES.md\nindex 32ac7bf..ae8cd52 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.md\n@@ -1,18 +1,31 @@\n-Changelog\n----------\n+# Changelog\n \n-.. You should *NOT* be adding new change log entries to this file.\n+<!--\n+   You should *NOT* be adding new change log entries to this file.\n    You should create a file in the news directory instead.\n    For helpful instructions, please see:\n    https://github.com/plone/plone.releaser/blob/master/ADD-A-NEWS-ITEM.rst\n+-->\n \n-.. towncrier release notes start\n+<!-- towncrier release notes start -->\n \n-3.0.2 (2023-01-26)\n-------------------\n+## 3.0.3 (2023-02-22)\n \n-Bug fixes:\n \n+### Bug fixes:\n+\n+- Declare dependencies.\n+  [gforcada] #1\n+\n+\n+### Documentation:\n+\n+- Convert README and CHANGES to markdown.  [ericof] #114\n+\n+\n+## 3.0.2 (2023-01-26)\n+\n+### Bug fixes:\n \n - Correct Bootstrap classes for `<select />` in controlpanel.\n   [petschki] (#112)\n@@ -21,212 +34,150 @@ Bug fixes:\n   See `Zope issue 1089 <https://github.com/zopefoundation/Zope/issues/1089>`_.\n   [maurits] (#1089)\n \n+## 3.0.1 (2022-12-21)\n \n-3.0.1 (2022-12-21)\n-------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Fix tests to work with the Zope security fix.\n   [maurits] (#106)\n \n+## 3.0.0 (2022-11-14)\n \n-3.0.0 (2022-11-14)\n-------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Add missing quotation mark in Etag 304 Response [sverbois] (#104)\n \n+## 3.0.0b2 (2022-07-20)\n \n-3.0.0b2 (2022-07-20)\n---------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Remove trailing comma to avoid different default messages for the same msgid\n   [erral] (#102)\n \n+## 3.0.0b1 (2022-06-23)\n \n-3.0.0b1 (2022-06-23)\n---------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Add missing i18n tags\n   [erral] (#101)\n \n+## 3.0.0a14 (2022-05-15)\n \n-3.0.0a14 (2022-05-15)\n----------------------\n-\n-Breaking changes:\n-\n+### Breaking changes:\n \n - Remove unmaintained Split-View profile.\n   [jensens] (#99)\n \n-\n-New features:\n-\n+### New features:\n \n - Move caching ruleset assignments from here to plone.restapi and add ZCML feature here.\n   [jensens] (#100)\n \n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Minor overhaul, use plone.base, remove some Plone 5.2 imports, ...\n   [jensens] (#98)\n - Minor code cleanup and review/overhaul docs.\n   [jensens] (#99)\n \n+## 3.0.0a13 (2022-04-05)\n \n-3.0.0a13 (2022-04-05)\n----------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Apply black to the codebase, format it to be Python 3 only (#94)\n \n+## 3.0.0a12 (2022-04-04)\n \n-3.0.0a12 (2022-04-04)\n----------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Test-only fix: caching checks for ``timestamp.txt`` in ``portal_resources`` which is no longer there.\n   Update ETAG Headers accordingly.\n   [pbauer] (#92)\n \n+## 3.0.0a11 (2022-02-24)\n \n-3.0.0a11 (2022-02-24)\n----------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Updated control panel icon. Use iconresolver to get the proper svg icon.\n   [yurj] (#91)\n \n+## 3.0.0a10 (2021-12-01)\n \n-3.0.0a10 (2021-12-01)\n----------------------\n-\n-New features:\n-\n+### New features:\n \n - When purging images also purge the field WITHOUT a size parameter (e.g. ``[...]/@@images/image``).\n   [wolbernd] (#89)\n \n+## 3.0.0a9 (2021-11-23)\n \n-3.0.0a9 (2021-11-23)\n---------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Remove translations endpoint test because it does not have the correct fixture\n   [sneridagh] (#87)\n \n+## 3.0.0a8 (2021-10-22)\n \n-3.0.0a8 (2021-10-22)\n---------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - fix deprecated imports\n   [petschki] (#86)\n \n+## 3.0.0a7 (2021-10-13)\n \n-3.0.0a7 (2021-10-13)\n---------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Fix label in controlpanel.pt.  [brian.duncan] (#84)\n \n+## 3.0.0a6 (2021-09-15)\n \n-3.0.0a6 (2021-09-15)\n---------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Add upgrade step to define the new base terse cache setting.\n   [maurits] (#82)\n \n+## 3.0.0a5 (2021-09-01)\n \n-3.0.0a5 (2021-09-01)\n---------------------\n-\n-New features:\n-\n+### New features:\n \n - Add etag for layout property.\n   This is not yet added to a caching profile, but this can be done later.\n   Fixes `issue 80 <https://github.com/plone/plone.app.caching/issues/80>`_.\n   [maurits] (#80)\n \n+## 3.0.0a4 (2021-05-14)\n \n-3.0.0a4 (2021-05-14)\n---------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Fix ram-caching of binary files.\n   [agitator] (#79)\n \n+## 3.0.0a3 (2021-02-25)\n \n-3.0.0a3 (2021-02-25)\n---------------------\n-\n-Breaking changes:\n-\n+### Breaking changes:\n \n - Update for Plone 6 with Bootstrap markup\n   [ale-rt, jensens] (#63)\n \n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Links with pat-modal:  Remove unused redirectOnResponse from data-pat-modal actionOptions.  (Products.CMFPlone#3197)\n   [fulv] (#3197)\n \n+## 3.0.0a2 (2021-02-02)\n \n-3.0.0a2 (2021-02-02)\n---------------------\n-\n-New features:\n-\n+### New features:\n \n - Restored ``resourceRegistries`` ETag, but now for Plone 5 resource registries.\n   Fixes warning "Could not find value adapter for ETag component resourceRegistries".\n   [maurits] (#61)\n \n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Add more purge paths for images and downloads [jensens] (#71)\n \n+## 3.0.0a1 (2020-12-03)\n \n-3.0.0a1 (2020-12-03)\n---------------------\n-\n-Breaking changes:\n-\n+### Breaking changes:\n \n - Remove traces of Archetypes\n   [pbauer] (#68)\n@@ -234,9 +185,7 @@ Breaking changes:\n   Black code style and isort.\n   [jensens] (#69)\n \n-\n-New features:\n-\n+### New features:\n \n - Introduce *terseCaching* operation and `plone.content.dynamic` ruleset.\n   *terseCaching* is a rule with by default 10s in browser cache and 60s in edge cache.\n@@ -249,104 +198,75 @@ New features:\n   Latter may conflict with edge side cache not supporting the Vary header.\n   [jensens] (66-2)\n \n+## 2.0.8 (2020-10-30)\n \n-2.0.8 (2020-10-30)\n-------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Do not assume request or request.URL is a string. It might be None. [jensens, iham] (#59)\n - Remove hopelessly outdated proxy config examples.\n   Look at plone.recipe.varnish for excellent examples!\n   [jensens] (#64)\n \n+## 2.0.7 (2020-09-28)\n \n-2.0.7 (2020-09-28)\n-------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Fixed invalid escape sequences.\n   [maurits] (#3130)\n \n+## 2.0.6 (2020-06-24)\n \n-2.0.6 (2020-06-24)\n-------------------\n-\n-New features:\n-\n+### New features:\n \n - Remove Range from request if the If-Range condition is not fulfilled\n   [mamico] (#58)\n \n+## 2.0.5 (2020-04-20)\n \n-2.0.5 (2020-04-20)\n-------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Minor packaging updates. (#1)\n \n+## 2.0.4 (2020-02-20)\n \n-2.0.4 (2020-02-20)\n-------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Purging image scales of behavior fields, e.g. lead image\n   [ksuess] (#55)\n \n+## 2.0.3 (2019-09-13)\n \n-2.0.3 (2019-09-13)\n-------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Fix python3 related encoding error on manual purge page.\n   [agitator] (#51)\n \n+## 2.0.2 (2019-04-10)\n \n-2.0.2 (2019-04-10)\n-------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - fix typo [vincentfretin] (#47)\n - Fix controlpanel for Python 3\n   [petschki] (#48)\n \n+## 2.0.1 (2019-03-03)\n \n-2.0.1 (2019-03-03)\n-------------------\n-\n-Bug fixes:\n-\n+### Bug fixes:\n \n - Only fire 1 Purge() when deleting content, instead of 3 [skurfer]\n   Detect and ignore content creation more reliably [skurfer]\n   Also purge the parent object when something changes (since the parent probably displays a list that includes the item being changed)\n   [skurfer] (#37)\n \n+## 2.0.0 (2019-02-08)\n \n-2.0.0 (2019-02-08)\n-------------------\n-\n-Breaking changes:\n-\n+### Breaking changes:\n \n - Removed legacy resource registries [ksuess] (#45)\n \n+## 1.2.23 (2018-12-28)\n \n-1.2.23 (2018-12-28)\n--------------------\n-\n-Bug fixes:\n+### Bug fixes:\n \n - Warn after save if caching was disabled while purging is still enabled.\n   [jensens]\n@@ -357,20 +277,16 @@ Clean-up\n   Handling of legacy resource registries Products.ResourceRegistries removed\n   [ksuess]\n \n+## 1.2.22 (2018-09-23)\n \n-1.2.22 (2018-09-23)\n--------------------\n-\n-New features:\n+### New features:\n \n - Python 3 support\n   [pbauer, MatthewWilkes, ale-rt]\n \n+## 1.2.21 (2018-04-03)\n \n-1.2.21 (2018-04-03)\n--------------------\n-\n-New features:\n+### New features:\n \n - Use plone as i18n domain in ZCML files too\n   [erral]\n@@ -378,63 +294,51 @@ New features:\n - Use plone as i18n domain\n   [erral]\n \n-Bug fixes:\n+### Bug fixes:\n \n - Fix backslash escapes in i18nstring (poedit complains).\n   [jensens]\n \n+## 1.2.20 (2018-02-05)\n \n-1.2.20 (2018-02-05)\n--------------------\n-\n-New features:\n+### New features:\n \n - Prepare for Python 2 / 3 compatibility\n   [b4oshany, davilima6]\n \n+## 1.2.19 (2017-11-24)\n \n-1.2.19 (2017-11-24)\n--------------------\n-\n-New features:\n+### New features:\n \n - Purging all image scale paths and file paths in custom dexterity content types. [karalics]\n \n+## 1.2.18 (2017-04-08)\n \n-1.2.18 (2017-04-08)\n--------------------\n-\n-Bug fixes:\n+### Bug fixes:\n \n - Fixed blank edit forms of the per ruleset parameters.\n   `Issue 1993 <https://github.com/plone/Products.CMFPlone/issues/1993>`_.\n   [maurits]\n \n+## 1.2.17 (2017-04-02)\n \n-1.2.17 (2017-04-02)\n--------------------\n-\n-Bug fixes:\n+### Bug fixes:\n \n - Fixed title and description of max age in strong caching rule for resources.\n   They wrongly were the same as for shared max age.\n   Fixes `issue 1989 <https://github.com/plone/Products.CMFPlone/issues/1989>`_.\n   [maurits]\n \n+## 1.2.16 (2017-03-23)\n \n-1.2.16 (2017-03-23)\n--------------------\n-\n-Bug fixes:\n+### Bug fixes:\n \n - Fix: Do not break Plone if there is no Archetypes available.\n   [jensens]\n \n+## 1.2.15 (2017-01-12)\n \n-1.2.15 (2017-01-12)\n--------------------\n-\n-Bug fixes:\n+### Bug fixes:\n \n - Remove dependency on unittest2; fix tests assertions.\n   [hvelarde]\n@@ -442,36 +346,28 @@ Bug fixes:\n - Fixed tests when using ZODB 4.\n   [davisagli]\n \n+## 1.2.14 (2016-11-18)\n \n-1.2.14 (2016-11-18)\n--------------------\n-\n-Bug fixes:\n+### Bug fixes:\n \n - Update code to follow Plone styleguide.\n   [gforcada]\n \n+## 1.2.13 (2016-10-05)\n \n-1.2.13 (2016-10-05)\n--------------------\n-\n-Bug fixes:\n+### Bug fixes:\n \n - Code-Style: isort, utf8-headers, zca-decorators, manual cleanup.\n   [jensens]\n \n+## 1.2.12 (2016-09-16)\n \n-1.2.12 (2016-09-16)\n--------------------\n-\n-Bug fixes:\n+### Bug fixes:\n \n - Enable unload protection by using pattern class ``pat-formunloadalert`` instead ``enableUnloadProtection``.\n   [thet]\n \n-\n-1.2.11 (2016-08-17)\n--------------------\n+## 1.2.11 (2016-08-17)\n \n Fixes:\n \n@@ -481,26 +377,20 @@ Fixes:\n - Use zope.interface decorator.\n   [gforcada]\n \n-\n-1.2.10 (2016-03-29)\n--------------------\n+## 1.2.10 (2016-03-29)\n \n New:\n \n - Show status after synchronous purge if it is an error status.\n   [maurits]\n \n-\n-1.2.9 (2016-02-19)\n-------------------\n+## 1.2.9 (2016-02-19)\n \n Fixes:\n \n - Fixed deprecated imports in tests.  [thet]\n \n-\n-1.2.8 (2015-11-28)\n-------------------\n+## 1.2.8 (2015-11-28)\n \n Fixes:\n \n@@ -508,17 +398,13 @@ Fixes:\n   Fixes https://github.com/plone/Products.CMFPlone/issues/1255\n   [davilima6]\n \n-\n-1.2.7 (2015-09-09)\n-------------------\n+## 1.2.7 (2015-09-09)\n \n - fix cache settings modal settings so they do not show content\n   inline on save.\n   [vangheem]\n \n-\n-1.2.6 (2015-07-18)\n-------------------\n+## 1.2.6 (2015-07-18)\n \n - Remove gzip option, silly to be done at this layer.\n   [vangheem]\n@@ -526,18 +412,14 @@ Fixes:\n - Change the category of the configlet to \'plone-advanced\'\n   [sneridagh]\n \n-\n-1.2.5 (2015-06-09)\n-------------------\n+## 1.2.5 (2015-06-09)\n \n - correctly create purge paths for root of site, prevent double slashes\n   and the empty root of site(no trailing slash) not getting a purge\n   path generated\n   [vangheem]\n \n-\n-1.2.4 (2015-06-05)\n-------------------\n+## 1.2.4 (2015-06-05)\n \n - update first time here warning\n   [vangheem]\n@@ -545,9 +427,7 @@ Fixes:\n - make control panel work for both plone 4 and plone 5 with tabs\n   [vangheem]\n \n-\n-1.2.3 (2015-05-04)\n-------------------\n+## 1.2.3 (2015-05-04)\n \n - Fixed getObjectDefaultView method to strip off leading / and/or @@.\n   [alecghica]\n@@ -556,9 +436,7 @@ Fixes:\n   This bug resulted in rarely doing all the purging required.\n   [puittenbroek]\n \n-\n-1.2.2 (2014-10-23)\n-------------------\n+## 1.2.2 (2014-10-23)\n \n - Remove DL\'s from portal message templates.\n   https://github.com/plone/Products.CMFPlone/issues/153\n@@ -567,23 +445,17 @@ Fixes:\n - Fix ruleset registry test isolation so that is no longer order dependent.\n   [jone]\n \n-\n-1.2.1 (2014-04-01)\n-------------------\n+## 1.2.1 (2014-04-01)\n \n - Fix tests that fail on the day before the switch to daylight saving time.\n   [pbauer]\n \n-\n-1.2.0 (2014-02-26)\n-------------------\n+## 1.2.0 (2014-02-26)\n \n - Use the PLONE_APP_CONTENTTYPES_FIXTURE test layer for Plone 5 compatibility.\n   [timo]\n \n-\n-1.1.7 (unreleased)\n-------------------\n+## 1.1.7 (unreleased)\n \n - Make it possible to set a maxage of zero in strong caching. This is\n   an edge case since this would ordinarily be handled by moderate caching.\n@@ -596,40 +468,30 @@ Fixes:\n   was effectively ignored. Added operation test for strong caching.\n   [smcmahon]\n \n-\n-1.1.6 (2013-08-14)\n-------------------\n+## 1.1.6 (2013-08-14)\n \n - Fix double purge of paths for items whose default view is the same as /view\n   [eleddy]\n \n-\n-1.1.5 (2013-08-13)\n-------------------\n+## 1.1.5 (2013-08-13)\n \n - Register the plone.atobjectfields adapter not only when Products.Archetypes\n   but also plone.app.blob is installed.\n   [thet]\n \n-\n-1.1.4 (2013-06-13)\n-------------------\n+## 1.1.4 (2013-06-13)\n \n - Fixed purge paths for virtual hosting scenarios using virtual path components.\n   [dokai]\n \n-\n-1.1.3 (2013-03-05)\n-------------------\n+## 1.1.3 (2013-03-05)\n \n - Provide message for newbies to suggest importing\n   pre-defined caching rule set.\n   [vangheem]\n \n \n-\n-1.1.2 (2012-12-27)\n-------------------\n+## 1.1.2 (2012-12-27)\n \n - Add other feed types to plone.content.feed purge policy\n   [vangheem]\n@@ -642,15 +504,11 @@ Fixes:\n   iterates on the \'result\' iterable, it must return a new one.\n   [ebrehault]\n \n-\n-1.1.1 (2012-08-30)\n-------------------\n+## 1.1.1 (2012-08-30)\n \n - Nothing changed yet.\n \n-\n-1.1 (2012-05-25)\n-~~~~~~~~~~~~~~~~\n+## 1.1 (2012-05-25)\n \n - Use zope.browserresource instead of zope.app.publisher.\n   [hannosch]\n@@ -658,31 +516,25 @@ Fixes:\n - Deprecated methods aliases were replaced on tests.\n   [hvelarde]\n \n-\n-1.0.4 (unreleased)\n-------------------\n+## 1.0.4 (unreleased)\n \n - Fix possible test failures by logging in with the user name.\n   Note that user id and user name (login name) can differ.\n   [maurits]\n \n-\n-1.0.3 (2012-04-15)\n-------------------\n+## 1.0.3 (2012-04-15)\n \n - Fix packaging issue.\n   [esteele]\n \n+## 1.0.2 (2012-04-15)\n \n-1.0.2 (2012-04-15)\n-------------------\n - Handle caching of resource registries in RAM cache by not storing empty\n   bodies in the RAMCache\n   [eleddy with major tseaver support]\n \n+## 1.0.1 (2012-01-26)\n \n-1.0.1 (2012-01-26)\n-------------------\n - Properly handle a changed configuration from with etags to no etags by\n   forcing a page refresh\n   [eleddy]\n@@ -708,8 +560,7 @@ Fixes:\n - Changed wrong i18n domain in the messagefactory. plone.caching -> plone.app.caching.\n   [giacomos]\n \n-1.0 - 2011-05-12\n-~~~~~~~~~~~~~~~~\n+## 1.0 (2011-05-12)\n \n - Use the `userLanguage` ETag component in place of the language ETag component\n   in the default configs to allow ETags to be used for anonymous users with\n@@ -733,9 +584,7 @@ Fixes:\n   would otherwise take precedence.\n   [stefan]\n \n-\n-1.0b2 - 2011-02-10\n-------------------\n+## 1.0b2 (2011-02-10)\n \n - Added `News Item` to the list of `purgedContentTypes`, so the image field\n   and its scales gets purged.\n@@ -767,9 +616,7 @@ Fixes:\n - Fixed various i18n issues.\n   [vincentfretin]\n \n-\n-1.0b1 - 2010-08-04\n-------------------\n+## 1.0b1 (2010-08-04)\n \n - Add an option for "anonymous only" caching to the default operations.\n   This is a simple way to switch off caching for logged-in users. See\n@@ -786,9 +633,7 @@ Fixes:\n - template fixes for cmf.pt compatibility\n   [pilz]\n \n-\n-1.0a1 - 2010-04-24\n-------------------\n+## 1.0a1 (2010-04-24)\n \n - Initial release.\n   [optilude, newbery, smcmahon]\ndiff --git a/CONTRIBUTING.rst b/CONTRIBUTING.rst\ndeleted file mode 100644\nindex fc637ac..0000000\n--- a/CONTRIBUTING.rst\n+++ /dev/null\n@@ -1 +0,0 @@\n-Please see http://docs.plone.org/develop/coredev/docs/guidelines.html\ndiff --git a/MANIFEST.in b/MANIFEST.in\nindex 1eaa548..df0a9da 100644\n--- a/MANIFEST.in\n+++ b/MANIFEST.in\n@@ -1,5 +1,5 @@\n include *.txt\n-include *.rst\n+include *.md\n include pyproject.toml\n \n recursive-include docs *\ndiff --git a/Makefile b/Makefile\nnew file mode 100644\nindex 0000000..e6aed91\n--- /dev/null\n+++ b/Makefile\n@@ -0,0 +1,77 @@\n+### Defensive settings for make:\n+#     https://tech.davis-hansson.com/p/make/\n+SHELL:=bash\n+.ONESHELL:\n+.SHELLFLAGS:=-xeu -o pipefail -O inherit_errexit -c\n+.SILENT:\n+.DELETE_ON_ERROR:\n+MAKEFLAGS+=--warn-undefined-variables\n+MAKEFLAGS+=--no-builtin-rules\n+\n+# We like colors\n+# From: https://coderwall.com/p/izxssa/colored-makefile-for-golang-projects\n+RED=`tput setaf 1`\n+GREEN=`tput setaf 2`\n+RESET=`tput sgr0`\n+YELLOW=`tput setaf 3`\n+\n+PLONE6=6.0-latest\n+\n+BACKEND_FOLDER=$(shell dirname $(realpath $(firstword $(MAKEFILE_LIST))))\n+DOCS_DIR=${BACKEND_FOLDER}/docs\n+\n+# Python checks\n+PYTHON?=python3\n+\n+# installed?\n+ifeq (, $(shell which $(PYTHON) ))\n+  $(error "PYTHON=$(PYTHON) not found in $(PATH)")\n+endif\n+\n+# version ok?\n+PYTHON_VERSION_MIN=3.11\n+PYTHON_VERSION_OK=$(shell $(PYTHON) -c \'import sys; print((int(sys.version_info[0]), int(sys.version_info[1])) > tuple(map(int, "$(PYTHON_VERSION_MIN)".split("."))))\')\n+ifeq ($(PYTHON_VERSION_OK),0)\n+  $(error "Need python $(PYTHON_VERSION) >= $(PYTHON_VERSION_MIN)")\n+endif\n+\n+all: build\n+\n+# Add the following \'help\' target to your Makefile\n+# And add help text after each target name starting with \'\\#\\#\'\n+.PHONY: help\n+help: ## This help message\n+\t@grep -E \'^[a-zA-Z_-]+:.*?## .*$$\' $(MAKEFILE_LIST) | sort | awk \'BEGIN {FS = ":.*?## "}; {printf "\\033[36m%-30s\\033[0m %s\\n", $$1, $$2}\'\n+\n+bin/pip:\n+\t@echo "$(GREEN)==> Setup Virtual Env$(RESET)"\n+\t$(PYTHON) -m venv .\n+\tbin/pip install -U "pip" "wheel" "cookiecutter" "mxdev" "tox"\n+\n+.PHONY: config\n+config: bin/pip  ## Create instance configuration\n+\t@echo "$(GREEN)==> Create instance configuration$(RESET)"\n+\tbin/cookiecutter -f --no-input --config-file instance.yaml gh:plone/cookiecutter-zope-instance\n+\n+.PHONY: build-dev\n+build-dev: config ## pip install Plone packages\n+\t@echo "$(GREEN)==> Setup Build$(RESET)"\n+\tbin/mxdev -c mx.ini\n+\tbin/pip install -r requirements-mxdev.txt\n+\n+.PHONY: build\n+build: build-dev ## pip install Plone packages\n+\n+.PHONY: clean\n+clean: ## Remove old virtualenv and creates a new one\n+\t@echo "$(RED)==> Cleaning environment and build$(RESET)"\n+\trm -rf bin lib lib64 include share etc var instance pyvenv.cfg\n+\n+.PHONY: start\n+start: ## Start a Plone instance on localhost:8080\n+\tPYTHONWARNINGS=ignore ./bin/runwsgi instance/etc/zope.ini\n+\n+# Lint\n+.PHONY: lint\n+lint: bin/pip  ## Lint codebase\n+\tbin/tox -e lint\ndiff --git a/README.md b/README.md\nnew file mode 100644\nindex 0000000..e6a5dd2\n--- /dev/null\n+++ b/README.md\n@@ -0,0 +1,74 @@\n+<p align="center">\n+    <img alt="Plone Logo" width="200px" src="https://raw.githubusercontent.com/plone/.github/main/plone-logo.png">\n+</p>\n+\n+<h1 align="center">\n+  plone.app.caching\n+</h1>\n+\n+<div align="center">\n+\n+[![PyPI - Wheel](https://img.shields.io/pypi/wheel/plone.app.caching)](https://pypi.org/project/plone.app.caching/)\n+[![PyPI - License](https://img.shields.io/pypi/l/plone.app.caching)](https://pypi.org/project/plone.app.caching/)\n+[![PyPI - Status](https://img.shields.io/pypi/status/plone.app.caching)](https://pypi.org/project/plone.app.caching/)\n+\n+[![GitHub contributors](https://img.shields.io/github/contributors/plone/plone.app.caching)](https://github.com/plone/plone.app.caching)\n+![GitHub Repo stars](https://img.shields.io/github/stars/plone/plone.app.caching?style=flat-square)\n+\n+</div>\n+\n+## Introduction\n+\n+This package provides a Plone UI and default rules for managing HTTP response caching in Plone.\n+It builds on [z3c.caching](https://github.com/zopefoundation/z3c.caching), [plone.caching](https://github.com/plone/plone.caching) and [plone.cachepurging](https://github.com/plone/plone.cachepurging).\n+\n+\n+### Compatibility\n+\n+| Version | Plone |\n+|------|-----|\n+| 3.x | 6.0 or above |\n+| 2.x | 5.2 |\n+| 1.x | 5.1, 5.0, 4.3, 4.2, 4.1 |\n+\n+\n+## Installation\n+\n+`plone.app.caching` is shipped as a dependency of the *Plone* package, and it should be available on all Plone installations, but\n+Caching is **not enabled by default**, although it is highly recommended to configure caching for every new Plone site.\n+\n+After creating a new Plone site, go to `Site Setup`, then `Addons` and install `HTTP caching support`.\n+\n+Under the Advanced header, look for the Caching control panel -- currently only supported on the Classic UI.\n+\n+### Troubleshooting\n+\n+When the Caching control panel is not there, there can be various reasons for this:\n+\n+- If your installation does not load the `Plone` package, but only `Products.CMFPlone`, then `plone.app.caching` is not included.\n+- If the package *is* included, but you add a Plone Site using the advanced form and disable caching, then the control panel is not there.\n+\n+If you want to install it in an existing Plone Site:\n+\n+1. Make sure the package is available in the Plone instance, by adding `plone.app.caching` or `Plone` to your installation.\n+2. From the Plone Site Setup go to the ZMI (Zope Management Interface).\n+3. Go to ``portal_setup``, and then to the Import tab.\n+4. Select the HTTP caching support profile, perhaps easiest by id: `profile-plone.app.caching:default`.\n+5. Click \'Import all steps\'.\n+\n+\n+## Source Code\n+\n+Contributors, please read the document [Process for Plone core\'s development](https://5.docs.plone.org/develop/coredev/docs/index.html)\n+\n+Sources are at the [Plone code repository hosted at Github ](https://github.com/plone/plone.app.caching).\n+\n+## This project is supported by\n+\n+<a href="https://plone.org/foundation/">\n+    <img alt="Plone Logo" width="200px" src="https://raw.githubusercontent.com/plone/.github/main/plone-foundation.png">\n+</a>\n+\n+## License\n+\n+The project is licensed under GPLv2.\ndiff --git a/README.rst b/README.rst\ndeleted file mode 100644\nindex 273cebc..0000000\n--- a/README.rst\n+++ /dev/null\n@@ -1,49 +0,0 @@\n-=================\n-plone.app.caching\n-=================\n-\n-Introduction\n-============\n-\n-This package provides a Plone UI and default rules for managing HTTP response caching in Plone.\n-It builds on `z3c.caching <https://github.com/zopefoundation/z3c.caching>`_, `plone.caching <https://github.com/plone/plone.caching>`_ and `plone.cachepurging <https://github.com/plone/plone.cachepurging>`_.\n-\n-\n-Version information:\n-\n-- Version 3.x requires Plone 6.0 or later.\n-- Plone 5.2 release uses the version 2.x series.\n-- Earlier Plone versions: use a release from 1.x series.\n-\n-\n-Installation\n-============\n-\n-*plone.app.caching* is shipped as a dependency of the *Plone* package.\n-Caching is **not enabled by default**.\n-It is highly recommended to configure caching.\n-\n-When you create a default Plone site, it is available in the Site Setup.\n-Under the Advanced header, look for the Caching control panel.\n-There you can enable caching.\n-\n-When the Caching control panel is not there, there can be various reasons for this:\n-\n-- If your buildout does not load the ``Plone`` egg, but only ``Products.CMFPlone``, then ``plone.app.caching`` is not included.\n-- If the package *is* included, but you add a Plone Site using the advanced form and disable caching, then the control panel is not there.\n-\n-If you want to install it in an existing Plone Site:\n-\n-1. Make sure the package is available in the Plone instance, by adding ``plone.app.caching`` or ``Plone`` to the eggs and running buildout.\n-2. From the Plone Site Setup go to the ZMI (Zope Management Interface).\n-3. Go to ``portal_setup``, and then to the Import tab.\n-4. Select the HTTP caching support profile, perhaps easiest by id: ``profile-plone.app.caching:default``.\n-5. Click \'Import all steps\'.\n-\n-\n-Source Code\n-===========\n-\n-Contributors please read the document `Process for Plone core\'s development <https://docs.plone.org/develop/coredev/docs/index.html>`_\n-\n-Sources are at the `Plone code repository hosted at Github <https://github.com/plone/plone.app.caching>`_.\ndiff --git a/docs/README.rst b/docs/README.rst\ndeleted file mode 100644\nindex cec3091..0000000\n--- a/docs/README.rst\n+++ /dev/null\n@@ -1,32 +0,0 @@\n-=================\n-plone.app.caching\n-=================\n-\n-\n-Introduction\n-============\n-\n-``plone.app.caching`` provides a Plone UI and default rules for managing HTTP response caching in Plone. It builds on ``z3c.caching``, ``plone.caching`` and ``plone.cachepurging``.\n-\n-``plone.app.caching`` requires Plone 4 or later.\n-\n-\n-Installation\n-============\n-\n-From Plone 4.1 onwards, ``plone.app.caching`` is shipped as a dependency of Plone. It is available from the Control Panel, but not enabled by default. You can enable it from the "add-ons" menu option.\n-\n-Installation on Plone 4.0\n-=========================\n-\n-To install ``plone.app.caching``, add it to the ``eggs`` list in your ``buildout.cfg``, or as a dependency of one of your own packages in ``setup.py``. ZCML configuration will be automatically loaded via a ``z3c.autoinclude`` entry point. You will also need to install the package in Plone\'s Add-ons control panel as normal.\n-\n-This package depends on a number of other packages, including ``z3c.form`` and ``plone.app.registry``, that do not ship with Plone.\n-You will probably want to lock down the versions for those packages using a known good set. Add this to the the ``extends`` line in your ``buildout.cfg``, *after* the line that includes the Plone KGS::\n-\n-    extends =\n-        ...\n-        http://good-py.appspot.com/release/plone.app.caching/1.0a1\n-\n-Update the version number at the end of the URL as appropriate. You can find an overview of the versions\n-`here <http://good-py.appspot.com/release/plone.app.caching>`_\ndiff --git a/docs/caching-control-panel.rst b/docs/caching-control-panel.rst\ndeleted file mode 100644\nindex 5eb1234..0000000\n--- a/docs/caching-control-panel.rst\n+++ /dev/null\n@@ -1,35 +0,0 @@\n-The caching control panel\n--------------------------\n-\n-After installation, you will find a Caching control panel in Plone\'s site setup.\n-\n-This consists of four main tabs:\n-\n-Change settings\n-    where you can control caching behaviour\n-\n-Import settings\n-    where you can import pre-defined profiles of cache settings\n-\n-Purge caching proxy\n-    where you can manually purge content from a caching proxy.\n-    This tab only appears if you have purging enabled under *Change settings*.\n-\n-RAM cache\n-    where you can view statistics about and purge the RAM cache.\n-\n-Under the settings tab, you will find four fieldsets:\n-\n-General settings\n-    for global options such as turning caching on or off.\n-\n-Caching proxies\n-    where you can control Plone\'s use of a caching proxy such or Varnish or a CDN.\n-\n-Caching operation mappings\n-    where caching rulesets (hints about views and resources used for caching purposes) can be associated with caching operations.\n-    Those either intercept a request to return a cached response, or modifies a response to add cache control headers.\n-    This is also where rulesets for legacy page templates (created through the web or the  portal_skins tool) are configured.\n-\n-Detailed settings\n-    where you can configure parameters for individual caching operations.\ndiff --git a/docs/caching-profiles.rst b/docs/caching-profiles.rst\ndeleted file mode 100644\nindex 6ff8803..0000000\n--- a/docs/caching-profiles.rst\n+++ /dev/null\n@@ -1,96 +0,0 @@\n-Caching profiles\n-----------------\n-\n-All persistent configuration for the caching machinery is stored in the configuration registry, as managed by ``plone.app.registry``.\n-This can be modified using the ``registry.xml`` GenericSetup import step.\n-The *Import settings* tab of the control panel allows you to import these caching profiles.\n-\n-\n-Default caching profiles\n-~~~~~~~~~~~~~~~~~~~~~~~~\n-\n-``plone.app.caching`` includes three default caching profiles.\n-Two of these  profiles encapsulate the cache settings that are known to work well with a typical default Plone installation.\n-\n-The three default caching profiles:\n-\n-* **Without caching proxy**\n-      Settings useful for setups without a caching proxy.\n-\n-* **With caching proxy**\n-      Settings useful for setups with a caching proxy such as Squid or\n-      Varnish.  The only difference from the "without caching proxy"\n-      profile are some settings to enable proxy caching of files/images\n-      in content space and content feeds.\n-\n-Custom caching profiles\n-~~~~~~~~~~~~~~~~~~~~~~~\n-\n-Caching policies are often a compromise between speed and freshness.\n-More aggressive caching often comes at the cost of increased risk of stale responses.\n-The default profiles provided tend to err on the side of freshness over speed so there is some room for tweaking if greater speed is desired.\n-\n-Customization may also be needed if third-party products are installed which require special treatment.\n-Examine the HTTP response headers to determine whether the third-party product requires special treatment.\n-Most simple cases probably can be solved by adding the content type or template to the appropriate mapping.\n-More complicated cases, may require custom caching operations.\n-\n-A GenericSetup profile used for caching should be registered for the ``ICacheProfiles`` marker interface to distinguish it from more general profiles used to install a product.\n-This also hides the profile from Plone\'s Add-ons control panel.\n-\n-Here is an example from this package::\n-\n-    <genericsetup:registerProfile\n-        name="with-caching-proxy"\n-        title="With caching proxy"\n-        description="Settings useful for setups with a caching proxy such as Squid or Varnish"\n-        directory="profiles/with-caching-proxy"\n-        provides="Products.GenericSetup.interfaces.EXTENSION"\n-        for="plone.app.caching.interfaces.ICacheProfiles"\n-        />\n-\n-The directory ``profiles/with-caching-proxy`` contains a single import step, ``registry.xml``,\n-containing settings to configure the ruleset to operation mapping,\n-and setting options for various operations.\n-At the time of writing, this includes::\n-\n-    <record name="plone.caching.interfaces.ICacheSettings.operationMapping">\n-        <value purge="False">\n-            <element key="plone.resource">plone.app.caching.strongCaching</element>\n-            <element key="plone.stableResource">plone.app.caching.strongCaching</element>\n-            <element key="plone.content.itemView">plone.app.caching.weakCaching</element>\n-            <element key="plone.content.feed">plone.app.caching.moderateCaching</element>\n-            <element key="plone.content.folderView">plone.app.caching.weakCaching</element>\n-            <element key="plone.content.file">plone.app.caching.moderateCaching</element>\n-            <element key="plone.content.dynamic">plone.app.caching.terseCaching</element>\n-        </value>\n-    </record>\n-\n-Default options for the various standard operations are found in the ``registry.xml`` file that is part of the standard installation profile for this product, in the directory ``profiles/default``.\n-The custom profile overrides a number of operation settings for specific rulesets (see below).\n-For example::\n-\n-    <record name="plone.app.caching.weakCaching.plone.content.itemView.ramCache">\n-        <field ref="plone.app.caching.weakCaching.ramCache" />\n-        <value>True</value>\n-    </record>\n-\n-This enables RAM caching for the "weak caching" operation for resources using the ruleset ``plone.content.itemView``.\n-The default is defined in the main ``registry.xml`` as::\n-\n-    <record name="plone.app.caching.weakCaching.ramCache">\n-        <field type="plone.registry.field.Bool">\n-            <title>RAM cache</title>\n-            <description>Turn on caching in Zope memory</description>\n-            <required>False</required>\n-        </field>\n-        <value>False</value>\n-    </record>\n-\n-Notice how we use a *field reference* to avoid having to re-define the field.\n-\n-It may be useful looking at these bundled ``registry.xml`` for inspiration if you are building your own caching profile.\n-Alternatively, you can export the registry from the ``portal_setup`` tool and pull out the records under the prefixes ``plone.caching`` and ``plone.app.caching``.\n-\n-Typically, ``registry.xml`` is all that is required, but you are free to add additional import steps if required.\n-You can also add a ``metadata.xml`` and use the GenericSetup dependency mechanism to install other profiles on the fly.\ndiff --git a/docs/caching-proxies.rst b/docs/caching-proxies.rst\ndeleted file mode 100644\nindex 46b974e..0000000\n--- a/docs/caching-proxies.rst\n+++ /dev/null\n@@ -1,92 +0,0 @@\n-Caching proxies\n----------------\n-\n-It is common to place a so-called caching reverse proxy in front of Zope when hosting large Plone sites.\n-If hosted by yourself, a popular option is `Varnish`_.\n-On the other hand there are commercial hosted CDN services like Cloudflare, CloudFront, Fastly and more.\n-\n-It is important to realise that whilst ``plone.app.caching`` provides some functionality for controlling how Plone interacts with a caching proxy.\n-The proxy itself must be configured separately.\n-\n-Some operations in ``plone.app.caching`` can set response headers that instruct the caching proxy how best to cache content.\n-For example, it is normally a good idea to cache static resources (such as images and stylesheets) and "downloadables"  in the proxy.\n-This are i.e. Plone content of the types ``File`` or ``Image``.\n-This content will then be served to most users straight from the proxy, which is much faster than Zope.\n-\n-The downside of this approach is that an old version of a content item may returned to a user, because the cache has not been updated since the item was modified.\n-There are three general strategies for dealing with this:\n-\n-* Since resources are cached in the proxy based on their URL, you can "invalidate" the cached copy by changing an item\'s URL when it is updated.\n-  This is the approach taken by Plone\'s resource management:\n-  in production mode, the links that are inserted into Plone\'s content pages for resource managed by Plone  contain a hash-based token, which changes when the main bundle file changes.\n-  This approach has the benefit of also being able to "invalidate" content stored in a user\'s browser cache.\n-\n-* All caching proxies support setting timeouts.\n-  This means that content may be stale, but typically only up to a few minutes.\n-  This is sometimes an acceptable policy for high-volume sites where most users do not log in.\n-\n-* Most caching proxies support receiving PURGE requests for paths that should be purged.\n-  Given the proxy has cached a resource at ``/logo.jpg``, and that object is modified.\n-  Then a PURGE request could be sent to the proxy (originating from Zope, not the client) with the same path to force the proxy to fetch a new version the next time the item is requested.\n-\n-The final option, of course is to avoid caching content in the proxy altogether.\n-The default policies will not allow standard listing pages to be cached in the proxy, because it is too difficult to invalidate cached instances.\n-For example, if you change a content item\'s title, that may require invalidation of a number of pages where that title appears in the navigation tree, folder listings, ``Collections``, portlets, and so on.\n-Tracking all these dependencies and purging in an efficient manner is impossible unless the caching proxy configuration is highly customised for the site.\n-\n-Nevertheless a "terse" policy allows caching for just a few seconds of all pages to reduce the load on the backend on high traffic situations.\n-\n-\n-Purging a caching proxy\n-~~~~~~~~~~~~~~~~~~~~~~~\n-\n-Synchronous and asynchronous purging is enabled via `plone.cachepurging`_.\n-In the control panel, you can configure the use of a proxy via various options, such as:\n-\n-* Whether or not to enable purging globally.\n-\n-* The address of the caching server to which PURGE requests should be sent.\n-\n-* Whether or not virtual host rewriting takes place before the caching proxy receives a URL or not.\n-  This has implications for how the PURGE path is constructed.\n-\n-* Any domain aliases for your site, to enable correct purging of content served via e.g. http://example.com and http://www.example.com.\n-\n-The default purging policy is geared mainly towards purging file and image resources, not content pages, although basic purging of content pages is included.\n-The actual paths to purge are constructed from a number of components providing the ``IPurgePaths`` interface.\n-See ``plone.cachepurging`` for details on how this works, especially if you need to write your own.\n-\n-The default purge paths include:\n-\n-* ${object_path}, -- the object\'s canonical path\n-\n-* ${object_path}/ -- in case the object is a folder\n-\n-* ${object_path}/view -- the ``view`` method alias\n-\n-* ${object_path}/${default-view} -- in case a default view template is used\n-\n-* The download URLs for any content object fields, given the type contains blobs.\n-This includes support for the standard ``File`` and  ``Image`` types.\n-\n-Files and images created (or customised) in the ZMI are purged automatically when modified.\n-Bundles managed through the resource registration do not need purging, since they have "stable" URLs.\n-To purge Plone content when modified (or removed), you must select the content types in the control panel.\n-By default, only the ``File`` and ``Image`` types are purged.\n-\n-You should not enable purging for types that are not likely to be cached in the proxy.\n-Although purging happens asynchronously at the end of the request, it may still place unnecessary load on your server.\n-\n-Finally, you can use the *Purge* tab in the control panel to manually purge one or more URLs.\n-This is a useful way to debug cache purging.\n-It offers as well as a quick solution for the awkward situation where your boss walks in and wonders why the "about us" page is still showing that old picture of him, before he had a new haircut.\n-\n-\n-Installing and configuring a caching proxy\n-~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n-\n-There is a buildout recipes for building and configuring proxy configs: `plone.recipe.varnish`_.\n-\n-.. _Varnish: http://varnish-cache.org\n-.. _plone.recipe.varnish: http://pypi.python.org/pypi/plone.recipe.varnish\n-.. _plone.cachepurging: http://pypi.python.org/pypi/plone.cachepurging\ndiff --git a/docs/changelog_template.jinja b/docs/changelog_template.jinja\nnew file mode 100644\nindex 0000000..b35bff3\n--- /dev/null\n+++ b/docs/changelog_template.jinja\n@@ -0,0 +1,15 @@\n+{% if sections[""] %}\n+{% for category, val in definitions.items() if category in sections[""] %}\n+\n+### {{ definitions[category][\'name\'] }}\n+\n+{% for text, values in sections[""][category].items() %}\n+- {{ text }} {{ values|join(\', \') }}\n+{% endfor %}\n+\n+{% endfor %}\n+{% else %}\n+No significant changes.\n+\n+\n+{% endif %}\n\\ No newline at end of file\ndiff --git a/docs/composite-views.rst b/docs/composite-views.rst\ndeleted file mode 100644\nindex e72a537..0000000\n--- a/docs/composite-views.rst\n+++ /dev/null\n@@ -1,19 +0,0 @@\n-Composite views\n----------------\n-\n-A ``composite view`` is just a general term for most page views you see when you visit a Plone site.\n-It includes all content item views, content folder views, and many template views.\n-For our purposes, the distinguishing characteristic of composite views is the difficulty inherent in keeping track of all changes that might affect the final composited view.\n-Because of the difficulty of dependency tracking, composite views are often notoriously difficult to purge reliably from caching proxies so the default caching profiles set headers which expire the cache immediately (i.e. *weak caching*).\n-\n-However, most of the inline resources linked to from the composite view (css, javascript, images, etc.) can be cached very well in proxy so the overall speed of most composite views will always be better with a caching proxy in front despite the page itself not being cached.\n-\n-For relatively stable composite views or for those views for which you can\n-tolerate some potential staleness, you might be tempted to try switching from\n-*weak caching* to *moderate caching* with the ``s-maxage`` expiration\n-value set to some tolerable value but first make sure you understand the\n-issues regarding "split view" caching (see below).\n-\n-A way to speedup a site with lots of composite view is to use "Terse" caching.\n-It caches a page for just a small time (be default 10s in browser and 60s in the caching proxy).\n-Thus the content is almost up to date, but on high load visitors are getting pages served from the cache.\ndiff --git a/docs/conf.py b/docs/conf.py\ndeleted file mode 100644\nindex 9a199de..0000000\n--- a/docs/conf.py\n+++ /dev/null\n@@ -1,253 +0,0 @@\n-#\n-# plone.app.caching documentation build configuration file, created by\n-# sphinx-quickstart on Tue May 20 16:53:52 2014.\n-#\n-# This file is execfile()d with the current directory set to its containing dir.\n-#\n-# Note that not all possible configuration values are present in this\n-# autogenerated file.\n-#\n-# All configuration values have a default; values that are commented out\n-# serve to show the default.\n-\n-# If extensions (or modules to document with autodoc) are in another directory,\n-# add these directories to sys.path here. If the directory is relative to the\n-# documentation root, use os.path.abspath to make it absolute, like shown here.\n-# sys.path.insert(0, os.path.abspath(\'.\'))\n-\n-# -- General configuration -----------------------------------------------------\n-\n-# If your documentation needs a minimal Sphinx version, state it here.\n-# needs_sphinx = \'1.0\'\n-\n-# Add any Sphinx extension module names here, as strings. They can be extensions\n-# coming with Sphinx (named \'sphinx.ext.*\') or your custom ones.\n-extensions = []\n-\n-# Add any paths that contain templates here, relative to this directory.\n-templates_path = ["_templates"]\n-\n-# The suffix of source filenames.\n-source_suffix = ".rst"\n-\n-# The encoding of source files.\n-# source_encoding = \'utf-8-sig\'\n-\n-# The master toctree document.\n-master_doc = "index"\n-\n-# General information about the project.\n-project = "plone.app.caching"\n-copyright = "2014, Plone Foundation"\n-\n-# The version info for the project you\'re documenting, acts as replacement for\n-# |version| and |release|, also used in various other places throughout the\n-# built documents.\n-#\n-# The short X.Y version.\n-version = "1.2"\n-# The full version, including alpha/beta/rc tags.\n-release = "1.2.1"\n-\n-# The language for content autogenerated by Sphinx. Refer to documentation\n-# for a list of supported languages.\n-# language = None\n-\n-# There are two options for replacing |today|: either, you set today to some\n-# non-false value, then it is used:\n-# today = \'\'\n-# Else, today_fmt is used as the format for a strftime call.\n-# today_fmt = \'%B %d, %Y\'\n-\n-# List of patterns, relative to source directory, that match files and\n-# directories to ignore when looking for source files.\n-exclude_patterns = ["_build"]\n-\n-# The reST default role (used for this markup: `text`) to use for all documents.\n-# default_role = None\n-\n-# If true, \'()\' will be appended to :func: etc. cross-reference text.\n-# add_function_parentheses = True\n-\n-# If true, the current module name will be prepended to all description\n-# unit titles (such as .. function::).\n-# add_module_names = True\n-\n-# If true, sectionauthor and moduleauthor directives will be shown in the\n-# output. They are ignored by default.\n-# show_authors = False\n-\n-# The name of the Pygments (syntax highlighting) style to use.\n-pygments_style = "sphinx"\n-\n-# A list of ignored prefixes for module index sorting.\n-# modindex_common_prefix = []\n-\n-\n-# -- Options for HTML output ---------------------------------------------------\n-\n-# The theme to use for HTML and HTML Help pages.  See the documentation for\n-# a list of builtin themes.\n-html_theme = "default"\n-\n-# Theme options are theme-specific and customize the look and feel of a theme\n-# further.  For a list of options available for each theme, see the\n-# documentation.\n-# html_theme_options = {}\n-\n-# Add any paths that contain custom themes here, relative to this directory.\n-# html_theme_path = []\n-\n-# The name for this set of Sphinx documents.  If None, it defaults to\n-# "<project> v<release> documentation".\n-# html_title = None\n-\n-# A shorter title for the navigation bar.  Default is the same as html_title.\n-# html_short_title = None\n-\n-# The name of an image file (relative to this directory) to place at the top\n-# of the sidebar.\n-# html_logo = None\n-\n-# The name of an image file (within the static path) to use as favicon of the\n-# docs.  This file should be a Windows icon file (.ico) being 16x16 or 32x32\n-# pixels large.\n-# html_favicon = None\n-\n-# Add any paths that contain custom static files (such as style sheets) here,\n-# relative to this directory. They are copied after the builtin static files,\n-# so a file named "default.css" will overwrite the builtin "default.css".\n-html_static_path = ["_static"]\n-\n-# If not \'\', a \'Last updated on:\' timestamp is inserted at every page bottom,\n-# using the given strftime format.\n-# html_last_updated_fmt = \'%b %d, %Y\'\n-\n-# If true, SmartyPants will be used to convert quotes and dashes to\n-# typographically correct entities.\n-# html_use_smartypants = True\n-\n-# Custom sidebar templates, maps document names to template names.\n-# html_sidebars = {}\n-\n-# Additional templates that should be rendered to pages, maps page names to\n-# template names.\n-# html_additional_pages = {}\n-\n-# If false, no module index is generated.\n-# html_domain_indices = True\n-\n-# If false, no index is generated.\n-# html_use_index = True\n-\n-# If true, the index is split into individual pages for each letter.\n-# html_split_index = False\n-\n-# If true, links to the reST sources are added to the pages.\n-# html_show_sourcelink = True\n-\n-# If true, "Created using Sphinx" is shown in the HTML footer. Default is True.\n-# html_show_sphinx = True\n-\n-# If true, "(C) Copyright ..." is shown in the HTML footer. Default is True.\n-# html_show_copyright = True\n-\n-# If true, an OpenSearch description file will be output, and all pages will\n-# contain a <link> tag referring to it.  The value of this option must be the\n-# base URL from which the finished HTML is served.\n-# html_use_opensearch = \'\'\n-\n-# This is the file name suffix for HTML files (e.g. ".xhtml").\n-# html_file_suffix = None\n-\n-# Output file base name for HTML help builder.\n-htmlhelp_basename = "ploneappcachingdoc"\n-\n-\n-# -- Options for LaTeX output --------------------------------------------------\n-\n-latex_elements = {\n-    # The paper size (\'letterpaper\' or \'a4paper\').\n-    # \'papersize\': \'letterpaper\',\n-    # The font size (\'10pt\', \'11pt\' or \'12pt\').\n-    # \'pointsize\': \'10pt\',\n-    # Additional stuff for the LaTeX preamble.\n-    # \'preamble\': \'\',\n-}\n-\n-# Grouping the document tree into LaTeX files. List of tuples\n-# (source start file, target name, title, author, documentclass [howto/manual]).\n-latex_documents = [\n-    (\n-        "index",\n-        "ploneappcaching.tex",\n-        "plone.app.caching Documentation",\n-        "Plone Foundation",\n-        "manual",\n-    ),\n-]\n-\n-# The name of an image file (relative to this directory) to place at the top of\n-# the title page.\n-# latex_logo = None\n-\n-# For "manual" documents, if this is true, then toplevel headings are parts,\n-# not chapters.\n-# latex_use_parts = False\n-\n-# If true, show page references after internal links.\n-# latex_show_pagerefs = False\n-\n-# If true, show URL addresses after external links.\n-# latex_show_urls = False\n-\n-# Documents to append as an appendix to all manuals.\n-# latex_appendices = []\n-\n-# If false, no module index is generated.\n-# latex_domain_indices = True\n-\n-\n-# -- Options for manual page output --------------------------------------------\n-\n-# One entry per manual page. List of tuples\n-# (source start file, name, description, authors, manual section).\n-man_pages = [\n-    (\n-        "index",\n-        "ploneappcaching",\n-        "plone.app.caching Documentation",\n-        ["Plone Foundation"],\n-        1,\n-    )\n-]\n-\n-# If true, show URL addresses after external links.\n-# man_show_urls = False\n-\n-\n-# -- Options for Texinfo output ------------------------------------------------\n-\n-# Grouping the document tree into Texinfo files. List of tuples\n-# (source start file, target name, title, author,\n-#  dir menu entry, description, category)\n-texinfo_documents = [\n-    (\n-        "index",\n-        "ploneappcaching",\n-        "plone.app.caching Documentation",\n-        "Plone Foundation",\n-        "ploneappcaching",\n-        "One line description of project.",\n-        "Miscellaneous",\n-    ),\n-]\n-\n-# Documents to append as an appendix to all manuals.\n-# texinfo_appendices = []\n-\n-# If false, no module index is generated.\n-# texinfo_domain_indices = True\n-\n-# How to display URL addresses: \'footnote\', \'no\', or \'inline\'.\n-# texinfo_show_urls = \'footnote\'\ndiff --git a/docs/etags.rst b/docs/etags.rst\ndeleted file mode 100644\nindex dac1b29..0000000\n--- a/docs/etags.rst\n+++ /dev/null\n@@ -1,72 +0,0 @@\n-ETags\n------\n-\n-ETags are used in to check whether pages need to be re-calculated or can be served from cache.\n-An ETag is simply a string. Under ``plone.app.caching``, it is a string of tokens separated by pipe characters.\n-The tokens hold values such as a user id, the current skin name, or a counter indicating how many objects have been added to the site.\n-The idea is that the browser sends a request with the ETag included in an ``If-None-Match`` header.\n-Plone can then quickly calculate the current ETag for the requested resource.\n-If the ETag is the same, Plone can reply with ``304 NOT MODIFIED`` response, telling the browser to use its cached copy.\n-Otherwise, Plone renders the page and returns it as normal.\n-\n-Many caching operations use ETags. The tokens to include are typically listed in an ``etags`` tuple in the operation\'s options.\n-\n-The ETag names tokens supported by default are:\n-\n-userid\n-    The current user\'s id\n-\n-roles\n-    A list of the current user\'s roles in the given context\n-\n-language\n-    The language(s) accepted by the browser, in the ``ACCEPT_LANGUAGE`` header\n-\n-userLanguage\n-    The current user\'s preferred language\n-\n-lastModified\n-    A timestamp indicating the last-modified date of the given context\n-\n-catalogCounter\n-    A counter that is incremented each time the catalog is updated.\n-    I.e. each time content in the site is changed.\n-\n-locked\n-    Whether or not the given context is locked for editing.\n-\n-skin\n-    The name of the current skin (theme)\n-\n-resourceRegistries\n-    A timestamp indicating the last-modified timestamp for the Resource Registries.\n-    This is useful for avoiding requests for expired resources from cached pages.\n-\n-It is possible to provide additional tokens by registering an ``IETagValue`` adapter.\n-This should be a named adapter on the published object (typically a view, file resource or Zope page template object) and request, with a unique name.\n-The name is used to look up the component. Thus, you can also override one of the tokens above for a particular type of context or request (e.g. via a browser layer), by registering a more specific adapter with the same name.\n-\n-As an example, here is the ``language`` adapter::\n-\n-    from plone.app.caching.interfaces import IETagValue\n-    from zope.component import adapter\n-    from zope.interface import implementer\n-    from zope.interface import Interface\n-\n-    @implementer(IETagValue)\n-    @adapter(Interface, Interface)\n-    class Language(object):\n-        """The ``language`` etag component, returning the value of the\n-        HTTP_ACCEPT_LANGUAGE request key.\n-        """\n-\n-        def __init__(self, published, request):\n-            self.published = published\n-            self.request = request\n-\n-        def __call__(self):\n-            return self.request.get(\'HTTP_ACCEPT_LANGUAGE\', \'\')\n-\n-This is registered in ZCML like so::\n-\n-    <adapter factory=".etags.Language" name="language" />\ndiff --git a/docs/index.rst b/docs/index.rst\ndeleted file mode 100644\nindex 2da491a..0000000\n--- a/docs/index.rst\n+++ /dev/null\n@@ -1,37 +0,0 @@\n-===============================\n-plone.app.caching documentation\n-===============================\n-\n-.. plone.app.caching documentation master file, created by\n-   sphinx-quickstart on Tue May 20 16:53:52 2014.\n-   You can adapt this file completely to your liking, but it should at least\n-   contain the root `toctree` directive.\n-\n-.. include:: README.rst\n-\n-Documentation\n-=============\n-\n-Contents:\n-\n-.. toctree::\n-   :maxdepth: 2\n-\n-   caching-control-panel\n-   caching-profiles\n-   rulesets-and-caching-operations\n-   caching-proxies\n-   ram-cache\n-   etags\n-   composite-views\n-   split-views\n-   restapi\n-\n-\n-Indices and tables\n-==================\n-\n-* :ref:`genindex`\n-* :ref:`modindex`\n-* :ref:`search`\n-\ndiff --git a/docs/ram-cache.rst b/docs/ram-cache.rst\ndeleted file mode 100644\nindex d9282a1..0000000\n--- a/docs/ram-cache.rst\n+++ /dev/null\n@@ -1,70 +0,0 @@\n-The RAM cache\n--------------\n-\n-In addition to caching content in users\' browsers (through setting appropriate response headers) and a caching proxy, Plone can cache certain information in memory.\n-This is done in two main ways:\n-\n-* Developers may use the ``plone.memoize`` package\'s ``ram`` module to cache the results of certain functions in RAM.\n-  For example, some viewlets and portlets cache their rendered output in RAM for a time, alleviating the need to calculate them every time.\n-\n-* Some caching operations may cache an entire response in memory, so that  they can later intercept the request to return a cached response.\n-\n-Caching in RAM in Zope is not as efficient as caching in a proxy, for a number of reasons:\n-\n-* Zope still has to perform traversal, security, transaction management and so on before serving a request with a RAM-cached response.\n-\n-* Zope\'s use of memory is not as efficient as that of a finely optimised caching proxy.\n-\n-* Storing lots of content in RAM may compete with the standard ZODB object cache and other memory pools used by Zope, thus slowing down Zope overall.\n-\n-* In multi-client ZEO setups, the RAM cache is (by default at least) not shared among instances (though it is shared among threads in that instance).\n-  Thus, each Plone client process will maintain its own cache.\n-\n-You can use the *RAM cache* tab in the caching control panel to view statistics about the use of the RAM cache.\n-On the *Change settings* tab, you can also control the size of the cache, and the frequency with which it is purged of old items.\n-\n-\n-Alternative RAM cache implementations\n-~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n-\n-The RAM cache exposed through ``plone.memoize.ram`` is looked up via an ``ICacheChoser`` utility.\n-The default implementation looks up a ``zope.ramcache.interfaces.ram.IRAMCache`` utility.\n-Plone installs a local such utility (to allows its settings to be persisted - the cache itself is not persistent), which is shared by all users of the cache.\n-\n-You can provide your own ``ICacheChooser`` utility to change this policy, by installing this as a local utility or overriding it in ``overrides.zcml``.\n-One reason to do this may be to back the cache with a `memcached`_ server, which would allow a single cache to be shared among multiple Zope clients.\n-\n-Below is a sketch of such a cache chooser, courtesy of Wojciech Lichota::\n-\n-    from plone.memoize.interfaces import ICacheChooser\n-    from plone.memoize.ram import MemcacheAdapter\n-    from pylibmc import Client\n-    from threading import local\n-    from zope.interface import implementer\n-\n-    @implementer(ICacheChooser)\n-    class MemcachedCacheChooser(object):\n-        _v_thread_local = local()\n-\n-        def getClient(self):\n-            """\n-            Return thread local connection to memcached.\n-            """\n-            connection = getattr(self._v_thread_local, \'connection\', None)\n-            if connection is None:\n-                connection = Client([\'127.0.0.1:11211\'])\n-                self._v_thread_local.connection = connection\n-\n-            return connection\n-\n-        def __call__(self, fun_name):\n-            """\n-            Create new adapter for plone.memoize.ram.\n-            """\n-            return MemcacheAdapter(client=self.getClient(), globalkey=fun_name)\n-\n-You could install this with the following lines in an overrides.zcml::\n-\n-    <utility factory=".memcached.MemcachedCacheChooser" />\n-\n-.. _memcached: http://memcached.org\ndiff --git a/docs/restapi.rst b/docs/restapi.rst\ndeleted file mode 100644\nindex 9c0b211..0000000\n--- a/docs/restapi.rst\n+++ /dev/null\n@@ -1,135 +0,0 @@\n-Caching of plone.restapi\n-------------------------\n-\n-Strategy\n-~~~~~~~~\n-\n-Caching for anonymous users for all GET requests.\n-\n-Remark: Some POST requests, like `@querystring`, should be turned into GET in order to better cache.\n-\n-We have endpoints following classic `plone.content.itemView` content and do not accept parameters.\n-Those can be handled with the default rules, including purge.\n-\n-There are others delivering dynamic content, like search, impossible to purge.\n-Those shall be cached using a shorttime cache (like some seconds to some minutes).\n-\n-This get covered by the rulesetType `plone.content.dynamic`.\n-It is configured to cache by default in browser 10sec, in caching-proxy 60 seconds.\n-Its goal is primary to reduce the load/peak-load on the server.\n-Also, it reduces the impact of loading the same endpoint more than one time in one page.\n-\n-\n-plone.restapi GET endpoints\n-~~~~~~~~~~~~~~~~~~~~~~~~~~~\n-\n-And its environment and assignments:\n-\n-- ``@actions``\n-\n-  - Anonymous\n-  - rule plone.content.dynamic (might be influenced by other content)\n-  - purge\n-\n-- ``@addons``\n-\n-  - Authenticated\n-  - no rule assignment\n-\n-- ``@breadcrumbs``\n-\n-  - Anonymous\n-  - rule plone.content.dynamic (parent may change)\n-  - purge\n-\n-- ``@comments``\n-\n-  - Anonymous\n-  - rule plone.content.itemView\n-  - purge\n-\n-- ``/`` (content)\n-\n-  - Anonymous\n-  - expander!\n-  - rule plone.content.dynamic\n-\n-- ``@history``\n-\n-  - Authenticated\n-  - no rule assignment\n-\n-- ``@lock``\n-\n-  - Authenticated\n-  - no rule assignment\n-\n-- ``@translations``\n-\n-  - Anonymous\n-  - with parameters\n-  - rule plone.content.dynamic\n-\n-- ``@translations-locator``\n-\n-  - Authenticated\n-  - no rule assignment\n-\n-- ``@navigation``\n-\n-  - Anonymous\n-  - with parameters\n-  - rule plone.content.dynamic\n-\n-- ``@querysources``\n-\n-  - Authenticated\n-  - with parameters\n-  - can not be cached\n-\n-- ``@querystring``\n-\n-  - Anonymous\n-  - (values on IPloneSiteRoot from registry)\n-  - rule plone.content.dynamic\n-\n-- ``@querystring-search``\n-\n-  - is in `get.py` BUT configured as POST\n-  - Anonymous\n-  - with json body\n-  - can not be cached\n-\n-- ``@registry``\n-\n-  - Authenticated\n-  - with subpath\n-  - no rule assignment\n-\n-- ``@roles``\n-\n-  - Authenticated\n-  - no rule assignment\n-\n-- ``@search``\n-\n-  - Anonymous\n-  - with parameters\n-  - rule plone.content.dynamic\n-\n-- ``@sources``\n-\n-  - Authenticated\n-  - no rule assignment\n-\n-- ``@tiles``\n-\n-  - pre-deprecation\n-  - Anonymous\n-  - with subpath\n-  - no rule assignment\n-\n-- ``@types``\n-\n-  - Authenticated\n-  - no rule assignment\ndiff --git a/docs/rulesets-and-caching-operations.rst b/docs/rulesets-and-caching-operations.rst\ndeleted file mode 100644\nindex 83f78cd..0000000\n--- a/docs/rulesets-and-caching-operations.rst\n+++ /dev/null\n@@ -1,338 +0,0 @@\n-Rulesets and caching operations\n--------------------------------\n-\n-The caching infrastructure works on the principle of *rulesets* mapped to\n-*caching operations*. A ruleset is basically just a name, and is normally\n-applied in ZCML by the author of a particular view. There are also some\n-default rulesets applied to general resources - see below.\n-\n-Please note that ``plone.app.caching`` places the caching ruleset registry\n-into "explicit" mode. This means that you *must* declare a caching ruleset\n-(with the ``<cache:rulesetType />`` directive) before you can use it.\n-\n-Caching operations are components written in Python which either interrupt\n-rendering to provide a cached response (such as a ``304 NOT MODIFIED``\n-response), or add caching information to a response (such as setting the\n-``Cache-Control`` HTTP response header).\n-\n-For more details on how to use these components, see the documentation for\n-`plone.caching`_.\n-\n-Once rulesets and caching operations have been registered, they will\n-appear in the caching control panel.\n-\n-\n-Default rulesets\n-~~~~~~~~~~~~~~~~\n-\n-``plone.app.caching`` declares a few default rulesets.  They are listed\n-with descriptions in the control panel.\n-\n-* **Content feed** (``plone.content.feed``)\n-      A dynamic feed, e.g. using RSS or ATOM.\n-\n-* **Content files and images** (``plone.content.file``)\n-      Includes files and images in content space usually either downloaded\n-      or included as an inline element in one of the other public-facing\n-      views.\n-\n-* **Content folder view** (``plone.content.folderView``)\n-      A public-facing view for a content item that is a folder or container\n-      for other items.\n-\n-* **Content item view** (``plone.content.itemView``)\n-      A public-facing view for a content item that is not a folder or\n-      container for other items.\n-\n-* **File and image resources** (``plone.resource``)\n-      Includes images and files created or customised through the ZMI,\n-      those exposed in the portal_skins tool, and images registered in\n-      resource directories on the filesystem.\n-\n-* **Stable file and image resources** (``plone.stableResource``)\n-      Stable resources like the css, javascript, and kss files registered\n-      with the Resource Registries.  These are resources which can be cached\n-      \'forever\'.  Normally this means that if the object does change, its\n-      URL changes too.\n-\n-\n-Default cache operations\n-~~~~~~~~~~~~~~~~~~~~~~~~\n-\n-``plone.app.caching`` also declares a number of default operation types.\n-These are listed in the control panel as available operations for the\n-various rulesets. Hover your mouse over an operation in the drop-down\n-list to view its description.\n-\n-* **Strong caching** (``plone.app.caching.strongCaching``)\n-      Cache in browser and proxy (default: 24 hours).  Caution: Only use\n-      for stable resources that never change without changing their URL,\n-      or resources for which temporary staleness is not critical.\n-\n-      In the caching profiles ``without-caching-proxy`` and\n-      ``with-caching-proxy``, this operation is mapped to the rulesets\n-      ``plone.resource`` and ``plone.stableResource``, which causes the\n-      following headers to be added to the response::\n-\n-        Last-Modified: <last-modified-date>\n-        Cache-Control: max-age=<seconds>, proxy-revalidate, public\n-\n-..\n-\n-* **Moderate caching** (``plone.app.caching.moderateCaching``),\n-      Cache in browser but expire immediately (same as ``weak caching``),\n-      and cache in proxy (default: 24 hours).  Use a purgable caching\n-      reverse proxy for best results.  Caution: If proxy cannot be purged\n-      reliably (for example, in the case of composite pages where it may\n-      be difficult to track when a dependency has changed) then stale\n-      responses might be seen until the cached entry expires.  A similar\n-      caution applies even if in the purgeable case, if the proxy cannot\n-      be configured to disallow caching in other intermediate proxies\n-      that may exist between the local proxies and the browser (see the\n-      example proxy configs included with this package for some solutions\n-      to this problem).\n-\n-      In the caching profile ``with-caching-proxy``, this operation is mapped\n-      to the rulesets ``plone.content.feed`` and ``plone.content.file``,\n-      which causes the following headers to be added to the response::\n-\n-        [plone.content.feed]\n-        ETag: <etag-value>\n-        Cache-Control: max-age=0, s-maxage=<seconds>, must-revalidate\n-\n-        [plone.content.file]\n-        Last-Modified: <last-modified-date>\n-        Cache-Control: max-age=0, s-maxage=<seconds>, must-revalidate\n-\n-..\n-\n-* **Weak caching** (``plone.app.caching.weakCaching``)\n-      Cache in browser but expire immediately and enable 304 responses on\n-      subsequent requests. 304\'s require configuration of the\n-      ``Last-Modified`` and/or ``ETags`` settings. If Last-Modified header is\n-      insufficient to ensure freshness, turn on ETag checking by listing each\n-      ETag component that should be used to to construct the ETag header. To\n-      also cache public responses in Zope memory, set the ``RAM cache``\n-      parameter to True.\n-\n-      In the caching profile ``without-caching-proxy``, this operation is\n-      mapped to the rulesets ``plone.content.itemView``,\n-      ``plone.content.folderView``, ``plone.content.feed``, and\n-      ``plone.content.file``, which causes the following headers to be added\n-      to the response::\n-\n-        [plone.content.itemView, plone.content.folderView, plone.content.feed]\n-        ETag: <etag-value>\n-        Cache-Control: max-age=0, must-revalidate, private\n-\n-        [plone.content.file]\n-        Last-Modified: <last-modified-date>\n-        Cache-Control: max-age=0, must-revalidate, private\n-\n-      In the caching profile ``with-caching-proxy``, this operation is mapped\n-      only to the rulesets ``plone.content.itemView`` and\n-      ``plone.content.folderView``.\n-\n-* **No caching** (``plone.app.caching.noCaching``)\n-      Use this operation to keep the response out of all caches. The\n-      default settings generate an IE-safe no-cache operation. Under\n-      certain conditions, IE chokes on ``no-cache`` and ``no-store``\n-      Cache-Control tokens, so instead we just exclude caching in\n-      shared caching proxies with the ``private`` token, expire immediately\n-      in the browser, and disable validation. This emulates the usual\n-      behavior expected from the ``no-cache`` token.  If the nominally\n-      more secure, but occasionally troublesome, ``no-store`` token\n-      is also desired, set the ``No store`` parameter to True.\n-      [XXX - \'no store\' option not done yet]\n-\n-* **Chain** (``plone.caching.operations.chain``)\n-      Allows multiple operations to be chained together. When intercepting\n-      the response, the first chained operation to return a value will\n-      be used. Subsequent operations are ignored. When modifying the\n-      response, all operations will be called, in order.\n-\n-These operation descriptions are a bit simplified as several of these\n-operations also include tests to downgrade caching depending on various\n-parameter settings, workflow state, and access privileges. For more detail,\n-it\'s best to review the operation code itself.\n-\n-\n-Default ruleset/operation mappings\n-~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n-\n-To recap, ``plone.app.caching`` defines three default cache policies\n-containing the cache operation mappings for each of the six rulesets. The\n-default mappings are as follows:\n-\n-===============  =====================  ==================  =============================\n-..               without-caching-proxy  with-caching-proxy  with-caching-proxy-splitviews\n-===============  =====================  ==================  =============================\n-itemView         weakCaching            weakCaching         moderateCaching\n-folderView       weakCaching            weakCaching         moderateCaching\n-feed             weakCaching            moderateCaching     moderateCaching\n-file             weakCaching            moderateCaching     moderateCaching\n-resource         strongCaching          strongCaching       strongCaching\n-stableResource   strongCaching          strongCaching       strongCaching\n-===============  =====================  ==================  =============================\n-\n-\n-Cache operation parameters\n-~~~~~~~~~~~~~~~~~~~~~~~~~~\n-\n-Much of the cache operation behavior is controlled via user-adjustable\n-parameters. In fact, three of the default caching operations (strong caching,\n-moderate caching, and weak caching) are essentially all the same operation but\n-with different default parameter settings and with some parameters hidden from\n-the UI.\n-\n-* *Maximum age* (``maxage``)\n-      Time (in seconds) to cache the response in the browser or caching proxy.\n-      Adds a "Cache-Control: max-age=<value>" header and a matching "Expires"\n-      header to the response.\n-\n-* *Shared maximum age* (``smaxage``)\n-      Time (in seconds) to cache the response in the caching proxy.\n-      Adds a "Cache-Control: s-maxage=<value>" header to the response.\n-\n-* *ETags* (``etags``)\n-      A list of the names of the ETag components to include in the ETag\n-      header. Also turns on "304 Not Modified" responses for "If-None-Match"\n-      conditional requests.\n-\n-* *Last-modified validation* (``lastModified``)\n-      Adds a "Last-Modified" header to the response and turns on "304 Not\n-      Modified" responses for "If-Modified-Since" conditional requests.\n-\n-* *RAM cache* (``ramCache``)\n-      Turn on caching in Zope memory. If the URL is not specific enough to\n-      ensure uniqueness then either ETags or Last-Modified should also be\n-      added to the list of parameters in order to generate a unique cache key.\n-\n-* *Vary* (``vary``)\n-      Name(s) of HTTP headers in the request that must match (in addition to\n-      the URL) for a caching proxy to return a cached response.\n-\n-* *Anonymous only* (``anonOnly``)\n-      Set this to True if you want to force logged-in users to always get a\n-      fresh copy. This works best with the "moderate caching" operation, and\n-      will not work well with a "Max age" (to cache content in the browser)\n-      greater than zero. By setting this option, you can focus the other cache\n-      settings on the anonymous use case. Note that if you are using a caching\n-      proxy, you will need to set a Vary header of "X-Anonymous" or similar,\n-      and ensure that such a header is set in the proxy for logged in users (a\n-      blunter alternative is to use "Cookie" as the header, although this can\n-      have false positives). See the example Varnish and Squid configurations\n-      that come with this package for more details.\n-\n-* *Request variables that prevent caching* (``cacheStopRequestVariables``)\n-      A list of variables in the request (including Cookies) that prevent\n-      caching if present. Note, unlike the others above, this global parameter\n-      is not directly visible in the plone.app.caching UI. There should\n-      unlikely be any need to change this list but, if needed, it can be\n-      edited via the Configuration Registry control panel.\n-\n-\n-Caching operation helper functions\n-~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n-\n-If you will find the implementations of the default caching operations\n-in the package ``plone.app.caching.operations``. If you are writing a\n-custom caching operation, the ``utils`` module contains helper functions\n-which you may find useful.\n-\n-\n-Debug headers and logging\n-~~~~~~~~~~~~~~~~~~~~~~~~~\n-\n-It can sometimes be useful to see which rulesets and operations (if any)\n-are being applied to published resources. There are two ways to see\n-this: via debug response headers and via debug logging.\n-\n-Several debug response headers are added automatically by plone.app.caching\n-and plone.caching. These headers include:\n-\n-* ``X-Cache-Rule: <matching rule id>``\n-\n-* ``X-Cache-Operation: <matching operation id>``\n-\n-* ``X-Cache-Chain-Operations: <list of chain operation ids>``\n-\n-* ``X-RAMCache: <ram cache id>``\n-\n-Viewing these headers is relatively easy with tools like the Firebug\n-and LiveHTTPHeaders add-on for the Firefox browser.  Similar tools\n-for inspecting response headers exist for Safari and IE.\n-\n-If you enable the DEBUG logging level for the ``plone.caching`` logger,\n-you will get additional debug output in your event log. One way to do that\n-is to set the global Zope logging level to DEBUG in ``zope.conf``::\n-\n-    <eventlog>\n-        level DEBUG\n-        <logfile>\n-            path <file path here>\n-            level DEBUG\n-        </logfile>\n-    </eventlog>\n-\n-If you are using `plone.recipe.zope2instance`_ to create your Zope instances,\n-you can set the logging level with the ``event-log-level`` option.\n-\n-You should see output in the log like::\n-\n-    2010-01-11 16:44:10 DEBUG plone.caching Published: <ATImage at /test/i> Ruleset: plone.download Operation: None\n-    2010-01-11 16:44:10 DEBUG plone.caching Published: <ATImage at /test/i> Ruleset: plone.download Operation: plone.caching.operations.chain\n-\n-The ``None`` indicates that no ruleset or operation was mapped.\n-\n-It is probably not a good idea to leave debug logging on for production use,\n-as it can produce a lot of output, filling up log files and adding unnecessary\n-load to your disks.\n-\n-Content-type based rulesets\n-~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n-\n-Normally, you declare caching rulesets for a view, e.g. with::\n-\n-    <cache:ruleset\n-        ruleset="plone.content.itemView"\n-        for=".browser.MyItemView"\n-        />\n-\n-See `plone.caching`_ for details.\n-\n-plone.app.caching installs a special ruleset lookup adapter that is invoked\n-for skin layer page templates and browser views not assigned a more specific\n-rule set. This adapter allows you to declare a ruleset for the *default view*\n-of a given content type by supplying a content type class or interface to the\n-``<cache:ruleset />`` directive::\n-\n-    <cache:ruleset\n-        ruleset="plone.content.itemView"\n-        for=".interfaces.IMyContentType"\n-        />\n-\n-or for a class:\n-\n-    <cache:ruleset\n-        ruleset="plone.content.itemView"\n-        for=".content.MyContentType"\n-        />\n-\n-There are two reasons to want to do this:\n-\n-* Your type uses a skin layer page template for its default view, instead of a\n-  browser view. In this case, you can either declare the ruleset on the\n-  type as shown above (in ZCML), or map the type name in the registry,\n-  using the GUI or GenericSetup. The former is more robust and certainly more\n-  natural if you are declaring other, more conventional rulesets in ZCML\n-  already.\n-* You want to set the ruleset for a number of content types. In fact,\n-  plone.app.caching already does this for you: The Archetypes base classes\n-  ``BaseContent`` and ``BaseFolder`` are assigned the rulesets\n-  ``plone.content.itemView`` and ``plone.content.folderview``, respectively.\n-  Ditto for Dexterity\'s ``IDexterityItem`` and ``IDexterityContainer``\n-  interfaces.\n-\n-.. _plone.caching: http://pypi.python.org/pypi/plone.caching\n-.. _plone.recipe.zope2instance: http://pypi.python.org/pypi/plone.recipe.zope2instance\ndiff --git a/instance.yaml b/instance.yaml\nnew file mode 100644\nindex 0000000..8c6c46e\n--- /dev/null\n+++ b/instance.yaml\n@@ -0,0 +1,8 @@\n+default_context:\n+    initial_user_name: \'admin\'\n+    initial_user_password: \'admin\'\n+\n+    load_zcml:\n+        package_includes: [\'plone.app.caching\']\n+\n+    db_storage: direct\ndiff --git a/mx.ini b/mx.ini\nnew file mode 100644\nindex 0000000..b575b20\n--- /dev/null\n+++ b/mx.ini\n@@ -0,0 +1,9 @@\n+; This is a mxdev configuration file\n+; it can be used to override versions of packages already defined in the\n+; constraints files and to add new packages from VCS like git.\n+; to learn more about mxdev visit https://pypi.org/project/mxdev/\n+\n+[settings]\n+; example how to override a package version\n+; version-overrides =\n+;     example.package==2.1.0a2\ndiff --git a/news/1.bugfix b/news/1.bugfix\ndeleted file mode 100644\nindex 2229bed..0000000\n--- a/news/1.bugfix\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-Declare dependencies.\n-[gforcada]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 22f22ec..ea13c1f 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,10 +1,12 @@\n # Generated from:\n # https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n-filename = "CHANGES.rst"\n+filename = "CHANGES.md"\n directory = "news/"\n-title_format = "{version} ({project_date})"\n-underlines = ["-", ""]\n+start_string = "<!-- towncrier release notes start -->\\n"\n+title_format = "## {version} ({project_date})"\n+template = "docs/changelog_template.jinja"\n+underlines = ["", "", ""]\n \n [[tool.towncrier.type]]\n directory = "breaking"\ndiff --git a/requirements.txt b/requirements.txt\nnew file mode 100644\nindex 0000000..8e4007a\n--- /dev/null\n+++ b/requirements.txt\n@@ -0,0 +1 @@\n+-e ".[test]"\ndiff --git a/setup.cfg b/setup.cfg\nindex d9ca197..edba85f 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -24,5 +24,7 @@ ignore =\n     lint-requirements.txt\n     .tox\n     constraints-mxdev.txt\n-    instance\n+    instance.yaml\n+    Makefile\n+    mx.ini\n     requirements-mxdev.txt\ndiff --git a/setup.py b/setup.py\nindex 262d39a..722645b 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -1,14 +1,21 @@\n+from pathlib import Path\n from setuptools import find_packages\n from setuptools import setup\n \n \n-version = "3.0.3.dev0"\n+version = "3.0.4.dev0"\n+\n+long_description = f"""\n+{Path("README.md").read_text()}\\n\n+{Path("CHANGES.md").read_text()}\\n\n+"""\n \n setup(\n     name="plone.app.caching",\n     version=version,\n     description="Plone UI and default rules for plone.caching/z3c.caching",\n-    long_description=(open("README.rst").read() + "\\n" + open("CHANGES.rst").read()),\n+    long_description=long_description,\n+    long_description_content_type="text/markdown",\n     classifiers=[\n         "Development Status :: 5 - Production/Stable",\n         "Environment :: Web Environment",\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-24T23:22:51+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/303291abdd40e3b590ca7d45ffa511fe9a4fdeb2

Comment out tox tests for now, they don't work.

Files changed:
M tox.ini

b"diff --git a/tox.ini b/tox.ini\nindex 6a42494..8ed21b4 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -43,13 +43,13 @@ deps =\n commands =\n     sh -c 'pipdeptree --exclude setuptools,pipdeptree,wheel --graph-output svg > dependencies.svg'\n \n-[testenv:test]\n-description = run the tests of the distribution\n-deps =\n-    plone.app.caching[test]\n-    pytest\n-    gocept.pytestlayer\n-    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n-commands =\n-    pip install -e .[test]\n-    pytest\n+; [testenv:test]\n+; description = run the tests of the distribution\n+; deps =\n+;     plone.app.caching[test]\n+;     pytest\n+;     gocept.pytestlayer\n+;     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+; commands =\n+;     pip install -e .[test]\n+;     pytest\n"

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2023-02-25T23:04:20+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/6e31dd86240647ce6f2b55acced49ae082b8debb

Merge pull request #118 from plone/config-with-default-template-f9275fa3

Config with default template f9275fa3

Files changed:
A .pre-commit-config.yaml
A news/cbbcff93.internal
M .meta.toml
M plone/app/caching/browser/controlpanel.pt
M plone/app/caching/browser/controlpanel.py
M plone/app/caching/browser/edit.pt
M plone/app/caching/browser/edit.py
M plone/app/caching/browser/import.pt
M plone/app/caching/browser/purge.pt
M plone/app/caching/browser/ramcache.pt
M plone/app/caching/lookup.py
M plone/app/caching/operations/utils.py
M plone/app/caching/purge.py
M plone/app/caching/setuphandlers.py
M plone/app/caching/testing.py
M plone/app/caching/tests/test_etags.py
M plone/app/caching/tests/test_integration.py
M plone/app/caching/tests/test_lastmodified.py
M plone/app/caching/tests/test_lookup.py
M plone/app/caching/tests/test_operation_parameters.py
M plone/app/caching/tests/test_operation_utils.py
M plone/app/caching/tests/test_profile_with_caching_proxy.py
M plone/app/caching/tests/test_profile_without_caching_proxy.py
M plone/app/caching/tests/test_purge.py
M plone/app/caching/tests/test_utils.py
M pyproject.toml
M setup.cfg
M tox.ini

b'diff --git a/.meta.toml b/.meta.toml\nindex 6323538..15742c4 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -2,7 +2,7 @@\n # https://github.com/plone/meta/tree/master/config/default\n [meta]\n template = "default"\n-commit-id = "0e4e67b6"\n+commit-id = "cbbcff93"\n \n [dependencies]\n mappings = [\n@@ -10,3 +10,16 @@ mappings = [\n     "python-dateutil = [\'dateutil\']",\n     ]\n ignores = "[\'zope.dublincore\']"\n+\n+[check-manifest]\n+additional-ignores = [\n+    ".tox",\n+    "constraints-mxdev.txt",\n+    "instance.yaml",\n+    "Makefile",\n+    "mx.ini",\n+    "requirements-mxdev.txt",\n+    ]\n+\n+[codespell]\n+additional-ignores = "discreet,ordner"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 0000000..a3085c9\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.1\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.1"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/news/cbbcff93.internal b/news/cbbcff93.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/cbbcff93.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/plone/app/caching/browser/controlpanel.pt b/plone/app/caching/browser/controlpanel.pt\nindex 1b8c69f..8c2748c 100644\n--- a/plone/app/caching/browser/controlpanel.pt\n+++ b/plone/app/caching/browser/controlpanel.pt\n@@ -1,16 +1,18 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<div metal:fill-slot="prefs_configlet_main">\n+    <div metal:fill-slot="prefs_configlet_main">\n \n-<script type="text/javascript">\n+      <script type="text/javascript">\n (function($) {\n \n     if($.fn.prepOverlay){\n@@ -26,279 +28,400 @@\n     }\n \n })(jQuery);\n-</script>\n+      </script>\n \n-    <div class="autotabs">\n+      <div class="autotabs">\n         <ul class="nav nav-tabs">\n-            <li class="nav-item">\n-                <a href=""\n-                   class="nav-link active"\n-                   tal:attributes="href string:${portal_url}/@@caching-controlpanel"\n-                   i18n:translate="label_settings">Change settings</a>\n-              </li>\n-              <li class="nav-item">\n-                <a class="nav-link"\n-                   href=""\n-                   tal:attributes="href string:${portal_url}/@@caching-controlpanel-import"\n-                   i18n:translate="label_import">Import settings</a>\n-              </li>\n-              <li tal:condition="view/purgingEnabled" class="nav-item">\n-                <a class="nav-link"\n-                   href=""\n-                   tal:attributes="href string:${portal_url}/@@caching-controlpanel-purge"\n-                   i18n:translate="label_purging">Purge caching proxy</a>\n-              </li>\n-              <li class="nav-item">\n-                <a class="nav-link"\n-                   href=""\n-                   tal:attributes="href string:${portal_url}/@@caching-controlpanel-ramcache"\n-                   i18n:translate="label_ramcache">RAM cache</a>\n-              </li>\n+          <li class="nav-item">\n+            <a class="nav-link active"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel;\n+               "\n+               i18n:translate="label_settings"\n+            >Change settings</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-import;\n+               "\n+               i18n:translate="label_import"\n+            >Import settings</a>\n+          </li>\n+          <li class="nav-item"\n+              tal:condition="view/purgingEnabled"\n+          >\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-purge;\n+               "\n+               i18n:translate="label_purging"\n+            >Purge caching proxy</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-ramcache;\n+               "\n+               i18n:translate="label_ramcache"\n+            >RAM cache</a>\n+          </li>\n         </ul>\n-    </div>\n+      </div>\n \n-    <div class="alert alert-info"\n-         role="alert"\n-        tal:condition="not: view/settings/enabled">\n+      <div class="alert alert-info"\n+           role="alert"\n+           tal:condition="not: view/settings/enabled"\n+      >\n         <strong i18n:translate="">\n             Info\n         </strong>\n         <span tal:omit-tag=""\n-            i18n:translate="label_caching_first_time_here?">\n+              i18n:translate="label_caching_first_time_here?"\n+        >\n             First time here? We recommend that you get started by\n-            <a href="@@caching-controlpanel-import"\n-               tal:attributes="href string:${context/absolute_url}/@@caching-controlpanel-import"\n-               title="Import caching rules"\n-               i18n:name="link"\n-               i18n:attributes="title label_import_caching_rules"\n-               i18n:translate="label_caching_first_time_here_link"\n-               >importing a preconfigured set of caching rules</a>.\n+          <a href="@@caching-controlpanel-import"\n+             title="Import caching rules"\n+             tal:attributes="\n+               href string:${context/absolute_url}/@@caching-controlpanel-import;\n+             "\n+             i18n:attributes="title label_import_caching_rules"\n+             i18n:name="link"\n+             i18n:translate="label_caching_first_time_here_link"\n+          >importing a preconfigured set of caching rules</a>.\n         </span>\n-    </div>\n+      </div>\n \n-    <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n     Portal status message\n-    </div>\n+      </div>\n \n \n-            <div class="configlet">\n+      <div class="configlet">\n \n-                <h1 class="documentFirstHeading"\n-                    i18n:translate="heading_caching_settings">Caching settings</h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="heading_caching_settings"\n+        >Caching settings</h1>\n \n \n-                <p i18n:translate="description_cache_settings" class="documentDescription">\n+        <p class="documentDescription"\n+           i18n:translate="description_cache_settings"\n+        >\n                     Control how pages, images, style sheets and other resources are\n                     cached.\n-                </p>\n-\n-\n-                <form\n-                    name="settings"\n-                    method="post"\n-                    class="enableFormTabbing pat-formunloadalert pat-autotoc"\n-                    data-pat-autotoc="levels: legend; section: fieldset; className: autotabs"\n-                    tal:attributes="action request/URL"\n-                    tal:define="errors view/errors">\n-\n-\n-                    <!-- Field set: global settings -->\n-                    <fieldset id="fieldset-global-settings">\n-                        <legend\n-                            id="fieldsetlegend-global-settings"\n-                            i18n:translate="legend_global_settings">Global settings</legend>\n-\n-                        <div\n-                            class="form-check"\n-                            tal:define="selected python:request.get(\'enabled\', view.settings.enabled)">\n-\n-                            <input type="hidden" value="" name="enabled:boolean:default" />\n-                            <input class="form-check-input"\n-                                type="checkbox" value="1" name="enabled:boolean" id="enabled"\n-                                tal:attributes="checked python:\'checked\' if selected else None"\n-                                />\n-                            <label class="form-check-label"\n-                                   for="enabled" i18n:translate="label_enabled">Enable caching</label>\n-                            <div class="form-text" i18n:translate="help_enabled">\n+        </p>\n+\n+\n+        <form class="enableFormTabbing pat-formunloadalert pat-autotoc"\n+              method="post"\n+              name="settings"\n+              data-pat-autotoc="levels: legend; section: fieldset; className: autotabs"\n+              tal:define="\n+                errors view/errors;\n+              "\n+              tal:attributes="\n+                action request/URL;\n+              "\n+        >\n+\n+\n+          <!-- Field set: global settings -->\n+          <fieldset id="fieldset-global-settings">\n+            <legend id="fieldsetlegend-global-settings"\n+                    i18n:translate="legend_global_settings"\n+            >Global settings</legend>\n+\n+            <div class="form-check"\n+                 tal:define="\n+                   selected python:request.get(\'enabled\', view.settings.enabled);\n+                 "\n+            >\n+\n+              <input name="enabled:boolean:default"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input class="form-check-input"\n+                     id="enabled"\n+                     name="enabled:boolean"\n+                     type="checkbox"\n+                     value="1"\n+                     tal:attributes="\n+                       checked python:\'checked\' if selected else None;\n+                     "\n+              />\n+              <label class="form-check-label"\n+                     for="enabled"\n+                     i18n:translate="label_enabled"\n+              >Enable caching</label>\n+              <div class="form-text"\n+                   i18n:translate="help_enabled"\n+              >\n                                 If this option is disabled, no caching will take place.\n-                            </div>\n+              </div>\n \n-                        </div>\n+            </div>\n \n-                    </fieldset>\n+          </fieldset>\n \n-                    <!-- Field set: caching proxies -->\n-                    <fieldset id="fieldset-caching-proxies">\n-                        <legend\n-                            id="fieldsetlegend-caching-proxies"\n-                            i18n:translate="legend_caching_proxies">Caching proxies</legend>\n+          <!-- Field set: caching proxies -->\n+          <fieldset id="fieldset-caching-proxies">\n+            <legend id="fieldsetlegend-caching-proxies"\n+                    i18n:translate="legend_caching_proxies"\n+            >Caching proxies</legend>\n \n-                        <div class="discreet" i18n:translate="description_caching_proxies">\n+            <div class="discreet"\n+                 i18n:translate="description_caching_proxies"\n+            >\n                             High-performance sites will often place a caching reverse\n                             proxy such as Varnish or Squid in front of Zope. The caching\n                             operations configured elsewhere on this screen can often take\n                             advantage of such a proxy by instructing it to cache certain\n                             content in a certain way, whilst passing requests for other\n                             content through to Plone always. Plone can also send so-called\n-                            <code>PURGE</code> requests to a caching proxy when content\n+              <code>PURGE</code>\n+               requests to a caching proxy when content\n                             changes, reducing the risk of a stale response from a cached\n                             copy.\n-                        </div>\n+            </div>\n \n-                        <div class="mb-3 field form-check"\n-                            tal:define="selected python:request.get(\'purgingEnabled\', view.purgingSettings.enabled)">\n-\n-                            <input type="hidden" value="" name="purgingEnabled:boolean:default" />\n-                            <input class="form-check-input"\n-                                   type="checkbox" value="1" name="purgingEnabled:boolean" id="purgingEnabled"\n-                                tal:attributes="checked python:\'checked\' if selected else None"\n-                                />\n-                            <label class="form-check-label"\n-                                   for="purgingEnabled" i18n:translate="label_purging_enabled">Enable purging</label>\n-                            <div class="form-text" i18n:translate="help_purging_enabled">\n+            <div class="mb-3 field form-check"\n+                 tal:define="\n+                   selected python:request.get(\'purgingEnabled\', view.purgingSettings.enabled);\n+                 "\n+            >\n+\n+              <input name="purgingEnabled:boolean:default"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input class="form-check-input"\n+                     id="purgingEnabled"\n+                     name="purgingEnabled:boolean"\n+                     type="checkbox"\n+                     value="1"\n+                     tal:attributes="\n+                       checked python:\'checked\' if selected else None;\n+                     "\n+              />\n+              <label class="form-check-label"\n+                     for="purgingEnabled"\n+                     i18n:translate="label_purging_enabled"\n+              >Enable purging</label>\n+              <div class="form-text"\n+                   i18n:translate="help_purging_enabled"\n+              >\n                                 Enable this option if you have configured a caching proxy\n                                 in front of Plone, and the proxy supports HTTP\n-                                <code>PURGE</code> requests.\n-                            </div>\n-\n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                             tal:define="error errors/cachingProxies | nothing;\n-                                        selected python:request.get(\'cachingProxies\', view.purgingSettings.cachingProxies)"\n-                        >\n+                <code>PURGE</code>\n+                 requests.\n+              </div>\n \n-                            <label class="form-label"\n-                                   for="cachingProxies" i18n:translate="label_caching_proxies">Caching proxies</label>\n-\n-                            <div tal:replace="error" tal:condition="error" />\n-\n-                            <textarea class="form-control"\n-                                cols="40" rows="4" id="cachingProxies" name="cachingProxies:lines"\n-                                tal:content="python:\'\\n\'.join(selected or [])"\n-                                ></textarea>\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_caching_proxies">\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/cachingProxies | nothing;\n+                   selected python:request.get(\'cachingProxies\', view.purgingSettings.cachingProxies);\n+                 "\n+            >\n+\n+              <label class="form-label"\n+                     for="cachingProxies"\n+                     i18n:translate="label_caching_proxies"\n+              >Caching proxies</label>\n+\n+              <div tal:condition="error"\n+                   tal:replace="error"\n+              ></div>\n+\n+              <textarea class="form-control"\n+                        id="cachingProxies"\n+                        cols="40"\n+                        name="cachingProxies:lines"\n+                        rows="4"\n+                        tal:content="python:\'\\n\'.join(selected or [])"\n+              ></textarea>\n+\n+              <div class="form-text"\n+                   i18n:translate="help_caching_proxies"\n+              >\n                                 Enter the domain name of each caching proxy, one per\n                                 line. For example, if you have Varnish running on the\n                                 local machine on port 1234, you could enter\n-                                <code>http://localhost:1234</code>. The domain name must\n+                <code>http://localhost:1234</code>. The domain name must\n                                 be reachable by the Zope process, but does not need to\n                                 be reachable from users\' local machines.\n-                            </div>\n+              </div>\n \n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                            tal:define="error errors/purgedContentTypes | nothing;\n-                                        selected python:request.get(\'purgedContentTypes\', view.ploneSettings.purgedContentTypes)"\n-                        >\n-\n-                            <label class="form-label"\n-                                   for="purgedContentTypes" i18n:translate="label_purged_content_types">Content types to purge</label>\n-\n-                            <div tal:replace="error" tal:condition="error" />\n-\n-                            <select class="form-select"\n-                                    size="6" multiple="multiple" id="purgedContentTypes" name="purgedContentTypes:list">\n-                                <option\n-                                    tal:repeat="contentType view/contentTypes"\n-                                    tal:attributes="value    contentType/name;\n-                                                    title    contentType/description;\n-                                                    selected python:\'selected\' if contentType[\'name\'] in selected else None;"\n-                                    tal:content="contentType/title"\n-                                    i18n:attributes="title" i18n:translate=""/>\n-                            </select>\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_purged_content_types">\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/purgedContentTypes | nothing;\n+                   selected python:request.get(\'purgedContentTypes\', view.ploneSettings.purgedContentTypes);\n+                 "\n+            >\n+\n+              <label class="form-label"\n+                     for="purgedContentTypes"\n+                     i18n:translate="label_purged_content_types"\n+              >Content types to purge</label>\n+\n+              <div tal:condition="error"\n+                   tal:replace="error"\n+              ></div>\n+\n+              <select class="form-select"\n+                      id="purgedContentTypes"\n+                      multiple="multiple"\n+                      name="purgedContentTypes:list"\n+                      size="6"\n+              >\n+                <option tal:repeat="contentType view/contentTypes"\n+                        tal:content="contentType/title"\n+                        tal:attributes="\n+                          value    contentType/name;\n+                          title    contentType/description;\n+                          selected python:\'selected\' if contentType[\'name\'] in selected else None;\n+                        "\n+                        i18n:attributes="title"\n+                        i18n:translate=""\n+                ></option>\n+              </select>\n+\n+              <div class="form-text"\n+                   i18n:translate="help_purged_content_types"\n+              >\n                                 If you have enabled purging, Plone can automatically purge\n                                 the views of content items when they are modified or\n                                 removed. Select the types to automatically purge below.\n-                                <strong>Note:</strong> although a content items\'s view\n+                <strong>Note:</strong>\n+                 although a content items\'s view\n                                 can be purged easily, it is not always possible to purge\n                                 every page where that item may appear. Items that appear\n-                                in dynamic listings (such as <em>Collection</em> portlets),\n+                                in dynamic listings (such as\n+                <em>Collection</em>\n+                 portlets),\n                                 the navigation tree and other navigational aids may appear\n                                 out of date if you have cached the pages where those\n                                 items would appear.\n-                            </div>\n+              </div>\n \n-                        </div>\n+            </div>\n \n-                        <div class="mb-3 field form-check"\n-                            tal:define="selected python:request.get(\'virtualHosting\', view.purgingSettings.virtualHosting)">\n-\n-                            <input type="hidden" value="" name="virtualHosting:boolean:default" />\n-                            <input class="form-check-input"\n-                                   type="checkbox" value="1" name="virtualHosting:boolean" id="virtualHosting"\n-                                tal:attributes="checked python:\'checked\' if selected else None"\n-                                />\n-                            <label class="form-check-label"\n-                                   for="virtualHosting" i18n:translate="label_virtual_hosting">Virtual host rewriting takes place in front of the caching proxy</label>\n-                            <div class="form-text" i18n:translate="help_virtual_hosting">\n+            <div class="mb-3 field form-check"\n+                 tal:define="\n+                   selected python:request.get(\'virtualHosting\', view.purgingSettings.virtualHosting);\n+                 "\n+            >\n+\n+              <input name="virtualHosting:boolean:default"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input class="form-check-input"\n+                     id="virtualHosting"\n+                     name="virtualHosting:boolean"\n+                     type="checkbox"\n+                     value="1"\n+                     tal:attributes="\n+                       checked python:\'checked\' if selected else None;\n+                     "\n+              />\n+              <label class="form-check-label"\n+                     for="virtualHosting"\n+                     i18n:translate="label_virtual_hosting"\n+              >Virtual host rewriting takes place in front of the caching proxy</label>\n+              <div class="form-text"\n+                   i18n:translate="help_virtual_hosting"\n+              >\n                                 Enable this if you are using virtual hosting with Zope\'s\n                                 VirtualHostMonster and you perform URL rewriting (to\n                                 incorporate the special virtual hosting tokens such as\n-                                <code>VirtualHostBase</code> and\n-                                <code>VirtualHostRoot</code> in the URL) <em>before</em>\n+                <code>VirtualHostBase</code>\n+                 and\n+                <code>VirtualHostRoot</code>\n+                in the URL)\n+                <em>before</em>\n                                 the request is passed to the caching proxy, e.g. in an\n                                 Apache web server that receives requests and passes them\n                                 on to a Varnish caching proxy. Disable this option if you\n                                 are not using virtual hosting, or if the caching proxy is\n                                 in front of whatever performs the rewrite (or is itself\n                                 performing the rewrites), disable this option.\n-                            </div>\n-\n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                            tal:define="error errors/domains | nothing;\n-                                        selected python:request.get(\'domains\', view.purgingSettings.domains)"\n-                        >\n-\n-                            <label class="form-label"\n-                                   for="domains" i18n:translate="label_domains">Externally facing domains</label>\n+              </div>\n \n-                            <div tal:replace="error" tal:condition="error" />\n-\n-                            <textarea class="form-control"\n-                                cols="40" rows="4" id="domains" name="domains:lines"\n-                                tal:content="python:\'\\n\'.join(selected or [])"\n-                                ></textarea>\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_domains">\n-                                <p>\n-                                If you have enabled <em>Virtual host rewriting takes place\n-                                front of the caching proxy</em> above, and your site is\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/domains | nothing;\n+                   selected python:request.get(\'domains\', view.purgingSettings.domains);\n+                 "\n+            >\n+\n+              <label class="form-label"\n+                     for="domains"\n+                     i18n:translate="label_domains"\n+              >Externally facing domains</label>\n+\n+              <div tal:condition="error"\n+                   tal:replace="error"\n+              ></div>\n+\n+              <textarea class="form-control"\n+                        id="domains"\n+                        cols="40"\n+                        name="domains:lines"\n+                        rows="4"\n+                        tal:content="python:\'\\n\'.join(selected or [])"\n+              ></textarea>\n+\n+              <div class="form-text"\n+                   i18n:translate="help_domains"\n+              >\n+                <p>\n+                                If you have enabled\n+                  <em>Virtual host rewriting takes place\n+                    front of the caching proxy</em>\n+                   above, and your site is\n                                 reachable via multiple domains (e.g.\n-                                <code>http://example.com:80</code> vs.\n-                                <code>http://www.example.com:80</code>), enter all available\n+                  <code>http://example.com:80</code>\n+                   vs.\n+                  <code>http://www.example.com:80</code>), enter all available\n                                 domains here, one per line. This will ensure that purge\n                                 requests are sent for all domains where applicable. Note\n                                 that it is more efficient to configure the front-most web\n                                 server to simply redirect all requests to a single domain,\n                                 so that Zope only "sees" a single domain.\n-                                </p>\n-                                <p>\n+                </p>\n+                <p>\n                                 It is safe to leave this list blank if you are not using\n                                 a caching proxy, if you are not using virtual hosting,\n                                 if virtual host rewriting takes place behind the caching\n                                 proxy, or if you only have a single virtually hosted\n                                 domain name.\n-                                </p>\n-                            </div>\n+                </p>\n+              </div>\n \n-                        </div>\n+            </div>\n \n-                    </fieldset>\n+          </fieldset>\n \n-                    <!-- Field set: memory -->\n-                    <fieldset id="fieldset-ram">\n-                        <legend\n-                            id="fieldsetlegend-ram"\n-                            i18n:translate="legend_ram">In-memory cache</legend>\n+          <!-- Field set: memory -->\n+          <fieldset id="fieldset-ram">\n+            <legend id="fieldsetlegend-ram"\n+                    i18n:translate="legend_ram"\n+            >In-memory cache</legend>\n \n-                        <div class="discreet" i18n:translate="description_ram">\n+            <div class="discreet"\n+                 i18n:translate="description_ram"\n+            >\n                             Plone maintains a cache of certain pages and\n                             fragments of pages in memory to speed up\n                             rendering. Certain caching operations, when\n@@ -314,254 +437,364 @@\n                             load balancer so that they always reach the same\n                             back-end instance. As an alternative, you can\n                             integrate a shared cache such as\n-                            <em>memcached</em>. See the documentation for\n+              <em>memcached</em>. See the documentation for\n                             details.\n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                            tal:define="error errors/ramCacheMaxEntries | nothing"\n-                        >\n-\n-                            <label class="form-label"\n-                                for="ramCacheMaxEntries"\n-                                i18n:translate="label_ram_max_entries">Maximum entries in the cache</label>\n-\n-                            <span class="fieldRequired" i18n:translate="">(Required)</span>\n-\n-                            <div tal:condition="error" tal:content="error" />\n-\n-                            <input class="form-control"\n-                                name="ramCacheMaxEntries" id="ramCacheMaxEntries" size="6"\n-                                tal:attributes="value request/ramCacheMaxEntries | view/ramCache/maxEntries | nothing" />\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_ram_max_entries">\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/ramCacheMaxEntries | nothing;\n+                 "\n+            >\n+\n+              <label class="form-label"\n+                     for="ramCacheMaxEntries"\n+                     i18n:translate="label_ram_max_entries"\n+              >Maximum entries in the cache</label>\n+\n+              <span class="fieldRequired"\n+                    i18n:translate=""\n+              >(Required)</span>\n+\n+              <div tal:condition="error"\n+                   tal:content="error"\n+              ></div>\n+\n+              <input class="form-control"\n+                     id="ramCacheMaxEntries"\n+                     name="ramCacheMaxEntries"\n+                     size="6"\n+                     tal:attributes="\n+                       value request/ramCacheMaxEntries | view/ramCache/maxEntries | nothing;\n+                     "\n+              />\n+\n+              <div class="form-text"\n+                   i18n:translate="help_ram_max_entries"\n+              >\n                                 Use this to control how many items can be\n                                 placed in the cache. The more items you allow,\n                                 the higher the potential memory consumption.\n-                            </div>\n-\n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                            tal:define="error errors/ramCacheMaxAge | nothing"\n-                        >\n-\n-                            <label\n-                                for="ramCacheMaxAge"\n-                                i18n:translate="label_ram_max_age">Maximum age of entries in the cache</label>\n-\n-                            <span class="fieldRequired" i18n:translate="">(Required)</span>\n+              </div>\n \n-                            <div tal:condition="error" tal:content="error" />\n-\n-                            <input class="form-control"\n-                                name="ramCacheMaxAge" id="ramCacheMaxAge" size="6"\n-                                tal:attributes="value request/ramCacheMaxAge | view/ramCache/maxAge | nothing" />\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_ram_max_age">\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/ramCacheMaxAge | nothing;\n+                 "\n+            >\n+\n+              <label for="ramCacheMaxAge"\n+                     i18n:translate="label_ram_max_age"\n+              >Maximum age of entries in the cache</label>\n+\n+              <span class="fieldRequired"\n+                    i18n:translate=""\n+              >(Required)</span>\n+\n+              <div tal:condition="error"\n+                   tal:content="error"\n+              ></div>\n+\n+              <input class="form-control"\n+                     id="ramCacheMaxAge"\n+                     name="ramCacheMaxAge"\n+                     size="6"\n+                     tal:attributes="\n+                       value request/ramCacheMaxAge | view/ramCache/maxAge | nothing;\n+                     "\n+              />\n+\n+              <div class="form-text"\n+                   i18n:translate="help_ram_max_age"\n+              >\n                                 Enter the maximum time, in seconds, that an item\n                                 may remain in the cache before being purged.\n-                            </div>\n+              </div>\n \n-                        </div>\n-\n-                        <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                            tal:define="error errors/ramCacheCleanupInterval | nothing"\n-                        >\n-\n-                            <label\n-                                for="ramCacheCleanupInterval"\n-                                i18n:translate="label_ram_cleanup_interval">Cleanup interval</label>\n-\n-                            <span class="fieldRequired" i18n:translate="">(Required)</span>\n-\n-                            <div tal:condition="error" tal:content="error" />\n-\n-                            <input class="form-control"\n-                                name="ramCacheCleanupInterval" id="ramCacheCleanupInterval" size="6"\n-                                tal:attributes="value request/ramCacheCleanupInterval | view/ramCache/cleanupInterval | nothing" />\n+            </div>\n \n-                            <div class="form-text" i18n:translate="help_ram_cleanup_interval">\n+            <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+                 tal:define="\n+                   error errors/ramCacheCleanupInterval | nothing;\n+                 "\n+            >\n+\n+              <label for="ramCacheCleanupInterval"\n+                     i18n:translate="label_ram_cleanup_interval"\n+              >Cleanup interval</label>\n+\n+              <span class="fieldRequired"\n+                    i18n:translate=""\n+              >(Required)</span>\n+\n+              <div tal:condition="error"\n+                   tal:content="error"\n+              ></div>\n+\n+              <input class="form-control"\n+                     id="ramCacheCleanupInterval"\n+                     name="ramCacheCleanupInterval"\n+                     size="6"\n+                     tal:attributes="\n+                       value request/ramCacheCleanupInterval | view/ramCache/cleanupInterval | nothing;\n+                     "\n+              />\n+\n+              <div class="form-text"\n+                   i18n:translate="help_ram_cleanup_interval"\n+              >\n                                 Enter the time, in seconds, before attempts\n                                 to clean up the cache. A lower value may reduce\n                                 memory consumption by purging items frequently,\n                                 but can also slow down the system by tying up\n                                 the cache with maintenance tasks for too long.\n-                            </div>\n+              </div>\n \n-                        </div>\n+            </div>\n \n-                    </fieldset>\n-\n-                    <!-- Field set: mappings -->\n-                    <fieldset id="fieldset-mappings">\n-                        <legend\n-                            id="fieldsetlegend-mappings"\n-                            i18n:translate="legend_mappings">Caching operations</legend>\n-\n-                        <div class="discreet" i18n:translate="description_mappings">\n-                            <p>\n-                            Caching can be controlled by mapping <em>rulesets</em> to\n-                            <em>caching operations</em>.\n-                            </p>\n-                            <p>\n-                            A <strong>ruleset</strong> is a name given to a resource\n+          </fieldset>\n+\n+          <!-- Field set: mappings -->\n+          <fieldset id="fieldset-mappings">\n+            <legend id="fieldsetlegend-mappings"\n+                    i18n:translate="legend_mappings"\n+            >Caching operations</legend>\n+\n+            <div class="discreet"\n+                 i18n:translate="description_mappings"\n+            >\n+              <p>\n+                            Caching can be controlled by mapping\n+                <em>rulesets</em>\n+                 to\n+                <em>caching operations</em>.\n+              </p>\n+              <p>\n+                            A\n+                <strong>ruleset</strong>\n+                 is a name given to a resource\n                             published by Plone, such as a view. Rulesets are declared by\n                             the developers who write those views. You can think of them as\n                             a way to give hints about how something should be cached,\n                             without actually implementing the caching operations.\n-                            </p>\n-                            <p>\n+              </p>\n+              <p>\n                             The exact caching operations to use are mapped to\n                             rulesets in the table below. Caching operations will often\n                             set response headers to tell the users\'s web browser and/or\n                             a caching proxy how to cache content. They may also intercept\n                             a response to return a cached copy or instruct the browser to use\n                             its own cached copy, if it is considered to be current.\n-                            </p>\n-                        </div>\n-                        <div class="mb-3 field">\n-                            <label i18n:translate="label_mappings">Ruleset mappings</label>\n-                            <div class="form-text" i18n:translate="help_main_mappings">\n+              </p>\n+            </div>\n+            <div class="mb-3 field">\n+              <label i18n:translate="label_mappings">Ruleset mappings</label>\n+              <div class="form-text"\n+                   i18n:translate="help_main_mappings"\n+              >\n                                 Use the table below to map rulesets to caching\n                                 operations.\n-                            </div>\n-\n-                            <table class="table table-striped table-responsive" id="rulesetMappingsTable">\n-                                <thead>\n-                                    <tr>\n-                                        <th class="col-9"\n-                                            i18n:translate="heading_ruleset">Ruleset</th>\n-                                        <th class="col-3"\n-                                            i18n:translate="heading_operation">Operation</th>\n-                                    </tr>\n-                                </thead>\n-                                <tbody>\n-                                    <tr tal:repeat="ruleType view/ruleTypes">\n-                                        <td>\n-                                            <label class="form-label"\n-                                                tal:content="ruleType/title" i18n:translate=""/>\n-                                            <p class="form-text" tal:content="ruleType/description" i18n:translate=""/>\n-                                        </td>\n-                                        <td tal:define="selected python:request.get(\'operations\', view.operationMapping).get(ruleType[\'safeName\'], None)">\n-                                            <select class="form-select"\n-                                                size="1"\n-                                                tal:attributes="id   string:operation-${ruleType/name};\n-                                                                name string:operations.${ruleType/safeName}:record;">\n-                                                <option\n-                                                    value=""\n-                                                    tal:attributes="selected python:\'selected\' if selected is None else None"\n-                                                    i18n:translate="value_not_used"\n-                                                    >(Not used)</option>\n-                                                <option\n-                                                    tal:repeat="operationType view/operationTypes"\n-                                                    tal:attributes="value    operationType/name;\n-                                                                    title    operationType/description;\n-                                                                    selected python:\'selected\' if operationType[\'name\'] == selected else None;"\n-                                                    tal:content="operationType/title"\n-                                                    />\n-                                            </select>\n-                                        </td>\n-                                    </tr>\n-                                </tbody>\n-                            </table>\n-                        </div>\n+              </div>\n+\n+              <table class="table table-striped table-responsive"\n+                     id="rulesetMappingsTable"\n+              >\n+                <thead>\n+                  <tr>\n+                    <th class="col-9"\n+                        i18n:translate="heading_ruleset"\n+                    >Ruleset</th>\n+                    <th class="col-3"\n+                        i18n:translate="heading_operation"\n+                    >Operation</th>\n+                  </tr>\n+                </thead>\n+                <tbody>\n+                  <tr tal:repeat="ruleType view/ruleTypes">\n+                    <td>\n+                      <label class="form-label"\n+                             tal:content="ruleType/title"\n+                             i18n:translate=""\n+                      ></label>\n+                      <p class="form-text"\n+                         tal:content="ruleType/description"\n+                         i18n:translate=""\n+                      ></p>\n+                    </td>\n+                    <td tal:define="\n+                          selected python:request.get(\'operations\', view.operationMapping).get(ruleType[\'safeName\'], None);\n+                        ">\n+                      <select class="form-select"\n+                              size="1"\n+                              tal:attributes="\n+                                id   string:operation-${ruleType/name};\n+                                name string:operations.${ruleType/safeName}:record;\n+                              "\n+                      >\n+                        <option value=""\n+                                tal:attributes="\n+                                  selected python:\'selected\' if selected is None else None;\n+                                "\n+                                i18n:translate="value_not_used"\n+                        >(Not used)</option>\n+                        <option tal:repeat="operationType view/operationTypes"\n+                                tal:content="operationType/title"\n+                                tal:attributes="\n+                                  value    operationType/name;\n+                                  title    operationType/description;\n+                                  selected python:\'selected\' if operationType[\'name\'] == selected else None;\n+                                "\n+                        ></option>\n+                      </select>\n+                    </td>\n+                  </tr>\n+                </tbody>\n+              </table>\n+            </div>\n \n-                        <div class="mb-3 field">\n-                            <label class="form-label"\n-                                i18n:translate="label_template_mappings">Legacy template mappings</label>\n-                            <div class="form-text" i18n:translate="help_template_mappings">\n-                                <p>\n-                                Legacy page templates defined in the <em>portal_skins</em>\n+            <div class="mb-3 field">\n+              <label class="form-label"\n+                     i18n:translate="label_template_mappings"\n+              >Legacy template mappings</label>\n+              <div class="form-text"\n+                   i18n:translate="help_template_mappings"\n+              >\n+                <p>\n+                                Legacy page templates defined in the\n+                  <em>portal_skins</em>\n                                 tool in the ZMI, or created or customised through the web cannot be\n                                 associated with rulesets in the usual way. There are two options:\n-                                </p>\n-                                <ul>\n-                                    <li>If the template is the <em>default type</em> of a content type\n+                </p>\n+                <ul>\n+                  <li>If the template is the\n+                    <em>default type</em>\n+                     of a content type\n                                         it is possible to associate the type class or an interface it\n-                                        provides with a ruleset.</li>\n-                                    <li>You can also associate a specific page template (by name) or\n-                                        content type with a ruleset using the options below.</li>\n-                                </ul>\n-                                <p>\n-                                <strong>Note:</strong> By default, folder-like content types are\n-                                associated with the ruleset <code>plone.content.folderView</code>,\n+                    provides with a ruleset.</li>\n+                  <li>You can also associate a specific page template (by name) or\n+                    content type with a ruleset using the options below.</li>\n+                </ul>\n+                <p>\n+                  <strong>Note:</strong>\n+                   By default, folder-like content types are\n+                                associated with the ruleset\n+                  <code>plone.content.folderView</code>,\n                                 and item-like content types are associated with the ruleset\n-                                <code>plone.content.itemView</code>. Any settings entered below or\n+                  <code>plone.content.itemView</code>. Any settings entered below or\n                                 set via an explicit cache ruleset (in a ZCML file) will override these\n                                 defaults.\n-                                </p>\n-                                <p>\n-                                <strong>Note:</strong> You can only use each template name or\n+                </p>\n+                <p>\n+                  <strong>Note:</strong>\n+                   You can only use each template name or\n                                 content type once!\n-                                </p>\n-                            </div>\n-\n-                            <table class="table table-striped table-responsive" id="templateMappingsTable">\n-                                <thead>\n-                                    <tr>\n-                                        <th class="col-6"\n-                                            i18n:translate="heading_ruleset">Ruleset</th>\n-                                        <th class="col-3"\n-                                            i18n:translate="heading_content_types">Content types</th>\n-                                        <th class="col-3"\n-                                            i18n:translate="heading_templates">Templates</th>\n-                                    </tr>\n-                                </thead>\n-                                <tbody>\n-                                    <tal:block repeat="ruleType view/ruleTypes">\n-                                        <tr tal:define="contentTypeError python:errors.get(\'contenttypes\', {}).get(ruleType[\'name\'], None);\n-                                                        templateError    python:errors.get(\'templates\', {}).get(ruleType[\'name\'], None);">\n-                                            <td>\n-                                                <div tal:content="ruleType/title" i18n:translate=""/>\n-                                                <p class="discreet" tal:content="ruleType/description" i18n:translate=""/>\n-                                                <div class="invalid-feedback" tal:condition="python:contentTypeError or templateError">\n-                                                    <div tal:content="contentTypeError" tal:condition="contentTypeError" />\n-                                                    <div tal:content="templateError" tal:condition="templateError" />\n-                                                </div>\n-                                            </td>\n-                                            <td tal:define="selected python:request.get(\'contenttypes\', view.reverseContentTypeMapping).get(ruleType[\'safeName\'], [])">\n-                                                <div class="invalid-feedback" tal:omit-tag="not:contentTypeError">\n-                                                    <select class="form-select"\n-                                                        size="6"\n-                                                        multiple="multiple"\n-                                                        tal:attributes="id   string:contenttypes-${ruleType/name};\n-                                                                        name string:contenttypes.${ruleType/safeName}:record:list;">\n-                                                        <option\n-                                                            tal:repeat="contentType view/contentTypes"\n-                                                            tal:attributes="value    contentType/name;\n-                                                                            title    contentType/description;\n-                                                                            selected python:\'selected\' if contentType[\'name\'] in selected else None;"\n-                                                            tal:content="contentType/title"\n-                                                            i18n:attributes="title" i18n:translate="" />\n-                                                    </select>\n-                                                </div>\n-                                            </td>\n-                                            <td tal:define="selected python:request.get(\'templates\', view.reverseTemplateMapping).get(ruleType[\'safeName\'], \'\')">\n-                                                <div class="invalid-feedback" tal:omit-tag="not:templateError">\n-                                                    <textarea class="form-control"\n-                                                        cols="40" rows="4"\n-                                                        tal:attributes="id   string:templates-${ruleType/name};\n-                                                                        name string:templates.${ruleType/safeName}:record:lines"\n-                                                        tal:content="python:\'\\n\'.join(selected or [])"\n-                                                        ></textarea>\n-                                                </div>\n-                                            </td>\n-                                        </tr>\n-                                    </tal:block>\n-                                </tbody>\n-                            </table>\n+                </p>\n+              </div>\n+\n+              <table class="table table-striped table-responsive"\n+                     id="templateMappingsTable"\n+              >\n+                <thead>\n+                  <tr>\n+                    <th class="col-6"\n+                        i18n:translate="heading_ruleset"\n+                    >Ruleset</th>\n+                    <th class="col-3"\n+                        i18n:translate="heading_content_types"\n+                    >Content types</th>\n+                    <th class="col-3"\n+                        i18n:translate="heading_templates"\n+                    >Templates</th>\n+                  </tr>\n+                </thead>\n+                <tbody>\n+                  <tal:block repeat="ruleType view/ruleTypes">\n+                    <tr tal:define="\n+                          contentTypeError python:errors.get(\'contenttypes\', {}).get(ruleType[\'name\'], None);\n+                          templateError    python:errors.get(\'templates\', {}).get(ruleType[\'name\'], None);\n+                        ">\n+                      <td>\n+                        <div tal:content="ruleType/title"\n+                             i18n:translate=""\n+                        ></div>\n+                        <p class="discreet"\n+                           tal:content="ruleType/description"\n+                           i18n:translate=""\n+                        ></p>\n+                        <div class="invalid-feedback"\n+                             tal:condition="python:contentTypeError or templateError"\n+                        >\n+                          <div tal:condition="contentTypeError"\n+                               tal:content="contentTypeError"\n+                          ></div>\n+                          <div tal:condition="templateError"\n+                               tal:content="templateError"\n+                          ></div>\n                         </div>\n-                    </fieldset>\n-\n-                    <!-- Field set: detailed settings -->\n-                    <fieldset id="fieldset-detailed-settings">\n-                        <legend\n-                            id="fieldsetlegend-detailed-settings"\n-                            i18n:translate="legend_detailed_settings">Detailed settings</legend>\n-\n-                        <div class="discreet" i18n:translate="description_detailed_settings">\n-                            <p>\n+                      </td>\n+                      <td tal:define="\n+                            selected python:request.get(\'contenttypes\', view.reverseContentTypeMapping).get(ruleType[\'safeName\'], []);\n+                          ">\n+                        <div class="invalid-feedback"\n+                             tal:omit-tag="not:contentTypeError"\n+                        >\n+                          <select class="form-select"\n+                                  multiple="multiple"\n+                                  size="6"\n+                                  tal:attributes="\n+                                    id   string:contenttypes-${ruleType/name};\n+                                    name string:contenttypes.${ruleType/safeName}:record:list;\n+                                  "\n+                          >\n+                            <option tal:repeat="contentType view/contentTypes"\n+                                    tal:content="contentType/title"\n+                                    tal:attributes="\n+                                      value    contentType/name;\n+                                      title    contentType/description;\n+                                      selected python:\'selected\' if contentType[\'name\'] in selected else None;\n+                                    "\n+                                    i18n:attributes="title"\n+                                    i18n:translate=""\n+                            ></option>\n+                          </select>\n+                        </div>\n+                      </td>\n+                      <td tal:define="\n+                            selected python:request.get(\'templates\', view.reverseTemplateMapping).get(ruleType[\'safeName\'], \'\');\n+                          ">\n+                        <div class="invalid-feedback"\n+                             tal:omit-tag="not:templateError"\n+                        >\n+                          <textarea class="form-control"\n+                                    cols="40"\n+                                    rows="4"\n+                                    tal:content="python:\'\\n\'.join(selected or [])"\n+                                    tal:attributes="\n+                                      id   string:templates-${ruleType/name};\n+                                      name string:templates.${ruleType/safeName}:record:lines;\n+                                    "\n+                          ></textarea>\n+                        </div>\n+                      </td>\n+                    </tr>\n+                  </tal:block>\n+                </tbody>\n+              </table>\n+            </div>\n+          </fieldset>\n+\n+          <!-- Field set: detailed settings -->\n+          <fieldset id="fieldset-detailed-settings">\n+            <legend id="fieldsetlegend-detailed-settings"\n+                    i18n:translate="legend_detailed_settings"\n+            >Detailed settings</legend>\n+\n+            <div class="discreet"\n+                 i18n:translate="description_detailed_settings"\n+            >\n+              <p>\n                             Many caching operations accept parameters to influence their\n                             behaviour. For example, an operation which returns a page\n                             cached in RAM may accept a parameter specifying the timeout\n@@ -569,128 +802,160 @@\n                             however, will have "sensible defaults", so that  they work\n                             acceptably even when no parameters have been set. Note also\n                             that not all operations support parameters.\n-                            </p>\n-                            <p>\n+              </p>\n+              <p>\n                             Parameters can be set at two levels. By default, parameters\n                             apply to all uses of particular operation. Thus, if you have\n                             assigned an operation to more than one ruleset, the\n-                            <em>same</em> parameters will be used. However, you can also\n+                <em>same</em>\n+                 parameters will be used. However, you can also\n                             override the parameters for a particular ruleset.\n-                            </p>\n-                            <p>\n+              </p>\n+              <p>\n                             Use the table below to access parameters for a particular\n-                            operation or ruleset. <strong>Warning:</strong> If you have\n+                            operation or ruleset.\n+                <strong>Warning:</strong>\n+                 If you have\n                             made changes elsewhere in this form, you should save them\n                             before configuring any operation parameters. Otherwise, you\n                             will lose your changes.\n-                            </p>\n-                        </div>\n-                        <div class="mb-3 field">\n-                            <label class="form-label"\n-                                   i18n:translate="label_operation_parameters">Operation parameters</label>\n-                            <div class="form-text" i18n:translate="help_operation_parameters">\n+              </p>\n+            </div>\n+            <div class="mb-3 field">\n+              <label class="form-label"\n+                     i18n:translate="label_operation_parameters"\n+              >Operation parameters</label>\n+              <div class="form-text"\n+                   i18n:translate="help_operation_parameters"\n+              >\n                                 Use the table below to create, clear and edit operation\n                                 parameters. If you clear the ruleset-specific parameters for\n                                 a given operation, it will fall back on the global operation\n                                 parameters.\n-                            </div>\n-\n-                            <table class="table table-striped table-responsive" id="operationParametersTable">\n-                                <thead>\n-                                    <tr>\n-                                        <th class="col-9"\n-                                            i18n:translate="heading_ruleset">Ruleset</th>\n-                                        <th class="col-3"\n-                                            i18n:translate="heading_operation">Operation</th>\n-                                    </tr>\n-                                </thead>\n-                                <tbody>\n-                                    <tr tal:repeat="ruleType view/ruleTypes">\n-                                        <td>\n-                                            <div class="form-label"\n-                                                 tal:content="ruleType/title" i18n:translate=""/>\n-                                            <p class="form-text"\n-                                               tal:content="ruleType/description" i18n:translate=""/>\n-                                        </td>\n-                                        <td tal:define="operationName python:view.operationMapping.get(ruleType[\'safeName\'], None)">\n-                                            <tal:block condition="not:operationName" i18n:translate="help_not_mapped">\n+              </div>\n+\n+              <table class="table table-striped table-responsive"\n+                     id="operationParametersTable"\n+              >\n+                <thead>\n+                  <tr>\n+                    <th class="col-9"\n+                        i18n:translate="heading_ruleset"\n+                    >Ruleset</th>\n+                    <th class="col-3"\n+                        i18n:translate="heading_operation"\n+                    >Operation</th>\n+                  </tr>\n+                </thead>\n+                <tbody>\n+                  <tr tal:repeat="ruleType view/ruleTypes">\n+                    <td>\n+                      <div class="form-label"\n+                           tal:content="ruleType/title"\n+                           i18n:translate=""\n+                      ></div>\n+                      <p class="form-text"\n+                         tal:content="ruleType/description"\n+                         i18n:translate=""\n+                      ></p>\n+                    </td>\n+                    <td tal:define="\n+                          operationName python:view.operationMapping.get(ruleType[\'safeName\'], None);\n+                        ">\n+                      <tal:block condition="not:operationName"\n+                                 i18n:translate="help_not_mapped"\n+                      >\n                                                 Not mapped\n-                                            </tal:block>\n-                                            <tal:block condition="operationName">\n-                                                <tal:block\n-                                                    define="operationInfo python:view.operationTypesLookup.get(operationName, None)"\n-                                                    condition="operationInfo">\n-                                                    <div tal:content="operationInfo/title" />\n-                                                    <div\n-                                                        class="discreet"\n-                                                        tal:condition="not:operationInfo/hasOptions"\n-                                                        i18n:translate="help_no_options">\n+                      </tal:block>\n+                      <tal:block condition="operationName">\n+                        <tal:block define="\n+                                     operationInfo python:view.operationTypesLookup.get(operationName, None);\n+                                   "\n+                                   condition="operationInfo"\n+                        >\n+                          <div tal:content="operationInfo/title"></div>\n+                          <div class="discreet"\n+                               tal:condition="not:operationInfo/hasOptions"\n+                               i18n:translate="help_no_options"\n+                          >\n                                                         No parameters\n-                                                    </div>\n-                                                    <div style="white-space: nowrap" class="discreet rulesetParameterLink" tal:condition="operationInfo/hasOptions">\n-                                                        <a  class="editGlobalOperationParameters pat-plone-modal"\n-                                                            data-pat-plone-modal=\'{"actionOptions": {"disableAjaxFormSubmit":true}}\'\n-                                                            i18n:translate="link_view_edit"\n-                                                            tal:attributes="href string:${context/absolute_url}/@@${view/__name__}/edit-operation-global/${operationName}"\n-                                                            >View/edit</a>\n-                                                        <span i18n:translate="label_global">global parameters</span>\n-                                                    </div>\n-                                                    <div style="white-space: nowrap" class="discreet rulesetParameterLink"  tal:condition="operationInfo/hasOptions">\n-                                                        <tal:block define="hasRulesetOptions python:view.hasRulesetOptions(operationInfo[\'type\'], ruleType[\'name\'])">\n-                                                            <a  class="editRulesetOperationParameters pat-plone-modal"\n-                                                                data-pat-plone-modal=\'{"actionOptions": {"disableAjaxFormSubmit":true}}\'\n-                                                                tal:condition="hasRulesetOptions"\n-                                                                i18n:translate="link_view_edit_clear"\n-                                                                tal:attributes="href string:${context/absolute_url}/@@${view/__name__}/edit-operation-ruleset/${operationName}/${ruleType/name}"\n-                                                                >View/edit/clear</a>\n-                                                            <a  class="editRulesetOperationParameters pat-plone-modal"\n-                                                                data-pat-plone-modal=\'{"actionOptions": {"disableAjaxFormSubmit":true}}\'\n-                                                                tal:condition="not:hasRulesetOptions"\n-                                                                i18n:translate="link_create"\n-                                                                tal:attributes="href string:${context/absolute_url}/@@${view/__name__}/edit-operation-ruleset/${operationName}/${ruleType/name}"\n-                                                                >Create</a>\n-                                                        </tal:block>\n-                                                        <span i18n:translate="label_ruleset">per-ruleset parameters</span>\n-                                                    </div>\n-                                                </tal:block>\n-                                            </tal:block>\n-                                        </td>\n-                                    </tr>\n-                                </tbody>\n-                            </table>\n-                        </div>\n+                          </div>\n+                          <div class="discreet rulesetParameterLink"\n+                               style="white-space: nowrap"\n+                               tal:condition="operationInfo/hasOptions"\n+                          >\n+                            <a class="editGlobalOperationParameters pat-plone-modal"\n+                               data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n+                               tal:attributes="\n+                                 href string:${context/absolute_url}/@@${view/__name__}/edit-operation-global/${operationName};\n+                               "\n+                               i18n:translate="link_view_edit"\n+                            >View/edit</a>\n+                            <span i18n:translate="label_global">global parameters</span>\n+                          </div>\n+                          <div class="discreet rulesetParameterLink"\n+                               style="white-space: nowrap"\n+                               tal:condition="operationInfo/hasOptions"\n+                          >\n+                            <tal:block define="\n+                                         hasRulesetOptions python:view.hasRulesetOptions(operationInfo[\'type\'], ruleType[\'name\']);\n+                                       ">\n+                              <a class="editRulesetOperationParameters pat-plone-modal"\n+                                 data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n+                                 tal:condition="hasRulesetOptions"\n+                                 tal:attributes="\n+                                   href string:${context/absolute_url}/@@${view/__name__}/edit-operation-ruleset/${operationName}/${ruleType/name};\n+                                 "\n+                                 i18n:translate="link_view_edit_clear"\n+                              >View/edit/clear</a>\n+                              <a class="editRulesetOperationParameters pat-plone-modal"\n+                                 data-pat-plone-modal="{\'actionOptions\': {\'disableAjaxFormSubmit\':true}}"\n+                                 tal:condition="not:hasRulesetOptions"\n+                                 tal:attributes="\n+                                   href string:${context/absolute_url}/@@${view/__name__}/edit-operation-ruleset/${operationName}/${ruleType/name};\n+                                 "\n+                                 i18n:translate="link_create"\n+                              >Create</a>\n+                            </tal:block>\n+                            <span i18n:translate="label_ruleset">per-ruleset parameters</span>\n+                          </div>\n+                        </tal:block>\n+                      </tal:block>\n+                    </td>\n+                  </tr>\n+                </tbody>\n+              </table>\n+            </div>\n \n-                    </fieldset>\n+          </fieldset>\n \n-                    <div class="formControls">\n-                        <button\n-                            type="submit"\n-                            name="form.button.Save"\n-                            class="btn btn-primary"\n-                            value="Save"\n-                            i18n:attributes="value"\n-                            i18n:translate=""\n-                        >\n+          <div class="formControls">\n+            <button class="btn btn-primary"\n+                    name="form.button.Save"\n+                    type="submit"\n+                    value="Save"\n+                    i18n:attributes="value"\n+                    i18n:translate=""\n+            >\n                             Save\n-                        </button>\n-\n-                        <button\n-                            type="submit"\n-                            name="form.button.Cancel"\n-                            class="btn btn-secondary"\n-                            value="Cancel"\n-                            i18n:attributes="value"\n-                            i18n:translate=""\n-                        >\n+            </button>\n+\n+            <button class="btn btn-secondary"\n+                    name="form.button.Cancel"\n+                    type="submit"\n+                    value="Cancel"\n+                    i18n:attributes="value"\n+                    i18n:translate=""\n+            >\n                             Cancel\n-                        </button>\n+            </button>\n \n-                    </div>\n+          </div>\n \n-                    <input tal:replace="structure context/@@authenticator/authenticator" />\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-                </form>\n-            </div>\n-        </div>\n-</body>\n+        </form>\n+      </div>\n+    </div>\n+  </body>\n </html>\ndiff --git a/plone/app/caching/browser/controlpanel.py b/plone/app/caching/browser/controlpanel.py\nindex c7415a0..a79fa3a 100644\n--- a/plone/app/caching/browser/controlpanel.py\n+++ b/plone/app/caching/browser/controlpanel.py\n@@ -110,7 +110,6 @@ def publishTraverse(self, request, name):\n             self.editOperationName = name\n \n             if self.editGlobal:\n-\n                 operation = queryUtility(\n                     ICachingOperationType, name=self.editOperationName\n                 )\n@@ -163,7 +162,6 @@ def update(self):\n                 )\n \n     def processSave(self):\n-\n         form = self.request.form\n \n         # Form data\n@@ -215,7 +213,10 @@ def processSave(self):\n                         contentType,\n                     )\n                     error_ruleset = contentTypeRulesetMapping[contentType]\n-                    self.errors.setdefault("contenttypes", {},)[ruleset] = _(\n+                    self.errors.setdefault(\n+                        "contenttypes",\n+                        {},\n+                    )[ruleset] = _(\n                         "Content type ${error_content_type} is already mapped to "\n                         "the rule ${ruleset}.",\n                         mapping={\n@@ -237,7 +238,10 @@ def processSave(self):\n                     continue\n \n                 if template in templateRulesetMapping:\n-                    self.errors.setdefault("templates", {},)[ruleset] = _(\n+                    self.errors.setdefault(\n+                        "templates",\n+                        {},\n+                    )[ruleset] = _(\n                         "Template ${template} is already mapped to the rule "\n                         "${ruleset}.",\n                         mapping={\n@@ -630,7 +634,6 @@ def update(self):\n                 self.processPurge()\n \n     def processPurge(self):\n-\n         if self.ramCache is None:\n             IStatusMessage(self.request).addStatusMessage(\n                 _("RAM cache not installed."), "error"\ndiff --git a/plone/app/caching/browser/edit.pt b/plone/app/caching/browser/edit.pt\nindex 77667c5..96926da 100644\n--- a/plone/app/caching/browser/edit.pt\n+++ b/plone/app/caching/browser/edit.pt\n@@ -1,20 +1,24 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n-<metal:block fill-slot="prefs_configlet_main">\n+  <body>\n+    <metal:block fill-slot="prefs_configlet_main">\n \n-    <h1 class="documentFirstHeading" tal:content="view/title">View Title</h1>\n+      <h1 class="documentFirstHeading"\n+          tal:content="view/title"\n+      >View Title</h1>\n \n-    <div id="content-core">\n+      <div id="content-core">\n         <metal:block use-macro="context/@@ploneform-macros/titlelessform" />\n-    </div>\n+      </div>\n \n-</metal:block>\n-</body>\n+    </metal:block>\n+  </body>\n </html>\ndiff --git a/plone/app/caching/browser/edit.py b/plone/app/caching/browser/edit.py\nindex da3bf84..b667df8 100644\n--- a/plone/app/caching/browser/edit.py\n+++ b/plone/app/caching/browser/edit.py\n@@ -75,7 +75,6 @@ def __init__(\n         self.ruleset = ruleset\n \n     def update(self):\n-\n         self.registry = getUtility(IRegistry)\n \n         # If we were using plone.z3cform, this would be done with\n@@ -170,10 +169,8 @@ def applyChanges(self, data):\n         """Save changes in the given data dictionary to the registry."""\n \n         for key, value in data.items():\n-\n             # Lazily create per-ruleset records if necessary\n             if key not in self.registry.records:\n-\n                 # This should only ever happen if we have a not-yet-creted\n                 # ruleset-specific record\n                 assert self.rulesetName in key\n@@ -195,7 +192,6 @@ def applyChanges(self, data):\n                 self.registry[key] = value\n \n     def cloneField(self, field):\n-\n         # XXX: The field may sometimes not have data for reasons known only\n         # to Jim.\n         try:\ndiff --git a/plone/app/caching/browser/import.pt b/plone/app/caching/browser/import.pt\nindex 7a672b4..03d6982 100644\n--- a/plone/app/caching/browser/import.pt\n+++ b/plone/app/caching/browser/import.pt\n@@ -1,136 +1,181 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n-\n-<body>\n-\n-<div metal:fill-slot="prefs_configlet_main">\n-\n-            <div class="autotabs">\n-                <ul class="nav nav-tabs">\n-                    <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel"\n-                           i18n:translate="label_settings">Change settings</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link active"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-import"\n-                           i18n:translate="label_import">Import settings</a>\n-                      </li>\n-                      <li tal:condition="view/purgingEnabled" class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-purge"\n-                           i18n:translate="label_purging">Purge caching proxy</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-ramcache"\n-                           i18n:translate="label_ramcache">RAM cache</a>\n-                      </li>\n-                </ul>\n-            </div>\n-\n-            <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+\n+  <body>\n+\n+    <div metal:fill-slot="prefs_configlet_main">\n+\n+      <div class="autotabs">\n+        <ul class="nav nav-tabs">\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel;\n+               "\n+               i18n:translate="label_settings"\n+            >Change settings</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link active"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-import;\n+               "\n+               i18n:translate="label_import"\n+            >Import settings</a>\n+          </li>\n+          <li class="nav-item"\n+              tal:condition="view/purgingEnabled"\n+          >\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-purge;\n+               "\n+               i18n:translate="label_purging"\n+            >Purge caching proxy</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-ramcache;\n+               "\n+               i18n:translate="label_ramcache"\n+            >RAM cache</a>\n+          </li>\n+        </ul>\n+      </div>\n+\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n             Portal status message\n-            </div>\n+      </div>\n \n-            <div class="configlet">\n+      <div class="configlet">\n \n-                <h1 class="documentFirstHeading"\n-                    i18n:translate="heading_caching_import">Import caching profiles</h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="heading_caching_import"\n+        >Import caching profiles</h1>\n \n-                <a id="setup-link" class="link-parent"\n-                    tal:attributes="href string:${portal_url}/@@overview-controlpanel"\n-                    i18n:translate="label_up_to_plone_setup">\n+        <a class="link-parent"\n+           id="setup-link"\n+           tal:attributes="\n+             href string:${portal_url}/@@overview-controlpanel;\n+           "\n+           i18n:translate="label_up_to_plone_setup"\n+        >\n                         Up to Site Setup\n-                </a>\n+        </a>\n \n-                <p class="form-text"\n-                    i18n:translate="description_caching_ipmort">\n+        <p class="form-text"\n+           i18n:translate="description_caching_ipmort"\n+        >\n                     Choose a profile below to import cache settings. Additional\n                     profiles may be installed by third party products.\n-                    <strong>Warning:</strong> This may overwrite existing\n+          <strong>Warning:</strong>\n+           This may overwrite existing\n                     settings.\n-                </p>\n-\n-                <form name="profiles" tal:attributes="action request/URL" method="post"\n-                    class="pat-formunloadalert"\n-                    tal:define="errors view/errors">\n-\n-                    <div class="mb-3 field form-check ${python:\'error\' if errors else \'\'}">\n-\n-                        <div\n-                            class="invalid-feedback"\n-                            tal:condition="errors/profile | nothing"\n-                            tal:content="errors/profile"\n-                            />\n-\n-                        <div tal:repeat="profile view/profiles">\n-\n-                            <input class="form-check-input"\n-                                type="radio"\n-                                name="profile"\n-                                tal:attributes="id string:profile-${repeat/profile/index};\n-                                                value profile/id"\n-                                />\n-\n-                            <label class="form-check-label"\n-                                tal:attributes="for string:profile-${repeat/profile/index}"\n-                                tal:content="profile/title" i18n:translate=""\n-                                />\n-\n-                            <p class="discreet" tal:content="profile/description" i18n:translate=""/>\n-\n-                        </div>\n-                    </div>\n-\n-                    <div class="field">\n-                        <input type="hidden" name="snapshot:boolean:default" value="" />\n-                        <input\n-                            type="checkbox"\n-                            name="snapshot:boolean"\n-                            id="snapshot"\n-                            value="1"\n-                            tal:attributes="checked python:\'checked\' if request.get(\'snapshot\', True) else None"\n-                            />\n-\n-                        <label for="snapshot" i18n:translate="label_snapshot">\n+        </p>\n+\n+        <form class="pat-formunloadalert"\n+              method="post"\n+              name="profiles"\n+              tal:define="\n+                errors view/errors;\n+              "\n+              tal:attributes="\n+                action request/URL;\n+              "\n+        >\n+\n+          <div class="mb-3 field form-check ${python:\'error\' if errors else \'\'}">\n+\n+            <div class="invalid-feedback"\n+                 tal:condition="errors/profile | nothing"\n+                 tal:content="errors/profile"\n+            ></div>\n+\n+            <div tal:repeat="profile view/profiles">\n+\n+              <input class="form-check-input"\n+                     name="profile"\n+                     type="radio"\n+                     tal:attributes="\n+                       id string:profile-${repeat/profile/index};\n+                       value profile/id;\n+                     "\n+              />\n+\n+              <label class="form-check-label"\n+                     tal:content="profile/title"\n+                     tal:attributes="\n+                       for string:profile-${repeat/profile/index};\n+                     "\n+                     i18n:translate=""\n+              ></label>\n+\n+              <p class="discreet"\n+                 tal:content="profile/description"\n+                 i18n:translate=""\n+              ></p>\n+\n+            </div>\n+          </div>\n+\n+          <div class="field">\n+            <input name="snapshot:boolean:default"\n+                   type="hidden"\n+                   value=""\n+            />\n+            <input id="snapshot"\n+                   name="snapshot:boolean"\n+                   type="checkbox"\n+                   value="1"\n+                   tal:attributes="\n+                     checked python:\'checked\' if request.get(\'snapshot\', True) else None;\n+                   "\n+            />\n+\n+            <label for="snapshot"\n+                   i18n:translate="label_snapshot"\n+            >\n                             Take a snapshot of the site prior to importing new\n                             setting.\n-                        </label>\n-                        <div class="formHelp" i18n:translate="help_snapshot">\n+            </label>\n+            <div class="formHelp"\n+                 i18n:translate="help_snapshot"\n+            >\n                             This allows rollback to a previous state via the\n-                            <em>portal_setup</em> tool.\n-                        </div>\n-                    </div>\n-\n-                    <div class="formControls">\n-                        <button\n-                            class="btn btn-primary"\n-                            type="submit"\n-                            name="form.button.Import"\n-                            value="Import"\n-                            i18n:attributes="value"\n-                            i18n:translate=""\n-                        >\n+              <em>portal_setup</em>\n+               tool.\n+            </div>\n+          </div>\n+\n+          <div class="formControls">\n+            <button class="btn btn-primary"\n+                    name="form.button.Import"\n+                    type="submit"\n+                    value="Import"\n+                    i18n:attributes="value"\n+                    i18n:translate=""\n+            >\n                             Import\n-                        </button>\n-                    </div>\n+            </button>\n+          </div>\n \n-                    <input tal:replace="structure context/@@authenticator/authenticator" />\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-                </form>\n-            </div>\n+        </form>\n+      </div>\n     </div>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/caching/browser/purge.pt b/plone/app/caching/browser/purge.pt\nindex decbe3d..4bf8ef4 100644\n--- a/plone/app/caching/browser/purge.pt\n+++ b/plone/app/caching/browser/purge.pt\n@@ -1,145 +1,198 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n-\n-<body>\n-\n-<div metal:fill-slot="prefs_configlet_main">\n-\n-            <div class="autotabs">\n-                <ul class="nav nav-tabs">\n-                    <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel"\n-                           i18n:translate="label_settings">Change settings</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-import"\n-                           i18n:translate="label_import">Import settings</a>\n-                      </li>\n-                      <li tal:condition="view/purgingEnabled" class="nav-item">\n-                        <a class="nav-link active"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-purge"\n-                           i18n:translate="label_purging">Purge caching proxy</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-ramcache"\n-                           i18n:translate="label_ramcache">RAM cache</a>\n-                      </li>\n-                </ul>\n-            </div>\n-\n-            <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+\n+  <body>\n+\n+    <div metal:fill-slot="prefs_configlet_main">\n+\n+      <div class="autotabs">\n+        <ul class="nav nav-tabs">\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel;\n+               "\n+               i18n:translate="label_settings"\n+            >Change settings</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-import;\n+               "\n+               i18n:translate="label_import"\n+            >Import settings</a>\n+          </li>\n+          <li class="nav-item"\n+              tal:condition="view/purgingEnabled"\n+          >\n+            <a class="nav-link active"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-purge;\n+               "\n+               i18n:translate="label_purging"\n+            >Purge caching proxy</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-ramcache;\n+               "\n+               i18n:translate="label_ramcache"\n+            >RAM cache</a>\n+          </li>\n+        </ul>\n+      </div>\n+\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n             Portal status message\n-            </div>\n+      </div>\n \n-            <div class="configlet">\n+      <div class="configlet">\n \n-                <h1 class="documentFirstHeading"\n-                    i18n:translate="heading_caching_purging">Purge caching proxy</h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="heading_caching_purging"\n+        >Purge caching proxy</h1>\n \n-                <a id="setup-link" class="link-parent"\n-                    tal:attributes="href string:${portal_url}/@@overview-controlpanel"\n-                    i18n:translate="label_up_to_plone_setup">\n+        <a class="link-parent"\n+           id="setup-link"\n+           tal:attributes="\n+             href string:${portal_url}/@@overview-controlpanel;\n+           "\n+           i18n:translate="label_up_to_plone_setup"\n+        >\n                         Up to Site Setup\n-                </a>\n+        </a>\n \n-                <p class="form-text"\n-                    i18n:translate="description_cache_purging">\n+        <p class="form-text"\n+           i18n:translate="description_cache_purging"\n+        >\n                     If you have enabled a caching proxy, it may end up caching\n                     objects which are no longer current. Plone will attempt\n                     to automatically purge objects when they change, but if\n                     you are seeing stale objects in your cache, you can purge\n                     them manually below.\n-                </p>\n-\n-                <div class="alert alert-info"\n-                     tal:condition="view/purgeLog | nothing">\n-                    <strong i18n:translate="heading_purged">Status</strong>\n-                    <span tal:omit-tag="" i18n:translate="description_purged">\n+        </p>\n+\n+        <div class="alert alert-info"\n+             tal:condition="view/purgeLog | nothing"\n+        >\n+          <strong i18n:translate="heading_purged">Status</strong>\n+          <span tal:omit-tag=""\n+                i18n:translate="description_purged"\n+          >\n                         The following items were purged:\n-                    </span>\n-                    <ul>\n-                      <li tal:repeat="log view/purgeLog" tal:content="log" />\n-                    </ul>\n-                </div>\n-\n-                <form name="purge" tal:attributes="action string:${request/URL}" method="post"\n-                    class="pat-formunloadalert"\n-                    tal:define="errors view/errors">\n-\n-                    <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n-                         tal:define="error errors/urls | nothing"\n-                    >\n-\n-                        <label class="form-label"\n-                               for="purgeURLs" i18n:translate="label_urls">URLs to purge</label>\n-\n-\n-                        <div class="invalid-feedback"\n-                             tal:content="error" tal:condition="error" />\n-\n-                        <textarea class="form-control"\n-                                  id="purgeURLs" name="urls:lines" cols="40" rows="4"></textarea>\n-\n-                        <div class="form-text" i18n:translate="help_urls">\n+          </span>\n+          <ul>\n+            <li tal:repeat="log view/purgeLog"\n+                tal:content="log"\n+            ></li>\n+          </ul>\n+        </div>\n+\n+        <form class="pat-formunloadalert"\n+              method="post"\n+              name="purge"\n+              tal:define="\n+                errors view/errors;\n+              "\n+              tal:attributes="\n+                action string:${request/URL};\n+              "\n+        >\n+\n+          <div class="mb-3 field ${python:\'error\' if error else \'\'}"\n+               tal:define="\n+                 error errors/urls | nothing;\n+               "\n+          >\n+\n+            <label class="form-label"\n+                   for="purgeURLs"\n+                   i18n:translate="label_urls"\n+            >URLs to purge</label>\n+\n+\n+            <div class="invalid-feedback"\n+                 tal:condition="error"\n+                 tal:content="error"\n+            ></div>\n+\n+            <textarea class="form-control"\n+                      id="purgeURLs"\n+                      cols="40"\n+                      name="urls:lines"\n+                      rows="4"\n+            ></textarea>\n+\n+            <div class="form-text"\n+                 i18n:translate="help_urls"\n+            >\n                             Enter URLs to purge, one per line, below. You can\n                             either enter a full URL including a domain, or a path\n-                            relative to the site root, starting with a <em>/</em>.\n-                        </div>\n-                    </div>\n-\n-                    <div class="mb-3 field form-check">\n-                        <input type="hidden" name="synchronous:boolean:default" value="" />\n-                        <input class="form-check-input"\n-                            type="checkbox"\n-                            name="synchronous:boolean"\n-                            id="purgeSynchronous"\n-                            value="1"\n-                            checked="checked"\n-                            />\n-\n-                        <label class="form-check-label"\n-                               for="purgeSynchronous" i18n:translate="label_synchronous">\n+                            relative to the site root, starting with a\n+              <em>/</em>.\n+            </div>\n+          </div>\n+\n+          <div class="mb-3 field form-check">\n+            <input name="synchronous:boolean:default"\n+                   type="hidden"\n+                   value=""\n+            />\n+            <input class="form-check-input"\n+                   id="purgeSynchronous"\n+                   checked="checked"\n+                   name="synchronous:boolean"\n+                   type="checkbox"\n+                   value="1"\n+            />\n+\n+            <label class="form-check-label"\n+                   for="purgeSynchronous"\n+                   i18n:translate="label_synchronous"\n+            >\n                             Purge synchronously\n-                        </label>\n-                        <div class="form-text" i18n:translate="help_synchronous">\n+            </label>\n+            <div class="form-text"\n+                 i18n:translate="help_synchronous"\n+            >\n                             Select this option to wait while the purge completes.\n                             This allows you to see the results of the purges.\n                             Purging asynchronously will return immediately, but\n                             you will need to check your caching proxy\'s log files\n                             to see if the purge actually succeeded.\n-                        </div>\n-                    </div>\n-\n-                    <div class="formControls">\n-                        <button\n-                            type="submit"\n-                            name="form.button.Purge"\n-                            class="btn btn-primary"\n-                            value="Purge"\n-                            i18n:attributes="value"\n-                            i18n:translate=""\n-                        >\n+            </div>\n+          </div>\n+\n+          <div class="formControls">\n+            <button class="btn btn-primary"\n+                    name="form.button.Purge"\n+                    type="submit"\n+                    value="Purge"\n+                    i18n:attributes="value"\n+                    i18n:translate=""\n+            >\n                             Purge\n-                        </button>\n-                    </div>\n+            </button>\n+          </div>\n \n-                    <input tal:replace="structure context/@@authenticator/authenticator" />\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-                </form>\n-            </div>\n+        </form>\n+      </div>\n \n-</div>\n-</body>\n+    </div>\n+  </body>\n </html>\ndiff --git a/plone/app/caching/browser/ramcache.pt b/plone/app/caching/browser/ramcache.pt\nindex 18147b8..bc1813d 100644\n--- a/plone/app/caching/browser/ramcache.pt\n+++ b/plone/app/caching/browser/ramcache.pt\n@@ -1,110 +1,143 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<div metal:fill-slot="prefs_configlet_main">\n+    <div metal:fill-slot="prefs_configlet_main">\n \n-            <div class="autotabs">\n-                <ul class="nav nav-tabs">\n-                    <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel"\n-                           i18n:translate="label_settings">Change settings</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-import"\n-                           i18n:translate="label_import">Import settings</a>\n-                      </li>\n-                      <li tal:condition="view/purgingEnabled" class="nav-item">\n-                        <a class="nav-link"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-purge"\n-                           i18n:translate="label_purging">Purge caching proxy</a>\n-                      </li>\n-                      <li class="nav-item">\n-                        <a class="nav-link active"\n-                           href=""\n-                           tal:attributes="href string:${portal_url}/@@caching-controlpanel-ramcache"\n-                           i18n:translate="label_ramcache">RAM cache</a>\n-                      </li>\n-                </ul>\n-            </div>\n+      <div class="autotabs">\n+        <ul class="nav nav-tabs">\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel;\n+               "\n+               i18n:translate="label_settings"\n+            >Change settings</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-import;\n+               "\n+               i18n:translate="label_import"\n+            >Import settings</a>\n+          </li>\n+          <li class="nav-item"\n+              tal:condition="view/purgingEnabled"\n+          >\n+            <a class="nav-link"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-purge;\n+               "\n+               i18n:translate="label_purging"\n+            >Purge caching proxy</a>\n+          </li>\n+          <li class="nav-item">\n+            <a class="nav-link active"\n+               href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@caching-controlpanel-ramcache;\n+               "\n+               i18n:translate="label_ramcache"\n+            >RAM cache</a>\n+          </li>\n+        </ul>\n+      </div>\n \n-            <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n             Portal status message\n-            </div>\n+      </div>\n \n-            <div class="configlet">\n+      <div class="configlet">\n \n-                <h1 class="documentFirstHeading"\n-                    i18n:translate="heading_ramcache_stats">RAM cache statistics</h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="heading_ramcache_stats"\n+        >RAM cache statistics</h1>\n \n-                <a id="setup-link" class="link-parent"\n-                    tal:attributes="href string:${portal_url}/@@overview-controlpanel"\n-                    i18n:translate="label_up_to_plone_setup">\n+        <a class="link-parent"\n+           id="setup-link"\n+           tal:attributes="\n+             href string:${portal_url}/@@overview-controlpanel;\n+           "\n+           i18n:translate="label_up_to_plone_setup"\n+        >\n                         Up to Site Setup\n-                </a>\n+        </a>\n \n-                <p class="form-text"\n-                    i18n:translate="description_ramcache_stats">\n+        <p class="form-text"\n+           i18n:translate="description_ramcache_stats"\n+        >\n                     The table below shows statistics for the default RAM\n-                    cache. You can use the <em>Purge</em> button to manually\n+                    cache. You can use the\n+          <em>Purge</em>\n+           button to manually\n                     clear the cache if you suspect there are stale items there.\n-                </p>\n+        </p>\n \n-                <form name="purge" tal:attributes="action string:${request/URL}" method="post"\n-                    class="pat-formunloadalert"\n-                    tal:define="errors view/errors">\n+        <form class="pat-formunloadalert"\n+              method="post"\n+              name="purge"\n+              tal:define="\n+                errors view/errors;\n+              "\n+              tal:attributes="\n+                action string:${request/URL};\n+              "\n+        >\n \n-                  <table class="table table-striped table-responsive"\n-                         tal:define="stats view/ramCache/getStatistics"\n-                         summary="RAM cache statistics"\n-                         i18n:attributes="summary heading_ramcache_stats;">\n-                    <thead>\n-                      <th i18n:translate="label_cache_key">Key</th>\n-                      <th i18n:translate="label_cache_hits">Hits</th>\n-                      <th i18n:translate="label_cache_misses">Misses</th>\n-                      <th i18n:translate="label_cache_size_bytes">Size (bytes)</th>\n-                      <th i18n:translate="label_cache_entries">Entries</th>\n-                    </thead>\n-                    <tbody>\n-                      <tr tal:repeat="data stats">\n-                        <td><span tal:content="data/path">&nbsp;</span></td>\n-                        <td><span tal:content="data/hits">&nbsp;</span></td>\n-                        <td><span tal:content="data/misses">&nbsp;</span></td>\n-                        <td><span tal:content="data/size">&nbsp;</span></td>\n-                        <td><span tal:content="data/entries">&nbsp;</span></td>\n-                      </tr>\n-                    </tbody>\n-                  </table>\n+          <table class="table table-striped table-responsive"\n+                 summary="RAM cache statistics"\n+                 tal:define="\n+                   stats view/ramCache/getStatistics;\n+                 "\n+                 i18n:attributes="summary heading_ramcache_stats;"\n+          >\n+            <thead>\n+              <th i18n:translate="label_cache_key">Key</th>\n+              <th i18n:translate="label_cache_hits">Hits</th>\n+              <th i18n:translate="label_cache_misses">Misses</th>\n+              <th i18n:translate="label_cache_size_bytes">Size (bytes)</th>\n+              <th i18n:translate="label_cache_entries">Entries</th>\n+            </thead>\n+            <tbody>\n+              <tr tal:repeat="data stats">\n+                <td><span tal:content="data/path">&nbsp;</span></td>\n+                <td><span tal:content="data/hits">&nbsp;</span></td>\n+                <td><span tal:content="data/misses">&nbsp;</span></td>\n+                <td><span tal:content="data/size">&nbsp;</span></td>\n+                <td><span tal:content="data/entries">&nbsp;</span></td>\n+              </tr>\n+            </tbody>\n+          </table>\n \n-                    <div class="formControls">\n-                        <button\n-                            class="btn btn-primary"\n-                            type="submit"\n-                            name="form.button.Purge"\n-                            value="Purge"\n-                            i18n:attributes="value"\n-                            i18n:translate=""\n-                        >\n+          <div class="formControls">\n+            <button class="btn btn-primary"\n+                    name="form.button.Purge"\n+                    type="submit"\n+                    value="Purge"\n+                    i18n:attributes="value"\n+                    i18n:translate=""\n+            >\n                           Purge\n-                        </button>\n-                    </div>\n+            </button>\n+          </div>\n \n-                    <input tal:replace="structure context/@@authenticator/authenticator" />\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-                </form>\n-            </div>\n+        </form>\n+      </div>\n \n-</div>\n-</body>\n+    </div>\n+  </body>\n </html>\ndiff --git a/plone/app/caching/lookup.py b/plone/app/caching/lookup.py\nindex 1c2ae31..d19402c 100644\n--- a/plone/app/caching/lookup.py\n+++ b/plone/app/caching/lookup.py\n@@ -54,7 +54,6 @@ def __init__(self, published, request):\n         self.request = request\n \n     def __call__(self):\n-\n         # 1. Attempt to look up a ruleset using the default lookup\n         ruleset = lookup(self.published)\n         if ruleset is not None:\ndiff --git a/plone/app/caching/operations/utils.py b/plone/app/caching/operations/utils.py\nindex c5a6091..7821b49 100644\n--- a/plone/app/caching/operations/utils.py\n+++ b/plone/app/caching/operations/utils.py\n@@ -399,7 +399,6 @@ def isModified(request, etag=None, lastModified=None):\n \n     # Check the modification date\n     if ifModifiedSince and lastModified is not None:\n-\n         # Attempt to get a date\n \n         ifModifiedSince = ifModifiedSince.split(";")[0]\ndiff --git a/plone/app/caching/purge.py b/plone/app/caching/purge.py\nindex 40d8154..dbfe0ca 100644\n--- a/plone/app/caching/purge.py\n+++ b/plone/app/caching/purge.py\n@@ -160,7 +160,6 @@ def getAbsolutePaths(self):\n \n     @memoize\n     def _getRoot(self):\n-\n         plone_utils = getToolByName(self.context, "plone_utils", None)\n         if plone_utils is None:\n             return\ndiff --git a/plone/app/caching/setuphandlers.py b/plone/app/caching/setuphandlers.py\nindex 0ef14b5..6029e58 100644\n--- a/plone/app/caching/setuphandlers.py\n+++ b/plone/app/caching/setuphandlers.py\n@@ -13,7 +13,6 @@ def enableExplicitMode():\n \n \n def importVarious(context):\n-\n     if not context.readDataFile("plone.app.caching.txt"):\n         return\n \ndiff --git a/plone/app/caching/testing.py b/plone/app/caching/testing.py\nindex f474824..f9608c4 100644\n--- a/plone/app/caching/testing.py\n+++ b/plone/app/caching/testing.py\n@@ -37,7 +37,6 @@ def stopThreads(self, wait=False):\n \n class PloneAppCachingBase(PloneSandboxLayer):\n     def setUpZope(self, app, configurationContext):\n-\n         # Load ZCML\n         import plone.app.caching\n \n@@ -57,7 +56,6 @@ def tearDownZope(self, app):\n \n \n class PloneAppCaching(PloneAppCachingBase):\n-\n     defaultBases = (PLONE_APP_CONTENTTYPES_FIXTURE,)\n \n \ndiff --git a/plone/app/caching/tests/test_etags.py b/plone/app/caching/tests/test_etags.py\nindex 986b4b0..83e281d 100644\n--- a/plone/app/caching/tests/test_etags.py\n+++ b/plone/app/caching/tests/test_etags.py\n@@ -31,7 +31,6 @@ def __init__(self, parent=None):\n \n \n class TestETags(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/caching/tests/test_integration.py b/plone/app/caching/tests/test_integration.py\nindex 10d134f..7e00036 100644\n--- a/plone/app/caching/tests/test_integration.py\n+++ b/plone/app/caching/tests/test_integration.py\n@@ -175,7 +175,6 @@ def test_disabled(self):\n         # self.assertTrue(\'Cache-Control\' in browser.headers)\n \n     def test_auto_purge_content_types(self):\n-\n         setRoles(self.portal, TEST_USER_ID, ("Manager",))\n \n         # Non-folder content\ndiff --git a/plone/app/caching/tests/test_lastmodified.py b/plone/app/caching/tests/test_lastmodified.py\nindex bcd4f29..a67a6c0 100644\n--- a/plone/app/caching/tests/test_lastmodified.py\n+++ b/plone/app/caching/tests/test_lastmodified.py\n@@ -24,7 +24,6 @@ def register(self, object):\n \n \n class TestLastModified(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -148,7 +147,6 @@ def test_CatalogableDublinCoreLastModified(self):\n \n         @implementer(ICatalogableDublinCore)\n         class Dummy:\n-\n             _mod = None\n \n             def modified(self):\n@@ -172,7 +170,6 @@ def test_DCTimesLastModified(self):\n \n         @implementer(IDCTimes)\n         class Dummy:\n-\n             _mod = None\n \n             @property\ndiff --git a/plone/app/caching/tests/test_lookup.py b/plone/app/caching/tests/test_lookup.py\nindex 9f8a2ec..5c46781 100644\n--- a/plone/app/caching/tests/test_lookup.py\n+++ b/plone/app/caching/tests/test_lookup.py\n@@ -76,7 +76,6 @@ class DummyView(BrowserView):\n \n \n class TestContentItemLookup(unittest.TestCase):\n-\n     layer = IMPLICIT_RULESET_REGISTRY_UNIT_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/caching/tests/test_operation_parameters.py b/plone/app/caching/tests/test_operation_parameters.py\nindex 3b989f0..0f5923a 100644\n--- a/plone/app/caching/tests/test_operation_parameters.py\n+++ b/plone/app/caching/tests/test_operation_parameters.py\n@@ -35,7 +35,6 @@ def tearDown(self):\n         setRequest(None)\n \n     def test_anon_only(self):\n-\n         # Add folder content\n         setRoles(self.portal, TEST_USER_ID, ("Manager",))\n         self.portal.invokeFactory("Folder", "f1")\ndiff --git a/plone/app/caching/tests/test_operation_utils.py b/plone/app/caching/tests/test_operation_utils.py\nindex ff5ce36..9661e69 100644\n--- a/plone/app/caching/tests/test_operation_utils.py\n+++ b/plone/app/caching/tests/test_operation_utils.py\n@@ -40,7 +40,6 @@ def normalize_response_cache(value):\n \n \n class ResponseModificationHelpersTest(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -392,7 +391,6 @@ def test_cacheInRAM_etag_alternate_key(self):\n \n \n class ResponseInterceptorHelpersTest(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -537,7 +535,6 @@ def test_notModified_full(self):\n \n \n class CacheCheckHelpersTest(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -841,7 +838,6 @@ def test_visibleToRole_permission(self):\n \n \n class MiscHelpersTest(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -1264,7 +1260,6 @@ def test_parseETags_multiple_quoted_weak_disallowed(self):\n \n \n class RAMCacheTest(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/caching/tests/test_profile_with_caching_proxy.py b/plone/app/caching/tests/test_profile_with_caching_proxy.py\nindex ca724c3..8df999a 100644\n--- a/plone/app/caching/tests/test_profile_with_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_with_caching_proxy.py\n@@ -304,7 +304,6 @@ def test_composite_viewsxx(self):\n         self.assertEqual("200 OK", browser.headers["Status"].upper())\n \n     def test_content_feeds(self):\n-\n         catalog = self.portal["portal_catalog"]\n         skins_tool = self.portal["portal_skins"]\n \n@@ -405,7 +404,6 @@ def test_content_feeds(self):\n         self.assertIsNone(browser.headers.get("X-RAMCache"))\n \n     def test_content_files(self):\n-\n         # Add folder content\n         setRoles(self.portal, TEST_USER_ID, ("Manager",))\n         self.portal.invokeFactory("Folder", "f1")\ndiff --git a/plone/app/caching/tests/test_profile_without_caching_proxy.py b/plone/app/caching/tests/test_profile_without_caching_proxy.py\nindex 4ce78dd..07a0585 100644\n--- a/plone/app/caching/tests/test_profile_without_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_without_caching_proxy.py\n@@ -56,7 +56,6 @@ def tearDown(self):\n         setRequest(None)\n \n     def test_composite_views(self):\n-\n         catalog = self.portal["portal_catalog"]\n         default_skin = self.portal["portal_skins"].default_skin\n \n@@ -276,7 +275,6 @@ def test_composite_views(self):\n         self.assertEqual("200 OK", browser.headers["Status"].upper())\n \n     def test_content_feeds(self):\n-\n         catalog = self.portal["portal_catalog"]\n         default_skin = self.portal["portal_skins"].default_skin\n \n@@ -377,7 +375,6 @@ def test_content_feeds(self):\n         self.assertIsNone(browser.headers.get("X-RAMCache"))\n \n     def test_content_files(self):\n-\n         # Add folder content\n         setRoles(self.portal, TEST_USER_ID, ("Manager",))\n         self.portal.invokeFactory("Folder", "f1")\ndiff --git a/plone/app/caching/tests/test_purge.py b/plone/app/caching/tests/test_purge.py\nindex 3b433a1..a37acc6 100644\n--- a/plone/app/caching/tests/test_purge.py\n+++ b/plone/app/caching/tests/test_purge.py\n@@ -92,7 +92,6 @@ def getParentNode(self):\n \n @implementer(IBrowserDefault)\n class FauxContent(FauxNonContent):\n-\n     portal_type = "testtype"\n \n     def defaultView(self):\n@@ -105,7 +104,6 @@ class FauxDiscussable(Explicit):\n \n \n class TestPurgeRedispatch(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -182,7 +180,6 @@ def test_removed(self):\n \n \n class TestContentPurgePaths(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def test_no_default_view(self):\n@@ -230,7 +227,6 @@ def test_parent_default_view(self):\n \n \n class TestDiscussionItemPurgePaths(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -319,11 +315,9 @@ def getDiscussionThread(self, item):\n \n \n class TestScalesPurgePaths(unittest.TestCase):\n-\n     layer = PLONE_APP_CACHING_FUNCTIONAL_TESTING\n \n     def setUp(self):\n-\n         self.portal = self.layer["portal"]\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n         self.portal.invokeFactory("Folder", "media")\n@@ -346,7 +340,6 @@ def setUp(self):\n         @implementer(IBehaviorAssignable)\n         @adapter(IDocument)\n         class TestingAssignable:\n-\n             enabled = [ILeadImageBehavior]\n             name = "plone.leadimage"\n \ndiff --git a/plone/app/caching/tests/test_utils.py b/plone/app/caching/tests/test_utils.py\nindex 0b36c3d..2a8c003 100644\n--- a/plone/app/caching/tests/test_utils.py\n+++ b/plone/app/caching/tests/test_utils.py\n@@ -98,7 +98,6 @@ def getTypeInfo(self):\n \n \n class TestIsPurged(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def setUp(self):\n@@ -155,7 +154,6 @@ def test_listed(self):\n \n \n class TestGetObjectDefaultPath(unittest.TestCase):\n-\n     layer = UNIT_TESTING\n \n     def test_not_content(self):\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 0c7b34b..ea13c1f 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -44,6 +44,9 @@ profile = "plone"\n [tool.black]\n target-version = ["py38"]\n \n+[tool.codespell]\n+ignore-words-list = "discreet,ordner"\n+\n [tool.dependencychecker]\n ignore-packages = [\'zope.dublincore\']\n Zope = [\'OFS\', \'Products.Five\', \'Products.PageTemplates\', \'ZPublisher\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 28a6823..edba85f 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -19,10 +19,12 @@ ignore =\n ignore =\n     .editorconfig\n     .meta.toml\n+    .pre-commit-config.yaml\n     tox.ini\n     lint-requirements.txt\n+    .tox\n     constraints-mxdev.txt\n-    requirements-mxdev.txt\n-    Makefile\n     instance.yaml\n+    Makefile\n     mx.ini\n+    requirements-mxdev.txt\ndiff --git a/tox.ini b/tox.ini\nindex 5cad975..8ed21b4 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -6,50 +6,50 @@ envlist =\n     lint\n \n [testenv]\n-py_files = git ls-files "*.py"\n-text_files = git ls-files "*.rst" "*.md"\n-xml_files = git ls-files "*.xml"\n-zcml_files = git ls-files "*.zcml"\n allowlist_externals =\n     sh\n \n [testenv:format]\n-description = automatically reformat python code\n+description = automatically reformat code\n skip_install = true\n deps =\n-    pyupgrade\n-    isort\n-    black\n-    zpretty\n-    -c lint-requirements.txt\n+    pre-commit\n commands =\n-    sh -c \'{[testenv]py_files} | xargs pyupgrade --py38-plus\'\n-    sh -c \'{[testenv]py_files} | xargs isort\'\n-    sh -c \'{[testenv]py_files} | xargs black\'\n-    sh -c \'{[testenv]xml_files} | xargs zpretty -x -i\'\n-    sh -c \'{[testenv]zcml_files} | xargs zpretty -z -i\'\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n \n [testenv:lint]\n description = run linters that will help improve the code style\n skip_install = true\n deps =\n-    flake8\n-    codespell\n-    tomli  # needed for codespell to read pyproject.toml\n-    check-manifest\n-    pyroma\n-    -c lint-requirements.txt\n+    pre-commit\n commands =\n-    sh -c \'{[testenv]py_files} | xargs flake8\'\n-    sh -c \'{[testenv]py_files} | xargs codespell\'\n-    sh -c \'{[testenv]text_files} | xargs codespell\'\n-    check-manifest\n-    pyroma -n 10 .\n+    pre-commit run -a\n \n [testenv:dependencies]\n description = check if the package defines all its dependencies\n deps =\n-    z3c.dependencychecker\n-    -c lint-requirements.txt\n+    z3c.dependencychecker==2.10\n commands =\n     dependencychecker\n+\n+[testenv:dependencies-graph]\n+description = generate a graph with the distribution dependencies\n+deps =\n+    pipdeptree==2.3.3\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    sh -c \'pipdeptree --exclude setuptools,pipdeptree,wheel --graph-output svg > dependencies.svg\'\n+\n+; [testenv:test]\n+; description = run the tests of the distribution\n+; deps =\n+;     plone.app.caching[test]\n+;     pytest\n+;     gocept.pytestlayer\n+;     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+; commands =\n+;     pip install -e .[test]\n+;     pytest\n'

