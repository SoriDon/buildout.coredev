Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2017-10-23T18:34:46+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/369fd92bb2286d89795eda7f05e5a6613428e483

Updated compatibility info.

Files changed:
M .gitignore
M CHANGES.rst
M README.rst
M setup.py
M src/plone/recipe/zope2instance/__init__.py
M src/plone/recipe/zope2instance/tests/test_docs.py

diff --git a/.gitignore b/.gitignore
index 4c4e309..62fde7b 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,10 +1,14 @@
 *.egg-info
 *.pyc
 *.pyo
+.Python
 bin
 build
 develop-eggs
 dist
 eggs
+include/
+lib/
 parts
+pip-selfcheck.json
 /.installed.cfg
diff --git a/CHANGES.rst b/CHANGES.rst
index f190bfd..ce2464a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,6 +6,10 @@ Changelog
 
 Breaking changes:
 
+- Require at least ZODB 5 and Zope 4.0b1.
+
+- Do not claim compatibility with Plone 4.3 and 5.0 anymore.
+
 - Python 3 compatibility.
 
 New features:
diff --git a/README.rst b/README.rst
index 7c827c1..0e75a72 100644
--- a/README.rst
+++ b/README.rst
@@ -23,9 +23,8 @@ You can use it with a part like this::
   zcml = my.distribution
 
 .. ATTENTION::
-   This release is targeted at Zope 2.12+ and Python 2.6. If you are using
-   this recipe with earlier versions of Zope or Python, you should use one
-   of the releases from the 3.x series.
+   This release is targeted at Plone 5.2, ZODB 5, Zope 4, and Python 2.7 or 3.5.
+   If you are using this recipe with earlier versions, you should use one of the releases from the 4.x series.
 
 Options
 =======
diff --git a/setup.py b/setup.py
index ccaf4cf..3dace93 100644
--- a/setup.py
+++ b/setup.py
@@ -21,13 +21,10 @@
         "License :: OSI Approved :: Zope Public License",
         "Framework :: Buildout",
         "Framework :: Plone",
-        "Framework :: Plone :: 4.3",
-        "Framework :: Plone :: 5.0",
         "Framework :: Plone :: 5.1",
         "Framework :: Zope2",
         "Programming Language :: Python",
         "Programming Language :: Python :: 2",
-        "Programming Language :: Python :: 2.6",
         "Programming Language :: Python :: 2.7",
         "Programming Language :: Python :: 3",
         "Programming Language :: Python :: 3.5",
@@ -42,7 +39,7 @@
         'setuptools',
         'six',
         'zc.recipe.egg',
-        'Zope2 >= 2.12.1',
+        'Zope >= 4.0b1',
         'ZODB >= 5.1.1',
         'ZEO',
     ],
diff --git a/src/plone/recipe/zope2instance/__init__.py b/src/plone/recipe/zope2instance/__init__.py
index c2dd072..372ebd2 100644
--- a/src/plone/recipe/zope2instance/__init__.py
+++ b/src/plone/recipe/zope2instance/__init__.py
@@ -91,8 +91,8 @@ def install(self, update=False):
             if os.path.exists(location):
                 shutil.rmtree(location)
 
-            # Which Zope2 version do we have?
-            dist = pkg_resources.get_distribution('Zope2')
+            # Which Zope version do we have?
+            dist = pkg_resources.get_distribution('Zope')
             parsed = dist.parsed_version
             major, minor = parsed[0:2]
             major = int(major)
diff --git a/src/plone/recipe/zope2instance/tests/test_docs.py b/src/plone/recipe/zope2instance/tests/test_docs.py
index f6a50fd..9fdb6ec 100644
--- a/src/plone/recipe/zope2instance/tests/test_docs.py
+++ b/src/plone/recipe/zope2instance/tests/test_docs.py
@@ -16,7 +16,7 @@ def setUp(test):
     install_develop('plone.recipe.zope2instance', test)
     install('zc.recipe.egg', test)
     install_dependencies(pkg_resources.working_set.require('ZEO'), test)
-    install_dependencies(pkg_resources.working_set.require('Zope2'), test)
+    install_dependencies(pkg_resources.working_set.require('Zope'), test)
     install_dependencies(pkg_resources.working_set.require('ZODB'), test)
 
 


Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2017-10-23T18:34:56+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/06dfab1563dead6d1daa62b4f53f5b5d4678f68f

Removed 2.12 skeleton, always use 2.13 skeleton.

We do not actually support 2.13, only 4+, but we do not have to rename the directory.
Should make it easier to backport stuff.

Files changed:
M src/plone/recipe/zope2instance/__init__.py
M src/plone/recipe/zope2instance/make.py
D src/plone/recipe/zope2instance/skel212/bin/README.txt
D src/plone/recipe/zope2instance/skel212/etc/site.zcml
D src/plone/recipe/zope2instance/skel212/var/README.txt

diff --git a/src/plone/recipe/zope2instance/__init__.py b/src/plone/recipe/zope2instance/__init__.py
index 372ebd2..74d087a 100644
--- a/src/plone/recipe/zope2instance/__init__.py
+++ b/src/plone/recipe/zope2instance/__init__.py
@@ -19,7 +19,6 @@
 
 import os
 import os.path
-import pkg_resources
 import re
 import shutil
 import sys
@@ -92,19 +91,11 @@ def install(self, update=False):
                 shutil.rmtree(location)
 
             # Which Zope version do we have?
-            dist = pkg_resources.get_distribution('Zope')
-            parsed = dist.parsed_version
-            major, minor = parsed[0:2]
-            major = int(major)
-            # We support creating instances for 2.12, 2.13 and 4.0
-            if major >= 4:
-                major = 2
-                minor = 13
-            elif major == 2:
-                minor = int(minor)
-                if minor > 13:
-                    minor = 13
-            version = str(major) + str(minor)
+            # dist = pkg_resources.get_distribution('Zope')
+            # parsed = dist.parsed_version
+            # We support creating instances for 4 only,
+            # which has the same structure as 2.13.
+            version = '213'
             make.make_instance(options.get('user', None), location, version)
 
         try:
diff --git a/src/plone/recipe/zope2instance/make.py b/src/plone/recipe/zope2instance/make.py
index b5630c1..10101d6 100644
--- a/src/plone/recipe/zope2instance/make.py
+++ b/src/plone/recipe/zope2instance/make.py
@@ -15,7 +15,7 @@
             os.path.normcase('.git')]
 
 
-def make_instance(user=None, instancehome=None, version='212'):
+def make_instance(user=None, instancehome=None, version='213'):
     instancehome = os.path.abspath(os.path.expanduser(instancehome))
     password = None
     if user:
@@ -23,6 +23,9 @@ def make_instance(user=None, instancehome=None, version='212'):
 
     # Use our own skeleton
     skelsrc = os.path.join(os.path.dirname(__file__), 'skel' + version)
+    if not os.path.exists(skelsrc):
+        raise ValueError(
+            'No configuration skeleton found for version {0}'.format(version))
 
     inituser = os.path.join(instancehome, 'inituser')
     if not (user or os.path.exists(inituser)):
diff --git a/src/plone/recipe/zope2instance/skel212/bin/README.txt b/src/plone/recipe/zope2instance/skel212/bin/README.txt
deleted file mode 100644
index e69de29..0000000
diff --git a/src/plone/recipe/zope2instance/skel212/etc/site.zcml b/src/plone/recipe/zope2instance/skel212/etc/site.zcml
deleted file mode 100644
index 4745442..0000000
--- a/src/plone/recipe/zope2instance/skel212/etc/site.zcml
+++ /dev/null
@@ -1,26 +0,0 @@
-<configure
-    xmlns="http://namespaces.zope.org/zope"
-    xmlns:meta="http://namespaces.zope.org/meta"
-    xmlns:five="http://namespaces.zope.org/five">
-
-  <include package="Products.Five" />
-  <meta:redefinePermission from="zope2.Public" to="zope.Public" />
-
-
-  <!-- Load the meta -->
-  <include files="package-includes/*-meta.zcml" />
-  <five:loadProducts file="meta.zcml"/>
-
-  <!-- Load the configuration -->
-  <include files="package-includes/*-configure.zcml" />
-  <five:loadProducts />
-
-  <!-- Load the configuration overrides-->
-  <includeOverrides files="package-includes/*-overrides.zcml" />
-  <five:loadProductsOverrides />
-
-
-  <securityPolicy
-      component="Products.Five.security.FiveSecurityPolicy" />
-
-</configure>
diff --git a/src/plone/recipe/zope2instance/skel212/var/README.txt b/src/plone/recipe/zope2instance/skel212/var/README.txt
deleted file mode 100644
index e69de29..0000000


Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2017-11-06T09:37:09+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/3dff8993e19c0600c4f8cf07a788637fa1e43639

Renamed skel213 to skel4.

Files changed:
A src/plone/recipe/zope2instance/skel4/bin/README.txt
A src/plone/recipe/zope2instance/skel4/etc/site.zcml
A src/plone/recipe/zope2instance/skel4/var/README.txt
M src/plone/recipe/zope2instance/__init__.py
M src/plone/recipe/zope2instance/make.py
D src/plone/recipe/zope2instance/skel213/bin/README.txt
D src/plone/recipe/zope2instance/skel213/etc/site.zcml
D src/plone/recipe/zope2instance/skel213/var/README.txt

diff --git a/src/plone/recipe/zope2instance/__init__.py b/src/plone/recipe/zope2instance/__init__.py
index 74d087a..0590586 100644
--- a/src/plone/recipe/zope2instance/__init__.py
+++ b/src/plone/recipe/zope2instance/__init__.py
@@ -90,12 +90,9 @@ def install(self, update=False):
             if os.path.exists(location):
                 shutil.rmtree(location)
 
-            # Which Zope version do we have?
-            # dist = pkg_resources.get_distribution('Zope')
-            # parsed = dist.parsed_version
-            # We support creating instances for 4 only,
-            # which has the same structure as 2.13.
-            version = '213'
+            # We could check with pkg_resources which Zope version we have.
+            # But we support creating instances for 4 only.
+            version = '4'
             make.make_instance(options.get('user', None), location, version)
 
         try:
diff --git a/src/plone/recipe/zope2instance/make.py b/src/plone/recipe/zope2instance/make.py
index 10101d6..2747c17 100644
--- a/src/plone/recipe/zope2instance/make.py
+++ b/src/plone/recipe/zope2instance/make.py
@@ -15,7 +15,7 @@
             os.path.normcase('.git')]
 
 
-def make_instance(user=None, instancehome=None, version='213'):
+def make_instance(user=None, instancehome=None, version='4'):
     instancehome = os.path.abspath(os.path.expanduser(instancehome))
     password = None
     if user:
diff --git a/src/plone/recipe/zope2instance/skel213/bin/README.txt b/src/plone/recipe/zope2instance/skel4/bin/README.txt
similarity index 100%
rename from src/plone/recipe/zope2instance/skel213/bin/README.txt
rename to src/plone/recipe/zope2instance/skel4/bin/README.txt
diff --git a/src/plone/recipe/zope2instance/skel213/etc/site.zcml b/src/plone/recipe/zope2instance/skel4/etc/site.zcml
similarity index 100%
rename from src/plone/recipe/zope2instance/skel213/etc/site.zcml
rename to src/plone/recipe/zope2instance/skel4/etc/site.zcml
diff --git a/src/plone/recipe/zope2instance/skel213/var/README.txt b/src/plone/recipe/zope2instance/skel4/var/README.txt
similarity index 100%
rename from src/plone/recipe/zope2instance/skel213/var/README.txt
rename to src/plone/recipe/zope2instance/skel4/var/README.txt


Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2017-11-06T09:41:20+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/6e1ded3521a48212bb46df44474ed90986ddbda8

Set https pypi index in buildout config.

Files changed:
M buildout.cfg

diff --git a/buildout.cfg b/buildout.cfg
index 936c8cd..e56504a 100644
--- a/buildout.cfg
+++ b/buildout.cfg
@@ -1,4 +1,5 @@
 [buildout]
+index = https://pypi.python.org/simple/
 extends = https://raw.githubusercontent.com/zopefoundation/Zope/4.0b2/versions-prod.cfg
 versions = versions
 develop = .


Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2017-11-06T10:51:15+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/2e6b685c9e5acde7e599cee239e9518f68ae9194

Merge pull request #35 from plone/readme-compatibility

Update compatibility info and only support Zope 4

Files changed:
A src/plone/recipe/zope2instance/skel4/bin/README.txt
A src/plone/recipe/zope2instance/skel4/etc/site.zcml
A src/plone/recipe/zope2instance/skel4/var/README.txt
M .gitignore
M CHANGES.rst
M README.rst
M buildout.cfg
M setup.py
M src/plone/recipe/zope2instance/__init__.py
M src/plone/recipe/zope2instance/make.py
M src/plone/recipe/zope2instance/tests/test_docs.py
D src/plone/recipe/zope2instance/skel212/bin/README.txt
D src/plone/recipe/zope2instance/skel212/etc/site.zcml
D src/plone/recipe/zope2instance/skel212/var/README.txt
D src/plone/recipe/zope2instance/skel213/bin/README.txt
D src/plone/recipe/zope2instance/skel213/etc/site.zcml
D src/plone/recipe/zope2instance/skel213/var/README.txt

diff --git a/.gitignore b/.gitignore
index 4c4e309..62fde7b 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,10 +1,14 @@
 *.egg-info
 *.pyc
 *.pyo
+.Python
 bin
 build
 develop-eggs
 dist
 eggs
+include/
+lib/
 parts
+pip-selfcheck.json
 /.installed.cfg
diff --git a/CHANGES.rst b/CHANGES.rst
index f190bfd..ce2464a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,6 +6,10 @@ Changelog
 
 Breaking changes:
 
+- Require at least ZODB 5 and Zope 4.0b1.
+
+- Do not claim compatibility with Plone 4.3 and 5.0 anymore.
+
 - Python 3 compatibility.
 
 New features:
diff --git a/README.rst b/README.rst
index 7c827c1..0e75a72 100644
--- a/README.rst
+++ b/README.rst
@@ -23,9 +23,8 @@ You can use it with a part like this::
   zcml = my.distribution
 
 .. ATTENTION::
-   This release is targeted at Zope 2.12+ and Python 2.6. If you are using
-   this recipe with earlier versions of Zope or Python, you should use one
-   of the releases from the 3.x series.
+   This release is targeted at Plone 5.2, ZODB 5, Zope 4, and Python 2.7 or 3.5.
+   If you are using this recipe with earlier versions, you should use one of the releases from the 4.x series.
 
 Options
 =======
diff --git a/buildout.cfg b/buildout.cfg
index 936c8cd..e56504a 100644
--- a/buildout.cfg
+++ b/buildout.cfg
@@ -1,4 +1,5 @@
 [buildout]
+index = https://pypi.python.org/simple/
 extends = https://raw.githubusercontent.com/zopefoundation/Zope/4.0b2/versions-prod.cfg
 versions = versions
 develop = .
diff --git a/setup.py b/setup.py
index ccaf4cf..3dace93 100644
--- a/setup.py
+++ b/setup.py
@@ -21,13 +21,10 @@
         "License :: OSI Approved :: Zope Public License",
         "Framework :: Buildout",
         "Framework :: Plone",
-        "Framework :: Plone :: 4.3",
-        "Framework :: Plone :: 5.0",
         "Framework :: Plone :: 5.1",
         "Framework :: Zope2",
         "Programming Language :: Python",
         "Programming Language :: Python :: 2",
-        "Programming Language :: Python :: 2.6",
         "Programming Language :: Python :: 2.7",
         "Programming Language :: Python :: 3",
         "Programming Language :: Python :: 3.5",
@@ -42,7 +39,7 @@
         'setuptools',
         'six',
         'zc.recipe.egg',
-        'Zope2 >= 2.12.1',
+        'Zope >= 4.0b1',
         'ZODB >= 5.1.1',
         'ZEO',
     ],
diff --git a/src/plone/recipe/zope2instance/__init__.py b/src/plone/recipe/zope2instance/__init__.py
index c2dd072..0590586 100644
--- a/src/plone/recipe/zope2instance/__init__.py
+++ b/src/plone/recipe/zope2instance/__init__.py
@@ -19,7 +19,6 @@
 
 import os
 import os.path
-import pkg_resources
 import re
 import shutil
 import sys
@@ -91,20 +90,9 @@ def install(self, update=False):
             if os.path.exists(location):
                 shutil.rmtree(location)
 
-            # Which Zope2 version do we have?
-            dist = pkg_resources.get_distribution('Zope2')
-            parsed = dist.parsed_version
-            major, minor = parsed[0:2]
-            major = int(major)
-            # We support creating instances for 2.12, 2.13 and 4.0
-            if major >= 4:
-                major = 2
-                minor = 13
-            elif major == 2:
-                minor = int(minor)
-                if minor > 13:
-                    minor = 13
-            version = str(major) + str(minor)
+            # We could check with pkg_resources which Zope version we have.
+            # But we support creating instances for 4 only.
+            version = '4'
             make.make_instance(options.get('user', None), location, version)
 
         try:
diff --git a/src/plone/recipe/zope2instance/make.py b/src/plone/recipe/zope2instance/make.py
index b5630c1..2747c17 100644
--- a/src/plone/recipe/zope2instance/make.py
+++ b/src/plone/recipe/zope2instance/make.py
@@ -15,7 +15,7 @@
             os.path.normcase('.git')]
 
 
-def make_instance(user=None, instancehome=None, version='212'):
+def make_instance(user=None, instancehome=None, version='4'):
     instancehome = os.path.abspath(os.path.expanduser(instancehome))
     password = None
     if user:
@@ -23,6 +23,9 @@ def make_instance(user=None, instancehome=None, version='212'):
 
     # Use our own skeleton
     skelsrc = os.path.join(os.path.dirname(__file__), 'skel' + version)
+    if not os.path.exists(skelsrc):
+        raise ValueError(
+            'No configuration skeleton found for version {0}'.format(version))
 
     inituser = os.path.join(instancehome, 'inituser')
     if not (user or os.path.exists(inituser)):
diff --git a/src/plone/recipe/zope2instance/skel212/etc/site.zcml b/src/plone/recipe/zope2instance/skel212/etc/site.zcml
deleted file mode 100644
index 4745442..0000000
--- a/src/plone/recipe/zope2instance/skel212/etc/site.zcml
+++ /dev/null
@@ -1,26 +0,0 @@
-<configure
-    xmlns="http://namespaces.zope.org/zope"
-    xmlns:meta="http://namespaces.zope.org/meta"
-    xmlns:five="http://namespaces.zope.org/five">
-
-  <include package="Products.Five" />
-  <meta:redefinePermission from="zope2.Public" to="zope.Public" />
-
-
-  <!-- Load the meta -->
-  <include files="package-includes/*-meta.zcml" />
-  <five:loadProducts file="meta.zcml"/>
-
-  <!-- Load the configuration -->
-  <include files="package-includes/*-configure.zcml" />
-  <five:loadProducts />
-
-  <!-- Load the configuration overrides-->
-  <includeOverrides files="package-includes/*-overrides.zcml" />
-  <five:loadProductsOverrides />
-
-
-  <securityPolicy
-      component="Products.Five.security.FiveSecurityPolicy" />
-
-</configure>
diff --git a/src/plone/recipe/zope2instance/skel213/bin/README.txt b/src/plone/recipe/zope2instance/skel213/bin/README.txt
deleted file mode 100644
index e69de29..0000000
diff --git a/src/plone/recipe/zope2instance/skel213/var/README.txt b/src/plone/recipe/zope2instance/skel213/var/README.txt
deleted file mode 100644
index e69de29..0000000
diff --git a/src/plone/recipe/zope2instance/skel212/bin/README.txt b/src/plone/recipe/zope2instance/skel4/bin/README.txt
similarity index 100%
rename from src/plone/recipe/zope2instance/skel212/bin/README.txt
rename to src/plone/recipe/zope2instance/skel4/bin/README.txt
diff --git a/src/plone/recipe/zope2instance/skel213/etc/site.zcml b/src/plone/recipe/zope2instance/skel4/etc/site.zcml
similarity index 100%
rename from src/plone/recipe/zope2instance/skel213/etc/site.zcml
rename to src/plone/recipe/zope2instance/skel4/etc/site.zcml
diff --git a/src/plone/recipe/zope2instance/skel212/var/README.txt b/src/plone/recipe/zope2instance/skel4/var/README.txt
similarity index 100%
rename from src/plone/recipe/zope2instance/skel212/var/README.txt
rename to src/plone/recipe/zope2instance/skel4/var/README.txt
diff --git a/src/plone/recipe/zope2instance/tests/test_docs.py b/src/plone/recipe/zope2instance/tests/test_docs.py
index f6a50fd..9fdb6ec 100644
--- a/src/plone/recipe/zope2instance/tests/test_docs.py
+++ b/src/plone/recipe/zope2instance/tests/test_docs.py
@@ -16,7 +16,7 @@ def setUp(test):
     install_develop('plone.recipe.zope2instance', test)
     install('zc.recipe.egg', test)
     install_dependencies(pkg_resources.working_set.require('ZEO'), test)
-    install_dependencies(pkg_resources.working_set.require('Zope2'), test)
+    install_dependencies(pkg_resources.working_set.require('Zope'), test)
     install_dependencies(pkg_resources.working_set.require('ZODB'), test)
 
 


