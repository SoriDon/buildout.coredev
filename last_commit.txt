Repository: plone.base


Branch: refs/heads/main
Date: 2022-08-18T11:53:55+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.base/commit/c1f39756297d22f00b9bc3bf06d536922e250670

remove unused code/outdated comment

Files changed:
M src/plone/base/utils.py

b'diff --git a/src/plone/base/utils.py b/src/plone/base/utils.py\nindex ea4544a..252d559 100644\n--- a/src/plone/base/utils.py\n+++ b/src/plone/base/utils.py\n@@ -94,13 +94,6 @@ def safeToInt(value, default=0):\n     return safe_int(value, default)\n \n \n-@deprecate(\n-    "Use plone.base.utils.safe_int instead, came in by accident (will be removed in Plone 6 beta phase)"\n-)\n-def safe_to_int(value, default=0):\n-    return safe_int(value, default)\n-\n-\n def safe_text(value, encoding="utf-8") -> str:\n     """Converts a value to text, even it is already a text string.\n \n@@ -182,9 +175,6 @@ def pretty_title_or_id(context, obj, empty_value=_marker):\n     of whether obj is a catalog brain or an object, but returning an\n     empty title marker if the id is not set (i.e. it\'s auto-generated).\n     """\n-    # if safe_hasattr(obj, \'aq_explicit\'):\n-    #    obj = obj.aq_explicit\n-    # title = getattr(obj, \'Title\', None)\n     title = None\n     if base_hasattr(obj, "Title"):\n         title = getattr(obj, "Title", None)\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-08-18T11:57:44+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.base/commit/37e421f7fc73692038ccde0e57afb20d94ef509e

fix returning of item_id if given.

Files changed:
A news/16.bugfix
M src/plone/base/utils.py

b'diff --git a/news/16.bugfix b/news/16.bugfix\nnew file mode 100644\nindex 0000000..7f5245a\n--- /dev/null\n+++ b/news/16.bugfix\n@@ -0,0 +1,3 @@\n+Fix returning of item_id if given in `pretty_title_or_id`.\n+Remove unused code and outdated comment.\n+[jensens]\ndiff --git a/src/plone/base/utils.py b/src/plone/base/utils.py\nindex 252d559..c879fd8 100644\n--- a/src/plone/base/utils.py\n+++ b/src/plone/base/utils.py\n@@ -185,6 +185,8 @@ def pretty_title_or_id(context, obj, empty_value=_marker):\n     item_id = getattr(obj, "getId", None)\n     if safe_callable(item_id):\n         item_id = item_id()\n+    if item_id is not None:\n+        return item_id\n     if empty_value is _marker:\n         empty_value = get_empty_title(context)\n     return empty_value\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-08-18T13:09:03+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.base/commit/17a5496ceffd92c131a7b8d4bd719002d409dfc3

Merge pull request #16 from plone/minor-fixes

Minor fixes

Files changed:
A news/16.bugfix
M src/plone/base/utils.py

b'diff --git a/news/16.bugfix b/news/16.bugfix\nnew file mode 100644\nindex 0000000..7f5245a\n--- /dev/null\n+++ b/news/16.bugfix\n@@ -0,0 +1,3 @@\n+Fix returning of item_id if given in `pretty_title_or_id`.\n+Remove unused code and outdated comment.\n+[jensens]\ndiff --git a/src/plone/base/utils.py b/src/plone/base/utils.py\nindex ea4544a..c879fd8 100644\n--- a/src/plone/base/utils.py\n+++ b/src/plone/base/utils.py\n@@ -94,13 +94,6 @@ def safeToInt(value, default=0):\n     return safe_int(value, default)\n \n \n-@deprecate(\n-    "Use plone.base.utils.safe_int instead, came in by accident (will be removed in Plone 6 beta phase)"\n-)\n-def safe_to_int(value, default=0):\n-    return safe_int(value, default)\n-\n-\n def safe_text(value, encoding="utf-8") -> str:\n     """Converts a value to text, even it is already a text string.\n \n@@ -182,9 +175,6 @@ def pretty_title_or_id(context, obj, empty_value=_marker):\n     of whether obj is a catalog brain or an object, but returning an\n     empty title marker if the id is not set (i.e. it\'s auto-generated).\n     """\n-    # if safe_hasattr(obj, \'aq_explicit\'):\n-    #    obj = obj.aq_explicit\n-    # title = getattr(obj, \'Title\', None)\n     title = None\n     if base_hasattr(obj, "Title"):\n         title = getattr(obj, "Title", None)\n@@ -195,6 +185,8 @@ def pretty_title_or_id(context, obj, empty_value=_marker):\n     item_id = getattr(obj, "getId", None)\n     if safe_callable(item_id):\n         item_id = item_id()\n+    if item_id is not None:\n+        return item_id\n     if empty_value is _marker:\n         empty_value = get_empty_title(context)\n     return empty_value\n'

