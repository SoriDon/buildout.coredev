Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-12-08T08:44:57-08:00
Author: Alok Kumar (iFlameing) <ialokkumarsingh0@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/db7b02be560e5fb7064f9b5b20b8f6e6f2ef50d1

Fix timezone for Locking creation date (#1550)

* Initial commit

* run black

* Add changelog

* convert time to utc

Co-authored-by: David Glick &lt;david@glicksoftware.com&gt;

* Update documentation test

Co-authored-by: David Glick &lt;david@glicksoftware.com&gt;
Co-authored-by: Balázs Reé &lt;ree@greenfinity.hu&gt;

Files changed:
A news/1551.bugfix
M src/plone/restapi/services/locking/__init__.py
M src/plone/restapi/tests/http-examples/lock.resp
M src/plone/restapi/tests/http-examples/lock_nonstealable_timeout.resp
M src/plone/restapi/tests/http-examples/refresh_lock.resp
M src/plone/restapi/tests/http-examples/workingcopy_baseline_get.resp

b'diff --git a/news/1551.bugfix b/news/1551.bugfix\nnew file mode 100644\nindex 000000000..66884e04a\n--- /dev/null\n+++ b/news/1551.bugfix\n@@ -0,0 +1 @@\n+Fix timezone for Locking creation date @iFlameing\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/services/locking/__init__.py b/src/plone/restapi/services/locking/__init__.py\nindex 852bc73c1..aec6ad975 100644\n--- a/src/plone/restapi/services/locking/__init__.py\n+++ b/src/plone/restapi/services/locking/__init__.py\n@@ -16,7 +16,11 @@ def creator_url(username):\n \n \n def creation_date(timestamp):\n-    return datetime.fromtimestamp(timestamp).isoformat()\n+    # Note that isoformat does not add the Z at the end of the string, The lack of the\n+    # timezone specifier causes Intl (and derivative libraries) in the browser not to\n+    # use local time, which is considered a bug in applications. Therefore we add the Z\n+    # to the end to make sure that the date will be interpreted properly by the client.\n+    return datetime.utcfromtimestamp(timestamp).strftime("%Y-%m-%dT%H:%M:%SZ")\n \n \n def lock_info(obj):\ndiff --git a/src/plone/restapi/tests/http-examples/lock.resp b/src/plone/restapi/tests/http-examples/lock.resp\nindex 5cbb1a9d2..28cdc4d5a 100644\n--- a/src/plone/restapi/tests/http-examples/lock.resp\n+++ b/src/plone/restapi/tests/http-examples/lock.resp\n@@ -2,7 +2,7 @@ HTTP/1.1 200 OK\n Content-Type: application/json\n \n {\n-    "created": "1995-07-31T17:30:00",\n+    "created": "1995-07-31T17:30:00Z",\n     "creator": "admin",\n     "creator_name": "admin",\n     "creator_url": "http://localhost:55001/plone/author/admin",\ndiff --git a/src/plone/restapi/tests/http-examples/lock_nonstealable_timeout.resp b/src/plone/restapi/tests/http-examples/lock_nonstealable_timeout.resp\nindex ad881caf9..61c7ecd9a 100644\n--- a/src/plone/restapi/tests/http-examples/lock_nonstealable_timeout.resp\n+++ b/src/plone/restapi/tests/http-examples/lock_nonstealable_timeout.resp\n@@ -2,7 +2,7 @@ HTTP/1.1 200 OK\n Content-Type: application/json\n \n {\n-    "created": "1995-07-31T17:30:00",\n+    "created": "1995-07-31T17:30:00Z",\n     "creator": "admin",\n     "creator_name": "admin",\n     "creator_url": "http://localhost:55001/plone/author/admin",\ndiff --git a/src/plone/restapi/tests/http-examples/refresh_lock.resp b/src/plone/restapi/tests/http-examples/refresh_lock.resp\nindex 5cbb1a9d2..28cdc4d5a 100644\n--- a/src/plone/restapi/tests/http-examples/refresh_lock.resp\n+++ b/src/plone/restapi/tests/http-examples/refresh_lock.resp\n@@ -2,7 +2,7 @@ HTTP/1.1 200 OK\n Content-Type: application/json\n \n {\n-    "created": "1995-07-31T17:30:00",\n+    "created": "1995-07-31T17:30:00Z",\n     "creator": "admin",\n     "creator_name": "admin",\n     "creator_url": "http://localhost:55001/plone/author/admin",\ndiff --git a/src/plone/restapi/tests/http-examples/workingcopy_baseline_get.resp b/src/plone/restapi/tests/http-examples/workingcopy_baseline_get.resp\nindex a4622d83c..4dbae1b66 100644\n--- a/src/plone/restapi/tests/http-examples/workingcopy_baseline_get.resp\n+++ b/src/plone/restapi/tests/http-examples/workingcopy_baseline_get.resp\n@@ -43,7 +43,7 @@ Content-Type: application/json\n     "language": "",\n     "layout": "document_view",\n     "lock": {\n-        "created": "1995-07-31T17:30:00",\n+        "created": "1995-07-31T17:30:00Z",\n         "creator": "admin",\n         "creator_name": "admin",\n         "creator_url": "http://localhost:55001/plone/author/admin",\n'

