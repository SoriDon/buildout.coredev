Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2016-01-26T13:51:24+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.Archetypes/commit/912e6f2493a56fcb6c3d2d03b664dc91c71d8aac

Replace zope.tal.ndiff with difflib.ndiff

Files changed:
M CHANGES.rst
M Products/Archetypes/tests/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c71df88..0475497 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Replace zope.tal.ndiff with difflib.ndiff. It was removed in zope.tal 4.0.0.
+  [pbauer]
 
 
 1.10.11 (2015-10-27)
diff --git a/Products/Archetypes/tests/utils.py b/Products/Archetypes/tests/utils.py
index 98696aa..a5c9d21 100644
--- a/Products/Archetypes/tests/utils.py
+++ b/Products/Archetypes/tests/utils.py
@@ -28,8 +28,8 @@
 import re
 import sys
 import logging
+import difflib
 
-from zope.tal import ndiff
 from App.Common import package_home
 from ZPublisher.HTTPRequest import HTTPRequest
 from ZPublisher.HTTPResponse import HTTPResponse
@@ -88,15 +88,7 @@ def nicerange(lo, hi):
 
 
 def showdiff(a, b):
-    cruncher = ndiff.SequenceMatcher(ndiff.IS_LINE_JUNK, a, b)
-    for tag, alo, ahi, blo, bhi in cruncher.get_opcodes():
-        if tag == "equal":
-            continue
-        print nicerange(alo, ahi) + tag[0] + nicerange(blo, bhi)
-        ndiff.dump('<', a, alo, ahi)
-        if a and b:
-            print '---'
-        ndiff.dump('>', b, blo, bhi)
+    print(''.join(difflib.ndiff(a, b)))
 
 
 def populateFolder(folder, folder_type, doc_type):


Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2016-02-01T15:34:11+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.Archetypes/commit/eee6a55d87acdf2813f77493495ef124bea53ee5

Merge pull request #51 from plone/thet-zope4

Replace deprecated zope.tal.ndiff with difflib.ndiff

Files changed:
M CHANGES.rst
M Products/Archetypes/tests/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c71df88..0475497 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Replace zope.tal.ndiff with difflib.ndiff. It was removed in zope.tal 4.0.0.
+  [pbauer]
 
 
 1.10.11 (2015-10-27)
diff --git a/Products/Archetypes/tests/utils.py b/Products/Archetypes/tests/utils.py
index 98696aa..a5c9d21 100644
--- a/Products/Archetypes/tests/utils.py
+++ b/Products/Archetypes/tests/utils.py
@@ -28,8 +28,8 @@
 import re
 import sys
 import logging
+import difflib
 
-from zope.tal import ndiff
 from App.Common import package_home
 from ZPublisher.HTTPRequest import HTTPRequest
 from ZPublisher.HTTPResponse import HTTPResponse
@@ -88,15 +88,7 @@ def nicerange(lo, hi):
 
 
 def showdiff(a, b):
-    cruncher = ndiff.SequenceMatcher(ndiff.IS_LINE_JUNK, a, b)
-    for tag, alo, ahi, blo, bhi in cruncher.get_opcodes():
-        if tag == "equal":
-            continue
-        print nicerange(alo, ahi) + tag[0] + nicerange(blo, bhi)
-        ndiff.dump('<', a, alo, ahi)
-        if a and b:
-            print '---'
-        ndiff.dump('>', b, blo, bhi)
+    print(''.join(difflib.ndiff(a, b)))
 
 
 def populateFolder(folder, folder_type, doc_type):


