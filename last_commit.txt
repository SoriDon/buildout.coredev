Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2016-02-29T15:32:11+01:00
Author: Julian Handl (julianhandl) <julian.handl@gmail.com>
Commit: https://github.com/plone/plone.outputfilters/commit/a6f7ee46a4741aa74d22100b2f2604542ed88952

Do not build url if href starts with 'tel:'

Files changed:
M plone/outputfilters/filters/resolveuid_and_caption.py

diff --git a/plone/outputfilters/filters/resolveuid_and_caption.py b/plone/outputfilters/filters/resolveuid_and_caption.py
index 9f2c949..b6446e7 100644
--- a/plone/outputfilters/filters/resolveuid_and_caption.py
+++ b/plone/outputfilters/filters/resolveuid_and_caption.py
@@ -324,6 +324,7 @@ def unknown_starttag(self, tag, attrs):
                 scheme = urlsplit(href)[0]
                 if not scheme and not href.startswith('/') \
                         and not href.startswith('mailto<') \
+                        and not href.startswith('tel:') \
                         and not href.startswith('#'):
                     obj, subpath, appendix = self.resolve_link(href)
                     if obj is not None:


Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2016-02-29T16:03:59+01:00
Author: Julian Handl (julianhandl) <julian.handl@gmail.com>
Commit: https://github.com/plone/plone.outputfilters/commit/e10bf815670462049463a82ba7b7cfb518a8603c

Update CHANGES.rst

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index ca233df..599824f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,8 @@ Changelog
 
 New:
 
-- *add item here*
+- Added "tel:" to ignored link types.
+  [julianhandl]
 
 Fixes:
 


Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2016-03-01T08:35:51+01:00
Author: Julian Handl (julianhandl) <julian.handl@gmail.com>
Commit: https://github.com/plone/plone.outputfilters/commit/e9342131aaf5d7a2f3e3e54edd3cc390f91693d4

Add test for tel links

Files changed:
M plone/outputfilters/tests/test_resolveuid_and_caption.py

diff --git a/plone/outputfilters/tests/test_resolveuid_and_caption.py b/plone/outputfilters/tests/test_resolveuid_and_caption.py
index b97cfd6..79129ac 100644
--- a/plone/outputfilters/tests/test_resolveuid_and_caption.py
+++ b/plone/outputfilters/tests/test_resolveuid_and_caption.py
@@ -198,6 +198,10 @@ def test_resolve_uids_in_image_maps(self):
     def test_resolve_uids_ignores_mailto(self):
         text_in = """<a href="mailto:foo@example.com">foo@example.com</a>"""
         self._assertTransformsTo(text_in, text_in)
+    
+    def test_resolve_uids_ignores_tel(self):
+        text_in = """<a href="tel:+1234567890">+12 345 67890</a>"""
+        self._assertTransformsTo(text_in, text_in)
 
     def test_resolve_uids_handles_junk(self):
         text_in = """<a class="external-link" href="mailto&lt;foo@example.com&gt;">foo@example.com</a>"""


Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2016-03-06T21:40:19+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.forcada@freitag.de>
Commit: https://github.com/plone/plone.outputfilters/commit/8d07483718181eb745b9beef665cae032f94b165

Merge pull request #16 from julianhandl/telephone-link

Do not build url if href starts with 'tel:'

Files changed:
M CHANGES.rst
M plone/outputfilters/filters/resolveuid_and_caption.py
M plone/outputfilters/tests/test_resolveuid_and_caption.py

diff --git a/CHANGES.rst b/CHANGES.rst
index ca233df..599824f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,8 @@ Changelog
 
 New:
 
-- *add item here*
+- Added "tel:" to ignored link types.
+  [julianhandl]
 
 Fixes:
 
diff --git a/plone/outputfilters/filters/resolveuid_and_caption.py b/plone/outputfilters/filters/resolveuid_and_caption.py
index 9f2c949..b6446e7 100644
--- a/plone/outputfilters/filters/resolveuid_and_caption.py
+++ b/plone/outputfilters/filters/resolveuid_and_caption.py
@@ -324,6 +324,7 @@ def unknown_starttag(self, tag, attrs):
                 scheme = urlsplit(href)[0]
                 if not scheme and not href.startswith('/') \
                         and not href.startswith('mailto<') \
+                        and not href.startswith('tel:') \
                         and not href.startswith('#'):
                     obj, subpath, appendix = self.resolve_link(href)
                     if obj is not None:
diff --git a/plone/outputfilters/tests/test_resolveuid_and_caption.py b/plone/outputfilters/tests/test_resolveuid_and_caption.py
index b97cfd6..79129ac 100644
--- a/plone/outputfilters/tests/test_resolveuid_and_caption.py
+++ b/plone/outputfilters/tests/test_resolveuid_and_caption.py
@@ -198,6 +198,10 @@ def test_resolve_uids_in_image_maps(self):
     def test_resolve_uids_ignores_mailto(self):
         text_in = """<a href="mailto:foo@example.com">foo@example.com</a>"""
         self._assertTransformsTo(text_in, text_in)
+    
+    def test_resolve_uids_ignores_tel(self):
+        text_in = """<a href="tel:+1234567890">+12 345 67890</a>"""
+        self._assertTransformsTo(text_in, text_in)
 
     def test_resolve_uids_handles_junk(self):
         text_in = """<a class="external-link" href="mailto&lt;foo@example.com&gt;">foo@example.com</a>"""


