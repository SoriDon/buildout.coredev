Repository: plone.dexterity


Branch: refs/heads/master
Date: 2016-01-29T23:31:45+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.dexterity/commit/e5fd89988bf95f06b5bcb6d316cd8c32d189301c

skip some test for zope4

Files changed:
M plone/dexterity/tests/test_schema.py
M plone/dexterity/tests/test_utils.py

diff --git a/plone/dexterity/tests/test_schema.py b/plone/dexterity/tests/test_schema.py
index e9d4510..0b3011a 100644
--- a/plone/dexterity/tests/test_schema.py
+++ b/plone/dexterity/tests/test_schema.py
@@ -1,5 +1,6 @@
 # -*- coding: utf-8 -*-
 from Products.CMFCore.interfaces import ISiteRoot
+from pkg_resources import get_distribution
 from plone.dexterity import schema
 from plone.dexterity.fti import DexterityFTI
 from plone.dexterity.interfaces import IContentType
@@ -15,6 +16,8 @@
 import unittest
 import zope.schema
 
+has_zope4 = get_distribution('Zope2').version.startswith('4')
+
 
 class TestSchemaModuleFactory(MockTestCase):
 
@@ -160,6 +163,7 @@ def test_portalTypeToSchemaName_with_schema_and_prefix(self):
             schema.portalTypeToSchemaName('type one.two', '', 'prefix')
         )
 
+    @unittest.skipIf(has_zope4, 'Broken with zope4, see https://community.plone.org/t/problems-with-mocktestcase-in-plone-dexterity/1484')  # noqa
     def test_portalTypeToSchemaName_looks_up_portal_for_prefix(self):
         portal_mock = self.mocker.mock()
         self.expect(
diff --git a/plone/dexterity/tests/test_utils.py b/plone/dexterity/tests/test_utils.py
index 0cff8ae..ec94117 100644
--- a/plone/dexterity/tests/test_utils.py
+++ b/plone/dexterity/tests/test_utils.py
@@ -2,12 +2,16 @@
 from plone.dexterity import utils
 from plone.dexterity.fti import DexterityFTI
 from plone.mocktestcase import MockTestCase
+from pkg_resources import get_distribution
 
 import unittest
 
+has_zope4 = get_distribution('Zope2').version.startswith('4')
+
 
 class TestUtils(MockTestCase):
 
+    @unittest.skipIf(has_zope4, 'Broken with zope4, see https://community.plone.org/t/problems-with-mocktestcase-in-plone-dexterity/1484')  # noqa
     def test_getAdditionalSchemata(self):
         from plone.dexterity.interfaces import IDexterityFTI
         from plone.behavior.interfaces import IBehavior
@@ -45,11 +49,17 @@ class IBehaviorSchema(Interface):
 
         self.mock_utility(behavior_mock, IBehavior, behavior_name)
         self.mock_utility(fti_mock, IDexterityFTI, portal_type)
+
+        import zope.interface.registry
+        orig_getName = zope.interface.registry._getName
+        zope.interface._getName = lambda component: u''
         self.mock_adapter(
             provider_mock,
             IFormFieldProvider,
             (providedBy(IBehaviorInterface), )
         )
+        #zope.interface._getName = orig_getName
+
 
         self.replay()
 


Repository: plone.dexterity


Branch: refs/heads/master
Date: 2016-02-02T10:51:59+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.dexterity/commit/7da4296e0a650085d03fb1e878f5f46f50d69cb4

cleanup and changelog

Files changed:
M CHANGES.rst
M plone/dexterity/tests/test_schema.py
M plone/dexterity/tests/test_utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index ebc8aa8..0aa698f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,9 @@ New:
 
 Fixes:
 
+- Skip the tests ``test_portalTypeToSchemaName_looks_up_portal_for_prefix`` and ``test_getAdditionalSchemata`` with isolation problems in Zope 4.
+  [pbauer]
+
 - make utils/datify work with newer DateTime and pytz. Adjust tests to reflect
   changes.
   [jensens]
diff --git a/plone/dexterity/tests/test_schema.py b/plone/dexterity/tests/test_schema.py
index 0b3011a..4c34c1e 100644
--- a/plone/dexterity/tests/test_schema.py
+++ b/plone/dexterity/tests/test_schema.py
@@ -1,5 +1,4 @@
 # -*- coding: utf-8 -*-
-from Products.CMFCore.interfaces import ISiteRoot
 from pkg_resources import get_distribution
 from plone.dexterity import schema
 from plone.dexterity.fti import DexterityFTI
@@ -10,12 +9,14 @@
 from plone.dexterity.schema import SCHEMA_CACHE
 from plone.mocktestcase import MockTestCase
 from plone.supermodel.model import Model
+from Products.CMFCore.interfaces import ISiteRoot
 from zope.interface import Interface
 from zope.interface.interface import InterfaceClass
 
 import unittest
 import zope.schema
 
+
 has_zope4 = get_distribution('Zope2').version.startswith('4')
 
 
diff --git a/plone/dexterity/tests/test_utils.py b/plone/dexterity/tests/test_utils.py
index ec94117..9213fbb 100644
--- a/plone/dexterity/tests/test_utils.py
+++ b/plone/dexterity/tests/test_utils.py
@@ -1,11 +1,12 @@
 # -*- coding: utf-8 -*-
+from pkg_resources import get_distribution
 from plone.dexterity import utils
 from plone.dexterity.fti import DexterityFTI
 from plone.mocktestcase import MockTestCase
-from pkg_resources import get_distribution
 
 import unittest
 
+
 has_zope4 = get_distribution('Zope2').version.startswith('4')
 
 
@@ -50,16 +51,11 @@ class IBehaviorSchema(Interface):
         self.mock_utility(behavior_mock, IBehavior, behavior_name)
         self.mock_utility(fti_mock, IDexterityFTI, portal_type)
 
-        import zope.interface.registry
-        orig_getName = zope.interface.registry._getName
-        zope.interface._getName = lambda component: u''
         self.mock_adapter(
             provider_mock,
             IFormFieldProvider,
             (providedBy(IBehaviorInterface), )
         )
-        #zope.interface._getName = orig_getName
-
 
         self.replay()
 


Repository: plone.dexterity


Branch: refs/heads/master
Date: 2016-02-03T09:56:14+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.dexterity/commit/e59ed59b6a6914ec269bf028ab315f93f39f1220

Merge pull request #50 from plone/thet-zope4

Zope4

Files changed:
M CHANGES.rst
M plone/dexterity/tests/test_schema.py
M plone/dexterity/tests/test_utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index ebc8aa8..0aa698f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,9 @@ New:
 
 Fixes:
 
+- Skip the tests ``test_portalTypeToSchemaName_looks_up_portal_for_prefix`` and ``test_getAdditionalSchemata`` with isolation problems in Zope 4.
+  [pbauer]
+
 - make utils/datify work with newer DateTime and pytz. Adjust tests to reflect
   changes.
   [jensens]
diff --git a/plone/dexterity/tests/test_schema.py b/plone/dexterity/tests/test_schema.py
index e9d4510..4c34c1e 100644
--- a/plone/dexterity/tests/test_schema.py
+++ b/plone/dexterity/tests/test_schema.py
@@ -1,5 +1,5 @@
 # -*- coding: utf-8 -*-
-from Products.CMFCore.interfaces import ISiteRoot
+from pkg_resources import get_distribution
 from plone.dexterity import schema
 from plone.dexterity.fti import DexterityFTI
 from plone.dexterity.interfaces import IContentType
@@ -9,6 +9,7 @@
 from plone.dexterity.schema import SCHEMA_CACHE
 from plone.mocktestcase import MockTestCase
 from plone.supermodel.model import Model
+from Products.CMFCore.interfaces import ISiteRoot
 from zope.interface import Interface
 from zope.interface.interface import InterfaceClass
 
@@ -16,6 +17,9 @@
 import zope.schema
 
 
+has_zope4 = get_distribution('Zope2').version.startswith('4')
+
+
 class TestSchemaModuleFactory(MockTestCase):
 
     def test_transient_schema(self):
@@ -160,6 +164,7 @@ def test_portalTypeToSchemaName_with_schema_and_prefix(self):
             schema.portalTypeToSchemaName('type one.two', '', 'prefix')
         )
 
+    @unittest.skipIf(has_zope4, 'Broken with zope4, see https://community.plone.org/t/problems-with-mocktestcase-in-plone-dexterity/1484')  # noqa
     def test_portalTypeToSchemaName_looks_up_portal_for_prefix(self):
         portal_mock = self.mocker.mock()
         self.expect(
diff --git a/plone/dexterity/tests/test_utils.py b/plone/dexterity/tests/test_utils.py
index 0cff8ae..9213fbb 100644
--- a/plone/dexterity/tests/test_utils.py
+++ b/plone/dexterity/tests/test_utils.py
@@ -1,4 +1,5 @@
 # -*- coding: utf-8 -*-
+from pkg_resources import get_distribution
 from plone.dexterity import utils
 from plone.dexterity.fti import DexterityFTI
 from plone.mocktestcase import MockTestCase
@@ -6,8 +7,12 @@
 import unittest
 
 
+has_zope4 = get_distribution('Zope2').version.startswith('4')
+
+
 class TestUtils(MockTestCase):
 
+    @unittest.skipIf(has_zope4, 'Broken with zope4, see https://community.plone.org/t/problems-with-mocktestcase-in-plone-dexterity/1484')  # noqa
     def test_getAdditionalSchemata(self):
         from plone.dexterity.interfaces import IDexterityFTI
         from plone.behavior.interfaces import IBehavior
@@ -45,6 +50,7 @@ class IBehaviorSchema(Interface):
 
         self.mock_utility(behavior_mock, IBehavior, behavior_name)
         self.mock_utility(fti_mock, IDexterityFTI, portal_type)
+
         self.mock_adapter(
             provider_mock,
             IFormFieldProvider,


