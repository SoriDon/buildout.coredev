Repository: plone.app.mosaic


Branch: refs/heads/es6
Date: 2022-06-13T12:23:56+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.mosaic/commit/981905ef008bbedded64c62f75d373dc0c587619

fixing properties modal

Files changed:
M resources/js/mosaic.overlay.js

b'diff --git a/resources/js/mosaic.overlay.js b/resources/js/mosaic.overlay.js\nindex 7387b397..a7dc5d36 100644\n--- a/resources/js/mosaic.overlay.js\n+++ b/resources/js/mosaic.overlay.js\n@@ -18,81 +18,69 @@ export default class Overlay {\n         originalContent.style.display = "none";\n \n         self.modal = new Modal(originalContent, {\n-            title: document.querySelector("h1").innerText,\n-            content: "#form",\n+            content: "#content-core",\n             modalSizeClass: "modal-xl",\n         });\n+        self.modal.initModal();\n     }\n \n     open (mode, tile_config) {\n         // Local variables\n         var self = this;\n-        var formtabs, tile_group, visible_tabs, field, fieldset;\n+        var formtabs, visible_tabs, field, fieldset, modalContent;\n \n-        // Expand the overlay\n+        // show modal\n         self.modal.show();\n+        modalContent = self.modal.$modalContent;\n \n         if (mode === "all" && self.options.overlay_hide_fields) {\n             // Get form tabs\n-            formtabs = self.modal.$modal.find("nav");\n+            formtabs = modalContent.find("nav");\n \n             // Show form tabs\n             formtabs.removeClass("mosaic-hidden");\n \n             // Show all fields\n-            self.modal.$modal.find("fieldset").children().removeClass("mosaic-hidden");\n+            modalContent.find("fieldset").children().removeClass("mosaic-hidden");\n \n             // Hide all fieldsets\n-            self.modal.$modal.find("fieldset").removeClass("active");\n+            modalContent.find("fieldset").removeClass("active");\n \n             // Deselect all tabs\n             formtabs.find("a").removeClass("active");\n \n             // Hide layout field\n-            self.modal.$modal.find(self.options.customContentLayout_selector).addClass("mosaic-hidden");\n-            self.modal.$modal.find(self.options.contentLayout_selector).addClass("mosaic-hidden");\n+            modalContent.find(self.options.customContentLayout_selector).addClass("mosaic-hidden");\n+            modalContent.find(self.options.contentLayout_selector).addClass("mosaic-hidden");\n \n             // Hide title and description\n-            if ($(".mosaic-IDublinCore-title-tile").length > 0) {\n-                self.modal.$modal.find("#formfield-form-widgets-IDublinCore-title").addClass(\n-                    "mosaic-hidden"\n-                );\n-            } else {\n-                self.modal.$modal.find("#formfield-form-widgets-IDublinCore-title").removeClass(\n-                    "mosaic-hidden"\n-                );\n-            }\n-            if ($(".mosaic-IDublinCore-description-tile").length > 0) {\n-                self.modal.$modal.find("#formfield-form-widgets-IDublinCore-description").addClass(\n-                    "mosaic-hidden"\n-                );\n-            } else {\n-                self.modal.$modal.find("#formfield-form-widgets-IDublinCore-description").removeClass(\n-                    "mosaic-hidden"\n-                );\n-            }\n+            modalContent.find("#formfield-form-widgets-IDublinCore-title").toggleClass(\n+                "mosaic-hidden",\n+                $(".mosaic-IDublinCore-title-tile").length > 0\n+            );\n+            modalContent.find("#formfield-form-widgets-IDublinCore-description").toggleClass(\n+                "mosaic-hidden",\n+                $(".mosaic-IDublinCore-description-tile").length > 0\n+            );\n \n             // Hide field which are on the wysiwyg area\n-            var tile_group = {};\n             for (const tg of self.options.tiles) {\n                 if (tg.name === "fields") {\n-                    tile_group = tg;\n-                    break;\n-                }\n-            }\n-            for (const field_tile of tile_group.tiles) {\n-                if (\n-                    self.panels.find(\n-                        ".mosaic-" + field_tile.name + "-tile"\n-                    ).length !== 0\n-                ) {\n-                    log.info(`Hide field.tile ${field_tile.id}`);\n-                    self.modal.$modal.find("#" + field_tile.id).addClass("mosaic-hidden");\n+                    for (const field_tile of tg.tiles) {\n+                        if (\n+                            self.panels.find(\n+                                ".mosaic-" + field_tile.name + "-tile"\n+                            ).length !== 0\n+                        ) {\n+                            log.info(`Hide field.tile #${field_tile.id}`);\n+                            $(`#${field_tile.id}`, modalContent).addClass("mosaic-hidden");\n+                        }\n+                    }\n                 }\n             }\n \n             // Hide tab if fieldset has no visible items\n-            self.modal.$modal.find("fieldset").each(function () {\n+            modalContent.find("fieldset").each(function () {\n                 if ($(this).children("div:not(.mosaic-hidden)").length === 0) {\n                     $(\n                         "a[href=#fieldsetlegend-" + $(this).attr("id").split("-")[1] + "]"\n@@ -105,11 +93,11 @@ export default class Overlay {\n \n             // Select first tab\n             visible_tabs.eq(0).addClass("active");\n-            var $fieldset = self.modal.$modal.find(\n+            var $fieldset = modalContent.find(\n                 "#fieldset-" + visible_tabs.eq(0).attr("href").split("-")[1]\n             );\n             if ($fieldset.length === 0) {\n-                $fieldset = self.modal.$modal.find("fieldset:not(.mosaic-hidden)").eq(0);\n+                $fieldset = modalContent.find("fieldset:not(.mosaic-hidden)").eq(0);\n             }\n             $fieldset.addClass("active");\n         } else if (mode === "field") {\n@@ -118,7 +106,7 @@ export default class Overlay {\n             fieldset = field.parents("fieldset");\n \n             // Hide all fieldsets\n-            self.modal.$modal.find("fieldset").removeClass("active");\n+            modalContent.find("fieldset").removeClass("active");\n \n             // Show current fieldset\n             fieldset.addClass("active");\n@@ -130,7 +118,7 @@ export default class Overlay {\n             field.removeClass("mosaic-hidden");\n \n             // Hide form tabs\n-            self.modal.$modal.find("nav").addClass("mosaic-hidden");\n+            modalContent.find("nav").addClass("mosaic-hidden");\n         }\n     }\n \n'

