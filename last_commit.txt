Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.layout/commit/d7419b37af6604d4a8f73bcc60b19cb6e0b18c75

add icon resolver markup

Files changed:
M plone/app/layout/viewlets/menu.pt

b'diff --git a/plone/app/layout/viewlets/menu.pt b/plone/app/layout/viewlets/menu.pt\nindex ea6a0d3b..fd3d15d1 100644\n--- a/plone/app/layout/viewlets/menu.pt\n+++ b/plone/app/layout/viewlets/menu.pt\n@@ -1,4 +1,5 @@\n-<tal:contentviews tal:define="ploneview context/@@plone;"\n+<tal:contentviews tal:define="ploneview context/@@plone;\n+                              icons python:context.restrictedTraverse(\'@@iconresolver\');"\n                   tal:condition="ploneview/showToolbar"\n                   i18n:domain="plone">\n   <tal:actions tal:repeat="action options/actions">\n@@ -14,6 +15,8 @@\n           <span tal:attributes="class string:icon-${action/id}${action/cssClass|nothing}  toolbar-menu-icon;"\n                 class="icon-folderContents" aria-hidden="true">\n           </span>\n+          <tal:icon tal:condition="python:action[\'icon\']"\n+            tal:replace="structure python:icons.tag(action[\'icon\'] and action[\'icon\'] or \'toolbar-action\', tag_alt=action[\'id\'], tag_class=\'toolbarIcon\')" />\n           <span tal:content="action/title" i18n:translate="">View name</span>\n         </a>\n       </tal:var>\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.layout/commit/a051cf38cfe76b1cc3a40e3404b8271985077f5e

fix svg icon display

Files changed:
M plone/app/layout/viewlets/menu.pt

b'diff --git a/plone/app/layout/viewlets/menu.pt b/plone/app/layout/viewlets/menu.pt\nindex fd3d15d1..781d85b4 100644\n--- a/plone/app/layout/viewlets/menu.pt\n+++ b/plone/app/layout/viewlets/menu.pt\n@@ -14,9 +14,9 @@\n                            class action/cssClass|nothing;">\n           <span tal:attributes="class string:icon-${action/id}${action/cssClass|nothing}  toolbar-menu-icon;"\n                 class="icon-folderContents" aria-hidden="true">\n+            <tal:icon tal:condition="python:action[\'icon\']"\n+              tal:replace="structure python:icons.tag(action[\'icon\'] and action[\'icon\'] or \'toolbar-action\', tag_alt=action[\'id\'], tag_class=\'toolbarIcon\')" />\n           </span>\n-          <tal:icon tal:condition="python:action[\'icon\']"\n-            tal:replace="structure python:icons.tag(action[\'icon\'] and action[\'icon\'] or \'toolbar-action\', tag_alt=action[\'id\'], tag_class=\'toolbarIcon\')" />\n           <span tal:content="action/title" i18n:translate="">View name</span>\n         </a>\n       </tal:var>\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.layout/commit/8cba78fc7dc40ed8daf633ea1bd3e71bb040d36a

fix display of svg toolbar icons

Files changed:
M plone/app/layout/viewlets/menu.pt
M plone/app/layout/viewlets/toolbar.pt

b'diff --git a/plone/app/layout/viewlets/menu.pt b/plone/app/layout/viewlets/menu.pt\nindex 781d85b4..4dd1daa1 100644\n--- a/plone/app/layout/viewlets/menu.pt\n+++ b/plone/app/layout/viewlets/menu.pt\n@@ -33,7 +33,9 @@\n                            class action/cssClass|nothing">\n           <span tal:attributes="class python:locked and \'icon-lock\' or \'icon-history\'"\n                 class="icon-folderContents toolbar-menu-icon" aria-hidden="true">\n-          </span>\n+            <tal:icon tal:condition="python:action[\'icon\']"\n+              tal:replace="structure python:icons.tag(action[\'icon\'] and action[\'icon\'] or \'toolbar-action\', tag_alt=action[\'id\'], tag_class=\'toolbarIcon\')" />\n+            </span>\n           <span class="pat-moment" data-pat-moment="format:relative;"\n                 tal:content="context/ModificationDate">Modified</span>\n         </a>\ndiff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex 994af333..c8c49d3f 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -1,5 +1,6 @@\n <section id="edit-bar" role="toolbar"\n          tal:define="context_state view/context_state;\n+                     icons python:context.restrictedTraverse(\'@@iconresolver\');\n                      personal_bar python: view.get_personal_bar()"\n          tal:condition="context_state/is_toolbar_visible"\n          i18n:domain="plone">\n@@ -19,7 +20,9 @@\n               tal:condition="personal_bar/user_actions">\n             <a href="#"\n                tal:attributes="href personal_bar/homelink_url">\n-              <span class="icon-user" aria-hidden="true"></span>\n+              <span class="icon-user" aria-hidden="true">\n+                <tal:icon tal:replace="structure python:icons.tag(\'toolbar-action/personaltools\', tag_alt=\'portal-personaltools\', tag_class=\'toolbarIcon\')" />\n+              </span>\n               <span tal:content="personal_bar/user_name">User</span>\n               <span class="plone-toolbar-caret"></span>\n             </a>\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/7f7cd1641dbdb2cd91aae5669dcdb7e8da71ba99

Use pat-display-time from Patternslib in the toolbar and remove pat-moment from the history view.

Files changed:
A news/254.bugfix
M plone/app/layout/viewlets/content.py
M plone/app/layout/viewlets/content_history.pt
M plone/app/layout/viewlets/menu.pt

b'diff --git a/news/254.bugfix b/news/254.bugfix\nnew file mode 100644\nindex 00000000..42175d98\n--- /dev/null\n+++ b/news/254.bugfix\n@@ -0,0 +1,2 @@\n+Use pat-display-time from Patternslib in the toolbar and remove pat-moment from the history view.\n+[thet]\ndiff --git a/plone/app/layout/viewlets/content.py b/plone/app/layout/viewlets/content.py\nindex 88ef00fb..eb17758a 100644\n--- a/plone/app/layout/viewlets/content.py\n+++ b/plone/app/layout/viewlets/content.py\n@@ -497,15 +497,14 @@ def fullHistory(self):\n \n     def toLocalizedTime(self, time, long_format=None, time_only=None):\n         """Convert time to localized time"""\n-        return DateTime(time).ISO()\n-        # util = getToolByName(self.context, \'translation_service\')\n-        # return util.ulocalized_time(\n-        #     time,\n-        #     long_format,\n-        #     time_only,\n-        #     self.context,\n-        #     domain=\'plonelocales\'\n-        # )\n+        util = getToolByName(self.context, \'translation_service\')\n+        return util.ulocalized_time(\n+            time,\n+            long_format,\n+            time_only,\n+            self.context,\n+            domain=\'plonelocales\'\n+        )\n \n \n class ContentHistoryView(ContentHistoryViewlet):\ndiff --git a/plone/app/layout/viewlets/content_history.pt b/plone/app/layout/viewlets/content_history.pt\nindex 1e9424c9..8920dbf9 100644\n--- a/plone/app/layout/viewlets/content_history.pt\n+++ b/plone/app/layout/viewlets/content_history.pt\n@@ -41,11 +41,10 @@\n                                    tal:replace="actor_name"/>\n                             </tal:actor>\n                             on\n-                            <span i18n:translate=""  i18n:name="time" tal:content="python:view.toLocalizedTime(item[\'time\'],long_format=True)" class="pat-moment" data-pat-moment="format:relative;"/>\n+                            <span i18n:translate="" i18n:name="time" tal:content="python:view.toLocalizedTime(item[\'time\'],long_format=True)"/>\n                         </tal:action>\n                         <tal:effective tal:condition="effective|nothing">\n-                            (<span i18n:translate="label_publishing_effective" tal:omit-tag="">effective</span>:\n-                            <span tal:content="python:item[\'effective\']" class="pat-moment" data-pat-moment="format:relative;" />)\n+                            (<span i18n:translate="label_publishing_effective" tal:omit-tag="">effective</span>: ${effectiveDate})\n                         </tal:effective>\n \n                     </span>\ndiff --git a/plone/app/layout/viewlets/menu.pt b/plone/app/layout/viewlets/menu.pt\nindex 4dd1daa1..25b36afa 100644\n--- a/plone/app/layout/viewlets/menu.pt\n+++ b/plone/app/layout/viewlets/menu.pt\n@@ -35,9 +35,12 @@\n                 class="icon-folderContents toolbar-menu-icon" aria-hidden="true">\n             <tal:icon tal:condition="python:action[\'icon\']"\n               tal:replace="structure python:icons.tag(action[\'icon\'] and action[\'icon\'] or \'toolbar-action\', tag_alt=action[\'id\'], tag_class=\'toolbarIcon\')" />\n-            </span>\n-          <span class="pat-moment" data-pat-moment="format:relative;"\n-                tal:content="context/ModificationDate">Modified</span>\n+          </span>\n+          <time\n+              class="pat-display-time"\n+              data-pat-display-time="from-now: true"\n+              datetime="${context/ModificationDate}"\n+              tal:content="">${context/ModificationDate}</time>\n         </a>\n       </tal:var>\n     </li>\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.layout/commit/aca4c803c874cc295e88959eb918eeea04133024

update toolbar markup to Bootstrap5 Sidebars

Files changed:
M plone/app/layout/viewlets/contentviews.pt
M plone/app/layout/viewlets/menu.pt
M plone/app/layout/viewlets/toolbar.pt

b'diff --git a/plone/app/layout/viewlets/contentviews.pt b/plone/app/layout/viewlets/contentviews.pt\nindex c0d759d6..7184bb9a 100644\n--- a/plone/app/layout/viewlets/contentviews.pt\n+++ b/plone/app/layout/viewlets/contentviews.pt\n@@ -5,9 +5,11 @@\n   <tal:block define="actions view/tabSet1;">\n     <div tal:replace="structure python: view.menu_template(actions=actions)" />\n   </tal:block>\n+  <hr />\n   <tal:contentmenus>\n     <div tal:replace="structure provider:plone.contentmenu" />\n   </tal:contentmenus>\n+  <hr />\n   <tal:block define="actions view/tabSet2;">\n     <div tal:replace="structure python: view.menu_template(actions=actions)" />\n   </tal:block>\ndiff --git a/plone/app/layout/viewlets/menu.pt b/plone/app/layout/viewlets/menu.pt\nindex 25b36afa..ffd8ac4f 100644\n--- a/plone/app/layout/viewlets/menu.pt\n+++ b/plone/app/layout/viewlets/menu.pt\n@@ -1,48 +1,34 @@\n <tal:contentviews tal:define="ploneview context/@@plone;\n+                              locked view/locked_icon;\n                               icons python:context.restrictedTraverse(\'@@iconresolver\');"\n                   tal:condition="ploneview/showToolbar"\n                   i18n:domain="plone">\n   <tal:actions tal:repeat="action options/actions">\n-    <li tal:attributes="id string:contentview-${action/id};\n-                        class python: action.get(\'selected\') and \'active\' or \'\'"\n-        tal:define="actionid action/id"\n-        tal:condition="python:actionid != \'history\'">\n-      <tal:var define="selected action/selected|nothing;">\n-        <a href="#"\n+    <li id="contentview-${action/id}" class="nav-item"\n+        tal:define="actionid action/id;\n+                    selected action/selected | python:False">\n+\n+        <a href="#" class="nav-link ${python:\'text-warning\' if locked and actionid == \'history\' else \'text-white\'} ${action/cssClass | nothing} ${python:\'active\' if selected else None}"\n            tal:attributes="href action/url;\n-                           target action/link_target|nothing;\n-                           class action/cssClass|nothing;">\n-          <span tal:attributes="class string:icon-${action/id}${action/cssClass|nothing}  toolbar-menu-icon;"\n-                class="icon-folderContents" aria-hidden="true">\n+                           target action/link_target|nothing;">\n+\n+          <tal:if condition="python:actionid != \'history\'">\n             <tal:icon tal:condition="python:action[\'icon\']"\n-              tal:replace="structure python:icons.tag(action[\'icon\'] and action[\'icon\'] or \'toolbar-action\', tag_alt=action[\'id\'], tag_class=\'toolbarIcon\')" />\n-          </span>\n-          <span tal:content="action/title" i18n:translate="">View name</span>\n+                      tal:replace="structure python:icons.tag(action[\'icon\'] or \'toolbar-action\', tag_alt=action[\'id\'], tag_class=\'me-1\')" />\n+            <span tal:content="action/title" i18n:translate="">View name</span>\n+          </tal:if>\n+\n+          <tal:if tal:condition="python:actionid == \'history\'">\n+            <tal:icon tal:replace="structure python:icons.tag(\'lock\' if locked else action[\'icon\'], tag_alt=action[\'id\'], tag_class=\'me-1\')" />\n+            <time\n+                class="pat-display-time"\n+                data-pat-display-time="from-now: true"\n+                datetime="${context/ModificationDate}"\n+                tal:content="">${context/ModificationDate}</time>\n+          </tal:if>\n+\n         </a>\n-      </tal:var>\n-    </li>\n-    <li tal:attributes="id string:contentview-${action/id};\n-                        class python: action.get(\'selected\') and \'active\' or \'\'"\n-        tal:define="actionid action/id"\n-        tal:condition="python:actionid == \'history\'">\n-      <tal:var define="selected action/selected|nothing;\n-                       locked view/locked_icon">\n-        <a href="#"\n-           tal:attributes="href action/url;\n-                           target action/link_target|nothing;\n-                           class action/cssClass|nothing">\n-          <span tal:attributes="class python:locked and \'icon-lock\' or \'icon-history\'"\n-                class="icon-folderContents toolbar-menu-icon" aria-hidden="true">\n-            <tal:icon tal:condition="python:action[\'icon\']"\n-              tal:replace="structure python:icons.tag(action[\'icon\'] and action[\'icon\'] or \'toolbar-action\', tag_alt=action[\'id\'], tag_class=\'toolbarIcon\')" />\n-          </span>\n-          <time\n-              class="pat-display-time"\n-              data-pat-display-time="from-now: true"\n-              datetime="${context/ModificationDate}"\n-              tal:content="">${context/ModificationDate}</time>\n-        </a>\n-      </tal:var>\n+\n     </li>\n   </tal:actions>\n </tal:contentviews>\ndiff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex c8c49d3f..fc451c6f 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -4,47 +4,62 @@\n                      personal_bar python: view.get_personal_bar()"\n          tal:condition="context_state/is_toolbar_visible"\n          i18n:domain="plone">\n-  <div id="edit-zone" role="toolbar" class="pat-toolbar" data-pat-toolbar="${view/get_options}">\n-    <div class="plone-toolbar-container">\n-      <a class="plone-toolbar-logo">\n-        <img alt="Plone Toolbar" tal:attributes="src view/get_toolbar_logo" />\n+\n+  <div class="bg-dark h-100 position-fixed top-0 start-0 d-flex d-md-none flex-column offcanvas-toggler">\n+    <div class="toggler-header px-1 py-3">\n+      <img alt="Plone Toolbar" tal:attributes="src view/get_toolbar_logo" class="img-fluid" />\n+    </div>\n+    <a class="d-block p-1 text-white my-auto" data-bs-toggle="offcanvas" href="#edit-zone">\n+      <tal:icon tal:replace="structure python:icons.tag(\'arrow-bar-right\')" />\n+    </a>\n+  </div>\n+\n+  <div id="edit-zone" role="toolbar"\n+       class="pat-toolbar bg-dark text-white position-fixed top-0 start-0 h-100 overflow-scroll d-flex flex-column"\n+       data-bs-scroll="true" data-bs-backdrop="false"\n+       data-pat-toolbar="${view/get_options}">\n+       <!-- class="pat-toolbar bg-dark text-white offcanvas offcanvas-start show h-100 overflow-scroll" -->\n+    <div class="offcanvas-header mb-3 bg-primary">\n+      <a class="text-white text-decoration-none">\n+        <img alt="Plone Toolbar" tal:attributes="src view/get_toolbar_logo" class="img-fluid" />\n       </a>\n-      <a class="plone-toolbar-switcher" tal:condition="view/show_switcher"><span i18n:translate="label_toolbar_switcher">Left-Top switcher</span></a>\n-      <nav>\n-        <ul class="plone-toolbar-main">\n-          <div tal:replace="structure view/base_render">\n-          </div>\n-        </ul>\n-        <ul id="personal-bar-container">\n-          <li id="portal-personaltools" class="plone-toolbar-separator"\n-              tal:condition="personal_bar/user_actions">\n-            <a href="#"\n-               tal:attributes="href personal_bar/homelink_url">\n-              <span class="icon-user" aria-hidden="true">\n-                <tal:icon tal:replace="structure python:icons.tag(\'toolbar-action/personaltools\', tag_alt=\'portal-personaltools\', tag_class=\'toolbarIcon\')" />\n-              </span>\n-              <span tal:content="personal_bar/user_name">User</span>\n-              <span class="plone-toolbar-caret"></span>\n+      <button type="button" class="btn-close text-white d-md-none" data-bs-dismiss="offcanvas" aria-label="Close"></button>\n+    </div>\n+\n+    <ul class="nav nav-pills flex-column flex-shrink-0 plone-toolbar-main"\n+        tal:define="toolbar_main view/base_render"\n+        tal:condition="toolbar_main">\n+      <div tal:replace="structure toolbar_main">\n+      </div>\n+    </ul>\n+\n+    <div tal:condition="personal_bar/user_actions" class="mt-auto mb-3">\n+\n+      <hr class="nav-divider" />\n+\n+      <a id="personaltools-menulink"\n+        class="text-white nav-link dropdown-toggle collapsed"\n+        data-bs-toggle="collapse"\n+        data-bs-target="#collapse-personaltools"\n+        aria-expanded="false"\n+        tal:attributes="href personal_bar/homelink_url">\n+        <tal:icon tal:replace="structure python:icons.tag(\'toolbar-action/personaltools\', tag_alt=\'portal-personaltools\', tag_class=\'me-1\')" />\n+        <span tal:replace="personal_bar/user_name">User</span>\n+      </a>\n+\n+      <div id="collapse-personaltools" class="collapse">\n+        <ul class="nav nav-pills flex-column small" aria-labelledby="personaltools-menulink">\n+          <li class="ps-3" tal:repeat="action personal_bar/user_actions">\n+            <a href="${action/href}" class="nav-link text-white">\n+              <tal:icon replace="structure python:icons.tag(action.get(\'icon\', \'dot\'), tag_alt=\'portal-personaltools\', tag_class=\'me-1\')" />\n+              <tal:actionname tal:content="action/title">\n+                action title\n+              </tal:actionname>\n             </a>\n-            <ul>\n-              <li class="plone-toolbar-submenu-header">\n-                <span tal:content="personal_bar/user_name">Username</span>\n-              </li>\n-              <li class="user-action"\n-                  tal:repeat="action personal_bar/user_actions">\n-                <a href="" tal:attributes="action">\n-                  <tal:actionname tal:content="action/title">\n-                     action title\n-                  </tal:actionname>\n-                  <tal:islogout condition="python:action[\'id\'] == \'personaltools-logout\'">\n-                    <span class="icon-logout"></span>\n-                  </tal:islogout>\n-                </a>\n-              </li>\n-            </ul>\n           </li>\n         </ul>\n-      </nav>\n+      </div>\n+\n     </div>\n   </div>\n </section>\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/6a8f409868e19b6812dacbf89ad0959a4934e51a

PLIP 3211 - Plone toolbar not configurable via lessvariables any more.

Files changed:
M plone/app/layout/viewlets/toolbar.pt
M plone/app/layout/viewlets/toolbar.py

b'diff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex fc451c6f..64ab7f00 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -16,9 +16,7 @@\n \n   <div id="edit-zone" role="toolbar"\n        class="pat-toolbar bg-dark text-white position-fixed top-0 start-0 h-100 overflow-scroll d-flex flex-column"\n-       data-bs-scroll="true" data-bs-backdrop="false"\n-       data-pat-toolbar="${view/get_options}">\n-       <!-- class="pat-toolbar bg-dark text-white offcanvas offcanvas-start show h-100 overflow-scroll" -->\n+       data-bs-scroll="true" data-bs-backdrop="false">\n     <div class="offcanvas-header mb-3 bg-primary">\n       <a class="text-white text-decoration-none">\n         <img alt="Plone Toolbar" tal:attributes="src view/get_toolbar_logo" class="img-fluid" />\ndiff --git a/plone/app/layout/viewlets/toolbar.py b/plone/app/layout/viewlets/toolbar.py\nindex 0134580a..7e48e1b2 100644\n--- a/plone/app/layout/viewlets/toolbar.py\n+++ b/plone/app/layout/viewlets/toolbar.py\n@@ -8,8 +8,6 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n-import json\n-\n \n class ToolbarViewletManager(OrderedViewletManager):\n     custom_template = ViewPageTemplateFile("toolbar.pt")\n@@ -30,25 +28,6 @@ def context_state(self):\n     def portal_state(self):\n         return getMultiAdapter((self.context, self.request), name="plone_portal_state")\n \n-    def get_options(self):\n-        registry = getUtility(IRegistry)\n-        options = {}\n-\n-        lessvars = registry.get("plone.lessvariables", {})\n-\n-        toolbar_width = lessvars.get("plone-left-toolbar-expanded", None)\n-        submenu_width = lessvars.get("plone-toolbar-submenu-width", None)\n-        desktop_width = lessvars.get("plone-screen-sm-min", None)\n-\n-        if toolbar_width:\n-            options["toolbar_width"] = toolbar_width\n-        if submenu_width:\n-            options["submenu_width"] = submenu_width\n-        if desktop_width:\n-            options["desktop_width"] = desktop_width\n-\n-        return json.dumps(options)\n-\n     def get_personal_bar(self):\n         viewlet = PersonalBarViewlet(self.context, self.request, self.__parent__, self)\n         viewlet.update()\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.layout/commit/40dedce42461190daa5704007feb41b5e09babf1

toolbar offcanvas support

Files changed:
M plone/app/layout/viewlets/toolbar.pt

b'diff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex 64ab7f00..b3cfcf79 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -5,17 +5,17 @@\n          tal:condition="context_state/is_toolbar_visible"\n          i18n:domain="plone">\n \n-  <div class="bg-dark h-100 position-fixed top-0 start-0 d-flex d-md-none flex-column offcanvas-toggler">\n+  <div class="bg-dark h-100 d-flex d-md-none flex-column offcanvas-toggler">\n     <div class="toggler-header px-1 py-3">\n       <img alt="Plone Toolbar" tal:attributes="src view/get_toolbar_logo" class="img-fluid" />\n     </div>\n-    <a class="d-block p-1 text-white my-auto" data-bs-toggle="offcanvas" href="#edit-zone">\n+    <a class="d-flex flex-column justify-content-center h-100 w-100 text-white" data-bs-toggle="offcanvas" href="#edit-zone">\n       <tal:icon tal:replace="structure python:icons.tag(\'arrow-bar-right\')" />\n     </a>\n   </div>\n \n   <div id="edit-zone" role="toolbar"\n-       class="pat-toolbar bg-dark text-white position-fixed top-0 start-0 h-100 overflow-scroll d-flex flex-column"\n+       class="pat-toolbar bg-dark text-white offcanvas offcanvas-start"\n        data-bs-scroll="true" data-bs-backdrop="false">\n     <div class="offcanvas-header mb-3 bg-primary">\n       <a class="text-white text-decoration-none">\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.layout/commit/b859dafea3f16ec6f08301b2cdefaf25a40217d3

toolbar update: expanded/collapsed mode

Files changed:
M plone/app/layout/viewlets/contentviews.pt
M plone/app/layout/viewlets/menu.pt
M plone/app/layout/viewlets/toolbar.pt
D plone/app/layout/viewlets/contentactions_blank.pt

b'diff --git a/plone/app/layout/viewlets/contentactions_blank.pt b/plone/app/layout/viewlets/contentactions_blank.pt\ndeleted file mode 100644\nindex 41b946df..00000000\n--- a/plone/app/layout/viewlets/contentactions_blank.pt\n+++ /dev/null\n@@ -1,5 +0,0 @@\n-<div class="contentActions"\n-     tal:define="ploneview context/@@plone"\n-     tal:condition="ploneview/showToolbar">\n-\n-</div>\ndiff --git a/plone/app/layout/viewlets/contentviews.pt b/plone/app/layout/viewlets/contentviews.pt\nindex 7184bb9a..b84c3627 100644\n--- a/plone/app/layout/viewlets/contentviews.pt\n+++ b/plone/app/layout/viewlets/contentviews.pt\n@@ -5,11 +5,15 @@\n   <tal:block define="actions view/tabSet1;">\n     <div tal:replace="structure python: view.menu_template(actions=actions)" />\n   </tal:block>\n-  <hr />\n+\n+  <li class="border-top my-2">\n+\n   <tal:contentmenus>\n     <div tal:replace="structure provider:plone.contentmenu" />\n   </tal:contentmenus>\n-  <hr />\n+\n+  <li class="border-top my-2">\n+\n   <tal:block define="actions view/tabSet2;">\n     <div tal:replace="structure python: view.menu_template(actions=actions)" />\n   </tal:block>\ndiff --git a/plone/app/layout/viewlets/menu.pt b/plone/app/layout/viewlets/menu.pt\nindex ffd8ac4f..89a5e887 100644\n--- a/plone/app/layout/viewlets/menu.pt\n+++ b/plone/app/layout/viewlets/menu.pt\n@@ -8,7 +8,7 @@\n         tal:define="actionid action/id;\n                     selected action/selected | python:False">\n \n-        <a href="#" class="nav-link ${python:\'text-warning\' if locked and actionid == \'history\' else \'text-white\'} ${action/cssClass | nothing} ${python:\'active\' if selected else None}"\n+        <a href="#" class="nav-link ${python:\'locked\' if locked and actionid == \'history\' else \'\'} ${action/cssClass | nothing} ${python:\'active\' if selected else None}"\n            tal:attributes="href action/url;\n                            target action/link_target|nothing;">\n \ndiff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex b3cfcf79..cdde430b 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -5,38 +5,41 @@\n          tal:condition="context_state/is_toolbar_visible"\n          i18n:domain="plone">\n \n-  <div class="bg-dark h-100 d-flex d-md-none flex-column offcanvas-toggler">\n-    <div class="toggler-header px-1 py-3">\n-      <img alt="Plone Toolbar" tal:attributes="src view/get_toolbar_logo" class="img-fluid" />\n+    <div class="h-100 offcanvas-toggler bg-dark">\n+      <div class="toggler-header">\n+        <a class="d-block" data-bs-toggle="offcanvas" href="#edit-zone">\n+          <tal:icon tal:replace="structure python:icons.tag(\'list\')" />\n+        </a>\n+      </div>\n     </div>\n-    <a class="d-flex flex-column justify-content-center h-100 w-100 text-white" data-bs-toggle="offcanvas" href="#edit-zone">\n-      <tal:icon tal:replace="structure python:icons.tag(\'arrow-bar-right\')" />\n-    </a>\n-  </div>\n \n   <div id="edit-zone" role="toolbar"\n-       class="pat-toolbar bg-dark text-white offcanvas offcanvas-start"\n+       class="pat-toolbar offcanvas offcanvas-start bg-dark"\n        data-bs-scroll="true" data-bs-backdrop="false">\n+\n     <div class="offcanvas-header mb-3 bg-primary">\n-      <a class="text-white text-decoration-none">\n-        <img alt="Plone Toolbar" tal:attributes="src view/get_toolbar_logo" class="img-fluid" />\n+      <a class="offcanvas-dismiss text-white" data-bs-dismiss="offcanvas" aria-label="Dismiss" href="#edit-zone">\n+        <tal:icon tal:replace="structure python:icons.tag(\'x-lg\')" />\n+      </a>\n+      <a class="offcanvas-unpin text-white" data-bs-dismiss="offcanvas" aria-label="Unpin" href="#edit-zone">\n+        <tal:icon tal:replace="structure python:icons.tag(\'arrow-bar-left\')" />\n+      </a>\n+      <a class="offcanvas-pin text-white" data-bs-dismiss="offcanvas" aria-label="Pin" href="#edit-zone">\n+        <tal:icon tal:replace="structure python:icons.tag(\'pin-angle\')" />\n       </a>\n-      <button type="button" class="btn-close text-white d-md-none" data-bs-dismiss="offcanvas" aria-label="Close"></button>\n     </div>\n \n-    <ul class="nav nav-pills flex-column flex-shrink-0 plone-toolbar-main"\n+    <ul class="nav nav-pills flex-column flex-nowrap flex-shrink-0 plone-toolbar-main"\n         tal:define="toolbar_main view/base_render"\n         tal:condition="toolbar_main">\n-      <div tal:replace="structure toolbar_main">\n-      </div>\n+      <li tal:replace="structure toolbar_main">\n+      </li>\n     </ul>\n \n-    <div tal:condition="personal_bar/user_actions" class="mt-auto mb-3">\n-\n-      <hr class="nav-divider" />\n+    <div tal:condition="personal_bar/user_actions" class="mt-auto py-2 border-top">\n \n       <a id="personaltools-menulink"\n-        class="text-white nav-link dropdown-toggle collapsed"\n+        class="nav-link dropdown-toggle collapsed"\n         data-bs-toggle="collapse"\n         data-bs-target="#collapse-personaltools"\n         aria-expanded="false"\n@@ -48,7 +51,7 @@\n       <div id="collapse-personaltools" class="collapse">\n         <ul class="nav nav-pills flex-column small" aria-labelledby="personaltools-menulink">\n           <li class="ps-3" tal:repeat="action personal_bar/user_actions">\n-            <a href="${action/href}" class="nav-link text-white">\n+            <a href="${action/href}" class="nav-link">\n               <tal:icon replace="structure python:icons.tag(action.get(\'icon\', \'dot\'), tag_alt=\'portal-personaltools\', tag_class=\'me-1\')" />\n               <tal:actionname tal:content="action/title">\n                 action title\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: petschki (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.layout/commit/f6a04ab45b3a6c88ef82b55774f0ae0c783031f9

enable offcanvas backdrop

Files changed:
M plone/app/layout/viewlets/toolbar.pt

b'diff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex cdde430b..7709e9ed 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -14,8 +14,7 @@\n     </div>\n \n   <div id="edit-zone" role="toolbar"\n-       class="pat-toolbar offcanvas offcanvas-start bg-dark"\n-       data-bs-scroll="true" data-bs-backdrop="false">\n+       class="pat-toolbar offcanvas offcanvas-start bg-dark">\n \n     <div class="offcanvas-header mb-3 bg-primary">\n       <a class="offcanvas-dismiss text-white" data-bs-dismiss="offcanvas" aria-label="Dismiss" href="#edit-zone">\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.layout/commit/ab35bf9cdfa44cd94126359d0483d1d54283be43

toolbar topmode

Files changed:
M plone/app/layout/viewlets/toolbar.pt

b'diff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex 7709e9ed..3f5c5831 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -28,28 +28,29 @@\n       </a>\n     </div>\n \n-    <ul class="nav nav-pills flex-column flex-nowrap flex-shrink-0 plone-toolbar-main"\n+    <ul class="nav flex-column plone-toolbar-main"\n         tal:define="toolbar_main view/base_render"\n         tal:condition="toolbar_main">\n       <li tal:replace="structure toolbar_main">\n       </li>\n     </ul>\n \n-    <div tal:condition="personal_bar/user_actions" class="mt-auto py-2 border-top">\n+    <div tal:condition="personal_bar/user_actions" class="personaltools-wrapper">\n \n       <a id="personaltools-menulink"\n         class="nav-link dropdown-toggle collapsed"\n         data-bs-toggle="collapse"\n         data-bs-target="#collapse-personaltools"\n+        data-bs-\n         aria-expanded="false"\n         tal:attributes="href personal_bar/homelink_url">\n         <tal:icon tal:replace="structure python:icons.tag(\'toolbar-action/personaltools\', tag_alt=\'portal-personaltools\', tag_class=\'me-1\')" />\n         <span tal:replace="personal_bar/user_name">User</span>\n       </a>\n \n-      <div id="collapse-personaltools" class="collapse">\n+      <div id="collapse-personaltools" class="collapse" data-bs-parent="#edit-zone">\n         <ul class="nav nav-pills flex-column small" aria-labelledby="personaltools-menulink">\n-          <li class="ps-3" tal:repeat="action personal_bar/user_actions">\n+          <li tal:repeat="action personal_bar/user_actions">\n             <a href="${action/href}" class="nav-link">\n               <tal:icon replace="structure python:icons.tag(action.get(\'icon\', \'dot\'), tag_alt=\'portal-personaltools\', tag_class=\'me-1\')" />\n               <tal:actionname tal:content="action/title">\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.layout/commit/bf43d232c25f282d48dc1d3f7b2981ed7e43d7b0

implement hovering events for collapsed toolbar

Files changed:
M plone/app/layout/viewlets/toolbar.pt

b'diff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex 3f5c5831..543cf342 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -6,11 +6,10 @@\n          i18n:domain="plone">\n \n     <div class="h-100 offcanvas-toggler bg-dark">\n-      <div class="toggler-header">\n-        <a class="d-block" data-bs-toggle="offcanvas" href="#edit-zone">\n-          <tal:icon tal:replace="structure python:icons.tag(\'list\')" />\n-        </a>\n-      </div>\n+      <a class="toggler-header" data-bs-toggle="offcanvas" href="#edit-zone">\n+        <tal:icon tal:replace="structure python:icons.tag(\'list\')" />\n+      </a>\n+      <a class="toggler-hover"></a>\n     </div>\n \n   <div id="edit-zone" role="toolbar"\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-23T21:13:45+01:00
Author: petschki (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.layout/commit/d2374db5a699eaaab327dddc16a7f6e676eec4c3

toolbar toggler markup

Files changed:
M plone/app/layout/viewlets/toolbar.pt

b'diff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex 543cf342..d3c61e97 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -5,12 +5,13 @@\n          tal:condition="context_state/is_toolbar_visible"\n          i18n:domain="plone">\n \n-    <div class="h-100 offcanvas-toggler bg-dark">\n-      <a class="toggler-header" data-bs-toggle="offcanvas" href="#edit-zone">\n+  <div class="h-100 offcanvas-toggler bg-dark">\n+    <a class="toggler-hover" data-bs-toggle="offcanvas" href="#edit-zone">\n+      <span class="toggler-header">\n         <tal:icon tal:replace="structure python:icons.tag(\'list\')" />\n-      </a>\n-      <a class="toggler-hover"></a>\n-    </div>\n+      </span>\n+    </a>\n+  </div>\n \n   <div id="edit-zone" role="toolbar"\n        class="pat-toolbar offcanvas offcanvas-start bg-dark">\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-24T12:39:08+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/75982fda75832329b7baa54906aff801df085feb

Add newsfile.

Files changed:
A news/254-2.bugfix

b'diff --git a/news/254-2.bugfix b/news/254-2.bugfix\nnew file mode 100644\nindex 00000000..654b73b0\n--- /dev/null\n+++ b/news/254-2.bugfix\n@@ -0,0 +1,5 @@\n+Use icon resolver from Plone 6 and use SVG icons.\n+[agitator]\n+\n+Integrate new toolbar.\n+[petschki]\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-03-24T15:24:05+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/7acae92faf06d967eef433fe911037134a4799ef

Merge pull request #254 from plone/barceloneta-lts-svg-icons

Barceloneta lts svg icons

Files changed:
A news/254-2.bugfix
A news/254.bugfix
M plone/app/layout/viewlets/content.py
M plone/app/layout/viewlets/content_history.pt
M plone/app/layout/viewlets/contentviews.pt
M plone/app/layout/viewlets/menu.pt
M plone/app/layout/viewlets/toolbar.pt
M plone/app/layout/viewlets/toolbar.py
D plone/app/layout/viewlets/contentactions_blank.pt

b'diff --git a/news/254-2.bugfix b/news/254-2.bugfix\nnew file mode 100644\nindex 00000000..654b73b0\n--- /dev/null\n+++ b/news/254-2.bugfix\n@@ -0,0 +1,5 @@\n+Use icon resolver from Plone 6 and use SVG icons.\n+[agitator]\n+\n+Integrate new toolbar.\n+[petschki]\ndiff --git a/news/254.bugfix b/news/254.bugfix\nnew file mode 100644\nindex 00000000..42175d98\n--- /dev/null\n+++ b/news/254.bugfix\n@@ -0,0 +1,2 @@\n+Use pat-display-time from Patternslib in the toolbar and remove pat-moment from the history view.\n+[thet]\ndiff --git a/plone/app/layout/viewlets/content.py b/plone/app/layout/viewlets/content.py\nindex 88ef00fb..eb17758a 100644\n--- a/plone/app/layout/viewlets/content.py\n+++ b/plone/app/layout/viewlets/content.py\n@@ -497,15 +497,14 @@ def fullHistory(self):\n \n     def toLocalizedTime(self, time, long_format=None, time_only=None):\n         """Convert time to localized time"""\n-        return DateTime(time).ISO()\n-        # util = getToolByName(self.context, \'translation_service\')\n-        # return util.ulocalized_time(\n-        #     time,\n-        #     long_format,\n-        #     time_only,\n-        #     self.context,\n-        #     domain=\'plonelocales\'\n-        # )\n+        util = getToolByName(self.context, \'translation_service\')\n+        return util.ulocalized_time(\n+            time,\n+            long_format,\n+            time_only,\n+            self.context,\n+            domain=\'plonelocales\'\n+        )\n \n \n class ContentHistoryView(ContentHistoryViewlet):\ndiff --git a/plone/app/layout/viewlets/content_history.pt b/plone/app/layout/viewlets/content_history.pt\nindex 1e9424c9..8920dbf9 100644\n--- a/plone/app/layout/viewlets/content_history.pt\n+++ b/plone/app/layout/viewlets/content_history.pt\n@@ -41,11 +41,10 @@\n                                    tal:replace="actor_name"/>\n                             </tal:actor>\n                             on\n-                            <span i18n:translate=""  i18n:name="time" tal:content="python:view.toLocalizedTime(item[\'time\'],long_format=True)" class="pat-moment" data-pat-moment="format:relative;"/>\n+                            <span i18n:translate="" i18n:name="time" tal:content="python:view.toLocalizedTime(item[\'time\'],long_format=True)"/>\n                         </tal:action>\n                         <tal:effective tal:condition="effective|nothing">\n-                            (<span i18n:translate="label_publishing_effective" tal:omit-tag="">effective</span>:\n-                            <span tal:content="python:item[\'effective\']" class="pat-moment" data-pat-moment="format:relative;" />)\n+                            (<span i18n:translate="label_publishing_effective" tal:omit-tag="">effective</span>: ${effectiveDate})\n                         </tal:effective>\n \n                     </span>\ndiff --git a/plone/app/layout/viewlets/contentactions_blank.pt b/plone/app/layout/viewlets/contentactions_blank.pt\ndeleted file mode 100644\nindex 41b946df..00000000\n--- a/plone/app/layout/viewlets/contentactions_blank.pt\n+++ /dev/null\n@@ -1,5 +0,0 @@\n-<div class="contentActions"\n-     tal:define="ploneview context/@@plone"\n-     tal:condition="ploneview/showToolbar">\n-\n-</div>\ndiff --git a/plone/app/layout/viewlets/contentviews.pt b/plone/app/layout/viewlets/contentviews.pt\nindex c0d759d6..b84c3627 100644\n--- a/plone/app/layout/viewlets/contentviews.pt\n+++ b/plone/app/layout/viewlets/contentviews.pt\n@@ -5,9 +5,15 @@\n   <tal:block define="actions view/tabSet1;">\n     <div tal:replace="structure python: view.menu_template(actions=actions)" />\n   </tal:block>\n+\n+  <li class="border-top my-2">\n+\n   <tal:contentmenus>\n     <div tal:replace="structure provider:plone.contentmenu" />\n   </tal:contentmenus>\n+\n+  <li class="border-top my-2">\n+\n   <tal:block define="actions view/tabSet2;">\n     <div tal:replace="structure python: view.menu_template(actions=actions)" />\n   </tal:block>\ndiff --git a/plone/app/layout/viewlets/menu.pt b/plone/app/layout/viewlets/menu.pt\nindex ea6a0d3b..89a5e887 100644\n--- a/plone/app/layout/viewlets/menu.pt\n+++ b/plone/app/layout/viewlets/menu.pt\n@@ -1,40 +1,34 @@\n-<tal:contentviews tal:define="ploneview context/@@plone;"\n+<tal:contentviews tal:define="ploneview context/@@plone;\n+                              locked view/locked_icon;\n+                              icons python:context.restrictedTraverse(\'@@iconresolver\');"\n                   tal:condition="ploneview/showToolbar"\n                   i18n:domain="plone">\n   <tal:actions tal:repeat="action options/actions">\n-    <li tal:attributes="id string:contentview-${action/id};\n-                        class python: action.get(\'selected\') and \'active\' or \'\'"\n-        tal:define="actionid action/id"\n-        tal:condition="python:actionid != \'history\'">\n-      <tal:var define="selected action/selected|nothing;">\n-        <a href="#"\n+    <li id="contentview-${action/id}" class="nav-item"\n+        tal:define="actionid action/id;\n+                    selected action/selected | python:False">\n+\n+        <a href="#" class="nav-link ${python:\'locked\' if locked and actionid == \'history\' else \'\'} ${action/cssClass | nothing} ${python:\'active\' if selected else None}"\n            tal:attributes="href action/url;\n-                           target action/link_target|nothing;\n-                           class action/cssClass|nothing;">\n-          <span tal:attributes="class string:icon-${action/id}${action/cssClass|nothing}  toolbar-menu-icon;"\n-                class="icon-folderContents" aria-hidden="true">\n-          </span>\n-          <span tal:content="action/title" i18n:translate="">View name</span>\n+                           target action/link_target|nothing;">\n+\n+          <tal:if condition="python:actionid != \'history\'">\n+            <tal:icon tal:condition="python:action[\'icon\']"\n+                      tal:replace="structure python:icons.tag(action[\'icon\'] or \'toolbar-action\', tag_alt=action[\'id\'], tag_class=\'me-1\')" />\n+            <span tal:content="action/title" i18n:translate="">View name</span>\n+          </tal:if>\n+\n+          <tal:if tal:condition="python:actionid == \'history\'">\n+            <tal:icon tal:replace="structure python:icons.tag(\'lock\' if locked else action[\'icon\'], tag_alt=action[\'id\'], tag_class=\'me-1\')" />\n+            <time\n+                class="pat-display-time"\n+                data-pat-display-time="from-now: true"\n+                datetime="${context/ModificationDate}"\n+                tal:content="">${context/ModificationDate}</time>\n+          </tal:if>\n+\n         </a>\n-      </tal:var>\n-    </li>\n-    <li tal:attributes="id string:contentview-${action/id};\n-                        class python: action.get(\'selected\') and \'active\' or \'\'"\n-        tal:define="actionid action/id"\n-        tal:condition="python:actionid == \'history\'">\n-      <tal:var define="selected action/selected|nothing;\n-                       locked view/locked_icon">\n-        <a href="#"\n-           tal:attributes="href action/url;\n-                           target action/link_target|nothing;\n-                           class action/cssClass|nothing">\n-          <span tal:attributes="class python:locked and \'icon-lock\' or \'icon-history\'"\n-                class="icon-folderContents toolbar-menu-icon" aria-hidden="true">\n-          </span>\n-          <span class="pat-moment" data-pat-moment="format:relative;"\n-                tal:content="context/ModificationDate">Modified</span>\n-        </a>\n-      </tal:var>\n+\n     </li>\n   </tal:actions>\n </tal:contentviews>\ndiff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex 994af333..d3c61e97 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -1,47 +1,66 @@\n <section id="edit-bar" role="toolbar"\n          tal:define="context_state view/context_state;\n+                     icons python:context.restrictedTraverse(\'@@iconresolver\');\n                      personal_bar python: view.get_personal_bar()"\n          tal:condition="context_state/is_toolbar_visible"\n          i18n:domain="plone">\n-  <div id="edit-zone" role="toolbar" class="pat-toolbar" data-pat-toolbar="${view/get_options}">\n-    <div class="plone-toolbar-container">\n-      <a class="plone-toolbar-logo">\n-        <img alt="Plone Toolbar" tal:attributes="src view/get_toolbar_logo" />\n+\n+  <div class="h-100 offcanvas-toggler bg-dark">\n+    <a class="toggler-hover" data-bs-toggle="offcanvas" href="#edit-zone">\n+      <span class="toggler-header">\n+        <tal:icon tal:replace="structure python:icons.tag(\'list\')" />\n+      </span>\n+    </a>\n+  </div>\n+\n+  <div id="edit-zone" role="toolbar"\n+       class="pat-toolbar offcanvas offcanvas-start bg-dark">\n+\n+    <div class="offcanvas-header mb-3 bg-primary">\n+      <a class="offcanvas-dismiss text-white" data-bs-dismiss="offcanvas" aria-label="Dismiss" href="#edit-zone">\n+        <tal:icon tal:replace="structure python:icons.tag(\'x-lg\')" />\n       </a>\n-      <a class="plone-toolbar-switcher" tal:condition="view/show_switcher"><span i18n:translate="label_toolbar_switcher">Left-Top switcher</span></a>\n-      <nav>\n-        <ul class="plone-toolbar-main">\n-          <div tal:replace="structure view/base_render">\n-          </div>\n-        </ul>\n-        <ul id="personal-bar-container">\n-          <li id="portal-personaltools" class="plone-toolbar-separator"\n-              tal:condition="personal_bar/user_actions">\n-            <a href="#"\n-               tal:attributes="href personal_bar/homelink_url">\n-              <span class="icon-user" aria-hidden="true"></span>\n-              <span tal:content="personal_bar/user_name">User</span>\n-              <span class="plone-toolbar-caret"></span>\n+      <a class="offcanvas-unpin text-white" data-bs-dismiss="offcanvas" aria-label="Unpin" href="#edit-zone">\n+        <tal:icon tal:replace="structure python:icons.tag(\'arrow-bar-left\')" />\n+      </a>\n+      <a class="offcanvas-pin text-white" data-bs-dismiss="offcanvas" aria-label="Pin" href="#edit-zone">\n+        <tal:icon tal:replace="structure python:icons.tag(\'pin-angle\')" />\n+      </a>\n+    </div>\n+\n+    <ul class="nav flex-column plone-toolbar-main"\n+        tal:define="toolbar_main view/base_render"\n+        tal:condition="toolbar_main">\n+      <li tal:replace="structure toolbar_main">\n+      </li>\n+    </ul>\n+\n+    <div tal:condition="personal_bar/user_actions" class="personaltools-wrapper">\n+\n+      <a id="personaltools-menulink"\n+        class="nav-link dropdown-toggle collapsed"\n+        data-bs-toggle="collapse"\n+        data-bs-target="#collapse-personaltools"\n+        data-bs-\n+        aria-expanded="false"\n+        tal:attributes="href personal_bar/homelink_url">\n+        <tal:icon tal:replace="structure python:icons.tag(\'toolbar-action/personaltools\', tag_alt=\'portal-personaltools\', tag_class=\'me-1\')" />\n+        <span tal:replace="personal_bar/user_name">User</span>\n+      </a>\n+\n+      <div id="collapse-personaltools" class="collapse" data-bs-parent="#edit-zone">\n+        <ul class="nav nav-pills flex-column small" aria-labelledby="personaltools-menulink">\n+          <li tal:repeat="action personal_bar/user_actions">\n+            <a href="${action/href}" class="nav-link">\n+              <tal:icon replace="structure python:icons.tag(action.get(\'icon\', \'dot\'), tag_alt=\'portal-personaltools\', tag_class=\'me-1\')" />\n+              <tal:actionname tal:content="action/title">\n+                action title\n+              </tal:actionname>\n             </a>\n-            <ul>\n-              <li class="plone-toolbar-submenu-header">\n-                <span tal:content="personal_bar/user_name">Username</span>\n-              </li>\n-              <li class="user-action"\n-                  tal:repeat="action personal_bar/user_actions">\n-                <a href="" tal:attributes="action">\n-                  <tal:actionname tal:content="action/title">\n-                     action title\n-                  </tal:actionname>\n-                  <tal:islogout condition="python:action[\'id\'] == \'personaltools-logout\'">\n-                    <span class="icon-logout"></span>\n-                  </tal:islogout>\n-                </a>\n-              </li>\n-            </ul>\n           </li>\n         </ul>\n-      </nav>\n+      </div>\n+\n     </div>\n   </div>\n </section>\ndiff --git a/plone/app/layout/viewlets/toolbar.py b/plone/app/layout/viewlets/toolbar.py\nindex 0134580a..7e48e1b2 100644\n--- a/plone/app/layout/viewlets/toolbar.py\n+++ b/plone/app/layout/viewlets/toolbar.py\n@@ -8,8 +8,6 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n-import json\n-\n \n class ToolbarViewletManager(OrderedViewletManager):\n     custom_template = ViewPageTemplateFile("toolbar.pt")\n@@ -30,25 +28,6 @@ def context_state(self):\n     def portal_state(self):\n         return getMultiAdapter((self.context, self.request), name="plone_portal_state")\n \n-    def get_options(self):\n-        registry = getUtility(IRegistry)\n-        options = {}\n-\n-        lessvars = registry.get("plone.lessvariables", {})\n-\n-        toolbar_width = lessvars.get("plone-left-toolbar-expanded", None)\n-        submenu_width = lessvars.get("plone-toolbar-submenu-width", None)\n-        desktop_width = lessvars.get("plone-screen-sm-min", None)\n-\n-        if toolbar_width:\n-            options["toolbar_width"] = toolbar_width\n-        if submenu_width:\n-            options["submenu_width"] = submenu_width\n-        if desktop_width:\n-            options["desktop_width"] = desktop_width\n-\n-        return json.dumps(options)\n-\n     def get_personal_bar(self):\n         viewlet = PersonalBarViewlet(self.context, self.request, self.__parent__, self)\n         viewlet.update()\n'

