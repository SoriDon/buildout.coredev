Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2016-02-17T03:34:16-08:00
Author: Alec Mitchell (alecpm) <alecpm@gmail.com>
Commit: https://github.com/plone/plone.app.dexterity/commit/c5fa6c8adcea79f9309596cf43427f9fea28b542

Ensure the widget is fully updated before looking up a vocabulary on it.

Files changed:
M plone/app/dexterity/permissions.py

diff --git a/plone/app/dexterity/permissions.py b/plone/app/dexterity/permissions.py
index 2e582e5..c03a414 100644
--- a/plone/app/dexterity/permissions.py
+++ b/plone/app/dexterity/permissions.py
@@ -61,6 +61,8 @@ def validate(self, field_name, vocabulary_name=None):
                     else:
                         widget = queryMultiAdapter((field, self._request),
                                                    IFieldWidget)
+                    if widget:
+                        widget.update()
                     if getattr(widget, 'vocabulary', None) != vocabulary_name:
                         return False
                 # Create mapping of all schema permissions


