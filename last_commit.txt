Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-12-06T21:48:04-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.autoinclude/commit/36e1c4ea71d42dc25613601f96e519a95cdd649b

Revert https://github.com/plone/plone.autoinclude/pull/21

Files changed:
M src/plone/autoinclude/loader.py
M test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py

b'diff --git a/src/plone/autoinclude/loader.py b/src/plone/autoinclude/loader.py\nindex c7b2a6f..c0641c5 100644\n--- a/src/plone/autoinclude/loader.py\n+++ b/src/plone/autoinclude/loader.py\n@@ -12,11 +12,6 @@\n \n logger = logging.getLogger(__name__)\n \n-# copied from setuptools, see\n-# https://github.com/pypa/setuptools/blob/6f7dd7c12ceffa2aefe28c2fbafbad2273980b2b/pkg_resources/__init__.py#L1328\n-# and also https://github.com/plone/plone.autoinclude/issues/17\n-SAFE_NAME_RE = re.compile(\'[^A-Za-z0-9.]+\')\n-\n # Dictionary of project names and packages that we have already imported.\n _known_module_names = {}\n \n@@ -50,7 +45,7 @@ def load_z3c_packages(target=""):\n         # we can include it.\n         if target and ep.module_name != target:\n             continue\n-        module_name = SAFE_NAME_RE.sub(ep.dist.project_name,\'-\')\n+        module_name = ep.dist.project_name.replace("-", "_")\n         if module_name not in _known_module_names:\n             try:\n                 dist = importlib.import_module(module_name)\n@@ -116,7 +111,7 @@ def load_own_packages(target=""):\n             if target and eps["target"].module_name != target:\n                 # entry point defines target X but we only want target Y.\n                 continue\n-            module_name = SAFE_NAME_RE.sub(wsdist.project_name, \'-\')\n+            module_name = wsdist.project_name.replace("-", "_")\n         if "module" in eps:\n             # We could load the dist with ep.load(), but we do it differently.\n             module_name = eps["module"].module_name\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\nindex 9d319f7..fbbdc53 100644\n--- a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\n@@ -4,7 +4,8 @@\n \n \n class TestPackage(PackageTestCase, unittest.TestCase):\n-    project_name = "example.plone_dash_addon"\n+    project_name = "example.plone-dash-addon"\n+    module_name = "example.plone_dash_addon"\n     meta_files = []\n     configure_files = ["configure.zcml", "permissions.zcml", "browser/configure.zcml"]\n     overrides_files = []\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-12-06T21:49:37-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.autoinclude/commit/0e6c062e50aac9b246d8e95c1e816de9704860fd

changelog

Files changed:
A news/22.bugfix

b'diff --git a/news/22.bugfix b/news/22.bugfix\nnew file mode 100644\nindex 0000000..a64902f\n--- /dev/null\n+++ b/news/22.bugfix\n@@ -0,0 +1 @@\n+Revert "Use setuptools/pkg_resources regex to compute safe name for a project" to fix an error importing packages with dashes. [davisagli]\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-12-06T21:57:13-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.autoinclude/commit/96e7f5919b87e1bbd932eef05429f55acce6d2fa

fix ci os

Files changed:
M .github/workflows/tests.yml

b'diff --git a/.github/workflows/tests.yml b/.github/workflows/tests.yml\nindex a3db986..3f2a2a2 100644\n--- a/.github/workflows/tests.yml\n+++ b/.github/workflows/tests.yml\n@@ -18,24 +18,24 @@ jobs:\n       matrix:\n         config:\n         # [Python version, tox env]\n-        - ["3.8",   "lint"]\n-        - ["3.6",   "py36-unit"]\n-        - ["3.7",   "py37-unit"]\n-        - ["3.8",   "py38-unit"]\n-        - ["3.9",   "py39-unit"]\n-        - ["3.10",   "py310-unit"]\n-        - ["pypy3", "pypy3-unit"]\n-        - ["3.6",   "py36-integration"]\n-        - ["3.7",   "py37-integration"]\n-        - ["3.8",   "py38-integration"]\n-        - ["3.9",   "py39-integration"]\n-        - ["3.10",   "py310-integration"]\n-        - ["pypy3", "pypy3-integration"]\n-        - ["3.8",   "buildout2"]\n-        - ["3.8",   "buildout3"]\n-        - ["3.8",   "coverage"]\n+        - ["3.8", "lint", "ubuntu-latest"]\n+        - ["3.6", "py36-unit", "ubuntu-20.04"]\n+        - ["3.7", "py37-unit", "ubuntu-latest"]\n+        - ["3.8", "py38-unit", "ubuntu-latest"]\n+        - ["3.9", "py39-unit", "ubuntu-latest"]\n+        - ["3.10", "py310-unit", "ubuntu-latest"]\n+        - ["pypy3", "pypy3-unit", "ubuntu-20.04"]\n+        - ["3.6", "py36-integration", "ubuntu-20.04"]\n+        - ["3.7", "py37-integration", "ubuntu-latest"]\n+        - ["3.8", "py38-integration", "ubuntu-latest"]\n+        - ["3.9", "py39-integration", "ubuntu-latest"]\n+        - ["3.10", "py310-integration", "ubuntu-latest"]\n+        - ["pypy3", "pypy3-integration", "ubuntu-20.04"]\n+        - ["3.8", "buildout2", "ubuntu-latest"]\n+        - ["3.8", "buildout3", "ubuntu-latest"]\n+        - ["3.8", "coverage", "ubuntu-latest"]\n \n-    runs-on: ubuntu-latest\n+    runs-on: ${{ matrix.config[2] }}\n     name: ${{ matrix.config[1] }}\n     steps:\n     - uses: actions/checkout@v2\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-12-06T21:58:46-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.autoinclude/commit/bb1d119357e88e22e298bfb2972d988baa596c3b

lint

Files changed:
M src/plone/autoinclude/loader.py

b'diff --git a/src/plone/autoinclude/loader.py b/src/plone/autoinclude/loader.py\nindex c0641c5..3ff523d 100644\n--- a/src/plone/autoinclude/loader.py\n+++ b/src/plone/autoinclude/loader.py\n@@ -7,7 +7,6 @@\n import importlib\n import logging\n import os\n-import re\n \n \n logger = logging.getLogger(__name__)\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-12-06T22:02:35-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.autoinclude/commit/3ba90c516a52d04d7a3badf23a9d73759cecf7a6

Add Python 3.11 to test matrix

Files changed:
M .github/workflows/tests.yml
M tox.ini

b'diff --git a/.github/workflows/tests.yml b/.github/workflows/tests.yml\nindex 3f2a2a2..2a41864 100644\n--- a/.github/workflows/tests.yml\n+++ b/.github/workflows/tests.yml\n@@ -24,12 +24,14 @@ jobs:\n         - ["3.8", "py38-unit", "ubuntu-latest"]\n         - ["3.9", "py39-unit", "ubuntu-latest"]\n         - ["3.10", "py310-unit", "ubuntu-latest"]\n+        - ["3.11", "py311-unit", "ubuntu-latest"]\n         - ["pypy3", "pypy3-unit", "ubuntu-20.04"]\n         - ["3.6", "py36-integration", "ubuntu-20.04"]\n         - ["3.7", "py37-integration", "ubuntu-latest"]\n         - ["3.8", "py38-integration", "ubuntu-latest"]\n         - ["3.9", "py39-integration", "ubuntu-latest"]\n         - ["3.10", "py310-integration", "ubuntu-latest"]\n+        - ["3.11", "py311-integration", "ubuntu-latest"]\n         - ["pypy3", "pypy3-integration", "ubuntu-20.04"]\n         - ["3.8", "buildout2", "ubuntu-latest"]\n         - ["3.8", "buildout3", "ubuntu-latest"]\ndiff --git a/tox.ini b/tox.ini\nindex dd99932..247dfad 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -4,7 +4,7 @@\n minversion = 3.18\n envlist =\n     lint\n-    py{36,37,38,39,310,py3}-{integration,unit}\n+    py{36,37,38,39,310,311,py3}-{integration,unit}\n     buildout2\n     buildout3\n     coverage\n@@ -57,7 +57,7 @@ integration_testpaths =\n     --test-path=test-packages/namespaceexample.native/src\n     --test-path=test-packages/namespaceexample.pkgutilns/src\n \n-[testenv:py{36,37,38,39,310,py3}-integration]\n+[testenv:py{36,37,38,39,310,311,py3}-integration]\n # Integration tests: run only the tests of the test packages.\n # Do not run plone.autoinclude tests.\n commands =\n@@ -65,7 +65,7 @@ commands =\n extras =\n     test\n \n-[testenv:py{36,37,38,39,310,py3}-unit]\n+[testenv:py{36,37,38,39,310,311,py3}-unit]\n usedevelop = true\n skip_install = false\n deps =\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-12-06T22:05:22-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.autoinclude/commit/acd64662734f4ace145ac83f5af2ba89ab7a8fe8

fix test

Files changed:
M test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml

b'diff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\nindex 558aa27..9a0b516 100644\n--- a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\n@@ -15,6 +15,6 @@\n \n   <include file="permissions.zcml" />\n \n-  <!-- FOR TESTS: This is configure.zcml from example.plone_dash_addon. -->\n+  <!-- FOR TESTS: This is configure.zcml from example.plone-dash-addon. -->\n \n </configure>\n'

Repository: plone.autoinclude


Branch: refs/heads/main
Date: 2022-12-07T19:42:37+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.autoinclude/commit/bd3481aea884f7779e67348d016973e15afba3bd

Merge pull request #22 from plone/fix-include-with-dashes

Revert https://github.com/plone/plone.autoinclude/pull/21

Files changed:
A news/22.bugfix
M .github/workflows/tests.yml
M src/plone/autoinclude/loader.py
M test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml
M test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py
M tox.ini

b'diff --git a/.github/workflows/tests.yml b/.github/workflows/tests.yml\nindex a3db986..2a41864 100644\n--- a/.github/workflows/tests.yml\n+++ b/.github/workflows/tests.yml\n@@ -18,24 +18,26 @@ jobs:\n       matrix:\n         config:\n         # [Python version, tox env]\n-        - ["3.8",   "lint"]\n-        - ["3.6",   "py36-unit"]\n-        - ["3.7",   "py37-unit"]\n-        - ["3.8",   "py38-unit"]\n-        - ["3.9",   "py39-unit"]\n-        - ["3.10",   "py310-unit"]\n-        - ["pypy3", "pypy3-unit"]\n-        - ["3.6",   "py36-integration"]\n-        - ["3.7",   "py37-integration"]\n-        - ["3.8",   "py38-integration"]\n-        - ["3.9",   "py39-integration"]\n-        - ["3.10",   "py310-integration"]\n-        - ["pypy3", "pypy3-integration"]\n-        - ["3.8",   "buildout2"]\n-        - ["3.8",   "buildout3"]\n-        - ["3.8",   "coverage"]\n+        - ["3.8", "lint", "ubuntu-latest"]\n+        - ["3.6", "py36-unit", "ubuntu-20.04"]\n+        - ["3.7", "py37-unit", "ubuntu-latest"]\n+        - ["3.8", "py38-unit", "ubuntu-latest"]\n+        - ["3.9", "py39-unit", "ubuntu-latest"]\n+        - ["3.10", "py310-unit", "ubuntu-latest"]\n+        - ["3.11", "py311-unit", "ubuntu-latest"]\n+        - ["pypy3", "pypy3-unit", "ubuntu-20.04"]\n+        - ["3.6", "py36-integration", "ubuntu-20.04"]\n+        - ["3.7", "py37-integration", "ubuntu-latest"]\n+        - ["3.8", "py38-integration", "ubuntu-latest"]\n+        - ["3.9", "py39-integration", "ubuntu-latest"]\n+        - ["3.10", "py310-integration", "ubuntu-latest"]\n+        - ["3.11", "py311-integration", "ubuntu-latest"]\n+        - ["pypy3", "pypy3-integration", "ubuntu-20.04"]\n+        - ["3.8", "buildout2", "ubuntu-latest"]\n+        - ["3.8", "buildout3", "ubuntu-latest"]\n+        - ["3.8", "coverage", "ubuntu-latest"]\n \n-    runs-on: ubuntu-latest\n+    runs-on: ${{ matrix.config[2] }}\n     name: ${{ matrix.config[1] }}\n     steps:\n     - uses: actions/checkout@v2\ndiff --git a/news/22.bugfix b/news/22.bugfix\nnew file mode 100644\nindex 0000000..a64902f\n--- /dev/null\n+++ b/news/22.bugfix\n@@ -0,0 +1 @@\n+Revert "Use setuptools/pkg_resources regex to compute safe name for a project" to fix an error importing packages with dashes. [davisagli]\ndiff --git a/src/plone/autoinclude/loader.py b/src/plone/autoinclude/loader.py\nindex c7b2a6f..3ff523d 100644\n--- a/src/plone/autoinclude/loader.py\n+++ b/src/plone/autoinclude/loader.py\n@@ -7,16 +7,10 @@\n import importlib\n import logging\n import os\n-import re\n \n \n logger = logging.getLogger(__name__)\n \n-# copied from setuptools, see\n-# https://github.com/pypa/setuptools/blob/6f7dd7c12ceffa2aefe28c2fbafbad2273980b2b/pkg_resources/__init__.py#L1328\n-# and also https://github.com/plone/plone.autoinclude/issues/17\n-SAFE_NAME_RE = re.compile(\'[^A-Za-z0-9.]+\')\n-\n # Dictionary of project names and packages that we have already imported.\n _known_module_names = {}\n \n@@ -50,7 +44,7 @@ def load_z3c_packages(target=""):\n         # we can include it.\n         if target and ep.module_name != target:\n             continue\n-        module_name = SAFE_NAME_RE.sub(ep.dist.project_name,\'-\')\n+        module_name = ep.dist.project_name.replace("-", "_")\n         if module_name not in _known_module_names:\n             try:\n                 dist = importlib.import_module(module_name)\n@@ -116,7 +110,7 @@ def load_own_packages(target=""):\n             if target and eps["target"].module_name != target:\n                 # entry point defines target X but we only want target Y.\n                 continue\n-            module_name = SAFE_NAME_RE.sub(wsdist.project_name, \'-\')\n+            module_name = wsdist.project_name.replace("-", "_")\n         if "module" in eps:\n             # We could load the dist with ep.load(), but we do it differently.\n             module_name = eps["module"].module_name\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\nindex 558aa27..9a0b516 100644\n--- a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/configure.zcml\n@@ -15,6 +15,6 @@\n \n   <include file="permissions.zcml" />\n \n-  <!-- FOR TESTS: This is configure.zcml from example.plone_dash_addon. -->\n+  <!-- FOR TESTS: This is configure.zcml from example.plone-dash-addon. -->\n \n </configure>\ndiff --git a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\nindex 9d319f7..fbbdc53 100644\n--- a/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\n+++ b/test-packages/example.plone-dash-addon/src/example/plone_dash_addon/tests.py\n@@ -4,7 +4,8 @@\n \n \n class TestPackage(PackageTestCase, unittest.TestCase):\n-    project_name = "example.plone_dash_addon"\n+    project_name = "example.plone-dash-addon"\n+    module_name = "example.plone_dash_addon"\n     meta_files = []\n     configure_files = ["configure.zcml", "permissions.zcml", "browser/configure.zcml"]\n     overrides_files = []\ndiff --git a/tox.ini b/tox.ini\nindex dd99932..247dfad 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -4,7 +4,7 @@\n minversion = 3.18\n envlist =\n     lint\n-    py{36,37,38,39,310,py3}-{integration,unit}\n+    py{36,37,38,39,310,311,py3}-{integration,unit}\n     buildout2\n     buildout3\n     coverage\n@@ -57,7 +57,7 @@ integration_testpaths =\n     --test-path=test-packages/namespaceexample.native/src\n     --test-path=test-packages/namespaceexample.pkgutilns/src\n \n-[testenv:py{36,37,38,39,310,py3}-integration]\n+[testenv:py{36,37,38,39,310,311,py3}-integration]\n # Integration tests: run only the tests of the test packages.\n # Do not run plone.autoinclude tests.\n commands =\n@@ -65,7 +65,7 @@ commands =\n extras =\n     test\n \n-[testenv:py{36,37,38,39,310,py3}-unit]\n+[testenv:py{36,37,38,39,310,311,py3}-unit]\n usedevelop = true\n skip_install = false\n deps =\n'

