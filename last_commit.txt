Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2017-02-15T22:33:09+01:00
Author: Diederik Veeze (didrix) <d.veeze@zestsoftware.nl>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/4277876b6cefda94691fbd9292cd817b13c973f4

Use namedFile only with DX in testing.

Files changed:
M CHANGES.rst
M plone/app/linkintegrity/testing.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 859b799..3353cc5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Use plone.namedfile for testing images
+  [didrix]
 
 Bug fixes:
 
diff --git a/plone/app/linkintegrity/testing.py b/plone/app/linkintegrity/testing.py
index 75506a8..c49540a 100644
--- a/plone/app/linkintegrity/testing.py
+++ b/plone/app/linkintegrity/testing.py
@@ -15,6 +15,7 @@
 from plone.app.testing import login
 from plone.app.testing import ploneSite
 from plone.app.testing import setRoles
+from plone.namedfile.file import NamedImage
 from plone.testing import z2
 from zope.configuration import xmlconfig
 
@@ -73,7 +74,6 @@ def setUpContent(self):
                 create(portal, **type_data)
 
             create(portal, 'File', id='file1', title='File 1', file=GIF)
-            create(portal, 'Image', id='image1', title='Image 1', image=GIF)
             create(portal, 'Folder', id='folder1', title='Folder 1')
             subfolder = portal['folder1']
             create(subfolder, 'Document', id='doc4', title='Test Page 4')
@@ -99,6 +99,12 @@ class LinkIntegrityATLayer(LinkIntegrityLayer):
     def setUp(self):
         self.setUpContent()
 
+    def setUpContent(self):
+        super(LinkIntegrityATLayer, self).setUpContent()
+
+        with ploneSite() as portal:
+            create(portal, 'Image', id='image1', title='Image 1', image=GIF)
+
 PLONE_APP_LINKINTEGRITY_AT_FIXTURE = LinkIntegrityATLayer()
 
 
@@ -121,6 +127,11 @@ def setUpContent(self):
             # Create an object that does not provide the behavior to live along
             create(portal, 'News Item', id='news1', title='News 1')
 
+            # create a DX NamedImage
+            portal.invokeFactory('Image', 'image1')
+            portal['image1'].image = NamedImage(GIF, 'image/gif',
+                                                u'sample.gif')
+
 
 PLONE_APP_LINKINTEGRITY_DX_FIXTURE = LinkIntegrityDXLayer()
 


Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2017-02-23T12:11:33+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/5432a9b947527ab7e0bcc5b679a54425b07a9fc7

Merge pull request #39 from plone/plip-1483-retina-image-scales

Use plone.namedfile for testing images

Files changed:
M CHANGES.rst
M plone/app/linkintegrity/testing.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e7c4224..4b6f7c4 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Use plone.namedfile for testing images
+  [didrix]
 
 Bug fixes:
 
diff --git a/plone/app/linkintegrity/testing.py b/plone/app/linkintegrity/testing.py
index 75506a8..c49540a 100644
--- a/plone/app/linkintegrity/testing.py
+++ b/plone/app/linkintegrity/testing.py
@@ -15,6 +15,7 @@
 from plone.app.testing import login
 from plone.app.testing import ploneSite
 from plone.app.testing import setRoles
+from plone.namedfile.file import NamedImage
 from plone.testing import z2
 from zope.configuration import xmlconfig
 
@@ -73,7 +74,6 @@ def setUpContent(self):
                 create(portal, **type_data)
 
             create(portal, 'File', id='file1', title='File 1', file=GIF)
-            create(portal, 'Image', id='image1', title='Image 1', image=GIF)
             create(portal, 'Folder', id='folder1', title='Folder 1')
             subfolder = portal['folder1']
             create(subfolder, 'Document', id='doc4', title='Test Page 4')
@@ -99,6 +99,12 @@ class LinkIntegrityATLayer(LinkIntegrityLayer):
     def setUp(self):
         self.setUpContent()
 
+    def setUpContent(self):
+        super(LinkIntegrityATLayer, self).setUpContent()
+
+        with ploneSite() as portal:
+            create(portal, 'Image', id='image1', title='Image 1', image=GIF)
+
 PLONE_APP_LINKINTEGRITY_AT_FIXTURE = LinkIntegrityATLayer()
 
 
@@ -121,6 +127,11 @@ def setUpContent(self):
             # Create an object that does not provide the behavior to live along
             create(portal, 'News Item', id='news1', title='News 1')
 
+            # create a DX NamedImage
+            portal.invokeFactory('Image', 'image1')
+            portal['image1'].image = NamedImage(GIF, 'image/gif',
+                                                u'sample.gif')
+
 
 PLONE_APP_LINKINTEGRITY_DX_FIXTURE = LinkIntegrityDXLayer()
 


