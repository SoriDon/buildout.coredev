Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-27T13:35:53+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/1893c378844abd0921929cade7bad0f74f2fee12

Fix tests for image_scales url update

Files changed:
M Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py

b'diff --git a/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py b/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\nindex be656d06ba..a8af51fd32 100644\n--- a/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\n+++ b/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\n@@ -91,8 +91,7 @@ def test_field_adapter_does_not_return_larger_scales(self):\n         self.assertEqual(scales["width"], 900)\n         self.assertEqual(scales["height"], 900)\n         download = scales["download"]\n-        images_url = image.absolute_url() + "/@@images"\n-        self.assertTrue(download.startswith(f"{images_url}/image-900-"))\n+        self.assertTrue(download.startswith("@@images/image-900-"))\n         self.assertTrue(download.endswith(".jpeg"))\n         scales = scales["scales"]\n         # larger and huge should not be in here: these scales would return the same\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-27T13:38:44+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/f91b5f6e352a9c5370e2c860efb7752c9913174b

add changenote

Files changed:
A news/3566.bugfix

b'diff --git a/news/3566.bugfix b/news/3566.bugfix\nnew file mode 100644\nindex 0000000000..db4c3dc993\n--- /dev/null\n+++ b/news/3566.bugfix\n@@ -0,0 +1,2 @@\n+Fix tests for `image_scale` download url update.\n+[petschki]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-27T13:40:21+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/7a15bb51708f95895cc2bf2a20962ca72a2a577d

update url

Files changed:
M Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py

b'diff --git a/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py b/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\nindex a8af51fd32..0cc5c2c1e0 100644\n--- a/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\n+++ b/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\n@@ -103,7 +103,7 @@ def test_field_adapter_does_not_return_larger_scales(self):\n         preview = scales["preview"]\n         self.assertEqual(preview["width"], 400)\n         self.assertEqual(preview["height"], 400)\n-        self.assertTrue(preview["download"].startswith(f"{images_url}/image-400-"))\n+        self.assertTrue(preview["download"].startswith("@@images/image-400-"))\n \n     def test_content_adapter_return_proper_scales(self):\n         res = queryMultiAdapter((self.image, self.request), IImageScalesAdapter)()\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-27T15:47:35+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/2f23940f677d0648470d7abe600be03de44cfb5c

Merge pull request #3566 from plone/petschki-image-scales-fix-tests

Fix tests for `image_scales` download url update

Files changed:
A news/3566.bugfix
M Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py

b'diff --git a/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py b/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\nindex be656d06ba..0cc5c2c1e0 100644\n--- a/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\n+++ b/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\n@@ -91,8 +91,7 @@ def test_field_adapter_does_not_return_larger_scales(self):\n         self.assertEqual(scales["width"], 900)\n         self.assertEqual(scales["height"], 900)\n         download = scales["download"]\n-        images_url = image.absolute_url() + "/@@images"\n-        self.assertTrue(download.startswith(f"{images_url}/image-900-"))\n+        self.assertTrue(download.startswith("@@images/image-900-"))\n         self.assertTrue(download.endswith(".jpeg"))\n         scales = scales["scales"]\n         # larger and huge should not be in here: these scales would return the same\n@@ -104,7 +103,7 @@ def test_field_adapter_does_not_return_larger_scales(self):\n         preview = scales["preview"]\n         self.assertEqual(preview["width"], 400)\n         self.assertEqual(preview["height"], 400)\n-        self.assertTrue(preview["download"].startswith(f"{images_url}/image-400-"))\n+        self.assertTrue(preview["download"].startswith("@@images/image-400-"))\n \n     def test_content_adapter_return_proper_scales(self):\n         res = queryMultiAdapter((self.image, self.request), IImageScalesAdapter)()\ndiff --git a/news/3566.bugfix b/news/3566.bugfix\nnew file mode 100644\nindex 0000000000..db4c3dc993\n--- /dev/null\n+++ b/news/3566.bugfix\n@@ -0,0 +1,2 @@\n+Fix tests for `image_scale` download url update.\n+[petschki]\n'

