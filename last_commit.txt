Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2016-10-22T15:39:59-04:00
Author: Ivan Teoh (ivanteoh) <ivan.teoh@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/75af3535b9129fa7925ebdebb1cbb603cc891f7f

Remove ZopeTestCase.

Files changed:
M CHANGES.rst
M plone/app/z3cform/inline_validation.rst
M plone/app/z3cform/tests/tests.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4ec6b91..91abddf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Remove ZopeTestCase.
+  [ivanteoh, maurits]
+
 - In select widget, accept items as property or method.
   This avoids breaking on some z3c.form versions.
   See https://github.com/zopefoundation/z3c.form/issues/44
diff --git a/plone/app/z3cform/inline_validation.rst b/plone/app/z3cform/inline_validation.rst
index b1379ce..b7468f0 100644
--- a/plone/app/z3cform/inline_validation.rst
+++ b/plone/app/z3cform/inline_validation.rst
@@ -4,14 +4,15 @@ Inline validation
 First, let's set up some infrastructure:
 
     >>> from zope.interface import alsoProvides
-    >>> from Testing.ZopeTestCase import ZopeLite
-    >>> from Testing.makerequest import makerequest
+    >>> from plone.testing.z2 import makeTestRequest
     >>> from zope.annotation.interfaces import IAttributeAnnotatable
     >>> from z3c.form.interfaces import IFormLayer
 
-    >>> app = ZopeLite.app()
-    >>> def make_request(form={}, lang='en'):
-    ...     request = makerequest(app, environ = {'HTTP_ACCEPT_LANGUAGE': lang}).REQUEST
+    >>> app = layer['app']
+    >>> def make_request(form=None, lang='en'):
+    ...     request = makeTestRequest({'HTTP_ACCEPT_LANGUAGE': lang})
+    ...     if form is None:
+    ...         form = {}
     ...     request.form.update(form)
     ...     alsoProvides(request, IFormLayer)
     ...     alsoProvides(request, IAttributeAnnotatable)
@@ -155,6 +156,7 @@ the behavior of archetypes.)
     >>> z3cform_validate_field(fname=u'form.widgets.name', fset="0")
     '{"errmsg": "Erforderliche Eingabe fehlt."}'
 
+
 Forms embedded inside normal views
 -----------------------------------
 
diff --git a/plone/app/z3cform/tests/tests.py b/plone/app/z3cform/tests/tests.py
index 602d8d6..cb40d0d 100644
--- a/plone/app/z3cform/tests/tests.py
+++ b/plone/app/z3cform/tests/tests.py
@@ -1,6 +1,7 @@
 # -*- coding: utf-8 -*-
 from plone.app.z3cform.tests.layer import PAZ3CForm_INTEGRATION_TESTING
 from plone.browserlayer.layer import mark_layer
+from plone.testing import layered
 from zope.traversing.interfaces import BeforeTraverseEvent
 
 import doctest
@@ -37,16 +38,14 @@ def test_content_provider(self):
 
 
 def test_suite():
-
-    inlineValidationTests = doctest.DocFileSuite(
+    inlineValidationTests = layered(doctest.DocFileSuite(
         'inline_validation.rst',
         package='plone.app.z3cform',
         optionflags=(
             doctest.ELLIPSIS |
             doctest.NORMALIZE_WHITESPACE
         )
-    )
-    inlineValidationTests.layer = PAZ3CForm_INTEGRATION_TESTING
+    ), layer=PAZ3CForm_INTEGRATION_TESTING)
 
     suite = unittest.TestSuite([
         unittest.makeSuite(IntegrationTests),


Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2016-10-22T17:47:21-04:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/e85201556a7aa035f556d056ce712d9e9e5290d4

Merge pull request #51 from plone/remove-zopetestcase

Remove ZopeTestCase.

Files changed:
M CHANGES.rst
M plone/app/z3cform/inline_validation.rst
M plone/app/z3cform/tests/tests.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4ec6b91..91abddf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Remove ZopeTestCase.
+  [ivanteoh, maurits]
+
 - In select widget, accept items as property or method.
   This avoids breaking on some z3c.form versions.
   See https://github.com/zopefoundation/z3c.form/issues/44
diff --git a/plone/app/z3cform/inline_validation.rst b/plone/app/z3cform/inline_validation.rst
index b1379ce..b7468f0 100644
--- a/plone/app/z3cform/inline_validation.rst
+++ b/plone/app/z3cform/inline_validation.rst
@@ -4,14 +4,15 @@ Inline validation
 First, let's set up some infrastructure:
 
     >>> from zope.interface import alsoProvides
-    >>> from Testing.ZopeTestCase import ZopeLite
-    >>> from Testing.makerequest import makerequest
+    >>> from plone.testing.z2 import makeTestRequest
     >>> from zope.annotation.interfaces import IAttributeAnnotatable
     >>> from z3c.form.interfaces import IFormLayer
 
-    >>> app = ZopeLite.app()
-    >>> def make_request(form={}, lang='en'):
-    ...     request = makerequest(app, environ = {'HTTP_ACCEPT_LANGUAGE': lang}).REQUEST
+    >>> app = layer['app']
+    >>> def make_request(form=None, lang='en'):
+    ...     request = makeTestRequest({'HTTP_ACCEPT_LANGUAGE': lang})
+    ...     if form is None:
+    ...         form = {}
     ...     request.form.update(form)
     ...     alsoProvides(request, IFormLayer)
     ...     alsoProvides(request, IAttributeAnnotatable)
@@ -155,6 +156,7 @@ the behavior of archetypes.)
     >>> z3cform_validate_field(fname=u'form.widgets.name', fset="0")
     '{"errmsg": "Erforderliche Eingabe fehlt."}'
 
+
 Forms embedded inside normal views
 -----------------------------------
 
diff --git a/plone/app/z3cform/tests/tests.py b/plone/app/z3cform/tests/tests.py
index 602d8d6..cb40d0d 100644
--- a/plone/app/z3cform/tests/tests.py
+++ b/plone/app/z3cform/tests/tests.py
@@ -1,6 +1,7 @@
 # -*- coding: utf-8 -*-
 from plone.app.z3cform.tests.layer import PAZ3CForm_INTEGRATION_TESTING
 from plone.browserlayer.layer import mark_layer
+from plone.testing import layered
 from zope.traversing.interfaces import BeforeTraverseEvent
 
 import doctest
@@ -37,16 +38,14 @@ def test_content_provider(self):
 
 
 def test_suite():
-
-    inlineValidationTests = doctest.DocFileSuite(
+    inlineValidationTests = layered(doctest.DocFileSuite(
         'inline_validation.rst',
         package='plone.app.z3cform',
         optionflags=(
             doctest.ELLIPSIS |
             doctest.NORMALIZE_WHITESPACE
         )
-    )
-    inlineValidationTests.layer = PAZ3CForm_INTEGRATION_TESTING
+    ), layer=PAZ3CForm_INTEGRATION_TESTING)
 
     suite = unittest.TestSuite([
         unittest.makeSuite(IntegrationTests),


