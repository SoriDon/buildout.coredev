Repository: plone.rest


Branch: refs/heads/master
Date: 2023-01-29T07:41:44+01:00
Author: Timo Stollenwerk (tisto) <tisto@users.noreply.github.com>
Commit: https://github.com/plone/plone.rest/commit/b0e31a87d05716c3c23942c38054ea375efb564b

Add official support for Plone 6 (#144)

* Drop support for Plone 4.3, 5.0, and 5.1

* Drop versions on gha as well

* Add official support for Plone 6

* Use individual requirements files for 5.2 and 6.0

* Exclude GHA Plone 6 / Py 2.7

* Add changelog for #143

* Add build for Plone 6 to Makefile

* No need to test py 3.7

Files changed:
A news/143.feature
A plone-6.0.x.cfg
A requirements-5.2.x.txt
A requirements-6.0.x.txt
M .github/workflows/tests.yml
M Makefile
M setup.py

b'diff --git a/.github/workflows/tests.yml b/.github/workflows/tests.yml\nindex da7d133..5455f52 100644\n--- a/.github/workflows/tests.yml\n+++ b/.github/workflows/tests.yml\n@@ -6,8 +6,11 @@ jobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        python-version: [3.8, 3.7, 2.7]\n-        plone-version: [5.2]\n+        python-version: [3.8, 2.7]\n+        plone-version: ["6.0", 5.2]\n+        exclude:\n+          - python-version: 2.7\n+            plone-version: 6.0\n     steps:\n       # git checkout\n       - uses: actions/checkout@v2\n@@ -30,7 +33,7 @@ jobs:\n       - run: pip install virtualenv\n       - run: pip install wheel\n       - name: pip install\n-        run: pip install -r requirements.txt\n+        run: pip install -r requirements-${{ matrix.plone-version }}.x.txt\n       - name: choose Plone version\n         run: sed -ie "s#plone-x.x.x.cfg#plone-${{ matrix.plone-version }}.x.cfg#" ci.cfg\n \ndiff --git a/Makefile b/Makefile\nindex fce73d8..369383b 100644\n--- a/Makefile\n+++ b/Makefile\n@@ -3,7 +3,7 @@\n SHELL := /bin/bash\n CURRENT_DIR:=$(shell dirname $(realpath $(lastword $(MAKEFILE_LIST))))\n \n-version = 3\n+version = 3.8\n \n # We like colors\n # From: https://coderwall.com/p/izxssa/colored-makefile-for-golang-projects\n@@ -12,7 +12,7 @@ GREEN=`tput setaf 2`\n RESET=`tput sgr0`\n YELLOW=`tput setaf 3`\n \n-all: .installed.cfg\n+all: build-plone-6.0\n \n # Add the following \'help\' target to your Makefile\n # And add help text after each target name starting with \'\\#\\#\'\n@@ -83,6 +83,12 @@ build-plone-5.2-performance: .installed.cfg  ## Build Plone 5.2\n \tbin/pip install -r requirements.txt\n \tbin/buildout -c plone-5.2.x-performance.cfg\n \n+build-plone-6.0:  ## Build Plone 6.0\n+\tpython$(version) -m venv .\n+\tbin/pip install --upgrade pip\n+\tbin/pip install -r requirements-6.0.x.txt\n+\tbin/buildout -c plone-6.0.x.cfg\n+\n .PHONY: Test\n test:  ## Test\n \tbin/test\ndiff --git a/news/143.feature b/news/143.feature\nnew file mode 100644\nindex 0000000..16a5e19\n--- /dev/null\n+++ b/news/143.feature\n@@ -0,0 +1,2 @@\n+Add official support for Plone 6\n+[tisto]\ndiff --git a/plone-6.0.x.cfg b/plone-6.0.x.cfg\nnew file mode 100644\nindex 0000000..bcb6378\n--- /dev/null\n+++ b/plone-6.0.x.cfg\n@@ -0,0 +1,17 @@\n+[buildout]\n+extends =\n+    https://dist.plone.org/release/6.0.0/versions.cfg\n+    base.cfg\n+\n+[buildout:python38]\n+parts =\n+    test\n+    code-analysis\n+\n+[instance]\n+recipe = plone.recipe.zope2instance\n+zodb-temporary-storage = off\n+\n+[versions]\n+black = 21.7b0\n+pygments = 2.14.0\n\\ No newline at end of file\ndiff --git a/requirements-5.2.x.txt b/requirements-5.2.x.txt\nnew file mode 100644\nindex 0000000..505c1ab\n--- /dev/null\n+++ b/requirements-5.2.x.txt\n@@ -0,0 +1,12 @@\n+# Keep this file in sync with: https://dist.plone.org/release/5.2.9/requirements.txt\n+setuptools==42.0.2\n+zc.buildout==2.13.7\n+wheel==0.37.1\n+\n+# Windows specific down here (has to be installed here, fails in buildout)\n+# Dependency of zope.sendmail:\n+pywin32 ; platform_system == \'Windows\'\n+# SSL Certs on Windows, because Python is missing them otherwise:\n+certifi ; platform_system == \'Windows\'\n+# Dependency of collective.recipe.omelette:\n+ntfsutils ; platform_system == \'Windows\' and python_version < \'3.0\'\n\\ No newline at end of file\ndiff --git a/requirements-6.0.x.txt b/requirements-6.0.x.txt\nnew file mode 100644\nindex 0000000..fe350fe\n--- /dev/null\n+++ b/requirements-6.0.x.txt\n@@ -0,0 +1,11 @@\n+pip==22.3.1\n+setuptools==65.5.1\n+wheel==0.38.4\n+zc.buildout==3.0.1\n+\n+# Windows specific down here (has to be installed here, fails in buildout)\n+# Dependency of zope.sendmail:\n+pywin32 ; platform_system == \'Windows\'\n+\n+# SSL Certs on windows, because Python is missing them otherwise:\n+certifi ; platform_system == \'Windows\'\n\\ No newline at end of file\ndiff --git a/setup.py b/setup.py\nindex 46b738f..635fab5 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -24,6 +24,7 @@ def read(*rnames):\n         "Environment :: Web Environment",\n         "Framework :: Plone",\n         "Framework :: Plone :: 5.2",\n+        "Framework :: Plone :: 6.0",\n         "Framework :: Plone :: Core",\n         "Framework :: Zope2",\n         "Framework :: Zope :: 4",\n'

