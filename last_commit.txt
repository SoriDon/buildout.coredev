Repository: plone.restapi


Branch: refs/heads/master
Date: 2018-12-27T16:58:44+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.restapi/commit/7e577352d3ca5140948cc9a50424109e8216718e

Close the api_session in tests.

This prevents lots of ResourceWarnings about unclosed sockets.
Fixes https://github.com/plone/plone.restapi/issues/636 and https://github.com/plone/plone.restapi/issues/648.

Files changed:
M CHANGES.rst
M src/plone/restapi/tests/test_documentation.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex e9c4b020..166b8429 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -6,6 +6,12 @@ Changelog\n \n Bugfixes:\n \n+- Close the api_session in tests.\n+  This prevents lots of ResourceWarnings about unclosed sockets.\n+  Fixes issues `636 <https://github.com/plone/plone.restapi/issues/636>`_\n+  and `648 <https://github.com/plone/plone.restapi/issues/648>`_.\n+  [maurits]\n+\n - Standardize errors data structure of email-notification endpoint.\n   [cekk]\n \ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex acddc411..1b919dd1 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -228,6 +228,7 @@ def create_folder(self):\n     def tearDown(self):\n         self.time_freezer.stop()\n         popGlobalRegistry(getSite())\n+        self.api_session.close()\n \n     def test_documentation_content_crud(self):\n         folder = self.create_folder()\n@@ -1380,6 +1381,7 @@ def create_document(self):\n     def tearDown(self):\n         self.time_freezer.stop()\n         popGlobalRegistry(getSite())\n+        self.api_session.close()\n \n     def test_translate_messages_types(self):\n         response = self.api_session.get('/@types')\n@@ -1440,6 +1442,7 @@ def setUp(self):\n \n     def tearDown(self):\n         self.time_freezer.stop()\n+        self.api_session.close()\n \n     def create_document_with_comments(self):\n         self.portal.invokeFactory('Document', id='front-page')\n@@ -1627,6 +1630,7 @@ def setUp(self):\n \n     def tearDown(self):\n         self.time_freezer.stop()\n+        self.api_session.close()\n \n     def test_documentation_translations_post(self):\n         response = self.api_session.post(\n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2018-12-28T00:01:34+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/fbd357b99eb3dfcb570d4d593a092dcef34441dd

Merge pull request #651 from plone/close-api-session

Close the api_session in tests.

Files changed:
M CHANGES.rst
M src/plone/restapi/tests/test_documentation.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex e9c4b020..166b8429 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -6,6 +6,12 @@ Changelog\n \n Bugfixes:\n \n+- Close the api_session in tests.\n+  This prevents lots of ResourceWarnings about unclosed sockets.\n+  Fixes issues `636 <https://github.com/plone/plone.restapi/issues/636>`_\n+  and `648 <https://github.com/plone/plone.restapi/issues/648>`_.\n+  [maurits]\n+\n - Standardize errors data structure of email-notification endpoint.\n   [cekk]\n \ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex acddc411..1b919dd1 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -228,6 +228,7 @@ def create_folder(self):\n     def tearDown(self):\n         self.time_freezer.stop()\n         popGlobalRegistry(getSite())\n+        self.api_session.close()\n \n     def test_documentation_content_crud(self):\n         folder = self.create_folder()\n@@ -1380,6 +1381,7 @@ def create_document(self):\n     def tearDown(self):\n         self.time_freezer.stop()\n         popGlobalRegistry(getSite())\n+        self.api_session.close()\n \n     def test_translate_messages_types(self):\n         response = self.api_session.get('/@types')\n@@ -1440,6 +1442,7 @@ def setUp(self):\n \n     def tearDown(self):\n         self.time_freezer.stop()\n+        self.api_session.close()\n \n     def create_document_with_comments(self):\n         self.portal.invokeFactory('Document', id='front-page')\n@@ -1627,6 +1630,7 @@ def setUp(self):\n \n     def tearDown(self):\n         self.time_freezer.stop()\n+        self.api_session.close()\n \n     def test_documentation_translations_post(self):\n         response = self.api_session.post(\n"

