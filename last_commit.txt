Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2022-04-06T11:53:18+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.portlets/commit/d7fe54d81e619a858238cce0a3e1f0d1a43edcd3

Use @@iconresolver to display icons in navigation portlet

Files changed:
M plone/app/portlets/portlets/navigation.py
M plone/app/portlets/portlets/navigation_recurse.pt

b'diff --git a/plone/app/portlets/portlets/navigation.py b/plone/app/portlets/portlets/navigation.py\nindex 0e9378cc..4d5c4f4c 100644\n--- a/plone/app/portlets/portlets/navigation.py\n+++ b/plone/app/portlets/portlets/navigation.py\n@@ -369,22 +369,6 @@ def thumb_scale(self):\n         thumb_scale_portlet = settings.thumb_scale_portlet\n         return thumb_scale_portlet\n \n-    def getMimeTypeIcon(self, node):\n-        try:\n-            if not node["normalized_portal_type"] == "file":\n-                return None\n-            fileo = node["item"].getObject().file\n-            portal_url = getNavigationRoot(self.context)\n-            mtt = getToolByName(self.context, "mimetypes_registry")\n-            if fileo.contentType:\n-                ctype = mtt.lookup(fileo.contentType)\n-                if not ctype:\n-                    return None\n-                return os.path.join(portal_url, guess_icon_path(ctype[0]))\n-        except AttributeError:\n-            return None\n-        return None\n-\n     def update(self):\n         pass\n \ndiff --git a/plone/app/portlets/portlets/navigation_recurse.pt b/plone/app/portlets/portlets/navigation_recurse.pt\nindex 1f3dd0bc..402291c2 100644\n--- a/plone/app/portlets/portlets/navigation_recurse.pt\n+++ b/plone/app/portlets/portlets/navigation_recurse.pt\n@@ -3,7 +3,8 @@\n                     bottomLevel options/bottomLevel | nothing;\n                     supress_icon    view/data/no_icons;\n                     supress_thumb   view/data/no_thumbs;\n-                    thumb_scale view/thumb_scale"\n+                    thumb_scale view/thumb_scale;\n+                    icons nocall:context/@@iconresolver;"\n             i18n:domain="plone">\n \n <metal:main define-macro="nav_main"\n@@ -35,9 +36,11 @@\n                            title node/Description;\n                            class string:${item_class}${li_class}${li_extr_class}${li_folder_class} ${item_type_class}">\n \n-             <img class="mime-icon" tal:condition="python:item_type ==\'File\' and not supress_icon"\n-                             tal:attributes="href node/getURL;\n-                                             src python:view.getMimeTypeIcon(node);">\n+            <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')" />\n+\n+            <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'mimetype-{item.mime_type}\')" />\n \n             <img tal:condition="python:has_thumb and thumb_scale"\n                  tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)">\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2022-04-06T11:55:00+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.portlets/commit/f4e2edb9e16c6881436e2357da00489d67fbac94

changelog

Files changed:
A news/162.bugfix

b'diff --git a/news/162.bugfix b/news/162.bugfix\nnew file mode 100644\nindex 00000000..0afcc8d2\n--- /dev/null\n+++ b/news/162.bugfix\n@@ -0,0 +1,2 @@\n+Use @@iconresolver to display icons in navigation portlet.\n+[pbauer]\n\\ No newline at end of file\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2022-04-06T12:01:50+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.portlets/commit/f13ff017e2431021ca0d9dc6fe2ad47da98c33ac

move getting normalizeString out of repeat-loop

Files changed:
M plone/app/portlets/portlets/navigation_recurse.pt

b'diff --git a/plone/app/portlets/portlets/navigation_recurse.pt b/plone/app/portlets/portlets/navigation_recurse.pt\nindex 402291c2..8b6a9d28 100644\n--- a/plone/app/portlets/portlets/navigation_recurse.pt\n+++ b/plone/app/portlets/portlets/navigation_recurse.pt\n@@ -4,7 +4,8 @@\n                     supress_icon    view/data/no_icons;\n                     supress_thumb   view/data/no_thumbs;\n                     thumb_scale view/thumb_scale;\n-                    icons nocall:context/@@iconresolver;"\n+                    icons nocall:context/@@iconresolver;\n+                    normalizeString nocall: context/plone_utils/normalizeString;"\n             i18n:domain="plone">\n \n <metal:main define-macro="nav_main"\n@@ -23,8 +24,7 @@\n                 is_in_path      node/currentParent;\n                 li_class        python:\' navTreeCurrentNode\' if is_current else \'\';\n                 li_extr_class   python:\' navTreeItemInPath\' if is_in_path else \'\';\n-                li_folder_class python:\' navTreeFolderish\' if show_children else \'\';\n-                normalizeString nocall: context/plone_utils/normalizeString;"\n+                li_folder_class python:\' navTreeFolderish\' if show_children else \'\';"\n     tal:condition="python:bottomLevel &lt;= 0 or level &lt;= bottomLevel"\n     tal:attributes="class string:navTreeItem visualNoMarker${li_class}${li_extr_class}${li_folder_class} section-${node/normalized_id}">\n \n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2022-04-06T12:18:51+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.portlets/commit/74a8857bf3729eeefb74b237204de6486fa717e6

show icons in recent portlet

Files changed:
M plone/app/portlets/portlets/recent.pt

b'diff --git a/plone/app/portlets/portlets/recent.pt b/plone/app/portlets/portlets/recent.pt\nindex e2f0214f..d7ce3ed1 100644\n--- a/plone/app/portlets/portlets/recent.pt\n+++ b/plone/app/portlets/portlets/recent.pt\n@@ -16,7 +16,8 @@\n                     image_scale portal/@@image_scale;\n                     supress_icon view/data/no_icons;\n                     supress_thumb view/data/no_thumbs;\n-                    thumb_scale view/thumb_scale">\n+                    thumb_scale view/thumb_scale;\n+                    icons nocall:context/@@iconresolver;">\n       <ul>\n         <tal:items\n             tal:define="plone_view context/@@plone;\n@@ -29,7 +30,12 @@\n                         item_wf_state_class python:\'state-\' + normalizeString(item_wf_state);\n                         item_class python:\'contenttype-\' + normalizeString(obj.portal_type) if not supress_icon else \'\';">\n           <a href="" tal:attributes="href string:${obj/getURL}/view; title obj/Description; class string:$item_wf_state_class tile $item_class">\n-            <img class="mime-icon" tal:condition="python:item_type ==\'File\' and not supress_icon" tal:attributes="href obj/getURL; src python:view.getMimeTypeIcon(obj);">\n+\n+            <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')" />\n+            <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'mimetype-{obj.mime_type}\')" />\n+\n             <img tal:condition="python:obj.getIcon and thumb_scale and not supress_thumb and image_scale" tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)" />\n             <span tal:content="obj/pretty_title_or_id">Title</span>\n           </a>\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2022-04-06T16:34:40+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.portlets/commit/a529506559bae1752c05d7781b89188e81a5a676

Merge pull request #162 from plone/show_icons_in_navigation_portlet

Use @@iconresolver to display icons in navigation portlet

Files changed:
A news/162.bugfix
M plone/app/portlets/portlets/navigation.py
M plone/app/portlets/portlets/navigation_recurse.pt
M plone/app/portlets/portlets/recent.pt

b'diff --git a/news/162.bugfix b/news/162.bugfix\nnew file mode 100644\nindex 00000000..0afcc8d2\n--- /dev/null\n+++ b/news/162.bugfix\n@@ -0,0 +1,2 @@\n+Use @@iconresolver to display icons in navigation portlet.\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/plone/app/portlets/portlets/navigation.py b/plone/app/portlets/portlets/navigation.py\nindex 0e9378cc..4d5c4f4c 100644\n--- a/plone/app/portlets/portlets/navigation.py\n+++ b/plone/app/portlets/portlets/navigation.py\n@@ -369,22 +369,6 @@ def thumb_scale(self):\n         thumb_scale_portlet = settings.thumb_scale_portlet\n         return thumb_scale_portlet\n \n-    def getMimeTypeIcon(self, node):\n-        try:\n-            if not node["normalized_portal_type"] == "file":\n-                return None\n-            fileo = node["item"].getObject().file\n-            portal_url = getNavigationRoot(self.context)\n-            mtt = getToolByName(self.context, "mimetypes_registry")\n-            if fileo.contentType:\n-                ctype = mtt.lookup(fileo.contentType)\n-                if not ctype:\n-                    return None\n-                return os.path.join(portal_url, guess_icon_path(ctype[0]))\n-        except AttributeError:\n-            return None\n-        return None\n-\n     def update(self):\n         pass\n \ndiff --git a/plone/app/portlets/portlets/navigation_recurse.pt b/plone/app/portlets/portlets/navigation_recurse.pt\nindex 1f3dd0bc..8b6a9d28 100644\n--- a/plone/app/portlets/portlets/navigation_recurse.pt\n+++ b/plone/app/portlets/portlets/navigation_recurse.pt\n@@ -3,7 +3,9 @@\n                     bottomLevel options/bottomLevel | nothing;\n                     supress_icon    view/data/no_icons;\n                     supress_thumb   view/data/no_thumbs;\n-                    thumb_scale view/thumb_scale"\n+                    thumb_scale view/thumb_scale;\n+                    icons nocall:context/@@iconresolver;\n+                    normalizeString nocall: context/plone_utils/normalizeString;"\n             i18n:domain="plone">\n \n <metal:main define-macro="nav_main"\n@@ -22,8 +24,7 @@\n                 is_in_path      node/currentParent;\n                 li_class        python:\' navTreeCurrentNode\' if is_current else \'\';\n                 li_extr_class   python:\' navTreeItemInPath\' if is_in_path else \'\';\n-                li_folder_class python:\' navTreeFolderish\' if show_children else \'\';\n-                normalizeString nocall: context/plone_utils/normalizeString;"\n+                li_folder_class python:\' navTreeFolderish\' if show_children else \'\';"\n     tal:condition="python:bottomLevel &lt;= 0 or level &lt;= bottomLevel"\n     tal:attributes="class string:navTreeItem visualNoMarker${li_class}${li_extr_class}${li_folder_class} section-${node/normalized_id}">\n \n@@ -35,9 +36,11 @@\n                            title node/Description;\n                            class string:${item_class}${li_class}${li_extr_class}${li_folder_class} ${item_type_class}">\n \n-             <img class="mime-icon" tal:condition="python:item_type ==\'File\' and not supress_icon"\n-                             tal:attributes="href node/getURL;\n-                                             src python:view.getMimeTypeIcon(node);">\n+            <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')" />\n+\n+            <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'mimetype-{item.mime_type}\')" />\n \n             <img tal:condition="python:has_thumb and thumb_scale"\n                  tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)">\ndiff --git a/plone/app/portlets/portlets/recent.pt b/plone/app/portlets/portlets/recent.pt\nindex e2f0214f..d7ce3ed1 100644\n--- a/plone/app/portlets/portlets/recent.pt\n+++ b/plone/app/portlets/portlets/recent.pt\n@@ -16,7 +16,8 @@\n                     image_scale portal/@@image_scale;\n                     supress_icon view/data/no_icons;\n                     supress_thumb view/data/no_thumbs;\n-                    thumb_scale view/thumb_scale">\n+                    thumb_scale view/thumb_scale;\n+                    icons nocall:context/@@iconresolver;">\n       <ul>\n         <tal:items\n             tal:define="plone_view context/@@plone;\n@@ -29,7 +30,12 @@\n                         item_wf_state_class python:\'state-\' + normalizeString(item_wf_state);\n                         item_class python:\'contenttype-\' + normalizeString(obj.portal_type) if not supress_icon else \'\';">\n           <a href="" tal:attributes="href string:${obj/getURL}/view; title obj/Description; class string:$item_wf_state_class tile $item_class">\n-            <img class="mime-icon" tal:condition="python:item_type ==\'File\' and not supress_icon" tal:attributes="href obj/getURL; src python:view.getMimeTypeIcon(obj);">\n+\n+            <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')" />\n+            <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n+                      tal:replace="structure python:icons.tag(f\'mimetype-{obj.mime_type}\')" />\n+\n             <img tal:condition="python:obj.getIcon and thumb_scale and not supress_thumb and image_scale" tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)" />\n             <span tal:content="obj/pretty_title_or_id">Title</span>\n           </a>\n'

