Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-04-05T17:06:00+02:00
Author: Robert Niederreiter (rnixx) <office@squarewave.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/bad4344994bbb528af7701c949128da2b3a61e11

only encode css_body if unicode to avoid unicode error

only encode css_body if unicode to avoid unicode error

Files changed:
M CHANGES.rst
M Products/CMFPlone/_scripts/_generate_gruntfile.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0100923..0ab51be 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -23,6 +23,10 @@ New:
 
 Fixes:
 
+- Only encode CSS body if unicode in gruntfile generation script to avoid
+  unicode error.
+  [rnix]
+
 - Gruntfile failed if only css or only javascripts were registered.
   [jensens]
 
diff --git a/Products/CMFPlone/_scripts/_generate_gruntfile.py b/Products/CMFPlone/_scripts/_generate_gruntfile.py
index bfa3e38..9874085 100644
--- a/Products/CMFPlone/_scripts/_generate_gruntfile.py
+++ b/Products/CMFPlone/_scripts/_generate_gruntfile.py
@@ -296,7 +296,9 @@ def resource_to_dir(resource, file_type='.js'):
                     pass
                 local_file = temp_resource_folder + '/' + file_name + '.js'
                 temp_file = open(local_file, 'w')
-                temp_file.write(css_body.encode('utf-8'))
+                if isinstance(css_body, unicode):
+                    css_body = css_body.encode('utf-8')
+                temp_file.write(css_body)
                 temp_file.close()
 
         if local_file:


