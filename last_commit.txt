Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-08-11T10:52:43+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/26837cadbfd9193805e94f7ce36ae38a6df8d749

Protect @@historyview with Modify portal content permission. Fixes #3297

Files changed:
A news/3297.feature
M Products/CMFPlone/profiles/default/actions.xml

b'diff --git a/Products/CMFPlone/profiles/default/actions.xml b/Products/CMFPlone/profiles/default/actions.xml\nindex 9d23e6f2a8..18f0a826bf 100644\n--- a/Products/CMFPlone/profiles/default/actions.xml\n+++ b/Products/CMFPlone/profiles/default/actions.xml\n@@ -101,7 +101,7 @@\n    <property name="icon_expr">string:toolbar-action/history</property>\n    <property name="available_expr"></property>\n    <property name="permissions">\n-    <element value="View"/>\n+    <element value="Modify portal content"/>\n    </property>\n    <property name="visible">True</property>\n   </object>\ndiff --git a/news/3297.feature b/news/3297.feature\nnew file mode 100644\nindex 0000000000..9005da5193\n--- /dev/null\n+++ b/news/3297.feature\n@@ -0,0 +1,2 @@\n+Protect @@historyview with Modify portal content permission. Fixes #3297\n+[pbauer]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-08-11T14:35:27+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/38bd44b73da7956affab956dce66cc24c2d91b88

Merge branch 'master' into protect_historyview_3297

Files changed:
A docs/HISTORY.rst
M CHANGES.rst
M news/3274.bugfix.1
M news/3274.bugfix.2
M setup.cfg
M setup.py
D docs/HISTORY.txt

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex a3ae16923b..541f7f2c78 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -1,6 +1,6 @@\n .. This file should contain the changes for the last release only, which\n    will be included on the package\'s page on pypi. All older entries are\n-   kept in HISTORY.txt\n+   kept in docs/HISTORY.rst\n \n Changelog\n =========\n@@ -11,654 +11,3 @@ Changelog\n    https://github.com/plone/plone.releaser/blob/master/ADD-A-NEWS-ITEM.rst\n \n .. towncrier release notes start\n-\n-5.2.2 (2020-08-16)\n-------------------\n-\n-Bug fixes:\n-\n-\n-- Release Plone 5.2.2 final.\n-  No changes with last release candidate, except that the versions will contain Products.isurlinportal 1.1.0 with a minor security hardening fix.\n-  [maurits] (#3510)\n-\n-\n-5.2.2rc3 (2020-08-16)\n----------------------\n-\n-Bug fixes:\n-\n-\n-- Return a Zope aware engine for page templates based on ``zope.pagetemplate`` instead of ``Products.PageTemplates``.\n-  Fixes possible problems with such templates, for example z3c.form ones, with Zope 4.4 and higher.\n-  See `issue 3141 <https://github.com/plone/Products.CMFPlone/issues/3141>`_.\n-  [maurits] (#3141)\n-- Depend on new package ``Products.isurlinportal``.\n-  This contains the ``isURLInPortal`` method that was split off from our ``URLTool``.\n-  See `issue 3150 <https://github.com/plone/Products.CMFPlone/issues/3150>`_.\n-  [maurits] (#3150)\n-- Redirection view: refactor our navigation root editing to a separate method ``edit_for_navigation_root``.\n-  Since Plone 5.2 the redirectiontool respects INavigationroot:\n-  with a manual redirect you cannot enter a path starting with ``/`` which \'escapes\' the NavigationRoot to the SiteRoot to link to another part of the Plone instance.\n-  This refactor makes it possible to override this method to return the redirection unchanged, brining back the pre Plone 5.2 behavior of the ``Products.RedirectionTool`` add-on.\n-  [maurits] (#3153)\n-- Control panel configlets: first check visibility, then check condition.\n-  Visibility is cheaper to check.\n-  Also fixes `bug 3154 <https://github.com/plone/Products.CMFPlone/issues/3154>`_.\n-  [maurits] (#3154)\n-\n-\n-5.2.2rc2 (2020-07-17)\n----------------------\n-\n-Bug fixes:\n-\n-\n-- Fix an issue in mail_password_template.pt in the message showing the ip to really try the request.REMOTE_ADDR variable if request.HTTP_X_FORWARDED_FOR is empty (when you\'re not behind apache or nginx).\n-  [vincentfretin] (#2949)\n-- mail_password form: Do not crash if the userid is not provided or the user doesn\'t have an email configured\n-  [frapell] (#3008)\n-\n-\n-5.2.2rc1 (2020-06-28)\n----------------------\n-\n-New features:\n-\n-\n-- Image caption support\n-  Allow ``figcaption`` in rich text editor as a valid tag.\n-  Add registry setting for plone.image_caption outputfilter transform.\n-  [thet] (#2887)\n-- Add markdown extension settings to markup control panel.\n-  [thomasmassmann] (#3076)\n-- Insert virtual custom.css bundle into the header after diazo bundle.\n-  Only add this when custom css is set in the theming control panel.\n-  [MrTango] (#3086)\n-\n-\n-Bug fixes:\n-\n-\n-- Change control panel item sorting and sort them by title\n-  [erral] (#721)\n-- Update HTMLFilter settings to enable TinyMCE styling features. See #2329, #2482, #2535\n-  [petschki] (#2482)\n-- If \'tinymce-content-css\' option is missing in themes manifest.cfg prevent unnecessary loading of a css at nav_root_url while editing a page.  [krissik] (#2861)\n-- Redirect (when possible) also ajax requests and do not return an unuseful body\n-  [ale-rt] (#3014)\n-- Merge Hotfix20200121 Check of the strength of password could be skipped. (#3021)\n-- Merge Hotfix20200121: isURLInPortal could be tricked into accepting malicious links. (#3021)\n-- Improve tests for the workflow tool method listWFStatesByTitle (#3032)\n-- Fix index_html on PortalRoot: ReplaceableWrapper did not work.\n-  [jensens] (#3060)\n-- Allow accessing ``plone_view.patterns_settings``.\n-  This was no problem until now, but a newer ``Zope/zope.tales/Chameleon``  is rightly stricter.\n-  [maurits] (#3066)\n-- Fix Python 3.8 ``time.clock`` removal in CatalogTool [jensens] (#3082)\n-- Fixed TypeError when adding both a group and a user to a group.\n-  [maurits] (#3084)\n-- Make the resource registry scripts output more robust when a bundle resource is missing. This prevents\n-  breaking your whole Plone site and access to the resource registry control panel after inserting\n-  one missing resource.\n-  [fredvd] (#3096)\n-- Bugfix for #3103\n-  [petschki] (#3105)\n-- Fixed saving ignored exception types in Python 3.  [maurits] (#3115)\n-\n-\n-5.2.1 (2020-01-13)\n-------------------\n-\n-New features:\n-\n-\n-- Add plone.staticresources to list of addons which are automatically upgraded if upgrade steps are available.\n-  [thet] (#2976)\n-\n-\n-Bug fixes:\n-\n-\n-- fix creation of Plone site not adding default Dexterity content types if example content not explicitily selected by user.\n-  [ericof] (#1318)\n-- fix default value for email msgid\n-  [erral] (#2790)\n-- Fix: PasswordResetView::getErrors is called, this ensures password is validated through RegistrationTool before attempting to reset password.\n-  [nazrulword] (#2917)\n-- Breadcrumbs: consider hidden folders when creating urls [ksuess] (#2935)\n-- Add Collection to the default_page_types list\n-  [erral] (#2956)\n-- Fix localization of "Site setup" in some control panels [vincentfretin] (#2958)\n-- Fix TTW Bundle compilation broken.\n-  [thet] (#2969)\n-- Do not save type settings in "content-controlpanel" when switching between types.\n-  [cekk] (#2986)\n-- Correctly fire events when user autologin after the password has been reset.\n-  [ericof] (#2993)\n-\n-\n-5.2.0 (2019-07-10)\n-------------------\n-\n-Bug fixes:\n-\n-\n-- Don\'t activate all sorting tabs when no sort option has been chosen.\n-  [gyst, rodfersou, jensens] (#1789)\n-- Fix test failures exposed in Python 3.8\n-  [pbauer] (#2903)\n-\n-\n-5.2rc5 (2019-06-27)\n--------------------\n-\n-New features:\n-\n-\n-- Add support for Python 3.8 [pbauer] (#2896)\n-\n-\n-Bug fixes:\n-\n-\n-- Add missing i18n:translate calls\n-  [erral] (#2891)\n-- Fix login-help layout on mobile.\n-  [jensens] (#2893)\n-\n-\n-5.2rc4 (2019-06-20)\n--------------------\n-\n-New features:\n-\n-\n-- Remove verifydb, it was moved to standalone package zodbverify.\n-  [jensens] (#2858)\n-\n-\n-Bug fixes:\n-\n-\n-- If specified in the registry, let the user autologin after the password has been reset (#2439)\n-- Allow empty ``default_page`` registry setting\n-  [petschki] (#2813)\n-- Always add ``data-default-sort`` attribute to search results.  [maurits] (#2854)\n-- Fix deprecation warnings.\n-  [jensens] (#2862)\n-- Use the shared \'Plone test setup\' and \'Plone test teardown\' keywords in Robot tests.\n-  [Rotonen] (#2864)\n-- Fix script resource parsing error because of self closing tags.\n-  [Netroxen] (#2870)\n-\n-\n-5.2rc3 (2019-05-04)\n--------------------\n-\n-New features:\n-\n-\n-- Allow filtering on date and manual/automatic in redirection controlpanel. (#2799)\n-- Add a button to export the alternative urls in redirection controlpanel. (#2799)\n-- Add a button to remove all alternative urls that match the filter.\n-  See `issue 2799 <https://github.com/plone/Products.CMFPlone/issues/2799>`_.\n-  [maurits] (#2799)\n-\n-\n-Bug fixes:\n-\n-\n-- gracefully handle tracebacks during addon installation\n-  [petschki] (#2228)\n-- Add workaround for the case when a inifite recusion in a page-template that uses the main-template crashes the instance instead of raising a RecursionError.\n-  [pbauer, esteele] (#2666)\n-- Fixed unstable Markup Control Panel robot test again.  [maurits] (#2809)\n-- add a missing space in an error message in the redirects control panel and replace "deffered" by "deferred" [vincentfretin] (#2821)\n-- Fixes: Cooking resources with non ASCII resulted in encoding error.\n-  Further, writing legacy resources resulted in ValueError. [jensens] (#2827)\n-- restore ``exclude_from_nav`` combined with ``show_excluded_items`` handling\n-  [petschki] (#2828)\n-- Fix DeprecationWarning in syndication-view. [jensens] (#2831)\n-- Fix malformed url when redirecting to external login. [ericof] (#2842)\n-- Make navigation (CatalogNavigationTabs) subclassing easier. [iham] (#2849)\n-\n-\n-5.2rc2 (2019-03-21)\n--------------------\n-\n-Bug fixes:\n-\n-\n-- Fix excluded items in navigation [ale-rt] (#2516)\n-- Add basic validators for the portal action controlpanel forms (#2689)\n-- Fix wrong msgids in link management control panel [erral] (#2788)\n-- Fix errors that abort the verification when debugging a DB with ./bin/instance verifydb -D.\n-  [pbauer] (#2792)\n-- Add summary of all errors when verifying a DB with ./bin/instance verifydb.\n-  [pbauer] (#2798)\n-- Fixed unstable SearchableText and Scenario Type querystring robot tests.  [maurits] (#2808)\n-- Fixed unstable Markup Control Panel and other robot tests.   [maurits] (#2809)\n-\n-\n-5.2rc1 (2019-03-04)\n--------------------\n-\n-New features:\n-\n-\n-- Views for title and description. [iham] (#2740)\n-- Display wsgi-state plus name and version of the server in the controlpanel\n-  [pbauer] (#2770)\n-- Enable dropdown-navigation for new sites by default. [pbauer] (#2772)\n-\n-\n-Bug fixes:\n-\n-\n-- Resolve circular dependency between `Products.CMFPlone` and `plone.i18n` by\n-  moving `ILanguageSchema` there. [sallner] (#2049)\n-- Use correct permission for mail controlpanel form so that Site Administrators\n-  can also edit. [fredvd] (#2688)\n-- Make linkintegrity robot test more reliable [MrTango] (#2752)\n-- Check only once if Products.ATContentTypes is available. [gforcada] (#2765)\n-- Fix redirection to `came_from` when url matches LOGIN_TEMPLATE_ID partly\n-  [petschki] (#2771)\n-\n-\n-5.2b1 (2019-02-13)\n-------------------\n-\n-Breaking changes:\n-\n-\n-- Factor out all static resources and the ``plone-compile-resources`` script\n-  into plone.staticresources. [thet] (#2542)\n-\n-\n-New features:\n-\n-\n-- PLIP 1486: Merge Products.RedirectionTool into core. Allow users to manage\n-  redirects on their site and aliases to content. See\n-  https://github.com/plone/Products.CMFPlone/issues/1486 [staeff, maurits]\n-  (#1486)\n-- Added multilevel dropdown navigation [agitator] (#2516)\n-- No longer mark special links by default. [pbauer] (#2736)\n-\n-\n-Bug fixes:\n-\n-\n-- Switched allowedRolesAndUsers indexer from \'View\' to the correct permission\n-  \'Access contents information\' for displaying metadata. \'View\' permission\n-  should be used on the item itself. The change should not matter for default\n-  Plone workflows, since they always use those permissions together. [agitator]\n-  (#260)\n-- deprecate catalog_get_all(catalog) in favor of catalog.getAllBrains()\n-  [pbauer] (#2258)\n-- Restore the possibility to sort catalog query results with multiple indexes\n-  (#2464)\n-- Review list portlet showed nothing to review with plone.app.multilingual, As\n-  WorkflowTool bypassed languages only for p.a.m<2.x or linguaplone. fixed and\n-  now compatible to both lang-bypassing methods. [iham] (#2595)\n-- Fixed fallback to default view when selected layout does not exist for\n-  Folder. [gbastien] (#2645)\n-- The patched init method for the class zope.sendmail.mailer.SMTPMailer has\n-  been updated, fixing a bug that was preventing to send emails. [ale-rt,\n-  nazrulworld] (#2665)\n-- a11y: Added role attribute for portalMessage [nzambello] (#2675)\n-- Fix several warnings shown when running tests on Python 3+. [gforcada]\n-  (#2683)\n-- fixed Python 3 related str decoding issue in breadcrumbs (#2694)\n-- Fixed unstable robot test Scenario: A page is opened to edit in TinyMCE.\n-  [maurits] (#2707)\n-\n-\n-5.2a2 (2018-12-30)\n-------------------\n-\n-New features:\n-\n-\n-- New robot tests for querystring in Collection type. Now almost all\n-  querystring types are robot tested. [llisa123] (#2489)\n-- Add ``load_async`` and ``load_defer`` attributes to resource registries\n-  bundle settings. When set, ``<script>`` tags are rendered with\n-  ``async="async"`` resp. ``defer="defer"`` attributes. You also need to empty\n-  the ``merge_with`` property of your bundle, because production bundles\n-  (``default.js`` and ``logged-in.js``) are never loaded with async or defer.\n-  The default.js includes jQuery and requirejs and those are needed at many\n-  places and therefore cannot be loaded asynchronously. Refs: #2649, #2657.\n-  [thet] (#2649)\n-\n-\n-Bug fixes:\n-\n-\n-- Delete ``fa_ir.js``. Keep ```fa_IR.js``. [maurits] (#2620)\n-- Forward port TinyMCE fixes from 5.1 [vangheem] (#2630)\n-- Fix robot test test_edit_user_schema: Fieldname was set duplicate (first by\n-  JS, then by robot). [jensens] (#2669)\n-\n-5.2a1 (2018-11-08)\n-------------------\n-\n-Breaking changes:\n-\n-- Removed generateUniqueId.py skins script (after it was added to Products.Archetypes).\n-  This script is no longer available outside Archetypes world.\n-  #1801\n-  [jensens]\n-\n-- Remove all dependencies on plone.app.controlpanel.\n-  Third party code need either to depend on plone.app.controlpanel 4.0,\n-  which is a backward compatibility package only, or also update to not depend on it anymore.\n-  [jensens]\n-\n-- Removed check_id.py skin script.  Replaced with utils.check_id function.\n-  #1801 and #2582.\n-  [maurits]\n-\n-- Removed my_worklist.py skin script. #1801\n-  [reinhardt]\n-\n-- Removed getObjectsFromPathList.py skin script. #1801\n-  [reinhardt]\n-\n-- Removed isExpired.py skin script. #1801\n-  [reinhardt]\n-\n-- Removed redirectToReferrer.py skin script. #1801\n-  [tlotze]\n-\n-- Removed enableHTTPCompression.py skin script. #1801\n-  [tlotze]\n-\n-- Removed setAuthCookie.py skin script. #1801\n-  [tlotze]\n-\n-- Stop configuring \'View History\' permission which was removed from Zope.\n-  [davisagli]\n-\n-- Removed legacy resource registries portal_css and portal_javascripts;\n-  no conditional handling.\n-  [ksuess]\n-\n-New features:\n-\n-- Factored out human_readable_size method for replacing getObjSize.py;\n-  removed getObjSize.py. #1801\n-  [reinhardt]\n-\n-- Update TinyMCE to 4.7.13\n-  [erral]\n-\n-- New browser view based login code - merged from plone.login (credits to esteele, pbauer, agitator, jensens, et al).\n-  `portal_skins/plone_login` is now gone, see PLIP #2092.\n-  Also, password reset view moved to login subfolder to keep things together.\n-  Some testbrowser based tests needed changes because of z3c.form based login form .\n-  The Plone specific, rarely used cross site __ac cookie SSO feature/hack was removed.\n-  In case somebody needs this, please make it an addon package.\n-  Better use a field proven, more secure way, like OAuth2, Shibboleth or someting similar.\n-  [jensens, et al]\n-\n-- Upgrade grunt + plugins to same versions as in\n-  mockup https://github.com/plone/mockup/pull/870\n-  [sunew]\n-\n-- Upgrade less in bower.json to the same version as already used\n-  in the generated package.json in compile_resources.py.\n-  [sunew]\n-\n-- Add utility-method safe_nativestring.\n-  [pbauer]\n-\n-- Rename safe_unicode to safe_text and safe_encode to safe_bytes. Keep old aliases.\n-  [pbauer]\n-- Add a ``bin/instance verifydb`` command which can be used to check\n-  that all records in the database can be successfully loaded.\n-  This is intended to help with verifying a database conversion\n-  from Python 2 to Python 3.\n-  [davisagli]\n-\n-Bug fixes:\n-\n-- Modernize robot keywords that use "Get Element Attribute"\n-  [ale-rt]\n-\n-- remove plone.app.folder dependency\n-  [petschki]\n-\n-- move GopipIndex Class to plone.folder\n-  [petschki]\n-\n-- Fixed getObjSize indexer for Python 3. #2526\n-  [reinhardt]\n-- Fix toolbar menu on mobile #2333.\n-- make groups_modify_roles test more robust.\n-  [tschorr]\n-\n--- Fix wrong CSS property to allow correct word-break.\n-  [tmassman]\n-\n- Fix toolbar menu on mobile #2333.\n-  [tmassman]\n-\n-- Removed the ``raiseUnauthorized`` skin script.\n-  If you use this, please do permission checking in your own Python code instead (likely in a browser view).\n-  Refs `issue 1801 <https://github.com/plone/Products.CMFPlone/issues/1801>`_.\n-  [maurits]\n-\n-- Remove the devdependencies from bower.json - they are just used for running tests in mockup, not here.\n-  [sunew]\n-\n-- Adapt tests to `Products.GenericSetup >= 2.0` thus requiring at least that\n-  version.\n-  [icemac]\n-\n-- Some tools from CMFCore are now utilities\n-  [pbauer]\n-\n-- Fix failing thememapper robot test after rebuild of thememapper bundle in p.a.theming PR 148\n-  [sunew]\n-\n-- Remove five.pt for Zope 4\n-  [jensens]\n-\n-- Changes for Zope 4 compatibility in maintenance controlpanel.\n-  [thet]\n-\n-- Render exceptions using an exception view instead of standard_error_message.\n-  [davisagli]\n-\n-- Remove old PlacelessTranslationService.\n-  [jensens, ksuess]\n-\n-- Fix controlpanel quickinstaller view:\n-  A not yet installed product must not return any upgrade info.\n-  [jensens]\n-\n-- Fix to make plone/plone.session#11 work:\n-  Make test for installation of  plone.session more explicit.\n-  [jensens]\n-\n-- Advanced Catalog Clear And Rebuild feature showed wrong processing time due to new queue processing.\n-  This was fixed bei calling ``processQueue()`` after indexing.\n-  [jensens]\n-\n-- Some nested `section id="edit-bar"` tag in folder_contents page #2322\n-  [terapyon]\n-\n-- Remove ``plone-generate-gruntfile`` (it is all available through ``plone-compile-resources``).\n-  [jensens]\n-\n-- Migrate from ``slimit`` to ``calmjs.parse`` for the JavaScript cooker #2616\n-  [metatoaster]\n-\n-\n-New Features:\n-\n-- Update to latest mockup\n-  [frapell]\n-\n-- Provide an utility ``dump_json_to_text`` that works both on Python 2.7 an Python 3.\n-  [ale-rt]\n-\n-- Prepare for Python 2 / 3 compatibility.\n-  [pbauer]\n-\n-- Fix imports to work with Python 3.\n-  [pbauer]\n-\n-- Mockup update.\n-  [thet]\n-\n-- add link to Plone.org VPAT accessibility statement\n-  [tkimnguyen]\n-\n-Bug Fixes:\n-\n-- Remove last legacy Javascript ``highlight-searchterms.js``.\n-  Removes also the skins folder ``plone_ecmascript``.\n-  It was broken for all (Google, other search engines, own live search);\n-  JS worked only when coming from Plone detailed search.\n-  [jensens]\n-\n-- Fix an undefined variable in a test helper function\n-  [ale-rt]\n-\n-- Let the ``combine-bundles`` import step also work when the ``IBundleRegistry`` keyword is not in ``registry.xml``, but in a ``registry`` directory.\n-  `Issue 2520 <https://github.com/plone/Products.CMFPlone/issues/2502>`_.\n-  [maurits]\n-\n-- Get rid of obsolete ``X-UA-Compatible`` header.\n-  [hvelarde]\n-\n-- Fix registration of ``robots.txt`` browser view to avoid ``AttributeError`` on Zope\'s root (fixes `#2052 <https://github.com/plone/Products.CMFPlone/issues/2052>`_).\n-  [hvelarde]\n-\n-- Get rid of obsolete ``X-UA-Compatible`` header.\n-  [hvelarde]\n-\n-- Add test for issue #2469.\n-  [jensens]\n-\n-- Fixed tests when IRichText behavior is used.\n-  IRichText -> IRichTextBehavior\n-  This is a follow up to `issue 476 <https://github.com/plone/plone.app.contenttypes/issues/476>`_.\n-  [iham]\n-\n-- Remove unused mail_password.py from skins/plone_scripts\n-  [agitator]\n-\n-- Hide ``plone.app.querystring`` from add-ons control panel.\n-  Fixes `issue 2426 <https://github.com/plone/Products.CMFPlone/issues/2426>`_.\n-  [maurits]\n-\n-- Fix tests after changes in disallowed object ids in Zope.\n-  [pbauer]\n-\n-- Do not include too new upgrades when upgrading Plone Site.\n-  Otherwise the Plone Site ends up at a newer version that the filesystem code supports,\n-  giving an error when upgrading, and resulting in possibly missed upgrades later.\n-  Fixes `issue 2377 <https://github.com/plone/Products.CMFPlone/issues/2377>`_.\n-  [maurits]\n-\n-- After site creation, do not render the add-site template: we redirect anyway.\n-  [maurits]\n-\n-- Unflakied a unit test.\n-  [Rotonen]\n-\n-- Do not show TinyMCE menu items with no subitems, Fixes #2245.\n-  [mrsaicharan1]\n-\n-- Fix Exception-View when main_template can\'t be rendered. Fixes #2325.\n-  [pbauer]\n-\n-- Render exceptions as text, not html to fix format of infos after traceback.\n-  Display as <pre> for basic and normal error templates.\n-  [pbauer]\n-\n-- Removed extra methods and tests for CMFQuickInstallerTool.\n-  Moved those to the Products.CMFQuickInstallerTool package.\n-  [maurits]\n-\n-- Added tests for add-ons control panel.\n-  Add a link to the Site Setup.\n-  Let ``get_product_version`` work when you call it with ``CMFPlacefulWorkflow`` too.\n-  [maurits]\n-\n-- Fix bad domain for translating password reset mails.\n-  [allusa]\n-\n-- Ignore invalid ``sort_on`` parameters in catalog ``searchResults``.\n-  Otherwise you get a ``CatalogError``.\n-  I get crazy sort_ons like \'194\' or \'null\'.\n-  [maurits]\n-\n-- Register the ``ExceptionView`` for the unspecific ``zope.interface.Interface`` for easier overloading.\n-  Fixes a problem, where plone.rest couldn\'t overload the ExceptionView with an adapter bound to ``plone.rest.interfaces.IAPIRequest``.\n-  [thet]\n-\n-- Fixed linkintegrity robot tests.  [maurits]\n-\n-- Fixed flaky actions controlpanel tests by waiting longer.  [maurits]\n-\n-- Require AccessControl 4.0b1 so ``guarded_getitem`` is used.\n-  Part of PloneHotfix20171128.  [maurits]\n-\n-- Improved isURLInPortal according to PloneHotfix20171128.\n-  Accept only http/https, and doubly check escaped urls.  [maurits]\n-\n-- Fix exception view when called on Zope-root. Fixes #2203.\n-  [pbauer]\n-\n-- added CSS hyphenation support for toolbar for avoiding ugly text wrapping\n-  Fixes `issue 723 <https://github.com/plone/Products.CMFPlone/issues/723>`_.\n-  [ajung]\n-\n-- Increase compatibility with Python3.\n-  [ale-rt]\n-\n-- Show example for expression in actions control panel.\n-  [maurits]\n-\n-- Fix test where you cannot instanciate a PythonScript with the id script.\n-  [pbauer]\n-\n-- Set the status of an exception view according to the exception type.\n-  Fixes `issue 2187 <https://github.com/plone/Products.CMFPlone/issues/2187>`_.\n-  [maurits]\n-\n-- Use absolute imports for Python3 compatibility\n-  [ale-rt]\n-\n-- Fallback for missing date in DefaultDublinCoreImpl no longer relies on\n-  bobobase_modification_time.\n-  [pbauer]\n-\n-- Display real version of Zope, not of the empty meta-package Zope2.\n-  [pbauer]\n-\n-- Add zcml-condition plone-52 for conditional configuration.\n-  [pbauer]\n-\n-- Use getSite in set_own_login_name to get the portals acl_users.\n-  [pbauer]\n-\n-- Fix test issue with rarely used multi-site SSO feature.\n-  ``came_from`` on ``@register`` link would point to wrong site.\n-  Completly removed ``came_from`` on ``@@register`` link.\n-  It does not make much sense anyway and we test nowhere if there is a came_from on that link.\n-  [jensens]\n-\n-- Remove depricated ``type`` attribute from ``script`` and ``link`` tags.\n-  [newbazz]\n-\n-- Render tinymce attributes correctly in Python3.\n-  [sallner]\n-\n-- Remove unresolved dependencies of plone-final to cssregistry and jsregistry.\n-  [pbauer]\ndiff --git a/docs/HISTORY.txt b/docs/HISTORY.rst\nsimilarity index 95%\nrename from docs/HISTORY.txt\nrename to docs/HISTORY.rst\nindex 06a08a99aa..15e39e0977 100644\n--- a/docs/HISTORY.txt\n+++ b/docs/HISTORY.rst\n@@ -1,7 +1,663 @@\n Historical release notes\n ========================\n \n-For what\'s new in this release, see CHANGES.txt.\n+This contains the changelogs from older releases.\n+Note that there are large gaps, for example there is nothing between 4.3.3 and 5.0.0.\n+So the value of this historical record is currently doubtful.\n+\n+For what\'s new in the current release, see CHANGES.txt.\n+\n+\n+5.2.2 (2020-08-16)\n+------------------\n+\n+Bug fixes:\n+\n+\n+- Release Plone 5.2.2 final.\n+  No changes with last release candidate, except that the versions will contain Products.isurlinportal 1.1.0 with a minor security hardening fix.\n+  [maurits] (#3510)\n+\n+\n+5.2.2rc3 (2020-08-16)\n+---------------------\n+\n+Bug fixes:\n+\n+\n+- Return a Zope aware engine for page templates based on ``zope.pagetemplate`` instead of ``Products.PageTemplates``.\n+  Fixes possible problems with such templates, for example z3c.form ones, with Zope 4.4 and higher.\n+  See `issue 3141 <https://github.com/plone/Products.CMFPlone/issues/3141>`_.\n+  [maurits] (#3141)\n+- Depend on new package ``Products.isurlinportal``.\n+  This contains the ``isURLInPortal`` method that was split off from our ``URLTool``.\n+  See `issue 3150 <https://github.com/plone/Products.CMFPlone/issues/3150>`_.\n+  [maurits] (#3150)\n+- Redirection view: refactor our navigation root editing to a separate method ``edit_for_navigation_root``.\n+  Since Plone 5.2 the redirectiontool respects INavigationroot:\n+  with a manual redirect you cannot enter a path starting with ``/`` which \'escapes\' the NavigationRoot to the SiteRoot to link to another part of the Plone instance.\n+  This refactor makes it possible to override this method to return the redirection unchanged, brining back the pre Plone 5.2 behavior of the ``Products.RedirectionTool`` add-on.\n+  [maurits] (#3153)\n+- Control panel configlets: first check visibility, then check condition.\n+  Visibility is cheaper to check.\n+  Also fixes `bug 3154 <https://github.com/plone/Products.CMFPlone/issues/3154>`_.\n+  [maurits] (#3154)\n+\n+\n+5.2.2rc2 (2020-07-17)\n+---------------------\n+\n+Bug fixes:\n+\n+\n+- Fix an issue in mail_password_template.pt in the message showing the ip to really try the request.REMOTE_ADDR variable if request.HTTP_X_FORWARDED_FOR is empty (when you\'re not behind apache or nginx).\n+  [vincentfretin] (#2949)\n+- mail_password form: Do not crash if the userid is not provided or the user doesn\'t have an email configured\n+  [frapell] (#3008)\n+\n+\n+5.2.2rc1 (2020-06-28)\n+---------------------\n+\n+New features:\n+\n+\n+- Image caption support\n+  Allow ``figcaption`` in rich text editor as a valid tag.\n+  Add registry setting for plone.image_caption outputfilter transform.\n+  [thet] (#2887)\n+- Add markdown extension settings to markup control panel.\n+  [thomasmassmann] (#3076)\n+- Insert virtual custom.css bundle into the header after diazo bundle.\n+  Only add this when custom css is set in the theming control panel.\n+  [MrTango] (#3086)\n+\n+\n+Bug fixes:\n+\n+\n+- Change control panel item sorting and sort them by title\n+  [erral] (#721)\n+- Update HTMLFilter settings to enable TinyMCE styling features. See #2329, #2482, #2535\n+  [petschki] (#2482)\n+- If \'tinymce-content-css\' option is missing in themes manifest.cfg prevent unnecessary loading of a css at nav_root_url while editing a page.  [krissik] (#2861)\n+- Redirect (when possible) also ajax requests and do not return an unuseful body\n+  [ale-rt] (#3014)\n+- Merge Hotfix20200121 Check of the strength of password could be skipped. (#3021)\n+- Merge Hotfix20200121: isURLInPortal could be tricked into accepting malicious links. (#3021)\n+- Improve tests for the workflow tool method listWFStatesByTitle (#3032)\n+- Fix index_html on PortalRoot: ReplaceableWrapper did not work.\n+  [jensens] (#3060)\n+- Allow accessing ``plone_view.patterns_settings``.\n+  This was no problem until now, but a newer ``Zope/zope.tales/Chameleon``  is rightly stricter.\n+  [maurits] (#3066)\n+- Fix Python 3.8 ``time.clock`` removal in CatalogTool [jensens] (#3082)\n+- Fixed TypeError when adding both a group and a user to a group.\n+  [maurits] (#3084)\n+- Make the resource registry scripts output more robust when a bundle resource is missing. This prevents\n+  breaking your whole Plone site and access to the resource registry control panel after inserting\n+  one missing resource.\n+  [fredvd] (#3096)\n+- Bugfix for #3103\n+  [petschki] (#3105)\n+- Fixed saving ignored exception types in Python 3.  [maurits] (#3115)\n+\n+\n+5.2.1 (2020-01-13)\n+------------------\n+\n+New features:\n+\n+\n+- Add plone.staticresources to list of addons which are automatically upgraded if upgrade steps are available.\n+  [thet] (#2976)\n+\n+\n+Bug fixes:\n+\n+\n+- fix creation of Plone site not adding default Dexterity content types if example content not explicitily selected by user.\n+  [ericof] (#1318)\n+- fix default value for email msgid\n+  [erral] (#2790)\n+- Fix: PasswordResetView::getErrors is called, this ensures password is validated through RegistrationTool before attempting to reset password.\n+  [nazrulword] (#2917)\n+- Breadcrumbs: consider hidden folders when creating urls [ksuess] (#2935)\n+- Add Collection to the default_page_types list\n+  [erral] (#2956)\n+- Fix localization of "Site setup" in some control panels [vincentfretin] (#2958)\n+- Fix TTW Bundle compilation broken.\n+  [thet] (#2969)\n+- Do not save type settings in "content-controlpanel" when switching between types.\n+  [cekk] (#2986)\n+- Correctly fire events when user autologin after the password has been reset.\n+  [ericof] (#2993)\n+\n+\n+5.2.0 (2019-07-10)\n+------------------\n+\n+Bug fixes:\n+\n+\n+- Don\'t activate all sorting tabs when no sort option has been chosen.\n+  [gyst, rodfersou, jensens] (#1789)\n+- Fix test failures exposed in Python 3.8\n+  [pbauer] (#2903)\n+\n+\n+5.2rc5 (2019-06-27)\n+-------------------\n+\n+New features:\n+\n+\n+- Add support for Python 3.8 [pbauer] (#2896)\n+\n+\n+Bug fixes:\n+\n+\n+- Add missing i18n:translate calls\n+  [erral] (#2891)\n+- Fix login-help layout on mobile.\n+  [jensens] (#2893)\n+\n+\n+5.2rc4 (2019-06-20)\n+-------------------\n+\n+New features:\n+\n+\n+- Remove verifydb, it was moved to standalone package zodbverify.\n+  [jensens] (#2858)\n+\n+\n+Bug fixes:\n+\n+\n+- If specified in the registry, let the user autologin after the password has been reset (#2439)\n+- Allow empty ``default_page`` registry setting\n+  [petschki] (#2813)\n+- Always add ``data-default-sort`` attribute to search results.  [maurits] (#2854)\n+- Fix deprecation warnings.\n+  [jensens] (#2862)\n+- Use the shared \'Plone test setup\' and \'Plone test teardown\' keywords in Robot tests.\n+  [Rotonen] (#2864)\n+- Fix script resource parsing error because of self closing tags.\n+  [Netroxen] (#2870)\n+\n+\n+5.2rc3 (2019-05-04)\n+-------------------\n+\n+New features:\n+\n+\n+- Allow filtering on date and manual/automatic in redirection controlpanel. (#2799)\n+- Add a button to export the alternative urls in redirection controlpanel. (#2799)\n+- Add a button to remove all alternative urls that match the filter.\n+  See `issue 2799 <https://github.com/plone/Products.CMFPlone/issues/2799>`_.\n+  [maurits] (#2799)\n+\n+\n+Bug fixes:\n+\n+\n+- gracefully handle tracebacks during addon installation\n+  [petschki] (#2228)\n+- Add workaround for the case when a inifite recusion in a page-template that uses the main-template crashes the instance instead of raising a RecursionError.\n+  [pbauer, esteele] (#2666)\n+- Fixed unstable Markup Control Panel robot test again.  [maurits] (#2809)\n+- add a missing space in an error message in the redirects control panel and replace "deffered" by "deferred" [vincentfretin] (#2821)\n+- Fixes: Cooking resources with non ASCII resulted in encoding error.\n+  Further, writing legacy resources resulted in ValueError. [jensens] (#2827)\n+- restore ``exclude_from_nav`` combined with ``show_excluded_items`` handling\n+  [petschki] (#2828)\n+- Fix DeprecationWarning in syndication-view. [jensens] (#2831)\n+- Fix malformed url when redirecting to external login. [ericof] (#2842)\n+- Make navigation (CatalogNavigationTabs) subclassing easier. [iham] (#2849)\n+\n+\n+5.2rc2 (2019-03-21)\n+-------------------\n+\n+Bug fixes:\n+\n+\n+- Fix excluded items in navigation [ale-rt] (#2516)\n+- Add basic validators for the portal action controlpanel forms (#2689)\n+- Fix wrong msgids in link management control panel [erral] (#2788)\n+- Fix errors that abort the verification when debugging a DB with ./bin/instance verifydb -D.\n+  [pbauer] (#2792)\n+- Add summary of all errors when verifying a DB with ./bin/instance verifydb.\n+  [pbauer] (#2798)\n+- Fixed unstable SearchableText and Scenario Type querystring robot tests.  [maurits] (#2808)\n+- Fixed unstable Markup Control Panel and other robot tests.   [maurits] (#2809)\n+\n+\n+5.2rc1 (2019-03-04)\n+-------------------\n+\n+New features:\n+\n+\n+- Views for title and description. [iham] (#2740)\n+- Display wsgi-state plus name and version of the server in the controlpanel\n+  [pbauer] (#2770)\n+- Enable dropdown-navigation for new sites by default. [pbauer] (#2772)\n+\n+\n+Bug fixes:\n+\n+\n+- Resolve circular dependency between `Products.CMFPlone` and `plone.i18n` by\n+  moving `ILanguageSchema` there. [sallner] (#2049)\n+- Use correct permission for mail controlpanel form so that Site Administrators\n+  can also edit. [fredvd] (#2688)\n+- Make linkintegrity robot test more reliable [MrTango] (#2752)\n+- Check only once if Products.ATContentTypes is available. [gforcada] (#2765)\n+- Fix redirection to `came_from` when url matches LOGIN_TEMPLATE_ID partly\n+  [petschki] (#2771)\n+\n+\n+5.2b1 (2019-02-13)\n+------------------\n+\n+Breaking changes:\n+\n+\n+- Factor out all static resources and the ``plone-compile-resources`` script\n+  into plone.staticresources. [thet] (#2542)\n+\n+\n+New features:\n+\n+\n+- PLIP 1486: Merge Products.RedirectionTool into core. Allow users to manage\n+  redirects on their site and aliases to content. See\n+  https://github.com/plone/Products.CMFPlone/issues/1486 [staeff, maurits]\n+  (#1486)\n+- Added multilevel dropdown navigation [agitator] (#2516)\n+- No longer mark special links by default. [pbauer] (#2736)\n+\n+\n+Bug fixes:\n+\n+\n+- Switched allowedRolesAndUsers indexer from \'View\' to the correct permission\n+  \'Access contents information\' for displaying metadata. \'View\' permission\n+  should be used on the item itself. The change should not matter for default\n+  Plone workflows, since they always use those permissions together. [agitator]\n+  (#260)\n+- deprecate catalog_get_all(catalog) in favor of catalog.getAllBrains()\n+  [pbauer] (#2258)\n+- Restore the possibility to sort catalog query results with multiple indexes\n+  (#2464)\n+- Review list portlet showed nothing to review with plone.app.multilingual, As\n+  WorkflowTool bypassed languages only for p.a.m<2.x or linguaplone. fixed and\n+  now compatible to both lang-bypassing methods. [iham] (#2595)\n+- Fixed fallback to default view when selected layout does not exist for\n+  Folder. [gbastien] (#2645)\n+- The patched init method for the class zope.sendmail.mailer.SMTPMailer has\n+  been updated, fixing a bug that was preventing to send emails. [ale-rt,\n+  nazrulworld] (#2665)\n+- a11y: Added role attribute for portalMessage [nzambello] (#2675)\n+- Fix several warnings shown when running tests on Python 3+. [gforcada]\n+  (#2683)\n+- fixed Python 3 related str decoding issue in breadcrumbs (#2694)\n+- Fixed unstable robot test Scenario: A page is opened to edit in TinyMCE.\n+  [maurits] (#2707)\n+\n+\n+5.2a2 (2018-12-30)\n+------------------\n+\n+New features:\n+\n+\n+- New robot tests for querystring in Collection type. Now almost all\n+  querystring types are robot tested. [llisa123] (#2489)\n+- Add ``load_async`` and ``load_defer`` attributes to resource registries\n+  bundle settings. When set, ``<script>`` tags are rendered with\n+  ``async="async"`` resp. ``defer="defer"`` attributes. You also need to empty\n+  the ``merge_with`` property of your bundle, because production bundles\n+  (``default.js`` and ``logged-in.js``) are never loaded with async or defer.\n+  The default.js includes jQuery and requirejs and those are needed at many\n+  places and therefore cannot be loaded asynchronously. Refs: #2649, #2657.\n+  [thet] (#2649)\n+\n+\n+Bug fixes:\n+\n+\n+- Delete ``fa_ir.js``. Keep ```fa_IR.js``. [maurits] (#2620)\n+- Forward port TinyMCE fixes from 5.1 [vangheem] (#2630)\n+- Fix robot test test_edit_user_schema: Fieldname was set duplicate (first by\n+  JS, then by robot). [jensens] (#2669)\n+\n+5.2a1 (2018-11-08)\n+------------------\n+\n+Breaking changes:\n+\n+- Removed generateUniqueId.py skins script (after it was added to Products.Archetypes).\n+  This script is no longer available outside Archetypes world.\n+  #1801\n+  [jensens]\n+\n+- Remove all dependencies on plone.app.controlpanel.\n+  Third party code need either to depend on plone.app.controlpanel 4.0,\n+  which is a backward compatibility package only, or also update to not depend on it anymore.\n+  [jensens]\n+\n+- Removed check_id.py skin script.  Replaced with utils.check_id function.\n+  #1801 and #2582.\n+  [maurits]\n+\n+- Removed my_worklist.py skin script. #1801\n+  [reinhardt]\n+\n+- Removed getObjectsFromPathList.py skin script. #1801\n+  [reinhardt]\n+\n+- Removed isExpired.py skin script. #1801\n+  [reinhardt]\n+\n+- Removed redirectToReferrer.py skin script. #1801\n+  [tlotze]\n+\n+- Removed enableHTTPCompression.py skin script. #1801\n+  [tlotze]\n+\n+- Removed setAuthCookie.py skin script. #1801\n+  [tlotze]\n+\n+- Stop configuring \'View History\' permission which was removed from Zope.\n+  [davisagli]\n+\n+- Removed legacy resource registries portal_css and portal_javascripts;\n+  no conditional handling.\n+  [ksuess]\n+\n+New features:\n+\n+- Factored out human_readable_size method for replacing getObjSize.py;\n+  removed getObjSize.py. #1801\n+  [reinhardt]\n+\n+- Update TinyMCE to 4.7.13\n+  [erral]\n+\n+- New browser view based login code - merged from plone.login (credits to esteele, pbauer, agitator, jensens, et al).\n+  `portal_skins/plone_login` is now gone, see PLIP #2092.\n+  Also, password reset view moved to login subfolder to keep things together.\n+  Some testbrowser based tests needed changes because of z3c.form based login form .\n+  The Plone specific, rarely used cross site __ac cookie SSO feature/hack was removed.\n+  In case somebody needs this, please make it an addon package.\n+  Better use a field proven, more secure way, like OAuth2, Shibboleth or someting similar.\n+  [jensens, et al]\n+\n+- Upgrade grunt + plugins to same versions as in\n+  mockup https://github.com/plone/mockup/pull/870\n+  [sunew]\n+\n+- Upgrade less in bower.json to the same version as already used\n+  in the generated package.json in compile_resources.py.\n+  [sunew]\n+\n+- Add utility-method safe_nativestring.\n+  [pbauer]\n+\n+- Rename safe_unicode to safe_text and safe_encode to safe_bytes. Keep old aliases.\n+  [pbauer]\n+- Add a ``bin/instance verifydb`` command which can be used to check\n+  that all records in the database can be successfully loaded.\n+  This is intended to help with verifying a database conversion\n+  from Python 2 to Python 3.\n+  [davisagli]\n+\n+Bug fixes:\n+\n+- Modernize robot keywords that use "Get Element Attribute"\n+  [ale-rt]\n+\n+- remove plone.app.folder dependency\n+  [petschki]\n+\n+- move GopipIndex Class to plone.folder\n+  [petschki]\n+\n+- Fixed getObjSize indexer for Python 3. #2526\n+  [reinhardt]\n+- Fix toolbar menu on mobile #2333.\n+- make groups_modify_roles test more robust.\n+  [tschorr]\n+\n+-- Fix wrong CSS property to allow correct word-break.\n+  [tmassman]\n+\n+ Fix toolbar menu on mobile #2333.\n+  [tmassman]\n+\n+- Removed the ``raiseUnauthorized`` skin script.\n+  If you use this, please do permission checking in your own Python code instead (likely in a browser view).\n+  Refs `issue 1801 <https://github.com/plone/Products.CMFPlone/issues/1801>`_.\n+  [maurits]\n+\n+- Remove the devdependencies from bower.json - they are just used for running tests in mockup, not here.\n+  [sunew]\n+\n+- Adapt tests to `Products.GenericSetup >= 2.0` thus requiring at least that\n+  version.\n+  [icemac]\n+\n+- Some tools from CMFCore are now utilities\n+  [pbauer]\n+\n+- Fix failing thememapper robot test after rebuild of thememapper bundle in p.a.theming PR 148\n+  [sunew]\n+\n+- Remove five.pt for Zope 4\n+  [jensens]\n+\n+- Changes for Zope 4 compatibility in maintenance controlpanel.\n+  [thet]\n+\n+- Render exceptions using an exception view instead of standard_error_message.\n+  [davisagli]\n+\n+- Remove old PlacelessTranslationService.\n+  [jensens, ksuess]\n+\n+- Fix controlpanel quickinstaller view:\n+  A not yet installed product must not return any upgrade info.\n+  [jensens]\n+\n+- Fix to make plone/plone.session#11 work:\n+  Make test for installation of  plone.session more explicit.\n+  [jensens]\n+\n+- Advanced Catalog Clear And Rebuild feature showed wrong processing time due to new queue processing.\n+  This was fixed bei calling ``processQueue()`` after indexing.\n+  [jensens]\n+\n+- Some nested `section id="edit-bar"` tag in folder_contents page #2322\n+  [terapyon]\n+\n+- Remove ``plone-generate-gruntfile`` (it is all available through ``plone-compile-resources``).\n+  [jensens]\n+\n+- Migrate from ``slimit`` to ``calmjs.parse`` for the JavaScript cooker #2616\n+  [metatoaster]\n+\n+\n+New Features:\n+\n+- Update to latest mockup\n+  [frapell]\n+\n+- Provide an utility ``dump_json_to_text`` that works both on Python 2.7 an Python 3.\n+  [ale-rt]\n+\n+- Prepare for Python 2 / 3 compatibility.\n+  [pbauer]\n+\n+- Fix imports to work with Python 3.\n+  [pbauer]\n+\n+- Mockup update.\n+  [thet]\n+\n+- add link to Plone.org VPAT accessibility statement\n+  [tkimnguyen]\n+\n+Bug Fixes:\n+\n+- Remove last legacy Javascript ``highlight-searchterms.js``.\n+  Removes also the skins folder ``plone_ecmascript``.\n+  It was broken for all (Google, other search engines, own live search);\n+  JS worked only when coming from Plone detailed search.\n+  [jensens]\n+\n+- Fix an undefined variable in a test helper function\n+  [ale-rt]\n+\n+- Let the ``combine-bundles`` import step also work when the ``IBundleRegistry`` keyword is not in ``registry.xml``, but in a ``registry`` directory.\n+  `Issue 2520 <https://github.com/plone/Products.CMFPlone/issues/2502>`_.\n+  [maurits]\n+\n+- Get rid of obsolete ``X-UA-Compatible`` header.\n+  [hvelarde]\n+\n+- Fix registration of ``robots.txt`` browser view to avoid ``AttributeError`` on Zope\'s root (fixes `#2052 <https://github.com/plone/Products.CMFPlone/issues/2052>`_).\n+  [hvelarde]\n+\n+- Get rid of obsolete ``X-UA-Compatible`` header.\n+  [hvelarde]\n+\n+- Add test for issue #2469.\n+  [jensens]\n+\n+- Fixed tests when IRichText behavior is used.\n+  IRichText -> IRichTextBehavior\n+  This is a follow up to `issue 476 <https://github.com/plone/plone.app.contenttypes/issues/476>`_.\n+  [iham]\n+\n+- Remove unused mail_password.py from skins/plone_scripts\n+  [agitator]\n+\n+- Hide ``plone.app.querystring`` from add-ons control panel.\n+  Fixes `issue 2426 <https://github.com/plone/Products.CMFPlone/issues/2426>`_.\n+  [maurits]\n+\n+- Fix tests after changes in disallowed object ids in Zope.\n+  [pbauer]\n+\n+- Do not include too new upgrades when upgrading Plone Site.\n+  Otherwise the Plone Site ends up at a newer version that the filesystem code supports,\n+  giving an error when upgrading, and resulting in possibly missed upgrades later.\n+  Fixes `issue 2377 <https://github.com/plone/Products.CMFPlone/issues/2377>`_.\n+  [maurits]\n+\n+- After site creation, do not render the add-site template: we redirect anyway.\n+  [maurits]\n+\n+- Unflakied a unit test.\n+  [Rotonen]\n+\n+- Do not show TinyMCE menu items with no subitems, Fixes #2245.\n+  [mrsaicharan1]\n+\n+- Fix Exception-View when main_template can\'t be rendered. Fixes #2325.\n+  [pbauer]\n+\n+- Render exceptions as text, not html to fix format of infos after traceback.\n+  Display as <pre> for basic and normal error templates.\n+  [pbauer]\n+\n+- Removed extra methods and tests for CMFQuickInstallerTool.\n+  Moved those to the Products.CMFQuickInstallerTool package.\n+  [maurits]\n+\n+- Added tests for add-ons control panel.\n+  Add a link to the Site Setup.\n+  Let ``get_product_version`` work when you call it with ``CMFPlacefulWorkflow`` too.\n+  [maurits]\n+\n+- Fix bad domain for translating password reset mails.\n+  [allusa]\n+\n+- Ignore invalid ``sort_on`` parameters in catalog ``searchResults``.\n+  Otherwise you get a ``CatalogError``.\n+  I get crazy sort_ons like \'194\' or \'null\'.\n+  [maurits]\n+\n+- Register the ``ExceptionView`` for the unspecific ``zope.interface.Interface`` for easier overloading.\n+  Fixes a problem, where plone.rest couldn\'t overload the ExceptionView with an adapter bound to ``plone.rest.interfaces.IAPIRequest``.\n+  [thet]\n+\n+- Fixed linkintegrity robot tests.  [maurits]\n+\n+- Fixed flaky actions controlpanel tests by waiting longer.  [maurits]\n+\n+- Require AccessControl 4.0b1 so ``guarded_getitem`` is used.\n+  Part of PloneHotfix20171128.  [maurits]\n+\n+- Improved isURLInPortal according to PloneHotfix20171128.\n+  Accept only http/https, and doubly check escaped urls.  [maurits]\n+\n+- Fix exception view when called on Zope-root. Fixes #2203.\n+  [pbauer]\n+\n+- added CSS hyphenation support for toolbar for avoiding ugly text wrapping\n+  Fixes `issue 723 <https://github.com/plone/Products.CMFPlone/issues/723>`_.\n+  [ajung]\n+\n+- Increase compatibility with Python3.\n+  [ale-rt]\n+\n+- Show example for expression in actions control panel.\n+  [maurits]\n+\n+- Fix test where you cannot instanciate a PythonScript with the id script.\n+  [pbauer]\n+\n+- Set the status of an exception view according to the exception type.\n+  Fixes `issue 2187 <https://github.com/plone/Products.CMFPlone/issues/2187>`_.\n+  [maurits]\n+\n+- Use absolute imports for Python3 compatibility\n+  [ale-rt]\n+\n+- Fallback for missing date in DefaultDublinCoreImpl no longer relies on\n+  bobobase_modification_time.\n+  [pbauer]\n+\n+- Display real version of Zope, not of the empty meta-package Zope2.\n+  [pbauer]\n+\n+- Add zcml-condition plone-52 for conditional configuration.\n+  [pbauer]\n+\n+- Use getSite in set_own_login_name to get the portals acl_users.\n+  [pbauer]\n+\n+- Fix test issue with rarely used multi-site SSO feature.\n+  ``came_from`` on ``@register`` link would point to wrong site.\n+  Completly removed ``came_from`` on ``@@register`` link.\n+  It does not make much sense anyway and we test nowhere if there is a came_from on that link.\n+  [jensens]\n+\n+- Remove depricated ``type`` attribute from ``script`` and ``link`` tags.\n+  [newbazz]\n+\n+- Render tinymce attributes correctly in Python3.\n+  [sallner]\n+\n+- Remove unresolved dependencies of plone-final to cssregistry and jsregistry.\n+  [pbauer]\n \n \n 5.1rc2 (unreleased)\n@@ -155,7 +811,7 @@ Bug fixes:\n - Gruntfile generation no longer fails on introspecting resourceDirectory\n   configurations using a plone.browserlayer layer, by loading all layers\n   configured for the site used during generation.\n-  Fixes Issue `#2080`_.\n+  Fixes `issue 2080 <https://github.com/plone/Products.CMFPlone/issues/2080>`_.\n   [seanupton]\n \n - fixed css-classes for thumb scales ...\n@@ -2380,7 +3036,7 @@ Fixes:\n \n \n 4.2.1.1 (2012-08-23)\n-------------------\n+--------------------\n \n - Fixed i18n of image view improvement introduced in 4.2.1.\n   [vincentfretin]\n@@ -2400,8 +3056,10 @@ Fixes:\n   [thomasdesvenain]\n \n - Improve image view:\n+\n     - Add a download button.\n     - Display View button only if image is a web format (jpeg, png, gif...)\n+\n   [thomasdesvenain]\n \n - zope.globalrequest is a required dependency on tests.\ndiff --git a/news/3274.bugfix.1 b/news/3274.bugfix.1\nindex 7d9f538d12..af26a7e9eb 100644\n--- a/news/3274.bugfix.1\n+++ b/news/3274.bugfix.1\n@@ -1,3 +1,3 @@\n Removed the docstring from various methods to avoid making them available via a url.\n-From `Products.PloneHotfix20210518 <https://plone.org/security/hotfix/20210518/reflected-xss-in-various-spots>`_.\n+From the `Products.PloneHotfix20210518 reflected XSS fix <https://plone.org/security/hotfix/20210518/reflected-xss-in-various-spots>`_.\n [maurits]\ndiff --git a/news/3274.bugfix.2 b/news/3274.bugfix.2\nindex eaefaa3547..cfe4f9372e 100644\n--- a/news/3274.bugfix.2\n+++ b/news/3274.bugfix.2\n@@ -1,3 +1,3 @@\n-Add the expressions patch from `Products.PloneHotfix20210518 <https://plone.org/security/hotfix/20210518/remote-code-execution-via-traversal-in-expressions>`_.\n+Add the remote code execution fix from the `Products.PloneHotfix20210518 expressions patch <https://plone.org/security/hotfix/20210518/remote-code-execution-via-traversal-in-expressions>`_.\n We need this because Zope 4.6.2 is too strict for us.\n [maurits]\ndiff --git a/setup.cfg b/setup.cfg\nindex 77b09549f4..fedd44695f 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -2,7 +2,7 @@\n extra-message = [ci skip]\n \n [bdist_wheel]\n-universal = 1\n+universal = 0\n \n [isort]\n force_alphabetical_sort=True\ndiff --git a/setup.py b/setup.py\nindex c57e101093..3b123a81de 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -34,7 +34,7 @@\n     include_package_data=True,\n     zip_safe=False,\n     install_requires=[\n-        \'AccessControl >= 4.0b1\',\n+        \'AccessControl >= 4.0\',\n         \'Acquisition\',\n         \'borg.localrole\',\n         \'calmjs.parse\',\n@@ -47,14 +47,14 @@\n         \'plone.api >= 1.4.4\',\n         \'plone.app.content\',\n         \'plone.app.contentlisting\',\n-        \'plone.app.contentmenu >= 1.1.6dev-r22380\',\n+        \'plone.app.contentmenu >= 2.0.1\',\n         \'plone.app.contentrules\',\n         \'plone.app.contenttypes\',\n         \'plone.app.customerize\',\n         \'plone.app.dexterity\',\n         \'plone.app.discussion\',\n         \'plone.app.i18n\',\n-        \'plone.app.layout >=1.1.7dev-r23744\',\n+        \'plone.app.layout >= 2.5.15\',\n         \'plone.app.linkintegrity >=1.0.3\',\n         \'plone.app.locales\',\n         \'plone.app.multilingual\',\n@@ -68,10 +68,10 @@\n         \'plone.app.vocabularies\',\n         \'plone.app.workflow\',\n         \'plone.batching\',\n-        \'plone.browserlayer >= 1.0rc4\',\n+        \'plone.browserlayer >= 2.1.5\',\n         \'plone.contentrules\',\n         \'plone.folder\',\n-        \'plone.i18n >= 4.0.4.dev0\',\n+        \'plone.i18n >= 4.0.5\',\n         \'plone.indexer\',\n         \'plone.intelligenttext\',\n         \'plone.locking\',\n@@ -80,7 +80,7 @@\n         \'plone.portlet.collection\',\n         \'plone.portlet.static\',\n         \'plone.portlets\',\n-        \'plone.protect >= 3.0.0a1\',\n+        \'plone.protect >= 3.0.0\',\n         \'plone.registry\',\n         \'plone.schema\',\n         \'plone.session\',\n@@ -95,7 +95,7 @@\n         \'Products.CMFUid\',\n         \'Products.DCWorkflow\',\n         \'Products.ExtendedPathIndex\',\n-        \'Products.GenericSetup >= 2.0.dev0\',\n+        \'Products.GenericSetup >= 2.0\',\n         \'Products.isurlinportal\',\n         \'Products.MimetypesRegistry\',\n         \'Products.PlonePAS\',\n@@ -109,7 +109,7 @@\n         \'transaction\',\n         \'z3c.autoinclude\',\n         \'ZODB3\',\n-        \'Zope[wsgi] >= 4.0b5\',\n+        \'Zope[wsgi] >= 4.0\',\n         \'zope.app.locales >= 3.6.0\',\n         \'zope.cachedescriptors\',\n         \'zope.component\',\n@@ -134,7 +134,7 @@\n         \'test\': [\n             \'lxml\',\n             \'mock\',\n-            \'plone.app.robotframework>0.9.16\',\n+            \'plone.app.robotframework>=1.0\',\n             \'robotframework-debuglibrary\',\n             \'plone.app.testing\',\n             \'zope.globalrequest\',\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-08-11T16:49:33+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/de5dc3074c94c4ef05956e1a0eec9ab3a0be3629

Merge pull request #3298 from plone/protect_historyview_3297

Protect @@historyview with Modify portal content permission

Files changed:
A news/3297.feature
M Products/CMFPlone/profiles/default/actions.xml

b'diff --git a/Products/CMFPlone/profiles/default/actions.xml b/Products/CMFPlone/profiles/default/actions.xml\nindex 9d23e6f2a8..18f0a826bf 100644\n--- a/Products/CMFPlone/profiles/default/actions.xml\n+++ b/Products/CMFPlone/profiles/default/actions.xml\n@@ -101,7 +101,7 @@\n    <property name="icon_expr">string:toolbar-action/history</property>\n    <property name="available_expr"></property>\n    <property name="permissions">\n-    <element value="View"/>\n+    <element value="Modify portal content"/>\n    </property>\n    <property name="visible">True</property>\n   </object>\ndiff --git a/news/3297.feature b/news/3297.feature\nnew file mode 100644\nindex 0000000000..9005da5193\n--- /dev/null\n+++ b/news/3297.feature\n@@ -0,0 +1,2 @@\n+Protect @@historyview with Modify portal content permission. Fixes #3297\n+[pbauer]\n\\ No newline at end of file\n'

