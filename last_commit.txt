Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-03-18T07:49:34+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/2e63e93f7da5e290023bfb4001b8a04978f7965d

Compatibility with latest z3c.form

Files changed:
A news/3459.feature
M Products/CMFPlone/browser/login/login.py

b"diff --git a/Products/CMFPlone/browser/login/login.py b/Products/CMFPlone/browser/login/login.py\nindex db2875f7ba..02d67358d4 100644\n--- a/Products/CMFPlone/browser/login/login.py\n+++ b/Products/CMFPlone/browser/login/login.py\n@@ -90,22 +90,22 @@ def _get_auth(self):\n                 pass\n \n     def updateWidgets(self):\n+        super().updateWidgets(prefix='')\n+\n         auth = self._get_auth()\n \n         if auth:\n-            fieldname_name = auth.get('name_cookie', '__ac_name')\n-            fieldname_password = auth.get('pw_cookie', '__ac_password')\n+            widgetname_login = auth.get('name_cookie', '__ac_name')\n+            widgetname_password = auth.get('pw_cookie', '__ac_password')\n         else:\n-            fieldname_name = '__ac_name'\n-            fieldname_password = '__ac_password'\n+            widgetname_login = '__ac_name'\n+            widgetname_password = '__ac_password'\n \n-        self.fields['ac_name'].__name__ = fieldname_name\n-        self.fields['ac_password'].__name__ = fieldname_password\n-\n-        super().updateWidgets(prefix='')\n+        self.widgets['ac_name'].name = widgetname_login\n+        self.widgets['ac_password'].name = widgetname_password\n \n         if self.use_email_as_login():\n-            self.widgets[fieldname_name].label = _('label_email',\n+            self.widgets['ac_name'].label = _('label_email',\n                                                    default='Email')\n         self.widgets['came_from'].mode = HIDDEN_MODE\n         self.widgets['came_from'].value = self.get_came_from()\ndiff --git a/news/3459.feature b/news/3459.feature\nnew file mode 100644\nindex 0000000000..c1a15aec03\n--- /dev/null\n+++ b/news/3459.feature\n@@ -0,0 +1,2 @@\n+Compatibility with z3c.form >= 4\n+[petschki]\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-03-18T10:05:59+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/d9d8f9b86e325a59e77ec3353838063826fcfd3c

fix login widgets ids

Files changed:
M Products/CMFPlone/browser/login/login.py

b"diff --git a/Products/CMFPlone/browser/login/login.py b/Products/CMFPlone/browser/login/login.py\nindex 02d67358d4..b4b8f2af93 100644\n--- a/Products/CMFPlone/browser/login/login.py\n+++ b/Products/CMFPlone/browser/login/login.py\n@@ -102,7 +102,9 @@ def updateWidgets(self):\n             widgetname_password = '__ac_password'\n \n         self.widgets['ac_name'].name = widgetname_login\n+        self.widgets['ac_name'].id = widgetname_login\n         self.widgets['ac_password'].name = widgetname_password\n+        self.widgets['ac_password'].id = widgetname_password\n \n         if self.use_email_as_login():\n             self.widgets['ac_name'].label = _('label_email',\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-03-21T09:12:45+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/fa95215435198145784f24ea211067d0aef25411

Merge pull request #3460 from plone/z3c-form-latest

Compatibility with latest z3c.form

Files changed:
A news/3459.feature
M Products/CMFPlone/browser/login/login.py

b"diff --git a/Products/CMFPlone/browser/login/login.py b/Products/CMFPlone/browser/login/login.py\nindex db2875f7ba..b4b8f2af93 100644\n--- a/Products/CMFPlone/browser/login/login.py\n+++ b/Products/CMFPlone/browser/login/login.py\n@@ -90,22 +90,24 @@ def _get_auth(self):\n                 pass\n \n     def updateWidgets(self):\n+        super().updateWidgets(prefix='')\n+\n         auth = self._get_auth()\n \n         if auth:\n-            fieldname_name = auth.get('name_cookie', '__ac_name')\n-            fieldname_password = auth.get('pw_cookie', '__ac_password')\n+            widgetname_login = auth.get('name_cookie', '__ac_name')\n+            widgetname_password = auth.get('pw_cookie', '__ac_password')\n         else:\n-            fieldname_name = '__ac_name'\n-            fieldname_password = '__ac_password'\n+            widgetname_login = '__ac_name'\n+            widgetname_password = '__ac_password'\n \n-        self.fields['ac_name'].__name__ = fieldname_name\n-        self.fields['ac_password'].__name__ = fieldname_password\n-\n-        super().updateWidgets(prefix='')\n+        self.widgets['ac_name'].name = widgetname_login\n+        self.widgets['ac_name'].id = widgetname_login\n+        self.widgets['ac_password'].name = widgetname_password\n+        self.widgets['ac_password'].id = widgetname_password\n \n         if self.use_email_as_login():\n-            self.widgets[fieldname_name].label = _('label_email',\n+            self.widgets['ac_name'].label = _('label_email',\n                                                    default='Email')\n         self.widgets['came_from'].mode = HIDDEN_MODE\n         self.widgets['came_from'].value = self.get_came_from()\ndiff --git a/news/3459.feature b/news/3459.feature\nnew file mode 100644\nindex 0000000000..c1a15aec03\n--- /dev/null\n+++ b/news/3459.feature\n@@ -0,0 +1,2 @@\n+Compatibility with z3c.form >= 4\n+[petschki]\n"

