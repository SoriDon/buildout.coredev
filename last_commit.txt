Repository: plone.app.content


Branch: refs/heads/master
Date: 2021-10-27T09:56:32+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/253c67340354a32d9925e492562dc5630c995c17

Adapt the tests for Plone 6

Adapt the tests to cope with the fact the since Plone 6 the Plone site
root is cataloged

Files changed:
A news/236.bugfix
M plone/app/content/tests/test_folder.py
M plone/app/content/tests/test_widgets.py

b'diff --git a/news/236.bugfix b/news/236.bugfix\nnew file mode 100644\nindex 0000000..0bd847e\n--- /dev/null\n+++ b/news/236.bugfix\n@@ -0,0 +1 @@\n+Adapt the tests to cope with the fact the since Plone 6 the Plone site root is cataloged [ale-rt]\ndiff --git a/plone/app/content/tests/test_folder.py b/plone/app/content/tests/test_folder.py\nindex eb37148..3751d8a 100644\n--- a/plone/app/content/tests/test_folder.py\n+++ b/plone/app/content/tests/test_folder.py\n@@ -162,7 +162,7 @@ def testStateChange(self):\n         effective_index = self.convertDateTimeToIndexRepr(\n             self.portal.page.effective_date\n         )\n-        self.assertEqual(pc.uniqueValuesFor("effective"), (effective_index,))\n+        self.assertIn(effective_index, pc.uniqueValuesFor("effective"))\n \n \n class RenameTest(BaseTest):\ndiff --git a/plone/app/content/tests/test_widgets.py b/plone/app/content/tests/test_widgets.py\nindex 8eeaa66..15b36b2 100644\n--- a/plone/app/content/tests/test_widgets.py\n+++ b/plone/app/content/tests/test_widgets.py\n@@ -122,7 +122,12 @@ def testVocabularyCatalogResults(self):\n                     "i": "path",\n                     "o": "plone.app.querystring.operation.string.path",\n                     "v": "/plone",\n-                }\n+                },\n+                {\n+                    "i": "portal_type",\n+                    "o": "plone.app.querystring.operation.selection.any",\n+                    "v": "Document",\n+                },\n             ]\n         }\n         self.request.form.update(\n@@ -216,7 +221,12 @@ def testVocabularyBatching(self):\n                     "i": "path",\n                     "o": "plone.app.querystring.operation.string.path",\n                     "v": "/plone",\n-                }\n+                },\n+                {\n+                    "i": "portal_type",\n+                    "o": "plone.app.querystring.operation.selection.any",\n+                    "v": "Document",\n+                },\n             ]\n         }\n         # batch pages are 1-based\n@@ -601,10 +611,20 @@ def testUntranslatableMetadata(self):\n \n     def testGetMimeIcon(self):\n         """Check if the returned icon is correct"""\n+        query = {\n+            "criteria": [\n+                {\n+                    "i": "portal_type",\n+                    "o": "plone.app.querystring.operation.selection.any",\n+                    "v": "File",\n+                },\n+            ]\n+        }\n         self.request.form.update(\n             {\n                 "name": "plone.app.vocabularies.Catalog",\n                 "attributes": ["getMimeIcon"],\n+                "query": json.dumps(query),\n             }\n         )\n         view = VocabularyView(self.portal, self.request)\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2021-10-30T12:06:09+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/7a1bd2b60136b1fd380d4fa04bd052498548f272

Merge pull request #236 from plone/portal-in-the-catalog

Portal in the catalog

Files changed:
A news/236.bugfix
M plone/app/content/tests/test_folder.py
M plone/app/content/tests/test_widgets.py

b'diff --git a/news/236.bugfix b/news/236.bugfix\nnew file mode 100644\nindex 0000000..0bd847e\n--- /dev/null\n+++ b/news/236.bugfix\n@@ -0,0 +1 @@\n+Adapt the tests to cope with the fact the since Plone 6 the Plone site root is cataloged [ale-rt]\ndiff --git a/plone/app/content/tests/test_folder.py b/plone/app/content/tests/test_folder.py\nindex eb37148..3751d8a 100644\n--- a/plone/app/content/tests/test_folder.py\n+++ b/plone/app/content/tests/test_folder.py\n@@ -162,7 +162,7 @@ def testStateChange(self):\n         effective_index = self.convertDateTimeToIndexRepr(\n             self.portal.page.effective_date\n         )\n-        self.assertEqual(pc.uniqueValuesFor("effective"), (effective_index,))\n+        self.assertIn(effective_index, pc.uniqueValuesFor("effective"))\n \n \n class RenameTest(BaseTest):\ndiff --git a/plone/app/content/tests/test_widgets.py b/plone/app/content/tests/test_widgets.py\nindex 8eeaa66..15b36b2 100644\n--- a/plone/app/content/tests/test_widgets.py\n+++ b/plone/app/content/tests/test_widgets.py\n@@ -122,7 +122,12 @@ def testVocabularyCatalogResults(self):\n                     "i": "path",\n                     "o": "plone.app.querystring.operation.string.path",\n                     "v": "/plone",\n-                }\n+                },\n+                {\n+                    "i": "portal_type",\n+                    "o": "plone.app.querystring.operation.selection.any",\n+                    "v": "Document",\n+                },\n             ]\n         }\n         self.request.form.update(\n@@ -216,7 +221,12 @@ def testVocabularyBatching(self):\n                     "i": "path",\n                     "o": "plone.app.querystring.operation.string.path",\n                     "v": "/plone",\n-                }\n+                },\n+                {\n+                    "i": "portal_type",\n+                    "o": "plone.app.querystring.operation.selection.any",\n+                    "v": "Document",\n+                },\n             ]\n         }\n         # batch pages are 1-based\n@@ -601,10 +611,20 @@ def testUntranslatableMetadata(self):\n \n     def testGetMimeIcon(self):\n         """Check if the returned icon is correct"""\n+        query = {\n+            "criteria": [\n+                {\n+                    "i": "portal_type",\n+                    "o": "plone.app.querystring.operation.selection.any",\n+                    "v": "File",\n+                },\n+            ]\n+        }\n         self.request.form.update(\n             {\n                 "name": "plone.app.vocabularies.Catalog",\n                 "attributes": ["getMimeIcon"],\n+                "query": json.dumps(query),\n             }\n         )\n         view = VocabularyView(self.portal, self.request)\n'

