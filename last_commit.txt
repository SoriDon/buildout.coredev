Repository: plone.app.event


Branch: refs/heads/master
Date: 2016-01-26T19:00:27+01:00
Author: Patrick Gerken (do3cc) <patrick.gerken@zumtobelgroup.com>
Commit: https://github.com/plone/plone.app.event/commit/4fd417ff8d235be83f722e139354acf3d2ed6db0

Handle unset env variable

Files changed:
M plone/app/event/testing.py

diff --git a/plone/app/event/testing.py b/plone/app/event/testing.py
index c8deb5f..60cdc9a 100644
--- a/plone/app/event/testing.py
+++ b/plone/app/event/testing.py
@@ -32,11 +32,13 @@ def set_timezone(tz):
     reg = getUtility(IRegistry)
     current_tz = reg.get('plone.portal_timezone', None)
     reg['plone.portal_timezone'] = tz
-    return tz
+    return current_tz
 
 
 def set_env_timezone(tz):
-    current_tz = os.environ['TZ']
+    if tz is None:
+        return None
+    current_tz = os.environ.get('TZ', None)
     os.environ['TZ'] = tz
     return current_tz
 


