Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2018-10-02T12:06:28+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/54bb9f57fd1c6f2c559ee0557839997444e863c3

Do the permission checks in zcml.

This means we can stop using the raiseUnauthorized skin script.
Also check for the 'CMFPlacefulWorkflow: Manage workflow policies' permission instead of the 'Manage portal' permission.

Files changed:
A news/25.bugfix
M Products/CMFPlacefulWorkflow/browser/configure.zcml
M Products/CMFPlacefulWorkflow/browser/prefs_workflow_localpolicies_form.pt
M Products/CMFPlacefulWorkflow/browser/prefs_workflow_policy_mapping.pt
M Products/CMFPlacefulWorkflow/configure.zcml

b'diff --git a/Products/CMFPlacefulWorkflow/browser/configure.zcml b/Products/CMFPlacefulWorkflow/browser/configure.zcml\nindex 3f2cdcf..28ba777 100644\n--- a/Products/CMFPlacefulWorkflow/browser/configure.zcml\n+++ b/Products/CMFPlacefulWorkflow/browser/configure.zcml\n@@ -8,7 +8,7 @@\n         name="placeful_workflow_configuration"\n         class=".views.PlacefulWorkflowConfiguration"\n         template="placeful_workflow_configuration.pt"\n-        permission="zope2.View"\n+        permission="CMFPlacefulWorkflow.ManageWorkflowPolicies"\n         />\n \n     <browser:page\n@@ -16,7 +16,7 @@\n         name="prefs_workflow_policy_mapping"\n         class=".views.WorkflowPolicyMapping"\n         template="prefs_workflow_policy_mapping.pt"\n-        permission="zope2.View"\n+        permission="CMFPlacefulWorkflow.ManageWorkflowPolicies"\n         />\n \n     <browser:page\n@@ -24,8 +24,7 @@\n         name="prefs_workflow_localpolicies_form"\n         class=".views.WorkflowPoliciesForm"\n         template="prefs_workflow_localpolicies_form.pt"\n-        permission="zope2.View"\n+        permission="CMFPlacefulWorkflow.ManageWorkflowPolicies"\n         />\n \n </configure>\n-\ndiff --git a/Products/CMFPlacefulWorkflow/browser/prefs_workflow_localpolicies_form.pt b/Products/CMFPlacefulWorkflow/browser/prefs_workflow_localpolicies_form.pt\nindex 0e5ee11..46c3a75 100644\n--- a/Products/CMFPlacefulWorkflow/browser/prefs_workflow_localpolicies_form.pt\n+++ b/Products/CMFPlacefulWorkflow/browser/prefs_workflow_localpolicies_form.pt\n@@ -11,8 +11,7 @@\n \n         <span tal:define="dummy python:request.response.setHeader(\'pragma\',\'no-cache\')" />\n \n-        <div id="content"\n-             tal:condition="python:checkPermission(\'Manage portal\', context)">\n+        <div id="content">\n \n             <h5 class="hiddenStructure">Views</h5>\n \n@@ -154,13 +153,6 @@\n \n             </div>\n         </div>\n-        <div id="content"\n-             class="documentEditable"\n-             tal:condition="python:not checkPermission(\'Manage portal\', context)">\n-            <tal:block replace="context/raiseUnauthorized" />\n-        </div>\n \n     </div>\n </html>\n-\n-\ndiff --git a/Products/CMFPlacefulWorkflow/browser/prefs_workflow_policy_mapping.pt b/Products/CMFPlacefulWorkflow/browser/prefs_workflow_policy_mapping.pt\nindex a01013d..f9cce67 100644\n--- a/Products/CMFPlacefulWorkflow/browser/prefs_workflow_policy_mapping.pt\n+++ b/Products/CMFPlacefulWorkflow/browser/prefs_workflow_policy_mapping.pt\n@@ -15,8 +15,7 @@\n \n         <span tal:define="dummy python:request.response.setHeader(\'pragma\',\'no-cache\')" />\n \n-        <div id="content"\n-             tal:condition="python:checkPermission(\'Manage portal\', context)">\n+        <div id="content">\n \n             <h5 class="hiddenStructure">Views</h5>\n \ndiff --git a/Products/CMFPlacefulWorkflow/configure.zcml b/Products/CMFPlacefulWorkflow/configure.zcml\nindex c0badd1..df1d441 100644\n--- a/Products/CMFPlacefulWorkflow/configure.zcml\n+++ b/Products/CMFPlacefulWorkflow/configure.zcml\n@@ -1,11 +1,11 @@\n <configure xmlns="http://namespaces.zope.org/zope"\n     xmlns:zcml="http://namespaces.zope.org/zcml">\n \n-  <include package=".browser"/>\n   <include file="implements.zcml"/>\n   <include file="exportimport.zcml"/>\n   <include file="profiles.zcml"/>\n   <include file="permissions.zcml"/>\n+  <include package=".browser"/>\n \n   <adapter factory=".adapter.PlacefulWorkflowChain" />\n \ndiff --git a/news/25.bugfix b/news/25.bugfix\nnew file mode 100644\nindex 0000000..c9f78c9\n--- /dev/null\n+++ b/news/25.bugfix\n@@ -0,0 +1,5 @@\n+Do the permission checks in zcml.\n+\n+This means we can stop using the ``raiseUnauthorized`` skin script.\n+Also check for the \'CMFPlacefulWorkflow: Manage workflow policies\' permission instead of the \'Manage portal\' permission.\n+[maurits]\n'

Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2018-10-02T13:28:41+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/43debd3b86dbdb80898542305e5e0873c568fa5e

Merge pull request #26 from plone/issue-25-permissions

Do the permission checks in zcml.

Files changed:
A news/25.bugfix
M Products/CMFPlacefulWorkflow/browser/configure.zcml
M Products/CMFPlacefulWorkflow/browser/prefs_workflow_localpolicies_form.pt
M Products/CMFPlacefulWorkflow/browser/prefs_workflow_policy_mapping.pt
M Products/CMFPlacefulWorkflow/configure.zcml

b'diff --git a/Products/CMFPlacefulWorkflow/browser/configure.zcml b/Products/CMFPlacefulWorkflow/browser/configure.zcml\nindex 3f2cdcf..28ba777 100644\n--- a/Products/CMFPlacefulWorkflow/browser/configure.zcml\n+++ b/Products/CMFPlacefulWorkflow/browser/configure.zcml\n@@ -8,7 +8,7 @@\n         name="placeful_workflow_configuration"\n         class=".views.PlacefulWorkflowConfiguration"\n         template="placeful_workflow_configuration.pt"\n-        permission="zope2.View"\n+        permission="CMFPlacefulWorkflow.ManageWorkflowPolicies"\n         />\n \n     <browser:page\n@@ -16,7 +16,7 @@\n         name="prefs_workflow_policy_mapping"\n         class=".views.WorkflowPolicyMapping"\n         template="prefs_workflow_policy_mapping.pt"\n-        permission="zope2.View"\n+        permission="CMFPlacefulWorkflow.ManageWorkflowPolicies"\n         />\n \n     <browser:page\n@@ -24,8 +24,7 @@\n         name="prefs_workflow_localpolicies_form"\n         class=".views.WorkflowPoliciesForm"\n         template="prefs_workflow_localpolicies_form.pt"\n-        permission="zope2.View"\n+        permission="CMFPlacefulWorkflow.ManageWorkflowPolicies"\n         />\n \n </configure>\n-\ndiff --git a/Products/CMFPlacefulWorkflow/browser/prefs_workflow_localpolicies_form.pt b/Products/CMFPlacefulWorkflow/browser/prefs_workflow_localpolicies_form.pt\nindex 0e5ee11..46c3a75 100644\n--- a/Products/CMFPlacefulWorkflow/browser/prefs_workflow_localpolicies_form.pt\n+++ b/Products/CMFPlacefulWorkflow/browser/prefs_workflow_localpolicies_form.pt\n@@ -11,8 +11,7 @@\n \n         <span tal:define="dummy python:request.response.setHeader(\'pragma\',\'no-cache\')" />\n \n-        <div id="content"\n-             tal:condition="python:checkPermission(\'Manage portal\', context)">\n+        <div id="content">\n \n             <h5 class="hiddenStructure">Views</h5>\n \n@@ -154,13 +153,6 @@\n \n             </div>\n         </div>\n-        <div id="content"\n-             class="documentEditable"\n-             tal:condition="python:not checkPermission(\'Manage portal\', context)">\n-            <tal:block replace="context/raiseUnauthorized" />\n-        </div>\n \n     </div>\n </html>\n-\n-\ndiff --git a/Products/CMFPlacefulWorkflow/browser/prefs_workflow_policy_mapping.pt b/Products/CMFPlacefulWorkflow/browser/prefs_workflow_policy_mapping.pt\nindex a01013d..f9cce67 100644\n--- a/Products/CMFPlacefulWorkflow/browser/prefs_workflow_policy_mapping.pt\n+++ b/Products/CMFPlacefulWorkflow/browser/prefs_workflow_policy_mapping.pt\n@@ -15,8 +15,7 @@\n \n         <span tal:define="dummy python:request.response.setHeader(\'pragma\',\'no-cache\')" />\n \n-        <div id="content"\n-             tal:condition="python:checkPermission(\'Manage portal\', context)">\n+        <div id="content">\n \n             <h5 class="hiddenStructure">Views</h5>\n \ndiff --git a/Products/CMFPlacefulWorkflow/configure.zcml b/Products/CMFPlacefulWorkflow/configure.zcml\nindex c0badd1..df1d441 100644\n--- a/Products/CMFPlacefulWorkflow/configure.zcml\n+++ b/Products/CMFPlacefulWorkflow/configure.zcml\n@@ -1,11 +1,11 @@\n <configure xmlns="http://namespaces.zope.org/zope"\n     xmlns:zcml="http://namespaces.zope.org/zcml">\n \n-  <include package=".browser"/>\n   <include file="implements.zcml"/>\n   <include file="exportimport.zcml"/>\n   <include file="profiles.zcml"/>\n   <include file="permissions.zcml"/>\n+  <include package=".browser"/>\n \n   <adapter factory=".adapter.PlacefulWorkflowChain" />\n \ndiff --git a/news/25.bugfix b/news/25.bugfix\nnew file mode 100644\nindex 0000000..c9f78c9\n--- /dev/null\n+++ b/news/25.bugfix\n@@ -0,0 +1,5 @@\n+Do the permission checks in zcml.\n+\n+This means we can stop using the ``raiseUnauthorized`` skin script.\n+Also check for the \'CMFPlacefulWorkflow: Manage workflow policies\' permission instead of the \'Manage portal\' permission.\n+[maurits]\n'

