Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-07T17:09:49+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/0c31715e438cfbe8bb86ea9eb721cd26c4dd166b

Configuring with plone/meta

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/11f0db91.internal
A tox.ini
M pyproject.toml
M setup.cfg

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 00000000..b4158b89\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 00000000..b6641708\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "11f0db91"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 00000000..fdafec1c\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.3.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.4\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/news/11f0db91.internal b/news/11f0db91.internal\nnew file mode 100644\nindex 00000000..c08f5399\n--- /dev/null\n+++ b/news/11f0db91.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615de..9eb73f3c 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,43 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 469f1a50..0da8f8fb 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,28 +1,23 @@\n-[check-manifest]\n-ignore =\n-    bootstrap.py\n-    jenkins.cfg\n-\n-[isort]\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n-\n-\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n \n [flake8]\n-# black compatible flake8 rules:\n+doctests = 1\n ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n     W503,\n-    C812,\n-    E501\n-    T001\n-    C813\n-# E203, E266\n-exclude = docs\n-max-line-length = 120\n-max-complexity = 18\n-select = B,C,E,F,W,T4,B9\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 00000000..00fd9f4c\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,68 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --all --test-path={toxinidir} -s plone.app.layout {posargs}\n+extras =\n+    test\n+\n+[testenv:coverage]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    coverage\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    coverage run {envbindir}/zope-testrunner --all --test-path={toxinidir} -s plone.app.layout {posargs}\n+    coverage report -m --format markdown\n+extras =\n+    test\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-07T17:11:29+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/4cb7fd9777d50ca12a3f2e66a75120cc7855cb53

chore: isort

Files changed:
M plone/app/layout/analytics/view.py
M plone/app/layout/favicon_handler.py
M plone/app/layout/globals/context.py
M plone/app/layout/globals/layout.py
M plone/app/layout/globals/portal.py
M plone/app/layout/globals/tests/test_context.py
M plone/app/layout/globals/tests/test_layout.py
M plone/app/layout/globals/tests/test_portal.py
M plone/app/layout/links/tests/test_favicon_viewlet.py
M plone/app/layout/links/viewlets.py
M plone/app/layout/sitemap/sitemap.py
M plone/app/layout/sitemap/tests/test_sitemap.py
M plone/app/layout/viewlets/common.py
M plone/app/layout/viewlets/social.py
M plone/app/layout/viewlets/tests/test_common.py
M plone/app/layout/viewlets/tests/test_content.py
M plone/app/layout/viewlets/tests/test_social.py
M plone/app/layout/viewlets/toolbar.py

b'diff --git a/plone/app/layout/analytics/view.py b/plone/app/layout/analytics/view.py\nindex 5de1a4a4..2a17aebf 100644\n--- a/plone/app/layout/analytics/view.py\n+++ b/plone/app/layout/analytics/view.py\n@@ -1,5 +1,5 @@\n-from plone.registry.interfaces import IRegistry\n from plone.base.interfaces import ISiteSchema\n+from plone.registry.interfaces import IRegistry\n from Products.Five.browser import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getUtility\ndiff --git a/plone/app/layout/favicon_handler.py b/plone/app/layout/favicon_handler.py\nindex 439dec25..4a10447b 100644\n--- a/plone/app/layout/favicon_handler.py\n+++ b/plone/app/layout/favicon_handler.py\n@@ -1,7 +1,7 @@\n+from plone.base.interfaces import ISiteSchema\n from plone.formwidget.namedfile.converter import b64decode_file\n from plone.registry.interfaces import IRecordModifiedEvent\n from plone.registry.recordsproxy import RecordsProxy\n-from plone.base.interfaces import ISiteSchema\n from zope.component import adapter\n \n import mimetypes\ndiff --git a/plone/app/layout/globals/context.py b/plone/app/layout/globals/context.py\nindex 146d325d..3a1943d7 100644\n--- a/plone/app/layout/globals/context.py\n+++ b/plone/app/layout/globals/context.py\n@@ -3,6 +3,7 @@\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n from plone.base.interfaces import INavigationRoot\n+from plone.base.interfaces import INonStructuralFolder\n from plone.base.utils import pretty_title_or_id\n from plone.memoize.view import memoize\n from plone.portlets.interfaces import ILocalPortletAssignable\n@@ -11,7 +12,6 @@\n from Products.CMFCore.interfaces import ISiteRoot\n from Products.CMFCore.utils import getToolByName\n from Products.CMFDynamicViewFTI.interfaces import IBrowserDefault\n-from plone.base.interfaces import INonStructuralFolder\n from Products.Five.browser import BrowserView\n from zope.component import getMultiAdapter\n from zope.component import getUtility\ndiff --git a/plone/app/layout/globals/layout.py b/plone/app/layout/globals/layout.py\nindex ee8e21e7..a122b5ca 100644\n--- a/plone/app/layout/globals/layout.py\n+++ b/plone/app/layout/globals/layout.py\n@@ -2,14 +2,14 @@\n from plone.app.layout.globals.interfaces import IBodyClassAdapter\n from plone.app.layout.globals.interfaces import ILayoutPolicy\n from plone.app.layout.globals.interfaces import IViewView\n+from plone.base.interfaces.controlpanel import ILinkSchema\n+from plone.base.interfaces.controlpanel import ISiteSchema\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.memoize.view import memoize\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletManagerRenderer\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces.controlpanel import ILinkSchema\n-from plone.base.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.metaconfigure import ViewMixinForTemplates\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.browserpage.viewpagetemplatefile import (\ndiff --git a/plone/app/layout/globals/portal.py b/plone/app/layout/globals/portal.py\nindex ce4f02e6..b90d02e1 100644\n--- a/plone/app/layout/globals/portal.py\n+++ b/plone/app/layout/globals/portal.py\n@@ -2,6 +2,8 @@\n from Acquisition import aq_inner\n from plone.app.layout.navigation.root import getNavigationRoot\n from plone.app.layout.navigation.root import getNavigationRootObject\n+from plone.base.interfaces import ISearchSchema\n+from plone.base.interfaces import ISiteSchema\n from plone.i18n.interfaces import ILanguageSchema\n from plone.memoize.view import memoize\n from plone.memoize.view import memoize_contextless\n@@ -9,8 +11,6 @@\n from Products.CMFCore.interfaces import ISiteRoot\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.interfaces import IPloneSiteRoot\n-from plone.base.interfaces import ISearchSchema\n-from plone.base.interfaces import ISiteSchema\n from Products.Five.browser import BrowserView\n from zope.component import getUtility\n from zope.component import providedBy\ndiff --git a/plone/app/layout/globals/tests/test_context.py b/plone/app/layout/globals/tests/test_context.py\nindex 7bf39b30..7afc2d62 100644\n--- a/plone/app/layout/globals/tests/test_context.py\n+++ b/plone/app/layout/globals/tests/test_context.py\n@@ -1,12 +1,12 @@\n-from plone.base.interfaces import INavigationRoot\n from plone.app.layout.testing import INTEGRATION_TESTING\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing.helpers import logout\n-from plone.locking.interfaces import ILockable\n-from Products.CMFDynamicViewFTI.interfaces import IBrowserDefault\n+from plone.base.interfaces import INavigationRoot\n from plone.base.interfaces import INonStructuralFolder\n from plone.base.utils import unrestricted_construct_instance\n+from plone.locking.interfaces import ILockable\n+from Products.CMFDynamicViewFTI.interfaces import IBrowserDefault\n from zope.interface import alsoProvides\n from zope.interface import directlyProvides\n \ndiff --git a/plone/app/layout/globals/tests/test_layout.py b/plone/app/layout/globals/tests/test_layout.py\nindex 5178fbf5..aba2b8d0 100644\n--- a/plone/app/layout/globals/tests/test_layout.py\n+++ b/plone/app/layout/globals/tests/test_layout.py\n@@ -1,11 +1,11 @@\n-from plone.base.interfaces import INavigationRoot\n from plone.app.layout.testing import INTEGRATION_TESTING\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing.helpers import logout\n+from plone.base.interfaces import INavigationRoot\n+from plone.base.interfaces.controlpanel import ILinkSchema\n from plone.portlets.interfaces import IPortletType\n from plone.registry.interfaces import IRegistry\n-from plone.base.interfaces.controlpanel import ILinkSchema\n from zope.component import getUtility\n \n import os\ndiff --git a/plone/app/layout/globals/tests/test_portal.py b/plone/app/layout/globals/tests/test_portal.py\nindex bebb172d..682d139f 100644\n--- a/plone/app/layout/globals/tests/test_portal.py\n+++ b/plone/app/layout/globals/tests/test_portal.py\n@@ -1,13 +1,13 @@\n-from plone.base.interfaces import INavigationRoot\n from plone.app.layout.navigation.root import getNavigationRoot\n from plone.app.layout.testing import INTEGRATION_TESTING\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing.helpers import logout\n-from plone.i18n.interfaces import ILanguageSchema\n-from plone.registry.interfaces import IRegistry\n+from plone.base.interfaces import INavigationRoot\n from plone.base.interfaces import ISearchSchema\n from plone.base.interfaces import ISiteSchema\n+from plone.i18n.interfaces import ILanguageSchema\n+from plone.registry.interfaces import IRegistry\n from zope.component import getUtility\n from zope.event import notify\n from zope.i18n.locales import locales\ndiff --git a/plone/app/layout/links/tests/test_favicon_viewlet.py b/plone/app/layout/links/tests/test_favicon_viewlet.py\nindex 17d8673b..c05c5d23 100644\n--- a/plone/app/layout/links/tests/test_favicon_viewlet.py\n+++ b/plone/app/layout/links/tests/test_favicon_viewlet.py\n@@ -1,9 +1,9 @@\n from plone.app.layout.links.viewlets import FaviconViewlet\n from plone.app.layout.testing import FUNCTIONAL_TESTING\n from plone.app.layout.viewlets.tests.base import ViewletsTestCase\n+from plone.base.interfaces import ISiteSchema\n from plone.formwidget.namedfile.converter import b64encode_file\n from plone.registry.interfaces import IRegistry\n-from plone.base.interfaces import ISiteSchema\n from zope.component import getUtility\n \n \ndiff --git a/plone/app/layout/links/viewlets.py b/plone/app/layout/links/viewlets.py\nindex 08e868fe..f4a83eb1 100644\n--- a/plone/app/layout/links/viewlets.py\n+++ b/plone/app/layout/links/viewlets.py\n@@ -1,6 +1,8 @@\n from Acquisition import aq_inner\n from plone.app.layout.viewlets import ViewletBase\n from plone.app.uuid.utils import uuidToObject\n+from plone.base.interfaces import ISecuritySchema\n+from plone.base.interfaces import ISiteSchema\n from plone.base.interfaces import ISiteSyndicationSettings\n from plone.base.interfaces.syndication import IFeedSettings\n from plone.base.utils import safe_bytes\n@@ -9,8 +11,6 @@\n from plone.memoize import view\n from plone.memoize.compress import xhtml_compress\n from plone.registry.interfaces import IRegistry\n-from plone.base.interfaces import ISecuritySchema\n-from plone.base.interfaces import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from typing import NoReturn\n from zope.component import getMultiAdapter\ndiff --git a/plone/app/layout/sitemap/sitemap.py b/plone/app/layout/sitemap/sitemap.py\nindex a897ee69..7eb6bfa7 100644\n--- a/plone/app/layout/sitemap/sitemap.py\n+++ b/plone/app/layout/sitemap/sitemap.py\n@@ -1,11 +1,11 @@\n from BTrees.OOBTree import OOBTree\n from gzip import GzipFile\n from io import BytesIO\n+from plone.base.interfaces import IPloneSiteRoot\n+from plone.base.interfaces import ISiteSchema\n from plone.memoize import ram\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces import IPloneSiteRoot\n-from plone.base.interfaces import ISiteSchema\n from Products.Five import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getUtility\ndiff --git a/plone/app/layout/sitemap/tests/test_sitemap.py b/plone/app/layout/sitemap/tests/test_sitemap.py\nindex 9d3820b1..a5d90301 100644\n--- a/plone/app/layout/sitemap/tests/test_sitemap.py\n+++ b/plone/app/layout/sitemap/tests/test_sitemap.py\n@@ -1,18 +1,18 @@\n from DateTime import DateTime\n from gzip import GzipFile\n from io import BytesIO\n-from plone.base.interfaces import INavigationRoot\n from plone.app.layout.testing import INTEGRATION_TESTING\n from plone.app.testing import login\n from plone.app.testing import logout\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n+from plone.base.interfaces import INavigationRoot\n+from plone.base.interfaces import ISearchSchema\n+from plone.base.interfaces import ISiteSchema\n from plone.base.utils import safe_text\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces import ISearchSchema\n-from plone.base.interfaces import ISiteSchema\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n from zope.interface import alsoProvides\ndiff --git a/plone/app/layout/viewlets/common.py b/plone/app/layout/viewlets/common.py\nindex 4fbe4b8f..b75a4a02 100644\n--- a/plone/app/layout/viewlets/common.py\n+++ b/plone/app/layout/viewlets/common.py\n@@ -7,16 +7,16 @@\n from plone.app.layout.globals.interfaces import IViewView\n from plone.app.layout.navigation.root import getNavigationRoot\n from plone.base import PloneMessageFactory as _\n+from plone.base.interfaces import IPloneSiteRoot\n+from plone.base.interfaces import ISearchSchema\n+from plone.base.interfaces import ISiteSchema\n+from plone.base.interfaces.controlpanel import INavigationSchema\n from plone.base.utils import safe_text\n from plone.i18n.interfaces import ILanguageSchema\n from plone.memoize.view import memoize\n from plone.protect.utils import addTokenToUrl\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces import IPloneSiteRoot\n-from plone.base.interfaces import ISearchSchema\n-from plone.base.interfaces import ISiteSchema\n-from plone.base.interfaces.controlpanel import INavigationSchema\n from Products.CMFPlone.utils import getSiteLogo\n from Products.Five.browser import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\ndiff --git a/plone/app/layout/viewlets/social.py b/plone/app/layout/viewlets/social.py\nindex 0f4f002a..8b9a61b7 100644\n--- a/plone/app/layout/viewlets/social.py\n+++ b/plone/app/layout/viewlets/social.py\n@@ -1,11 +1,11 @@\n from plone.app.layout.viewlets.common import TitleViewlet\n+from plone.base.interfaces import ISocialMediaSchema\n+from plone.base.interfaces.syndication import IFeedItem\n from plone.memoize.view import memoize\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.browser.syndication.adapters import BaseItem\n from Products.CMFPlone.browser.syndication.adapters import FolderFeed\n-from plone.base.interfaces import ISocialMediaSchema\n-from plone.base.interfaces.syndication import IFeedItem\n from Products.CMFPlone.utils import getSiteLogo\n from zope.component import getUtility\n from zope.component import queryMultiAdapter\n@@ -13,6 +13,7 @@\n \n import logging\n \n+\n logger = logging.getLogger("plone.app.layout")\n \n \ndiff --git a/plone/app/layout/viewlets/tests/test_common.py b/plone/app/layout/viewlets/tests/test_common.py\nindex 00e15bb5..2579aa1d 100644\n--- a/plone/app/layout/viewlets/tests/test_common.py\n+++ b/plone/app/layout/viewlets/tests/test_common.py\n@@ -1,4 +1,3 @@\n-from plone.base.interfaces import INavigationRoot\n from plone.app.layout.viewlets.common import ContentViewsViewlet\n from plone.app.layout.viewlets.common import GlobalSectionsViewlet\n from plone.app.layout.viewlets.common import LogoViewlet\n@@ -10,11 +9,12 @@\n from plone.app.testing import SITE_OWNER_NAME\n from plone.app.testing import SITE_OWNER_PASSWORD\n from plone.app.testing import TEST_USER_ID\n+from plone.base.interfaces import INavigationRoot\n+from plone.base.interfaces import INonStructuralFolder\n+from plone.base.interfaces import ISiteSchema\n from plone.protect import authenticator as auth\n from plone.registry.interfaces import IRegistry\n from plone.testing.zope import Browser\n-from plone.base.interfaces import INonStructuralFolder\n-from plone.base.interfaces import ISiteSchema\n from zope.component import getUtility\n from zope.component.hooks import setSite\n from zope.interface import alsoProvides\ndiff --git a/plone/app/layout/viewlets/tests/test_content.py b/plone/app/layout/viewlets/tests/test_content.py\nindex eae647f5..48e352fb 100644\n--- a/plone/app/layout/viewlets/tests/test_content.py\n+++ b/plone/app/layout/viewlets/tests/test_content.py\n@@ -7,10 +7,10 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_PASSWORD\n-from plone.locking.interfaces import ILockable\n-from plone.registry.interfaces import IRegistry\n from plone.base.interfaces import ISecuritySchema\n from plone.base.interfaces import ISiteSchema\n+from plone.locking.interfaces import ILockable\n+from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from z3c.relationfield import RelationValue\n from zope.component import getUtility\ndiff --git a/plone/app/layout/viewlets/tests/test_social.py b/plone/app/layout/viewlets/tests/test_social.py\nindex 70a73a0d..c37f13ad 100644\n--- a/plone/app/layout/viewlets/tests/test_social.py\n+++ b/plone/app/layout/viewlets/tests/test_social.py\n@@ -5,8 +5,8 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n-from plone.registry.interfaces import IRegistry\n from plone.base.interfaces import ISocialMediaSchema\n+from plone.registry.interfaces import IRegistry\n from zope.annotation.interfaces import IAnnotations\n from zope.component import getUtility\n \ndiff --git a/plone/app/layout/viewlets/toolbar.py b/plone/app/layout/viewlets/toolbar.py\nindex 67ceb14d..59525d96 100644\n--- a/plone/app/layout/viewlets/toolbar.py\n+++ b/plone/app/layout/viewlets/toolbar.py\n@@ -1,8 +1,8 @@\n from plone.app.layout.viewlets.common import PersonalBarViewlet\n from plone.app.viewletmanager.manager import OrderedViewletManager\n+from plone.base.interfaces.controlpanel import ISiteSchema\n from plone.memoize.instance import memoize\n from plone.registry.interfaces import IRegistry\n-from plone.base.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-07T17:12:17+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/e41188058a8434be6758a6c3fe09c01fec566cbd

chore: black

Files changed:
M plone/app/layout/analytics/view.py
M plone/app/layout/favicon_handler.py
M plone/app/layout/icons/icons.py
M plone/app/layout/links/tests/test_canonical_url.py
M plone/app/layout/links/viewlets.py
M plone/app/layout/navigation/navtree.py
M plone/app/layout/navigation/tests/test_root.py
M plone/app/layout/testing.py
M plone/app/layout/viewlets/common.py
M plone/app/layout/viewlets/content.py
M plone/app/layout/viewlets/social.py
M plone/app/layout/viewlets/tests/base.py
M plone/app/layout/viewlets/tests/test_common.py
M plone/app/layout/viewlets/tests/test_content.py
M plone/app/layout/viewlets/tests/test_social.py

b'diff --git a/plone/app/layout/analytics/view.py b/plone/app/layout/analytics/view.py\nindex 2a17aebf..c277714d 100644\n--- a/plone/app/layout/analytics/view.py\n+++ b/plone/app/layout/analytics/view.py\n@@ -9,7 +9,6 @@\n \n @implementer(IViewlet)\n class AnalyticsViewlet(BrowserView):\n-\n     render = ViewPageTemplateFile("view.pt")\n \n     def __init__(self, context, request, view, manager):\ndiff --git a/plone/app/layout/favicon_handler.py b/plone/app/layout/favicon_handler.py\nindex 4a10447b..2185a417 100644\n--- a/plone/app/layout/favicon_handler.py\n+++ b/plone/app/layout/favicon_handler.py\n@@ -9,7 +9,6 @@\n \n @adapter(ISiteSchema, IRecordModifiedEvent)\n def updateMimetype(settings: RecordsProxy, event: IRecordModifiedEvent = None):\n-\n     if event.record.fieldName != "site_favicon" or not event.record.value:\n         return\n \ndiff --git a/plone/app/layout/icons/icons.py b/plone/app/layout/icons/icons.py\nindex cb084b39..dd9a3e82 100644\n--- a/plone/app/layout/icons/icons.py\n+++ b/plone/app/layout/icons/icons.py\n@@ -20,7 +20,6 @@ def __call__(self):\n \n     @memoize\n     def html_tag(self):\n-\n         if not self.url:\n             return None\n \ndiff --git a/plone/app/layout/links/tests/test_canonical_url.py b/plone/app/layout/links/tests/test_canonical_url.py\nindex 308033fd..b20ba6ac 100644\n--- a/plone/app/layout/links/tests/test_canonical_url.py\n+++ b/plone/app/layout/links/tests/test_canonical_url.py\n@@ -5,7 +5,6 @@\n \n \n class ViewletTestCase(unittest.TestCase):\n-\n     layer = FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/layout/links/viewlets.py b/plone/app/layout/links/viewlets.py\nindex f4a83eb1..5d12762d 100644\n--- a/plone/app/layout/links/viewlets.py\n+++ b/plone/app/layout/links/viewlets.py\n@@ -36,7 +36,6 @@ def render_cachekey(fun, self):\n \n \n class FaviconViewlet(ViewletBase):\n-\n     _template = ViewPageTemplateFile("favicon.pt")\n     mimetype: str\n     favicon_path: str\n@@ -81,7 +80,6 @@ def render(self) -> ViewPageTemplateFile:\n \n \n class SearchViewlet(ViewletBase):\n-\n     _template = ViewPageTemplateFile("search.pt")\n \n     @ram.cache(render_cachekey)\n@@ -90,7 +88,6 @@ def render(self):\n \n \n class AuthorViewlet(ViewletBase):\n-\n     _template = ViewPageTemplateFile("author.pt")\n \n     def update(self):\ndiff --git a/plone/app/layout/navigation/navtree.py b/plone/app/layout/navigation/navtree.py\nindex 00de3bbd..ab47564a 100644\n--- a/plone/app/layout/navigation/navtree.py\n+++ b/plone/app/layout/navigation/navtree.py\n@@ -260,7 +260,6 @@ def insertElement(itemPaths, item, forceInsert=False):\n         if not forceInsert and strategy is not None:\n             insert = strategy.nodeFilter(newNode)\n         if insert:\n-\n             if strategy is not None:\n                 newNode = strategy.decoratorFactory(newNode)\n \ndiff --git a/plone/app/layout/navigation/tests/test_root.py b/plone/app/layout/navigation/tests/test_root.py\nindex d6ac822a..27d7eb5a 100644\n--- a/plone/app/layout/navigation/tests/test_root.py\n+++ b/plone/app/layout/navigation/tests/test_root.py\n@@ -5,7 +5,6 @@\n \n \n class NavigationRootTestCase(unittest.TestCase):\n-\n     layer = INTEGRATION_TESTING\n \n     def test_getNavigationRootObject_no_context(self):\ndiff --git a/plone/app/layout/testing.py b/plone/app/layout/testing.py\nindex 6e59c9d6..e3af3a81 100644\n--- a/plone/app/layout/testing.py\n+++ b/plone/app/layout/testing.py\n@@ -8,7 +8,6 @@\n \n \n class Fixture(PloneSandboxLayer):\n-\n     defaultBases = (PLONE_APP_CONTENTTYPES_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\ndiff --git a/plone/app/layout/viewlets/common.py b/plone/app/layout/viewlets/common.py\nindex b75a4a02..ea96b11b 100644\n--- a/plone/app/layout/viewlets/common.py\n+++ b/plone/app/layout/viewlets/common.py\n@@ -409,7 +409,6 @@ def portal_tabs(self):\n \n \n class PersonalBarViewlet(ViewletBase):\n-\n     homelink_url = ""\n     user_name = ""\n \ndiff --git a/plone/app/layout/viewlets/content.py b/plone/app/layout/viewlets/content.py\nindex 9c65f270..456cca3a 100644\n--- a/plone/app/layout/viewlets/content.py\n+++ b/plone/app/layout/viewlets/content.py\n@@ -46,7 +46,6 @@\n \n \n class DocumentActionsViewlet(ViewletBase):\n-\n     index = ViewPageTemplateFile("document_actions.pt")\n \n     def update(self):\n@@ -59,7 +58,6 @@ def update(self):\n \n \n class DocumentBylineViewlet(ViewletBase):\n-\n     index = ViewPageTemplateFile("document_byline.pt")\n \n     def update(self):\n@@ -67,12 +65,16 @@ def update(self):\n         self.anonymous = self.portal_state.anonymous()\n \n     @property\n-    @deprecation.deprecate("The context_state property is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The context_state property is unused and will be removed in Plone 7"\n+    )\n     def context_state(self):\n         return getMultiAdapter((self.context, self.request), name="plone_context_state")\n \n     @property\n-    @deprecation.deprecate("The has_pam property is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The has_pam property is unused and will be removed in Plone 7"\n+    )\n     def has_pam(self):\n         return HAS_PAM\n \n@@ -97,7 +99,9 @@ def show_about(self):\n         )\n         return not self.anonymous or settings.allow_anon_views_about\n \n-    @deprecation.deprecate("The creator method is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The creator method is unused and will be removed in Plone 7"\n+    )\n     def creator(self):\n         return self.context.Creator()\n \n@@ -106,7 +110,9 @@ def author(self):\n         membership = getToolByName(self.context, "portal_membership")\n         return membership.getMemberInfo(self.creator())\n \n-    @deprecation.deprecate("The authorname method is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The authorname method is unused and will be removed in Plone 7"\n+    )\n     def authorname(self):\n         author = self.author()\n         return author and author["fullname"] or self.creator()\n@@ -139,7 +145,9 @@ def isExpired(self):\n             return self.context.expires().isPast()\n         return False\n \n-    @deprecation.deprecate("The toLocalizedTime method is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The toLocalizedTime method is unused and will be removed in Plone 7"\n+    )\n     def toLocalizedTime(self, time, long_format=None, time_only=None):\n         """Convert time to localized time"""\n         util = getToolByName(self.context, "translation_service")\n@@ -167,7 +175,9 @@ def pub_date(self):\n \n         return DateTime(date)\n \n-    @deprecation.deprecate("The get_translations method is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The get_translations method is unused and will be removed in Plone 7"\n+    )\n     def get_translations(self):\n         cts = []\n         if ITranslatable.providedBy(self.context):\n@@ -308,7 +318,6 @@ def get_translations(self):\n \n \n class ContentRelatedItems(ViewletBase):\n-\n     index = ViewPageTemplateFile("document_relateditems.pt")\n \n     def related_items(self):\n@@ -365,7 +374,6 @@ def related2brains(self, related):\n \n \n class WorkflowHistoryViewlet(ViewletBase):\n-\n     index = ViewPageTemplateFile("review_history.pt")\n \n     @memoize\n@@ -440,7 +448,6 @@ def workflowHistory(self, complete=True):\n \n \n class ContentHistoryViewlet(WorkflowHistoryViewlet):\n-\n     index = ViewPageTemplateFile("content_history.pt")\n \n     def revisionHistory(self):\ndiff --git a/plone/app/layout/viewlets/social.py b/plone/app/layout/viewlets/social.py\nindex 8b9a61b7..2641b659 100644\n--- a/plone/app/layout/viewlets/social.py\n+++ b/plone/app/layout/viewlets/social.py\n@@ -100,10 +100,10 @@ def _get_tags(self):\n         if item.has_enclosure and item.file_length > 0:\n             if item.file_type.startswith("image"):\n                 image = None\n-                scales = self.context.restrictedTraverse(\'@@images\', None)\n+                scales = self.context.restrictedTraverse("@@images", None)\n                 if scales:\n                     try:\n-                        image = scales.scale(\'image\', scale=self.social_image_scale)\n+                        image = scales.scale("image", scale=self.social_image_scale)\n                     except Exception as e:\n                         logger.exception(e)\n                 if image:\ndiff --git a/plone/app/layout/viewlets/tests/base.py b/plone/app/layout/viewlets/tests/base.py\nindex aafbe309..53c4c7d9 100644\n--- a/plone/app/layout/viewlets/tests/base.py\n+++ b/plone/app/layout/viewlets/tests/base.py\n@@ -6,7 +6,6 @@\n \n \n class ViewletsTestCase(unittest.TestCase):\n-\n     layer = INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -16,7 +15,6 @@ def setUp(self):\n \n \n class ViewletsFunctionalTestCase(unittest.TestCase):\n-\n     layer = FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/layout/viewlets/tests/test_common.py b/plone/app/layout/viewlets/tests/test_common.py\nindex 2579aa1d..c457650a 100644\n--- a/plone/app/layout/viewlets/tests/test_common.py\n+++ b/plone/app/layout/viewlets/tests/test_common.py\n@@ -173,7 +173,9 @@ def test_logo_viewlet_portal_root_default(self):\n         """\n         viewlet = LogoViewlet(self.folder, self.app.REQUEST, None)\n         viewlet.update()\n-        self.assertEqual(viewlet.img_src, f"{self.portal.absolute_url()}/++resource++plone-logo.svg")\n+        self.assertEqual(\n+            viewlet.img_src, f"{self.portal.absolute_url()}/++resource++plone-logo.svg"\n+        )\n \n     def test_logo_viewlet_portal_root_registry(self):\n         """When a logo is set, and viewlet is opened on a non-navigation root,\n@@ -197,7 +199,9 @@ def test_logo_viewlet_navigation_root_default(self):\n         self._set_site(self.folder)\n         viewlet = LogoViewlet(self.folder, self.app.REQUEST, None)\n         viewlet.update()\n-        self.assertEqual(viewlet.img_src, f"{self.folder.absolute_url()}/++resource++plone-logo.svg")\n+        self.assertEqual(\n+            viewlet.img_src, f"{self.folder.absolute_url()}/++resource++plone-logo.svg"\n+        )\n \n     def test_viewlet_navigation_root_registry(self):\n         """When a logo is set, and viewlet is opened on a navigation root,\ndiff --git a/plone/app/layout/viewlets/tests/test_content.py b/plone/app/layout/viewlets/tests/test_content.py\nindex 48e352fb..cba69bbf 100644\n--- a/plone/app/layout/viewlets/tests/test_content.py\n+++ b/plone/app/layout/viewlets/tests/test_content.py\n@@ -84,7 +84,11 @@ def test_get_fullname(self):\n         # otherwise we will return the fullname property\n         portal_membership = getToolByName(self.portal, "portal_membership")\n         portal_membership.addMember(\n-            "foo/bar", TEST_USER_PASSWORD, ["Member"], "", properties={"fullname": "Foo Bar"}\n+            "foo/bar",\n+            TEST_USER_PASSWORD,\n+            ["Member"],\n+            "",\n+            properties={"fullname": "Foo Bar"},\n         )\n         self.assertEqual(viewlet.get_fullname("foo/bar"), "Foo Bar")\n \ndiff --git a/plone/app/layout/viewlets/tests/test_social.py b/plone/app/layout/viewlets/tests/test_social.py\nindex c37f13ad..e9fb92ac 100644\n--- a/plone/app/layout/viewlets/tests/test_social.py\n+++ b/plone/app/layout/viewlets/tests/test_social.py\n@@ -131,12 +131,18 @@ def testLogo(self):\n         viewlet.update()\n         self.assertTrue(\n             self.tagFound(\n-                viewlet, "property", "og:image", "http://nohost/plone/++resource++plone-logo.svg"\n+                viewlet,\n+                "property",\n+                "og:image",\n+                "http://nohost/plone/++resource++plone-logo.svg",\n             )\n         )\n         self.assertFalse(self.tagFound(viewlet, "itemprop"))\n         self.assertTrue(\n             self.bodyTagFound(\n-                viewlet, "itemprop", "image", "http://nohost/plone/++resource++plone-logo.svg"\n+                viewlet,\n+                "itemprop",\n+                "image",\n+                "http://nohost/plone/++resource++plone-logo.svg",\n             )\n         )\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-07T17:12:51+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/d9925b73769e7537313335e0fcdb8b88d690d27c

chore: zpretty ZCML/XML

Files changed:
M plone/app/layout/analytics/configure.zcml
M plone/app/layout/configure.zcml
M plone/app/layout/globals/configure.zcml
M plone/app/layout/icons/configure.zcml
M plone/app/layout/links/configure.zcml
M plone/app/layout/navigation/configure.zcml
M plone/app/layout/nextprevious/configure.zcml
M plone/app/layout/permissions.zcml
M plone/app/layout/sitemap/configure.zcml
M plone/app/layout/sitemap/sitemap.xml
M plone/app/layout/viewlets/configure.zcml

b'diff --git a/plone/app/layout/analytics/configure.zcml b/plone/app/layout/analytics/configure.zcml\nindex 2e5c14a6..dc599351 100644\n--- a/plone/app/layout/analytics/configure.zcml\n+++ b/plone/app/layout/analytics/configure.zcml\n@@ -1,12 +1,13 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <browser:viewlet\n-        name="plone.analytics"\n-        manager="plone.app.layout.viewlets.interfaces.IPortalFooter"\n-        class=".view.AnalyticsViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.analytics"\n+      manager="plone.app.layout.viewlets.interfaces.IPortalFooter"\n+      class=".view.AnalyticsViewlet"\n+      permission="zope2.View"\n+      />\n \n </configure>\ndiff --git a/plone/app/layout/configure.zcml b/plone/app/layout/configure.zcml\nindex 5b267460..beebf645 100644\n--- a/plone/app/layout/configure.zcml\n+++ b/plone/app/layout/configure.zcml\n@@ -1,21 +1,20 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n-    <include package=".globals" />\n-    <include package=".navigation" />\n-    <include package=".viewlets" />\n-    <include package=".nextprevious" />\n-    <include package=".icons" />\n-    <include package=".links" />\n-    <include package=".sitemap" />\n-    <include package=".analytics" />\n+  <include package=".globals" />\n+  <include package=".navigation" />\n+  <include package=".viewlets" />\n+  <include package=".nextprevious" />\n+  <include package=".icons" />\n+  <include package=".links" />\n+  <include package=".sitemap" />\n+  <include package=".analytics" />\n \n-    <include file="permissions.zcml" />\n+  <include file="permissions.zcml" />\n \n-    <subscriber\n-        handler=".favicon_handler.updateMimetype"\n-    />\n+  <subscriber handler=".favicon_handler.updateMimetype" />\n \n </configure>\ndiff --git a/plone/app/layout/globals/configure.zcml b/plone/app/layout/globals/configure.zcml\nindex 1a4db1a3..5582d28e 100644\n--- a/plone/app/layout/globals/configure.zcml\n+++ b/plone/app/layout/globals/configure.zcml\n@@ -1,53 +1,54 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n-\n-    <!-- Views with global constants -->\n-\n-    <browser:page\n-        name="plone_interface_info"\n-        for="*"\n-        permission="zope.Public"\n-        class=".interface.InterfaceInformation"\n-        allowed_interface=".interfaces.IInterfaceInformation"\n-        />\n-\n-    <browser:page\n-        name="plone_layout"\n-        for="*"\n-        permission="zope.Public"\n-        class=".layout.LayoutPolicy"\n-        allowed_interface=".interfaces.ILayoutPolicy"\n-        />\n-\n-    <browser:page\n-        name="plone_tools"\n-        for="*"\n-        permission="zope.Public"\n-        class=".tools.Tools"\n-        allowed_interface=".interfaces.ITools"\n-        />\n-\n-    <browser:page\n-        name="plone_context_state"\n-        for="*"\n-        permission="zope.Public"\n-        class=".context.ContextState"\n-        allowed_interface=".interfaces.IContextState"\n-        />\n-\n-    <browser:page\n-        name="plone_portal_state"\n-        for="*"\n-        permission="zope.Public"\n-        class=".portal.PortalState"\n-        allowed_interface=".interfaces.IPortalState"\n-        />\n-\n-    <!-- We need to make the request annotatable for this to work -->\n-\n-    <class class="ZPublisher.BaseRequest.BaseRequest">\n-        <implements interface="zope.annotation.interfaces.IAttributeAnnotatable" />\n-    </class>\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n+\n+  <!-- Views with global constants -->\n+\n+  <browser:page\n+      name="plone_interface_info"\n+      for="*"\n+      class=".interface.InterfaceInformation"\n+      allowed_interface=".interfaces.IInterfaceInformation"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      name="plone_layout"\n+      for="*"\n+      class=".layout.LayoutPolicy"\n+      allowed_interface=".interfaces.ILayoutPolicy"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      name="plone_tools"\n+      for="*"\n+      class=".tools.Tools"\n+      allowed_interface=".interfaces.ITools"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      name="plone_context_state"\n+      for="*"\n+      class=".context.ContextState"\n+      allowed_interface=".interfaces.IContextState"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      name="plone_portal_state"\n+      for="*"\n+      class=".portal.PortalState"\n+      allowed_interface=".interfaces.IPortalState"\n+      permission="zope.Public"\n+      />\n+\n+  <!-- We need to make the request annotatable for this to work -->\n+\n+  <class class="ZPublisher.BaseRequest.BaseRequest">\n+    <implements interface="zope.annotation.interfaces.IAttributeAnnotatable" />\n+  </class>\n \n </configure>\ndiff --git a/plone/app/layout/icons/configure.zcml b/plone/app/layout/icons/configure.zcml\nindex 1d5f8d69..74954be7 100644\n--- a/plone/app/layout/icons/configure.zcml\n+++ b/plone/app/layout/icons/configure.zcml\n@@ -1,42 +1,56 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:browser="http://namespaces.zope.org/browser"\n-           xmlns:five="http://namespaces.zope.org/five">\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                Products.ZCatalog.CatalogBrains.AbstractCatalogBrain"\n-           factory=".icons.CatalogBrainContentIcon"\n-           provides=".interfaces.IContentIcon" />\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                Products.CMFCore.interfaces.IDynamicType"\n-           factory=".icons.CMFContentIcon"\n-           provides=".interfaces.IContentIcon" />\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                plone.dexterity.interfaces.IDexterityContent"\n-           factory=".icons.DefaultContentIcon"\n-           provides=".interfaces.IContentIcon" />\n-\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                Products.CMFCore.TypesTool.FactoryTypeInformation"\n-           factory=".icons.FTIContentIcon"\n-           provides=".interfaces.IContentIcon" />\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                plone.base.interfaces.IPloneSiteRoot"\n-           factory=".icons.PloneSiteContentIcon"\n-           provides=".interfaces.IContentIcon" />\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                *"\n-           factory=".icons.DefaultContentIcon"\n-           provides=".interfaces.IContentIcon" />\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:five="http://namespaces.zope.org/five"\n+    >\n+\n+  <adapter\n+      factory=".icons.CatalogBrainContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           Products.ZCatalog.CatalogBrains.AbstractCatalogBrain"\n+      />\n+\n+  <adapter\n+      factory=".icons.CMFContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           Products.CMFCore.interfaces.IDynamicType"\n+      />\n+\n+  <adapter\n+      factory=".icons.DefaultContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           plone.dexterity.interfaces.IDexterityContent"\n+      />\n+\n+\n+  <adapter\n+      factory=".icons.FTIContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           Products.CMFCore.TypesTool.FactoryTypeInformation"\n+      />\n+\n+  <adapter\n+      factory=".icons.PloneSiteContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           plone.base.interfaces.IPloneSiteRoot"\n+      />\n+\n+  <adapter\n+      factory=".icons.DefaultContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           *"\n+      />\n \n </configure>\ndiff --git a/plone/app/layout/links/configure.zcml b/plone/app/layout/links/configure.zcml\nindex 028a20b8..b2c0c8c0 100644\n--- a/plone/app/layout/links/configure.zcml\n+++ b/plone/app/layout/links/configure.zcml\n@@ -1,40 +1,42 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:browser="http://namespaces.zope.org/browser"\n-           xmlns:five="http://namespaces.zope.org/five">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:five="http://namespaces.zope.org/five"\n+    >\n \n-    <browser:viewlet\n-        name="plone.links.favicon"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".viewlets.FaviconViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.links.favicon"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".viewlets.FaviconViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.links.search"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".viewlets.SearchViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.links.search"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".viewlets.SearchViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.links.author"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".viewlets.AuthorViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.links.author"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".viewlets.AuthorViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.links.RSS"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".viewlets.RSSViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.links.RSS"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".viewlets.RSSViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.links.canonical_url"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".viewlets.CanonicalURL"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.links.canonical_url"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".viewlets.CanonicalURL"\n+      permission="zope2.View"\n+      />\n \n </configure>\ndiff --git a/plone/app/layout/navigation/configure.zcml b/plone/app/layout/navigation/configure.zcml\nindex 3dad49e9..a6ed63df 100644\n--- a/plone/app/layout/navigation/configure.zcml\n+++ b/plone/app/layout/navigation/configure.zcml\n@@ -1,9 +1,10 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <class class=".navtree.NavtreeStrategyBase">\n-        <allow interface=".interfaces.INavtreeStrategy" />\n-    </class>\n+  <class class=".navtree.NavtreeStrategyBase">\n+    <allow interface=".interfaces.INavtreeStrategy" />\n+  </class>\n \n </configure>\ndiff --git a/plone/app/layout/nextprevious/configure.zcml b/plone/app/layout/nextprevious/configure.zcml\nindex 2ee9eaf8..a6d88e4c 100644\n--- a/plone/app/layout/nextprevious/configure.zcml\n+++ b/plone/app/layout/nextprevious/configure.zcml\n@@ -1,33 +1,34 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <!-- We need this both in the viewlet and in Plone\'s header for rel links,\n+  <!-- We need this both in the viewlet and in Plone\'s header for rel links,\n          so define a view and use it in both places. Note that the actual\n          values are request memoized, so the calculations will only be\n          performed once.\n      -->\n \n-    <browser:page\n-        for="*"\n-        name="plone_nextprevious_view"\n-        class=".view.NextPreviousView"\n-        permission="zope.Public"\n-        allowed_attributes="next previous enabled"\n-        />\n+  <browser:page\n+      name="plone_nextprevious_view"\n+      for="*"\n+      class=".view.NextPreviousView"\n+      allowed_attributes="next previous enabled"\n+      permission="zope.Public"\n+      />\n \n-    <browser:viewlet\n-        name="plone.nextprevious"\n-        manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n-        class=".view.NextPreviousViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.nextprevious"\n+      manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n+      class=".view.NextPreviousViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.nextprevious.links"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".view.NextPreviousLinksViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.nextprevious.links"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".view.NextPreviousLinksViewlet"\n+      permission="zope2.View"\n+      />\n \n </configure>\ndiff --git a/plone/app/layout/permissions.zcml b/plone/app/layout/permissions.zcml\nindex f4990568..ffe6a1ed 100644\n--- a/plone/app/layout/permissions.zcml\n+++ b/plone/app/layout/permissions.zcml\n@@ -1,13 +1,15 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:zcml="http://namespaces.zope.org/zcml"\n-           i18n_domain="cmf_default">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="cmf_default"\n+    >\n \n   <configure zcml:condition="installed AccessControl.security">\n \n     <permission\n-      id="plone.ShowToolbar"\n-      title="Show Toolbar"\n-      />\n+        id="plone.ShowToolbar"\n+        title="Show Toolbar"\n+        />\n \n   </configure>\n \ndiff --git a/plone/app/layout/sitemap/configure.zcml b/plone/app/layout/sitemap/configure.zcml\nindex 967dcb7b..6a8a448b 100644\n--- a/plone/app/layout/sitemap/configure.zcml\n+++ b/plone/app/layout/sitemap/configure.zcml\n@@ -1,12 +1,13 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n   <browser:page\n       name="sitemap.xml.gz"\n       for="plone.base.interfaces.INavigationRoot"\n       class=".sitemap.SiteMapView"\n       permission="zope2.Public"\n-     />\n+      />\n \n </configure>\ndiff --git a/plone/app/layout/sitemap/sitemap.xml b/plone/app/layout/sitemap/sitemap.xml\nindex b39180e1..3bda3a7b 100644\n--- a/plone/app/layout/sitemap/sitemap.xml\n+++ b/plone/app/layout/sitemap/sitemap.xml\n@@ -1,15 +1,19 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"\n         xmlns:tal="http://xml.zope.org/namespaces/tal"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n-        xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd">\n-<url tal:repeat="obj view/objects">\n-  <loc tal:content="obj/loc">url</loc>\n-  <lastmod tal:condition="obj/lastmod | nothing"\n-          tal:content="obj/lastmod">date modified</lastmod>\n-  <changefreq tal:condition="obj/changefreq | nothing"\n-             tal:content="obj/changefreq">change frequency</changefreq>\n-  <priority tal:condition="obj/priority | nothing"\n-           tal:content="obj/priority">priority</priority>\n-</url>\n+        xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"\n+>\n+  <url tal:repeat="obj view/objects">\n+    <loc tal:content="obj/loc">url</loc>\n+    <lastmod tal:condition="obj/lastmod | nothing"\n+             tal:content="obj/lastmod"\n+    >date modified</lastmod>\n+    <changefreq tal:condition="obj/changefreq | nothing"\n+                tal:content="obj/changefreq"\n+    >change frequency</changefreq>\n+    <priority tal:condition="obj/priority | nothing"\n+              tal:content="obj/priority"\n+    >priority</priority>\n+  </url>\n </urlset>\ndiff --git a/plone/app/layout/viewlets/configure.zcml b/plone/app/layout/viewlets/configure.zcml\nindex 86b95ad3..9b82456e 100644\n--- a/plone/app/layout/viewlets/configure.zcml\n+++ b/plone/app/layout/viewlets/configure.zcml\n@@ -1,357 +1,361 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n-\n-    <include package="Products.CMFCore" file="permissions.zcml"/>\n-\n-    <!-- Register viewlet managers - used in plone\'s main_template -->\n-\n-    <browser:viewletManager\n-        name="plone.httpheaders"\n-        provides=".interfaces.IHTTPHeaders"\n-        permission="zope.Public"\n-        class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.htmlhead"\n-        provides=".interfaces.IHtmlHead"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.scripts"\n-        provides=".interfaces.IScripts"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.htmlhead.links"\n-        provides=".interfaces.IHtmlHeadLinks"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.portaltop"\n-        provides=".interfaces.IPortalTop"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.mainnavigation"\n-        provides=".interfaces.IMainNavigation"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.globalstatusmessage"\n-        provides=".interfaces.IGlobalStatusMessage"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.portalheader"\n-        provides=".interfaces.IPortalHeader"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.toolbar"\n-        provides=".interfaces.IToolbar"\n-        permission="zope2.View"\n-        class=".toolbar.ToolbarViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.abovecontent"\n-        provides=".interfaces.IAboveContent"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.abovecontenttitle"\n-        provides=".interfaces.IAboveContentTitle"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.belowcontenttitle"\n-        provides=".interfaces.IBelowContentTitle"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.belowcontentdescription"\n-        provides=".interfaces.IBelowContentDescription"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.abovecontentbody"\n-        provides=".interfaces.IAboveContentBody"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.belowcontentbody"\n-        provides=".interfaces.IBelowContentBody"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.belowcontent"\n-        provides=".interfaces.IBelowContent"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.portalfooter"\n-        provides=".interfaces.IPortalFooter"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <!-- Define some viewlets -->\n-\n-    <!-- HTTPHeaders -->\n-    <browser:viewlet\n-        name="plone.httpcachingheaders"\n-        manager=".interfaces.IHTTPHeaders"\n-        class=".httpheaders.HTTPCachingHeaders"\n-        permission="zope.Public"\n-        />\n-\n-    <!-- The site actions -->\n-    <browser:viewlet\n-        name="plone.site_actions"\n-        manager=".interfaces.IPortalFooter"\n-        class=".common.SiteActionsViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- The search box -->\n-    <browser:viewlet\n-        name="plone.searchbox"\n-        manager=".interfaces.IPortalHeader"\n-        class=".common.SearchBoxViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- The anontools (login, register) -->\n-    <browser:viewlet\n-        name="plone.anontools"\n-        manager=".interfaces.IPortalHeader"\n-        class=".common.PersonalBarViewlet"\n-        permission="zope2.View"\n-        template="anontools.pt"\n-        />\n-\n-    <!-- The member panel (logout, user actions) -->\n-    <browser:viewlet\n-        name="plone.membertools"\n-        manager=".interfaces.IPortalHeader"\n-        class=".common.PersonalBarViewlet"\n-        permission="zope2.View"\n-        template="membertools.pt"\n-        />\n-\n-    <!-- The logo -->\n-    <browser:viewlet\n-        name="plone.logo"\n-        manager=".interfaces.IPortalHeader"\n-        class=".common.LogoViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- The global sections -->\n-    <browser:viewlet\n-        name="plone.global_sections"\n-        manager=".interfaces.IMainNavigation"\n-        class=".common.GlobalSectionsViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Content views (tabs) -->\n-    <browser:viewlet\n-        name="plone.contentviews"\n-        manager=".interfaces.IToolbar"\n-        class=".common.ContentViewsViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the browser title -->\n-    <browser:viewlet\n-        name="plone.htmlhead.title"\n-        manager=".interfaces.IHtmlHead"\n-        class=".common.TitleViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the Dublin Core metadata -->\n-    <browser:viewlet\n-        name="plone.htmlhead.dublincore"\n-        manager=".interfaces.IHtmlHead"\n-        class=".common.DublinCoreViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the social media metadata -->\n-    <browser:viewlet\n-        name="plone.htmlhead.socialtags"\n-        manager=".interfaces.IHtmlHead"\n-        class=".social.SocialTagsViewlet"\n-        template="social_tags.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the social media body tags -->\n-    <browser:viewlet\n-        name="plone.socialtags"\n-        manager=".interfaces.IAboveContentTitle"\n-        class=".social.SocialTagsViewlet"\n-        template="social_tags_body.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the viewport -->\n-    <browser:viewlet\n-        name="plone.htmlhead.viewport"\n-        manager=".interfaces.IHtmlHead"\n-        template="viewport.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- The related items -->\n-    <browser:viewlet\n-        name="plone.relateditems"\n-        manager=".interfaces.IBelowContentBody"\n-        class=".content.ContentRelatedItems"\n-        view="plone.app.layout.globals.interfaces.IViewView"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the document actions -->\n-    <browser:viewlet\n-        name="plone.documentactions"\n-        manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n-        class=".content.DocumentActionsViewlet"\n-        permission="zope2.View"\n-        />\n-\n-\n-    <!-- Render the workflow history as a view -->\n-    <browser:view\n-        for="*"\n-        name="contenthistory"\n-        class=".content.ContentHistoryView"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the workflow history for popup -->\n-    <browser:page\n-        for="*"\n-        name="contenthistorypopup"\n-        template="popup_content_history.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the workflow history contents as a page-->\n-    <browser:page\n-        for="*"\n-        name="historyview"\n-        class=".content.HistoryByLineView"\n-        permission="cmf.ModifyPortalContent"\n-        />\n-\n-    <!-- The breadcrumbs -->\n-    <browser:viewlet\n-        name="plone.path_bar"\n-        manager=".interfaces.IAboveContent"\n-        class=".common.PathBarViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <browser:viewlet\n-        name="plone.globalstatusmessage"\n-        manager=".interfaces.IGlobalStatusMessage"\n-        class=".globalstatusmessage.GlobalStatusMessage"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the document byline -->\n-    <browser:viewlet\n-        name="plone.documentbyline"\n-        manager=".interfaces.IBelowContentTitle"\n-        class=".content.DocumentBylineViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the contributors section -->\n-    <browser:viewlet\n-        name="plone.contributors"\n-        manager=".interfaces.IBelowContentBody"\n-        class=".content.DocumentBylineViewlet"\n-        template="document_contributors.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the rights section -->\n-    <browser:viewlet\n-        name="plone.rights"\n-        manager=".interfaces.IBelowContentBody"\n-        template="document_rights.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the keywords -->\n-    <browser:viewlet\n-        name="plone.keywords"\n-        manager=".interfaces.IBelowContentBody"\n-        view="plone.app.layout.globals.interfaces.IViewView"\n-        template="keywords.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render lock info -->\n-    <browser:viewlet\n-        name="plone.lockinfo"\n-        manager=".interfaces.IAboveContent"\n-        class="plone.locking.browser.info.LockInfoViewlet"\n-        permission="cmf.ModifyPortalContent"\n-        for="plone.locking.interfaces.ITTWLockable"\n-        />\n-\n-    <!-- Render table of contents -->\n-    <browser:viewlet\n-        name="plone.tableofcontents"\n-        for="plone.app.contenttypes.behaviors.tableofcontents.ITableOfContents"\n-        manager=".interfaces.IAboveContentBody"\n-        class=".common.TableOfContentsViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Colophon -->\n-    <browser:viewlet\n-        name="plone.colophon"\n-        for="*"\n-        manager=".interfaces.IPortalFooter"\n-        template="colophon.pt"\n-        permission="zope.Public"\n-        />\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n+\n+  <include\n+      package="Products.CMFCore"\n+      file="permissions.zcml"\n+      />\n+\n+  <!-- Register viewlet managers - used in plone\'s main_template -->\n+\n+  <browser:viewletManager\n+      name="plone.httpheaders"\n+      provides=".interfaces.IHTTPHeaders"\n+      class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.htmlhead"\n+      provides=".interfaces.IHtmlHead"\n+      class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.scripts"\n+      provides=".interfaces.IScripts"\n+      class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.htmlhead.links"\n+      provides=".interfaces.IHtmlHeadLinks"\n+      class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.portaltop"\n+      provides=".interfaces.IPortalTop"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.mainnavigation"\n+      provides=".interfaces.IMainNavigation"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.globalstatusmessage"\n+      provides=".interfaces.IGlobalStatusMessage"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.portalheader"\n+      provides=".interfaces.IPortalHeader"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.toolbar"\n+      provides=".interfaces.IToolbar"\n+      class=".toolbar.ToolbarViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.abovecontent"\n+      provides=".interfaces.IAboveContent"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.abovecontenttitle"\n+      provides=".interfaces.IAboveContentTitle"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.belowcontenttitle"\n+      provides=".interfaces.IBelowContentTitle"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.belowcontentdescription"\n+      provides=".interfaces.IBelowContentDescription"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.abovecontentbody"\n+      provides=".interfaces.IAboveContentBody"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.belowcontentbody"\n+      provides=".interfaces.IBelowContentBody"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.belowcontent"\n+      provides=".interfaces.IBelowContent"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.portalfooter"\n+      provides=".interfaces.IPortalFooter"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Define some viewlets -->\n+\n+  <!-- HTTPHeaders -->\n+  <browser:viewlet\n+      name="plone.httpcachingheaders"\n+      manager=".interfaces.IHTTPHeaders"\n+      class=".httpheaders.HTTPCachingHeaders"\n+      permission="zope.Public"\n+      />\n+\n+  <!-- The site actions -->\n+  <browser:viewlet\n+      name="plone.site_actions"\n+      manager=".interfaces.IPortalFooter"\n+      class=".common.SiteActionsViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The search box -->\n+  <browser:viewlet\n+      name="plone.searchbox"\n+      manager=".interfaces.IPortalHeader"\n+      class=".common.SearchBoxViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The anontools (login, register) -->\n+  <browser:viewlet\n+      name="plone.anontools"\n+      manager=".interfaces.IPortalHeader"\n+      class=".common.PersonalBarViewlet"\n+      template="anontools.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The member panel (logout, user actions) -->\n+  <browser:viewlet\n+      name="plone.membertools"\n+      manager=".interfaces.IPortalHeader"\n+      class=".common.PersonalBarViewlet"\n+      template="membertools.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The logo -->\n+  <browser:viewlet\n+      name="plone.logo"\n+      manager=".interfaces.IPortalHeader"\n+      class=".common.LogoViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The global sections -->\n+  <browser:viewlet\n+      name="plone.global_sections"\n+      manager=".interfaces.IMainNavigation"\n+      class=".common.GlobalSectionsViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Content views (tabs) -->\n+  <browser:viewlet\n+      name="plone.contentviews"\n+      manager=".interfaces.IToolbar"\n+      class=".common.ContentViewsViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the browser title -->\n+  <browser:viewlet\n+      name="plone.htmlhead.title"\n+      manager=".interfaces.IHtmlHead"\n+      class=".common.TitleViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the Dublin Core metadata -->\n+  <browser:viewlet\n+      name="plone.htmlhead.dublincore"\n+      manager=".interfaces.IHtmlHead"\n+      class=".common.DublinCoreViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the social media metadata -->\n+  <browser:viewlet\n+      name="plone.htmlhead.socialtags"\n+      manager=".interfaces.IHtmlHead"\n+      class=".social.SocialTagsViewlet"\n+      template="social_tags.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the social media body tags -->\n+  <browser:viewlet\n+      name="plone.socialtags"\n+      manager=".interfaces.IAboveContentTitle"\n+      class=".social.SocialTagsViewlet"\n+      template="social_tags_body.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the viewport -->\n+  <browser:viewlet\n+      name="plone.htmlhead.viewport"\n+      manager=".interfaces.IHtmlHead"\n+      template="viewport.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The related items -->\n+  <browser:viewlet\n+      name="plone.relateditems"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager=".interfaces.IBelowContentBody"\n+      class=".content.ContentRelatedItems"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the document actions -->\n+  <browser:viewlet\n+      name="plone.documentactions"\n+      manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n+      class=".content.DocumentActionsViewlet"\n+      permission="zope2.View"\n+      />\n+\n+\n+  <!-- Render the workflow history as a view -->\n+  <browser:view\n+      name="contenthistory"\n+      for="*"\n+      class=".content.ContentHistoryView"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the workflow history for popup -->\n+  <browser:page\n+      name="contenthistorypopup"\n+      for="*"\n+      template="popup_content_history.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the workflow history contents as a page-->\n+  <browser:page\n+      name="historyview"\n+      for="*"\n+      class=".content.HistoryByLineView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <!-- The breadcrumbs -->\n+  <browser:viewlet\n+      name="plone.path_bar"\n+      manager=".interfaces.IAboveContent"\n+      class=".common.PathBarViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewlet\n+      name="plone.globalstatusmessage"\n+      manager=".interfaces.IGlobalStatusMessage"\n+      class=".globalstatusmessage.GlobalStatusMessage"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the document byline -->\n+  <browser:viewlet\n+      name="plone.documentbyline"\n+      manager=".interfaces.IBelowContentTitle"\n+      class=".content.DocumentBylineViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the contributors section -->\n+  <browser:viewlet\n+      name="plone.contributors"\n+      manager=".interfaces.IBelowContentBody"\n+      class=".content.DocumentBylineViewlet"\n+      template="document_contributors.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the rights section -->\n+  <browser:viewlet\n+      name="plone.rights"\n+      manager=".interfaces.IBelowContentBody"\n+      template="document_rights.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the keywords -->\n+  <browser:viewlet\n+      name="plone.keywords"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager=".interfaces.IBelowContentBody"\n+      template="keywords.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render lock info -->\n+  <browser:viewlet\n+      name="plone.lockinfo"\n+      for="plone.locking.interfaces.ITTWLockable"\n+      manager=".interfaces.IAboveContent"\n+      class="plone.locking.browser.info.LockInfoViewlet"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <!-- Render table of contents -->\n+  <browser:viewlet\n+      name="plone.tableofcontents"\n+      for="plone.app.contenttypes.behaviors.tableofcontents.ITableOfContents"\n+      manager=".interfaces.IAboveContentBody"\n+      class=".common.TableOfContentsViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Colophon -->\n+  <browser:viewlet\n+      name="plone.colophon"\n+      for="*"\n+      manager=".interfaces.IPortalFooter"\n+      template="colophon.pt"\n+      permission="zope.Public"\n+      />\n \n </configure>\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-07T17:13:50+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/ebd1f20947a377934c8ba5dcf8da44ed21ff8c1f

chore: zpretty PT

Files changed:
M plone/app/layout/analytics/view.pt
M plone/app/layout/globals/tests/data/bodyclass_nametest.pt
M plone/app/layout/links/author.pt
M plone/app/layout/links/favicon.pt
M plone/app/layout/links/rsslink.pt
M plone/app/layout/links/search.pt
M plone/app/layout/nextprevious/links.pt
M plone/app/layout/nextprevious/nextprevious.pt
M plone/app/layout/viewlets/anontools.pt
M plone/app/layout/viewlets/colophon.pt
M plone/app/layout/viewlets/content_history.pt
M plone/app/layout/viewlets/contentviews.pt
M plone/app/layout/viewlets/document_actions.pt
M plone/app/layout/viewlets/document_byline.pt
M plone/app/layout/viewlets/document_relateditems.pt
M plone/app/layout/viewlets/document_rights.pt
M plone/app/layout/viewlets/dublin_core.pt
M plone/app/layout/viewlets/globalstatusmessage.pt
M plone/app/layout/viewlets/history_view.pt
M plone/app/layout/viewlets/keywords.pt
M plone/app/layout/viewlets/logo.pt
M plone/app/layout/viewlets/membertools.pt
M plone/app/layout/viewlets/menu.pt
M plone/app/layout/viewlets/path_bar.pt
M plone/app/layout/viewlets/popup_content_history.pt
M plone/app/layout/viewlets/review_history.pt
M plone/app/layout/viewlets/searchbox.pt
M plone/app/layout/viewlets/sections.pt
M plone/app/layout/viewlets/site_actions.pt
M plone/app/layout/viewlets/social_tags.pt
M plone/app/layout/viewlets/social_tags_body.pt
M plone/app/layout/viewlets/tiny_logo.pt
M plone/app/layout/viewlets/toc.pt
M plone/app/layout/viewlets/toolbar.pt
M plone/app/layout/viewlets/viewport.pt

b'diff --git a/plone/app/layout/analytics/view.pt b/plone/app/layout/analytics/view.pt\nindex 7d3f83c7..2ac8e4f7 100644\n--- a/plone/app/layout/analytics/view.pt\n+++ b/plone/app/layout/analytics/view.pt\n@@ -1,5 +1,7 @@\n <div id="plone-analytics"\n-     tal:define="webstats_js view/webstats_js"\n+     tal:define="\n+       webstats_js view/webstats_js;\n+     "\n      tal:condition="webstats_js"\n      tal:content="structure webstats_js"\n >\ndiff --git a/plone/app/layout/globals/tests/data/bodyclass_nametest.pt b/plone/app/layout/globals/tests/data/bodyclass_nametest.pt\nindex f11b6135..f0ab6775 100644\n--- a/plone/app/layout/globals/tests/data/bodyclass_nametest.pt\n+++ b/plone/app/layout/globals/tests/data/bodyclass_nametest.pt\n@@ -1 +1 @@\n-<html><body>foo</body></html>\n\\ No newline at end of file\n+<html><body>foo</body></html>\ndiff --git a/plone/app/layout/links/author.pt b/plone/app/layout/links/author.pt\nindex 6f9f9d47..a2f25269 100644\n--- a/plone/app/layout/links/author.pt\n+++ b/plone/app/layout/links/author.pt\n@@ -1,12 +1,18 @@\n <div xmlns="http://www.w3.org/1999/xhtml"\n      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-     tal:define="navigation_root_url view/navigation_root_url"\n+     tal:define="\n+       navigation_root_url view/navigation_root_url;\n+     "\n      tal:omit-tag=""\n-     i18n:domain="plone">\n-    <link rel="author"\n-          href=""\n-          title="Author information"\n-          i18n:attributes="title title_author_info"\n-          tal:attributes="href string:${navigation_root_url}/author/${context/Creator|nothing}" />\n+     i18n:domain="plone"\n+>\n+  <link href=""\n+        rel="author"\n+        title="Author information"\n+        tal:attributes="\n+          href string:${navigation_root_url}/author/${context/Creator|nothing};\n+        "\n+        i18n:attributes="title title_author_info"\n+  />\n </div>\ndiff --git a/plone/app/layout/links/favicon.pt b/plone/app/layout/links/favicon.pt\nindex 73fd1472..811481e1 100644\n--- a/plone/app/layout/links/favicon.pt\n+++ b/plone/app/layout/links/favicon.pt\n@@ -1,5 +1,13 @@\n <tal:favicon>\n-    <link rel="preload icon" type="${python: view.mimetype}"\n-          tal:attributes="href python: view.favicon_path" />\n-    <link rel="mask-icon" tal:attributes="href python: view.favicon_path" />\n-</tal:favicon>\n\\ No newline at end of file\n+  <link rel="preload icon"\n+        type="${python: view.mimetype}"\n+        tal:attributes="\n+          href python: view.favicon_path;\n+        "\n+  />\n+  <link rel="mask-icon"\n+        tal:attributes="\n+          href python: view.favicon_path;\n+        "\n+  />\n+</tal:favicon>\ndiff --git a/plone/app/layout/links/rsslink.pt b/plone/app/layout/links/rsslink.pt\nindex 81de4a9e..9384413d 100644\n--- a/plone/app/layout/links/rsslink.pt\n+++ b/plone/app/layout/links/rsslink.pt\n@@ -1,7 +1,11 @@\n <tal:feeds tal:repeat="link view/rsslinks">\n-    <link rel="alternate" href="" title="RSS 1.0"\n-          type="application/rss+xml"\n-          tal:attributes="href link/url;\n-                          title link/title"\n-          />\n-</tal:feeds>\n\\ No newline at end of file\n+  <link href=""\n+        rel="alternate"\n+        title="RSS 1.0"\n+        type="application/rss+xml"\n+        tal:attributes="\n+          href link/url;\n+          title link/title;\n+        "\n+  />\n+</tal:feeds>\ndiff --git a/plone/app/layout/links/search.pt b/plone/app/layout/links/search.pt\nindex d41569c5..b3b58ebd 100644\n--- a/plone/app/layout/links/search.pt\n+++ b/plone/app/layout/links/search.pt\n@@ -1,8 +1,14 @@\n-<tal:search define="navigation_root_url view/navigation_root_url"\n-            i18n:domain="plone">\n-    <link rel="search"\n-          href=""\n-          title="Search this site"\n-          i18n:attributes="title title_search_this_site"\n-          tal:attributes="href string:${navigation_root_url}/@@search" />\n+<tal:search define="\n+              navigation_root_url view/navigation_root_url;\n+            "\n+            i18n:domain="plone"\n+>\n+  <link href=""\n+        rel="search"\n+        title="Search this site"\n+        tal:attributes="\n+          href string:${navigation_root_url}/@@search;\n+        "\n+        i18n:attributes="title title_search_this_site"\n+  />\n </tal:search>\ndiff --git a/plone/app/layout/nextprevious/links.pt b/plone/app/layout/nextprevious/links.pt\nindex 4b391def..33787906 100644\n--- a/plone/app/layout/nextprevious/links.pt\n+++ b/plone/app/layout/nextprevious/links.pt\n@@ -1,25 +1,38 @@\n <div xmlns="http://www.w3.org/1999/xhtml"\n      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-     tal:define="enabled view/enabled|nothing;\n-                 isViewTemplate view/isViewTemplate|nothing"\n+     tal:define="\n+       enabled view/enabled|nothing;\n+       isViewTemplate view/isViewTemplate|nothing;\n+     "\n      tal:condition="python:enabled and isViewTemplate"\n-     tal:omit-tag="">\n+     tal:omit-tag=""\n+>\n \n-    <link rel="previous"\n-          href=""\n-          title="Go to previous item"\n-          tal:define="previous view/previous"\n-          tal:condition="previous"\n-          i18n:attributes="title title_previous_item"\n-          tal:attributes="href previous/url" />\n+  <link href=""\n+        rel="previous"\n+        title="Go to previous item"\n+        tal:define="\n+          previous view/previous;\n+        "\n+        tal:condition="previous"\n+        tal:attributes="\n+          href previous/url;\n+        "\n+        i18n:attributes="title title_previous_item"\n+  />\n \n-    <link rel="next"\n-          href=""\n-          title="Go to next item"\n-          tal:define="next view/next"\n-          tal:condition="next"\n-          i18n:attributes="title title_next_item"\n-          tal:attributes="href next/url" />\n+  <link href=""\n+        rel="next"\n+        title="Go to next item"\n+        tal:define="\n+          next view/next;\n+        "\n+        tal:condition="next"\n+        tal:attributes="\n+          href next/url;\n+        "\n+        i18n:attributes="title title_next_item"\n+  />\n \n </div>\ndiff --git a/plone/app/layout/nextprevious/nextprevious.pt b/plone/app/layout/nextprevious/nextprevious.pt\nindex 06384dd8..34b9bd81 100644\n--- a/plone/app/layout/nextprevious/nextprevious.pt\n+++ b/plone/app/layout/nextprevious/nextprevious.pt\n@@ -1,36 +1,61 @@\n <section id="section-next-prev"\n-     tal:define="enabled view/enabled|nothing;\n-                 isViewTemplate view/isViewTemplate|nothing"\n-     tal:condition="python:enabled and isViewTemplate"\n-     i18n:domain="plone">\n+         tal:define="\n+           enabled view/enabled|nothing;\n+           isViewTemplate view/isViewTemplate|nothing;\n+         "\n+         tal:condition="python:enabled and isViewTemplate"\n+         i18n:domain="plone"\n+>\n \n-  <tal:block define="portal_url view/site_url;">\n+  <tal:block define="\n+               portal_url view/site_url;\n+             ">\n \n     <nav class="pagination justify-content-between"\n-         tal:define="next view/next;\n-                     previous view/previous"\n-         tal:condition="python:previous is not None or next is not None">\n-\n-          <a class="btn btn-sm btn-outline-secondary align-self-start previous" tal:condition="previous"\n-              title="Go to previous item"\n-              i18n:attributes="title title_previous_item"\n-              tal:attributes="href previous/url">\n-            <span class="arrow"></span>\n-            <span i18n:translate="label_previous_item" class="label">\n+         tal:define="\n+           next view/next;\n+           previous view/previous;\n+         "\n+         tal:condition="python:previous is not None or next is not None"\n+    >\n+\n+      <a class="btn btn-sm btn-outline-secondary align-self-start previous"\n+         title="Go to previous item"\n+         tal:condition="previous"\n+         tal:attributes="\n+           href previous/url;\n+         "\n+         i18n:attributes="title title_previous_item"\n+      >\n+        <span class="arrow"></span>\n+        <span class="label"\n+              i18n:translate="label_previous_item"\n+        >\n               Previous:\n-              <span i18n:name="itemtitle" tal:replace="previous/title" />\n-            </span>\n-          </a>\n-\n-          <a class="btn btn-sm btn-outline-secondary align-self-end next" tal:condition="next" title="Go to next item"\n-              i18n:attributes="title title_next_item"\n-              tal:attributes="href next/url">\n-            <span i18n:translate="label_next_item" class="label">\n+          <span tal:replace="previous/title"\n+                i18n:name="itemtitle"\n+          ></span>\n+        </span>\n+      </a>\n+\n+      <a class="btn btn-sm btn-outline-secondary align-self-end next"\n+         title="Go to next item"\n+         tal:condition="next"\n+         tal:attributes="\n+           href next/url;\n+         "\n+         i18n:attributes="title title_next_item"\n+      >\n+        <span class="label"\n+              i18n:translate="label_next_item"\n+        >\n               Next:\n-              <span i18n:name="itemtitle" tal:replace="next/title" />\n-            </span>\n-            <span class="arrow"></span>\n-          </a>\n+          <span tal:replace="next/title"\n+                i18n:name="itemtitle"\n+          ></span>\n+        </span>\n+        <span class="arrow"></span>\n+      </a>\n \n \n     </nav>\ndiff --git a/plone/app/layout/viewlets/anontools.pt b/plone/app/layout/viewlets/anontools.pt\nindex 810675d9..f399fdbc 100644\n--- a/plone/app/layout/viewlets/anontools.pt\n+++ b/plone/app/layout/viewlets/anontools.pt\n@@ -1,10 +1,17 @@\n-<div id="portal-anontools" tal:condition="python:view.user_actions and view.anonymous">\n+<div id="portal-anontools"\n+     tal:condition="python:view.user_actions and view.anonymous"\n+>\n   <ul class="list-inline">\n-    <li class="list-inline-item" tal:repeat="action view/user_actions">\n+    <li class="list-inline-item"\n+        tal:repeat="action view/user_actions"\n+    >\n       <a href=""\n-          tal:attributes="action"\n-          tal:content="action/title"\n-          i18n:translate="">\n+         tal:content="action/title"\n+         tal:attributes="\n+           action;\n+         "\n+         i18n:translate=""\n+      >\n           action title\n       </a>\n     </li>\ndiff --git a/plone/app/layout/viewlets/colophon.pt b/plone/app/layout/viewlets/colophon.pt\nindex 2137b891..b4c07f25 100644\n--- a/plone/app/layout/viewlets/colophon.pt\n+++ b/plone/app/layout/viewlets/colophon.pt\n@@ -1,14 +1,17 @@\n <div id="portal-colophon"\n-     i18n:domain="plone">\n-<div class="colophonWrapper">\n-<ul>\n-  <li>\n-    <a href="http://plone.com" target="_blank"\n-       title="This site was built using the Plone Open Source CMS/WCM."\n-       i18n:attributes="title title_built_with_plone;"\n-       i18n:translate="label_powered_by_plone">\n-      Powered by Plone &amp; Python</a>\n-  </li>\n-</ul>\n-</div>\n+     i18n:domain="plone"\n+>\n+  <div class="colophonWrapper">\n+    <ul>\n+      <li>\n+        <a href="http://plone.com"\n+           target="_blank"\n+           title="This site was built using the Plone Open Source CMS/WCM."\n+           i18n:attributes="title title_built_with_plone;"\n+           i18n:translate="label_powered_by_plone"\n+        >\n+          Powered by Plone &amp; Python</a>\n+      </li>\n+    </ul>\n+  </div>\n </div>\ndiff --git a/plone/app/layout/viewlets/content_history.pt b/plone/app/layout/viewlets/content_history.pt\nindex d7c37e75..629b3829 100644\n--- a/plone/app/layout/viewlets/content_history.pt\n+++ b/plone/app/layout/viewlets/content_history.pt\n@@ -1,97 +1,162 @@\n-<div i18n:domain="plone"\n-     tal:define="history view/fullHistory;"\n-     tal:omit-tag="">\n-     <div tal:condition="not: history">\xe2\x80\x94</div>\n+<div tal:define="\n+       history view/fullHistory;\n+     "\n+     tal:omit-tag=""\n+     i18n:domain="plone"\n+>\n+  <div tal:condition="not: history">&mdash;</div>\n \n-    <table class="table" id="history-list" tal:condition="history"\n-        summary="Content history"\n-        i18n:attributes="summary summary_content_history;">\n-        <tbody>\n-            <tr class="odd">\n-                <th i18n:translate="">What</th>\n-                <th i18n:translate="">View</th>\n-                <th colspan="2" i18n:translate="">Compare</th>\n-                <th i18n:translate="">Revert</th>\n-            </tr>\n-            <tal:block repeat="item history">\n-            <tal:historyItem\n-                define="rhComments item/comments|nothing;\n-                        actor item/actor;\n-                        actor_name python:actor and actor.get(\'fullname\',\'username\') or item[\'actorid\'];\n-                        actor_home item/actor_home;\n-                        action item/transition_title;\n-                        action_id python:item[\'action\'] or item[\'review_state\'];\n-                        effective item/effective_date|nothing;\n-                        effectiveDate python:effective and view.toLocalizedTime(item[\'effective_date\'],long_format=True);\n-                        isVersion python:item[\'type\']==\'versioning\';\n-                        icons python:context.restrictedTraverse(\'@@iconresolver\')">\n-            <tr class="historyRecord ${python:\'table-secondary\' if not isVersion else \'\'}">\n-                <td>\n-                    <span class="historyByLine">\n-                        <tal:action i18n:translate="history_action">\n-                            <span class="historyAction" tal:content="action" i18n:translate="" i18n:name="action"\n-                               tal:attributes="class string:historyAction state-${action_id}"/>\n-                            \xe2\x80\x94\n-                            <tal:actor i18n:name="actor">\n-                             <a href=""\n-                                tal:condition="actor_home"\n-                                tal:attributes="href actor_home"\n-                                tal:content="actor_name"> runyaga </a>\n-                             <span tal:condition="not: actor_home"\n-                                   tal:replace="actor_name"/>\n-                            </tal:actor>\n+  <table class="table"\n+         id="history-list"\n+         summary="Content history"\n+         tal:condition="history"\n+         i18n:attributes="summary summary_content_history;"\n+  >\n+    <tbody>\n+      <tr class="odd">\n+        <th i18n:translate="">What</th>\n+        <th i18n:translate="">View</th>\n+        <th colspan="2"\n+            i18n:translate=""\n+        >Compare</th>\n+        <th i18n:translate="">Revert</th>\n+      </tr>\n+      <tal:block repeat="item history">\n+        <tal:historyitem define="\n+                           rhComments item/comments|nothing;\n+                           actor item/actor;\n+                           actor_name python:actor and actor.get(\'fullname\',\'username\') or item[\'actorid\'];\n+                           actor_home item/actor_home;\n+                           action item/transition_title;\n+                           action_id python:item[\'action\'] or item[\'review_state\'];\n+                           effective item/effective_date|nothing;\n+                           effectiveDate python:effective and view.toLocalizedTime(item[\'effective_date\'],long_format=True);\n+                           isVersion python:item[\'type\']==\'versioning\';\n+                           icons python:context.restrictedTraverse(\'@@iconresolver\');\n+                         ">\n+          <tr class="historyRecord ${python:\'table-secondary\' if not isVersion else \'\'}">\n+            <td>\n+              <span class="historyByLine">\n+                <tal:action i18n:translate="history_action">\n+                  <span class="historyAction"\n+                        tal:content="action"\n+                        tal:attributes="\n+                          class string:historyAction state-${action_id};\n+                        "\n+                        i18n:name="action"\n+                        i18n:translate=""\n+                  ></span>\n+                            &mdash;\n+                  <tal:actor i18n:name="actor">\n+                    <a href=""\n+                       tal:condition="actor_home"\n+                       tal:content="actor_name"\n+                       tal:attributes="\n+                         href actor_home;\n+                       "\n+                    >\n+                      runyaga\n+                    </a>\n+                    <span tal:condition="not: actor_home"\n+                          tal:replace="actor_name"\n+                    ></span>\n+                  </tal:actor>\n                             on\n-                            <span i18n:translate="" i18n:name="time" tal:content="python:view.toLocalizedTime(item[\'time\'],long_format=True)"/>\n-                        </tal:action>\n-                        <tal:effective tal:condition="effective|nothing">\n-                            (<span i18n:translate="label_publishing_effective" tal:omit-tag="">effective</span>: ${effectiveDate})\n-                        </tal:effective>\n+                  <span tal:content="python:view.toLocalizedTime(item[\'time\'],long_format=True)"\n+                        i18n:name="time"\n+                        i18n:translate=""\n+                  ></span>\n+                </tal:action>\n+                <tal:effective tal:condition="effective|nothing">\n+                  (<span tal:omit-tag=""\n+                        i18n:translate="label_publishing_effective"\n+                  >effective</span>: ${effectiveDate})\n+                </tal:effective>\n \n-                    </span>\n-                    <p class="text-muted" tal:condition="rhComments">\n-                        <span i18n:translate="label_change_note">Change Note</span>:\n-                        <span i18n:translate="" tal:content="rhComments" />\n-                    </p>\n-                </td>\n-                <td>\n-                    <span class="historyLinks" tal:condition="isVersion">\n-                        <a class="btn btn-primary" href=""\n-                            tal:attributes="href item/preview_url"\n-                            i18n:translate="title_view_revision">View</a>\n-                    </span>\n-                </td>\n-                <td>\n-                    <span class="historyLinks" tal:condition="isVersion">\n-                        <a class="btn btn-secondary" href="" tal:attributes="href item/diff_current_url"\n-                            tal:condition="exists:item/diff_current_url">\n-                            <tal:icon replace="structure python:icons.tag(\'arrow-up\')" />\n-                            <span i18n:translate="title_compare_revision">Compare to current</span>\n-                        </a>\n-                    </span>\n-                </td>\n-                <td>\n-                    <a class="btn btn-secondary" tal:condition="exists:item/diff_previous_url"\n-                        tal:attributes="href item/diff_previous_url"\n-                        title="Compare with previous revision"\n-                        i18n:attributes="title title_compare_previous_revision">\n-                        <tal:icon replace="structure python:icons.tag(\'arrow-down\')" />\n-                        <span i18n:translate="label_compare" tal:omit-tag="">Compare</span>\n-                    </a>\n-                </td>\n-                <td>\n-                    <span class="historyTools" tal:condition="isVersion">\n-                    <form action="" method="post" tal:condition="item/revert_url" tal:attributes="action item/revert_url">\n-                        <input type="hidden" name="version_id" value="" tal:attributes="value item/version_id" />\n-                        <button class="btn btn-warning" type="submit"\n-                                tal:condition="exists:item/diff_current_url"\n-                                i18n:translate="title_revert_revision">Revert to this revision</button>\n-                    </form>\n-                    </span>\n-                </td>\n-            </tr>\n-            </tal:historyItem>\n-            </tal:block>\n-        </tbody>\n-    </table>\n+              </span>\n+              <p class="text-muted"\n+                 tal:condition="rhComments"\n+              >\n+                <span i18n:translate="label_change_note">Change Note</span>:\n+                <span tal:content="rhComments"\n+                      i18n:translate=""\n+                ></span>\n+              </p>\n+            </td>\n+            <td>\n+              <span class="historyLinks"\n+                    tal:condition="isVersion"\n+              >\n+                <a class="btn btn-primary"\n+                   href=""\n+                   tal:attributes="\n+                     href item/preview_url;\n+                   "\n+                   i18n:translate="title_view_revision"\n+                >View</a>\n+              </span>\n+            </td>\n+            <td>\n+              <span class="historyLinks"\n+                    tal:condition="isVersion"\n+              >\n+                <a class="btn btn-secondary"\n+                   href=""\n+                   tal:condition="exists:item/diff_current_url"\n+                   tal:attributes="\n+                     href item/diff_current_url;\n+                   "\n+                >\n+                  <tal:icon replace="structure python:icons.tag(\'arrow-up\')" />\n+                  <span i18n:translate="title_compare_revision">Compare to current</span>\n+                </a>\n+              </span>\n+            </td>\n+            <td>\n+              <a class="btn btn-secondary"\n+                 title="Compare with previous revision"\n+                 tal:condition="exists:item/diff_previous_url"\n+                 tal:attributes="\n+                   href item/diff_previous_url;\n+                 "\n+                 i18n:attributes="title title_compare_previous_revision"\n+              >\n+                <tal:icon replace="structure python:icons.tag(\'arrow-down\')" />\n+                <span tal:omit-tag=""\n+                      i18n:translate="label_compare"\n+                >Compare</span>\n+              </a>\n+            </td>\n+            <td>\n+              <span class="historyTools"\n+                    tal:condition="isVersion"\n+              >\n+                <form action=""\n+                      method="post"\n+                      tal:condition="item/revert_url"\n+                      tal:attributes="\n+                        action item/revert_url;\n+                      "\n+                >\n+                  <input name="version_id"\n+                         type="hidden"\n+                         value=""\n+                         tal:attributes="\n+                           value item/version_id;\n+                         "\n+                  />\n+                  <button class="btn btn-warning"\n+                          type="submit"\n+                          tal:condition="exists:item/diff_current_url"\n+                          i18n:translate="title_revert_revision"\n+                  >Revert to this revision</button>\n+                </form>\n+              </span>\n+            </td>\n+          </tr>\n+        </tal:historyitem>\n+      </tal:block>\n+    </tbody>\n+  </table>\n \n </div>\ndiff --git a/plone/app/layout/viewlets/contentviews.pt b/plone/app/layout/viewlets/contentviews.pt\nindex b84c3627..c2c49ebc 100644\n--- a/plone/app/layout/viewlets/contentviews.pt\n+++ b/plone/app/layout/viewlets/contentviews.pt\n@@ -1,21 +1,28 @@\n-<tal:contentviews tal:define="ploneview context/@@plone;"\n+<tal:contentviews tal:define="\n+                    ploneview context/@@plone;\n+                  "\n                   tal:condition="ploneview/showToolbar"\n-                  i18n:domain="plone">\n+                  i18n:domain="plone"\n+>\n \n-  <tal:block define="actions view/tabSet1;">\n-    <div tal:replace="structure python: view.menu_template(actions=actions)" />\n+  <tal:block define="\n+               actions view/tabSet1;\n+             ">\n+    <div tal:replace="structure python: view.menu_template(actions=actions)"></div>\n   </tal:block>\n \n   <li class="border-top my-2">\n \n-  <tal:contentmenus>\n-    <div tal:replace="structure provider:plone.contentmenu" />\n-  </tal:contentmenus>\n+    <tal:contentmenus>\n+      <div tal:replace="structure provider:plone.contentmenu"></div>\n+    </tal:contentmenus>\n \n-  <li class="border-top my-2">\n+    <li class="border-top my-2">\n \n-  <tal:block define="actions view/tabSet2;">\n-    <div tal:replace="structure python: view.menu_template(actions=actions)" />\n-  </tal:block>\n+      <tal:block define="\n+                   actions view/tabSet2;\n+                 ">\n+        <div tal:replace="structure python: view.menu_template(actions=actions)"></div>\n+      </tal:block>\n \n-</tal:contentviews>\n+    </li></li></tal:contentviews>\ndiff --git a/plone/app/layout/viewlets/document_actions.pt b/plone/app/layout/viewlets/document_actions.pt\nindex 111b910e..c299430d 100644\n--- a/plone/app/layout/viewlets/document_actions.pt\n+++ b/plone/app/layout/viewlets/document_actions.pt\n@@ -1,35 +1,45 @@\n <section id="section-document-actions"\n-    i18n:domain="plone"\n-    tal:condition="view/actions">\n+         tal:condition="view/actions"\n+         i18n:domain="plone"\n+>\n \n-    <div class="viewlet viewlet-document-actions">\n-        <tal:docactions>\n+  <div class="viewlet viewlet-document-actions">\n+    <tal:docactions>\n \n-            <div class="d-none" i18n:translate="heading_document_actions">\n+      <div class="d-none"\n+           i18n:translate="heading_document_actions"\n+      >\n               Document Actions\n-            </div>\n+      </div>\n \n-            <ul class="list-inline"\n-                tal:define="normalizeString nocall: context/@@plone/normalizeString;\n-                            icons python:context.restrictedTraverse(\'@@iconresolver\');\n-                            ">\n-                  <li tal:repeat="daction view/actions"\n-                      tal:attributes="id python:\'document-action-\' + normalizeString(daction[\'id\'])">\n-                      <a href=""\n-                         tal:attributes="href daction/url;\n-                                         target daction/link_target|nothing;\n-                                         title daction/description|nothing"\n-                        >\n-                        <tal:icon tal:replace="structure python:icons.tag(daction.get(\'icon\'))" />\n-                        <span\n-                            i18n:translate=""\n-                            tal:replace="daction/title">\n+      <ul class="list-inline"\n+          tal:define="\n+            normalizeString nocall: context/@@plone/normalizeString;\n+            icons python:context.restrictedTraverse(\'@@iconresolver\');\n+          "\n+      >\n+        <li tal:repeat="daction view/actions"\n+            tal:attributes="\n+              id python:\'document-action-\' + normalizeString(daction[\'id\']);\n+            "\n+        >\n+          <a href=""\n+             tal:attributes="\n+               href daction/url;\n+               target daction/link_target|nothing;\n+               title daction/description|nothing;\n+             "\n+          >\n+            <tal:icon tal:replace="structure python:icons.tag(daction.get(\'icon\'))" />\n+            <span tal:replace="daction/title"\n+                  i18n:translate=""\n+            >\n                             Menu Title\n-                        </span>\n-                      </a>\n-                  </li>\n-            </ul>\n-        </tal:docactions>\n+            </span>\n+          </a>\n+        </li>\n+      </ul>\n+    </tal:docactions>\n \n-    </div>\n+  </div>\n </section>\ndiff --git a/plone/app/layout/viewlets/document_byline.pt b/plone/app/layout/viewlets/document_byline.pt\nindex d1d4f267..a1106e9c 100644\n--- a/plone/app/layout/viewlets/document_byline.pt\n+++ b/plone/app/layout/viewlets/document_byline.pt\n@@ -23,30 +23,38 @@\n         >${fullname}</span>\n       </tal:user>\n     </tal:for>\n-    \xe2\x80\x94\n+    &mdash;\n   </tal:creators>\n \n-  <tal:dates define="published view/pub_date;\n-                     modified context/ModificationDate;\n-                     show_modification_date python:view.show_modification_date()">\n-  <span class="documentPublished" tal:condition="published">\n-    <span i18n:translate="box_published">published</span>\n-    <span tal:content="python:context.toLocalizedTime(published)">Published</span><tal:sep condition="show_modification_date">,</tal:sep>\n-  </span>\n+  <tal:dates define="\n+               published view/pub_date;\n+               modified context/ModificationDate;\n+               show_modification_date python:view.show_modification_date();\n+             ">\n+    <span class="documentPublished"\n+          tal:condition="published"\n+    >\n+      <span i18n:translate="box_published">published</span>\n+      <span tal:content="python:context.toLocalizedTime(published)">Published</span><tal:sep condition="show_modification_date">,</tal:sep>\n+    </span>\n \n-  <span class="documentModified" tal:condition="show_modification_date">\n-    <span i18n:translate="box_last_modified">\n+    <span class="documentModified"\n+          tal:condition="show_modification_date"\n+    >\n+      <span i18n:translate="box_last_modified">\n       last modified\n-    </span>\n-    <span tal:content="python:context.toLocalizedTime(modified)">\n+      </span>\n+      <span tal:content="python:context.toLocalizedTime(modified)">\n       Modified\n+      </span>\n     </span>\n-  </span>\n   </tal:dates>\n \n   <tal:expired tal:condition="view/isExpired">\n-    \xe2\x80\x94\n-    <span class="state-expired" i18n:translate="time_expired">expired</span>\n+    &mdash;\n+    <span class="state-expired"\n+          i18n:translate="time_expired"\n+    >expired</span>\n   </tal:expired>\n \n </section>\ndiff --git a/plone/app/layout/viewlets/document_relateditems.pt b/plone/app/layout/viewlets/document_relateditems.pt\nindex 2cc75501..9449f21b 100644\n--- a/plone/app/layout/viewlets/document_relateditems.pt\n+++ b/plone/app/layout/viewlets/document_relateditems.pt\n@@ -1,27 +1,57 @@\n-<section id="section-related" i18n:domain="plone"\n-    tal:define="related view/related_items; plone_view nocall:context/@@plone;\n-                plone_layout nocall:context/@@plone_layout;\n-                normalizeString nocall:plone_view/normalizeString;\n-                context_state nocall:context/@@plone_context_state;\n-                use_view_action python:context.portal_registry.get(\'types_use_view_action_in_listings\', []);"\n-    tal:condition="related">\n+<section id="section-related"\n+         tal:define="\n+           related view/related_items;\n+           plone_view nocall:context/@@plone;\n+           plone_layout nocall:context/@@plone_layout;\n+           normalizeString nocall:plone_view/normalizeString;\n+           context_state nocall:context/@@plone_context_state;\n+           use_view_action python:context.portal_registry.get(\'types_use_view_action_in_listings\', []);\n+         "\n+         tal:condition="related"\n+         i18n:domain="plone"\n+>\n \n-    <header class="section-heading" i18n:translate="section_related_heading">\n+  <header class="section-heading"\n+          i18n:translate="section_related_heading"\n+  >\n       Related content\n-    </header>\n+  </header>\n \n-    <!-- section content -->\n-    <tal:items tal:repeat="item related">\n-    <div class="media position-relative" tal:define="desc item/Description; item_type item/portal_type; item_type_class python:\'contenttype-\' + normalizeString(item_type); item_wf_state item/review_state|python: context_state.workflow_state(); item_wf_state_class python: \'state-\' + normalizeString(item_wf_state); item_url item/getURL|item/absolute_url; item_url python:(item_type in use_view_action) and item_url+\'/view\' or item_url; item_has_image python:item.getIcon;">\n+  <!-- section content -->\n+  <tal:items tal:repeat="item related">\n+    <div class="media position-relative"\n+         tal:define="\n+           desc item/Description;\n+           item_type item/portal_type;\n+           item_type_class python:\'contenttype-\' + normalizeString(item_type);\n+           item_wf_state item/review_state|python: context_state.workflow_state();\n+           item_wf_state_class python: \'state-\' + normalizeString(item_wf_state);\n+           item_url item/getURL|item/absolute_url;\n+           item_url python:(item_type in use_view_action) and item_url+\'/view\' or item_url;\n+           item_has_image python:item.getIcon;\n+         "\n+    >\n \n       <div class="media-body">\n-        <div><a href="${item_url}" class="h6 stretched-link">${item/pretty_title_or_id}</a></div>\n+        <div><a class="h6 stretched-link"\n+             href="${item_url}"\n+          >${item/pretty_title_or_id}</a></div>\n         <small>${item/Description}</small>\n       </div>\n \n-      <img src="" class="ms-3" tal:define="getIcon python:item.getURL() +\'/@@images/image/thumb\'" tal:condition="item_has_image" tal:attributes="src string:$getIcon; alt item/Description">\n+      <img class="ms-3"\n+           src=""\n+           tal:define="\n+             getIcon python:item.getURL() +\'/@@images/image/thumb\';\n+           "\n+           tal:condition="item_has_image"\n+           tal:attributes="\n+             src string:$getIcon;\n+             alt item/Description;\n+           "\n+      />\n \n     </div>\n-    </tal:items>\n+  </tal:items>\n \n </section>\ndiff --git a/plone/app/layout/viewlets/document_rights.pt b/plone/app/layout/viewlets/document_rights.pt\nindex ad65eb40..df01bad4 100644\n--- a/plone/app/layout/viewlets/document_rights.pt\n+++ b/plone/app/layout/viewlets/document_rights.pt\n@@ -1,9 +1,18 @@\n-<section id="section-rights" class="text-muted" i18n:domain="plone" tal:define="rights context/Rights" tal:condition="rights">\n+<section class="text-muted"\n+         id="section-rights"\n+         tal:define="\n+           rights context/Rights;\n+         "\n+         tal:condition="rights"\n+         i18n:domain="plone"\n+>\n \n-    <header class="section-heading" i18n:translate="section_rights_heading">\n+  <header class="section-heading"\n+          i18n:translate="section_rights_heading"\n+  >\n       Rights\n-    </header>\n+  </header>\n \n-    <small tal:content="rights">Copyleft NiceCorp Inc.</small>\n+  <small tal:content="rights">Copyleft NiceCorp Inc.</small>\n \n </section>\ndiff --git a/plone/app/layout/viewlets/dublin_core.pt b/plone/app/layout/viewlets/dublin_core.pt\nindex e65592ca..7290f088 100644\n--- a/plone/app/layout/viewlets/dublin_core.pt\n+++ b/plone/app/layout/viewlets/dublin_core.pt\n@@ -1,2 +1,6 @@\n <meta tal:repeat="keyval view/metatags"\n-      tal:attributes="name python:keyval[0]; content python:keyval[1];" />\n\\ No newline at end of file\n+      tal:attributes="\n+        name python:keyval[0];\n+        content python:keyval[1];\n+      "\n+/>\ndiff --git a/plone/app/layout/viewlets/globalstatusmessage.pt b/plone/app/layout/viewlets/globalstatusmessage.pt\nindex abea74a5..31f02091 100644\n--- a/plone/app/layout/viewlets/globalstatusmessage.pt\n+++ b/plone/app/layout/viewlets/globalstatusmessage.pt\n@@ -1,17 +1,25 @@\n-<tal:statusmsg tal:define="icons nocall: context/@@iconresolver"\n-               tal:repeat="message python:view.messages">\n+<tal:statusmsg tal:define="\n+                 icons nocall: context/@@iconresolver;\n+               "\n+               tal:repeat="message python:view.messages"\n+>\n \n-    <div tal:define="mtype message/type | nothing;\n-                     display_info python:view.display_info_for_mtype(mtype);"\n-         tal:condition="mtype"\n-         class="portalMessage ${python:display_info[\'cssclass\']}"\n-         role="alert">\n-        <tal:icon tal:replace="structure python:icons.tag(display_info[\'icon\'], tag_alt=display_info[\'msg\'], tag_class=\'statusmessage-icon mb-1 me-2\')" />\n-        <strong>${python:display_info[\'msg\']}</strong>\n-        <span class="content"\n-              tal:replace="message/message | nothing" i18n:translate="">\n+  <div class="portalMessage ${python:display_info[\'cssclass\']}"\n+       role="alert"\n+       tal:define="\n+         mtype message/type | nothing;\n+         display_info python:view.display_info_for_mtype(mtype);\n+       "\n+       tal:condition="mtype"\n+  >\n+    <tal:icon tal:replace="structure python:icons.tag(display_info[\'icon\'], tag_alt=display_info[\'msg\'], tag_class=\'statusmessage-icon mb-1 me-2\')" />\n+    <strong>${python:display_info[\'msg\']}</strong>\n+    <span class="content"\n+          tal:replace="message/message | nothing"\n+          i18n:translate=""\n+    >\n             The status message.\n-        </span>\n-    </div>\n+    </span>\n+  </div>\n \n </tal:statusmsg>\ndiff --git a/plone/app/layout/viewlets/history_view.pt b/plone/app/layout/viewlets/history_view.pt\nindex 1b23eab7..45ef31e8 100644\n--- a/plone/app/layout/viewlets/history_view.pt\n+++ b/plone/app/layout/viewlets/history_view.pt\n@@ -1,19 +1,21 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n     <metal:description fill-slot="content-description" />\n-    \n+\n     <metal:content fill-slot="content-core">\n-        <h3 i18n:translate="label_history">History</h3>\n-        <div tal:replace="structure here/@@contenthistory">Content History</div>\n+      <h3 i18n:translate="label_history">History</h3>\n+      <div tal:replace="structure here/@@contenthistory">Content History</div>\n     </metal:content>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/layout/viewlets/keywords.pt b/plone/app/layout/viewlets/keywords.pt\nindex 5bdd7d19..badcfeef 100644\n--- a/plone/app/layout/viewlets/keywords.pt\n+++ b/plone/app/layout/viewlets/keywords.pt\n@@ -1,17 +1,33 @@\n-<section id="section-category" i18n:domain="plone" tal:define="categories context/Subject|nothing; url_quote nocall:modules/Products.PythonScripts.standard/url_quote" tal:condition="categories">\n+<section id="section-category"\n+         tal:define="\n+           categories context/Subject|nothing;\n+           url_quote nocall:modules/Products.PythonScripts.standard/url_quote;\n+         "\n+         tal:condition="categories"\n+         i18n:domain="plone"\n+>\n \n   <div class="viewlet keywords-viewlet">\n \n-    <header class="card-title section-heading d-none" i18n:translate="section_keywords_heading">\n+    <header class="card-title section-heading d-none"\n+            i18n:translate="section_keywords_heading"\n+    >\n       Keywords\n     </header>\n \n     <tal:repeat tal:repeat="category categories">\n-    <a href="#" rel="nofollow" class="btn btn-sm btn-outline-primary"\n-      tal:define="quotedCat python:url_quote(category)"\n-      tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/@@search?Subject%3Alist=${quotedCat}">\n-      <span tal:content="category"></span>\n-    </a>\n+      <a class="btn btn-sm btn-outline-primary"\n+         href="#"\n+         rel="nofollow"\n+         tal:define="\n+           quotedCat python:url_quote(category);\n+         "\n+         tal:attributes="\n+           href string:${context/@@plone_portal_state/navigation_root_url}/@@search?Subject%3Alist=${quotedCat};\n+         "\n+      >\n+        <span tal:content="category"></span>\n+      </a>\n     </tal:repeat>\n \n   </div>\ndiff --git a/plone/app/layout/viewlets/logo.pt b/plone/app/layout/viewlets/logo.pt\nindex 5071ce33..b5bf9c43 100644\n--- a/plone/app/layout/viewlets/logo.pt\n+++ b/plone/app/layout/viewlets/logo.pt\n@@ -1,10 +1,17 @@\n <a id="portal-logo"\n    title="Home"\n-   tal:attributes="href view/navigation_root_url;\n-                   title view/navigation_root_title"\n+   tal:attributes="\n+     href view/navigation_root_url;\n+     title view/navigation_root_title;\n+   "\n+   i18n:attributes="title"\n    i18n:domain="plone"\n-   i18n:attributes="title">\n-   <img src="plone-logo.svg" alt=""\n-   tal:attributes="alt view/logo_title;\n-                         title view/logo_title;\n-                         src view/img_src" /></a>\n+>\n+  <img alt=""\n+       src="plone-logo.svg"\n+       tal:attributes="\n+         alt view/logo_title;\n+         title view/logo_title;\n+         src view/img_src;\n+       "\n+  /></a>\ndiff --git a/plone/app/layout/viewlets/membertools.pt b/plone/app/layout/viewlets/membertools.pt\nindex f28a0a63..d0a32a71 100644\n--- a/plone/app/layout/viewlets/membertools.pt\n+++ b/plone/app/layout/viewlets/membertools.pt\n@@ -1,31 +1,52 @@\n <div id="portal-membertools-wrapper"\n+     tal:define="\n+       toolbar_visible here/@@plone_context_state/is_toolbar_visible;\n+       isAnon view/anonymous;\n+     "\n+     tal:condition="python:not isAnon and not toolbar_visible"\n      i18n:domain="plone"\n-     tal:define="toolbar_visible here/@@plone_context_state/is_toolbar_visible;\n-                 isAnon view/anonymous;"\n-     tal:condition="python:not isAnon and not toolbar_visible">\n+>\n \n-  <p class="hiddenStructure" i18n:translate="heading_member_tools">Member tools</p>\n+  <p class="hiddenStructure"\n+     i18n:translate="heading_member_tools"\n+  >Member tools</p>\n \n-  <div class="dropdown dropdown-menu-end" id="portal-membertools"\n-      tal:condition="python:view.user_actions and not view.anonymous">\n-      <a id="user-name"\n-         class="dropdown-toggle" data-bs-toggle="dropdown"\n-         tal:attributes="href view/homelink_url">\n-         <span tal:replace="view/user_name">John</span>\n-         <span class="caret"></span>\n-      </a>\n-      <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">\n-          <li tal:repeat="action view/user_actions"\n-              tal:attributes="id string:membertools-${action/id}">\n-              <a href="" class="dropdown-item"\n-                 tal:attributes="href action/href;\n-                                 target action/link_target|nothing"\n-                 tal:content="action/title"\n-                 i18n:translate="">\n+  <div class="dropdown dropdown-menu-end"\n+       id="portal-membertools"\n+       tal:condition="python:view.user_actions and not view.anonymous"\n+  >\n+    <a class="dropdown-toggle"\n+       id="user-name"\n+       data-bs-toggle="dropdown"\n+       tal:attributes="\n+         href view/homelink_url;\n+       "\n+    >\n+      <span tal:replace="view/user_name">John</span>\n+      <span class="caret"></span>\n+    </a>\n+    <ul class="dropdown-menu"\n+        aria-labelledby="dropdownMenu"\n+        role="menu"\n+    >\n+      <li tal:repeat="action view/user_actions"\n+          tal:attributes="\n+            id string:membertools-${action/id};\n+          "\n+      >\n+        <a class="dropdown-item"\n+           href=""\n+           tal:content="action/title"\n+           tal:attributes="\n+             href action/href;\n+             target action/link_target|nothing;\n+           "\n+           i18n:translate=""\n+        >\n                   action title\n-              </a>\n-          </li>\n-      </ul>\n+        </a>\n+      </li>\n+    </ul>\n   </div>\n \n </div>\ndiff --git a/plone/app/layout/viewlets/menu.pt b/plone/app/layout/viewlets/menu.pt\nindex 13c66cc0..2454a778 100644\n--- a/plone/app/layout/viewlets/menu.pt\n+++ b/plone/app/layout/viewlets/menu.pt\n@@ -1,35 +1,50 @@\n-<tal:contentviews tal:define="ploneview context/@@plone;\n-                              locked view/locked_icon;\n-                              icons python:context.restrictedTraverse(\'@@iconresolver\');"\n+<tal:contentviews tal:define="\n+                    ploneview context/@@plone;\n+                    locked view/locked_icon;\n+                    icons python:context.restrictedTraverse(\'@@iconresolver\');\n+                  "\n                   tal:condition="ploneview/showToolbar"\n-                  i18n:domain="plone">\n+                  i18n:domain="plone"\n+>\n   <tal:actions tal:repeat="action options/actions">\n-    <li id="contentview-${action/id}" class="nav-item"\n-        tal:define="actionid action/id;\n-                    selected action/selected | python:False">\n+    <li class="nav-item"\n+        id="contentview-${action/id}"\n+        tal:define="\n+          actionid action/id;\n+          selected action/selected | python:False;\n+        "\n+    >\n \n-        <a href="#" class="nav-link ${python:\'locked\' if locked and actionid == \'history\' else \'\'} ${action/cssClass | nothing} ${python:\'active\' if selected else None}"\n-           tal:attributes="href action/url;\n-                           target action/link_target|nothing;">\n+      <a class="nav-link ${python:\'locked\' if locked and actionid == \'history\' else \'\'} ${action/cssClass | nothing} ${python:\'active\' if selected else None}"\n+         href="#"\n+         tal:attributes="\n+           href action/url;\n+           target action/link_target|nothing;\n+         "\n+      >\n \n-          <tal:if condition="python:actionid != \'history\'">\n-            <tal:icon tal:condition="python:action[\'icon\']"\n-                      tal:replace="structure python:icons.tag(action[\'icon\'] or \'toolbar-action\', tag_class=\'me-1\')" />\n-            <span class="toolbar-label" tal:content="action/title" i18n:translate="">View name</span>\n-          </tal:if>\n+        <tal:if condition="python:actionid != \'history\'">\n+          <tal:icon tal:condition="python:action[\'icon\']"\n+                    tal:replace="structure python:icons.tag(action[\'icon\'] or \'toolbar-action\', tag_class=\'me-1\')"\n+          />\n+          <span class="toolbar-label"\n+                tal:content="action/title"\n+                i18n:translate=""\n+          >View name</span>\n+        </tal:if>\n \n-          <tal:if tal:condition="python:actionid == \'history\'">\n-            <tal:icon tal:replace="structure python:icons.tag(\'lock\' if locked else action[\'icon\'], tag_class=\'me-1\')" />\n-            <span class="toolbar-label">\n-              <time\n-                class="pat-display-time"\n-                data-pat-display-time="output-format: L LTS"\n-                datetime="${context/ModificationDate}"\n-                tal:content="">${context/ModificationDate}</time>\n-            </span>\n-          </tal:if>\n+        <tal:if tal:condition="python:actionid == \'history\'">\n+          <tal:icon tal:replace="structure python:icons.tag(\'lock\' if locked else action[\'icon\'], tag_class=\'me-1\')" />\n+          <span class="toolbar-label">\n+            <time class="pat-display-time"\n+                  datetime="${context/ModificationDate}"\n+                  data-pat-display-time="output-format: L LTS"\n+                  tal:content=""\n+            >${context/ModificationDate}</time>\n+          </span>\n+        </tal:if>\n \n-        </a>\n+      </a>\n \n     </li>\n   </tal:actions>\ndiff --git a/plone/app/layout/viewlets/path_bar.pt b/plone/app/layout/viewlets/path_bar.pt\nindex d6e60883..e553e70c 100644\n--- a/plone/app/layout/viewlets/path_bar.pt\n+++ b/plone/app/layout/viewlets/path_bar.pt\n@@ -1,11 +1,25 @@\n \n-<nav id="portal-breadcrumbs" i18n:attributes="label_breadcrumb" aria-label="breadcrumb" i18n:domain="plone" tal:define="breadcrumbs python:view.breadcrumbs">\n+<nav id="portal-breadcrumbs"\n+     aria-label="breadcrumb"\n+     tal:define="\n+       breadcrumbs python:view.breadcrumbs;\n+     "\n+     i18n:attributes="label_breadcrumb"\n+     i18n:domain="plone"\n+>\n   <div class="container">\n     <ol class="breadcrumb">\n-      <li class="breadcrumb-item"><a i18n:translate="tabs_home" href="${python:view.navigation_root_url}">Home</a></li>\n+      <li class="breadcrumb-item"><a href="${python:view.navigation_root_url}"\n+           i18n:translate="tabs_home"\n+        >Home</a></li>\n       <tal:loop tal:repeat="crumb breadcrumbs">\n-      <li tal:condition="not: repeat/crumb/end" class="breadcrumb-item" ><a href="${python:crumb[\'absolute_url\']}">${python:crumb[\'Title\']}</a></li>\n-      <li tal:condition="repeat/crumb/end" class="breadcrumb-item active" aria-current="page">${python:crumb[\'Title\']}</li>\n+        <li class="breadcrumb-item"\n+            tal:condition="not: repeat/crumb/end"\n+        ><a href="${python:crumb[\'absolute_url\']}">${python:crumb[\'Title\']}</a></li>\n+        <li class="breadcrumb-item active"\n+            aria-current="page"\n+            tal:condition="repeat/crumb/end"\n+        >${python:crumb[\'Title\']}</li>\n       </tal:loop>\n     </ol>\n   </div>\ndiff --git a/plone/app/layout/viewlets/popup_content_history.pt b/plone/app/layout/viewlets/popup_content_history.pt\nindex 224144f3..6eb4f93f 100644\n--- a/plone/app/layout/viewlets/popup_content_history.pt\n+++ b/plone/app/layout/viewlets/popup_content_history.pt\n@@ -1,15 +1,19 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n     <article id="content">\n-        <h3 i18n:translate="label_history">History</h3>\n+      <h3 i18n:translate="label_history">History</h3>\n \n-        <div id="content-history" tal:content="structure here/@@contenthistory">Content History</div>\n+      <div id="content-history"\n+           tal:content="structure here/@@contenthistory"\n+      >Content History</div>\n     </article>\n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/layout/viewlets/review_history.pt b/plone/app/layout/viewlets/review_history.pt\nindex 382c42c0..9ec4bef6 100644\n--- a/plone/app/layout/viewlets/review_history.pt\n+++ b/plone/app/layout/viewlets/review_history.pt\n@@ -1,14 +1,23 @@\n <div class="reviewHistory"\n      id="review-history"\n+     tal:define="\n+       history view/workflowHistory;\n+     "\n      i18n:domain="plone"\n-     tal:define="history view/workflowHistory;">\n-    <tal:history tal:condition="history">\n-      <dl id="history" class="collapsible inline collapsedOnLoad">\n-        <dt class="collapsibleHeader" i18n:translate="label_history">History</dt>\n-        <dd class="collapsibleContent">\n+>\n+  <tal:history tal:condition="history">\n+    <dl class="collapsible inline collapsedOnLoad"\n+        id="history"\n+    >\n+      <dt class="collapsibleHeader"\n+          i18n:translate="label_history"\n+      >History</dt>\n+      <dd class="collapsibleContent">\n \n-        <table class="listing nosort" summary="Review History"\n-               i18n:attributes="summary summary_review_history;">\n+        <table class="listing nosort"\n+               summary="Review History"\n+               i18n:attributes="summary summary_review_history;"\n+        >\n \n           <tr>\n             <th i18n:translate="listingheader_action">Action</th>\n@@ -18,45 +27,65 @@\n           </tr>\n \n           <metal:block tal:repeat="item history">\n-            <tr tal:define="odd repeat/item/odd;\n-                            rhComments item/comments|nothing;\n-                            state item/review_state|nothing"\n-                tal:attributes="class python:odd and \'even\' or \'odd\'"\n-                tal:condition="item/action">\n-              <td i18n:translate="" tal:content="item/transition_title"\n-                  tal:attributes="class string:state-${state}">\n+            <tr tal:define="\n+                  odd repeat/item/odd;\n+                  rhComments item/comments|nothing;\n+                  state item/review_state|nothing;\n+                "\n+                tal:condition="item/action"\n+                tal:attributes="\n+                  class python:odd and \'even\' or \'odd\';\n+                "\n+            >\n+              <td tal:content="item/transition_title"\n+                  tal:attributes="\n+                    class string:state-${state};\n+                  "\n+                  i18n:translate=""\n+              >\n                 action\n               </td>\n \n-              <td tal:define="actorid python:item.get(\'actorid\');\n-                              actor python:item.get(\'actor\');\n-                              fullname actor/fullname|nothing;\n-                              username actor/username|nothing">\n+              <td tal:define="\n+                    actorid python:item.get(\'actorid\');\n+                    actor python:item.get(\'actor\');\n+                    fullname actor/fullname|nothing;\n+                    username actor/username|nothing;\n+                  ">\n                 <a href="/Members/runyaga"\n                    tal:condition="item/actor_home"\n-                   tal:attributes="href item/actor_home"\n-                   tal:content="python:fullname or username or actorid">\n+                   tal:content="python:fullname or username or actorid"\n+                   tal:attributes="\n+                     href item/actor_home;\n+                   "\n+                >\n                   runyaga\n                 </a>\n                 <span tal:condition="not: item/actor_home"\n                       tal:replace="python:fullname or username or actorid"\n-                />\n+                ></span>\n               </td>\n \n               <td>\n-                <span tal:replace="python:context.toLocalizedTime(item[\'time\'],long_format=True)" />\n+                <span tal:replace="python:context.toLocalizedTime(item[\'time\'],long_format=True)"></span>\n                 <span tal:condition="item/effective_date|nothing">\n-                  (<span i18n:translate="label_publishing_effective" tal:omit-tag="">effective</span>:\n+                  (<span tal:omit-tag=""\n+                        i18n:translate="label_publishing_effective"\n+                  >effective</span>:\n                   <span tal:replace="python: context.toLocalizedTime(item[\'effective_date\'],long_format=True)"></span>)\n                 </span>\n               </td>\n \n               <td>\n                 <span tal:condition="rhComments">\n-                  <span tal:replace="rhComments"> some comments </span>\n+                  <span tal:replace="rhComments">\n+                    some comments\n+                  </span>\n                 </span>\n \n-                <span tal:condition="not: rhComments" i18n:translate="no_comments">\n+                <span tal:condition="not: rhComments"\n+                      i18n:translate="no_comments"\n+                >\n                   No comments.\n                 </span>\n               </td>\n@@ -64,7 +93,7 @@\n           </metal:block>\n         </table>\n \n-        </dd>\n-      </dl>\n-    </tal:history>\n+      </dd>\n+    </dl>\n+  </tal:history>\n </div>\ndiff --git a/plone/app/layout/viewlets/searchbox.pt b/plone/app/layout/viewlets/searchbox.pt\nindex 5edd3ab9..0f1de644 100644\n--- a/plone/app/layout/viewlets/searchbox.pt\n+++ b/plone/app/layout/viewlets/searchbox.pt\n@@ -1,41 +1,57 @@\n-<div id="portal-searchbox" class="d-flex flex-column position-relative"\n-  i18n:domain="plone"\n-  tal:define="navigation_root_url view/navigation_root_url;">\n+<div class="d-flex flex-column position-relative"\n+     id="portal-searchbox"\n+     tal:define="\n+       navigation_root_url view/navigation_root_url;\n+     "\n+     i18n:domain="plone"\n+>\n \n-  <form id="searchGadget_form"\n-    action="@@search"\n-    role="search"\n-    class="d-flex ${python: view.livesearch and \'pat-livesearch\'} ${python: view.show_images and \'show_images\'} "\n-    tal:attributes="action string:${navigation_root_url}/@@search;\n-                    data-pat-livesearch string:ajaxUrl:${navigation_root_url}/@@ajax-search;">\n+  <form class="d-flex ${python: view.livesearch and \'pat-livesearch\'} ${python: view.show_images and \'show_images\'}"\n+        id="searchGadget_form"\n+        action="@@search"\n+        role="search"\n+        tal:attributes="\n+          action string:${navigation_root_url}/@@search;\n+          data-pat-livesearch string:ajaxUrl:${navigation_root_url}/@@ajax-search;\n+        "\n+  >\n \n     <label class="hiddenStructure"\n-      for="searchGadget"\n-      i18n:translate="text_search">Search Site</label>\n+           for="searchGadget"\n+           i18n:translate="text_search"\n+    >Search Site</label>\n \n-    <input name="SearchableText"\n-      type="text"\n-      size="18"\n-      value=""\n-      id="searchGadget"\n-      title="Search Site"\n-      placeholder="Search Site"\n-      i18n:attributes="title title_search_site;\n+    <input class="searchField form-control me-2"\n+           id="searchGadget"\n+           name="SearchableText"\n+           placeholder="Search Site"\n+           size="18"\n+           title="Search Site"\n+           type="text"\n+           value=""\n+           tal:attributes="\n+             value request/form/SearchableText|nothing;\n+           "\n+           i18n:attributes="title title_search_site;\n                         placeholder title_search_site"\n-      tal:attributes="value request/form/SearchableText|nothing;"\n-      class="searchField form-control me-2" />\n+    />\n \n     <button class="searchButton btn btn-outline-light"\n-      type="submit"\n-      i18n:translate="label_search">\n+            type="submit"\n+            i18n:translate="label_search"\n+    >\n       Search\n     </button>\n \n-    <div id="portal-advanced-search"\n-          class="hiddenStructure">\n+    <div class="hiddenStructure"\n+         id="portal-advanced-search"\n+    >\n       <a href="#"\n-          tal:attributes="href string:${navigation_root_url}/@@search"\n-          i18n:translate="label_advanced_search">\n+         tal:attributes="\n+           href string:${navigation_root_url}/@@search;\n+         "\n+         i18n:translate="label_advanced_search"\n+      >\n           Advanced Search&hellip;\n       </a>\n     </div>\ndiff --git a/plone/app/layout/viewlets/sections.pt b/plone/app/layout/viewlets/sections.pt\nindex 208045a9..faf9318f 100644\n--- a/plone/app/layout/viewlets/sections.pt\n+++ b/plone/app/layout/viewlets/sections.pt\n@@ -1,14 +1,21 @@\n-<tal:sections xmlns:tal="http://xml.zope.org/namespaces/tal"\n-  xmlns:metal="http://xml.zope.org/namespaces/metal"\n-  xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-  tal:condition="python:view.navtree" i18n:domain="plone">\n+<tal:sections xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+              xmlns:metal="http://xml.zope.org/namespaces/metal"\n+              xmlns:tal="http://xml.zope.org/namespaces/tal"\n+              tal:condition="python:view.navtree"\n+              i18n:domain="plone"\n+>\n \n-  <ul class="navbar-nav" id="portal-globalnav">\n-    <navtree tal:replace="structure python:view.render_globalnav()" />\n+  <ul class="navbar-nav"\n+      id="portal-globalnav"\n+  >\n+    <navtree tal:replace="structure python:view.render_globalnav()"></navtree>\n   </ul>\n \n-  <button class="navbar-toggler" type="button"\n-    aria-label="Toggle navigation" i18n:attributes="aria-label label_toggle_navigation">\n+  <button class="navbar-toggler"\n+          aria-label="Toggle navigation"\n+          type="button"\n+          i18n:attributes="aria-label label_toggle_navigation"\n+  >\n     <span class="navbar-toggler-icon"></span>\n   </button>\n \ndiff --git a/plone/app/layout/viewlets/site_actions.pt b/plone/app/layout/viewlets/site_actions.pt\nindex 5e2daa0f..9170aa54 100644\n--- a/plone/app/layout/viewlets/site_actions.pt\n+++ b/plone/app/layout/viewlets/site_actions.pt\n@@ -1,17 +1,24 @@\n <ul id="portal-siteactions"\n     tal:condition="view/site_actions"\n-    i18n:domain="plone">\n+    i18n:domain="plone"\n+>\n \n-    <li tal:repeat="saction view/site_actions"\n-        tal:attributes="id string:siteaction-${saction/id}"><a\n-           href=""\n-           tal:define="title saction/title;\n-                       id saction/id;"\n-           i18n:attributes="title"\n-           i18n:translate=""\n-           tal:content="title"\n-           tal:attributes="href saction/url;\n-                           target saction/link_target|nothing;\n-                           title title;"\n-           >Site action</a></li>\n+  <li tal:repeat="saction view/site_actions"\n+      tal:attributes="\n+        id string:siteaction-${saction/id};\n+      "\n+  ><a href=""\n+       tal:define="\n+         title saction/title;\n+         id saction/id;\n+       "\n+       tal:content="title"\n+       tal:attributes="\n+         href saction/url;\n+         target saction/link_target|nothing;\n+         title title;\n+       "\n+       i18n:attributes="title"\n+       i18n:translate=""\n+    >Site action</a></li>\n </ul>\ndiff --git a/plone/app/layout/viewlets/social_tags.pt b/plone/app/layout/viewlets/social_tags.pt\nindex 7e6a752e..ce886432 100644\n--- a/plone/app/layout/viewlets/social_tags.pt\n+++ b/plone/app/layout/viewlets/social_tags.pt\n@@ -1 +1,5 @@\n-<meta tal:repeat="tag view/tags" tal:attributes="tag" />\n\\ No newline at end of file\n+<meta tal:repeat="tag view/tags"\n+      tal:attributes="\n+        tag;\n+      "\n+/>\ndiff --git a/plone/app/layout/viewlets/social_tags_body.pt b/plone/app/layout/viewlets/social_tags_body.pt\nindex a461df7a..bacc0a87 100644\n--- a/plone/app/layout/viewlets/social_tags_body.pt\n+++ b/plone/app/layout/viewlets/social_tags_body.pt\n@@ -1,6 +1,12 @@\n-<span id="social-tags-body" style="display: none"\n-      itemscope itemtype="http://schema.org/WebPage">\n+<span id="social-tags-body"\n+      itemscope\n+      itemtype="http://schema.org/WebPage"\n+      style="display: none"\n+>\n   <span tal:repeat="tag view/body_tags"\n-        tal:attributes="itemprop tag/itemprop|nothing"\n-        tal:content="tag/content|nothing" />\n+        tal:content="tag/content|nothing"\n+        tal:attributes="\n+          itemprop tag/itemprop|nothing;\n+        "\n+  ></span>\n </span>\ndiff --git a/plone/app/layout/viewlets/tiny_logo.pt b/plone/app/layout/viewlets/tiny_logo.pt\nindex 4bcdf0f9..0e4653d0 100644\n--- a/plone/app/layout/viewlets/tiny_logo.pt\n+++ b/plone/app/layout/viewlets/tiny_logo.pt\n@@ -1,3 +1,8 @@\n-<a class="plone-toolbar-logo" aria-hidden="true">\n-    <img alt="Plone Toolbar" i18n:attributes="alt label_plone_toolbar_logo" src="++resource++plone-toolbarlogo.svg" />\n+<a class="plone-toolbar-logo"\n+   aria-hidden="true"\n+>\n+  <img alt="Plone Toolbar"\n+       src="++resource++plone-toolbarlogo.svg"\n+       i18n:attributes="alt label_plone_toolbar_logo"\n+  />\n </a>\ndiff --git a/plone/app/layout/viewlets/toc.pt b/plone/app/layout/viewlets/toc.pt\nindex edcd3749..c1bbdb91 100644\n--- a/plone/app/layout/viewlets/toc.pt\n+++ b/plone/app/layout/viewlets/toc.pt\n@@ -1,10 +1,15 @@\n-<section id="document-toc" class="portlet toc"  role="section" style="display: none"\n-    tal:condition="view/enabled"\n-    i18n:domain="plone">\n+<section class="portlet toc"\n+         id="document-toc"\n+         role="section"\n+         style="display: none"\n+         tal:condition="view/enabled"\n+         i18n:domain="plone"\n+>\n   <header class="portletHeader"\n-      i18n:translate="label_tableofcontents">Contents</header>\n+          i18n:translate="label_tableofcontents"\n+  >Contents</header>\n   <section class="portletContent">\n-\t  <div class="portletItem">\n-\t  </div>\n+    <div class="portletItem">\n+    </div>\n   </section>\n </section>\ndiff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex 997a44ff..eb743149 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -1,51 +1,77 @@\n-<section id="edit-bar" role="toolbar"\n-         tal:define="context_state view/context_state;\n-                     icons python:context.restrictedTraverse(\'@@iconresolver\');\n-                     personal_bar python: view.get_personal_bar();\n-                     toolbar_pos view/toolbar_position"\n+<section id="edit-bar"\n+         role="toolbar"\n+         tal:define="\n+           context_state view/context_state;\n+           icons python:context.restrictedTraverse(\'@@iconresolver\');\n+           personal_bar python: view.get_personal_bar();\n+           toolbar_pos view/toolbar_position;\n+         "\n          tal:condition="context_state/is_toolbar_visible"\n-         i18n:domain="plone">\n+         i18n:domain="plone"\n+>\n \n \n-  <div id="edit-zone" role="toolbar"\n-       class="pat-toolbar" data-bs-scroll="true">\n+  <div class="pat-toolbar"\n+       id="edit-zone"\n+       role="toolbar"\n+       data-bs-scroll="true"\n+  >\n \n     <div class="toolbar-header nav">\n-      <a class="toolbar-collapse" aria-label="Unpin" i18n:attributes="aria-label">\n+      <a class="toolbar-collapse"\n+         aria-label="Unpin"\n+         i18n:attributes="aria-label"\n+      >\n         <tal:icon tal:replace="structure python:icons.tag(\'arrow-bar-left\')" />\n       </a>\n-      <a class="toolbar-expand" aria-label="Pin" i18n:attributes="aria-label">\n+      <a class="toolbar-expand"\n+         aria-label="Pin"\n+         i18n:attributes="aria-label"\n+      >\n         <tal:icon tal:replace="structure python:icons.tag(\'arrow-bar-right\')" />\n       </a>\n     </div>\n \n     <ul class="nav flex-column plone-toolbar-main"\n-        tal:define="toolbar_main view/base_render"\n-        tal:condition="toolbar_main">\n+        tal:define="\n+          toolbar_main view/base_render;\n+        "\n+        tal:condition="toolbar_main"\n+    >\n       <li tal:replace="structure toolbar_main">\n       </li>\n     </ul>\n \n-    <div tal:condition="personal_bar/user_actions" class="personaltools-wrapper nav ${python:\'dropend\' if toolbar_pos == \'side\' else \'\'}">\n+    <div class="personaltools-wrapper nav ${python:\'dropend\' if toolbar_pos == \'side\' else \'\'}"\n+         tal:condition="personal_bar/user_actions"\n+    >\n \n-      <a id="personaltools-menulink"\n-         class="nav-link dropdown-toggle"\n-         data-bs-toggle="dropdown"\n-         data-bs-offset="0,0"\n+      <a class="nav-link dropdown-toggle"\n+         id="personaltools-menulink"\n          aria-expanded="false"\n-         tal:attributes="href personal_bar/homelink_url">\n+         data-bs-offset="0,0"\n+         data-bs-toggle="dropdown"\n+         tal:attributes="\n+           href personal_bar/homelink_url;\n+         "\n+      >\n         <tal:icon tal:replace="structure python:icons.tag(\'toolbar-action/personaltools\', tag_class=\'\')" />\n-        <span class="toolbar-label" tal:content="personal_bar/user_name">User</span>\n+        <span class="toolbar-label"\n+              tal:content="personal_bar/user_name"\n+        >User</span>\n       </a>\n \n-      <ul id="collapse-personaltools"\n-          class="dropdown-menu"\n-          aria-labelledby="personaltools-menulink">\n+      <ul class="dropdown-menu"\n+          id="collapse-personaltools"\n+          aria-labelledby="personaltools-menulink"\n+      >\n         <li>\n           <h6 class="dropdown-header">${personal_bar/user_name}</h6>\n         </li>\n         <li tal:repeat="action personal_bar/user_actions">\n-          <a href="${action/href}" class="nav-link dropdown-item">\n+          <a class="nav-link dropdown-item"\n+             href="${action/href}"\n+          >\n             <tal:icon replace="structure python:icons.tag(action.get(\'icon\', \'dot\'), tag_class=\'\')" />\n             <tal:actionname tal:content="action/title">\n               action title\ndiff --git a/plone/app/layout/viewlets/viewport.pt b/plone/app/layout/viewlets/viewport.pt\nindex 38081971..6e4ca18a 100644\n--- a/plone/app/layout/viewlets/viewport.pt\n+++ b/plone/app/layout/viewlets/viewport.pt\n@@ -1 +1,3 @@\n-<meta name="viewport" content="width=device-width, initial-scale=1.0">\n\\ No newline at end of file\n+<meta name="viewport"\n+      content="width=device-width, initial-scale=1.0"\n+/>\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-07T17:14:30+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/b5f22dcbeadf6ba8d4d8b8453b1c7005770b52a7

feat: flake8

Files changed:
M plone/app/layout/testing.py

b'diff --git a/plone/app/layout/testing.py b/plone/app/layout/testing.py\nindex e3af3a81..5cafc61f 100644\n--- a/plone/app/layout/testing.py\n+++ b/plone/app/layout/testing.py\n@@ -3,7 +3,6 @@\n from plone.app.testing import IntegrationTesting\n from plone.app.testing import PloneSandboxLayer\n from plone.app.testing import TEST_USER_ID\n-from plone.app.testing import TEST_USER_PASSWORD\n from plone.base.utils import unrestricted_construct_instance\n \n \n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-07T17:21:32+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/f3eaeb5e329bb556b58c24fa31691a24eab5746c

feat: codespell

Files changed:
M CHANGES.rst
M plone/app/layout/globals/interface.py
M plone/app/layout/globals/interfaces.py
M plone/app/layout/globals/tests/test_layout.py
M plone/app/layout/navigation/navtree.py
M plone/app/layout/sitemap/tests/test_sitemap.py
M plone/app/layout/viewlets/common.py
M plone/app/layout/viewlets/tests/history.txt

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex da80972c..e4b32ee5 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -392,7 +392,7 @@ Bug fixes:\n \n \n - Analytics viewlet: make webstats_js a property, so that it does not rely on an a call to the update method to be correctly evaluated [ale-rt] (#227)\n-- Code formating according to Plone standards (black, isort).\n+- Code formatting according to Plone standards (black, isort).\n   [thet] (#230)\n - Remove selectedTabs and update method from GlobalSectionsViewlet as both are now unused.\n   [thet] (#231)\n@@ -427,7 +427,7 @@ Bug fixes:\n New features:\n \n \n-- Add a sorrounding div to the webstats js. Fixes #157\n+- Add a surrounding div to the webstats js. Fixes #157\n   [erral] (#157)\n \n \n@@ -576,7 +576,7 @@ New features:\n - Allow addition of extra body classes via multiple IBodyClassAdapter adapter registrations without the need to overload the ILayoutPolicy view.\n   [thet, jensens, agitator]\n \n-- Make it easier to override seperator in title viewlet\n+- Make it easier to override separator in title viewlet\n   [tomgross]\n \n Bug fixes:\n@@ -642,7 +642,7 @@ New features:\n \n Bug fixes:\n \n-- show \'in current section only\' before seach input field for a11y reasons. https://github.com/plone/Products.CMFPlone/issues/1619 [polyester]\n+- show \'in current section only\' before search input field for a11y reasons. https://github.com/plone/Products.CMFPlone/issues/1619 [polyester]\n \n \n 2.7.1 (2017-07-03)\n@@ -751,7 +751,7 @@ Bug fixes:\n \n Bug fixes:\n \n-- Document byline viewlet is now displayed only to anonymous users if permited by the `Allow anyone to view \'about\' information` option in the `Security Settings` of `Site Setup` (closes `CMFPlone#1556`_).\n+- Document byline viewlet is now displayed only to anonymous users if permitted by the `Allow anyone to view \'about\' information` option in the `Security Settings` of `Site Setup` (closes `CMFPlone#1556`_).\n   Code used to show the lock status and history view was removed from the document byline as this information was not available to anonymous users anyway.\n   [hvelarde]\n \n@@ -968,7 +968,7 @@ Fixes:\n - by default, show site logo in social settings\n   [vangheem]\n \n-- Add aria hidden role to avoid screenreaders to nonesense stop by at the\n+- Add aria hidden role to avoid screenreaders to nonsense stop by at the\n   toolbar tiny logo [sneridagh]\n \n - Get rid completely of the plone.skip_links viewlet because it already doesn\'t\n@@ -1299,7 +1299,7 @@ Fixes:\n - handle missing feed type so it doesn\'t throw an error\n   [vangheem]\n \n-- handle absense of ACTUAL_URL on request.\n+- handle absence of ACTUAL_URL on request.\n   Fixes https://dev.plone.org/ticket/13173\n   [vangheem]\n \n@@ -1363,7 +1363,7 @@ Fixes:\n   see https://dev.plone.org/ticket/12904\n   [polyester]\n \n-- Add language atribute to presentation.pt for WCAG 2.0 compliance.\n+- Add language attribute to presentation.pt for WCAG 2.0 compliance.\n   See https://dev.plone.org/ticket/12902\n   [rmatt, polyester]\n \n@@ -1376,7 +1376,7 @@ Fixes:\n \n - Correctly hand action URLs not ending / [phrearch]\n \n-- Removed obsolete \'define-macro\' and \'define-slot\' from viewlet page tempates.\n+- Removed obsolete \'define-macro\' and \'define-slot\' from viewlet page templates.\n   Fixes http://dev.plone.org/ticket/11541.\n   [kleist]\n \n@@ -1395,7 +1395,7 @@ Fixes:\n   see https://dev.plone.org/ticket/12904\n   [polyester]\n \n-- Add language atribute to presentation.pt for WCAG 2.0 compliance.\n+- Add language attribute to presentation.pt for WCAG 2.0 compliance.\n   See https://dev.plone.org/ticket/12902\n   [rmatt, polyester]\n \n@@ -1435,7 +1435,7 @@ Fixes:\n 2.2.4 (2011-12-03)\n ------------------\n \n-- Add the ability for the navtree strategy to suppliment the query.\n+- Add the ability for the navtree strategy to supplement the query.\n   Fixes a problem where the listing of default pages in navigation\n   trees could no longer be enabled.\n   [rossp]\ndiff --git a/plone/app/layout/globals/interface.py b/plone/app/layout/globals/interface.py\nindex ccd5ce92..05a15e15 100644\n--- a/plone/app/layout/globals/interface.py\n+++ b/plone/app/layout/globals/interface.py\n@@ -65,8 +65,8 @@ def names_and_descriptions(self, dotted_name, all=0):\n         """Returns a list of pairs (name, description) for a given\n         interface"""\n         iface = resolveInterface(dotted_name)\n-        nd = iface.namesAndDescriptions(all=all)\n-        return [(n, d.getDoc()) for n, d in nd]\n+        data = iface.namesAndDescriptions(all=all)\n+        return [(name, desc.getDoc()) for name, desc in data]\n \n     @memoize\n     def get_interfaces(self):\n@@ -86,7 +86,7 @@ def get_base_interface(self):\n         return [biface for biface in bases if biface not in ifaces]\n \n     def get_interface_informations(self, iface):\n-        """Gets all useful informations from an iface\n+        """Gets all useful information from an iface\n \n         * name\n         * dotted name\ndiff --git a/plone/app/layout/globals/interfaces.py b/plone/app/layout/globals/interfaces.py\nindex db5fdeae..1e9f1ae9 100644\n--- a/plone/app/layout/globals/interfaces.py\n+++ b/plone/app/layout/globals/interfaces.py\n@@ -29,7 +29,7 @@ def get_base_interface():\n         """\n \n     def get_interface_informations(self, iface):\n-        """Gets all useful informations from an iface\n+        """Gets all useful information from an iface\n \n         * name\n         * dotted name\n@@ -170,7 +170,7 @@ def view_template_id():\n         """The id of the view template of the context"""\n \n     def is_view_template():\n-        """Return True if the currentl URL (in the request) refers to the\n+        """Return True if the current URL (in the request) refers to the\n         standard "view" of the context (i.e. the "view" tab).\n         """\n \n@@ -208,7 +208,7 @@ def is_locked():\n         """Whether or not the current object is locked"""\n \n     def is_toolbar_visible():\n-        """Wether toolbar is visible or not in the actual context"""\n+        """Whether toolbar is visible or not in the actual context"""\n \n     def actions(category):\n         """The filtered actions in the context. You can restrict the actions\ndiff --git a/plone/app/layout/globals/tests/test_layout.py b/plone/app/layout/globals/tests/test_layout.py\nindex aba2b8d0..a8c0f4c3 100644\n--- a/plone/app/layout/globals/tests/test_layout.py\n+++ b/plone/app/layout/globals/tests/test_layout.py\n@@ -44,7 +44,7 @@ def testDisableColumns(self):\n         self.app = self.layer["app"]\n         # Now add some portlets to be sure we have columns.  For\n         # simplicity we want a portlet that has no add form.  Note\n-        # that apparently the Calender had no add form until Plone\n+        # that apparently the Calendar had no add form until Plone\n         # 4.3, but since 4.4 it does, so it is not fit to use here.\n         portlet = getUtility(IPortletType, name="portlets.Login")\n         mapping_left = self.portal.restrictedTraverse(\n@@ -110,7 +110,7 @@ def testBodyClassTemplate(self):\n         body_class = layout_view.bodyClass(template, None)\n         self.assertIn("template-document_view", body_class)\n \n-        # case 3: if theres no template get name from view\n+        # case 3: if there\'s no template get name from view\n         body_class = layout_view.bodyClass(None, view)\n         self.assertIn("template-view", body_class)\n \ndiff --git a/plone/app/layout/navigation/navtree.py b/plone/app/layout/navigation/navtree.py\nindex ab47564a..092fde8a 100644\n--- a/plone/app/layout/navigation/navtree.py\n+++ b/plone/app/layout/navigation/navtree.py\n@@ -176,7 +176,7 @@ def buildFolderTree(context, obj=None, query={}, strategy=NavtreeStrategyBase())\n         if rootObject is not None:\n             pruneRoot = not strategy.showChildrenOf(rootObject)\n \n-    # Allow the strategy to suppliment the query for keys not already\n+    # Allow the strategy to supplement the query for keys not already\n     # present in the query such as sorting and omitting default pages\n     for key, value in strategy.supplimentQuery.items():\n         if key not in query:\ndiff --git a/plone/app/layout/sitemap/tests/test_sitemap.py b/plone/app/layout/sitemap/tests/test_sitemap.py\nindex a5d90301..88ae53a0 100644\n--- a/plone/app/layout/sitemap/tests/test_sitemap.py\n+++ b/plone/app/layout/sitemap/tests/test_sitemap.py\n@@ -36,7 +36,7 @@ def setUp(self):\n         )\n         self.wftool = getToolByName(self.portal, "portal_workflow")\n \n-        # we need to explizitly set a workflow cause we can\'t rely on the\n+        # we need to explicitly set a workflow cause we can\'t rely on the\n         # test environment.\n         # `instance test -m plone.app.layout`:\n         # wftool._default_chain == \'simple_publication_workflow\'\n@@ -71,9 +71,9 @@ def setUp(self):\n \n     def uncompress(self, sitemapdata):\n         sio = BytesIO(sitemapdata)\n-        unziped = GzipFile(fileobj=sio)\n-        xml = unziped.read()\n-        unziped.close()\n+        unzipped = GzipFile(fileobj=sio)\n+        xml = unzipped.read()\n+        unzipped.close()\n         return safe_text(xml)\n \n     def test_disabled(self):\ndiff --git a/plone/app/layout/viewlets/common.py b/plone/app/layout/viewlets/common.py\nindex ea96b11b..61a62774 100644\n--- a/plone/app/layout/viewlets/common.py\n+++ b/plone/app/layout/viewlets/common.py\n@@ -84,7 +84,7 @@ def __eq__(self, other):\n class TitleViewlet(ViewletBase):\n     index = ViewPageTemplateFile("title.pt")\n \n-    # seperator of page- and portal-title\n+    # separator of page- and portal-title\n     sep = " &mdash; "\n \n     @property\ndiff --git a/plone/app/layout/viewlets/tests/history.txt b/plone/app/layout/viewlets/tests/history.txt\nindex 3eb91899..fc5e1cc9 100644\n--- a/plone/app/layout/viewlets/tests/history.txt\n+++ b/plone/app/layout/viewlets/tests/history.txt\n@@ -62,7 +62,7 @@ The history viewlet gracefully handles initial default workflow state.\n     <...<span class="historyAction state-private">Create</span>...\n \n \n-The history viewlet handles revert actions sucessfully. Let\'s make a revision.\n+The history viewlet handles revert actions successfully. Let\'s make a revision.\n \n     >>> browser.open(urldoc2)\n     >>> browser.follow(\'Edit\')\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-07T18:21:12+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/33a17149815a27139604ec284390ecc5801fb401

fix: adjust tests for zpretty

Files changed:
M plone/app/layout/sitemap/tests/test_sitemap.py

b'diff --git a/plone/app/layout/sitemap/tests/test_sitemap.py b/plone/app/layout/sitemap/tests/test_sitemap.py\nindex 88ae53a0..0c8e868d 100644\n--- a/plone/app/layout/sitemap/tests/test_sitemap.py\n+++ b/plone/app/layout/sitemap/tests/test_sitemap.py\n@@ -266,6 +266,6 @@ def test_default_pages(self):\n         xml = self.uncompress(self.sitemap())\n         self.assertFalse("<loc>http://nohost/plone/folder/default</loc>" in xml)\n         self.assertTrue("<loc>http://nohost/plone/folder</loc>" in xml)\n-        self.assertTrue("<lastmod>2001-01-01T" in xml)\n+        self.assertTrue("<lastmod >2001-01-01T" in xml)\n         self.assertTrue("<loc>http://nohost/plone</loc>" in xml)\n         self.assertFalse("<loc>http://nohost/plone/published</loc>" in xml)\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-07T18:22:09+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/1f5c1f08c0dd119a46030b52a45dc4f903b952f0

feat: configure z3c.dependencychecker

Files changed:
M pyproject.toml

b"diff --git a/pyproject.toml b/pyproject.toml\nindex 9eb73f3c..eb8e6e8b 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,3 +60,4 @@ Zope = [\n   'Products.CMFDynamicViewFTI', 'zope.deprecation',\n ]\n python-dateutil = ['dateutil']\n+ignore-packages = ['plone.app.relationfield',]\n"

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-07T19:54:11+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/f91e7e8141faded9511c33e98c5cef7f93004cc5

feat: drop a few CMFPlone imports

Files changed:
M plone/app/layout/globals/portal.py
M plone/app/layout/viewlets/content.py

b'diff --git a/plone/app/layout/globals/portal.py b/plone/app/layout/globals/portal.py\nindex b90d02e1..33a9854f 100644\n--- a/plone/app/layout/globals/portal.py\n+++ b/plone/app/layout/globals/portal.py\n@@ -2,6 +2,7 @@\n from Acquisition import aq_inner\n from plone.app.layout.navigation.root import getNavigationRoot\n from plone.app.layout.navigation.root import getNavigationRootObject\n+from plone.base.interfaces import IPloneSiteRoot\n from plone.base.interfaces import ISearchSchema\n from plone.base.interfaces import ISiteSchema\n from plone.i18n.interfaces import ILanguageSchema\n@@ -10,7 +11,6 @@\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.interfaces import ISiteRoot\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import IPloneSiteRoot\n from Products.Five.browser import BrowserView\n from zope.component import getUtility\n from zope.component import providedBy\ndiff --git a/plone/app/layout/viewlets/content.py b/plone/app/layout/viewlets/content.py\nindex 456cca3a..c0b64e20 100644\n--- a/plone/app/layout/viewlets/content.py\n+++ b/plone/app/layout/viewlets/content.py\n@@ -11,6 +11,7 @@\n from plone.base.interfaces import ISecuritySchema\n from plone.base.interfaces import ISiteSchema\n from plone.base.utils import base_hasattr\n+from plone.base.utils import logger\n from plone.memoize.instance import memoize\n from plone.memoize.view import memoize_contextless\n from plone.protect.authenticator import createToken\n@@ -19,7 +20,6 @@\n from Products.CMFCore.utils import getToolByName\n from Products.CMFCore.WorkflowCore import WorkflowException\n from Products.CMFEditions.Permissions import AccessPreviousVersions\n-from Products.CMFPlone.utils import log\n from Products.Five.browser import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from urllib.parse import urlencode\n@@ -28,7 +28,6 @@\n from zope.component import queryMultiAdapter\n from zope.deprecation import deprecation\n \n-import logging\n import pkg_resources\n \n \n@@ -438,10 +437,9 @@ def workflowHistory(self, complete=True):\n             review_history.reverse()\n \n         except WorkflowException:\n-            log(\n-                "plone.app.layout.viewlets.content: "\n-                "%s has no associated workflow" % context.absolute_url(),\n-                severity=logging.DEBUG,\n+            logger.debug(\n+                "plone.app.layout.viewlets.content: %s has no associated workflow",\n+                context.absolute_url(),\n             )\n \n         return review_history\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-07T19:54:11+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/8eed423985ee0cb0fefede17f5f07185ea641c4d

feat: declare dependencies

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex 98e42772..662b4338 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -37,35 +37,31 @@\n     zip_safe=False,\n     python_requires=">=3.8",\n     install_requires=[\n-        "Acquisition",\n-        "DateTime",\n+        "BTrees",\n         "plone.app.content",\n+        "plone.app.multilingual",\n+        "plone.app.uuid",\n         "plone.app.viewletmanager >=1.2",\n         "plone.base >=1.0.4",\n-        "plone.batching >=2.0.0",\n+        "plone.dexterity",\n+        "plone.formwidget.namedfile",\n         "plone.i18n",\n         "plone.memoize",\n         "plone.portlets",\n+        "plone.protect",\n         "plone.registry",\n-        "Products.CMFCore",\n-        "Products.CMFDynamicViewFTI",\n         "Products.CMFEditions >=1.2.2",\n+        "Products.ZCatalog",\n+        "Products.statusmessages",\n         "setuptools",\n-        "zope.component",\n-        "zope.deferredimport",\n-        "zope.deprecation",\n+        "zope.browserpage",\n         "zope.dottedname",\n-        "zope.i18n",\n-        "zope.interface",\n-        "zope.publisher",\n-        "zope.schema",\n         "zope.viewlet",\n         "Zope",\n     ],\n     extras_require=dict(\n         test=[\n-            "plone.app.contenttypes",\n-            "plone.app.intid",\n+            "plone.app.contenttypes[test]",\n             "plone.app.relationfield",\n             "plone.app.testing",\n             "plone.dexterity",\n@@ -73,6 +69,7 @@\n             "plone.testing",\n             "z3c.relationfield",\n             "zope.annotation",\n+            "zope.intid",\n         ]\n     ),\n )\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-11T17:24:50+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/0eb9060875a91a04a11ea0148f247f942f28795d

cleanup dependencies again, now using plone/meta#79

(cherry picked from commit b19212dc6762f12d5b3265e96573dc5d30885795)

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex 662b4338..12e16806 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -40,6 +40,7 @@\n         "BTrees",\n         "plone.app.content",\n         "plone.app.multilingual",\n+        "plone.app.relationfield",\n         "plone.app.uuid",\n         "plone.app.viewletmanager >=1.2",\n         "plone.base >=1.0.4",\n@@ -49,14 +50,10 @@\n         "plone.memoize",\n         "plone.portlets",\n         "plone.protect",\n-        "plone.registry",\n         "Products.CMFEditions >=1.2.2",\n-        "Products.ZCatalog",\n         "Products.statusmessages",\n+        "Products.ZCatalog",\n         "setuptools",\n-        "zope.browserpage",\n-        "zope.dottedname",\n-        "zope.viewlet",\n         "Zope",\n     ],\n     extras_require=dict(\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-11T17:32:54+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/4485a96e213f62e5d003272844ea9cae417e26d4

Merge pull request #334 from plone/config-with-default-template-6139b94b

Config with default template

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/11f0db91.internal
A tox.ini
M CHANGES.rst
M plone/app/layout/analytics/configure.zcml
M plone/app/layout/analytics/view.pt
M plone/app/layout/analytics/view.py
M plone/app/layout/configure.zcml
M plone/app/layout/favicon_handler.py
M plone/app/layout/globals/configure.zcml
M plone/app/layout/globals/context.py
M plone/app/layout/globals/interface.py
M plone/app/layout/globals/interfaces.py
M plone/app/layout/globals/layout.py
M plone/app/layout/globals/portal.py
M plone/app/layout/globals/tests/data/bodyclass_nametest.pt
M plone/app/layout/globals/tests/test_context.py
M plone/app/layout/globals/tests/test_layout.py
M plone/app/layout/globals/tests/test_portal.py
M plone/app/layout/icons/configure.zcml
M plone/app/layout/icons/icons.py
M plone/app/layout/links/author.pt
M plone/app/layout/links/configure.zcml
M plone/app/layout/links/favicon.pt
M plone/app/layout/links/rsslink.pt
M plone/app/layout/links/search.pt
M plone/app/layout/links/tests/test_canonical_url.py
M plone/app/layout/links/tests/test_favicon_viewlet.py
M plone/app/layout/links/viewlets.py
M plone/app/layout/navigation/configure.zcml
M plone/app/layout/navigation/navtree.py
M plone/app/layout/navigation/tests/test_root.py
M plone/app/layout/nextprevious/configure.zcml
M plone/app/layout/nextprevious/links.pt
M plone/app/layout/nextprevious/nextprevious.pt
M plone/app/layout/permissions.zcml
M plone/app/layout/sitemap/configure.zcml
M plone/app/layout/sitemap/sitemap.py
M plone/app/layout/sitemap/sitemap.xml
M plone/app/layout/sitemap/tests/test_sitemap.py
M plone/app/layout/testing.py
M plone/app/layout/viewlets/anontools.pt
M plone/app/layout/viewlets/colophon.pt
M plone/app/layout/viewlets/common.py
M plone/app/layout/viewlets/configure.zcml
M plone/app/layout/viewlets/content.py
M plone/app/layout/viewlets/content_history.pt
M plone/app/layout/viewlets/contentviews.pt
M plone/app/layout/viewlets/document_actions.pt
M plone/app/layout/viewlets/document_byline.pt
M plone/app/layout/viewlets/document_relateditems.pt
M plone/app/layout/viewlets/document_rights.pt
M plone/app/layout/viewlets/dublin_core.pt
M plone/app/layout/viewlets/globalstatusmessage.pt
M plone/app/layout/viewlets/history_view.pt
M plone/app/layout/viewlets/keywords.pt
M plone/app/layout/viewlets/logo.pt
M plone/app/layout/viewlets/membertools.pt
M plone/app/layout/viewlets/menu.pt
M plone/app/layout/viewlets/path_bar.pt
M plone/app/layout/viewlets/popup_content_history.pt
M plone/app/layout/viewlets/review_history.pt
M plone/app/layout/viewlets/searchbox.pt
M plone/app/layout/viewlets/sections.pt
M plone/app/layout/viewlets/site_actions.pt
M plone/app/layout/viewlets/social.py
M plone/app/layout/viewlets/social_tags.pt
M plone/app/layout/viewlets/social_tags_body.pt
M plone/app/layout/viewlets/tests/base.py
M plone/app/layout/viewlets/tests/history.txt
M plone/app/layout/viewlets/tests/test_common.py
M plone/app/layout/viewlets/tests/test_content.py
M plone/app/layout/viewlets/tests/test_social.py
M plone/app/layout/viewlets/tiny_logo.pt
M plone/app/layout/viewlets/toc.pt
M plone/app/layout/viewlets/toolbar.pt
M plone/app/layout/viewlets/toolbar.py
M plone/app/layout/viewlets/viewport.pt
M pyproject.toml
M setup.cfg
M setup.py

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 00000000..b4158b89\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 00000000..b6641708\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "11f0db91"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 00000000..fdafec1c\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.3.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.4\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/CHANGES.rst b/CHANGES.rst\nindex da80972c..e4b32ee5 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -392,7 +392,7 @@ Bug fixes:\n \n \n - Analytics viewlet: make webstats_js a property, so that it does not rely on an a call to the update method to be correctly evaluated [ale-rt] (#227)\n-- Code formating according to Plone standards (black, isort).\n+- Code formatting according to Plone standards (black, isort).\n   [thet] (#230)\n - Remove selectedTabs and update method from GlobalSectionsViewlet as both are now unused.\n   [thet] (#231)\n@@ -427,7 +427,7 @@ Bug fixes:\n New features:\n \n \n-- Add a sorrounding div to the webstats js. Fixes #157\n+- Add a surrounding div to the webstats js. Fixes #157\n   [erral] (#157)\n \n \n@@ -576,7 +576,7 @@ New features:\n - Allow addition of extra body classes via multiple IBodyClassAdapter adapter registrations without the need to overload the ILayoutPolicy view.\n   [thet, jensens, agitator]\n \n-- Make it easier to override seperator in title viewlet\n+- Make it easier to override separator in title viewlet\n   [tomgross]\n \n Bug fixes:\n@@ -642,7 +642,7 @@ New features:\n \n Bug fixes:\n \n-- show \'in current section only\' before seach input field for a11y reasons. https://github.com/plone/Products.CMFPlone/issues/1619 [polyester]\n+- show \'in current section only\' before search input field for a11y reasons. https://github.com/plone/Products.CMFPlone/issues/1619 [polyester]\n \n \n 2.7.1 (2017-07-03)\n@@ -751,7 +751,7 @@ Bug fixes:\n \n Bug fixes:\n \n-- Document byline viewlet is now displayed only to anonymous users if permited by the `Allow anyone to view \'about\' information` option in the `Security Settings` of `Site Setup` (closes `CMFPlone#1556`_).\n+- Document byline viewlet is now displayed only to anonymous users if permitted by the `Allow anyone to view \'about\' information` option in the `Security Settings` of `Site Setup` (closes `CMFPlone#1556`_).\n   Code used to show the lock status and history view was removed from the document byline as this information was not available to anonymous users anyway.\n   [hvelarde]\n \n@@ -968,7 +968,7 @@ Fixes:\n - by default, show site logo in social settings\n   [vangheem]\n \n-- Add aria hidden role to avoid screenreaders to nonesense stop by at the\n+- Add aria hidden role to avoid screenreaders to nonsense stop by at the\n   toolbar tiny logo [sneridagh]\n \n - Get rid completely of the plone.skip_links viewlet because it already doesn\'t\n@@ -1299,7 +1299,7 @@ Fixes:\n - handle missing feed type so it doesn\'t throw an error\n   [vangheem]\n \n-- handle absense of ACTUAL_URL on request.\n+- handle absence of ACTUAL_URL on request.\n   Fixes https://dev.plone.org/ticket/13173\n   [vangheem]\n \n@@ -1363,7 +1363,7 @@ Fixes:\n   see https://dev.plone.org/ticket/12904\n   [polyester]\n \n-- Add language atribute to presentation.pt for WCAG 2.0 compliance.\n+- Add language attribute to presentation.pt for WCAG 2.0 compliance.\n   See https://dev.plone.org/ticket/12902\n   [rmatt, polyester]\n \n@@ -1376,7 +1376,7 @@ Fixes:\n \n - Correctly hand action URLs not ending / [phrearch]\n \n-- Removed obsolete \'define-macro\' and \'define-slot\' from viewlet page tempates.\n+- Removed obsolete \'define-macro\' and \'define-slot\' from viewlet page templates.\n   Fixes http://dev.plone.org/ticket/11541.\n   [kleist]\n \n@@ -1395,7 +1395,7 @@ Fixes:\n   see https://dev.plone.org/ticket/12904\n   [polyester]\n \n-- Add language atribute to presentation.pt for WCAG 2.0 compliance.\n+- Add language attribute to presentation.pt for WCAG 2.0 compliance.\n   See https://dev.plone.org/ticket/12902\n   [rmatt, polyester]\n \n@@ -1435,7 +1435,7 @@ Fixes:\n 2.2.4 (2011-12-03)\n ------------------\n \n-- Add the ability for the navtree strategy to suppliment the query.\n+- Add the ability for the navtree strategy to supplement the query.\n   Fixes a problem where the listing of default pages in navigation\n   trees could no longer be enabled.\n   [rossp]\ndiff --git a/news/11f0db91.internal b/news/11f0db91.internal\nnew file mode 100644\nindex 00000000..c08f5399\n--- /dev/null\n+++ b/news/11f0db91.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/plone/app/layout/analytics/configure.zcml b/plone/app/layout/analytics/configure.zcml\nindex 2e5c14a6..dc599351 100644\n--- a/plone/app/layout/analytics/configure.zcml\n+++ b/plone/app/layout/analytics/configure.zcml\n@@ -1,12 +1,13 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <browser:viewlet\n-        name="plone.analytics"\n-        manager="plone.app.layout.viewlets.interfaces.IPortalFooter"\n-        class=".view.AnalyticsViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.analytics"\n+      manager="plone.app.layout.viewlets.interfaces.IPortalFooter"\n+      class=".view.AnalyticsViewlet"\n+      permission="zope2.View"\n+      />\n \n </configure>\ndiff --git a/plone/app/layout/analytics/view.pt b/plone/app/layout/analytics/view.pt\nindex 7d3f83c7..2ac8e4f7 100644\n--- a/plone/app/layout/analytics/view.pt\n+++ b/plone/app/layout/analytics/view.pt\n@@ -1,5 +1,7 @@\n <div id="plone-analytics"\n-     tal:define="webstats_js view/webstats_js"\n+     tal:define="\n+       webstats_js view/webstats_js;\n+     "\n      tal:condition="webstats_js"\n      tal:content="structure webstats_js"\n >\ndiff --git a/plone/app/layout/analytics/view.py b/plone/app/layout/analytics/view.py\nindex 5de1a4a4..c277714d 100644\n--- a/plone/app/layout/analytics/view.py\n+++ b/plone/app/layout/analytics/view.py\n@@ -1,5 +1,5 @@\n-from plone.registry.interfaces import IRegistry\n from plone.base.interfaces import ISiteSchema\n+from plone.registry.interfaces import IRegistry\n from Products.Five.browser import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getUtility\n@@ -9,7 +9,6 @@\n \n @implementer(IViewlet)\n class AnalyticsViewlet(BrowserView):\n-\n     render = ViewPageTemplateFile("view.pt")\n \n     def __init__(self, context, request, view, manager):\ndiff --git a/plone/app/layout/configure.zcml b/plone/app/layout/configure.zcml\nindex 5b267460..beebf645 100644\n--- a/plone/app/layout/configure.zcml\n+++ b/plone/app/layout/configure.zcml\n@@ -1,21 +1,20 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n-    <include package=".globals" />\n-    <include package=".navigation" />\n-    <include package=".viewlets" />\n-    <include package=".nextprevious" />\n-    <include package=".icons" />\n-    <include package=".links" />\n-    <include package=".sitemap" />\n-    <include package=".analytics" />\n+  <include package=".globals" />\n+  <include package=".navigation" />\n+  <include package=".viewlets" />\n+  <include package=".nextprevious" />\n+  <include package=".icons" />\n+  <include package=".links" />\n+  <include package=".sitemap" />\n+  <include package=".analytics" />\n \n-    <include file="permissions.zcml" />\n+  <include file="permissions.zcml" />\n \n-    <subscriber\n-        handler=".favicon_handler.updateMimetype"\n-    />\n+  <subscriber handler=".favicon_handler.updateMimetype" />\n \n </configure>\ndiff --git a/plone/app/layout/favicon_handler.py b/plone/app/layout/favicon_handler.py\nindex 439dec25..2185a417 100644\n--- a/plone/app/layout/favicon_handler.py\n+++ b/plone/app/layout/favicon_handler.py\n@@ -1,7 +1,7 @@\n+from plone.base.interfaces import ISiteSchema\n from plone.formwidget.namedfile.converter import b64decode_file\n from plone.registry.interfaces import IRecordModifiedEvent\n from plone.registry.recordsproxy import RecordsProxy\n-from plone.base.interfaces import ISiteSchema\n from zope.component import adapter\n \n import mimetypes\n@@ -9,7 +9,6 @@\n \n @adapter(ISiteSchema, IRecordModifiedEvent)\n def updateMimetype(settings: RecordsProxy, event: IRecordModifiedEvent = None):\n-\n     if event.record.fieldName != "site_favicon" or not event.record.value:\n         return\n \ndiff --git a/plone/app/layout/globals/configure.zcml b/plone/app/layout/globals/configure.zcml\nindex 1a4db1a3..5582d28e 100644\n--- a/plone/app/layout/globals/configure.zcml\n+++ b/plone/app/layout/globals/configure.zcml\n@@ -1,53 +1,54 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n-\n-    <!-- Views with global constants -->\n-\n-    <browser:page\n-        name="plone_interface_info"\n-        for="*"\n-        permission="zope.Public"\n-        class=".interface.InterfaceInformation"\n-        allowed_interface=".interfaces.IInterfaceInformation"\n-        />\n-\n-    <browser:page\n-        name="plone_layout"\n-        for="*"\n-        permission="zope.Public"\n-        class=".layout.LayoutPolicy"\n-        allowed_interface=".interfaces.ILayoutPolicy"\n-        />\n-\n-    <browser:page\n-        name="plone_tools"\n-        for="*"\n-        permission="zope.Public"\n-        class=".tools.Tools"\n-        allowed_interface=".interfaces.ITools"\n-        />\n-\n-    <browser:page\n-        name="plone_context_state"\n-        for="*"\n-        permission="zope.Public"\n-        class=".context.ContextState"\n-        allowed_interface=".interfaces.IContextState"\n-        />\n-\n-    <browser:page\n-        name="plone_portal_state"\n-        for="*"\n-        permission="zope.Public"\n-        class=".portal.PortalState"\n-        allowed_interface=".interfaces.IPortalState"\n-        />\n-\n-    <!-- We need to make the request annotatable for this to work -->\n-\n-    <class class="ZPublisher.BaseRequest.BaseRequest">\n-        <implements interface="zope.annotation.interfaces.IAttributeAnnotatable" />\n-    </class>\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n+\n+  <!-- Views with global constants -->\n+\n+  <browser:page\n+      name="plone_interface_info"\n+      for="*"\n+      class=".interface.InterfaceInformation"\n+      allowed_interface=".interfaces.IInterfaceInformation"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      name="plone_layout"\n+      for="*"\n+      class=".layout.LayoutPolicy"\n+      allowed_interface=".interfaces.ILayoutPolicy"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      name="plone_tools"\n+      for="*"\n+      class=".tools.Tools"\n+      allowed_interface=".interfaces.ITools"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      name="plone_context_state"\n+      for="*"\n+      class=".context.ContextState"\n+      allowed_interface=".interfaces.IContextState"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      name="plone_portal_state"\n+      for="*"\n+      class=".portal.PortalState"\n+      allowed_interface=".interfaces.IPortalState"\n+      permission="zope.Public"\n+      />\n+\n+  <!-- We need to make the request annotatable for this to work -->\n+\n+  <class class="ZPublisher.BaseRequest.BaseRequest">\n+    <implements interface="zope.annotation.interfaces.IAttributeAnnotatable" />\n+  </class>\n \n </configure>\ndiff --git a/plone/app/layout/globals/context.py b/plone/app/layout/globals/context.py\nindex 146d325d..3a1943d7 100644\n--- a/plone/app/layout/globals/context.py\n+++ b/plone/app/layout/globals/context.py\n@@ -3,6 +3,7 @@\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n from plone.base.interfaces import INavigationRoot\n+from plone.base.interfaces import INonStructuralFolder\n from plone.base.utils import pretty_title_or_id\n from plone.memoize.view import memoize\n from plone.portlets.interfaces import ILocalPortletAssignable\n@@ -11,7 +12,6 @@\n from Products.CMFCore.interfaces import ISiteRoot\n from Products.CMFCore.utils import getToolByName\n from Products.CMFDynamicViewFTI.interfaces import IBrowserDefault\n-from plone.base.interfaces import INonStructuralFolder\n from Products.Five.browser import BrowserView\n from zope.component import getMultiAdapter\n from zope.component import getUtility\ndiff --git a/plone/app/layout/globals/interface.py b/plone/app/layout/globals/interface.py\nindex ccd5ce92..05a15e15 100644\n--- a/plone/app/layout/globals/interface.py\n+++ b/plone/app/layout/globals/interface.py\n@@ -65,8 +65,8 @@ def names_and_descriptions(self, dotted_name, all=0):\n         """Returns a list of pairs (name, description) for a given\n         interface"""\n         iface = resolveInterface(dotted_name)\n-        nd = iface.namesAndDescriptions(all=all)\n-        return [(n, d.getDoc()) for n, d in nd]\n+        data = iface.namesAndDescriptions(all=all)\n+        return [(name, desc.getDoc()) for name, desc in data]\n \n     @memoize\n     def get_interfaces(self):\n@@ -86,7 +86,7 @@ def get_base_interface(self):\n         return [biface for biface in bases if biface not in ifaces]\n \n     def get_interface_informations(self, iface):\n-        """Gets all useful informations from an iface\n+        """Gets all useful information from an iface\n \n         * name\n         * dotted name\ndiff --git a/plone/app/layout/globals/interfaces.py b/plone/app/layout/globals/interfaces.py\nindex db5fdeae..1e9f1ae9 100644\n--- a/plone/app/layout/globals/interfaces.py\n+++ b/plone/app/layout/globals/interfaces.py\n@@ -29,7 +29,7 @@ def get_base_interface():\n         """\n \n     def get_interface_informations(self, iface):\n-        """Gets all useful informations from an iface\n+        """Gets all useful information from an iface\n \n         * name\n         * dotted name\n@@ -170,7 +170,7 @@ def view_template_id():\n         """The id of the view template of the context"""\n \n     def is_view_template():\n-        """Return True if the currentl URL (in the request) refers to the\n+        """Return True if the current URL (in the request) refers to the\n         standard "view" of the context (i.e. the "view" tab).\n         """\n \n@@ -208,7 +208,7 @@ def is_locked():\n         """Whether or not the current object is locked"""\n \n     def is_toolbar_visible():\n-        """Wether toolbar is visible or not in the actual context"""\n+        """Whether toolbar is visible or not in the actual context"""\n \n     def actions(category):\n         """The filtered actions in the context. You can restrict the actions\ndiff --git a/plone/app/layout/globals/layout.py b/plone/app/layout/globals/layout.py\nindex ee8e21e7..a122b5ca 100644\n--- a/plone/app/layout/globals/layout.py\n+++ b/plone/app/layout/globals/layout.py\n@@ -2,14 +2,14 @@\n from plone.app.layout.globals.interfaces import IBodyClassAdapter\n from plone.app.layout.globals.interfaces import ILayoutPolicy\n from plone.app.layout.globals.interfaces import IViewView\n+from plone.base.interfaces.controlpanel import ILinkSchema\n+from plone.base.interfaces.controlpanel import ISiteSchema\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.memoize.view import memoize\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletManagerRenderer\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces.controlpanel import ILinkSchema\n-from plone.base.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.metaconfigure import ViewMixinForTemplates\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.browserpage.viewpagetemplatefile import (\ndiff --git a/plone/app/layout/globals/portal.py b/plone/app/layout/globals/portal.py\nindex ce4f02e6..33a9854f 100644\n--- a/plone/app/layout/globals/portal.py\n+++ b/plone/app/layout/globals/portal.py\n@@ -2,15 +2,15 @@\n from Acquisition import aq_inner\n from plone.app.layout.navigation.root import getNavigationRoot\n from plone.app.layout.navigation.root import getNavigationRootObject\n+from plone.base.interfaces import IPloneSiteRoot\n+from plone.base.interfaces import ISearchSchema\n+from plone.base.interfaces import ISiteSchema\n from plone.i18n.interfaces import ILanguageSchema\n from plone.memoize.view import memoize\n from plone.memoize.view import memoize_contextless\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.interfaces import ISiteRoot\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import IPloneSiteRoot\n-from plone.base.interfaces import ISearchSchema\n-from plone.base.interfaces import ISiteSchema\n from Products.Five.browser import BrowserView\n from zope.component import getUtility\n from zope.component import providedBy\ndiff --git a/plone/app/layout/globals/tests/data/bodyclass_nametest.pt b/plone/app/layout/globals/tests/data/bodyclass_nametest.pt\nindex f11b6135..f0ab6775 100644\n--- a/plone/app/layout/globals/tests/data/bodyclass_nametest.pt\n+++ b/plone/app/layout/globals/tests/data/bodyclass_nametest.pt\n@@ -1 +1 @@\n-<html><body>foo</body></html>\n\\ No newline at end of file\n+<html><body>foo</body></html>\ndiff --git a/plone/app/layout/globals/tests/test_context.py b/plone/app/layout/globals/tests/test_context.py\nindex 7bf39b30..7afc2d62 100644\n--- a/plone/app/layout/globals/tests/test_context.py\n+++ b/plone/app/layout/globals/tests/test_context.py\n@@ -1,12 +1,12 @@\n-from plone.base.interfaces import INavigationRoot\n from plone.app.layout.testing import INTEGRATION_TESTING\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing.helpers import logout\n-from plone.locking.interfaces import ILockable\n-from Products.CMFDynamicViewFTI.interfaces import IBrowserDefault\n+from plone.base.interfaces import INavigationRoot\n from plone.base.interfaces import INonStructuralFolder\n from plone.base.utils import unrestricted_construct_instance\n+from plone.locking.interfaces import ILockable\n+from Products.CMFDynamicViewFTI.interfaces import IBrowserDefault\n from zope.interface import alsoProvides\n from zope.interface import directlyProvides\n \ndiff --git a/plone/app/layout/globals/tests/test_layout.py b/plone/app/layout/globals/tests/test_layout.py\nindex 5178fbf5..a8c0f4c3 100644\n--- a/plone/app/layout/globals/tests/test_layout.py\n+++ b/plone/app/layout/globals/tests/test_layout.py\n@@ -1,11 +1,11 @@\n-from plone.base.interfaces import INavigationRoot\n from plone.app.layout.testing import INTEGRATION_TESTING\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing.helpers import logout\n+from plone.base.interfaces import INavigationRoot\n+from plone.base.interfaces.controlpanel import ILinkSchema\n from plone.portlets.interfaces import IPortletType\n from plone.registry.interfaces import IRegistry\n-from plone.base.interfaces.controlpanel import ILinkSchema\n from zope.component import getUtility\n \n import os\n@@ -44,7 +44,7 @@ def testDisableColumns(self):\n         self.app = self.layer["app"]\n         # Now add some portlets to be sure we have columns.  For\n         # simplicity we want a portlet that has no add form.  Note\n-        # that apparently the Calender had no add form until Plone\n+        # that apparently the Calendar had no add form until Plone\n         # 4.3, but since 4.4 it does, so it is not fit to use here.\n         portlet = getUtility(IPortletType, name="portlets.Login")\n         mapping_left = self.portal.restrictedTraverse(\n@@ -110,7 +110,7 @@ def testBodyClassTemplate(self):\n         body_class = layout_view.bodyClass(template, None)\n         self.assertIn("template-document_view", body_class)\n \n-        # case 3: if theres no template get name from view\n+        # case 3: if there\'s no template get name from view\n         body_class = layout_view.bodyClass(None, view)\n         self.assertIn("template-view", body_class)\n \ndiff --git a/plone/app/layout/globals/tests/test_portal.py b/plone/app/layout/globals/tests/test_portal.py\nindex bebb172d..682d139f 100644\n--- a/plone/app/layout/globals/tests/test_portal.py\n+++ b/plone/app/layout/globals/tests/test_portal.py\n@@ -1,13 +1,13 @@\n-from plone.base.interfaces import INavigationRoot\n from plone.app.layout.navigation.root import getNavigationRoot\n from plone.app.layout.testing import INTEGRATION_TESTING\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing.helpers import logout\n-from plone.i18n.interfaces import ILanguageSchema\n-from plone.registry.interfaces import IRegistry\n+from plone.base.interfaces import INavigationRoot\n from plone.base.interfaces import ISearchSchema\n from plone.base.interfaces import ISiteSchema\n+from plone.i18n.interfaces import ILanguageSchema\n+from plone.registry.interfaces import IRegistry\n from zope.component import getUtility\n from zope.event import notify\n from zope.i18n.locales import locales\ndiff --git a/plone/app/layout/icons/configure.zcml b/plone/app/layout/icons/configure.zcml\nindex 1d5f8d69..74954be7 100644\n--- a/plone/app/layout/icons/configure.zcml\n+++ b/plone/app/layout/icons/configure.zcml\n@@ -1,42 +1,56 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:browser="http://namespaces.zope.org/browser"\n-           xmlns:five="http://namespaces.zope.org/five">\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                Products.ZCatalog.CatalogBrains.AbstractCatalogBrain"\n-           factory=".icons.CatalogBrainContentIcon"\n-           provides=".interfaces.IContentIcon" />\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                Products.CMFCore.interfaces.IDynamicType"\n-           factory=".icons.CMFContentIcon"\n-           provides=".interfaces.IContentIcon" />\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                plone.dexterity.interfaces.IDexterityContent"\n-           factory=".icons.DefaultContentIcon"\n-           provides=".interfaces.IContentIcon" />\n-\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                Products.CMFCore.TypesTool.FactoryTypeInformation"\n-           factory=".icons.FTIContentIcon"\n-           provides=".interfaces.IContentIcon" />\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                plone.base.interfaces.IPloneSiteRoot"\n-           factory=".icons.PloneSiteContentIcon"\n-           provides=".interfaces.IContentIcon" />\n-\n-  <adapter for="*\n-                zope.publisher.interfaces.browser.IBrowserRequest\n-                *"\n-           factory=".icons.DefaultContentIcon"\n-           provides=".interfaces.IContentIcon" />\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:five="http://namespaces.zope.org/five"\n+    >\n+\n+  <adapter\n+      factory=".icons.CatalogBrainContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           Products.ZCatalog.CatalogBrains.AbstractCatalogBrain"\n+      />\n+\n+  <adapter\n+      factory=".icons.CMFContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           Products.CMFCore.interfaces.IDynamicType"\n+      />\n+\n+  <adapter\n+      factory=".icons.DefaultContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           plone.dexterity.interfaces.IDexterityContent"\n+      />\n+\n+\n+  <adapter\n+      factory=".icons.FTIContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           Products.CMFCore.TypesTool.FactoryTypeInformation"\n+      />\n+\n+  <adapter\n+      factory=".icons.PloneSiteContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           plone.base.interfaces.IPloneSiteRoot"\n+      />\n+\n+  <adapter\n+      factory=".icons.DefaultContentIcon"\n+      provides=".interfaces.IContentIcon"\n+      for="*\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           *"\n+      />\n \n </configure>\ndiff --git a/plone/app/layout/icons/icons.py b/plone/app/layout/icons/icons.py\nindex cb084b39..dd9a3e82 100644\n--- a/plone/app/layout/icons/icons.py\n+++ b/plone/app/layout/icons/icons.py\n@@ -20,7 +20,6 @@ def __call__(self):\n \n     @memoize\n     def html_tag(self):\n-\n         if not self.url:\n             return None\n \ndiff --git a/plone/app/layout/links/author.pt b/plone/app/layout/links/author.pt\nindex 6f9f9d47..a2f25269 100644\n--- a/plone/app/layout/links/author.pt\n+++ b/plone/app/layout/links/author.pt\n@@ -1,12 +1,18 @@\n <div xmlns="http://www.w3.org/1999/xhtml"\n      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-     tal:define="navigation_root_url view/navigation_root_url"\n+     tal:define="\n+       navigation_root_url view/navigation_root_url;\n+     "\n      tal:omit-tag=""\n-     i18n:domain="plone">\n-    <link rel="author"\n-          href=""\n-          title="Author information"\n-          i18n:attributes="title title_author_info"\n-          tal:attributes="href string:${navigation_root_url}/author/${context/Creator|nothing}" />\n+     i18n:domain="plone"\n+>\n+  <link href=""\n+        rel="author"\n+        title="Author information"\n+        tal:attributes="\n+          href string:${navigation_root_url}/author/${context/Creator|nothing};\n+        "\n+        i18n:attributes="title title_author_info"\n+  />\n </div>\ndiff --git a/plone/app/layout/links/configure.zcml b/plone/app/layout/links/configure.zcml\nindex 028a20b8..b2c0c8c0 100644\n--- a/plone/app/layout/links/configure.zcml\n+++ b/plone/app/layout/links/configure.zcml\n@@ -1,40 +1,42 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:browser="http://namespaces.zope.org/browser"\n-           xmlns:five="http://namespaces.zope.org/five">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:five="http://namespaces.zope.org/five"\n+    >\n \n-    <browser:viewlet\n-        name="plone.links.favicon"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".viewlets.FaviconViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.links.favicon"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".viewlets.FaviconViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.links.search"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".viewlets.SearchViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.links.search"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".viewlets.SearchViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.links.author"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".viewlets.AuthorViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.links.author"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".viewlets.AuthorViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.links.RSS"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".viewlets.RSSViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.links.RSS"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".viewlets.RSSViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.links.canonical_url"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".viewlets.CanonicalURL"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.links.canonical_url"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".viewlets.CanonicalURL"\n+      permission="zope2.View"\n+      />\n \n </configure>\ndiff --git a/plone/app/layout/links/favicon.pt b/plone/app/layout/links/favicon.pt\nindex 73fd1472..811481e1 100644\n--- a/plone/app/layout/links/favicon.pt\n+++ b/plone/app/layout/links/favicon.pt\n@@ -1,5 +1,13 @@\n <tal:favicon>\n-    <link rel="preload icon" type="${python: view.mimetype}"\n-          tal:attributes="href python: view.favicon_path" />\n-    <link rel="mask-icon" tal:attributes="href python: view.favicon_path" />\n-</tal:favicon>\n\\ No newline at end of file\n+  <link rel="preload icon"\n+        type="${python: view.mimetype}"\n+        tal:attributes="\n+          href python: view.favicon_path;\n+        "\n+  />\n+  <link rel="mask-icon"\n+        tal:attributes="\n+          href python: view.favicon_path;\n+        "\n+  />\n+</tal:favicon>\ndiff --git a/plone/app/layout/links/rsslink.pt b/plone/app/layout/links/rsslink.pt\nindex 81de4a9e..9384413d 100644\n--- a/plone/app/layout/links/rsslink.pt\n+++ b/plone/app/layout/links/rsslink.pt\n@@ -1,7 +1,11 @@\n <tal:feeds tal:repeat="link view/rsslinks">\n-    <link rel="alternate" href="" title="RSS 1.0"\n-          type="application/rss+xml"\n-          tal:attributes="href link/url;\n-                          title link/title"\n-          />\n-</tal:feeds>\n\\ No newline at end of file\n+  <link href=""\n+        rel="alternate"\n+        title="RSS 1.0"\n+        type="application/rss+xml"\n+        tal:attributes="\n+          href link/url;\n+          title link/title;\n+        "\n+  />\n+</tal:feeds>\ndiff --git a/plone/app/layout/links/search.pt b/plone/app/layout/links/search.pt\nindex d41569c5..b3b58ebd 100644\n--- a/plone/app/layout/links/search.pt\n+++ b/plone/app/layout/links/search.pt\n@@ -1,8 +1,14 @@\n-<tal:search define="navigation_root_url view/navigation_root_url"\n-            i18n:domain="plone">\n-    <link rel="search"\n-          href=""\n-          title="Search this site"\n-          i18n:attributes="title title_search_this_site"\n-          tal:attributes="href string:${navigation_root_url}/@@search" />\n+<tal:search define="\n+              navigation_root_url view/navigation_root_url;\n+            "\n+            i18n:domain="plone"\n+>\n+  <link href=""\n+        rel="search"\n+        title="Search this site"\n+        tal:attributes="\n+          href string:${navigation_root_url}/@@search;\n+        "\n+        i18n:attributes="title title_search_this_site"\n+  />\n </tal:search>\ndiff --git a/plone/app/layout/links/tests/test_canonical_url.py b/plone/app/layout/links/tests/test_canonical_url.py\nindex 308033fd..b20ba6ac 100644\n--- a/plone/app/layout/links/tests/test_canonical_url.py\n+++ b/plone/app/layout/links/tests/test_canonical_url.py\n@@ -5,7 +5,6 @@\n \n \n class ViewletTestCase(unittest.TestCase):\n-\n     layer = FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/layout/links/tests/test_favicon_viewlet.py b/plone/app/layout/links/tests/test_favicon_viewlet.py\nindex 17d8673b..c05c5d23 100644\n--- a/plone/app/layout/links/tests/test_favicon_viewlet.py\n+++ b/plone/app/layout/links/tests/test_favicon_viewlet.py\n@@ -1,9 +1,9 @@\n from plone.app.layout.links.viewlets import FaviconViewlet\n from plone.app.layout.testing import FUNCTIONAL_TESTING\n from plone.app.layout.viewlets.tests.base import ViewletsTestCase\n+from plone.base.interfaces import ISiteSchema\n from plone.formwidget.namedfile.converter import b64encode_file\n from plone.registry.interfaces import IRegistry\n-from plone.base.interfaces import ISiteSchema\n from zope.component import getUtility\n \n \ndiff --git a/plone/app/layout/links/viewlets.py b/plone/app/layout/links/viewlets.py\nindex 08e868fe..5d12762d 100644\n--- a/plone/app/layout/links/viewlets.py\n+++ b/plone/app/layout/links/viewlets.py\n@@ -1,6 +1,8 @@\n from Acquisition import aq_inner\n from plone.app.layout.viewlets import ViewletBase\n from plone.app.uuid.utils import uuidToObject\n+from plone.base.interfaces import ISecuritySchema\n+from plone.base.interfaces import ISiteSchema\n from plone.base.interfaces import ISiteSyndicationSettings\n from plone.base.interfaces.syndication import IFeedSettings\n from plone.base.utils import safe_bytes\n@@ -9,8 +11,6 @@\n from plone.memoize import view\n from plone.memoize.compress import xhtml_compress\n from plone.registry.interfaces import IRegistry\n-from plone.base.interfaces import ISecuritySchema\n-from plone.base.interfaces import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from typing import NoReturn\n from zope.component import getMultiAdapter\n@@ -36,7 +36,6 @@ def render_cachekey(fun, self):\n \n \n class FaviconViewlet(ViewletBase):\n-\n     _template = ViewPageTemplateFile("favicon.pt")\n     mimetype: str\n     favicon_path: str\n@@ -81,7 +80,6 @@ def render(self) -> ViewPageTemplateFile:\n \n \n class SearchViewlet(ViewletBase):\n-\n     _template = ViewPageTemplateFile("search.pt")\n \n     @ram.cache(render_cachekey)\n@@ -90,7 +88,6 @@ def render(self):\n \n \n class AuthorViewlet(ViewletBase):\n-\n     _template = ViewPageTemplateFile("author.pt")\n \n     def update(self):\ndiff --git a/plone/app/layout/navigation/configure.zcml b/plone/app/layout/navigation/configure.zcml\nindex 3dad49e9..a6ed63df 100644\n--- a/plone/app/layout/navigation/configure.zcml\n+++ b/plone/app/layout/navigation/configure.zcml\n@@ -1,9 +1,10 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <class class=".navtree.NavtreeStrategyBase">\n-        <allow interface=".interfaces.INavtreeStrategy" />\n-    </class>\n+  <class class=".navtree.NavtreeStrategyBase">\n+    <allow interface=".interfaces.INavtreeStrategy" />\n+  </class>\n \n </configure>\ndiff --git a/plone/app/layout/navigation/navtree.py b/plone/app/layout/navigation/navtree.py\nindex 00de3bbd..092fde8a 100644\n--- a/plone/app/layout/navigation/navtree.py\n+++ b/plone/app/layout/navigation/navtree.py\n@@ -176,7 +176,7 @@ def buildFolderTree(context, obj=None, query={}, strategy=NavtreeStrategyBase())\n         if rootObject is not None:\n             pruneRoot = not strategy.showChildrenOf(rootObject)\n \n-    # Allow the strategy to suppliment the query for keys not already\n+    # Allow the strategy to supplement the query for keys not already\n     # present in the query such as sorting and omitting default pages\n     for key, value in strategy.supplimentQuery.items():\n         if key not in query:\n@@ -260,7 +260,6 @@ def insertElement(itemPaths, item, forceInsert=False):\n         if not forceInsert and strategy is not None:\n             insert = strategy.nodeFilter(newNode)\n         if insert:\n-\n             if strategy is not None:\n                 newNode = strategy.decoratorFactory(newNode)\n \ndiff --git a/plone/app/layout/navigation/tests/test_root.py b/plone/app/layout/navigation/tests/test_root.py\nindex d6ac822a..27d7eb5a 100644\n--- a/plone/app/layout/navigation/tests/test_root.py\n+++ b/plone/app/layout/navigation/tests/test_root.py\n@@ -5,7 +5,6 @@\n \n \n class NavigationRootTestCase(unittest.TestCase):\n-\n     layer = INTEGRATION_TESTING\n \n     def test_getNavigationRootObject_no_context(self):\ndiff --git a/plone/app/layout/nextprevious/configure.zcml b/plone/app/layout/nextprevious/configure.zcml\nindex 2ee9eaf8..a6d88e4c 100644\n--- a/plone/app/layout/nextprevious/configure.zcml\n+++ b/plone/app/layout/nextprevious/configure.zcml\n@@ -1,33 +1,34 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <!-- We need this both in the viewlet and in Plone\'s header for rel links,\n+  <!-- We need this both in the viewlet and in Plone\'s header for rel links,\n          so define a view and use it in both places. Note that the actual\n          values are request memoized, so the calculations will only be\n          performed once.\n      -->\n \n-    <browser:page\n-        for="*"\n-        name="plone_nextprevious_view"\n-        class=".view.NextPreviousView"\n-        permission="zope.Public"\n-        allowed_attributes="next previous enabled"\n-        />\n+  <browser:page\n+      name="plone_nextprevious_view"\n+      for="*"\n+      class=".view.NextPreviousView"\n+      allowed_attributes="next previous enabled"\n+      permission="zope.Public"\n+      />\n \n-    <browser:viewlet\n-        name="plone.nextprevious"\n-        manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n-        class=".view.NextPreviousViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.nextprevious"\n+      manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n+      class=".view.NextPreviousViewlet"\n+      permission="zope2.View"\n+      />\n \n-    <browser:viewlet\n-        name="plone.nextprevious.links"\n-        manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n-        class=".view.NextPreviousLinksViewlet"\n-        permission="zope2.View"\n-        />\n+  <browser:viewlet\n+      name="plone.nextprevious.links"\n+      manager="plone.app.layout.viewlets.interfaces.IHtmlHeadLinks"\n+      class=".view.NextPreviousLinksViewlet"\n+      permission="zope2.View"\n+      />\n \n </configure>\ndiff --git a/plone/app/layout/nextprevious/links.pt b/plone/app/layout/nextprevious/links.pt\nindex 4b391def..33787906 100644\n--- a/plone/app/layout/nextprevious/links.pt\n+++ b/plone/app/layout/nextprevious/links.pt\n@@ -1,25 +1,38 @@\n <div xmlns="http://www.w3.org/1999/xhtml"\n      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-     tal:define="enabled view/enabled|nothing;\n-                 isViewTemplate view/isViewTemplate|nothing"\n+     tal:define="\n+       enabled view/enabled|nothing;\n+       isViewTemplate view/isViewTemplate|nothing;\n+     "\n      tal:condition="python:enabled and isViewTemplate"\n-     tal:omit-tag="">\n+     tal:omit-tag=""\n+>\n \n-    <link rel="previous"\n-          href=""\n-          title="Go to previous item"\n-          tal:define="previous view/previous"\n-          tal:condition="previous"\n-          i18n:attributes="title title_previous_item"\n-          tal:attributes="href previous/url" />\n+  <link href=""\n+        rel="previous"\n+        title="Go to previous item"\n+        tal:define="\n+          previous view/previous;\n+        "\n+        tal:condition="previous"\n+        tal:attributes="\n+          href previous/url;\n+        "\n+        i18n:attributes="title title_previous_item"\n+  />\n \n-    <link rel="next"\n-          href=""\n-          title="Go to next item"\n-          tal:define="next view/next"\n-          tal:condition="next"\n-          i18n:attributes="title title_next_item"\n-          tal:attributes="href next/url" />\n+  <link href=""\n+        rel="next"\n+        title="Go to next item"\n+        tal:define="\n+          next view/next;\n+        "\n+        tal:condition="next"\n+        tal:attributes="\n+          href next/url;\n+        "\n+        i18n:attributes="title title_next_item"\n+  />\n \n </div>\ndiff --git a/plone/app/layout/nextprevious/nextprevious.pt b/plone/app/layout/nextprevious/nextprevious.pt\nindex 06384dd8..34b9bd81 100644\n--- a/plone/app/layout/nextprevious/nextprevious.pt\n+++ b/plone/app/layout/nextprevious/nextprevious.pt\n@@ -1,36 +1,61 @@\n <section id="section-next-prev"\n-     tal:define="enabled view/enabled|nothing;\n-                 isViewTemplate view/isViewTemplate|nothing"\n-     tal:condition="python:enabled and isViewTemplate"\n-     i18n:domain="plone">\n+         tal:define="\n+           enabled view/enabled|nothing;\n+           isViewTemplate view/isViewTemplate|nothing;\n+         "\n+         tal:condition="python:enabled and isViewTemplate"\n+         i18n:domain="plone"\n+>\n \n-  <tal:block define="portal_url view/site_url;">\n+  <tal:block define="\n+               portal_url view/site_url;\n+             ">\n \n     <nav class="pagination justify-content-between"\n-         tal:define="next view/next;\n-                     previous view/previous"\n-         tal:condition="python:previous is not None or next is not None">\n-\n-          <a class="btn btn-sm btn-outline-secondary align-self-start previous" tal:condition="previous"\n-              title="Go to previous item"\n-              i18n:attributes="title title_previous_item"\n-              tal:attributes="href previous/url">\n-            <span class="arrow"></span>\n-            <span i18n:translate="label_previous_item" class="label">\n+         tal:define="\n+           next view/next;\n+           previous view/previous;\n+         "\n+         tal:condition="python:previous is not None or next is not None"\n+    >\n+\n+      <a class="btn btn-sm btn-outline-secondary align-self-start previous"\n+         title="Go to previous item"\n+         tal:condition="previous"\n+         tal:attributes="\n+           href previous/url;\n+         "\n+         i18n:attributes="title title_previous_item"\n+      >\n+        <span class="arrow"></span>\n+        <span class="label"\n+              i18n:translate="label_previous_item"\n+        >\n               Previous:\n-              <span i18n:name="itemtitle" tal:replace="previous/title" />\n-            </span>\n-          </a>\n-\n-          <a class="btn btn-sm btn-outline-secondary align-self-end next" tal:condition="next" title="Go to next item"\n-              i18n:attributes="title title_next_item"\n-              tal:attributes="href next/url">\n-            <span i18n:translate="label_next_item" class="label">\n+          <span tal:replace="previous/title"\n+                i18n:name="itemtitle"\n+          ></span>\n+        </span>\n+      </a>\n+\n+      <a class="btn btn-sm btn-outline-secondary align-self-end next"\n+         title="Go to next item"\n+         tal:condition="next"\n+         tal:attributes="\n+           href next/url;\n+         "\n+         i18n:attributes="title title_next_item"\n+      >\n+        <span class="label"\n+              i18n:translate="label_next_item"\n+        >\n               Next:\n-              <span i18n:name="itemtitle" tal:replace="next/title" />\n-            </span>\n-            <span class="arrow"></span>\n-          </a>\n+          <span tal:replace="next/title"\n+                i18n:name="itemtitle"\n+          ></span>\n+        </span>\n+        <span class="arrow"></span>\n+      </a>\n \n \n     </nav>\ndiff --git a/plone/app/layout/permissions.zcml b/plone/app/layout/permissions.zcml\nindex f4990568..ffe6a1ed 100644\n--- a/plone/app/layout/permissions.zcml\n+++ b/plone/app/layout/permissions.zcml\n@@ -1,13 +1,15 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:zcml="http://namespaces.zope.org/zcml"\n-           i18n_domain="cmf_default">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="cmf_default"\n+    >\n \n   <configure zcml:condition="installed AccessControl.security">\n \n     <permission\n-      id="plone.ShowToolbar"\n-      title="Show Toolbar"\n-      />\n+        id="plone.ShowToolbar"\n+        title="Show Toolbar"\n+        />\n \n   </configure>\n \ndiff --git a/plone/app/layout/sitemap/configure.zcml b/plone/app/layout/sitemap/configure.zcml\nindex 967dcb7b..6a8a448b 100644\n--- a/plone/app/layout/sitemap/configure.zcml\n+++ b/plone/app/layout/sitemap/configure.zcml\n@@ -1,12 +1,13 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n   <browser:page\n       name="sitemap.xml.gz"\n       for="plone.base.interfaces.INavigationRoot"\n       class=".sitemap.SiteMapView"\n       permission="zope2.Public"\n-     />\n+      />\n \n </configure>\ndiff --git a/plone/app/layout/sitemap/sitemap.py b/plone/app/layout/sitemap/sitemap.py\nindex a897ee69..7eb6bfa7 100644\n--- a/plone/app/layout/sitemap/sitemap.py\n+++ b/plone/app/layout/sitemap/sitemap.py\n@@ -1,11 +1,11 @@\n from BTrees.OOBTree import OOBTree\n from gzip import GzipFile\n from io import BytesIO\n+from plone.base.interfaces import IPloneSiteRoot\n+from plone.base.interfaces import ISiteSchema\n from plone.memoize import ram\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces import IPloneSiteRoot\n-from plone.base.interfaces import ISiteSchema\n from Products.Five import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getUtility\ndiff --git a/plone/app/layout/sitemap/sitemap.xml b/plone/app/layout/sitemap/sitemap.xml\nindex b39180e1..3bda3a7b 100644\n--- a/plone/app/layout/sitemap/sitemap.xml\n+++ b/plone/app/layout/sitemap/sitemap.xml\n@@ -1,15 +1,19 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"\n         xmlns:tal="http://xml.zope.org/namespaces/tal"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n-        xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd">\n-<url tal:repeat="obj view/objects">\n-  <loc tal:content="obj/loc">url</loc>\n-  <lastmod tal:condition="obj/lastmod | nothing"\n-          tal:content="obj/lastmod">date modified</lastmod>\n-  <changefreq tal:condition="obj/changefreq | nothing"\n-             tal:content="obj/changefreq">change frequency</changefreq>\n-  <priority tal:condition="obj/priority | nothing"\n-           tal:content="obj/priority">priority</priority>\n-</url>\n+        xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"\n+>\n+  <url tal:repeat="obj view/objects">\n+    <loc tal:content="obj/loc">url</loc>\n+    <lastmod tal:condition="obj/lastmod | nothing"\n+             tal:content="obj/lastmod"\n+    >date modified</lastmod>\n+    <changefreq tal:condition="obj/changefreq | nothing"\n+                tal:content="obj/changefreq"\n+    >change frequency</changefreq>\n+    <priority tal:condition="obj/priority | nothing"\n+              tal:content="obj/priority"\n+    >priority</priority>\n+  </url>\n </urlset>\ndiff --git a/plone/app/layout/sitemap/tests/test_sitemap.py b/plone/app/layout/sitemap/tests/test_sitemap.py\nindex 9d3820b1..0c8e868d 100644\n--- a/plone/app/layout/sitemap/tests/test_sitemap.py\n+++ b/plone/app/layout/sitemap/tests/test_sitemap.py\n@@ -1,18 +1,18 @@\n from DateTime import DateTime\n from gzip import GzipFile\n from io import BytesIO\n-from plone.base.interfaces import INavigationRoot\n from plone.app.layout.testing import INTEGRATION_TESTING\n from plone.app.testing import login\n from plone.app.testing import logout\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n+from plone.base.interfaces import INavigationRoot\n+from plone.base.interfaces import ISearchSchema\n+from plone.base.interfaces import ISiteSchema\n from plone.base.utils import safe_text\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces import ISearchSchema\n-from plone.base.interfaces import ISiteSchema\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n from zope.interface import alsoProvides\n@@ -36,7 +36,7 @@ def setUp(self):\n         )\n         self.wftool = getToolByName(self.portal, "portal_workflow")\n \n-        # we need to explizitly set a workflow cause we can\'t rely on the\n+        # we need to explicitly set a workflow cause we can\'t rely on the\n         # test environment.\n         # `instance test -m plone.app.layout`:\n         # wftool._default_chain == \'simple_publication_workflow\'\n@@ -71,9 +71,9 @@ def setUp(self):\n \n     def uncompress(self, sitemapdata):\n         sio = BytesIO(sitemapdata)\n-        unziped = GzipFile(fileobj=sio)\n-        xml = unziped.read()\n-        unziped.close()\n+        unzipped = GzipFile(fileobj=sio)\n+        xml = unzipped.read()\n+        unzipped.close()\n         return safe_text(xml)\n \n     def test_disabled(self):\n@@ -266,6 +266,6 @@ def test_default_pages(self):\n         xml = self.uncompress(self.sitemap())\n         self.assertFalse("<loc>http://nohost/plone/folder/default</loc>" in xml)\n         self.assertTrue("<loc>http://nohost/plone/folder</loc>" in xml)\n-        self.assertTrue("<lastmod>2001-01-01T" in xml)\n+        self.assertTrue("<lastmod >2001-01-01T" in xml)\n         self.assertTrue("<loc>http://nohost/plone</loc>" in xml)\n         self.assertFalse("<loc>http://nohost/plone/published</loc>" in xml)\ndiff --git a/plone/app/layout/testing.py b/plone/app/layout/testing.py\nindex 6e59c9d6..5cafc61f 100644\n--- a/plone/app/layout/testing.py\n+++ b/plone/app/layout/testing.py\n@@ -3,12 +3,10 @@\n from plone.app.testing import IntegrationTesting\n from plone.app.testing import PloneSandboxLayer\n from plone.app.testing import TEST_USER_ID\n-from plone.app.testing import TEST_USER_PASSWORD\n from plone.base.utils import unrestricted_construct_instance\n \n \n class Fixture(PloneSandboxLayer):\n-\n     defaultBases = (PLONE_APP_CONTENTTYPES_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\ndiff --git a/plone/app/layout/viewlets/anontools.pt b/plone/app/layout/viewlets/anontools.pt\nindex 810675d9..f399fdbc 100644\n--- a/plone/app/layout/viewlets/anontools.pt\n+++ b/plone/app/layout/viewlets/anontools.pt\n@@ -1,10 +1,17 @@\n-<div id="portal-anontools" tal:condition="python:view.user_actions and view.anonymous">\n+<div id="portal-anontools"\n+     tal:condition="python:view.user_actions and view.anonymous"\n+>\n   <ul class="list-inline">\n-    <li class="list-inline-item" tal:repeat="action view/user_actions">\n+    <li class="list-inline-item"\n+        tal:repeat="action view/user_actions"\n+    >\n       <a href=""\n-          tal:attributes="action"\n-          tal:content="action/title"\n-          i18n:translate="">\n+         tal:content="action/title"\n+         tal:attributes="\n+           action;\n+         "\n+         i18n:translate=""\n+      >\n           action title\n       </a>\n     </li>\ndiff --git a/plone/app/layout/viewlets/colophon.pt b/plone/app/layout/viewlets/colophon.pt\nindex 2137b891..b4c07f25 100644\n--- a/plone/app/layout/viewlets/colophon.pt\n+++ b/plone/app/layout/viewlets/colophon.pt\n@@ -1,14 +1,17 @@\n <div id="portal-colophon"\n-     i18n:domain="plone">\n-<div class="colophonWrapper">\n-<ul>\n-  <li>\n-    <a href="http://plone.com" target="_blank"\n-       title="This site was built using the Plone Open Source CMS/WCM."\n-       i18n:attributes="title title_built_with_plone;"\n-       i18n:translate="label_powered_by_plone">\n-      Powered by Plone &amp; Python</a>\n-  </li>\n-</ul>\n-</div>\n+     i18n:domain="plone"\n+>\n+  <div class="colophonWrapper">\n+    <ul>\n+      <li>\n+        <a href="http://plone.com"\n+           target="_blank"\n+           title="This site was built using the Plone Open Source CMS/WCM."\n+           i18n:attributes="title title_built_with_plone;"\n+           i18n:translate="label_powered_by_plone"\n+        >\n+          Powered by Plone &amp; Python</a>\n+      </li>\n+    </ul>\n+  </div>\n </div>\ndiff --git a/plone/app/layout/viewlets/common.py b/plone/app/layout/viewlets/common.py\nindex 4fbe4b8f..61a62774 100644\n--- a/plone/app/layout/viewlets/common.py\n+++ b/plone/app/layout/viewlets/common.py\n@@ -7,16 +7,16 @@\n from plone.app.layout.globals.interfaces import IViewView\n from plone.app.layout.navigation.root import getNavigationRoot\n from plone.base import PloneMessageFactory as _\n+from plone.base.interfaces import IPloneSiteRoot\n+from plone.base.interfaces import ISearchSchema\n+from plone.base.interfaces import ISiteSchema\n+from plone.base.interfaces.controlpanel import INavigationSchema\n from plone.base.utils import safe_text\n from plone.i18n.interfaces import ILanguageSchema\n from plone.memoize.view import memoize\n from plone.protect.utils import addTokenToUrl\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces import IPloneSiteRoot\n-from plone.base.interfaces import ISearchSchema\n-from plone.base.interfaces import ISiteSchema\n-from plone.base.interfaces.controlpanel import INavigationSchema\n from Products.CMFPlone.utils import getSiteLogo\n from Products.Five.browser import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n@@ -84,7 +84,7 @@ def __eq__(self, other):\n class TitleViewlet(ViewletBase):\n     index = ViewPageTemplateFile("title.pt")\n \n-    # seperator of page- and portal-title\n+    # separator of page- and portal-title\n     sep = " &mdash; "\n \n     @property\n@@ -409,7 +409,6 @@ def portal_tabs(self):\n \n \n class PersonalBarViewlet(ViewletBase):\n-\n     homelink_url = ""\n     user_name = ""\n \ndiff --git a/plone/app/layout/viewlets/configure.zcml b/plone/app/layout/viewlets/configure.zcml\nindex 86b95ad3..9b82456e 100644\n--- a/plone/app/layout/viewlets/configure.zcml\n+++ b/plone/app/layout/viewlets/configure.zcml\n@@ -1,357 +1,361 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n-\n-    <include package="Products.CMFCore" file="permissions.zcml"/>\n-\n-    <!-- Register viewlet managers - used in plone\'s main_template -->\n-\n-    <browser:viewletManager\n-        name="plone.httpheaders"\n-        provides=".interfaces.IHTTPHeaders"\n-        permission="zope.Public"\n-        class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.htmlhead"\n-        provides=".interfaces.IHtmlHead"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.scripts"\n-        provides=".interfaces.IScripts"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.htmlhead.links"\n-        provides=".interfaces.IHtmlHeadLinks"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.portaltop"\n-        provides=".interfaces.IPortalTop"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.mainnavigation"\n-        provides=".interfaces.IMainNavigation"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.globalstatusmessage"\n-        provides=".interfaces.IGlobalStatusMessage"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.portalheader"\n-        provides=".interfaces.IPortalHeader"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.toolbar"\n-        provides=".interfaces.IToolbar"\n-        permission="zope2.View"\n-        class=".toolbar.ToolbarViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.abovecontent"\n-        provides=".interfaces.IAboveContent"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.abovecontenttitle"\n-        provides=".interfaces.IAboveContentTitle"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.belowcontenttitle"\n-        provides=".interfaces.IBelowContentTitle"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.belowcontentdescription"\n-        provides=".interfaces.IBelowContentDescription"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.abovecontentbody"\n-        provides=".interfaces.IAboveContentBody"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.belowcontentbody"\n-        provides=".interfaces.IBelowContentBody"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.belowcontent"\n-        provides=".interfaces.IBelowContent"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <browser:viewletManager\n-        name="plone.portalfooter"\n-        provides=".interfaces.IPortalFooter"\n-        permission="zope2.View"\n-        class="plone.app.viewletmanager.manager.OrderedViewletManager"\n-        />\n-\n-    <!-- Define some viewlets -->\n-\n-    <!-- HTTPHeaders -->\n-    <browser:viewlet\n-        name="plone.httpcachingheaders"\n-        manager=".interfaces.IHTTPHeaders"\n-        class=".httpheaders.HTTPCachingHeaders"\n-        permission="zope.Public"\n-        />\n-\n-    <!-- The site actions -->\n-    <browser:viewlet\n-        name="plone.site_actions"\n-        manager=".interfaces.IPortalFooter"\n-        class=".common.SiteActionsViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- The search box -->\n-    <browser:viewlet\n-        name="plone.searchbox"\n-        manager=".interfaces.IPortalHeader"\n-        class=".common.SearchBoxViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- The anontools (login, register) -->\n-    <browser:viewlet\n-        name="plone.anontools"\n-        manager=".interfaces.IPortalHeader"\n-        class=".common.PersonalBarViewlet"\n-        permission="zope2.View"\n-        template="anontools.pt"\n-        />\n-\n-    <!-- The member panel (logout, user actions) -->\n-    <browser:viewlet\n-        name="plone.membertools"\n-        manager=".interfaces.IPortalHeader"\n-        class=".common.PersonalBarViewlet"\n-        permission="zope2.View"\n-        template="membertools.pt"\n-        />\n-\n-    <!-- The logo -->\n-    <browser:viewlet\n-        name="plone.logo"\n-        manager=".interfaces.IPortalHeader"\n-        class=".common.LogoViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- The global sections -->\n-    <browser:viewlet\n-        name="plone.global_sections"\n-        manager=".interfaces.IMainNavigation"\n-        class=".common.GlobalSectionsViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Content views (tabs) -->\n-    <browser:viewlet\n-        name="plone.contentviews"\n-        manager=".interfaces.IToolbar"\n-        class=".common.ContentViewsViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the browser title -->\n-    <browser:viewlet\n-        name="plone.htmlhead.title"\n-        manager=".interfaces.IHtmlHead"\n-        class=".common.TitleViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the Dublin Core metadata -->\n-    <browser:viewlet\n-        name="plone.htmlhead.dublincore"\n-        manager=".interfaces.IHtmlHead"\n-        class=".common.DublinCoreViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the social media metadata -->\n-    <browser:viewlet\n-        name="plone.htmlhead.socialtags"\n-        manager=".interfaces.IHtmlHead"\n-        class=".social.SocialTagsViewlet"\n-        template="social_tags.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the social media body tags -->\n-    <browser:viewlet\n-        name="plone.socialtags"\n-        manager=".interfaces.IAboveContentTitle"\n-        class=".social.SocialTagsViewlet"\n-        template="social_tags_body.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the viewport -->\n-    <browser:viewlet\n-        name="plone.htmlhead.viewport"\n-        manager=".interfaces.IHtmlHead"\n-        template="viewport.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- The related items -->\n-    <browser:viewlet\n-        name="plone.relateditems"\n-        manager=".interfaces.IBelowContentBody"\n-        class=".content.ContentRelatedItems"\n-        view="plone.app.layout.globals.interfaces.IViewView"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the document actions -->\n-    <browser:viewlet\n-        name="plone.documentactions"\n-        manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n-        class=".content.DocumentActionsViewlet"\n-        permission="zope2.View"\n-        />\n-\n-\n-    <!-- Render the workflow history as a view -->\n-    <browser:view\n-        for="*"\n-        name="contenthistory"\n-        class=".content.ContentHistoryView"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the workflow history for popup -->\n-    <browser:page\n-        for="*"\n-        name="contenthistorypopup"\n-        template="popup_content_history.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the workflow history contents as a page-->\n-    <browser:page\n-        for="*"\n-        name="historyview"\n-        class=".content.HistoryByLineView"\n-        permission="cmf.ModifyPortalContent"\n-        />\n-\n-    <!-- The breadcrumbs -->\n-    <browser:viewlet\n-        name="plone.path_bar"\n-        manager=".interfaces.IAboveContent"\n-        class=".common.PathBarViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <browser:viewlet\n-        name="plone.globalstatusmessage"\n-        manager=".interfaces.IGlobalStatusMessage"\n-        class=".globalstatusmessage.GlobalStatusMessage"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the document byline -->\n-    <browser:viewlet\n-        name="plone.documentbyline"\n-        manager=".interfaces.IBelowContentTitle"\n-        class=".content.DocumentBylineViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the contributors section -->\n-    <browser:viewlet\n-        name="plone.contributors"\n-        manager=".interfaces.IBelowContentBody"\n-        class=".content.DocumentBylineViewlet"\n-        template="document_contributors.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the rights section -->\n-    <browser:viewlet\n-        name="plone.rights"\n-        manager=".interfaces.IBelowContentBody"\n-        template="document_rights.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render the keywords -->\n-    <browser:viewlet\n-        name="plone.keywords"\n-        manager=".interfaces.IBelowContentBody"\n-        view="plone.app.layout.globals.interfaces.IViewView"\n-        template="keywords.pt"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Render lock info -->\n-    <browser:viewlet\n-        name="plone.lockinfo"\n-        manager=".interfaces.IAboveContent"\n-        class="plone.locking.browser.info.LockInfoViewlet"\n-        permission="cmf.ModifyPortalContent"\n-        for="plone.locking.interfaces.ITTWLockable"\n-        />\n-\n-    <!-- Render table of contents -->\n-    <browser:viewlet\n-        name="plone.tableofcontents"\n-        for="plone.app.contenttypes.behaviors.tableofcontents.ITableOfContents"\n-        manager=".interfaces.IAboveContentBody"\n-        class=".common.TableOfContentsViewlet"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Colophon -->\n-    <browser:viewlet\n-        name="plone.colophon"\n-        for="*"\n-        manager=".interfaces.IPortalFooter"\n-        template="colophon.pt"\n-        permission="zope.Public"\n-        />\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n+\n+  <include\n+      package="Products.CMFCore"\n+      file="permissions.zcml"\n+      />\n+\n+  <!-- Register viewlet managers - used in plone\'s main_template -->\n+\n+  <browser:viewletManager\n+      name="plone.httpheaders"\n+      provides=".interfaces.IHTTPHeaders"\n+      class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.htmlhead"\n+      provides=".interfaces.IHtmlHead"\n+      class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.scripts"\n+      provides=".interfaces.IScripts"\n+      class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.htmlhead.links"\n+      provides=".interfaces.IHtmlHeadLinks"\n+      class="plone.app.viewletmanager.manager.BaseOrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.portaltop"\n+      provides=".interfaces.IPortalTop"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.mainnavigation"\n+      provides=".interfaces.IMainNavigation"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.globalstatusmessage"\n+      provides=".interfaces.IGlobalStatusMessage"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.portalheader"\n+      provides=".interfaces.IPortalHeader"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.toolbar"\n+      provides=".interfaces.IToolbar"\n+      class=".toolbar.ToolbarViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.abovecontent"\n+      provides=".interfaces.IAboveContent"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.abovecontenttitle"\n+      provides=".interfaces.IAboveContentTitle"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.belowcontenttitle"\n+      provides=".interfaces.IBelowContentTitle"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.belowcontentdescription"\n+      provides=".interfaces.IBelowContentDescription"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.abovecontentbody"\n+      provides=".interfaces.IAboveContentBody"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.belowcontentbody"\n+      provides=".interfaces.IBelowContentBody"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.belowcontent"\n+      provides=".interfaces.IBelowContent"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewletManager\n+      name="plone.portalfooter"\n+      provides=".interfaces.IPortalFooter"\n+      class="plone.app.viewletmanager.manager.OrderedViewletManager"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Define some viewlets -->\n+\n+  <!-- HTTPHeaders -->\n+  <browser:viewlet\n+      name="plone.httpcachingheaders"\n+      manager=".interfaces.IHTTPHeaders"\n+      class=".httpheaders.HTTPCachingHeaders"\n+      permission="zope.Public"\n+      />\n+\n+  <!-- The site actions -->\n+  <browser:viewlet\n+      name="plone.site_actions"\n+      manager=".interfaces.IPortalFooter"\n+      class=".common.SiteActionsViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The search box -->\n+  <browser:viewlet\n+      name="plone.searchbox"\n+      manager=".interfaces.IPortalHeader"\n+      class=".common.SearchBoxViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The anontools (login, register) -->\n+  <browser:viewlet\n+      name="plone.anontools"\n+      manager=".interfaces.IPortalHeader"\n+      class=".common.PersonalBarViewlet"\n+      template="anontools.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The member panel (logout, user actions) -->\n+  <browser:viewlet\n+      name="plone.membertools"\n+      manager=".interfaces.IPortalHeader"\n+      class=".common.PersonalBarViewlet"\n+      template="membertools.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The logo -->\n+  <browser:viewlet\n+      name="plone.logo"\n+      manager=".interfaces.IPortalHeader"\n+      class=".common.LogoViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The global sections -->\n+  <browser:viewlet\n+      name="plone.global_sections"\n+      manager=".interfaces.IMainNavigation"\n+      class=".common.GlobalSectionsViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Content views (tabs) -->\n+  <browser:viewlet\n+      name="plone.contentviews"\n+      manager=".interfaces.IToolbar"\n+      class=".common.ContentViewsViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the browser title -->\n+  <browser:viewlet\n+      name="plone.htmlhead.title"\n+      manager=".interfaces.IHtmlHead"\n+      class=".common.TitleViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the Dublin Core metadata -->\n+  <browser:viewlet\n+      name="plone.htmlhead.dublincore"\n+      manager=".interfaces.IHtmlHead"\n+      class=".common.DublinCoreViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the social media metadata -->\n+  <browser:viewlet\n+      name="plone.htmlhead.socialtags"\n+      manager=".interfaces.IHtmlHead"\n+      class=".social.SocialTagsViewlet"\n+      template="social_tags.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the social media body tags -->\n+  <browser:viewlet\n+      name="plone.socialtags"\n+      manager=".interfaces.IAboveContentTitle"\n+      class=".social.SocialTagsViewlet"\n+      template="social_tags_body.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the viewport -->\n+  <browser:viewlet\n+      name="plone.htmlhead.viewport"\n+      manager=".interfaces.IHtmlHead"\n+      template="viewport.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- The related items -->\n+  <browser:viewlet\n+      name="plone.relateditems"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager=".interfaces.IBelowContentBody"\n+      class=".content.ContentRelatedItems"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the document actions -->\n+  <browser:viewlet\n+      name="plone.documentactions"\n+      manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n+      class=".content.DocumentActionsViewlet"\n+      permission="zope2.View"\n+      />\n+\n+\n+  <!-- Render the workflow history as a view -->\n+  <browser:view\n+      name="contenthistory"\n+      for="*"\n+      class=".content.ContentHistoryView"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the workflow history for popup -->\n+  <browser:page\n+      name="contenthistorypopup"\n+      for="*"\n+      template="popup_content_history.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the workflow history contents as a page-->\n+  <browser:page\n+      name="historyview"\n+      for="*"\n+      class=".content.HistoryByLineView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <!-- The breadcrumbs -->\n+  <browser:viewlet\n+      name="plone.path_bar"\n+      manager=".interfaces.IAboveContent"\n+      class=".common.PathBarViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:viewlet\n+      name="plone.globalstatusmessage"\n+      manager=".interfaces.IGlobalStatusMessage"\n+      class=".globalstatusmessage.GlobalStatusMessage"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the document byline -->\n+  <browser:viewlet\n+      name="plone.documentbyline"\n+      manager=".interfaces.IBelowContentTitle"\n+      class=".content.DocumentBylineViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the contributors section -->\n+  <browser:viewlet\n+      name="plone.contributors"\n+      manager=".interfaces.IBelowContentBody"\n+      class=".content.DocumentBylineViewlet"\n+      template="document_contributors.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the rights section -->\n+  <browser:viewlet\n+      name="plone.rights"\n+      manager=".interfaces.IBelowContentBody"\n+      template="document_rights.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render the keywords -->\n+  <browser:viewlet\n+      name="plone.keywords"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager=".interfaces.IBelowContentBody"\n+      template="keywords.pt"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Render lock info -->\n+  <browser:viewlet\n+      name="plone.lockinfo"\n+      for="plone.locking.interfaces.ITTWLockable"\n+      manager=".interfaces.IAboveContent"\n+      class="plone.locking.browser.info.LockInfoViewlet"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <!-- Render table of contents -->\n+  <browser:viewlet\n+      name="plone.tableofcontents"\n+      for="plone.app.contenttypes.behaviors.tableofcontents.ITableOfContents"\n+      manager=".interfaces.IAboveContentBody"\n+      class=".common.TableOfContentsViewlet"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Colophon -->\n+  <browser:viewlet\n+      name="plone.colophon"\n+      for="*"\n+      manager=".interfaces.IPortalFooter"\n+      template="colophon.pt"\n+      permission="zope.Public"\n+      />\n \n </configure>\ndiff --git a/plone/app/layout/viewlets/content.py b/plone/app/layout/viewlets/content.py\nindex 9c65f270..c0b64e20 100644\n--- a/plone/app/layout/viewlets/content.py\n+++ b/plone/app/layout/viewlets/content.py\n@@ -11,6 +11,7 @@\n from plone.base.interfaces import ISecuritySchema\n from plone.base.interfaces import ISiteSchema\n from plone.base.utils import base_hasattr\n+from plone.base.utils import logger\n from plone.memoize.instance import memoize\n from plone.memoize.view import memoize_contextless\n from plone.protect.authenticator import createToken\n@@ -19,7 +20,6 @@\n from Products.CMFCore.utils import getToolByName\n from Products.CMFCore.WorkflowCore import WorkflowException\n from Products.CMFEditions.Permissions import AccessPreviousVersions\n-from Products.CMFPlone.utils import log\n from Products.Five.browser import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from urllib.parse import urlencode\n@@ -28,7 +28,6 @@\n from zope.component import queryMultiAdapter\n from zope.deprecation import deprecation\n \n-import logging\n import pkg_resources\n \n \n@@ -46,7 +45,6 @@\n \n \n class DocumentActionsViewlet(ViewletBase):\n-\n     index = ViewPageTemplateFile("document_actions.pt")\n \n     def update(self):\n@@ -59,7 +57,6 @@ def update(self):\n \n \n class DocumentBylineViewlet(ViewletBase):\n-\n     index = ViewPageTemplateFile("document_byline.pt")\n \n     def update(self):\n@@ -67,12 +64,16 @@ def update(self):\n         self.anonymous = self.portal_state.anonymous()\n \n     @property\n-    @deprecation.deprecate("The context_state property is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The context_state property is unused and will be removed in Plone 7"\n+    )\n     def context_state(self):\n         return getMultiAdapter((self.context, self.request), name="plone_context_state")\n \n     @property\n-    @deprecation.deprecate("The has_pam property is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The has_pam property is unused and will be removed in Plone 7"\n+    )\n     def has_pam(self):\n         return HAS_PAM\n \n@@ -97,7 +98,9 @@ def show_about(self):\n         )\n         return not self.anonymous or settings.allow_anon_views_about\n \n-    @deprecation.deprecate("The creator method is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The creator method is unused and will be removed in Plone 7"\n+    )\n     def creator(self):\n         return self.context.Creator()\n \n@@ -106,7 +109,9 @@ def author(self):\n         membership = getToolByName(self.context, "portal_membership")\n         return membership.getMemberInfo(self.creator())\n \n-    @deprecation.deprecate("The authorname method is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The authorname method is unused and will be removed in Plone 7"\n+    )\n     def authorname(self):\n         author = self.author()\n         return author and author["fullname"] or self.creator()\n@@ -139,7 +144,9 @@ def isExpired(self):\n             return self.context.expires().isPast()\n         return False\n \n-    @deprecation.deprecate("The toLocalizedTime method is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The toLocalizedTime method is unused and will be removed in Plone 7"\n+    )\n     def toLocalizedTime(self, time, long_format=None, time_only=None):\n         """Convert time to localized time"""\n         util = getToolByName(self.context, "translation_service")\n@@ -167,7 +174,9 @@ def pub_date(self):\n \n         return DateTime(date)\n \n-    @deprecation.deprecate("The get_translations method is unused and will be removed in Plone 7")\n+    @deprecation.deprecate(\n+        "The get_translations method is unused and will be removed in Plone 7"\n+    )\n     def get_translations(self):\n         cts = []\n         if ITranslatable.providedBy(self.context):\n@@ -308,7 +317,6 @@ def get_translations(self):\n \n \n class ContentRelatedItems(ViewletBase):\n-\n     index = ViewPageTemplateFile("document_relateditems.pt")\n \n     def related_items(self):\n@@ -365,7 +373,6 @@ def related2brains(self, related):\n \n \n class WorkflowHistoryViewlet(ViewletBase):\n-\n     index = ViewPageTemplateFile("review_history.pt")\n \n     @memoize\n@@ -430,17 +437,15 @@ def workflowHistory(self, complete=True):\n             review_history.reverse()\n \n         except WorkflowException:\n-            log(\n-                "plone.app.layout.viewlets.content: "\n-                "%s has no associated workflow" % context.absolute_url(),\n-                severity=logging.DEBUG,\n+            logger.debug(\n+                "plone.app.layout.viewlets.content: %s has no associated workflow",\n+                context.absolute_url(),\n             )\n \n         return review_history\n \n \n class ContentHistoryViewlet(WorkflowHistoryViewlet):\n-\n     index = ViewPageTemplateFile("content_history.pt")\n \n     def revisionHistory(self):\ndiff --git a/plone/app/layout/viewlets/content_history.pt b/plone/app/layout/viewlets/content_history.pt\nindex d7c37e75..629b3829 100644\n--- a/plone/app/layout/viewlets/content_history.pt\n+++ b/plone/app/layout/viewlets/content_history.pt\n@@ -1,97 +1,162 @@\n-<div i18n:domain="plone"\n-     tal:define="history view/fullHistory;"\n-     tal:omit-tag="">\n-     <div tal:condition="not: history">\xe2\x80\x94</div>\n+<div tal:define="\n+       history view/fullHistory;\n+     "\n+     tal:omit-tag=""\n+     i18n:domain="plone"\n+>\n+  <div tal:condition="not: history">&mdash;</div>\n \n-    <table class="table" id="history-list" tal:condition="history"\n-        summary="Content history"\n-        i18n:attributes="summary summary_content_history;">\n-        <tbody>\n-            <tr class="odd">\n-                <th i18n:translate="">What</th>\n-                <th i18n:translate="">View</th>\n-                <th colspan="2" i18n:translate="">Compare</th>\n-                <th i18n:translate="">Revert</th>\n-            </tr>\n-            <tal:block repeat="item history">\n-            <tal:historyItem\n-                define="rhComments item/comments|nothing;\n-                        actor item/actor;\n-                        actor_name python:actor and actor.get(\'fullname\',\'username\') or item[\'actorid\'];\n-                        actor_home item/actor_home;\n-                        action item/transition_title;\n-                        action_id python:item[\'action\'] or item[\'review_state\'];\n-                        effective item/effective_date|nothing;\n-                        effectiveDate python:effective and view.toLocalizedTime(item[\'effective_date\'],long_format=True);\n-                        isVersion python:item[\'type\']==\'versioning\';\n-                        icons python:context.restrictedTraverse(\'@@iconresolver\')">\n-            <tr class="historyRecord ${python:\'table-secondary\' if not isVersion else \'\'}">\n-                <td>\n-                    <span class="historyByLine">\n-                        <tal:action i18n:translate="history_action">\n-                            <span class="historyAction" tal:content="action" i18n:translate="" i18n:name="action"\n-                               tal:attributes="class string:historyAction state-${action_id}"/>\n-                            \xe2\x80\x94\n-                            <tal:actor i18n:name="actor">\n-                             <a href=""\n-                                tal:condition="actor_home"\n-                                tal:attributes="href actor_home"\n-                                tal:content="actor_name"> runyaga </a>\n-                             <span tal:condition="not: actor_home"\n-                                   tal:replace="actor_name"/>\n-                            </tal:actor>\n+  <table class="table"\n+         id="history-list"\n+         summary="Content history"\n+         tal:condition="history"\n+         i18n:attributes="summary summary_content_history;"\n+  >\n+    <tbody>\n+      <tr class="odd">\n+        <th i18n:translate="">What</th>\n+        <th i18n:translate="">View</th>\n+        <th colspan="2"\n+            i18n:translate=""\n+        >Compare</th>\n+        <th i18n:translate="">Revert</th>\n+      </tr>\n+      <tal:block repeat="item history">\n+        <tal:historyitem define="\n+                           rhComments item/comments|nothing;\n+                           actor item/actor;\n+                           actor_name python:actor and actor.get(\'fullname\',\'username\') or item[\'actorid\'];\n+                           actor_home item/actor_home;\n+                           action item/transition_title;\n+                           action_id python:item[\'action\'] or item[\'review_state\'];\n+                           effective item/effective_date|nothing;\n+                           effectiveDate python:effective and view.toLocalizedTime(item[\'effective_date\'],long_format=True);\n+                           isVersion python:item[\'type\']==\'versioning\';\n+                           icons python:context.restrictedTraverse(\'@@iconresolver\');\n+                         ">\n+          <tr class="historyRecord ${python:\'table-secondary\' if not isVersion else \'\'}">\n+            <td>\n+              <span class="historyByLine">\n+                <tal:action i18n:translate="history_action">\n+                  <span class="historyAction"\n+                        tal:content="action"\n+                        tal:attributes="\n+                          class string:historyAction state-${action_id};\n+                        "\n+                        i18n:name="action"\n+                        i18n:translate=""\n+                  ></span>\n+                            &mdash;\n+                  <tal:actor i18n:name="actor">\n+                    <a href=""\n+                       tal:condition="actor_home"\n+                       tal:content="actor_name"\n+                       tal:attributes="\n+                         href actor_home;\n+                       "\n+                    >\n+                      runyaga\n+                    </a>\n+                    <span tal:condition="not: actor_home"\n+                          tal:replace="actor_name"\n+                    ></span>\n+                  </tal:actor>\n                             on\n-                            <span i18n:translate="" i18n:name="time" tal:content="python:view.toLocalizedTime(item[\'time\'],long_format=True)"/>\n-                        </tal:action>\n-                        <tal:effective tal:condition="effective|nothing">\n-                            (<span i18n:translate="label_publishing_effective" tal:omit-tag="">effective</span>: ${effectiveDate})\n-                        </tal:effective>\n+                  <span tal:content="python:view.toLocalizedTime(item[\'time\'],long_format=True)"\n+                        i18n:name="time"\n+                        i18n:translate=""\n+                  ></span>\n+                </tal:action>\n+                <tal:effective tal:condition="effective|nothing">\n+                  (<span tal:omit-tag=""\n+                        i18n:translate="label_publishing_effective"\n+                  >effective</span>: ${effectiveDate})\n+                </tal:effective>\n \n-                    </span>\n-                    <p class="text-muted" tal:condition="rhComments">\n-                        <span i18n:translate="label_change_note">Change Note</span>:\n-                        <span i18n:translate="" tal:content="rhComments" />\n-                    </p>\n-                </td>\n-                <td>\n-                    <span class="historyLinks" tal:condition="isVersion">\n-                        <a class="btn btn-primary" href=""\n-                            tal:attributes="href item/preview_url"\n-                            i18n:translate="title_view_revision">View</a>\n-                    </span>\n-                </td>\n-                <td>\n-                    <span class="historyLinks" tal:condition="isVersion">\n-                        <a class="btn btn-secondary" href="" tal:attributes="href item/diff_current_url"\n-                            tal:condition="exists:item/diff_current_url">\n-                            <tal:icon replace="structure python:icons.tag(\'arrow-up\')" />\n-                            <span i18n:translate="title_compare_revision">Compare to current</span>\n-                        </a>\n-                    </span>\n-                </td>\n-                <td>\n-                    <a class="btn btn-secondary" tal:condition="exists:item/diff_previous_url"\n-                        tal:attributes="href item/diff_previous_url"\n-                        title="Compare with previous revision"\n-                        i18n:attributes="title title_compare_previous_revision">\n-                        <tal:icon replace="structure python:icons.tag(\'arrow-down\')" />\n-                        <span i18n:translate="label_compare" tal:omit-tag="">Compare</span>\n-                    </a>\n-                </td>\n-                <td>\n-                    <span class="historyTools" tal:condition="isVersion">\n-                    <form action="" method="post" tal:condition="item/revert_url" tal:attributes="action item/revert_url">\n-                        <input type="hidden" name="version_id" value="" tal:attributes="value item/version_id" />\n-                        <button class="btn btn-warning" type="submit"\n-                                tal:condition="exists:item/diff_current_url"\n-                                i18n:translate="title_revert_revision">Revert to this revision</button>\n-                    </form>\n-                    </span>\n-                </td>\n-            </tr>\n-            </tal:historyItem>\n-            </tal:block>\n-        </tbody>\n-    </table>\n+              </span>\n+              <p class="text-muted"\n+                 tal:condition="rhComments"\n+              >\n+                <span i18n:translate="label_change_note">Change Note</span>:\n+                <span tal:content="rhComments"\n+                      i18n:translate=""\n+                ></span>\n+              </p>\n+            </td>\n+            <td>\n+              <span class="historyLinks"\n+                    tal:condition="isVersion"\n+              >\n+                <a class="btn btn-primary"\n+                   href=""\n+                   tal:attributes="\n+                     href item/preview_url;\n+                   "\n+                   i18n:translate="title_view_revision"\n+                >View</a>\n+              </span>\n+            </td>\n+            <td>\n+              <span class="historyLinks"\n+                    tal:condition="isVersion"\n+              >\n+                <a class="btn btn-secondary"\n+                   href=""\n+                   tal:condition="exists:item/diff_current_url"\n+                   tal:attributes="\n+                     href item/diff_current_url;\n+                   "\n+                >\n+                  <tal:icon replace="structure python:icons.tag(\'arrow-up\')" />\n+                  <span i18n:translate="title_compare_revision">Compare to current</span>\n+                </a>\n+              </span>\n+            </td>\n+            <td>\n+              <a class="btn btn-secondary"\n+                 title="Compare with previous revision"\n+                 tal:condition="exists:item/diff_previous_url"\n+                 tal:attributes="\n+                   href item/diff_previous_url;\n+                 "\n+                 i18n:attributes="title title_compare_previous_revision"\n+              >\n+                <tal:icon replace="structure python:icons.tag(\'arrow-down\')" />\n+                <span tal:omit-tag=""\n+                      i18n:translate="label_compare"\n+                >Compare</span>\n+              </a>\n+            </td>\n+            <td>\n+              <span class="historyTools"\n+                    tal:condition="isVersion"\n+              >\n+                <form action=""\n+                      method="post"\n+                      tal:condition="item/revert_url"\n+                      tal:attributes="\n+                        action item/revert_url;\n+                      "\n+                >\n+                  <input name="version_id"\n+                         type="hidden"\n+                         value=""\n+                         tal:attributes="\n+                           value item/version_id;\n+                         "\n+                  />\n+                  <button class="btn btn-warning"\n+                          type="submit"\n+                          tal:condition="exists:item/diff_current_url"\n+                          i18n:translate="title_revert_revision"\n+                  >Revert to this revision</button>\n+                </form>\n+              </span>\n+            </td>\n+          </tr>\n+        </tal:historyitem>\n+      </tal:block>\n+    </tbody>\n+  </table>\n \n </div>\ndiff --git a/plone/app/layout/viewlets/contentviews.pt b/plone/app/layout/viewlets/contentviews.pt\nindex b84c3627..c2c49ebc 100644\n--- a/plone/app/layout/viewlets/contentviews.pt\n+++ b/plone/app/layout/viewlets/contentviews.pt\n@@ -1,21 +1,28 @@\n-<tal:contentviews tal:define="ploneview context/@@plone;"\n+<tal:contentviews tal:define="\n+                    ploneview context/@@plone;\n+                  "\n                   tal:condition="ploneview/showToolbar"\n-                  i18n:domain="plone">\n+                  i18n:domain="plone"\n+>\n \n-  <tal:block define="actions view/tabSet1;">\n-    <div tal:replace="structure python: view.menu_template(actions=actions)" />\n+  <tal:block define="\n+               actions view/tabSet1;\n+             ">\n+    <div tal:replace="structure python: view.menu_template(actions=actions)"></div>\n   </tal:block>\n \n   <li class="border-top my-2">\n \n-  <tal:contentmenus>\n-    <div tal:replace="structure provider:plone.contentmenu" />\n-  </tal:contentmenus>\n+    <tal:contentmenus>\n+      <div tal:replace="structure provider:plone.contentmenu"></div>\n+    </tal:contentmenus>\n \n-  <li class="border-top my-2">\n+    <li class="border-top my-2">\n \n-  <tal:block define="actions view/tabSet2;">\n-    <div tal:replace="structure python: view.menu_template(actions=actions)" />\n-  </tal:block>\n+      <tal:block define="\n+                   actions view/tabSet2;\n+                 ">\n+        <div tal:replace="structure python: view.menu_template(actions=actions)"></div>\n+      </tal:block>\n \n-</tal:contentviews>\n+    </li></li></tal:contentviews>\ndiff --git a/plone/app/layout/viewlets/document_actions.pt b/plone/app/layout/viewlets/document_actions.pt\nindex 111b910e..c299430d 100644\n--- a/plone/app/layout/viewlets/document_actions.pt\n+++ b/plone/app/layout/viewlets/document_actions.pt\n@@ -1,35 +1,45 @@\n <section id="section-document-actions"\n-    i18n:domain="plone"\n-    tal:condition="view/actions">\n+         tal:condition="view/actions"\n+         i18n:domain="plone"\n+>\n \n-    <div class="viewlet viewlet-document-actions">\n-        <tal:docactions>\n+  <div class="viewlet viewlet-document-actions">\n+    <tal:docactions>\n \n-            <div class="d-none" i18n:translate="heading_document_actions">\n+      <div class="d-none"\n+           i18n:translate="heading_document_actions"\n+      >\n               Document Actions\n-            </div>\n+      </div>\n \n-            <ul class="list-inline"\n-                tal:define="normalizeString nocall: context/@@plone/normalizeString;\n-                            icons python:context.restrictedTraverse(\'@@iconresolver\');\n-                            ">\n-                  <li tal:repeat="daction view/actions"\n-                      tal:attributes="id python:\'document-action-\' + normalizeString(daction[\'id\'])">\n-                      <a href=""\n-                         tal:attributes="href daction/url;\n-                                         target daction/link_target|nothing;\n-                                         title daction/description|nothing"\n-                        >\n-                        <tal:icon tal:replace="structure python:icons.tag(daction.get(\'icon\'))" />\n-                        <span\n-                            i18n:translate=""\n-                            tal:replace="daction/title">\n+      <ul class="list-inline"\n+          tal:define="\n+            normalizeString nocall: context/@@plone/normalizeString;\n+            icons python:context.restrictedTraverse(\'@@iconresolver\');\n+          "\n+      >\n+        <li tal:repeat="daction view/actions"\n+            tal:attributes="\n+              id python:\'document-action-\' + normalizeString(daction[\'id\']);\n+            "\n+        >\n+          <a href=""\n+             tal:attributes="\n+               href daction/url;\n+               target daction/link_target|nothing;\n+               title daction/description|nothing;\n+             "\n+          >\n+            <tal:icon tal:replace="structure python:icons.tag(daction.get(\'icon\'))" />\n+            <span tal:replace="daction/title"\n+                  i18n:translate=""\n+            >\n                             Menu Title\n-                        </span>\n-                      </a>\n-                  </li>\n-            </ul>\n-        </tal:docactions>\n+            </span>\n+          </a>\n+        </li>\n+      </ul>\n+    </tal:docactions>\n \n-    </div>\n+  </div>\n </section>\ndiff --git a/plone/app/layout/viewlets/document_byline.pt b/plone/app/layout/viewlets/document_byline.pt\nindex d1d4f267..a1106e9c 100644\n--- a/plone/app/layout/viewlets/document_byline.pt\n+++ b/plone/app/layout/viewlets/document_byline.pt\n@@ -23,30 +23,38 @@\n         >${fullname}</span>\n       </tal:user>\n     </tal:for>\n-    \xe2\x80\x94\n+    &mdash;\n   </tal:creators>\n \n-  <tal:dates define="published view/pub_date;\n-                     modified context/ModificationDate;\n-                     show_modification_date python:view.show_modification_date()">\n-  <span class="documentPublished" tal:condition="published">\n-    <span i18n:translate="box_published">published</span>\n-    <span tal:content="python:context.toLocalizedTime(published)">Published</span><tal:sep condition="show_modification_date">,</tal:sep>\n-  </span>\n+  <tal:dates define="\n+               published view/pub_date;\n+               modified context/ModificationDate;\n+               show_modification_date python:view.show_modification_date();\n+             ">\n+    <span class="documentPublished"\n+          tal:condition="published"\n+    >\n+      <span i18n:translate="box_published">published</span>\n+      <span tal:content="python:context.toLocalizedTime(published)">Published</span><tal:sep condition="show_modification_date">,</tal:sep>\n+    </span>\n \n-  <span class="documentModified" tal:condition="show_modification_date">\n-    <span i18n:translate="box_last_modified">\n+    <span class="documentModified"\n+          tal:condition="show_modification_date"\n+    >\n+      <span i18n:translate="box_last_modified">\n       last modified\n-    </span>\n-    <span tal:content="python:context.toLocalizedTime(modified)">\n+      </span>\n+      <span tal:content="python:context.toLocalizedTime(modified)">\n       Modified\n+      </span>\n     </span>\n-  </span>\n   </tal:dates>\n \n   <tal:expired tal:condition="view/isExpired">\n-    \xe2\x80\x94\n-    <span class="state-expired" i18n:translate="time_expired">expired</span>\n+    &mdash;\n+    <span class="state-expired"\n+          i18n:translate="time_expired"\n+    >expired</span>\n   </tal:expired>\n \n </section>\ndiff --git a/plone/app/layout/viewlets/document_relateditems.pt b/plone/app/layout/viewlets/document_relateditems.pt\nindex 2cc75501..9449f21b 100644\n--- a/plone/app/layout/viewlets/document_relateditems.pt\n+++ b/plone/app/layout/viewlets/document_relateditems.pt\n@@ -1,27 +1,57 @@\n-<section id="section-related" i18n:domain="plone"\n-    tal:define="related view/related_items; plone_view nocall:context/@@plone;\n-                plone_layout nocall:context/@@plone_layout;\n-                normalizeString nocall:plone_view/normalizeString;\n-                context_state nocall:context/@@plone_context_state;\n-                use_view_action python:context.portal_registry.get(\'types_use_view_action_in_listings\', []);"\n-    tal:condition="related">\n+<section id="section-related"\n+         tal:define="\n+           related view/related_items;\n+           plone_view nocall:context/@@plone;\n+           plone_layout nocall:context/@@plone_layout;\n+           normalizeString nocall:plone_view/normalizeString;\n+           context_state nocall:context/@@plone_context_state;\n+           use_view_action python:context.portal_registry.get(\'types_use_view_action_in_listings\', []);\n+         "\n+         tal:condition="related"\n+         i18n:domain="plone"\n+>\n \n-    <header class="section-heading" i18n:translate="section_related_heading">\n+  <header class="section-heading"\n+          i18n:translate="section_related_heading"\n+  >\n       Related content\n-    </header>\n+  </header>\n \n-    <!-- section content -->\n-    <tal:items tal:repeat="item related">\n-    <div class="media position-relative" tal:define="desc item/Description; item_type item/portal_type; item_type_class python:\'contenttype-\' + normalizeString(item_type); item_wf_state item/review_state|python: context_state.workflow_state(); item_wf_state_class python: \'state-\' + normalizeString(item_wf_state); item_url item/getURL|item/absolute_url; item_url python:(item_type in use_view_action) and item_url+\'/view\' or item_url; item_has_image python:item.getIcon;">\n+  <!-- section content -->\n+  <tal:items tal:repeat="item related">\n+    <div class="media position-relative"\n+         tal:define="\n+           desc item/Description;\n+           item_type item/portal_type;\n+           item_type_class python:\'contenttype-\' + normalizeString(item_type);\n+           item_wf_state item/review_state|python: context_state.workflow_state();\n+           item_wf_state_class python: \'state-\' + normalizeString(item_wf_state);\n+           item_url item/getURL|item/absolute_url;\n+           item_url python:(item_type in use_view_action) and item_url+\'/view\' or item_url;\n+           item_has_image python:item.getIcon;\n+         "\n+    >\n \n       <div class="media-body">\n-        <div><a href="${item_url}" class="h6 stretched-link">${item/pretty_title_or_id}</a></div>\n+        <div><a class="h6 stretched-link"\n+             href="${item_url}"\n+          >${item/pretty_title_or_id}</a></div>\n         <small>${item/Description}</small>\n       </div>\n \n-      <img src="" class="ms-3" tal:define="getIcon python:item.getURL() +\'/@@images/image/thumb\'" tal:condition="item_has_image" tal:attributes="src string:$getIcon; alt item/Description">\n+      <img class="ms-3"\n+           src=""\n+           tal:define="\n+             getIcon python:item.getURL() +\'/@@images/image/thumb\';\n+           "\n+           tal:condition="item_has_image"\n+           tal:attributes="\n+             src string:$getIcon;\n+             alt item/Description;\n+           "\n+      />\n \n     </div>\n-    </tal:items>\n+  </tal:items>\n \n </section>\ndiff --git a/plone/app/layout/viewlets/document_rights.pt b/plone/app/layout/viewlets/document_rights.pt\nindex ad65eb40..df01bad4 100644\n--- a/plone/app/layout/viewlets/document_rights.pt\n+++ b/plone/app/layout/viewlets/document_rights.pt\n@@ -1,9 +1,18 @@\n-<section id="section-rights" class="text-muted" i18n:domain="plone" tal:define="rights context/Rights" tal:condition="rights">\n+<section class="text-muted"\n+         id="section-rights"\n+         tal:define="\n+           rights context/Rights;\n+         "\n+         tal:condition="rights"\n+         i18n:domain="plone"\n+>\n \n-    <header class="section-heading" i18n:translate="section_rights_heading">\n+  <header class="section-heading"\n+          i18n:translate="section_rights_heading"\n+  >\n       Rights\n-    </header>\n+  </header>\n \n-    <small tal:content="rights">Copyleft NiceCorp Inc.</small>\n+  <small tal:content="rights">Copyleft NiceCorp Inc.</small>\n \n </section>\ndiff --git a/plone/app/layout/viewlets/dublin_core.pt b/plone/app/layout/viewlets/dublin_core.pt\nindex e65592ca..7290f088 100644\n--- a/plone/app/layout/viewlets/dublin_core.pt\n+++ b/plone/app/layout/viewlets/dublin_core.pt\n@@ -1,2 +1,6 @@\n <meta tal:repeat="keyval view/metatags"\n-      tal:attributes="name python:keyval[0]; content python:keyval[1];" />\n\\ No newline at end of file\n+      tal:attributes="\n+        name python:keyval[0];\n+        content python:keyval[1];\n+      "\n+/>\ndiff --git a/plone/app/layout/viewlets/globalstatusmessage.pt b/plone/app/layout/viewlets/globalstatusmessage.pt\nindex abea74a5..31f02091 100644\n--- a/plone/app/layout/viewlets/globalstatusmessage.pt\n+++ b/plone/app/layout/viewlets/globalstatusmessage.pt\n@@ -1,17 +1,25 @@\n-<tal:statusmsg tal:define="icons nocall: context/@@iconresolver"\n-               tal:repeat="message python:view.messages">\n+<tal:statusmsg tal:define="\n+                 icons nocall: context/@@iconresolver;\n+               "\n+               tal:repeat="message python:view.messages"\n+>\n \n-    <div tal:define="mtype message/type | nothing;\n-                     display_info python:view.display_info_for_mtype(mtype);"\n-         tal:condition="mtype"\n-         class="portalMessage ${python:display_info[\'cssclass\']}"\n-         role="alert">\n-        <tal:icon tal:replace="structure python:icons.tag(display_info[\'icon\'], tag_alt=display_info[\'msg\'], tag_class=\'statusmessage-icon mb-1 me-2\')" />\n-        <strong>${python:display_info[\'msg\']}</strong>\n-        <span class="content"\n-              tal:replace="message/message | nothing" i18n:translate="">\n+  <div class="portalMessage ${python:display_info[\'cssclass\']}"\n+       role="alert"\n+       tal:define="\n+         mtype message/type | nothing;\n+         display_info python:view.display_info_for_mtype(mtype);\n+       "\n+       tal:condition="mtype"\n+  >\n+    <tal:icon tal:replace="structure python:icons.tag(display_info[\'icon\'], tag_alt=display_info[\'msg\'], tag_class=\'statusmessage-icon mb-1 me-2\')" />\n+    <strong>${python:display_info[\'msg\']}</strong>\n+    <span class="content"\n+          tal:replace="message/message | nothing"\n+          i18n:translate=""\n+    >\n             The status message.\n-        </span>\n-    </div>\n+    </span>\n+  </div>\n \n </tal:statusmsg>\ndiff --git a/plone/app/layout/viewlets/history_view.pt b/plone/app/layout/viewlets/history_view.pt\nindex 1b23eab7..45ef31e8 100644\n--- a/plone/app/layout/viewlets/history_view.pt\n+++ b/plone/app/layout/viewlets/history_view.pt\n@@ -1,19 +1,21 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n     <metal:description fill-slot="content-description" />\n-    \n+\n     <metal:content fill-slot="content-core">\n-        <h3 i18n:translate="label_history">History</h3>\n-        <div tal:replace="structure here/@@contenthistory">Content History</div>\n+      <h3 i18n:translate="label_history">History</h3>\n+      <div tal:replace="structure here/@@contenthistory">Content History</div>\n     </metal:content>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/layout/viewlets/keywords.pt b/plone/app/layout/viewlets/keywords.pt\nindex 5bdd7d19..badcfeef 100644\n--- a/plone/app/layout/viewlets/keywords.pt\n+++ b/plone/app/layout/viewlets/keywords.pt\n@@ -1,17 +1,33 @@\n-<section id="section-category" i18n:domain="plone" tal:define="categories context/Subject|nothing; url_quote nocall:modules/Products.PythonScripts.standard/url_quote" tal:condition="categories">\n+<section id="section-category"\n+         tal:define="\n+           categories context/Subject|nothing;\n+           url_quote nocall:modules/Products.PythonScripts.standard/url_quote;\n+         "\n+         tal:condition="categories"\n+         i18n:domain="plone"\n+>\n \n   <div class="viewlet keywords-viewlet">\n \n-    <header class="card-title section-heading d-none" i18n:translate="section_keywords_heading">\n+    <header class="card-title section-heading d-none"\n+            i18n:translate="section_keywords_heading"\n+    >\n       Keywords\n     </header>\n \n     <tal:repeat tal:repeat="category categories">\n-    <a href="#" rel="nofollow" class="btn btn-sm btn-outline-primary"\n-      tal:define="quotedCat python:url_quote(category)"\n-      tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/@@search?Subject%3Alist=${quotedCat}">\n-      <span tal:content="category"></span>\n-    </a>\n+      <a class="btn btn-sm btn-outline-primary"\n+         href="#"\n+         rel="nofollow"\n+         tal:define="\n+           quotedCat python:url_quote(category);\n+         "\n+         tal:attributes="\n+           href string:${context/@@plone_portal_state/navigation_root_url}/@@search?Subject%3Alist=${quotedCat};\n+         "\n+      >\n+        <span tal:content="category"></span>\n+      </a>\n     </tal:repeat>\n \n   </div>\ndiff --git a/plone/app/layout/viewlets/logo.pt b/plone/app/layout/viewlets/logo.pt\nindex 5071ce33..b5bf9c43 100644\n--- a/plone/app/layout/viewlets/logo.pt\n+++ b/plone/app/layout/viewlets/logo.pt\n@@ -1,10 +1,17 @@\n <a id="portal-logo"\n    title="Home"\n-   tal:attributes="href view/navigation_root_url;\n-                   title view/navigation_root_title"\n+   tal:attributes="\n+     href view/navigation_root_url;\n+     title view/navigation_root_title;\n+   "\n+   i18n:attributes="title"\n    i18n:domain="plone"\n-   i18n:attributes="title">\n-   <img src="plone-logo.svg" alt=""\n-   tal:attributes="alt view/logo_title;\n-                         title view/logo_title;\n-                         src view/img_src" /></a>\n+>\n+  <img alt=""\n+       src="plone-logo.svg"\n+       tal:attributes="\n+         alt view/logo_title;\n+         title view/logo_title;\n+         src view/img_src;\n+       "\n+  /></a>\ndiff --git a/plone/app/layout/viewlets/membertools.pt b/plone/app/layout/viewlets/membertools.pt\nindex f28a0a63..d0a32a71 100644\n--- a/plone/app/layout/viewlets/membertools.pt\n+++ b/plone/app/layout/viewlets/membertools.pt\n@@ -1,31 +1,52 @@\n <div id="portal-membertools-wrapper"\n+     tal:define="\n+       toolbar_visible here/@@plone_context_state/is_toolbar_visible;\n+       isAnon view/anonymous;\n+     "\n+     tal:condition="python:not isAnon and not toolbar_visible"\n      i18n:domain="plone"\n-     tal:define="toolbar_visible here/@@plone_context_state/is_toolbar_visible;\n-                 isAnon view/anonymous;"\n-     tal:condition="python:not isAnon and not toolbar_visible">\n+>\n \n-  <p class="hiddenStructure" i18n:translate="heading_member_tools">Member tools</p>\n+  <p class="hiddenStructure"\n+     i18n:translate="heading_member_tools"\n+  >Member tools</p>\n \n-  <div class="dropdown dropdown-menu-end" id="portal-membertools"\n-      tal:condition="python:view.user_actions and not view.anonymous">\n-      <a id="user-name"\n-         class="dropdown-toggle" data-bs-toggle="dropdown"\n-         tal:attributes="href view/homelink_url">\n-         <span tal:replace="view/user_name">John</span>\n-         <span class="caret"></span>\n-      </a>\n-      <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">\n-          <li tal:repeat="action view/user_actions"\n-              tal:attributes="id string:membertools-${action/id}">\n-              <a href="" class="dropdown-item"\n-                 tal:attributes="href action/href;\n-                                 target action/link_target|nothing"\n-                 tal:content="action/title"\n-                 i18n:translate="">\n+  <div class="dropdown dropdown-menu-end"\n+       id="portal-membertools"\n+       tal:condition="python:view.user_actions and not view.anonymous"\n+  >\n+    <a class="dropdown-toggle"\n+       id="user-name"\n+       data-bs-toggle="dropdown"\n+       tal:attributes="\n+         href view/homelink_url;\n+       "\n+    >\n+      <span tal:replace="view/user_name">John</span>\n+      <span class="caret"></span>\n+    </a>\n+    <ul class="dropdown-menu"\n+        aria-labelledby="dropdownMenu"\n+        role="menu"\n+    >\n+      <li tal:repeat="action view/user_actions"\n+          tal:attributes="\n+            id string:membertools-${action/id};\n+          "\n+      >\n+        <a class="dropdown-item"\n+           href=""\n+           tal:content="action/title"\n+           tal:attributes="\n+             href action/href;\n+             target action/link_target|nothing;\n+           "\n+           i18n:translate=""\n+        >\n                   action title\n-              </a>\n-          </li>\n-      </ul>\n+        </a>\n+      </li>\n+    </ul>\n   </div>\n \n </div>\ndiff --git a/plone/app/layout/viewlets/menu.pt b/plone/app/layout/viewlets/menu.pt\nindex 13c66cc0..2454a778 100644\n--- a/plone/app/layout/viewlets/menu.pt\n+++ b/plone/app/layout/viewlets/menu.pt\n@@ -1,35 +1,50 @@\n-<tal:contentviews tal:define="ploneview context/@@plone;\n-                              locked view/locked_icon;\n-                              icons python:context.restrictedTraverse(\'@@iconresolver\');"\n+<tal:contentviews tal:define="\n+                    ploneview context/@@plone;\n+                    locked view/locked_icon;\n+                    icons python:context.restrictedTraverse(\'@@iconresolver\');\n+                  "\n                   tal:condition="ploneview/showToolbar"\n-                  i18n:domain="plone">\n+                  i18n:domain="plone"\n+>\n   <tal:actions tal:repeat="action options/actions">\n-    <li id="contentview-${action/id}" class="nav-item"\n-        tal:define="actionid action/id;\n-                    selected action/selected | python:False">\n+    <li class="nav-item"\n+        id="contentview-${action/id}"\n+        tal:define="\n+          actionid action/id;\n+          selected action/selected | python:False;\n+        "\n+    >\n \n-        <a href="#" class="nav-link ${python:\'locked\' if locked and actionid == \'history\' else \'\'} ${action/cssClass | nothing} ${python:\'active\' if selected else None}"\n-           tal:attributes="href action/url;\n-                           target action/link_target|nothing;">\n+      <a class="nav-link ${python:\'locked\' if locked and actionid == \'history\' else \'\'} ${action/cssClass | nothing} ${python:\'active\' if selected else None}"\n+         href="#"\n+         tal:attributes="\n+           href action/url;\n+           target action/link_target|nothing;\n+         "\n+      >\n \n-          <tal:if condition="python:actionid != \'history\'">\n-            <tal:icon tal:condition="python:action[\'icon\']"\n-                      tal:replace="structure python:icons.tag(action[\'icon\'] or \'toolbar-action\', tag_class=\'me-1\')" />\n-            <span class="toolbar-label" tal:content="action/title" i18n:translate="">View name</span>\n-          </tal:if>\n+        <tal:if condition="python:actionid != \'history\'">\n+          <tal:icon tal:condition="python:action[\'icon\']"\n+                    tal:replace="structure python:icons.tag(action[\'icon\'] or \'toolbar-action\', tag_class=\'me-1\')"\n+          />\n+          <span class="toolbar-label"\n+                tal:content="action/title"\n+                i18n:translate=""\n+          >View name</span>\n+        </tal:if>\n \n-          <tal:if tal:condition="python:actionid == \'history\'">\n-            <tal:icon tal:replace="structure python:icons.tag(\'lock\' if locked else action[\'icon\'], tag_class=\'me-1\')" />\n-            <span class="toolbar-label">\n-              <time\n-                class="pat-display-time"\n-                data-pat-display-time="output-format: L LTS"\n-                datetime="${context/ModificationDate}"\n-                tal:content="">${context/ModificationDate}</time>\n-            </span>\n-          </tal:if>\n+        <tal:if tal:condition="python:actionid == \'history\'">\n+          <tal:icon tal:replace="structure python:icons.tag(\'lock\' if locked else action[\'icon\'], tag_class=\'me-1\')" />\n+          <span class="toolbar-label">\n+            <time class="pat-display-time"\n+                  datetime="${context/ModificationDate}"\n+                  data-pat-display-time="output-format: L LTS"\n+                  tal:content=""\n+            >${context/ModificationDate}</time>\n+          </span>\n+        </tal:if>\n \n-        </a>\n+      </a>\n \n     </li>\n   </tal:actions>\ndiff --git a/plone/app/layout/viewlets/path_bar.pt b/plone/app/layout/viewlets/path_bar.pt\nindex d6e60883..e553e70c 100644\n--- a/plone/app/layout/viewlets/path_bar.pt\n+++ b/plone/app/layout/viewlets/path_bar.pt\n@@ -1,11 +1,25 @@\n \n-<nav id="portal-breadcrumbs" i18n:attributes="label_breadcrumb" aria-label="breadcrumb" i18n:domain="plone" tal:define="breadcrumbs python:view.breadcrumbs">\n+<nav id="portal-breadcrumbs"\n+     aria-label="breadcrumb"\n+     tal:define="\n+       breadcrumbs python:view.breadcrumbs;\n+     "\n+     i18n:attributes="label_breadcrumb"\n+     i18n:domain="plone"\n+>\n   <div class="container">\n     <ol class="breadcrumb">\n-      <li class="breadcrumb-item"><a i18n:translate="tabs_home" href="${python:view.navigation_root_url}">Home</a></li>\n+      <li class="breadcrumb-item"><a href="${python:view.navigation_root_url}"\n+           i18n:translate="tabs_home"\n+        >Home</a></li>\n       <tal:loop tal:repeat="crumb breadcrumbs">\n-      <li tal:condition="not: repeat/crumb/end" class="breadcrumb-item" ><a href="${python:crumb[\'absolute_url\']}">${python:crumb[\'Title\']}</a></li>\n-      <li tal:condition="repeat/crumb/end" class="breadcrumb-item active" aria-current="page">${python:crumb[\'Title\']}</li>\n+        <li class="breadcrumb-item"\n+            tal:condition="not: repeat/crumb/end"\n+        ><a href="${python:crumb[\'absolute_url\']}">${python:crumb[\'Title\']}</a></li>\n+        <li class="breadcrumb-item active"\n+            aria-current="page"\n+            tal:condition="repeat/crumb/end"\n+        >${python:crumb[\'Title\']}</li>\n       </tal:loop>\n     </ol>\n   </div>\ndiff --git a/plone/app/layout/viewlets/popup_content_history.pt b/plone/app/layout/viewlets/popup_content_history.pt\nindex 224144f3..6eb4f93f 100644\n--- a/plone/app/layout/viewlets/popup_content_history.pt\n+++ b/plone/app/layout/viewlets/popup_content_history.pt\n@@ -1,15 +1,19 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n     <article id="content">\n-        <h3 i18n:translate="label_history">History</h3>\n+      <h3 i18n:translate="label_history">History</h3>\n \n-        <div id="content-history" tal:content="structure here/@@contenthistory">Content History</div>\n+      <div id="content-history"\n+           tal:content="structure here/@@contenthistory"\n+      >Content History</div>\n     </article>\n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/layout/viewlets/review_history.pt b/plone/app/layout/viewlets/review_history.pt\nindex 382c42c0..9ec4bef6 100644\n--- a/plone/app/layout/viewlets/review_history.pt\n+++ b/plone/app/layout/viewlets/review_history.pt\n@@ -1,14 +1,23 @@\n <div class="reviewHistory"\n      id="review-history"\n+     tal:define="\n+       history view/workflowHistory;\n+     "\n      i18n:domain="plone"\n-     tal:define="history view/workflowHistory;">\n-    <tal:history tal:condition="history">\n-      <dl id="history" class="collapsible inline collapsedOnLoad">\n-        <dt class="collapsibleHeader" i18n:translate="label_history">History</dt>\n-        <dd class="collapsibleContent">\n+>\n+  <tal:history tal:condition="history">\n+    <dl class="collapsible inline collapsedOnLoad"\n+        id="history"\n+    >\n+      <dt class="collapsibleHeader"\n+          i18n:translate="label_history"\n+      >History</dt>\n+      <dd class="collapsibleContent">\n \n-        <table class="listing nosort" summary="Review History"\n-               i18n:attributes="summary summary_review_history;">\n+        <table class="listing nosort"\n+               summary="Review History"\n+               i18n:attributes="summary summary_review_history;"\n+        >\n \n           <tr>\n             <th i18n:translate="listingheader_action">Action</th>\n@@ -18,45 +27,65 @@\n           </tr>\n \n           <metal:block tal:repeat="item history">\n-            <tr tal:define="odd repeat/item/odd;\n-                            rhComments item/comments|nothing;\n-                            state item/review_state|nothing"\n-                tal:attributes="class python:odd and \'even\' or \'odd\'"\n-                tal:condition="item/action">\n-              <td i18n:translate="" tal:content="item/transition_title"\n-                  tal:attributes="class string:state-${state}">\n+            <tr tal:define="\n+                  odd repeat/item/odd;\n+                  rhComments item/comments|nothing;\n+                  state item/review_state|nothing;\n+                "\n+                tal:condition="item/action"\n+                tal:attributes="\n+                  class python:odd and \'even\' or \'odd\';\n+                "\n+            >\n+              <td tal:content="item/transition_title"\n+                  tal:attributes="\n+                    class string:state-${state};\n+                  "\n+                  i18n:translate=""\n+              >\n                 action\n               </td>\n \n-              <td tal:define="actorid python:item.get(\'actorid\');\n-                              actor python:item.get(\'actor\');\n-                              fullname actor/fullname|nothing;\n-                              username actor/username|nothing">\n+              <td tal:define="\n+                    actorid python:item.get(\'actorid\');\n+                    actor python:item.get(\'actor\');\n+                    fullname actor/fullname|nothing;\n+                    username actor/username|nothing;\n+                  ">\n                 <a href="/Members/runyaga"\n                    tal:condition="item/actor_home"\n-                   tal:attributes="href item/actor_home"\n-                   tal:content="python:fullname or username or actorid">\n+                   tal:content="python:fullname or username or actorid"\n+                   tal:attributes="\n+                     href item/actor_home;\n+                   "\n+                >\n                   runyaga\n                 </a>\n                 <span tal:condition="not: item/actor_home"\n                       tal:replace="python:fullname or username or actorid"\n-                />\n+                ></span>\n               </td>\n \n               <td>\n-                <span tal:replace="python:context.toLocalizedTime(item[\'time\'],long_format=True)" />\n+                <span tal:replace="python:context.toLocalizedTime(item[\'time\'],long_format=True)"></span>\n                 <span tal:condition="item/effective_date|nothing">\n-                  (<span i18n:translate="label_publishing_effective" tal:omit-tag="">effective</span>:\n+                  (<span tal:omit-tag=""\n+                        i18n:translate="label_publishing_effective"\n+                  >effective</span>:\n                   <span tal:replace="python: context.toLocalizedTime(item[\'effective_date\'],long_format=True)"></span>)\n                 </span>\n               </td>\n \n               <td>\n                 <span tal:condition="rhComments">\n-                  <span tal:replace="rhComments"> some comments </span>\n+                  <span tal:replace="rhComments">\n+                    some comments\n+                  </span>\n                 </span>\n \n-                <span tal:condition="not: rhComments" i18n:translate="no_comments">\n+                <span tal:condition="not: rhComments"\n+                      i18n:translate="no_comments"\n+                >\n                   No comments.\n                 </span>\n               </td>\n@@ -64,7 +93,7 @@\n           </metal:block>\n         </table>\n \n-        </dd>\n-      </dl>\n-    </tal:history>\n+      </dd>\n+    </dl>\n+  </tal:history>\n </div>\ndiff --git a/plone/app/layout/viewlets/searchbox.pt b/plone/app/layout/viewlets/searchbox.pt\nindex 5edd3ab9..0f1de644 100644\n--- a/plone/app/layout/viewlets/searchbox.pt\n+++ b/plone/app/layout/viewlets/searchbox.pt\n@@ -1,41 +1,57 @@\n-<div id="portal-searchbox" class="d-flex flex-column position-relative"\n-  i18n:domain="plone"\n-  tal:define="navigation_root_url view/navigation_root_url;">\n+<div class="d-flex flex-column position-relative"\n+     id="portal-searchbox"\n+     tal:define="\n+       navigation_root_url view/navigation_root_url;\n+     "\n+     i18n:domain="plone"\n+>\n \n-  <form id="searchGadget_form"\n-    action="@@search"\n-    role="search"\n-    class="d-flex ${python: view.livesearch and \'pat-livesearch\'} ${python: view.show_images and \'show_images\'} "\n-    tal:attributes="action string:${navigation_root_url}/@@search;\n-                    data-pat-livesearch string:ajaxUrl:${navigation_root_url}/@@ajax-search;">\n+  <form class="d-flex ${python: view.livesearch and \'pat-livesearch\'} ${python: view.show_images and \'show_images\'}"\n+        id="searchGadget_form"\n+        action="@@search"\n+        role="search"\n+        tal:attributes="\n+          action string:${navigation_root_url}/@@search;\n+          data-pat-livesearch string:ajaxUrl:${navigation_root_url}/@@ajax-search;\n+        "\n+  >\n \n     <label class="hiddenStructure"\n-      for="searchGadget"\n-      i18n:translate="text_search">Search Site</label>\n+           for="searchGadget"\n+           i18n:translate="text_search"\n+    >Search Site</label>\n \n-    <input name="SearchableText"\n-      type="text"\n-      size="18"\n-      value=""\n-      id="searchGadget"\n-      title="Search Site"\n-      placeholder="Search Site"\n-      i18n:attributes="title title_search_site;\n+    <input class="searchField form-control me-2"\n+           id="searchGadget"\n+           name="SearchableText"\n+           placeholder="Search Site"\n+           size="18"\n+           title="Search Site"\n+           type="text"\n+           value=""\n+           tal:attributes="\n+             value request/form/SearchableText|nothing;\n+           "\n+           i18n:attributes="title title_search_site;\n                         placeholder title_search_site"\n-      tal:attributes="value request/form/SearchableText|nothing;"\n-      class="searchField form-control me-2" />\n+    />\n \n     <button class="searchButton btn btn-outline-light"\n-      type="submit"\n-      i18n:translate="label_search">\n+            type="submit"\n+            i18n:translate="label_search"\n+    >\n       Search\n     </button>\n \n-    <div id="portal-advanced-search"\n-          class="hiddenStructure">\n+    <div class="hiddenStructure"\n+         id="portal-advanced-search"\n+    >\n       <a href="#"\n-          tal:attributes="href string:${navigation_root_url}/@@search"\n-          i18n:translate="label_advanced_search">\n+         tal:attributes="\n+           href string:${navigation_root_url}/@@search;\n+         "\n+         i18n:translate="label_advanced_search"\n+      >\n           Advanced Search&hellip;\n       </a>\n     </div>\ndiff --git a/plone/app/layout/viewlets/sections.pt b/plone/app/layout/viewlets/sections.pt\nindex 208045a9..faf9318f 100644\n--- a/plone/app/layout/viewlets/sections.pt\n+++ b/plone/app/layout/viewlets/sections.pt\n@@ -1,14 +1,21 @@\n-<tal:sections xmlns:tal="http://xml.zope.org/namespaces/tal"\n-  xmlns:metal="http://xml.zope.org/namespaces/metal"\n-  xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-  tal:condition="python:view.navtree" i18n:domain="plone">\n+<tal:sections xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+              xmlns:metal="http://xml.zope.org/namespaces/metal"\n+              xmlns:tal="http://xml.zope.org/namespaces/tal"\n+              tal:condition="python:view.navtree"\n+              i18n:domain="plone"\n+>\n \n-  <ul class="navbar-nav" id="portal-globalnav">\n-    <navtree tal:replace="structure python:view.render_globalnav()" />\n+  <ul class="navbar-nav"\n+      id="portal-globalnav"\n+  >\n+    <navtree tal:replace="structure python:view.render_globalnav()"></navtree>\n   </ul>\n \n-  <button class="navbar-toggler" type="button"\n-    aria-label="Toggle navigation" i18n:attributes="aria-label label_toggle_navigation">\n+  <button class="navbar-toggler"\n+          aria-label="Toggle navigation"\n+          type="button"\n+          i18n:attributes="aria-label label_toggle_navigation"\n+  >\n     <span class="navbar-toggler-icon"></span>\n   </button>\n \ndiff --git a/plone/app/layout/viewlets/site_actions.pt b/plone/app/layout/viewlets/site_actions.pt\nindex 5e2daa0f..9170aa54 100644\n--- a/plone/app/layout/viewlets/site_actions.pt\n+++ b/plone/app/layout/viewlets/site_actions.pt\n@@ -1,17 +1,24 @@\n <ul id="portal-siteactions"\n     tal:condition="view/site_actions"\n-    i18n:domain="plone">\n+    i18n:domain="plone"\n+>\n \n-    <li tal:repeat="saction view/site_actions"\n-        tal:attributes="id string:siteaction-${saction/id}"><a\n-           href=""\n-           tal:define="title saction/title;\n-                       id saction/id;"\n-           i18n:attributes="title"\n-           i18n:translate=""\n-           tal:content="title"\n-           tal:attributes="href saction/url;\n-                           target saction/link_target|nothing;\n-                           title title;"\n-           >Site action</a></li>\n+  <li tal:repeat="saction view/site_actions"\n+      tal:attributes="\n+        id string:siteaction-${saction/id};\n+      "\n+  ><a href=""\n+       tal:define="\n+         title saction/title;\n+         id saction/id;\n+       "\n+       tal:content="title"\n+       tal:attributes="\n+         href saction/url;\n+         target saction/link_target|nothing;\n+         title title;\n+       "\n+       i18n:attributes="title"\n+       i18n:translate=""\n+    >Site action</a></li>\n </ul>\ndiff --git a/plone/app/layout/viewlets/social.py b/plone/app/layout/viewlets/social.py\nindex 0f4f002a..2641b659 100644\n--- a/plone/app/layout/viewlets/social.py\n+++ b/plone/app/layout/viewlets/social.py\n@@ -1,11 +1,11 @@\n from plone.app.layout.viewlets.common import TitleViewlet\n+from plone.base.interfaces import ISocialMediaSchema\n+from plone.base.interfaces.syndication import IFeedItem\n from plone.memoize.view import memoize\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.browser.syndication.adapters import BaseItem\n from Products.CMFPlone.browser.syndication.adapters import FolderFeed\n-from plone.base.interfaces import ISocialMediaSchema\n-from plone.base.interfaces.syndication import IFeedItem\n from Products.CMFPlone.utils import getSiteLogo\n from zope.component import getUtility\n from zope.component import queryMultiAdapter\n@@ -13,6 +13,7 @@\n \n import logging\n \n+\n logger = logging.getLogger("plone.app.layout")\n \n \n@@ -99,10 +100,10 @@ def _get_tags(self):\n         if item.has_enclosure and item.file_length > 0:\n             if item.file_type.startswith("image"):\n                 image = None\n-                scales = self.context.restrictedTraverse(\'@@images\', None)\n+                scales = self.context.restrictedTraverse("@@images", None)\n                 if scales:\n                     try:\n-                        image = scales.scale(\'image\', scale=self.social_image_scale)\n+                        image = scales.scale("image", scale=self.social_image_scale)\n                     except Exception as e:\n                         logger.exception(e)\n                 if image:\ndiff --git a/plone/app/layout/viewlets/social_tags.pt b/plone/app/layout/viewlets/social_tags.pt\nindex 7e6a752e..ce886432 100644\n--- a/plone/app/layout/viewlets/social_tags.pt\n+++ b/plone/app/layout/viewlets/social_tags.pt\n@@ -1 +1,5 @@\n-<meta tal:repeat="tag view/tags" tal:attributes="tag" />\n\\ No newline at end of file\n+<meta tal:repeat="tag view/tags"\n+      tal:attributes="\n+        tag;\n+      "\n+/>\ndiff --git a/plone/app/layout/viewlets/social_tags_body.pt b/plone/app/layout/viewlets/social_tags_body.pt\nindex a461df7a..bacc0a87 100644\n--- a/plone/app/layout/viewlets/social_tags_body.pt\n+++ b/plone/app/layout/viewlets/social_tags_body.pt\n@@ -1,6 +1,12 @@\n-<span id="social-tags-body" style="display: none"\n-      itemscope itemtype="http://schema.org/WebPage">\n+<span id="social-tags-body"\n+      itemscope\n+      itemtype="http://schema.org/WebPage"\n+      style="display: none"\n+>\n   <span tal:repeat="tag view/body_tags"\n-        tal:attributes="itemprop tag/itemprop|nothing"\n-        tal:content="tag/content|nothing" />\n+        tal:content="tag/content|nothing"\n+        tal:attributes="\n+          itemprop tag/itemprop|nothing;\n+        "\n+  ></span>\n </span>\ndiff --git a/plone/app/layout/viewlets/tests/base.py b/plone/app/layout/viewlets/tests/base.py\nindex aafbe309..53c4c7d9 100644\n--- a/plone/app/layout/viewlets/tests/base.py\n+++ b/plone/app/layout/viewlets/tests/base.py\n@@ -6,7 +6,6 @@\n \n \n class ViewletsTestCase(unittest.TestCase):\n-\n     layer = INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -16,7 +15,6 @@ def setUp(self):\n \n \n class ViewletsFunctionalTestCase(unittest.TestCase):\n-\n     layer = FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/layout/viewlets/tests/history.txt b/plone/app/layout/viewlets/tests/history.txt\nindex 3eb91899..fc5e1cc9 100644\n--- a/plone/app/layout/viewlets/tests/history.txt\n+++ b/plone/app/layout/viewlets/tests/history.txt\n@@ -62,7 +62,7 @@ The history viewlet gracefully handles initial default workflow state.\n     <...<span class="historyAction state-private">Create</span>...\n \n \n-The history viewlet handles revert actions sucessfully. Let\'s make a revision.\n+The history viewlet handles revert actions successfully. Let\'s make a revision.\n \n     >>> browser.open(urldoc2)\n     >>> browser.follow(\'Edit\')\ndiff --git a/plone/app/layout/viewlets/tests/test_common.py b/plone/app/layout/viewlets/tests/test_common.py\nindex 00e15bb5..c457650a 100644\n--- a/plone/app/layout/viewlets/tests/test_common.py\n+++ b/plone/app/layout/viewlets/tests/test_common.py\n@@ -1,4 +1,3 @@\n-from plone.base.interfaces import INavigationRoot\n from plone.app.layout.viewlets.common import ContentViewsViewlet\n from plone.app.layout.viewlets.common import GlobalSectionsViewlet\n from plone.app.layout.viewlets.common import LogoViewlet\n@@ -10,11 +9,12 @@\n from plone.app.testing import SITE_OWNER_NAME\n from plone.app.testing import SITE_OWNER_PASSWORD\n from plone.app.testing import TEST_USER_ID\n+from plone.base.interfaces import INavigationRoot\n+from plone.base.interfaces import INonStructuralFolder\n+from plone.base.interfaces import ISiteSchema\n from plone.protect import authenticator as auth\n from plone.registry.interfaces import IRegistry\n from plone.testing.zope import Browser\n-from plone.base.interfaces import INonStructuralFolder\n-from plone.base.interfaces import ISiteSchema\n from zope.component import getUtility\n from zope.component.hooks import setSite\n from zope.interface import alsoProvides\n@@ -173,7 +173,9 @@ def test_logo_viewlet_portal_root_default(self):\n         """\n         viewlet = LogoViewlet(self.folder, self.app.REQUEST, None)\n         viewlet.update()\n-        self.assertEqual(viewlet.img_src, f"{self.portal.absolute_url()}/++resource++plone-logo.svg")\n+        self.assertEqual(\n+            viewlet.img_src, f"{self.portal.absolute_url()}/++resource++plone-logo.svg"\n+        )\n \n     def test_logo_viewlet_portal_root_registry(self):\n         """When a logo is set, and viewlet is opened on a non-navigation root,\n@@ -197,7 +199,9 @@ def test_logo_viewlet_navigation_root_default(self):\n         self._set_site(self.folder)\n         viewlet = LogoViewlet(self.folder, self.app.REQUEST, None)\n         viewlet.update()\n-        self.assertEqual(viewlet.img_src, f"{self.folder.absolute_url()}/++resource++plone-logo.svg")\n+        self.assertEqual(\n+            viewlet.img_src, f"{self.folder.absolute_url()}/++resource++plone-logo.svg"\n+        )\n \n     def test_viewlet_navigation_root_registry(self):\n         """When a logo is set, and viewlet is opened on a navigation root,\ndiff --git a/plone/app/layout/viewlets/tests/test_content.py b/plone/app/layout/viewlets/tests/test_content.py\nindex eae647f5..cba69bbf 100644\n--- a/plone/app/layout/viewlets/tests/test_content.py\n+++ b/plone/app/layout/viewlets/tests/test_content.py\n@@ -7,10 +7,10 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_PASSWORD\n-from plone.locking.interfaces import ILockable\n-from plone.registry.interfaces import IRegistry\n from plone.base.interfaces import ISecuritySchema\n from plone.base.interfaces import ISiteSchema\n+from plone.locking.interfaces import ILockable\n+from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from z3c.relationfield import RelationValue\n from zope.component import getUtility\n@@ -84,7 +84,11 @@ def test_get_fullname(self):\n         # otherwise we will return the fullname property\n         portal_membership = getToolByName(self.portal, "portal_membership")\n         portal_membership.addMember(\n-            "foo/bar", TEST_USER_PASSWORD, ["Member"], "", properties={"fullname": "Foo Bar"}\n+            "foo/bar",\n+            TEST_USER_PASSWORD,\n+            ["Member"],\n+            "",\n+            properties={"fullname": "Foo Bar"},\n         )\n         self.assertEqual(viewlet.get_fullname("foo/bar"), "Foo Bar")\n \ndiff --git a/plone/app/layout/viewlets/tests/test_social.py b/plone/app/layout/viewlets/tests/test_social.py\nindex 70a73a0d..e9fb92ac 100644\n--- a/plone/app/layout/viewlets/tests/test_social.py\n+++ b/plone/app/layout/viewlets/tests/test_social.py\n@@ -5,8 +5,8 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n-from plone.registry.interfaces import IRegistry\n from plone.base.interfaces import ISocialMediaSchema\n+from plone.registry.interfaces import IRegistry\n from zope.annotation.interfaces import IAnnotations\n from zope.component import getUtility\n \n@@ -131,12 +131,18 @@ def testLogo(self):\n         viewlet.update()\n         self.assertTrue(\n             self.tagFound(\n-                viewlet, "property", "og:image", "http://nohost/plone/++resource++plone-logo.svg"\n+                viewlet,\n+                "property",\n+                "og:image",\n+                "http://nohost/plone/++resource++plone-logo.svg",\n             )\n         )\n         self.assertFalse(self.tagFound(viewlet, "itemprop"))\n         self.assertTrue(\n             self.bodyTagFound(\n-                viewlet, "itemprop", "image", "http://nohost/plone/++resource++plone-logo.svg"\n+                viewlet,\n+                "itemprop",\n+                "image",\n+                "http://nohost/plone/++resource++plone-logo.svg",\n             )\n         )\ndiff --git a/plone/app/layout/viewlets/tiny_logo.pt b/plone/app/layout/viewlets/tiny_logo.pt\nindex 4bcdf0f9..0e4653d0 100644\n--- a/plone/app/layout/viewlets/tiny_logo.pt\n+++ b/plone/app/layout/viewlets/tiny_logo.pt\n@@ -1,3 +1,8 @@\n-<a class="plone-toolbar-logo" aria-hidden="true">\n-    <img alt="Plone Toolbar" i18n:attributes="alt label_plone_toolbar_logo" src="++resource++plone-toolbarlogo.svg" />\n+<a class="plone-toolbar-logo"\n+   aria-hidden="true"\n+>\n+  <img alt="Plone Toolbar"\n+       src="++resource++plone-toolbarlogo.svg"\n+       i18n:attributes="alt label_plone_toolbar_logo"\n+  />\n </a>\ndiff --git a/plone/app/layout/viewlets/toc.pt b/plone/app/layout/viewlets/toc.pt\nindex edcd3749..c1bbdb91 100644\n--- a/plone/app/layout/viewlets/toc.pt\n+++ b/plone/app/layout/viewlets/toc.pt\n@@ -1,10 +1,15 @@\n-<section id="document-toc" class="portlet toc"  role="section" style="display: none"\n-    tal:condition="view/enabled"\n-    i18n:domain="plone">\n+<section class="portlet toc"\n+         id="document-toc"\n+         role="section"\n+         style="display: none"\n+         tal:condition="view/enabled"\n+         i18n:domain="plone"\n+>\n   <header class="portletHeader"\n-      i18n:translate="label_tableofcontents">Contents</header>\n+          i18n:translate="label_tableofcontents"\n+  >Contents</header>\n   <section class="portletContent">\n-\t  <div class="portletItem">\n-\t  </div>\n+    <div class="portletItem">\n+    </div>\n   </section>\n </section>\ndiff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex 997a44ff..eb743149 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -1,51 +1,77 @@\n-<section id="edit-bar" role="toolbar"\n-         tal:define="context_state view/context_state;\n-                     icons python:context.restrictedTraverse(\'@@iconresolver\');\n-                     personal_bar python: view.get_personal_bar();\n-                     toolbar_pos view/toolbar_position"\n+<section id="edit-bar"\n+         role="toolbar"\n+         tal:define="\n+           context_state view/context_state;\n+           icons python:context.restrictedTraverse(\'@@iconresolver\');\n+           personal_bar python: view.get_personal_bar();\n+           toolbar_pos view/toolbar_position;\n+         "\n          tal:condition="context_state/is_toolbar_visible"\n-         i18n:domain="plone">\n+         i18n:domain="plone"\n+>\n \n \n-  <div id="edit-zone" role="toolbar"\n-       class="pat-toolbar" data-bs-scroll="true">\n+  <div class="pat-toolbar"\n+       id="edit-zone"\n+       role="toolbar"\n+       data-bs-scroll="true"\n+  >\n \n     <div class="toolbar-header nav">\n-      <a class="toolbar-collapse" aria-label="Unpin" i18n:attributes="aria-label">\n+      <a class="toolbar-collapse"\n+         aria-label="Unpin"\n+         i18n:attributes="aria-label"\n+      >\n         <tal:icon tal:replace="structure python:icons.tag(\'arrow-bar-left\')" />\n       </a>\n-      <a class="toolbar-expand" aria-label="Pin" i18n:attributes="aria-label">\n+      <a class="toolbar-expand"\n+         aria-label="Pin"\n+         i18n:attributes="aria-label"\n+      >\n         <tal:icon tal:replace="structure python:icons.tag(\'arrow-bar-right\')" />\n       </a>\n     </div>\n \n     <ul class="nav flex-column plone-toolbar-main"\n-        tal:define="toolbar_main view/base_render"\n-        tal:condition="toolbar_main">\n+        tal:define="\n+          toolbar_main view/base_render;\n+        "\n+        tal:condition="toolbar_main"\n+    >\n       <li tal:replace="structure toolbar_main">\n       </li>\n     </ul>\n \n-    <div tal:condition="personal_bar/user_actions" class="personaltools-wrapper nav ${python:\'dropend\' if toolbar_pos == \'side\' else \'\'}">\n+    <div class="personaltools-wrapper nav ${python:\'dropend\' if toolbar_pos == \'side\' else \'\'}"\n+         tal:condition="personal_bar/user_actions"\n+    >\n \n-      <a id="personaltools-menulink"\n-         class="nav-link dropdown-toggle"\n-         data-bs-toggle="dropdown"\n-         data-bs-offset="0,0"\n+      <a class="nav-link dropdown-toggle"\n+         id="personaltools-menulink"\n          aria-expanded="false"\n-         tal:attributes="href personal_bar/homelink_url">\n+         data-bs-offset="0,0"\n+         data-bs-toggle="dropdown"\n+         tal:attributes="\n+           href personal_bar/homelink_url;\n+         "\n+      >\n         <tal:icon tal:replace="structure python:icons.tag(\'toolbar-action/personaltools\', tag_class=\'\')" />\n-        <span class="toolbar-label" tal:content="personal_bar/user_name">User</span>\n+        <span class="toolbar-label"\n+              tal:content="personal_bar/user_name"\n+        >User</span>\n       </a>\n \n-      <ul id="collapse-personaltools"\n-          class="dropdown-menu"\n-          aria-labelledby="personaltools-menulink">\n+      <ul class="dropdown-menu"\n+          id="collapse-personaltools"\n+          aria-labelledby="personaltools-menulink"\n+      >\n         <li>\n           <h6 class="dropdown-header">${personal_bar/user_name}</h6>\n         </li>\n         <li tal:repeat="action personal_bar/user_actions">\n-          <a href="${action/href}" class="nav-link dropdown-item">\n+          <a class="nav-link dropdown-item"\n+             href="${action/href}"\n+          >\n             <tal:icon replace="structure python:icons.tag(action.get(\'icon\', \'dot\'), tag_class=\'\')" />\n             <tal:actionname tal:content="action/title">\n               action title\ndiff --git a/plone/app/layout/viewlets/toolbar.py b/plone/app/layout/viewlets/toolbar.py\nindex 67ceb14d..59525d96 100644\n--- a/plone/app/layout/viewlets/toolbar.py\n+++ b/plone/app/layout/viewlets/toolbar.py\n@@ -1,8 +1,8 @@\n from plone.app.layout.viewlets.common import PersonalBarViewlet\n from plone.app.viewletmanager.manager import OrderedViewletManager\n+from plone.base.interfaces.controlpanel import ISiteSchema\n from plone.memoize.instance import memoize\n from plone.registry.interfaces import IRegistry\n-from plone.base.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getMultiAdapter\n from zope.component import getUtility\ndiff --git a/plone/app/layout/viewlets/viewport.pt b/plone/app/layout/viewlets/viewport.pt\nindex 38081971..6e4ca18a 100644\n--- a/plone/app/layout/viewlets/viewport.pt\n+++ b/plone/app/layout/viewlets/viewport.pt\n@@ -1 +1,3 @@\n-<meta name="viewport" content="width=device-width, initial-scale=1.0">\n\\ No newline at end of file\n+<meta name="viewport"\n+      content="width=device-width, initial-scale=1.0"\n+/>\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615de..eb8e6e8b 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,44 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\n+ignore-packages = [\'plone.app.relationfield\',]\ndiff --git a/setup.cfg b/setup.cfg\nindex 469f1a50..0da8f8fb 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,28 +1,23 @@\n-[check-manifest]\n-ignore =\n-    bootstrap.py\n-    jenkins.cfg\n-\n-[isort]\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n-\n-\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n \n [flake8]\n-# black compatible flake8 rules:\n+doctests = 1\n ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n     W503,\n-    C812,\n-    E501\n-    T001\n-    C813\n-# E203, E266\n-exclude = docs\n-max-line-length = 120\n-max-complexity = 18\n-select = B,C,E,F,W,T4,B9\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/setup.py b/setup.py\nindex 98e42772..12e16806 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -37,35 +37,28 @@\n     zip_safe=False,\n     python_requires=">=3.8",\n     install_requires=[\n-        "Acquisition",\n-        "DateTime",\n+        "BTrees",\n         "plone.app.content",\n+        "plone.app.multilingual",\n+        "plone.app.relationfield",\n+        "plone.app.uuid",\n         "plone.app.viewletmanager >=1.2",\n         "plone.base >=1.0.4",\n-        "plone.batching >=2.0.0",\n+        "plone.dexterity",\n+        "plone.formwidget.namedfile",\n         "plone.i18n",\n         "plone.memoize",\n         "plone.portlets",\n-        "plone.registry",\n-        "Products.CMFCore",\n-        "Products.CMFDynamicViewFTI",\n+        "plone.protect",\n         "Products.CMFEditions >=1.2.2",\n+        "Products.statusmessages",\n+        "Products.ZCatalog",\n         "setuptools",\n-        "zope.component",\n-        "zope.deferredimport",\n-        "zope.deprecation",\n-        "zope.dottedname",\n-        "zope.i18n",\n-        "zope.interface",\n-        "zope.publisher",\n-        "zope.schema",\n-        "zope.viewlet",\n         "Zope",\n     ],\n     extras_require=dict(\n         test=[\n-            "plone.app.contenttypes",\n-            "plone.app.intid",\n+            "plone.app.contenttypes[test]",\n             "plone.app.relationfield",\n             "plone.app.testing",\n             "plone.dexterity",\n@@ -73,6 +66,7 @@\n             "plone.testing",\n             "z3c.relationfield",\n             "zope.annotation",\n+            "zope.intid",\n         ]\n     ),\n )\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 00000000..00fd9f4c\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,68 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --all --test-path={toxinidir} -s plone.app.layout {posargs}\n+extras =\n+    test\n+\n+[testenv:coverage]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    coverage\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    coverage run {envbindir}/zope-testrunner --all --test-path={toxinidir} -s plone.app.layout {posargs}\n+    coverage report -m --format markdown\n+extras =\n+    test\n'

