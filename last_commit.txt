Repository: plone.app.widgets


Branch: refs/heads/master
Date: 2016-02-24T16:04:31+01:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/plone.app.widgets/commit/f74dfb4bd040f2b103283f05d9e304f93c5dd291

fix: ensure we have all content for tree query in relateditems

Files changed:
M CHANGES.rst
M plone/app/widgets/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d8ba9e2..e274393 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,9 @@ Fixes:
 - Ensure vocabulary lookup works on add forms for related items widget.
   [alecm]
 
+- Ensure we have all content for tree query in relateditems
+  [Gagaro]
+
 
 2.0.3 (2016-02-14)
 ------------------
diff --git a/plone/app/widgets/utils.py b/plone/app/widgets/utils.py
index 2d3dd27..0690721 100644
--- a/plone/app/widgets/utils.py
+++ b/plone/app/widgets/utils.py
@@ -120,6 +120,7 @@ def get_ajaxselect_options(context, value, separator, vocabulary_name,
 
 def get_relateditems_options(context, value, separator, vocabulary_name,
                              vocabulary_view, field_name=None):
+    portal = get_portal()
     options = get_ajaxselect_options(context, value, separator,
                                      vocabulary_name, vocabulary_view,
                                      field_name)
@@ -135,12 +136,16 @@ def get_relateditems_options(context, value, separator, vocabulary_name,
                        context=request)
     options.setdefault('homeText', msgstr)
     options.setdefault('folderTypes', ['Folder'])
+    options.setdefault(
+        'treeVocabularyUrl',
+        '{}/@@getVocabulary?name=plone.app.vocabularies.Catalog'.format(
+            portal is not None and portal.absolute_url() or '')
+   )
 
     nav_root = getNavigationRootObject(context, get_portal())
     options['rootPath'] = (
         '/'.join(nav_root.getPhysicalPath()) if nav_root else '/'
     )
-
     return options
 
 


Repository: plone.app.widgets


Branch: refs/heads/master
Date: 2016-02-24T09:24:06-06:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.widgets/commit/8d522235bbe917b12b5d38057f6504facba74290

Merge pull request #114 from plone/fix-relateditems-treequery

fix: ensure we have all content for tree query in relateditems

Files changed:
M CHANGES.rst
M plone/app/widgets/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d8ba9e2..e274393 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,9 @@ Fixes:
 - Ensure vocabulary lookup works on add forms for related items widget.
   [alecm]
 
+- Ensure we have all content for tree query in relateditems
+  [Gagaro]
+
 
 2.0.3 (2016-02-14)
 ------------------
diff --git a/plone/app/widgets/utils.py b/plone/app/widgets/utils.py
index 2d3dd27..0690721 100644
--- a/plone/app/widgets/utils.py
+++ b/plone/app/widgets/utils.py
@@ -120,6 +120,7 @@ def get_ajaxselect_options(context, value, separator, vocabulary_name,
 
 def get_relateditems_options(context, value, separator, vocabulary_name,
                              vocabulary_view, field_name=None):
+    portal = get_portal()
     options = get_ajaxselect_options(context, value, separator,
                                      vocabulary_name, vocabulary_view,
                                      field_name)
@@ -135,12 +136,16 @@ def get_relateditems_options(context, value, separator, vocabulary_name,
                        context=request)
     options.setdefault('homeText', msgstr)
     options.setdefault('folderTypes', ['Folder'])
+    options.setdefault(
+        'treeVocabularyUrl',
+        '{}/@@getVocabulary?name=plone.app.vocabularies.Catalog'.format(
+            portal is not None and portal.absolute_url() or '')
+   )
 
     nav_root = getNavigationRootObject(context, get_portal())
     options['rootPath'] = (
         '/'.join(nav_root.getPhysicalPath()) if nav_root else '/'
     )
-
     return options
 
 


