Repository: plone.app.vocabularies


Branch: refs/heads/master
Date: 2016-02-14T09:53:38+01:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/plone.app.vocabularies/commit/0859418033baa8843d265a629ee2acce3c239a0a

vocabulary for permissions

Files changed:
M CHANGES.rst
M plone/app/vocabularies/configure.zcml
M plone/app/vocabularies/security.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2df03f2..0ffbf90 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,8 @@ Changelog
 
 New:
 
-- *add item here*
+- Vocabulary for permissions
+  [ebrehault]
 
 Fixes:
 
diff --git a/plone/app/vocabularies/configure.zcml b/plone/app/vocabularies/configure.zcml
index bbe3570..25b0fb7 100644
--- a/plone/app/vocabularies/configure.zcml
+++ b/plone/app/vocabularies/configure.zcml
@@ -23,6 +23,11 @@
     />
 
   <utility
+    component=".security.PermissionsVocabularyFactory"
+    name="plone.app.vocabularies.Permissions"
+    />
+
+  <utility
     component=".types.AllowedContentTypesVocabularyFactory"
     name="plone.app.vocabularies.AllowedContentTypes"
     />
diff --git a/plone/app/vocabularies/security.py b/plone/app/vocabularies/security.py
index fb99c87..b18afc1 100644
--- a/plone/app/vocabularies/security.py
+++ b/plone/app/vocabularies/security.py
@@ -129,3 +129,17 @@ def __call__(self, context):
         return SimpleVocabulary(items)
 
 GroupsVocabularyFactory = GroupsVocabulary()
+
+
+@implementer(IVocabularyFactory)
+class PermissionsVocabulary(object):
+    """Vocabulary factory for permissions.
+    """
+
+    def __call__(self, context):
+        site = getSite()
+        items = [SimpleTerm(perm, perm, perm)
+            for perm in site.possible_permissions()]
+        return SimpleVocabulary(items)
+
+PermissionsVocabularyFactory = PermissionsVocabulary()


Repository: plone.app.vocabularies


Branch: refs/heads/master
Date: 2016-03-02T10:00:36+01:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/plone.app.vocabularies/commit/23956435af6587ab46ab9e68dd07d1a6e2e4fed7

Vocabulary for portal action categories

Files changed:
M CHANGES.rst
M README.rst
M plone/app/vocabularies/actions.py
M plone/app/vocabularies/configure.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 0ffbf90..e85153b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -9,6 +9,9 @@ New:
 - Vocabulary for permissions
   [ebrehault]
 
+- Vocabulary for portal action categories
+  [ebrehault]
+
 Fixes:
 
 - Make user vocabulary handle non-ASCII characters.
diff --git a/README.rst b/README.rst
index 8b09420..8188932 100644
--- a/README.rst
+++ b/README.rst
@@ -59,6 +59,16 @@ Portal Types
     Portal types filtered as 'user friendly' by the Types Tool.
 
 
+Portal actions
+--------------
+
+``plone.app.vocabularies.Actions``
+    All the actions category ids. Used in Actions portlet.
+
+``plone.app.vocabularies.PortalActionCategories``
+    All the actions categories (ids + translated title). Used in Actions control panel.
+
+
 Workflows
 ---------
 
diff --git a/plone/app/vocabularies/actions.py b/plone/app/vocabularies/actions.py
index 8e9a06a..dea115d 100644
--- a/plone/app/vocabularies/actions.py
+++ b/plone/app/vocabularies/actions.py
@@ -1,5 +1,6 @@
 # -*- coding:utf-8 -*-
 from Products.CMFCore.utils import getToolByName
+from Products.CMFPlone import PloneMessageFactory as _
 from zope.interface import implementer
 from zope.schema.interfaces import IVocabularyFactory
 from zope.schema.vocabulary import SimpleTerm
@@ -26,3 +27,26 @@ def __call__(self, context):
 
 
 ActionCategoriesVocabularyFactory = ActionCategoriesVocabulary()
+
+
+@implementer(IVocabularyFactory)
+class PortalActionCategoriesVocabulary(object):
+    """Provides portal action categories vocabulary."""
+
+    def __call__(self, context):
+        portal_actions = getToolByName(context, 'portal_actions')
+        categories = portal_actions.objectIds()
+        categories.sort()
+        terms = []
+        for category in categories:
+            if category == 'controlpanel':
+                continue
+            title = portal_actions.get(category).title
+            if title:
+                title = _(title)
+            else:
+                title = category
+            terms.append(SimpleTerm(category, title=title))
+        return SimpleVocabulary(terms)
+
+PortalActionCategoriesVocabularyFactory = PortalActionCategoriesVocabulary()
diff --git a/plone/app/vocabularies/configure.zcml b/plone/app/vocabularies/configure.zcml
index 25b0fb7..7dbc17b 100644
--- a/plone/app/vocabularies/configure.zcml
+++ b/plone/app/vocabularies/configure.zcml
@@ -108,6 +108,11 @@
     />
 
   <utility
+    component=".actions.PortalActionCategoriesVocabularyFactory"
+    name="plone.app.vocabularies.PortalActionCategories"
+    />
+
+  <utility
     component=".datetimerelated.TimezonesFactory"
     name="plone.app.vocabularies.Timezones"
     />


Repository: plone.app.vocabularies


Branch: refs/heads/master
Date: 2016-03-02T10:07:14+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.vocabularies/commit/5f6fdba4931fc81eff775dcb1dc3baeb0dc3c199

Merge pull request #26 from plone/plip-1342-portal-actions

part of Plip 1342: portal actions controlpanel

Files changed:
M CHANGES.rst
M README.rst
M plone/app/vocabularies/actions.py
M plone/app/vocabularies/configure.zcml
M plone/app/vocabularies/security.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2610a3c..3df3c36 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,11 @@ Incompatibilities:
 
 New:
 
-- *add item here*
+- Vocabulary for permissions
+  [ebrehault]
+
+- Vocabulary for portal action categories
+  [ebrehault]
 
 Fixes:
 
diff --git a/README.rst b/README.rst
index 8b09420..8188932 100644
--- a/README.rst
+++ b/README.rst
@@ -59,6 +59,16 @@ Portal Types
     Portal types filtered as 'user friendly' by the Types Tool.
 
 
+Portal actions
+--------------
+
+``plone.app.vocabularies.Actions``
+    All the actions category ids. Used in Actions portlet.
+
+``plone.app.vocabularies.PortalActionCategories``
+    All the actions categories (ids + translated title). Used in Actions control panel.
+
+
 Workflows
 ---------
 
diff --git a/plone/app/vocabularies/actions.py b/plone/app/vocabularies/actions.py
index 8e9a06a..dea115d 100644
--- a/plone/app/vocabularies/actions.py
+++ b/plone/app/vocabularies/actions.py
@@ -1,5 +1,6 @@
 # -*- coding:utf-8 -*-
 from Products.CMFCore.utils import getToolByName
+from Products.CMFPlone import PloneMessageFactory as _
 from zope.interface import implementer
 from zope.schema.interfaces import IVocabularyFactory
 from zope.schema.vocabulary import SimpleTerm
@@ -26,3 +27,26 @@ def __call__(self, context):
 
 
 ActionCategoriesVocabularyFactory = ActionCategoriesVocabulary()
+
+
+@implementer(IVocabularyFactory)
+class PortalActionCategoriesVocabulary(object):
+    """Provides portal action categories vocabulary."""
+
+    def __call__(self, context):
+        portal_actions = getToolByName(context, 'portal_actions')
+        categories = portal_actions.objectIds()
+        categories.sort()
+        terms = []
+        for category in categories:
+            if category == 'controlpanel':
+                continue
+            title = portal_actions.get(category).title
+            if title:
+                title = _(title)
+            else:
+                title = category
+            terms.append(SimpleTerm(category, title=title))
+        return SimpleVocabulary(terms)
+
+PortalActionCategoriesVocabularyFactory = PortalActionCategoriesVocabulary()
diff --git a/plone/app/vocabularies/configure.zcml b/plone/app/vocabularies/configure.zcml
index bbe3570..7dbc17b 100644
--- a/plone/app/vocabularies/configure.zcml
+++ b/plone/app/vocabularies/configure.zcml
@@ -23,6 +23,11 @@
     />
 
   <utility
+    component=".security.PermissionsVocabularyFactory"
+    name="plone.app.vocabularies.Permissions"
+    />
+
+  <utility
     component=".types.AllowedContentTypesVocabularyFactory"
     name="plone.app.vocabularies.AllowedContentTypes"
     />
@@ -103,6 +108,11 @@
     />
 
   <utility
+    component=".actions.PortalActionCategoriesVocabularyFactory"
+    name="plone.app.vocabularies.PortalActionCategories"
+    />
+
+  <utility
     component=".datetimerelated.TimezonesFactory"
     name="plone.app.vocabularies.Timezones"
     />
diff --git a/plone/app/vocabularies/security.py b/plone/app/vocabularies/security.py
index fb99c87..b18afc1 100644
--- a/plone/app/vocabularies/security.py
+++ b/plone/app/vocabularies/security.py
@@ -129,3 +129,17 @@ def __call__(self, context):
         return SimpleVocabulary(items)
 
 GroupsVocabularyFactory = GroupsVocabulary()
+
+
+@implementer(IVocabularyFactory)
+class PermissionsVocabulary(object):
+    """Vocabulary factory for permissions.
+    """
+
+    def __call__(self, context):
+        site = getSite()
+        items = [SimpleTerm(perm, perm, perm)
+            for perm in site.possible_permissions()]
+        return SimpleVocabulary(items)
+
+PermissionsVocabularyFactory = PermissionsVocabulary()


