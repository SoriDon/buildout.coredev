Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2018-05-07T11:09:03-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.portlets/commit/fbc0aef1957474f7024870df69bdc96370b52da5

Test against p.a.contenttypes instead of Archetypes

Files changed:
M CHANGES.rst
M plone/app/portlets/testing.py
M plone/app/portlets/tests/test_actions_portlet.py
M plone/app/portlets/tests/test_classic_portlet.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 098edfb..a8e71a0 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -26,6 +26,9 @@ Bug fixes:
   to check permission.
   [davisagli]
 
+- Test against plone.app.contenttypes instead of ATContentTypes.
+  [davisagli]
+
 - *add item here*
 
 
diff --git a/plone/app/portlets/testing.py b/plone/app/portlets/testing.py
index 79a339c..7f7e11f 100644
--- a/plone/app/portlets/testing.py
+++ b/plone/app/portlets/testing.py
@@ -17,8 +17,6 @@ class PloneAppPortlets(PloneSandboxLayer):
     defaultBases = (PLONE_FIXTURE,)
 
     def setUpZope(self, app, configurationContext):
-        z2.installProduct(app, 'Products.ATContentTypes')
-        z2.installProduct(app, 'plone.app.blob')
         z2.installProduct(app, 'plone.app.portlets')
 
         # Include testing profile
@@ -28,7 +26,7 @@ def setUpZope(self, app, configurationContext):
                        context=configurationContext)
 
     def setUpPloneSite(self, portal):
-        applyProfile(portal, 'Products.ATContentTypes:default')
+        applyProfile(portal, 'plone.app.contenttypes:default')
 
         setRoles(portal, TEST_USER_ID, ['Manager'])
         login(portal, TEST_USER_NAME)
diff --git a/plone/app/portlets/tests/test_actions_portlet.py b/plone/app/portlets/tests/test_actions_portlet.py
index 9d84703..7286660 100644
--- a/plone/app/portlets/tests/test_actions_portlet.py
+++ b/plone/app/portlets/tests/test_actions_portlet.py
@@ -190,7 +190,7 @@ def test_object_buttons(self):
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
         got = set([six.text_type(link['title']) for link in output])
-        self.failUnlessEqual(got, expected)
+        self.assertTrue(expected.issubset(got))
 
     def test_category(self):
         r = self.renderer(
@@ -220,4 +220,4 @@ def test_object_buttons_with_icons(self):
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
         got = set([six.text_type(link['title']) for link in output])
-        self.failUnlessEqual(got, expected)
+        self.assertTrue(expected.issubset(got))
diff --git a/plone/app/portlets/tests/test_classic_portlet.py b/plone/app/portlets/tests/test_classic_portlet.py
index 37ac8f9..cfd1695 100644
--- a/plone/app/portlets/tests/test_classic_portlet.py
+++ b/plone/app/portlets/tests/test_classic_portlet.py
@@ -94,7 +94,7 @@ def testPathExpression(self):
         self.assertEqual('context/portlet_recent', r.path_expression())
 
     def testRenderClassicPortlet(self):
-        r = self.renderer(assignment=classic.Assignment(template='base_view', macro='content-core'))
+        r = self.renderer(assignment=classic.Assignment(template='@@view', macro='content-core'))
         r.render()
 
 
diff --git a/setup.py b/setup.py
index 89ff3e9..d944881 100644
--- a/setup.py
+++ b/setup.py
@@ -32,8 +32,6 @@
     zip_safe=False,
     extras_require=dict(
         test=[
-            'Products.ATContentTypes',
-            'plone.app.blob',
             'plone.app.testing',
         ],
     ),


Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2018-05-07T12:27:06-04:00
Author: David Glick (davisagli) <david.glick@plone.org>
Commit: https://github.com/plone/plone.app.portlets/commit/9a6c8e40ce4d08f81591d0515aec2f24215ecae6

Merge pull request #112 from plone/no-at-master

Test against p.a.contenttypes instead of Archetypes

Files changed:
M CHANGES.rst
M plone/app/portlets/testing.py
M plone/app/portlets/tests/test_actions_portlet.py
M plone/app/portlets/tests/test_classic_portlet.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 098edfb..a8e71a0 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -26,6 +26,9 @@ Bug fixes:
   to check permission.
   [davisagli]
 
+- Test against plone.app.contenttypes instead of ATContentTypes.
+  [davisagli]
+
 - *add item here*
 
 
diff --git a/plone/app/portlets/testing.py b/plone/app/portlets/testing.py
index 79a339c..7f7e11f 100644
--- a/plone/app/portlets/testing.py
+++ b/plone/app/portlets/testing.py
@@ -17,8 +17,6 @@ class PloneAppPortlets(PloneSandboxLayer):
     defaultBases = (PLONE_FIXTURE,)
 
     def setUpZope(self, app, configurationContext):
-        z2.installProduct(app, 'Products.ATContentTypes')
-        z2.installProduct(app, 'plone.app.blob')
         z2.installProduct(app, 'plone.app.portlets')
 
         # Include testing profile
@@ -28,7 +26,7 @@ def setUpZope(self, app, configurationContext):
                        context=configurationContext)
 
     def setUpPloneSite(self, portal):
-        applyProfile(portal, 'Products.ATContentTypes:default')
+        applyProfile(portal, 'plone.app.contenttypes:default')
 
         setRoles(portal, TEST_USER_ID, ['Manager'])
         login(portal, TEST_USER_NAME)
diff --git a/plone/app/portlets/tests/test_actions_portlet.py b/plone/app/portlets/tests/test_actions_portlet.py
index 9d84703..7286660 100644
--- a/plone/app/portlets/tests/test_actions_portlet.py
+++ b/plone/app/portlets/tests/test_actions_portlet.py
@@ -190,7 +190,7 @@ def test_object_buttons(self):
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
         got = set([six.text_type(link['title']) for link in output])
-        self.failUnlessEqual(got, expected)
+        self.assertTrue(expected.issubset(got))
 
     def test_category(self):
         r = self.renderer(
@@ -220,4 +220,4 @@ def test_object_buttons_with_icons(self):
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
         got = set([six.text_type(link['title']) for link in output])
-        self.failUnlessEqual(got, expected)
+        self.assertTrue(expected.issubset(got))
diff --git a/plone/app/portlets/tests/test_classic_portlet.py b/plone/app/portlets/tests/test_classic_portlet.py
index 37ac8f9..cfd1695 100644
--- a/plone/app/portlets/tests/test_classic_portlet.py
+++ b/plone/app/portlets/tests/test_classic_portlet.py
@@ -94,7 +94,7 @@ def testPathExpression(self):
         self.assertEqual('context/portlet_recent', r.path_expression())
 
     def testRenderClassicPortlet(self):
-        r = self.renderer(assignment=classic.Assignment(template='base_view', macro='content-core'))
+        r = self.renderer(assignment=classic.Assignment(template='@@view', macro='content-core'))
         r.render()
 
 
diff --git a/setup.py b/setup.py
index 89ff3e9..d944881 100644
--- a/setup.py
+++ b/setup.py
@@ -32,8 +32,6 @@
     zip_safe=False,
     extras_require=dict(
         test=[
-            'Products.ATContentTypes',
-            'plone.app.blob',
             'plone.app.testing',
         ],
     ),


