Repository: plone.app.content


Branch: refs/heads/master
Date: 2022-01-18T12:46:40+01:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/63bb9369777951caadd9972bb69ee62306db1212

Use the human_readable_size method from the @@plone view (#241)

Fixes #240

Files changed:
A news/240.breaking
M plone/app/content/browser/content_status_history.py
M plone/app/content/browser/templates/content_status_history.pt

b'diff --git a/news/240.breaking b/news/240.breaking\nnew file mode 100644\nindex 0000000..01f5dde\n--- /dev/null\n+++ b/news/240.breaking\n@@ -0,0 +1,2 @@\n+Deprecate the human_readable_size mehtod of the ContentStatusHistoryView class because the one from the @@plone view should be used\n+[ale-rt]\ndiff --git a/plone/app/content/browser/content_status_history.py b/plone/app/content/browser/content_status_history.py\nindex db32576..94f05fa 100644\n--- a/plone/app/content/browser/content_status_history.py\n+++ b/plone/app/content/browser/content_status_history.py\n@@ -3,12 +3,12 @@\n from Products.CMFPlone.utils import human_readable_size, isExpired\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from z3c.form import field, form\n+from zope.deprecation.deprecation import deprecate\n from zope.interface import Interface\n from zope.publisher.browser import BrowserView\n from zope.schema import Datetime\n from zope.schema.fieldproperty import FieldProperty\n \n-\n class IContentStatusHistoryDates(Interface):\n     """Interface for the two dates on content status history view"""\n \n@@ -134,5 +134,9 @@ def redirect_to_referrer(self):\n     def isExpired(self, content):\n         return isExpired(content)\n \n+    @deprecate(\n+        "This method is deprecated since Plone 6, "\n+        "use the @@plone/human_readable_size method instead"\n+    )\n     def human_readable_size(self, size):\n         return human_readable_size(size)\ndiff --git a/plone/app/content/browser/templates/content_status_history.pt b/plone/app/content/browser/templates/content_status_history.pt\nindex 99980b0..cff394c 100644\n--- a/plone/app/content/browser/templates/content_status_history.pt\n+++ b/plone/app/content/browser/templates/content_status_history.pt\n@@ -123,7 +123,7 @@\n                                            item_title_or_id     item/pretty_title_or_id;\n                                            item_description     item/Description;\n                                            item_type            item/portal_type;\n-                                           item_size            python:view.human_readable_size(item.get_size());\n+                                           item_size            python:plone_view.human_readable_size(item.get_size());\n                                            item_modified        item/ModificationDate;\n                                            item_type_class      python:\'contenttype-\' + normalizeString(item_type);\n                                            item_wf_state        item/review_state|python: wtool.getInfoFor(item, \'review_state\', \'\');\n'

