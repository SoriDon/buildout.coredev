Repository: mockup


Branch: refs/heads/master
Date: 2022-06-02T11:03:08+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/mockup/commit/a42f4a9b2eb287d1207cd6706a932045b6d0fc02

maint(Build): update datatables.net

Files changed:
M package.json

b'diff --git a/package.json b/package.json\nindex b056f2515..c0c38c969 100644\n--- a/package.json\n+++ b/package.json\n@@ -16,8 +16,8 @@\n         "bootstrap": "^5.2.0-beta1",\n         "bootstrap-icons": "^1.8.2",\n         "cs-jqtree-contextmenu": "0.1.0",\n-        "datatables.net": "^1.12.0",\n-        "datatables.net-bs5": "^1.12.0",\n+        "datatables.net": "^1.12.1",\n+        "datatables.net-bs5": "^1.12.1",\n         "datatables.net-buttons": "^2.2.3",\n         "datatables.net-buttons-bs5": "^2.2.3",\n         "datatables.net-colreorder": "^1.5.6",\n'

Repository: mockup


Branch: refs/heads/master
Date: 2022-06-02T11:03:48+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/mockup/commit/7f8bd233f119a17261bab6d80cdd4e1f75e85e79

yarn install

Files changed:
M yarn.lock

b'diff --git a/yarn.lock b/yarn.lock\nindex 035f0a54e..eacf2f88e 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -3937,7 +3937,7 @@ data-uri-to-buffer@3:\n   resolved "https://registry.yarnpkg.com/data-uri-to-buffer/-/data-uri-to-buffer-3.0.1.tgz#594b8973938c5bc2c33046535785341abc4f3636"\n   integrity sha512-WboRycPNsVw3B3TL559F7kuBUM4d8CgMEvk6xEJlOp7OBPjt6G7z8WMWlD2rOFZLk6OYfFIUGsCOWzcQH9K2og==\n \n-datatables.net-bs5@>=1.11.3, datatables.net-bs5@^1.12.0:\n+datatables.net-bs5@>=1.11.3, datatables.net-bs5@^1.12.1:\n   version "1.12.1"\n   resolved "https://registry.yarnpkg.com/datatables.net-bs5/-/datatables.net-bs5-1.12.1.tgz#b05d4bcaed77f6b77df0b50eaf1d5ec8e5d476bd"\n   integrity sha512-CcQCImfmH4YZk7I0aC0kTiNPyfHJ2ueGgOh/kFB9KqsZD8bNJy2A88gC6hn9A7TbmmenOL+K3Q1ti7G8yqi8SQ==\n@@ -4045,7 +4045,7 @@ datatables.net-select@>=1.3.3, datatables.net-select@^1.4.0:\n     datatables.net ">=1.11.3"\n     jquery ">=1.7"\n \n-datatables.net@>=1.11.3, datatables.net@^1.10.15, datatables.net@^1.12.0:\n+datatables.net@>=1.11.3, datatables.net@^1.10.15, datatables.net@^1.12.1:\n   version "1.12.1"\n   resolved "https://registry.yarnpkg.com/datatables.net/-/datatables.net-1.12.1.tgz#3e625e49a3341f605b0efb519fae94e37b278f24"\n   integrity sha512-e6XAMUoV41JdQPS/r9YRfRcmTPcCVvyZbWI+xog1Zg+kjVliMQbEkvWK5XFItmi64Cvwg+IqsZbTUJ1KSY3umA==\n'

Repository: mockup


Branch: refs/heads/master
Date: 2022-06-02T11:04:15+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/mockup/commit/a3335ffb2f258c7b30490ab785d9fc1abd6f7c33

fix(pat structure): datatable sorting

Files changed:
M src/pat/structure/js/views/table.js
M src/pat/structure/templates/table.xml

b'diff --git a/src/pat/structure/js/views/table.js b/src/pat/structure/js/views/table.js\nindex dd8c2086f..0a7663f81 100644\n--- a/src/pat/structure/js/views/table.js\n+++ b/src/pat/structure/js/views/table.js\n@@ -75,10 +75,10 @@ export default BaseView.extend({\n \n         const datatables_options = {\n             order: [0, "asc"],\n-            aoColumnDefs: [\n+            columnDefs: [\n                 {\n-                    bSortable: false,\n-                    aTargets: [0, this.app.activeColumns.length + 2],\n+                    orderable: false,\n+                    targets: [0, this.app.activeColumns.length + 1],\n                 },\n             ],\n             paging: false,\ndiff --git a/src/pat/structure/templates/table.xml b/src/pat/structure/templates/table.xml\nindex 9ce847fb2..2c0df507b 100644\n--- a/src/pat/structure/templates/table.xml\n+++ b/src/pat/structure/templates/table.xml\n@@ -1,5 +1,5 @@\n <div class="fc-breadcrumbs-container">\n-  <div class="fc-breadcrumbs" colspan="<%- activeColumns.length + 3 %>">\n+  <div class="fc-breadcrumbs">\n     <a href="#" title="<%- _t(\'Root\') %>" aria-label="<%- _t(\'Root\') %>" data-path="/">\n       <%= homeIcon %> /\n     </a>\n'

Repository: mockup


Branch: refs/heads/master
Date: 2022-06-02T11:12:40+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/mockup/commit/179fb41bd8cfd709eacde7778ab687374b39b9e1

fix(pat structure): row actions cut/copy/default_page

Files changed:
M src/pat/structure/js/actions.js

b'diff --git a/src/pat/structure/js/actions.js b/src/pat/structure/js/actions.js\nindex 57f01e90d..ebb8811d9 100644\n--- a/src/pat/structure/js/actions.js\n+++ b/src/pat/structure/js/actions.js\n@@ -69,10 +69,10 @@ export default Backbone.Model.extend({\n         const url = new URL(this.app.buttons.get(buttonName).options.url);\n         const resp = await fetch(url, {\n             headers: {\n-                Accept: "application/json",\n+                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",\n             },\n             method: "POST",\n-            body: JSON.stringify({\n+            body: new URLSearchParams({\n                 selection: JSON.stringify([this.model.attributes.UID]),\n                 folder: this.model.attributes.path,\n                 _authenticator: utils.getAuthenticator(),\n@@ -80,18 +80,19 @@ export default Backbone.Model.extend({\n         });\n         const data = await resp.json();\n \n-        let msg;\n+        let msg, state_type = "warning";\n         if (data.status === "success") {\n             msg = _t(`${successMsg} "${this.model.attributes.Title}"`);\n             this.app.collection.fetch();\n             this.app.updateButtons();\n         } else {\n-            msg = _t(`Error ${failMsg} "${this.model.attributes.Title}"`);\n+            msg = _t("Error") + `: ${failMsg} "${this.model.attributes.Title}"`;\n+            state_type = "danger";\n         }\n         this.app.clearStatus();\n         this.app.setStatus({\n             text: msg,\n-            type: data.status || "warning",\n+            type: data.status || state_type,\n         });\n     },\n \n@@ -125,10 +126,13 @@ export default Backbone.Model.extend({\n         try {\n             const url = new URL(this.app.getAjaxUrl(this.app.setDefaultPageUrl));\n             const resp = await fetch(url, {\n+                headers: {\n+                    "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",\n+                },\n                 method: "POST",\n-                body: JSON.stringify({\n+                body: new URLSearchParams({\n                     id: this.model.attributes.id,\n-                    _authenticator: $(\'[name="_authenticator"]\').val(),\n+                    _authenticator: utils.getAuthenticator(),\n                 }),\n             });\n             const data = await resp.json();\n'

Repository: mockup


Branch: refs/heads/master
Date: 2022-06-02T15:59:04+02:00
Author: petschki (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/mockup/commit/eeafed0db3eab6aee0b26593c17bd5f730050db2

maint(Bundle): new underscore release

Files changed:
M package.json

b'diff --git a/package.json b/package.json\nindex c0c38c969..52c703f7a 100644\n--- a/package.json\n+++ b/package.json\n@@ -41,7 +41,7 @@\n         "sortablejs": "^1.15.0",\n         "tinymce": "^5.10.2",\n         "tinymce-i18n": "^20.12.25",\n-        "underscore": "git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626"\n+        "underscore": "^1.13.4"\n     },\n     "devDependencies": {\n         "@11ty/eleventy": "^0.12.1",\n@@ -95,7 +95,7 @@\n         "@patternslib/patternslib": "8.1.0-alpha.1",\n         "backbone": "1.4.1",\n         "jquery": "3.6.0",\n-        "underscore": "git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626"\n+        "underscore": "1.13.4"\n     },\n     "scripts": {\n         "clean": "rimraf docs/_site",\n'

Repository: mockup


Branch: refs/heads/master
Date: 2022-06-02T15:59:19+02:00
Author: petschki (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/mockup/commit/1dc5973c665f140f489e8691316340292c1c5573

yarn install

Files changed:
M yarn.lock

b'diff --git a/yarn.lock b/yarn.lock\nindex eacf2f88e..02ad721c7 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -10087,9 +10087,10 @@ unc-path-regex@^0.1.2:\n   resolved "https://registry.yarnpkg.com/unc-path-regex/-/unc-path-regex-0.1.2.tgz#e73dd3d7b0d7c5ed86fbac6b0ae7d8c6a69d50fa"\n   integrity sha1-5z3T17DXxe2G+6xrCufYxqadUPo=\n \n-underscore@>=1.8.3, underscore@^1.8.0, "underscore@git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626":\n-  version "1.13.3"\n-  resolved "git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626"\n+underscore@1.13.4, underscore@>=1.8.3, underscore@^1.13.4, underscore@^1.8.0:\n+  version "1.13.4"\n+  resolved "https://registry.yarnpkg.com/underscore/-/underscore-1.13.4.tgz#7886b46bbdf07f768e0052f1828e1dcab40c0dee"\n+  integrity sha512-BQFnUDuAQ4Yf/cYY5LNrK9NCJFKriaRbD9uR1fTeXnBeoa97W0i41qkZfGO9pSo8I5KzjAcSY2XYtdf0oKd7KQ==\n \n unicode-canonical-property-names-ecmascript@^2.0.0:\n   version "2.0.0"\n'

Repository: mockup


Branch: refs/heads/master
Date: 2022-06-02T16:03:38+02:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/mockup/commit/98e9993db5ad948a2575703a0e750bd877925657

Merge pull request #1173 from plone/pat-structure-fixes

pat-structure fixes

Files changed:
M package.json
M src/pat/structure/js/actions.js
M src/pat/structure/js/views/table.js
M src/pat/structure/templates/table.xml
M yarn.lock

b'diff --git a/package.json b/package.json\nindex b056f2515..52c703f7a 100644\n--- a/package.json\n+++ b/package.json\n@@ -16,8 +16,8 @@\n         "bootstrap": "^5.2.0-beta1",\n         "bootstrap-icons": "^1.8.2",\n         "cs-jqtree-contextmenu": "0.1.0",\n-        "datatables.net": "^1.12.0",\n-        "datatables.net-bs5": "^1.12.0",\n+        "datatables.net": "^1.12.1",\n+        "datatables.net-bs5": "^1.12.1",\n         "datatables.net-buttons": "^2.2.3",\n         "datatables.net-buttons-bs5": "^2.2.3",\n         "datatables.net-colreorder": "^1.5.6",\n@@ -41,7 +41,7 @@\n         "sortablejs": "^1.15.0",\n         "tinymce": "^5.10.2",\n         "tinymce-i18n": "^20.12.25",\n-        "underscore": "git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626"\n+        "underscore": "^1.13.4"\n     },\n     "devDependencies": {\n         "@11ty/eleventy": "^0.12.1",\n@@ -95,7 +95,7 @@\n         "@patternslib/patternslib": "8.1.0-alpha.1",\n         "backbone": "1.4.1",\n         "jquery": "3.6.0",\n-        "underscore": "git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626"\n+        "underscore": "1.13.4"\n     },\n     "scripts": {\n         "clean": "rimraf docs/_site",\ndiff --git a/src/pat/structure/js/actions.js b/src/pat/structure/js/actions.js\nindex 57f01e90d..ebb8811d9 100644\n--- a/src/pat/structure/js/actions.js\n+++ b/src/pat/structure/js/actions.js\n@@ -69,10 +69,10 @@ export default Backbone.Model.extend({\n         const url = new URL(this.app.buttons.get(buttonName).options.url);\n         const resp = await fetch(url, {\n             headers: {\n-                Accept: "application/json",\n+                "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",\n             },\n             method: "POST",\n-            body: JSON.stringify({\n+            body: new URLSearchParams({\n                 selection: JSON.stringify([this.model.attributes.UID]),\n                 folder: this.model.attributes.path,\n                 _authenticator: utils.getAuthenticator(),\n@@ -80,18 +80,19 @@ export default Backbone.Model.extend({\n         });\n         const data = await resp.json();\n \n-        let msg;\n+        let msg, state_type = "warning";\n         if (data.status === "success") {\n             msg = _t(`${successMsg} "${this.model.attributes.Title}"`);\n             this.app.collection.fetch();\n             this.app.updateButtons();\n         } else {\n-            msg = _t(`Error ${failMsg} "${this.model.attributes.Title}"`);\n+            msg = _t("Error") + `: ${failMsg} "${this.model.attributes.Title}"`;\n+            state_type = "danger";\n         }\n         this.app.clearStatus();\n         this.app.setStatus({\n             text: msg,\n-            type: data.status || "warning",\n+            type: data.status || state_type,\n         });\n     },\n \n@@ -125,10 +126,13 @@ export default Backbone.Model.extend({\n         try {\n             const url = new URL(this.app.getAjaxUrl(this.app.setDefaultPageUrl));\n             const resp = await fetch(url, {\n+                headers: {\n+                    "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",\n+                },\n                 method: "POST",\n-                body: JSON.stringify({\n+                body: new URLSearchParams({\n                     id: this.model.attributes.id,\n-                    _authenticator: $(\'[name="_authenticator"]\').val(),\n+                    _authenticator: utils.getAuthenticator(),\n                 }),\n             });\n             const data = await resp.json();\ndiff --git a/src/pat/structure/js/views/table.js b/src/pat/structure/js/views/table.js\nindex dd8c2086f..0a7663f81 100644\n--- a/src/pat/structure/js/views/table.js\n+++ b/src/pat/structure/js/views/table.js\n@@ -75,10 +75,10 @@ export default BaseView.extend({\n \n         const datatables_options = {\n             order: [0, "asc"],\n-            aoColumnDefs: [\n+            columnDefs: [\n                 {\n-                    bSortable: false,\n-                    aTargets: [0, this.app.activeColumns.length + 2],\n+                    orderable: false,\n+                    targets: [0, this.app.activeColumns.length + 1],\n                 },\n             ],\n             paging: false,\ndiff --git a/src/pat/structure/templates/table.xml b/src/pat/structure/templates/table.xml\nindex 9ce847fb2..2c0df507b 100644\n--- a/src/pat/structure/templates/table.xml\n+++ b/src/pat/structure/templates/table.xml\n@@ -1,5 +1,5 @@\n <div class="fc-breadcrumbs-container">\n-  <div class="fc-breadcrumbs" colspan="<%- activeColumns.length + 3 %>">\n+  <div class="fc-breadcrumbs">\n     <a href="#" title="<%- _t(\'Root\') %>" aria-label="<%- _t(\'Root\') %>" data-path="/">\n       <%= homeIcon %> /\n     </a>\ndiff --git a/yarn.lock b/yarn.lock\nindex 035f0a54e..02ad721c7 100644\n--- a/yarn.lock\n+++ b/yarn.lock\n@@ -3937,7 +3937,7 @@ data-uri-to-buffer@3:\n   resolved "https://registry.yarnpkg.com/data-uri-to-buffer/-/data-uri-to-buffer-3.0.1.tgz#594b8973938c5bc2c33046535785341abc4f3636"\n   integrity sha512-WboRycPNsVw3B3TL559F7kuBUM4d8CgMEvk6xEJlOp7OBPjt6G7z8WMWlD2rOFZLk6OYfFIUGsCOWzcQH9K2og==\n \n-datatables.net-bs5@>=1.11.3, datatables.net-bs5@^1.12.0:\n+datatables.net-bs5@>=1.11.3, datatables.net-bs5@^1.12.1:\n   version "1.12.1"\n   resolved "https://registry.yarnpkg.com/datatables.net-bs5/-/datatables.net-bs5-1.12.1.tgz#b05d4bcaed77f6b77df0b50eaf1d5ec8e5d476bd"\n   integrity sha512-CcQCImfmH4YZk7I0aC0kTiNPyfHJ2ueGgOh/kFB9KqsZD8bNJy2A88gC6hn9A7TbmmenOL+K3Q1ti7G8yqi8SQ==\n@@ -4045,7 +4045,7 @@ datatables.net-select@>=1.3.3, datatables.net-select@^1.4.0:\n     datatables.net ">=1.11.3"\n     jquery ">=1.7"\n \n-datatables.net@>=1.11.3, datatables.net@^1.10.15, datatables.net@^1.12.0:\n+datatables.net@>=1.11.3, datatables.net@^1.10.15, datatables.net@^1.12.1:\n   version "1.12.1"\n   resolved "https://registry.yarnpkg.com/datatables.net/-/datatables.net-1.12.1.tgz#3e625e49a3341f605b0efb519fae94e37b278f24"\n   integrity sha512-e6XAMUoV41JdQPS/r9YRfRcmTPcCVvyZbWI+xog1Zg+kjVliMQbEkvWK5XFItmi64Cvwg+IqsZbTUJ1KSY3umA==\n@@ -10087,9 +10087,10 @@ unc-path-regex@^0.1.2:\n   resolved "https://registry.yarnpkg.com/unc-path-regex/-/unc-path-regex-0.1.2.tgz#e73dd3d7b0d7c5ed86fbac6b0ae7d8c6a69d50fa"\n   integrity sha1-5z3T17DXxe2G+6xrCufYxqadUPo=\n \n-underscore@>=1.8.3, underscore@^1.8.0, "underscore@git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626":\n-  version "1.13.3"\n-  resolved "git+https://github.com/jashkenas/underscore.git#75d257fa10131c3d65d870dd22095cb187cd1626"\n+underscore@1.13.4, underscore@>=1.8.3, underscore@^1.13.4, underscore@^1.8.0:\n+  version "1.13.4"\n+  resolved "https://registry.yarnpkg.com/underscore/-/underscore-1.13.4.tgz#7886b46bbdf07f768e0052f1828e1dcab40c0dee"\n+  integrity sha512-BQFnUDuAQ4Yf/cYY5LNrK9NCJFKriaRbD9uR1fTeXnBeoa97W0i41qkZfGO9pSo8I5KzjAcSY2XYtdf0oKd7KQ==\n \n unicode-canonical-property-names-ecmascript@^2.0.0:\n   version "2.0.0"\n'

