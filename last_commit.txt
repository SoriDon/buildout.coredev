Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2016-02-24T10:23:11+01:00
Author: Benoît Suttor (bsuttor) <benoit.suttor@imio.be>
Commit: https://github.com/plone/plone.app.contenttypes/commit/0ac18aad12f1080f363cf6e0904f922445cf53b2

Check if there is an image into leadimage field for migration.

Files changed:
M plone/app/contenttypes/migration/utils.py

diff --git a/plone/app/contenttypes/migration/utils.py b/plone/app/contenttypes/migration/utils.py
index 11104b4..7d77f7a 100644
--- a/plone/app/contenttypes/migration/utils.py
+++ b/plone/app/contenttypes/migration/utils.py
@@ -213,6 +213,12 @@ def migrate_leadimage(source_object, target_object):
                     "Could not migrate collective.leadimage fields.")
         return
 
+    acc = source_object.getField(
+        OLD_LEADIMAGE_FIELD_NAME).getAccessor(source_object)()
+    if getattr(acc, 'filename', None) is None:
+        # skip if old content has field but has no lead image in the field
+        return
+
     # handle image field
     migrate_imagefield(
         source_object,
@@ -227,7 +233,8 @@ def migrate_leadimage(source_object, target_object):
         OLD_CAPTION_FIELD_NAME,
         NEW_CAPTION_FIELD_NAME)
     logger.info(
-        "Migrating contentlead image for." % target_object.absolute_url())
+        "Migrating contentlead image for {0}.".format(
+            target_object.absolute_url()))
 
 
 def migrate_portlets(src_obj, dst_obj):


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2016-02-24T10:23:11+01:00
Author: Benoît Suttor (bsuttor) <benoit.suttor@imio.be>
Commit: https://github.com/plone/plone.app.contenttypes/commit/73b58afa9310e3ab5e1be31b2821b76d94d9686b

Update changelog

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index dde415c..672d35d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,8 @@ Fixes:
 
 - Make sure to have image scale before generating tag for album view
   [vangheem]
+- Check if there is an image into leadimage field for migration.
+  [bsuttor]
 
 - Also remove collections upon uninstalling.
   [pbauer]


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2016-02-24T10:23:11+01:00
Author: Benoît Suttor (bsuttor) <benoit.suttor@imio.be>
Commit: https://github.com/plone/plone.app.contenttypes/commit/2d185d23354662145e97a84a50a8a02c14725e65

lint

Files changed:
M plone/app/contenttypes/migration/utils.py

diff --git a/plone/app/contenttypes/migration/utils.py b/plone/app/contenttypes/migration/utils.py
index 7d77f7a..bfac29c 100644
--- a/plone/app/contenttypes/migration/utils.py
+++ b/plone/app/contenttypes/migration/utils.py
@@ -232,9 +232,8 @@ def migrate_leadimage(source_object, target_object):
         target_object,
         OLD_CAPTION_FIELD_NAME,
         NEW_CAPTION_FIELD_NAME)
-    logger.info(
-        "Migrating contentlead image for {0}.".format(
-            target_object.absolute_url()))
+    logger.info("Migrating contentlead image for {0}.".format(
+        target_object.absolute_url()))
 
 
 def migrate_portlets(src_obj, dst_obj):


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2016-02-24T10:24:34+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/b14e5996055689e2815c945cccd6ad758c00dea0

rebase afterwork

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 672d35d..2e503f6 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -13,10 +13,11 @@ New:
 
 Fixes:
 
+- Check if there is a non-empty leadimage field for migration.
+  [bsuttor]
+
 - Make sure to have image scale before generating tag for album view
   [vangheem]
-- Check if there is an image into leadimage field for migration.
-  [bsuttor]
 
 - Also remove collections upon uninstalling.
   [pbauer]


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2016-02-24T12:55:04+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/f106e8d81c349ae924af4dd0f8ad7dae6a37279e

Merge pull request #325 from plone/fix-leadimage-migration-with-no-image-in-field

Fix leadimage migration with no image in field

Files changed:
M CHANGES.rst
M plone/app/contenttypes/migration/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index dde415c..2e503f6 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -13,6 +13,9 @@ New:
 
 Fixes:
 
+- Check if there is a non-empty leadimage field for migration.
+  [bsuttor]
+
 - Make sure to have image scale before generating tag for album view
   [vangheem]
 
diff --git a/plone/app/contenttypes/migration/utils.py b/plone/app/contenttypes/migration/utils.py
index 11104b4..bfac29c 100644
--- a/plone/app/contenttypes/migration/utils.py
+++ b/plone/app/contenttypes/migration/utils.py
@@ -213,6 +213,12 @@ def migrate_leadimage(source_object, target_object):
                     "Could not migrate collective.leadimage fields.")
         return
 
+    acc = source_object.getField(
+        OLD_LEADIMAGE_FIELD_NAME).getAccessor(source_object)()
+    if getattr(acc, 'filename', None) is None:
+        # skip if old content has field but has no lead image in the field
+        return
+
     # handle image field
     migrate_imagefield(
         source_object,
@@ -226,8 +232,8 @@ def migrate_leadimage(source_object, target_object):
         target_object,
         OLD_CAPTION_FIELD_NAME,
         NEW_CAPTION_FIELD_NAME)
-    logger.info(
-        "Migrating contentlead image for." % target_object.absolute_url())
+    logger.info("Migrating contentlead image for {0}.".format(
+        target_object.absolute_url()))
 
 
 def migrate_portlets(src_obj, dst_obj):


