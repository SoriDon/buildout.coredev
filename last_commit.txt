Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-08-18T17:23:40+03:00
Author: Petchesi-Iulian (Petchesi-Iulian) <iamnotacat12@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/ec375817cd5b80395c76c984f09299b968c1582d

Use json_compatible on return in order to avoid datetime not serializable error.

Files changed:
M src/plone/restapi/services/registry/get.py

b'diff --git a/src/plone/restapi/services/registry/get.py b/src/plone/restapi/services/registry/get.py\nindex 8ba0ac2cd..b75ecc07a 100644\n--- a/src/plone/restapi/services/registry/get.py\n+++ b/src/plone/restapi/services/registry/get.py\n@@ -1,5 +1,6 @@\n from plone.registry.interfaces import IRegistry\n from plone.restapi.interfaces import ISerializeToJson\n+from plone.restapi.serializer.converters import json_compatible\n from plone.restapi.services import Service\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n@@ -32,7 +33,7 @@ def reply(self):\n         registry = getUtility(IRegistry)\n         if self.params:\n             value = registry[self._get_record_name]\n-            return value\n+            return json_compatible(value)\n         else:  # batched listing\n             serializer = getMultiAdapter((registry, self.request), ISerializeToJson)\n             return serializer()\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-08-18T17:27:06+03:00
Author: Petchesi-Iulian (Petchesi-Iulian) <iamnotacat12@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/2036ad9d106881edfef44da8c7ac1de7af63a65d

Add changelog

Files changed:
A news/1189.bugfix

b'diff --git a/news/1189.bugfix b/news/1189.bugfix\nnew file mode 100644\nindex 000000000..08ee97e73\n--- /dev/null\n+++ b/news/1189.bugfix\n@@ -0,0 +1,2 @@\n+Fix @registry endpoint Object of type datetime is not JSON serializable\n+[iulianpetchesi]\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-08-19T00:07:29+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.restapi/commit/656c53ae38543a1d8389d3395af06fa404736b74

Merge pull request #1470 from plone/issue-1189-registry-datetime

@registry Endpoint datetime not serializable fix

Files changed:
A news/1189.bugfix
M src/plone/restapi/services/registry/get.py

b'diff --git a/news/1189.bugfix b/news/1189.bugfix\nnew file mode 100644\nindex 000000000..08ee97e73\n--- /dev/null\n+++ b/news/1189.bugfix\n@@ -0,0 +1,2 @@\n+Fix @registry endpoint Object of type datetime is not JSON serializable\n+[iulianpetchesi]\ndiff --git a/src/plone/restapi/services/registry/get.py b/src/plone/restapi/services/registry/get.py\nindex 8ba0ac2cd..b75ecc07a 100644\n--- a/src/plone/restapi/services/registry/get.py\n+++ b/src/plone/restapi/services/registry/get.py\n@@ -1,5 +1,6 @@\n from plone.registry.interfaces import IRegistry\n from plone.restapi.interfaces import ISerializeToJson\n+from plone.restapi.serializer.converters import json_compatible\n from plone.restapi.services import Service\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n@@ -32,7 +33,7 @@ def reply(self):\n         registry = getUtility(IRegistry)\n         if self.params:\n             value = registry[self._get_record_name]\n-            return value\n+            return json_compatible(value)\n         else:  # batched listing\n             serializer = getMultiAdapter((registry, self.request), ISerializeToJson)\n             return serializer()\n'

