Repository: plone.volto


Branch: refs/heads/main
Date: 2022-11-04T17:40:49+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.volto/commit/3806331f9272441cc2e3e899a196b8116f0ef944

fix adding a leadimage-block if item has a leadimage

Files changed:
M src/plone/volto/browser/migrate_richtext.py

b'diff --git a/src/plone/volto/browser/migrate_richtext.py b/src/plone/volto/browser/migrate_richtext.py\nindex 2753d9f..c0e74c8 100644\n--- a/src/plone/volto/browser/migrate_richtext.py\n+++ b/src/plone/volto/browser/migrate_richtext.py\n@@ -104,8 +104,8 @@ def migrate_richtext_to_blocks(\n \n             if ILeadImage(obj, None) and ILeadImage(obj).image:\n                 uuid = str(uuid4())\n-                obj.blocks_layout["items"].append(uuid)\n-                obj.blocks[uuid] = {"@type": "leadimage"}\n+                blocks[uuid] = {"@type": "leadimage"}\n+                blocks_layout["items"].append(uuid)\n \n             text_blocks, text_uuids = get_blocks_from_richtext(\n                 text,\n'

Repository: plone.volto


Branch: refs/heads/main
Date: 2022-11-04T17:57:02+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.volto/commit/009eeac81a53dcaa328e255396659b641e1ca210

add changenote

Files changed:
A news/3836.bugfix

b'diff --git a/news/3836.bugfix b/news/3836.bugfix\nnew file mode 100644\nindex 0000000..6501d2b\n--- /dev/null\n+++ b/news/3836.bugfix\n@@ -0,0 +1 @@\n+Fix adding a leadimage block during migration to Volto when a leadimage exists. [pbauer]\n\\ No newline at end of file\n'

Repository: plone.volto


Branch: refs/heads/main
Date: 2022-11-04T17:59:32+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.volto/commit/6fa1db87d9212819d276b43d5060db235533f43a

fix filename

Files changed:
A news/96.bugfix
D news/3836.bugfix

b'diff --git a/news/3836.bugfix b/news/96.bugfix\nsimilarity index 100%\nrename from news/3836.bugfix\nrename to news/96.bugfix\n'

Repository: plone.volto


Branch: refs/heads/main
Date: 2022-11-04T11:23:26-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.volto/commit/153fa368b202b0eca6eb5eb01b5310c8e1756176

Merge pull request #96 from plone/fix_leadimage_migration

fix adding a leadimage-block if item has a leadimage

Files changed:
A news/96.bugfix
M src/plone/volto/browser/migrate_richtext.py

b'diff --git a/news/96.bugfix b/news/96.bugfix\nnew file mode 100644\nindex 0000000..6501d2b\n--- /dev/null\n+++ b/news/96.bugfix\n@@ -0,0 +1 @@\n+Fix adding a leadimage block during migration to Volto when a leadimage exists. [pbauer]\n\\ No newline at end of file\ndiff --git a/src/plone/volto/browser/migrate_richtext.py b/src/plone/volto/browser/migrate_richtext.py\nindex 2753d9f..c0e74c8 100644\n--- a/src/plone/volto/browser/migrate_richtext.py\n+++ b/src/plone/volto/browser/migrate_richtext.py\n@@ -104,8 +104,8 @@ def migrate_richtext_to_blocks(\n \n             if ILeadImage(obj, None) and ILeadImage(obj).image:\n                 uuid = str(uuid4())\n-                obj.blocks_layout["items"].append(uuid)\n-                obj.blocks[uuid] = {"@type": "leadimage"}\n+                blocks[uuid] = {"@type": "leadimage"}\n+                blocks_layout["items"].append(uuid)\n \n             text_blocks, text_uuids = get_blocks_from_richtext(\n                 text,\n'

