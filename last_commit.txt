Repository: plone.app.testing


Branch: refs/heads/master
Date: 2016-02-10T23:06:24+01:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/plone.app.testing/commit/cc72ec7c176be71d12b435b8a3eb571f6c0999c3

make sure ramcache object is valid

Files changed:
M CHANGES.rst
M plone/app/testing/layers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7e5394e..3fca859 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -21,6 +21,10 @@ Fixes:
 - Cleanup code, flake8, sort imports, etc.
   [gforcada]
 
+- Fix RAM cache error with bbb.PloneTestCase.
+  [ebrehault]
+
+
 5.0b6 (2015-08-22)
 ------------------
 
diff --git a/plone/app/testing/layers.py b/plone/app/testing/layers.py
index f9fcecb..f1fed28 100644
--- a/plone/app/testing/layers.py
+++ b/plone/app/testing/layers.py
@@ -308,7 +308,7 @@ def tearDownEnvironment(self, portal):
         from zope.component import queryUtility
         from plone.memoize.ram import IRAMCache
         cache = queryUtility(IRAMCache)
-        if cache is not None:
+        if cache and getattr(cache, '_cacheId', None):
             cache.invalidateAll()
 
         # Unset the local component site


Repository: plone.app.testing


Branch: refs/heads/master
Date: 2016-02-11T09:08:29+01:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/plone.app.testing/commit/28e087b1e931fb9a803e792fe663aa9082caf9a9

Merge pull request #24 from plone/ebr-ramcache-error

Make sure ramcache object is valid

Files changed:
M CHANGES.rst
M plone/app/testing/layers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7e5394e..3fca859 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -21,6 +21,10 @@ Fixes:
 - Cleanup code, flake8, sort imports, etc.
   [gforcada]
 
+- Fix RAM cache error with bbb.PloneTestCase.
+  [ebrehault]
+
+
 5.0b6 (2015-08-22)
 ------------------
 
diff --git a/plone/app/testing/layers.py b/plone/app/testing/layers.py
index f9fcecb..f1fed28 100644
--- a/plone/app/testing/layers.py
+++ b/plone/app/testing/layers.py
@@ -308,7 +308,7 @@ def tearDownEnvironment(self, portal):
         from zope.component import queryUtility
         from plone.memoize.ram import IRAMCache
         cache = queryUtility(IRAMCache)
-        if cache is not None:
+        if cache and getattr(cache, '_cacheId', None):
             cache.invalidateAll()
 
         # Unset the local component site


