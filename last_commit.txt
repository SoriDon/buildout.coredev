Repository: plone.app.viewletmanager


Branch: refs/heads/master
Date: 2023-04-28T12:32:05+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.viewletmanager/commit/3837105f00e92c6f8b63d5c3e6a05178745db1fa

Remove transitive circular dependency on plone.app.vocabularies

Files changed:
A news/fix-circular-dependency.bugfix
M plone/app/viewletmanager/exportimport/storage.py
M setup.py

b'diff --git a/news/fix-circular-dependency.bugfix b/news/fix-circular-dependency.bugfix\nnew file mode 100644\nindex 0000000..ae13ea3\n--- /dev/null\n+++ b/news/fix-circular-dependency.bugfix\n@@ -0,0 +1,2 @@\n+Remove transitive circular dependency on `plone.app.vocabularies`.\n+[@jensens]\ndiff --git a/plone/app/viewletmanager/exportimport/storage.py b/plone/app/viewletmanager/exportimport/storage.py\nindex e34c362..2afbbd3 100644\n--- a/plone/app/viewletmanager/exportimport/storage.py\n+++ b/plone/app/viewletmanager/exportimport/storage.py\n@@ -51,12 +51,12 @@\n \n """\n from plone.app.viewletmanager.interfaces import IViewletSettingsStorage\n+from Products.CMFCore.utils import getToolByName\n from Products.GenericSetup.interfaces import IBody\n from Products.GenericSetup.utils import XMLAdapterBase\n from zope.component import getUtility\n from zope.component import queryMultiAdapter\n from zope.component import queryUtility\n-from zope.schema.interfaces import IVocabularyFactory\n \n import os\n \n@@ -109,13 +109,8 @@ class ViewletSettingsStorageNodeAdapter(XMLAdapterBase):\n \n     def __init__(self, context, environ):\n         super().__init__(context, environ)\n-\n-        self.skins = [\n-            skin.token\n-            for skin in getUtility(IVocabularyFactory, "plone.app.vocabularies.Skins")(\n-                self.context\n-            )\n-        ]\n+        skins_tool = getToolByName(self.context, "portal_skins", None)\n+        self.skins = list(sorted(skins_tool.getSkinSelections())) if skins_tool else []\n \n     def _exportNode(self):\n         """\ndiff --git a/setup.py b/setup.py\nindex bdae295..ab6a811 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -21,7 +21,6 @@\n     "Products.GenericSetup",\n     "Zope",\n     "persistent",\n-    "plone.app.vocabularies",\n     "setuptools",\n     "zope.contentprovider",\n     "zope.viewlet",\n'

Repository: plone.app.viewletmanager


Branch: refs/heads/master
Date: 2023-05-02T16:12:56+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.viewletmanager/commit/8d772eba08e06af039a6c3d6893c7ceb60be8fe7

chore: adjust dependencies

Files changed:
M pyproject.toml
M setup.py

b'diff --git a/pyproject.toml b/pyproject.toml\nindex 09b1f6b..9eb73f3 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,4 +60,3 @@ Zope = [\n   \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n ]\n python-dateutil = [\'dateutil\']\n-ignore-packages = [\'plone.app.vocabularies\']\ndiff --git a/setup.py b/setup.py\nindex ab6a811..66244f3 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -19,6 +19,7 @@\n \n install_requires = [\n     "Products.GenericSetup",\n+    "Products.CMFCore",\n     "Zope",\n     "persistent",\n     "setuptools",\n'

Repository: plone.app.viewletmanager


Branch: refs/heads/master
Date: 2023-05-02T16:47:00+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.viewletmanager/commit/15d524edb78de55a7d07fe2427d8ac6e04d5995e

Merge pull request #32 from plone/fix-circular-dependency

Remove transitive circular dependency on plone.app.vocabularies

Files changed:
A news/fix-circular-dependency.bugfix
M plone/app/viewletmanager/exportimport/storage.py
M pyproject.toml
M setup.py

b'diff --git a/news/fix-circular-dependency.bugfix b/news/fix-circular-dependency.bugfix\nnew file mode 100644\nindex 0000000..ae13ea3\n--- /dev/null\n+++ b/news/fix-circular-dependency.bugfix\n@@ -0,0 +1,2 @@\n+Remove transitive circular dependency on `plone.app.vocabularies`.\n+[@jensens]\ndiff --git a/plone/app/viewletmanager/exportimport/storage.py b/plone/app/viewletmanager/exportimport/storage.py\nindex e34c362..2afbbd3 100644\n--- a/plone/app/viewletmanager/exportimport/storage.py\n+++ b/plone/app/viewletmanager/exportimport/storage.py\n@@ -51,12 +51,12 @@\n \n """\n from plone.app.viewletmanager.interfaces import IViewletSettingsStorage\n+from Products.CMFCore.utils import getToolByName\n from Products.GenericSetup.interfaces import IBody\n from Products.GenericSetup.utils import XMLAdapterBase\n from zope.component import getUtility\n from zope.component import queryMultiAdapter\n from zope.component import queryUtility\n-from zope.schema.interfaces import IVocabularyFactory\n \n import os\n \n@@ -109,13 +109,8 @@ class ViewletSettingsStorageNodeAdapter(XMLAdapterBase):\n \n     def __init__(self, context, environ):\n         super().__init__(context, environ)\n-\n-        self.skins = [\n-            skin.token\n-            for skin in getUtility(IVocabularyFactory, "plone.app.vocabularies.Skins")(\n-                self.context\n-            )\n-        ]\n+        skins_tool = getToolByName(self.context, "portal_skins", None)\n+        self.skins = list(sorted(skins_tool.getSkinSelections())) if skins_tool else []\n \n     def _exportNode(self):\n         """\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 09b1f6b..9eb73f3 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,4 +60,3 @@ Zope = [\n   \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n ]\n python-dateutil = [\'dateutil\']\n-ignore-packages = [\'plone.app.vocabularies\']\ndiff --git a/setup.py b/setup.py\nindex bdae295..66244f3 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -19,9 +19,9 @@\n \n install_requires = [\n     "Products.GenericSetup",\n+    "Products.CMFCore",\n     "Zope",\n     "persistent",\n-    "plone.app.vocabularies",\n     "setuptools",\n     "zope.contentprovider",\n     "zope.viewlet",\n'

