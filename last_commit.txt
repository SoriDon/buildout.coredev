Repository: plone.namedfile


Branch: refs/heads/master
Date: 2018-11-05T21:09:41+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.namedfile/commit/44bd9e541d9c9fdcb9a7343a8023ac3a16d5bbe6

Do not fail image upload when Exif data is bad.

https://github.com/plone/plone.namedfile/issues/68

Files changed:
M plone/namedfile/file.py

b"diff --git a/plone/namedfile/file.py b/plone/namedfile/file.py\nindex e97db54..9f9d89d 100644\n--- a/plone/namedfile/file.py\n+++ b/plone/namedfile/file.py\n@@ -393,8 +393,15 @@ def __init__(self, data=b'', contentType='', filename=None):\n                       'Exif Data: %s', exif_data)\n             orientation = exif_data['0th'].get(piexif.ImageIFD.Orientation, 1)\n             if 1 < orientation <= 8:\n-                self.data, self._width, self._height, self.exif = rotate_image(\n-                    self.data)\n+                try:\n+                    self.data, self._width, self._height, self.exif = \\\n+                        rotate_image(self.data)\n+                except KeyboardInterrupt:\n+                    raise\n+                except Exception:\n+                    log.warning(\n+                        'Error rotating image %s based on exif data.',\n+                        filename, exc_info=1)\n             else:\n                 self.exif = exif_data\n \n"

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2018-11-05T22:06:40+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.namedfile/commit/6a202e96c29c68f60846a9e39238a7d257d0b066

Forgot to commit news file

Files changed:
A news/68.bugfix

b'diff --git a/news/68.bugfix b/news/68.bugfix\nnew file mode 100644\nindex 0000000..9060b3f\n--- /dev/null\n+++ b/news/68.bugfix\n@@ -0,0 +1 @@\n+Do not fail image upload when Exif data is bad.  [maurits]\n'

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2018-11-09T00:34:38+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.namedfile/commit/d29f01e63e5dd05fc17f47fbb4672d6faa523150

Merge pull request #69 from plone/issue-68-master

Do not fail image upload when Exif data is bad. [master]

Files changed:
A news/68.bugfix
M plone/namedfile/file.py

b"diff --git a/news/68.bugfix b/news/68.bugfix\nnew file mode 100644\nindex 0000000..9060b3f\n--- /dev/null\n+++ b/news/68.bugfix\n@@ -0,0 +1 @@\n+Do not fail image upload when Exif data is bad.  [maurits]\ndiff --git a/plone/namedfile/file.py b/plone/namedfile/file.py\nindex e97db54..9f9d89d 100644\n--- a/plone/namedfile/file.py\n+++ b/plone/namedfile/file.py\n@@ -393,8 +393,15 @@ def __init__(self, data=b'', contentType='', filename=None):\n                       'Exif Data: %s', exif_data)\n             orientation = exif_data['0th'].get(piexif.ImageIFD.Orientation, 1)\n             if 1 < orientation <= 8:\n-                self.data, self._width, self._height, self.exif = rotate_image(\n-                    self.data)\n+                try:\n+                    self.data, self._width, self._height, self.exif = \\\n+                        rotate_image(self.data)\n+                except KeyboardInterrupt:\n+                    raise\n+                except Exception:\n+                    log.warning(\n+                        'Error rotating image %s based on exif data.',\n+                        filename, exc_info=1)\n             else:\n                 self.exif = exif_data\n \n"

