Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2015-11-26T14:27:53+01:00
Author: Gil Forcada (gforcada) <gforcada@gnome.org>
Commit: https://github.com/plone/plone.app.contenttypes/commit/9d3b9de151ebb7cbc9bd4347412985402cd656ad

Index subject field on the catalog so that is searchable

Fixes https://github.com/plone/plone.app.contenttypes/issues/194

Files changed:
M CHANGES.rst
M plone/app/contenttypes/indexers.py
M plone/app/contenttypes/tests/test_indexes.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 99a2e0c..e87b283 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,8 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
-
+- Index subject field on the catalog so that is searchable.
+  Fixes https://github.com/plone/plone.app.contenttypes/issues/194
+  [gforcada]
 
 1.2.6 (2015-11-25)
 ------------------
diff --git a/plone/app/contenttypes/indexers.py b/plone/app/contenttypes/indexers.py
index 8621daa..c5f7895 100644
--- a/plone/app/contenttypes/indexers.py
+++ b/plone/app/contenttypes/indexers.py
@@ -48,11 +48,16 @@ def SearchableText(obj):
                 mimetype=textvalue.mimeType,
             ).getData().strip()
 
+    subject = u' '.join(
+        [safe_unicode(s) for s in obj.Subject()]
+    )
+
     return u" ".join((
         safe_unicode(obj.id),
         safe_unicode(obj.title) or u"",
         safe_unicode(obj.description) or u"",
-        safe_unicode(text)
+        safe_unicode(text),
+        safe_unicode(subject),
     ))
 
 
diff --git a/plone/app/contenttypes/tests/test_indexes.py b/plone/app/contenttypes/tests/test_indexes.py
index 5824c3e..99f8e94 100644
--- a/plone/app/contenttypes/tests/test_indexes.py
+++ b/plone/app/contenttypes/tests/test_indexes.py
@@ -89,6 +89,18 @@ def test_description_in_searchable_text_index(self):
             '/plone/folder/document'
         )
 
+    def test_subject_in_searchable_text_index(self):
+        self.document.setSubject(["Apples", "Oranges", ])
+        self.document.reindexObject()
+        brains = self.catalog.searchResults(dict(
+            SearchableText="Apples",
+        ))
+        self.assertEqual(len(brains), 1)
+        self.assertEqual(
+            brains[0].getPath(),
+            '/plone/folder/document'
+        )
+
     def test_folder_fields_in_searchable_text_index(self):
         self.folder.title = "Carpeta"
         self.folder.description = "My description"


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2015-11-26T15:41:54+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/054b6530df9d6e47aaffa0edb02ac14423f94541

Merge pull request #303 from plone/index-subject-194

Index subject field on the catalog so that is searchable

Files changed:
M CHANGES.rst
M plone/app/contenttypes/indexers.py
M plone/app/contenttypes/tests/test_indexes.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 99a2e0c..e87b283 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,8 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
-
+- Index subject field on the catalog so that is searchable.
+  Fixes https://github.com/plone/plone.app.contenttypes/issues/194
+  [gforcada]
 
 1.2.6 (2015-11-25)
 ------------------
diff --git a/plone/app/contenttypes/indexers.py b/plone/app/contenttypes/indexers.py
index 8621daa..c5f7895 100644
--- a/plone/app/contenttypes/indexers.py
+++ b/plone/app/contenttypes/indexers.py
@@ -48,11 +48,16 @@ def SearchableText(obj):
                 mimetype=textvalue.mimeType,
             ).getData().strip()
 
+    subject = u' '.join(
+        [safe_unicode(s) for s in obj.Subject()]
+    )
+
     return u" ".join((
         safe_unicode(obj.id),
         safe_unicode(obj.title) or u"",
         safe_unicode(obj.description) or u"",
-        safe_unicode(text)
+        safe_unicode(text),
+        safe_unicode(subject),
     ))
 
 
diff --git a/plone/app/contenttypes/tests/test_indexes.py b/plone/app/contenttypes/tests/test_indexes.py
index 5824c3e..99f8e94 100644
--- a/plone/app/contenttypes/tests/test_indexes.py
+++ b/plone/app/contenttypes/tests/test_indexes.py
@@ -89,6 +89,18 @@ def test_description_in_searchable_text_index(self):
             '/plone/folder/document'
         )
 
+    def test_subject_in_searchable_text_index(self):
+        self.document.setSubject(["Apples", "Oranges", ])
+        self.document.reindexObject()
+        brains = self.catalog.searchResults(dict(
+            SearchableText="Apples",
+        ))
+        self.assertEqual(len(brains), 1)
+        self.assertEqual(
+            brains[0].getPath(),
+            '/plone/folder/document'
+        )
+
     def test_folder_fields_in_searchable_text_index(self):
         self.folder.title = "Carpeta"
         self.folder.description = "My description"


