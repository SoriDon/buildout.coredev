Repository: plone.app.content


Branch: refs/heads/master
Date: 2021-10-21T21:34:07+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.content/commit/52eb9d4d3e3f1dac185c08f8c013af905d31db76

Allow access to content_status_modify page for all with View permission.

This was the case when it was still a skin script.
The internal logic of the page makes sure you can only *really* change anything when you have the proper permission.

Fixes https://github.com/plone/Products.CMFPlone/issues/3338, where an Editor could no longer submit a page.

Files changed:
A news/3338.bugfix
M plone/app/content/browser/configure.zcml
M plone/app/content/tests/test_content_status_modify.py

b'diff --git a/news/3338.bugfix b/news/3338.bugfix\nnew file mode 100644\nindex 0000000..1e21906\n--- /dev/null\n+++ b/news/3338.bugfix\n@@ -0,0 +1,5 @@\n+Allow access to content_status_modify page for all with View permission.\n+This was the case when it was still a skin script.\n+The internal logic of the page makes sure you can only *really* change anything when you have the proper permission.\n+Fixes `issue 3338 <https://github.com/plone/Products.CMFPlone/issues/3338>`_, where an Editor could no longer submit a page.\n+[maurits]\ndiff --git a/plone/app/content/browser/configure.zcml b/plone/app/content/browser/configure.zcml\nindex a55050f..b69207b 100644\n--- a/plone/app/content/browser/configure.zcml\n+++ b/plone/app/content/browser/configure.zcml\n@@ -48,7 +48,7 @@\n         for="*"\n         name="content_status_modify"\n         class=".content_status_modify.ContentStatusModifyView"\n-        permission="cmf.ReviewPortalContent"\n+        permission="zope2.View"\n         />\n \n     <!-- Folder factories -->\ndiff --git a/plone/app/content/tests/test_content_status_modify.py b/plone/app/content/tests/test_content_status_modify.py\nindex e195bee..a0686dd 100644\n--- a/plone/app/content/tests/test_content_status_modify.py\n+++ b/plone/app/content/tests/test_content_status_modify.py\n@@ -94,3 +94,21 @@ def testIsExpiredWithExplicitNonExpiredContent(self):\n         view = self.get_content_status_modify_view(self.folder.d1)\n         view(workflow_action="publish")\n         self.assertFalse(isExpired(self.folder.d1))\n+\n+    def testEditorCanSubmitButNotPublish(self):\n+        setRoles(self.portal, TEST_USER_ID, ["Contributor"])\n+        self.folder.invokeFactory("Document", id="d2", title="Doc 2")\n+        view = self.get_content_status_modify_view(self.folder.d2)\n+        view(workflow_action="submit")\n+        self.assertEqual(\n+            self.workflow.getInfoFor(self.folder.d2, "review_state"), "pending"\n+        )\n+\n+        # Now try publishing.\n+        # For various reasons, there are no complaints/errors when trying\n+        # a transition that you are not allowed to do.\n+        view = self.get_content_status_modify_view(self.folder.d2)\n+        view(workflow_action="publish")\n+        self.assertEqual(\n+            self.workflow.getInfoFor(self.folder.d2, "review_state"), "pending"\n+        )\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2021-10-22T17:55:39+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.app.content/commit/8886a3cb1144ca5d078b44757f52d5b6d03f9fa0

Merge pull request #235 from plone/maurits-fix-content-status-modify-permission

Allow access to content_status_modify page for all with View permission.

Files changed:
A news/3338.bugfix
M plone/app/content/browser/configure.zcml
M plone/app/content/tests/test_content_status_modify.py

b'diff --git a/news/3338.bugfix b/news/3338.bugfix\nnew file mode 100644\nindex 0000000..1e21906\n--- /dev/null\n+++ b/news/3338.bugfix\n@@ -0,0 +1,5 @@\n+Allow access to content_status_modify page for all with View permission.\n+This was the case when it was still a skin script.\n+The internal logic of the page makes sure you can only *really* change anything when you have the proper permission.\n+Fixes `issue 3338 <https://github.com/plone/Products.CMFPlone/issues/3338>`_, where an Editor could no longer submit a page.\n+[maurits]\ndiff --git a/plone/app/content/browser/configure.zcml b/plone/app/content/browser/configure.zcml\nindex a55050f..b69207b 100644\n--- a/plone/app/content/browser/configure.zcml\n+++ b/plone/app/content/browser/configure.zcml\n@@ -48,7 +48,7 @@\n         for="*"\n         name="content_status_modify"\n         class=".content_status_modify.ContentStatusModifyView"\n-        permission="cmf.ReviewPortalContent"\n+        permission="zope2.View"\n         />\n \n     <!-- Folder factories -->\ndiff --git a/plone/app/content/tests/test_content_status_modify.py b/plone/app/content/tests/test_content_status_modify.py\nindex e195bee..a0686dd 100644\n--- a/plone/app/content/tests/test_content_status_modify.py\n+++ b/plone/app/content/tests/test_content_status_modify.py\n@@ -94,3 +94,21 @@ def testIsExpiredWithExplicitNonExpiredContent(self):\n         view = self.get_content_status_modify_view(self.folder.d1)\n         view(workflow_action="publish")\n         self.assertFalse(isExpired(self.folder.d1))\n+\n+    def testEditorCanSubmitButNotPublish(self):\n+        setRoles(self.portal, TEST_USER_ID, ["Contributor"])\n+        self.folder.invokeFactory("Document", id="d2", title="Doc 2")\n+        view = self.get_content_status_modify_view(self.folder.d2)\n+        view(workflow_action="submit")\n+        self.assertEqual(\n+            self.workflow.getInfoFor(self.folder.d2, "review_state"), "pending"\n+        )\n+\n+        # Now try publishing.\n+        # For various reasons, there are no complaints/errors when trying\n+        # a transition that you are not allowed to do.\n+        view = self.get_content_status_modify_view(self.folder.d2)\n+        view(workflow_action="publish")\n+        self.assertEqual(\n+            self.workflow.getInfoFor(self.folder.d2, "review_state"), "pending"\n+        )\n'

