Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-10-24T12:05:13+03:00
Author: Ion Lizarazu (ionlizarazu) <ilizarazu@codesyntax.com>
Commit: https://github.com/plone/plone.restapi/commit/38c60799be05c29827dbd570e6b1c2474112ba2e

add url field to Actions (#1076)

Co-authored-by: nileshgulia1 &lt;nileshgulia@gmail.com&gt;
Co-authored-by: Alin Voinea &lt;contact@avoinea.com&gt;

Files changed:
A news/817.bugfix
M src/plone/restapi/services/actions/get.py
M src/plone/restapi/tests/http-examples/expansion_expanded_full.resp
M src/plone/restapi/tests/test_services_actions.py

b'diff --git a/news/817.bugfix b/news/817.bugfix\nnew file mode 100644\nindex 000000000..34ddedc24\n--- /dev/null\n+++ b/news/817.bugfix\n@@ -0,0 +1 @@\n+Added url field to Actions\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/services/actions/get.py b/src/plone/restapi/services/actions/get.py\nindex a14c3e581..b71f75754 100644\n--- a/src/plone/restapi/services/actions/get.py\n+++ b/src/plone/restapi/services/actions/get.py\n@@ -36,6 +36,7 @@ def __call__(self, expand=False):\n                         "title": translate(action["title"], context=self.request),\n                         "id": action["id"],\n                         "icon": action["icon"],\n+                        "url": action["url"],\n                     }\n                 )\n             data[category] = category_action_data\ndiff --git a/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp b/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp\nindex 356dddb78..9f75fb317 100644\n--- a/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp\n+++ b/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp\n@@ -9,100 +9,118 @@ Content-Type: application/json\n                 {\n                     "icon": "toolbar-action/view",\n                     "id": "view",\n-                    "title": "View"\n+                    "title": "View",\n+                    "url": "http://localhost:55001/plone/front-page"\n                 },\n                 {\n                     "icon": "toolbar-action/edit",\n                     "id": "edit",\n-                    "title": "Edit"\n+                    "title": "Edit",\n+                    "url": "http://localhost:55001/plone/front-page/edit"\n                 },\n                 {\n                     "icon": "toolbar-action/folderContents",\n                     "id": "folderContents",\n-                    "title": "Contents"\n+                    "title": "Contents",\n+                    "url": "http://localhost:55001/plone/folder_contents"\n                 },\n                 {\n                     "icon": "toolbar-action/history",\n                     "id": "history",\n-                    "title": "History"\n+                    "title": "History",\n+                    "url": "http://localhost:55001/plone/front-page/@@historyview"\n                 },\n                 {\n                     "icon": "toolbar-action/sharing",\n                     "id": "local_roles",\n-                    "title": "Sharing"\n+                    "title": "Sharing",\n+                    "url": "http://localhost:55001/plone/front-page/@@sharing"\n                 }\n             ],\n             "object_buttons": [\n                 {\n                     "icon": "plone-cut",\n                     "id": "cut",\n-                    "title": "Cut"\n+                    "title": "Cut",\n+                    "url": "http://localhost:55001/plone/front-page/object_cut"\n                 },\n                 {\n                     "icon": "plone-copy",\n                     "id": "copy",\n-                    "title": "Copy"\n+                    "title": "Copy",\n+                    "url": "http://localhost:55001/plone/front-page/object_copy"\n                 },\n                 {\n                     "icon": "plone-delete",\n                     "id": "delete",\n-                    "title": "Delete"\n+                    "title": "Delete",\n+                    "url": "http://localhost:55001/plone/front-page/delete_confirmation"\n                 },\n                 {\n                     "icon": "plone-rename",\n                     "id": "rename",\n-                    "title": "Rename"\n+                    "title": "Rename",\n+                    "url": "http://localhost:55001/plone/front-page/object_rename"\n                 },\n                 {\n                     "icon": "plone-redirection",\n                     "id": "redirection",\n-                    "title": "URL Management"\n+                    "title": "URL Management",\n+                    "url": " http://localhost:55001/plone/front-page/@@manage-aliases"\n                 }\n             ],\n             "portal_tabs": [\n                 {\n                     "icon": "plone-home",\n                     "id": "index_html",\n-                    "title": "Home"\n+                    "title": "Home",\n+                    "url": "http://localhost:55001/plone"\n                 }\n             ],\n             "site_actions": [\n                 {\n                     "icon": "plone-sitemap",\n                     "id": "sitemap",\n-                    "title": "Site Map"\n+                    "title": "Site Map",\n+                    "url": "http://localhost:55001/plone/sitemap"\n                 },\n                 {\n                     "icon": "plone-accessibility",\n                     "id": "accessibility",\n-                    "title": "Accessibility"\n+                    "title": "Accessibility",\n+                    "url": "http://localhost:55001/plone/accessibility-info"\n                 },\n                 {\n                     "icon": "plone-contact-info",\n                     "id": "contact",\n-                    "title": "Contact"\n+                    "title": "Contact",\n+                    "url": "http://localhost:55001/plone/contact-info"\n                 }\n             ],\n             "user": [\n                 {\n                     "icon": "plone-user",\n                     "id": "preferences",\n-                    "title": "Preferences"\n+                    "title": "Preferences",\n+                    "url": "http://localhost:55001/plone/@@personal-preferences"\n                 },\n                 {\n                     "icon": "plone-dashboard",\n                     "id": "dashboard",\n-                    "title": "Dashboard"\n+                    "title": "Dashboard",\n+                    "url": "http://localhost:55001/plone/dashboard"\n                 },\n                 {\n                     "icon": "plone-controlpanel",\n                     "id": "plone_setup",\n-                    "title": "Site Setup"\n+                    "title": "Site Setup",\n+                    "url": "http://localhost:55001/plone/@@overview-controlpanel"\n                 },\n                 {\n                     "icon": "plone-logout",\n                     "id": "logout",\n-                    "title": "Log out"\n+                    "title": "Log out",\n+                    "url": "http://localhost:55001/plone/logout"\n                 }\n             ]\n         },\ndiff --git a/src/plone/restapi/tests/test_services_actions.py b/src/plone/restapi/tests/test_services_actions.py\nindex 87eb9c9d3..61c79edc1 100644\n--- a/src/plone/restapi/tests/test_services_actions.py\n+++ b/src/plone/restapi/tests/test_services_actions.py\n@@ -27,7 +27,14 @@ def add_category(self, name):\n         return category\n \n     def add_action(\n-        self, category, name, title, icon_expr="", available_expr="", permissions=()\n+        self,\n+        category,\n+        name,\n+        title,\n+        icon_expr="",\n+        available_expr="",\n+        permissions=(),\n+        url="",\n     ):\n         action = Action(\n             name,\n@@ -35,6 +42,7 @@ def add_action(\n             icon_expr=icon_expr,\n             available_expr=available_expr,\n             permissions=permissions,\n+            url_expr=url,\n         )\n         action.id = name\n         category._setObject(name, action)\n@@ -62,18 +70,21 @@ def setUp(self):\n             "member_action",\n             "Members only",\n             available_expr="python:member is not None",\n+            url="string:${globals_view/navigationRootUrl}/sitemap",\n         )\n         self.add_action(\n             self.cat1,\n             "view_action",\n             "Action with view permission",\n             permissions=(permissions.View,),\n+            url="string:${globals_view/navigationRootUrl}/accessibility-info",\n         )\n         self.add_action(\n             self.cat1,\n             "manage_action",\n             "Action with Manage Portal Content permission",\n             permissions=(permissions.ManagePortal,),\n+            url="",\n         )\n         self.cat2 = self.add_category("category2")\n         self.cat3 = self.add_category("category3")\n@@ -105,20 +116,29 @@ def test_actions_siteroot(self):\n \n         self.assertEqual(response.status_code, 200)\n         response = response.json()\n+\n+        self.maxDiff = None\n         self.assertEqual(\n             response,\n             {\n                 "category1": [\n-                    {"title": "Members only", "id": "member_action", "icon": ""},\n+                    {\n+                        "title": "Members only",\n+                        "id": "member_action",\n+                        "icon": "",\n+                        "url": self.portal_url + "/sitemap",\n+                    },\n                     {\n                         "title": "Action with view permission",\n                         "id": "view_action",\n                         "icon": "",\n+                        "url": self.portal_url + "/accessibility-info",\n                     },\n                     {\n                         "title": "Action with Manage Portal Content permission",\n                         "id": "manage_action",\n                         "icon": "",\n+                        "url": "",\n                     },\n                 ],\n                 "category2": [],\n@@ -139,6 +159,7 @@ def test_actions_siteroot_anon(self):\n                         "title": "Action with view permission",\n                         "id": "view_action",\n                         "icon": "",\n+                        "url": self.portal_url + "/accessibility-info",\n                     }\n                 ],\n                 "category2": [],\n'

