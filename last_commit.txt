Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-27T08:38:32+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/cbb726858c848075a8de73e37b7c0b5b6b189824

several i18n fixes

Files changed:
A news/3565.bugfix
M Products/CMFPlone/browser/login/templates/pwreset_form.pt
M Products/CMFPlone/browser/templates/test_rendering_icons.pt
M Products/CMFPlone/controlpanel/browser/actions.pt
M Products/CMFPlone/controlpanel/browser/overview.pt
M Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt
M Products/CMFPlone/controlpanel/browser/usergroups_groupsoverview.pt

b'diff --git a/Products/CMFPlone/browser/login/templates/pwreset_form.pt b/Products/CMFPlone/browser/login/templates/pwreset_form.pt\nindex 578b804889..5ca9f46a39 100644\n--- a/Products/CMFPlone/browser/login/templates/pwreset_form.pt\n+++ b/Products/CMFPlone/browser/login/templates/pwreset_form.pt\n@@ -128,6 +128,7 @@\n                                 value="Set my password"\n                                 i18n:attributes="value">\n                                 <span i18n:translate="">Set my password</span>\n+                            </button>\n                         </div>\n                     </div>\n                     <input type="hidden" name="form.submitted" value="1" />\ndiff --git a/Products/CMFPlone/browser/templates/test_rendering_icons.pt b/Products/CMFPlone/browser/templates/test_rendering_icons.pt\nindex 40999ad312..380a067d19 100644\n--- a/Products/CMFPlone/browser/templates/test_rendering_icons.pt\n+++ b/Products/CMFPlone/browser/templates/test_rendering_icons.pt\n@@ -8,7 +8,7 @@\n \n     <style>\n \n-    </style>    \n+    </style>\n \n     <ul class="nav nav-tabs mb-3">\n       <li class="nav-item">\n@@ -54,7 +54,7 @@\n       <tal:icon tal:replace="structure python:icons.tag(\'archive\', tag_class=\'custom-class\', tag_alt=\'foobar\')" />\n     </p>\n \n-    <h2>Registration<h2>\n+    <h2>Registration</h2>\n \n     <p>\n       Todo: List custom Icons\n@@ -88,4 +88,4 @@\n \n </body>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/Products/CMFPlone/controlpanel/browser/actions.pt b/Products/CMFPlone/controlpanel/browser/actions.pt\nindex 808cdf3672..ed8c89431a 100644\n--- a/Products/CMFPlone/controlpanel/browser/actions.pt\n+++ b/Products/CMFPlone/controlpanel/browser/actions.pt\n@@ -52,13 +52,13 @@\n               </button>\n               <a class="pat-plone-modal btn btn-sm btn-primary standalone"\n                 tal:attributes="href string:${action/url}/@@action-form"\n-                ><tal:icon tal:replace="structure python:icons.tag(\'plone-edit\', tag_alt=\'Edit\')" /><span i18n:translate="" class="ms-2" i18n:translate="">Edit</span></a>\n+                ><tal:icon tal:replace="structure python:icons.tag(\'plone-edit\', tag_alt=\'Edit\')" /><span class="ms-2" i18n:translate="">Edit</span></a>\n               <button type="submit" class="btn btn-sm btn-danger destructive" name="delete"\n                 value="Delete"\n                 confirm-message="Delete the action?"\n                 i18n:attributes="value; confirm-message"\n                 onclick="return confirm(this.getAttribute(\'confirm-message\'));" >\n-                <tal:icon tal:replace="structure python:icons.tag(\'plone-delete\', tag_alt=\'Delete\')" /><span i18n:translate="" class="ms-2" i18n:translate="">Delete</span>\n+                <tal:icon tal:replace="structure python:icons.tag(\'plone-delete\', tag_alt=\'Delete\')" /><span class="ms-2" i18n:translate="">Delete</span>\n               </button>\n             </form>\n           </li>\n@@ -68,4 +68,4 @@\n   </div>\n </metal:main>\n </body>\n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/Products/CMFPlone/controlpanel/browser/overview.pt b/Products/CMFPlone/controlpanel/browser/overview.pt\nindex f6742cd3fe..502561674b 100644\n--- a/Products/CMFPlone/controlpanel/browser/overview.pt\n+++ b/Products/CMFPlone/controlpanel/browser/overview.pt\n@@ -114,7 +114,7 @@\n                         src="" alt="" class="icon"\n                         tal:attributes="src action/icon;\n                                         alt action/title"\n-                        i18n:attributes="alt action/title">\n+                        i18n:attributes="alt">\n                       <tal:icon tal:condition="not: icon_url"\n                         tal:replace="structure python:icons.tag(action[\'icon\'] or \'plone-controlpanel\', tag_alt=action[\'title\'], tag_class=\'overview-icon\')" />\n                     </div>\ndiff --git a/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt b/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\nindex c355e6bef5..1ca009a775 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\n+++ b/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\n@@ -43,7 +43,7 @@\n                                     src="" alt="" class="icon"\n                                     tal:attributes="src configlet/icon;\n                                                     alt configlet/title"\n-                                    i18n:attributes="alt configlet/title">\n+                                    i18n:attributes="alt">\n                                 <tal:icon tal:condition="not: icon_url"\n                                           tal:replace="structure python:icons.tag(configlet[\'icon\'] or \'plone-controlpanel\', tag_alt=configlet[\'title\'])" />\n                                 ${configlet/title}\ndiff --git a/Products/CMFPlone/controlpanel/browser/usergroups_groupsoverview.pt b/Products/CMFPlone/controlpanel/browser/usergroups_groupsoverview.pt\nindex e4d2042bac..2bab236cfb 100644\n--- a/Products/CMFPlone/controlpanel/browser/usergroups_groupsoverview.pt\n+++ b/Products/CMFPlone/controlpanel/browser/usergroups_groupsoverview.pt\n@@ -104,7 +104,7 @@\n                    i18n:attributes="summary summary_roles_for_groups;">\n                 <thead tal:condition="search_results">\n                     <tr>\n-                        <th class="text-start" i18n:translate="listingheader_group_name">Group name</th>\n+                        <th class="text-start" i18n:translate="listingheader_group_name">Group Name</th>\n                         <th class="rotate" tal:repeat="portal_role portal_roles"><div tal:content="portal_role" i18n:translate="">Role</div></th>\n                         <th class="rotate alert-danger"><div i18n:translate="listingheader_remove">Remove</div></th>\n                     </tr>\ndiff --git a/news/3565.bugfix b/news/3565.bugfix\nnew file mode 100644\nindex 0000000000..3163520176\n--- /dev/null\n+++ b/news/3565.bugfix\n@@ -0,0 +1,2 @@\n+Fix several i18n bugs\n+[erral]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-27T15:50:43+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/08b8d0bd1c12fab0c29f8bf90064b5e994cf9f98

Merge branch 'master' into erral-i18n-fixes

Files changed:
A news/3566.bugfix
M Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py

b'diff --git a/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py b/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\nindex be656d06ba..0cc5c2c1e0 100644\n--- a/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\n+++ b/Products/CMFPlone/image_scales/tests/test_image_scales_metadata.py\n@@ -91,8 +91,7 @@ def test_field_adapter_does_not_return_larger_scales(self):\n         self.assertEqual(scales["width"], 900)\n         self.assertEqual(scales["height"], 900)\n         download = scales["download"]\n-        images_url = image.absolute_url() + "/@@images"\n-        self.assertTrue(download.startswith(f"{images_url}/image-900-"))\n+        self.assertTrue(download.startswith("@@images/image-900-"))\n         self.assertTrue(download.endswith(".jpeg"))\n         scales = scales["scales"]\n         # larger and huge should not be in here: these scales would return the same\n@@ -104,7 +103,7 @@ def test_field_adapter_does_not_return_larger_scales(self):\n         preview = scales["preview"]\n         self.assertEqual(preview["width"], 400)\n         self.assertEqual(preview["height"], 400)\n-        self.assertTrue(preview["download"].startswith(f"{images_url}/image-400-"))\n+        self.assertTrue(preview["download"].startswith("@@images/image-400-"))\n \n     def test_content_adapter_return_proper_scales(self):\n         res = queryMultiAdapter((self.image, self.request), IImageScalesAdapter)()\ndiff --git a/news/3566.bugfix b/news/3566.bugfix\nnew file mode 100644\nindex 0000000000..db4c3dc993\n--- /dev/null\n+++ b/news/3566.bugfix\n@@ -0,0 +1,2 @@\n+Fix tests for `image_scale` download url update.\n+[petschki]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-27T16:42:49+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/41cd2ab484437b481f7d510df443be7a57e12747

Merge pull request #3565 from plone/erral-i18n-fixes

several i18n fixes

Files changed:
A news/3565.bugfix
M Products/CMFPlone/browser/login/templates/pwreset_form.pt
M Products/CMFPlone/browser/templates/test_rendering_icons.pt
M Products/CMFPlone/controlpanel/browser/actions.pt
M Products/CMFPlone/controlpanel/browser/overview.pt
M Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt
M Products/CMFPlone/controlpanel/browser/usergroups_groupsoverview.pt

b'diff --git a/Products/CMFPlone/browser/login/templates/pwreset_form.pt b/Products/CMFPlone/browser/login/templates/pwreset_form.pt\nindex 578b804889..5ca9f46a39 100644\n--- a/Products/CMFPlone/browser/login/templates/pwreset_form.pt\n+++ b/Products/CMFPlone/browser/login/templates/pwreset_form.pt\n@@ -128,6 +128,7 @@\n                                 value="Set my password"\n                                 i18n:attributes="value">\n                                 <span i18n:translate="">Set my password</span>\n+                            </button>\n                         </div>\n                     </div>\n                     <input type="hidden" name="form.submitted" value="1" />\ndiff --git a/Products/CMFPlone/browser/templates/test_rendering_icons.pt b/Products/CMFPlone/browser/templates/test_rendering_icons.pt\nindex 40999ad312..380a067d19 100644\n--- a/Products/CMFPlone/browser/templates/test_rendering_icons.pt\n+++ b/Products/CMFPlone/browser/templates/test_rendering_icons.pt\n@@ -8,7 +8,7 @@\n \n     <style>\n \n-    </style>    \n+    </style>\n \n     <ul class="nav nav-tabs mb-3">\n       <li class="nav-item">\n@@ -54,7 +54,7 @@\n       <tal:icon tal:replace="structure python:icons.tag(\'archive\', tag_class=\'custom-class\', tag_alt=\'foobar\')" />\n     </p>\n \n-    <h2>Registration<h2>\n+    <h2>Registration</h2>\n \n     <p>\n       Todo: List custom Icons\n@@ -88,4 +88,4 @@\n \n </body>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/Products/CMFPlone/controlpanel/browser/actions.pt b/Products/CMFPlone/controlpanel/browser/actions.pt\nindex 808cdf3672..ed8c89431a 100644\n--- a/Products/CMFPlone/controlpanel/browser/actions.pt\n+++ b/Products/CMFPlone/controlpanel/browser/actions.pt\n@@ -52,13 +52,13 @@\n               </button>\n               <a class="pat-plone-modal btn btn-sm btn-primary standalone"\n                 tal:attributes="href string:${action/url}/@@action-form"\n-                ><tal:icon tal:replace="structure python:icons.tag(\'plone-edit\', tag_alt=\'Edit\')" /><span i18n:translate="" class="ms-2" i18n:translate="">Edit</span></a>\n+                ><tal:icon tal:replace="structure python:icons.tag(\'plone-edit\', tag_alt=\'Edit\')" /><span class="ms-2" i18n:translate="">Edit</span></a>\n               <button type="submit" class="btn btn-sm btn-danger destructive" name="delete"\n                 value="Delete"\n                 confirm-message="Delete the action?"\n                 i18n:attributes="value; confirm-message"\n                 onclick="return confirm(this.getAttribute(\'confirm-message\'));" >\n-                <tal:icon tal:replace="structure python:icons.tag(\'plone-delete\', tag_alt=\'Delete\')" /><span i18n:translate="" class="ms-2" i18n:translate="">Delete</span>\n+                <tal:icon tal:replace="structure python:icons.tag(\'plone-delete\', tag_alt=\'Delete\')" /><span class="ms-2" i18n:translate="">Delete</span>\n               </button>\n             </form>\n           </li>\n@@ -68,4 +68,4 @@\n   </div>\n </metal:main>\n </body>\n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/Products/CMFPlone/controlpanel/browser/overview.pt b/Products/CMFPlone/controlpanel/browser/overview.pt\nindex f6742cd3fe..502561674b 100644\n--- a/Products/CMFPlone/controlpanel/browser/overview.pt\n+++ b/Products/CMFPlone/controlpanel/browser/overview.pt\n@@ -114,7 +114,7 @@\n                         src="" alt="" class="icon"\n                         tal:attributes="src action/icon;\n                                         alt action/title"\n-                        i18n:attributes="alt action/title">\n+                        i18n:attributes="alt">\n                       <tal:icon tal:condition="not: icon_url"\n                         tal:replace="structure python:icons.tag(action[\'icon\'] or \'plone-controlpanel\', tag_alt=action[\'title\'], tag_class=\'overview-icon\')" />\n                     </div>\ndiff --git a/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt b/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\nindex c355e6bef5..1ca009a775 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\n+++ b/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\n@@ -43,7 +43,7 @@\n                                     src="" alt="" class="icon"\n                                     tal:attributes="src configlet/icon;\n                                                     alt configlet/title"\n-                                    i18n:attributes="alt configlet/title">\n+                                    i18n:attributes="alt">\n                                 <tal:icon tal:condition="not: icon_url"\n                                           tal:replace="structure python:icons.tag(configlet[\'icon\'] or \'plone-controlpanel\', tag_alt=configlet[\'title\'])" />\n                                 ${configlet/title}\ndiff --git a/Products/CMFPlone/controlpanel/browser/usergroups_groupsoverview.pt b/Products/CMFPlone/controlpanel/browser/usergroups_groupsoverview.pt\nindex e4d2042bac..2bab236cfb 100644\n--- a/Products/CMFPlone/controlpanel/browser/usergroups_groupsoverview.pt\n+++ b/Products/CMFPlone/controlpanel/browser/usergroups_groupsoverview.pt\n@@ -104,7 +104,7 @@\n                    i18n:attributes="summary summary_roles_for_groups;">\n                 <thead tal:condition="search_results">\n                     <tr>\n-                        <th class="text-start" i18n:translate="listingheader_group_name">Group name</th>\n+                        <th class="text-start" i18n:translate="listingheader_group_name">Group Name</th>\n                         <th class="rotate" tal:repeat="portal_role portal_roles"><div tal:content="portal_role" i18n:translate="">Role</div></th>\n                         <th class="rotate alert-danger"><div i18n:translate="listingheader_remove">Remove</div></th>\n                     </tr>\ndiff --git a/news/3565.bugfix b/news/3565.bugfix\nnew file mode 100644\nindex 0000000000..3163520176\n--- /dev/null\n+++ b/news/3565.bugfix\n@@ -0,0 +1,2 @@\n+Fix several i18n bugs\n+[erral]\n'

