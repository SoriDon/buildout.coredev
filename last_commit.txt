Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-04-05T18:36:07+02:00
Author: Robert Niederreiter (rnixx) <office@squarewave.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/8ddd2606135fb7b571187247a6faa17f3f398e4d

only encode css_body if unicode to avoid unicode error

only encode css_body if unicode to avoid unicode error

Files changed:
M CHANGES.rst
M Products/CMFPlone/_scripts/_generate_gruntfile.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0ab51be..1afbbac 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -23,6 +23,10 @@ New:
 
 Fixes:
 
+- Only encode JS body if unicode in gruntfile generation script to avoid
+  unicode error.
+  [jensens]
+
 - Only encode CSS body if unicode in gruntfile generation script to avoid
   unicode error.
   [rnix]
diff --git a/Products/CMFPlone/_scripts/_generate_gruntfile.py b/Products/CMFPlone/_scripts/_generate_gruntfile.py
index 9874085..2d1f088 100644
--- a/Products/CMFPlone/_scripts/_generate_gruntfile.py
+++ b/Products/CMFPlone/_scripts/_generate_gruntfile.py
@@ -208,9 +208,10 @@ def resource_to_dir(resource, file_type='.js'):
                 except OSError:
                     pass
                 local_file = temp_resource_folder + '/' + file_name + '.js'
-                temp_file = open(local_file, 'w')
-                temp_file.write(js_body.encode('utf-8'))
-                temp_file.close()
+                if isinstance(js_body, unicode):
+                    js_body = js_body.encode('utf-8')
+                with open(local_file, 'w') as temp_file:
+                    temp_file.write(js_body)
 
         if local_file:
             # Extract .js


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-04-05T18:41:39+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/f6180898aba86b41b2882402a42b9f6d2fe42db3

only encode css_body if unicode to avoid unicode error

only encode css_body if unicode to avoid unicode error

Files changed:
M CHANGES.rst
M Products/CMFPlone/_scripts/_generate_gruntfile.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0ab51be..1afbbac 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -23,6 +23,10 @@ New:
 
 Fixes:
 
+- Only encode JS body if unicode in gruntfile generation script to avoid
+  unicode error.
+  [jensens]
+
 - Only encode CSS body if unicode in gruntfile generation script to avoid
   unicode error.
   [rnix]
diff --git a/Products/CMFPlone/_scripts/_generate_gruntfile.py b/Products/CMFPlone/_scripts/_generate_gruntfile.py
index 9874085..2d1f088 100644
--- a/Products/CMFPlone/_scripts/_generate_gruntfile.py
+++ b/Products/CMFPlone/_scripts/_generate_gruntfile.py
@@ -208,9 +208,10 @@ def resource_to_dir(resource, file_type='.js'):
                 except OSError:
                     pass
                 local_file = temp_resource_folder + '/' + file_name + '.js'
-                temp_file = open(local_file, 'w')
-                temp_file.write(js_body.encode('utf-8'))
-                temp_file.close()
+                if isinstance(js_body, unicode):
+                    js_body = js_body.encode('utf-8')
+                with open(local_file, 'w') as temp_file:
+                    temp_file.write(js_body)
 
         if local_file:
             # Extract .js


