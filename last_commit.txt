Repository: plone.tiles


Branch: refs/heads/master
Date: 2016-02-16T14:27:27+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.tiles/commit/fdb2736b28bd8cb964270443bf59798f5d010faa

fixes

Files changed:
M buildout.cfg
M plone/tiles/data.py
M plone/tiles/tile.py

diff --git a/buildout.cfg b/buildout.cfg
index 8ca29cf..eecc79b 100644
--- a/buildout.cfg
+++ b/buildout.cfg
@@ -1,2 +1,2 @@
 [buildout]
-extends = test-4.3.x.cfg
+extends = test-5.x.cfg
diff --git a/plone/tiles/data.py b/plone/tiles/data.py
index 10302cb..cd9e3ee 100644
--- a/plone/tiles/data.py
+++ b/plone/tiles/data.py
@@ -49,7 +49,7 @@ def __init__(self, tile):
             self.tile.request,
             self.tile.request.form
         )
-        self.key = '.'.join([ANNOTATIONS_KEY_PREFIX, tile.id])
+        self.key = '.'.join([ANNOTATIONS_KEY_PREFIX, str(tile.id)])
 
     def get(self):
         # use explicitly set data (saved as annotation on the request)
@@ -104,7 +104,7 @@ def __init__(self, tile):
             (tile.context, tile.request, tile), ITileDataContext)
         self.annotations = IAnnotations(self.context)
 
-        self.key = '.'.join([ANNOTATIONS_KEY_PREFIX, tile.id])
+        self.key = '.'.join([ANNOTATIONS_KEY_PREFIX, str(tile.id)])
 
     def _get_default_request_data(self):
         # If we don't have a schema, just take the request
diff --git a/plone/tiles/tile.py b/plone/tiles/tile.py
index 529538f..2ddc589 100644
--- a/plone/tiles/tile.py
+++ b/plone/tiles/tile.py
@@ -47,7 +47,9 @@ def __getitem__(self, name):
                 self.__doc__ = "For Zope 2, to keep the ZPublisher happy"
 
             self.request.response.setHeader(
-                'X-Tile-Url', self.url)
+                'X-Tile-Url',
+                self.url
+            )
 
             return self
 
@@ -75,13 +77,16 @@ def publishTraverse(self, request, name):
         return self[name]
 
     def __call__(self, *args, **kwargs):
-        if not hasattr(self, 'index'):
+        if getattr(self, 'index', None) is None:
             raise NotImplemented(
-                u"Override __call__ or set a class variable 'index' to point "
-                u"to a view page template file")
+                u'Override __call__ or set a class variable "index" to point '
+                u'to a view page template file'
+            )
         if self.id is not None:
             self.request.response.setHeader(
-                'X-Tile-Url', self.url[len(self.context.absolute_url()) + 1:])
+                'X-Tile-Url',
+                self.url[len(self.context.absolute_url()) + 1:]
+            )
         return self.index(*args, **kwargs)
 
     @property


