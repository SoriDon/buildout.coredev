Repository: plone.api


Branch: refs/heads/master
Date: 2022-06-18T12:08:34+02:00
Author: Martin Peeters (mpeeters) <martin.peeters@affinitic.be>
Commit: https://github.com/plone/plone.api/commit/e663fb164e7a96c72c467f64d2ade55ec959e342

`mutually_exclusive_parameters` error message should include only related arguments

Files changed:
A news/489.bugfix
M src/plone/api/tests/test_validation.py
M src/plone/api/validation.py

b'diff --git a/news/489.bugfix b/news/489.bugfix\nnew file mode 100644\nindex 00000000..d387893f\n--- /dev/null\n+++ b/news/489.bugfix\n@@ -0,0 +1 @@\n+- `mutually_exclusive_parameters` error message should include only related arguments\ndiff --git a/src/plone/api/tests/test_validation.py b/src/plone/api/tests/test_validation.py\nindex 810a02cc..b35a9dc0 100644\n--- a/src/plone/api/tests/test_validation.py\n+++ b/src/plone/api/tests/test_validation.py\n@@ -182,12 +182,24 @@ def test_two_mutually_exclusive_args_provided(self):\n         from plone.api.exc import InvalidParameterError\n \n         _func = mutually_exclusive_parameters("arg1", "arg2")(undecorated_func)\n-        with self.assertRaises(InvalidParameterError):\n+        with self.assertRaisesRegex(\n+            InvalidParameterError,\n+            "^These parameters are mutually exclusive: arg1, arg2.$",\n+        ):\n             _func("ahoy", "there")\n \n-        with self.assertRaises(InvalidParameterError):\n+        with self.assertRaisesRegex(\n+            InvalidParameterError,\n+            "^These parameters are mutually exclusive: arg1, arg2.$",\n+        ):\n             _func(arg1="ahoy", arg2="there")\n \n+        with self.assertRaisesRegex(\n+            InvalidParameterError,\n+            "^These parameters are mutually exclusive: arg1, arg2.$",\n+        ):\n+            _func(arg1="ahoy", arg2="there", arg3="!")\n+\n     def test_require_at_least_one_but_none_provided(self):\n         """Test that MissingParameterError is raised if no argument is supplied\n         when at least one is required.\ndiff --git a/src/plone/api/validation.py b/src/plone/api/validation.py\nindex d4bc707f..ff972b09 100644\n--- a/src/plone/api/validation.py\n+++ b/src/plone/api/validation.py\n@@ -102,7 +102,7 @@ def wrapped(function, *args, **kwargs):\n             if len(clashes) > 1:\n                 raise InvalidParameterError(\n                     "These parameters are mutually exclusive: {arg}.".format(\n-                        arg=", ".join(supplied_args),\n+                        arg=", ".join(clashes),\n                     ),\n                 )\n \n'

Repository: plone.api


Branch: refs/heads/master
Date: 2022-06-23T15:01:14+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.api/commit/2e2ba864e04238435efc4d683eebacf0429c2aaa

Merge pull request #490 from mpeeters/master

`mutually_exclusive_parameters` error message should include only relâ€¦

Files changed:
A news/489.bugfix
M src/plone/api/tests/test_validation.py
M src/plone/api/validation.py

b'diff --git a/news/489.bugfix b/news/489.bugfix\nnew file mode 100644\nindex 00000000..d387893f\n--- /dev/null\n+++ b/news/489.bugfix\n@@ -0,0 +1 @@\n+- `mutually_exclusive_parameters` error message should include only related arguments\ndiff --git a/src/plone/api/tests/test_validation.py b/src/plone/api/tests/test_validation.py\nindex 810a02cc..b35a9dc0 100644\n--- a/src/plone/api/tests/test_validation.py\n+++ b/src/plone/api/tests/test_validation.py\n@@ -182,12 +182,24 @@ def test_two_mutually_exclusive_args_provided(self):\n         from plone.api.exc import InvalidParameterError\n \n         _func = mutually_exclusive_parameters("arg1", "arg2")(undecorated_func)\n-        with self.assertRaises(InvalidParameterError):\n+        with self.assertRaisesRegex(\n+            InvalidParameterError,\n+            "^These parameters are mutually exclusive: arg1, arg2.$",\n+        ):\n             _func("ahoy", "there")\n \n-        with self.assertRaises(InvalidParameterError):\n+        with self.assertRaisesRegex(\n+            InvalidParameterError,\n+            "^These parameters are mutually exclusive: arg1, arg2.$",\n+        ):\n             _func(arg1="ahoy", arg2="there")\n \n+        with self.assertRaisesRegex(\n+            InvalidParameterError,\n+            "^These parameters are mutually exclusive: arg1, arg2.$",\n+        ):\n+            _func(arg1="ahoy", arg2="there", arg3="!")\n+\n     def test_require_at_least_one_but_none_provided(self):\n         """Test that MissingParameterError is raised if no argument is supplied\n         when at least one is required.\ndiff --git a/src/plone/api/validation.py b/src/plone/api/validation.py\nindex d4bc707f..ff972b09 100644\n--- a/src/plone/api/validation.py\n+++ b/src/plone/api/validation.py\n@@ -102,7 +102,7 @@ def wrapped(function, *args, **kwargs):\n             if len(clashes) > 1:\n                 raise InvalidParameterError(\n                     "These parameters are mutually exclusive: {arg}.".format(\n-                        arg=", ".join(supplied_args),\n+                        arg=", ".join(clashes),\n                     ),\n                 )\n \n'

