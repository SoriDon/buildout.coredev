Repository: mockup


Branch: refs/heads/master
Date: 2016-10-03T09:06:14-03:00
Author: Rodrigo Ferreira de Souza (rodfersou) <rodfersou@gmail.com>
Commit: https://github.com/plone/mockup/commit/627ed82e898489db67a782d585af59d9d81bc825

Added options to change default search order

Files changed:
M CHANGES.rst
M mockup/patterns/livesearch/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 31e6d00..1dcae3e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -13,6 +13,9 @@ Incompatibilities:
 
 New:
 
+- Change default sort option in livesearch pattern.
+  [rodfersou]
+
 - Show expired label in folder contents for expired attributes
   [vangheem]
 
diff --git a/mockup/patterns/livesearch/pattern.js b/mockup/patterns/livesearch/pattern.js
index ef92046..12b06f5 100644
--- a/mockup/patterns/livesearch/pattern.js
+++ b/mockup/patterns/livesearch/pattern.js
@@ -59,10 +59,31 @@ define([
       if(page === undefined){
         page = 1;
       }
+      var sort_on = function(){
+        var parameters = location.search,
+            sorton_position = parameters.indexOf('sort_on');
+        if(sorton_position === -1){
+          // return default sort
+          var $searchResults = $('#search-results');
+          if($searchResults.length > 0){
+            return $searchResults.attr('data-default-sort');
+          }
+          return '';
+        }
+        // cut string before sort_on parameter
+        var sort_on = parameters.substring(sorton_position);
+        // cut other parameters
+        sort_on = sort_on.split('&')[0];
+        // get just the value
+        sort_on = sort_on.split('=')[1];
+        return sort_on;
+      }();
+
       $.ajax({
         url: self.options.ajaxUrl + '?' + query +
              '&page=' + page +
-             '&perPage=' + self.options.perPage,
+             '&perPage=' + self.options.perPage +
+             '&sort_on=' + sort_on,
         dataType: 'json'
       }).done(function(data){
         self.results = data;
@@ -241,6 +262,10 @@ define([
           self.render();
         }
       });
+      $('#sorting-options a').click(function(e){
+        e.preventDefault();
+        self.onceFocused = false;
+      });
 
       /* create result dom */
       self.$results = $('<ul class="' + self.resultsClass + '"></ul>').hide().insertAfter(self.$input);


Repository: mockup


Branch: refs/heads/master
Date: 2016-10-07T15:35:42+02:00
Author: agitator (agitator) <hpeter@agitator.com>
Commit: https://github.com/plone/mockup/commit/7c642e26fdd29a2acbac2c921e82e987739f2a39

Merge pull request #713 from plone/issue_1600_5x

Issue 1600 - Plone 5.1.x - Added options to change default search order

Files changed:
M CHANGES.rst
M mockup/patterns/livesearch/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index ff09741..add75cd 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -13,6 +13,9 @@ Incompatibilities:
 
 New:
 
+- Change default sort option in livesearch pattern.
+  [rodfersou]
+
 - Show expired label in folder contents for expired attributes
   [vangheem]
 
diff --git a/mockup/patterns/livesearch/pattern.js b/mockup/patterns/livesearch/pattern.js
index ef92046..12b06f5 100644
--- a/mockup/patterns/livesearch/pattern.js
+++ b/mockup/patterns/livesearch/pattern.js
@@ -59,10 +59,31 @@ define([
       if(page === undefined){
         page = 1;
       }
+      var sort_on = function(){
+        var parameters = location.search,
+            sorton_position = parameters.indexOf('sort_on');
+        if(sorton_position === -1){
+          // return default sort
+          var $searchResults = $('#search-results');
+          if($searchResults.length > 0){
+            return $searchResults.attr('data-default-sort');
+          }
+          return '';
+        }
+        // cut string before sort_on parameter
+        var sort_on = parameters.substring(sorton_position);
+        // cut other parameters
+        sort_on = sort_on.split('&')[0];
+        // get just the value
+        sort_on = sort_on.split('=')[1];
+        return sort_on;
+      }();
+
       $.ajax({
         url: self.options.ajaxUrl + '?' + query +
              '&page=' + page +
-             '&perPage=' + self.options.perPage,
+             '&perPage=' + self.options.perPage +
+             '&sort_on=' + sort_on,
         dataType: 'json'
       }).done(function(data){
         self.results = data;
@@ -241,6 +262,10 @@ define([
           self.render();
         }
       });
+      $('#sorting-options a').click(function(e){
+        e.preventDefault();
+        self.onceFocused = false;
+      });
 
       /* create result dom */
       self.$results = $('<ul class="' + self.resultsClass + '"></ul>').hide().insertAfter(self.$input);


