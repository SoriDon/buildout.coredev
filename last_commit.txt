Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T18:04:05+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/f6c9cdca51f50ea245b47119c9565c8d33e2fefa

Configuring with plone/meta

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/65ae937a.internal
A tox.ini
M pyproject.toml
M setup.cfg

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 00000000..b4158b89\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 00000000..f6631b61\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "65ae937a"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 00000000..449e951a\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/news/65ae937a.internal b/news/65ae937a.internal\nnew file mode 100644\nindex 00000000..c08f5399\n--- /dev/null\n+++ b/news/65ae937a.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615de..9eb73f3c 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,43 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 908a1d62..0da8f8fb 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,9 +1,23 @@\n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n-\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n+\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 00000000..724a36cf\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,53 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --test-path={toxinidir} -s plone.app.portlets {posargs}\n+extras =\n+    test\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T18:05:51+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/9efdf3ca49820518b6d517bcc8a7a89955850c51

gitignore

Files changed:
M .gitignore

b'diff --git a/.gitignore b/.gitignore\nindex 0cf73216..33ae8cb9 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -2,7 +2,9 @@\n *.pyc\n *.pyo\n build\n+dependencies.svg\n dist\n .project\n .pydevproject\n .settings\n+.tox\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T18:06:18+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/51a184fea3a7f812ee33d7e4c61e7c51407c0f0a

chore: pyupgrade

Files changed:
M plone/app/portlets/browser/viewlets.py
M plone/app/portlets/dashboard/dashboard.py
M plone/app/portlets/dashboard/user_actions.py
M plone/app/portlets/tests/test_actions_portlet.py
M plone/app/portlets/tests/test_configuration.py

b'diff --git a/plone/app/portlets/browser/viewlets.py b/plone/app/portlets/browser/viewlets.py\nindex 6a365f00..b01eac94 100644\n--- a/plone/app/portlets/browser/viewlets.py\n+++ b/plone/app/portlets/browser/viewlets.py\n@@ -12,10 +12,10 @@ class ManagePortletsFallbackViewlet(ViewletBase):\n \n     def update(self):\n         plonelayout = getMultiAdapter(\n-            (self.context, self.request), name=u"plone_layout"\n+            (self.context, self.request), name="plone_layout"\n         )\n         context_state = getMultiAdapter(\n-            (self.context, self.request), name=u"plone_context_state"\n+            (self.context, self.request), name="plone_context_state"\n         )\n \n         self.portlet_assignable = context_state.portlet_assignable()\n@@ -36,7 +36,7 @@ class FooterViewlet(ViewletBase):\n     index = ViewPageTemplateFile("templates/footer.pt")\n \n     def update(self):\n-        super(FooterViewlet, self).update()\n+        super().update()\n         self.year = date.today().year\n \n     def render_footer_portlets(self):\ndiff --git a/plone/app/portlets/dashboard/dashboard.py b/plone/app/portlets/dashboard/dashboard.py\nindex abc42837..db74acef 100644\n--- a/plone/app/portlets/dashboard/dashboard.py\n+++ b/plone/app/portlets/dashboard/dashboard.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from AccessControl import getSecurityManager\n from plone.memoize.instance import memoize\n from plone.portlets.constants import GROUP_CATEGORY\n@@ -28,8 +27,8 @@ def __call__(self):\n         self.request.set("disable_plone.rightcolumn", 1)\n         if self.can_edit() and self.empty():\n             message = _(\n-                u"info_empty_dashboard",\n-                default=u"Your dashboard is currently empty. Click the"\n+                "info_empty_dashboard",\n+                default="Your dashboard is currently empty. Click the"\n                 " <em>edit</em> tab to assign some personal"\n                 " portlets.",\n             )\ndiff --git a/plone/app/portlets/dashboard/user_actions.py b/plone/app/portlets/dashboard/user_actions.py\nindex 64e10f96..5cec7084 100644\n--- a/plone/app/portlets/dashboard/user_actions.py\n+++ b/plone/app/portlets/dashboard/user_actions.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from Products.Five.browser import BrowserView\n from zope.component import getMultiAdapter\n \n@@ -8,7 +7,7 @@ class UserActionsView(BrowserView):\n \n     def user_actions(self):\n         context_state = getMultiAdapter(\n-            (self.context, self.request), name=u"plone_context_state"\n+            (self.context, self.request), name="plone_context_state"\n         )\n \n         actions = context_state.actions("user")\ndiff --git a/plone/app/portlets/tests/test_actions_portlet.py b/plone/app/portlets/tests/test_actions_portlet.py\nindex c9a2b605..a7c7d758 100644\n--- a/plone/app/portlets/tests/test_actions_portlet.py\n+++ b/plone/app/portlets/tests/test_actions_portlet.py\n@@ -19,7 +19,7 @@ def afterSetUp(self):\n \n     def test_portlet_type_registered(self):\n         portlet = getUtility(IPortletType, name="portlets.Actions")\n-        self.assertEquals(portlet.addview, "portlets.Actions")\n+        self.assertEqual(portlet.addview, "portlets.Actions")\n         return\n \n     def test_interfaces(self):\n@@ -40,7 +40,7 @@ def test_invoke_add_view(self):\n         data = {"ptitle": "Actions", "category": "document", "show_icons": True}\n         addview.createAndAdd(data=data)\n \n-        self.assertEquals(len(mapping), 1)\n+        self.assertEqual(len(mapping), 1)\n         self.assertTrue(isinstance(mapping.values()[0], actions.Assignment))\n         return\n \n@@ -158,18 +158,18 @@ def test_multiple_portlets(self):\n         links2 = r2.actionLinks()\n \n         # check the portal_tabs links (portal_tabs is somehow special)\n-        self.assertEquals(len(links1), 5)\n-        self.assertEquals(links1[0]["title"], "Home")\n+        self.assertEqual(len(links1), 5)\n+        self.assertEqual(links1[0]["title"], "Home")\n \n         # now check the site_actions links\n         # this was failing until the caching of actionLinks method was fixed\n         if int(migtool.getInstanceVersion()[0]) >= 4:\n-            self.assertEquals(len(links2), 3)\n+            self.assertEqual(len(links2), 3)\n         else:\n-            self.assertEquals(len(links2), 4)\n-        self.assertEquals(links2[0]["title"], "Site Map")\n-        self.assertEquals(links2[0]["url"], "http://nohost/plone/sitemap")\n-        self.assertEquals(links2[0]["icon"], None)\n+            self.assertEqual(len(links2), 4)\n+        self.assertEqual(links2[0]["title"], "Site Map")\n+        self.assertEqual(links2[0]["url"], "http://nohost/plone/sitemap")\n+        self.assertEqual(links2[0]["icon"], None)\n         return\n \n     def test_portal_tabs(self):\ndiff --git a/plone/app/portlets/tests/test_configuration.py b/plone/app/portlets/tests/test_configuration.py\nindex a064e73b..f23688b3 100644\n--- a/plone/app/portlets/tests/test_configuration.py\n+++ b/plone/app/portlets/tests/test_configuration.py\n@@ -425,7 +425,7 @@ def testPurgeMethod(self):\n \n     def testPurge(self):\n         manager = queryUtility(IPortletManager, name="test.testcolumn")\n-        self.assertNotEquals(None, manager)\n+        self.assertNotEqual(None, manager)\n \n         context = DummyImportContext(self.portal, purge=False)\n         context._files[\n@@ -441,7 +441,7 @@ def testPurge(self):\n \n     def testManagerRemove(self):\n         manager = queryUtility(IPortletManager, name="test.testcolumn")\n-        self.assertNotEquals(None, manager)\n+        self.assertNotEqual(None, manager)\n \n         context = DummyImportContext(self.portal, purge=False)\n         context._files[\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T18:06:39+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/356a3d291a11cfcbfffbf5a14117493dfd9f5414

chore: isort

Files changed:
M plone/app/portlets/browser/viewlets.py
M plone/app/portlets/portlets/language.py

b'diff --git a/plone/app/portlets/browser/viewlets.py b/plone/app/portlets/browser/viewlets.py\nindex b01eac94..655dbab1 100644\n--- a/plone/app/portlets/browser/viewlets.py\n+++ b/plone/app/portlets/browser/viewlets.py\n@@ -1,8 +1,8 @@\n-from zope.component import getMultiAdapter\n-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n-from plone.app.layout.viewlets.common import ViewletBase\n from AccessControl import getSecurityManager\n from datetime import date\n+from plone.app.layout.viewlets.common import ViewletBase\n+from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n+from zope.component import getMultiAdapter\n \n \n class ManagePortletsFallbackViewlet(ViewletBase):\ndiff --git a/plone/app/portlets/portlets/language.py b/plone/app/portlets/portlets/language.py\nindex 23906b7d..3ca7277b 100644\n--- a/plone/app/portlets/portlets/language.py\n+++ b/plone/app/portlets/portlets/language.py\n@@ -1,6 +1,6 @@\n-from plone.app.i18n.locales.browser.selector import LanguageSelector\n from .. import PloneMessageFactory as _\n from ..portlets import base\n+from plone.app.i18n.locales.browser.selector import LanguageSelector\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getMultiAdapter\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T18:07:00+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/f4d6c7eb25793af37590e6ff300a3972ab741d7e

chore: black

Files changed:
M plone/app/portlets/browser/adding.py
M plone/app/portlets/browser/manage.py
M plone/app/portlets/browser/viewlets.py
M plone/app/portlets/exportimport/portlets.py
M plone/app/portlets/metaconfigure.py
M plone/app/portlets/portlets/language.py
M plone/app/portlets/portlets/login.py
M plone/app/portlets/portlets/navigation.py
M plone/app/portlets/portlets/news.py
M plone/app/portlets/portlets/recent.py
M plone/app/portlets/portlets/review.py
M plone/app/portlets/portlets/rss.py
M plone/app/portlets/portlets/search.py
M plone/app/portlets/testing.py
M plone/app/portlets/tests/test_configuration.py
M plone/app/portlets/tests/test_context.py
M plone/app/portlets/tests/test_dashboard.py
M plone/app/portlets/tests/test_formextender.py
M plone/app/portlets/tests/test_namechooser.py

b'diff --git a/plone/app/portlets/browser/adding.py b/plone/app/portlets/browser/adding.py\nindex 656babe3..be62f690 100644\n--- a/plone/app/portlets/browser/adding.py\n+++ b/plone/app/portlets/browser/adding.py\n@@ -14,7 +14,6 @@\n \n @implementer(IPortletAdding)\n class PortletAdding(SimpleItem, BrowserView):\n-\n     context = None\n     request = None\n \ndiff --git a/plone/app/portlets/browser/manage.py b/plone/app/portlets/browser/manage.py\nindex 0face36a..1c970240 100644\n--- a/plone/app/portlets/browser/manage.py\n+++ b/plone/app/portlets/browser/manage.py\n@@ -120,7 +120,6 @@ def convert_legacy_portlets(self):\n \n @implementer(IManageDashboardPortletsView)\n class ManageDashboardPortlets(BrowserView):\n-\n     # IManagePortletsView implementation\n \n     @property\n@@ -212,7 +211,6 @@ def getAssignmentsForManager(self, manager):\n \n @implementer(IManageGroupPortletsView)\n class ManageGroupPortlets(BrowserView):\n-\n     # IManagePortletsView implementation\n \n     @property\ndiff --git a/plone/app/portlets/browser/viewlets.py b/plone/app/portlets/browser/viewlets.py\nindex 655dbab1..01fa1f8b 100644\n--- a/plone/app/portlets/browser/viewlets.py\n+++ b/plone/app/portlets/browser/viewlets.py\n@@ -11,9 +11,7 @@ class ManagePortletsFallbackViewlet(ViewletBase):\n     index = ViewPageTemplateFile("templates/manage_portlets_fallback.pt")\n \n     def update(self):\n-        plonelayout = getMultiAdapter(\n-            (self.context, self.request), name="plone_layout"\n-        )\n+        plonelayout = getMultiAdapter((self.context, self.request), name="plone_layout")\n         context_state = getMultiAdapter(\n             (self.context, self.request), name="plone_context_state"\n         )\n@@ -32,6 +30,7 @@ def available(self):\n             return False\n         return bool(not self.sl and not self.sr and self.portlet_assignable)\n \n+\n class FooterViewlet(ViewletBase):\n     index = ViewPageTemplateFile("templates/footer.pt")\n \ndiff --git a/plone/app/portlets/exportimport/portlets.py b/plone/app/portlets/exportimport/portlets.py\nindex 6c404fac..82e1d70b 100644\n--- a/plone/app/portlets/exportimport/portlets.py\n+++ b/plone/app/portlets/exportimport/portlets.py\n@@ -802,7 +802,6 @@ def exportPortlets(context):\n \n \n class InvalidPortletForDefinition(Exception):\n-\n     message = """The following portlet definition is invalid: %s\n The \'for\' attribute is not supported, use \'for\' sub-elements instead.\n See http://plone.org/documentation/manual/upgrade-guide/version/\\\ndiff --git a/plone/app/portlets/metaconfigure.py b/plone/app/portlets/metaconfigure.py\nindex 2dff5aae..89b5469f 100644\n--- a/plone/app/portlets/metaconfigure.py\n+++ b/plone/app/portlets/metaconfigure.py\n@@ -147,7 +147,6 @@ def portletRendererDirective(\n         raise TypeError("\'template\' and \'class\' cannot be specified at the same time")\n \n     if template is not None:\n-\n         # Look up the default renderer for this portlet\n         base_class = _default_renderers.get(portlet, None)\n         if base_class is None:\ndiff --git a/plone/app/portlets/portlets/language.py b/plone/app/portlets/portlets/language.py\nindex 3ca7277b..f61b2d1f 100644\n--- a/plone/app/portlets/portlets/language.py\n+++ b/plone/app/portlets/portlets/language.py\n@@ -13,7 +13,6 @@ class ILanguagePortlet(IPortletDataProvider):\n \n @implementer(ILanguagePortlet)\n class Assignment(base.Assignment):\n-\n     title = _("label_languages", default="Languages")\n \n \ndiff --git a/plone/app/portlets/portlets/login.py b/plone/app/portlets/portlets/login.py\nindex 3f6cc1ac..ab23fa6b 100644\n--- a/plone/app/portlets/portlets/login.py\n+++ b/plone/app/portlets/portlets/login.py\n@@ -14,7 +14,6 @@ class ILoginPortlet(IPortletDataProvider):\n \n @implementer(ILoginPortlet)\n class Assignment(base.Assignment):\n-\n     title = _("label_log_in", default="Log in")\n \n \ndiff --git a/plone/app/portlets/portlets/navigation.py b/plone/app/portlets/portlets/navigation.py\nindex 124c6049..16e1eac7 100644\n--- a/plone/app/portlets/portlets/navigation.py\n+++ b/plone/app/portlets/portlets/navigation.py\n@@ -150,7 +150,6 @@ class INavigationPortlet(IPortletDataProvider):\n \n @implementer(INavigationPortlet)\n class Assignment(base.Assignment):\n-\n     name = ""\n     root = None\n     root_uid = None\ndiff --git a/plone/app/portlets/portlets/news.py b/plone/app/portlets/portlets/news.py\nindex 0075ee9d..452ae94b 100644\n--- a/plone/app/portlets/portlets/news.py\n+++ b/plone/app/portlets/portlets/news.py\n@@ -20,7 +20,6 @@\n \n \n class INewsPortlet(IPortletDataProvider):\n-\n     count = schema.Int(\n         title=_("Number of items to display"),\n         description=_("How many items to list."),\n@@ -60,7 +59,6 @@ class INewsPortlet(IPortletDataProvider):\n \n @implementer(INewsPortlet)\n class Assignment(base.Assignment):\n-\n     thumb_scale = None\n     no_thumbs = False\n \n@@ -78,7 +76,6 @@ def title(self):\n \n \n class Renderer(base.Renderer):\n-\n     _template = ViewPageTemplateFile("news.pt")\n \n     def __init__(self, *args):\ndiff --git a/plone/app/portlets/portlets/recent.py b/plone/app/portlets/portlets/recent.py\nindex 6ee8eeb7..4976cb3f 100644\n--- a/plone/app/portlets/portlets/recent.py\n+++ b/plone/app/portlets/portlets/recent.py\n@@ -21,7 +21,6 @@\n \n \n class IRecentPortlet(IPortletDataProvider):\n-\n     count = schema.Int(\n         title=_("Number of items to display"),\n         description=_("How many items to list."),\ndiff --git a/plone/app/portlets/portlets/review.py b/plone/app/portlets/portlets/review.py\nindex 1c00c23c..eb7346a5 100644\n--- a/plone/app/portlets/portlets/review.py\n+++ b/plone/app/portlets/portlets/review.py\n@@ -19,7 +19,6 @@\n \n \n class IReviewPortlet(IPortletDataProvider):\n-\n     no_icons = schema.Bool(\n         title=_("Suppress Icons"),\n         description=_("If enabled, the portlet will not show document type icons"),\n@@ -64,7 +63,6 @@ def title(self):\n \n \n class Renderer(base.Renderer):\n-\n     render = ViewPageTemplateFile("review.pt")\n \n     title = _("box_review_list", default="Review List")\ndiff --git a/plone/app/portlets/portlets/rss.py b/plone/app/portlets/portlets/rss.py\nindex c53a37bd..1cdf8ccc 100644\n--- a/plone/app/portlets/portlets/rss.py\n+++ b/plone/app/portlets/portlets/rss.py\n@@ -235,7 +235,6 @@ def siteurl(self):\n \n \n class IRSSPortlet(IPortletDataProvider):\n-\n     portlet_title = schema.TextLine(\n         title=_("Title"),\n         description=_(\n@@ -269,7 +268,6 @@ class IRSSPortlet(IPortletDataProvider):\n \n @implementer(IRSSPortlet)\n class Assignment(base.Assignment):\n-\n     portlet_title = ""\n \n     @property\n@@ -289,7 +287,6 @@ def __init__(self, portlet_title="", count=5, url="", timeout=100):\n \n \n class Renderer(base.DeferredRenderer):\n-\n     render_full = ZopeTwoPageTemplateFile("rss.pt")\n \n     @property\ndiff --git a/plone/app/portlets/portlets/search.py b/plone/app/portlets/portlets/search.py\nindex db7b3a68..18a45998 100644\n--- a/plone/app/portlets/portlets/search.py\n+++ b/plone/app/portlets/portlets/search.py\n@@ -34,7 +34,6 @@ def title(self):\n \n \n class Renderer(base.Renderer):\n-\n     render = ViewPageTemplateFile("search.pt")\n     action = "@@search"\n     livesearch_action = "livesearch_reply"\ndiff --git a/plone/app/portlets/testing.py b/plone/app/portlets/testing.py\nindex f37875e6..e481c116 100644\n--- a/plone/app/portlets/testing.py\n+++ b/plone/app/portlets/testing.py\n@@ -15,7 +15,6 @@\n \n \n class PloneAppPortlets(PloneSandboxLayer):\n-\n     defaultBases = (PLONE_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\ndiff --git a/plone/app/portlets/tests/test_configuration.py b/plone/app/portlets/tests/test_configuration.py\nindex f23688b3..9ae2ea5f 100644\n--- a/plone/app/portlets/tests/test_configuration.py\n+++ b/plone/app/portlets/tests/test_configuration.py\n@@ -63,7 +63,6 @@ class ITestPortlet(IPortletDataProvider):\n \n @implementer(ITestPortlet)\n class TestAssignment(base.Assignment):\n-\n     test_text = None\n     test_bool = None\n     test_tuple = None\ndiff --git a/plone/app/portlets/tests/test_context.py b/plone/app/portlets/tests/test_context.py\nindex c15b08cd..b4f6bb32 100644\n--- a/plone/app/portlets/tests/test_context.py\n+++ b/plone/app/portlets/tests/test_context.py\n@@ -18,7 +18,6 @@ def testGlobalsNoGroups(self):\n         self.assertEqual(g[1], ("user", TEST_USER_ID))\n \n     def testGlobalsWithSingleGroup(self):\n-\n         group = self.portal.portal_groups.getGroupById("Reviewers")\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n         group.addMember(TEST_USER_ID)\n@@ -32,7 +31,6 @@ def testGlobalsWithSingleGroup(self):\n         self.assertEqual(g[3], ("group", "Reviewers"))\n \n     def testGlobalsWithMultipleGroup(self):\n-\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n         group = self.portal.portal_groups.getGroupById("Reviewers")\n         group.addMember(TEST_USER_ID)\n@@ -70,7 +68,6 @@ def testGlobalsNoGroups(self):\n         self.assertEqual(g[1], ("user", TEST_USER_ID))\n \n     def testGlobalsWithSingleGroup(self):\n-\n         group = self.portal.portal_groups.getGroupById("Reviewers")\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n         group.addMember(TEST_USER_ID)\n@@ -84,7 +81,6 @@ def testGlobalsWithSingleGroup(self):\n         self.assertEqual(g[3], ("group", "Reviewers"))\n \n     def testGlobalsWithMultipleGroup(self):\n-\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n         group = self.portal.portal_groups.getGroupById("Reviewers")\n         group.addMember(TEST_USER_ID)\ndiff --git a/plone/app/portlets/tests/test_dashboard.py b/plone/app/portlets/tests/test_dashboard.py\nindex 0d504f76..b8c1ce2c 100644\n--- a/plone/app/portlets/tests/test_dashboard.py\n+++ b/plone/app/portlets/tests/test_dashboard.py\n@@ -15,7 +15,6 @@\n \n class TestDashboard(PortletsTestCase):\n     def test_default_dashboard_created_for_new_user(self):\n-\n         col = getUtility(IPortletManager, name="plone.dashboard1")\n         user_portlets = col[USER_CATEGORY]\n         self.assertFalse("fakeuser" in user_portlets)\n@@ -46,7 +45,6 @@ def test_non_ascii_usernames_created(self):\n \n \n def test_suite():\n-\n     suite = TestSuite()\n     suite.addTest(makeSuite(TestDashboard))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_formextender.py b/plone/app/portlets/tests/test_formextender.py\nindex 51fb7ada..1d3d5747 100644\n--- a/plone/app/portlets/tests/test_formextender.py\n+++ b/plone/app/portlets/tests/test_formextender.py\n@@ -149,7 +149,6 @@ def test_invoke_add_form(self):\n         self.assertEqual(settings.get("css_class"), "my-class")\n \n     def test_editform_fields(self):\n-\n         schema_field_names = [k for k in field.Fields(news.INewsPortlet).keys()]\n \n         mapping = PortletAssignmentMapping()\ndiff --git a/plone/app/portlets/tests/test_namechooser.py b/plone/app/portlets/tests/test_namechooser.py\nindex b8ee6889..a538d0d5 100644\n--- a/plone/app/portlets/tests/test_namechooser.py\n+++ b/plone/app/portlets/tests/test_namechooser.py\n@@ -7,7 +7,6 @@\n \n \n def test_suite():\n-\n     import plone.app.portlets.storage\n \n     return unittest.TestSuite(\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:19+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/c82439cf19dc2c3ff3cc8c07e4967f8ad2b572fc

chore: zpretty

Files changed:
M plone/app/portlets/browser/configure.zcml
M plone/app/portlets/browser/templates/column.pt
M plone/app/portlets/browser/templates/dashboard-column.pt
M plone/app/portlets/browser/templates/edit-manager-contextual.pt
M plone/app/portlets/browser/templates/edit-manager-macros.pt
M plone/app/portlets/browser/templates/edit-manager.pt
M plone/app/portlets/browser/templates/error_message.pt
M plone/app/portlets/browser/templates/footer.pt
M plone/app/portlets/browser/templates/manage-content-type.pt
M plone/app/portlets/browser/templates/manage-contextual.pt
M plone/app/portlets/browser/templates/manage-dashboard.pt
M plone/app/portlets/browser/templates/manage-group-dashboard.pt
M plone/app/portlets/browser/templates/manage-group.pt
M plone/app/portlets/browser/templates/manage_portlets_fallback.pt
M plone/app/portlets/browser/templates/portlets-pageform.pt
M plone/app/portlets/browser/templates/topbar-manage-portlets.pt
M plone/app/portlets/browser/templates/z3cform-portlets-pageform.pt
M plone/app/portlets/configure.zcml
M plone/app/portlets/dashboard/configure.zcml
M plone/app/portlets/dashboard/dashboard.pt
M plone/app/portlets/dashboard/user_actions.pt
M plone/app/portlets/exportimport/configure.zcml
M plone/app/portlets/meta.zcml
M plone/app/portlets/overrides.zcml
M plone/app/portlets/permissions.zcml
M plone/app/portlets/portlets/actions.pt
M plone/app/portlets/portlets/classic.pt
M plone/app/portlets/portlets/configure.zcml
M plone/app/portlets/portlets/language.pt
M plone/app/portlets/portlets/login.pt
M plone/app/portlets/portlets/navigation.pt
M plone/app/portlets/portlets/navigation_recurse.pt
M plone/app/portlets/portlets/news.pt
M plone/app/portlets/portlets/recent.pt
M plone/app/portlets/portlets/review.pt
M plone/app/portlets/portlets/rss.pt
M plone/app/portlets/portlets/search.pt
M plone/app/portlets/tests/configure.zcml
M plone/app/portlets/tests/profiles/testing/portlets.xml

b'diff --git a/plone/app/portlets/browser/configure.zcml b/plone/app/portlets/browser/configure.zcml\nindex 653f3487..48031e41 100644\n--- a/plone/app/portlets/browser/configure.zcml\n+++ b/plone/app/portlets/browser/configure.zcml\n@@ -1,243 +1,246 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <!-- Some things do not make sense in the breadcrumbs. -->\n-    <class class="..portlets.base.Assignment">\n-      <implements interface="Products.CMFPlone.interfaces.IHideFromBreadcrumbs" />\n-    </class>\n+  <!-- Some things do not make sense in the breadcrumbs. -->\n+  <class class="..portlets.base.Assignment">\n+    <implements interface="Products.CMFPlone.interfaces.IHideFromBreadcrumbs" />\n+  </class>\n \n-    <class class="..storage.PortletAssignmentMapping">\n-      <implements interface="Products.CMFPlone.interfaces.IHideFromBreadcrumbs" />\n-    </class>\n+  <class class="..storage.PortletAssignmentMapping">\n+    <implements interface="Products.CMFPlone.interfaces.IHideFromBreadcrumbs" />\n+  </class>\n \n-    <!-- Make a special renderer for the columns so we can control them\n+  <!-- Make a special renderer for the columns so we can control them\n       with a template\n     -->\n-    <adapter\n+  <adapter\n       factory="..manager.ColumnPortletManagerRenderer"\n       provides="plone.portlets.interfaces.IPortletManagerRenderer"\n       />\n \n-    <adapter\n+  <adapter\n       factory="..manager.DashboardPortletManagerRenderer"\n       provides="plone.portlets.interfaces.IPortletManagerRenderer"\n       />\n \n-    <!-- Namespace traversal adapters for various types of portlets -->\n-    <adapter\n-        factory=".traversal.ContextPortletNamespace"\n-        name="contextportlets"\n-        />\n-    <adapter\n-        factory=".traversal.DashboardNamespace"\n-        name="dashboard"\n-        />\n-    <adapter\n-        factory=".traversal.GroupPortletNamespace"\n-        name="groupportlets"\n-        />\n-    <adapter\n-        factory=".traversal.GroupDashboardNamespace"\n-        name="groupdashboard"\n-        />\n-    <adapter\n-        factory=".traversal.ContentTypePortletNamespace"\n-        name="contenttypeportlets"\n-        />\n+  <!-- Namespace traversal adapters for various types of portlets -->\n+  <adapter\n+      factory=".traversal.ContextPortletNamespace"\n+      name="contextportlets"\n+      />\n+  <adapter\n+      factory=".traversal.DashboardNamespace"\n+      name="dashboard"\n+      />\n+  <adapter\n+      factory=".traversal.GroupPortletNamespace"\n+      name="groupportlets"\n+      />\n+  <adapter\n+      factory=".traversal.GroupDashboardNamespace"\n+      name="groupdashboard"\n+      />\n+  <adapter\n+      factory=".traversal.ContentTypePortletNamespace"\n+      name="contenttypeportlets"\n+      />\n \n-    <!-- Portlet management pages -->\n+  <!-- Portlet management pages -->\n \n-    <browser:page\n-        for="*"\n-        name="manage-portlets-macros"\n-        class=".manage.ManageContextualPortlets"\n-        template="templates/edit-manager-macros.pt"\n-        permission="plone.app.portlets.ManageOwnPortlets"\n-        />\n+  <browser:page\n+      name="manage-portlets-macros"\n+      for="*"\n+      class=".manage.ManageContextualPortlets"\n+      template="templates/edit-manager-macros.pt"\n+      permission="plone.app.portlets.ManageOwnPortlets"\n+      />\n \n-    <browser:page\n+  <browser:page\n+      name="topbar-manage-portlets"\n       for="plone.portlets.interfaces.ILocalPortletAssignable"\n       class=".manage.TopbarManagePortlets"\n-      permission="plone.app.portlets.ManagePortlets"\n-      name="topbar-manage-portlets"\n       template="templates/topbar-manage-portlets.pt"\n+      permission="plone.app.portlets.ManagePortlets"\n       />\n \n \n-    <browser:pages\n+  <browser:pages\n       for="plone.portlets.interfaces.ILocalPortletAssignable"\n       class=".manage.ManageContextualPortlets"\n       permission="plone.app.portlets.ManagePortlets"\n       >\n \n-      <browser:page\n+    <browser:page\n         name="manage-portlets"\n         template="templates/manage-contextual.pt"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="convert-legacy-portlets"\n         attribute="convert_legacy_portlets"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="set-portlet-blacklist-status"\n         attribute="set_blacklist_status"\n         />\n \n-    </browser:pages>\n+  </browser:pages>\n \n-    <browser:page\n+  <browser:page\n+      name="manage-dashboard"\n       for="plone.app.layout.navigation.interfaces.INavigationRoot"\n       class=".manage.ManageDashboardPortlets"\n-      name="manage-dashboard"\n       template="templates/manage-dashboard.pt"\n       permission="plone.app.portlets.ManageOwnPortlets"\n       />\n \n-    <browser:page\n+  <browser:page\n+      name="manage-content-type-portlets"\n       for="Products.CMFCore.interfaces.ISiteRoot"\n       class=".manage.ManageContentTypePortlets"\n-      name="manage-content-type-portlets"\n       template="templates/manage-content-type.pt"\n       permission="plone.app.portlets.ManagePortlets"\n       />\n \n-    <browser:page\n+  <browser:page\n+      name="manage-group-portlets"\n       for="Products.CMFCore.interfaces.ISiteRoot"\n       class=".manage.ManageGroupPortlets"\n-      name="manage-group-portlets"\n       template="templates/manage-group.pt"\n       permission="plone.app.portlets.ManagePortlets"\n       />\n \n-    <browser:page\n+  <browser:page\n+      name="manage-group-dashboard"\n       for="Products.CMFCore.interfaces.ISiteRoot"\n       class=".manage.ManageGroupDashboardPortlets"\n-      name="manage-group-dashboard"\n       template="templates/manage-group-dashboard.pt"\n       permission="plone.app.portlets.ManagePortlets"\n       />\n \n-    <!-- Renderer for the columns in edit mode -->\n-    <adapter\n-        factory=".editmanager.EditPortletManagerRenderer"\n-        provides="plone.portlets.interfaces.IPortletManagerRenderer"\n-        />\n-    <adapter\n-        factory=".editmanager.ContextualEditPortletManagerRenderer"\n-        provides="plone.portlets.interfaces.IPortletManagerRenderer"\n-        />\n-    <adapter\n-        factory=".editmanager.DashboardEditPortletManagerRenderer"\n-        provides="plone.portlets.interfaces.IPortletManagerRenderer"\n-        />\n+  <!-- Renderer for the columns in edit mode -->\n+  <adapter\n+      factory=".editmanager.EditPortletManagerRenderer"\n+      provides="plone.portlets.interfaces.IPortletManagerRenderer"\n+      />\n+  <adapter\n+      factory=".editmanager.ContextualEditPortletManagerRenderer"\n+      provides="plone.portlets.interfaces.IPortletManagerRenderer"\n+      />\n+  <adapter\n+      factory=".editmanager.DashboardEditPortletManagerRenderer"\n+      provides="plone.portlets.interfaces.IPortletManagerRenderer"\n+      />\n \n \n-    <!-- Operations on portlets when in edit mode -->\n-    <browser:pages\n+  <!-- Operations on portlets when in edit mode -->\n+  <browser:pages\n       for="plone.portlets.interfaces.IPortletAssignmentMapping"\n       class=".editmanager.ManagePortletAssignments"\n       permission="plone.app.portlets.ManageOwnPortlets"\n       >\n \n-      <browser:page\n+    <browser:page\n         name="delete-portlet"\n         attribute="delete_portlet"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="move-portlet-up"\n         attribute="move_portlet_up"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="move-portlet-down"\n         attribute="move_portlet_down"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="toggle-visibility"\n         attribute="toggle_visibility"\n         />\n \n-    </browser:pages>\n+  </browser:pages>\n \n-    <!-- Adding view for portlet assignments -->\n-    <browser:view\n-      for="plone.portlets.interfaces.IPortletAssignmentMapping"\n+  <!-- Adding view for portlet assignments -->\n+  <browser:view\n       name="+"\n+      for="plone.portlets.interfaces.IPortletAssignmentMapping"\n       class=".adding.PortletAdding"\n       allowed_interface="plone.app.portlets.browser.interfaces.IPortletAdding"\n       permission="plone.app.portlets.ManagePortlets"\n       />\n \n-    <browser:view\n-      for="plone.app.portlets.interfaces.IUserPortletAssignmentMapping"\n+  <browser:view\n       name="+"\n+      for="plone.app.portlets.interfaces.IUserPortletAssignmentMapping"\n       class="plone.app.portlets.browser.adding.PortletAdding"\n       allowed_interface="plone.app.portlets.browser.interfaces.IPortletAdding"\n-      permission="plone.app.portlets.ManageOwnPortlets" />\n+      permission="plone.app.portlets.ManageOwnPortlets"\n+      />\n \n \n-    <class class=".adding.PortletAdding">\n-      <require\n+  <class class=".adding.PortletAdding">\n+    <require\n         permission="plone.app.portlets.ManagePortlets"\n-        interface=".interfaces.IPortletAdding" />\n-    </class>\n+        interface=".interfaces.IPortletAdding"\n+        />\n+  </class>\n \n-    <!-- Get pretty templates on our add and edit pages -->\n-    <configure package="Products.CMFPlone.browser">\n+  <!-- Get pretty templates on our add and edit pages -->\n+  <configure package="Products.CMFPlone.browser">\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.portlets.interfaces.IPortletAssignment"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.portlets.interfaces.IPortletAssignmentMapping"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.app.portlets.browser.interfaces.IPortletAdding"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-    </configure>\n+  </configure>\n \n-    <browser:page\n-        for="*"\n-        name="render-portlet"\n-        class=".utils.PortletUtilities"\n-        attribute="render_portlet"\n-        permission="zope2.View"\n-        />\n+  <browser:page\n+      name="render-portlet"\n+      for="*"\n+      class=".utils.PortletUtilities"\n+      attribute="render_portlet"\n+      permission="zope2.View"\n+      />\n \n-    <!-- Portlets Footer -->\n-    <browser:viewlet\n-        name="plone.footer"\n-        for="*"\n-        manager="plone.app.layout.viewlets.interfaces.IPortalFooter"\n-        class=".viewlets.FooterViewlet"\n-        permission="zope.Public"\n-        />\n+  <!-- Portlets Footer -->\n+  <browser:viewlet\n+      name="plone.footer"\n+      for="*"\n+      manager="plone.app.layout.viewlets.interfaces.IPortalFooter"\n+      class=".viewlets.FooterViewlet"\n+      permission="zope.Public"\n+      />\n \n-    <!-- Manage portlets Fallback link -->\n-    <browser:viewlet\n-        name="plone.manage_portlets_fallback"\n-        for="plone.portlets.interfaces.ILocalPortletAssignable"\n-        view="plone.app.layout.globals.interfaces.IViewView"\n-        manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n-        class=".viewlets.ManagePortletsFallbackViewlet"\n-        permission="zope2.View"\n-        />\n+  <!-- Manage portlets Fallback link -->\n+  <browser:viewlet\n+      name="plone.manage_portlets_fallback"\n+      for="plone.portlets.interfaces.ILocalPortletAssignable"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n+      class=".viewlets.ManagePortletsFallbackViewlet"\n+      permission="zope2.View"\n+      />\n \n </configure>\ndiff --git a/plone/app/portlets/browser/templates/column.pt b/plone/app/portlets/browser/templates/column.pt\nindex 5f01c0d6..b3dd4828 100644\n--- a/plone/app/portlets/browser/templates/column.pt\n+++ b/plone/app/portlets/browser/templates/column.pt\n@@ -1,6 +1,9 @@\n <tal:block repeat="portlet options/portlets">\n-<div class="portletWrapper"\n-    tal:attributes="id string:portletwrapper-${portlet/hash};\n-                     data-portlethash portlet/hash"\n-     tal:content="structure python:view.safe_render(portlet[\'renderer\'])" />\n+  <div class="portletWrapper"\n+       tal:content="structure python:view.safe_render(portlet[\'renderer\'])"\n+       tal:attributes="\n+         id string:portletwrapper-${portlet/hash};\n+         data-portlethash portlet/hash;\n+       "\n+  ></div>\n </tal:block>\ndiff --git a/plone/app/portlets/browser/templates/dashboard-column.pt b/plone/app/portlets/browser/templates/dashboard-column.pt\nindex 0d59beba..1a5bde69 100644\n--- a/plone/app/portlets/browser/templates/dashboard-column.pt\n+++ b/plone/app/portlets/browser/templates/dashboard-column.pt\n@@ -1,5 +1,8 @@\n <tal:block repeat="portlet options/portlets">\n-<div tal:attributes="id string:portletwrapper-${portlet/hash};\n-                     data-portlethash portlet/hash"\n-     tal:content="structure python:view.safe_render(portlet[\'renderer\'])" />\n+  <div tal:content="structure python:view.safe_render(portlet[\'renderer\'])"\n+       tal:attributes="\n+         id string:portletwrapper-${portlet/hash};\n+         data-portlethash portlet/hash;\n+       "\n+  ></div>\n </tal:block>\ndiff --git a/plone/app/portlets/browser/templates/edit-manager-contextual.pt b/plone/app/portlets/browser/templates/edit-manager-contextual.pt\nindex 4e3ac302..085756f8 100644\n--- a/plone/app/portlets/browser/templates/edit-manager-contextual.pt\n+++ b/plone/app/portlets/browser/templates/edit-manager-contextual.pt\n@@ -1,69 +1,107 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n-<div class="portlets-manager pat-manage-portlets row"\n-     tal:attributes="id string:portletmanager-${view/normalized_manager_name};"\n-     i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n+  <div class="portlets-manager pat-manage-portlets row"\n+       tal:attributes="\n+         id string:portletmanager-${view/normalized_manager_name};\n+       "\n+       i18n:domain="plone"\n+  >\n \n-  <div class="container">\n-    <div metal:use-macro="context/@@manage-portlets-macros/macros/portlet-add-form" />\n-  </div>\n+    <div class="container">\n+      <div metal:use-macro="context/@@manage-portlets-macros/macros/portlet-add-form"></div>\n+    </div>\n \n-  <div metal:use-macro="context/@@manage-portlets-macros/macros/current-portlets-list" />\n+    <div metal:use-macro="context/@@manage-portlets-macros/macros/current-portlets-list"></div>\n \n-  <div class="container portletAssignments">\n+    <div class="container portletAssignments">\n \n-    <h5 i18n:translate="heading_un_block_portlets">\n+      <h5 i18n:translate="heading_un_block_portlets">\n         Block/unblock portlets\n-    </h5>\n-\n-    <form method="post" tal:attributes="action view/blacklist_status_action" class="portlets-settings">\n-\n-        <span tal:replace="structure context/@@authenticator/authenticator" />\n-        <input type="hidden" name="manager" tal:attributes="value view/manager_name" />\n-\n-        <div tal:define="status view/context_blacklist_status" class="mb-3 portlet-group">\n+      </h5>\n+\n+      <form class="portlets-settings"\n+            method="post"\n+            tal:attributes="\n+              action view/blacklist_status_action;\n+            "\n+      >\n+\n+        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+        <input name="manager"\n+               type="hidden"\n+               tal:attributes="\n+                 value view/manager_name;\n+               "\n+        />\n+\n+        <div class="mb-3 portlet-group"\n+             tal:define="\n+               status view/context_blacklist_status;\n+             "\n+        >\n \n           <div class="mb-3">\n \n             <label i18n:translate="label_portlets_parent_folders">Parent portlets:</label>\n \n-            <select name="context_status:int" size="1" class="form-select">\n+            <select class="form-select"\n+                    name="context_status:int"\n+                    size="1"\n+            >\n \n-                <option value="1"\n-                        tal:attributes="selected python:status == True and \'selected\' or None"\n-                        i18n:translate="portlets_value_block">\n+              <option value="1"\n+                      tal:attributes="\n+                        selected python:status == True and \'selected\' or None;\n+                      "\n+                      i18n:translate="portlets_value_block"\n+              >\n                     Block\n-                </option>\n+              </option>\n \n-                <option value="-1"\n-                        tal:attributes="selected python:(status == False or status == None) and \'selected\' or None"\n-                        i18n:translate="portlets_value_show">\n+              <option value="-1"\n+                      tal:attributes="\n+                        selected python:(status == False or status == None) and \'selected\' or None;\n+                      "\n+                      i18n:translate="portlets_value_show"\n+              >\n                     Do not block\n-                </option>\n+              </option>\n \n             </select>\n \n           </div>\n \n-          <tal:block define="portlets view/inherited_portlets;"\n-                    condition="portlets">\n+          <tal:block define="\n+                       portlets view/inherited_portlets;\n+                     "\n+                     condition="portlets"\n+          >\n \n-            <div tal:attributes="class python:status and \'managedPortlet inheritedPortlet blockedPortlet list-group\' or \'managedPortlet inheritedPortlet list-group\'" tal:repeat="portlet portlets">\n+            <div tal:repeat="portlet portlets"\n+                 tal:attributes="\n+                   class python:status and \'managedPortlet inheritedPortlet blockedPortlet list-group\' or \'managedPortlet inheritedPortlet list-group\';\n+                 "\n+            >\n \n               <div class="list-group-item">\n \n-                <a tal:omit-tag="not:portlet/editview"\n-                  tal:attributes="href string:${portlet/editview}?referer=${view/url_quote_referer}"\n-                  tal:content="portlet/title" />\n+                <a tal:content="portlet/title"\n+                   tal:omit-tag="not:portlet/editview"\n+                   tal:attributes="\n+                     href string:${portlet/editview}?referer=${view/url_quote_referer};\n+                   "\n+                ></a>\n \n                 <span class="portletBlockedMessage hiddenStructure"\n-                  tal:condition="status"\n-                  title="Blocked"\n-                  i18n:translate="label_portlet_blocked"\n-                  i18n:attributes="title title_portlet_blocked;">\n+                      title="Blocked"\n+                      tal:condition="status"\n+                      i18n:attributes="title title_portlet_blocked;"\n+                      i18n:translate="label_portlet_blocked"\n+                >\n                   (Blocked)\n                 </span>\n               </div>\n@@ -73,48 +111,74 @@\n \n         </div>\n \n-        <div tal:define="status view/group_blacklist_status" class="mb-3 portlet-group">\n+        <div class="mb-3 portlet-group"\n+             tal:define="\n+               status view/group_blacklist_status;\n+             "\n+        >\n \n           <label i18n:translate="label_portlets_group_portlets">Group portlets:</label>\n \n-          <select name="group_status:int" size="1" class="form-select">\n-\n-              <option value="0"\n-                      tal:attributes="selected python:status == None and \'selected\' or None"\n-                      i18n:translate="portlets_value_use_parent">\n+          <select class="form-select"\n+                  name="group_status:int"\n+                  size="1"\n+          >\n+\n+            <option value="0"\n+                    tal:attributes="\n+                      selected python:status == None and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_use_parent"\n+            >\n                   Use parent settings\n-              </option>\n-\n-              <option value="1"\n-                      tal:attributes="selected python:status == True and \'selected\' or None"\n-                      i18n:translate="portlets_value_block">\n+            </option>\n+\n+            <option value="1"\n+                    tal:attributes="\n+                      selected python:status == True and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_block"\n+            >\n                   Block\n-              </option>\n-\n-              <option value="-1"\n-                      tal:attributes="selected python:status == False and \'selected\' or None"\n-                      i18n:translate="portlets_value_show">\n+            </option>\n+\n+            <option value="-1"\n+                    tal:attributes="\n+                      selected python:status == False and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_show"\n+            >\n                   Do not block\n-              </option>\n+            </option>\n \n           </select>\n \n-          <tal:block define="portlets view/group_portlets;\n-                            status python:view.group_blacklist_status(check_parent=True)">\n+          <tal:block define="\n+                       portlets view/group_portlets;\n+                       status python:view.group_blacklist_status(check_parent=True);\n+                     ">\n \n-            <div tal:attributes="class python:status and \'managedPortlet inheritedPortlet blockedPortlet\' or \'managedPortlet inheritedPortlet\'" tal:repeat="portlet portlets">\n+            <div tal:repeat="portlet portlets"\n+                 tal:attributes="\n+                   class python:status and \'managedPortlet inheritedPortlet blockedPortlet\' or \'managedPortlet inheritedPortlet\';\n+                 "\n+            >\n \n               <div class="portletHeader">\n \n-                <a tal:omit-tag="not:portlet/editview"\n-                  tal:attributes="href string:${portlet/editview}?referer=${view/url_quote_referer}"\n-                  tal:content="portlet/title" />\n+                <a tal:content="portlet/title"\n+                   tal:omit-tag="not:portlet/editview"\n+                   tal:attributes="\n+                     href string:${portlet/editview}?referer=${view/url_quote_referer};\n+                   "\n+                ></a>\n \n                 <span class="portletBlockedMessage hiddenStructure"\n-                  tal:condition="status"\n-                  title="Blocked"\n-                  i18n:translate="label_portlet_blocked"\n-                  i18n:attributes="title title_portlet_blocked;">\n+                      title="Blocked"\n+                      tal:condition="status"\n+                      i18n:attributes="title title_portlet_blocked;"\n+                      i18n:translate="label_portlet_blocked"\n+                >\n                   (Blocked)\n                 </span>\n \n@@ -127,46 +191,71 @@\n         </div>\n \n \n-        <div tal:define="status view/content_type_blacklist_status" class="mb-3 portlet-group">\n+        <div class="mb-3 portlet-group"\n+             tal:define="\n+               status view/content_type_blacklist_status;\n+             "\n+        >\n \n           <label i18n:translate="label_portlets_content_type_portlets">Content type portlets:</label>\n \n-          <select name="content_type_status:int" size="1"  class="form-select">\n-\n-              <option value="0"\n-                      tal:attributes="selected python:status == None and \'selected\' or None"\n-                      i18n:translate="portlets_value_use_parent">\n+          <select class="form-select"\n+                  name="content_type_status:int"\n+                  size="1"\n+          >\n+\n+            <option value="0"\n+                    tal:attributes="\n+                      selected python:status == None and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_use_parent"\n+            >\n                   Use parent settings\n-              </option>\n-\n-              <option value="1"\n-                      tal:attributes="selected python:status == True and \'selected\' or None"\n-                      i18n:translate="portlets_value_block">\n+            </option>\n+\n+            <option value="1"\n+                    tal:attributes="\n+                      selected python:status == True and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_block"\n+            >\n                   Block\n-              </option>\n-\n-              <option value="-1"\n-                      tal:attributes="selected python:status == False and \'selected\' or None"\n-                      i18n:translate="portlets_value_show">\n+            </option>\n+\n+            <option value="-1"\n+                    tal:attributes="\n+                      selected python:status == False and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_show"\n+            >\n                   Do not block\n-              </option>\n+            </option>\n           </select>\n \n-          <tal:block define="portlets view/content_type_portlets;\n-                    status python:view.content_type_blacklist_status(check_parent=True)">\n+          <tal:block define="\n+                       portlets view/content_type_portlets;\n+                       status python:view.content_type_blacklist_status(check_parent=True);\n+                     ">\n \n-            <div tal:attributes="class python:status and \'managedPortlet inheritedPortlet blockedPortlet\' or \'managedPortlet inheritedPortlet\'"\n-              tal:repeat="portlet portlets">\n+            <div tal:repeat="portlet portlets"\n+                 tal:attributes="\n+                   class python:status and \'managedPortlet inheritedPortlet blockedPortlet\' or \'managedPortlet inheritedPortlet\';\n+                 "\n+            >\n               <div class="portletHeader">\n-                <a tal:omit-tag="not:portlet/editview"\n-                  tal:attributes="href string:${portlet/editview}?referer=${view/url_quote_referer}"\n-                  tal:content="portlet/title" />\n+                <a tal:content="portlet/title"\n+                   tal:omit-tag="not:portlet/editview"\n+                   tal:attributes="\n+                     href string:${portlet/editview}?referer=${view/url_quote_referer};\n+                   "\n+                ></a>\n \n                 <span class="portletBlockedMessage hiddenStructure"\n-                  tal:condition="status"\n-                  title="Blocked"\n-                  i18n:translate="label_portlet_blocked"\n-                  i18n:attributes="title title_portlet_blocked;">\n+                      title="Blocked"\n+                      tal:condition="status"\n+                      i18n:attributes="title title_portlet_blocked;"\n+                      i18n:translate="label_portlet_blocked"\n+                >\n                   (Blocked)\n                 </span>\n \n@@ -177,17 +266,18 @@\n         </div>\n \n         <noscript>\n-        <div class="formControls">\n+          <div class="formControls">\n             <input class="btn btn-primary"\n-                  type="submit"\n-                  value="Save settings"\n-                  i18n:attributes="value label_save_settings"/>\n-        </div>\n+                   type="submit"\n+                   value="Save settings"\n+                   i18n:attributes="value label_save_settings"\n+            />\n+          </div>\n         </noscript>\n \n       </form>\n \n-  </div>\n+    </div>\n \n-</div>\n-</html>\n\\ No newline at end of file\n+  </div>\n+</html>\ndiff --git a/plone/app/portlets/browser/templates/edit-manager-macros.pt b/plone/app/portlets/browser/templates/edit-manager-macros.pt\nindex a4d0ac1a..3abd7d6d 100644\n--- a/plone/app/portlets/browser/templates/edit-manager-macros.pt\n+++ b/plone/app/portlets/browser/templates/edit-manager-macros.pt\n@@ -1,129 +1,314 @@\n-<div metal:define-macro="portlet-add-form" class="section mb-4" i18n:domain="plone">\n+<div class="section mb-4"\n+     metal:define-macro="portlet-add-form"\n+     i18n:domain="plone"\n+>\n \n-    <form method="post" action="#"\n-          tal:define="portlets view/addable_portlets"\n-          tal:condition="portlets"\n-          tal:attributes="action view/context_url">\n+  <form action="#"\n+        method="post"\n+        tal:define="\n+          portlets view/addable_portlets;\n+        "\n+        tal:condition="portlets"\n+        tal:attributes="\n+          action view/context_url;\n+        "\n+  >\n \n-        <input type="hidden" name="referer" tal:attributes="value view/referer" />\n+    <input name="referer"\n+           type="hidden"\n+           tal:attributes="\n+             value view/referer;\n+           "\n+    />\n \n-        <label class="hiddenStructure"\n-               i18n:translate="label_add_portlet">\n+    <label class="hiddenStructure"\n+           i18n:translate="label_add_portlet"\n+    >\n             Add portlet\n-        </label>\n+    </label>\n \n-        <select name=":action" class="add-portlet form-select"\n-                tal:attributes="data-context-url python: view.context_url()">\n-            <option tal:attributes="value python:request[\'ACTUAL_URL\'].replace(view.context_url(), \'\')"\n-                    i18n:translate="label_add_portlet_ellipsis">\n+    <select class="add-portlet form-select"\n+            name=":action"\n+            tal:attributes="\n+              data-context-url python: view.context_url();\n+            "\n+    >\n+      <option tal:attributes="\n+                value python:request[\'ACTUAL_URL\'].replace(view.context_url(), \'\');\n+              "\n+              i18n:translate="label_add_portlet_ellipsis"\n+      >\n                 Add portlet&hellip;\n-            </option>\n-            <tal:options repeat="portlet portlets">\n-                <option tal:attributes="value string:${portlet/addview}"\n-                        tal:content="portlet/title"\n-                        i18n:translate="" />\n-            </tal:options>\n-\n-        </select>\n-\n-        <noscript>\n-            <input class="btn btn-secondary"\n-                   type="submit"\n-                   value="Add portlet"\n-                   i18n:attributes="value label_add_portlet;"/>\n-        </noscript>\n-\n-    </form>\n+      </option>\n+      <tal:options repeat="portlet portlets">\n+        <option tal:content="portlet/title"\n+                tal:attributes="\n+                  value string:${portlet/addview};\n+                "\n+                i18n:translate=""\n+        ></option>\n+      </tal:options>\n+\n+    </select>\n+\n+    <noscript>\n+      <input class="btn btn-secondary"\n+             type="submit"\n+             value="Add portlet"\n+             i18n:attributes="value label_add_portlet;"\n+      />\n+    </noscript>\n+\n+  </form>\n </div>\n \n-<div metal:define-macro="current-portlets-list" class="portletAssignment"\n-    i18n:domain="plone"\n-    tal:define="portlets view/portlets">\n+<div class="portletAssignment"\n+     metal:define-macro="current-portlets-list"\n+     tal:define="\n+       portlets view/portlets;\n+     "\n+     i18n:domain="plone"\n+>\n \n-    <h5 i18n:translate="heading_portlets_assigned_here" tal:condition="portlets">\n+  <h5 tal:condition="portlets"\n+      i18n:translate="heading_portlets_assigned_here"\n+  >\n         Portlets assigned here\n-    </h5>\n+  </h5>\n \n-    <tal:block repeat="portlet portlets">\n-    <div\n-        tal:define="\n-            hiddenPortletClass python:not portlet[\'visible\'] and \'blockedPortlet\' or \'\';\n-            authenticator context/@@authenticator/authenticator"\n-        tal:attributes="\n-            class string:managedPortlet card mb-3 ${hiddenPortletClass};\n-            data-portlethash portlet/hash;\n-            data-viewname view/view_name;">\n-\n-        <div class="card-header d-flex align-items-center justify-content-between">\n-\n-            <a tal:omit-tag="not:portlet/editview"\n-                tal:attributes="href string:${portlet/editview}?referer=${view/url_quote_referer}"\n-                tal:content="portlet/title"></a>\n-        </div>\n-\n-        <div class="card-body managedPortletActions">\n-\n-            <form class="portlet-action up" method="POST"\n-                tal:attributes="action portlet/up_url"\n-                tal:condition="not:repeat/portlet/start">\n-                <input type="hidden" name="referer" tal:attributes="value view/url_quote_referer" />\n-                <input type="hidden" name="key" tal:attributes="value view/key" />\n-                <input type="hidden" name="name" tal:attributes="value portlet/name" />\n-                <input type="hidden" name="viewname" tal:attributes="value view/view_name" />\n-                <span tal:replace="structure authenticator"/>\n-                <button class="btn btn-outline-secondary btn-sm" title="Move up" i18n:attributes="title" type="submit"\n-                    tal:attributes="name string:${portlet/name}-up">&#9650;</button>\n-            </form>\n-\n-            <form class="portlet-action down" method="POST"\n-                tal:attributes="action portlet/down_url"\n-                tal:condition="not:repeat/portlet/end">\n-                <input type="hidden" name="referer" tal:attributes="value view/url_quote_referer" />\n-                <input type="hidden" name="key" tal:attributes="value view/key" />\n-                <input type="hidden" name="name" tal:attributes="value portlet/name" />\n-                <input type="hidden" name="viewname" tal:attributes="value view/view_name" />\n-                <span tal:replace="structure authenticator"/>\n-                <button class="btn btn-outline-secondary btn-sm" title="Move down" i18n:attributes="title" type="submit"\n-                    tal:attributes="name string:${portlet/name}-down">&#9660;</button>\n-            </form>\n-\n-            <form class="portlet-action" method="POST"\n-                tal:attributes="action portlet/show_url"\n-                tal:condition="not: portlet/visible">\n-                <input type="hidden" name="referer" tal:attributes="value view/url_quote_referer" />\n-                <input type="hidden" name="key" tal:attributes="value view/key" />\n-                <input type="hidden" name="name" tal:attributes="value portlet/name" />\n-                <input type="hidden" name="viewname" tal:attributes="value view/view_name" />\n-                <span tal:replace="structure authenticator"/>\n-                <button class="btn btn-outline-secondary btn-sm" type="submit" i18n:translate="label_show_item"\n-                    tal:attributes="name string:${portlet/name}-show">Show</button>\n-            </form>\n-\n-            <form class="portlet-action" method="POST"\n-                tal:attributes="action portlet/hide_url"\n-                tal:condition="portlet/visible">\n-                <input type="hidden" name="referer" tal:attributes="value view/url_quote_referer" />\n-                <input type="hidden" name="key" tal:attributes="value view/key" />\n-                <input type="hidden" name="name" tal:attributes="value portlet/name" />\n-                <input type="hidden" name="viewname" tal:attributes="value view/view_name" />\n-                <span tal:replace="structure authenticator"/>\n-                <button class="btn btn-outline-secondary btn-sm" type="submit" i18n:translate="label_hide_item"\n-                    tal:attributes="name string:${portlet/name}-hide">Hide</button>\n-            </form>\n-\n-            <form class="portlet-action delete" method="POST"\n-                tal:attributes="action portlet/delete_url">\n-                <input type="hidden" name="referer" tal:attributes="value view/url_quote_referer" />\n-                <input type="hidden" name="key" tal:attributes="value view/key" />\n-                <input type="hidden" name="name" tal:attributes="value portlet/name" />\n-                <input type="hidden" name="viewname" tal:attributes="value view/view_name" />\n-                <span tal:replace="structure authenticator"/>\n-                <button class="btn btn-outline-secondary btn-sm" i18n:attributes="title" title="Remove" type="submit"\n-                    tal:attributes="name string:${portlet/name}-remove">&times;</button>\n-            </form>\n-\n-        </div>\n+  <tal:block repeat="portlet portlets">\n+    <div tal:define="\n+           hiddenPortletClass python:not portlet[\'visible\'] and \'blockedPortlet\' or \'\';\n+           authenticator context/@@authenticator/authenticator;\n+         "\n+         tal:attributes="\n+           class string:managedPortlet card mb-3 ${hiddenPortletClass};\n+           data-portlethash portlet/hash;\n+           data-viewname view/view_name;\n+         "\n+    >\n+\n+      <div class="card-header d-flex align-items-center justify-content-between">\n+\n+        <a tal:content="portlet/title"\n+           tal:omit-tag="not:portlet/editview"\n+           tal:attributes="\n+             href string:${portlet/editview}?referer=${view/url_quote_referer};\n+           "\n+        ></a>\n+      </div>\n+\n+      <div class="card-body managedPortletActions">\n+\n+        <form class="portlet-action up"\n+              method="POST"\n+              tal:condition="not:repeat/portlet/start"\n+              tal:attributes="\n+                action portlet/up_url;\n+              "\n+        >\n+          <input name="referer"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/url_quote_referer;\n+                 "\n+          />\n+          <input name="key"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/key;\n+                 "\n+          />\n+          <input name="name"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value portlet/name;\n+                 "\n+          />\n+          <input name="viewname"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/view_name;\n+                 "\n+          />\n+          <span tal:replace="structure authenticator"></span>\n+          <button class="btn btn-outline-secondary btn-sm"\n+                  title="Move up"\n+                  type="submit"\n+                  tal:attributes="\n+                    name string:${portlet/name}-up;\n+                  "\n+                  i18n:attributes="title"\n+          >&#9650;</button>\n+        </form>\n+\n+        <form class="portlet-action down"\n+              method="POST"\n+              tal:condition="not:repeat/portlet/end"\n+              tal:attributes="\n+                action portlet/down_url;\n+              "\n+        >\n+          <input name="referer"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/url_quote_referer;\n+                 "\n+          />\n+          <input name="key"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/key;\n+                 "\n+          />\n+          <input name="name"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value portlet/name;\n+                 "\n+          />\n+          <input name="viewname"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/view_name;\n+                 "\n+          />\n+          <span tal:replace="structure authenticator"></span>\n+          <button class="btn btn-outline-secondary btn-sm"\n+                  title="Move down"\n+                  type="submit"\n+                  tal:attributes="\n+                    name string:${portlet/name}-down;\n+                  "\n+                  i18n:attributes="title"\n+          >&#9660;</button>\n+        </form>\n+\n+        <form class="portlet-action"\n+              method="POST"\n+              tal:condition="not: portlet/visible"\n+              tal:attributes="\n+                action portlet/show_url;\n+              "\n+        >\n+          <input name="referer"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/url_quote_referer;\n+                 "\n+          />\n+          <input name="key"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/key;\n+                 "\n+          />\n+          <input name="name"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value portlet/name;\n+                 "\n+          />\n+          <input name="viewname"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/view_name;\n+                 "\n+          />\n+          <span tal:replace="structure authenticator"></span>\n+          <button class="btn btn-outline-secondary btn-sm"\n+                  type="submit"\n+                  tal:attributes="\n+                    name string:${portlet/name}-show;\n+                  "\n+                  i18n:translate="label_show_item"\n+          >Show</button>\n+        </form>\n+\n+        <form class="portlet-action"\n+              method="POST"\n+              tal:condition="portlet/visible"\n+              tal:attributes="\n+                action portlet/hide_url;\n+              "\n+        >\n+          <input name="referer"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/url_quote_referer;\n+                 "\n+          />\n+          <input name="key"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/key;\n+                 "\n+          />\n+          <input name="name"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value portlet/name;\n+                 "\n+          />\n+          <input name="viewname"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/view_name;\n+                 "\n+          />\n+          <span tal:replace="structure authenticator"></span>\n+          <button class="btn btn-outline-secondary btn-sm"\n+                  type="submit"\n+                  tal:attributes="\n+                    name string:${portlet/name}-hide;\n+                  "\n+                  i18n:translate="label_hide_item"\n+          >Hide</button>\n+        </form>\n+\n+        <form class="portlet-action delete"\n+              method="POST"\n+              tal:attributes="\n+                action portlet/delete_url;\n+              "\n+        >\n+          <input name="referer"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/url_quote_referer;\n+                 "\n+          />\n+          <input name="key"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/key;\n+                 "\n+          />\n+          <input name="name"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value portlet/name;\n+                 "\n+          />\n+          <input name="viewname"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/view_name;\n+                 "\n+          />\n+          <span tal:replace="structure authenticator"></span>\n+          <button class="btn btn-outline-secondary btn-sm"\n+                  title="Remove"\n+                  type="submit"\n+                  tal:attributes="\n+                    name string:${portlet/name}-remove;\n+                  "\n+                  i18n:attributes="title"\n+          >&times;</button>\n+        </form>\n+\n+      </div>\n \n     </div>\n-    </tal:block>\n+  </tal:block>\n </div>\ndiff --git a/plone/app/portlets/browser/templates/edit-manager.pt b/plone/app/portlets/browser/templates/edit-manager.pt\nindex 55421e75..ab741186 100644\n--- a/plone/app/portlets/browser/templates/edit-manager.pt\n+++ b/plone/app/portlets/browser/templates/edit-manager.pt\n@@ -1,14 +1,18 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n-<div class="portlets-manager pat-manage-portlets"\n-     tal:attributes="id string:portletmanager-${view/normalized_manager_name};">\n+      tal:omit-tag=""\n+>\n+  <div class="portlets-manager pat-manage-portlets"\n+       tal:attributes="\n+         id string:portletmanager-${view/normalized_manager_name};\n+       "\n+  >\n \n-  <div metal:use-macro="context/@@manage-portlets-macros/macros/portlet-add-form" />\n+    <div metal:use-macro="context/@@manage-portlets-macros/macros/portlet-add-form"></div>\n \n-  <div metal:use-macro="context/@@manage-portlets-macros/macros/current-portlets-list" />\n+    <div metal:use-macro="context/@@manage-portlets-macros/macros/current-portlets-list"></div>\n \n-</div>\n+  </div>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/error_message.pt b/plone/app/portlets/browser/templates/error_message.pt\nindex 536b5f59..4b964967 100644\n--- a/plone/app/portlets/browser/templates/error_message.pt\n+++ b/plone/app/portlets/browser/templates/error_message.pt\n@@ -1,17 +1,20 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n-<section class="portlet portletError"\n-    i18n:domain="plone">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n+  <section class="portlet portletError"\n+           i18n:domain="plone"\n+  >\n \n     <header class="portletHeader">\n-        <a href="#"\n-           class="tile"\n-           i18n:translate="box_error">Error</a>\n+      <a class="tile"\n+         href="#"\n+         i18n:translate="box_error"\n+      >Error</a>\n     </header>\n     <section class="portletContent">\n-        <p i18n:translate="text_error_rendering_portlet">There was an error while rendering the portlet.</p>\n+      <p i18n:translate="text_error_rendering_portlet">There was an error while rendering the portlet.</p>\n     </section>\n-</section>\n+  </section>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/footer.pt b/plone/app/portlets/browser/templates/footer.pt\nindex df16ba9d..51f14d6c 100644\n--- a/plone/app/portlets/browser/templates/footer.pt\n+++ b/plone/app/portlets/browser/templates/footer.pt\n@@ -1,5 +1,7 @@\n <div class="row">\n-\t<div class="col-xs-12">\n-\t\t<div tal:on-error="nothing" tal:replace="structure view/render_footer_portlets" />\n-\t</div>\n+  <div class="col-xs-12">\n+    <div tal:replace="structure view/render_footer_portlets"\n+         tal:on-error="nothing"\n+    ></div>\n+  </div>\n </div>\ndiff --git a/plone/app/portlets/browser/templates/manage-content-type.pt b/plone/app/portlets/browser/templates/manage-content-type.pt\nindex b2d0f1a5..1b149b69 100644\n--- a/plone/app/portlets/browser/templates/manage-content-type.pt\n+++ b/plone/app/portlets/browser/templates/manage-content-type.pt\n@@ -1,41 +1,51 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n-<body>\n-<metal:main fill-slot="main">\n+  <body>\n+    <metal:main fill-slot="main">\n \n-  <h1 class="documentFirstHeading"\n-      i18n:translate="title_manage_contenttype_portlets">\n-      <img i18n:name="contenttype_icon"\n-           tal:define="icon view/portal_type_icon"\n-           tal:replace="structure icon/html_tag" />\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="title_manage_contenttype_portlets"\n+      >\n+        <img tal:define="\n+               icon view/portal_type_icon;\n+             "\n+             tal:replace="structure icon/html_tag"\n+             i18n:name="contenttype_icon"\n+        />\n       Manage content type portlets for\n-      <span i18n:name="contenttype_name" tal:content="view/portal_type">content type</span>\n-  </h1>\n+        <span tal:content="view/portal_type"\n+              i18n:name="contenttype_name"\n+        >content type</span>\n+      </h1>\n \n-  <div id="content-core">\n-      <a href=""\n-           class="link-parent"\n-           tal:attributes="href string:${context/absolute_url}/@@content-controlpanel?type_id=${request/key}"\n-           i18n:translate="return_to_view">\n+      <div id="content-core">\n+        <a class="link-parent"\n+           href=""\n+           tal:attributes="\n+             href string:${context/absolute_url}/@@content-controlpanel?type_id=${request/key};\n+           "\n+           i18n:translate="return_to_view"\n+        >\n         Return\n-      </a>\n+        </a>\n \n-      <p i18n:translate="description_manage_contenttype_portlets">\n+        <p i18n:translate="description_manage_contenttype_portlets">\n         The left and right portlet slots will now display only those portlets\n         assigned to this content type. Use the up, down, delete and edit links\n         to manage user portlets. Use the drop-down list to add new portlets.\n-      </p>\n+        </p>\n \n-      <p i18n:translate="description_contenttype_portlets_below">\n+        <p i18n:translate="description_contenttype_portlets_below">\n         Note that content type portlets are normally rendered below context portlets.\n-      </p>\n-  </div>\n+        </p>\n+      </div>\n \n-</metal:main>\n-</body>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/manage-contextual.pt b/plone/app/portlets/browser/templates/manage-contextual.pt\nindex 1cf4829f..b9e5832a 100644\n--- a/plone/app/portlets/browser/templates/manage-contextual.pt\n+++ b/plone/app/portlets/browser/templates/manage-contextual.pt\n@@ -1,94 +1,121 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n-<body>\n-<metal:main fill-slot="main" tal:define="plone_view context/@@plone">\n+  <body>\n+    <metal:main fill-slot="main"\n+                tal:define="\n+                  plone_view context/@@plone;\n+                "\n+    >\n \n-  <header>\n-    <h1 class="documentFirstHeading"\n-        i18n:translate="title_manage_contextual_portlets">\n+      <header>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="title_manage_contextual_portlets"\n+        >\n         Manage portlets for\n-        <q i18n:name="context_title" tal:content="context/Title">title</q>\n-    </h1>\n-    \n-    \n-    <a href=""\n-        class="link-parent d-inline-block mb-3"\n-        tal:attributes="href string:${context/absolute_url}"\n-        i18n:translate="return_to_view">\n+          <q tal:content="context/Title"\n+             i18n:name="context_title"\n+          >title</q>\n+        </h1>\n+\n+\n+        <a class="link-parent d-inline-block mb-3"\n+           href=""\n+           tal:attributes="\n+             href string:${context/absolute_url};\n+           "\n+           i18n:translate="return_to_view"\n+        >\n       Return\n-    </a>\n+        </a>\n \n-    <tal:block tal:define="is_portal_root context/@@plone_context_state/is_portal_root;"\n-            tal:condition="not:is_portal_root">\n-    <a class="link-parent mb-3 ms-3" tal:condition="plone_view/getParentObject|nothing"\n-    tal:attributes="href python:plone_view.getParentObject().absolute_url()+\'/@@manage-portlets\'"\n-    i18n:translate="">\n+        <tal:block tal:define="\n+                     is_portal_root context/@@plone_context_state/is_portal_root;\n+                   "\n+                   tal:condition="not:is_portal_root"\n+        >\n+          <a class="link-parent mb-3 ms-3"\n+             tal:condition="plone_view/getParentObject|nothing"\n+             tal:attributes="\n+               href python:plone_view.getParentObject().absolute_url()+\'/@@manage-portlets\';\n+             "\n+             i18n:translate=""\n+          >\n     Go to parent folder\n-    </a>\n-    </tal:block>\n-    \n-\n-    <div class="alert alert-info"\n-        role="status"\n-        tal:condition="plone_view/isDefaultPageInFolder|nothing">\n-      <strong i18n:translate="">\n+          </a>\n+        </tal:block>\n+\n+\n+        <div class="alert alert-info"\n+             role="status"\n+             tal:condition="plone_view/isDefaultPageInFolder|nothing"\n+        >\n+          <strong i18n:translate="">\n           Info\n-      </strong>\n-      <span tal:omit-tag=""\n-          i18n:translate="label_manage_portlets_default_view_container">\n+          </strong>\n+          <span tal:omit-tag=""\n+                i18n:translate="label_manage_portlets_default_view_container"\n+          >\n           You are managing the portlets of the default view of a container. If\n           you wanted to manage the portlets of the container itself,\n-          <a href=""\n-              i18n:name="go_here"\n-              i18n:translate="label_manage_portlets_default_view_container_go_here"\n-              tal:attributes="href string:${context/aq_inner/aq_parent/absolute_url}/@@manage-portlets">go here</a>.\n-      </span>\n-    </div>\n-  </header>\n+            <a href=""\n+               tal:attributes="\n+                 href string:${context/aq_inner/aq_parent/absolute_url}/@@manage-portlets;\n+               "\n+               i18n:name="go_here"\n+               i18n:translate="label_manage_portlets_default_view_container_go_here"\n+            >go here</a>.\n+          </span>\n+        </div>\n+      </header>\n \n-  <div id="content-core">\n+      <div id="content-core">\n \n-      <p i18n:translate="description_manage_contextual_portlets">\n+        <p i18n:translate="description_manage_contextual_portlets">\n         The portlet columns will first display portlets\n         explicitly assigned in this context. Use the buttons on each portlet\n         to move them up or down, delete or edit them. To add a new portlet,\n         use the drop-down list at the top of the column.\n-      </p>\n+        </p>\n \n-      <p i18n:translate="description_portlets_block_unblock">\n+        <p i18n:translate="description_portlets_block_unblock">\n           If you wish to block or unblock certain categories of portlets, you can\n           do so using the drop-down boxes. Portlets that are included by these categories\n           are shown below the selection box.\n-      </p>\n+        </p>\n \n-      <div tal:condition="view/has_legacy_portlets">\n+        <div tal:condition="view/has_legacy_portlets">\n \n-        <h2 i18n:translate="title_legacy_portlets">Legacy portlets</h2>\n+          <h2 i18n:translate="title_legacy_portlets">Legacy portlets</h2>\n \n-        <p i18n:translate="action_convert_legacy_portlets">\n+          <p i18n:translate="action_convert_legacy_portlets">\n           There are legacy portlets defined here. Click the button to\n           convert them to new-style portlets.\n-        </p>\n+          </p>\n \n-        <form method="post"\n-              tal:attributes="action string:${context/absolute_url}/@@convert-legacy-portlets">\n+          <form method="post"\n+                tal:attributes="\n+                  action string:${context/absolute_url}/@@convert-legacy-portlets;\n+                "\n+          >\n \n-            <input type="submit"\n-                   class="btn btn-primary"\n+            <input class="btn btn-primary"\n+                   name="convert"\n+                   type="submit"\n                    value="Convert portlets"\n                    i18n:attributes="value label_convert_portlets"\n-                   name="convert" />\n+            />\n \n-        </form>\n+          </form>\n \n+        </div>\n       </div>\n-  </div>\n \n-</metal:main>\n-</body>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/manage-dashboard.pt b/plone/app/portlets/browser/templates/manage-dashboard.pt\nindex 5c96ccde..cc2af212 100644\n--- a/plone/app/portlets/browser/templates/manage-dashboard.pt\n+++ b/plone/app/portlets/browser/templates/manage-dashboard.pt\n@@ -1,27 +1,29 @@\n-<html\n-    xmlns="http://www.w3.org/1999/xhtml"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    xml:lang="en"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n   <head>\n-    <metal:block\n-        fill-slot="top_slot"\n-        tal:define="dummy python:request.set(\'disable_border\',1);\n-                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n+    <metal:block fill-slot="top_slot"\n+                 tal:define="\n+                   dummy python:request.set(\'disable_border\',1);\n+                   disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                   disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+                 "\n+    />\n   </head>\n \n   <body>\n \n     <metal:b fill-slot="content-title">\n-      <h1\n-          class="documentFirstHeading"\n-          i18n:translate="title_edit_dashboard">\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="title_edit_dashboard"\n+      >\n         Edit your dashboard\n       </h1>\n     </metal:b>\n@@ -32,24 +34,32 @@\n \n         <div class="autotabs">\n           <nav class="autotoc-nav nav nav-tabs mb-3">\n-              <a class="nav-link"\n-                 href="${context/@@plone_portal_state/navigation_root_url}/dashboard"\n-                 i18n:translate="label_dashboard">Dashboard</a>\n-              <a class="active nav-link"\n-                 href="${context/@@plone_portal_state/navigation_root_url}/@@manage-dashboard?_authenticator=${view/auth_token}"\n-                 i18n:translate="label_edit">Edit</a>\n+            <a class="nav-link"\n+               href="${context/@@plone_portal_state/navigation_root_url}/dashboard"\n+               i18n:translate="label_dashboard"\n+            >Dashboard</a>\n+            <a class="active nav-link"\n+               href="${context/@@plone_portal_state/navigation_root_url}/@@manage-dashboard?_authenticator=${view/auth_token}"\n+               i18n:translate="label_edit"\n+            >Edit</a>\n           </nav>\n \n-          <div id="dashboard"\n-              class="row row-cols-1 row-cols-md-2 gx-5 gy-5">\n-            <div id="dashboard-portlets1" class=""\n-              tal:content="structure provider:plone.dashboard1" />\n+          <div class="row row-cols-1 row-cols-md-2 gx-5 gy-5"\n+               id="dashboard"\n+          >\n+            <div class=""\n+                 id="dashboard-portlets1"\n+                 tal:content="structure provider:plone.dashboard1"\n+            ></div>\n             <div id="dashboard-portlets2"\n-              tal:content="structure provider:plone.dashboard2" />\n+                 tal:content="structure provider:plone.dashboard2"\n+            ></div>\n             <div id="dashboard-portlets3"\n-              tal:content="structure provider:plone.dashboard3" />\n+                 tal:content="structure provider:plone.dashboard3"\n+            ></div>\n             <div id="dashboard-portlets4"\n-              tal:content="structure provider:plone.dashboard4" />\n+                 tal:content="structure provider:plone.dashboard4"\n+            ></div>\n           </div>\n         </div>\n \ndiff --git a/plone/app/portlets/browser/templates/manage-group-dashboard.pt b/plone/app/portlets/browser/templates/manage-group-dashboard.pt\nindex e99baf91..f080fd73 100644\n--- a/plone/app/portlets/browser/templates/manage-group-dashboard.pt\n+++ b/plone/app/portlets/browser/templates/manage-group-dashboard.pt\n@@ -1,59 +1,86 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      xml:lang="en" lang="en"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<head>\n+  <head>\n     <metal:block fill-slot="top_slot"\n-             tal:define="dummy python:request.set(\'disable_border\',1)" />\n+                 tal:define="\n+                   dummy python:request.set(\'disable_border\',1);\n+                 "\n+    />\n \n-</head>\n+  </head>\n \n-<body>\n+  <body>\n \n-<metal:b fill-slot="prefs_configlet_main">\n+    <metal:b fill-slot="prefs_configlet_main">\n \n-    <header>\n-      <h1 class="documentFirstHeading" i18n:translate="">Group: <span i18n:name="groupname" tal:content="view/group" tal:omit-tag=""/></h1>\n-    </header>\n+      <header>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate=""\n+        >Group:\n+          <span tal:content="view/group"\n+                tal:omit-tag=""\n+                i18n:name="groupname"\n+          ></span></h1>\n+      </header>\n \n-    <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n         Portal status message\n-    </div>\n-\n-    <div id="content-core" tal:define="token context/@@authenticator/token">\n-      <div class="autotabs">\n-        <nav class="autotoc-nav nav nav-tabs mb-3">\n-          <a class="nav-link" href="${portal_url}/@@usergroup-groupmembership?groupname=${request/key}"\n-             i18n:translate="label_group_members">Group Members</a>\n-          <a class="nav-link" href="${portal_url}/@@usergroup-groupdetails?groupname=${request/key}"\n-             i18n:translate="label_group_properties">Group Properties</a>\n-          <a class="nav-link" href="${portal_url}/@@manage-group-portlets?key=${request/key}&_authenticator=${token}"\n-             i18n:translate="label_group_portlets">Group Portlets</a>\n-          <a class="active nav-link"\n-             href="${portal_url}/@@manage-group-dashboard?key=${request/key}&_authenticator=${token}"\n-             i18n:translate="label_group_dashboard">Group Dashboard</a>\n-        </nav>\n-\n-        <div id="dashboard"\n-            class="row row-cols-1 row-cols-md-2 gx-5 gy-5">\n+      </div>\n+\n+      <div id="content-core"\n+           tal:define="\n+             token context/@@authenticator/token;\n+           "\n+      >\n+        <div class="autotabs">\n+          <nav class="autotoc-nav nav nav-tabs mb-3">\n+            <a class="nav-link"\n+               href="${portal_url}/@@usergroup-groupmembership?groupname=${request/key}"\n+               i18n:translate="label_group_members"\n+            >Group Members</a>\n+            <a class="nav-link"\n+               href="${portal_url}/@@usergroup-groupdetails?groupname=${request/key}"\n+               i18n:translate="label_group_properties"\n+            >Group Properties</a>\n+            <a class="nav-link"\n+               href="${portal_url}/@@manage-group-portlets?key=${request/key}&_authenticator=${token}"\n+               i18n:translate="label_group_portlets"\n+            >Group Portlets</a>\n+            <a class="active nav-link"\n+               href="${portal_url}/@@manage-group-dashboard?key=${request/key}&_authenticator=${token}"\n+               i18n:translate="label_group_dashboard"\n+            >Group Dashboard</a>\n+          </nav>\n+\n+          <div class="row row-cols-1 row-cols-md-2 gx-5 gy-5"\n+               id="dashboard"\n+          >\n             <div id="dashboard-portlets1"\n-              tal:content="structure provider:plone.dashboard1" />\n+                 tal:content="structure provider:plone.dashboard1"\n+            ></div>\n             <div id="dashboard-portlets2"\n-              tal:content="structure provider:plone.dashboard2" />\n+                 tal:content="structure provider:plone.dashboard2"\n+            ></div>\n             <div id="dashboard-portlets3"\n-              tal:content="structure provider:plone.dashboard3" />\n+                 tal:content="structure provider:plone.dashboard3"\n+            ></div>\n             <div id="dashboard-portlets4"\n-              tal:content="structure provider:plone.dashboard4" />\n+                 tal:content="structure provider:plone.dashboard4"\n+            ></div>\n+          </div>\n+          <div class="visualClear"><!-- --></div>\n         </div>\n-        <div class="visualClear"><!-- --></div>\n       </div>\n-    </div>\n \n-</metal:b>\n+    </metal:b>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/manage-group.pt b/plone/app/portlets/browser/templates/manage-group.pt\nindex 5d5c7c3c..edddf21f 100644\n--- a/plone/app/portlets/browser/templates/manage-group.pt\n+++ b/plone/app/portlets/browser/templates/manage-group.pt\n@@ -1,58 +1,82 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      xml:lang="en" lang="en"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="here/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<head>\n+  <head>\n     <metal:block fill-slot="top_slot"\n-             tal:define="dummy python:request.set(\'disable_border\',1)" />\n-</head>\n+                 tal:define="\n+                   dummy python:request.set(\'disable_border\',1);\n+                 "\n+    />\n+  </head>\n \n-<body>\n+  <body>\n \n-<metal:b fill-slot="content-title">\n-  <a href=""\n-       class="link-parent"\n-       tal:attributes="href string:$portal_url/@@usergroup-groupprefs"\n-       i18n:translate="label_up_to_groups_overview">\n+    <metal:b fill-slot="content-title">\n+      <a class="link-parent"\n+         href=""\n+         tal:attributes="\n+           href string:$portal_url/@@usergroup-groupprefs;\n+         "\n+         i18n:translate="label_up_to_groups_overview"\n+      >\n     Up to Groups Overview\n-  </a>\n-\n-  <h1 class="documentFirstHeading" i18n:translate="">Group: <span i18n:name="groupname" tal:content="view/group" tal:omit-tag=""/></h1>\n-</metal:b>\n-\n-<metal:b fill-slot="content-core">\n-  <metal:b metal:define-macro="props" tal:omit-tag="">\n-\n-    <div class="autotabs" tal:define="token context/@@authenticator/token">\n-      <nav class="autotoc-nav">\n-        <a href="${portal_url}/@@usergroup-groupmembership?groupname=${request/key}"\n-           i18n:translate="label_group_members">Group Members</a>\n-        <a href="${portal_url}/@@usergroup-groupdetails?groupname=${request/key}"\n-           i18n:translate="label_group_properties">Group Properties</a>\n-        <a class="active"\n-           href="${portal_url}/@@manage-group-portlets?key=${request/key}&_authenticator=${token}"\n-           i18n:translate="label_group_portlets">Group Portlets</a>\n-        <a href="${portal_url}/@@manage-group-dashboard?key=${request/key}&_authenticator=${token}"\n-           i18n:translate="label_group_dashboard">Group Dashboard</a>\n-      </nav>\n-\n-      <p i18n:translate="description_manage_group_portlets">\n+      </a>\n+\n+      <h1 class="documentFirstHeading"\n+          i18n:translate=""\n+      >Group:\n+        <span tal:content="view/group"\n+              tal:omit-tag=""\n+              i18n:name="groupname"\n+        ></span></h1>\n+    </metal:b>\n+\n+    <metal:b fill-slot="content-core">\n+      <metal:b metal:define-macro="props"\n+               tal:omit-tag=""\n+      >\n+\n+        <div class="autotabs"\n+             tal:define="\n+               token context/@@authenticator/token;\n+             "\n+        >\n+          <nav class="autotoc-nav">\n+            <a href="${portal_url}/@@usergroup-groupmembership?groupname=${request/key}"\n+               i18n:translate="label_group_members"\n+            >Group Members</a>\n+            <a href="${portal_url}/@@usergroup-groupdetails?groupname=${request/key}"\n+               i18n:translate="label_group_properties"\n+            >Group Properties</a>\n+            <a class="active"\n+               href="${portal_url}/@@manage-group-portlets?key=${request/key}&_authenticator=${token}"\n+               i18n:translate="label_group_portlets"\n+            >Group Portlets</a>\n+            <a href="${portal_url}/@@manage-group-dashboard?key=${request/key}&_authenticator=${token}"\n+               i18n:translate="label_group_dashboard"\n+            >Group Dashboard</a>\n+          </nav>\n+\n+          <p i18n:translate="description_manage_group_portlets">\n         The left and right portlet slots will now display only those portlets\n         assigned to this group. Use the up, down, delete and edit links\n         to manage user portlets. Use the drop-down list to add new portlets.\n-      </p>\n+          </p>\n \n-      <p i18n:translate="description_group_portlets_below">\n+          <p i18n:translate="description_group_portlets_below">\n         Note that group portlets are normally rendered below context portlets.\n-      </p>\n-    </div>\n+          </p>\n+        </div>\n \n-  </metal:b>\n-</metal:b>\n+      </metal:b>\n+    </metal:b>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/manage_portlets_fallback.pt b/plone/app/portlets/browser/templates/manage_portlets_fallback.pt\nindex ec5592d9..a7cba8b9 100644\n--- a/plone/app/portlets/browser/templates/manage_portlets_fallback.pt\n+++ b/plone/app/portlets/browser/templates/manage_portlets_fallback.pt\n@@ -1,14 +1,19 @@\n-<div tal:condition="view/available" class="row managePortlets-row">\n-\t<tal:comment tal:condition="nothing">\n+<div class="row managePortlets-row"\n+     tal:condition="view/available"\n+>\n+  <tal:comment tal:condition="nothing">\n \t\t**********\n \t\tNEEDED COL\n \t\t**********\n-\t</tal:comment>\n-    <a class="managePortletsFallback"\n-        tal:attributes="href string:${view/object_url}/@@manage-portlets"\n-        i18n:domain="plone"\n-        i18n:translate="manage_portlets_link">\n+  </tal:comment>\n+  <a class="managePortletsFallback"\n+     tal:attributes="\n+       href string:${view/object_url}/@@manage-portlets;\n+     "\n+     i18n:domain="plone"\n+     i18n:translate="manage_portlets_link"\n+  >\n         Manage portlets\n-    </a>\n+  </a>\n \n-</div>\n\\ No newline at end of file\n+</div>\ndiff --git a/plone/app/portlets/browser/templates/portlets-pageform.pt b/plone/app/portlets/browser/templates/portlets-pageform.pt\nindex dc35fecb..4e65a74e 100644\n--- a/plone/app/portlets/browser/templates/portlets-pageform.pt\n+++ b/plone/app/portlets/browser/templates/portlets-pageform.pt\n@@ -1,23 +1,33 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      metal:use-macro="context/main_template/macros/master">\n+      metal:use-macro="context/main_template/macros/master"\n+>\n \n-<metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1);\n-                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+                 disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                 disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+               "\n+  />\n \n-<body>\n-<metal:main fill-slot="main">\n+  <body>\n+    <metal:main fill-slot="main">\n \n-  <metal:form use-macro="context/@@base-pageform.html/form">\n-    <metal:block fill-slot="extra_info">\n-     <input type="hidden" name="referer" value="" tal:attributes="value view/referer" />\n-    </metal:block>\n-  </metal:form>\n+      <metal:form use-macro="context/@@base-pageform.html/form">\n+        <metal:block fill-slot="extra_info">\n+          <input name="referer"\n+                 type="hidden"\n+                 value=""\n+                 tal:attributes="\n+                   value view/referer;\n+                 "\n+          />\n+        </metal:block>\n+      </metal:form>\n \n-</metal:main>\n-</body>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/topbar-manage-portlets.pt b/plone/app/portlets/browser/templates/topbar-manage-portlets.pt\nindex 11d9aaa0..37702e0c 100644\n--- a/plone/app/portlets/browser/templates/topbar-manage-portlets.pt\n+++ b/plone/app/portlets/browser/templates/topbar-manage-portlets.pt\n@@ -1,68 +1,102 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n-<body>\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-  <metal:main fill-slot="main" tal:define="plone_view context/@@plone">\n+    <metal:main fill-slot="main"\n+                tal:define="\n+                  plone_view context/@@plone;\n+                "\n+    >\n \n-    <div class="quicknav-wrapper">\n-      <form method="post"\n-          tal:attributes="action context/absolute_url">\n-        <select id="quicknav" class="switch-portlet-manager form-select w-auto ms-1 float-end" name=":action"\n-            tal:define="portlet_menu context/@@view_get_menu/plone_contentmenu_portletmanager"\n-            tal:attributes="data-context-url context/absolute_url">\n-          <option tal:attributes="value python:request[\'ACTUAL_URL\']"\n-          ><tal:span i18n:translate="title_switch_portlet_managers">Other portlet managers</tal:span>&hellip;</option>\n-          <tal:item repeat="item portlet_menu">\n-            <option tal:define="item_id python:item[\'title\'].lower().replace(\' \', \'.\');\n-                                is_current python:item_id == view.manager_name"\n-                tal:attributes="value item/action"\n-                tal:content="item/title"\n-                tal:omit-tag="is_current">Plone Leftcolumn</option>\n-          </tal:item>\n-        </select>\n-        <label for="quicknav" class="sr-only" i18n:translate="title_switch_portlet_managers">Other portlet managers</label>\n-      </form>\n-    </div>\n+      <div class="quicknav-wrapper">\n+        <form method="post"\n+              tal:attributes="\n+                action context/absolute_url;\n+              "\n+        >\n+          <select class="switch-portlet-manager form-select w-auto ms-1 float-end"\n+                  id="quicknav"\n+                  name=":action"\n+                  tal:define="\n+                    portlet_menu context/@@view_get_menu/plone_contentmenu_portletmanager;\n+                  "\n+                  tal:attributes="\n+                    data-context-url context/absolute_url;\n+                  "\n+          >\n+            <option tal:attributes="\n+                      value python:request[\'ACTUAL_URL\'];\n+                    "><tal:span i18n:translate="title_switch_portlet_managers">Other portlet managers</tal:span>&hellip;</option>\n+            <tal:item repeat="item portlet_menu">\n+              <option tal:define="\n+                        item_id python:item[\'title\'].lower().replace(\' \', \'.\');\n+                        is_current python:item_id == view.manager_name;\n+                      "\n+                      tal:content="item/title"\n+                      tal:omit-tag="is_current"\n+                      tal:attributes="\n+                        value item/action;\n+                      "\n+              >Plone Leftcolumn</option>\n+            </tal:item>\n+          </select>\n+          <label class="sr-only"\n+                 for="quicknav"\n+                 i18n:translate="title_switch_portlet_managers"\n+          >Other portlet managers</label>\n+        </form>\n+      </div>\n \n-    <header>\n-      <h1 class="documentFirstHeading"\n-        i18n:translate="title_manage_contextual_portlets">\n+      <header>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="title_manage_contextual_portlets"\n+        >\n         Manage portlets for\n-        <q i18n:name="context_title" tal:content="context/Title">title</q>\n-      </h1>\n-      \n-      <a class="link-parent d-inline-block mb-3"\n-          tal:attributes="href context/absolute_url"\n-          i18n:translate="return_to_view">\n+          <q tal:content="context/Title"\n+             i18n:name="context_title"\n+          >title</q>\n+        </h1>\n+\n+        <a class="link-parent d-inline-block mb-3"\n+           tal:attributes="\n+             href context/absolute_url;\n+           "\n+           i18n:translate="return_to_view"\n+        >\n         Return\n-      </a>      \n+        </a>\n \n-      <div class="alert alert-info"\n-          role="status"\n-          tal:condition="plone_view/isDefaultPageInFolder|nothing">\n-        <strong i18n:translate="">\n+        <div class="alert alert-info"\n+             role="status"\n+             tal:condition="plone_view/isDefaultPageInFolder|nothing"\n+        >\n+          <strong i18n:translate="">\n             Info\n-        </strong>\n-        <div i18n:translate="label_manage_portlets_default_view_container">\n+          </strong>\n+          <div i18n:translate="label_manage_portlets_default_view_container">\n             You are managing the portlets of the default view of a container. If\n             you wanted to manage the portlets of the container itself,\n-          <a href=""\n-              i18n:name="go_here"\n-              i18n:translate="label_manage_portlets_default_view_container_go_here"\n-              class="portlets-link-to-parent"\n-              tal:attributes="href string:${context/aq_inner/aq_parent/absolute_url}/@@topbar-manage-portlets/${view/manager_name}">go here</a>.\n+            <a class="portlets-link-to-parent"\n+               href=""\n+               tal:attributes="\n+                 href string:${context/aq_inner/aq_parent/absolute_url}/@@topbar-manage-portlets/${view/manager_name};\n+               "\n+               i18n:name="go_here"\n+               i18n:translate="label_manage_portlets_default_view_container_go_here"\n+            >go here</a>.\n+          </div>\n         </div>\n-      </div>\n-    </header>\n+      </header>\n \n-    <h2 tal:content="view/manager_name"></h2>\n-    <span tal:replace="structure view/render_edit_manager_portlets" />\n+      <h2 tal:content="view/manager_name"></h2>\n+      <span tal:replace="structure view/render_edit_manager_portlets"></span>\n \n-  </metal:main>\n+    </metal:main>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/z3cform-portlets-pageform.pt b/plone/app/portlets/browser/templates/z3cform-portlets-pageform.pt\nindex d376e420..d75e5cca 100644\n--- a/plone/app/portlets/browser/templates/z3cform-portlets-pageform.pt\n+++ b/plone/app/portlets/browser/templates/z3cform-portlets-pageform.pt\n@@ -1,30 +1,45 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      metal:use-macro="context/main_template/macros/master"\n       i18n:domain="plone"\n-      metal:use-macro="context/main_template/macros/master">\n+>\n+\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+                 disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                 disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+               "\n+  />\n \n-<metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1);\n-                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n+  <metal:block fill-slot="main">\n \n-    <metal:block fill-slot="main">\n+    <h1 class="documentFirstHeading"\n+        tal:content="view/label | nothing"\n+    ></h1>\n \n-        <h1 class="documentFirstHeading" tal:content="view/label | nothing" />\n-        \n-        <div class="text-muted" tal:condition="view/description | nothing" tal:content="view/description" />\n+    <div class="text-muted"\n+         tal:condition="view/description | nothing"\n+         tal:content="view/description"\n+    ></div>\n \n-        <div id="content-core">\n-            <metal:block use-macro="context/@@ploneform-macros/titlelessform" >\n-                <metal:block fill-slot="formtop">\n-                     <input type="hidden" name="referer" value="" tal:attributes="value view/referer" />\n-                </metal:block>\n-            </metal:block>\n-        </div>\n+    <div id="content-core">\n+      <metal:block use-macro="context/@@ploneform-macros/titlelessform">\n+        <metal:block fill-slot="formtop">\n+          <input name="referer"\n+                 type="hidden"\n+                 value=""\n+                 tal:attributes="\n+                   value view/referer;\n+                 "\n+          />\n+        </metal:block>\n+      </metal:block>\n+    </div>\n \n \n-    </metal:block>\n+  </metal:block>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/portlets/configure.zcml b/plone/app/portlets/configure.zcml\nindex b4b59569..25ebe95a 100644\n--- a/plone/app/portlets/configure.zcml\n+++ b/plone/app/portlets/configure.zcml\n@@ -2,70 +2,73 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:five="http://namespaces.zope.org/five"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n-    <include package="plone.portlets" />\n-    <include package="plone.app.vocabularies" />\n+  <include package="plone.portlets" />\n+  <include package="plone.app.vocabularies" />\n \n-    <five:registerPackage package="." />\n+  <five:registerPackage package="." />\n \n-    <include file="permissions.zcml" />\n+  <include file="permissions.zcml" />\n \n-    <include package=".browser" />\n-    <include package=".dashboard" />\n-    <include package=".exportimport" />\n-    <include package=".portlets" />\n+  <include package=".browser" />\n+  <include package=".dashboard" />\n+  <include package=".exportimport" />\n+  <include package=".portlets" />\n \n-    <!-- Set up the portlet context -->\n-    <adapter factory=".portletcontext.ContentContext" />\n-    <adapter factory=".portletcontext.PortalRootContext" />\n+  <!-- Set up the portlet context -->\n+  <adapter factory=".portletcontext.ContentContext" />\n+  <adapter factory=".portletcontext.PortalRootContext" />\n \n-    <!-- Make it possible to define a sane default dashboard -->\n-    <subscriber\n-        for="Products.PluggableAuthService.interfaces.authservice.IPropertiedUser\n-            Products.PluggableAuthService.interfaces.events.IPrincipalCreatedEvent"\n-        handler=".dashboard.new_user"\n-        />\n+  <!-- Make it possible to define a sane default dashboard -->\n+  <subscriber\n+      for="Products.PluggableAuthService.interfaces.authservice.IPropertiedUser\n+           Products.PluggableAuthService.interfaces.events.IPrincipalCreatedEvent"\n+      handler=".dashboard.new_user"\n+      />\n \n-    <adapter factory=".dashboard.DefaultDashboard" />\n+  <adapter factory=".dashboard.DefaultDashboard" />\n \n-    <!-- Make the site root and any ATContentType a possible portlet manager -->\n-    <class class="Products.CMFPlone.Portal.PloneSite">\n-        <implements interface="plone.portlets.interfaces.ILocalPortletAssignable" />\n-    </class>\n+  <!-- Make the site root and any ATContentType a possible portlet manager -->\n+  <class class="Products.CMFPlone.Portal.PloneSite">\n+    <implements interface="plone.portlets.interfaces.ILocalPortletAssignable" />\n+  </class>\n \n-    <class zcml:condition="installed Products.ATContentTypes"\n-           class="Products.ATContentTypes.content.base.ATCTMixin">\n-        <implements interface="plone.portlets.interfaces.ILocalPortletAssignable" />\n-    </class>\n+  <class\n+      class="Products.ATContentTypes.content.base.ATCTMixin"\n+      zcml:condition="installed Products.ATContentTypes"\n+      >\n+    <implements interface="plone.portlets.interfaces.ILocalPortletAssignable" />\n+  </class>\n \n-    <!-- Make a Zope 2 safe traversal adapter for assignment mappings -->\n-    <adapter\n+  <!-- Make a Zope 2 safe traversal adapter for assignment mappings -->\n+  <adapter\n       factory=".storage.PortletAssignmentMappingTraverser"\n       provides="zope.publisher.interfaces.browser.IBrowserPublisher"\n       />\n \n-    <!-- Set up assignment mapping permissions -->\n-    <class class=".storage.PortletAssignmentMapping">\n-      <require\n+  <!-- Set up assignment mapping permissions -->\n+  <class class=".storage.PortletAssignmentMapping">\n+    <require\n         permission="zope2.View"\n         interface="zope.container.interfaces.IReadContainer"\n         />\n-      <require\n+    <require\n         permission="plone.app.portlets.ManagePortlets"\n         interface="zope.container.interfaces.IWriteContainer"\n         />\n-      <require\n+    <require\n         permission="plone.app.portlets.ManagePortlets"\n         attributes="updateOrder"\n         />\n-    </class>\n+  </class>\n \n-    <!-- Register a name chooser -->\n-    <adapter\n+  <!-- Register a name chooser -->\n+  <adapter\n+      factory=".storage.PortletsNameChooser"\n       provides="zope.container.interfaces.INameChooser"\n       for="plone.portlets.interfaces.IPortletAssignmentMapping"\n-      factory=".storage.PortletsNameChooser"\n       />\n \n </configure>\ndiff --git a/plone/app/portlets/dashboard/configure.zcml b/plone/app/portlets/dashboard/configure.zcml\nindex c206737c..6096944a 100644\n--- a/plone/app/portlets/dashboard/configure.zcml\n+++ b/plone/app/portlets/dashboard/configure.zcml\n@@ -1,22 +1,23 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <browser:page\n-        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n-        name="dashboard"\n-        permission="plone.app.portlets.ViewDashboard"\n-        class=".dashboard.DashboardView"\n-        template="dashboard.pt"\n-        />\n+  <browser:page\n+      name="dashboard"\n+      for="plone.app.layout.navigation.interfaces.INavigationRoot"\n+      class=".dashboard.DashboardView"\n+      template="dashboard.pt"\n+      permission="plone.app.portlets.ViewDashboard"\n+      />\n \n-    <!-- this view provides a not-js fallback for the user dropdown menu.\n+  <!-- this view provides a not-js fallback for the user dropdown menu.\n     It has been placed here to be near the personal bar code -->\n-    <browser:page\n-        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n-        name="useractions"\n-        permission="zope2.View"\n-        class=".user_actions.UserActionsView"\n-        template="user_actions.pt"\n-        />\n+  <browser:page\n+      name="useractions"\n+      for="plone.app.layout.navigation.interfaces.INavigationRoot"\n+      class=".user_actions.UserActionsView"\n+      template="user_actions.pt"\n+      permission="zope2.View"\n+      />\n </configure>\ndiff --git a/plone/app/portlets/dashboard/dashboard.pt b/plone/app/portlets/dashboard/dashboard.pt\nindex 71de849a..da7884b5 100644\n--- a/plone/app/portlets/dashboard/dashboard.pt\n+++ b/plone/app/portlets/dashboard/dashboard.pt\n@@ -1,25 +1,27 @@\n-<html\n-    xmlns="http://www.w3.org/1999/xhtml"\n-    xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n   <body>\n \n     <metal:b fill-slot="content-title">\n-      <h1\n-          class="documentFirstHeading"\n+      <h1 class="documentFirstHeading"\n+          tal:define="\n+            memberinfo context/portal_membership/getMemberInfo;\n+            member context/@@plone_portal_state/member;\n+            name python:memberinfo[\'fullname\'] or member.getId() or member.getId();\n+          "\n           i18n:translate="heading_dashboard"\n-          tal:define="memberinfo context/portal_membership/getMemberInfo;\n-                  member context/@@plone_portal_state/member;\n-                  name python:memberinfo[\'fullname\'] or member.getId() or member.getId()">\n-        <span\n-            tal:replace="name"\n-            i18n:name="user_name" />\n+      >\n+        <span tal:replace="name"\n+              i18n:name="user_name"\n+        ></span>\n         &#8217;s dashboard\n       </h1>\n     </metal:b>\n@@ -30,35 +32,35 @@\n         <div class="autotabs">\n           <nav class="autotoc-nav nav nav-tabs mb-3">\n             <span class="nav-item">\n-              <a\n-                  class="active nav-link"\n-                  href="${context/@@plone_portal_state/navigation_root_url}/dashboard"\n-                  i18n:translate="label_dashboard">Dashboard</a>\n+              <a class="active nav-link"\n+                 href="${context/@@plone_portal_state/navigation_root_url}/dashboard"\n+                 i18n:translate="label_dashboard"\n+              >Dashboard</a>\n             </span>\n             <span class="nav-item">\n-              <a\n-                  href="${context/@@plone_portal_state/navigation_root_url}/@@manage-dashboard?_authenticator=${view/auth_token}"\n-                  class="nav-link"\n-                  i18n:translate="label_edit">Edit</a>\n+              <a class="nav-link"\n+                 href="${context/@@plone_portal_state/navigation_root_url}/@@manage-dashboard?_authenticator=${view/auth_token}"\n+                 i18n:translate="label_edit"\n+              >Edit</a>\n             </span>\n           </nav>\n \n \n-          <div\n-              id="dashboard"\n-              class="row row-cols-1 row-cols-md-2 gy-2">\n-            <div\n-                id="dashboard-portlets1"\n-                tal:content="structure provider:plone.dashboard1" />\n-            <div\n-                id="dashboard-portlets2"\n-                tal:content="structure provider:plone.dashboard2" />\n-            <div\n-                id="dashboard-portlets3"\n-                tal:content="structure provider:plone.dashboard3" />\n-            <div\n-                id="dashboard-portlets4"\n-                tal:content="structure provider:plone.dashboard4" />\n+          <div class="row row-cols-1 row-cols-md-2 gy-2"\n+               id="dashboard"\n+          >\n+            <div id="dashboard-portlets1"\n+                 tal:content="structure provider:plone.dashboard1"\n+            ></div>\n+            <div id="dashboard-portlets2"\n+                 tal:content="structure provider:plone.dashboard2"\n+            ></div>\n+            <div id="dashboard-portlets3"\n+                 tal:content="structure provider:plone.dashboard3"\n+            ></div>\n+            <div id="dashboard-portlets4"\n+                 tal:content="structure provider:plone.dashboard4"\n+            ></div>\n           </div>\n \n         </div>\ndiff --git a/plone/app/portlets/dashboard/user_actions.pt b/plone/app/portlets/dashboard/user_actions.pt\nindex ce532f1f..c94373bf 100644\n--- a/plone/app/portlets/dashboard/user_actions.pt\n+++ b/plone/app/portlets/dashboard/user_actions.pt\n@@ -1,35 +1,45 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<head>\n+  <head>\n     <metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1);\n-                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n-</head>\n+                 tal:define="\n+                   dummy python:request.set(\'disable_border\',1);\n+                   disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                   disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+                 "\n+    />\n+  </head>\n \n-<body>\n+  <body>\n \n-<metal:main fill-slot="main">\n-<h1 i18n:translate="" class="documentFirstHeading">User Actions</h1>\n-<ul id="user-actions">\n-    <li tal:repeat="action view/user_actions">\n-        <a href=""\n-           tal:attributes="href action/url;\n-                           target action/link_target|nothing;\n-                           id string:personaltoolspage-${action/id};"\n-           tal:content="action/title"\n-           i18n:translate="">\n+    <metal:main fill-slot="main">\n+      <h1 class="documentFirstHeading"\n+          i18n:translate=""\n+      >User Actions</h1>\n+      <ul id="user-actions">\n+        <li tal:repeat="action view/user_actions">\n+          <a href=""\n+             tal:content="action/title"\n+             tal:attributes="\n+               href action/url;\n+               target action/link_target|nothing;\n+               id string:personaltoolspage-${action/id};\n+             "\n+             i18n:translate=""\n+          >\n             action title\n-        </a>\n-    </li>\n-</ul>\n-</metal:main>\n+          </a>\n+        </li>\n+      </ul>\n+    </metal:main>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/exportimport/configure.zcml b/plone/app/portlets/exportimport/configure.zcml\nindex 17e90313..9be1f051 100644\n--- a/plone/app/portlets/exportimport/configure.zcml\n+++ b/plone/app/portlets/exportimport/configure.zcml\n@@ -2,43 +2,42 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n-\n-    <adapter\n-        factory=".portlets.PortletsXMLAdapter"\n-        name="plone.portlets"\n-        />\n-\n-    <adapter\n-        factory=".portlets.PropertyPortletAssignmentExportImportHandler"\n+    i18n_domain="plone"\n+    >\n+\n+  <adapter\n+      factory=".portlets.PortletsXMLAdapter"\n+      name="plone.portlets"\n+      />\n+\n+  <adapter factory=".portlets.PropertyPortletAssignmentExportImportHandler" />\n+\n+  <!-- Register import and export steps -->\n+  <genericsetup:importStep\n+      name="portlets"\n+      title="Portlets"\n+      description="Import portlet managers, types, assignments and blacklistings"\n+      handler=".portlets.importPortlets"\n+      >\n+    <depends name="componentregistry" />\n+    <depends name="content" />\n+  </genericsetup:importStep>\n+\n+  <genericsetup:exportStep\n+      name="portlets"\n+      title="Portlets"\n+      description="Export portlet managers, types, assignments and blacklistings"\n+      handler=".portlets.exportPortlets"\n+      />\n+\n+  <configure zcml:condition="not-installed Products.CMFCore.src">\n+\n+    <utility\n+        factory=".portlets.Blacklist"\n+        provides="Products.GenericSetup.interfaces.IComponentsHandlerBlacklist"\n+        name="plone.app.portlets.exportimport"\n         />\n \n-    <!-- Register import and export steps -->\n-    <genericsetup:importStep\n-        name="portlets"\n-        title="Portlets"\n-        description="Import portlet managers, types, assignments and blacklistings"\n-        handler=".portlets.importPortlets">\n-        <depends name="componentregistry"/>\n-        <depends name="content"/>\n-    </genericsetup:importStep>\n-\n-    <genericsetup:exportStep\n-        name="portlets"\n-        title="Portlets"\n-        description="Export portlet managers, types, assignments and blacklistings"\n-        handler=".portlets.exportPortlets"\n-        />\n-\n-    <configure\n-        zcml:condition="not-installed Products.CMFCore.src">\n-\n-        <utility\n-            factory=".portlets.Blacklist"\n-            provides="Products.GenericSetup.interfaces.IComponentsHandlerBlacklist"\n-            name="plone.app.portlets.exportimport"\n-            />\n-\n-        </configure>\n+  </configure>\n \n </configure>\ndiff --git a/plone/app/portlets/meta.zcml b/plone/app/portlets/meta.zcml\nindex 2341e10d..0655c3dc 100644\n--- a/plone/app/portlets/meta.zcml\n+++ b/plone/app/portlets/meta.zcml\n@@ -1,21 +1,22 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:meta="http://namespaces.zope.org/meta">\n+    xmlns:meta="http://namespaces.zope.org/meta"\n+    >\n \n-    <meta:directives namespace="http://namespaces.plone.org/plone">\n+  <meta:directives namespace="http://namespaces.plone.org/plone">\n \n-        <meta:directive\n-            name="portlet"\n-            schema=".metadirectives.IPortletDirective"\n-            handler=".metaconfigure.portletDirective"\n-            />\n+    <meta:directive\n+        name="portlet"\n+        handler=".metaconfigure.portletDirective"\n+        schema=".metadirectives.IPortletDirective"\n+        />\n \n-        <meta:directive\n-            name="portletRenderer"\n-            schema=".metadirectives.IPortletRendererDirective"\n-            handler=".metaconfigure.portletRendererDirective"\n-            />\n+    <meta:directive\n+        name="portletRenderer"\n+        handler=".metaconfigure.portletRendererDirective"\n+        schema=".metadirectives.IPortletRendererDirective"\n+        />\n \n-    </meta:directives>\n+  </meta:directives>\n \n-</configure>\n\\ No newline at end of file\n+</configure>\ndiff --git a/plone/app/portlets/overrides.zcml b/plone/app/portlets/overrides.zcml\nindex 2aefc787..beb2011a 100644\n--- a/plone/app/portlets/overrides.zcml\n+++ b/plone/app/portlets/overrides.zcml\n@@ -1,8 +1,10 @@\n <configure xmlns="http://namespaces.zope.org/zope">\n \n-    <adapter factory=".assignable.localPortletAssignmentMappingAdapter" />\n+  <adapter factory=".assignable.localPortletAssignmentMappingAdapter" />\n \n-    <adapter factory=".manager.PortletManagerRenderer"\n-             provides="plone.portlets.interfaces.IPortletManagerRenderer"/>\n+  <adapter\n+      factory=".manager.PortletManagerRenderer"\n+      provides="plone.portlets.interfaces.IPortletManagerRenderer"\n+      />\n \n </configure>\ndiff --git a/plone/app/portlets/permissions.zcml b/plone/app/portlets/permissions.zcml\nindex db4a2f1a..55fa4bd1 100644\n--- a/plone/app/portlets/permissions.zcml\n+++ b/plone/app/portlets/permissions.zcml\n@@ -1,5 +1,7 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-    i18n_domain="plone.app.portlets">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    i18n_domain="plone.app.portlets"\n+    >\n \n   <!-- Note: These permissions are also set up in the rolemap.xml GenericSetup\n              importer in CMFPlone.\n@@ -18,19 +20,19 @@\n      -->\n \n   <permission\n-    id="plone.app.portlets.ManagePortlets"\n-    title="Portlets: Manage portlets"\n-    />\n+      id="plone.app.portlets.ManagePortlets"\n+      title="Portlets: Manage portlets"\n+      />\n \n   <permission\n-    id="plone.app.portlets.ManageOwnPortlets"\n-    title="Portlets: Manage own portlets"\n-    />\n+      id="plone.app.portlets.ManageOwnPortlets"\n+      title="Portlets: Manage own portlets"\n+      />\n \n   <permission\n-     id="plone.app.portlets.ViewDashboard"\n-     title="Portlets: View dashboard"\n-     />\n+      id="plone.app.portlets.ViewDashboard"\n+      title="Portlets: View dashboard"\n+      />\n \n   <adapter factory=".checker.DefaultPortletPermissionChecker" />\n   <adapter factory=".checker.UserPortletPermissionChecker" />\ndiff --git a/plone/app/portlets/portlets/actions.pt b/plone/app/portlets/portlets/actions.pt\nindex fdeda5f9..44985527 100644\n--- a/plone/app/portlets/portlets/actions.pt\n+++ b/plone/app/portlets/portlets/actions.pt\n@@ -1,40 +1,64 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n   <div class="card portlet portletActions"\n-      tal:define="portal_url context/@@plone_portal_state/portal_url;">\n+       tal:define="\n+         portal_url context/@@plone_portal_state/portal_url;\n+       "\n+  >\n \n-    <div class="card-header" tal:condition="view/showTitle">\n-      <span tal:condition="view/title" tal:replace="view/title">\n+    <div class="card-header"\n+         tal:condition="view/showTitle"\n+    >\n+      <span tal:condition="view/title"\n+            tal:replace="view/title"\n+      >\n         Title\n       </span>\n     </div>\n \n     <div class="card-body portletContent">\n-      <ul tal:attributes="class string:actions-${view/category}">\n+      <ul tal:attributes="\n+            class string:actions-${view/category};\n+          ">\n         <tal:loop tal:repeat="link view/actionLinks">\n-        <li class="portletItem"\n-            tal:define="icon nocall:link/icon">\n-          <a href="#"\n-              tal:define="modal link/modal|nothing"\n-              tal:attributes="href link/url;\n-                              class python:\'pat-plone-modal\' if modal else None;\n-                              data-pat-plone-modal python:modal if modal else None;">\n-            <span tal:condition="not:icon"\n-                tal:content="link/title">\n+          <li class="portletItem"\n+              tal:define="\n+                icon nocall:link/icon;\n+              "\n+          >\n+            <a href="#"\n+               tal:define="\n+                 modal link/modal|nothing;\n+               "\n+               tal:attributes="\n+                 href link/url;\n+                 class python:\'pat-plone-modal\' if modal else None;\n+                 data-pat-plone-modal python:modal if modal else None;\n+               "\n+            >\n+              <span tal:condition="not:icon"\n+                    tal:content="link/title"\n+              >\n               Action\n-            </span>\n-            <span tal:condition="icon"\n-                tal:content="link/title"\n-                tal:define="icon_url icon/absolute_url|icon"\n-                tal:attributes="style string:background-image:url($icon_url);;">\n+              </span>\n+              <span tal:define="\n+                      icon_url icon/absolute_url|icon;\n+                    "\n+                    tal:condition="icon"\n+                    tal:content="link/title"\n+                    tal:attributes="\n+                      style string:background-image:url($icon_url);;;\n+                    "\n+              >\n               Action\n-            </span>\n-          </a>\n-        </li>\n+              </span>\n+            </a>\n+          </li>\n         </tal:loop>\n       </ul>\n     </div>\ndiff --git a/plone/app/portlets/portlets/classic.pt b/plone/app/portlets/portlets/classic.pt\nindex 877411fe..bb3b4935 100644\n--- a/plone/app/portlets/portlets/classic.pt\n+++ b/plone/app/portlets/portlets/classic.pt\n@@ -1,12 +1,14 @@\n-<tal:block tal:define="use_macro view/use_macro;\n-                       path_expression view/path_expression">\n+<tal:block tal:define="\n+             use_macro view/use_macro;\n+             path_expression view/path_expression;\n+           ">\n \n   <tal:block condition="use_macro">\n     <metal:block metal:use-macro="python:path(path_expression)" />\n   </tal:block>\n \n   <tal:block condition="not:use_macro">\n-    <div tal:replace="structure python:path(path_expression)" />\n+    <div tal:replace="structure python:path(path_expression)"></div>\n   </tal:block>\n \n-</tal:block>\n\\ No newline at end of file\n+</tal:block>\ndiff --git a/plone/app/portlets/portlets/configure.zcml b/plone/app/portlets/portlets/configure.zcml\nindex 08e2bd7a..ef9cdc83 100644\n--- a/plone/app/portlets/portlets/configure.zcml\n+++ b/plone/app/portlets/portlets/configure.zcml\n@@ -1,96 +1,98 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:browser="http://namespaces.zope.org/browser"\n-           xmlns:plone="http://namespaces.plone.org/plone">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n-    <plone:portlet\n-        name="portlets.Classic"\n-        interface=".classic.IClassicPortlet"\n-        assignment=".classic.Assignment"\n-        renderer=".classic.Renderer"\n-        addview=".classic.AddForm"\n-        editview=".classic.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Classic"\n+      interface=".classic.IClassicPortlet"\n+      assignment=".classic.Assignment"\n+      renderer=".classic.Renderer"\n+      addview=".classic.AddForm"\n+      editview=".classic.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.News"\n-        interface=".news.INewsPortlet"\n-        assignment=".news.Assignment"\n-        renderer=".news.Renderer"\n-        addview=".news.AddForm"\n-        editview=".news.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.News"\n+      interface=".news.INewsPortlet"\n+      assignment=".news.Assignment"\n+      renderer=".news.Renderer"\n+      addview=".news.AddForm"\n+      editview=".news.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Login"\n-        interface=".login.ILoginPortlet"\n-        assignment=".login.Assignment"\n-        renderer=".login.Renderer"\n-        addview=".login.AddForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Login"\n+      interface=".login.ILoginPortlet"\n+      assignment=".login.Assignment"\n+      renderer=".login.Renderer"\n+      addview=".login.AddForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Navigation"\n-        interface=".navigation.INavigationPortlet"\n-        assignment=".navigation.Assignment"\n-        renderer=".navigation.Renderer"\n-        addview=".navigation.AddForm"\n-        editview=".navigation.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Navigation"\n+      interface=".navigation.INavigationPortlet"\n+      assignment=".navigation.Assignment"\n+      renderer=".navigation.Renderer"\n+      addview=".navigation.AddForm"\n+      editview=".navigation.EditForm"\n+      />\n \n-    <adapter factory=".navigation.QueryBuilder" />\n-    <adapter factory=".navigation.NavtreeStrategy" />\n+  <adapter factory=".navigation.QueryBuilder" />\n+  <adapter factory=".navigation.NavtreeStrategy" />\n \n-    <plone:portlet\n-        name="portlets.Recent"\n-        interface=".recent.IRecentPortlet"\n-        assignment=".recent.Assignment"\n-        renderer=".recent.Renderer"\n-        addview=".recent.AddForm"\n-        editview=".recent.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Recent"\n+      interface=".recent.IRecentPortlet"\n+      assignment=".recent.Assignment"\n+      renderer=".recent.Renderer"\n+      addview=".recent.AddForm"\n+      editview=".recent.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Review"\n-        interface=".review.IReviewPortlet"\n-        assignment=".review.Assignment"\n-        renderer=".review.Renderer"\n-        addview=".review.AddForm"\n-        editview=".review.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Review"\n+      interface=".review.IReviewPortlet"\n+      assignment=".review.Assignment"\n+      renderer=".review.Renderer"\n+      addview=".review.AddForm"\n+      editview=".review.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.rss"\n-        interface=".rss.IRSSPortlet"\n-        assignment=".rss.Assignment"\n-        renderer=".rss.Renderer"\n-        addview=".rss.AddForm"\n-        editview=".rss.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.rss"\n+      interface=".rss.IRSSPortlet"\n+      assignment=".rss.Assignment"\n+      renderer=".rss.Renderer"\n+      addview=".rss.AddForm"\n+      editview=".rss.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Search"\n-        interface=".search.ISearchPortlet"\n-        assignment=".search.Assignment"\n-        renderer=".search.Renderer"\n-        addview=".search.AddForm"\n-        editview=".search.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Search"\n+      interface=".search.ISearchPortlet"\n+      assignment=".search.Assignment"\n+      renderer=".search.Renderer"\n+      addview=".search.AddForm"\n+      editview=".search.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Language"\n-        interface=".language.ILanguagePortlet"\n-        assignment=".language.Assignment"\n-        renderer=".language.Renderer"\n-        addview=".language.AddForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Language"\n+      interface=".language.ILanguagePortlet"\n+      assignment=".language.Assignment"\n+      renderer=".language.Renderer"\n+      addview=".language.AddForm"\n+      />\n \n-    <plone:portlet\n-       name="portlets.Actions"\n-       interface=".actions.IActionsPortlet"\n-       assignment=".actions.Assignment"\n-       renderer=".actions.Renderer"\n-       addview=".actions.AddForm"\n-       editview=".actions.EditForm"\n-       />\n+  <plone:portlet\n+      name="portlets.Actions"\n+      interface=".actions.IActionsPortlet"\n+      assignment=".actions.Assignment"\n+      renderer=".actions.Renderer"\n+      addview=".actions.AddForm"\n+      editview=".actions.EditForm"\n+      />\n \n </configure>\ndiff --git a/plone/app/portlets/portlets/language.pt b/plone/app/portlets/portlets/language.pt\nindex f79d7102..7fdc1eba 100644\n--- a/plone/app/portlets/portlets/language.pt\n+++ b/plone/app/portlets/portlets/language.pt\n@@ -1,33 +1,51 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n   <div class="card portlet portletLanguage">\n \n     <div class="card-header">\n-      <span class="tile" i18n:translate="box_languages">Languages</span>\n+      <span class="tile"\n+            i18n:translate="box_languages"\n+      >Languages</span>\n     </div>\n \n     <div class="card-body">\n-      <ul tal:define="showFlags view/showFlags">\n-        <li class="portletItem" tal:repeat="lang view/languages">\n-          <span tal:define="code lang/code;\n-                            selected lang/selected"\n-              tal:omit-tag="selected">\n+      <ul tal:define="\n+            showFlags view/showFlags;\n+          ">\n+        <li class="portletItem"\n+            tal:repeat="lang view/languages"\n+        >\n+          <span tal:define="\n+                  code lang/code;\n+                  selected lang/selected;\n+                "\n+                tal:omit-tag="selected"\n+          >\n             <a href=""\n-                tal:define="flag lang/flag;\n-                            name lang/name"\n-                tal:attributes="href string:${here/absolute_url}/switchLanguage?set_language=${code};\n-                                title name">\n+               tal:define="\n+                 flag lang/flag;\n+                 name lang/name;\n+               "\n+               tal:attributes="\n+                 href string:${here/absolute_url}/switchLanguage?set_language=${code};\n+                 title name;\n+               "\n+            >\n               <tal:flag condition="python:showFlags and flag">\n-                <img width="14"\n-                    height="11"\n-                    alt=""\n-                    tal:attributes="src string:${view/navigation_root_url}${flag};\n-                                    title python: name;\n-                                    class python: selected and \'currentItem\' or \'\';" />\n+                <img alt=""\n+                     height="11"\n+                     width="14"\n+                     tal:attributes="\n+                       src string:${view/navigation_root_url}${flag};\n+                       title python: name;\n+                       class python: selected and \'currentItem\' or \'\';\n+                     "\n+                />\n               </tal:flag>\n               <span tal:replace="lang/native|lang/name">Native language name</span>\n             </a>\ndiff --git a/plone/app/portlets/portlets/login.pt b/plone/app/portlets/portlets/login.pt\nindex bcdb8093..b515b7d0 100644\n--- a/plone/app/portlets/portlets/login.pt\n+++ b/plone/app/portlets/portlets/login.pt\n@@ -1,126 +1,200 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n       i18n:domain="plone"\n-      tal:omit-tag="">\n+>\n \n   <tal:block condition="view/show">\n \n-  <div class="card portlet portletLogin"\n-      tal:condition="view/available">\n+    <div class="card portlet portletLogin"\n+         tal:condition="view/available"\n+    >\n \n-    <div class="card-header">\n-      <a href="#"\n-          class="tile"\n-          tal:attributes="href view/login_form"\n-          i18n:translate="box_sign_in">Log in</a>\n-    </div>\n+      <div class="card-header">\n+        <a class="tile"\n+           href="#"\n+           tal:attributes="\n+             href view/login_form;\n+           "\n+           i18n:translate="box_sign_in"\n+        >Log in</a>\n+      </div>\n \n-    <div class="card-body">\n-      <div tal:define="ac_name view/login_name;\n-                        ac_password view/login_password">\n-        <form action="login_form"\n-            id="loginform"\n-            method="post"\n-            tal:attributes="action view/login_form">\n-          <div>\n-            <input type="hidden" name="form.submitted" value="1" />\n-            <input type="hidden" name="came_from" value=""\n-                tal:attributes="value context/@@plone_context_state/current_page_url" />\n-            <input type="hidden" name="js_enabled" id="js_enabled" value="0" />\n-            <input type="hidden" name="cookies_enabled" id="cookies_enabled" value="" />\n-            <input type="hidden" name="login_name" id="login_name" value="" />\n-            <input type="hidden" name="pwd_empty" id="pwd_empty" value="0" />\n-          </div>\n-          <div class="field"\n-              tal:define="use_email_as_login python:context.portal_registry[\'plone.use_email_as_login\'];">\n-            <tal:loginname condition="not:use_email_as_login">\n+      <div class="card-body">\n+        <div tal:define="\n+               ac_name view/login_name;\n+               ac_password view/login_password;\n+             ">\n+          <form id="loginform"\n+                action="login_form"\n+                method="post"\n+                tal:attributes="\n+                  action view/login_form;\n+                "\n+          >\n+            <div>\n+              <input name="form.submitted"\n+                     type="hidden"\n+                     value="1"\n+              />\n+              <input name="came_from"\n+                     type="hidden"\n+                     value=""\n+                     tal:attributes="\n+                       value context/@@plone_context_state/current_page_url;\n+                     "\n+              />\n+              <input id="js_enabled"\n+                     name="js_enabled"\n+                     type="hidden"\n+                     value="0"\n+              />\n+              <input id="cookies_enabled"\n+                     name="cookies_enabled"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input id="login_name"\n+                     name="login_name"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input id="pwd_empty"\n+                     name="pwd_empty"\n+                     type="hidden"\n+                     value="0"\n+              />\n+            </div>\n+            <div class="field"\n+                 tal:define="\n+                   use_email_as_login python:context.portal_registry[\'plone.use_email_as_login\'];\n+                 "\n+            >\n+              <tal:loginname condition="not:use_email_as_login">\n+                <label for=""\n+                       tal:attributes="\n+                         for ac_name;\n+                       "\n+                       i18n:translate="label_login_name"\n+                >Login Name</label>\n+                <br />\n+                <input size="10"\n+                       type="text"\n+                       tal:attributes="\n+                         name ac_name;\n+                         id ac_name;\n+                         value python:request.get(ac_name, \'\');\n+                       "\n+                />\n+              </tal:loginname>\n+              <tal:email condition="use_email_as_login">\n+                <label for=""\n+                       tal:attributes="\n+                         for ac_name;\n+                       "\n+                       i18n:translate="label_email"\n+                >Email</label>\n+                <br />\n+                <input size="10"\n+                       type="text"\n+                       tal:attributes="\n+                         name ac_name;\n+                         id ac_name;\n+                         value python:request.get(ac_name, \'\');\n+                       "\n+                />\n+              </tal:email>\n+            </div>\n+            <div class="field">\n               <label for=""\n-                  tal:attributes="for ac_name"\n-                  i18n:translate="label_login_name">Login Name</label>\n+                     tal:attributes="\n+                       for ac_password;\n+                     "\n+                     i18n:translate="label_password"\n+              >Password</label>\n               <br />\n-              <input type="text"\n-                  size="10"\n-                  tal:attributes="name ac_name; id ac_name;\n-                                  value python:request.get(ac_name, \'\');" />\n-            </tal:loginname>\n-            <tal:email condition="use_email_as_login">\n-              <label for=""\n-                  tal:attributes="for ac_name"\n-                  i18n:translate="label_email">Email</label>\n-              <br />\n-              <input type="text"\n-                  size="10"\n-                  tal:attributes="name ac_name; id ac_name;\n-                                  value python:request.get(ac_name, \'\');" />\n-            </tal:email>\n-          </div>\n-          <div class="field">\n-            <label for=""\n-                tal:attributes="for ac_password"\n-                i18n:translate="label_password">Password</label>\n-            <br />\n-            <input type="password"\n-                size="10"\n-                tal:attributes="name ac_password; id ac_password;" />\n-          </div>\n-          <div class="cookiesMessage alert alert-warning"\n-              style="display:none" role="alert">\n-            <strong i18n:translate="">Warning</strong>\n-            <span i18n:translate="enable_cookies_message_before_login">\n+              <input size="10"\n+                     type="password"\n+                     tal:attributes="\n+                       name ac_password;\n+                       id ac_password;\n+                     "\n+              />\n+            </div>\n+            <div class="cookiesMessage alert alert-warning"\n+                 role="alert"\n+                 style="display:none"\n+            >\n+              <strong i18n:translate="">Warning</strong>\n+              <span i18n:translate="enable_cookies_message_before_login">\n               Cookies are not enabled. You must enable cookies before you\n               can log in.\n-            </span>\n-          </div>\n-          <div class="formControls">\n-            <input class="btn btn-primary"\n-                type="submit"\n-                name="buttons.login"\n-                value="Log in"\n-                title="Log in"\n-                i18n:attributes="value label_log_in; title label_log_in;"/>\n-          </div>\n-        </form>\n+              </span>\n+            </div>\n+            <div class="formControls">\n+              <input class="btn btn-primary"\n+                     name="buttons.login"\n+                     title="Log in"\n+                     type="submit"\n+                     value="Log in"\n+                     i18n:attributes="value label_log_in; title label_log_in;"\n+              />\n+            </div>\n+          </form>\n+        </div>\n       </div>\n-    </div>\n \n-    <div class="card-footer">\n-      <div tal:condition="view/can_request_password">\n-        <a href="mail_password_form"\n-            class="tile"\n-            tal:attributes="href view/mail_password_form">\n-          <tal:block replace="structure context/info_icon.png"/>\n-          <span tal:omit-tag="" i18n:translate="box_forgot_password_option">Forgot your password?</span>\n-        </a>\n-      </div>\n-      <div tal:condition="view/can_register">\n-        <a href=""\n-            class="tile"\n-            tal:attributes="href view/join_action">\n-          <tal:block replace="structure context/user.png"/>\n-          <span tal:omit-tag="" i18n:translate="box_new_user_option">New user?</span>\n-        </a>\n+      <div class="card-footer">\n+        <div tal:condition="view/can_request_password">\n+          <a class="tile"\n+             href="mail_password_form"\n+             tal:attributes="\n+               href view/mail_password_form;\n+             "\n+          >\n+            <tal:block replace="structure context/info_icon.png" />\n+            <span tal:omit-tag=""\n+                  i18n:translate="box_forgot_password_option"\n+            >Forgot your password?</span>\n+          </a>\n+        </div>\n+        <div tal:condition="view/can_register">\n+          <a class="tile"\n+             href=""\n+             tal:attributes="\n+               href view/join_action;\n+             "\n+          >\n+            <tal:block replace="structure context/user.png" />\n+            <span tal:omit-tag=""\n+                  i18n:translate="box_new_user_option"\n+            >New user?</span>\n+          </a>\n+        </div>\n       </div>\n     </div>\n-  </div>\n \n-  <div class="card portlet portletLogin"\n-      tal:condition="not:view/available">\n+    <div class="card portlet portletLogin"\n+         tal:condition="not:view/available"\n+    >\n \n-    <div class="card-header">\n-      <a href="#"\n-          class="tile"\n-          i18n:translate="box_sign_in">Log in</a>\n-    </div>\n+      <div class="card-header">\n+        <a class="tile"\n+           href="#"\n+           i18n:translate="box_sign_in"\n+        >Log in</a>\n+      </div>\n \n-    <div class="card-body"\n-        i18n:translate="login_portlet_disabled">\n+      <div class="card-body"\n+           i18n:translate="login_portlet_disabled"\n+      >\n       Cookie authentication is disabled.\n       Login portlet not available.\n-    </div>\n+      </div>\n \n-  </div>\n+    </div>\n \n   </tal:block>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/portlets/portlets/navigation.pt b/plone/app/portlets/portlets/navigation.pt\nindex 73555dcc..b661c2c6 100644\n--- a/plone/app/portlets/portlets/navigation.pt\n+++ b/plone/app/portlets/portlets/navigation.pt\n@@ -1,44 +1,63 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n \n   <div class="card portlet portletNavigationTree"\n-      tal:define="root view/navigation_root"\n-      i18n:domain="plone">\n+       tal:define="\n+         root view/navigation_root;\n+       "\n+       i18n:domain="plone"\n+  >\n \n     <div class="card-header"\n-        tal:attributes="class python:view.hasName() and \'card-header\' or \'card-header hiddenStructure\'">\n-      <a href="#"\n-          class="tile"\n-          tal:attributes="href string:${view/heading_link_target}"\n-          tal:content="view/title"\n-          i18n:translate="">Navigation</a>\n+         tal:attributes="\n+           class python:view.hasName() and \'card-header\' or \'card-header hiddenStructure\';\n+         "\n+    >\n+      <a class="tile"\n+         href="#"\n+         tal:content="view/title"\n+         tal:attributes="\n+           href string:${view/heading_link_target};\n+         "\n+         i18n:translate=""\n+      >Navigation</a>\n     </div>\n \n     <nav class="card-body">\n       <ul class="navTree navTreeLevel0">\n-        <li tal:define="selectedClass view/root_item_class;\n-                        li_class python:selectedClass and \' navTreeCurrentNode\' or \'\';\n-                        normalizeString nocall:context/plone_utils/normalizeString;\n-                        section_title root/Title;\n-                        section python:normalizeString(section_title);"\n+        <li tal:define="\n+              selectedClass view/root_item_class;\n+              li_class python:selectedClass and \' navTreeCurrentNode\' or \'\';\n+              normalizeString nocall:context/plone_utils/normalizeString;\n+              section_title root/Title;\n+              section python:normalizeString(section_title);\n+            "\n             tal:condition="view/include_top"\n-            tal:attributes="class string:navTreeItem navTreeTopNode${li_class} nav-section-${section}">\n+            tal:attributes="\n+              class string:navTreeItem navTreeTopNode${li_class} nav-section-${section};\n+            "\n+        >\n           <div tal:define="\n-                  rootIsPortal view/root_is_portal;\n-                  root_type root/portal_type;\n-                  root_type_class python:\'contenttype-\' + normalizeString(root_type);\n-                  root_class python:rootIsPortal and \'contenttype-plone-site\' or root_type_class;\n-              ">\n-            <a tal:attributes="href root/absolute_url;\n-                              title root/Description;\n-                              class python:\' \'.join([root_class, selectedClass]).strip();">\n-              <span tal:omit-tag=""\n-                  tal:condition="rootIsPortal"\n-                  i18n:translate="tabs_home">Home</span>\n+                 rootIsPortal view/root_is_portal;\n+                 root_type root/portal_type;\n+                 root_type_class python:\'contenttype-\' + normalizeString(root_type);\n+                 root_class python:rootIsPortal and \'contenttype-plone-site\' or root_type_class;\n+               ">\n+            <a tal:attributes="\n+                 href root/absolute_url;\n+                 title root/Description;\n+                 class python:\' \'.join([root_class, selectedClass]).strip();\n+               ">\n+              <span tal:condition="rootIsPortal"\n+                    tal:omit-tag=""\n+                    i18n:translate="tabs_home"\n+              >Home</span>\n               <span tal:condition="not:rootIsPortal"\n-                  tal:replace="root/Title">Root item title</span>\n+                    tal:replace="root/Title"\n+              >Root item title</span>\n             </a>\n           </div>\n         </li>\ndiff --git a/plone/app/portlets/portlets/navigation_recurse.pt b/plone/app/portlets/portlets/navigation_recurse.pt\nindex 8b6a9d28..b7a52d86 100644\n--- a/plone/app/portlets/portlets/navigation_recurse.pt\n+++ b/plone/app/portlets/portlets/navigation_recurse.pt\n@@ -1,61 +1,82 @@\n-<tal:master define="level options/level | python:0;\n-                    children options/children | nothing;\n-                    bottomLevel options/bottomLevel | nothing;\n-                    supress_icon    view/data/no_icons;\n-                    supress_thumb   view/data/no_thumbs;\n-                    thumb_scale view/thumb_scale;\n-                    icons nocall:context/@@iconresolver;\n-                    normalizeString nocall: context/plone_utils/normalizeString;"\n-            i18n:domain="plone">\n-\n-<metal:main define-macro="nav_main"\n-\t   tal:define="portal context/@@plone_portal_state/portal;\n-                   image_scale portal/@@image_scale">\n-<tal:navitem repeat="node children">\n-<li tal:define="show_children   node/show_children;\n-                children        node/children;\n-                item_url        node/getURL;\n-                item_remote_url node/getRemoteUrl;\n-                use_remote_url  node/useRemoteUrl | nothing;\n-                item_type       node/portal_type;\n-                item            node/item;\n-                has_thumb       item/getIcon;\n-                is_current      node/currentItem;\n-                is_in_path      node/currentParent;\n-                li_class        python:\' navTreeCurrentNode\' if is_current else \'\';\n-                li_extr_class   python:\' navTreeItemInPath\' if is_in_path else \'\';\n-                li_folder_class python:\' navTreeFolderish\' if show_children else \'\';"\n-    tal:condition="python:bottomLevel &lt;= 0 or level &lt;= bottomLevel"\n-    tal:attributes="class string:navTreeItem visualNoMarker${li_class}${li_extr_class}${li_folder_class} section-${node/normalized_id}">\n-\n-    <tal:level define="item_class string:state-${node/normalized_review_state};\n-                       item_type_class python:\'contenttype-%s\' % normalizeString(item_type) if not supress_icon else \'\';\n-                       item_class python:\'%s navTreeCurrentItem\' % item_class if is_current else item_class">\n-\n-        <a tal:attributes="href  python:item_remote_url if use_remote_url else item_url;\n-                           title node/Description;\n-                           class string:${item_class}${li_class}${li_extr_class}${li_folder_class} ${item_type_class}">\n+<tal:master define="\n+              level options/level | python:0;\n+              children options/children | nothing;\n+              bottomLevel options/bottomLevel | nothing;\n+              supress_icon    view/data/no_icons;\n+              supress_thumb   view/data/no_thumbs;\n+              thumb_scale view/thumb_scale;\n+              icons nocall:context/@@iconresolver;\n+              normalizeString nocall: context/plone_utils/normalizeString;\n+            "\n+            i18n:domain="plone"\n+>\n+\n+  <metal:main define-macro="nav_main"\n+              tal:define="\n+                portal context/@@plone_portal_state/portal;\n+                image_scale portal/@@image_scale;\n+              "\n+  >\n+    <tal:navitem repeat="node children">\n+      <li tal:define="\n+            show_children   node/show_children;\n+            children        node/children;\n+            item_url        node/getURL;\n+            item_remote_url node/getRemoteUrl;\n+            use_remote_url  node/useRemoteUrl | nothing;\n+            item_type       node/portal_type;\n+            item            node/item;\n+            has_thumb       item/getIcon;\n+            is_current      node/currentItem;\n+            is_in_path      node/currentParent;\n+            li_class        python:\' navTreeCurrentNode\' if is_current else \'\';\n+            li_extr_class   python:\' navTreeItemInPath\' if is_in_path else \'\';\n+            li_folder_class python:\' navTreeFolderish\' if show_children else \'\';\n+          "\n+          tal:condition="python:bottomLevel &lt;= 0 or level &lt;= bottomLevel"\n+          tal:attributes="\n+            class string:navTreeItem visualNoMarker${li_class}${li_extr_class}${li_folder_class} section-${node/normalized_id};\n+          "\n+      >\n+\n+        <tal:level define="\n+                     item_class string:state-${node/normalized_review_state};\n+                     item_type_class python:\'contenttype-%s\' % normalizeString(item_type) if not supress_icon else \'\';\n+                     item_class python:\'%s navTreeCurrentItem\' % item_class if is_current else item_class;\n+                   ">\n+\n+          <a tal:attributes="\n+               href  python:item_remote_url if use_remote_url else item_url;\n+               title node/Description;\n+               class string:${item_class}${li_class}${li_extr_class}${li_folder_class} ${item_type_class};\n+             ">\n \n             <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n-                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')" />\n+                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')"\n+            />\n \n             <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n-                      tal:replace="structure python:icons.tag(f\'mimetype-{item.mime_type}\')" />\n+                      tal:replace="structure python:icons.tag(f\'mimetype-{item.mime_type}\')"\n+            />\n \n             <img tal:condition="python:has_thumb and thumb_scale"\n-                 tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)">\n+                 tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)"\n+            />\n \n             <span tal:replace="node/Title">Selected Item Title</span>\n-        </a>\n-        <tal:children condition="children">\n-            <ul tal:attributes="class string:navTree navTreeLevel${level}"\n-                tal:condition="python: children and show_children and bottomLevel and level < bottomLevel or bottomLevel == 0">\n-                <span tal:replace="structure python:view.recurse(children=children, level=level+1, bottomLevel=bottomLevel)" />\n+          </a>\n+          <tal:children condition="children">\n+            <ul tal:condition="python: children and show_children and bottomLevel and level &lt; bottomLevel or bottomLevel == 0"\n+                tal:attributes="\n+                  class string:navTree navTreeLevel${level};\n+                "\n+            >\n+              <span tal:replace="structure python:view.recurse(children=children, level=level+1, bottomLevel=bottomLevel)"></span>\n             </ul>\n-        </tal:children>\n+          </tal:children>\n \n-    </tal:level>\n-</li>\n-</tal:navitem>\n-</metal:main>\n+        </tal:level>\n+      </li>\n+    </tal:navitem>\n+  </metal:main>\n </tal:master>\ndiff --git a/plone/app/portlets/portlets/news.pt b/plone/app/portlets/portlets/news.pt\nindex 3b53a00b..1dc0c9c9 100644\n--- a/plone/app/portlets/portlets/news.pt\n+++ b/plone/app/portlets/portlets/news.pt\n@@ -1,58 +1,86 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n \n   <div class="card portlet portletNews"\n-      i18n:domain="plone">\n+       i18n:domain="plone"\n+  >\n \n     <div class="card-header">\n-      <a href="#"\n-          class="tile"\n-          tal:define="all_news_link view/all_news_link"\n-          tal:omit-tag="not:all_news_link"\n-          tal:attributes="href all_news_link"\n-          i18n:translate="box_news">News</a>\n+      <a class="tile"\n+         href="#"\n+         tal:define="\n+           all_news_link view/all_news_link;\n+         "\n+         tal:omit-tag="not:all_news_link"\n+         tal:attributes="\n+           href all_news_link;\n+         "\n+         i18n:translate="box_news"\n+      >News</a>\n     </div>\n \n     <div class="card-body"\n-        tal:define="thumb_scale view/thumb_scale;\n-                    supress_thumb view/data/no_thumbs;">\n+         tal:define="\n+           thumb_scale view/thumb_scale;\n+           supress_thumb view/data/no_thumbs;\n+         "\n+    >\n       <ul>\n-        <tal:newsitems\n-            tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;\n-                        plone_layout context/@@plone_layout;\n-                        portal context/@@plone_portal_state/portal;\n-                        image_scale portal/@@image_scale;\n-                        thumb_scale view/thumb_scale"\n-            tal:repeat="obj view/published_news_items">\n-        <li tal:define="oddrow repeat/obj/odd;"\n-            tal:attributes="class python:oddrow and \'portletItem even\' or \'portletItem odd\'">\n-          <a href=""\n-              class="tile"\n-              tal:attributes="href obj/getURL;\n-                              title obj/Description">\n-            <img tal:condition="python:obj.getIcon and thumb_scale"\n-                tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)" />\n-            <span tal:replace="obj/pretty_title_or_id">Plone 5.1 announced!</span>\n-          </a>\n-          <time class="portletItemDetails"\n-              tal:content="python:toLocalizedTime(obj.Date)">May 5</time>\n-        </li>\n+        <tal:newsitems tal:define="\n+                         toLocalizedTime nocall:context/@@plone/toLocalizedTime;\n+                         plone_layout context/@@plone_layout;\n+                         portal context/@@plone_portal_state/portal;\n+                         image_scale portal/@@image_scale;\n+                         thumb_scale view/thumb_scale;\n+                       "\n+                       tal:repeat="obj view/published_news_items"\n+        >\n+          <li tal:define="\n+                oddrow repeat/obj/odd;\n+              "\n+              tal:attributes="\n+                class python:oddrow and \'portletItem even\' or \'portletItem odd\';\n+              "\n+          >\n+            <a class="tile"\n+               href=""\n+               tal:attributes="\n+                 href obj/getURL;\n+                 title obj/Description;\n+               "\n+            >\n+              <img tal:condition="python:obj.getIcon and thumb_scale"\n+                   tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)"\n+              />\n+              <span tal:replace="obj/pretty_title_or_id">Plone 5.1 announced!</span>\n+            </a>\n+            <time class="portletItemDetails"\n+                  tal:content="python:toLocalizedTime(obj.Date)"\n+            >May 5</time>\n+          </li>\n         </tal:newsitems>\n       </ul>\n     </div>\n \n     <div class="card-footer portletFooter"\n-        tal:condition="view/all_news_link">\n+         tal:condition="view/all_news_link"\n+    >\n       <a href=""\n-          tal:attributes="href view/all_news_link"\n-          i18n:translate="box_more_news_link">\n+         tal:attributes="\n+           href view/all_news_link;\n+         "\n+         i18n:translate="box_more_news_link"\n+      >\n         More news&hellip;\n       </a>\n     </div>\n-    <div class="card-footer" tal:condition="not:view/all_news_link"></div>\n+    <div class="card-footer"\n+         tal:condition="not:view/all_news_link"\n+    ></div>\n \n   </div>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/portlets/portlets/recent.pt b/plone/app/portlets/portlets/recent.pt\nindex d7ce3ed1..ac9dc4f6 100644\n--- a/plone/app/portlets/portlets/recent.pt\n+++ b/plone/app/portlets/portlets/recent.pt\n@@ -1,56 +1,89 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n   <div class="card portlet portletRecent">\n \n     <div class="card-header">\n-      <a href="#" tal:attributes="href view/recently_modified_link" i18n:translate="" tal:content="view/title" />\n+      <a href="#"\n+         tal:content="view/title"\n+         tal:attributes="\n+           href view/recently_modified_link;\n+         "\n+         i18n:translate=""\n+      ></a>\n     </div>\n \n-    <div class="card-body" tal:condition="view/recent_items"\n-        tal:define="plone_layout context/@@plone_layout;\n-                    portal context/@@plone_portal_state/portal;\n-                    image_scale portal/@@image_scale;\n-                    supress_icon view/data/no_icons;\n-                    supress_thumb view/data/no_thumbs;\n-                    thumb_scale view/thumb_scale;\n-                    icons nocall:context/@@iconresolver;">\n+    <div class="card-body"\n+         tal:define="\n+           plone_layout context/@@plone_layout;\n+           portal context/@@plone_portal_state/portal;\n+           image_scale portal/@@image_scale;\n+           supress_icon view/data/no_icons;\n+           supress_thumb view/data/no_thumbs;\n+           thumb_scale view/thumb_scale;\n+           icons nocall:context/@@iconresolver;\n+         "\n+         tal:condition="view/recent_items"\n+    >\n       <ul>\n-        <tal:items\n-            tal:define="plone_view context/@@plone;\n-                        normalizeString nocall:plone_view/normalizeString;\n-                        toLocalizedTime nocall:plone_view/toLocalizedTime;"\n-            tal:repeat="obj view/recent_items">\n-        <li tal:define="oddrow repeat/obj/odd;\n-                        item_type obj/portal_type;\n-                        item_wf_state obj/review_state;\n-                        item_wf_state_class python:\'state-\' + normalizeString(item_wf_state);\n-                        item_class python:\'contenttype-\' + normalizeString(obj.portal_type) if not supress_icon else \'\';">\n-          <a href="" tal:attributes="href string:${obj/getURL}/view; title obj/Description; class string:$item_wf_state_class tile $item_class">\n-\n-            <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n-                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')" />\n-            <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n-                      tal:replace="structure python:icons.tag(f\'mimetype-{obj.mime_type}\')" />\n-\n-            <img tal:condition="python:obj.getIcon and thumb_scale and not supress_thumb and image_scale" tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)" />\n-            <span tal:content="obj/pretty_title_or_id">Title</span>\n-          </a>\n-          <time tal:content="python:toLocalizedTime(obj.ModificationDate)">May 5</time>\n-        </li>\n+        <tal:items tal:define="\n+                     plone_view context/@@plone;\n+                     normalizeString nocall:plone_view/normalizeString;\n+                     toLocalizedTime nocall:plone_view/toLocalizedTime;\n+                   "\n+                   tal:repeat="obj view/recent_items"\n+        >\n+          <li tal:define="\n+                oddrow repeat/obj/odd;\n+                item_type obj/portal_type;\n+                item_wf_state obj/review_state;\n+                item_wf_state_class python:\'state-\' + normalizeString(item_wf_state);\n+                item_class python:\'contenttype-\' + normalizeString(obj.portal_type) if not supress_icon else \'\';\n+              ">\n+            <a href=""\n+               tal:attributes="\n+                 href string:${obj/getURL}/view;\n+                 title obj/Description;\n+                 class string:$item_wf_state_class tile $item_class;\n+               "\n+            >\n+\n+              <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n+                        tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')"\n+              />\n+              <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n+                        tal:replace="structure python:icons.tag(f\'mimetype-{obj.mime_type}\')"\n+              />\n+\n+              <img tal:condition="python:obj.getIcon and thumb_scale and not supress_thumb and image_scale"\n+                   tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)"\n+              />\n+              <span tal:content="obj/pretty_title_or_id">Title</span>\n+            </a>\n+            <time tal:content="python:toLocalizedTime(obj.ModificationDate)">May 5</time>\n+          </li>\n         </tal:items>\n       </ul>\n     </div>\n \n-    <div class="card-body" tal:condition="not: view/recent_items">\n+    <div class="card-body"\n+         tal:condition="not: view/recent_items"\n+    >\n       <p i18n:translate="box_recent_no_items">No items changed yet.</p>\n     </div>\n \n     <div class="card-footer">\n-      <a href="#" class="tile" tal:attributes="href view/recently_modified_link" i18n:translate="box_more_recently_changed">All recent changes&hellip;</a>\n+      <a class="tile"\n+         href="#"\n+         tal:attributes="\n+           href view/recently_modified_link;\n+         "\n+         i18n:translate="box_more_recently_changed"\n+      >All recent changes&hellip;</a>\n     </div>\n   </div>\n \ndiff --git a/plone/app/portlets/portlets/review.pt b/plone/app/portlets/portlets/review.pt\nindex c3b16cf5..e0bd4c52 100644\n--- a/plone/app/portlets/portlets/review.pt\n+++ b/plone/app/portlets/portlets/review.pt\n@@ -1,63 +1,89 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n \n   <div class="card portlet portletWorkflowReview"\n-      i18n:domain="plone">\n+       i18n:domain="plone"\n+  >\n \n     <div class="card-header">\n-      <a href="#"\n-          class="tile"\n-          tal:define="full_review_link view/full_review_link"\n-          tal:omit-tag="not:full_review_link"\n-          tal:attributes="href full_review_link"\n-          i18n:translate=""\n-          tal:content="view/title" />\n+      <a class="tile"\n+         href="#"\n+         tal:define="\n+           full_review_link view/full_review_link;\n+         "\n+         tal:content="view/title"\n+         tal:omit-tag="not:full_review_link"\n+         tal:attributes="\n+           href full_review_link;\n+         "\n+         i18n:translate=""\n+      ></a>\n     </div>\n \n     <div class="card-body"\n-        tal:define="supress_icon    view/data/no_icons;\n-                    supress_thumb   view/data/no_thumbs;\n-                    thumb_scale python:view.thumb_scale();\n-                    ">\n+         tal:define="\n+           supress_icon    view/data/no_icons;\n+           supress_thumb   view/data/no_thumbs;\n+           thumb_scale python:view.thumb_scale();\n+         "\n+    >\n       <ul>\n         <tal:items tal:repeat="obj view/review_items">\n-        <li class="portletItem"\n-            tal:define="oddrow repeat/obj/odd;\n-                        review_state_class obj/review_state_class;\n-                        image obj/images;\n-                        hasImage obj/hasImage;\n-                        item_class python: obj[\'item_class\'] if not supress_icon else \'\';"\n-            tal:attributes="class python:oddrow and \'portletItem even\' or \'portletItem odd\'">\n-\n-          <a href="#"\n-              tal:attributes="href string:${obj/path}/view;\n-                              title obj/description;\n-                              class string:$review_state_class tile $item_class">\n-            <img tal:condition="python:not supress_thumb and hasImage and thumb_scale"\n-                tal:replace="structure python:image.scale(\'image\', scale=thumb_scale).tag(css_class=\'float-end thumb-\'+thumb_scale)"/>\n-            <span tal:replace="obj/title">Title</span>\n-          </a>\n-          <span class="portletItemDetails">\n-              <span tal:replace="obj/creator">Jim Smith</span> &mdash;\n-              <time tal:replace="obj/mod_date"> May 5</time>\n-          </span>\n-\n-        </li>\n+          <li class="portletItem"\n+              tal:define="\n+                oddrow repeat/obj/odd;\n+                review_state_class obj/review_state_class;\n+                image obj/images;\n+                hasImage obj/hasImage;\n+                item_class python: obj[\'item_class\'] if not supress_icon else \'\';\n+              "\n+              tal:attributes="\n+                class python:oddrow and \'portletItem even\' or \'portletItem odd\';\n+              "\n+          >\n+\n+            <a href="#"\n+               tal:attributes="\n+                 href string:${obj/path}/view;\n+                 title obj/description;\n+                 class string:$review_state_class tile $item_class;\n+               "\n+            >\n+              <img tal:condition="python:not supress_thumb and hasImage and thumb_scale"\n+                   tal:replace="structure python:image.scale(\'image\', scale=thumb_scale).tag(css_class=\'float-end thumb-\'+thumb_scale)"\n+              />\n+              <span tal:replace="obj/title">Title</span>\n+            </a>\n+            <span class="portletItemDetails">\n+              <span tal:replace="obj/creator">Jim Smith</span>\n+               &mdash;\n+              <time tal:replace="obj/mod_date">\n+                May 5</time>\n+            </span>\n+\n+          </li>\n         </tal:items>\n       </ul>\n     </div>\n \n     <div class="card-footer"\n-        tal:define="full_review_link view/full_review_link"\n-        tal:condition="full_review_link">\n-      <a href="#"\n-          class="tile"\n-          tal:attributes="href full_review_link"\n-          i18n:translate="box_full_review_list">Full review list&hellip;</a>\n+         tal:define="\n+           full_review_link view/full_review_link;\n+         "\n+         tal:condition="full_review_link"\n+    >\n+      <a class="tile"\n+         href="#"\n+         tal:attributes="\n+           href full_review_link;\n+         "\n+         i18n:translate="box_full_review_list"\n+      >Full review list&hellip;</a>\n     </div>\n \n   </div>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/portlets/portlets/rss.pt b/plone/app/portlets/portlets/rss.pt\nindex 66b9ec21..853ac0c4 100644\n--- a/plone/app/portlets/portlets/rss.pt\n+++ b/plone/app/portlets/portlets/rss.pt\n@@ -1,52 +1,78 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n \n   <div class="card portlet portletRss"\n-      i18n:domain="plone"\n-      tal:condition="view/enabled">\n+       tal:condition="view/enabled"\n+       i18n:domain="plone"\n+  >\n \n     <div class="card-header">\n-      <a href=""\n-          tal:attributes="href view/siteurl"\n-          tal:omit-tag="not:view/siteurl"\n-          tal:content="view/title"\n-          class="tile">\n+      <a class="tile"\n+         href=""\n+         tal:content="view/title"\n+         tal:omit-tag="not:view/siteurl"\n+         tal:attributes="\n+           href view/siteurl;\n+         "\n+      >\n         Tags\n       </a>\n     </div>\n \n-    <div class="card-body" >\n+    <div class="card-body">\n       <ul tal:condition="view/feedAvailable">\n-        <tal:rss tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime"\n-            tal:repeat="item view/items">\n-        <li class="portletItem oddrow"\n-            tal:define="oddrow repeat/item/odd"\n-            tal:attributes="class python:oddrow and \'portletItem even\' or \'portletItem odd\'">\n-          <a href="#"\n-              tal:attributes="href item/url"\n-              class="tile">\n-            <span tal:replace="item/title">Title</span>\n-          </a>\n-          <time class="portletItemDetails"\n-              tal:condition="exists:item/updated">\n-            <span tal:omit-tag="" tal:content="python:toLocalizedTime(item[\'updated\'])">19.02.2007</span>\n-          </time>\n-        </li>\n+        <tal:rss tal:define="\n+                   toLocalizedTime nocall:context/@@plone/toLocalizedTime;\n+                 "\n+                 tal:repeat="item view/items"\n+        >\n+          <li class="portletItem oddrow"\n+              tal:define="\n+                oddrow repeat/item/odd;\n+              "\n+              tal:attributes="\n+                class python:oddrow and \'portletItem even\' or \'portletItem odd\';\n+              "\n+          >\n+            <a class="tile"\n+               href="#"\n+               tal:attributes="\n+                 href item/url;\n+               "\n+            >\n+              <span tal:replace="item/title">Title</span>\n+            </a>\n+            <time class="portletItemDetails"\n+                  tal:condition="exists:item/updated"\n+            >\n+              <span tal:content="python:toLocalizedTime(item[\'updated\'])"\n+                    tal:omit-tag=""\n+              >19.02.2007</span>\n+            </time>\n+          </li>\n         </tal:rss>\n       </ul>\n     </div>\n \n-    <div class="card-footer" tal:condition="view/feedAvailable">\n+    <div class="card-footer"\n+         tal:condition="view/feedAvailable"\n+    >\n       <a href=""\n-          tal:condition="view/siteurl"\n-          tal:attributes="href view/siteurl">\n-        <span class="hiddenStructure"><span tal:replace="view/title" /> - </span>\n+         tal:condition="view/siteurl"\n+         tal:attributes="\n+           href view/siteurl;\n+         "\n+      >\n+        <span class="hiddenStructure"><span tal:replace="view/title"></span>\n+          -\n+        </span>\n         <span i18n:translate="box_morelink">More&hellip;</span>\n       </a>\n     </div>\n \n   </div>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/portlets/portlets/search.pt b/plone/app/portlets/portlets/search.pt\nindex 7d1289f4..38eecebd 100644\n--- a/plone/app/portlets/portlets/search.pt\n+++ b/plone/app/portlets/portlets/search.pt\n@@ -1,40 +1,70 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n   <div class="card portlet portletSearch">\n \n     <div class="card-header">\n-      <a class="tile" tal:attributes="href view/search_action">\n-        <tal:header condition="not:view/data/title|nothing" i18n:translate="box_search">Search</tal:header>\n-        <tal:header condition="view/data/title|nothing" tal:content="view/data/title">Search</tal:header>\n+      <a class="tile"\n+         tal:attributes="\n+           href view/search_action;\n+         "\n+      >\n+        <tal:header condition="not:view/data/title|nothing"\n+                    i18n:translate="box_search"\n+        >Search</tal:header>\n+        <tal:header condition="view/data/title|nothing"\n+                    tal:content="view/data/title"\n+        >Search</tal:header>\n       </a>\n     </div>\n \n     <div class="card-body">\n-      <form id="searchform" action="search"\n-          style="min-width: auto;"\n-          tal:define="livesearch view/enable_livesearch;"\n-          tal:attributes="action view/search_action;\n-                          data-action view/action;\n-                          class python: view.enable_livesearch() and \'pat-livesearch\' or None;\n-                          data-pat-livesearch python: view.enable_livesearch() and \'ajaxUrl:\' + view.navigation_root_url + \'/@@ajax-search\' or None;">\n+      <form id="searchform"\n+            action="search"\n+            style="min-width: auto;"\n+            tal:define="\n+              livesearch view/enable_livesearch;\n+            "\n+            tal:attributes="\n+              action view/search_action;\n+              data-action view/action;\n+              class python: view.enable_livesearch() and \'pat-livesearch\' or None;\n+              data-pat-livesearch python: view.enable_livesearch() and \'ajaxUrl:\' + view.navigation_root_url + \'/@@ajax-search\' or None;\n+            "\n+      >\n         <div class="LSBox">\n           <div class="input-group">\n             <input class="form-control"\n-                name="SearchableText"\n-                type="text"\n-                title="Search Site"\n-                placeholder="Search Site"\n-                i18n:attributes="title title_search_title; placeholder title_search_site"\n-                tal:attributes="value request/SearchableText|nothing; class python:livesearch and \'form-control portlet-search-gadget\' or \'form-control portlet-search-gadget-nols\'"/>\n+                   name="SearchableText"\n+                   placeholder="Search Site"\n+                   title="Search Site"\n+                   type="text"\n+                   tal:attributes="\n+                     value request/SearchableText|nothing;\n+                     class python:livesearch and \'form-control portlet-search-gadget\' or \'form-control portlet-search-gadget-nols\';\n+                   "\n+                   i18n:attributes="title title_search_title; placeholder title_search_site"\n+            />\n             <div class="input-group-append">\n-              <button type="submit" class="btn btn-primary" value="Search" i18n:attributes="value label_search" i18n:translate="label_submit">Submit</button>\n+              <button class="btn btn-primary"\n+                      type="submit"\n+                      value="Search"\n+                      i18n:attributes="value label_search"\n+                      i18n:translate="label_submit"\n+              >Submit</button>\n             </div>\n           </div>\n-          <div class="LSResult" style="" tal:condition="livesearch" tal:attributes="data-livesearch view/livesearch_action;">\n+          <div class="LSResult"\n+               style=""\n+               tal:condition="livesearch"\n+               tal:attributes="\n+                 data-livesearch view/livesearch_action;\n+               "\n+          >\n             <div class="LSShadow"></div>\n           </div>\n         </div>\n@@ -42,7 +72,12 @@\n     </div>\n \n     <div class="card-footer">\n-      <a href="#" tal:attributes="href view/search_action" i18n:translate="label_advanced_search">Advanced Search&hellip;</a>\n+      <a href="#"\n+         tal:attributes="\n+           href view/search_action;\n+         "\n+         i18n:translate="label_advanced_search"\n+      >Advanced Search&hellip;</a>\n     </div>\n \n   </div>\ndiff --git a/plone/app/portlets/tests/configure.zcml b/plone/app/portlets/tests/configure.zcml\nindex 1b376d1c..61518080 100644\n--- a/plone/app/portlets/tests/configure.zcml\n+++ b/plone/app/portlets/tests/configure.zcml\n@@ -1,26 +1,28 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    xmlns:plone="http://namespaces.plone.org/plone"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n     package="plone.app.portlets"\n-    i18n_domain="test">\n+    i18n_domain="test"\n+    >\n \n-    <plone:portlet\n-        name="portlets.test.Test"\n-        interface="plone.app.portlets.tests.test_configuration.ITestPortlet"\n-        assignment="plone.app.portlets.tests.test_configuration.TestAssignment"\n-        renderer="plone.app.portlets.tests.test_configuration.TestRenderer"\n-        addview="plone.app.portlets.tests.test_configuration.TestAddForm"\n-        editview="plone.app.portlets.tests.test_configuration.TestEditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.test.Test"\n+      interface="plone.app.portlets.tests.test_configuration.ITestPortlet"\n+      assignment="plone.app.portlets.tests.test_configuration.TestAssignment"\n+      renderer="plone.app.portlets.tests.test_configuration.TestRenderer"\n+      addview="plone.app.portlets.tests.test_configuration.TestAddForm"\n+      editview="plone.app.portlets.tests.test_configuration.TestEditForm"\n+      />\n \n-    <genericsetup:registerProfile\n-        name="testing"\n-        title="plone.app.portlets testing"\n-        description="Used for testing only"\n-        directory="tests/profiles/testing"\n-        for="Products.CMFCore.interfaces.ISiteRoot"\n-        provides="Products.GenericSetup.interfaces.EXTENSION"\n-        />\n+  <genericsetup:registerProfile\n+      name="testing"\n+      title="plone.app.portlets testing"\n+      description="Used for testing only"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      directory="tests/profiles/testing"\n+      />\n \n </configure>\ndiff --git a/plone/app/portlets/tests/profiles/testing/portlets.xml b/plone/app/portlets/tests/profiles/testing/portlets.xml\nindex e1a89a5c..4895e87c 100644\n--- a/plone/app/portlets/tests/profiles/testing/portlets.xml\n+++ b/plone/app/portlets/tests/profiles/testing/portlets.xml\n@@ -1,153 +1,141 @@\n-<?xml version="1.0"?>\n-<portlets\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    i18n:domain="plone">\n-\n-    <portletmanager\n-        name="test.testcolumn"\n-        type="plone.app.portlets.tests.test_configuration.ITestColumn"\n-        />\n-\n-    <portletmanager\n-        name="test.testcolumn2"\n-        type="plone.app.portlets.tests.test_configuration.ITestColumn"\n-        />\n-\n-    <portlet\n-        addview="portlets.test.Test"\n-        title="Test portlet"\n-        description="A test portlet"\n-        i18n:attributes="title title_test_portlet;\n-                         description description_test_portlet"\n-        />\n-\n-    <!-- \'name\' and \'insert-before\' are optional -->\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="context"\n-        key="/"\n-        type="portlets.test.Test"\n-        name="test.portlet1">\n-            <property name="test_text">Test pr\xc3\xb6p 1</property>\n-            <property name="test_bool">False</property>\n-            <property name="test_tuple">\n-                <element>published</element>\n-                <element>private</element>\n-            </property>\n-    </assignment>\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="context"\n-        key="/"\n-        type="portlets.test.Test"\n-        name="test.portlet2"\n-        visible="0"\n-        insert-before="test.portlet1">\n-            <property name="test_text">Test prop 2</property>\n-            <property name="test_bool">True</property>\n-            <property name="test_tuple" />\n-    </assignment>\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="context"\n-        key="/"\n-        type="portlets.test.Test"\n-        name="test.portlet3"\n-        insert-before="*" />\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="content_type"\n-        key="Folder"\n-        type="portlets.test.Test"\n-        name="test.portlet4"\n-        insert-before="test.portlet1"\n-        />\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="content_type"\n-        key="Folder"\n-        type="portlets.test.Test"\n-        name="test.portlet5"\n-        insert-before="test.portlet1"\n-        />\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="group"\n-        key="Reviewers"\n-        type="portlets.test.Test"\n-        name="test.portlet6"\n-        insert-before="test.portlet1"\n-        />\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="context"\n-        key="/"\n-        type="portlets.test.Test"\n-        name="test.portlet7"\n-        remove="" />\n-\n-    <assignment name="navigation"\n-        category="context"\n-        key="/"\n-        manager="test.testcolumn2"\n-        type="portlets.Navigation"\n-        visible="True">\n-        <property name="topLevel">1</property>\n-        <property name="currentFolderOnly">False</property>\n-        <property name="name"></property>\n-        <property name="includeTop">False</property>\n-        <property name="bottomLevel">0</property>\n-        <property name="root"></property>\n-        <property name="no_icon">False</property>\n-        <property name="thumb_scale"></property>\n-        <property name="no_thumbs">False</property>\n-    </assignment>\n-\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="context"\n-        location="/news"\n-        status="block"\n-        />\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="group"\n-        location="/news"\n-        status="show"\n-        />\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="content_type"\n-        location="/news"\n-        status="acquire"\n-        />\n-\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="content_type"\n-        location="/"\n-        status="block"\n-        />\n-\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="group"\n-        location="/"\n-        status="show"\n-        />\n-\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="context"\n-        location="/"\n-        status="acquire"\n-        />\n+<?xml version="1.0" encoding="utf-8"?>\n+<portlets xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+          i18n:domain="plone"\n+>\n+\n+  <portletmanager name="test.testcolumn"\n+                  type="plone.app.portlets.tests.test_configuration.ITestColumn"\n+  />\n+\n+  <portletmanager name="test.testcolumn2"\n+                  type="plone.app.portlets.tests.test_configuration.ITestColumn"\n+  />\n+\n+  <portlet addview="portlets.test.Test"\n+           description="A test portlet"\n+           title="Test portlet"\n+           i18n:attributes="title title_test_portlet;                          description description_test_portlet"\n+  />\n+\n+  <!-- \'name\' and \'insert-before\' are optional -->\n+\n+  <assignment category="context"\n+              key="/"\n+              manager="test.testcolumn"\n+              name="test.portlet1"\n+              type="portlets.test.Test"\n+  >\n+    <property name="test_text">Test pr\xc3\xb6p 1</property>\n+    <property name="test_bool">False</property>\n+    <property name="test_tuple">\n+      <element>published</element>\n+      <element>private</element>\n+    </property>\n+  </assignment>\n+\n+  <assignment category="context"\n+              insert-before="test.portlet1"\n+              key="/"\n+              manager="test.testcolumn"\n+              name="test.portlet2"\n+              type="portlets.test.Test"\n+              visible="0"\n+  >\n+    <property name="test_text">Test prop 2</property>\n+    <property name="test_bool">True</property>\n+    <property name="test_tuple" />\n+  </assignment>\n+\n+  <assignment category="context"\n+              insert-before="*"\n+              key="/"\n+              manager="test.testcolumn"\n+              name="test.portlet3"\n+              type="portlets.test.Test"\n+  />\n+\n+  <assignment category="content_type"\n+              insert-before="test.portlet1"\n+              key="Folder"\n+              manager="test.testcolumn"\n+              name="test.portlet4"\n+              type="portlets.test.Test"\n+  />\n+\n+  <assignment category="content_type"\n+              insert-before="test.portlet1"\n+              key="Folder"\n+              manager="test.testcolumn"\n+              name="test.portlet5"\n+              type="portlets.test.Test"\n+  />\n+\n+  <assignment category="group"\n+              insert-before="test.portlet1"\n+              key="Reviewers"\n+              manager="test.testcolumn"\n+              name="test.portlet6"\n+              type="portlets.test.Test"\n+  />\n+\n+  <assignment category="context"\n+              key="/"\n+              manager="test.testcolumn"\n+              name="test.portlet7"\n+              remove=""\n+              type="portlets.test.Test"\n+  />\n+\n+  <assignment category="context"\n+              key="/"\n+              manager="test.testcolumn2"\n+              name="navigation"\n+              type="portlets.Navigation"\n+              visible="True"\n+  >\n+    <property name="topLevel">1</property>\n+    <property name="currentFolderOnly">False</property>\n+    <property name="name" />\n+    <property name="includeTop">False</property>\n+    <property name="bottomLevel">0</property>\n+    <property name="root" />\n+    <property name="no_icon">False</property>\n+    <property name="thumb_scale" />\n+    <property name="no_thumbs">False</property>\n+  </assignment>\n+\n+  <blacklist category="context"\n+             location="/news"\n+             manager="test.testcolumn"\n+             status="block"\n+  />\n+  <blacklist category="group"\n+             location="/news"\n+             manager="test.testcolumn"\n+             status="show"\n+  />\n+  <blacklist category="content_type"\n+             location="/news"\n+             manager="test.testcolumn"\n+             status="acquire"\n+  />\n+\n+  <blacklist category="content_type"\n+             location="/"\n+             manager="test.testcolumn"\n+             status="block"\n+  />\n+\n+  <blacklist category="group"\n+             location="/"\n+             manager="test.testcolumn"\n+             status="show"\n+  />\n+\n+  <blacklist category="context"\n+             location="/"\n+             manager="test.testcolumn"\n+             status="acquire"\n+  />\n \n </portlets>\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:25+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/11a50a390d6a765d20dea47222a3458465d8562d

chore: flake8

```
plone/app/portlets/browser/editmanager.py:395:21: E731 do not assign a lambda expression, use a def
plone/app/portlets/exportimport/portlets.py:248:21: E722 do not use bare 'except'
plone/app/portlets/exportimport/portlets.py:654:27: E712 comparison to True should be 'if cond is True:' or 'if cond:'
plone/app/portlets/exportimport/portlets.py:656:29: E712 comparison to False should be 'if cond is False:' or 'if not cond:'
plone/app/portlets/portlets/base.py:1:1: F401 '..browser.formhelper.AddForm' imported but unused
plone/app/portlets/portlets/base.py:2:1: F401 '..browser.formhelper.EditForm' imported but unused
plone/app/portlets/portlets/base.py:3:1: F401 '..browser.formhelper.NullAddForm' imported but unused
plone/app/portlets/portlets/base.py:89:9: F901 'raise NotImplemented' should be 'raise NotImplementedError'
plone/app/portlets/portlets/calendar.py:2:1: F401 'plone.app.event.portlets.portlet_calendar.Assignment' imported but unused
plone/app/portlets/portlets/events.py:2:1: F401 'plone.app.event.portlets.portlet_events.Assignment' imported but unused
plone/app/portlets/portlets/navigation.py:30:1: F401 'Products.MimetypesRegistry.MimeTypeItem.guess_icon_path' imported but unused
plone/app/portlets/portlets/navigation.py:40:1: F401 'os' imported but unused
plone/app/portlets/portlets/navigation.py:486:28: E712 comparison to False should be 'if cond is False:' or 'if not cond:'
plone/app/portlets/portlets/review.py:18:1: F401 'zope.interface.Interface' imported but unused
plone/app/portlets/portlets/rss.py:130:9: E722 do not use bare 'except'
plone/app/portlets/tests/test_configuration.py:49:1: E402 module level import not at top of file
plone/app/portlets/tests/test_configuration.py:50:1: E402 module level import not at top of file
plone/app/portlets/tests/test_configuration.py:51:1: E402 module level import not at top of file
plone/app/portlets/tests/test_configuration.py:52:1: E402 module level import not at top of file
plone/app/portlets/tests/test_dashboard.py:5:1: F401 'plone.portlets.interfaces.IPortletType' imported but unused
plone/app/portlets/tests/test_dashboard.py:10:1: F401 'zExceptions.Unauthorized' imported but unused
plone/app/portlets/tests/test_traversal.py:55:9: F841 local variable 'assignment' is assigned to but never used
plone/app/portlets/tests/test_traversal.py:56:9: F841 local variable 'manager' is assigned to but never used
plone/app/portlets/tests/test_utils.py:12:1: F401 'plone.portlets.interfaces.IPortletRenderer' imported but unused
plone/app/portlets/utils.py:4:1: F401 'plone.app.portlets.HAS_PLONE_APP_EVENT' imported but unused
plone/app/portlets/utils.py:84:9: F601 dictionary key 'portlet_calendar' repeated with different values
plone/app/portlets/utils.py:85:9: F601 dictionary key 'portlet_events' repeated with different values
plone/app/portlets/utils.py:86:9: F601 dictionary key 'portlet_calendar' repeated with different values
plone/app/portlets/utils.py:87:9: F601 dictionary key 'portlet_events' repeated with different values
```

Files changed:
M plone/app/portlets/browser/editmanager.py
M plone/app/portlets/exportimport/portlets.py
M plone/app/portlets/portlets/base.py
M plone/app/portlets/portlets/calendar.py
M plone/app/portlets/portlets/events.py
M plone/app/portlets/portlets/navigation.py
M plone/app/portlets/portlets/review.py
M plone/app/portlets/portlets/rss.py
M plone/app/portlets/tests/atom_feed_maurits.xml
M plone/app/portlets/tests/test_configuration.py
M plone/app/portlets/tests/test_dashboard.py
M plone/app/portlets/tests/test_traversal.py
M plone/app/portlets/tests/test_utils.py
M plone/app/portlets/utils.py

b'diff --git a/plone/app/portlets/browser/editmanager.py b/plone/app/portlets/browser/editmanager.py\nindex 5e5842b2..f588ae9a 100644\n--- a/plone/app/portlets/browser/editmanager.py\n+++ b/plone/app/portlets/browser/editmanager.py\n@@ -392,9 +392,10 @@ def global_portlets(self, category, prefix):\n                 mapping = self.manager.get(category, None)\n                 assignments = []\n                 if mapping is not None:\n-                    is_visible = lambda a: IPortletAssignmentSettings(a).get(\n-                        "visible", True\n-                    )\n+\n+                    def is_visible(a):\n+                        return IPortletAssignmentSettings(a).get("visible", True)\n+\n                     assignments.extend(\n                         [a for a in mapping.get(key, {}).values() if is_visible(a)]\n                     )\ndiff --git a/plone/app/portlets/exportimport/portlets.py b/plone/app/portlets/exportimport/portlets.py\nindex 82e1d70b..8d4d1dcf 100644\n--- a/plone/app/portlets/exportimport/portlets.py\n+++ b/plone/app/portlets/exportimport/portlets.py\n@@ -245,7 +245,7 @@ def field_typecast(self, field, value):\n                     try:\n                         value = tc(value)\n                         break\n-                    except:\n+                    except Exception:\n                         pass\n         return value\n \n@@ -651,12 +651,12 @@ def extractMapping(manager_name, category, key, mapping):\n                 child.setAttribute("location", "/")\n \n                 status = assignable.getBlacklistStatus(category)\n-                if status == True:\n+                if status is None:\n+                    child.setAttribute("status", "acquire")\n+                elif status:\n                     child.setAttribute("status", "block")\n-                elif status == False:\n-                    child.setAttribute("status", "show")\n                 else:\n-                    child.setAttribute("status", "acquire")\n+                    child.setAttribute("status", "show")\n \n                 fragment.appendChild(child)\n \ndiff --git a/plone/app/portlets/portlets/base.py b/plone/app/portlets/portlets/base.py\nindex cfe507cb..3a19370d 100644\n--- a/plone/app/portlets/portlets/base.py\n+++ b/plone/app/portlets/portlets/base.py\n@@ -1,6 +1,6 @@\n-from ..browser.formhelper import AddForm\n-from ..browser.formhelper import EditForm\n-from ..browser.formhelper import NullAddForm\n+from ..browser.formhelper import AddForm  # noqa F401 imported but unused\n+from ..browser.formhelper import EditForm  # noqa F401 imported but unused\n+from ..browser.formhelper import NullAddForm  # noqa F401 imported but unused\n from OFS.SimpleItem import SimpleItem\n from plone.app.portlets.interfaces import IDeferredPortletRenderer\n from plone.portlets.interfaces import IPortletAssignment\n@@ -86,7 +86,7 @@ class DeferredRenderer(Renderer):\n     render_preload = ViewPageTemplateFile("deferred_portlet.pt")\n \n     def render_full(self):\n-        raise NotImplemented(\n+        raise NotImplementedError(\n             "You must implement \'render_full\' as a method or page template file attribute"\n         )\n \ndiff --git a/plone/app/portlets/portlets/calendar.py b/plone/app/portlets/portlets/calendar.py\nindex 2d0e487f..b1af0295 100644\n--- a/plone/app/portlets/portlets/calendar.py\n+++ b/plone/app/portlets/portlets/calendar.py\n@@ -1,2 +1,2 @@\n # avoid broken persistent object\n-from plone.app.event.portlets.portlet_calendar import Assignment\n+from plone.app.event.portlets.portlet_calendar import Assignment  # noqa F401\ndiff --git a/plone/app/portlets/portlets/events.py b/plone/app/portlets/portlets/events.py\nindex f8eb93c6..f249a0f2 100644\n--- a/plone/app/portlets/portlets/events.py\n+++ b/plone/app/portlets/portlets/events.py\n@@ -1,2 +1,2 @@\n # avoid broken persistent object\n-from plone.app.event.portlets.portlet_events import Assignment\n+from plone.app.event.portlets.portlet_events import Assignment  # noqa F401\ndiff --git a/plone/app/portlets/portlets/navigation.py b/plone/app/portlets/portlets/navigation.py\nindex 16e1eac7..f1fc0819 100644\n--- a/plone/app/portlets/portlets/navigation.py\n+++ b/plone/app/portlets/portlets/navigation.py\n@@ -27,7 +27,6 @@\n from Products.CMFPlone.browser.navtree import SitemapNavtreeStrategy\n from Products.CMFPlone.utils import typesToList\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n-from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path\n from zExceptions import NotFound\n from zope import schema\n from zope.component import adapter\n@@ -37,8 +36,6 @@\n from zope.interface import implementer\n from zope.interface import Interface\n \n-import os\n-\n \n class INavigationPortlet(IPortletDataProvider):\n     """A portlet which can render the navigation tree"""\n@@ -483,13 +480,12 @@ def __init__(self, context, portlet):\n \n     def subtreeFilter(self, node):\n         sitemapDecision = SitemapNavtreeStrategy.subtreeFilter(self, node)\n-        if sitemapDecision == False:\n+        if not sitemapDecision:\n             return False\n         depth = node.get("depth", 0)\n         if depth > 0 and self.bottomLevel > 0 and depth >= self.bottomLevel:\n             return False\n-        else:\n-            return True\n+        return True\n \n \n def getRootPath(context, currentFolderOnly, topLevel, root):\ndiff --git a/plone/app/portlets/portlets/review.py b/plone/app/portlets/portlets/review.py\nindex eb7346a5..7e6e2cc9 100644\n--- a/plone/app/portlets/portlets/review.py\n+++ b/plone/app/portlets/portlets/review.py\n@@ -15,7 +15,6 @@\n from zope.component import getUtility\n from zope.component import queryUtility\n from zope.interface import implementer\n-from zope.interface import Interface\n \n \n class IReviewPortlet(IPortletDataProvider):\ndiff --git a/plone/app/portlets/portlets/rss.py b/plone/app/portlets/portlets/rss.py\nindex 1cdf8ccc..655c4862 100644\n--- a/plone/app/portlets/portlets/rss.py\n+++ b/plone/app/portlets/portlets/rss.py\n@@ -127,7 +127,7 @@ def update(self):\n             # check for regular update\n             if self.needs_update:\n                 return self._retrieveFeed()\n-        except:\n+        except Exception:\n             self._failed = True\n             logger.exception("failed to update RSS feed %s", self.url)\n \ndiff --git a/plone/app/portlets/tests/atom_feed_maurits.xml b/plone/app/portlets/tests/atom_feed_maurits.xml\nindex 7655d714..83c90123 100644\n--- a/plone/app/portlets/tests/atom_feed_maurits.xml\n+++ b/plone/app/portlets/tests/atom_feed_maurits.xml\n@@ -1,1520 +1 @@\n-<?xml version="1.0" ?>\n <?xml-stylesheet href="atom.css" type="text/css"?>\n-\n-<feed xmlns="http://www.w3.org/2005/Atom"\n-      xmlns:atom="http://www.w3.org/2005/Atom"\n-      xmlns:dc="http://purl.org/dc/elements/1.1/"\n-      xml:base="https://maurits.vanrees.org" xml:lang="en">\n-  <link rel="self"\n-        href="https://maurits.vanrees.org/weblog/topics/plone/@@atom.xml" />\n-  <div xmlns="http://www.w3.org/1999/xhtml">\n-    <a href="http://www.atomenabled.org/feedvalidator/check.cgi?url=https://maurits.vanrees.org/weblog/atom.xml">\n-      <img title="Validate my Atom feed" width="88"\n-           height="31"\n-           src="http://www.atomenabled.org/feedvalidator/images/valid-atom.png"\n-           alt="[Valid Atom]" border="0px" />\n-    </a>\n-    <p>\n-      <span>\n-        This is an Atom formatted XML site feed. It is intended to be viewed in\n-        a Newsreader or syndicated to another site. Please visit\n-      </span>\n-      <a href="http://www.atomenabled.org/">Atom Enabled</a>\n-      <span>\n-        for more info.\n-      </span>\n-    </p>\n-  </div>\n-\n-  <title type="html">Weblog</title>\n-\n-\n-  <updated>2021-01-05T10:33:42+00:00</updated>\n-\n-  <link href="https://maurits.vanrees.org/weblog"\n-        rel="alternate" type="text/html" />\n-\n-\n-\n-  <id>urn:syndication:3a1d81067fb16b9d671c9ee4a6efa204</id>\n-\n-  <generator uri="http://plone.org/products/fatsyndication/" version="0.1">fatsyndication</generator>\n-\n-\n-\n-    <entry>\n-\n-      <title>Philip Bauer: Growing Pains: PosKeyErrors and Other Malaises</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/philip-bauer-growing-pains-poskeyerrors-and-other-malaises" />\n-\n-\n-\n-      <id>urn:syndication:a2e343ca7c1c64182bc128b9a4f0be0b</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>This talk is about the issues that you face when your project grows, the code base grows, the database grows, the problems grow.\n-This is about the causes and some of the remedies.</p>\n-<div class="section" id="symptom-1-huge-database">\n-<h3><a name="symptom-1-huge-database">Symptom 1: huge database</a></h3>\n-<p>Cause 1: a huge number of revisions or versions.</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Remove all versions and pack the database. When you migrate to a new Plone version, and you ask your client, they will usually be okay with this.</li>\n-<li>Manage or limit revisions. Easiest is to use <a class="reference" href="https://github.com/collective/collective.revisionmanager">collective.revisionmanager</a> for this. Especially, revisions may have been left behind for content that no longer exists. You can easily remove it with this tool.</li>\n-<li>Disable versioning of Files. It is disabled by default, but maybe someone has switched it on.</li>\n-<li>Enable manual versioning instead of automatic. Then the editor needs to check a box when they make a major change that they want to be able to rollback.</li>\n-</ul>\n-<p>Cause 2: no packing.</p>\n-<p>Remedy: just pack it. Use the <tt class="docutils literal"><span class="pre">zeopack</span></tt> script, which part of <tt class="docutils literal"><span class="pre">plone.recipe.zeoserver</span></tt>. Add a cronjob for this, weekly seems best for most sites.</p>\n-<p>Cause 3: unused content.</p>\n-<p>Remedy: delete it. You have to find it first.\n-Of course no code can tell you which content is safe to delete.\n-You could use <tt class="docutils literal"><span class="pre">statistics.py</span></tt> from <a class="reference" href="https://github.com/collective/collective.migrationhelpers">collective.migrationhelpers</a> to get an idea of where which content is.</p>\n-<p>Cause 4: the SearchableText index is huge</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Use solr or elasticsearch and possibly remove the <tt class="docutils literal"><span class="pre">SearchableText</span></tt> index.</li>\n-<li>Don\'t index files. They are converted to text, but this may not be needed for your site.</li>\n-</ul>\n-<p>Cause 5: large blobs\n-For example, plone.de had a Linux <tt class="docutils literal"><span class="pre">iso</span></tt> image, which was huge.</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Limit the upload size. You could do this in nginx/apache. Archetypes had something, you can likely do this in Dexterity too.</li>\n-<li>Get stats and remove or replace too large items.</li>\n-</ul>\n-<p>Cause 6: aborted uploads (rare)</p>\n-<p>Remedy: check <tt class="docutils literal"><span class="pre">IAnnotations(portal).get(\'file_upload_map\')</span></tt>.</p>\n-</div>\n-<div class="section" id="symptom-2-slow-site">\n-<h3><a name="symptom-2-slow-site">Symptom 2: slow site</a></h3>\n-<p>Cause 1: unneeded full renders of content</p>\n-<p>Remedy: use Python in page templates.\n-By default, page templates use path expressions like this: <tt class="docutils literal"><span class="pre">tal:define=&quot;foo</span> <span class="pre">context/foo&quot;</span></tt>.\n-But this tries to render&nbsp; foo as html if possible.\n-Use <tt class="docutils literal"><span class="pre">foo</span> <span class="pre">python:context.foo</span></tt> instead.</p>\n-<p>Cause 2: wake up many objects</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Always try to use brains and metadata. The difference is huge, also with Dexterity.</li>\n-<li>Listing 3000 brains: 0.2 seconds</li>\n-<li>Listing 3000 objects: 2 seconds</li>\n-<li>Same is true for Volto when you use the search-endpoint with <tt class="docutils literal"><span class="pre">fullobjects</span></tt>.</li>\n-</ul>\n-<p>Of course most page templates in Plone will not list thousands of objects, but will be paginated.\n-Still: just use brains, they are so much tastier.</p>\n-<p>Cause 3: no caching</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Switch on the built-in caching</li>\n-<li>Add varnish</li>\n-<li>Manage the zeocache (that is a bit of science, ask the community)</li>\n-<li>Use <tt class="docutils literal"><span class="pre">memoize</span></tt> in your code.</li>\n-</ul>\n-<p>Cause 4: hardware</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Don\'t be cheap.</li>\n-<li>Buy enough ram to keep the database in memory.</li>\n-<li>Remember that your consulting time probably costs more than buying better hardware would.</li>\n-</ul>\n-<p>Cause 5: slow code</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Learn and use profiling. A very handy toy for that is <a class="reference" href="https://pypi.org/project/py-spy/">py-spy</a>. Sample use: <tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">py-spy</span> <span class="pre">top</span> <span class="pre">--pid</span> <span class="pre">12345</span></tt></li>\n-<li>Do not call methods multiple times from templates. Call them once, store the result, and use this.</li>\n-</ul>\n-<p>Cause 6: slow data sources</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>decouple, for example using redis or celery</li>\n-<li>Use your choice of async implementations</li>\n-<li>Use lazyloading of images if they come from outside of your Plone site.</li>\n-</ul>\n-</div>\n-<div class="section" id="symptom-3-conflict-errors">\n-<h3><a name="symptom-3-conflict-errors">Symptom 3: conflict errors</a></h3>\n-<p>Conflict errors happen when two requests work at the same time and both change the same object.\n-This is complicated, but Zope and the ZODB have built-in conflict resolution.</p>\n-<p>Cause 1: conflict resolving is not enabled.\n-The zeoserver needs access to the same code that your zeoclient has, otherwise conflicts cannot be resolved and the transaction will be aborted.</p>\n-<p>Remedy: add all application code to the zeoserver:</p>\n-<pre class="literal-block">\n-[zeoserver]\n-eggs = ${buildout:eggs}\n-</pre>\n-<p>Cause 2: long running requests change data</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Prevent writes.</li>\n-<li>If it takes long, do intermediate commits when possible.</li>\n-<li>Prevent crossfire: disable cronjobs and editors when a long request needs to run.</li>\n-<li>Use async. Talk to Asko about that probably.</li>\n-</ul>\n-</div>\n-<div class="section" id="symptom-4-poskeyerrors">\n-<h3><a name="symptom-4-poskeyerrors">Symptom 4: PosKeyErrors</a></h3>\n-<p>Cause 1: missing blobs</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Copy all blobs of course.</li>\n-<li>Use <a class="reference" href="https://pypi.org/project/experimental.gracefulblobmissing/">experimental.gracefulblobmissing</a> in development to create dummy blobs where needed.</li>\n-<li>Find and delete afflicted content in a browser view.</li>\n-<li>There can be cases when you have two zeoclients and the syncing does not work well. Talk to Alessandro about that.</li>\n-</ul>\n-</div>\n-<div class="section" id="symptom-5-broken-data">\n-<h3><a name="symptom-5-broken-data">Symptom 5: broken data</a></h3>\n-<p>Now for the really interesting part.\n-These are errors like:</p>\n-<pre class="literal-block">\n-ModuleNotFoundError\n-AttributeError\n-ImportError\n-PostKeyError\n-BrokenObject\n-</pre>\n-<p>I could read you my whole blog post about <a class="reference" href="https://www.starzel.de/blog/zodb-debugging">zodb debugging</a>.</p>\n-<p>Cause 1: code to unpickle som data is missing</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Ignore the errors, if normal operation still works, and the site only has to stay up for a limited time, because <tt class="docutils literal"><span class="pre">zeopack</span></tt> probably also fails.</li>\n-<li>Fix it with a <a class="reference" href="https://github.com/zopefoundation/zodbupdate#id4">rename_dict</a>. See <a class="reference" href="https://github.com/zestsoftware/zest.zodbupdate">zest.zodbupdate</a> for some examples that are actually really useful. [Thanks! MvR]</li>\n-<li>Work around it with an <tt class="docutils literal"><span class="pre">alias_module</span></tt> patch, like <tt class="docutils literal"><span class="pre">plone.app.upgrade</span></tt> does in several cases. Then imports can work again.</li>\n-<li>Find out what and where broken objects are and then fix or remove them safely. Use <a class="reference" href="https://pypi.org/project/zodbverify/">zodbverify</a>.</li>\n-</ul>\n-<p>Steps for the last one:</p>\n-<ul class="simple">\n-<li>Call <tt class="docutils literal"><span class="pre">bin/zodbverify</span> <span class="pre">-f</span> <span class="pre">var/filestorage/Data.fs</span></tt> to get all broken objects.</li>\n-<li>Pick one error type at a time, with an oid (object id) that has a problem.</li>\n-<li>Call <tt class="docutils literal"><span class="pre">bin/zodbverify</span> <span class="pre">-f</span> <span class="pre">var/filestorage/Data.fs</span> <span class="pre">-o</span> <span class="pre">&lt;oid&gt;</span> <span class="pre">-D</span></tt> to inspect one object and find out where it is referenced.</li>\n-<li>For the extra options, you should use the branch from my <a class="reference" href="https://github.com/plone/zodbverify/pull/8">pull request</a>, which I still have not finished yet, but it runs fine.</li>\n-<li>Remove or fix the object.</li>\n-<li>Important: make notes, write upgrade steps, keep the terminal log, because you will forget it and need it again.</li>\n-</ul>\n-<p>To remove or fix the object, it helps to start the actual Plone site with some special zodbverify sauce:</p>\n-<pre class="literal-block">\n-./bin/instance zodbverify -f var/filestorage/Data.fs -o &lt;oid&gt; -D\n-</pre>\n-<p>Then you can use your debugging skills to try and fix things.\n-Note that after you fixed it, you need to commit the changes explicitly:</p>\n-<pre class="literal-block">\n-import transaction\n-transaction.commit()\n-</pre>\n-<p>Note that the bad object is still in the database, until you pack it.</p>\n-<p>Frequent culprits are IntIds and Relations, especially if you migrated from Archetypes to Dexterity.\n-Using <a class="reference" href="https://github.com/collective/collective.relationhelpers/blob/master/src/collective/relationhelpers/api.py">collective.relationhelpers</a> you can clean this up:</p>\n-<pre class="literal-block">\n-from collective.relationhelpers.api import cleanup_intids\n-from collective.relationhelpers.api import purge_relations\n-from collective.relationhelpers.api import restore_relations\n-from collective.relationhelpers.api import store_relations\n-# store all relations in a annotation on the portal\n-store_relations()\n-# empty the relation-catalog\n-purge_relations()\n-# remove all relationvalues and refs to broken objects from intid\n-cleanup_intids()\n-# recreate all relations from a annotation on the portal\n-restore_relations()\n-</pre>\n-</div>\n-<div class="section" id="symptom-6-bad-code">\n-<h3><a name="symptom-6-bad-code">Symptom 6: bad code</a></h3>\n-<p>Unreadable, untested, unused, undocumented, unmaintained, complicated, overly complex, too much code.\n-If you can convince a client to <em>not</em> want a feature because they will only use it once, that is a win.\n-Every line of code that is <em>not</em> written, is a good line of code.</p>\n-</div>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-11T17:08:38+00:00</published>\n-\n-      <updated>2021-01-05T10:33:42+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Maik Derstappen: Plone 6 Theming with Diazo</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/maik-derstappen-plone-6-theming-with-diazo" />\n-\n-\n-\n-      <id>urn:syndication:3ba6d872864981f8695780e8de6d246f</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>How does Plone theming look in classic UI?</p>\n-<ul class="simple">\n-<li>html5 theme plus a mapping configuration</li>\n-<li>deploying themes as ZIP-file for shared hosting is possible</li>\n-<li>With Diazo you can map any Plone html to a static theme layout.</li>\n-</ul>\n-<p>Separating frontend and backend theme.\n-Don\'t reinvent the backend views!\n-You could theme the backend, so for content editors and admins, but it looks fine, not needed.\n-You should focus on the frontend layout for visitors.\n-To use the default backend layout you can include <tt class="docutils literal"><span class="pre">backend.xml</span></tt> in your rules, with some conditions.</p>\n-<p>Diazo is not for everything!\n-If the backend markup differs from what you need, do not try to solve it with Diazo or XSLT.\n-Instead, fix the backend templates directly, most likely with a <tt class="docutils literal"><span class="pre">z3c.jbot</span></tt> override.</p>\n-<p>You can use <a class="reference" href="https://github.com/collective/collective.themefragments/">theme fragments</a> or browser views to add new templates.\n-The theme fragments can also be used as tiles in Mosaic.</p>\n-<p>I like using SASS mixins.\n-Say you have a <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;main-wrapper</span> <span class="pre">container&quot;&gt;</span></tt>.\n-Cleaner would be <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;main-wrapper&quot;&gt;</span></tt>.\n-You can do this with mixins with <tt class="docutils literal"><span class="pre">&#64;include</span></tt> in your selector.</p>\n-<p>For more information on Diazo, see <a class="reference" href="https://diazo.org">https://diazo.org</a>.</p>\n-<div class="section" id="new-features-in-plone-6">\n-<h3><a name="new-features-in-plone-6">New features in Plone 6</a></h3>\n-<p>From the backend we get Bootstrap 5 compatible html.\n-Result is that Bootstrap themes are easier to integrate in Plone 6.</p>\n-<p>You have custom CSS in the theming control panel, for small changes.\n-This actually sneaked into Plone 5.2.2 as well.</p>\n-<p>We have simplified Diazo rules.</p>\n-<p>Create a theme with plonecli:</p>\n-<ul class="simple">\n-<li>pip install plonecli</li>\n-<li>plonecli create addon plonetheme.yourtheme</li>\n-<li>cd plonetheme.yourtheme</li>\n-<li>plonecli add theme</li>\n-<li>plonecli build</li>\n-</ul>\n-<p>Theme from this presentation will be published as <a class="reference" href="https://github.com/collective/collective.bunapisicuto">collective.bunapisicuto</a> when it is ready for you to inspect.</p>\n-</div>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-10T22:16:11+00:00</published>\n-\n-      <updated>2020-12-10T22:16:11+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Stefan Antonelli: Plone 6 Theming from Scratch</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/stefan-antonelli-plone-6-theming-from-scratch" />\n-\n-\n-\n-      <id>urn:syndication:d1f0f9b0e055800492dbadd973f3290e</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>How to create a theme for Plone 6.\n-Quite easy, because the templates use Bootstrap 5 classes.\n-We build a theme from scratch, no Barceloneta, no Diazo.</p>\n-<p>First step is to create an empty plone_addon package with <tt class="docutils literal"><span class="pre">plonecli</span></tt> or <tt class="docutils literal"><span class="pre">mr.bob</span></tt>.\n-For the questions you can answer: use Plone 5.2.1. We will switch later.\n-My theme is <a class="reference" href="https://github.com/collective/plonetheme.munich">plonetheme.munich</a>.</p>\n-<p>I recommend to cleanup the standard package a bit.\n-I remove tests, constraints for Plone 4 and 5.\n-Check it out in the commits.</p>\n-<p>Now switch to <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/buildout.cfg">extend Plone 6</a> and run the buildout.</p>\n-<p>You can add theme structure with a bob template, but I prefer creating my own.</p>\n-<p>Some interesting files:</p>\n-<ul class="simple">\n-<li><a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/package.json">package.json</a> lists various tasks, especially the <tt class="docutils literal"><span class="pre">watch</span></tt> task.</li>\n-<li>In the theme <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/src/plonetheme/munich/theme/manifest.cfg">manifest.cfg</a> we more or less disable Diazo by emptying the <tt class="docutils literal"><span class="pre">rules</span></tt> line.</li>\n-<li>The compiled CSS and JavaScript are registered in <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/src/plonetheme/munich/profiles/default/registry/main.xml">registry.xml</a>.</li>\n-</ul>\n-<p>You can compile SASS to CSS using npm or yarn.\n-Do <tt class="docutils literal"><span class="pre">yarn</span> <span class="pre">install</span></tt> in the top of your package.\n-Later, with <tt class="docutils literal"><span class="pre">yarn</span> <span class="pre">dist</span></tt> you make it ready for production.</p>\n-<p>After these steps Plone is partially broken, or at least ugly.\n-I do some <a class="reference" href="https://github.com/collective/plonetheme.munich/commit/000717fb336849facec17b8fbd7b75686ec6146b">basic fixes</a> and it looks better.</p>\n-<p>For templates that you need to change you add <tt class="docutils literal"><span class="pre">z3c.jbot</span></tt> overrides.\n-Personally I always kick out the &quot;search in section&quot; checkbox.</p>\n-<p>I don\'t like columns, but for this example I kept them.\n-In most cases I need just one column.\n-Plus maybe a side bar for portlets, but portlets must die.</p>\n-<p>With <tt class="docutils literal"><span class="pre">plonetheme.tokyo</span></tt> everything is Bootstrap, no columns, so no portlets, really fully responsive.\n-This was the package where we built on Barceloneta Plone 5.2 and introduced lots of template overrides to put in Bootstrap.\n-For Plone 6 we can just remove the overrides.</p>\n-<p>What about the toolbar? Yes, we dropped it.\n-We bring editing features and navigation together.\n-This is now a few feature: <a class="reference" href="https://github.com/collective/collective.sidebar">collective.sidebar</a>.\n-It is only one template to override.\n-It works for Plone 5.2 at the moment, and I may work on it for Plone 6 during the sprints.</p>\n-<p>Question: is TTW still a viable path?</p>\n-<p>Answer: I like to concentrate on one path.\n-I am not an expert in TTW theming.\n-I switched to file system, except really small customizations.\n-For small CSS customizations there is a field in the theming control panel.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-10T17:08:30+00:00</published>\n-\n-      <updated>2020-12-10T17:08:30+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Stefan Antonelli and Peter Holzer: Modernize Plone\xe2\x80\x99s Classic UI</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/stefan-antonelli-and-peter-holzer-modernize-plone2019s-classic-ui" />\n-\n-\n-\n-      <id>urn:syndication:468faba6197c93edadf910d668dac1c1</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>What was new in Plone 5?\n-We had beautiful new theme: Barceloneta.\n-Diazo theming by default.\n-We switched to CSS compilation with <tt class="docutils literal"><span class="pre">less</span></tt>.</p>\n-<p>During the Tokyo conference Stefan thought up Tokyo Theme.\n-Clean responsive theme for Plone 5.\n-Tons of overrides to tackle problems in Plone 5.\n-Issue with navigation and editing on mobile we solved with collective.sidebar.</p>\n-<p>We had community discussions, especially during several Plone events.\n-Everyone tried to use Bootstrap (components).\n-First idea: map variables from Barceloneta to Bootstrap, because they have similar ideas using different terms.</p>\n-<p>We have PLIP to modernize markup in templates, and another PLIP to modernize the default theme: Barceloneta LTS.\n-Forms using z3c.form are already using the new classes.</p>\n-<p>Make things easier: UI, development.\n-Creating a modern UI for the web is complex.\n-You need to support different devices, responsiveness.\n-In Bootstrap there are patterns for most useful things.</p>\n-<p>Developer perspective: expect one way to do things.\n-Developers should not have to worry about design.\n-When busy in the backend, you should focus on Python, not on it looking nice and shiny.\n-Don\'t think about markup, just use components.\n-The good news: there is documentation. The Bootstrap documentation is our documentation.</p>\n-<p>What is new in Plone 6?</p>\n-<ul class="simple">\n-<li>Volto is the default UI.</li>\n-<li>There still is the Classic UI with Barceloneta look and feel, but updated.</li>\n-<li>No TTW (through the web) theming.</li>\n-<li>But there is a textarea to add some simple CSS (already in 5.2.3).</li>\n-<li>Some CSS variables may be changeable TTW.</li>\n-<li>Finally jQuery 3</li>\n-</ul>\n-<p>Bootstrap is still the most popular front-end framework.\n-Well documented, tested and maintained.\n-It is so easy to create stuff, I enjoy it a lot.</p>\n-<p>What is new in Bootstrap 5?</p>\n-<ul class="simple">\n-<li>Improved overall look and feel.</li>\n-<li>Updated and extended the color system</li>\n-<li>Custom properties: css variables</li>\n-<li>SVG Icon library</li>\n-<li>Pure javascript</li>\n-<li>Dropped IE10 and IE11 support</li>\n-<li>Bootstrap 5 is currently alpha 3.</li>\n-<li>See <a class="reference" href="https://v5.getbootstrap.com">https://v5.getbootstrap.com</a></li>\n-</ul>\n-<p>Features: what do we get from these changes?</p>\n-<ul class="simple">\n-<li>Core templates use Bootstrap 5 markup. Instead of overrides in <tt class="docutils literal"><span class="pre">plonetheme.tokyo</span></tt>, we have lots of branches for the actual packages.</li>\n-<li>All major templates have been touched already.</li>\n-<li>For the current state, see the unofficial demo at <a class="reference" href="https://classic.plone.de">https://classic.plone.de</a></li>\n-<li>The <a class="reference" href="https://getbootstrap.com/docs/5.0/getting-started/introduction/">Bootstrap documentation</a> has lots of snippets than you can copy.</li>\n-<li>You don\'t need much more CSS on top of it if you paste most examples. We added a little for own components, like navigation.</li>\n-</ul>\n-<p>Barceloneta appearance is fully customizable.\n-It is basically on opinionated set of bootstrap variables.\n-Every aspect can be changed with variables: colors, fonts, sizes, spacings, grid gutters, etc.\n-There are overall properties, like shadowed, rounded, gradients. Just turn on or off.</p>\n-<p>Theming workflow.\n-<tt class="docutils literal"><span class="pre">plonetheme.barceloneta</span></tt> will also be published as <tt class="docutils literal"><span class="pre">npm</span></tt> package.\n-<tt class="docutils literal"><span class="pre">bobtemplates.plone</span></tt> will have a template for the new theming workflow.\n-You can do quick and dirty customizations through the CSS overrides field in the theme controlpanel.</p>\n-<p>Diazo will still be there, will work as before.\n-Some optimizations in the <tt class="docutils literal"><span class="pre">rules.xml</span></tt> to make content are customizations easier.</p>\n-<p>How to deal with icons?\n-What if you want to change the content type icons? Used to be hard.\n-Now we come up with the idea of an icon resolver.\n-We decided to use the <a class="reference" href="https://icons.getbootstrap.com">bootstrap icons</a>.\n-Icons are registered via GenericSetup, for example with a record name <tt class="docutils literal"><span class="pre">plone.icon.alarm</span></tt> pointing to an SVG.\n-You can then override this in your own GS profile.</p>\n-<p>Example icon use:</p>\n-<pre class="literal-block">\n-&lt;tal:icon replace=&quot;structure python:icons.tag(\'love\', tag_class=\'custom-class\', tag_alt=\'foobar\')&quot; /&gt;\n-</pre>\n-<p>You get get back an inline SVG or an image tag.</p>\n-<p>Note: all z3c form widgets in Plone are now in <tt class="docutils literal"><span class="pre">plone.app.z3cform</span></tt>, and not scattered over lots of packages.</p>\n-<p>We will restart our weekly Plone 6 Classic UI sprints, starting Januari 13 2021, 10:00 (UTC+1).</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-10T16:02:29+00:00</published>\n-\n-      <updated>2020-12-10T16:02:29+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Keynote: The User Experience - Editing Composite Pages in Plone 6 and Beyond</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/keynote-the-user-experience-editing-composite-pages-in-plone-6-and-beyond" />\n-\n-\n-\n-      <id>urn:syndication:e244a1928902dfa6b7ea77347437d2d9</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>It may be a surprise to non-technical people to learn that pages created in Volto are not currently interoperable with traditional Plone\'s page editing. If you think about it, the reason becomes obvious. Volto, like Mosaic, creates tiled layouts, and like Mosaic it stores page data in special fields for the individual blocks and their layout. Neither Volto nor Mosaic pages are editable in TinyMCE, which expects just one rich text field.</p>\n-<p>Is this divergence between sites created in Volto and sites created in traditional Plone a problem? It does make it harder to describe what Plone is, and it might mean that there is no way to mix both approaches - for instance when part of a larger site is available as a Volto-based sub-site. Would it be possible to have one tool and one representation for tiled layouts so that we can avoid this divergence? Is there some other solution? Is it even a problem? Will Plone 6 be backwards compatible with Plone 5 and include a smooth upgrade path?</p>\n-<p>We will tackle these questions in this strategic panel discussion, moderated by Sally Kleinfeldt. Panelists will include Paul Roeland, Philip Bauer, Timo Stollenwerk, Victor Fernandez de Alba, and Eric Steele.</p>\n-<p>First, Philip has a message from Max Jacob who is very ill with pancreatic cancer and may not survive this weekend. He wants to thank the Plone community for what they allowed him to do: like organize the German Plone Konferenz. Thanks for all the friendships. Such a pity that this is happening now, he wanted to jump into only doing Plone for the next few years, due to changes at his job, and looked forward to that.</p>\n-<div class="section" id="classic-mosaic-and-volto-pages">\n-<h3><a name="classic-mosaic-and-volto-pages">Classic, Mosaic and Volto Pages</a></h3>\n-<p>We have Classic, Mosaic and Volto Pages. They have different internal representations and are not compatible.\n-Is this a problem? Is there a solution?\n-Is one tool, one representation possible?\n-If we really need three, how to position?</p>\n-<p>Paul: for me as user this presents a problem. When do you switch over your site?\n-We would like to not write 700 pages from scratch, again, like we did for previous composite pages.</p>\n-<p>Timo: We migrated quite a few large projects from classic Plone to Volto.\n-One of those had collective.cover (other composite page system).\n-Problem in general with such systems, is that they are pretty specific.\n-They solve specific use cases and come from different eras.\n-After any migration, it will not look the same any more.\n-Whatever you do: the page will initially look ugly.\n-So you put a lot of effort into migration, but then have to put manual effort into every page anyway.\n-It <em>can</em> help: you at least have a start.\n-We created a system where we migrated overview pages, and editors could click to migrate other pages one at a time.</p>\n-<p>Philip: We have code to migrate from non-folderish to folderish content types.\n-There will be code to migrate to dexterity site root on Plone 6.\n-We <em>can</em> make sure to migrate any standard content types.\n-Mosaic is another story.\n-So for pages you would at least have the text available. Maybe only visible for editors to pick and choose from.\n-You may lose portlets, unless they get implemented in Volto.</p>\n-<p>Timo: When you go to Plone 6 and do a redesign at the same time, then you can jump on Volto.\n-Otherwise you could stay at Classic Plone for now.\n-There will be an overlap period.</p>\n-<p>Victor: For Mosaic you could dump all tiles into html and insert it in a block.</p>\n-</div>\n-<div class="section" id="how-to-have-a-big-classic-site-with-a-subsite-made-in-volto">\n-<h3><a name="how-to-have-a-big-classic-site-with-a-subsite-made-in-volto">How to have a big Classic site with a subsite made in Volto?</a></h3>\n-<p>Victor: Definitely doable, though we have not done this ourselves.</p>\n-<p>Sally: But what happens when an editor in Classic goes to the Volto subsite? The Volto page would not be editable then, right?</p>\n-<p>Philip: You should not offer this. I see no upside, no use case.\n-Split them into separate applications, with shared authentication maybe.</p>\n-<p>Paul: Use case: large site with several departments.\n-The marketing department may want snazzy new Volto things.</p>\n-<p>Timo: Just create another site then.</p>\n-</div>\n-<div class="section" id="cost-and-benefit-of-upgrading-big-classic-site-to-plone-6">\n-<h3><a name="cost-and-benefit-of-upgrading-big-classic-site-to-plone-6">Cost and benefit of upgrading big Classic Site to Plone 6</a></h3>\n-<p>So you just had a big migration to Plone5, and now what would you get for going to Plone 6.</p>\n-<p>Philip: We have this discussion every major upgrade.\n-Communicate every upgrade as a relaunch.\n-The relaunch is the reason for the upgrade.\n-&quot;There is a new version so you need to upgrade&quot; does not fly for my clients.</p>\n-<p>Timo: We became a very developer oriented community, and every develop understands the need and benefits.\n-We should really get back to giving more value at major releases, so clients really want to upgrade themselves.\n-Plone releases should sell themselves.</p>\n-<p>Eric: It looks like we think Plone 6 + Volto is a costly upgrade with lots of benefits.\n-For Classic 5 to Classic 6 the upgrade is not costly.</p>\n-</div>\n-<div class="section" id="alex-limi-s-vision-for-deco-are-we-there-yet">\n-<h3><a name="alex-limi-s-vision-for-deco-are-we-there-yet">Alex Limi\'s vision for Deco: are we there yet?</a></h3>\n-<p>Was this fulfilled by Mosaic? Volto? Something still needed?</p>\n-<p>Paul: Not quite, but slowly getting there.\n-For me it would be Volto, plus some power features that Eau de Web (EEA) adds.</p>\n-<p>Timo: I think we went beyond what Limi envisioned.</p>\n-<p>Eric and Victor: What we have seen from Volto, is pretty close to what Alex wanted.</p>\n-<p>Victor: We gave the users powerful tools, so beware of them.</p>\n-<p>Philip: Partly yes. Volto is close, and it is for normal users.</p>\n-<p>Now some questions from users.</p>\n-</div>\n-<div class="section" id="is-there-a-plan-for-volto-to-support-editing-the-existing-richtext-fields-of-documents-news-items">\n-<h3><a name="is-there-a-plan-for-volto-to-support-editing-the-existing-richtext-fields-of-documents-news-items">Is there a plan for Volto to support editing the existing Richtext fields of Documents, News Items?</a></h3>\n-<p>Philip: This should be doable.</p>\n-</div>\n-<div class="section" id="migrations">\n-<h3><a name="migrations">Migrations</a></h3>\n-<p>Philip: Plone 4 to 5.2 was three migrations in one.\n-Plone 6 is less of a problem.</p>\n-<p>Eric: 5.2 had a lot of backend migrations.\n-A split between backend and frontend with plone.restapi in between makes things easier.</p>\n-<p>[The question on multiple variations of Volto, especially editors, went a bit too fast for me to write intelligible notes down.]</p>\n-</div>\n-<div class="section" id="what-s-the-future-of-using-ct-s-behaviors-in-plone-to-design-information-architecture">\n-<h3><a name="what-s-the-future-of-using-ct-s-behaviors-in-plone-to-design-information-architecture">What\'s the future of using CT\'s/behaviors in Plone to design information architecture?</a></h3>\n-<blockquote>\n-With Volto the trend seems mixing/adding 40 different blocks for every page.</blockquote>\n-<p>Timo: Blocks are definitely the way to work.\n-But the underlying power of content types and behaviors still exists.</p>\n-<p>Philip: We need blocks that represent a field or a behavior. That is unavoidable.</p>\n-</div>\n-<div class="section" id="next-steps">\n-<h3><a name="next-steps">Next steps</a></h3>\n-<p>Timo: We plan to have an open space on page compositions and Volto, and want to sprint on it.</p>\n-<p>Paul: Good if there is a longer term vision.\n-I would rather have more power that a Site Admin can lock down, than having to choose between three different versions.\n-I don\'t want choice stress.</p>\n-</div>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-10T14:55:55+00:00</published>\n-\n-      <updated>2020-12-10T14:55:55+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Lightning Talks Wednesday</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/lightning-talks-wednesday" />\n-\n-\n-\n-      <id>urn:syndication:c478decef0cbf87b0b04ae96599134b3</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <div class="section" id="lukas-guziel-continuous-deployment">\n-<h3><a name="lukas-guziel-continuous-deployment">Lukas Guziel: Continuous Deployment</a></h3>\n-<p>CD means deploying code automatically.\n-It saves time, reduces human error.\n-It Gitlab you can add <tt class="docutils literal"><span class="pre">gitlib-ci.yml</span></tt> and configure it.\n-Include a base template that you use in multiple projects.\n-End result can be a site that the customer can test.</p>\n-</div>\n-<div class="section" id="erico-andrei-world-plone-day-2021">\n-<h3><a name="erico-andrei-world-plone-day-2021">Erico Andrei: World Plone Day 2021</a></h3>\n-<p>We are a global community.\n-Almost 300 people from 36 countries are at this online conference.\n-World Plone Day is an annual Plone event.\n-Next year of course online. April 28th 2021.</p>\n-<p>We want to stream 24 hours live on our YouTube channel.\n-Showcase Plone. Technical talk, use cases, interviews, demo.</p>\n-<p>It should not all be in English, please use your own language.\n-Talk to your local community.</p>\n-<p>Please help and join. See <a class="reference" href="https://plone.org/events/wpd">https://plone.org/events/wpd</a></p>\n-</div>\n-<div class="section" id="andreas-jung-collective-contentsync2">\n-<h3><a name="andreas-jung-collective-contentsync2">Andreas Jung: collective.contentsync2</a></h3>\n-<p>Syncing content between Plone sites through <tt class="docutils literal"><span class="pre">plone.restapi</span></tt>.\n-It is a behavior.\n-You have a source Plone site and one or more target Plone sites.\n-You need Plone 5.2 under Python 3.</p>\n-<ul class="simple">\n-<li>Create a dedicated user account with global role Editor.</li>\n-<li>Configure on the content sync control panel.</li>\n-<li>Automatically creates two content rules to sync content when added or modified.</li>\n-<li>You can enable it on all content types, also Folders.</li>\n-</ul>\n-<p>See <a class="reference" href="https://github.com/collective/collective.contentsync2">https://github.com/collective/collective.contentsync2</a></p>\n-</div>\n-<div class="section" id="philip-bauer-why-relations-are-weird">\n-<h3><a name="philip-bauer-why-relations-are-weird">Philip Bauer: Why relations are weird</a></h3>\n-<p>These packages have a part in relations:</p>\n-<ul class="simple">\n-<li>zc.relation: abstract relation catalog</li>\n-<li>z3c.relationfield: fields and values on objects</li>\n-<li>plone.app.relationfield: converters from field to widget and vv</li>\n-<li>plone.app.z3cform: widgets</li>\n-<li>mockup: actual widget UI</li>\n-</ul>\n-<p>In a schema use a RelationChoice field with vocabulary plone.app.vocabularies.Catalog, and set pattern directives.</p>\n-<p>It is not straightforward.\n-So I wrote <tt class="docutils literal"><span class="pre">collective.relationhelpers</span></tt>.</p>\n-<p>See <a class="reference" href="https://github.com/collective/collective.relationhelpers">https://github.com/collective/collective.relationhelpers</a></p>\n-<p>Maybe use uuid instead of all this code.</p>\n-<p>[About ten people in the chat want to merge this package into plone.api. Actually, see <a class="reference" href="https://github.com/plone/plone.api/issues/223">this issue</a>.]</p>\n-</div>\n-<div class="section" id="christopher-lozinski-simple-json-schema-guis">\n-<h3><a name="christopher-lozinski-simple-json-schema-guis">Christopher Lozinski: Simple JSON Schema GUIs</a></h3>\n-<p>Create a JSON schema, automatically generate the UI.\n-Search for basic JSON editor library.\n-He shows JSON in ZODB, so you can browse it, if I understood correctly.\xf0\x9f\x99\x82</p>\n-</div>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-09T18:21:14+00:00</published>\n-\n-      <updated>2020-12-09T18:21:14+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Eric Brehault: Second Guessing the Single-Page-App Pattern</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/eric-brehault-second-guessing-the-single-page-app-pattern" />\n-\n-\n-\n-      <id>urn:syndication:8b678f3acfa36bff175e085791de850d</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>SPA (Single Page App) is about providing an entire app by exposing a single physical web page containing an enormous javascript bundle. It breaks the original web paradigm in many ways. Surprisingly enough, we invest a lot of efforts to mimic the regular web behaviour.</p>\n-<p>Isn\xe2\x80\x99t it time for modern frontend to reconsider the SPA approach?</p>\n-<p>[Note: Eric presented by using a projector to show his slides on a black Plone conference T-shirt. :-)]</p>\n-<p>Why are we doing this? Originally we always requested a whole page and this was considered slow. But we have good bandwidth now. And if you don\'t have good bandwidth, the super big bundle is not good either.</p>\n-<p>With SPA we try very hard to bring back the original working of the page, especially the browser history, being able to browse and then share the link to the current page.</p>\n-<p>To mitigate problems, we created an enormous stack. And we deny the complexity.  New tools create new problems, even when their individual creators does not see the complexity.</p>\n-<p>&quot;SPA isn\'t stable or efficient.&quot;\n-But there is no way back. For example, you cannot create Google Docs  with server side rendered pages.\n-Web 2.0 is 15 years old. It is still about content.</p>\n-<p>SPA is separation of concern, which is a good principle. But we mix the browser layer (how you get and view the page) and the content layer (the page content).</p>\n-<p>It seems a take it or leave it situation: either use SPA or don\'t. What do we want? We want proportionate complexity. Do we need 100 percent SPA?</p>\n-<p>You can use micro components, see for example the demo of Maik Derstappen in the lightning talks on Monday, using Svelte.\n-Micro frontend is bigger than that.  It is a part of the application, that you develop separately. For example, you could do the Plone Sharing page like this.</p>\n-<p>Can we compile each page separately? Then each page is an app.</p>\n-<p>ES6 native support would be interesting. Combine with HTTP/2 and you need no bundles.\n-Bundling is the most brutal thing ever. Horrible. Get rid of it.</p>\n-<p>Respect the layers. SPAs are monolithic. Break them down.</p>\n-<p>We should have a generic browser layer, common to many different use cases, for example for logging in.\n-I don\'t want to code that, but plug it. Second step: push this layer to the browsers themselves.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-09T17:41:59+00:00</published>\n-\n-      <updated>2020-12-09T17:42:16+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Asko Soukka: Deploying Plone and Volto, the Hard Way</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/asko-soukka-deploying-plone-and-volto-the-hard-way" />\n-\n-\n-\n-      <id>urn:syndication:7d213d4114be2f1ef8ed20a2e1983ed3</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>Here are the <a class="reference" href="https://datakurre.github.io/ploneconf2020/deploying-plone-and-volto-hard-way.pdf">slides</a>.</p>\n-<p>How about building Plone without buildout? Running Plone on Python 3 without WSGI? Deploying Plone and Volto with containers without Docker? Building all this in re-usable and safe manner in sandbox with restricted network access with Nix? Welcome to hear about our hipster setup where we lock, build and configure Plone deployments with Nix, insist to keep ZServer running on Python 3 for the love\'s sake, build software deployments into standalone tarball archives, and run them with Nomad \xe2\x80\x93 the simple on-premises-friendly alternative for K8S.</p>\n-<ul class="simple">\n-<li>The easy, documented way: buildout, WSGI, Docker (if you need containers), Registry.</li>\n-<li>Our way: pip, TxZServer, Nomad, Nix</li>\n-</ul>\n-<p>When you use a container infrastructure, you have multiple containers for running a Plone site, for example zeo clients, zeo servers, load balancer. Nomad helps there, and is much simpler than Kubernetes.\n-We have one job file to rule them all: task groups, instance count, update policy, server resources, volumen mounts, tasks, consul services, vault secrets, environment variables, exec artifacts.</p>\n-<p>Nomad has &quot;isolated fork / exec driver&quot;. No docker image needed. We have a Nix-built artifact, a tarball that we extract in the root of the container.</p>\n-<p>With Nix, you get 100 percent reproducible artifacts. Production equals development. You have a full dependency graph. The result is a standalone tarball, perhaps 100 MB. Disadvantage is that there are no conventions, no metadata, no shared layers, no documentation. It needs learning and practice. Well, some documentation now: <a class="reference" href="https://nixos.org">https://nixos.org</a> and <a class="reference" href="https://nix.dev">https://nix.dev</a>, partially made by people that were using Plone previously.</p>\n-<p>Some ugly parts from Nix:</p>\n-<ul class="simple">\n-<li>Every language has their own Nix-conventions</li>\n-<li>dependency generator ecosystem is comples</li>\n-<li>cyclic dependencies are not supported</li>\n-<li>no storage device is big enough for <tt class="docutils literal"><span class="pre">/nix/store</span></tt></li>\n-</ul>\n-<p>Our (legacy) approach for Plone 5.2.1 without Buildout and with pip:</p>\n-<ul class="simple">\n-<li>generated requirements.txt with buildout</li>\n-<li>create Python env with pip and nix</li>\n-<li>use pip-branch of z3c.autoinclude</li>\n-<li>disabled <tt class="docutils literal"><span class="pre">&lt;includeDependencies</span> <span class="pre">/&gt;</span></tt></li>\n-<li>generate instance skeleton with nix</li>\n-<li>forked plone.recipe.zope2instance</li>\n-</ul>\n-<p>Plone 6 without Buildout should be pip-installable out of the box, but that is hear-say.</p>\n-<p>We use TxZServer in production, so ZServer using Twisted.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-09T16:22:15+00:00</published>\n-\n-      <updated>2020-12-09T16:22:15+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Nicola Zambello: Theming Volto without SemanticUI: Is It Possible?</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/nicola-zambello-theming-volto-without-semanticui-is-it-possible" />\n-\n-\n-\n-      <id>urn:syndication:d96309ed215a2fec3c67f7f3e4d97885</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>We will walk through the process of building a product for Italian Public Administrations using a bootstrap-based theme.\n-I\'m presenting io-comune, RedTurtle\'s first product based on Volto and the strategies we used.\n-We will see the possibilities in Volto for theming without SemanticUI, using bootstrap and sass and what are the next ideas we could work on.</p>\n-<p>Scenario:</p>\n-<ul class="simple">\n-<li>We wanted to adopt Volto in our new project.</li>\n-<li>We needed to include Bootstrap.</li>\n-<li>Volto uses SemanticUI instead.</li>\n-<li>Two such frameworks will conflict, for example fighting over the same selector.</li>\n-</ul>\n-<p>We tried. We tried harder.\n-A cheap approach did not seem possible, so we looked for a sane one.</p>\n-<p>A new theme: <tt class="docutils literal"><span class="pre">pastanaga-cms-ui</span></tt>. Load only the CSS needed for Volto admin UI, see <a class="reference" href="https://github.com/plone/volto/pull/970">Volto PR 970</a>.\n-And <tt class="docutils literal"><span class="pre">public-ui</span></tt> for public pages.\n-In your <tt class="docutils literal"><span class="pre">src/theme.js</span></tt> do not import the css/less from semantic-ui, but the <tt class="docutils literal"><span class="pre">pastanaga-cms-ui</span></tt>.\n-In theme theme.config also use pastanaga-cms-ui.\n-Also razzle-config.</p>\n-<p>You should normalize your base style, for example:</p>\n-<pre class="literal-block">\n-body.cms-ui {\n-  .public-ui {\n-    font-size: 18px;\n-  }\n-}\n-</pre>\n-<p>and wrap your components with <tt class="docutils literal"><span class="pre">.public-ui</span></tt>.</p>\n-<p>Building a product:</p>\n-<ul class="simple">\n-<li>Base common package for every customer: <a class="reference" href="https://github.com/RedTurtle/design-volto-theme">https://github.com/RedTurtle/design-volto-theme</a></li>\n-<li>New intermediate layer for SemanticUI</li>\n-<li>New config layer for razzle/customizations</li>\n-<li>Template for actual projects: <tt class="docutils literal"><span class="pre">design-volto-kit</span></tt>, with a Yeoman generator: <tt class="docutils literal"><span class="pre">create-italia-volto-app</span></tt></li>\n-</ul>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-09T14:22:41+00:00</published>\n-\n-      <updated>2020-12-09T14:22:41+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Alin Voinea: Volto Dexterity Schema and Layout Editor</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/alin-voinea-volto-dexterity-schema-and-layout-editor" />\n-\n-\n-\n-      <id>urn:syndication:e78a4c57d7c28e52be32a25b83f7c466</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>Through the Web Dexterity Content-Types with Schema Editor and Blocks Layout Editor</p>\n-<p>How do we define content types schemas in Plone?</p>\n-<ul class="simple">\n-<li>TTW schema editor</li>\n-<li>GenericSetup profile</li>\n-<li>Behaviors, schemas in Python</li>\n-</ul>\n-<p>Why do we need them, we have Volto blocks, right?\n-You still need metadata, a title, etcetera. Certainly for larger institutions you need a structure, a schema.\n-Volto itself has schema-based components.</p>\n-<p>Layout editor.\n-Blocks have properties, like a placeholder, a position.\n-You can type text in a block: &quot;Published on date by author&quot;.\n-Then select &quot;date&quot; and link this text to the published date metadata,\n-and select &quot;author&quot; and link it to the author.\n-Save this as a layout for a content type.\n-You can export this to a JSONField in a custom behavior, so you can save it in version control for production.</p>\n-<p>List of add-ons and other packages that make Volto awesome:\n-<a class="reference" href="https://github.com/collective/awesome-volto">https://github.com/collective/awesome-volto</a></p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-08T17:40:59+00:00</published>\n-\n-      <updated>2020-12-08T17:40:59+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Jens Klein: Performance, Profiling, Power-Consumption</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/jens-klein-performance-profiling-power-consumption" />\n-\n-\n-\n-      <id>urn:syndication:8c53225f93c004d147e18d907160144d</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>I want to focus on Python performance, so not caching or database performance.</p>\n-<p>Tools:</p>\n-<ul class="simple">\n-<li><tt class="docutils literal"><span class="pre">py-spy</span></tt>: Overall mix of the whole live application, top-like.</li>\n-<li><tt class="docutils literal"><span class="pre">repoze.profile</span></tt>: WSGI middleware, slows down application. Profile single request and analyse its call stack by count, call time, etc.</li>\n-<li><tt class="docutils literal"><span class="pre">dis</span></tt>: disassembler for Python at the bytecode level.</li>\n-</ul>\n-<p>Improvements Plone 5.2.0-5.2.3:</p>\n-<ul class="simple">\n-<li>Avoided early <tt class="docutils literal"><span class="pre">providedBy</span></tt> calls</li>\n-<li><tt class="docutils literal"><span class="pre">__getattr__</span></tt> early exit on common attributes</li>\n-<li><tt class="docutils literal"><span class="pre">zope.interface</span></tt>: some functions are called hundreds of thousands of times when you reindex an index, so a tiny improvement helps a lot. I found various places that could use improvements, and that landed in the package, together with memory improvements by Jason Madden.</li>\n-</ul>\n-<p>Live demo. I call <tt class="docutils literal"><span class="pre">py-spy</span></tt> with <tt class="docutils literal"><span class="pre">sudo</span></tt> because I need to connect to an existing process id.</p>\n-<p>Future Todo\'s:</p>\n-<ul class="simple">\n-<li><tt class="docutils literal"><span class="pre">plone.restapi</span></tt> has optimization potential, all navigation related, but currently it still supports even Plone 4.3. This will likely wait for a 5.2-only or Python3-only branch.</li>\n-<li><tt class="docutils literal"><span class="pre">plone.registry</span></tt> is called too often</li>\n-<li>Use <tt class="docutils literal"><span class="pre">python:</span></tt> expressions in all page templates. They are way faster than standard Tales expressions.</li>\n-<li>More introspection.</li>\n-<li>Move more logic from page templates to Python code</li>\n-</ul>\n-<p>Advice: start introspecting the performance of your application.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-08T16:27:53+00:00</published>\n-\n-      <updated>2020-12-08T16:27:53+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Alex Clark: The State of Pillow</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/alex-clark-the-state-of-pillow" />\n-\n-\n-\n-      <id>urn:syndication:e34819d893c83228742eda41c42063d6</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>The Plone Conference account tweeted that a State of Plone talk would be awesome and that the Plone community missed me. I miss the Plone community too, so I am here.</p>\n-<p>I will state it clearly: Pillow would not exist if not for Plone.</p>\n-<p>In July 2010 I announced Pillow as &quot;friendly&quot; fork of PIL. The <a class="reference" href="https://mail.python.org/pipermail/image-sig/2010-July/006423.html">mailing thread</a> and future answers are interesting to read.</p>\n-<p>Some history:</p>\n-<ul class="simple">\n-<li>1991: Python 0.9.1</li>\n-<li>1995: PIL started</li>\n-<li>1998: Zope</li>\n-<li>1999: Zope2</li>\n-<li>2000: Python 2.0 with distutils</li>\n-<li>2001: Plone</li>\n-<li>2005: Buildout</li>\n-<li>2006: I attended my first Plone Conference, in Washington</li>\n-<li>2006: setuptools was born</li>\n-</ul>\n-<p>PIL had an issue, or Plone had an issue with PIL:</p>\n-<ul class="simple">\n-<li>PIL used distutils.</li>\n-<li>Plone 3.2 used Buildout and setuptools</li>\n-<li>PIL was not installable in Buildout and setuptools</li>\n-<li>Specific problem: <tt class="docutils literal"><span class="pre">import</span> <span class="pre">Image</span></tt> could mean the Image module from PIL, or the Image module from Zope.</li>\n-</ul>\n-<p>Various ways of repackaging PIL started, for example <tt class="docutils literal"><span class="pre">PILwoTk</span></tt>. You can still find various PIL derivatives at <a class="reference" href="https://dist.plone.org/thirdparty/">https://dist.plone.org/thirdparty/</a></p>\n-<p>PIL 1.1.6 from 2006 is still the last version on <a class="reference" href="https://pypi.org/project/PIL/#history">PyPI</a>. I got maintainership of this page this year, actually.\n-Pillow 1.0 is basically the same, except that it uses <tt class="docutils literal"><span class="pre">setuptools</span></tt>.\n-This worked in buildout.\n-I was happy.</p>\n-<p>Couple years, nothing really interesting happened.\n-But some contributors came along.\n-Pillow 2.0.0 in March 2013 had Python 3 support.</p>\n-<p>An important milestone in 2015: we added release notes.</p>\n-<p>Release schedule: in the beginning of every quarter.</p>\n-<p>We get some money from Tidelift for maintenance.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-08T16:23:06+00:00</published>\n-\n-      <updated>2020-12-08T16:26:22+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Lightning talks Monday</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/lightning-talks-monday" />\n-\n-\n-\n-      <id>urn:syndication:73d847717e4336392db709c0738ec383</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <div class="section" id="alec-mitchell-wysiwyg-problems-be-gone">\n-<h3><a name="alec-mitchell-wysiwyg-problems-be-gone">Alec Mitchell: WYSIWYG problems be gone</a></h3>\n-<p>A new add-on to vastly* improve your content editing experience.</p>\n-<p>(* size of improvement may vary, no warranty implied. The following is (un)paid free software promotional content)</p>\n-<p>Adding images to a document is so hard! At least nine steps! (Difficulty be exaggerated for marketing purposes).\n-Why can\'t you drop an image in?\n-You can, with our new, super special add-on <a class="reference" href="https://pypi.org/project/kcrw.tinymce-imagedrop/">krcw.tinymce_imagedrop</a>.</p>\n-<p>Can you drop two?\n-Yes!</p>\n-<p>Can you drop more than two?\n-No, because browsers are weird.</p>\n-<p>But it fails gracefully.</p>\n-</div>\n-<div class="section" id="steve-piercy-deform-and-friends">\n-<h3><a name="steve-piercy-deform-and-friends">Steve Piercy: Deform and friends</a></h3>\n-<p>How I learned to stop worrying and love web forms.\n-We must have a good interface, data structure, validation, security.\n-Deform (form library), colander (de/serialization), peppercorn (data structure), bootstrap forms for design.\n-We have a looooong list of widgets.\n-In deform 3.0 we will use bootstrap 5.\n-See <a class="reference" href="https://github.com/pylons/deform">https://github.com/pylons/deform</a></p>\n-</div>\n-<div class="section" id="christopher-lozinski-forest-wiki">\n-<h3><a name="christopher-lozinski-forest-wiki">Christopher Lozinski: Forest Wiki</a></h3>\n-<p>The <a class="reference" href="https://forestwiki.com/">Forest Wiki</a> is a modern version of Zope 2.\n-Biggest difference: it uses Pyramid\'s security and views.\n-Modern JavaScript enabled ZMI: reorder, sort, rename, etc.\n-Both WYSIWYG and MarkDown pages.\n-Advanced types like JSON, CoffeeScript, pug. Pug is the leading template engine for Node.</p>\n-</div>\n-<div class="section" id="jens-klein-relstorage">\n-<h3><a name="jens-klein-relstorage">Jens Klein: RelStorage</a></h3>\n-<p>Plone relational database backend storage.\n-It is a drop-in replacement for FileStorage of ZEO.\n-You can use PostgreSQL, MySQL, Oracle, SQLite.\n-It has been around for about 13 years, grown old, but in recent years development has picked up, driven by Jason Madden, including Python 3 support. It is much more performant.\n-Latest release 3.4.0 is form October 2020.</p>\n-<p>PostgreSQL is the cloud database, kind of industry standard, well supported by all big cloud providers.\n-Easy to install in Docker.</p>\n-<p>Advantages of RelStorage: fast, parallel commits, better concurrency, shorter locks.\n-Optimized per process caching.\n-Blobs in database.\n-Optionally you can use it in history free mode. You lose the Undo functionality, but you don\'t need to pack so often.</p>\n-<p><tt class="docutils literal"><span class="pre">plone.recipe.zope2instance</span></tt> supports it with the <tt class="docutils literal"><span class="pre">rel-storage</span></tt> option.</p>\n-<p>You can use additional client side caches, shared between all threads of a process.</p>\n-<p>With the <tt class="docutils literal"><span class="pre">zodbconvert</span></tt> tool you convert from ZEO to RelStorage, or the other way around, including converting blobs if needed.</p>\n-<p>ZODB keeps old transactions, so packing is needed, even in history free mode. RelStorage has a fast <tt class="docutils literal"><span class="pre">zodbpack</span></tt>.</p>\n-<p>Blobs:</p>\n-<ul>\n-<li><p class="first">RelStorage 3.x is Python 3 only and runs with Plone 5.2+. Here, blobs should be stored in RelStorage.</p>\n-</li>\n-<li><p class="first">RelStorage 2.x is for Plone 5.0, 5.1, and blobs should <a href="#id1" name="id2"><span class="problematic" id="id2">**</span></a>not**&nbsp; be stored in the database, except for Oracle backends, otherwise you should still use a shared blobs filesystem directory.</p>\n-<div class="system-message" id="id1">\n-<p class="system-message-title">System Message: <a name="id1">WARNING/2</a> (<tt class="docutils">&lt;string&gt;</tt>, line 69); <em><a href="#id2">backlink</a></em></p>\n-<p>Inline strong start-string without end-string.</p>\n-</div>\n-</li>\n-</ul>\n-<p>I use RelStorage today for all my live deployments. I have used it since version 1.6 with Plone 4.3 and never had problems. Always blazing fast. Dev/ops and sysadmins love it: it is a standard solution, nothing special, just works.</p>\n-</div>\n-<div class="section" id="maik-derstappen-add-on-catalog-for-plone">\n-<h3><a name="maik-derstappen-add-on-catalog-for-plone">Maik Derstappen: Add-on catalog for Plone</a></h3>\n-<p>We want to bring back an add-on catalog for Plone. You can look on PyPI, but it is hard to find packages.</p>\n-<p>We worked on a tool for this. You can search on named, filter on Plone versions and add-on types.</p>\n-<p>Components:</p>\n-<ul class="simple">\n-<li>The <a class="reference" href="https://github.com/collective/pyf.aggregator">Python Package Filter Aggregator</a> (<tt class="docutils literal"><span class="pre">pyf.aggregator</span></tt>) aggregates the meta information of all Python packages in the PyPI.</li>\n-<li>an <a class="reference" href="https://github.com/collective/pyf.api">api</a> using elasticsearch</li>\n-<li>a <a class="reference" href="https://github.com/collective/pyf-svelte-gui">prototype in Svelte</a></li>\n-</ul>\n-<p>We only aggregate packages that have classifier <tt class="docutils literal"><span class="pre">Plone</span> <span class="pre">::</span> <span class="pre">Framework</span></tt>.\n-We will probably work on this during the sprints and are happy to onboard you.</p>\n-</div>\n-<div class="section" id="david-bain-plone-and-webflow">\n-<h3><a name="david-bain-plone-and-webflow">David Bain: Plone and Webflow</a></h3>\n-<p>Both platforms are for building websites, but they approach things in different ways.\n-I hope this may inspire.\n-Keep in mind the motivation of the two platforms, which may account for some strengths and weaknesses.</p>\n-<p>Webflow is visual web design, less content management. Strong design tools.\n-Designer friendly layout tools.\n-You can design a page with what you could call blocks.</p>\n-<p>Plone is enterprise content management, focus on security.\n-Linking to an attachment is standard, where it is tricky in Webflow.\n-Forms are way more flexible.</p>\n-<p>We have also built a website in Webflow and based it on Plone.</p>\n-</div>\n-<div class="section" id="steve-piercy-pyramid-project-in-pycharm-professional">\n-<h3><a name="steve-piercy-pyramid-project-in-pycharm-professional">Steve Piercy: Pyramid Project in PyCharm Professional</a></h3>\n-<p>It is easy to create a such a project. Demo.\n-See <a class="reference" href="https://stevepiercy.github.io/pppp/">https://stevepiercy.github.io/pppp/</a></p>\n-</div>\n-<div class="section" id="miu-razvan-volto-grid-block">\n-<h3><a name="miu-razvan-volto-grid-block">Miu Razvan: Volto grid block</a></h3>\n-<ul class="simple">\n-<li>Created by Eau de Web team</li>\n-<li>Dependencies: Volto blocks form</li>\n-<li>Similar component: Volto columns block</li>\n-<li>Use it to organize other blocks.</li>\n-<li>Demo showing lots of configuration options, including for different screen sizes</li>\n-<li>See <a class="reference" href="https://github.com/eea/volto-grid-block">https://github.com/eea/volto-grid-block</a></li>\n-</ul>\n-</div>\n-<div class="section" id="maik-derstappen-custom-elements">\n-<h3><a name="maik-derstappen-custom-elements">Maik Derstappen: Custom elements</a></h3>\n-<p>Custom elements are an extension to normal native html elements, for example <tt class="docutils literal"><span class="pre">&lt;flag-icon&gt;</span></tt>.</p>\n-<p>The promise of web components: write once, use anywhere.\n-See <a class="reference" href="https://custom-elements-everywhere.com/">https://custom-elements-everywhere.com/</a></p>\n-<p>How do you use this in Plone?\n-Use <tt class="docutils literal"><span class="pre">plonecli</span> <span class="pre">add</span> <span class="pre">svelte_app</span></tt> to create a small app. Run <tt class="docutils literal"><span class="pre">yarn</span></tt>. Install in Plone add-ons control panel.\n-Edit a page. Replace html source with <tt class="docutils literal"><span class="pre">&lt;my-svelte-app</span> <span class="pre">/&gt;</span></tt>.\n-And your component is there and working.\n-The size is less than five&nbsp; kilobytes.</p>\n-</div>\n-<div class="section" id="tiberiu-ichim-volto-slate">\n-<h3><a name="tiberiu-ichim-volto-slate">Tiberiu Ichim: volto-slate</a></h3>\n-<p><tt class="docutils literal"><span class="pre">volto-slate</span></tt> is a drop-in replacement for the standard rich text editor in Volto.\n-Volto turns an HTML document into a modern document.</p>\n-<p>Why another text editor instead of improving the existing one?</p>\n-<ul class="simple">\n-<li>With Slate we get a better plugin framework. Plugins are just wrappers around the editor. The standard Draft.js is meant to be integrated directly by an application, no concept of plugins out-of-the-box.</li>\n-<li>Slate has simple DOM-like storage for its values, making it easier to render the ersult.</li>\n-</ul>\n-<p>Current status:</p>\n-<ul class="simple">\n-<li>No migrations of any kind.</li>\n-<li>Right now not possible to completely remove or replace Draftjs out of Volto.</li>\n-</ul>\n-</div>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-08T11:53:56+00:00</published>\n-\n-      <updated>2020-12-09T10:19:52+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Fred van Dijk: collective.collectionfilter as a Light-weight Faceted Navigation or a \'compare\' Console</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/fred-van-dijk-collective-collectionfilter-as-a-light-weight-faceted-navigation-or-a-compare-console" />\n-\n-\n-\n-      <id>urn:syndication:0a9da3a3170511af38154da7691da92a</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>I want to talk about some categorisation and classification options in Plone, next to the folder structure.</p>\n-<p>Faceted navigation: drill down on \'facets\' when you search for items. It was popularized by online shopping. Facets in Plone for developers is: whatever is in the ZCatalog, and for users: what you can search on in Collections.\n-Gold standard is <a class="reference" href="https://github.com/eea/eea.facetednavigation">eea.facetednavigation</a>, developed for the European Environment Agency. Examples: <a class="reference" href="https://www.eea.europa.eu/highlights">EEA</a>,  and on two sites by Zest: <a class="reference" href="https://vaquums.eu/sensor-db">Vaquums</a> and <a class="reference" href="https://www.minaraad.be/zoeken">Minaraad</a>, where it replaces the standard search.</p>\n-<p>collective.collectionfilter is a much leaner, meaner, but also more limited version of faceted navigation. Demo with standard Plone News Items with some tags (also known as categories, also known as Subject). Add a Collection that filters on News Items. Now add collection filter portlets.</p>\n-<p>eea.facetednavigation takes over your complete page. In an action you enable or disable it.</p>\n-<p>Now a demo of collectionfilter in SGBP, a documentation website for water management planning in Belgium/Flanders. The customer wanted to take some graphs and compare them. We did that with collectionfilter and collective.classifiers. With the last one we added structured categories: one for water basins and one for parameters of the graphs. Now we use collectionfilter to query a parameter and show the graphs for all water basins.</p>\n-<p>You can adapt several things in the collectionfilter UI, for example change how search options are displayed. This is documented, but took me a while to get right.</p>\n-<p>Collectionfilter also works with Mosaic, because the portlets are also mapped to tiles.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-07T21:10:20+00:00</published>\n-\n-      <updated>2020-12-07T21:10:20+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Asko Soukka: Plone and Volto in a Jamstack project</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/asko-soukka-plone-and-volto-in-a-jamstack-project" />\n-\n-\n-\n-      <id>urn:syndication:a2b3ebe0e81fdf7ce953cb80333b0919</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>Here are the <a class="reference" href="https://datakurre.github.io/ploneconf2020/plone-and-volto-in-jamstack-project.pdf">slides</a>.</p>\n-<p>I am a software architect at University of Jyv\xc3\xa4skyl\xc3\xa4. I have been using Plone since 2004 and GatsbyJS since 2018.\n-The university wanted one student information management system to rule them all, but... every organisation shall do their own integrations, using granular REST API with deep JSON responses. And there should be branded study guides, which we crafted with GatsbyJS. But this was not enough for the Open University part. They really needed a CMS.</p>\n-<p>We use Plone 5.2, Volto, GatsbyJS, and have 6000 html pages, times two languages, out of which 760 are Volto pages.\n-With Plone we could extend content types without needing to do any coding, in the content types field editor. In volto we added auto-complete widgets with custom vocabularies. On the GatsbyJs side, we query the connected pages with GraphQL. We render Volto layouts with React components, rendering individual blocks.</p>\n-<p>Why did we choose GatsbyJs? It is a ReactJS-based site generator. Being static, it is very fast. You can use multiple sources as input, using a plugin architecture. Data lookup is done with GraphQL. It is easy to get started, with comprehensive documentation.</p>\n-<p>I mentored two Google Summer of Code projects for the <tt class="docutils literal"><span class="pre">gatsby-source-plone</span></tt> plugin. It supports default types and most TTW types, also Volto blocks. You can do incremental updates by modification date, so it is really fast.</p>\n-<p>Not everything is easy. The full &quot;GatsbyJs experience&quot; requires practice. You want to replace inline images and links with GatsbyJs images and links, replace file links with direct downloads.</p>\n-<p>Using <tt class="docutils literal"><span class="pre">&#64;plone/volto</span></tt> as dependency to render blocks seemed like a good idea, but it required webpack overrides to be impartable, and could not be used for images and links.</p>\n-<p>The ugly parts of GatsbyJs:</p>\n-<ul class="simple">\n-<li>The GraphQL source plugin cannot cache.</li>\n-<li>The build may take hours, and gigabytes of memory.</li>\n-<li>The build result in readonly.</li>\n-<li>For me it is hard to follow GatsbyJs development, especially individual plugins, because they use a monorepo.</li>\n-</ul>\n-<p>Editors can work on the site during the day, and then wee rebuild the result during the night</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-07T17:54:09+00:00</published>\n-\n-      <updated>2020-12-07T17:54:09+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-</feed>\ndiff --git a/plone/app/portlets/tests/test_configuration.py b/plone/app/portlets/tests/test_configuration.py\nindex 9ae2ea5f..512535b7 100644\n--- a/plone/app/portlets/tests/test_configuration.py\n+++ b/plone/app/portlets/tests/test_configuration.py\n@@ -2,6 +2,7 @@\n from plone.app.portlets.exportimport.portlets import importPortlets\n from plone.app.portlets.interfaces import IColumn\n from plone.app.portlets.interfaces import IPortletTypeInterface\n+from plone.app.portlets.portlets import base\n from plone.app.portlets.tests.base import PortletsTestCase\n from plone.app.portlets.utils import assignment_mapping_from_key\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n@@ -9,6 +10,7 @@\n from plone.portlets.constants import GROUP_CATEGORY\n from plone.portlets.interfaces import ILocalPortletAssignmentManager\n from plone.portlets.interfaces import IPortletAssignmentSettings\n+from plone.portlets.interfaces import IPortletDataProvider\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletRenderer\n from plone.portlets.interfaces import IPortletType\n@@ -17,12 +19,14 @@\n from Products.GenericSetup.context import TarballExportContext\n from Products.GenericSetup.interfaces import IBody\n from Products.GenericSetup.tests.common import DummyImportContext\n+from zope import schema\n from zope.component import getMultiAdapter\n from zope.component import getSiteManager\n from zope.component import getUtility\n from zope.component import queryUtility\n from zope.component.interfaces import IFactory\n from zope.i18nmessageid import Message\n+from zope.interface import implementer\n from zope.interface import Interface\n \n import time\n@@ -46,12 +50,6 @@ class DummyView(BrowserView):\n \n # A sample portlet\n \n-from plone.app.portlets.portlets import base\n-from plone.portlets.interfaces import IPortletDataProvider\n-from zope import schema\n-from zope.interface import implementer\n-\n-\n class ITestPortlet(IPortletDataProvider):\n     test_text = schema.TextLine(title="Test")\n     test_bool = schema.Bool(title="Test")\ndiff --git a/plone/app/portlets/tests/test_dashboard.py b/plone/app/portlets/tests/test_dashboard.py\nindex b8c1ce2c..e0739933 100644\n--- a/plone/app/portlets/tests/test_dashboard.py\n+++ b/plone/app/portlets/tests/test_dashboard.py\n@@ -2,12 +2,10 @@\n from plone.portlets.constants import USER_CATEGORY\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletRetriever\n-from plone.portlets.interfaces import IPortletType\n from Products.PluggableAuthService.events import PrincipalCreated\n from Products.PluggableAuthService.PropertiedUser import PropertiedUser\n from unittest import makeSuite\n from unittest import TestSuite\n-from zExceptions import Unauthorized\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n from zope.event import notify\ndiff --git a/plone/app/portlets/tests/test_traversal.py b/plone/app/portlets/tests/test_traversal.py\nindex c54bfd08..4f86b089 100644\n--- a/plone/app/portlets/tests/test_traversal.py\n+++ b/plone/app/portlets/tests/test_traversal.py\n@@ -52,8 +52,6 @@ def testGroupDashboardNamespace(self):\n         self.assertEqual("++groupdashboard++plone.dashboard1+Reviewers", mapping.id)\n \n     def testGroupDashboardNamespaceChecker(self):\n-        assignment = classic.Assignment()\n-        manager = getUtility(IPortletManager, name="plone.dashboard1")\n         mapping = self.portal.restrictedTraverse(\n             "++groupdashboard++plone.dashboard1+Reviewers"\n         )\ndiff --git a/plone/app/portlets/tests/test_utils.py b/plone/app/portlets/tests/test_utils.py\nindex 08f4464a..ea225c93 100644\n--- a/plone/app/portlets/tests/test_utils.py\n+++ b/plone/app/portlets/tests/test_utils.py\n@@ -9,7 +9,6 @@\n from plone.portlets.constants import USER_CATEGORY\n from plone.portlets.interfaces import IPortletAssignmentMapping\n from plone.portlets.interfaces import IPortletManager\n-from plone.portlets.interfaces import IPortletRenderer\n from plone.portlets.utils import hashPortletInfo\n from Products.CMFPlone.utils import safe_unicode\n from zope.component import getMultiAdapter\ndiff --git a/plone/app/portlets/utils.py b/plone/app/portlets/utils.py\nindex db69975a..db641f23 100644\n--- a/plone/app/portlets/utils.py\n+++ b/plone/app/portlets/utils.py\n@@ -1,7 +1,6 @@\n from Acquisition import aq_base\n from plone.app.event.portlets import portlet_calendar as calendar\n from plone.app.event.portlets import portlet_events as events\n-from plone.app.portlets import HAS_PLONE_APP_EVENT\n from plone.app.portlets.interfaces import IPortletPermissionChecker\n from plone.app.portlets.portlets import classic\n from plone.app.portlets.portlets import login\n@@ -81,8 +80,6 @@ def convert_legacy_portlets(context):\n         "portlet_recent": recent.Assignment(count=5),\n         "portlet_related": DONT_MIGRATE,\n         "portlet_languages": DONT_MIGRATE,\n-        "portlet_calendar": DONT_MIGRATE,\n-        "portlet_events": DONT_MIGRATE,\n         "portlet_calendar": calendar.Assignment(),\n         "portlet_events": events.Assignment(count=5),\n     }\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:25+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/daace0df2811fcc23a4e38bebf705e1ce8784939

chore: codespell

Files changed:
M CHANGES.rst
M plone/app/portlets/browser/editmanager.py
M plone/app/portlets/browser/formhelper.py
M plone/app/portlets/browser/interfaces.py
M plone/app/portlets/interfaces.py
M plone/app/portlets/metaconfigure.py
M plone/app/portlets/permissions.zcml
M plone/app/portlets/portlets/base.py
M plone/app/portlets/tests/test_configuration.py
M plone/app/portlets/tests/test_navigation_portlet.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 524c7747..936b2239 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -232,7 +232,7 @@ New features:\n   version.\n   [icemac]\n \n-- Add python 3 compatability\n+- Add python 3 compatibility\n   [pbauer, ale-rt, jensens]\n \n Bug fixes:\n@@ -271,7 +271,7 @@ Bug fixes:\n \n New features:\n \n-- navigation-, news-, recent-,review-portlets: add options to supress icons,\n+- navigation-, news-, recent-,review-portlets: add options to suppress icons,\n   read thumb_scale from registry plus  option to override thumb_scale individually\n   or suppress thumbs.\n   Replace paper clip (fontello icon) with mimetype icon\n@@ -527,7 +527,7 @@ Fixes:\n 3.0.5 (2015-05-12)\n ------------------\n \n-- Supress a ZopeTestCase warning.\n+- Suppress a ZopeTestCase warning.\n   This fixes https://github.com/plone/Products.CMFPlone/issues/501\n   [gforcada]\n \n@@ -582,7 +582,7 @@ Fixes:\n 3.0.1 (2014-04-16)\n ------------------\n \n-- Transfered pbauer\'s fix of #32 \'removing group-portlets\' of 2.4.x-branch to\n+- Transferred pbauer\'s fix of #32 \'removing group-portlets\' of 2.4.x-branch to\n   master. Also Tansfered changelogs of version 2.4.4 to 2.4.8.\n   [ida27]\n \n@@ -686,7 +686,7 @@ Fixes:\n 2.4.6 (2013-09-14)\n ------------------\n \n-- Use relative links for calender next and prev buttons since caching can cause these things to change the current page the user is viewing\n+- Use relative links for calendar next and prev buttons since caching can cause these things to change the current page the user is viewing\n   [vangheem]\n - Fix the removing of Group- and Typeportlets https://dev.plone.org/ticket/13659\n   [pbauer]\n@@ -860,7 +860,7 @@ Fixes:\n   [seanupton]\n \n - Navigation portlet template renders a non-site navigation root content\n-  item with its apporpriate content icon, reserving the Plone site icon\n+  item with its appropriate content icon, reserving the Plone site icon\n   CSS sprite for default use by a site only.\n   [seanupton]\n \n@@ -950,7 +950,7 @@ Fixes:\n \n 2.2.1 - 2011-08-08\n ------------------\n-- Imporove tests readability. Merged from branches/2.1\n+- Improve tests readability. Merged from branches/2.1\n   [gotcha]\n \n - \'placeholder\' attribute for the search portlet\'s field instead of the custom\ndiff --git a/plone/app/portlets/browser/editmanager.py b/plone/app/portlets/browser/editmanager.py\nindex f588ae9a..e48bfc2c 100644\n--- a/plone/app/portlets/browser/editmanager.py\n+++ b/plone/app/portlets/browser/editmanager.py\n@@ -93,7 +93,7 @@ def view_name(self):\n                     Unauthorized,\n                 ):\n                     logging.getLogger("plone.app.portlets.browser").debug(\n-                        "Cant get view name for TTV %s" % self.__parent__\n+                        "Can\'t get view name for TTW %s" % self.__parent__\n                     )\n         return name\n \ndiff --git a/plone/app/portlets/browser/formhelper.py b/plone/app/portlets/browser/formhelper.py\nindex 3a104c73..bb053fe2 100644\n--- a/plone/app/portlets/browser/formhelper.py\n+++ b/plone/app/portlets/browser/formhelper.py\n@@ -30,7 +30,7 @@ class AddForm(AutoExtensibleForm, form.AddForm):\n \n     Sub-classes should define create() and set the form_fields class variable.\n \n-    Notice the suble difference between AddForm and NullAddform in that the\n+    Notice the subtle difference between AddForm and NullAddform in that the\n     create template method for AddForm takes as a parameter a dict \'data\':\n \n         def create(self, data):\ndiff --git a/plone/app/portlets/browser/interfaces.py b/plone/app/portlets/browser/interfaces.py\nindex 6ce29538..795beabe 100644\n--- a/plone/app/portlets/browser/interfaces.py\n+++ b/plone/app/portlets/browser/interfaces.py\n@@ -45,7 +45,7 @@ class IManageDashboardPortletsView(IManagePortletsView):\n \n \n class IManageColumnPortletsView(IManagePortletsView):\n-    """Base class for views that should display the edit fuctionality\n+    """Base class for views that should display the edit functionality\n     for column portlets.\n \n     This allows us to register a generic portlet manager renderer for this\ndiff --git a/plone/app/portlets/interfaces.py b/plone/app/portlets/interfaces.py\nindex bde17c68..d1b34dfc 100644\n--- a/plone/app/portlets/interfaces.py\n+++ b/plone/app/portlets/interfaces.py\n@@ -26,7 +26,7 @@ class IPortletPermissionChecker(Interface):\n     """\n \n     def __call__():\n-        """Check the adapted assignment manager. Will raise Unathorized if\n+        """Check the adapted assignment manager. Will raise Unauthorized if\n         something fishy is going on.\n         """\n \ndiff --git a/plone/app/portlets/metaconfigure.py b/plone/app/portlets/metaconfigure.py\nindex 89b5469f..dc551d15 100644\n--- a/plone/app/portlets/metaconfigure.py\n+++ b/plone/app/portlets/metaconfigure.py\n@@ -14,7 +14,7 @@\n from zope.publisher.interfaces.browser import IDefaultBrowserLayer\n \n \n-# Keep track of which renderers we\'ve registered so that we can artifically\n+# Keep track of which renderers we\'ve registered so that we can artificially\n # subclass them in portletRendererDirective. Yes, this is evil.\n _default_renderers = {}\n \n@@ -36,7 +36,7 @@ def portletDirective(\n     base.Assignment, a renderer deriving from base.Renderer, an addview\n     using z3c form and deriving from base.AddForm and an editview (optional)\n     using z3c form and deriving from base.EditForm, can use this directive\n-    to avoid having to regiter each of those components individually.\n+    to avoid having to register each of those components individually.\n \n     In addition, we register the portlet interface using IPortletTypeInterface\n     and an IFactory utility, in order to help the GenericSetup handler and\ndiff --git a/plone/app/portlets/permissions.zcml b/plone/app/portlets/permissions.zcml\nindex 55fa4bd1..9d15eb31 100644\n--- a/plone/app/portlets/permissions.zcml\n+++ b/plone/app/portlets/permissions.zcml\n@@ -16,7 +16,7 @@\n       A better way of doing this would probably be to use the Owner role\n       against the assignment mappings and let Manage portlets be controlled\n       by that, but managing those roles properly w.r.t. the namespace\n-      traveral adapters and acquisition is not fun.\n+      traversal adapters and acquisition is not fun.\n      -->\n \n   <permission\ndiff --git a/plone/app/portlets/portlets/base.py b/plone/app/portlets/portlets/base.py\nindex 3a19370d..cd6b8bcc 100644\n--- a/plone/app/portlets/portlets/base.py\n+++ b/plone/app/portlets/portlets/base.py\n@@ -93,7 +93,7 @@ def render_full(self):\n     def render(self):\n         """render the portlet\n \n-        the template gets choosen depending on the initialize state\n+        the template gets chosen depending on the initialize state\n         """\n         if self.initializing:\n             return self.render_preload()\ndiff --git a/plone/app/portlets/tests/test_configuration.py b/plone/app/portlets/tests/test_configuration.py\nindex 512535b7..6e20e0a7 100644\n--- a/plone/app/portlets/tests/test_configuration.py\n+++ b/plone/app/portlets/tests/test_configuration.py\n@@ -276,7 +276,7 @@ def testAssignmentRemoval(self):\n             key="/",\n         )\n \n-        # initally there should be no portlet7\n+        # initially there should be no portlet7\n         self.assertEqual(mapping.get("test.portlet7", None), None)\n \n         # now we add one\n@@ -338,7 +338,7 @@ def testAssignmentPurging(self):\n         )\n         self.assertEqual(1, len(mapping))\n \n-        # and be purgable\n+        # and be purgeable\n         context = DummyImportContext(self.portal, purge=False)\n         context._files[\n             "portlets.xml"\n@@ -372,7 +372,7 @@ def testAssignmentPurging(self):\n         )\n         self.assertEqual(2, len(mapping))\n \n-        # and be purgable\n+        # and be purgeable\n         context = DummyImportContext(self.portal, purge=False)\n         context._files[\n             "portlets.xml"\ndiff --git a/plone/app/portlets/tests/test_navigation_portlet.py b/plone/app/portlets/tests/test_navigation_portlet.py\nindex 7cfb2345..2637cc3d 100644\n--- a/plone/app/portlets/tests/test_navigation_portlet.py\n+++ b/plone/app/portlets/tests/test_navigation_portlet.py\n@@ -644,7 +644,7 @@ def testINavigationRootWithRelativeRootSet(self):\n         )\n \n     def testPortletsTitle(self):\n-        """If portlet\'s name is not explicitely specified we show\n+        """If portlet\'s name is not explicitly specified we show\n         default fallback \'Navigation\', translate it and hide it\n         with CSS."""\n         view = self.renderer(self.portal)\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:25+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/9e896106122de7742c7b2d3c6432180cde129c0c

Remove unused imports in tests.

Files changed:
M plone/app/portlets/tests/test_configuration.py

b'diff --git a/plone/app/portlets/tests/test_configuration.py b/plone/app/portlets/tests/test_configuration.py\nindex 6e20e0a7..29262cce 100644\n--- a/plone/app/portlets/tests/test_configuration.py\n+++ b/plone/app/portlets/tests/test_configuration.py\n@@ -32,24 +32,13 @@\n import time\n \n \n-# BBB Zope 2.12\n-try:\n-    from OFS import metaconfigure\n-    from Zope2.App import zcml\n-\n-    zcml  # pyflakes\n-    metaconfigure\n-except ImportError:\n-    from Products.Five import fiveconfigure as metaconfigure\n-    from Products.Five import zcml\n-\n-\n class DummyView(BrowserView):\n     pass\n \n \n # A sample portlet\n \n+\n class ITestPortlet(IPortletDataProvider):\n     test_text = schema.TextLine(title="Test")\n     test_bool = schema.Bool(title="Test")\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:26+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/d4bd7b8c4b2f06f77353bff3f7a8bed8f409d5d7

feat: declare dependencies

Files changed:
M .meta.toml
M pyproject.toml
M setup.py

b'diff --git a/.meta.toml b/.meta.toml\nindex f6631b61..f3748f2b 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -3,3 +3,8 @@\n [meta]\n template = "default"\n commit-id = "65ae937a"\n+\n+[dependencies]\n+mappings = [\n+    "ExtensionClass = [\'ComputedAttribute\']",\n+    ]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 9eb73f3c..75ac6ebe 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,3 +60,4 @@ Zope = [\n   \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n ]\n python-dateutil = [\'dateutil\']\n+ExtensionClass = [\'ComputedAttribute\']\ndiff --git a/setup.py b/setup.py\nindex 5dc9a200..c518779c 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -36,20 +36,47 @@\n     python_requires=">=3.8",\n     extras_require=dict(\n         test=[\n+            "five.intid",\n+            "plone.namedfile",\n+            "plone.testing",\n+            "plone.z3cform",\n             "plone.app.testing",\n+            "zope.intid",\n         ],\n     ),\n     install_requires=[\n-        "setuptools",\n+        "Acquisition",\n+        "BTrees",\n+        "DateTime",\n+        "ExtensionClass",\n+        "feedparser",\n         "five.customerize",\n+        "plone.app.event",\n+        "plone.app.i18n",\n+        "plone.app.layout",\n+        "plone.app.uuid",\n+        "plone.app.vocabularies >= 2.1.15",\n+        "plone.app.z3cform",\n         "plone.autoform",\n+        "plone.base",\n         "plone.i18n",\n         "plone.memoize",\n         "plone.portlets>=1.1",\n-        "plone.app.i18n",\n-        "plone.app.vocabularies >= 2.1.15",\n-        "plone.app.z3cform",\n+        "plone.protect",\n+        "plone.registry",\n+        "Products.CMFCore",\n+        "Products.CMFDynamicViewFTI",\n+        "Products.CMFPlone",\n+        "Products.GenericSetup >= 2.0",\n+        "Products.MimetypesRegistry",\n+        "Products.PluggableAuthService",\n+        "Products.PythonScripts",\n+        "Products.statusmessages",\n+        "setuptools",\n         "transaction",\n+        "z3c.form",\n+        "ZODB",\n+        "Zope >= 5",\n         "zope.annotation",\n         "zope.browser",\n         "zope.component",\n@@ -62,16 +89,6 @@\n         "zope.lifecycleevent",\n         "zope.publisher",\n         "zope.schema",\n-        "zope.site",\n         "zope.traversing",\n-        "Products.CMFCore",\n-        "Products.CMFDynamicViewFTI",\n-        "Products.GenericSetup >= 2.0",\n-        "Products.PluggableAuthService",\n-        "ZODB",\n-        "Acquisition",\n-        "DateTime",\n-        "Zope >= 5",\n-        "feedparser",\n     ],\n )\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:26+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/3a9b12f8fa9d1655206c310a0a6f2f6a0ba6a86a

no z2 but zope

Files changed:
M plone/app/portlets/testing.py
M plone/app/portlets/tests/testMemberDashboard.rst

b'diff --git a/plone/app/portlets/testing.py b/plone/app/portlets/testing.py\nindex e481c116..f72fad39 100644\n--- a/plone/app/portlets/testing.py\n+++ b/plone/app/portlets/testing.py\n@@ -7,7 +7,7 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n-from plone.testing import z2\n+from plone.testing import zope\n from Products.CMFCore.utils import getToolByName\n from zope.configuration import xmlconfig\n \n@@ -18,7 +18,7 @@ class PloneAppPortlets(PloneSandboxLayer):\n     defaultBases = (PLONE_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\n-        z2.installProduct(app, "plone.app.portlets")\n+        zope.installProduct(app, "plone.app.portlets")\n \n         # Include testing profile\n         import plone.app.portlets\ndiff --git a/plone/app/portlets/tests/testMemberDashboard.rst b/plone/app/portlets/tests/testMemberDashboard.rst\nindex dd922332..3f27411a 100644\n--- a/plone/app/portlets/tests/testMemberDashboard.rst\n+++ b/plone/app/portlets/tests/testMemberDashboard.rst\n@@ -16,7 +16,7 @@ bug: 11174: Portal Members can\'t add portlets to their dashboard\n ----------------------\n Login as the \'user1\' user\n \n-    >>> from plone.testing.z2 import Browser\n+    >>> from plone.testing.zope import Browser\n     >>> browser = Browser(layer[\'app\'])\n     >>> portalURL = portal.absolute_url()\n \n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:26+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/a124f728b846287d6a9338088ca13e70b55a55e3

Tests: fix DeprecationWarning: invalid escape sequence '\&lt;'

Files changed:
M plone/app/portlets/tests/testMemberDashboard.rst

b'diff --git a/plone/app/portlets/tests/testMemberDashboard.rst b/plone/app/portlets/tests/testMemberDashboard.rst\nindex 3f27411a..bb095334 100644\n--- a/plone/app/portlets/tests/testMemberDashboard.rst\n+++ b/plone/app/portlets/tests/testMemberDashboard.rst\n@@ -34,7 +34,7 @@ Go to the dashboard and check that portlets are addable here\n \n Let\'s try to add a Search portlet and then remove it\n \n-    >>> bool(re.search(\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n+    >>> bool(re.search(r\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n     False\n     >>> browser.getControl(name=\':action\',index=0).value = [\'/++dashboard++plone.dashboard1+user1/+/portlets.Search\']\n     >>> browser.getForm(index=1).submit()\n@@ -73,7 +73,7 @@ Using the addview, let\'s see that we cannot add a portlet for another user\n     >>> browser.getControl(\'Log in\').click()\n \n     >>> browser.open(portalURL+\'/@@manage-dashboard?_authenticator=\' + createToken())\n-    >>> bool(re.search(\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n+    >>> bool(re.search(r\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n     False\n \n Now, we try to open the @@manage-portlets view and also try to call the addview\n@@ -94,7 +94,7 @@ those views\n     >>> browser.open(portalURL+\'/@@manage-portlets?_authenticator=\' + createToken())\n     >>> "Insufficient Privileges" in browser.contents\n     False\n-    >>> bool(re.search(\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n+    >>> bool(re.search(r\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n     False\n     >>> browser.open(portalURL + "/++contextportlets++plone.leftcolumn/+/portlets.Search")\n     >>> "Insufficient Privileges" in browser.contents\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:26+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/535d7762cd6d86f3786b018df1d779d6ad9b5528

Get rid of most direct use of Products.CMPlone, replace with plone.base.

Files changed:
M plone/app/portlets/browser/configure.zcml
M plone/app/portlets/browser/editmanager.py
M plone/app/portlets/dashboard/dashboard.py
M plone/app/portlets/portlets/news.py
M plone/app/portlets/portlets/recent.py
M plone/app/portlets/portlets/review.py
M plone/app/portlets/tests/test_navigation_portlet.py
M plone/app/portlets/tests/test_utils.py

b'diff --git a/plone/app/portlets/browser/configure.zcml b/plone/app/portlets/browser/configure.zcml\nindex 48031e41..a06c00c8 100644\n--- a/plone/app/portlets/browser/configure.zcml\n+++ b/plone/app/portlets/browser/configure.zcml\n@@ -5,11 +5,11 @@\n \n   <!-- Some things do not make sense in the breadcrumbs. -->\n   <class class="..portlets.base.Assignment">\n-    <implements interface="Products.CMFPlone.interfaces.IHideFromBreadcrumbs" />\n+    <implements interface="plone.base.interfaces.IHideFromBreadcrumbs" />\n   </class>\n \n   <class class="..storage.PortletAssignmentMapping">\n-    <implements interface="Products.CMFPlone.interfaces.IHideFromBreadcrumbs" />\n+    <implements interface="plone.base.interfaces.IHideFromBreadcrumbs" />\n   </class>\n \n   <!-- Make a special renderer for the columns so we can control them\ndiff --git a/plone/app/portlets/browser/editmanager.py b/plone/app/portlets/browser/editmanager.py\nindex e48bfc2c..97e2a715 100644\n--- a/plone/app/portlets/browser/editmanager.py\n+++ b/plone/app/portlets/browser/editmanager.py\n@@ -20,7 +20,7 @@\n from plone.portlets.interfaces import IPortletManagerRenderer\n from plone.portlets.utils import hashPortletInfo\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import IPloneSiteRoot\n+from plone.base.interfaces import IPloneSiteRoot\n from Products.Five.browser import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.PythonScripts.standard import url_quote\ndiff --git a/plone/app/portlets/dashboard/dashboard.py b/plone/app/portlets/dashboard/dashboard.py\nindex db74acef..783ea8b7 100644\n--- a/plone/app/portlets/dashboard/dashboard.py\n+++ b/plone/app/portlets/dashboard/dashboard.py\n@@ -5,7 +5,7 @@\n from plone.portlets.interfaces import IPortletManager\n from plone.protect.authenticator import createToken\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone import PloneMessageFactory as _\n+from plone.base import PloneMessageFactory as _\n from Products.Five.browser import BrowserView\n from Products.statusmessages.interfaces import IStatusMessage\n from zope.component import getUtility\ndiff --git a/plone/app/portlets/portlets/news.py b/plone/app/portlets/portlets/news.py\nindex 452ae94b..76a056e5 100644\n--- a/plone/app/portlets/portlets/news.py\n+++ b/plone/app/portlets/portlets/news.py\n@@ -11,7 +11,7 @@\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import ISiteSchema\n+from plone.base.interfaces import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\n from zope.component import getMultiAdapter\ndiff --git a/plone/app/portlets/portlets/recent.py b/plone/app/portlets/portlets/recent.py\nindex 4976cb3f..0be9d7fb 100644\n--- a/plone/app/portlets/portlets/recent.py\n+++ b/plone/app/portlets/portlets/recent.py\n@@ -9,7 +9,7 @@\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces.controlpanel import ISiteSchema\n+from plone.base.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path\n from zope import schema\ndiff --git a/plone/app/portlets/portlets/review.py b/plone/app/portlets/portlets/review.py\nindex 7e6e2cc9..85a29f4a 100644\n--- a/plone/app/portlets/portlets/review.py\n+++ b/plone/app/portlets/portlets/review.py\n@@ -8,7 +8,7 @@\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces.controlpanel import ISiteSchema\n+from plone.base.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\n from zope.component import getMultiAdapter\ndiff --git a/plone/app/portlets/tests/test_navigation_portlet.py b/plone/app/portlets/tests/test_navigation_portlet.py\nindex 2637cc3d..741a3930 100644\n--- a/plone/app/portlets/tests/test_navigation_portlet.py\n+++ b/plone/app/portlets/tests/test_navigation_portlet.py\n@@ -12,7 +12,7 @@\n from plone.portlets.interfaces import IPortletRenderer\n from plone.portlets.interfaces import IPortletType\n from plone.registry.interfaces import IRegistry\n-from Products.CMFPlone.interfaces import INavigationSchema\n+from plone.base.interfaces import INavigationSchema\n from Products.CMFPlone.tests import dummy\n from Products.GenericSetup.utils import _getDottedName\n from zope.component import getMultiAdapter\ndiff --git a/plone/app/portlets/tests/test_utils.py b/plone/app/portlets/tests/test_utils.py\nindex ea225c93..37c5e315 100644\n--- a/plone/app/portlets/tests/test_utils.py\n+++ b/plone/app/portlets/tests/test_utils.py\n@@ -5,12 +5,12 @@\n from plone.app.portlets.tests.base import PortletsTestCase\n from plone.app.portlets.utils import assignment_from_key\n from plone.app.testing import TEST_USER_ID\n+from plone.base.utils import safe_text\n from plone.portlets.constants import CONTEXT_CATEGORY\n from plone.portlets.constants import USER_CATEGORY\n from plone.portlets.interfaces import IPortletAssignmentMapping\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.utils import hashPortletInfo\n-from Products.CMFPlone.utils import safe_unicode\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n@@ -82,7 +82,7 @@ def testTraversalRendererWithHash(self):\n         )\n         render_portlet_view = PortletUtilities(context, request)\n         rendered_portlet = render_portlet_view.render_portlet(\n-            safe_unicode(portlet_hash)\n+            safe_text(portlet_hash)\n         )\n         self.assertIn("portletNews", rendered_portlet)\n         self.assertIn("Test News", rendered_portlet)\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:26+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/df930d677201f95aec593464c77673115c372473

Get rid of ATContentTypes compatibility code.

Files changed:
M plone/app/portlets/configure.zcml

b'diff --git a/plone/app/portlets/configure.zcml b/plone/app/portlets/configure.zcml\nindex 25ebe95a..6732bada 100644\n--- a/plone/app/portlets/configure.zcml\n+++ b/plone/app/portlets/configure.zcml\n@@ -2,7 +2,6 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:five="http://namespaces.zope.org/five"\n-    xmlns:zcml="http://namespaces.zope.org/zcml"\n     >\n \n   <include package="plone.portlets" />\n@@ -30,19 +29,12 @@\n \n   <adapter factory=".dashboard.DefaultDashboard" />\n \n-  <!-- Make the site root and any ATContentType a possible portlet manager -->\n+  <!-- Make the site root a possible portlet manager -->\n   <class class="Products.CMFPlone.Portal.PloneSite">\n     <implements interface="plone.portlets.interfaces.ILocalPortletAssignable" />\n   </class>\n \n-  <class\n-      class="Products.ATContentTypes.content.base.ATCTMixin"\n-      zcml:condition="installed Products.ATContentTypes"\n-      >\n-    <implements interface="plone.portlets.interfaces.ILocalPortletAssignable" />\n-  </class>\n-\n-  <!-- Make a Zope 2 safe traversal adapter for assignment mappings -->\n+  <!-- Make a Zope safe traversal adapter for assignment mappings -->\n   <adapter\n       factory=".storage.PortletAssignmentMappingTraverser"\n       provides="zope.publisher.interfaces.browser.IBrowserPublisher"\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:26+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/1f033a291387eac29068944b4dbee1773f6b3565

Removed unused definition of HAS_PLONE_APP_EVENT.

plone.app.event is always there.

Files changed:
M plone/app/portlets/__init__.py

b'diff --git a/plone/app/portlets/__init__.py b/plone/app/portlets/__init__.py\nindex febb48db..85434045 100644\n--- a/plone/app/portlets/__init__.py\n+++ b/plone/app/portlets/__init__.py\n@@ -1,14 +1,5 @@\n # Import PloneMessageFactory to create messages in the plone domain\n from zope.i18nmessageid import MessageFactory\n \n-import pkg_resources\n-\n \n PloneMessageFactory = MessageFactory("plone")\n-\n-try:\n-    pkg_resources.get_distribution("plone.app.event")\n-except pkg_resources.DistributionNotFound:\n-    HAS_PLONE_APP_EVENT = False\n-else:\n-    HAS_PLONE_APP_EVENT = True\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:27+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/d5c1e0612bc35315e70c49bebdf6324f7d82c946

Remove never true zcml condition: Products.CMFCore has no 'src' module.

Files changed:
M plone/app/portlets/exportimport/configure.zcml

b'diff --git a/plone/app/portlets/exportimport/configure.zcml b/plone/app/portlets/exportimport/configure.zcml\nindex 9be1f051..e78125b1 100644\n--- a/plone/app/portlets/exportimport/configure.zcml\n+++ b/plone/app/portlets/exportimport/configure.zcml\n@@ -1,7 +1,6 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    xmlns:zcml="http://namespaces.zope.org/zcml"\n     i18n_domain="plone"\n     >\n \n@@ -30,14 +29,10 @@\n       handler=".portlets.exportPortlets"\n       />\n \n-  <configure zcml:condition="not-installed Products.CMFCore.src">\n-\n-    <utility\n-        factory=".portlets.Blacklist"\n-        provides="Products.GenericSetup.interfaces.IComponentsHandlerBlacklist"\n-        name="plone.app.portlets.exportimport"\n-        />\n-\n-  </configure>\n+  <utility\n+      factory=".portlets.Blacklist"\n+      provides="Products.GenericSetup.interfaces.IComponentsHandlerBlacklist"\n+      name="plone.app.portlets.exportimport"\n+      />\n \n </configure>\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:27+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/00e5c9378252e3f93f771362c6f6fa74b27b7a5a

import plone.base PloneMessageFactory in root and use that everywhere.

Most code was already importing it from '..'

Files changed:
M plone/app/portlets/__init__.py
M plone/app/portlets/dashboard/dashboard.py

b'diff --git a/plone/app/portlets/__init__.py b/plone/app/portlets/__init__.py\nindex 85434045..793aae76 100644\n--- a/plone/app/portlets/__init__.py\n+++ b/plone/app/portlets/__init__.py\n@@ -1,5 +1 @@\n-# Import PloneMessageFactory to create messages in the plone domain\n-from zope.i18nmessageid import MessageFactory\n-\n-\n-PloneMessageFactory = MessageFactory("plone")\n+from plone.base import PloneMessageFactory  # noqa F401 imported but unused\ndiff --git a/plone/app/portlets/dashboard/dashboard.py b/plone/app/portlets/dashboard/dashboard.py\nindex 783ea8b7..d8a70e3c 100644\n--- a/plone/app/portlets/dashboard/dashboard.py\n+++ b/plone/app/portlets/dashboard/dashboard.py\n@@ -5,7 +5,7 @@\n from plone.portlets.interfaces import IPortletManager\n from plone.protect.authenticator import createToken\n from Products.CMFCore.utils import getToolByName\n-from plone.base import PloneMessageFactory as _\n+from .. import PloneMessageFactory as _\n from Products.Five.browser import BrowserView\n from Products.statusmessages.interfaces import IStatusMessage\n from zope.component import getUtility\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:35:27+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/f8713bf258fbe41b9f40d70ae5d3c22e1d3702d0

isort and black again

Files changed:
M plone/app/portlets/browser/editmanager.py
M plone/app/portlets/dashboard/dashboard.py
M plone/app/portlets/portlets/news.py
M plone/app/portlets/portlets/recent.py
M plone/app/portlets/portlets/review.py
M plone/app/portlets/tests/test_navigation_portlet.py
M plone/app/portlets/tests/test_utils.py

b'diff --git a/plone/app/portlets/browser/editmanager.py b/plone/app/portlets/browser/editmanager.py\nindex 97e2a715..11d1a978 100644\n--- a/plone/app/portlets/browser/editmanager.py\n+++ b/plone/app/portlets/browser/editmanager.py\n@@ -9,6 +9,7 @@\n from Acquisition import Explicit\n from Acquisition.interfaces import IAcquirer\n from five.customerize.zpt import TTWViewTemplateRenderer\n+from plone.base.interfaces import IPloneSiteRoot\n from plone.memoize.view import memoize\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n from plone.portlets.constants import CONTEXT_CATEGORY\n@@ -20,7 +21,6 @@\n from plone.portlets.interfaces import IPortletManagerRenderer\n from plone.portlets.utils import hashPortletInfo\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces import IPloneSiteRoot\n from Products.Five.browser import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.PythonScripts.standard import url_quote\ndiff --git a/plone/app/portlets/dashboard/dashboard.py b/plone/app/portlets/dashboard/dashboard.py\nindex d8a70e3c..a2e5354a 100644\n--- a/plone/app/portlets/dashboard/dashboard.py\n+++ b/plone/app/portlets/dashboard/dashboard.py\n@@ -1,3 +1,4 @@\n+from .. import PloneMessageFactory as _\n from AccessControl import getSecurityManager\n from plone.memoize.instance import memoize\n from plone.portlets.constants import GROUP_CATEGORY\n@@ -5,7 +6,6 @@\n from plone.portlets.interfaces import IPortletManager\n from plone.protect.authenticator import createToken\n from Products.CMFCore.utils import getToolByName\n-from .. import PloneMessageFactory as _\n from Products.Five.browser import BrowserView\n from Products.statusmessages.interfaces import IStatusMessage\n from zope.component import getUtility\ndiff --git a/plone/app/portlets/portlets/news.py b/plone/app/portlets/portlets/news.py\nindex 76a056e5..ebb7d97b 100644\n--- a/plone/app/portlets/portlets/news.py\n+++ b/plone/app/portlets/portlets/news.py\n@@ -5,13 +5,13 @@\n from plone.app.layout.navigation.root import getNavigationRootObject\n from plone.app.z3cform.widget import SelectFieldWidget\n from plone.autoform.directives import widget\n+from plone.base.interfaces import ISiteSchema\n from plone.memoize import ram\n from plone.memoize.compress import xhtml_compress\n from plone.memoize.instance import memoize\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\n from zope.component import getMultiAdapter\ndiff --git a/plone/app/portlets/portlets/recent.py b/plone/app/portlets/portlets/recent.py\nindex 0be9d7fb..05e7d74a 100644\n--- a/plone/app/portlets/portlets/recent.py\n+++ b/plone/app/portlets/portlets/recent.py\n@@ -3,13 +3,13 @@\n from ..portlets import base\n from Acquisition import aq_inner\n from plone.app.layout.navigation.root import getNavigationRoot\n+from plone.base.interfaces.controlpanel import ISiteSchema\n from plone.memoize import ram\n from plone.memoize.compress import xhtml_compress\n from plone.memoize.instance import memoize\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path\n from zope import schema\ndiff --git a/plone/app/portlets/portlets/review.py b/plone/app/portlets/portlets/review.py\nindex 85a29f4a..feb83225 100644\n--- a/plone/app/portlets/portlets/review.py\n+++ b/plone/app/portlets/portlets/review.py\n@@ -3,12 +3,12 @@\n from ..portlets import base\n from Acquisition import aq_base\n from Acquisition import aq_inner\n+from plone.base.interfaces.controlpanel import ISiteSchema\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.memoize.instance import memoize\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\n from zope.component import getMultiAdapter\ndiff --git a/plone/app/portlets/tests/test_navigation_portlet.py b/plone/app/portlets/tests/test_navigation_portlet.py\nindex 741a3930..ca36144d 100644\n--- a/plone/app/portlets/tests/test_navigation_portlet.py\n+++ b/plone/app/portlets/tests/test_navigation_portlet.py\n@@ -6,13 +6,13 @@\n from plone.app.portlets.tests.base import PortletsTestCase\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n+from plone.base.interfaces import INavigationSchema\n from plone.portlets.interfaces import IPortletAssignment\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletRenderer\n from plone.portlets.interfaces import IPortletType\n from plone.registry.interfaces import IRegistry\n-from plone.base.interfaces import INavigationSchema\n from Products.CMFPlone.tests import dummy\n from Products.GenericSetup.utils import _getDottedName\n from zope.component import getMultiAdapter\ndiff --git a/plone/app/portlets/tests/test_utils.py b/plone/app/portlets/tests/test_utils.py\nindex 37c5e315..7bf331d9 100644\n--- a/plone/app/portlets/tests/test_utils.py\n+++ b/plone/app/portlets/tests/test_utils.py\n@@ -81,9 +81,7 @@ def testTraversalRendererWithHash(self):\n             )\n         )\n         render_portlet_view = PortletUtilities(context, request)\n-        rendered_portlet = render_portlet_view.render_portlet(\n-            safe_text(portlet_hash)\n-        )\n+        rendered_portlet = render_portlet_view.render_portlet(safe_text(portlet_hash))\n         self.assertIn("portletNews", rendered_portlet)\n         self.assertIn("Test News", rendered_portlet)\n \n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:52:00+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/ba1b7219e54b3993a5638505ebfe46a752822b4f

Get rid of deprecation warning for unittest.makeSuite.

Files changed:
M plone/app/portlets/tests/testDoctests.py
M plone/app/portlets/tests/test_actions_portlet.py
M plone/app/portlets/tests/test_cache.py
M plone/app/portlets/tests/test_classic_portlet.py
M plone/app/portlets/tests/test_configuration.py
M plone/app/portlets/tests/test_context.py
M plone/app/portlets/tests/test_dashboard.py
M plone/app/portlets/tests/test_exportimport.py
M plone/app/portlets/tests/test_formextender.py
M plone/app/portlets/tests/test_login_portlet.py
M plone/app/portlets/tests/test_manage_views.py
M plone/app/portlets/tests/test_mapping.py
M plone/app/portlets/tests/test_navigation_portlet.py
M plone/app/portlets/tests/test_news_portlet.py
M plone/app/portlets/tests/test_recent_portlet.py
M plone/app/portlets/tests/test_redirects.py
M plone/app/portlets/tests/test_review_portlet.py
M plone/app/portlets/tests/test_rss_portlet.py
M plone/app/portlets/tests/test_setup.py
M plone/app/portlets/tests/test_traversal.py
M plone/app/portlets/tests/test_utils.py

b'diff --git a/plone/app/portlets/tests/testDoctests.py b/plone/app/portlets/tests/testDoctests.py\nindex c52d40bd..90b19398 100644\n--- a/plone/app/portlets/tests/testDoctests.py\n+++ b/plone/app/portlets/tests/testDoctests.py\n@@ -2,11 +2,12 @@\n from plone.app.portlets.testing import OPTIONFLAGS\n from plone.app.portlets.testing import PLONE_APP_PORTLETS_FUNCTIONAL_TESTING\n from plone.testing import layered\n-from unittest import TestSuite\n+\n+import unittest\n \n \n def test_suite():\n-    suite = TestSuite()\n+    suite = unittest.TestSuite()\n     suite.addTest(\n         layered(\n             DocFileSuite(\ndiff --git a/plone/app/portlets/tests/test_actions_portlet.py b/plone/app/portlets/tests/test_actions_portlet.py\nindex a7c7d758..3427115c 100644\n--- a/plone/app/portlets/tests/test_actions_portlet.py\n+++ b/plone/app/portlets/tests/test_actions_portlet.py\n@@ -12,6 +12,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -239,3 +241,10 @@ def test_object_buttons_with_icons(self):\n         expected = {"Cut", "Copy", "Rename", "Delete"}\n         got = {str(link["title"]) for link in output}\n         self.assertTrue(expected.issubset(got))\n+\n+\n+def test_suite():\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n+    return suite\ndiff --git a/plone/app/portlets/tests/test_cache.py b/plone/app/portlets/tests/test_cache.py\nindex f3ca0184..928c42fc 100644\n--- a/plone/app/portlets/tests/test_cache.py\n+++ b/plone/app/portlets/tests/test_cache.py\n@@ -2,6 +2,8 @@\n from plone.app.portlets.tests.base import PortletsTestCase\n from plone.app.testing import logout\n \n+import unittest\n+\n \n class MockBrain:\n     def __init__(self, path="some/path", modified="2002-01-01"):\n@@ -60,9 +62,6 @@ def testNonASCIIPath(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestCacheKey))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestCacheKey))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_classic_portlet.py b/plone/app/portlets/tests/test_classic_portlet.py\nindex cbe01e5a..7e800fe4 100644\n--- a/plone/app/portlets/tests/test_classic_portlet.py\n+++ b/plone/app/portlets/tests/test_classic_portlet.py\n@@ -12,6 +12,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -119,10 +121,7 @@ def testRenderClassicPortlet(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_configuration.py b/plone/app/portlets/tests/test_configuration.py\nindex 29262cce..ea54d8f0 100644\n--- a/plone/app/portlets/tests/test_configuration.py\n+++ b/plone/app/portlets/tests/test_configuration.py\n@@ -30,6 +30,7 @@\n from zope.interface import Interface\n \n import time\n+import unittest\n \n \n class DummyView(BrowserView):\n@@ -582,10 +583,7 @@ def testExport(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestZCML))\n-    suite.addTest(makeSuite(TestGenericSetup))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestZCML))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestGenericSetup))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_context.py b/plone/app/portlets/tests/test_context.py\nindex b4f6bb32..fb66b582 100644\n--- a/plone/app/portlets/tests/test_context.py\n+++ b/plone/app/portlets/tests/test_context.py\n@@ -4,6 +4,8 @@\n from plone.app.testing import TEST_USER_ID\n from plone.portlets.interfaces import IPortletContext\n \n+import unittest\n+\n \n class TestBasicContext(PortletsTestCase):\n     def testParent(self):\n@@ -106,10 +108,9 @@ def testAnonymous(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestBasicContext))\n-    suite.addTest(makeSuite(TestPortalRootContext))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestBasicContext))\n+    suite.addTest(\n+        unittest.defaultTestLoader.loadTestsFromTestCase(TestPortalRootContext)\n+    )\n     return suite\ndiff --git a/plone/app/portlets/tests/test_dashboard.py b/plone/app/portlets/tests/test_dashboard.py\nindex e0739933..40457880 100644\n--- a/plone/app/portlets/tests/test_dashboard.py\n+++ b/plone/app/portlets/tests/test_dashboard.py\n@@ -4,12 +4,12 @@\n from plone.portlets.interfaces import IPortletRetriever\n from Products.PluggableAuthService.events import PrincipalCreated\n from Products.PluggableAuthService.PropertiedUser import PropertiedUser\n-from unittest import makeSuite\n-from unittest import TestSuite\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n from zope.event import notify\n \n+import unittest\n+\n \n class TestDashboard(PortletsTestCase):\n     def test_default_dashboard_created_for_new_user(self):\n@@ -43,6 +43,6 @@ def test_non_ascii_usernames_created(self):\n \n \n def test_suite():\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestDashboard))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestDashboard))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_exportimport.py b/plone/app/portlets/tests/test_exportimport.py\nindex 545d53fa..77e27899 100644\n--- a/plone/app/portlets/tests/test_exportimport.py\n+++ b/plone/app/portlets/tests/test_exportimport.py\n@@ -15,6 +15,8 @@\n from zope.component import queryUtility\n from zope.i18nmessageid import Message\n \n+import unittest\n+\n \n class PortletsExportImportTestCase(PortletsTestCase):\n     def afterSetUp(self):\n@@ -248,14 +250,15 @@ def test_extractPortletManagerNode_customClass(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestImportPortlets))\n-    suite.addTest(makeSuite(TestExportPortlets))\n-    suite.addTest(makeSuite(TestImportPortletManagers))\n-    suite.addTest(makeSuite(TestExportPortletManagers))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestImportPortlets))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestExportPortlets))\n+    suite.addTest(\n+        unittest.defaultTestLoader.loadTestsFromTestCase(TestImportPortletManagers)\n+    )\n+    suite.addTest(\n+        unittest.defaultTestLoader.loadTestsFromTestCase(TestExportPortletManagers)\n+    )\n     return suite\n \n \ndiff --git a/plone/app/portlets/tests/test_formextender.py b/plone/app/portlets/tests/test_formextender.py\nindex 1d3d5747..94ce9878 100644\n--- a/plone/app/portlets/tests/test_formextender.py\n+++ b/plone/app/portlets/tests/test_formextender.py\n@@ -20,10 +20,10 @@\n from zope.interface import Interface\n from zope.publisher.interfaces.browser import IDefaultBrowserLayer\n \n-\n-# A sample schemaextender:\n+import unittest\n \n \n+# A sample schemaextender:\n EXTENDER_PREFIX = "portletcssclass"\n \n \n@@ -257,9 +257,6 @@ def test_renderer(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestSchemaExtender))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestSchemaExtender))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_login_portlet.py b/plone/app/portlets/tests/test_login_portlet.py\nindex a3f3f810..5d178225 100644\n--- a/plone/app/portlets/tests/test_login_portlet.py\n+++ b/plone/app/portlets/tests/test_login_portlet.py\n@@ -14,6 +14,8 @@\n from zope.component import getUtility\n from zope.component import queryMultiAdapter\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -140,10 +142,7 @@ def testCanRegister(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_manage_views.py b/plone/app/portlets/tests/test_manage_views.py\nindex c78baf9c..9836eede 100644\n--- a/plone/app/portlets/tests/test_manage_views.py\n+++ b/plone/app/portlets/tests/test_manage_views.py\n@@ -1,5 +1,7 @@\n from plone.app.portlets.tests.base import PortletsTestCase\n \n+import unittest\n+\n \n class TestManageAssignments(PortletsTestCase):\n     def testMoveUp(self):\n@@ -13,10 +15,7 @@ def testDelete(self):\n \n \n def test_suite():\n-    from unittest import TestSuite\n-\n-    # from unittest import makeSuite\n-    suite = TestSuite()\n+    suite = unittest.TestSuite()\n     # TODO: Write tests that *pass*\n-    # suite.addTest(makeSuite(TestManageAssignments))\n+    # suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestManageAssignments))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_mapping.py b/plone/app/portlets/tests/test_mapping.py\nindex b9170971..b1eb279a 100644\n--- a/plone/app/portlets/tests/test_mapping.py\n+++ b/plone/app/portlets/tests/test_mapping.py\n@@ -11,6 +11,8 @@\n from zope.publisher.interfaces import NotFound\n from zope.publisher.interfaces.browser import IBrowserPublisher\n \n+import unittest\n+\n \n class TestNameChooser(PortletsTestCase):\n     def testNameChooser(self):\n@@ -72,11 +74,8 @@ def testTraverseToNonExistent(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestContextMapping))\n-    suite.addTest(makeSuite(TestTraverser))\n-    suite.addTest(makeSuite(TestNameChooser))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestContextMapping))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestTraverser))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestNameChooser))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_navigation_portlet.py b/plone/app/portlets/tests/test_navigation_portlet.py\nindex ca36144d..e917df34 100644\n--- a/plone/app/portlets/tests/test_navigation_portlet.py\n+++ b/plone/app/portlets/tests/test_navigation_portlet.py\n@@ -20,6 +20,8 @@\n from zope.interface import directlyProvides\n from zope.intid.interfaces import IIntIds\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -711,10 +713,7 @@ def testHeadingLinkRootedItemGone(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_news_portlet.py b/plone/app/portlets/tests/test_news_portlet.py\nindex b021f887..4b8c6477 100644\n--- a/plone/app/portlets/tests/test_news_portlet.py\n+++ b/plone/app/portlets/tests/test_news_portlet.py\n@@ -12,6 +12,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -128,10 +130,7 @@ def test_all_news_link(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_recent_portlet.py b/plone/app/portlets/tests/test_recent_portlet.py\nindex 2eba5dd0..6a70eb27 100644\n--- a/plone/app/portlets/tests/test_recent_portlet.py\n+++ b/plone/app/portlets/tests/test_recent_portlet.py\n@@ -12,6 +12,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -121,10 +123,7 @@ def test_title(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_redirects.py b/plone/app/portlets/tests/test_redirects.py\nindex 03105469..ec6446b8 100644\n--- a/plone/app/portlets/tests/test_redirects.py\n+++ b/plone/app/portlets/tests/test_redirects.py\n@@ -4,6 +4,8 @@\n from plone.app.portlets.browser.formhelper import EditForm\n from plone.app.portlets.tests.base import PortletsTestCase\n \n+import unittest\n+\n \n class TestRedirects(PortletsTestCase):\n     _test_methods = [\n@@ -47,9 +49,6 @@ def test_suite():\n     # bin/test -s plone.app.portlets -m test_redirects\n     # But the error *is* in this test_redirects.py file,\n     # because it goes away when I delete this file.\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestRedirects))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRedirects))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_review_portlet.py b/plone/app/portlets/tests/test_review_portlet.py\nindex 53eb64e3..e978fe70 100644\n--- a/plone/app/portlets/tests/test_review_portlet.py\n+++ b/plone/app/portlets/tests/test_review_portlet.py\n@@ -14,6 +14,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -130,10 +132,7 @@ def test_title(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_rss_portlet.py b/plone/app/portlets/tests/test_rss_portlet.py\nindex 1ee123ed..74e73e85 100644\n--- a/plone/app/portlets/tests/test_rss_portlet.py\n+++ b/plone/app/portlets/tests/test_rss_portlet.py\n@@ -140,10 +140,7 @@ def test_rss_feed_http(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_setup.py b/plone/app/portlets/tests/test_setup.py\nindex 4d31bd54..cf35792c 100644\n--- a/plone/app/portlets/tests/test_setup.py\n+++ b/plone/app/portlets/tests/test_setup.py\n@@ -9,6 +9,8 @@\n from zope.component import getUtilitiesFor\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestProductInstall(PortletsTestCase):\n     def testPortletManagersRegistered(self):\n@@ -49,9 +51,6 @@ def testPortletTypesRegistered(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestProductInstall))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestProductInstall))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_traversal.py b/plone/app/portlets/tests/test_traversal.py\nindex 4f86b089..c6ca8b07 100644\n--- a/plone/app/portlets/tests/test_traversal.py\n+++ b/plone/app/portlets/tests/test_traversal.py\n@@ -14,6 +14,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestTraversal(PortletsTestCase):\n     def _assertSameObject(self, a, b):\n@@ -90,9 +92,6 @@ def testContentTypeNamespace(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestTraversal))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestTraversal))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_utils.py b/plone/app/portlets/tests/test_utils.py\nindex 7bf331d9..06957183 100644\n--- a/plone/app/portlets/tests/test_utils.py\n+++ b/plone/app/portlets/tests/test_utils.py\n@@ -14,6 +14,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestAssignmentFromKey(PortletsTestCase):\n     def afterSetUp(self):\n@@ -87,10 +89,9 @@ def testTraversalRendererWithHash(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestAssignmentFromKey))\n-    suite.addTest(makeSuite(TestRendering))\n+    suite = unittest.TestSuite()\n+    suite.addTest(\n+        unittest.defaultTestLoader.loadTestsFromTestCase(TestAssignmentFromKey)\n+    )\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRendering))\n     return suite\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-29T19:56:21+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/0d2769c87f39d2aab3248c003227a66158fad6a4

news snippet: declare dependencies.

Files changed:
M news/65ae937a.internal

b'diff --git a/news/65ae937a.internal b/news/65ae937a.internal\nindex c08f5399..d6c01aed 100644\n--- a/news/65ae937a.internal\n+++ b/news/65ae937a.internal\n@@ -1,2 +1,2 @@\n-Update configuration files.\n+Update configuration files, declare dependencies.\n [plone devs]\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-30T10:46:18+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/7fa7155f4654d2ca90e359362bddb37bbdde02e1

We do not want to declare our dependency on Products.CMFPlone for now.

Files changed:
M .meta.toml
M pyproject.toml

b'diff --git a/.meta.toml b/.meta.toml\nindex f3748f2b..02792c8f 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -2,9 +2,12 @@\n # https://github.com/plone/meta/tree/master/config/default\n [meta]\n template = "default"\n-commit-id = "65ae937a"\n+commit-id = "c79ab88f"\n \n [dependencies]\n mappings = [\n     "ExtensionClass = [\'ComputedAttribute\']",\n     ]\n+ignores = [\n+    "Products.CMFPlone",\n+    ]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 75ac6ebe..375029bf 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,4 +60,5 @@ Zope = [\n   \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n ]\n python-dateutil = [\'dateutil\']\n+ignore-packages = [\'Products.CMFPlone\']\n ExtensionClass = [\'ComputedAttribute\']\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-30T11:00:11+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/54a03f2ddc87b93b506fcd800f38b5cf6e92b9bb

Remove transitive dependencies.

These were already there. It is apparently best to start with a completely empty list, and let dependencychecker do its job.

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex c518779c..28fa2b12 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -37,17 +37,18 @@\n     extras_require=dict(\n         test=[\n             "five.intid",\n+            "plone.app.testing",\n             "plone.namedfile",\n             "plone.testing",\n             "plone.z3cform",\n-            "plone.app.testing",\n             "zope.intid",\n         ],\n     ),\n     install_requires=[\n-        "Acquisition",\n+        "setuptools",\n+        "plone.base",\n+        "Zope",\n         "BTrees",\n-        "DateTime",\n         "ExtensionClass",\n         "feedparser",\n         "five.customerize",\n@@ -55,40 +56,22 @@\n         "plone.app.i18n",\n         "plone.app.layout",\n         "plone.app.uuid",\n-        "plone.app.vocabularies >= 2.1.15",\n+        "plone.app.vocabularies",\n         "plone.app.z3cform",\n         "plone.autoform",\n-        "plone.base",\n         "plone.i18n",\n         "plone.memoize",\n-        "plone.portlets>=1.1",\n+        "plone.portlets",\n         "plone.protect",\n         "plone.registry",\n-        "Products.CMFCore",\n-        "Products.CMFDynamicViewFTI",\n-        "Products.CMFPlone",\n-        "Products.GenericSetup >= 2.0",\n+        "Products.GenericSetup",\n         "Products.MimetypesRegistry",\n         "Products.PluggableAuthService",\n         "Products.PythonScripts",\n         "Products.statusmessages",\n-        "setuptools",\n-        "transaction",\n         "z3c.form",\n-        "ZODB",\n-        "Zope >= 5",\n         "zope.annotation",\n         "zope.browser",\n-        "zope.component",\n-        "zope.configuration",\n-        "zope.container",\n         "zope.contentprovider",\n-        "zope.event",\n-        "zope.i18nmessageid",\n-        "zope.interface",\n-        "zope.lifecycleevent",\n-        "zope.publisher",\n-        "zope.schema",\n-        "zope.traversing",\n     ],\n )\n'

Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2023-03-30T14:12:50+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.portlets/commit/650de0163b7fb4bedd1e4f992a7c494b2073ae0c

Merge pull request #173 from plone/config-with-default-template-ee0c5463

Config with default template ee0c5463

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/65ae937a.internal
A tox.ini
M .gitignore
M CHANGES.rst
M plone/app/portlets/__init__.py
M plone/app/portlets/browser/adding.py
M plone/app/portlets/browser/configure.zcml
M plone/app/portlets/browser/editmanager.py
M plone/app/portlets/browser/formhelper.py
M plone/app/portlets/browser/interfaces.py
M plone/app/portlets/browser/manage.py
M plone/app/portlets/browser/templates/column.pt
M plone/app/portlets/browser/templates/dashboard-column.pt
M plone/app/portlets/browser/templates/edit-manager-contextual.pt
M plone/app/portlets/browser/templates/edit-manager-macros.pt
M plone/app/portlets/browser/templates/edit-manager.pt
M plone/app/portlets/browser/templates/error_message.pt
M plone/app/portlets/browser/templates/footer.pt
M plone/app/portlets/browser/templates/manage-content-type.pt
M plone/app/portlets/browser/templates/manage-contextual.pt
M plone/app/portlets/browser/templates/manage-dashboard.pt
M plone/app/portlets/browser/templates/manage-group-dashboard.pt
M plone/app/portlets/browser/templates/manage-group.pt
M plone/app/portlets/browser/templates/manage_portlets_fallback.pt
M plone/app/portlets/browser/templates/portlets-pageform.pt
M plone/app/portlets/browser/templates/topbar-manage-portlets.pt
M plone/app/portlets/browser/templates/z3cform-portlets-pageform.pt
M plone/app/portlets/browser/viewlets.py
M plone/app/portlets/configure.zcml
M plone/app/portlets/dashboard/configure.zcml
M plone/app/portlets/dashboard/dashboard.pt
M plone/app/portlets/dashboard/dashboard.py
M plone/app/portlets/dashboard/user_actions.pt
M plone/app/portlets/dashboard/user_actions.py
M plone/app/portlets/exportimport/configure.zcml
M plone/app/portlets/exportimport/portlets.py
M plone/app/portlets/interfaces.py
M plone/app/portlets/meta.zcml
M plone/app/portlets/metaconfigure.py
M plone/app/portlets/overrides.zcml
M plone/app/portlets/permissions.zcml
M plone/app/portlets/portlets/actions.pt
M plone/app/portlets/portlets/base.py
M plone/app/portlets/portlets/calendar.py
M plone/app/portlets/portlets/classic.pt
M plone/app/portlets/portlets/configure.zcml
M plone/app/portlets/portlets/events.py
M plone/app/portlets/portlets/language.pt
M plone/app/portlets/portlets/language.py
M plone/app/portlets/portlets/login.pt
M plone/app/portlets/portlets/login.py
M plone/app/portlets/portlets/navigation.pt
M plone/app/portlets/portlets/navigation.py
M plone/app/portlets/portlets/navigation_recurse.pt
M plone/app/portlets/portlets/news.pt
M plone/app/portlets/portlets/news.py
M plone/app/portlets/portlets/recent.pt
M plone/app/portlets/portlets/recent.py
M plone/app/portlets/portlets/review.pt
M plone/app/portlets/portlets/review.py
M plone/app/portlets/portlets/rss.pt
M plone/app/portlets/portlets/rss.py
M plone/app/portlets/portlets/search.pt
M plone/app/portlets/portlets/search.py
M plone/app/portlets/testing.py
M plone/app/portlets/tests/atom_feed_maurits.xml
M plone/app/portlets/tests/configure.zcml
M plone/app/portlets/tests/profiles/testing/portlets.xml
M plone/app/portlets/tests/testDoctests.py
M plone/app/portlets/tests/testMemberDashboard.rst
M plone/app/portlets/tests/test_actions_portlet.py
M plone/app/portlets/tests/test_cache.py
M plone/app/portlets/tests/test_classic_portlet.py
M plone/app/portlets/tests/test_configuration.py
M plone/app/portlets/tests/test_context.py
M plone/app/portlets/tests/test_dashboard.py
M plone/app/portlets/tests/test_exportimport.py
M plone/app/portlets/tests/test_formextender.py
M plone/app/portlets/tests/test_login_portlet.py
M plone/app/portlets/tests/test_manage_views.py
M plone/app/portlets/tests/test_mapping.py
M plone/app/portlets/tests/test_namechooser.py
M plone/app/portlets/tests/test_navigation_portlet.py
M plone/app/portlets/tests/test_news_portlet.py
M plone/app/portlets/tests/test_recent_portlet.py
M plone/app/portlets/tests/test_redirects.py
M plone/app/portlets/tests/test_review_portlet.py
M plone/app/portlets/tests/test_rss_portlet.py
M plone/app/portlets/tests/test_setup.py
M plone/app/portlets/tests/test_traversal.py
M plone/app/portlets/tests/test_utils.py
M plone/app/portlets/utils.py
M pyproject.toml
M setup.cfg
M setup.py

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 00000000..b4158b89\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.gitignore b/.gitignore\nindex 0cf73216..33ae8cb9 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -2,7 +2,9 @@\n *.pyc\n *.pyo\n build\n+dependencies.svg\n dist\n .project\n .pydevproject\n .settings\n+.tox\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 00000000..02792c8f\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,13 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "c79ab88f"\n+\n+[dependencies]\n+mappings = [\n+    "ExtensionClass = [\'ComputedAttribute\']",\n+    ]\n+ignores = [\n+    "Products.CMFPlone",\n+    ]\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 00000000..449e951a\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/CHANGES.rst b/CHANGES.rst\nindex 524c7747..936b2239 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -232,7 +232,7 @@ New features:\n   version.\n   [icemac]\n \n-- Add python 3 compatability\n+- Add python 3 compatibility\n   [pbauer, ale-rt, jensens]\n \n Bug fixes:\n@@ -271,7 +271,7 @@ Bug fixes:\n \n New features:\n \n-- navigation-, news-, recent-,review-portlets: add options to supress icons,\n+- navigation-, news-, recent-,review-portlets: add options to suppress icons,\n   read thumb_scale from registry plus  option to override thumb_scale individually\n   or suppress thumbs.\n   Replace paper clip (fontello icon) with mimetype icon\n@@ -527,7 +527,7 @@ Fixes:\n 3.0.5 (2015-05-12)\n ------------------\n \n-- Supress a ZopeTestCase warning.\n+- Suppress a ZopeTestCase warning.\n   This fixes https://github.com/plone/Products.CMFPlone/issues/501\n   [gforcada]\n \n@@ -582,7 +582,7 @@ Fixes:\n 3.0.1 (2014-04-16)\n ------------------\n \n-- Transfered pbauer\'s fix of #32 \'removing group-portlets\' of 2.4.x-branch to\n+- Transferred pbauer\'s fix of #32 \'removing group-portlets\' of 2.4.x-branch to\n   master. Also Tansfered changelogs of version 2.4.4 to 2.4.8.\n   [ida27]\n \n@@ -686,7 +686,7 @@ Fixes:\n 2.4.6 (2013-09-14)\n ------------------\n \n-- Use relative links for calender next and prev buttons since caching can cause these things to change the current page the user is viewing\n+- Use relative links for calendar next and prev buttons since caching can cause these things to change the current page the user is viewing\n   [vangheem]\n - Fix the removing of Group- and Typeportlets https://dev.plone.org/ticket/13659\n   [pbauer]\n@@ -860,7 +860,7 @@ Fixes:\n   [seanupton]\n \n - Navigation portlet template renders a non-site navigation root content\n-  item with its apporpriate content icon, reserving the Plone site icon\n+  item with its appropriate content icon, reserving the Plone site icon\n   CSS sprite for default use by a site only.\n   [seanupton]\n \n@@ -950,7 +950,7 @@ Fixes:\n \n 2.2.1 - 2011-08-08\n ------------------\n-- Imporove tests readability. Merged from branches/2.1\n+- Improve tests readability. Merged from branches/2.1\n   [gotcha]\n \n - \'placeholder\' attribute for the search portlet\'s field instead of the custom\ndiff --git a/news/65ae937a.internal b/news/65ae937a.internal\nnew file mode 100644\nindex 00000000..d6c01aed\n--- /dev/null\n+++ b/news/65ae937a.internal\n@@ -0,0 +1,2 @@\n+Update configuration files, declare dependencies.\n+[plone devs]\ndiff --git a/plone/app/portlets/__init__.py b/plone/app/portlets/__init__.py\nindex febb48db..793aae76 100644\n--- a/plone/app/portlets/__init__.py\n+++ b/plone/app/portlets/__init__.py\n@@ -1,14 +1 @@\n-# Import PloneMessageFactory to create messages in the plone domain\n-from zope.i18nmessageid import MessageFactory\n-\n-import pkg_resources\n-\n-\n-PloneMessageFactory = MessageFactory("plone")\n-\n-try:\n-    pkg_resources.get_distribution("plone.app.event")\n-except pkg_resources.DistributionNotFound:\n-    HAS_PLONE_APP_EVENT = False\n-else:\n-    HAS_PLONE_APP_EVENT = True\n+from plone.base import PloneMessageFactory  # noqa F401 imported but unused\ndiff --git a/plone/app/portlets/browser/adding.py b/plone/app/portlets/browser/adding.py\nindex 656babe3..be62f690 100644\n--- a/plone/app/portlets/browser/adding.py\n+++ b/plone/app/portlets/browser/adding.py\n@@ -14,7 +14,6 @@\n \n @implementer(IPortletAdding)\n class PortletAdding(SimpleItem, BrowserView):\n-\n     context = None\n     request = None\n \ndiff --git a/plone/app/portlets/browser/configure.zcml b/plone/app/portlets/browser/configure.zcml\nindex 653f3487..a06c00c8 100644\n--- a/plone/app/portlets/browser/configure.zcml\n+++ b/plone/app/portlets/browser/configure.zcml\n@@ -1,243 +1,246 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <!-- Some things do not make sense in the breadcrumbs. -->\n-    <class class="..portlets.base.Assignment">\n-      <implements interface="Products.CMFPlone.interfaces.IHideFromBreadcrumbs" />\n-    </class>\n+  <!-- Some things do not make sense in the breadcrumbs. -->\n+  <class class="..portlets.base.Assignment">\n+    <implements interface="plone.base.interfaces.IHideFromBreadcrumbs" />\n+  </class>\n \n-    <class class="..storage.PortletAssignmentMapping">\n-      <implements interface="Products.CMFPlone.interfaces.IHideFromBreadcrumbs" />\n-    </class>\n+  <class class="..storage.PortletAssignmentMapping">\n+    <implements interface="plone.base.interfaces.IHideFromBreadcrumbs" />\n+  </class>\n \n-    <!-- Make a special renderer for the columns so we can control them\n+  <!-- Make a special renderer for the columns so we can control them\n       with a template\n     -->\n-    <adapter\n+  <adapter\n       factory="..manager.ColumnPortletManagerRenderer"\n       provides="plone.portlets.interfaces.IPortletManagerRenderer"\n       />\n \n-    <adapter\n+  <adapter\n       factory="..manager.DashboardPortletManagerRenderer"\n       provides="plone.portlets.interfaces.IPortletManagerRenderer"\n       />\n \n-    <!-- Namespace traversal adapters for various types of portlets -->\n-    <adapter\n-        factory=".traversal.ContextPortletNamespace"\n-        name="contextportlets"\n-        />\n-    <adapter\n-        factory=".traversal.DashboardNamespace"\n-        name="dashboard"\n-        />\n-    <adapter\n-        factory=".traversal.GroupPortletNamespace"\n-        name="groupportlets"\n-        />\n-    <adapter\n-        factory=".traversal.GroupDashboardNamespace"\n-        name="groupdashboard"\n-        />\n-    <adapter\n-        factory=".traversal.ContentTypePortletNamespace"\n-        name="contenttypeportlets"\n-        />\n+  <!-- Namespace traversal adapters for various types of portlets -->\n+  <adapter\n+      factory=".traversal.ContextPortletNamespace"\n+      name="contextportlets"\n+      />\n+  <adapter\n+      factory=".traversal.DashboardNamespace"\n+      name="dashboard"\n+      />\n+  <adapter\n+      factory=".traversal.GroupPortletNamespace"\n+      name="groupportlets"\n+      />\n+  <adapter\n+      factory=".traversal.GroupDashboardNamespace"\n+      name="groupdashboard"\n+      />\n+  <adapter\n+      factory=".traversal.ContentTypePortletNamespace"\n+      name="contenttypeportlets"\n+      />\n \n-    <!-- Portlet management pages -->\n+  <!-- Portlet management pages -->\n \n-    <browser:page\n-        for="*"\n-        name="manage-portlets-macros"\n-        class=".manage.ManageContextualPortlets"\n-        template="templates/edit-manager-macros.pt"\n-        permission="plone.app.portlets.ManageOwnPortlets"\n-        />\n+  <browser:page\n+      name="manage-portlets-macros"\n+      for="*"\n+      class=".manage.ManageContextualPortlets"\n+      template="templates/edit-manager-macros.pt"\n+      permission="plone.app.portlets.ManageOwnPortlets"\n+      />\n \n-    <browser:page\n+  <browser:page\n+      name="topbar-manage-portlets"\n       for="plone.portlets.interfaces.ILocalPortletAssignable"\n       class=".manage.TopbarManagePortlets"\n-      permission="plone.app.portlets.ManagePortlets"\n-      name="topbar-manage-portlets"\n       template="templates/topbar-manage-portlets.pt"\n+      permission="plone.app.portlets.ManagePortlets"\n       />\n \n \n-    <browser:pages\n+  <browser:pages\n       for="plone.portlets.interfaces.ILocalPortletAssignable"\n       class=".manage.ManageContextualPortlets"\n       permission="plone.app.portlets.ManagePortlets"\n       >\n \n-      <browser:page\n+    <browser:page\n         name="manage-portlets"\n         template="templates/manage-contextual.pt"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="convert-legacy-portlets"\n         attribute="convert_legacy_portlets"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="set-portlet-blacklist-status"\n         attribute="set_blacklist_status"\n         />\n \n-    </browser:pages>\n+  </browser:pages>\n \n-    <browser:page\n+  <browser:page\n+      name="manage-dashboard"\n       for="plone.app.layout.navigation.interfaces.INavigationRoot"\n       class=".manage.ManageDashboardPortlets"\n-      name="manage-dashboard"\n       template="templates/manage-dashboard.pt"\n       permission="plone.app.portlets.ManageOwnPortlets"\n       />\n \n-    <browser:page\n+  <browser:page\n+      name="manage-content-type-portlets"\n       for="Products.CMFCore.interfaces.ISiteRoot"\n       class=".manage.ManageContentTypePortlets"\n-      name="manage-content-type-portlets"\n       template="templates/manage-content-type.pt"\n       permission="plone.app.portlets.ManagePortlets"\n       />\n \n-    <browser:page\n+  <browser:page\n+      name="manage-group-portlets"\n       for="Products.CMFCore.interfaces.ISiteRoot"\n       class=".manage.ManageGroupPortlets"\n-      name="manage-group-portlets"\n       template="templates/manage-group.pt"\n       permission="plone.app.portlets.ManagePortlets"\n       />\n \n-    <browser:page\n+  <browser:page\n+      name="manage-group-dashboard"\n       for="Products.CMFCore.interfaces.ISiteRoot"\n       class=".manage.ManageGroupDashboardPortlets"\n-      name="manage-group-dashboard"\n       template="templates/manage-group-dashboard.pt"\n       permission="plone.app.portlets.ManagePortlets"\n       />\n \n-    <!-- Renderer for the columns in edit mode -->\n-    <adapter\n-        factory=".editmanager.EditPortletManagerRenderer"\n-        provides="plone.portlets.interfaces.IPortletManagerRenderer"\n-        />\n-    <adapter\n-        factory=".editmanager.ContextualEditPortletManagerRenderer"\n-        provides="plone.portlets.interfaces.IPortletManagerRenderer"\n-        />\n-    <adapter\n-        factory=".editmanager.DashboardEditPortletManagerRenderer"\n-        provides="plone.portlets.interfaces.IPortletManagerRenderer"\n-        />\n+  <!-- Renderer for the columns in edit mode -->\n+  <adapter\n+      factory=".editmanager.EditPortletManagerRenderer"\n+      provides="plone.portlets.interfaces.IPortletManagerRenderer"\n+      />\n+  <adapter\n+      factory=".editmanager.ContextualEditPortletManagerRenderer"\n+      provides="plone.portlets.interfaces.IPortletManagerRenderer"\n+      />\n+  <adapter\n+      factory=".editmanager.DashboardEditPortletManagerRenderer"\n+      provides="plone.portlets.interfaces.IPortletManagerRenderer"\n+      />\n \n \n-    <!-- Operations on portlets when in edit mode -->\n-    <browser:pages\n+  <!-- Operations on portlets when in edit mode -->\n+  <browser:pages\n       for="plone.portlets.interfaces.IPortletAssignmentMapping"\n       class=".editmanager.ManagePortletAssignments"\n       permission="plone.app.portlets.ManageOwnPortlets"\n       >\n \n-      <browser:page\n+    <browser:page\n         name="delete-portlet"\n         attribute="delete_portlet"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="move-portlet-up"\n         attribute="move_portlet_up"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="move-portlet-down"\n         attribute="move_portlet_down"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="toggle-visibility"\n         attribute="toggle_visibility"\n         />\n \n-    </browser:pages>\n+  </browser:pages>\n \n-    <!-- Adding view for portlet assignments -->\n-    <browser:view\n-      for="plone.portlets.interfaces.IPortletAssignmentMapping"\n+  <!-- Adding view for portlet assignments -->\n+  <browser:view\n       name="+"\n+      for="plone.portlets.interfaces.IPortletAssignmentMapping"\n       class=".adding.PortletAdding"\n       allowed_interface="plone.app.portlets.browser.interfaces.IPortletAdding"\n       permission="plone.app.portlets.ManagePortlets"\n       />\n \n-    <browser:view\n-      for="plone.app.portlets.interfaces.IUserPortletAssignmentMapping"\n+  <browser:view\n       name="+"\n+      for="plone.app.portlets.interfaces.IUserPortletAssignmentMapping"\n       class="plone.app.portlets.browser.adding.PortletAdding"\n       allowed_interface="plone.app.portlets.browser.interfaces.IPortletAdding"\n-      permission="plone.app.portlets.ManageOwnPortlets" />\n+      permission="plone.app.portlets.ManageOwnPortlets"\n+      />\n \n \n-    <class class=".adding.PortletAdding">\n-      <require\n+  <class class=".adding.PortletAdding">\n+    <require\n         permission="plone.app.portlets.ManagePortlets"\n-        interface=".interfaces.IPortletAdding" />\n-    </class>\n+        interface=".interfaces.IPortletAdding"\n+        />\n+  </class>\n \n-    <!-- Get pretty templates on our add and edit pages -->\n-    <configure package="Products.CMFPlone.browser">\n+  <!-- Get pretty templates on our add and edit pages -->\n+  <configure package="Products.CMFPlone.browser">\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.portlets.interfaces.IPortletAssignment"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.portlets.interfaces.IPortletAssignmentMapping"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-      <browser:page\n+    <browser:page\n         name="five_template"\n         for="plone.app.portlets.browser.interfaces.IPortletAdding"\n         template="templates/five_template.pt"\n         permission="zope2.View"\n         />\n \n-    </configure>\n+  </configure>\n \n-    <browser:page\n-        for="*"\n-        name="render-portlet"\n-        class=".utils.PortletUtilities"\n-        attribute="render_portlet"\n-        permission="zope2.View"\n-        />\n+  <browser:page\n+      name="render-portlet"\n+      for="*"\n+      class=".utils.PortletUtilities"\n+      attribute="render_portlet"\n+      permission="zope2.View"\n+      />\n \n-    <!-- Portlets Footer -->\n-    <browser:viewlet\n-        name="plone.footer"\n-        for="*"\n-        manager="plone.app.layout.viewlets.interfaces.IPortalFooter"\n-        class=".viewlets.FooterViewlet"\n-        permission="zope.Public"\n-        />\n+  <!-- Portlets Footer -->\n+  <browser:viewlet\n+      name="plone.footer"\n+      for="*"\n+      manager="plone.app.layout.viewlets.interfaces.IPortalFooter"\n+      class=".viewlets.FooterViewlet"\n+      permission="zope.Public"\n+      />\n \n-    <!-- Manage portlets Fallback link -->\n-    <browser:viewlet\n-        name="plone.manage_portlets_fallback"\n-        for="plone.portlets.interfaces.ILocalPortletAssignable"\n-        view="plone.app.layout.globals.interfaces.IViewView"\n-        manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n-        class=".viewlets.ManagePortletsFallbackViewlet"\n-        permission="zope2.View"\n-        />\n+  <!-- Manage portlets Fallback link -->\n+  <browser:viewlet\n+      name="plone.manage_portlets_fallback"\n+      for="plone.portlets.interfaces.ILocalPortletAssignable"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager="plone.app.layout.viewlets.interfaces.IBelowContent"\n+      class=".viewlets.ManagePortletsFallbackViewlet"\n+      permission="zope2.View"\n+      />\n \n </configure>\ndiff --git a/plone/app/portlets/browser/editmanager.py b/plone/app/portlets/browser/editmanager.py\nindex 5e5842b2..11d1a978 100644\n--- a/plone/app/portlets/browser/editmanager.py\n+++ b/plone/app/portlets/browser/editmanager.py\n@@ -9,6 +9,7 @@\n from Acquisition import Explicit\n from Acquisition.interfaces import IAcquirer\n from five.customerize.zpt import TTWViewTemplateRenderer\n+from plone.base.interfaces import IPloneSiteRoot\n from plone.memoize.view import memoize\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n from plone.portlets.constants import CONTEXT_CATEGORY\n@@ -20,7 +21,6 @@\n from plone.portlets.interfaces import IPortletManagerRenderer\n from plone.portlets.utils import hashPortletInfo\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import IPloneSiteRoot\n from Products.Five.browser import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.PythonScripts.standard import url_quote\n@@ -93,7 +93,7 @@ def view_name(self):\n                     Unauthorized,\n                 ):\n                     logging.getLogger("plone.app.portlets.browser").debug(\n-                        "Cant get view name for TTV %s" % self.__parent__\n+                        "Can\'t get view name for TTW %s" % self.__parent__\n                     )\n         return name\n \n@@ -392,9 +392,10 @@ def global_portlets(self, category, prefix):\n                 mapping = self.manager.get(category, None)\n                 assignments = []\n                 if mapping is not None:\n-                    is_visible = lambda a: IPortletAssignmentSettings(a).get(\n-                        "visible", True\n-                    )\n+\n+                    def is_visible(a):\n+                        return IPortletAssignmentSettings(a).get("visible", True)\n+\n                     assignments.extend(\n                         [a for a in mapping.get(key, {}).values() if is_visible(a)]\n                     )\ndiff --git a/plone/app/portlets/browser/formhelper.py b/plone/app/portlets/browser/formhelper.py\nindex 3a104c73..bb053fe2 100644\n--- a/plone/app/portlets/browser/formhelper.py\n+++ b/plone/app/portlets/browser/formhelper.py\n@@ -30,7 +30,7 @@ class AddForm(AutoExtensibleForm, form.AddForm):\n \n     Sub-classes should define create() and set the form_fields class variable.\n \n-    Notice the suble difference between AddForm and NullAddform in that the\n+    Notice the subtle difference between AddForm and NullAddform in that the\n     create template method for AddForm takes as a parameter a dict \'data\':\n \n         def create(self, data):\ndiff --git a/plone/app/portlets/browser/interfaces.py b/plone/app/portlets/browser/interfaces.py\nindex 6ce29538..795beabe 100644\n--- a/plone/app/portlets/browser/interfaces.py\n+++ b/plone/app/portlets/browser/interfaces.py\n@@ -45,7 +45,7 @@ class IManageDashboardPortletsView(IManagePortletsView):\n \n \n class IManageColumnPortletsView(IManagePortletsView):\n-    """Base class for views that should display the edit fuctionality\n+    """Base class for views that should display the edit functionality\n     for column portlets.\n \n     This allows us to register a generic portlet manager renderer for this\ndiff --git a/plone/app/portlets/browser/manage.py b/plone/app/portlets/browser/manage.py\nindex 0face36a..1c970240 100644\n--- a/plone/app/portlets/browser/manage.py\n+++ b/plone/app/portlets/browser/manage.py\n@@ -120,7 +120,6 @@ def convert_legacy_portlets(self):\n \n @implementer(IManageDashboardPortletsView)\n class ManageDashboardPortlets(BrowserView):\n-\n     # IManagePortletsView implementation\n \n     @property\n@@ -212,7 +211,6 @@ def getAssignmentsForManager(self, manager):\n \n @implementer(IManageGroupPortletsView)\n class ManageGroupPortlets(BrowserView):\n-\n     # IManagePortletsView implementation\n \n     @property\ndiff --git a/plone/app/portlets/browser/templates/column.pt b/plone/app/portlets/browser/templates/column.pt\nindex 5f01c0d6..b3dd4828 100644\n--- a/plone/app/portlets/browser/templates/column.pt\n+++ b/plone/app/portlets/browser/templates/column.pt\n@@ -1,6 +1,9 @@\n <tal:block repeat="portlet options/portlets">\n-<div class="portletWrapper"\n-    tal:attributes="id string:portletwrapper-${portlet/hash};\n-                     data-portlethash portlet/hash"\n-     tal:content="structure python:view.safe_render(portlet[\'renderer\'])" />\n+  <div class="portletWrapper"\n+       tal:content="structure python:view.safe_render(portlet[\'renderer\'])"\n+       tal:attributes="\n+         id string:portletwrapper-${portlet/hash};\n+         data-portlethash portlet/hash;\n+       "\n+  ></div>\n </tal:block>\ndiff --git a/plone/app/portlets/browser/templates/dashboard-column.pt b/plone/app/portlets/browser/templates/dashboard-column.pt\nindex 0d59beba..1a5bde69 100644\n--- a/plone/app/portlets/browser/templates/dashboard-column.pt\n+++ b/plone/app/portlets/browser/templates/dashboard-column.pt\n@@ -1,5 +1,8 @@\n <tal:block repeat="portlet options/portlets">\n-<div tal:attributes="id string:portletwrapper-${portlet/hash};\n-                     data-portlethash portlet/hash"\n-     tal:content="structure python:view.safe_render(portlet[\'renderer\'])" />\n+  <div tal:content="structure python:view.safe_render(portlet[\'renderer\'])"\n+       tal:attributes="\n+         id string:portletwrapper-${portlet/hash};\n+         data-portlethash portlet/hash;\n+       "\n+  ></div>\n </tal:block>\ndiff --git a/plone/app/portlets/browser/templates/edit-manager-contextual.pt b/plone/app/portlets/browser/templates/edit-manager-contextual.pt\nindex 4e3ac302..085756f8 100644\n--- a/plone/app/portlets/browser/templates/edit-manager-contextual.pt\n+++ b/plone/app/portlets/browser/templates/edit-manager-contextual.pt\n@@ -1,69 +1,107 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n-<div class="portlets-manager pat-manage-portlets row"\n-     tal:attributes="id string:portletmanager-${view/normalized_manager_name};"\n-     i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n+  <div class="portlets-manager pat-manage-portlets row"\n+       tal:attributes="\n+         id string:portletmanager-${view/normalized_manager_name};\n+       "\n+       i18n:domain="plone"\n+  >\n \n-  <div class="container">\n-    <div metal:use-macro="context/@@manage-portlets-macros/macros/portlet-add-form" />\n-  </div>\n+    <div class="container">\n+      <div metal:use-macro="context/@@manage-portlets-macros/macros/portlet-add-form"></div>\n+    </div>\n \n-  <div metal:use-macro="context/@@manage-portlets-macros/macros/current-portlets-list" />\n+    <div metal:use-macro="context/@@manage-portlets-macros/macros/current-portlets-list"></div>\n \n-  <div class="container portletAssignments">\n+    <div class="container portletAssignments">\n \n-    <h5 i18n:translate="heading_un_block_portlets">\n+      <h5 i18n:translate="heading_un_block_portlets">\n         Block/unblock portlets\n-    </h5>\n-\n-    <form method="post" tal:attributes="action view/blacklist_status_action" class="portlets-settings">\n-\n-        <span tal:replace="structure context/@@authenticator/authenticator" />\n-        <input type="hidden" name="manager" tal:attributes="value view/manager_name" />\n-\n-        <div tal:define="status view/context_blacklist_status" class="mb-3 portlet-group">\n+      </h5>\n+\n+      <form class="portlets-settings"\n+            method="post"\n+            tal:attributes="\n+              action view/blacklist_status_action;\n+            "\n+      >\n+\n+        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+        <input name="manager"\n+               type="hidden"\n+               tal:attributes="\n+                 value view/manager_name;\n+               "\n+        />\n+\n+        <div class="mb-3 portlet-group"\n+             tal:define="\n+               status view/context_blacklist_status;\n+             "\n+        >\n \n           <div class="mb-3">\n \n             <label i18n:translate="label_portlets_parent_folders">Parent portlets:</label>\n \n-            <select name="context_status:int" size="1" class="form-select">\n+            <select class="form-select"\n+                    name="context_status:int"\n+                    size="1"\n+            >\n \n-                <option value="1"\n-                        tal:attributes="selected python:status == True and \'selected\' or None"\n-                        i18n:translate="portlets_value_block">\n+              <option value="1"\n+                      tal:attributes="\n+                        selected python:status == True and \'selected\' or None;\n+                      "\n+                      i18n:translate="portlets_value_block"\n+              >\n                     Block\n-                </option>\n+              </option>\n \n-                <option value="-1"\n-                        tal:attributes="selected python:(status == False or status == None) and \'selected\' or None"\n-                        i18n:translate="portlets_value_show">\n+              <option value="-1"\n+                      tal:attributes="\n+                        selected python:(status == False or status == None) and \'selected\' or None;\n+                      "\n+                      i18n:translate="portlets_value_show"\n+              >\n                     Do not block\n-                </option>\n+              </option>\n \n             </select>\n \n           </div>\n \n-          <tal:block define="portlets view/inherited_portlets;"\n-                    condition="portlets">\n+          <tal:block define="\n+                       portlets view/inherited_portlets;\n+                     "\n+                     condition="portlets"\n+          >\n \n-            <div tal:attributes="class python:status and \'managedPortlet inheritedPortlet blockedPortlet list-group\' or \'managedPortlet inheritedPortlet list-group\'" tal:repeat="portlet portlets">\n+            <div tal:repeat="portlet portlets"\n+                 tal:attributes="\n+                   class python:status and \'managedPortlet inheritedPortlet blockedPortlet list-group\' or \'managedPortlet inheritedPortlet list-group\';\n+                 "\n+            >\n \n               <div class="list-group-item">\n \n-                <a tal:omit-tag="not:portlet/editview"\n-                  tal:attributes="href string:${portlet/editview}?referer=${view/url_quote_referer}"\n-                  tal:content="portlet/title" />\n+                <a tal:content="portlet/title"\n+                   tal:omit-tag="not:portlet/editview"\n+                   tal:attributes="\n+                     href string:${portlet/editview}?referer=${view/url_quote_referer};\n+                   "\n+                ></a>\n \n                 <span class="portletBlockedMessage hiddenStructure"\n-                  tal:condition="status"\n-                  title="Blocked"\n-                  i18n:translate="label_portlet_blocked"\n-                  i18n:attributes="title title_portlet_blocked;">\n+                      title="Blocked"\n+                      tal:condition="status"\n+                      i18n:attributes="title title_portlet_blocked;"\n+                      i18n:translate="label_portlet_blocked"\n+                >\n                   (Blocked)\n                 </span>\n               </div>\n@@ -73,48 +111,74 @@\n \n         </div>\n \n-        <div tal:define="status view/group_blacklist_status" class="mb-3 portlet-group">\n+        <div class="mb-3 portlet-group"\n+             tal:define="\n+               status view/group_blacklist_status;\n+             "\n+        >\n \n           <label i18n:translate="label_portlets_group_portlets">Group portlets:</label>\n \n-          <select name="group_status:int" size="1" class="form-select">\n-\n-              <option value="0"\n-                      tal:attributes="selected python:status == None and \'selected\' or None"\n-                      i18n:translate="portlets_value_use_parent">\n+          <select class="form-select"\n+                  name="group_status:int"\n+                  size="1"\n+          >\n+\n+            <option value="0"\n+                    tal:attributes="\n+                      selected python:status == None and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_use_parent"\n+            >\n                   Use parent settings\n-              </option>\n-\n-              <option value="1"\n-                      tal:attributes="selected python:status == True and \'selected\' or None"\n-                      i18n:translate="portlets_value_block">\n+            </option>\n+\n+            <option value="1"\n+                    tal:attributes="\n+                      selected python:status == True and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_block"\n+            >\n                   Block\n-              </option>\n-\n-              <option value="-1"\n-                      tal:attributes="selected python:status == False and \'selected\' or None"\n-                      i18n:translate="portlets_value_show">\n+            </option>\n+\n+            <option value="-1"\n+                    tal:attributes="\n+                      selected python:status == False and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_show"\n+            >\n                   Do not block\n-              </option>\n+            </option>\n \n           </select>\n \n-          <tal:block define="portlets view/group_portlets;\n-                            status python:view.group_blacklist_status(check_parent=True)">\n+          <tal:block define="\n+                       portlets view/group_portlets;\n+                       status python:view.group_blacklist_status(check_parent=True);\n+                     ">\n \n-            <div tal:attributes="class python:status and \'managedPortlet inheritedPortlet blockedPortlet\' or \'managedPortlet inheritedPortlet\'" tal:repeat="portlet portlets">\n+            <div tal:repeat="portlet portlets"\n+                 tal:attributes="\n+                   class python:status and \'managedPortlet inheritedPortlet blockedPortlet\' or \'managedPortlet inheritedPortlet\';\n+                 "\n+            >\n \n               <div class="portletHeader">\n \n-                <a tal:omit-tag="not:portlet/editview"\n-                  tal:attributes="href string:${portlet/editview}?referer=${view/url_quote_referer}"\n-                  tal:content="portlet/title" />\n+                <a tal:content="portlet/title"\n+                   tal:omit-tag="not:portlet/editview"\n+                   tal:attributes="\n+                     href string:${portlet/editview}?referer=${view/url_quote_referer};\n+                   "\n+                ></a>\n \n                 <span class="portletBlockedMessage hiddenStructure"\n-                  tal:condition="status"\n-                  title="Blocked"\n-                  i18n:translate="label_portlet_blocked"\n-                  i18n:attributes="title title_portlet_blocked;">\n+                      title="Blocked"\n+                      tal:condition="status"\n+                      i18n:attributes="title title_portlet_blocked;"\n+                      i18n:translate="label_portlet_blocked"\n+                >\n                   (Blocked)\n                 </span>\n \n@@ -127,46 +191,71 @@\n         </div>\n \n \n-        <div tal:define="status view/content_type_blacklist_status" class="mb-3 portlet-group">\n+        <div class="mb-3 portlet-group"\n+             tal:define="\n+               status view/content_type_blacklist_status;\n+             "\n+        >\n \n           <label i18n:translate="label_portlets_content_type_portlets">Content type portlets:</label>\n \n-          <select name="content_type_status:int" size="1"  class="form-select">\n-\n-              <option value="0"\n-                      tal:attributes="selected python:status == None and \'selected\' or None"\n-                      i18n:translate="portlets_value_use_parent">\n+          <select class="form-select"\n+                  name="content_type_status:int"\n+                  size="1"\n+          >\n+\n+            <option value="0"\n+                    tal:attributes="\n+                      selected python:status == None and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_use_parent"\n+            >\n                   Use parent settings\n-              </option>\n-\n-              <option value="1"\n-                      tal:attributes="selected python:status == True and \'selected\' or None"\n-                      i18n:translate="portlets_value_block">\n+            </option>\n+\n+            <option value="1"\n+                    tal:attributes="\n+                      selected python:status == True and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_block"\n+            >\n                   Block\n-              </option>\n-\n-              <option value="-1"\n-                      tal:attributes="selected python:status == False and \'selected\' or None"\n-                      i18n:translate="portlets_value_show">\n+            </option>\n+\n+            <option value="-1"\n+                    tal:attributes="\n+                      selected python:status == False and \'selected\' or None;\n+                    "\n+                    i18n:translate="portlets_value_show"\n+            >\n                   Do not block\n-              </option>\n+            </option>\n           </select>\n \n-          <tal:block define="portlets view/content_type_portlets;\n-                    status python:view.content_type_blacklist_status(check_parent=True)">\n+          <tal:block define="\n+                       portlets view/content_type_portlets;\n+                       status python:view.content_type_blacklist_status(check_parent=True);\n+                     ">\n \n-            <div tal:attributes="class python:status and \'managedPortlet inheritedPortlet blockedPortlet\' or \'managedPortlet inheritedPortlet\'"\n-              tal:repeat="portlet portlets">\n+            <div tal:repeat="portlet portlets"\n+                 tal:attributes="\n+                   class python:status and \'managedPortlet inheritedPortlet blockedPortlet\' or \'managedPortlet inheritedPortlet\';\n+                 "\n+            >\n               <div class="portletHeader">\n-                <a tal:omit-tag="not:portlet/editview"\n-                  tal:attributes="href string:${portlet/editview}?referer=${view/url_quote_referer}"\n-                  tal:content="portlet/title" />\n+                <a tal:content="portlet/title"\n+                   tal:omit-tag="not:portlet/editview"\n+                   tal:attributes="\n+                     href string:${portlet/editview}?referer=${view/url_quote_referer};\n+                   "\n+                ></a>\n \n                 <span class="portletBlockedMessage hiddenStructure"\n-                  tal:condition="status"\n-                  title="Blocked"\n-                  i18n:translate="label_portlet_blocked"\n-                  i18n:attributes="title title_portlet_blocked;">\n+                      title="Blocked"\n+                      tal:condition="status"\n+                      i18n:attributes="title title_portlet_blocked;"\n+                      i18n:translate="label_portlet_blocked"\n+                >\n                   (Blocked)\n                 </span>\n \n@@ -177,17 +266,18 @@\n         </div>\n \n         <noscript>\n-        <div class="formControls">\n+          <div class="formControls">\n             <input class="btn btn-primary"\n-                  type="submit"\n-                  value="Save settings"\n-                  i18n:attributes="value label_save_settings"/>\n-        </div>\n+                   type="submit"\n+                   value="Save settings"\n+                   i18n:attributes="value label_save_settings"\n+            />\n+          </div>\n         </noscript>\n \n       </form>\n \n-  </div>\n+    </div>\n \n-</div>\n-</html>\n\\ No newline at end of file\n+  </div>\n+</html>\ndiff --git a/plone/app/portlets/browser/templates/edit-manager-macros.pt b/plone/app/portlets/browser/templates/edit-manager-macros.pt\nindex a4d0ac1a..3abd7d6d 100644\n--- a/plone/app/portlets/browser/templates/edit-manager-macros.pt\n+++ b/plone/app/portlets/browser/templates/edit-manager-macros.pt\n@@ -1,129 +1,314 @@\n-<div metal:define-macro="portlet-add-form" class="section mb-4" i18n:domain="plone">\n+<div class="section mb-4"\n+     metal:define-macro="portlet-add-form"\n+     i18n:domain="plone"\n+>\n \n-    <form method="post" action="#"\n-          tal:define="portlets view/addable_portlets"\n-          tal:condition="portlets"\n-          tal:attributes="action view/context_url">\n+  <form action="#"\n+        method="post"\n+        tal:define="\n+          portlets view/addable_portlets;\n+        "\n+        tal:condition="portlets"\n+        tal:attributes="\n+          action view/context_url;\n+        "\n+  >\n \n-        <input type="hidden" name="referer" tal:attributes="value view/referer" />\n+    <input name="referer"\n+           type="hidden"\n+           tal:attributes="\n+             value view/referer;\n+           "\n+    />\n \n-        <label class="hiddenStructure"\n-               i18n:translate="label_add_portlet">\n+    <label class="hiddenStructure"\n+           i18n:translate="label_add_portlet"\n+    >\n             Add portlet\n-        </label>\n+    </label>\n \n-        <select name=":action" class="add-portlet form-select"\n-                tal:attributes="data-context-url python: view.context_url()">\n-            <option tal:attributes="value python:request[\'ACTUAL_URL\'].replace(view.context_url(), \'\')"\n-                    i18n:translate="label_add_portlet_ellipsis">\n+    <select class="add-portlet form-select"\n+            name=":action"\n+            tal:attributes="\n+              data-context-url python: view.context_url();\n+            "\n+    >\n+      <option tal:attributes="\n+                value python:request[\'ACTUAL_URL\'].replace(view.context_url(), \'\');\n+              "\n+              i18n:translate="label_add_portlet_ellipsis"\n+      >\n                 Add portlet&hellip;\n-            </option>\n-            <tal:options repeat="portlet portlets">\n-                <option tal:attributes="value string:${portlet/addview}"\n-                        tal:content="portlet/title"\n-                        i18n:translate="" />\n-            </tal:options>\n-\n-        </select>\n-\n-        <noscript>\n-            <input class="btn btn-secondary"\n-                   type="submit"\n-                   value="Add portlet"\n-                   i18n:attributes="value label_add_portlet;"/>\n-        </noscript>\n-\n-    </form>\n+      </option>\n+      <tal:options repeat="portlet portlets">\n+        <option tal:content="portlet/title"\n+                tal:attributes="\n+                  value string:${portlet/addview};\n+                "\n+                i18n:translate=""\n+        ></option>\n+      </tal:options>\n+\n+    </select>\n+\n+    <noscript>\n+      <input class="btn btn-secondary"\n+             type="submit"\n+             value="Add portlet"\n+             i18n:attributes="value label_add_portlet;"\n+      />\n+    </noscript>\n+\n+  </form>\n </div>\n \n-<div metal:define-macro="current-portlets-list" class="portletAssignment"\n-    i18n:domain="plone"\n-    tal:define="portlets view/portlets">\n+<div class="portletAssignment"\n+     metal:define-macro="current-portlets-list"\n+     tal:define="\n+       portlets view/portlets;\n+     "\n+     i18n:domain="plone"\n+>\n \n-    <h5 i18n:translate="heading_portlets_assigned_here" tal:condition="portlets">\n+  <h5 tal:condition="portlets"\n+      i18n:translate="heading_portlets_assigned_here"\n+  >\n         Portlets assigned here\n-    </h5>\n+  </h5>\n \n-    <tal:block repeat="portlet portlets">\n-    <div\n-        tal:define="\n-            hiddenPortletClass python:not portlet[\'visible\'] and \'blockedPortlet\' or \'\';\n-            authenticator context/@@authenticator/authenticator"\n-        tal:attributes="\n-            class string:managedPortlet card mb-3 ${hiddenPortletClass};\n-            data-portlethash portlet/hash;\n-            data-viewname view/view_name;">\n-\n-        <div class="card-header d-flex align-items-center justify-content-between">\n-\n-            <a tal:omit-tag="not:portlet/editview"\n-                tal:attributes="href string:${portlet/editview}?referer=${view/url_quote_referer}"\n-                tal:content="portlet/title"></a>\n-        </div>\n-\n-        <div class="card-body managedPortletActions">\n-\n-            <form class="portlet-action up" method="POST"\n-                tal:attributes="action portlet/up_url"\n-                tal:condition="not:repeat/portlet/start">\n-                <input type="hidden" name="referer" tal:attributes="value view/url_quote_referer" />\n-                <input type="hidden" name="key" tal:attributes="value view/key" />\n-                <input type="hidden" name="name" tal:attributes="value portlet/name" />\n-                <input type="hidden" name="viewname" tal:attributes="value view/view_name" />\n-                <span tal:replace="structure authenticator"/>\n-                <button class="btn btn-outline-secondary btn-sm" title="Move up" i18n:attributes="title" type="submit"\n-                    tal:attributes="name string:${portlet/name}-up">&#9650;</button>\n-            </form>\n-\n-            <form class="portlet-action down" method="POST"\n-                tal:attributes="action portlet/down_url"\n-                tal:condition="not:repeat/portlet/end">\n-                <input type="hidden" name="referer" tal:attributes="value view/url_quote_referer" />\n-                <input type="hidden" name="key" tal:attributes="value view/key" />\n-                <input type="hidden" name="name" tal:attributes="value portlet/name" />\n-                <input type="hidden" name="viewname" tal:attributes="value view/view_name" />\n-                <span tal:replace="structure authenticator"/>\n-                <button class="btn btn-outline-secondary btn-sm" title="Move down" i18n:attributes="title" type="submit"\n-                    tal:attributes="name string:${portlet/name}-down">&#9660;</button>\n-            </form>\n-\n-            <form class="portlet-action" method="POST"\n-                tal:attributes="action portlet/show_url"\n-                tal:condition="not: portlet/visible">\n-                <input type="hidden" name="referer" tal:attributes="value view/url_quote_referer" />\n-                <input type="hidden" name="key" tal:attributes="value view/key" />\n-                <input type="hidden" name="name" tal:attributes="value portlet/name" />\n-                <input type="hidden" name="viewname" tal:attributes="value view/view_name" />\n-                <span tal:replace="structure authenticator"/>\n-                <button class="btn btn-outline-secondary btn-sm" type="submit" i18n:translate="label_show_item"\n-                    tal:attributes="name string:${portlet/name}-show">Show</button>\n-            </form>\n-\n-            <form class="portlet-action" method="POST"\n-                tal:attributes="action portlet/hide_url"\n-                tal:condition="portlet/visible">\n-                <input type="hidden" name="referer" tal:attributes="value view/url_quote_referer" />\n-                <input type="hidden" name="key" tal:attributes="value view/key" />\n-                <input type="hidden" name="name" tal:attributes="value portlet/name" />\n-                <input type="hidden" name="viewname" tal:attributes="value view/view_name" />\n-                <span tal:replace="structure authenticator"/>\n-                <button class="btn btn-outline-secondary btn-sm" type="submit" i18n:translate="label_hide_item"\n-                    tal:attributes="name string:${portlet/name}-hide">Hide</button>\n-            </form>\n-\n-            <form class="portlet-action delete" method="POST"\n-                tal:attributes="action portlet/delete_url">\n-                <input type="hidden" name="referer" tal:attributes="value view/url_quote_referer" />\n-                <input type="hidden" name="key" tal:attributes="value view/key" />\n-                <input type="hidden" name="name" tal:attributes="value portlet/name" />\n-                <input type="hidden" name="viewname" tal:attributes="value view/view_name" />\n-                <span tal:replace="structure authenticator"/>\n-                <button class="btn btn-outline-secondary btn-sm" i18n:attributes="title" title="Remove" type="submit"\n-                    tal:attributes="name string:${portlet/name}-remove">&times;</button>\n-            </form>\n-\n-        </div>\n+  <tal:block repeat="portlet portlets">\n+    <div tal:define="\n+           hiddenPortletClass python:not portlet[\'visible\'] and \'blockedPortlet\' or \'\';\n+           authenticator context/@@authenticator/authenticator;\n+         "\n+         tal:attributes="\n+           class string:managedPortlet card mb-3 ${hiddenPortletClass};\n+           data-portlethash portlet/hash;\n+           data-viewname view/view_name;\n+         "\n+    >\n+\n+      <div class="card-header d-flex align-items-center justify-content-between">\n+\n+        <a tal:content="portlet/title"\n+           tal:omit-tag="not:portlet/editview"\n+           tal:attributes="\n+             href string:${portlet/editview}?referer=${view/url_quote_referer};\n+           "\n+        ></a>\n+      </div>\n+\n+      <div class="card-body managedPortletActions">\n+\n+        <form class="portlet-action up"\n+              method="POST"\n+              tal:condition="not:repeat/portlet/start"\n+              tal:attributes="\n+                action portlet/up_url;\n+              "\n+        >\n+          <input name="referer"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/url_quote_referer;\n+                 "\n+          />\n+          <input name="key"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/key;\n+                 "\n+          />\n+          <input name="name"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value portlet/name;\n+                 "\n+          />\n+          <input name="viewname"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/view_name;\n+                 "\n+          />\n+          <span tal:replace="structure authenticator"></span>\n+          <button class="btn btn-outline-secondary btn-sm"\n+                  title="Move up"\n+                  type="submit"\n+                  tal:attributes="\n+                    name string:${portlet/name}-up;\n+                  "\n+                  i18n:attributes="title"\n+          >&#9650;</button>\n+        </form>\n+\n+        <form class="portlet-action down"\n+              method="POST"\n+              tal:condition="not:repeat/portlet/end"\n+              tal:attributes="\n+                action portlet/down_url;\n+              "\n+        >\n+          <input name="referer"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/url_quote_referer;\n+                 "\n+          />\n+          <input name="key"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/key;\n+                 "\n+          />\n+          <input name="name"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value portlet/name;\n+                 "\n+          />\n+          <input name="viewname"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/view_name;\n+                 "\n+          />\n+          <span tal:replace="structure authenticator"></span>\n+          <button class="btn btn-outline-secondary btn-sm"\n+                  title="Move down"\n+                  type="submit"\n+                  tal:attributes="\n+                    name string:${portlet/name}-down;\n+                  "\n+                  i18n:attributes="title"\n+          >&#9660;</button>\n+        </form>\n+\n+        <form class="portlet-action"\n+              method="POST"\n+              tal:condition="not: portlet/visible"\n+              tal:attributes="\n+                action portlet/show_url;\n+              "\n+        >\n+          <input name="referer"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/url_quote_referer;\n+                 "\n+          />\n+          <input name="key"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/key;\n+                 "\n+          />\n+          <input name="name"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value portlet/name;\n+                 "\n+          />\n+          <input name="viewname"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/view_name;\n+                 "\n+          />\n+          <span tal:replace="structure authenticator"></span>\n+          <button class="btn btn-outline-secondary btn-sm"\n+                  type="submit"\n+                  tal:attributes="\n+                    name string:${portlet/name}-show;\n+                  "\n+                  i18n:translate="label_show_item"\n+          >Show</button>\n+        </form>\n+\n+        <form class="portlet-action"\n+              method="POST"\n+              tal:condition="portlet/visible"\n+              tal:attributes="\n+                action portlet/hide_url;\n+              "\n+        >\n+          <input name="referer"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/url_quote_referer;\n+                 "\n+          />\n+          <input name="key"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/key;\n+                 "\n+          />\n+          <input name="name"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value portlet/name;\n+                 "\n+          />\n+          <input name="viewname"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/view_name;\n+                 "\n+          />\n+          <span tal:replace="structure authenticator"></span>\n+          <button class="btn btn-outline-secondary btn-sm"\n+                  type="submit"\n+                  tal:attributes="\n+                    name string:${portlet/name}-hide;\n+                  "\n+                  i18n:translate="label_hide_item"\n+          >Hide</button>\n+        </form>\n+\n+        <form class="portlet-action delete"\n+              method="POST"\n+              tal:attributes="\n+                action portlet/delete_url;\n+              "\n+        >\n+          <input name="referer"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/url_quote_referer;\n+                 "\n+          />\n+          <input name="key"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/key;\n+                 "\n+          />\n+          <input name="name"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value portlet/name;\n+                 "\n+          />\n+          <input name="viewname"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value view/view_name;\n+                 "\n+          />\n+          <span tal:replace="structure authenticator"></span>\n+          <button class="btn btn-outline-secondary btn-sm"\n+                  title="Remove"\n+                  type="submit"\n+                  tal:attributes="\n+                    name string:${portlet/name}-remove;\n+                  "\n+                  i18n:attributes="title"\n+          >&times;</button>\n+        </form>\n+\n+      </div>\n \n     </div>\n-    </tal:block>\n+  </tal:block>\n </div>\ndiff --git a/plone/app/portlets/browser/templates/edit-manager.pt b/plone/app/portlets/browser/templates/edit-manager.pt\nindex 55421e75..ab741186 100644\n--- a/plone/app/portlets/browser/templates/edit-manager.pt\n+++ b/plone/app/portlets/browser/templates/edit-manager.pt\n@@ -1,14 +1,18 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n-<div class="portlets-manager pat-manage-portlets"\n-     tal:attributes="id string:portletmanager-${view/normalized_manager_name};">\n+      tal:omit-tag=""\n+>\n+  <div class="portlets-manager pat-manage-portlets"\n+       tal:attributes="\n+         id string:portletmanager-${view/normalized_manager_name};\n+       "\n+  >\n \n-  <div metal:use-macro="context/@@manage-portlets-macros/macros/portlet-add-form" />\n+    <div metal:use-macro="context/@@manage-portlets-macros/macros/portlet-add-form"></div>\n \n-  <div metal:use-macro="context/@@manage-portlets-macros/macros/current-portlets-list" />\n+    <div metal:use-macro="context/@@manage-portlets-macros/macros/current-portlets-list"></div>\n \n-</div>\n+  </div>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/error_message.pt b/plone/app/portlets/browser/templates/error_message.pt\nindex 536b5f59..4b964967 100644\n--- a/plone/app/portlets/browser/templates/error_message.pt\n+++ b/plone/app/portlets/browser/templates/error_message.pt\n@@ -1,17 +1,20 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n-<section class="portlet portletError"\n-    i18n:domain="plone">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n+  <section class="portlet portletError"\n+           i18n:domain="plone"\n+  >\n \n     <header class="portletHeader">\n-        <a href="#"\n-           class="tile"\n-           i18n:translate="box_error">Error</a>\n+      <a class="tile"\n+         href="#"\n+         i18n:translate="box_error"\n+      >Error</a>\n     </header>\n     <section class="portletContent">\n-        <p i18n:translate="text_error_rendering_portlet">There was an error while rendering the portlet.</p>\n+      <p i18n:translate="text_error_rendering_portlet">There was an error while rendering the portlet.</p>\n     </section>\n-</section>\n+  </section>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/footer.pt b/plone/app/portlets/browser/templates/footer.pt\nindex df16ba9d..51f14d6c 100644\n--- a/plone/app/portlets/browser/templates/footer.pt\n+++ b/plone/app/portlets/browser/templates/footer.pt\n@@ -1,5 +1,7 @@\n <div class="row">\n-\t<div class="col-xs-12">\n-\t\t<div tal:on-error="nothing" tal:replace="structure view/render_footer_portlets" />\n-\t</div>\n+  <div class="col-xs-12">\n+    <div tal:replace="structure view/render_footer_portlets"\n+         tal:on-error="nothing"\n+    ></div>\n+  </div>\n </div>\ndiff --git a/plone/app/portlets/browser/templates/manage-content-type.pt b/plone/app/portlets/browser/templates/manage-content-type.pt\nindex b2d0f1a5..1b149b69 100644\n--- a/plone/app/portlets/browser/templates/manage-content-type.pt\n+++ b/plone/app/portlets/browser/templates/manage-content-type.pt\n@@ -1,41 +1,51 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n-<body>\n-<metal:main fill-slot="main">\n+  <body>\n+    <metal:main fill-slot="main">\n \n-  <h1 class="documentFirstHeading"\n-      i18n:translate="title_manage_contenttype_portlets">\n-      <img i18n:name="contenttype_icon"\n-           tal:define="icon view/portal_type_icon"\n-           tal:replace="structure icon/html_tag" />\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="title_manage_contenttype_portlets"\n+      >\n+        <img tal:define="\n+               icon view/portal_type_icon;\n+             "\n+             tal:replace="structure icon/html_tag"\n+             i18n:name="contenttype_icon"\n+        />\n       Manage content type portlets for\n-      <span i18n:name="contenttype_name" tal:content="view/portal_type">content type</span>\n-  </h1>\n+        <span tal:content="view/portal_type"\n+              i18n:name="contenttype_name"\n+        >content type</span>\n+      </h1>\n \n-  <div id="content-core">\n-      <a href=""\n-           class="link-parent"\n-           tal:attributes="href string:${context/absolute_url}/@@content-controlpanel?type_id=${request/key}"\n-           i18n:translate="return_to_view">\n+      <div id="content-core">\n+        <a class="link-parent"\n+           href=""\n+           tal:attributes="\n+             href string:${context/absolute_url}/@@content-controlpanel?type_id=${request/key};\n+           "\n+           i18n:translate="return_to_view"\n+        >\n         Return\n-      </a>\n+        </a>\n \n-      <p i18n:translate="description_manage_contenttype_portlets">\n+        <p i18n:translate="description_manage_contenttype_portlets">\n         The left and right portlet slots will now display only those portlets\n         assigned to this content type. Use the up, down, delete and edit links\n         to manage user portlets. Use the drop-down list to add new portlets.\n-      </p>\n+        </p>\n \n-      <p i18n:translate="description_contenttype_portlets_below">\n+        <p i18n:translate="description_contenttype_portlets_below">\n         Note that content type portlets are normally rendered below context portlets.\n-      </p>\n-  </div>\n+        </p>\n+      </div>\n \n-</metal:main>\n-</body>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/manage-contextual.pt b/plone/app/portlets/browser/templates/manage-contextual.pt\nindex 1cf4829f..b9e5832a 100644\n--- a/plone/app/portlets/browser/templates/manage-contextual.pt\n+++ b/plone/app/portlets/browser/templates/manage-contextual.pt\n@@ -1,94 +1,121 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n-<body>\n-<metal:main fill-slot="main" tal:define="plone_view context/@@plone">\n+  <body>\n+    <metal:main fill-slot="main"\n+                tal:define="\n+                  plone_view context/@@plone;\n+                "\n+    >\n \n-  <header>\n-    <h1 class="documentFirstHeading"\n-        i18n:translate="title_manage_contextual_portlets">\n+      <header>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="title_manage_contextual_portlets"\n+        >\n         Manage portlets for\n-        <q i18n:name="context_title" tal:content="context/Title">title</q>\n-    </h1>\n-    \n-    \n-    <a href=""\n-        class="link-parent d-inline-block mb-3"\n-        tal:attributes="href string:${context/absolute_url}"\n-        i18n:translate="return_to_view">\n+          <q tal:content="context/Title"\n+             i18n:name="context_title"\n+          >title</q>\n+        </h1>\n+\n+\n+        <a class="link-parent d-inline-block mb-3"\n+           href=""\n+           tal:attributes="\n+             href string:${context/absolute_url};\n+           "\n+           i18n:translate="return_to_view"\n+        >\n       Return\n-    </a>\n+        </a>\n \n-    <tal:block tal:define="is_portal_root context/@@plone_context_state/is_portal_root;"\n-            tal:condition="not:is_portal_root">\n-    <a class="link-parent mb-3 ms-3" tal:condition="plone_view/getParentObject|nothing"\n-    tal:attributes="href python:plone_view.getParentObject().absolute_url()+\'/@@manage-portlets\'"\n-    i18n:translate="">\n+        <tal:block tal:define="\n+                     is_portal_root context/@@plone_context_state/is_portal_root;\n+                   "\n+                   tal:condition="not:is_portal_root"\n+        >\n+          <a class="link-parent mb-3 ms-3"\n+             tal:condition="plone_view/getParentObject|nothing"\n+             tal:attributes="\n+               href python:plone_view.getParentObject().absolute_url()+\'/@@manage-portlets\';\n+             "\n+             i18n:translate=""\n+          >\n     Go to parent folder\n-    </a>\n-    </tal:block>\n-    \n-\n-    <div class="alert alert-info"\n-        role="status"\n-        tal:condition="plone_view/isDefaultPageInFolder|nothing">\n-      <strong i18n:translate="">\n+          </a>\n+        </tal:block>\n+\n+\n+        <div class="alert alert-info"\n+             role="status"\n+             tal:condition="plone_view/isDefaultPageInFolder|nothing"\n+        >\n+          <strong i18n:translate="">\n           Info\n-      </strong>\n-      <span tal:omit-tag=""\n-          i18n:translate="label_manage_portlets_default_view_container">\n+          </strong>\n+          <span tal:omit-tag=""\n+                i18n:translate="label_manage_portlets_default_view_container"\n+          >\n           You are managing the portlets of the default view of a container. If\n           you wanted to manage the portlets of the container itself,\n-          <a href=""\n-              i18n:name="go_here"\n-              i18n:translate="label_manage_portlets_default_view_container_go_here"\n-              tal:attributes="href string:${context/aq_inner/aq_parent/absolute_url}/@@manage-portlets">go here</a>.\n-      </span>\n-    </div>\n-  </header>\n+            <a href=""\n+               tal:attributes="\n+                 href string:${context/aq_inner/aq_parent/absolute_url}/@@manage-portlets;\n+               "\n+               i18n:name="go_here"\n+               i18n:translate="label_manage_portlets_default_view_container_go_here"\n+            >go here</a>.\n+          </span>\n+        </div>\n+      </header>\n \n-  <div id="content-core">\n+      <div id="content-core">\n \n-      <p i18n:translate="description_manage_contextual_portlets">\n+        <p i18n:translate="description_manage_contextual_portlets">\n         The portlet columns will first display portlets\n         explicitly assigned in this context. Use the buttons on each portlet\n         to move them up or down, delete or edit them. To add a new portlet,\n         use the drop-down list at the top of the column.\n-      </p>\n+        </p>\n \n-      <p i18n:translate="description_portlets_block_unblock">\n+        <p i18n:translate="description_portlets_block_unblock">\n           If you wish to block or unblock certain categories of portlets, you can\n           do so using the drop-down boxes. Portlets that are included by these categories\n           are shown below the selection box.\n-      </p>\n+        </p>\n \n-      <div tal:condition="view/has_legacy_portlets">\n+        <div tal:condition="view/has_legacy_portlets">\n \n-        <h2 i18n:translate="title_legacy_portlets">Legacy portlets</h2>\n+          <h2 i18n:translate="title_legacy_portlets">Legacy portlets</h2>\n \n-        <p i18n:translate="action_convert_legacy_portlets">\n+          <p i18n:translate="action_convert_legacy_portlets">\n           There are legacy portlets defined here. Click the button to\n           convert them to new-style portlets.\n-        </p>\n+          </p>\n \n-        <form method="post"\n-              tal:attributes="action string:${context/absolute_url}/@@convert-legacy-portlets">\n+          <form method="post"\n+                tal:attributes="\n+                  action string:${context/absolute_url}/@@convert-legacy-portlets;\n+                "\n+          >\n \n-            <input type="submit"\n-                   class="btn btn-primary"\n+            <input class="btn btn-primary"\n+                   name="convert"\n+                   type="submit"\n                    value="Convert portlets"\n                    i18n:attributes="value label_convert_portlets"\n-                   name="convert" />\n+            />\n \n-        </form>\n+          </form>\n \n+        </div>\n       </div>\n-  </div>\n \n-</metal:main>\n-</body>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/manage-dashboard.pt b/plone/app/portlets/browser/templates/manage-dashboard.pt\nindex 5c96ccde..cc2af212 100644\n--- a/plone/app/portlets/browser/templates/manage-dashboard.pt\n+++ b/plone/app/portlets/browser/templates/manage-dashboard.pt\n@@ -1,27 +1,29 @@\n-<html\n-    xmlns="http://www.w3.org/1999/xhtml"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    xml:lang="en"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n   <head>\n-    <metal:block\n-        fill-slot="top_slot"\n-        tal:define="dummy python:request.set(\'disable_border\',1);\n-                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n+    <metal:block fill-slot="top_slot"\n+                 tal:define="\n+                   dummy python:request.set(\'disable_border\',1);\n+                   disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                   disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+                 "\n+    />\n   </head>\n \n   <body>\n \n     <metal:b fill-slot="content-title">\n-      <h1\n-          class="documentFirstHeading"\n-          i18n:translate="title_edit_dashboard">\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="title_edit_dashboard"\n+      >\n         Edit your dashboard\n       </h1>\n     </metal:b>\n@@ -32,24 +34,32 @@\n \n         <div class="autotabs">\n           <nav class="autotoc-nav nav nav-tabs mb-3">\n-              <a class="nav-link"\n-                 href="${context/@@plone_portal_state/navigation_root_url}/dashboard"\n-                 i18n:translate="label_dashboard">Dashboard</a>\n-              <a class="active nav-link"\n-                 href="${context/@@plone_portal_state/navigation_root_url}/@@manage-dashboard?_authenticator=${view/auth_token}"\n-                 i18n:translate="label_edit">Edit</a>\n+            <a class="nav-link"\n+               href="${context/@@plone_portal_state/navigation_root_url}/dashboard"\n+               i18n:translate="label_dashboard"\n+            >Dashboard</a>\n+            <a class="active nav-link"\n+               href="${context/@@plone_portal_state/navigation_root_url}/@@manage-dashboard?_authenticator=${view/auth_token}"\n+               i18n:translate="label_edit"\n+            >Edit</a>\n           </nav>\n \n-          <div id="dashboard"\n-              class="row row-cols-1 row-cols-md-2 gx-5 gy-5">\n-            <div id="dashboard-portlets1" class=""\n-              tal:content="structure provider:plone.dashboard1" />\n+          <div class="row row-cols-1 row-cols-md-2 gx-5 gy-5"\n+               id="dashboard"\n+          >\n+            <div class=""\n+                 id="dashboard-portlets1"\n+                 tal:content="structure provider:plone.dashboard1"\n+            ></div>\n             <div id="dashboard-portlets2"\n-              tal:content="structure provider:plone.dashboard2" />\n+                 tal:content="structure provider:plone.dashboard2"\n+            ></div>\n             <div id="dashboard-portlets3"\n-              tal:content="structure provider:plone.dashboard3" />\n+                 tal:content="structure provider:plone.dashboard3"\n+            ></div>\n             <div id="dashboard-portlets4"\n-              tal:content="structure provider:plone.dashboard4" />\n+                 tal:content="structure provider:plone.dashboard4"\n+            ></div>\n           </div>\n         </div>\n \ndiff --git a/plone/app/portlets/browser/templates/manage-group-dashboard.pt b/plone/app/portlets/browser/templates/manage-group-dashboard.pt\nindex e99baf91..f080fd73 100644\n--- a/plone/app/portlets/browser/templates/manage-group-dashboard.pt\n+++ b/plone/app/portlets/browser/templates/manage-group-dashboard.pt\n@@ -1,59 +1,86 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      xml:lang="en" lang="en"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<head>\n+  <head>\n     <metal:block fill-slot="top_slot"\n-             tal:define="dummy python:request.set(\'disable_border\',1)" />\n+                 tal:define="\n+                   dummy python:request.set(\'disable_border\',1);\n+                 "\n+    />\n \n-</head>\n+  </head>\n \n-<body>\n+  <body>\n \n-<metal:b fill-slot="prefs_configlet_main">\n+    <metal:b fill-slot="prefs_configlet_main">\n \n-    <header>\n-      <h1 class="documentFirstHeading" i18n:translate="">Group: <span i18n:name="groupname" tal:content="view/group" tal:omit-tag=""/></h1>\n-    </header>\n+      <header>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate=""\n+        >Group:\n+          <span tal:content="view/group"\n+                tal:omit-tag=""\n+                i18n:name="groupname"\n+          ></span></h1>\n+      </header>\n \n-    <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n         Portal status message\n-    </div>\n-\n-    <div id="content-core" tal:define="token context/@@authenticator/token">\n-      <div class="autotabs">\n-        <nav class="autotoc-nav nav nav-tabs mb-3">\n-          <a class="nav-link" href="${portal_url}/@@usergroup-groupmembership?groupname=${request/key}"\n-             i18n:translate="label_group_members">Group Members</a>\n-          <a class="nav-link" href="${portal_url}/@@usergroup-groupdetails?groupname=${request/key}"\n-             i18n:translate="label_group_properties">Group Properties</a>\n-          <a class="nav-link" href="${portal_url}/@@manage-group-portlets?key=${request/key}&_authenticator=${token}"\n-             i18n:translate="label_group_portlets">Group Portlets</a>\n-          <a class="active nav-link"\n-             href="${portal_url}/@@manage-group-dashboard?key=${request/key}&_authenticator=${token}"\n-             i18n:translate="label_group_dashboard">Group Dashboard</a>\n-        </nav>\n-\n-        <div id="dashboard"\n-            class="row row-cols-1 row-cols-md-2 gx-5 gy-5">\n+      </div>\n+\n+      <div id="content-core"\n+           tal:define="\n+             token context/@@authenticator/token;\n+           "\n+      >\n+        <div class="autotabs">\n+          <nav class="autotoc-nav nav nav-tabs mb-3">\n+            <a class="nav-link"\n+               href="${portal_url}/@@usergroup-groupmembership?groupname=${request/key}"\n+               i18n:translate="label_group_members"\n+            >Group Members</a>\n+            <a class="nav-link"\n+               href="${portal_url}/@@usergroup-groupdetails?groupname=${request/key}"\n+               i18n:translate="label_group_properties"\n+            >Group Properties</a>\n+            <a class="nav-link"\n+               href="${portal_url}/@@manage-group-portlets?key=${request/key}&_authenticator=${token}"\n+               i18n:translate="label_group_portlets"\n+            >Group Portlets</a>\n+            <a class="active nav-link"\n+               href="${portal_url}/@@manage-group-dashboard?key=${request/key}&_authenticator=${token}"\n+               i18n:translate="label_group_dashboard"\n+            >Group Dashboard</a>\n+          </nav>\n+\n+          <div class="row row-cols-1 row-cols-md-2 gx-5 gy-5"\n+               id="dashboard"\n+          >\n             <div id="dashboard-portlets1"\n-              tal:content="structure provider:plone.dashboard1" />\n+                 tal:content="structure provider:plone.dashboard1"\n+            ></div>\n             <div id="dashboard-portlets2"\n-              tal:content="structure provider:plone.dashboard2" />\n+                 tal:content="structure provider:plone.dashboard2"\n+            ></div>\n             <div id="dashboard-portlets3"\n-              tal:content="structure provider:plone.dashboard3" />\n+                 tal:content="structure provider:plone.dashboard3"\n+            ></div>\n             <div id="dashboard-portlets4"\n-              tal:content="structure provider:plone.dashboard4" />\n+                 tal:content="structure provider:plone.dashboard4"\n+            ></div>\n+          </div>\n+          <div class="visualClear"><!-- --></div>\n         </div>\n-        <div class="visualClear"><!-- --></div>\n       </div>\n-    </div>\n \n-</metal:b>\n+    </metal:b>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/manage-group.pt b/plone/app/portlets/browser/templates/manage-group.pt\nindex 5d5c7c3c..edddf21f 100644\n--- a/plone/app/portlets/browser/templates/manage-group.pt\n+++ b/plone/app/portlets/browser/templates/manage-group.pt\n@@ -1,58 +1,82 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      xml:lang="en" lang="en"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="here/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<head>\n+  <head>\n     <metal:block fill-slot="top_slot"\n-             tal:define="dummy python:request.set(\'disable_border\',1)" />\n-</head>\n+                 tal:define="\n+                   dummy python:request.set(\'disable_border\',1);\n+                 "\n+    />\n+  </head>\n \n-<body>\n+  <body>\n \n-<metal:b fill-slot="content-title">\n-  <a href=""\n-       class="link-parent"\n-       tal:attributes="href string:$portal_url/@@usergroup-groupprefs"\n-       i18n:translate="label_up_to_groups_overview">\n+    <metal:b fill-slot="content-title">\n+      <a class="link-parent"\n+         href=""\n+         tal:attributes="\n+           href string:$portal_url/@@usergroup-groupprefs;\n+         "\n+         i18n:translate="label_up_to_groups_overview"\n+      >\n     Up to Groups Overview\n-  </a>\n-\n-  <h1 class="documentFirstHeading" i18n:translate="">Group: <span i18n:name="groupname" tal:content="view/group" tal:omit-tag=""/></h1>\n-</metal:b>\n-\n-<metal:b fill-slot="content-core">\n-  <metal:b metal:define-macro="props" tal:omit-tag="">\n-\n-    <div class="autotabs" tal:define="token context/@@authenticator/token">\n-      <nav class="autotoc-nav">\n-        <a href="${portal_url}/@@usergroup-groupmembership?groupname=${request/key}"\n-           i18n:translate="label_group_members">Group Members</a>\n-        <a href="${portal_url}/@@usergroup-groupdetails?groupname=${request/key}"\n-           i18n:translate="label_group_properties">Group Properties</a>\n-        <a class="active"\n-           href="${portal_url}/@@manage-group-portlets?key=${request/key}&_authenticator=${token}"\n-           i18n:translate="label_group_portlets">Group Portlets</a>\n-        <a href="${portal_url}/@@manage-group-dashboard?key=${request/key}&_authenticator=${token}"\n-           i18n:translate="label_group_dashboard">Group Dashboard</a>\n-      </nav>\n-\n-      <p i18n:translate="description_manage_group_portlets">\n+      </a>\n+\n+      <h1 class="documentFirstHeading"\n+          i18n:translate=""\n+      >Group:\n+        <span tal:content="view/group"\n+              tal:omit-tag=""\n+              i18n:name="groupname"\n+        ></span></h1>\n+    </metal:b>\n+\n+    <metal:b fill-slot="content-core">\n+      <metal:b metal:define-macro="props"\n+               tal:omit-tag=""\n+      >\n+\n+        <div class="autotabs"\n+             tal:define="\n+               token context/@@authenticator/token;\n+             "\n+        >\n+          <nav class="autotoc-nav">\n+            <a href="${portal_url}/@@usergroup-groupmembership?groupname=${request/key}"\n+               i18n:translate="label_group_members"\n+            >Group Members</a>\n+            <a href="${portal_url}/@@usergroup-groupdetails?groupname=${request/key}"\n+               i18n:translate="label_group_properties"\n+            >Group Properties</a>\n+            <a class="active"\n+               href="${portal_url}/@@manage-group-portlets?key=${request/key}&_authenticator=${token}"\n+               i18n:translate="label_group_portlets"\n+            >Group Portlets</a>\n+            <a href="${portal_url}/@@manage-group-dashboard?key=${request/key}&_authenticator=${token}"\n+               i18n:translate="label_group_dashboard"\n+            >Group Dashboard</a>\n+          </nav>\n+\n+          <p i18n:translate="description_manage_group_portlets">\n         The left and right portlet slots will now display only those portlets\n         assigned to this group. Use the up, down, delete and edit links\n         to manage user portlets. Use the drop-down list to add new portlets.\n-      </p>\n+          </p>\n \n-      <p i18n:translate="description_group_portlets_below">\n+          <p i18n:translate="description_group_portlets_below">\n         Note that group portlets are normally rendered below context portlets.\n-      </p>\n-    </div>\n+          </p>\n+        </div>\n \n-  </metal:b>\n-</metal:b>\n+      </metal:b>\n+    </metal:b>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/manage_portlets_fallback.pt b/plone/app/portlets/browser/templates/manage_portlets_fallback.pt\nindex ec5592d9..a7cba8b9 100644\n--- a/plone/app/portlets/browser/templates/manage_portlets_fallback.pt\n+++ b/plone/app/portlets/browser/templates/manage_portlets_fallback.pt\n@@ -1,14 +1,19 @@\n-<div tal:condition="view/available" class="row managePortlets-row">\n-\t<tal:comment tal:condition="nothing">\n+<div class="row managePortlets-row"\n+     tal:condition="view/available"\n+>\n+  <tal:comment tal:condition="nothing">\n \t\t**********\n \t\tNEEDED COL\n \t\t**********\n-\t</tal:comment>\n-    <a class="managePortletsFallback"\n-        tal:attributes="href string:${view/object_url}/@@manage-portlets"\n-        i18n:domain="plone"\n-        i18n:translate="manage_portlets_link">\n+  </tal:comment>\n+  <a class="managePortletsFallback"\n+     tal:attributes="\n+       href string:${view/object_url}/@@manage-portlets;\n+     "\n+     i18n:domain="plone"\n+     i18n:translate="manage_portlets_link"\n+  >\n         Manage portlets\n-    </a>\n+  </a>\n \n-</div>\n\\ No newline at end of file\n+</div>\ndiff --git a/plone/app/portlets/browser/templates/portlets-pageform.pt b/plone/app/portlets/browser/templates/portlets-pageform.pt\nindex dc35fecb..4e65a74e 100644\n--- a/plone/app/portlets/browser/templates/portlets-pageform.pt\n+++ b/plone/app/portlets/browser/templates/portlets-pageform.pt\n@@ -1,23 +1,33 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      metal:use-macro="context/main_template/macros/master">\n+      metal:use-macro="context/main_template/macros/master"\n+>\n \n-<metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1);\n-                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+                 disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                 disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+               "\n+  />\n \n-<body>\n-<metal:main fill-slot="main">\n+  <body>\n+    <metal:main fill-slot="main">\n \n-  <metal:form use-macro="context/@@base-pageform.html/form">\n-    <metal:block fill-slot="extra_info">\n-     <input type="hidden" name="referer" value="" tal:attributes="value view/referer" />\n-    </metal:block>\n-  </metal:form>\n+      <metal:form use-macro="context/@@base-pageform.html/form">\n+        <metal:block fill-slot="extra_info">\n+          <input name="referer"\n+                 type="hidden"\n+                 value=""\n+                 tal:attributes="\n+                   value view/referer;\n+                 "\n+          />\n+        </metal:block>\n+      </metal:form>\n \n-</metal:main>\n-</body>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/topbar-manage-portlets.pt b/plone/app/portlets/browser/templates/topbar-manage-portlets.pt\nindex 11d9aaa0..37702e0c 100644\n--- a/plone/app/portlets/browser/templates/topbar-manage-portlets.pt\n+++ b/plone/app/portlets/browser/templates/topbar-manage-portlets.pt\n@@ -1,68 +1,102 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n-<body>\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-  <metal:main fill-slot="main" tal:define="plone_view context/@@plone">\n+    <metal:main fill-slot="main"\n+                tal:define="\n+                  plone_view context/@@plone;\n+                "\n+    >\n \n-    <div class="quicknav-wrapper">\n-      <form method="post"\n-          tal:attributes="action context/absolute_url">\n-        <select id="quicknav" class="switch-portlet-manager form-select w-auto ms-1 float-end" name=":action"\n-            tal:define="portlet_menu context/@@view_get_menu/plone_contentmenu_portletmanager"\n-            tal:attributes="data-context-url context/absolute_url">\n-          <option tal:attributes="value python:request[\'ACTUAL_URL\']"\n-          ><tal:span i18n:translate="title_switch_portlet_managers">Other portlet managers</tal:span>&hellip;</option>\n-          <tal:item repeat="item portlet_menu">\n-            <option tal:define="item_id python:item[\'title\'].lower().replace(\' \', \'.\');\n-                                is_current python:item_id == view.manager_name"\n-                tal:attributes="value item/action"\n-                tal:content="item/title"\n-                tal:omit-tag="is_current">Plone Leftcolumn</option>\n-          </tal:item>\n-        </select>\n-        <label for="quicknav" class="sr-only" i18n:translate="title_switch_portlet_managers">Other portlet managers</label>\n-      </form>\n-    </div>\n+      <div class="quicknav-wrapper">\n+        <form method="post"\n+              tal:attributes="\n+                action context/absolute_url;\n+              "\n+        >\n+          <select class="switch-portlet-manager form-select w-auto ms-1 float-end"\n+                  id="quicknav"\n+                  name=":action"\n+                  tal:define="\n+                    portlet_menu context/@@view_get_menu/plone_contentmenu_portletmanager;\n+                  "\n+                  tal:attributes="\n+                    data-context-url context/absolute_url;\n+                  "\n+          >\n+            <option tal:attributes="\n+                      value python:request[\'ACTUAL_URL\'];\n+                    "><tal:span i18n:translate="title_switch_portlet_managers">Other portlet managers</tal:span>&hellip;</option>\n+            <tal:item repeat="item portlet_menu">\n+              <option tal:define="\n+                        item_id python:item[\'title\'].lower().replace(\' \', \'.\');\n+                        is_current python:item_id == view.manager_name;\n+                      "\n+                      tal:content="item/title"\n+                      tal:omit-tag="is_current"\n+                      tal:attributes="\n+                        value item/action;\n+                      "\n+              >Plone Leftcolumn</option>\n+            </tal:item>\n+          </select>\n+          <label class="sr-only"\n+                 for="quicknav"\n+                 i18n:translate="title_switch_portlet_managers"\n+          >Other portlet managers</label>\n+        </form>\n+      </div>\n \n-    <header>\n-      <h1 class="documentFirstHeading"\n-        i18n:translate="title_manage_contextual_portlets">\n+      <header>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="title_manage_contextual_portlets"\n+        >\n         Manage portlets for\n-        <q i18n:name="context_title" tal:content="context/Title">title</q>\n-      </h1>\n-      \n-      <a class="link-parent d-inline-block mb-3"\n-          tal:attributes="href context/absolute_url"\n-          i18n:translate="return_to_view">\n+          <q tal:content="context/Title"\n+             i18n:name="context_title"\n+          >title</q>\n+        </h1>\n+\n+        <a class="link-parent d-inline-block mb-3"\n+           tal:attributes="\n+             href context/absolute_url;\n+           "\n+           i18n:translate="return_to_view"\n+        >\n         Return\n-      </a>      \n+        </a>\n \n-      <div class="alert alert-info"\n-          role="status"\n-          tal:condition="plone_view/isDefaultPageInFolder|nothing">\n-        <strong i18n:translate="">\n+        <div class="alert alert-info"\n+             role="status"\n+             tal:condition="plone_view/isDefaultPageInFolder|nothing"\n+        >\n+          <strong i18n:translate="">\n             Info\n-        </strong>\n-        <div i18n:translate="label_manage_portlets_default_view_container">\n+          </strong>\n+          <div i18n:translate="label_manage_portlets_default_view_container">\n             You are managing the portlets of the default view of a container. If\n             you wanted to manage the portlets of the container itself,\n-          <a href=""\n-              i18n:name="go_here"\n-              i18n:translate="label_manage_portlets_default_view_container_go_here"\n-              class="portlets-link-to-parent"\n-              tal:attributes="href string:${context/aq_inner/aq_parent/absolute_url}/@@topbar-manage-portlets/${view/manager_name}">go here</a>.\n+            <a class="portlets-link-to-parent"\n+               href=""\n+               tal:attributes="\n+                 href string:${context/aq_inner/aq_parent/absolute_url}/@@topbar-manage-portlets/${view/manager_name};\n+               "\n+               i18n:name="go_here"\n+               i18n:translate="label_manage_portlets_default_view_container_go_here"\n+            >go here</a>.\n+          </div>\n         </div>\n-      </div>\n-    </header>\n+      </header>\n \n-    <h2 tal:content="view/manager_name"></h2>\n-    <span tal:replace="structure view/render_edit_manager_portlets" />\n+      <h2 tal:content="view/manager_name"></h2>\n+      <span tal:replace="structure view/render_edit_manager_portlets"></span>\n \n-  </metal:main>\n+    </metal:main>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/browser/templates/z3cform-portlets-pageform.pt b/plone/app/portlets/browser/templates/z3cform-portlets-pageform.pt\nindex d376e420..d75e5cca 100644\n--- a/plone/app/portlets/browser/templates/z3cform-portlets-pageform.pt\n+++ b/plone/app/portlets/browser/templates/z3cform-portlets-pageform.pt\n@@ -1,30 +1,45 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       xmlns:metal="http://xml.zope.org/namespaces/metal"\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      metal:use-macro="context/main_template/macros/master"\n       i18n:domain="plone"\n-      metal:use-macro="context/main_template/macros/master">\n+>\n+\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+                 disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                 disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+               "\n+  />\n \n-<metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1);\n-                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n+  <metal:block fill-slot="main">\n \n-    <metal:block fill-slot="main">\n+    <h1 class="documentFirstHeading"\n+        tal:content="view/label | nothing"\n+    ></h1>\n \n-        <h1 class="documentFirstHeading" tal:content="view/label | nothing" />\n-        \n-        <div class="text-muted" tal:condition="view/description | nothing" tal:content="view/description" />\n+    <div class="text-muted"\n+         tal:condition="view/description | nothing"\n+         tal:content="view/description"\n+    ></div>\n \n-        <div id="content-core">\n-            <metal:block use-macro="context/@@ploneform-macros/titlelessform" >\n-                <metal:block fill-slot="formtop">\n-                     <input type="hidden" name="referer" value="" tal:attributes="value view/referer" />\n-                </metal:block>\n-            </metal:block>\n-        </div>\n+    <div id="content-core">\n+      <metal:block use-macro="context/@@ploneform-macros/titlelessform">\n+        <metal:block fill-slot="formtop">\n+          <input name="referer"\n+                 type="hidden"\n+                 value=""\n+                 tal:attributes="\n+                   value view/referer;\n+                 "\n+          />\n+        </metal:block>\n+      </metal:block>\n+    </div>\n \n \n-    </metal:block>\n+  </metal:block>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/portlets/browser/viewlets.py b/plone/app/portlets/browser/viewlets.py\nindex 6a365f00..01fa1f8b 100644\n--- a/plone/app/portlets/browser/viewlets.py\n+++ b/plone/app/portlets/browser/viewlets.py\n@@ -1,8 +1,8 @@\n-from zope.component import getMultiAdapter\n-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n-from plone.app.layout.viewlets.common import ViewletBase\n from AccessControl import getSecurityManager\n from datetime import date\n+from plone.app.layout.viewlets.common import ViewletBase\n+from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n+from zope.component import getMultiAdapter\n \n \n class ManagePortletsFallbackViewlet(ViewletBase):\n@@ -11,11 +11,9 @@ class ManagePortletsFallbackViewlet(ViewletBase):\n     index = ViewPageTemplateFile("templates/manage_portlets_fallback.pt")\n \n     def update(self):\n-        plonelayout = getMultiAdapter(\n-            (self.context, self.request), name=u"plone_layout"\n-        )\n+        plonelayout = getMultiAdapter((self.context, self.request), name="plone_layout")\n         context_state = getMultiAdapter(\n-            (self.context, self.request), name=u"plone_context_state"\n+            (self.context, self.request), name="plone_context_state"\n         )\n \n         self.portlet_assignable = context_state.portlet_assignable()\n@@ -32,11 +30,12 @@ def available(self):\n             return False\n         return bool(not self.sl and not self.sr and self.portlet_assignable)\n \n+\n class FooterViewlet(ViewletBase):\n     index = ViewPageTemplateFile("templates/footer.pt")\n \n     def update(self):\n-        super(FooterViewlet, self).update()\n+        super().update()\n         self.year = date.today().year\n \n     def render_footer_portlets(self):\ndiff --git a/plone/app/portlets/configure.zcml b/plone/app/portlets/configure.zcml\nindex b4b59569..6732bada 100644\n--- a/plone/app/portlets/configure.zcml\n+++ b/plone/app/portlets/configure.zcml\n@@ -2,70 +2,65 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:five="http://namespaces.zope.org/five"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    >\n \n-    <include package="plone.portlets" />\n-    <include package="plone.app.vocabularies" />\n+  <include package="plone.portlets" />\n+  <include package="plone.app.vocabularies" />\n \n-    <five:registerPackage package="." />\n+  <five:registerPackage package="." />\n \n-    <include file="permissions.zcml" />\n+  <include file="permissions.zcml" />\n \n-    <include package=".browser" />\n-    <include package=".dashboard" />\n-    <include package=".exportimport" />\n-    <include package=".portlets" />\n+  <include package=".browser" />\n+  <include package=".dashboard" />\n+  <include package=".exportimport" />\n+  <include package=".portlets" />\n \n-    <!-- Set up the portlet context -->\n-    <adapter factory=".portletcontext.ContentContext" />\n-    <adapter factory=".portletcontext.PortalRootContext" />\n+  <!-- Set up the portlet context -->\n+  <adapter factory=".portletcontext.ContentContext" />\n+  <adapter factory=".portletcontext.PortalRootContext" />\n \n-    <!-- Make it possible to define a sane default dashboard -->\n-    <subscriber\n-        for="Products.PluggableAuthService.interfaces.authservice.IPropertiedUser\n-            Products.PluggableAuthService.interfaces.events.IPrincipalCreatedEvent"\n-        handler=".dashboard.new_user"\n-        />\n-\n-    <adapter factory=".dashboard.DefaultDashboard" />\n+  <!-- Make it possible to define a sane default dashboard -->\n+  <subscriber\n+      for="Products.PluggableAuthService.interfaces.authservice.IPropertiedUser\n+           Products.PluggableAuthService.interfaces.events.IPrincipalCreatedEvent"\n+      handler=".dashboard.new_user"\n+      />\n \n-    <!-- Make the site root and any ATContentType a possible portlet manager -->\n-    <class class="Products.CMFPlone.Portal.PloneSite">\n-        <implements interface="plone.portlets.interfaces.ILocalPortletAssignable" />\n-    </class>\n+  <adapter factory=".dashboard.DefaultDashboard" />\n \n-    <class zcml:condition="installed Products.ATContentTypes"\n-           class="Products.ATContentTypes.content.base.ATCTMixin">\n-        <implements interface="plone.portlets.interfaces.ILocalPortletAssignable" />\n-    </class>\n+  <!-- Make the site root a possible portlet manager -->\n+  <class class="Products.CMFPlone.Portal.PloneSite">\n+    <implements interface="plone.portlets.interfaces.ILocalPortletAssignable" />\n+  </class>\n \n-    <!-- Make a Zope 2 safe traversal adapter for assignment mappings -->\n-    <adapter\n+  <!-- Make a Zope safe traversal adapter for assignment mappings -->\n+  <adapter\n       factory=".storage.PortletAssignmentMappingTraverser"\n       provides="zope.publisher.interfaces.browser.IBrowserPublisher"\n       />\n \n-    <!-- Set up assignment mapping permissions -->\n-    <class class=".storage.PortletAssignmentMapping">\n-      <require\n+  <!-- Set up assignment mapping permissions -->\n+  <class class=".storage.PortletAssignmentMapping">\n+    <require\n         permission="zope2.View"\n         interface="zope.container.interfaces.IReadContainer"\n         />\n-      <require\n+    <require\n         permission="plone.app.portlets.ManagePortlets"\n         interface="zope.container.interfaces.IWriteContainer"\n         />\n-      <require\n+    <require\n         permission="plone.app.portlets.ManagePortlets"\n         attributes="updateOrder"\n         />\n-    </class>\n+  </class>\n \n-    <!-- Register a name chooser -->\n-    <adapter\n+  <!-- Register a name chooser -->\n+  <adapter\n+      factory=".storage.PortletsNameChooser"\n       provides="zope.container.interfaces.INameChooser"\n       for="plone.portlets.interfaces.IPortletAssignmentMapping"\n-      factory=".storage.PortletsNameChooser"\n       />\n \n </configure>\ndiff --git a/plone/app/portlets/dashboard/configure.zcml b/plone/app/portlets/dashboard/configure.zcml\nindex c206737c..6096944a 100644\n--- a/plone/app/portlets/dashboard/configure.zcml\n+++ b/plone/app/portlets/dashboard/configure.zcml\n@@ -1,22 +1,23 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n-    <browser:page\n-        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n-        name="dashboard"\n-        permission="plone.app.portlets.ViewDashboard"\n-        class=".dashboard.DashboardView"\n-        template="dashboard.pt"\n-        />\n+  <browser:page\n+      name="dashboard"\n+      for="plone.app.layout.navigation.interfaces.INavigationRoot"\n+      class=".dashboard.DashboardView"\n+      template="dashboard.pt"\n+      permission="plone.app.portlets.ViewDashboard"\n+      />\n \n-    <!-- this view provides a not-js fallback for the user dropdown menu.\n+  <!-- this view provides a not-js fallback for the user dropdown menu.\n     It has been placed here to be near the personal bar code -->\n-    <browser:page\n-        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n-        name="useractions"\n-        permission="zope2.View"\n-        class=".user_actions.UserActionsView"\n-        template="user_actions.pt"\n-        />\n+  <browser:page\n+      name="useractions"\n+      for="plone.app.layout.navigation.interfaces.INavigationRoot"\n+      class=".user_actions.UserActionsView"\n+      template="user_actions.pt"\n+      permission="zope2.View"\n+      />\n </configure>\ndiff --git a/plone/app/portlets/dashboard/dashboard.pt b/plone/app/portlets/dashboard/dashboard.pt\nindex 71de849a..da7884b5 100644\n--- a/plone/app/portlets/dashboard/dashboard.pt\n+++ b/plone/app/portlets/dashboard/dashboard.pt\n@@ -1,25 +1,27 @@\n-<html\n-    xmlns="http://www.w3.org/1999/xhtml"\n-    xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n   <body>\n \n     <metal:b fill-slot="content-title">\n-      <h1\n-          class="documentFirstHeading"\n+      <h1 class="documentFirstHeading"\n+          tal:define="\n+            memberinfo context/portal_membership/getMemberInfo;\n+            member context/@@plone_portal_state/member;\n+            name python:memberinfo[\'fullname\'] or member.getId() or member.getId();\n+          "\n           i18n:translate="heading_dashboard"\n-          tal:define="memberinfo context/portal_membership/getMemberInfo;\n-                  member context/@@plone_portal_state/member;\n-                  name python:memberinfo[\'fullname\'] or member.getId() or member.getId()">\n-        <span\n-            tal:replace="name"\n-            i18n:name="user_name" />\n+      >\n+        <span tal:replace="name"\n+              i18n:name="user_name"\n+        ></span>\n         &#8217;s dashboard\n       </h1>\n     </metal:b>\n@@ -30,35 +32,35 @@\n         <div class="autotabs">\n           <nav class="autotoc-nav nav nav-tabs mb-3">\n             <span class="nav-item">\n-              <a\n-                  class="active nav-link"\n-                  href="${context/@@plone_portal_state/navigation_root_url}/dashboard"\n-                  i18n:translate="label_dashboard">Dashboard</a>\n+              <a class="active nav-link"\n+                 href="${context/@@plone_portal_state/navigation_root_url}/dashboard"\n+                 i18n:translate="label_dashboard"\n+              >Dashboard</a>\n             </span>\n             <span class="nav-item">\n-              <a\n-                  href="${context/@@plone_portal_state/navigation_root_url}/@@manage-dashboard?_authenticator=${view/auth_token}"\n-                  class="nav-link"\n-                  i18n:translate="label_edit">Edit</a>\n+              <a class="nav-link"\n+                 href="${context/@@plone_portal_state/navigation_root_url}/@@manage-dashboard?_authenticator=${view/auth_token}"\n+                 i18n:translate="label_edit"\n+              >Edit</a>\n             </span>\n           </nav>\n \n \n-          <div\n-              id="dashboard"\n-              class="row row-cols-1 row-cols-md-2 gy-2">\n-            <div\n-                id="dashboard-portlets1"\n-                tal:content="structure provider:plone.dashboard1" />\n-            <div\n-                id="dashboard-portlets2"\n-                tal:content="structure provider:plone.dashboard2" />\n-            <div\n-                id="dashboard-portlets3"\n-                tal:content="structure provider:plone.dashboard3" />\n-            <div\n-                id="dashboard-portlets4"\n-                tal:content="structure provider:plone.dashboard4" />\n+          <div class="row row-cols-1 row-cols-md-2 gy-2"\n+               id="dashboard"\n+          >\n+            <div id="dashboard-portlets1"\n+                 tal:content="structure provider:plone.dashboard1"\n+            ></div>\n+            <div id="dashboard-portlets2"\n+                 tal:content="structure provider:plone.dashboard2"\n+            ></div>\n+            <div id="dashboard-portlets3"\n+                 tal:content="structure provider:plone.dashboard3"\n+            ></div>\n+            <div id="dashboard-portlets4"\n+                 tal:content="structure provider:plone.dashboard4"\n+            ></div>\n           </div>\n \n         </div>\ndiff --git a/plone/app/portlets/dashboard/dashboard.py b/plone/app/portlets/dashboard/dashboard.py\nindex abc42837..a2e5354a 100644\n--- a/plone/app/portlets/dashboard/dashboard.py\n+++ b/plone/app/portlets/dashboard/dashboard.py\n@@ -1,4 +1,4 @@\n-# -*- coding: utf-8 -*-\n+from .. import PloneMessageFactory as _\n from AccessControl import getSecurityManager\n from plone.memoize.instance import memoize\n from plone.portlets.constants import GROUP_CATEGORY\n@@ -6,7 +6,6 @@\n from plone.portlets.interfaces import IPortletManager\n from plone.protect.authenticator import createToken\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone import PloneMessageFactory as _\n from Products.Five.browser import BrowserView\n from Products.statusmessages.interfaces import IStatusMessage\n from zope.component import getUtility\n@@ -28,8 +27,8 @@ def __call__(self):\n         self.request.set("disable_plone.rightcolumn", 1)\n         if self.can_edit() and self.empty():\n             message = _(\n-                u"info_empty_dashboard",\n-                default=u"Your dashboard is currently empty. Click the"\n+                "info_empty_dashboard",\n+                default="Your dashboard is currently empty. Click the"\n                 " <em>edit</em> tab to assign some personal"\n                 " portlets.",\n             )\ndiff --git a/plone/app/portlets/dashboard/user_actions.pt b/plone/app/portlets/dashboard/user_actions.pt\nindex ce532f1f..c94373bf 100644\n--- a/plone/app/portlets/dashboard/user_actions.pt\n+++ b/plone/app/portlets/dashboard/user_actions.pt\n@@ -1,35 +1,45 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<head>\n+  <head>\n     <metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1);\n-                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n-</head>\n+                 tal:define="\n+                   dummy python:request.set(\'disable_border\',1);\n+                   disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                   disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+                 "\n+    />\n+  </head>\n \n-<body>\n+  <body>\n \n-<metal:main fill-slot="main">\n-<h1 i18n:translate="" class="documentFirstHeading">User Actions</h1>\n-<ul id="user-actions">\n-    <li tal:repeat="action view/user_actions">\n-        <a href=""\n-           tal:attributes="href action/url;\n-                           target action/link_target|nothing;\n-                           id string:personaltoolspage-${action/id};"\n-           tal:content="action/title"\n-           i18n:translate="">\n+    <metal:main fill-slot="main">\n+      <h1 class="documentFirstHeading"\n+          i18n:translate=""\n+      >User Actions</h1>\n+      <ul id="user-actions">\n+        <li tal:repeat="action view/user_actions">\n+          <a href=""\n+             tal:content="action/title"\n+             tal:attributes="\n+               href action/url;\n+               target action/link_target|nothing;\n+               id string:personaltoolspage-${action/id};\n+             "\n+             i18n:translate=""\n+          >\n             action title\n-        </a>\n-    </li>\n-</ul>\n-</metal:main>\n+          </a>\n+        </li>\n+      </ul>\n+    </metal:main>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/portlets/dashboard/user_actions.py b/plone/app/portlets/dashboard/user_actions.py\nindex 64e10f96..5cec7084 100644\n--- a/plone/app/portlets/dashboard/user_actions.py\n+++ b/plone/app/portlets/dashboard/user_actions.py\n@@ -1,4 +1,3 @@\n-# -*- coding: utf-8 -*-\n from Products.Five.browser import BrowserView\n from zope.component import getMultiAdapter\n \n@@ -8,7 +7,7 @@ class UserActionsView(BrowserView):\n \n     def user_actions(self):\n         context_state = getMultiAdapter(\n-            (self.context, self.request), name=u"plone_context_state"\n+            (self.context, self.request), name="plone_context_state"\n         )\n \n         actions = context_state.actions("user")\ndiff --git a/plone/app/portlets/exportimport/configure.zcml b/plone/app/portlets/exportimport/configure.zcml\nindex 17e90313..e78125b1 100644\n--- a/plone/app/portlets/exportimport/configure.zcml\n+++ b/plone/app/portlets/exportimport/configure.zcml\n@@ -1,44 +1,38 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n-\n-    <adapter\n-        factory=".portlets.PortletsXMLAdapter"\n-        name="plone.portlets"\n-        />\n-\n-    <adapter\n-        factory=".portlets.PropertyPortletAssignmentExportImportHandler"\n-        />\n-\n-    <!-- Register import and export steps -->\n-    <genericsetup:importStep\n-        name="portlets"\n-        title="Portlets"\n-        description="Import portlet managers, types, assignments and blacklistings"\n-        handler=".portlets.importPortlets">\n-        <depends name="componentregistry"/>\n-        <depends name="content"/>\n-    </genericsetup:importStep>\n-\n-    <genericsetup:exportStep\n-        name="portlets"\n-        title="Portlets"\n-        description="Export portlet managers, types, assignments and blacklistings"\n-        handler=".portlets.exportPortlets"\n-        />\n-\n-    <configure\n-        zcml:condition="not-installed Products.CMFCore.src">\n-\n-        <utility\n-            factory=".portlets.Blacklist"\n-            provides="Products.GenericSetup.interfaces.IComponentsHandlerBlacklist"\n-            name="plone.app.portlets.exportimport"\n-            />\n-\n-        </configure>\n+    i18n_domain="plone"\n+    >\n+\n+  <adapter\n+      factory=".portlets.PortletsXMLAdapter"\n+      name="plone.portlets"\n+      />\n+\n+  <adapter factory=".portlets.PropertyPortletAssignmentExportImportHandler" />\n+\n+  <!-- Register import and export steps -->\n+  <genericsetup:importStep\n+      name="portlets"\n+      title="Portlets"\n+      description="Import portlet managers, types, assignments and blacklistings"\n+      handler=".portlets.importPortlets"\n+      >\n+    <depends name="componentregistry" />\n+    <depends name="content" />\n+  </genericsetup:importStep>\n+\n+  <genericsetup:exportStep\n+      name="portlets"\n+      title="Portlets"\n+      description="Export portlet managers, types, assignments and blacklistings"\n+      handler=".portlets.exportPortlets"\n+      />\n+\n+  <utility\n+      factory=".portlets.Blacklist"\n+      provides="Products.GenericSetup.interfaces.IComponentsHandlerBlacklist"\n+      name="plone.app.portlets.exportimport"\n+      />\n \n </configure>\ndiff --git a/plone/app/portlets/exportimport/portlets.py b/plone/app/portlets/exportimport/portlets.py\nindex 6c404fac..8d4d1dcf 100644\n--- a/plone/app/portlets/exportimport/portlets.py\n+++ b/plone/app/portlets/exportimport/portlets.py\n@@ -245,7 +245,7 @@ def field_typecast(self, field, value):\n                     try:\n                         value = tc(value)\n                         break\n-                    except:\n+                    except Exception:\n                         pass\n         return value\n \n@@ -651,12 +651,12 @@ def extractMapping(manager_name, category, key, mapping):\n                 child.setAttribute("location", "/")\n \n                 status = assignable.getBlacklistStatus(category)\n-                if status == True:\n+                if status is None:\n+                    child.setAttribute("status", "acquire")\n+                elif status:\n                     child.setAttribute("status", "block")\n-                elif status == False:\n-                    child.setAttribute("status", "show")\n                 else:\n-                    child.setAttribute("status", "acquire")\n+                    child.setAttribute("status", "show")\n \n                 fragment.appendChild(child)\n \n@@ -802,7 +802,6 @@ def exportPortlets(context):\n \n \n class InvalidPortletForDefinition(Exception):\n-\n     message = """The following portlet definition is invalid: %s\n The \'for\' attribute is not supported, use \'for\' sub-elements instead.\n See http://plone.org/documentation/manual/upgrade-guide/version/\\\ndiff --git a/plone/app/portlets/interfaces.py b/plone/app/portlets/interfaces.py\nindex bde17c68..d1b34dfc 100644\n--- a/plone/app/portlets/interfaces.py\n+++ b/plone/app/portlets/interfaces.py\n@@ -26,7 +26,7 @@ class IPortletPermissionChecker(Interface):\n     """\n \n     def __call__():\n-        """Check the adapted assignment manager. Will raise Unathorized if\n+        """Check the adapted assignment manager. Will raise Unauthorized if\n         something fishy is going on.\n         """\n \ndiff --git a/plone/app/portlets/meta.zcml b/plone/app/portlets/meta.zcml\nindex 2341e10d..0655c3dc 100644\n--- a/plone/app/portlets/meta.zcml\n+++ b/plone/app/portlets/meta.zcml\n@@ -1,21 +1,22 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:meta="http://namespaces.zope.org/meta">\n+    xmlns:meta="http://namespaces.zope.org/meta"\n+    >\n \n-    <meta:directives namespace="http://namespaces.plone.org/plone">\n+  <meta:directives namespace="http://namespaces.plone.org/plone">\n \n-        <meta:directive\n-            name="portlet"\n-            schema=".metadirectives.IPortletDirective"\n-            handler=".metaconfigure.portletDirective"\n-            />\n+    <meta:directive\n+        name="portlet"\n+        handler=".metaconfigure.portletDirective"\n+        schema=".metadirectives.IPortletDirective"\n+        />\n \n-        <meta:directive\n-            name="portletRenderer"\n-            schema=".metadirectives.IPortletRendererDirective"\n-            handler=".metaconfigure.portletRendererDirective"\n-            />\n+    <meta:directive\n+        name="portletRenderer"\n+        handler=".metaconfigure.portletRendererDirective"\n+        schema=".metadirectives.IPortletRendererDirective"\n+        />\n \n-    </meta:directives>\n+  </meta:directives>\n \n-</configure>\n\\ No newline at end of file\n+</configure>\ndiff --git a/plone/app/portlets/metaconfigure.py b/plone/app/portlets/metaconfigure.py\nindex 2dff5aae..dc551d15 100644\n--- a/plone/app/portlets/metaconfigure.py\n+++ b/plone/app/portlets/metaconfigure.py\n@@ -14,7 +14,7 @@\n from zope.publisher.interfaces.browser import IDefaultBrowserLayer\n \n \n-# Keep track of which renderers we\'ve registered so that we can artifically\n+# Keep track of which renderers we\'ve registered so that we can artificially\n # subclass them in portletRendererDirective. Yes, this is evil.\n _default_renderers = {}\n \n@@ -36,7 +36,7 @@ def portletDirective(\n     base.Assignment, a renderer deriving from base.Renderer, an addview\n     using z3c form and deriving from base.AddForm and an editview (optional)\n     using z3c form and deriving from base.EditForm, can use this directive\n-    to avoid having to regiter each of those components individually.\n+    to avoid having to register each of those components individually.\n \n     In addition, we register the portlet interface using IPortletTypeInterface\n     and an IFactory utility, in order to help the GenericSetup handler and\n@@ -147,7 +147,6 @@ def portletRendererDirective(\n         raise TypeError("\'template\' and \'class\' cannot be specified at the same time")\n \n     if template is not None:\n-\n         # Look up the default renderer for this portlet\n         base_class = _default_renderers.get(portlet, None)\n         if base_class is None:\ndiff --git a/plone/app/portlets/overrides.zcml b/plone/app/portlets/overrides.zcml\nindex 2aefc787..beb2011a 100644\n--- a/plone/app/portlets/overrides.zcml\n+++ b/plone/app/portlets/overrides.zcml\n@@ -1,8 +1,10 @@\n <configure xmlns="http://namespaces.zope.org/zope">\n \n-    <adapter factory=".assignable.localPortletAssignmentMappingAdapter" />\n+  <adapter factory=".assignable.localPortletAssignmentMappingAdapter" />\n \n-    <adapter factory=".manager.PortletManagerRenderer"\n-             provides="plone.portlets.interfaces.IPortletManagerRenderer"/>\n+  <adapter\n+      factory=".manager.PortletManagerRenderer"\n+      provides="plone.portlets.interfaces.IPortletManagerRenderer"\n+      />\n \n </configure>\ndiff --git a/plone/app/portlets/permissions.zcml b/plone/app/portlets/permissions.zcml\nindex db4a2f1a..9d15eb31 100644\n--- a/plone/app/portlets/permissions.zcml\n+++ b/plone/app/portlets/permissions.zcml\n@@ -1,5 +1,7 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-    i18n_domain="plone.app.portlets">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    i18n_domain="plone.app.portlets"\n+    >\n \n   <!-- Note: These permissions are also set up in the rolemap.xml GenericSetup\n              importer in CMFPlone.\n@@ -14,23 +16,23 @@\n       A better way of doing this would probably be to use the Owner role\n       against the assignment mappings and let Manage portlets be controlled\n       by that, but managing those roles properly w.r.t. the namespace\n-      traveral adapters and acquisition is not fun.\n+      traversal adapters and acquisition is not fun.\n      -->\n \n   <permission\n-    id="plone.app.portlets.ManagePortlets"\n-    title="Portlets: Manage portlets"\n-    />\n+      id="plone.app.portlets.ManagePortlets"\n+      title="Portlets: Manage portlets"\n+      />\n \n   <permission\n-    id="plone.app.portlets.ManageOwnPortlets"\n-    title="Portlets: Manage own portlets"\n-    />\n+      id="plone.app.portlets.ManageOwnPortlets"\n+      title="Portlets: Manage own portlets"\n+      />\n \n   <permission\n-     id="plone.app.portlets.ViewDashboard"\n-     title="Portlets: View dashboard"\n-     />\n+      id="plone.app.portlets.ViewDashboard"\n+      title="Portlets: View dashboard"\n+      />\n \n   <adapter factory=".checker.DefaultPortletPermissionChecker" />\n   <adapter factory=".checker.UserPortletPermissionChecker" />\ndiff --git a/plone/app/portlets/portlets/actions.pt b/plone/app/portlets/portlets/actions.pt\nindex fdeda5f9..44985527 100644\n--- a/plone/app/portlets/portlets/actions.pt\n+++ b/plone/app/portlets/portlets/actions.pt\n@@ -1,40 +1,64 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n   <div class="card portlet portletActions"\n-      tal:define="portal_url context/@@plone_portal_state/portal_url;">\n+       tal:define="\n+         portal_url context/@@plone_portal_state/portal_url;\n+       "\n+  >\n \n-    <div class="card-header" tal:condition="view/showTitle">\n-      <span tal:condition="view/title" tal:replace="view/title">\n+    <div class="card-header"\n+         tal:condition="view/showTitle"\n+    >\n+      <span tal:condition="view/title"\n+            tal:replace="view/title"\n+      >\n         Title\n       </span>\n     </div>\n \n     <div class="card-body portletContent">\n-      <ul tal:attributes="class string:actions-${view/category}">\n+      <ul tal:attributes="\n+            class string:actions-${view/category};\n+          ">\n         <tal:loop tal:repeat="link view/actionLinks">\n-        <li class="portletItem"\n-            tal:define="icon nocall:link/icon">\n-          <a href="#"\n-              tal:define="modal link/modal|nothing"\n-              tal:attributes="href link/url;\n-                              class python:\'pat-plone-modal\' if modal else None;\n-                              data-pat-plone-modal python:modal if modal else None;">\n-            <span tal:condition="not:icon"\n-                tal:content="link/title">\n+          <li class="portletItem"\n+              tal:define="\n+                icon nocall:link/icon;\n+              "\n+          >\n+            <a href="#"\n+               tal:define="\n+                 modal link/modal|nothing;\n+               "\n+               tal:attributes="\n+                 href link/url;\n+                 class python:\'pat-plone-modal\' if modal else None;\n+                 data-pat-plone-modal python:modal if modal else None;\n+               "\n+            >\n+              <span tal:condition="not:icon"\n+                    tal:content="link/title"\n+              >\n               Action\n-            </span>\n-            <span tal:condition="icon"\n-                tal:content="link/title"\n-                tal:define="icon_url icon/absolute_url|icon"\n-                tal:attributes="style string:background-image:url($icon_url);;">\n+              </span>\n+              <span tal:define="\n+                      icon_url icon/absolute_url|icon;\n+                    "\n+                    tal:condition="icon"\n+                    tal:content="link/title"\n+                    tal:attributes="\n+                      style string:background-image:url($icon_url);;;\n+                    "\n+              >\n               Action\n-            </span>\n-          </a>\n-        </li>\n+              </span>\n+            </a>\n+          </li>\n         </tal:loop>\n       </ul>\n     </div>\ndiff --git a/plone/app/portlets/portlets/base.py b/plone/app/portlets/portlets/base.py\nindex cfe507cb..cd6b8bcc 100644\n--- a/plone/app/portlets/portlets/base.py\n+++ b/plone/app/portlets/portlets/base.py\n@@ -1,6 +1,6 @@\n-from ..browser.formhelper import AddForm\n-from ..browser.formhelper import EditForm\n-from ..browser.formhelper import NullAddForm\n+from ..browser.formhelper import AddForm  # noqa F401 imported but unused\n+from ..browser.formhelper import EditForm  # noqa F401 imported but unused\n+from ..browser.formhelper import NullAddForm  # noqa F401 imported but unused\n from OFS.SimpleItem import SimpleItem\n from plone.app.portlets.interfaces import IDeferredPortletRenderer\n from plone.portlets.interfaces import IPortletAssignment\n@@ -86,14 +86,14 @@ class DeferredRenderer(Renderer):\n     render_preload = ViewPageTemplateFile("deferred_portlet.pt")\n \n     def render_full(self):\n-        raise NotImplemented(\n+        raise NotImplementedError(\n             "You must implement \'render_full\' as a method or page template file attribute"\n         )\n \n     def render(self):\n         """render the portlet\n \n-        the template gets choosen depending on the initialize state\n+        the template gets chosen depending on the initialize state\n         """\n         if self.initializing:\n             return self.render_preload()\ndiff --git a/plone/app/portlets/portlets/calendar.py b/plone/app/portlets/portlets/calendar.py\nindex 2d0e487f..b1af0295 100644\n--- a/plone/app/portlets/portlets/calendar.py\n+++ b/plone/app/portlets/portlets/calendar.py\n@@ -1,2 +1,2 @@\n # avoid broken persistent object\n-from plone.app.event.portlets.portlet_calendar import Assignment\n+from plone.app.event.portlets.portlet_calendar import Assignment  # noqa F401\ndiff --git a/plone/app/portlets/portlets/classic.pt b/plone/app/portlets/portlets/classic.pt\nindex 877411fe..bb3b4935 100644\n--- a/plone/app/portlets/portlets/classic.pt\n+++ b/plone/app/portlets/portlets/classic.pt\n@@ -1,12 +1,14 @@\n-<tal:block tal:define="use_macro view/use_macro;\n-                       path_expression view/path_expression">\n+<tal:block tal:define="\n+             use_macro view/use_macro;\n+             path_expression view/path_expression;\n+           ">\n \n   <tal:block condition="use_macro">\n     <metal:block metal:use-macro="python:path(path_expression)" />\n   </tal:block>\n \n   <tal:block condition="not:use_macro">\n-    <div tal:replace="structure python:path(path_expression)" />\n+    <div tal:replace="structure python:path(path_expression)"></div>\n   </tal:block>\n \n-</tal:block>\n\\ No newline at end of file\n+</tal:block>\ndiff --git a/plone/app/portlets/portlets/configure.zcml b/plone/app/portlets/portlets/configure.zcml\nindex 08e2bd7a..ef9cdc83 100644\n--- a/plone/app/portlets/portlets/configure.zcml\n+++ b/plone/app/portlets/portlets/configure.zcml\n@@ -1,96 +1,98 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:browser="http://namespaces.zope.org/browser"\n-           xmlns:plone="http://namespaces.plone.org/plone">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n-    <plone:portlet\n-        name="portlets.Classic"\n-        interface=".classic.IClassicPortlet"\n-        assignment=".classic.Assignment"\n-        renderer=".classic.Renderer"\n-        addview=".classic.AddForm"\n-        editview=".classic.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Classic"\n+      interface=".classic.IClassicPortlet"\n+      assignment=".classic.Assignment"\n+      renderer=".classic.Renderer"\n+      addview=".classic.AddForm"\n+      editview=".classic.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.News"\n-        interface=".news.INewsPortlet"\n-        assignment=".news.Assignment"\n-        renderer=".news.Renderer"\n-        addview=".news.AddForm"\n-        editview=".news.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.News"\n+      interface=".news.INewsPortlet"\n+      assignment=".news.Assignment"\n+      renderer=".news.Renderer"\n+      addview=".news.AddForm"\n+      editview=".news.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Login"\n-        interface=".login.ILoginPortlet"\n-        assignment=".login.Assignment"\n-        renderer=".login.Renderer"\n-        addview=".login.AddForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Login"\n+      interface=".login.ILoginPortlet"\n+      assignment=".login.Assignment"\n+      renderer=".login.Renderer"\n+      addview=".login.AddForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Navigation"\n-        interface=".navigation.INavigationPortlet"\n-        assignment=".navigation.Assignment"\n-        renderer=".navigation.Renderer"\n-        addview=".navigation.AddForm"\n-        editview=".navigation.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Navigation"\n+      interface=".navigation.INavigationPortlet"\n+      assignment=".navigation.Assignment"\n+      renderer=".navigation.Renderer"\n+      addview=".navigation.AddForm"\n+      editview=".navigation.EditForm"\n+      />\n \n-    <adapter factory=".navigation.QueryBuilder" />\n-    <adapter factory=".navigation.NavtreeStrategy" />\n+  <adapter factory=".navigation.QueryBuilder" />\n+  <adapter factory=".navigation.NavtreeStrategy" />\n \n-    <plone:portlet\n-        name="portlets.Recent"\n-        interface=".recent.IRecentPortlet"\n-        assignment=".recent.Assignment"\n-        renderer=".recent.Renderer"\n-        addview=".recent.AddForm"\n-        editview=".recent.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Recent"\n+      interface=".recent.IRecentPortlet"\n+      assignment=".recent.Assignment"\n+      renderer=".recent.Renderer"\n+      addview=".recent.AddForm"\n+      editview=".recent.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Review"\n-        interface=".review.IReviewPortlet"\n-        assignment=".review.Assignment"\n-        renderer=".review.Renderer"\n-        addview=".review.AddForm"\n-        editview=".review.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Review"\n+      interface=".review.IReviewPortlet"\n+      assignment=".review.Assignment"\n+      renderer=".review.Renderer"\n+      addview=".review.AddForm"\n+      editview=".review.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.rss"\n-        interface=".rss.IRSSPortlet"\n-        assignment=".rss.Assignment"\n-        renderer=".rss.Renderer"\n-        addview=".rss.AddForm"\n-        editview=".rss.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.rss"\n+      interface=".rss.IRSSPortlet"\n+      assignment=".rss.Assignment"\n+      renderer=".rss.Renderer"\n+      addview=".rss.AddForm"\n+      editview=".rss.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Search"\n-        interface=".search.ISearchPortlet"\n-        assignment=".search.Assignment"\n-        renderer=".search.Renderer"\n-        addview=".search.AddForm"\n-        editview=".search.EditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Search"\n+      interface=".search.ISearchPortlet"\n+      assignment=".search.Assignment"\n+      renderer=".search.Renderer"\n+      addview=".search.AddForm"\n+      editview=".search.EditForm"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Language"\n-        interface=".language.ILanguagePortlet"\n-        assignment=".language.Assignment"\n-        renderer=".language.Renderer"\n-        addview=".language.AddForm"\n-        />\n+  <plone:portlet\n+      name="portlets.Language"\n+      interface=".language.ILanguagePortlet"\n+      assignment=".language.Assignment"\n+      renderer=".language.Renderer"\n+      addview=".language.AddForm"\n+      />\n \n-    <plone:portlet\n-       name="portlets.Actions"\n-       interface=".actions.IActionsPortlet"\n-       assignment=".actions.Assignment"\n-       renderer=".actions.Renderer"\n-       addview=".actions.AddForm"\n-       editview=".actions.EditForm"\n-       />\n+  <plone:portlet\n+      name="portlets.Actions"\n+      interface=".actions.IActionsPortlet"\n+      assignment=".actions.Assignment"\n+      renderer=".actions.Renderer"\n+      addview=".actions.AddForm"\n+      editview=".actions.EditForm"\n+      />\n \n </configure>\ndiff --git a/plone/app/portlets/portlets/events.py b/plone/app/portlets/portlets/events.py\nindex f8eb93c6..f249a0f2 100644\n--- a/plone/app/portlets/portlets/events.py\n+++ b/plone/app/portlets/portlets/events.py\n@@ -1,2 +1,2 @@\n # avoid broken persistent object\n-from plone.app.event.portlets.portlet_events import Assignment\n+from plone.app.event.portlets.portlet_events import Assignment  # noqa F401\ndiff --git a/plone/app/portlets/portlets/language.pt b/plone/app/portlets/portlets/language.pt\nindex f79d7102..7fdc1eba 100644\n--- a/plone/app/portlets/portlets/language.pt\n+++ b/plone/app/portlets/portlets/language.pt\n@@ -1,33 +1,51 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n   <div class="card portlet portletLanguage">\n \n     <div class="card-header">\n-      <span class="tile" i18n:translate="box_languages">Languages</span>\n+      <span class="tile"\n+            i18n:translate="box_languages"\n+      >Languages</span>\n     </div>\n \n     <div class="card-body">\n-      <ul tal:define="showFlags view/showFlags">\n-        <li class="portletItem" tal:repeat="lang view/languages">\n-          <span tal:define="code lang/code;\n-                            selected lang/selected"\n-              tal:omit-tag="selected">\n+      <ul tal:define="\n+            showFlags view/showFlags;\n+          ">\n+        <li class="portletItem"\n+            tal:repeat="lang view/languages"\n+        >\n+          <span tal:define="\n+                  code lang/code;\n+                  selected lang/selected;\n+                "\n+                tal:omit-tag="selected"\n+          >\n             <a href=""\n-                tal:define="flag lang/flag;\n-                            name lang/name"\n-                tal:attributes="href string:${here/absolute_url}/switchLanguage?set_language=${code};\n-                                title name">\n+               tal:define="\n+                 flag lang/flag;\n+                 name lang/name;\n+               "\n+               tal:attributes="\n+                 href string:${here/absolute_url}/switchLanguage?set_language=${code};\n+                 title name;\n+               "\n+            >\n               <tal:flag condition="python:showFlags and flag">\n-                <img width="14"\n-                    height="11"\n-                    alt=""\n-                    tal:attributes="src string:${view/navigation_root_url}${flag};\n-                                    title python: name;\n-                                    class python: selected and \'currentItem\' or \'\';" />\n+                <img alt=""\n+                     height="11"\n+                     width="14"\n+                     tal:attributes="\n+                       src string:${view/navigation_root_url}${flag};\n+                       title python: name;\n+                       class python: selected and \'currentItem\' or \'\';\n+                     "\n+                />\n               </tal:flag>\n               <span tal:replace="lang/native|lang/name">Native language name</span>\n             </a>\ndiff --git a/plone/app/portlets/portlets/language.py b/plone/app/portlets/portlets/language.py\nindex 23906b7d..f61b2d1f 100644\n--- a/plone/app/portlets/portlets/language.py\n+++ b/plone/app/portlets/portlets/language.py\n@@ -1,6 +1,6 @@\n-from plone.app.i18n.locales.browser.selector import LanguageSelector\n from .. import PloneMessageFactory as _\n from ..portlets import base\n+from plone.app.i18n.locales.browser.selector import LanguageSelector\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getMultiAdapter\n@@ -13,7 +13,6 @@ class ILanguagePortlet(IPortletDataProvider):\n \n @implementer(ILanguagePortlet)\n class Assignment(base.Assignment):\n-\n     title = _("label_languages", default="Languages")\n \n \ndiff --git a/plone/app/portlets/portlets/login.pt b/plone/app/portlets/portlets/login.pt\nindex bcdb8093..b515b7d0 100644\n--- a/plone/app/portlets/portlets/login.pt\n+++ b/plone/app/portlets/portlets/login.pt\n@@ -1,126 +1,200 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n       i18n:domain="plone"\n-      tal:omit-tag="">\n+>\n \n   <tal:block condition="view/show">\n \n-  <div class="card portlet portletLogin"\n-      tal:condition="view/available">\n+    <div class="card portlet portletLogin"\n+         tal:condition="view/available"\n+    >\n \n-    <div class="card-header">\n-      <a href="#"\n-          class="tile"\n-          tal:attributes="href view/login_form"\n-          i18n:translate="box_sign_in">Log in</a>\n-    </div>\n+      <div class="card-header">\n+        <a class="tile"\n+           href="#"\n+           tal:attributes="\n+             href view/login_form;\n+           "\n+           i18n:translate="box_sign_in"\n+        >Log in</a>\n+      </div>\n \n-    <div class="card-body">\n-      <div tal:define="ac_name view/login_name;\n-                        ac_password view/login_password">\n-        <form action="login_form"\n-            id="loginform"\n-            method="post"\n-            tal:attributes="action view/login_form">\n-          <div>\n-            <input type="hidden" name="form.submitted" value="1" />\n-            <input type="hidden" name="came_from" value=""\n-                tal:attributes="value context/@@plone_context_state/current_page_url" />\n-            <input type="hidden" name="js_enabled" id="js_enabled" value="0" />\n-            <input type="hidden" name="cookies_enabled" id="cookies_enabled" value="" />\n-            <input type="hidden" name="login_name" id="login_name" value="" />\n-            <input type="hidden" name="pwd_empty" id="pwd_empty" value="0" />\n-          </div>\n-          <div class="field"\n-              tal:define="use_email_as_login python:context.portal_registry[\'plone.use_email_as_login\'];">\n-            <tal:loginname condition="not:use_email_as_login">\n+      <div class="card-body">\n+        <div tal:define="\n+               ac_name view/login_name;\n+               ac_password view/login_password;\n+             ">\n+          <form id="loginform"\n+                action="login_form"\n+                method="post"\n+                tal:attributes="\n+                  action view/login_form;\n+                "\n+          >\n+            <div>\n+              <input name="form.submitted"\n+                     type="hidden"\n+                     value="1"\n+              />\n+              <input name="came_from"\n+                     type="hidden"\n+                     value=""\n+                     tal:attributes="\n+                       value context/@@plone_context_state/current_page_url;\n+                     "\n+              />\n+              <input id="js_enabled"\n+                     name="js_enabled"\n+                     type="hidden"\n+                     value="0"\n+              />\n+              <input id="cookies_enabled"\n+                     name="cookies_enabled"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input id="login_name"\n+                     name="login_name"\n+                     type="hidden"\n+                     value=""\n+              />\n+              <input id="pwd_empty"\n+                     name="pwd_empty"\n+                     type="hidden"\n+                     value="0"\n+              />\n+            </div>\n+            <div class="field"\n+                 tal:define="\n+                   use_email_as_login python:context.portal_registry[\'plone.use_email_as_login\'];\n+                 "\n+            >\n+              <tal:loginname condition="not:use_email_as_login">\n+                <label for=""\n+                       tal:attributes="\n+                         for ac_name;\n+                       "\n+                       i18n:translate="label_login_name"\n+                >Login Name</label>\n+                <br />\n+                <input size="10"\n+                       type="text"\n+                       tal:attributes="\n+                         name ac_name;\n+                         id ac_name;\n+                         value python:request.get(ac_name, \'\');\n+                       "\n+                />\n+              </tal:loginname>\n+              <tal:email condition="use_email_as_login">\n+                <label for=""\n+                       tal:attributes="\n+                         for ac_name;\n+                       "\n+                       i18n:translate="label_email"\n+                >Email</label>\n+                <br />\n+                <input size="10"\n+                       type="text"\n+                       tal:attributes="\n+                         name ac_name;\n+                         id ac_name;\n+                         value python:request.get(ac_name, \'\');\n+                       "\n+                />\n+              </tal:email>\n+            </div>\n+            <div class="field">\n               <label for=""\n-                  tal:attributes="for ac_name"\n-                  i18n:translate="label_login_name">Login Name</label>\n+                     tal:attributes="\n+                       for ac_password;\n+                     "\n+                     i18n:translate="label_password"\n+              >Password</label>\n               <br />\n-              <input type="text"\n-                  size="10"\n-                  tal:attributes="name ac_name; id ac_name;\n-                                  value python:request.get(ac_name, \'\');" />\n-            </tal:loginname>\n-            <tal:email condition="use_email_as_login">\n-              <label for=""\n-                  tal:attributes="for ac_name"\n-                  i18n:translate="label_email">Email</label>\n-              <br />\n-              <input type="text"\n-                  size="10"\n-                  tal:attributes="name ac_name; id ac_name;\n-                                  value python:request.get(ac_name, \'\');" />\n-            </tal:email>\n-          </div>\n-          <div class="field">\n-            <label for=""\n-                tal:attributes="for ac_password"\n-                i18n:translate="label_password">Password</label>\n-            <br />\n-            <input type="password"\n-                size="10"\n-                tal:attributes="name ac_password; id ac_password;" />\n-          </div>\n-          <div class="cookiesMessage alert alert-warning"\n-              style="display:none" role="alert">\n-            <strong i18n:translate="">Warning</strong>\n-            <span i18n:translate="enable_cookies_message_before_login">\n+              <input size="10"\n+                     type="password"\n+                     tal:attributes="\n+                       name ac_password;\n+                       id ac_password;\n+                     "\n+              />\n+            </div>\n+            <div class="cookiesMessage alert alert-warning"\n+                 role="alert"\n+                 style="display:none"\n+            >\n+              <strong i18n:translate="">Warning</strong>\n+              <span i18n:translate="enable_cookies_message_before_login">\n               Cookies are not enabled. You must enable cookies before you\n               can log in.\n-            </span>\n-          </div>\n-          <div class="formControls">\n-            <input class="btn btn-primary"\n-                type="submit"\n-                name="buttons.login"\n-                value="Log in"\n-                title="Log in"\n-                i18n:attributes="value label_log_in; title label_log_in;"/>\n-          </div>\n-        </form>\n+              </span>\n+            </div>\n+            <div class="formControls">\n+              <input class="btn btn-primary"\n+                     name="buttons.login"\n+                     title="Log in"\n+                     type="submit"\n+                     value="Log in"\n+                     i18n:attributes="value label_log_in; title label_log_in;"\n+              />\n+            </div>\n+          </form>\n+        </div>\n       </div>\n-    </div>\n \n-    <div class="card-footer">\n-      <div tal:condition="view/can_request_password">\n-        <a href="mail_password_form"\n-            class="tile"\n-            tal:attributes="href view/mail_password_form">\n-          <tal:block replace="structure context/info_icon.png"/>\n-          <span tal:omit-tag="" i18n:translate="box_forgot_password_option">Forgot your password?</span>\n-        </a>\n-      </div>\n-      <div tal:condition="view/can_register">\n-        <a href=""\n-            class="tile"\n-            tal:attributes="href view/join_action">\n-          <tal:block replace="structure context/user.png"/>\n-          <span tal:omit-tag="" i18n:translate="box_new_user_option">New user?</span>\n-        </a>\n+      <div class="card-footer">\n+        <div tal:condition="view/can_request_password">\n+          <a class="tile"\n+             href="mail_password_form"\n+             tal:attributes="\n+               href view/mail_password_form;\n+             "\n+          >\n+            <tal:block replace="structure context/info_icon.png" />\n+            <span tal:omit-tag=""\n+                  i18n:translate="box_forgot_password_option"\n+            >Forgot your password?</span>\n+          </a>\n+        </div>\n+        <div tal:condition="view/can_register">\n+          <a class="tile"\n+             href=""\n+             tal:attributes="\n+               href view/join_action;\n+             "\n+          >\n+            <tal:block replace="structure context/user.png" />\n+            <span tal:omit-tag=""\n+                  i18n:translate="box_new_user_option"\n+            >New user?</span>\n+          </a>\n+        </div>\n       </div>\n     </div>\n-  </div>\n \n-  <div class="card portlet portletLogin"\n-      tal:condition="not:view/available">\n+    <div class="card portlet portletLogin"\n+         tal:condition="not:view/available"\n+    >\n \n-    <div class="card-header">\n-      <a href="#"\n-          class="tile"\n-          i18n:translate="box_sign_in">Log in</a>\n-    </div>\n+      <div class="card-header">\n+        <a class="tile"\n+           href="#"\n+           i18n:translate="box_sign_in"\n+        >Log in</a>\n+      </div>\n \n-    <div class="card-body"\n-        i18n:translate="login_portlet_disabled">\n+      <div class="card-body"\n+           i18n:translate="login_portlet_disabled"\n+      >\n       Cookie authentication is disabled.\n       Login portlet not available.\n-    </div>\n+      </div>\n \n-  </div>\n+    </div>\n \n   </tal:block>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/portlets/portlets/login.py b/plone/app/portlets/portlets/login.py\nindex 3f6cc1ac..ab23fa6b 100644\n--- a/plone/app/portlets/portlets/login.py\n+++ b/plone/app/portlets/portlets/login.py\n@@ -14,7 +14,6 @@ class ILoginPortlet(IPortletDataProvider):\n \n @implementer(ILoginPortlet)\n class Assignment(base.Assignment):\n-\n     title = _("label_log_in", default="Log in")\n \n \ndiff --git a/plone/app/portlets/portlets/navigation.pt b/plone/app/portlets/portlets/navigation.pt\nindex 73555dcc..b661c2c6 100644\n--- a/plone/app/portlets/portlets/navigation.pt\n+++ b/plone/app/portlets/portlets/navigation.pt\n@@ -1,44 +1,63 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n \n   <div class="card portlet portletNavigationTree"\n-      tal:define="root view/navigation_root"\n-      i18n:domain="plone">\n+       tal:define="\n+         root view/navigation_root;\n+       "\n+       i18n:domain="plone"\n+  >\n \n     <div class="card-header"\n-        tal:attributes="class python:view.hasName() and \'card-header\' or \'card-header hiddenStructure\'">\n-      <a href="#"\n-          class="tile"\n-          tal:attributes="href string:${view/heading_link_target}"\n-          tal:content="view/title"\n-          i18n:translate="">Navigation</a>\n+         tal:attributes="\n+           class python:view.hasName() and \'card-header\' or \'card-header hiddenStructure\';\n+         "\n+    >\n+      <a class="tile"\n+         href="#"\n+         tal:content="view/title"\n+         tal:attributes="\n+           href string:${view/heading_link_target};\n+         "\n+         i18n:translate=""\n+      >Navigation</a>\n     </div>\n \n     <nav class="card-body">\n       <ul class="navTree navTreeLevel0">\n-        <li tal:define="selectedClass view/root_item_class;\n-                        li_class python:selectedClass and \' navTreeCurrentNode\' or \'\';\n-                        normalizeString nocall:context/plone_utils/normalizeString;\n-                        section_title root/Title;\n-                        section python:normalizeString(section_title);"\n+        <li tal:define="\n+              selectedClass view/root_item_class;\n+              li_class python:selectedClass and \' navTreeCurrentNode\' or \'\';\n+              normalizeString nocall:context/plone_utils/normalizeString;\n+              section_title root/Title;\n+              section python:normalizeString(section_title);\n+            "\n             tal:condition="view/include_top"\n-            tal:attributes="class string:navTreeItem navTreeTopNode${li_class} nav-section-${section}">\n+            tal:attributes="\n+              class string:navTreeItem navTreeTopNode${li_class} nav-section-${section};\n+            "\n+        >\n           <div tal:define="\n-                  rootIsPortal view/root_is_portal;\n-                  root_type root/portal_type;\n-                  root_type_class python:\'contenttype-\' + normalizeString(root_type);\n-                  root_class python:rootIsPortal and \'contenttype-plone-site\' or root_type_class;\n-              ">\n-            <a tal:attributes="href root/absolute_url;\n-                              title root/Description;\n-                              class python:\' \'.join([root_class, selectedClass]).strip();">\n-              <span tal:omit-tag=""\n-                  tal:condition="rootIsPortal"\n-                  i18n:translate="tabs_home">Home</span>\n+                 rootIsPortal view/root_is_portal;\n+                 root_type root/portal_type;\n+                 root_type_class python:\'contenttype-\' + normalizeString(root_type);\n+                 root_class python:rootIsPortal and \'contenttype-plone-site\' or root_type_class;\n+               ">\n+            <a tal:attributes="\n+                 href root/absolute_url;\n+                 title root/Description;\n+                 class python:\' \'.join([root_class, selectedClass]).strip();\n+               ">\n+              <span tal:condition="rootIsPortal"\n+                    tal:omit-tag=""\n+                    i18n:translate="tabs_home"\n+              >Home</span>\n               <span tal:condition="not:rootIsPortal"\n-                  tal:replace="root/Title">Root item title</span>\n+                    tal:replace="root/Title"\n+              >Root item title</span>\n             </a>\n           </div>\n         </li>\ndiff --git a/plone/app/portlets/portlets/navigation.py b/plone/app/portlets/portlets/navigation.py\nindex 124c6049..f1fc0819 100644\n--- a/plone/app/portlets/portlets/navigation.py\n+++ b/plone/app/portlets/portlets/navigation.py\n@@ -27,7 +27,6 @@\n from Products.CMFPlone.browser.navtree import SitemapNavtreeStrategy\n from Products.CMFPlone.utils import typesToList\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n-from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path\n from zExceptions import NotFound\n from zope import schema\n from zope.component import adapter\n@@ -37,8 +36,6 @@\n from zope.interface import implementer\n from zope.interface import Interface\n \n-import os\n-\n \n class INavigationPortlet(IPortletDataProvider):\n     """A portlet which can render the navigation tree"""\n@@ -150,7 +147,6 @@ class INavigationPortlet(IPortletDataProvider):\n \n @implementer(INavigationPortlet)\n class Assignment(base.Assignment):\n-\n     name = ""\n     root = None\n     root_uid = None\n@@ -484,13 +480,12 @@ def __init__(self, context, portlet):\n \n     def subtreeFilter(self, node):\n         sitemapDecision = SitemapNavtreeStrategy.subtreeFilter(self, node)\n-        if sitemapDecision == False:\n+        if not sitemapDecision:\n             return False\n         depth = node.get("depth", 0)\n         if depth > 0 and self.bottomLevel > 0 and depth >= self.bottomLevel:\n             return False\n-        else:\n-            return True\n+        return True\n \n \n def getRootPath(context, currentFolderOnly, topLevel, root):\ndiff --git a/plone/app/portlets/portlets/navigation_recurse.pt b/plone/app/portlets/portlets/navigation_recurse.pt\nindex 8b6a9d28..b7a52d86 100644\n--- a/plone/app/portlets/portlets/navigation_recurse.pt\n+++ b/plone/app/portlets/portlets/navigation_recurse.pt\n@@ -1,61 +1,82 @@\n-<tal:master define="level options/level | python:0;\n-                    children options/children | nothing;\n-                    bottomLevel options/bottomLevel | nothing;\n-                    supress_icon    view/data/no_icons;\n-                    supress_thumb   view/data/no_thumbs;\n-                    thumb_scale view/thumb_scale;\n-                    icons nocall:context/@@iconresolver;\n-                    normalizeString nocall: context/plone_utils/normalizeString;"\n-            i18n:domain="plone">\n-\n-<metal:main define-macro="nav_main"\n-\t   tal:define="portal context/@@plone_portal_state/portal;\n-                   image_scale portal/@@image_scale">\n-<tal:navitem repeat="node children">\n-<li tal:define="show_children   node/show_children;\n-                children        node/children;\n-                item_url        node/getURL;\n-                item_remote_url node/getRemoteUrl;\n-                use_remote_url  node/useRemoteUrl | nothing;\n-                item_type       node/portal_type;\n-                item            node/item;\n-                has_thumb       item/getIcon;\n-                is_current      node/currentItem;\n-                is_in_path      node/currentParent;\n-                li_class        python:\' navTreeCurrentNode\' if is_current else \'\';\n-                li_extr_class   python:\' navTreeItemInPath\' if is_in_path else \'\';\n-                li_folder_class python:\' navTreeFolderish\' if show_children else \'\';"\n-    tal:condition="python:bottomLevel &lt;= 0 or level &lt;= bottomLevel"\n-    tal:attributes="class string:navTreeItem visualNoMarker${li_class}${li_extr_class}${li_folder_class} section-${node/normalized_id}">\n-\n-    <tal:level define="item_class string:state-${node/normalized_review_state};\n-                       item_type_class python:\'contenttype-%s\' % normalizeString(item_type) if not supress_icon else \'\';\n-                       item_class python:\'%s navTreeCurrentItem\' % item_class if is_current else item_class">\n-\n-        <a tal:attributes="href  python:item_remote_url if use_remote_url else item_url;\n-                           title node/Description;\n-                           class string:${item_class}${li_class}${li_extr_class}${li_folder_class} ${item_type_class}">\n+<tal:master define="\n+              level options/level | python:0;\n+              children options/children | nothing;\n+              bottomLevel options/bottomLevel | nothing;\n+              supress_icon    view/data/no_icons;\n+              supress_thumb   view/data/no_thumbs;\n+              thumb_scale view/thumb_scale;\n+              icons nocall:context/@@iconresolver;\n+              normalizeString nocall: context/plone_utils/normalizeString;\n+            "\n+            i18n:domain="plone"\n+>\n+\n+  <metal:main define-macro="nav_main"\n+              tal:define="\n+                portal context/@@plone_portal_state/portal;\n+                image_scale portal/@@image_scale;\n+              "\n+  >\n+    <tal:navitem repeat="node children">\n+      <li tal:define="\n+            show_children   node/show_children;\n+            children        node/children;\n+            item_url        node/getURL;\n+            item_remote_url node/getRemoteUrl;\n+            use_remote_url  node/useRemoteUrl | nothing;\n+            item_type       node/portal_type;\n+            item            node/item;\n+            has_thumb       item/getIcon;\n+            is_current      node/currentItem;\n+            is_in_path      node/currentParent;\n+            li_class        python:\' navTreeCurrentNode\' if is_current else \'\';\n+            li_extr_class   python:\' navTreeItemInPath\' if is_in_path else \'\';\n+            li_folder_class python:\' navTreeFolderish\' if show_children else \'\';\n+          "\n+          tal:condition="python:bottomLevel &lt;= 0 or level &lt;= bottomLevel"\n+          tal:attributes="\n+            class string:navTreeItem visualNoMarker${li_class}${li_extr_class}${li_folder_class} section-${node/normalized_id};\n+          "\n+      >\n+\n+        <tal:level define="\n+                     item_class string:state-${node/normalized_review_state};\n+                     item_type_class python:\'contenttype-%s\' % normalizeString(item_type) if not supress_icon else \'\';\n+                     item_class python:\'%s navTreeCurrentItem\' % item_class if is_current else item_class;\n+                   ">\n+\n+          <a tal:attributes="\n+               href  python:item_remote_url if use_remote_url else item_url;\n+               title node/Description;\n+               class string:${item_class}${li_class}${li_extr_class}${li_folder_class} ${item_type_class};\n+             ">\n \n             <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n-                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')" />\n+                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')"\n+            />\n \n             <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n-                      tal:replace="structure python:icons.tag(f\'mimetype-{item.mime_type}\')" />\n+                      tal:replace="structure python:icons.tag(f\'mimetype-{item.mime_type}\')"\n+            />\n \n             <img tal:condition="python:has_thumb and thumb_scale"\n-                 tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)">\n+                 tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)"\n+            />\n \n             <span tal:replace="node/Title">Selected Item Title</span>\n-        </a>\n-        <tal:children condition="children">\n-            <ul tal:attributes="class string:navTree navTreeLevel${level}"\n-                tal:condition="python: children and show_children and bottomLevel and level < bottomLevel or bottomLevel == 0">\n-                <span tal:replace="structure python:view.recurse(children=children, level=level+1, bottomLevel=bottomLevel)" />\n+          </a>\n+          <tal:children condition="children">\n+            <ul tal:condition="python: children and show_children and bottomLevel and level &lt; bottomLevel or bottomLevel == 0"\n+                tal:attributes="\n+                  class string:navTree navTreeLevel${level};\n+                "\n+            >\n+              <span tal:replace="structure python:view.recurse(children=children, level=level+1, bottomLevel=bottomLevel)"></span>\n             </ul>\n-        </tal:children>\n+          </tal:children>\n \n-    </tal:level>\n-</li>\n-</tal:navitem>\n-</metal:main>\n+        </tal:level>\n+      </li>\n+    </tal:navitem>\n+  </metal:main>\n </tal:master>\ndiff --git a/plone/app/portlets/portlets/news.pt b/plone/app/portlets/portlets/news.pt\nindex 3b53a00b..1dc0c9c9 100644\n--- a/plone/app/portlets/portlets/news.pt\n+++ b/plone/app/portlets/portlets/news.pt\n@@ -1,58 +1,86 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n \n   <div class="card portlet portletNews"\n-      i18n:domain="plone">\n+       i18n:domain="plone"\n+  >\n \n     <div class="card-header">\n-      <a href="#"\n-          class="tile"\n-          tal:define="all_news_link view/all_news_link"\n-          tal:omit-tag="not:all_news_link"\n-          tal:attributes="href all_news_link"\n-          i18n:translate="box_news">News</a>\n+      <a class="tile"\n+         href="#"\n+         tal:define="\n+           all_news_link view/all_news_link;\n+         "\n+         tal:omit-tag="not:all_news_link"\n+         tal:attributes="\n+           href all_news_link;\n+         "\n+         i18n:translate="box_news"\n+      >News</a>\n     </div>\n \n     <div class="card-body"\n-        tal:define="thumb_scale view/thumb_scale;\n-                    supress_thumb view/data/no_thumbs;">\n+         tal:define="\n+           thumb_scale view/thumb_scale;\n+           supress_thumb view/data/no_thumbs;\n+         "\n+    >\n       <ul>\n-        <tal:newsitems\n-            tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;\n-                        plone_layout context/@@plone_layout;\n-                        portal context/@@plone_portal_state/portal;\n-                        image_scale portal/@@image_scale;\n-                        thumb_scale view/thumb_scale"\n-            tal:repeat="obj view/published_news_items">\n-        <li tal:define="oddrow repeat/obj/odd;"\n-            tal:attributes="class python:oddrow and \'portletItem even\' or \'portletItem odd\'">\n-          <a href=""\n-              class="tile"\n-              tal:attributes="href obj/getURL;\n-                              title obj/Description">\n-            <img tal:condition="python:obj.getIcon and thumb_scale"\n-                tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)" />\n-            <span tal:replace="obj/pretty_title_or_id">Plone 5.1 announced!</span>\n-          </a>\n-          <time class="portletItemDetails"\n-              tal:content="python:toLocalizedTime(obj.Date)">May 5</time>\n-        </li>\n+        <tal:newsitems tal:define="\n+                         toLocalizedTime nocall:context/@@plone/toLocalizedTime;\n+                         plone_layout context/@@plone_layout;\n+                         portal context/@@plone_portal_state/portal;\n+                         image_scale portal/@@image_scale;\n+                         thumb_scale view/thumb_scale;\n+                       "\n+                       tal:repeat="obj view/published_news_items"\n+        >\n+          <li tal:define="\n+                oddrow repeat/obj/odd;\n+              "\n+              tal:attributes="\n+                class python:oddrow and \'portletItem even\' or \'portletItem odd\';\n+              "\n+          >\n+            <a class="tile"\n+               href=""\n+               tal:attributes="\n+                 href obj/getURL;\n+                 title obj/Description;\n+               "\n+            >\n+              <img tal:condition="python:obj.getIcon and thumb_scale"\n+                   tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)"\n+              />\n+              <span tal:replace="obj/pretty_title_or_id">Plone 5.1 announced!</span>\n+            </a>\n+            <time class="portletItemDetails"\n+                  tal:content="python:toLocalizedTime(obj.Date)"\n+            >May 5</time>\n+          </li>\n         </tal:newsitems>\n       </ul>\n     </div>\n \n     <div class="card-footer portletFooter"\n-        tal:condition="view/all_news_link">\n+         tal:condition="view/all_news_link"\n+    >\n       <a href=""\n-          tal:attributes="href view/all_news_link"\n-          i18n:translate="box_more_news_link">\n+         tal:attributes="\n+           href view/all_news_link;\n+         "\n+         i18n:translate="box_more_news_link"\n+      >\n         More news&hellip;\n       </a>\n     </div>\n-    <div class="card-footer" tal:condition="not:view/all_news_link"></div>\n+    <div class="card-footer"\n+         tal:condition="not:view/all_news_link"\n+    ></div>\n \n   </div>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/portlets/portlets/news.py b/plone/app/portlets/portlets/news.py\nindex 0075ee9d..ebb7d97b 100644\n--- a/plone/app/portlets/portlets/news.py\n+++ b/plone/app/portlets/portlets/news.py\n@@ -5,13 +5,13 @@\n from plone.app.layout.navigation.root import getNavigationRootObject\n from plone.app.z3cform.widget import SelectFieldWidget\n from plone.autoform.directives import widget\n+from plone.base.interfaces import ISiteSchema\n from plone.memoize import ram\n from plone.memoize.compress import xhtml_compress\n from plone.memoize.instance import memoize\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\n from zope.component import getMultiAdapter\n@@ -20,7 +20,6 @@\n \n \n class INewsPortlet(IPortletDataProvider):\n-\n     count = schema.Int(\n         title=_("Number of items to display"),\n         description=_("How many items to list."),\n@@ -60,7 +59,6 @@ class INewsPortlet(IPortletDataProvider):\n \n @implementer(INewsPortlet)\n class Assignment(base.Assignment):\n-\n     thumb_scale = None\n     no_thumbs = False\n \n@@ -78,7 +76,6 @@ def title(self):\n \n \n class Renderer(base.Renderer):\n-\n     _template = ViewPageTemplateFile("news.pt")\n \n     def __init__(self, *args):\ndiff --git a/plone/app/portlets/portlets/recent.pt b/plone/app/portlets/portlets/recent.pt\nindex d7ce3ed1..ac9dc4f6 100644\n--- a/plone/app/portlets/portlets/recent.pt\n+++ b/plone/app/portlets/portlets/recent.pt\n@@ -1,56 +1,89 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n   <div class="card portlet portletRecent">\n \n     <div class="card-header">\n-      <a href="#" tal:attributes="href view/recently_modified_link" i18n:translate="" tal:content="view/title" />\n+      <a href="#"\n+         tal:content="view/title"\n+         tal:attributes="\n+           href view/recently_modified_link;\n+         "\n+         i18n:translate=""\n+      ></a>\n     </div>\n \n-    <div class="card-body" tal:condition="view/recent_items"\n-        tal:define="plone_layout context/@@plone_layout;\n-                    portal context/@@plone_portal_state/portal;\n-                    image_scale portal/@@image_scale;\n-                    supress_icon view/data/no_icons;\n-                    supress_thumb view/data/no_thumbs;\n-                    thumb_scale view/thumb_scale;\n-                    icons nocall:context/@@iconresolver;">\n+    <div class="card-body"\n+         tal:define="\n+           plone_layout context/@@plone_layout;\n+           portal context/@@plone_portal_state/portal;\n+           image_scale portal/@@image_scale;\n+           supress_icon view/data/no_icons;\n+           supress_thumb view/data/no_thumbs;\n+           thumb_scale view/thumb_scale;\n+           icons nocall:context/@@iconresolver;\n+         "\n+         tal:condition="view/recent_items"\n+    >\n       <ul>\n-        <tal:items\n-            tal:define="plone_view context/@@plone;\n-                        normalizeString nocall:plone_view/normalizeString;\n-                        toLocalizedTime nocall:plone_view/toLocalizedTime;"\n-            tal:repeat="obj view/recent_items">\n-        <li tal:define="oddrow repeat/obj/odd;\n-                        item_type obj/portal_type;\n-                        item_wf_state obj/review_state;\n-                        item_wf_state_class python:\'state-\' + normalizeString(item_wf_state);\n-                        item_class python:\'contenttype-\' + normalizeString(obj.portal_type) if not supress_icon else \'\';">\n-          <a href="" tal:attributes="href string:${obj/getURL}/view; title obj/Description; class string:$item_wf_state_class tile $item_class">\n-\n-            <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n-                      tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')" />\n-            <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n-                      tal:replace="structure python:icons.tag(f\'mimetype-{obj.mime_type}\')" />\n-\n-            <img tal:condition="python:obj.getIcon and thumb_scale and not supress_thumb and image_scale" tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)" />\n-            <span tal:content="obj/pretty_title_or_id">Title</span>\n-          </a>\n-          <time tal:content="python:toLocalizedTime(obj.ModificationDate)">May 5</time>\n-        </li>\n+        <tal:items tal:define="\n+                     plone_view context/@@plone;\n+                     normalizeString nocall:plone_view/normalizeString;\n+                     toLocalizedTime nocall:plone_view/toLocalizedTime;\n+                   "\n+                   tal:repeat="obj view/recent_items"\n+        >\n+          <li tal:define="\n+                oddrow repeat/obj/odd;\n+                item_type obj/portal_type;\n+                item_wf_state obj/review_state;\n+                item_wf_state_class python:\'state-\' + normalizeString(item_wf_state);\n+                item_class python:\'contenttype-\' + normalizeString(obj.portal_type) if not supress_icon else \'\';\n+              ">\n+            <a href=""\n+               tal:attributes="\n+                 href string:${obj/getURL}/view;\n+                 title obj/Description;\n+                 class string:$item_wf_state_class tile $item_class;\n+               "\n+            >\n+\n+              <tal:icon tal:condition="python: not supress_icon and item_type != \'File\'"\n+                        tal:replace="structure python:icons.tag(f\'contenttype/{normalizeString(item_type)}\')"\n+              />\n+              <tal:icon tal:condition="python: not supress_icon and item_type == \'File\'"\n+                        tal:replace="structure python:icons.tag(f\'mimetype-{obj.mime_type}\')"\n+              />\n+\n+              <img tal:condition="python:obj.getIcon and thumb_scale and not supress_thumb and image_scale"\n+                   tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)"\n+              />\n+              <span tal:content="obj/pretty_title_or_id">Title</span>\n+            </a>\n+            <time tal:content="python:toLocalizedTime(obj.ModificationDate)">May 5</time>\n+          </li>\n         </tal:items>\n       </ul>\n     </div>\n \n-    <div class="card-body" tal:condition="not: view/recent_items">\n+    <div class="card-body"\n+         tal:condition="not: view/recent_items"\n+    >\n       <p i18n:translate="box_recent_no_items">No items changed yet.</p>\n     </div>\n \n     <div class="card-footer">\n-      <a href="#" class="tile" tal:attributes="href view/recently_modified_link" i18n:translate="box_more_recently_changed">All recent changes&hellip;</a>\n+      <a class="tile"\n+         href="#"\n+         tal:attributes="\n+           href view/recently_modified_link;\n+         "\n+         i18n:translate="box_more_recently_changed"\n+      >All recent changes&hellip;</a>\n     </div>\n   </div>\n \ndiff --git a/plone/app/portlets/portlets/recent.py b/plone/app/portlets/portlets/recent.py\nindex 6ee8eeb7..05e7d74a 100644\n--- a/plone/app/portlets/portlets/recent.py\n+++ b/plone/app/portlets/portlets/recent.py\n@@ -3,13 +3,13 @@\n from ..portlets import base\n from Acquisition import aq_inner\n from plone.app.layout.navigation.root import getNavigationRoot\n+from plone.base.interfaces.controlpanel import ISiteSchema\n from plone.memoize import ram\n from plone.memoize.compress import xhtml_compress\n from plone.memoize.instance import memoize\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path\n from zope import schema\n@@ -21,7 +21,6 @@\n \n \n class IRecentPortlet(IPortletDataProvider):\n-\n     count = schema.Int(\n         title=_("Number of items to display"),\n         description=_("How many items to list."),\ndiff --git a/plone/app/portlets/portlets/review.pt b/plone/app/portlets/portlets/review.pt\nindex c3b16cf5..e0bd4c52 100644\n--- a/plone/app/portlets/portlets/review.pt\n+++ b/plone/app/portlets/portlets/review.pt\n@@ -1,63 +1,89 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n \n   <div class="card portlet portletWorkflowReview"\n-      i18n:domain="plone">\n+       i18n:domain="plone"\n+  >\n \n     <div class="card-header">\n-      <a href="#"\n-          class="tile"\n-          tal:define="full_review_link view/full_review_link"\n-          tal:omit-tag="not:full_review_link"\n-          tal:attributes="href full_review_link"\n-          i18n:translate=""\n-          tal:content="view/title" />\n+      <a class="tile"\n+         href="#"\n+         tal:define="\n+           full_review_link view/full_review_link;\n+         "\n+         tal:content="view/title"\n+         tal:omit-tag="not:full_review_link"\n+         tal:attributes="\n+           href full_review_link;\n+         "\n+         i18n:translate=""\n+      ></a>\n     </div>\n \n     <div class="card-body"\n-        tal:define="supress_icon    view/data/no_icons;\n-                    supress_thumb   view/data/no_thumbs;\n-                    thumb_scale python:view.thumb_scale();\n-                    ">\n+         tal:define="\n+           supress_icon    view/data/no_icons;\n+           supress_thumb   view/data/no_thumbs;\n+           thumb_scale python:view.thumb_scale();\n+         "\n+    >\n       <ul>\n         <tal:items tal:repeat="obj view/review_items">\n-        <li class="portletItem"\n-            tal:define="oddrow repeat/obj/odd;\n-                        review_state_class obj/review_state_class;\n-                        image obj/images;\n-                        hasImage obj/hasImage;\n-                        item_class python: obj[\'item_class\'] if not supress_icon else \'\';"\n-            tal:attributes="class python:oddrow and \'portletItem even\' or \'portletItem odd\'">\n-\n-          <a href="#"\n-              tal:attributes="href string:${obj/path}/view;\n-                              title obj/description;\n-                              class string:$review_state_class tile $item_class">\n-            <img tal:condition="python:not supress_thumb and hasImage and thumb_scale"\n-                tal:replace="structure python:image.scale(\'image\', scale=thumb_scale).tag(css_class=\'float-end thumb-\'+thumb_scale)"/>\n-            <span tal:replace="obj/title">Title</span>\n-          </a>\n-          <span class="portletItemDetails">\n-              <span tal:replace="obj/creator">Jim Smith</span> &mdash;\n-              <time tal:replace="obj/mod_date"> May 5</time>\n-          </span>\n-\n-        </li>\n+          <li class="portletItem"\n+              tal:define="\n+                oddrow repeat/obj/odd;\n+                review_state_class obj/review_state_class;\n+                image obj/images;\n+                hasImage obj/hasImage;\n+                item_class python: obj[\'item_class\'] if not supress_icon else \'\';\n+              "\n+              tal:attributes="\n+                class python:oddrow and \'portletItem even\' or \'portletItem odd\';\n+              "\n+          >\n+\n+            <a href="#"\n+               tal:attributes="\n+                 href string:${obj/path}/view;\n+                 title obj/description;\n+                 class string:$review_state_class tile $item_class;\n+               "\n+            >\n+              <img tal:condition="python:not supress_thumb and hasImage and thumb_scale"\n+                   tal:replace="structure python:image.scale(\'image\', scale=thumb_scale).tag(css_class=\'float-end thumb-\'+thumb_scale)"\n+              />\n+              <span tal:replace="obj/title">Title</span>\n+            </a>\n+            <span class="portletItemDetails">\n+              <span tal:replace="obj/creator">Jim Smith</span>\n+               &mdash;\n+              <time tal:replace="obj/mod_date">\n+                May 5</time>\n+            </span>\n+\n+          </li>\n         </tal:items>\n       </ul>\n     </div>\n \n     <div class="card-footer"\n-        tal:define="full_review_link view/full_review_link"\n-        tal:condition="full_review_link">\n-      <a href="#"\n-          class="tile"\n-          tal:attributes="href full_review_link"\n-          i18n:translate="box_full_review_list">Full review list&hellip;</a>\n+         tal:define="\n+           full_review_link view/full_review_link;\n+         "\n+         tal:condition="full_review_link"\n+    >\n+      <a class="tile"\n+         href="#"\n+         tal:attributes="\n+           href full_review_link;\n+         "\n+         i18n:translate="box_full_review_list"\n+      >Full review list&hellip;</a>\n     </div>\n \n   </div>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/portlets/portlets/review.py b/plone/app/portlets/portlets/review.py\nindex 1c00c23c..feb83225 100644\n--- a/plone/app/portlets/portlets/review.py\n+++ b/plone/app/portlets/portlets/review.py\n@@ -3,23 +3,21 @@\n from ..portlets import base\n from Acquisition import aq_base\n from Acquisition import aq_inner\n+from plone.base.interfaces.controlpanel import ISiteSchema\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.memoize.instance import memoize\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n from zope.component import queryUtility\n from zope.interface import implementer\n-from zope.interface import Interface\n \n \n class IReviewPortlet(IPortletDataProvider):\n-\n     no_icons = schema.Bool(\n         title=_("Suppress Icons"),\n         description=_("If enabled, the portlet will not show document type icons"),\n@@ -64,7 +62,6 @@ def title(self):\n \n \n class Renderer(base.Renderer):\n-\n     render = ViewPageTemplateFile("review.pt")\n \n     title = _("box_review_list", default="Review List")\ndiff --git a/plone/app/portlets/portlets/rss.pt b/plone/app/portlets/portlets/rss.pt\nindex 66b9ec21..853ac0c4 100644\n--- a/plone/app/portlets/portlets/rss.pt\n+++ b/plone/app/portlets/portlets/rss.pt\n@@ -1,52 +1,78 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n \n   <div class="card portlet portletRss"\n-      i18n:domain="plone"\n-      tal:condition="view/enabled">\n+       tal:condition="view/enabled"\n+       i18n:domain="plone"\n+  >\n \n     <div class="card-header">\n-      <a href=""\n-          tal:attributes="href view/siteurl"\n-          tal:omit-tag="not:view/siteurl"\n-          tal:content="view/title"\n-          class="tile">\n+      <a class="tile"\n+         href=""\n+         tal:content="view/title"\n+         tal:omit-tag="not:view/siteurl"\n+         tal:attributes="\n+           href view/siteurl;\n+         "\n+      >\n         Tags\n       </a>\n     </div>\n \n-    <div class="card-body" >\n+    <div class="card-body">\n       <ul tal:condition="view/feedAvailable">\n-        <tal:rss tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime"\n-            tal:repeat="item view/items">\n-        <li class="portletItem oddrow"\n-            tal:define="oddrow repeat/item/odd"\n-            tal:attributes="class python:oddrow and \'portletItem even\' or \'portletItem odd\'">\n-          <a href="#"\n-              tal:attributes="href item/url"\n-              class="tile">\n-            <span tal:replace="item/title">Title</span>\n-          </a>\n-          <time class="portletItemDetails"\n-              tal:condition="exists:item/updated">\n-            <span tal:omit-tag="" tal:content="python:toLocalizedTime(item[\'updated\'])">19.02.2007</span>\n-          </time>\n-        </li>\n+        <tal:rss tal:define="\n+                   toLocalizedTime nocall:context/@@plone/toLocalizedTime;\n+                 "\n+                 tal:repeat="item view/items"\n+        >\n+          <li class="portletItem oddrow"\n+              tal:define="\n+                oddrow repeat/item/odd;\n+              "\n+              tal:attributes="\n+                class python:oddrow and \'portletItem even\' or \'portletItem odd\';\n+              "\n+          >\n+            <a class="tile"\n+               href="#"\n+               tal:attributes="\n+                 href item/url;\n+               "\n+            >\n+              <span tal:replace="item/title">Title</span>\n+            </a>\n+            <time class="portletItemDetails"\n+                  tal:condition="exists:item/updated"\n+            >\n+              <span tal:content="python:toLocalizedTime(item[\'updated\'])"\n+                    tal:omit-tag=""\n+              >19.02.2007</span>\n+            </time>\n+          </li>\n         </tal:rss>\n       </ul>\n     </div>\n \n-    <div class="card-footer" tal:condition="view/feedAvailable">\n+    <div class="card-footer"\n+         tal:condition="view/feedAvailable"\n+    >\n       <a href=""\n-          tal:condition="view/siteurl"\n-          tal:attributes="href view/siteurl">\n-        <span class="hiddenStructure"><span tal:replace="view/title" /> - </span>\n+         tal:condition="view/siteurl"\n+         tal:attributes="\n+           href view/siteurl;\n+         "\n+      >\n+        <span class="hiddenStructure"><span tal:replace="view/title"></span>\n+          -\n+        </span>\n         <span i18n:translate="box_morelink">More&hellip;</span>\n       </a>\n     </div>\n \n   </div>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/portlets/portlets/rss.py b/plone/app/portlets/portlets/rss.py\nindex c53a37bd..655c4862 100644\n--- a/plone/app/portlets/portlets/rss.py\n+++ b/plone/app/portlets/portlets/rss.py\n@@ -127,7 +127,7 @@ def update(self):\n             # check for regular update\n             if self.needs_update:\n                 return self._retrieveFeed()\n-        except:\n+        except Exception:\n             self._failed = True\n             logger.exception("failed to update RSS feed %s", self.url)\n \n@@ -235,7 +235,6 @@ def siteurl(self):\n \n \n class IRSSPortlet(IPortletDataProvider):\n-\n     portlet_title = schema.TextLine(\n         title=_("Title"),\n         description=_(\n@@ -269,7 +268,6 @@ class IRSSPortlet(IPortletDataProvider):\n \n @implementer(IRSSPortlet)\n class Assignment(base.Assignment):\n-\n     portlet_title = ""\n \n     @property\n@@ -289,7 +287,6 @@ def __init__(self, portlet_title="", count=5, url="", timeout=100):\n \n \n class Renderer(base.DeferredRenderer):\n-\n     render_full = ZopeTwoPageTemplateFile("rss.pt")\n \n     @property\ndiff --git a/plone/app/portlets/portlets/search.pt b/plone/app/portlets/portlets/search.pt\nindex 7d1289f4..38eecebd 100644\n--- a/plone/app/portlets/portlets/search.pt\n+++ b/plone/app/portlets/portlets/search.pt\n@@ -1,40 +1,70 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n+      i18n:domain="plone"\n+>\n \n   <div class="card portlet portletSearch">\n \n     <div class="card-header">\n-      <a class="tile" tal:attributes="href view/search_action">\n-        <tal:header condition="not:view/data/title|nothing" i18n:translate="box_search">Search</tal:header>\n-        <tal:header condition="view/data/title|nothing" tal:content="view/data/title">Search</tal:header>\n+      <a class="tile"\n+         tal:attributes="\n+           href view/search_action;\n+         "\n+      >\n+        <tal:header condition="not:view/data/title|nothing"\n+                    i18n:translate="box_search"\n+        >Search</tal:header>\n+        <tal:header condition="view/data/title|nothing"\n+                    tal:content="view/data/title"\n+        >Search</tal:header>\n       </a>\n     </div>\n \n     <div class="card-body">\n-      <form id="searchform" action="search"\n-          style="min-width: auto;"\n-          tal:define="livesearch view/enable_livesearch;"\n-          tal:attributes="action view/search_action;\n-                          data-action view/action;\n-                          class python: view.enable_livesearch() and \'pat-livesearch\' or None;\n-                          data-pat-livesearch python: view.enable_livesearch() and \'ajaxUrl:\' + view.navigation_root_url + \'/@@ajax-search\' or None;">\n+      <form id="searchform"\n+            action="search"\n+            style="min-width: auto;"\n+            tal:define="\n+              livesearch view/enable_livesearch;\n+            "\n+            tal:attributes="\n+              action view/search_action;\n+              data-action view/action;\n+              class python: view.enable_livesearch() and \'pat-livesearch\' or None;\n+              data-pat-livesearch python: view.enable_livesearch() and \'ajaxUrl:\' + view.navigation_root_url + \'/@@ajax-search\' or None;\n+            "\n+      >\n         <div class="LSBox">\n           <div class="input-group">\n             <input class="form-control"\n-                name="SearchableText"\n-                type="text"\n-                title="Search Site"\n-                placeholder="Search Site"\n-                i18n:attributes="title title_search_title; placeholder title_search_site"\n-                tal:attributes="value request/SearchableText|nothing; class python:livesearch and \'form-control portlet-search-gadget\' or \'form-control portlet-search-gadget-nols\'"/>\n+                   name="SearchableText"\n+                   placeholder="Search Site"\n+                   title="Search Site"\n+                   type="text"\n+                   tal:attributes="\n+                     value request/SearchableText|nothing;\n+                     class python:livesearch and \'form-control portlet-search-gadget\' or \'form-control portlet-search-gadget-nols\';\n+                   "\n+                   i18n:attributes="title title_search_title; placeholder title_search_site"\n+            />\n             <div class="input-group-append">\n-              <button type="submit" class="btn btn-primary" value="Search" i18n:attributes="value label_search" i18n:translate="label_submit">Submit</button>\n+              <button class="btn btn-primary"\n+                      type="submit"\n+                      value="Search"\n+                      i18n:attributes="value label_search"\n+                      i18n:translate="label_submit"\n+              >Submit</button>\n             </div>\n           </div>\n-          <div class="LSResult" style="" tal:condition="livesearch" tal:attributes="data-livesearch view/livesearch_action;">\n+          <div class="LSResult"\n+               style=""\n+               tal:condition="livesearch"\n+               tal:attributes="\n+                 data-livesearch view/livesearch_action;\n+               "\n+          >\n             <div class="LSShadow"></div>\n           </div>\n         </div>\n@@ -42,7 +72,12 @@\n     </div>\n \n     <div class="card-footer">\n-      <a href="#" tal:attributes="href view/search_action" i18n:translate="label_advanced_search">Advanced Search&hellip;</a>\n+      <a href="#"\n+         tal:attributes="\n+           href view/search_action;\n+         "\n+         i18n:translate="label_advanced_search"\n+      >Advanced Search&hellip;</a>\n     </div>\n \n   </div>\ndiff --git a/plone/app/portlets/portlets/search.py b/plone/app/portlets/portlets/search.py\nindex db7b3a68..18a45998 100644\n--- a/plone/app/portlets/portlets/search.py\n+++ b/plone/app/portlets/portlets/search.py\n@@ -34,7 +34,6 @@ def title(self):\n \n \n class Renderer(base.Renderer):\n-\n     render = ViewPageTemplateFile("search.pt")\n     action = "@@search"\n     livesearch_action = "livesearch_reply"\ndiff --git a/plone/app/portlets/testing.py b/plone/app/portlets/testing.py\nindex f37875e6..f72fad39 100644\n--- a/plone/app/portlets/testing.py\n+++ b/plone/app/portlets/testing.py\n@@ -7,7 +7,7 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n-from plone.testing import z2\n+from plone.testing import zope\n from Products.CMFCore.utils import getToolByName\n from zope.configuration import xmlconfig\n \n@@ -15,11 +15,10 @@\n \n \n class PloneAppPortlets(PloneSandboxLayer):\n-\n     defaultBases = (PLONE_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\n-        z2.installProduct(app, "plone.app.portlets")\n+        zope.installProduct(app, "plone.app.portlets")\n \n         # Include testing profile\n         import plone.app.portlets\ndiff --git a/plone/app/portlets/tests/atom_feed_maurits.xml b/plone/app/portlets/tests/atom_feed_maurits.xml\nindex 7655d714..83c90123 100644\n--- a/plone/app/portlets/tests/atom_feed_maurits.xml\n+++ b/plone/app/portlets/tests/atom_feed_maurits.xml\n@@ -1,1520 +1 @@\n-<?xml version="1.0" ?>\n <?xml-stylesheet href="atom.css" type="text/css"?>\n-\n-<feed xmlns="http://www.w3.org/2005/Atom"\n-      xmlns:atom="http://www.w3.org/2005/Atom"\n-      xmlns:dc="http://purl.org/dc/elements/1.1/"\n-      xml:base="https://maurits.vanrees.org" xml:lang="en">\n-  <link rel="self"\n-        href="https://maurits.vanrees.org/weblog/topics/plone/@@atom.xml" />\n-  <div xmlns="http://www.w3.org/1999/xhtml">\n-    <a href="http://www.atomenabled.org/feedvalidator/check.cgi?url=https://maurits.vanrees.org/weblog/atom.xml">\n-      <img title="Validate my Atom feed" width="88"\n-           height="31"\n-           src="http://www.atomenabled.org/feedvalidator/images/valid-atom.png"\n-           alt="[Valid Atom]" border="0px" />\n-    </a>\n-    <p>\n-      <span>\n-        This is an Atom formatted XML site feed. It is intended to be viewed in\n-        a Newsreader or syndicated to another site. Please visit\n-      </span>\n-      <a href="http://www.atomenabled.org/">Atom Enabled</a>\n-      <span>\n-        for more info.\n-      </span>\n-    </p>\n-  </div>\n-\n-  <title type="html">Weblog</title>\n-\n-\n-  <updated>2021-01-05T10:33:42+00:00</updated>\n-\n-  <link href="https://maurits.vanrees.org/weblog"\n-        rel="alternate" type="text/html" />\n-\n-\n-\n-  <id>urn:syndication:3a1d81067fb16b9d671c9ee4a6efa204</id>\n-\n-  <generator uri="http://plone.org/products/fatsyndication/" version="0.1">fatsyndication</generator>\n-\n-\n-\n-    <entry>\n-\n-      <title>Philip Bauer: Growing Pains: PosKeyErrors and Other Malaises</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/philip-bauer-growing-pains-poskeyerrors-and-other-malaises" />\n-\n-\n-\n-      <id>urn:syndication:a2e343ca7c1c64182bc128b9a4f0be0b</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>This talk is about the issues that you face when your project grows, the code base grows, the database grows, the problems grow.\n-This is about the causes and some of the remedies.</p>\n-<div class="section" id="symptom-1-huge-database">\n-<h3><a name="symptom-1-huge-database">Symptom 1: huge database</a></h3>\n-<p>Cause 1: a huge number of revisions or versions.</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Remove all versions and pack the database. When you migrate to a new Plone version, and you ask your client, they will usually be okay with this.</li>\n-<li>Manage or limit revisions. Easiest is to use <a class="reference" href="https://github.com/collective/collective.revisionmanager">collective.revisionmanager</a> for this. Especially, revisions may have been left behind for content that no longer exists. You can easily remove it with this tool.</li>\n-<li>Disable versioning of Files. It is disabled by default, but maybe someone has switched it on.</li>\n-<li>Enable manual versioning instead of automatic. Then the editor needs to check a box when they make a major change that they want to be able to rollback.</li>\n-</ul>\n-<p>Cause 2: no packing.</p>\n-<p>Remedy: just pack it. Use the <tt class="docutils literal"><span class="pre">zeopack</span></tt> script, which part of <tt class="docutils literal"><span class="pre">plone.recipe.zeoserver</span></tt>. Add a cronjob for this, weekly seems best for most sites.</p>\n-<p>Cause 3: unused content.</p>\n-<p>Remedy: delete it. You have to find it first.\n-Of course no code can tell you which content is safe to delete.\n-You could use <tt class="docutils literal"><span class="pre">statistics.py</span></tt> from <a class="reference" href="https://github.com/collective/collective.migrationhelpers">collective.migrationhelpers</a> to get an idea of where which content is.</p>\n-<p>Cause 4: the SearchableText index is huge</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Use solr or elasticsearch and possibly remove the <tt class="docutils literal"><span class="pre">SearchableText</span></tt> index.</li>\n-<li>Don\'t index files. They are converted to text, but this may not be needed for your site.</li>\n-</ul>\n-<p>Cause 5: large blobs\n-For example, plone.de had a Linux <tt class="docutils literal"><span class="pre">iso</span></tt> image, which was huge.</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Limit the upload size. You could do this in nginx/apache. Archetypes had something, you can likely do this in Dexterity too.</li>\n-<li>Get stats and remove or replace too large items.</li>\n-</ul>\n-<p>Cause 6: aborted uploads (rare)</p>\n-<p>Remedy: check <tt class="docutils literal"><span class="pre">IAnnotations(portal).get(\'file_upload_map\')</span></tt>.</p>\n-</div>\n-<div class="section" id="symptom-2-slow-site">\n-<h3><a name="symptom-2-slow-site">Symptom 2: slow site</a></h3>\n-<p>Cause 1: unneeded full renders of content</p>\n-<p>Remedy: use Python in page templates.\n-By default, page templates use path expressions like this: <tt class="docutils literal"><span class="pre">tal:define=&quot;foo</span> <span class="pre">context/foo&quot;</span></tt>.\n-But this tries to render&nbsp; foo as html if possible.\n-Use <tt class="docutils literal"><span class="pre">foo</span> <span class="pre">python:context.foo</span></tt> instead.</p>\n-<p>Cause 2: wake up many objects</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Always try to use brains and metadata. The difference is huge, also with Dexterity.</li>\n-<li>Listing 3000 brains: 0.2 seconds</li>\n-<li>Listing 3000 objects: 2 seconds</li>\n-<li>Same is true for Volto when you use the search-endpoint with <tt class="docutils literal"><span class="pre">fullobjects</span></tt>.</li>\n-</ul>\n-<p>Of course most page templates in Plone will not list thousands of objects, but will be paginated.\n-Still: just use brains, they are so much tastier.</p>\n-<p>Cause 3: no caching</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Switch on the built-in caching</li>\n-<li>Add varnish</li>\n-<li>Manage the zeocache (that is a bit of science, ask the community)</li>\n-<li>Use <tt class="docutils literal"><span class="pre">memoize</span></tt> in your code.</li>\n-</ul>\n-<p>Cause 4: hardware</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Don\'t be cheap.</li>\n-<li>Buy enough ram to keep the database in memory.</li>\n-<li>Remember that your consulting time probably costs more than buying better hardware would.</li>\n-</ul>\n-<p>Cause 5: slow code</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Learn and use profiling. A very handy toy for that is <a class="reference" href="https://pypi.org/project/py-spy/">py-spy</a>. Sample use: <tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">py-spy</span> <span class="pre">top</span> <span class="pre">--pid</span> <span class="pre">12345</span></tt></li>\n-<li>Do not call methods multiple times from templates. Call them once, store the result, and use this.</li>\n-</ul>\n-<p>Cause 6: slow data sources</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>decouple, for example using redis or celery</li>\n-<li>Use your choice of async implementations</li>\n-<li>Use lazyloading of images if they come from outside of your Plone site.</li>\n-</ul>\n-</div>\n-<div class="section" id="symptom-3-conflict-errors">\n-<h3><a name="symptom-3-conflict-errors">Symptom 3: conflict errors</a></h3>\n-<p>Conflict errors happen when two requests work at the same time and both change the same object.\n-This is complicated, but Zope and the ZODB have built-in conflict resolution.</p>\n-<p>Cause 1: conflict resolving is not enabled.\n-The zeoserver needs access to the same code that your zeoclient has, otherwise conflicts cannot be resolved and the transaction will be aborted.</p>\n-<p>Remedy: add all application code to the zeoserver:</p>\n-<pre class="literal-block">\n-[zeoserver]\n-eggs = ${buildout:eggs}\n-</pre>\n-<p>Cause 2: long running requests change data</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Prevent writes.</li>\n-<li>If it takes long, do intermediate commits when possible.</li>\n-<li>Prevent crossfire: disable cronjobs and editors when a long request needs to run.</li>\n-<li>Use async. Talk to Asko about that probably.</li>\n-</ul>\n-</div>\n-<div class="section" id="symptom-4-poskeyerrors">\n-<h3><a name="symptom-4-poskeyerrors">Symptom 4: PosKeyErrors</a></h3>\n-<p>Cause 1: missing blobs</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Copy all blobs of course.</li>\n-<li>Use <a class="reference" href="https://pypi.org/project/experimental.gracefulblobmissing/">experimental.gracefulblobmissing</a> in development to create dummy blobs where needed.</li>\n-<li>Find and delete afflicted content in a browser view.</li>\n-<li>There can be cases when you have two zeoclients and the syncing does not work well. Talk to Alessandro about that.</li>\n-</ul>\n-</div>\n-<div class="section" id="symptom-5-broken-data">\n-<h3><a name="symptom-5-broken-data">Symptom 5: broken data</a></h3>\n-<p>Now for the really interesting part.\n-These are errors like:</p>\n-<pre class="literal-block">\n-ModuleNotFoundError\n-AttributeError\n-ImportError\n-PostKeyError\n-BrokenObject\n-</pre>\n-<p>I could read you my whole blog post about <a class="reference" href="https://www.starzel.de/blog/zodb-debugging">zodb debugging</a>.</p>\n-<p>Cause 1: code to unpickle som data is missing</p>\n-<p>Remedies:</p>\n-<ul class="simple">\n-<li>Ignore the errors, if normal operation still works, and the site only has to stay up for a limited time, because <tt class="docutils literal"><span class="pre">zeopack</span></tt> probably also fails.</li>\n-<li>Fix it with a <a class="reference" href="https://github.com/zopefoundation/zodbupdate#id4">rename_dict</a>. See <a class="reference" href="https://github.com/zestsoftware/zest.zodbupdate">zest.zodbupdate</a> for some examples that are actually really useful. [Thanks! MvR]</li>\n-<li>Work around it with an <tt class="docutils literal"><span class="pre">alias_module</span></tt> patch, like <tt class="docutils literal"><span class="pre">plone.app.upgrade</span></tt> does in several cases. Then imports can work again.</li>\n-<li>Find out what and where broken objects are and then fix or remove them safely. Use <a class="reference" href="https://pypi.org/project/zodbverify/">zodbverify</a>.</li>\n-</ul>\n-<p>Steps for the last one:</p>\n-<ul class="simple">\n-<li>Call <tt class="docutils literal"><span class="pre">bin/zodbverify</span> <span class="pre">-f</span> <span class="pre">var/filestorage/Data.fs</span></tt> to get all broken objects.</li>\n-<li>Pick one error type at a time, with an oid (object id) that has a problem.</li>\n-<li>Call <tt class="docutils literal"><span class="pre">bin/zodbverify</span> <span class="pre">-f</span> <span class="pre">var/filestorage/Data.fs</span> <span class="pre">-o</span> <span class="pre">&lt;oid&gt;</span> <span class="pre">-D</span></tt> to inspect one object and find out where it is referenced.</li>\n-<li>For the extra options, you should use the branch from my <a class="reference" href="https://github.com/plone/zodbverify/pull/8">pull request</a>, which I still have not finished yet, but it runs fine.</li>\n-<li>Remove or fix the object.</li>\n-<li>Important: make notes, write upgrade steps, keep the terminal log, because you will forget it and need it again.</li>\n-</ul>\n-<p>To remove or fix the object, it helps to start the actual Plone site with some special zodbverify sauce:</p>\n-<pre class="literal-block">\n-./bin/instance zodbverify -f var/filestorage/Data.fs -o &lt;oid&gt; -D\n-</pre>\n-<p>Then you can use your debugging skills to try and fix things.\n-Note that after you fixed it, you need to commit the changes explicitly:</p>\n-<pre class="literal-block">\n-import transaction\n-transaction.commit()\n-</pre>\n-<p>Note that the bad object is still in the database, until you pack it.</p>\n-<p>Frequent culprits are IntIds and Relations, especially if you migrated from Archetypes to Dexterity.\n-Using <a class="reference" href="https://github.com/collective/collective.relationhelpers/blob/master/src/collective/relationhelpers/api.py">collective.relationhelpers</a> you can clean this up:</p>\n-<pre class="literal-block">\n-from collective.relationhelpers.api import cleanup_intids\n-from collective.relationhelpers.api import purge_relations\n-from collective.relationhelpers.api import restore_relations\n-from collective.relationhelpers.api import store_relations\n-# store all relations in a annotation on the portal\n-store_relations()\n-# empty the relation-catalog\n-purge_relations()\n-# remove all relationvalues and refs to broken objects from intid\n-cleanup_intids()\n-# recreate all relations from a annotation on the portal\n-restore_relations()\n-</pre>\n-</div>\n-<div class="section" id="symptom-6-bad-code">\n-<h3><a name="symptom-6-bad-code">Symptom 6: bad code</a></h3>\n-<p>Unreadable, untested, unused, undocumented, unmaintained, complicated, overly complex, too much code.\n-If you can convince a client to <em>not</em> want a feature because they will only use it once, that is a win.\n-Every line of code that is <em>not</em> written, is a good line of code.</p>\n-</div>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-11T17:08:38+00:00</published>\n-\n-      <updated>2021-01-05T10:33:42+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Maik Derstappen: Plone 6 Theming with Diazo</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/maik-derstappen-plone-6-theming-with-diazo" />\n-\n-\n-\n-      <id>urn:syndication:3ba6d872864981f8695780e8de6d246f</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>How does Plone theming look in classic UI?</p>\n-<ul class="simple">\n-<li>html5 theme plus a mapping configuration</li>\n-<li>deploying themes as ZIP-file for shared hosting is possible</li>\n-<li>With Diazo you can map any Plone html to a static theme layout.</li>\n-</ul>\n-<p>Separating frontend and backend theme.\n-Don\'t reinvent the backend views!\n-You could theme the backend, so for content editors and admins, but it looks fine, not needed.\n-You should focus on the frontend layout for visitors.\n-To use the default backend layout you can include <tt class="docutils literal"><span class="pre">backend.xml</span></tt> in your rules, with some conditions.</p>\n-<p>Diazo is not for everything!\n-If the backend markup differs from what you need, do not try to solve it with Diazo or XSLT.\n-Instead, fix the backend templates directly, most likely with a <tt class="docutils literal"><span class="pre">z3c.jbot</span></tt> override.</p>\n-<p>You can use <a class="reference" href="https://github.com/collective/collective.themefragments/">theme fragments</a> or browser views to add new templates.\n-The theme fragments can also be used as tiles in Mosaic.</p>\n-<p>I like using SASS mixins.\n-Say you have a <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;main-wrapper</span> <span class="pre">container&quot;&gt;</span></tt>.\n-Cleaner would be <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;main-wrapper&quot;&gt;</span></tt>.\n-You can do this with mixins with <tt class="docutils literal"><span class="pre">&#64;include</span></tt> in your selector.</p>\n-<p>For more information on Diazo, see <a class="reference" href="https://diazo.org">https://diazo.org</a>.</p>\n-<div class="section" id="new-features-in-plone-6">\n-<h3><a name="new-features-in-plone-6">New features in Plone 6</a></h3>\n-<p>From the backend we get Bootstrap 5 compatible html.\n-Result is that Bootstrap themes are easier to integrate in Plone 6.</p>\n-<p>You have custom CSS in the theming control panel, for small changes.\n-This actually sneaked into Plone 5.2.2 as well.</p>\n-<p>We have simplified Diazo rules.</p>\n-<p>Create a theme with plonecli:</p>\n-<ul class="simple">\n-<li>pip install plonecli</li>\n-<li>plonecli create addon plonetheme.yourtheme</li>\n-<li>cd plonetheme.yourtheme</li>\n-<li>plonecli add theme</li>\n-<li>plonecli build</li>\n-</ul>\n-<p>Theme from this presentation will be published as <a class="reference" href="https://github.com/collective/collective.bunapisicuto">collective.bunapisicuto</a> when it is ready for you to inspect.</p>\n-</div>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-10T22:16:11+00:00</published>\n-\n-      <updated>2020-12-10T22:16:11+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Stefan Antonelli: Plone 6 Theming from Scratch</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/stefan-antonelli-plone-6-theming-from-scratch" />\n-\n-\n-\n-      <id>urn:syndication:d1f0f9b0e055800492dbadd973f3290e</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>How to create a theme for Plone 6.\n-Quite easy, because the templates use Bootstrap 5 classes.\n-We build a theme from scratch, no Barceloneta, no Diazo.</p>\n-<p>First step is to create an empty plone_addon package with <tt class="docutils literal"><span class="pre">plonecli</span></tt> or <tt class="docutils literal"><span class="pre">mr.bob</span></tt>.\n-For the questions you can answer: use Plone 5.2.1. We will switch later.\n-My theme is <a class="reference" href="https://github.com/collective/plonetheme.munich">plonetheme.munich</a>.</p>\n-<p>I recommend to cleanup the standard package a bit.\n-I remove tests, constraints for Plone 4 and 5.\n-Check it out in the commits.</p>\n-<p>Now switch to <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/buildout.cfg">extend Plone 6</a> and run the buildout.</p>\n-<p>You can add theme structure with a bob template, but I prefer creating my own.</p>\n-<p>Some interesting files:</p>\n-<ul class="simple">\n-<li><a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/package.json">package.json</a> lists various tasks, especially the <tt class="docutils literal"><span class="pre">watch</span></tt> task.</li>\n-<li>In the theme <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/src/plonetheme/munich/theme/manifest.cfg">manifest.cfg</a> we more or less disable Diazo by emptying the <tt class="docutils literal"><span class="pre">rules</span></tt> line.</li>\n-<li>The compiled CSS and JavaScript are registered in <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/src/plonetheme/munich/profiles/default/registry/main.xml">registry.xml</a>.</li>\n-</ul>\n-<p>You can compile SASS to CSS using npm or yarn.\n-Do <tt class="docutils literal"><span class="pre">yarn</span> <span class="pre">install</span></tt> in the top of your package.\n-Later, with <tt class="docutils literal"><span class="pre">yarn</span> <span class="pre">dist</span></tt> you make it ready for production.</p>\n-<p>After these steps Plone is partially broken, or at least ugly.\n-I do some <a class="reference" href="https://github.com/collective/plonetheme.munich/commit/000717fb336849facec17b8fbd7b75686ec6146b">basic fixes</a> and it looks better.</p>\n-<p>For templates that you need to change you add <tt class="docutils literal"><span class="pre">z3c.jbot</span></tt> overrides.\n-Personally I always kick out the &quot;search in section&quot; checkbox.</p>\n-<p>I don\'t like columns, but for this example I kept them.\n-In most cases I need just one column.\n-Plus maybe a side bar for portlets, but portlets must die.</p>\n-<p>With <tt class="docutils literal"><span class="pre">plonetheme.tokyo</span></tt> everything is Bootstrap, no columns, so no portlets, really fully responsive.\n-This was the package where we built on Barceloneta Plone 5.2 and introduced lots of template overrides to put in Bootstrap.\n-For Plone 6 we can just remove the overrides.</p>\n-<p>What about the toolbar? Yes, we dropped it.\n-We bring editing features and navigation together.\n-This is now a few feature: <a class="reference" href="https://github.com/collective/collective.sidebar">collective.sidebar</a>.\n-It is only one template to override.\n-It works for Plone 5.2 at the moment, and I may work on it for Plone 6 during the sprints.</p>\n-<p>Question: is TTW still a viable path?</p>\n-<p>Answer: I like to concentrate on one path.\n-I am not an expert in TTW theming.\n-I switched to file system, except really small customizations.\n-For small CSS customizations there is a field in the theming control panel.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-10T17:08:30+00:00</published>\n-\n-      <updated>2020-12-10T17:08:30+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Stefan Antonelli and Peter Holzer: Modernize Plone\xe2\x80\x99s Classic UI</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/stefan-antonelli-and-peter-holzer-modernize-plone2019s-classic-ui" />\n-\n-\n-\n-      <id>urn:syndication:468faba6197c93edadf910d668dac1c1</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>What was new in Plone 5?\n-We had beautiful new theme: Barceloneta.\n-Diazo theming by default.\n-We switched to CSS compilation with <tt class="docutils literal"><span class="pre">less</span></tt>.</p>\n-<p>During the Tokyo conference Stefan thought up Tokyo Theme.\n-Clean responsive theme for Plone 5.\n-Tons of overrides to tackle problems in Plone 5.\n-Issue with navigation and editing on mobile we solved with collective.sidebar.</p>\n-<p>We had community discussions, especially during several Plone events.\n-Everyone tried to use Bootstrap (components).\n-First idea: map variables from Barceloneta to Bootstrap, because they have similar ideas using different terms.</p>\n-<p>We have PLIP to modernize markup in templates, and another PLIP to modernize the default theme: Barceloneta LTS.\n-Forms using z3c.form are already using the new classes.</p>\n-<p>Make things easier: UI, development.\n-Creating a modern UI for the web is complex.\n-You need to support different devices, responsiveness.\n-In Bootstrap there are patterns for most useful things.</p>\n-<p>Developer perspective: expect one way to do things.\n-Developers should not have to worry about design.\n-When busy in the backend, you should focus on Python, not on it looking nice and shiny.\n-Don\'t think about markup, just use components.\n-The good news: there is documentation. The Bootstrap documentation is our documentation.</p>\n-<p>What is new in Plone 6?</p>\n-<ul class="simple">\n-<li>Volto is the default UI.</li>\n-<li>There still is the Classic UI with Barceloneta look and feel, but updated.</li>\n-<li>No TTW (through the web) theming.</li>\n-<li>But there is a textarea to add some simple CSS (already in 5.2.3).</li>\n-<li>Some CSS variables may be changeable TTW.</li>\n-<li>Finally jQuery 3</li>\n-</ul>\n-<p>Bootstrap is still the most popular front-end framework.\n-Well documented, tested and maintained.\n-It is so easy to create stuff, I enjoy it a lot.</p>\n-<p>What is new in Bootstrap 5?</p>\n-<ul class="simple">\n-<li>Improved overall look and feel.</li>\n-<li>Updated and extended the color system</li>\n-<li>Custom properties: css variables</li>\n-<li>SVG Icon library</li>\n-<li>Pure javascript</li>\n-<li>Dropped IE10 and IE11 support</li>\n-<li>Bootstrap 5 is currently alpha 3.</li>\n-<li>See <a class="reference" href="https://v5.getbootstrap.com">https://v5.getbootstrap.com</a></li>\n-</ul>\n-<p>Features: what do we get from these changes?</p>\n-<ul class="simple">\n-<li>Core templates use Bootstrap 5 markup. Instead of overrides in <tt class="docutils literal"><span class="pre">plonetheme.tokyo</span></tt>, we have lots of branches for the actual packages.</li>\n-<li>All major templates have been touched already.</li>\n-<li>For the current state, see the unofficial demo at <a class="reference" href="https://classic.plone.de">https://classic.plone.de</a></li>\n-<li>The <a class="reference" href="https://getbootstrap.com/docs/5.0/getting-started/introduction/">Bootstrap documentation</a> has lots of snippets than you can copy.</li>\n-<li>You don\'t need much more CSS on top of it if you paste most examples. We added a little for own components, like navigation.</li>\n-</ul>\n-<p>Barceloneta appearance is fully customizable.\n-It is basically on opinionated set of bootstrap variables.\n-Every aspect can be changed with variables: colors, fonts, sizes, spacings, grid gutters, etc.\n-There are overall properties, like shadowed, rounded, gradients. Just turn on or off.</p>\n-<p>Theming workflow.\n-<tt class="docutils literal"><span class="pre">plonetheme.barceloneta</span></tt> will also be published as <tt class="docutils literal"><span class="pre">npm</span></tt> package.\n-<tt class="docutils literal"><span class="pre">bobtemplates.plone</span></tt> will have a template for the new theming workflow.\n-You can do quick and dirty customizations through the CSS overrides field in the theme controlpanel.</p>\n-<p>Diazo will still be there, will work as before.\n-Some optimizations in the <tt class="docutils literal"><span class="pre">rules.xml</span></tt> to make content are customizations easier.</p>\n-<p>How to deal with icons?\n-What if you want to change the content type icons? Used to be hard.\n-Now we come up with the idea of an icon resolver.\n-We decided to use the <a class="reference" href="https://icons.getbootstrap.com">bootstrap icons</a>.\n-Icons are registered via GenericSetup, for example with a record name <tt class="docutils literal"><span class="pre">plone.icon.alarm</span></tt> pointing to an SVG.\n-You can then override this in your own GS profile.</p>\n-<p>Example icon use:</p>\n-<pre class="literal-block">\n-&lt;tal:icon replace=&quot;structure python:icons.tag(\'love\', tag_class=\'custom-class\', tag_alt=\'foobar\')&quot; /&gt;\n-</pre>\n-<p>You get get back an inline SVG or an image tag.</p>\n-<p>Note: all z3c form widgets in Plone are now in <tt class="docutils literal"><span class="pre">plone.app.z3cform</span></tt>, and not scattered over lots of packages.</p>\n-<p>We will restart our weekly Plone 6 Classic UI sprints, starting Januari 13 2021, 10:00 (UTC+1).</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-10T16:02:29+00:00</published>\n-\n-      <updated>2020-12-10T16:02:29+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Keynote: The User Experience - Editing Composite Pages in Plone 6 and Beyond</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/keynote-the-user-experience-editing-composite-pages-in-plone-6-and-beyond" />\n-\n-\n-\n-      <id>urn:syndication:e244a1928902dfa6b7ea77347437d2d9</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>It may be a surprise to non-technical people to learn that pages created in Volto are not currently interoperable with traditional Plone\'s page editing. If you think about it, the reason becomes obvious. Volto, like Mosaic, creates tiled layouts, and like Mosaic it stores page data in special fields for the individual blocks and their layout. Neither Volto nor Mosaic pages are editable in TinyMCE, which expects just one rich text field.</p>\n-<p>Is this divergence between sites created in Volto and sites created in traditional Plone a problem? It does make it harder to describe what Plone is, and it might mean that there is no way to mix both approaches - for instance when part of a larger site is available as a Volto-based sub-site. Would it be possible to have one tool and one representation for tiled layouts so that we can avoid this divergence? Is there some other solution? Is it even a problem? Will Plone 6 be backwards compatible with Plone 5 and include a smooth upgrade path?</p>\n-<p>We will tackle these questions in this strategic panel discussion, moderated by Sally Kleinfeldt. Panelists will include Paul Roeland, Philip Bauer, Timo Stollenwerk, Victor Fernandez de Alba, and Eric Steele.</p>\n-<p>First, Philip has a message from Max Jacob who is very ill with pancreatic cancer and may not survive this weekend. He wants to thank the Plone community for what they allowed him to do: like organize the German Plone Konferenz. Thanks for all the friendships. Such a pity that this is happening now, he wanted to jump into only doing Plone for the next few years, due to changes at his job, and looked forward to that.</p>\n-<div class="section" id="classic-mosaic-and-volto-pages">\n-<h3><a name="classic-mosaic-and-volto-pages">Classic, Mosaic and Volto Pages</a></h3>\n-<p>We have Classic, Mosaic and Volto Pages. They have different internal representations and are not compatible.\n-Is this a problem? Is there a solution?\n-Is one tool, one representation possible?\n-If we really need three, how to position?</p>\n-<p>Paul: for me as user this presents a problem. When do you switch over your site?\n-We would like to not write 700 pages from scratch, again, like we did for previous composite pages.</p>\n-<p>Timo: We migrated quite a few large projects from classic Plone to Volto.\n-One of those had collective.cover (other composite page system).\n-Problem in general with such systems, is that they are pretty specific.\n-They solve specific use cases and come from different eras.\n-After any migration, it will not look the same any more.\n-Whatever you do: the page will initially look ugly.\n-So you put a lot of effort into migration, but then have to put manual effort into every page anyway.\n-It <em>can</em> help: you at least have a start.\n-We created a system where we migrated overview pages, and editors could click to migrate other pages one at a time.</p>\n-<p>Philip: We have code to migrate from non-folderish to folderish content types.\n-There will be code to migrate to dexterity site root on Plone 6.\n-We <em>can</em> make sure to migrate any standard content types.\n-Mosaic is another story.\n-So for pages you would at least have the text available. Maybe only visible for editors to pick and choose from.\n-You may lose portlets, unless they get implemented in Volto.</p>\n-<p>Timo: When you go to Plone 6 and do a redesign at the same time, then you can jump on Volto.\n-Otherwise you could stay at Classic Plone for now.\n-There will be an overlap period.</p>\n-<p>Victor: For Mosaic you could dump all tiles into html and insert it in a block.</p>\n-</div>\n-<div class="section" id="how-to-have-a-big-classic-site-with-a-subsite-made-in-volto">\n-<h3><a name="how-to-have-a-big-classic-site-with-a-subsite-made-in-volto">How to have a big Classic site with a subsite made in Volto?</a></h3>\n-<p>Victor: Definitely doable, though we have not done this ourselves.</p>\n-<p>Sally: But what happens when an editor in Classic goes to the Volto subsite? The Volto page would not be editable then, right?</p>\n-<p>Philip: You should not offer this. I see no upside, no use case.\n-Split them into separate applications, with shared authentication maybe.</p>\n-<p>Paul: Use case: large site with several departments.\n-The marketing department may want snazzy new Volto things.</p>\n-<p>Timo: Just create another site then.</p>\n-</div>\n-<div class="section" id="cost-and-benefit-of-upgrading-big-classic-site-to-plone-6">\n-<h3><a name="cost-and-benefit-of-upgrading-big-classic-site-to-plone-6">Cost and benefit of upgrading big Classic Site to Plone 6</a></h3>\n-<p>So you just had a big migration to Plone5, and now what would you get for going to Plone 6.</p>\n-<p>Philip: We have this discussion every major upgrade.\n-Communicate every upgrade as a relaunch.\n-The relaunch is the reason for the upgrade.\n-&quot;There is a new version so you need to upgrade&quot; does not fly for my clients.</p>\n-<p>Timo: We became a very developer oriented community, and every develop understands the need and benefits.\n-We should really get back to giving more value at major releases, so clients really want to upgrade themselves.\n-Plone releases should sell themselves.</p>\n-<p>Eric: It looks like we think Plone 6 + Volto is a costly upgrade with lots of benefits.\n-For Classic 5 to Classic 6 the upgrade is not costly.</p>\n-</div>\n-<div class="section" id="alex-limi-s-vision-for-deco-are-we-there-yet">\n-<h3><a name="alex-limi-s-vision-for-deco-are-we-there-yet">Alex Limi\'s vision for Deco: are we there yet?</a></h3>\n-<p>Was this fulfilled by Mosaic? Volto? Something still needed?</p>\n-<p>Paul: Not quite, but slowly getting there.\n-For me it would be Volto, plus some power features that Eau de Web (EEA) adds.</p>\n-<p>Timo: I think we went beyond what Limi envisioned.</p>\n-<p>Eric and Victor: What we have seen from Volto, is pretty close to what Alex wanted.</p>\n-<p>Victor: We gave the users powerful tools, so beware of them.</p>\n-<p>Philip: Partly yes. Volto is close, and it is for normal users.</p>\n-<p>Now some questions from users.</p>\n-</div>\n-<div class="section" id="is-there-a-plan-for-volto-to-support-editing-the-existing-richtext-fields-of-documents-news-items">\n-<h3><a name="is-there-a-plan-for-volto-to-support-editing-the-existing-richtext-fields-of-documents-news-items">Is there a plan for Volto to support editing the existing Richtext fields of Documents, News Items?</a></h3>\n-<p>Philip: This should be doable.</p>\n-</div>\n-<div class="section" id="migrations">\n-<h3><a name="migrations">Migrations</a></h3>\n-<p>Philip: Plone 4 to 5.2 was three migrations in one.\n-Plone 6 is less of a problem.</p>\n-<p>Eric: 5.2 had a lot of backend migrations.\n-A split between backend and frontend with plone.restapi in between makes things easier.</p>\n-<p>[The question on multiple variations of Volto, especially editors, went a bit too fast for me to write intelligible notes down.]</p>\n-</div>\n-<div class="section" id="what-s-the-future-of-using-ct-s-behaviors-in-plone-to-design-information-architecture">\n-<h3><a name="what-s-the-future-of-using-ct-s-behaviors-in-plone-to-design-information-architecture">What\'s the future of using CT\'s/behaviors in Plone to design information architecture?</a></h3>\n-<blockquote>\n-With Volto the trend seems mixing/adding 40 different blocks for every page.</blockquote>\n-<p>Timo: Blocks are definitely the way to work.\n-But the underlying power of content types and behaviors still exists.</p>\n-<p>Philip: We need blocks that represent a field or a behavior. That is unavoidable.</p>\n-</div>\n-<div class="section" id="next-steps">\n-<h3><a name="next-steps">Next steps</a></h3>\n-<p>Timo: We plan to have an open space on page compositions and Volto, and want to sprint on it.</p>\n-<p>Paul: Good if there is a longer term vision.\n-I would rather have more power that a Site Admin can lock down, than having to choose between three different versions.\n-I don\'t want choice stress.</p>\n-</div>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-10T14:55:55+00:00</published>\n-\n-      <updated>2020-12-10T14:55:55+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Lightning Talks Wednesday</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/lightning-talks-wednesday" />\n-\n-\n-\n-      <id>urn:syndication:c478decef0cbf87b0b04ae96599134b3</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <div class="section" id="lukas-guziel-continuous-deployment">\n-<h3><a name="lukas-guziel-continuous-deployment">Lukas Guziel: Continuous Deployment</a></h3>\n-<p>CD means deploying code automatically.\n-It saves time, reduces human error.\n-It Gitlab you can add <tt class="docutils literal"><span class="pre">gitlib-ci.yml</span></tt> and configure it.\n-Include a base template that you use in multiple projects.\n-End result can be a site that the customer can test.</p>\n-</div>\n-<div class="section" id="erico-andrei-world-plone-day-2021">\n-<h3><a name="erico-andrei-world-plone-day-2021">Erico Andrei: World Plone Day 2021</a></h3>\n-<p>We are a global community.\n-Almost 300 people from 36 countries are at this online conference.\n-World Plone Day is an annual Plone event.\n-Next year of course online. April 28th 2021.</p>\n-<p>We want to stream 24 hours live on our YouTube channel.\n-Showcase Plone. Technical talk, use cases, interviews, demo.</p>\n-<p>It should not all be in English, please use your own language.\n-Talk to your local community.</p>\n-<p>Please help and join. See <a class="reference" href="https://plone.org/events/wpd">https://plone.org/events/wpd</a></p>\n-</div>\n-<div class="section" id="andreas-jung-collective-contentsync2">\n-<h3><a name="andreas-jung-collective-contentsync2">Andreas Jung: collective.contentsync2</a></h3>\n-<p>Syncing content between Plone sites through <tt class="docutils literal"><span class="pre">plone.restapi</span></tt>.\n-It is a behavior.\n-You have a source Plone site and one or more target Plone sites.\n-You need Plone 5.2 under Python 3.</p>\n-<ul class="simple">\n-<li>Create a dedicated user account with global role Editor.</li>\n-<li>Configure on the content sync control panel.</li>\n-<li>Automatically creates two content rules to sync content when added or modified.</li>\n-<li>You can enable it on all content types, also Folders.</li>\n-</ul>\n-<p>See <a class="reference" href="https://github.com/collective/collective.contentsync2">https://github.com/collective/collective.contentsync2</a></p>\n-</div>\n-<div class="section" id="philip-bauer-why-relations-are-weird">\n-<h3><a name="philip-bauer-why-relations-are-weird">Philip Bauer: Why relations are weird</a></h3>\n-<p>These packages have a part in relations:</p>\n-<ul class="simple">\n-<li>zc.relation: abstract relation catalog</li>\n-<li>z3c.relationfield: fields and values on objects</li>\n-<li>plone.app.relationfield: converters from field to widget and vv</li>\n-<li>plone.app.z3cform: widgets</li>\n-<li>mockup: actual widget UI</li>\n-</ul>\n-<p>In a schema use a RelationChoice field with vocabulary plone.app.vocabularies.Catalog, and set pattern directives.</p>\n-<p>It is not straightforward.\n-So I wrote <tt class="docutils literal"><span class="pre">collective.relationhelpers</span></tt>.</p>\n-<p>See <a class="reference" href="https://github.com/collective/collective.relationhelpers">https://github.com/collective/collective.relationhelpers</a></p>\n-<p>Maybe use uuid instead of all this code.</p>\n-<p>[About ten people in the chat want to merge this package into plone.api. Actually, see <a class="reference" href="https://github.com/plone/plone.api/issues/223">this issue</a>.]</p>\n-</div>\n-<div class="section" id="christopher-lozinski-simple-json-schema-guis">\n-<h3><a name="christopher-lozinski-simple-json-schema-guis">Christopher Lozinski: Simple JSON Schema GUIs</a></h3>\n-<p>Create a JSON schema, automatically generate the UI.\n-Search for basic JSON editor library.\n-He shows JSON in ZODB, so you can browse it, if I understood correctly.\xf0\x9f\x99\x82</p>\n-</div>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-09T18:21:14+00:00</published>\n-\n-      <updated>2020-12-09T18:21:14+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Eric Brehault: Second Guessing the Single-Page-App Pattern</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/eric-brehault-second-guessing-the-single-page-app-pattern" />\n-\n-\n-\n-      <id>urn:syndication:8b678f3acfa36bff175e085791de850d</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>SPA (Single Page App) is about providing an entire app by exposing a single physical web page containing an enormous javascript bundle. It breaks the original web paradigm in many ways. Surprisingly enough, we invest a lot of efforts to mimic the regular web behaviour.</p>\n-<p>Isn\xe2\x80\x99t it time for modern frontend to reconsider the SPA approach?</p>\n-<p>[Note: Eric presented by using a projector to show his slides on a black Plone conference T-shirt. :-)]</p>\n-<p>Why are we doing this? Originally we always requested a whole page and this was considered slow. But we have good bandwidth now. And if you don\'t have good bandwidth, the super big bundle is not good either.</p>\n-<p>With SPA we try very hard to bring back the original working of the page, especially the browser history, being able to browse and then share the link to the current page.</p>\n-<p>To mitigate problems, we created an enormous stack. And we deny the complexity.  New tools create new problems, even when their individual creators does not see the complexity.</p>\n-<p>&quot;SPA isn\'t stable or efficient.&quot;\n-But there is no way back. For example, you cannot create Google Docs  with server side rendered pages.\n-Web 2.0 is 15 years old. It is still about content.</p>\n-<p>SPA is separation of concern, which is a good principle. But we mix the browser layer (how you get and view the page) and the content layer (the page content).</p>\n-<p>It seems a take it or leave it situation: either use SPA or don\'t. What do we want? We want proportionate complexity. Do we need 100 percent SPA?</p>\n-<p>You can use micro components, see for example the demo of Maik Derstappen in the lightning talks on Monday, using Svelte.\n-Micro frontend is bigger than that.  It is a part of the application, that you develop separately. For example, you could do the Plone Sharing page like this.</p>\n-<p>Can we compile each page separately? Then each page is an app.</p>\n-<p>ES6 native support would be interesting. Combine with HTTP/2 and you need no bundles.\n-Bundling is the most brutal thing ever. Horrible. Get rid of it.</p>\n-<p>Respect the layers. SPAs are monolithic. Break them down.</p>\n-<p>We should have a generic browser layer, common to many different use cases, for example for logging in.\n-I don\'t want to code that, but plug it. Second step: push this layer to the browsers themselves.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-09T17:41:59+00:00</published>\n-\n-      <updated>2020-12-09T17:42:16+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Asko Soukka: Deploying Plone and Volto, the Hard Way</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/asko-soukka-deploying-plone-and-volto-the-hard-way" />\n-\n-\n-\n-      <id>urn:syndication:7d213d4114be2f1ef8ed20a2e1983ed3</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>Here are the <a class="reference" href="https://datakurre.github.io/ploneconf2020/deploying-plone-and-volto-hard-way.pdf">slides</a>.</p>\n-<p>How about building Plone without buildout? Running Plone on Python 3 without WSGI? Deploying Plone and Volto with containers without Docker? Building all this in re-usable and safe manner in sandbox with restricted network access with Nix? Welcome to hear about our hipster setup where we lock, build and configure Plone deployments with Nix, insist to keep ZServer running on Python 3 for the love\'s sake, build software deployments into standalone tarball archives, and run them with Nomad \xe2\x80\x93 the simple on-premises-friendly alternative for K8S.</p>\n-<ul class="simple">\n-<li>The easy, documented way: buildout, WSGI, Docker (if you need containers), Registry.</li>\n-<li>Our way: pip, TxZServer, Nomad, Nix</li>\n-</ul>\n-<p>When you use a container infrastructure, you have multiple containers for running a Plone site, for example zeo clients, zeo servers, load balancer. Nomad helps there, and is much simpler than Kubernetes.\n-We have one job file to rule them all: task groups, instance count, update policy, server resources, volumen mounts, tasks, consul services, vault secrets, environment variables, exec artifacts.</p>\n-<p>Nomad has &quot;isolated fork / exec driver&quot;. No docker image needed. We have a Nix-built artifact, a tarball that we extract in the root of the container.</p>\n-<p>With Nix, you get 100 percent reproducible artifacts. Production equals development. You have a full dependency graph. The result is a standalone tarball, perhaps 100 MB. Disadvantage is that there are no conventions, no metadata, no shared layers, no documentation. It needs learning and practice. Well, some documentation now: <a class="reference" href="https://nixos.org">https://nixos.org</a> and <a class="reference" href="https://nix.dev">https://nix.dev</a>, partially made by people that were using Plone previously.</p>\n-<p>Some ugly parts from Nix:</p>\n-<ul class="simple">\n-<li>Every language has their own Nix-conventions</li>\n-<li>dependency generator ecosystem is comples</li>\n-<li>cyclic dependencies are not supported</li>\n-<li>no storage device is big enough for <tt class="docutils literal"><span class="pre">/nix/store</span></tt></li>\n-</ul>\n-<p>Our (legacy) approach for Plone 5.2.1 without Buildout and with pip:</p>\n-<ul class="simple">\n-<li>generated requirements.txt with buildout</li>\n-<li>create Python env with pip and nix</li>\n-<li>use pip-branch of z3c.autoinclude</li>\n-<li>disabled <tt class="docutils literal"><span class="pre">&lt;includeDependencies</span> <span class="pre">/&gt;</span></tt></li>\n-<li>generate instance skeleton with nix</li>\n-<li>forked plone.recipe.zope2instance</li>\n-</ul>\n-<p>Plone 6 without Buildout should be pip-installable out of the box, but that is hear-say.</p>\n-<p>We use TxZServer in production, so ZServer using Twisted.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-09T16:22:15+00:00</published>\n-\n-      <updated>2020-12-09T16:22:15+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Nicola Zambello: Theming Volto without SemanticUI: Is It Possible?</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/nicola-zambello-theming-volto-without-semanticui-is-it-possible" />\n-\n-\n-\n-      <id>urn:syndication:d96309ed215a2fec3c67f7f3e4d97885</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>We will walk through the process of building a product for Italian Public Administrations using a bootstrap-based theme.\n-I\'m presenting io-comune, RedTurtle\'s first product based on Volto and the strategies we used.\n-We will see the possibilities in Volto for theming without SemanticUI, using bootstrap and sass and what are the next ideas we could work on.</p>\n-<p>Scenario:</p>\n-<ul class="simple">\n-<li>We wanted to adopt Volto in our new project.</li>\n-<li>We needed to include Bootstrap.</li>\n-<li>Volto uses SemanticUI instead.</li>\n-<li>Two such frameworks will conflict, for example fighting over the same selector.</li>\n-</ul>\n-<p>We tried. We tried harder.\n-A cheap approach did not seem possible, so we looked for a sane one.</p>\n-<p>A new theme: <tt class="docutils literal"><span class="pre">pastanaga-cms-ui</span></tt>. Load only the CSS needed for Volto admin UI, see <a class="reference" href="https://github.com/plone/volto/pull/970">Volto PR 970</a>.\n-And <tt class="docutils literal"><span class="pre">public-ui</span></tt> for public pages.\n-In your <tt class="docutils literal"><span class="pre">src/theme.js</span></tt> do not import the css/less from semantic-ui, but the <tt class="docutils literal"><span class="pre">pastanaga-cms-ui</span></tt>.\n-In theme theme.config also use pastanaga-cms-ui.\n-Also razzle-config.</p>\n-<p>You should normalize your base style, for example:</p>\n-<pre class="literal-block">\n-body.cms-ui {\n-  .public-ui {\n-    font-size: 18px;\n-  }\n-}\n-</pre>\n-<p>and wrap your components with <tt class="docutils literal"><span class="pre">.public-ui</span></tt>.</p>\n-<p>Building a product:</p>\n-<ul class="simple">\n-<li>Base common package for every customer: <a class="reference" href="https://github.com/RedTurtle/design-volto-theme">https://github.com/RedTurtle/design-volto-theme</a></li>\n-<li>New intermediate layer for SemanticUI</li>\n-<li>New config layer for razzle/customizations</li>\n-<li>Template for actual projects: <tt class="docutils literal"><span class="pre">design-volto-kit</span></tt>, with a Yeoman generator: <tt class="docutils literal"><span class="pre">create-italia-volto-app</span></tt></li>\n-</ul>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-09T14:22:41+00:00</published>\n-\n-      <updated>2020-12-09T14:22:41+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Alin Voinea: Volto Dexterity Schema and Layout Editor</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/alin-voinea-volto-dexterity-schema-and-layout-editor" />\n-\n-\n-\n-      <id>urn:syndication:e78a4c57d7c28e52be32a25b83f7c466</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>Through the Web Dexterity Content-Types with Schema Editor and Blocks Layout Editor</p>\n-<p>How do we define content types schemas in Plone?</p>\n-<ul class="simple">\n-<li>TTW schema editor</li>\n-<li>GenericSetup profile</li>\n-<li>Behaviors, schemas in Python</li>\n-</ul>\n-<p>Why do we need them, we have Volto blocks, right?\n-You still need metadata, a title, etcetera. Certainly for larger institutions you need a structure, a schema.\n-Volto itself has schema-based components.</p>\n-<p>Layout editor.\n-Blocks have properties, like a placeholder, a position.\n-You can type text in a block: &quot;Published on date by author&quot;.\n-Then select &quot;date&quot; and link this text to the published date metadata,\n-and select &quot;author&quot; and link it to the author.\n-Save this as a layout for a content type.\n-You can export this to a JSONField in a custom behavior, so you can save it in version control for production.</p>\n-<p>List of add-ons and other packages that make Volto awesome:\n-<a class="reference" href="https://github.com/collective/awesome-volto">https://github.com/collective/awesome-volto</a></p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-08T17:40:59+00:00</published>\n-\n-      <updated>2020-12-08T17:40:59+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Jens Klein: Performance, Profiling, Power-Consumption</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/jens-klein-performance-profiling-power-consumption" />\n-\n-\n-\n-      <id>urn:syndication:8c53225f93c004d147e18d907160144d</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>I want to focus on Python performance, so not caching or database performance.</p>\n-<p>Tools:</p>\n-<ul class="simple">\n-<li><tt class="docutils literal"><span class="pre">py-spy</span></tt>: Overall mix of the whole live application, top-like.</li>\n-<li><tt class="docutils literal"><span class="pre">repoze.profile</span></tt>: WSGI middleware, slows down application. Profile single request and analyse its call stack by count, call time, etc.</li>\n-<li><tt class="docutils literal"><span class="pre">dis</span></tt>: disassembler for Python at the bytecode level.</li>\n-</ul>\n-<p>Improvements Plone 5.2.0-5.2.3:</p>\n-<ul class="simple">\n-<li>Avoided early <tt class="docutils literal"><span class="pre">providedBy</span></tt> calls</li>\n-<li><tt class="docutils literal"><span class="pre">__getattr__</span></tt> early exit on common attributes</li>\n-<li><tt class="docutils literal"><span class="pre">zope.interface</span></tt>: some functions are called hundreds of thousands of times when you reindex an index, so a tiny improvement helps a lot. I found various places that could use improvements, and that landed in the package, together with memory improvements by Jason Madden.</li>\n-</ul>\n-<p>Live demo. I call <tt class="docutils literal"><span class="pre">py-spy</span></tt> with <tt class="docutils literal"><span class="pre">sudo</span></tt> because I need to connect to an existing process id.</p>\n-<p>Future Todo\'s:</p>\n-<ul class="simple">\n-<li><tt class="docutils literal"><span class="pre">plone.restapi</span></tt> has optimization potential, all navigation related, but currently it still supports even Plone 4.3. This will likely wait for a 5.2-only or Python3-only branch.</li>\n-<li><tt class="docutils literal"><span class="pre">plone.registry</span></tt> is called too often</li>\n-<li>Use <tt class="docutils literal"><span class="pre">python:</span></tt> expressions in all page templates. They are way faster than standard Tales expressions.</li>\n-<li>More introspection.</li>\n-<li>Move more logic from page templates to Python code</li>\n-</ul>\n-<p>Advice: start introspecting the performance of your application.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-08T16:27:53+00:00</published>\n-\n-      <updated>2020-12-08T16:27:53+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Alex Clark: The State of Pillow</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/alex-clark-the-state-of-pillow" />\n-\n-\n-\n-      <id>urn:syndication:e34819d893c83228742eda41c42063d6</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>The Plone Conference account tweeted that a State of Plone talk would be awesome and that the Plone community missed me. I miss the Plone community too, so I am here.</p>\n-<p>I will state it clearly: Pillow would not exist if not for Plone.</p>\n-<p>In July 2010 I announced Pillow as &quot;friendly&quot; fork of PIL. The <a class="reference" href="https://mail.python.org/pipermail/image-sig/2010-July/006423.html">mailing thread</a> and future answers are interesting to read.</p>\n-<p>Some history:</p>\n-<ul class="simple">\n-<li>1991: Python 0.9.1</li>\n-<li>1995: PIL started</li>\n-<li>1998: Zope</li>\n-<li>1999: Zope2</li>\n-<li>2000: Python 2.0 with distutils</li>\n-<li>2001: Plone</li>\n-<li>2005: Buildout</li>\n-<li>2006: I attended my first Plone Conference, in Washington</li>\n-<li>2006: setuptools was born</li>\n-</ul>\n-<p>PIL had an issue, or Plone had an issue with PIL:</p>\n-<ul class="simple">\n-<li>PIL used distutils.</li>\n-<li>Plone 3.2 used Buildout and setuptools</li>\n-<li>PIL was not installable in Buildout and setuptools</li>\n-<li>Specific problem: <tt class="docutils literal"><span class="pre">import</span> <span class="pre">Image</span></tt> could mean the Image module from PIL, or the Image module from Zope.</li>\n-</ul>\n-<p>Various ways of repackaging PIL started, for example <tt class="docutils literal"><span class="pre">PILwoTk</span></tt>. You can still find various PIL derivatives at <a class="reference" href="https://dist.plone.org/thirdparty/">https://dist.plone.org/thirdparty/</a></p>\n-<p>PIL 1.1.6 from 2006 is still the last version on <a class="reference" href="https://pypi.org/project/PIL/#history">PyPI</a>. I got maintainership of this page this year, actually.\n-Pillow 1.0 is basically the same, except that it uses <tt class="docutils literal"><span class="pre">setuptools</span></tt>.\n-This worked in buildout.\n-I was happy.</p>\n-<p>Couple years, nothing really interesting happened.\n-But some contributors came along.\n-Pillow 2.0.0 in March 2013 had Python 3 support.</p>\n-<p>An important milestone in 2015: we added release notes.</p>\n-<p>Release schedule: in the beginning of every quarter.</p>\n-<p>We get some money from Tidelift for maintenance.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-08T16:23:06+00:00</published>\n-\n-      <updated>2020-12-08T16:26:22+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Lightning talks Monday</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/lightning-talks-monday" />\n-\n-\n-\n-      <id>urn:syndication:73d847717e4336392db709c0738ec383</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <div class="section" id="alec-mitchell-wysiwyg-problems-be-gone">\n-<h3><a name="alec-mitchell-wysiwyg-problems-be-gone">Alec Mitchell: WYSIWYG problems be gone</a></h3>\n-<p>A new add-on to vastly* improve your content editing experience.</p>\n-<p>(* size of improvement may vary, no warranty implied. The following is (un)paid free software promotional content)</p>\n-<p>Adding images to a document is so hard! At least nine steps! (Difficulty be exaggerated for marketing purposes).\n-Why can\'t you drop an image in?\n-You can, with our new, super special add-on <a class="reference" href="https://pypi.org/project/kcrw.tinymce-imagedrop/">krcw.tinymce_imagedrop</a>.</p>\n-<p>Can you drop two?\n-Yes!</p>\n-<p>Can you drop more than two?\n-No, because browsers are weird.</p>\n-<p>But it fails gracefully.</p>\n-</div>\n-<div class="section" id="steve-piercy-deform-and-friends">\n-<h3><a name="steve-piercy-deform-and-friends">Steve Piercy: Deform and friends</a></h3>\n-<p>How I learned to stop worrying and love web forms.\n-We must have a good interface, data structure, validation, security.\n-Deform (form library), colander (de/serialization), peppercorn (data structure), bootstrap forms for design.\n-We have a looooong list of widgets.\n-In deform 3.0 we will use bootstrap 5.\n-See <a class="reference" href="https://github.com/pylons/deform">https://github.com/pylons/deform</a></p>\n-</div>\n-<div class="section" id="christopher-lozinski-forest-wiki">\n-<h3><a name="christopher-lozinski-forest-wiki">Christopher Lozinski: Forest Wiki</a></h3>\n-<p>The <a class="reference" href="https://forestwiki.com/">Forest Wiki</a> is a modern version of Zope 2.\n-Biggest difference: it uses Pyramid\'s security and views.\n-Modern JavaScript enabled ZMI: reorder, sort, rename, etc.\n-Both WYSIWYG and MarkDown pages.\n-Advanced types like JSON, CoffeeScript, pug. Pug is the leading template engine for Node.</p>\n-</div>\n-<div class="section" id="jens-klein-relstorage">\n-<h3><a name="jens-klein-relstorage">Jens Klein: RelStorage</a></h3>\n-<p>Plone relational database backend storage.\n-It is a drop-in replacement for FileStorage of ZEO.\n-You can use PostgreSQL, MySQL, Oracle, SQLite.\n-It has been around for about 13 years, grown old, but in recent years development has picked up, driven by Jason Madden, including Python 3 support. It is much more performant.\n-Latest release 3.4.0 is form October 2020.</p>\n-<p>PostgreSQL is the cloud database, kind of industry standard, well supported by all big cloud providers.\n-Easy to install in Docker.</p>\n-<p>Advantages of RelStorage: fast, parallel commits, better concurrency, shorter locks.\n-Optimized per process caching.\n-Blobs in database.\n-Optionally you can use it in history free mode. You lose the Undo functionality, but you don\'t need to pack so often.</p>\n-<p><tt class="docutils literal"><span class="pre">plone.recipe.zope2instance</span></tt> supports it with the <tt class="docutils literal"><span class="pre">rel-storage</span></tt> option.</p>\n-<p>You can use additional client side caches, shared between all threads of a process.</p>\n-<p>With the <tt class="docutils literal"><span class="pre">zodbconvert</span></tt> tool you convert from ZEO to RelStorage, or the other way around, including converting blobs if needed.</p>\n-<p>ZODB keeps old transactions, so packing is needed, even in history free mode. RelStorage has a fast <tt class="docutils literal"><span class="pre">zodbpack</span></tt>.</p>\n-<p>Blobs:</p>\n-<ul>\n-<li><p class="first">RelStorage 3.x is Python 3 only and runs with Plone 5.2+. Here, blobs should be stored in RelStorage.</p>\n-</li>\n-<li><p class="first">RelStorage 2.x is for Plone 5.0, 5.1, and blobs should <a href="#id1" name="id2"><span class="problematic" id="id2">**</span></a>not**&nbsp; be stored in the database, except for Oracle backends, otherwise you should still use a shared blobs filesystem directory.</p>\n-<div class="system-message" id="id1">\n-<p class="system-message-title">System Message: <a name="id1">WARNING/2</a> (<tt class="docutils">&lt;string&gt;</tt>, line 69); <em><a href="#id2">backlink</a></em></p>\n-<p>Inline strong start-string without end-string.</p>\n-</div>\n-</li>\n-</ul>\n-<p>I use RelStorage today for all my live deployments. I have used it since version 1.6 with Plone 4.3 and never had problems. Always blazing fast. Dev/ops and sysadmins love it: it is a standard solution, nothing special, just works.</p>\n-</div>\n-<div class="section" id="maik-derstappen-add-on-catalog-for-plone">\n-<h3><a name="maik-derstappen-add-on-catalog-for-plone">Maik Derstappen: Add-on catalog for Plone</a></h3>\n-<p>We want to bring back an add-on catalog for Plone. You can look on PyPI, but it is hard to find packages.</p>\n-<p>We worked on a tool for this. You can search on named, filter on Plone versions and add-on types.</p>\n-<p>Components:</p>\n-<ul class="simple">\n-<li>The <a class="reference" href="https://github.com/collective/pyf.aggregator">Python Package Filter Aggregator</a> (<tt class="docutils literal"><span class="pre">pyf.aggregator</span></tt>) aggregates the meta information of all Python packages in the PyPI.</li>\n-<li>an <a class="reference" href="https://github.com/collective/pyf.api">api</a> using elasticsearch</li>\n-<li>a <a class="reference" href="https://github.com/collective/pyf-svelte-gui">prototype in Svelte</a></li>\n-</ul>\n-<p>We only aggregate packages that have classifier <tt class="docutils literal"><span class="pre">Plone</span> <span class="pre">::</span> <span class="pre">Framework</span></tt>.\n-We will probably work on this during the sprints and are happy to onboard you.</p>\n-</div>\n-<div class="section" id="david-bain-plone-and-webflow">\n-<h3><a name="david-bain-plone-and-webflow">David Bain: Plone and Webflow</a></h3>\n-<p>Both platforms are for building websites, but they approach things in different ways.\n-I hope this may inspire.\n-Keep in mind the motivation of the two platforms, which may account for some strengths and weaknesses.</p>\n-<p>Webflow is visual web design, less content management. Strong design tools.\n-Designer friendly layout tools.\n-You can design a page with what you could call blocks.</p>\n-<p>Plone is enterprise content management, focus on security.\n-Linking to an attachment is standard, where it is tricky in Webflow.\n-Forms are way more flexible.</p>\n-<p>We have also built a website in Webflow and based it on Plone.</p>\n-</div>\n-<div class="section" id="steve-piercy-pyramid-project-in-pycharm-professional">\n-<h3><a name="steve-piercy-pyramid-project-in-pycharm-professional">Steve Piercy: Pyramid Project in PyCharm Professional</a></h3>\n-<p>It is easy to create a such a project. Demo.\n-See <a class="reference" href="https://stevepiercy.github.io/pppp/">https://stevepiercy.github.io/pppp/</a></p>\n-</div>\n-<div class="section" id="miu-razvan-volto-grid-block">\n-<h3><a name="miu-razvan-volto-grid-block">Miu Razvan: Volto grid block</a></h3>\n-<ul class="simple">\n-<li>Created by Eau de Web team</li>\n-<li>Dependencies: Volto blocks form</li>\n-<li>Similar component: Volto columns block</li>\n-<li>Use it to organize other blocks.</li>\n-<li>Demo showing lots of configuration options, including for different screen sizes</li>\n-<li>See <a class="reference" href="https://github.com/eea/volto-grid-block">https://github.com/eea/volto-grid-block</a></li>\n-</ul>\n-</div>\n-<div class="section" id="maik-derstappen-custom-elements">\n-<h3><a name="maik-derstappen-custom-elements">Maik Derstappen: Custom elements</a></h3>\n-<p>Custom elements are an extension to normal native html elements, for example <tt class="docutils literal"><span class="pre">&lt;flag-icon&gt;</span></tt>.</p>\n-<p>The promise of web components: write once, use anywhere.\n-See <a class="reference" href="https://custom-elements-everywhere.com/">https://custom-elements-everywhere.com/</a></p>\n-<p>How do you use this in Plone?\n-Use <tt class="docutils literal"><span class="pre">plonecli</span> <span class="pre">add</span> <span class="pre">svelte_app</span></tt> to create a small app. Run <tt class="docutils literal"><span class="pre">yarn</span></tt>. Install in Plone add-ons control panel.\n-Edit a page. Replace html source with <tt class="docutils literal"><span class="pre">&lt;my-svelte-app</span> <span class="pre">/&gt;</span></tt>.\n-And your component is there and working.\n-The size is less than five&nbsp; kilobytes.</p>\n-</div>\n-<div class="section" id="tiberiu-ichim-volto-slate">\n-<h3><a name="tiberiu-ichim-volto-slate">Tiberiu Ichim: volto-slate</a></h3>\n-<p><tt class="docutils literal"><span class="pre">volto-slate</span></tt> is a drop-in replacement for the standard rich text editor in Volto.\n-Volto turns an HTML document into a modern document.</p>\n-<p>Why another text editor instead of improving the existing one?</p>\n-<ul class="simple">\n-<li>With Slate we get a better plugin framework. Plugins are just wrappers around the editor. The standard Draft.js is meant to be integrated directly by an application, no concept of plugins out-of-the-box.</li>\n-<li>Slate has simple DOM-like storage for its values, making it easier to render the ersult.</li>\n-</ul>\n-<p>Current status:</p>\n-<ul class="simple">\n-<li>No migrations of any kind.</li>\n-<li>Right now not possible to completely remove or replace Draftjs out of Volto.</li>\n-</ul>\n-</div>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-08T11:53:56+00:00</published>\n-\n-      <updated>2020-12-09T10:19:52+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Fred van Dijk: collective.collectionfilter as a Light-weight Faceted Navigation or a \'compare\' Console</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/fred-van-dijk-collective-collectionfilter-as-a-light-weight-faceted-navigation-or-a-compare-console" />\n-\n-\n-\n-      <id>urn:syndication:0a9da3a3170511af38154da7691da92a</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>I want to talk about some categorisation and classification options in Plone, next to the folder structure.</p>\n-<p>Faceted navigation: drill down on \'facets\' when you search for items. It was popularized by online shopping. Facets in Plone for developers is: whatever is in the ZCatalog, and for users: what you can search on in Collections.\n-Gold standard is <a class="reference" href="https://github.com/eea/eea.facetednavigation">eea.facetednavigation</a>, developed for the European Environment Agency. Examples: <a class="reference" href="https://www.eea.europa.eu/highlights">EEA</a>,  and on two sites by Zest: <a class="reference" href="https://vaquums.eu/sensor-db">Vaquums</a> and <a class="reference" href="https://www.minaraad.be/zoeken">Minaraad</a>, where it replaces the standard search.</p>\n-<p>collective.collectionfilter is a much leaner, meaner, but also more limited version of faceted navigation. Demo with standard Plone News Items with some tags (also known as categories, also known as Subject). Add a Collection that filters on News Items. Now add collection filter portlets.</p>\n-<p>eea.facetednavigation takes over your complete page. In an action you enable or disable it.</p>\n-<p>Now a demo of collectionfilter in SGBP, a documentation website for water management planning in Belgium/Flanders. The customer wanted to take some graphs and compare them. We did that with collectionfilter and collective.classifiers. With the last one we added structured categories: one for water basins and one for parameters of the graphs. Now we use collectionfilter to query a parameter and show the graphs for all water basins.</p>\n-<p>You can adapt several things in the collectionfilter UI, for example change how search options are displayed. This is documented, but took me a while to get right.</p>\n-<p>Collectionfilter also works with Mosaic, because the portlets are also mapped to tiles.</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-07T21:10:20+00:00</published>\n-\n-      <updated>2020-12-07T21:10:20+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-\n-    <entry>\n-\n-      <title>Asko Soukka: Plone and Volto in a Jamstack project</title>\n-\n-      <link rel="alternate" type="text/html"\n-            href="https://maurits.vanrees.org/weblog/archive/2020/12/asko-soukka-plone-and-volto-in-a-jamstack-project" />\n-\n-\n-\n-      <id>urn:syndication:a2b3ebe0e81fdf7ce953cb80333b0919</id>\n-\n-\n-\n-\n-\n-\n-      <content type="html"\n-               xml:base="https://maurits.vanrees.org"\n-               xml:lang="en-US" xml:space="preserve">\n-          <![CDATA[\n-          <p>Here are the <a class="reference" href="https://datakurre.github.io/ploneconf2020/plone-and-volto-in-jamstack-project.pdf">slides</a>.</p>\n-<p>I am a software architect at University of Jyv\xc3\xa4skyl\xc3\xa4. I have been using Plone since 2004 and GatsbyJS since 2018.\n-The university wanted one student information management system to rule them all, but... every organisation shall do their own integrations, using granular REST API with deep JSON responses. And there should be branded study guides, which we crafted with GatsbyJS. But this was not enough for the Open University part. They really needed a CMS.</p>\n-<p>We use Plone 5.2, Volto, GatsbyJS, and have 6000 html pages, times two languages, out of which 760 are Volto pages.\n-With Plone we could extend content types without needing to do any coding, in the content types field editor. In volto we added auto-complete widgets with custom vocabularies. On the GatsbyJs side, we query the connected pages with GraphQL. We render Volto layouts with React components, rendering individual blocks.</p>\n-<p>Why did we choose GatsbyJs? It is a ReactJS-based site generator. Being static, it is very fast. You can use multiple sources as input, using a plugin architecture. Data lookup is done with GraphQL. It is easy to get started, with comprehensive documentation.</p>\n-<p>I mentored two Google Summer of Code projects for the <tt class="docutils literal"><span class="pre">gatsby-source-plone</span></tt> plugin. It supports default types and most TTW types, also Volto blocks. You can do incremental updates by modification date, so it is really fast.</p>\n-<p>Not everything is easy. The full &quot;GatsbyJs experience&quot; requires practice. You want to replace inline images and links with GatsbyJs images and links, replace file links with direct downloads.</p>\n-<p>Using <tt class="docutils literal"><span class="pre">&#64;plone/volto</span></tt> as dependency to render blocks seemed like a good idea, but it required webpack overrides to be impartable, and could not be used for images and links.</p>\n-<p>The ugly parts of GatsbyJs:</p>\n-<ul class="simple">\n-<li>The GraphQL source plugin cannot cache.</li>\n-<li>The build may take hours, and gigabytes of memory.</li>\n-<li>The build result in readonly.</li>\n-<li>For me it is hard to follow GatsbyJs development, especially individual plugins, because they use a monorepo.</li>\n-</ul>\n-<p>Editors can work on the site during the day, and then wee rebuild the result during the night</p>\n-\n-          ]]>\n-      </content>\n-\n-\n-\n-      <author>\n-        <name>Maurits van Rees</name>\n-      </author>\n-\n-      <published>2020-12-07T17:54:09+00:00</published>\n-\n-      <updated>2020-12-07T17:54:09+00:00</updated>\n-\n-\n-        <category term="plone" />\n-\n-\n-        <category term="ploneconf2020" />\n-\n-\n-    </entry>\n-\n-\n-\n-</feed>\ndiff --git a/plone/app/portlets/tests/configure.zcml b/plone/app/portlets/tests/configure.zcml\nindex 1b376d1c..61518080 100644\n--- a/plone/app/portlets/tests/configure.zcml\n+++ b/plone/app/portlets/tests/configure.zcml\n@@ -1,26 +1,28 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    xmlns:plone="http://namespaces.plone.org/plone"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n     package="plone.app.portlets"\n-    i18n_domain="test">\n+    i18n_domain="test"\n+    >\n \n-    <plone:portlet\n-        name="portlets.test.Test"\n-        interface="plone.app.portlets.tests.test_configuration.ITestPortlet"\n-        assignment="plone.app.portlets.tests.test_configuration.TestAssignment"\n-        renderer="plone.app.portlets.tests.test_configuration.TestRenderer"\n-        addview="plone.app.portlets.tests.test_configuration.TestAddForm"\n-        editview="plone.app.portlets.tests.test_configuration.TestEditForm"\n-        />\n+  <plone:portlet\n+      name="portlets.test.Test"\n+      interface="plone.app.portlets.tests.test_configuration.ITestPortlet"\n+      assignment="plone.app.portlets.tests.test_configuration.TestAssignment"\n+      renderer="plone.app.portlets.tests.test_configuration.TestRenderer"\n+      addview="plone.app.portlets.tests.test_configuration.TestAddForm"\n+      editview="plone.app.portlets.tests.test_configuration.TestEditForm"\n+      />\n \n-    <genericsetup:registerProfile\n-        name="testing"\n-        title="plone.app.portlets testing"\n-        description="Used for testing only"\n-        directory="tests/profiles/testing"\n-        for="Products.CMFCore.interfaces.ISiteRoot"\n-        provides="Products.GenericSetup.interfaces.EXTENSION"\n-        />\n+  <genericsetup:registerProfile\n+      name="testing"\n+      title="plone.app.portlets testing"\n+      description="Used for testing only"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      directory="tests/profiles/testing"\n+      />\n \n </configure>\ndiff --git a/plone/app/portlets/tests/profiles/testing/portlets.xml b/plone/app/portlets/tests/profiles/testing/portlets.xml\nindex e1a89a5c..4895e87c 100644\n--- a/plone/app/portlets/tests/profiles/testing/portlets.xml\n+++ b/plone/app/portlets/tests/profiles/testing/portlets.xml\n@@ -1,153 +1,141 @@\n-<?xml version="1.0"?>\n-<portlets\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    i18n:domain="plone">\n-\n-    <portletmanager\n-        name="test.testcolumn"\n-        type="plone.app.portlets.tests.test_configuration.ITestColumn"\n-        />\n-\n-    <portletmanager\n-        name="test.testcolumn2"\n-        type="plone.app.portlets.tests.test_configuration.ITestColumn"\n-        />\n-\n-    <portlet\n-        addview="portlets.test.Test"\n-        title="Test portlet"\n-        description="A test portlet"\n-        i18n:attributes="title title_test_portlet;\n-                         description description_test_portlet"\n-        />\n-\n-    <!-- \'name\' and \'insert-before\' are optional -->\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="context"\n-        key="/"\n-        type="portlets.test.Test"\n-        name="test.portlet1">\n-            <property name="test_text">Test pr\xc3\xb6p 1</property>\n-            <property name="test_bool">False</property>\n-            <property name="test_tuple">\n-                <element>published</element>\n-                <element>private</element>\n-            </property>\n-    </assignment>\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="context"\n-        key="/"\n-        type="portlets.test.Test"\n-        name="test.portlet2"\n-        visible="0"\n-        insert-before="test.portlet1">\n-            <property name="test_text">Test prop 2</property>\n-            <property name="test_bool">True</property>\n-            <property name="test_tuple" />\n-    </assignment>\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="context"\n-        key="/"\n-        type="portlets.test.Test"\n-        name="test.portlet3"\n-        insert-before="*" />\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="content_type"\n-        key="Folder"\n-        type="portlets.test.Test"\n-        name="test.portlet4"\n-        insert-before="test.portlet1"\n-        />\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="content_type"\n-        key="Folder"\n-        type="portlets.test.Test"\n-        name="test.portlet5"\n-        insert-before="test.portlet1"\n-        />\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="group"\n-        key="Reviewers"\n-        type="portlets.test.Test"\n-        name="test.portlet6"\n-        insert-before="test.portlet1"\n-        />\n-\n-    <assignment\n-        manager="test.testcolumn"\n-        category="context"\n-        key="/"\n-        type="portlets.test.Test"\n-        name="test.portlet7"\n-        remove="" />\n-\n-    <assignment name="navigation"\n-        category="context"\n-        key="/"\n-        manager="test.testcolumn2"\n-        type="portlets.Navigation"\n-        visible="True">\n-        <property name="topLevel">1</property>\n-        <property name="currentFolderOnly">False</property>\n-        <property name="name"></property>\n-        <property name="includeTop">False</property>\n-        <property name="bottomLevel">0</property>\n-        <property name="root"></property>\n-        <property name="no_icon">False</property>\n-        <property name="thumb_scale"></property>\n-        <property name="no_thumbs">False</property>\n-    </assignment>\n-\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="context"\n-        location="/news"\n-        status="block"\n-        />\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="group"\n-        location="/news"\n-        status="show"\n-        />\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="content_type"\n-        location="/news"\n-        status="acquire"\n-        />\n-\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="content_type"\n-        location="/"\n-        status="block"\n-        />\n-\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="group"\n-        location="/"\n-        status="show"\n-        />\n-\n-    <blacklist\n-        manager="test.testcolumn"\n-        category="context"\n-        location="/"\n-        status="acquire"\n-        />\n+<?xml version="1.0" encoding="utf-8"?>\n+<portlets xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+          i18n:domain="plone"\n+>\n+\n+  <portletmanager name="test.testcolumn"\n+                  type="plone.app.portlets.tests.test_configuration.ITestColumn"\n+  />\n+\n+  <portletmanager name="test.testcolumn2"\n+                  type="plone.app.portlets.tests.test_configuration.ITestColumn"\n+  />\n+\n+  <portlet addview="portlets.test.Test"\n+           description="A test portlet"\n+           title="Test portlet"\n+           i18n:attributes="title title_test_portlet;                          description description_test_portlet"\n+  />\n+\n+  <!-- \'name\' and \'insert-before\' are optional -->\n+\n+  <assignment category="context"\n+              key="/"\n+              manager="test.testcolumn"\n+              name="test.portlet1"\n+              type="portlets.test.Test"\n+  >\n+    <property name="test_text">Test pr\xc3\xb6p 1</property>\n+    <property name="test_bool">False</property>\n+    <property name="test_tuple">\n+      <element>published</element>\n+      <element>private</element>\n+    </property>\n+  </assignment>\n+\n+  <assignment category="context"\n+              insert-before="test.portlet1"\n+              key="/"\n+              manager="test.testcolumn"\n+              name="test.portlet2"\n+              type="portlets.test.Test"\n+              visible="0"\n+  >\n+    <property name="test_text">Test prop 2</property>\n+    <property name="test_bool">True</property>\n+    <property name="test_tuple" />\n+  </assignment>\n+\n+  <assignment category="context"\n+              insert-before="*"\n+              key="/"\n+              manager="test.testcolumn"\n+              name="test.portlet3"\n+              type="portlets.test.Test"\n+  />\n+\n+  <assignment category="content_type"\n+              insert-before="test.portlet1"\n+              key="Folder"\n+              manager="test.testcolumn"\n+              name="test.portlet4"\n+              type="portlets.test.Test"\n+  />\n+\n+  <assignment category="content_type"\n+              insert-before="test.portlet1"\n+              key="Folder"\n+              manager="test.testcolumn"\n+              name="test.portlet5"\n+              type="portlets.test.Test"\n+  />\n+\n+  <assignment category="group"\n+              insert-before="test.portlet1"\n+              key="Reviewers"\n+              manager="test.testcolumn"\n+              name="test.portlet6"\n+              type="portlets.test.Test"\n+  />\n+\n+  <assignment category="context"\n+              key="/"\n+              manager="test.testcolumn"\n+              name="test.portlet7"\n+              remove=""\n+              type="portlets.test.Test"\n+  />\n+\n+  <assignment category="context"\n+              key="/"\n+              manager="test.testcolumn2"\n+              name="navigation"\n+              type="portlets.Navigation"\n+              visible="True"\n+  >\n+    <property name="topLevel">1</property>\n+    <property name="currentFolderOnly">False</property>\n+    <property name="name" />\n+    <property name="includeTop">False</property>\n+    <property name="bottomLevel">0</property>\n+    <property name="root" />\n+    <property name="no_icon">False</property>\n+    <property name="thumb_scale" />\n+    <property name="no_thumbs">False</property>\n+  </assignment>\n+\n+  <blacklist category="context"\n+             location="/news"\n+             manager="test.testcolumn"\n+             status="block"\n+  />\n+  <blacklist category="group"\n+             location="/news"\n+             manager="test.testcolumn"\n+             status="show"\n+  />\n+  <blacklist category="content_type"\n+             location="/news"\n+             manager="test.testcolumn"\n+             status="acquire"\n+  />\n+\n+  <blacklist category="content_type"\n+             location="/"\n+             manager="test.testcolumn"\n+             status="block"\n+  />\n+\n+  <blacklist category="group"\n+             location="/"\n+             manager="test.testcolumn"\n+             status="show"\n+  />\n+\n+  <blacklist category="context"\n+             location="/"\n+             manager="test.testcolumn"\n+             status="acquire"\n+  />\n \n </portlets>\ndiff --git a/plone/app/portlets/tests/testDoctests.py b/plone/app/portlets/tests/testDoctests.py\nindex c52d40bd..90b19398 100644\n--- a/plone/app/portlets/tests/testDoctests.py\n+++ b/plone/app/portlets/tests/testDoctests.py\n@@ -2,11 +2,12 @@\n from plone.app.portlets.testing import OPTIONFLAGS\n from plone.app.portlets.testing import PLONE_APP_PORTLETS_FUNCTIONAL_TESTING\n from plone.testing import layered\n-from unittest import TestSuite\n+\n+import unittest\n \n \n def test_suite():\n-    suite = TestSuite()\n+    suite = unittest.TestSuite()\n     suite.addTest(\n         layered(\n             DocFileSuite(\ndiff --git a/plone/app/portlets/tests/testMemberDashboard.rst b/plone/app/portlets/tests/testMemberDashboard.rst\nindex dd922332..bb095334 100644\n--- a/plone/app/portlets/tests/testMemberDashboard.rst\n+++ b/plone/app/portlets/tests/testMemberDashboard.rst\n@@ -16,7 +16,7 @@ bug: 11174: Portal Members can\'t add portlets to their dashboard\n ----------------------\n Login as the \'user1\' user\n \n-    >>> from plone.testing.z2 import Browser\n+    >>> from plone.testing.zope import Browser\n     >>> browser = Browser(layer[\'app\'])\n     >>> portalURL = portal.absolute_url()\n \n@@ -34,7 +34,7 @@ Go to the dashboard and check that portlets are addable here\n \n Let\'s try to add a Search portlet and then remove it\n \n-    >>> bool(re.search(\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n+    >>> bool(re.search(r\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n     False\n     >>> browser.getControl(name=\':action\',index=0).value = [\'/++dashboard++plone.dashboard1+user1/+/portlets.Search\']\n     >>> browser.getForm(index=1).submit()\n@@ -73,7 +73,7 @@ Using the addview, let\'s see that we cannot add a portlet for another user\n     >>> browser.getControl(\'Log in\').click()\n \n     >>> browser.open(portalURL+\'/@@manage-dashboard?_authenticator=\' + createToken())\n-    >>> bool(re.search(\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n+    >>> bool(re.search(r\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n     False\n \n Now, we try to open the @@manage-portlets view and also try to call the addview\n@@ -94,7 +94,7 @@ those views\n     >>> browser.open(portalURL+\'/@@manage-portlets?_authenticator=\' + createToken())\n     >>> "Insufficient Privileges" in browser.contents\n     False\n-    >>> bool(re.search(\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n+    >>> bool(re.search(r\'\\<\\/span\\>\\s+Search\\s+\\<\\/div\\>\', browser.contents))\n     False\n     >>> browser.open(portalURL + "/++contextportlets++plone.leftcolumn/+/portlets.Search")\n     >>> "Insufficient Privileges" in browser.contents\ndiff --git a/plone/app/portlets/tests/test_actions_portlet.py b/plone/app/portlets/tests/test_actions_portlet.py\nindex c9a2b605..3427115c 100644\n--- a/plone/app/portlets/tests/test_actions_portlet.py\n+++ b/plone/app/portlets/tests/test_actions_portlet.py\n@@ -12,6 +12,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -19,7 +21,7 @@ def afterSetUp(self):\n \n     def test_portlet_type_registered(self):\n         portlet = getUtility(IPortletType, name="portlets.Actions")\n-        self.assertEquals(portlet.addview, "portlets.Actions")\n+        self.assertEqual(portlet.addview, "portlets.Actions")\n         return\n \n     def test_interfaces(self):\n@@ -40,7 +42,7 @@ def test_invoke_add_view(self):\n         data = {"ptitle": "Actions", "category": "document", "show_icons": True}\n         addview.createAndAdd(data=data)\n \n-        self.assertEquals(len(mapping), 1)\n+        self.assertEqual(len(mapping), 1)\n         self.assertTrue(isinstance(mapping.values()[0], actions.Assignment))\n         return\n \n@@ -158,18 +160,18 @@ def test_multiple_portlets(self):\n         links2 = r2.actionLinks()\n \n         # check the portal_tabs links (portal_tabs is somehow special)\n-        self.assertEquals(len(links1), 5)\n-        self.assertEquals(links1[0]["title"], "Home")\n+        self.assertEqual(len(links1), 5)\n+        self.assertEqual(links1[0]["title"], "Home")\n \n         # now check the site_actions links\n         # this was failing until the caching of actionLinks method was fixed\n         if int(migtool.getInstanceVersion()[0]) >= 4:\n-            self.assertEquals(len(links2), 3)\n+            self.assertEqual(len(links2), 3)\n         else:\n-            self.assertEquals(len(links2), 4)\n-        self.assertEquals(links2[0]["title"], "Site Map")\n-        self.assertEquals(links2[0]["url"], "http://nohost/plone/sitemap")\n-        self.assertEquals(links2[0]["icon"], None)\n+            self.assertEqual(len(links2), 4)\n+        self.assertEqual(links2[0]["title"], "Site Map")\n+        self.assertEqual(links2[0]["url"], "http://nohost/plone/sitemap")\n+        self.assertEqual(links2[0]["icon"], None)\n         return\n \n     def test_portal_tabs(self):\n@@ -239,3 +241,10 @@ def test_object_buttons_with_icons(self):\n         expected = {"Cut", "Copy", "Rename", "Delete"}\n         got = {str(link["title"]) for link in output}\n         self.assertTrue(expected.issubset(got))\n+\n+\n+def test_suite():\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n+    return suite\ndiff --git a/plone/app/portlets/tests/test_cache.py b/plone/app/portlets/tests/test_cache.py\nindex f3ca0184..928c42fc 100644\n--- a/plone/app/portlets/tests/test_cache.py\n+++ b/plone/app/portlets/tests/test_cache.py\n@@ -2,6 +2,8 @@\n from plone.app.portlets.tests.base import PortletsTestCase\n from plone.app.testing import logout\n \n+import unittest\n+\n \n class MockBrain:\n     def __init__(self, path="some/path", modified="2002-01-01"):\n@@ -60,9 +62,6 @@ def testNonASCIIPath(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestCacheKey))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestCacheKey))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_classic_portlet.py b/plone/app/portlets/tests/test_classic_portlet.py\nindex cbe01e5a..7e800fe4 100644\n--- a/plone/app/portlets/tests/test_classic_portlet.py\n+++ b/plone/app/portlets/tests/test_classic_portlet.py\n@@ -12,6 +12,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -119,10 +121,7 @@ def testRenderClassicPortlet(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_configuration.py b/plone/app/portlets/tests/test_configuration.py\nindex a064e73b..ea54d8f0 100644\n--- a/plone/app/portlets/tests/test_configuration.py\n+++ b/plone/app/portlets/tests/test_configuration.py\n@@ -2,6 +2,7 @@\n from plone.app.portlets.exportimport.portlets import importPortlets\n from plone.app.portlets.interfaces import IColumn\n from plone.app.portlets.interfaces import IPortletTypeInterface\n+from plone.app.portlets.portlets import base\n from plone.app.portlets.tests.base import PortletsTestCase\n from plone.app.portlets.utils import assignment_mapping_from_key\n from plone.portlets.constants import CONTENT_TYPE_CATEGORY\n@@ -9,6 +10,7 @@\n from plone.portlets.constants import GROUP_CATEGORY\n from plone.portlets.interfaces import ILocalPortletAssignmentManager\n from plone.portlets.interfaces import IPortletAssignmentSettings\n+from plone.portlets.interfaces import IPortletDataProvider\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletRenderer\n from plone.portlets.interfaces import IPortletType\n@@ -17,27 +19,18 @@\n from Products.GenericSetup.context import TarballExportContext\n from Products.GenericSetup.interfaces import IBody\n from Products.GenericSetup.tests.common import DummyImportContext\n+from zope import schema\n from zope.component import getMultiAdapter\n from zope.component import getSiteManager\n from zope.component import getUtility\n from zope.component import queryUtility\n from zope.component.interfaces import IFactory\n from zope.i18nmessageid import Message\n+from zope.interface import implementer\n from zope.interface import Interface\n \n import time\n-\n-\n-# BBB Zope 2.12\n-try:\n-    from OFS import metaconfigure\n-    from Zope2.App import zcml\n-\n-    zcml  # pyflakes\n-    metaconfigure\n-except ImportError:\n-    from Products.Five import fiveconfigure as metaconfigure\n-    from Products.Five import zcml\n+import unittest\n \n \n class DummyView(BrowserView):\n@@ -46,11 +39,6 @@ class DummyView(BrowserView):\n \n # A sample portlet\n \n-from plone.app.portlets.portlets import base\n-from plone.portlets.interfaces import IPortletDataProvider\n-from zope import schema\n-from zope.interface import implementer\n-\n \n class ITestPortlet(IPortletDataProvider):\n     test_text = schema.TextLine(title="Test")\n@@ -63,7 +51,6 @@ class ITestPortlet(IPortletDataProvider):\n \n @implementer(ITestPortlet)\n class TestAssignment(base.Assignment):\n-\n     test_text = None\n     test_bool = None\n     test_tuple = None\n@@ -279,7 +266,7 @@ def testAssignmentRemoval(self):\n             key="/",\n         )\n \n-        # initally there should be no portlet7\n+        # initially there should be no portlet7\n         self.assertEqual(mapping.get("test.portlet7", None), None)\n \n         # now we add one\n@@ -341,7 +328,7 @@ def testAssignmentPurging(self):\n         )\n         self.assertEqual(1, len(mapping))\n \n-        # and be purgable\n+        # and be purgeable\n         context = DummyImportContext(self.portal, purge=False)\n         context._files[\n             "portlets.xml"\n@@ -375,7 +362,7 @@ def testAssignmentPurging(self):\n         )\n         self.assertEqual(2, len(mapping))\n \n-        # and be purgable\n+        # and be purgeable\n         context = DummyImportContext(self.portal, purge=False)\n         context._files[\n             "portlets.xml"\n@@ -425,7 +412,7 @@ def testPurgeMethod(self):\n \n     def testPurge(self):\n         manager = queryUtility(IPortletManager, name="test.testcolumn")\n-        self.assertNotEquals(None, manager)\n+        self.assertNotEqual(None, manager)\n \n         context = DummyImportContext(self.portal, purge=False)\n         context._files[\n@@ -441,7 +428,7 @@ def testPurge(self):\n \n     def testManagerRemove(self):\n         manager = queryUtility(IPortletManager, name="test.testcolumn")\n-        self.assertNotEquals(None, manager)\n+        self.assertNotEqual(None, manager)\n \n         context = DummyImportContext(self.portal, purge=False)\n         context._files[\n@@ -596,10 +583,7 @@ def testExport(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestZCML))\n-    suite.addTest(makeSuite(TestGenericSetup))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestZCML))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestGenericSetup))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_context.py b/plone/app/portlets/tests/test_context.py\nindex c15b08cd..fb66b582 100644\n--- a/plone/app/portlets/tests/test_context.py\n+++ b/plone/app/portlets/tests/test_context.py\n@@ -4,6 +4,8 @@\n from plone.app.testing import TEST_USER_ID\n from plone.portlets.interfaces import IPortletContext\n \n+import unittest\n+\n \n class TestBasicContext(PortletsTestCase):\n     def testParent(self):\n@@ -18,7 +20,6 @@ def testGlobalsNoGroups(self):\n         self.assertEqual(g[1], ("user", TEST_USER_ID))\n \n     def testGlobalsWithSingleGroup(self):\n-\n         group = self.portal.portal_groups.getGroupById("Reviewers")\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n         group.addMember(TEST_USER_ID)\n@@ -32,7 +33,6 @@ def testGlobalsWithSingleGroup(self):\n         self.assertEqual(g[3], ("group", "Reviewers"))\n \n     def testGlobalsWithMultipleGroup(self):\n-\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n         group = self.portal.portal_groups.getGroupById("Reviewers")\n         group.addMember(TEST_USER_ID)\n@@ -70,7 +70,6 @@ def testGlobalsNoGroups(self):\n         self.assertEqual(g[1], ("user", TEST_USER_ID))\n \n     def testGlobalsWithSingleGroup(self):\n-\n         group = self.portal.portal_groups.getGroupById("Reviewers")\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n         group.addMember(TEST_USER_ID)\n@@ -84,7 +83,6 @@ def testGlobalsWithSingleGroup(self):\n         self.assertEqual(g[3], ("group", "Reviewers"))\n \n     def testGlobalsWithMultipleGroup(self):\n-\n         setRoles(self.portal, TEST_USER_ID, ["Manager"])\n         group = self.portal.portal_groups.getGroupById("Reviewers")\n         group.addMember(TEST_USER_ID)\n@@ -110,10 +108,9 @@ def testAnonymous(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestBasicContext))\n-    suite.addTest(makeSuite(TestPortalRootContext))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestBasicContext))\n+    suite.addTest(\n+        unittest.defaultTestLoader.loadTestsFromTestCase(TestPortalRootContext)\n+    )\n     return suite\ndiff --git a/plone/app/portlets/tests/test_dashboard.py b/plone/app/portlets/tests/test_dashboard.py\nindex 0d504f76..40457880 100644\n--- a/plone/app/portlets/tests/test_dashboard.py\n+++ b/plone/app/portlets/tests/test_dashboard.py\n@@ -2,20 +2,17 @@\n from plone.portlets.constants import USER_CATEGORY\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletRetriever\n-from plone.portlets.interfaces import IPortletType\n from Products.PluggableAuthService.events import PrincipalCreated\n from Products.PluggableAuthService.PropertiedUser import PropertiedUser\n-from unittest import makeSuite\n-from unittest import TestSuite\n-from zExceptions import Unauthorized\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n from zope.event import notify\n \n+import unittest\n+\n \n class TestDashboard(PortletsTestCase):\n     def test_default_dashboard_created_for_new_user(self):\n-\n         col = getUtility(IPortletManager, name="plone.dashboard1")\n         user_portlets = col[USER_CATEGORY]\n         self.assertFalse("fakeuser" in user_portlets)\n@@ -46,7 +43,6 @@ def test_non_ascii_usernames_created(self):\n \n \n def test_suite():\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestDashboard))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestDashboard))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_exportimport.py b/plone/app/portlets/tests/test_exportimport.py\nindex 545d53fa..77e27899 100644\n--- a/plone/app/portlets/tests/test_exportimport.py\n+++ b/plone/app/portlets/tests/test_exportimport.py\n@@ -15,6 +15,8 @@\n from zope.component import queryUtility\n from zope.i18nmessageid import Message\n \n+import unittest\n+\n \n class PortletsExportImportTestCase(PortletsTestCase):\n     def afterSetUp(self):\n@@ -248,14 +250,15 @@ def test_extractPortletManagerNode_customClass(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestImportPortlets))\n-    suite.addTest(makeSuite(TestExportPortlets))\n-    suite.addTest(makeSuite(TestImportPortletManagers))\n-    suite.addTest(makeSuite(TestExportPortletManagers))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestImportPortlets))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestExportPortlets))\n+    suite.addTest(\n+        unittest.defaultTestLoader.loadTestsFromTestCase(TestImportPortletManagers)\n+    )\n+    suite.addTest(\n+        unittest.defaultTestLoader.loadTestsFromTestCase(TestExportPortletManagers)\n+    )\n     return suite\n \n \ndiff --git a/plone/app/portlets/tests/test_formextender.py b/plone/app/portlets/tests/test_formextender.py\nindex 51fb7ada..94ce9878 100644\n--- a/plone/app/portlets/tests/test_formextender.py\n+++ b/plone/app/portlets/tests/test_formextender.py\n@@ -20,10 +20,10 @@\n from zope.interface import Interface\n from zope.publisher.interfaces.browser import IDefaultBrowserLayer\n \n-\n-# A sample schemaextender:\n+import unittest\n \n \n+# A sample schemaextender:\n EXTENDER_PREFIX = "portletcssclass"\n \n \n@@ -149,7 +149,6 @@ def test_invoke_add_form(self):\n         self.assertEqual(settings.get("css_class"), "my-class")\n \n     def test_editform_fields(self):\n-\n         schema_field_names = [k for k in field.Fields(news.INewsPortlet).keys()]\n \n         mapping = PortletAssignmentMapping()\n@@ -258,9 +257,6 @@ def test_renderer(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestSchemaExtender))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestSchemaExtender))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_login_portlet.py b/plone/app/portlets/tests/test_login_portlet.py\nindex a3f3f810..5d178225 100644\n--- a/plone/app/portlets/tests/test_login_portlet.py\n+++ b/plone/app/portlets/tests/test_login_portlet.py\n@@ -14,6 +14,8 @@\n from zope.component import getUtility\n from zope.component import queryMultiAdapter\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -140,10 +142,7 @@ def testCanRegister(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_manage_views.py b/plone/app/portlets/tests/test_manage_views.py\nindex c78baf9c..9836eede 100644\n--- a/plone/app/portlets/tests/test_manage_views.py\n+++ b/plone/app/portlets/tests/test_manage_views.py\n@@ -1,5 +1,7 @@\n from plone.app.portlets.tests.base import PortletsTestCase\n \n+import unittest\n+\n \n class TestManageAssignments(PortletsTestCase):\n     def testMoveUp(self):\n@@ -13,10 +15,7 @@ def testDelete(self):\n \n \n def test_suite():\n-    from unittest import TestSuite\n-\n-    # from unittest import makeSuite\n-    suite = TestSuite()\n+    suite = unittest.TestSuite()\n     # TODO: Write tests that *pass*\n-    # suite.addTest(makeSuite(TestManageAssignments))\n+    # suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestManageAssignments))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_mapping.py b/plone/app/portlets/tests/test_mapping.py\nindex b9170971..b1eb279a 100644\n--- a/plone/app/portlets/tests/test_mapping.py\n+++ b/plone/app/portlets/tests/test_mapping.py\n@@ -11,6 +11,8 @@\n from zope.publisher.interfaces import NotFound\n from zope.publisher.interfaces.browser import IBrowserPublisher\n \n+import unittest\n+\n \n class TestNameChooser(PortletsTestCase):\n     def testNameChooser(self):\n@@ -72,11 +74,8 @@ def testTraverseToNonExistent(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestContextMapping))\n-    suite.addTest(makeSuite(TestTraverser))\n-    suite.addTest(makeSuite(TestNameChooser))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestContextMapping))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestTraverser))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestNameChooser))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_namechooser.py b/plone/app/portlets/tests/test_namechooser.py\nindex b8ee6889..a538d0d5 100644\n--- a/plone/app/portlets/tests/test_namechooser.py\n+++ b/plone/app/portlets/tests/test_namechooser.py\n@@ -7,7 +7,6 @@\n \n \n def test_suite():\n-\n     import plone.app.portlets.storage\n \n     return unittest.TestSuite(\ndiff --git a/plone/app/portlets/tests/test_navigation_portlet.py b/plone/app/portlets/tests/test_navigation_portlet.py\nindex 7cfb2345..e917df34 100644\n--- a/plone/app/portlets/tests/test_navigation_portlet.py\n+++ b/plone/app/portlets/tests/test_navigation_portlet.py\n@@ -6,13 +6,13 @@\n from plone.app.portlets.tests.base import PortletsTestCase\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n+from plone.base.interfaces import INavigationSchema\n from plone.portlets.interfaces import IPortletAssignment\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletRenderer\n from plone.portlets.interfaces import IPortletType\n from plone.registry.interfaces import IRegistry\n-from Products.CMFPlone.interfaces import INavigationSchema\n from Products.CMFPlone.tests import dummy\n from Products.GenericSetup.utils import _getDottedName\n from zope.component import getMultiAdapter\n@@ -20,6 +20,8 @@\n from zope.interface import directlyProvides\n from zope.intid.interfaces import IIntIds\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -644,7 +646,7 @@ def testINavigationRootWithRelativeRootSet(self):\n         )\n \n     def testPortletsTitle(self):\n-        """If portlet\'s name is not explicitely specified we show\n+        """If portlet\'s name is not explicitly specified we show\n         default fallback \'Navigation\', translate it and hide it\n         with CSS."""\n         view = self.renderer(self.portal)\n@@ -711,10 +713,7 @@ def testHeadingLinkRootedItemGone(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_news_portlet.py b/plone/app/portlets/tests/test_news_portlet.py\nindex b021f887..4b8c6477 100644\n--- a/plone/app/portlets/tests/test_news_portlet.py\n+++ b/plone/app/portlets/tests/test_news_portlet.py\n@@ -12,6 +12,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -128,10 +130,7 @@ def test_all_news_link(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_recent_portlet.py b/plone/app/portlets/tests/test_recent_portlet.py\nindex 2eba5dd0..6a70eb27 100644\n--- a/plone/app/portlets/tests/test_recent_portlet.py\n+++ b/plone/app/portlets/tests/test_recent_portlet.py\n@@ -12,6 +12,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -121,10 +123,7 @@ def test_title(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_redirects.py b/plone/app/portlets/tests/test_redirects.py\nindex 03105469..ec6446b8 100644\n--- a/plone/app/portlets/tests/test_redirects.py\n+++ b/plone/app/portlets/tests/test_redirects.py\n@@ -4,6 +4,8 @@\n from plone.app.portlets.browser.formhelper import EditForm\n from plone.app.portlets.tests.base import PortletsTestCase\n \n+import unittest\n+\n \n class TestRedirects(PortletsTestCase):\n     _test_methods = [\n@@ -47,9 +49,6 @@ def test_suite():\n     # bin/test -s plone.app.portlets -m test_redirects\n     # But the error *is* in this test_redirects.py file,\n     # because it goes away when I delete this file.\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestRedirects))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRedirects))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_review_portlet.py b/plone/app/portlets/tests/test_review_portlet.py\nindex 53eb64e3..e978fe70 100644\n--- a/plone/app/portlets/tests/test_review_portlet.py\n+++ b/plone/app/portlets/tests/test_review_portlet.py\n@@ -14,6 +14,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestPortlet(PortletsTestCase):\n     def afterSetUp(self):\n@@ -130,10 +132,7 @@ def test_title(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_rss_portlet.py b/plone/app/portlets/tests/test_rss_portlet.py\nindex 1ee123ed..74e73e85 100644\n--- a/plone/app/portlets/tests/test_rss_portlet.py\n+++ b/plone/app/portlets/tests/test_rss_portlet.py\n@@ -140,10 +140,7 @@ def test_rss_feed_http(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestPortlet))\n-    suite.addTest(makeSuite(TestRenderer))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestPortlet))\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRenderer))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_setup.py b/plone/app/portlets/tests/test_setup.py\nindex 4d31bd54..cf35792c 100644\n--- a/plone/app/portlets/tests/test_setup.py\n+++ b/plone/app/portlets/tests/test_setup.py\n@@ -9,6 +9,8 @@\n from zope.component import getUtilitiesFor\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestProductInstall(PortletsTestCase):\n     def testPortletManagersRegistered(self):\n@@ -49,9 +51,6 @@ def testPortletTypesRegistered(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestProductInstall))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestProductInstall))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_traversal.py b/plone/app/portlets/tests/test_traversal.py\nindex c54bfd08..c6ca8b07 100644\n--- a/plone/app/portlets/tests/test_traversal.py\n+++ b/plone/app/portlets/tests/test_traversal.py\n@@ -14,6 +14,8 @@\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestTraversal(PortletsTestCase):\n     def _assertSameObject(self, a, b):\n@@ -52,8 +54,6 @@ def testGroupDashboardNamespace(self):\n         self.assertEqual("++groupdashboard++plone.dashboard1+Reviewers", mapping.id)\n \n     def testGroupDashboardNamespaceChecker(self):\n-        assignment = classic.Assignment()\n-        manager = getUtility(IPortletManager, name="plone.dashboard1")\n         mapping = self.portal.restrictedTraverse(\n             "++groupdashboard++plone.dashboard1+Reviewers"\n         )\n@@ -92,9 +92,6 @@ def testContentTypeNamespace(self):\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestTraversal))\n+    suite = unittest.TestSuite()\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestTraversal))\n     return suite\ndiff --git a/plone/app/portlets/tests/test_utils.py b/plone/app/portlets/tests/test_utils.py\nindex 08f4464a..06957183 100644\n--- a/plone/app/portlets/tests/test_utils.py\n+++ b/plone/app/portlets/tests/test_utils.py\n@@ -5,16 +5,17 @@\n from plone.app.portlets.tests.base import PortletsTestCase\n from plone.app.portlets.utils import assignment_from_key\n from plone.app.testing import TEST_USER_ID\n+from plone.base.utils import safe_text\n from plone.portlets.constants import CONTEXT_CATEGORY\n from plone.portlets.constants import USER_CATEGORY\n from plone.portlets.interfaces import IPortletAssignmentMapping\n from plone.portlets.interfaces import IPortletManager\n-from plone.portlets.interfaces import IPortletRenderer\n from plone.portlets.utils import hashPortletInfo\n-from Products.CMFPlone.utils import safe_unicode\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n+import unittest\n+\n \n class TestAssignmentFromKey(PortletsTestCase):\n     def afterSetUp(self):\n@@ -82,18 +83,15 @@ def testTraversalRendererWithHash(self):\n             )\n         )\n         render_portlet_view = PortletUtilities(context, request)\n-        rendered_portlet = render_portlet_view.render_portlet(\n-            safe_unicode(portlet_hash)\n-        )\n+        rendered_portlet = render_portlet_view.render_portlet(safe_text(portlet_hash))\n         self.assertIn("portletNews", rendered_portlet)\n         self.assertIn("Test News", rendered_portlet)\n \n \n def test_suite():\n-    from unittest import makeSuite\n-    from unittest import TestSuite\n-\n-    suite = TestSuite()\n-    suite.addTest(makeSuite(TestAssignmentFromKey))\n-    suite.addTest(makeSuite(TestRendering))\n+    suite = unittest.TestSuite()\n+    suite.addTest(\n+        unittest.defaultTestLoader.loadTestsFromTestCase(TestAssignmentFromKey)\n+    )\n+    suite.addTest(unittest.defaultTestLoader.loadTestsFromTestCase(TestRendering))\n     return suite\ndiff --git a/plone/app/portlets/utils.py b/plone/app/portlets/utils.py\nindex db69975a..db641f23 100644\n--- a/plone/app/portlets/utils.py\n+++ b/plone/app/portlets/utils.py\n@@ -1,7 +1,6 @@\n from Acquisition import aq_base\n from plone.app.event.portlets import portlet_calendar as calendar\n from plone.app.event.portlets import portlet_events as events\n-from plone.app.portlets import HAS_PLONE_APP_EVENT\n from plone.app.portlets.interfaces import IPortletPermissionChecker\n from plone.app.portlets.portlets import classic\n from plone.app.portlets.portlets import login\n@@ -81,8 +80,6 @@ def convert_legacy_portlets(context):\n         "portlet_recent": recent.Assignment(count=5),\n         "portlet_related": DONT_MIGRATE,\n         "portlet_languages": DONT_MIGRATE,\n-        "portlet_calendar": DONT_MIGRATE,\n-        "portlet_events": DONT_MIGRATE,\n         "portlet_calendar": calendar.Assignment(),\n         "portlet_events": events.Assignment(count=5),\n     }\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615de..375029bf 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,45 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\n+ignore-packages = [\'Products.CMFPlone\']\n+ExtensionClass = [\'ComputedAttribute\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 908a1d62..0da8f8fb 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,9 +1,23 @@\n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n-\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n+\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/setup.py b/setup.py\nindex 5dc9a200..28fa2b12 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -36,42 +36,42 @@\n     python_requires=">=3.8",\n     extras_require=dict(\n         test=[\n+            "five.intid",\n             "plone.app.testing",\n+            "plone.namedfile",\n+            "plone.testing",\n+            "plone.z3cform",\n+            "zope.intid",\n         ],\n     ),\n     install_requires=[\n         "setuptools",\n+        "plone.base",\n+        "Zope",\n+        "BTrees",\n+        "ExtensionClass",\n+        "feedparser",\n         "five.customerize",\n+        "plone.app.event",\n+        "plone.app.i18n",\n+        "plone.app.layout",\n+        "plone.app.uuid",\n+        "plone.app.vocabularies",\n+        "plone.app.z3cform",\n         "plone.autoform",\n         "plone.i18n",\n         "plone.memoize",\n-        "plone.portlets>=1.1",\n-        "plone.app.i18n",\n-        "plone.app.vocabularies >= 2.1.15",\n-        "plone.app.z3cform",\n-        "transaction",\n+        "plone.portlets",\n+        "plone.protect",\n+        "plone.registry",\n+        "Products.GenericSetup",\n+        "Products.MimetypesRegistry",\n+        "Products.PluggableAuthService",\n+        "Products.PythonScripts",\n+        "Products.statusmessages",\n+        "z3c.form",\n         "zope.annotation",\n         "zope.browser",\n-        "zope.component",\n-        "zope.configuration",\n-        "zope.container",\n         "zope.contentprovider",\n-        "zope.event",\n-        "zope.i18nmessageid",\n-        "zope.interface",\n-        "zope.lifecycleevent",\n-        "zope.publisher",\n-        "zope.schema",\n-        "zope.site",\n-        "zope.traversing",\n-        "Products.CMFCore",\n-        "Products.CMFDynamicViewFTI",\n-        "Products.GenericSetup >= 2.0",\n-        "Products.PluggableAuthService",\n-        "ZODB",\n-        "Acquisition",\n-        "DateTime",\n-        "Zope >= 5",\n-        "feedparser",\n     ],\n )\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 00000000..724a36cf\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,53 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --test-path={toxinidir} -s plone.app.portlets {posargs}\n+extras =\n+    test\n'

