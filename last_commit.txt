Repository: plone.app.robotframework


Branch: refs/heads/master
Date: 2018-10-03T17:49:54+02:00
Author: Joni Orponen (Rotonen) <joni.orponen@gmail.com>
Commit: https://github.com/plone/plone.app.robotframework/commit/b8d9344f8d9ef1d871205b55b72641b79eda108d

Default to picking a free port.

Files changed:
M CHANGES.rst
M src/plone/app/robotframework/variables.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex e9c7e2a..95b80bf 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -6,6 +6,10 @@ Changelog\n \n Breaking changes:\n \n+- Default to the new plone.testing default of picking the ZServer port\n+  dynamically.\n+  [Rotonen]\n+\n - Remove compatibility code for Plone 4.x.\n   [hvelarde]\n \ndiff --git a/src/plone/app/robotframework/variables.py b/src/plone/app/robotframework/variables.py\nindex 3345465..e28fa8b 100644\n--- a/src/plone/app/robotframework/variables.py\n+++ b/src/plone/app/robotframework/variables.py\n@@ -1,23 +1,12 @@\n+from plone.testing.z2 import ZSERVER_FIXTURE\n import os\n import pkg_resources\n \n-try:\n-    from plone.testing.z2 import DEFAULT_ZSERVER_PORT\n-except ImportError:\n-    # DEFAULT_ZSERVER_PORT is not defined until plone.testing == 4.0.8\n-    DEFAULT_ZSERVER_PORT = 55001\n-\n-# plone.testing checks environment to allow overriding DEFAULT_ZSERVER_PORT\n-ZSERVER_PORT = os.environ.get('ZSERVER_PORT', DEFAULT_ZSERVER_PORT)\n-\n-# Allow specifying HOST and PORT through environment variables for instance,\n-# if tests should go through a proxy\n-ZOPE_HOST = os.environ.get('ZOPE_HOST', 'localhost')\n-ZOPE_PORT = os.environ.get('ZOPE_PORT', ZSERVER_PORT)\n+ZOPE_HOST = ZSERVER_FIXTURE.host\n+ZOPE_PORT = ZSERVER_FIXTURE.port\n \n CMFPLONE_VERSION = pkg_resources.get_distribution('Products.CMFPlone').version\n if CMFPLONE_VERSION.startswith('4.'):\n     CMFPLONE_SELECTORS = 'selectors/cmfplone43.robot'\n elif CMFPLONE_VERSION.startswith('5.'):\n     CMFPLONE_SELECTORS = 'selectors/cmfplone50.robot'\n-\n"

Repository: plone.app.robotframework


Branch: refs/heads/master
Date: 2018-10-04T00:21:00+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.robotframework/commit/788a1bf1e1badc43a472ed0eabcd98c8c97161f7

Merge pull request #86 from plone/jo-85

Default to picking a free port

Files changed:
M CHANGES.rst
M src/plone/app/robotframework/variables.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex ee9fb02..42a9551 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -22,6 +22,10 @@ Bug fixes:\n \n Breaking changes:\n \n+- Default to the new plone.testing default of picking the ZServer port\n+  dynamically.\n+  [Rotonen]\n+\n - Remove compatibility code for Plone 4.x.\n   [hvelarde]\n \ndiff --git a/src/plone/app/robotframework/variables.py b/src/plone/app/robotframework/variables.py\nindex 3345465..e28fa8b 100644\n--- a/src/plone/app/robotframework/variables.py\n+++ b/src/plone/app/robotframework/variables.py\n@@ -1,23 +1,12 @@\n+from plone.testing.z2 import ZSERVER_FIXTURE\n import os\n import pkg_resources\n \n-try:\n-    from plone.testing.z2 import DEFAULT_ZSERVER_PORT\n-except ImportError:\n-    # DEFAULT_ZSERVER_PORT is not defined until plone.testing == 4.0.8\n-    DEFAULT_ZSERVER_PORT = 55001\n-\n-# plone.testing checks environment to allow overriding DEFAULT_ZSERVER_PORT\n-ZSERVER_PORT = os.environ.get('ZSERVER_PORT', DEFAULT_ZSERVER_PORT)\n-\n-# Allow specifying HOST and PORT through environment variables for instance,\n-# if tests should go through a proxy\n-ZOPE_HOST = os.environ.get('ZOPE_HOST', 'localhost')\n-ZOPE_PORT = os.environ.get('ZOPE_PORT', ZSERVER_PORT)\n+ZOPE_HOST = ZSERVER_FIXTURE.host\n+ZOPE_PORT = ZSERVER_FIXTURE.port\n \n CMFPLONE_VERSION = pkg_resources.get_distribution('Products.CMFPlone').version\n if CMFPLONE_VERSION.startswith('4.'):\n     CMFPLONE_SELECTORS = 'selectors/cmfplone43.robot'\n elif CMFPLONE_VERSION.startswith('5.'):\n     CMFPLONE_SELECTORS = 'selectors/cmfplone50.robot'\n-\n"

