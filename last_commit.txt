Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-08-10T14:19:17+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/f61ef95e9485c5bb59ca7f38fd3b6a3e29543ee7

Robot tests: be more specific when clicking some elements.

Files changed:
A news/3582.bugfix
M Products/CMFPlone/tests/robot/test_linkintegrity.robot
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex db3f9d888f..6966425d5d 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -93,7 +93,7 @@ a link in rich text\n should show warning when deleting page\n \n   Go To  ${PLONE_URL}/foo\n-  Wait For Then Click Element  css=#plone-contentmenu-actions a\n+  Wait For Then Click Element  css=#plone-contentmenu-actions > a\n   Wait For Then Click Element  css=#plone-contentmenu-actions-delete\n   Wait until page contains element  css=.breach-container .breach-item\n \n@@ -113,7 +113,6 @@ should show warning when deleting page from folder_contents\n \n should not show warning when deleting page from folder_contents\n   Go To  ${PLONE_URL}/folder_contents\n-  Wait until page contains element  css=tr[data-id="foo"] input\n   Wait For Then Click Element  css=tr[data-id="foo"] input\n   Checkbox Should Be Selected  css=tr[data-id="foo"] input\n   Wait until keyword succeeds  30  1  Page should not contain element  css=#btn-delete.disabled\n@@ -127,7 +126,7 @@ should not show warning when deleting page from folder_contents\n \n should not show warning when deleting page\n   Go To  ${PLONE_URL}/foo\n-  Wait For Then Click Element  css=#plone-contentmenu-actions a\n+  Wait For Then Click Element  css=#plone-contentmenu-actions > a\n   Wait For Then Click Element  css=#plone-contentmenu-actions-delete\n   Page should not contain element  css=.breach-container .breach-item\n \ndiff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex 989187671c..5a5e66fbf7 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -271,18 +271,20 @@ I open the Selection Widget\n \n I delete one selection\n     #deletes one element\n-    Wait For Then Click Element  css=a.select2-search-choice-close\n+    Wait For Then Click Element  jquery=a.select2-search-choice-close:visible\n \n I delete my selection\n     #deletes two elements\n-    Wait For Then Click Element  css=a.select2-search-choice-close\n+    Wait For Then Click Element  jquery=a.select2-search-choice-close:visible:first\n     Sleep  0.1\n-    Wait For Then Click Element  css=a.select2-search-choice-close\n+    Wait For Then Click Element  jquery=a.select2-search-choice-close:visible\n \n I search in ${NAME} subfolder in the related items widget\n     mark results\n-    Wait For Then Click Element  css=ul.select2-choices\n+    Wait For Then Click Element  jquery=.pat-relateditems-container ul.select2-choices:visible\n     Wait Until Page Contains  ${NAME}\n+    # I have seen this fail sometimes, where the screen shot showed the NAME just fine.\n+    Sleep  0.1\n     Click Element  //a[contains(concat(\' \', normalize-space(@class), \' \'), \' pat-relateditems-result-select \')]//span[contains(text(),\'${NAME}\')]\n \n I expect to be in Advanced mode\n@@ -309,7 +311,7 @@ I expect to be in Simple mode\n \n open the select box titled ${NAME}\n     Click Element  css=body\n-    Wait For Then Click Element  css=.querystring-criteria-${NAME} .select2-container\n+    Wait For Then Click Element  jquery=.querystring-criteria-${NAME} .select2-container:first\n \n select index type ${INDEX}\n     ${input_selector}  Set Variable  .select2-drop-active[style*="display: block;"] input\ndiff --git a/news/3582.bugfix b/news/3582.bugfix\nnew file mode 100644\nindex 0000000000..805f4bdb48\n--- /dev/null\n+++ b/news/3582.bugfix\n@@ -0,0 +1,2 @@\n+Robot tests: be more specific when clicking some elements.\n+[maurits]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-08-10T14:19:17+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/27cb098cee70beb4202c67a9b7c79e55c00802dd

Overlay tests: use Wait For Then Click Element.

Might fix an unexpected open overlay.

Files changed:
M Products/CMFPlone/tests/robot/test_overlays.robot

b"diff --git a/Products/CMFPlone/tests/robot/test_overlays.robot b/Products/CMFPlone/tests/robot/test_overlays.robot\nindex deee0bdd98..83070070fc 100644\n--- a/Products/CMFPlone/tests/robot/test_overlays.robot\n+++ b/Products/CMFPlone/tests/robot/test_overlays.robot\n@@ -260,13 +260,13 @@ I '${action}' the form\n I enter wrong credentials\n     Input text  __ac_name  wrong\n     Input text  __ac_password  user\n-    Click Button  css=div.modal-footer button\n+    Wait For Then Click Element  css=div.modal-footer button\n \n I enter valid credentials\n     Wait until page contains element  name=__ac_name\n     Input text for sure  __ac_name  ${SITE_OWNER_NAME}\n     Input text for sure  __ac_password  ${SITE_OWNER_PASSWORD}\n-    Click Button  css=div.modal-footer button\n+    Wait For Then Click Element  css=div.modal-footer button\n \n I enter valid user data\n     Wait until page contains element  name=form.widgets.password_ctl\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-08-10T14:19:17+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/81176c8873ab39138dc0e8e0892fa3b1248e8253

Robot tests: Input RichText: sleep before and after setting input.

I saw an error indicating that the text was not saved.

Files changed:
M Products/CMFPlone/tests/robot/test_controlpanel_filter.robot

b"diff --git a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\nindex 0bad48857c..23bbae6394 100644\n--- a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n+++ b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n@@ -76,6 +76,7 @@ Input RichText\n   # See https://robotframework.org/robotframework/2.6.1/libraries/BuiltIn.html#Wait%20Until%20Keyword%20Succeeds\n   Sleep  1\n   Wait until keyword succeeds  5s  1s  Execute Javascript  tinyMCE.activeEditor.setContent('${input}');\n+  Sleep  1\n \n \n # --- WHEN -------------------------------------------------------------------\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-08-10T14:19:17+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/4883a10cf94ed7ab9c1658900623f9dccb748cc7

add a check if ``tinymce.setContent`` has set the content

Files changed:
M Products/CMFPlone/tests/robot/test_controlpanel_filter.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\nindex 23bbae6394..bcdf3307aa 100644\n--- a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n+++ b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n@@ -75,8 +75,15 @@ Input RichText\n   # or fatal exceptions are not caught by this keyword."\n   # See https://robotframework.org/robotframework/2.6.1/libraries/BuiltIn.html#Wait%20Until%20Keyword%20Succeeds\n   Sleep  1\n-  Wait until keyword succeeds  5s  1s  Execute Javascript  tinyMCE.activeEditor.setContent(\'${input}\');\n-  Sleep  1\n+  Wait until keyword succeeds  5s  1s  Set and Check TinyMCE Content  ${input}\n+\n+Set and Check TinyMCE Content\n+  [Arguments]  ${input}\n+  # Simply check if tinyMCE.getContent() isn\'t empty when we set an input\n+  Execute Javascript   tinyMCE.activeEditor.setContent(\'${input}\');\n+  Sleep  0.5\n+  ${check}=  Execute Javascript  return tinyMCE.activeEditor.getContent();\n+  Should not be empty  ${check}\n \n \n # --- WHEN -------------------------------------------------------------------\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-08-10T14:19:17+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/cae0d35be38d7480a83497fddab5bac5acfc6381

Robot tests: move 'folder contents pattern loaded' to keywords.robot.

It is needed in both the folder contents and the link integrity checks.
The link integrity checks sometimes had a failure like this:

- Wait until the `css=tr[data-id="foo"] input` is on the page.
- Click this element.
- Error: stale reference.

In between the first and second steps, apparently the folder contents were reinitialized or something.

Files changed:
M Products/CMFPlone/tests/robot/keywords.robot
M Products/CMFPlone/tests/robot/test_folder_contents.robot
M Products/CMFPlone/tests/robot/test_linkintegrity.robot

b'diff --git a/Products/CMFPlone/tests/robot/keywords.robot b/Products/CMFPlone/tests/robot/keywords.robot\nindex 75765ffc38..ca0c598c4b 100644\n--- a/Products/CMFPlone/tests/robot/keywords.robot\n+++ b/Products/CMFPlone/tests/robot/keywords.robot\n@@ -33,3 +33,7 @@ patterns are loaded\n a folder with a document \'${title}\'\n   ${folder_uid}=  Create content  type=Folder  title=folder\n   Create content  type=Document  container=${folder_uid}  title=${title}\n+\n+folder contents pattern loaded\n+    Page should contain element  css=.pat-structure\n+    Wait For Condition  return !!document.querySelector(\'.pat-structure div.navbar\')\ndiff --git a/Products/CMFPlone/tests/robot/test_folder_contents.robot b/Products/CMFPlone/tests/robot/test_folder_contents.robot\nindex 054d5f1c28..98cee696e9 100644\n--- a/Products/CMFPlone/tests/robot/test_folder_contents.robot\n+++ b/Products/CMFPlone/tests/robot/test_folder_contents.robot\n@@ -53,7 +53,6 @@ a folder with four pages\n \n the folder contents view\n     Go to  ${PLONE_URL}/my-folder/folder_contents\n-    Page should contain element  css=.pat-structure\n     Given folder contents pattern loaded\n \n I click the \'${link_name}\' link\n@@ -107,6 +106,3 @@ Should be above\n     ${locator1-position} =  Get vertical position  ${locator1}\n     ${locator2-position} =  Get vertical position  ${locator2}\n     Should be true  ${locator1-position} < ${locator2-position}\n-\n-folder contents pattern loaded\n-    Wait For Condition  return !!document.querySelector(\'.pat-structure div.navbar\')\ndiff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex 6966425d5d..b798d6a824 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -100,6 +100,7 @@ should show warning when deleting page\n \n should show warning when deleting page from folder_contents\n   Go To  ${PLONE_URL}/folder_contents\n+  Given folder contents pattern loaded\n   Wait For Then Click Element  css=tr[data-id="foo"] input\n   Checkbox Should Be Selected  css=tr[data-id="foo"] input\n   Wait until keyword succeeds  30  1  Page should not contain element  css=#btn-delete.disabled\n@@ -113,6 +114,7 @@ should show warning when deleting page from folder_contents\n \n should not show warning when deleting page from folder_contents\n   Go To  ${PLONE_URL}/folder_contents\n+  Given folder contents pattern loaded\n   Wait For Then Click Element  css=tr[data-id="foo"] input\n   Checkbox Should Be Selected  css=tr[data-id="foo"] input\n   Wait until keyword succeeds  30  1  Page should not contain element  css=#btn-delete.disabled\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-08-10T15:49:27+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/4f645713e0a6d51c500679554eb70d0541eb1a54

Merge pull request #3590 from plone/maurits-robot-tests-august-2022

Robot tests: be more specific when clicking some elements.

Files changed:
A news/3582.bugfix
M Products/CMFPlone/tests/robot/keywords.robot
M Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
M Products/CMFPlone/tests/robot/test_folder_contents.robot
M Products/CMFPlone/tests/robot/test_linkintegrity.robot
M Products/CMFPlone/tests/robot/test_overlays.robot
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/keywords.robot b/Products/CMFPlone/tests/robot/keywords.robot\nindex 75765ffc38..ca0c598c4b 100644\n--- a/Products/CMFPlone/tests/robot/keywords.robot\n+++ b/Products/CMFPlone/tests/robot/keywords.robot\n@@ -33,3 +33,7 @@ patterns are loaded\n a folder with a document \'${title}\'\n   ${folder_uid}=  Create content  type=Folder  title=folder\n   Create content  type=Document  container=${folder_uid}  title=${title}\n+\n+folder contents pattern loaded\n+    Page should contain element  css=.pat-structure\n+    Wait For Condition  return !!document.querySelector(\'.pat-structure div.navbar\')\ndiff --git a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\nindex 0bad48857c..bcdf3307aa 100644\n--- a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n+++ b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n@@ -75,7 +75,15 @@ Input RichText\n   # or fatal exceptions are not caught by this keyword."\n   # See https://robotframework.org/robotframework/2.6.1/libraries/BuiltIn.html#Wait%20Until%20Keyword%20Succeeds\n   Sleep  1\n-  Wait until keyword succeeds  5s  1s  Execute Javascript  tinyMCE.activeEditor.setContent(\'${input}\');\n+  Wait until keyword succeeds  5s  1s  Set and Check TinyMCE Content  ${input}\n+\n+Set and Check TinyMCE Content\n+  [Arguments]  ${input}\n+  # Simply check if tinyMCE.getContent() isn\'t empty when we set an input\n+  Execute Javascript   tinyMCE.activeEditor.setContent(\'${input}\');\n+  Sleep  0.5\n+  ${check}=  Execute Javascript  return tinyMCE.activeEditor.getContent();\n+  Should not be empty  ${check}\n \n \n # --- WHEN -------------------------------------------------------------------\ndiff --git a/Products/CMFPlone/tests/robot/test_folder_contents.robot b/Products/CMFPlone/tests/robot/test_folder_contents.robot\nindex 054d5f1c28..98cee696e9 100644\n--- a/Products/CMFPlone/tests/robot/test_folder_contents.robot\n+++ b/Products/CMFPlone/tests/robot/test_folder_contents.robot\n@@ -53,7 +53,6 @@ a folder with four pages\n \n the folder contents view\n     Go to  ${PLONE_URL}/my-folder/folder_contents\n-    Page should contain element  css=.pat-structure\n     Given folder contents pattern loaded\n \n I click the \'${link_name}\' link\n@@ -107,6 +106,3 @@ Should be above\n     ${locator1-position} =  Get vertical position  ${locator1}\n     ${locator2-position} =  Get vertical position  ${locator2}\n     Should be true  ${locator1-position} < ${locator2-position}\n-\n-folder contents pattern loaded\n-    Wait For Condition  return !!document.querySelector(\'.pat-structure div.navbar\')\ndiff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex db3f9d888f..b798d6a824 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -93,13 +93,14 @@ a link in rich text\n should show warning when deleting page\n \n   Go To  ${PLONE_URL}/foo\n-  Wait For Then Click Element  css=#plone-contentmenu-actions a\n+  Wait For Then Click Element  css=#plone-contentmenu-actions > a\n   Wait For Then Click Element  css=#plone-contentmenu-actions-delete\n   Wait until page contains element  css=.breach-container .breach-item\n \n \n should show warning when deleting page from folder_contents\n   Go To  ${PLONE_URL}/folder_contents\n+  Given folder contents pattern loaded\n   Wait For Then Click Element  css=tr[data-id="foo"] input\n   Checkbox Should Be Selected  css=tr[data-id="foo"] input\n   Wait until keyword succeeds  30  1  Page should not contain element  css=#btn-delete.disabled\n@@ -113,7 +114,7 @@ should show warning when deleting page from folder_contents\n \n should not show warning when deleting page from folder_contents\n   Go To  ${PLONE_URL}/folder_contents\n-  Wait until page contains element  css=tr[data-id="foo"] input\n+  Given folder contents pattern loaded\n   Wait For Then Click Element  css=tr[data-id="foo"] input\n   Checkbox Should Be Selected  css=tr[data-id="foo"] input\n   Wait until keyword succeeds  30  1  Page should not contain element  css=#btn-delete.disabled\n@@ -127,7 +128,7 @@ should not show warning when deleting page from folder_contents\n \n should not show warning when deleting page\n   Go To  ${PLONE_URL}/foo\n-  Wait For Then Click Element  css=#plone-contentmenu-actions a\n+  Wait For Then Click Element  css=#plone-contentmenu-actions > a\n   Wait For Then Click Element  css=#plone-contentmenu-actions-delete\n   Page should not contain element  css=.breach-container .breach-item\n \ndiff --git a/Products/CMFPlone/tests/robot/test_overlays.robot b/Products/CMFPlone/tests/robot/test_overlays.robot\nindex deee0bdd98..83070070fc 100644\n--- a/Products/CMFPlone/tests/robot/test_overlays.robot\n+++ b/Products/CMFPlone/tests/robot/test_overlays.robot\n@@ -260,13 +260,13 @@ I \'${action}\' the form\n I enter wrong credentials\n     Input text  __ac_name  wrong\n     Input text  __ac_password  user\n-    Click Button  css=div.modal-footer button\n+    Wait For Then Click Element  css=div.modal-footer button\n \n I enter valid credentials\n     Wait until page contains element  name=__ac_name\n     Input text for sure  __ac_name  ${SITE_OWNER_NAME}\n     Input text for sure  __ac_password  ${SITE_OWNER_PASSWORD}\n-    Click Button  css=div.modal-footer button\n+    Wait For Then Click Element  css=div.modal-footer button\n \n I enter valid user data\n     Wait until page contains element  name=form.widgets.password_ctl\ndiff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex 989187671c..5a5e66fbf7 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -271,18 +271,20 @@ I open the Selection Widget\n \n I delete one selection\n     #deletes one element\n-    Wait For Then Click Element  css=a.select2-search-choice-close\n+    Wait For Then Click Element  jquery=a.select2-search-choice-close:visible\n \n I delete my selection\n     #deletes two elements\n-    Wait For Then Click Element  css=a.select2-search-choice-close\n+    Wait For Then Click Element  jquery=a.select2-search-choice-close:visible:first\n     Sleep  0.1\n-    Wait For Then Click Element  css=a.select2-search-choice-close\n+    Wait For Then Click Element  jquery=a.select2-search-choice-close:visible\n \n I search in ${NAME} subfolder in the related items widget\n     mark results\n-    Wait For Then Click Element  css=ul.select2-choices\n+    Wait For Then Click Element  jquery=.pat-relateditems-container ul.select2-choices:visible\n     Wait Until Page Contains  ${NAME}\n+    # I have seen this fail sometimes, where the screen shot showed the NAME just fine.\n+    Sleep  0.1\n     Click Element  //a[contains(concat(\' \', normalize-space(@class), \' \'), \' pat-relateditems-result-select \')]//span[contains(text(),\'${NAME}\')]\n \n I expect to be in Advanced mode\n@@ -309,7 +311,7 @@ I expect to be in Simple mode\n \n open the select box titled ${NAME}\n     Click Element  css=body\n-    Wait For Then Click Element  css=.querystring-criteria-${NAME} .select2-container\n+    Wait For Then Click Element  jquery=.querystring-criteria-${NAME} .select2-container:first\n \n select index type ${INDEX}\n     ${input_selector}  Set Variable  .select2-drop-active[style*="display: block;"] input\ndiff --git a/news/3582.bugfix b/news/3582.bugfix\nnew file mode 100644\nindex 0000000000..805f4bdb48\n--- /dev/null\n+++ b/news/3582.bugfix\n@@ -0,0 +1,2 @@\n+Robot tests: be more specific when clicking some elements.\n+[maurits]\n'

