Repository: plone.base


Branch: refs/heads/main
Date: 2022-04-19T17:26:42+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/19a3efc539768c1b50774795b8fe82fff5d458f3

Add image srcset definition and json schema

Files changed:
A news/5.feature
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/news/5.feature b/news/5.feature\nnew file mode 100644\nindex 0000000..86f07cb\n--- /dev/null\n+++ b/news/5.feature\n@@ -0,0 +1 @@\n+Add Add image srcset\'s configuration including JSON schema definition to imaging-controlpanel [MrTango]\n\\ No newline at end of file\ndiff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 18d9a0a..afe62ed 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,7 +1,8 @@\n from .basetool import IPloneBaseTool\n+from plone import schema\n+from plone.autoform import directives\n from plone.base import PloneMessageFactory as _\n from Products.CMFCore.utils import getToolByName\n-from zope import schema\n from zope.component.hooks import getSite\n from zope.interface import Attribute\n from zope.interface import implementer\n@@ -57,6 +58,45 @@ def dump_json_to_text(obj):\n Disallow: /*view$\n """\n \n+IMAGE_SRCSET_SCHEMA = json.dumps(\n+    {\n+        "title": "Image srcset defintion",\n+        "type": "object",\n+        "additionalProperties": { "$ref": "#/$defs/srcset" },\n+        "$defs": {\n+            "srcset": {\n+                "type": "object",\n+                "properties": {\n+                    "title": {\n+                        "type": "string",\n+                    },\n+                    "preview": {\n+                        "type": "string",\n+                    },\n+                    "sourceset": {\n+                        "type": "array",\n+                        "items": {\n+                            "type": "object",\n+                            "properties": {\n+                                "scale": {\n+                                    "type": "string",\n+                                },\n+                                "media": {\n+                                    "type": "string",\n+                                },\n+                            },\n+                            "additionalProperties": False,\n+                            "required": ["scale"],\n+                        },\n+                    },\n+                },\n+                "additionalProperties": False,\n+                "required": ["title", "sourceset"],\n+            },\n+        },\n+    }\n+)\n+\n \n def validate_json(value):\n     try:\n@@ -1745,6 +1785,43 @@ class IImagingSchema(Interface):\n         default=51,\n     )\n \n+    image_srcsets = schema.JSONField(\n+        title=_("Image srcset\'s"),\n+        description=_(\n+            "Enter a JSON-formatted image srcset configuration. "\n+        ),\n+        schema=IMAGE_SRCSET_SCHEMA,\n+        default={\n+                "large": {\n+                    "title": "Large",\n+                    "preview": "++theme++barceloneta/static/preview-image-large.png",\n+                    "sourceset": [\n+                        {"scale": "teaser", "media": "(min-width:768px) and (orientation:portrait)"},\n+                        {"scale": "large", "media": "(min-width:768px)"},\n+                        {"scale": "larger", "media": "(min-width:992px)"},\n+                        {"scale": "great", "media": "(min-width:1200px)"},\n+                        {"scale": "huge", "media": "(min-width:1400px)"},\n+                        {"scale": "huge"},\n+                    ],\n+                },\n+                "medium": {\n+                    "title": "Medium",\n+                    "preview": "++theme++barceloneta/static/preview-image-medium.png",\n+                    "sourceset": [\n+                        {"scale": "larger"},\n+                    ],\n+                },\n+                "small": {\n+                    "title": "Small",\n+                    "preview": "++theme++barceloneta/static/preview-image-small.png",\n+                    "sourceset": [\n+                        {"scale": "preview"},\n+                    ],\n+                },\n+        },\n+        required=True,\n+    )\n+\n     image_captioning = schema.Bool(\n         title=_("image_captioning_title", "Enable image captioning"),\n         description=_(\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-04-19T17:28:00+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/2799df34d94703fe0223deccf9837efbff49c300

Allow picture tag and loading attributes in HTMLFilter

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex afe62ed..87e3572 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,5 +1,6 @@\n from .basetool import IPloneBaseTool\n from plone import schema\n+from zope.schema import ValidationError\n from plone.autoform import directives\n from plone.base import PloneMessageFactory as _\n from Products.CMFCore.utils import getToolByName\n@@ -103,7 +104,7 @@ def validate_json(value):\n         json.loads(value)\n     except ValueError as exc:\n \n-        class JSONError(schema.ValidationError):\n+        class JSONError(ValidationError):\n             __doc__ = _(\n                 "Must be empty or a valid JSON-formatted "\n                 "configuration \xe2\x80\x93 ${message}.",\n@@ -328,6 +329,7 @@ class IFilterSchema(Interface):\n             "output",\n             "p",\n             "pre",\n+            "picture",\n             "progress",\n             "q",\n             "rp",\n@@ -364,7 +366,7 @@ class IFilterSchema(Interface):\n     custom_attributes = schema.List(\n         title=_("Custom attributes"),\n         description=_("These attributes are additionally allowed."),\n-        default=["style", "controls", "poster", "autoplay"],\n+        default=["style", "controls", "poster", "autoplay", "loading"],\n         value_type=schema.TextLine(),\n         missing_value=[],\n         required=False,\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-04-19T19:13:23+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/b4ba912697e6b5022df7b646e27d395bdc7d044e

Add hideInEditor property in IMAGE_SRCSET_SCHEMA

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 87e3572..8aeda06 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,3 +1,4 @@\n+from xmlrpc.client import boolean\n from .basetool import IPloneBaseTool\n from plone import schema\n from zope.schema import ValidationError\n@@ -74,6 +75,9 @@ def dump_json_to_text(obj):\n                     "preview": {\n                         "type": "string",\n                     },\n+                    "hideInEditor": {\n+                        "type": "boolean",\n+                    },\n                     "sourceset": {\n                         "type": "array",\n                         "items": {\n@@ -1798,8 +1802,8 @@ class IImagingSchema(Interface):\n                     "title": "Large",\n                     "preview": "++theme++barceloneta/static/preview-image-large.png",\n                     "sourceset": [\n-                        {"scale": "teaser", "media": "(min-width:768px) and (orientation:portrait)"},\n-                        {"scale": "large", "media": "(min-width:768px)"},\n+                        {"scale": "teaser", "media": "(max-width:768px) and (orientation:portrait)"},\n+                        {"scale": "large", "media": "(max-width:768px)"},\n                         {"scale": "larger", "media": "(min-width:992px)"},\n                         {"scale": "great", "media": "(min-width:1200px)"},\n                         {"scale": "huge", "media": "(min-width:1400px)"},\n@@ -1810,6 +1814,7 @@ class IImagingSchema(Interface):\n                     "title": "Medium",\n                     "preview": "++theme++barceloneta/static/preview-image-medium.png",\n                     "sourceset": [\n+                        {"scale": "large", "media": "(max-width:768px)"},\n                         {"scale": "larger"},\n                     ],\n                 },\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-04-20T14:43:16+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.base/commit/f1cfd24cf59d0d9d94a33c699ca2ec22b5cac3c6

Allow srcset attribute in HTMLFilter.

Sorted the attributes alphabetically.

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 8aeda06..cbd38ce 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -370,7 +370,14 @@ class IFilterSchema(Interface):\n     custom_attributes = schema.List(\n         title=_("Custom attributes"),\n         description=_("These attributes are additionally allowed."),\n-        default=["style", "controls", "poster", "autoplay", "loading"],\n+        default=[\n+            "autoplay",\n+            "controls",\n+            "loading",\n+            "poster",\n+            "srcset",\n+            "style",\n+        ],\n         value_type=schema.TextLine(),\n         missing_value=[],\n         required=False,\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-04-22T15:20:30+03:00
Author: Maik Derstappen (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/566b2b0151b526839e12ea3acbb8c9dae53737a5

Update src/plone/base/interfaces/controlpanel.py

Co-authored-by: Alessandro Pisa &lt;alessandro.pisa@gmail.com&gt;

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex cbd38ce..608911b 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,4 +1,3 @@\n-from xmlrpc.client import boolean\n from .basetool import IPloneBaseTool\n from plone import schema\n from zope.schema import ValidationError\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-04-25T20:17:46+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/552be4fb402c63e232e93e4893d7dbc86fec54c3

move IMAGE_SRCSET_SCHEMA into inteface defintion and simplify defaults

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 608911b..61e7436 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -59,48 +59,6 @@ def dump_json_to_text(obj):\n Disallow: /*view$\n """\n \n-IMAGE_SRCSET_SCHEMA = json.dumps(\n-    {\n-        "title": "Image srcset defintion",\n-        "type": "object",\n-        "additionalProperties": { "$ref": "#/$defs/srcset" },\n-        "$defs": {\n-            "srcset": {\n-                "type": "object",\n-                "properties": {\n-                    "title": {\n-                        "type": "string",\n-                    },\n-                    "preview": {\n-                        "type": "string",\n-                    },\n-                    "hideInEditor": {\n-                        "type": "boolean",\n-                    },\n-                    "sourceset": {\n-                        "type": "array",\n-                        "items": {\n-                            "type": "object",\n-                            "properties": {\n-                                "scale": {\n-                                    "type": "string",\n-                                },\n-                                "media": {\n-                                    "type": "string",\n-                                },\n-                            },\n-                            "additionalProperties": False,\n-                            "required": ["scale"],\n-                        },\n-                    },\n-                },\n-                "additionalProperties": False,\n-                "required": ["title", "sourceset"],\n-            },\n-        },\n-    }\n-)\n-\n \n def validate_json(value):\n     try:\n@@ -369,14 +327,7 @@ class IFilterSchema(Interface):\n     custom_attributes = schema.List(\n         title=_("Custom attributes"),\n         description=_("These attributes are additionally allowed."),\n-        default=[\n-            "autoplay",\n-            "controls",\n-            "loading",\n-            "poster",\n-            "srcset",\n-            "style",\n-        ],\n+        default=["style", "controls", "poster", "autoplay", "loading", "srcset"],\n         value_type=schema.TextLine(),\n         missing_value=[],\n         required=False,\n@@ -409,9 +360,10 @@ class ITinyMCELayoutSchema(Interface):\n \n     inline = schema.Bool(\n         title=_("Run TinyMCE in inline mode."),\n-        description=_("The inline editing mode is useful when creating user "\n-                      "experiences where you want the editing view of the page "\n-                      "to be merged with the reading view of the page."\n+        description=_(\n+            "The inline editing mode is useful when creating user "\n+            "experiences where you want the editing view of the page "\n+            "to be merged with the reading view of the page."\n         ),\n         default=False,\n         required=False,\n@@ -731,9 +683,7 @@ class ITinyMCESpellCheckerSchema(Interface):\n \n     libraries_spellchecker_choice = schema.Choice(\n         title=_("Spellchecker plugin to use"),\n-        description=_(\n-            "This option allows you to choose the spellchecker for TinyMCE."\n-        ),\n+        description=_("This option allows you to choose the spellchecker for TinyMCE."),\n         missing_value=set(),\n         vocabulary=SimpleVocabulary(\n             [\n@@ -1566,9 +1516,7 @@ class IMailSchema(Interface):\n \n     email_from_name = schema.TextLine(\n         title=_("Site \'From\' name"),\n-        description=_(\n-            "Plone generates e-mail using this name as the e-mail sender."\n-        ),\n+        description=_("Plone generates e-mail using this name as the e-mail sender."),\n         default=None,\n         required=True,\n     )\n@@ -1799,38 +1747,78 @@ class IImagingSchema(Interface):\n \n     image_srcsets = schema.JSONField(\n         title=_("Image srcset\'s"),\n-        description=_(\n-            "Enter a JSON-formatted image srcset configuration. "\n-        ),\n-        schema=IMAGE_SRCSET_SCHEMA,\n-        default={\n-                "large": {\n-                    "title": "Large",\n-                    "preview": "++theme++barceloneta/static/preview-image-large.png",\n-                    "sourceset": [\n-                        {"scale": "teaser", "media": "(max-width:768px) and (orientation:portrait)"},\n-                        {"scale": "large", "media": "(max-width:768px)"},\n-                        {"scale": "larger", "media": "(min-width:992px)"},\n-                        {"scale": "great", "media": "(min-width:1200px)"},\n-                        {"scale": "huge", "media": "(min-width:1400px)"},\n-                        {"scale": "huge"},\n-                    ],\n-                },\n-                "medium": {\n-                    "title": "Medium",\n-                    "preview": "++theme++barceloneta/static/preview-image-medium.png",\n-                    "sourceset": [\n-                        {"scale": "large", "media": "(max-width:768px)"},\n-                        {"scale": "larger"},\n-                    ],\n+        description=_("Enter a JSON-formatted image srcset configuration. "),\n+        schema=json.dumps(\n+            {\n+                "title": "Image srcset defintion",\n+                "type": "object",\n+                "properties": {\n+                    "excludedScales": {\n+                        "type": "array",\n+                    },\n                 },\n-                "small": {\n-                    "title": "Small",\n-                    "preview": "++theme++barceloneta/static/preview-image-small.png",\n-                    "sourceset": [\n-                        {"scale": "preview"},\n-                    ],\n+                "additionalProperties": {"$ref": "#/$defs/srcset"},\n+                "$defs": {\n+                    "srcset": {\n+                        "type": "object",\n+                        "properties": {\n+                            "title": {\n+                                "type": "string",\n+                            },\n+                            "preview": {\n+                                "type": "string",\n+                            },\n+                            "excludedScales": {\n+                                "type": "array",\n+                            },\n+                            "hideInEditor": {\n+                                "type": "boolean",\n+                            },\n+                            "sourceset": {\n+                                "type": "array",\n+                                "items": {\n+                                    "type": "object",\n+                                    "properties": {\n+                                        "scale": {\n+                                            "type": "string",\n+                                        },\n+                                        "media": {\n+                                            "type": "string",\n+                                        },\n+                                    },\n+                                    "additionalProperties": False,\n+                                    "required": ["scale"],\n+                                },\n+                            },\n+                        },\n+                        "additionalProperties": False,\n+                        "required": ["title", "sourceset"],\n+                    },\n                 },\n+            }\n+        ),\n+        default={\n+            "excludedScales": ["tile", "icon", "listing"],\n+            "large": {\n+                "title": "Large",\n+                "sourceset": [\n+                    {\n+                        "scale": "larger",\n+                    },\n+                ],\n+            },\n+            "medium": {\n+                "title": "Medium",\n+                "sourceset": [\n+                    {"scale": "teaser"},\n+                ],\n+            },\n+            "small": {\n+                "title": "Small",\n+                "sourceset": [\n+                    {"scale": "preview"},\n+                ],\n+            },\n         },\n         required=True,\n     )\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-05T11:36:08+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/0e0881a149f9bb66676f456b46870c17504e29f5

use additionalScales for every source

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 61e7436..4755e29 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1768,9 +1768,6 @@ class IImagingSchema(Interface):\n                             "preview": {\n                                 "type": "string",\n                             },\n-                            "excludedScales": {\n-                                "type": "array",\n-                            },\n                             "hideInEditor": {\n                                 "type": "boolean",\n                             },\n@@ -1785,6 +1782,9 @@ class IImagingSchema(Interface):\n                                         "media": {\n                                             "type": "string",\n                                         },\n+                                        "additionalScales": {\n+                                            "type": "array",\n+                                        },\n                                     },\n                                     "additionalProperties": False,\n                                     "required": ["scale"],\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-05T12:09:28+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/5a4f2d47453063cc434ccdf1afe4d2cc743d33b4

Add image srcset definition and json schema

Files changed:
A news/5.feature
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/news/5.feature b/news/5.feature\nnew file mode 100644\nindex 0000000..86f07cb\n--- /dev/null\n+++ b/news/5.feature\n@@ -0,0 +1 @@\n+Add Add image srcset\'s configuration including JSON schema definition to imaging-controlpanel [MrTango]\n\\ No newline at end of file\ndiff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 1a8e65b..b8a1677 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,7 +1,8 @@\n from .basetool import IPloneBaseTool\n+from plone import schema\n+from plone.autoform import directives\n from plone.base import PloneMessageFactory as _\n from Products.CMFCore.utils import getToolByName\n-from zope import schema\n from zope.component.hooks import getSite\n from zope.interface import Attribute\n from zope.interface import implementer\n@@ -57,6 +58,45 @@ def dump_json_to_text(obj):\n Disallow: /*view$\n """\n \n+IMAGE_SRCSET_SCHEMA = json.dumps(\n+    {\n+        "title": "Image srcset defintion",\n+        "type": "object",\n+        "additionalProperties": { "$ref": "#/$defs/srcset" },\n+        "$defs": {\n+            "srcset": {\n+                "type": "object",\n+                "properties": {\n+                    "title": {\n+                        "type": "string",\n+                    },\n+                    "preview": {\n+                        "type": "string",\n+                    },\n+                    "sourceset": {\n+                        "type": "array",\n+                        "items": {\n+                            "type": "object",\n+                            "properties": {\n+                                "scale": {\n+                                    "type": "string",\n+                                },\n+                                "media": {\n+                                    "type": "string",\n+                                },\n+                            },\n+                            "additionalProperties": False,\n+                            "required": ["scale"],\n+                        },\n+                    },\n+                },\n+                "additionalProperties": False,\n+                "required": ["title", "sourceset"],\n+            },\n+        },\n+    }\n+)\n+\n \n def validate_json(value):\n     try:\n@@ -1745,6 +1785,43 @@ class IImagingSchema(Interface):\n         default=51,\n     )\n \n+    image_srcsets = schema.JSONField(\n+        title=_("Image srcset\'s"),\n+        description=_(\n+            "Enter a JSON-formatted image srcset configuration. "\n+        ),\n+        schema=IMAGE_SRCSET_SCHEMA,\n+        default={\n+                "large": {\n+                    "title": "Large",\n+                    "preview": "++theme++barceloneta/static/preview-image-large.png",\n+                    "sourceset": [\n+                        {"scale": "teaser", "media": "(min-width:768px) and (orientation:portrait)"},\n+                        {"scale": "large", "media": "(min-width:768px)"},\n+                        {"scale": "larger", "media": "(min-width:992px)"},\n+                        {"scale": "great", "media": "(min-width:1200px)"},\n+                        {"scale": "huge", "media": "(min-width:1400px)"},\n+                        {"scale": "huge"},\n+                    ],\n+                },\n+                "medium": {\n+                    "title": "Medium",\n+                    "preview": "++theme++barceloneta/static/preview-image-medium.png",\n+                    "sourceset": [\n+                        {"scale": "larger"},\n+                    ],\n+                },\n+                "small": {\n+                    "title": "Small",\n+                    "preview": "++theme++barceloneta/static/preview-image-small.png",\n+                    "sourceset": [\n+                        {"scale": "preview"},\n+                    ],\n+                },\n+        },\n+        required=True,\n+    )\n+\n     image_captioning = schema.Bool(\n         title=_("image_captioning_title", "Enable image captioning"),\n         description=_(\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-05T12:09:28+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/33814e593551bee062417ed07e2c17b1de5e47b5

Allow picture tag and loading attributes in HTMLFilter

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex b8a1677..ab89ade 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,5 +1,6 @@\n from .basetool import IPloneBaseTool\n from plone import schema\n+from zope.schema import ValidationError\n from plone.autoform import directives\n from plone.base import PloneMessageFactory as _\n from Products.CMFCore.utils import getToolByName\n@@ -103,7 +104,7 @@ def validate_json(value):\n         json.loads(value)\n     except ValueError as exc:\n \n-        class JSONError(schema.ValidationError):\n+        class JSONError(ValidationError):\n             __doc__ = _(\n                 "Must be empty or a valid JSON-formatted "\n                 "configuration \xe2\x80\x93 ${message}.",\n@@ -328,6 +329,7 @@ class IFilterSchema(Interface):\n             "output",\n             "p",\n             "pre",\n+            "picture",\n             "progress",\n             "q",\n             "rp",\n@@ -364,7 +366,7 @@ class IFilterSchema(Interface):\n     custom_attributes = schema.List(\n         title=_("Custom attributes"),\n         description=_("These attributes are additionally allowed."),\n-        default=["style", "controls", "poster", "autoplay"],\n+        default=["style", "controls", "poster", "autoplay", "loading"],\n         value_type=schema.TextLine(),\n         missing_value=[],\n         required=False,\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-05T12:09:28+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/c04015644ad1593e6ad5b6b386300b1337439f13

Add hideInEditor property in IMAGE_SRCSET_SCHEMA

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex ab89ade..ef4ca88 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,3 +1,4 @@\n+from xmlrpc.client import boolean\n from .basetool import IPloneBaseTool\n from plone import schema\n from zope.schema import ValidationError\n@@ -74,6 +75,9 @@ def dump_json_to_text(obj):\n                     "preview": {\n                         "type": "string",\n                     },\n+                    "hideInEditor": {\n+                        "type": "boolean",\n+                    },\n                     "sourceset": {\n                         "type": "array",\n                         "items": {\n@@ -1798,8 +1802,8 @@ class IImagingSchema(Interface):\n                     "title": "Large",\n                     "preview": "++theme++barceloneta/static/preview-image-large.png",\n                     "sourceset": [\n-                        {"scale": "teaser", "media": "(min-width:768px) and (orientation:portrait)"},\n-                        {"scale": "large", "media": "(min-width:768px)"},\n+                        {"scale": "teaser", "media": "(max-width:768px) and (orientation:portrait)"},\n+                        {"scale": "large", "media": "(max-width:768px)"},\n                         {"scale": "larger", "media": "(min-width:992px)"},\n                         {"scale": "great", "media": "(min-width:1200px)"},\n                         {"scale": "huge", "media": "(min-width:1400px)"},\n@@ -1810,6 +1814,7 @@ class IImagingSchema(Interface):\n                     "title": "Medium",\n                     "preview": "++theme++barceloneta/static/preview-image-medium.png",\n                     "sourceset": [\n+                        {"scale": "large", "media": "(max-width:768px)"},\n                         {"scale": "larger"},\n                     ],\n                 },\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-05T12:09:28+03:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.base/commit/865f903f28dd558462c601a7a6c167f682aacebe

Allow srcset attribute in HTMLFilter.

Sorted the attributes alphabetically.

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex ef4ca88..0a103ae 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -370,7 +370,14 @@ class IFilterSchema(Interface):\n     custom_attributes = schema.List(\n         title=_("Custom attributes"),\n         description=_("These attributes are additionally allowed."),\n-        default=["style", "controls", "poster", "autoplay", "loading"],\n+        default=[\n+            "autoplay",\n+            "controls",\n+            "loading",\n+            "poster",\n+            "srcset",\n+            "style",\n+        ],\n         value_type=schema.TextLine(),\n         missing_value=[],\n         required=False,\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-05T12:09:28+03:00
Author: Maik Derstappen (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/bd91ba17ce416e31caccf53a005eeab67c8f3cef

Update src/plone/base/interfaces/controlpanel.py

Co-authored-by: Alessandro Pisa &lt;alessandro.pisa@gmail.com&gt;

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 0a103ae..4d159a8 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,4 +1,3 @@\n-from xmlrpc.client import boolean\n from .basetool import IPloneBaseTool\n from plone import schema\n from zope.schema import ValidationError\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-05T12:09:28+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/98afe3faf8b0bc47cb193f3a4ee92a29f47b75f0

move IMAGE_SRCSET_SCHEMA into inteface defintion and simplify defaults

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 4d159a8..b43540c 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -59,48 +59,6 @@ def dump_json_to_text(obj):\n Disallow: /*view$\n """\n \n-IMAGE_SRCSET_SCHEMA = json.dumps(\n-    {\n-        "title": "Image srcset defintion",\n-        "type": "object",\n-        "additionalProperties": { "$ref": "#/$defs/srcset" },\n-        "$defs": {\n-            "srcset": {\n-                "type": "object",\n-                "properties": {\n-                    "title": {\n-                        "type": "string",\n-                    },\n-                    "preview": {\n-                        "type": "string",\n-                    },\n-                    "hideInEditor": {\n-                        "type": "boolean",\n-                    },\n-                    "sourceset": {\n-                        "type": "array",\n-                        "items": {\n-                            "type": "object",\n-                            "properties": {\n-                                "scale": {\n-                                    "type": "string",\n-                                },\n-                                "media": {\n-                                    "type": "string",\n-                                },\n-                            },\n-                            "additionalProperties": False,\n-                            "required": ["scale"],\n-                        },\n-                    },\n-                },\n-                "additionalProperties": False,\n-                "required": ["title", "sourceset"],\n-            },\n-        },\n-    }\n-)\n-\n \n def validate_json(value):\n     try:\n@@ -369,14 +327,7 @@ class IFilterSchema(Interface):\n     custom_attributes = schema.List(\n         title=_("Custom attributes"),\n         description=_("These attributes are additionally allowed."),\n-        default=[\n-            "autoplay",\n-            "controls",\n-            "loading",\n-            "poster",\n-            "srcset",\n-            "style",\n-        ],\n+        default=["style", "controls", "poster", "autoplay", "loading", "srcset"],\n         value_type=schema.TextLine(),\n         missing_value=[],\n         required=False,\n@@ -409,9 +360,10 @@ class ITinyMCELayoutSchema(Interface):\n \n     inline = schema.Bool(\n         title=_("Run TinyMCE in inline mode."),\n-        description=_("The inline editing mode is useful when creating user "\n-                      "experiences where you want the editing view of the page "\n-                      "to be merged with the reading view of the page."\n+        description=_(\n+            "The inline editing mode is useful when creating user "\n+            "experiences where you want the editing view of the page "\n+            "to be merged with the reading view of the page."\n         ),\n         default=False,\n         required=False,\n@@ -731,9 +683,7 @@ class ITinyMCESpellCheckerSchema(Interface):\n \n     libraries_spellchecker_choice = schema.Choice(\n         title=_("Spellchecker plugin to use"),\n-        description=_(\n-            "This option allows you to choose the spellchecker for TinyMCE."\n-        ),\n+        description=_("This option allows you to choose the spellchecker for TinyMCE."),\n         missing_value=set(),\n         vocabulary=SimpleVocabulary(\n             [\n@@ -1566,9 +1516,7 @@ class IMailSchema(Interface):\n \n     email_from_name = schema.TextLine(\n         title=_("Site \'From\' name"),\n-        description=_(\n-            "Plone generates e-mail using this name as the e-mail sender."\n-        ),\n+        description=_("Plone generates e-mail using this name as the e-mail sender."),\n         default=None,\n         required=True,\n     )\n@@ -1799,38 +1747,78 @@ class IImagingSchema(Interface):\n \n     image_srcsets = schema.JSONField(\n         title=_("Image srcset\'s"),\n-        description=_(\n-            "Enter a JSON-formatted image srcset configuration. "\n-        ),\n-        schema=IMAGE_SRCSET_SCHEMA,\n-        default={\n-                "large": {\n-                    "title": "Large",\n-                    "preview": "++theme++barceloneta/static/preview-image-large.png",\n-                    "sourceset": [\n-                        {"scale": "teaser", "media": "(max-width:768px) and (orientation:portrait)"},\n-                        {"scale": "large", "media": "(max-width:768px)"},\n-                        {"scale": "larger", "media": "(min-width:992px)"},\n-                        {"scale": "great", "media": "(min-width:1200px)"},\n-                        {"scale": "huge", "media": "(min-width:1400px)"},\n-                        {"scale": "huge"},\n-                    ],\n-                },\n-                "medium": {\n-                    "title": "Medium",\n-                    "preview": "++theme++barceloneta/static/preview-image-medium.png",\n-                    "sourceset": [\n-                        {"scale": "large", "media": "(max-width:768px)"},\n-                        {"scale": "larger"},\n-                    ],\n+        description=_("Enter a JSON-formatted image srcset configuration. "),\n+        schema=json.dumps(\n+            {\n+                "title": "Image srcset defintion",\n+                "type": "object",\n+                "properties": {\n+                    "excludedScales": {\n+                        "type": "array",\n+                    },\n                 },\n-                "small": {\n-                    "title": "Small",\n-                    "preview": "++theme++barceloneta/static/preview-image-small.png",\n-                    "sourceset": [\n-                        {"scale": "preview"},\n-                    ],\n+                "additionalProperties": {"$ref": "#/$defs/srcset"},\n+                "$defs": {\n+                    "srcset": {\n+                        "type": "object",\n+                        "properties": {\n+                            "title": {\n+                                "type": "string",\n+                            },\n+                            "preview": {\n+                                "type": "string",\n+                            },\n+                            "excludedScales": {\n+                                "type": "array",\n+                            },\n+                            "hideInEditor": {\n+                                "type": "boolean",\n+                            },\n+                            "sourceset": {\n+                                "type": "array",\n+                                "items": {\n+                                    "type": "object",\n+                                    "properties": {\n+                                        "scale": {\n+                                            "type": "string",\n+                                        },\n+                                        "media": {\n+                                            "type": "string",\n+                                        },\n+                                    },\n+                                    "additionalProperties": False,\n+                                    "required": ["scale"],\n+                                },\n+                            },\n+                        },\n+                        "additionalProperties": False,\n+                        "required": ["title", "sourceset"],\n+                    },\n                 },\n+            }\n+        ),\n+        default={\n+            "excludedScales": ["tile", "icon", "listing"],\n+            "large": {\n+                "title": "Large",\n+                "sourceset": [\n+                    {\n+                        "scale": "larger",\n+                    },\n+                ],\n+            },\n+            "medium": {\n+                "title": "Medium",\n+                "sourceset": [\n+                    {"scale": "teaser"},\n+                ],\n+            },\n+            "small": {\n+                "title": "Small",\n+                "sourceset": [\n+                    {"scale": "preview"},\n+                ],\n+            },\n         },\n         required=True,\n     )\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-05T12:09:28+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/050633242cd57a631d0a266f29f9de6a01132c7e

use additionalScales for every source

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex b43540c..f474779 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1768,9 +1768,6 @@ class IImagingSchema(Interface):\n                             "preview": {\n                                 "type": "string",\n                             },\n-                            "excludedScales": {\n-                                "type": "array",\n-                            },\n                             "hideInEditor": {\n                                 "type": "boolean",\n                             },\n@@ -1785,6 +1782,9 @@ class IImagingSchema(Interface):\n                                         "media": {\n                                             "type": "string",\n                                         },\n+                                        "additionalScales": {\n+                                            "type": "array",\n+                                        },\n                                     },\n                                     "additionalProperties": False,\n                                     "required": ["scale"],\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-05T12:27:45+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/951e86773cd831a5c3f7da28d17c15e0c2b32297

Merge remote-tracking branch 'remotes/origin/mrtango-image-handling-sourcesets-settings' into mrtango-image-handling-sourcesets-settings

Files changed:


b''

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-05T18:04:19+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/ff2de27c9a0ab497952b35801ba36544bb2d6e33

rename sourceset to source and remove exlucludeScales param

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex f474779..ea26aca 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1752,11 +1752,6 @@ class IImagingSchema(Interface):\n             {\n                 "title": "Image srcset defintion",\n                 "type": "object",\n-                "properties": {\n-                    "excludedScales": {\n-                        "type": "array",\n-                    },\n-                },\n                 "additionalProperties": {"$ref": "#/$defs/srcset"},\n                 "$defs": {\n                     "srcset": {\n@@ -1771,7 +1766,7 @@ class IImagingSchema(Interface):\n                             "hideInEditor": {\n                                 "type": "boolean",\n                             },\n-                            "sourceset": {\n+                            "source": {\n                                 "type": "array",\n                                 "items": {\n                                     "type": "object",\n@@ -1792,16 +1787,15 @@ class IImagingSchema(Interface):\n                             },\n                         },\n                         "additionalProperties": False,\n-                        "required": ["title", "sourceset"],\n+                        "required": ["title", "source"],\n                     },\n                 },\n             }\n         ),\n         default={\n-            "excludedScales": ["tile", "icon", "listing"],\n             "large": {\n                 "title": "Large",\n-                "sourceset": [\n+                "source": [\n                     {\n                         "scale": "larger",\n                     },\n@@ -1809,13 +1803,13 @@ class IImagingSchema(Interface):\n             },\n             "medium": {\n                 "title": "Medium",\n-                "sourceset": [\n+                "source": [\n                     {"scale": "teaser"},\n                 ],\n             },\n             "small": {\n                 "title": "Small",\n-                "sourceset": [\n+                "source": [\n                     {"scale": "preview"},\n                 ],\n             },\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-08T20:58:58+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/71c957f969319f9101e7d674031883d5a3689883

revert naming change of sourceset

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex ea26aca..edd8642 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1766,7 +1766,7 @@ class IImagingSchema(Interface):\n                             "hideInEditor": {\n                                 "type": "boolean",\n                             },\n-                            "source": {\n+                            "sourceset": {\n                                 "type": "array",\n                                 "items": {\n                                     "type": "object",\n@@ -1787,7 +1787,7 @@ class IImagingSchema(Interface):\n                             },\n                         },\n                         "additionalProperties": False,\n-                        "required": ["title", "source"],\n+                        "required": ["title", "sourceset"],\n                     },\n                 },\n             }\n@@ -1795,7 +1795,7 @@ class IImagingSchema(Interface):\n         default={\n             "large": {\n                 "title": "Large",\n-                "source": [\n+                "sourceset": [\n                     {\n                         "scale": "larger",\n                     },\n@@ -1803,13 +1803,13 @@ class IImagingSchema(Interface):\n             },\n             "medium": {\n                 "title": "Medium",\n-                "source": [\n+                "sourceset": [\n                     {"scale": "teaser"},\n                 ],\n             },\n             "small": {\n                 "title": "Small",\n-                "source": [\n+                "sourceset": [\n                     {"scale": "preview"},\n                 ],\n             },\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-09T20:48:29+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/95498f95018bb5a48324af027e279fc3cda894f9

isort fix

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex edd8642..2188dac 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,6 +1,5 @@\n from .basetool import IPloneBaseTool\n from plone import schema\n-from zope.schema import ValidationError\n from plone.autoform import directives\n from plone.base import PloneMessageFactory as _\n from Products.CMFCore.utils import getToolByName\n@@ -10,6 +9,7 @@\n from zope.interface import Interface\n from zope.interface import Invalid\n from zope.interface import invariant\n+from zope.schema import ValidationError\n from zope.schema.vocabulary import SimpleTerm\n from zope.schema.vocabulary import SimpleVocabulary\n \n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-18T12:54:06+02:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/6205b85933b3336659e57eb11e1ceb0808c7094a

Add additionalScales in default settings

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 2188dac..45a7971 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1798,19 +1798,26 @@ class IImagingSchema(Interface):\n                 "sourceset": [\n                     {\n                         "scale": "larger",\n+                        "additionalScales": ["preview", "teaser", "large", "great", "huge"],\n                     },\n                 ],\n             },\n             "medium": {\n                 "title": "Medium",\n                 "sourceset": [\n-                    {"scale": "teaser"},\n+                    {\n+                        "scale": "teaser",\n+                        "additionalScales": ["preview", "large", "larger", "great"],\n+                    },\n                 ],\n             },\n             "small": {\n                 "title": "Small",\n                 "sourceset": [\n-                    {"scale": "preview"},\n+                    {\n+                        "scale": "preview",\n+                        "additionalScales": ["preview", "large", "larger"],\n+                    },\n                 ],\n             },\n         },\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-27T12:58:19+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/1ee0b76f96abf4adaefb8c9e427d760149e9850e

Add image srcset definition and json schema

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex f474779..94a2bf8 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -59,6 +59,45 @@ def dump_json_to_text(obj):\n Disallow: /*view$\n """\n \n+IMAGE_SRCSET_SCHEMA = json.dumps(\n+    {\n+        "title": "Image srcset defintion",\n+        "type": "object",\n+        "additionalProperties": { "$ref": "#/$defs/srcset" },\n+        "$defs": {\n+            "srcset": {\n+                "type": "object",\n+                "properties": {\n+                    "title": {\n+                        "type": "string",\n+                    },\n+                    "preview": {\n+                        "type": "string",\n+                    },\n+                    "sourceset": {\n+                        "type": "array",\n+                        "items": {\n+                            "type": "object",\n+                            "properties": {\n+                                "scale": {\n+                                    "type": "string",\n+                                },\n+                                "media": {\n+                                    "type": "string",\n+                                },\n+                            },\n+                            "additionalProperties": False,\n+                            "required": ["scale"],\n+                        },\n+                    },\n+                },\n+                "additionalProperties": False,\n+                "required": ["title", "sourceset"],\n+            },\n+        },\n+    }\n+)\n+\n \n def validate_json(value):\n     try:\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-27T12:59:18+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/7b93e6143582617da9c43645bd24f904c6a51151

Add hideInEditor property in IMAGE_SRCSET_SCHEMA

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 94a2bf8..c7d52f5 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,3 +1,4 @@\n+from xmlrpc.client import boolean\n from .basetool import IPloneBaseTool\n from plone import schema\n from zope.schema import ValidationError\n@@ -74,6 +75,9 @@ def dump_json_to_text(obj):\n                     "preview": {\n                         "type": "string",\n                     },\n+                    "hideInEditor": {\n+                        "type": "boolean",\n+                    },\n                     "sourceset": {\n                         "type": "array",\n                         "items": {\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-27T12:59:41+03:00
Author: Maik Derstappen (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/f32ef4ee075eb5c7250dfbacfa5872d8775333f5

Update src/plone/base/interfaces/controlpanel.py

Co-authored-by: Alessandro Pisa &lt;alessandro.pisa@gmail.com&gt;

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex c7d52f5..18e5a87 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,4 +1,3 @@\n-from xmlrpc.client import boolean\n from .basetool import IPloneBaseTool\n from plone import schema\n from zope.schema import ValidationError\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-27T13:00:06+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/47b4304160ec45ea2115e6a4749a1b885f156a84

move IMAGE_SRCSET_SCHEMA into inteface defintion and simplify defaults

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 18e5a87..f474779 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -59,48 +59,6 @@ def dump_json_to_text(obj):\n Disallow: /*view$\n """\n \n-IMAGE_SRCSET_SCHEMA = json.dumps(\n-    {\n-        "title": "Image srcset defintion",\n-        "type": "object",\n-        "additionalProperties": { "$ref": "#/$defs/srcset" },\n-        "$defs": {\n-            "srcset": {\n-                "type": "object",\n-                "properties": {\n-                    "title": {\n-                        "type": "string",\n-                    },\n-                    "preview": {\n-                        "type": "string",\n-                    },\n-                    "hideInEditor": {\n-                        "type": "boolean",\n-                    },\n-                    "sourceset": {\n-                        "type": "array",\n-                        "items": {\n-                            "type": "object",\n-                            "properties": {\n-                                "scale": {\n-                                    "type": "string",\n-                                },\n-                                "media": {\n-                                    "type": "string",\n-                                },\n-                            },\n-                            "additionalProperties": False,\n-                            "required": ["scale"],\n-                        },\n-                    },\n-                },\n-                "additionalProperties": False,\n-                "required": ["title", "sourceset"],\n-            },\n-        },\n-    }\n-)\n-\n \n def validate_json(value):\n     try:\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-27T13:00:08+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/efd1e06c37f85cf4a1376187a3071dee31458bc2

rename sourceset to source and remove exlucludeScales param

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex f474779..ea26aca 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1752,11 +1752,6 @@ class IImagingSchema(Interface):\n             {\n                 "title": "Image srcset defintion",\n                 "type": "object",\n-                "properties": {\n-                    "excludedScales": {\n-                        "type": "array",\n-                    },\n-                },\n                 "additionalProperties": {"$ref": "#/$defs/srcset"},\n                 "$defs": {\n                     "srcset": {\n@@ -1771,7 +1766,7 @@ class IImagingSchema(Interface):\n                             "hideInEditor": {\n                                 "type": "boolean",\n                             },\n-                            "sourceset": {\n+                            "source": {\n                                 "type": "array",\n                                 "items": {\n                                     "type": "object",\n@@ -1792,16 +1787,15 @@ class IImagingSchema(Interface):\n                             },\n                         },\n                         "additionalProperties": False,\n-                        "required": ["title", "sourceset"],\n+                        "required": ["title", "source"],\n                     },\n                 },\n             }\n         ),\n         default={\n-            "excludedScales": ["tile", "icon", "listing"],\n             "large": {\n                 "title": "Large",\n-                "sourceset": [\n+                "source": [\n                     {\n                         "scale": "larger",\n                     },\n@@ -1809,13 +1803,13 @@ class IImagingSchema(Interface):\n             },\n             "medium": {\n                 "title": "Medium",\n-                "sourceset": [\n+                "source": [\n                     {"scale": "teaser"},\n                 ],\n             },\n             "small": {\n                 "title": "Small",\n-                "sourceset": [\n+                "source": [\n                     {"scale": "preview"},\n                 ],\n             },\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-27T13:00:08+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/f92f1aaffb3b064bfc623be3c068ad3f55fea8a1

revert naming change of sourceset

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex ea26aca..edd8642 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1766,7 +1766,7 @@ class IImagingSchema(Interface):\n                             "hideInEditor": {\n                                 "type": "boolean",\n                             },\n-                            "source": {\n+                            "sourceset": {\n                                 "type": "array",\n                                 "items": {\n                                     "type": "object",\n@@ -1787,7 +1787,7 @@ class IImagingSchema(Interface):\n                             },\n                         },\n                         "additionalProperties": False,\n-                        "required": ["title", "source"],\n+                        "required": ["title", "sourceset"],\n                     },\n                 },\n             }\n@@ -1795,7 +1795,7 @@ class IImagingSchema(Interface):\n         default={\n             "large": {\n                 "title": "Large",\n-                "source": [\n+                "sourceset": [\n                     {\n                         "scale": "larger",\n                     },\n@@ -1803,13 +1803,13 @@ class IImagingSchema(Interface):\n             },\n             "medium": {\n                 "title": "Medium",\n-                "source": [\n+                "sourceset": [\n                     {"scale": "teaser"},\n                 ],\n             },\n             "small": {\n                 "title": "Small",\n-                "source": [\n+                "sourceset": [\n                     {"scale": "preview"},\n                 ],\n             },\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-27T13:00:08+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/aa37bf42ef488054f1966f9316a8d0a549bc238a

isort fix

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex edd8642..2188dac 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,6 +1,5 @@\n from .basetool import IPloneBaseTool\n from plone import schema\n-from zope.schema import ValidationError\n from plone.autoform import directives\n from plone.base import PloneMessageFactory as _\n from Products.CMFCore.utils import getToolByName\n@@ -10,6 +9,7 @@\n from zope.interface import Interface\n from zope.interface import Invalid\n from zope.interface import invariant\n+from zope.schema import ValidationError\n from zope.schema.vocabulary import SimpleTerm\n from zope.schema.vocabulary import SimpleVocabulary\n \n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-27T13:00:08+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/18c55e1296cbc80d671f62045f6c996554598136

Add additionalScales in default settings

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 2188dac..45a7971 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1798,19 +1798,26 @@ class IImagingSchema(Interface):\n                 "sourceset": [\n                     {\n                         "scale": "larger",\n+                        "additionalScales": ["preview", "teaser", "large", "great", "huge"],\n                     },\n                 ],\n             },\n             "medium": {\n                 "title": "Medium",\n                 "sourceset": [\n-                    {"scale": "teaser"},\n+                    {\n+                        "scale": "teaser",\n+                        "additionalScales": ["preview", "large", "larger", "great"],\n+                    },\n                 ],\n             },\n             "small": {\n                 "title": "Small",\n                 "sourceset": [\n-                    {"scale": "preview"},\n+                    {\n+                        "scale": "preview",\n+                        "additionalScales": ["preview", "large", "larger"],\n+                    },\n                 ],\n             },\n         },\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-05-27T13:03:07+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/5439896daaab36a27f8f1c20a97a97cf9beda623

Merge remote-tracking branch 'remotes/origin/mrtango-image-handling-sourcesets-settings' into mrtango-image-handling-sourcesets-settings

Files changed:


b''

Repository: plone.base


Branch: refs/heads/main
Date: 2022-06-07T17:27:35+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/09457a808732bc692b014b3e66f7a7820b7b2f56

rename image_srcsets to picture_variants

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 45a7971..611b47b 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1745,9 +1745,9 @@ class IImagingSchema(Interface):\n         default=51,\n     )\n \n-    image_srcsets = schema.JSONField(\n-        title=_("Image srcset\'s"),\n-        description=_("Enter a JSON-formatted image srcset configuration. "),\n+    picture_variants = schema.JSONField(\n+        title=_("Picture variants"),\n+        description=_("Enter a JSON-formatted picture variants configuration."),\n         schema=json.dumps(\n             {\n                 "title": "Image srcset defintion",\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-06-08T18:10:24+03:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.base/commit/fc2b7d98b23b0bb17cd7a51eabb261902d1bf958

allow sizes attribute in hTML filter

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 611b47b..1736456 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -327,7 +327,7 @@ class IFilterSchema(Interface):\n     custom_attributes = schema.List(\n         title=_("Custom attributes"),\n         description=_("These attributes are additionally allowed."),\n-        default=["style", "controls", "poster", "autoplay", "loading", "srcset"],\n+        default=["style", "controls", "poster", "autoplay", "loading", "srcset", "sizes"],\n         value_type=schema.TextLine(),\n         missing_value=[],\n         required=False,\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-06-16T14:20:47+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.base/commit/16dc0e1922ee49854ee79c206ffe1906103c0b19

remove duplicate scale for small

Files changed:
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 1736456..105ae38 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1816,7 +1816,7 @@ class IImagingSchema(Interface):\n                 "sourceset": [\n                     {\n                         "scale": "preview",\n-                        "additionalScales": ["preview", "large", "larger"],\n+                        "additionalScales": ["large", "larger"],\n                     },\n                 ],\n             },\n'

Repository: plone.base


Branch: refs/heads/main
Date: 2022-06-16T18:53:42+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.base/commit/a5243b8e7a397cfa4e21da592c670edc5e0193e4

Merge pull request #5 from plone/mrtango-image-handling-sourcesets-settings

Add image srcset definition and json schema

Files changed:
A news/5.feature
M src/plone/base/interfaces/controlpanel.py

b'diff --git a/news/5.feature b/news/5.feature\nnew file mode 100644\nindex 0000000..86f07cb\n--- /dev/null\n+++ b/news/5.feature\n@@ -0,0 +1 @@\n+Add Add image srcset\'s configuration including JSON schema definition to imaging-controlpanel [MrTango]\n\\ No newline at end of file\ndiff --git a/src/plone/base/interfaces/controlpanel.py b/src/plone/base/interfaces/controlpanel.py\nindex 1a8e65b..105ae38 100644\n--- a/src/plone/base/interfaces/controlpanel.py\n+++ b/src/plone/base/interfaces/controlpanel.py\n@@ -1,13 +1,15 @@\n from .basetool import IPloneBaseTool\n+from plone import schema\n+from plone.autoform import directives\n from plone.base import PloneMessageFactory as _\n from Products.CMFCore.utils import getToolByName\n-from zope import schema\n from zope.component.hooks import getSite\n from zope.interface import Attribute\n from zope.interface import implementer\n from zope.interface import Interface\n from zope.interface import Invalid\n from zope.interface import invariant\n+from zope.schema import ValidationError\n from zope.schema.vocabulary import SimpleTerm\n from zope.schema.vocabulary import SimpleVocabulary\n \n@@ -63,7 +65,7 @@ def validate_json(value):\n         json.loads(value)\n     except ValueError as exc:\n \n-        class JSONError(schema.ValidationError):\n+        class JSONError(ValidationError):\n             __doc__ = _(\n                 "Must be empty or a valid JSON-formatted "\n                 "configuration \xe2\x80\x93 ${message}.",\n@@ -288,6 +290,7 @@ class IFilterSchema(Interface):\n             "output",\n             "p",\n             "pre",\n+            "picture",\n             "progress",\n             "q",\n             "rp",\n@@ -324,7 +327,7 @@ class IFilterSchema(Interface):\n     custom_attributes = schema.List(\n         title=_("Custom attributes"),\n         description=_("These attributes are additionally allowed."),\n-        default=["style", "controls", "poster", "autoplay"],\n+        default=["style", "controls", "poster", "autoplay", "loading", "srcset", "sizes"],\n         value_type=schema.TextLine(),\n         missing_value=[],\n         required=False,\n@@ -357,9 +360,10 @@ class ITinyMCELayoutSchema(Interface):\n \n     inline = schema.Bool(\n         title=_("Run TinyMCE in inline mode."),\n-        description=_("The inline editing mode is useful when creating user "\n-                      "experiences where you want the editing view of the page "\n-                      "to be merged with the reading view of the page."\n+        description=_(\n+            "The inline editing mode is useful when creating user "\n+            "experiences where you want the editing view of the page "\n+            "to be merged with the reading view of the page."\n         ),\n         default=False,\n         required=False,\n@@ -679,9 +683,7 @@ class ITinyMCESpellCheckerSchema(Interface):\n \n     libraries_spellchecker_choice = schema.Choice(\n         title=_("Spellchecker plugin to use"),\n-        description=_(\n-            "This option allows you to choose the spellchecker for TinyMCE."\n-        ),\n+        description=_("This option allows you to choose the spellchecker for TinyMCE."),\n         missing_value=set(),\n         vocabulary=SimpleVocabulary(\n             [\n@@ -1514,9 +1516,7 @@ class IMailSchema(Interface):\n \n     email_from_name = schema.TextLine(\n         title=_("Site \'From\' name"),\n-        description=_(\n-            "Plone generates e-mail using this name as the e-mail sender."\n-        ),\n+        description=_("Plone generates e-mail using this name as the e-mail sender."),\n         default=None,\n         required=True,\n     )\n@@ -1745,6 +1745,85 @@ class IImagingSchema(Interface):\n         default=51,\n     )\n \n+    picture_variants = schema.JSONField(\n+        title=_("Picture variants"),\n+        description=_("Enter a JSON-formatted picture variants configuration."),\n+        schema=json.dumps(\n+            {\n+                "title": "Image srcset defintion",\n+                "type": "object",\n+                "additionalProperties": {"$ref": "#/$defs/srcset"},\n+                "$defs": {\n+                    "srcset": {\n+                        "type": "object",\n+                        "properties": {\n+                            "title": {\n+                                "type": "string",\n+                            },\n+                            "preview": {\n+                                "type": "string",\n+                            },\n+                            "hideInEditor": {\n+                                "type": "boolean",\n+                            },\n+                            "sourceset": {\n+                                "type": "array",\n+                                "items": {\n+                                    "type": "object",\n+                                    "properties": {\n+                                        "scale": {\n+                                            "type": "string",\n+                                        },\n+                                        "media": {\n+                                            "type": "string",\n+                                        },\n+                                        "additionalScales": {\n+                                            "type": "array",\n+                                        },\n+                                    },\n+                                    "additionalProperties": False,\n+                                    "required": ["scale"],\n+                                },\n+                            },\n+                        },\n+                        "additionalProperties": False,\n+                        "required": ["title", "sourceset"],\n+                    },\n+                },\n+            }\n+        ),\n+        default={\n+            "large": {\n+                "title": "Large",\n+                "sourceset": [\n+                    {\n+                        "scale": "larger",\n+                        "additionalScales": ["preview", "teaser", "large", "great", "huge"],\n+                    },\n+                ],\n+            },\n+            "medium": {\n+                "title": "Medium",\n+                "sourceset": [\n+                    {\n+                        "scale": "teaser",\n+                        "additionalScales": ["preview", "large", "larger", "great"],\n+                    },\n+                ],\n+            },\n+            "small": {\n+                "title": "Small",\n+                "sourceset": [\n+                    {\n+                        "scale": "preview",\n+                        "additionalScales": ["large", "larger"],\n+                    },\n+                ],\n+            },\n+        },\n+        required=True,\n+    )\n+\n     image_captioning = schema.Bool(\n         title=_("image_captioning_title", "Enable image captioning"),\n         description=_(\n'

