Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-05-14T14:43:11+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/4e677244018784160a87d9e5c22baa7ffcf23b8b

Revert "When adding a Plone Site, do a transaction commit before applying extra profiles."

This reverts commit 4be00d0a130cdcdc049de13fc4c322c38f9c56aa.

Doing the transaction commit doesn't really help after all.
It just means that a subsequest transaction.abort in case of an error doesn't give additional errors on top of the original one.

Files changed:
M CHANGES.rst
M Products/CMFPlone/factory.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2b7087f30..1735203a0 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -58,12 +58,6 @@ New Features:
 
 Bug Fixes:
 
-- When adding a Plone Site, do a transaction commit before applying extra profiles.
-  This avoids errors in some cases when selecting add-ons in the advanced Plone Site add form,
-  where installing them right after site creation in the add-ons control panel goes fine.
-  Fixes `issue 2316 <https://github.com/plone/Products.CMFPlone/issues/2316>`_.
-  [maurits]
-
 - Unflakied a unit test.
   [Rotonen]
 
diff --git a/Products/CMFPlone/factory.py b/Products/CMFPlone/factory.py
index 404c79a6f..af016699a 100644
--- a/Products/CMFPlone/factory.py
+++ b/Products/CMFPlone/factory.py
@@ -9,9 +9,6 @@
 from zope.interface import implementer
 from zope.site.hooks import setSite
 
-import transaction
-
-
 _TOOL_ID = 'portal_setup'
 _DEFAULT_PROFILE = 'Products.CMFPlone:plone'
 _CONTENT_PROFILE = 'plone.app.contenttypes:plone-content'
@@ -166,14 +163,6 @@ def addPloneSite(context, site_id, title='Plone site', description='',
     # properties.xml file are applied and not overwritten by this
     site.manage_changeProperties(**props)
 
-    # In some cases we can get errors when add-ons are installed immediately.
-    # Installing the add-ons separately within the Add-ons control panel
-    # goes fine.
-    # One example is https://github.com/plone/Products.CMFPlone/issues/2316
-    # So it seems helpful to do a transaction commit here.
-    if extension_ids:
-        transaction.commit()
-
     for extension_id in extension_ids:
         setup_tool.runAllImportStepsFromProfile(
             'profile-%s' % extension_id)


