Repository: plone.volto


Branch: refs/heads/main
Date: 2022-11-15T19:17:47-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.volto/commit/38014924536748abcd4d798a5130a5b918fc8c9b

Don't acquire nav_title in breadcrumbs view

Files changed:
M src/plone/volto/browser/breadcrumbs.py

b'diff --git a/src/plone/volto/browser/breadcrumbs.py b/src/plone/volto/browser/breadcrumbs.py\nindex e5a93fa..b9c3b75 100644\n--- a/src/plone/volto/browser/breadcrumbs.py\n+++ b/src/plone/volto/browser/breadcrumbs.py\n@@ -1,4 +1,5 @@\n # -*- coding: utf-8 -*-\n+from Acquisition import aq_base\n from Acquisition import aq_inner\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.app.layout.navigation.root import getNavigationRoot\n@@ -20,15 +21,14 @@ def breadcrumbs(self):\n         container = utils.parent(context)\n \n         name, item_url = get_view_url(context)\n+        last_crumb = {\n+            "absolute_url": item_url,\n+            "Title": utils.pretty_title_or_id(context, context),\n+            "nav_title": getattr(aq_base(context), "nav_title", ""),\n+        }\n \n         if container is None:\n-            return (\n-                {\n-                    "absolute_url": item_url,\n-                    "Title": utils.pretty_title_or_id(context, context),\n-                    "nav_title": getattr(context, "nav_title", ""),\n-                },\n-            )\n+            return (last_crumb,)\n \n         # Replicate Products.CMFPlone.browser.navigaton.RootPhysicalNavigationBreadcrumbs.breadcrumbs()\n         # cause it is not registered during tests\n@@ -50,11 +50,5 @@ def breadcrumbs(self):\n         if not check_default_page_via_view(\n             context, request\n         ) and not rootPath.startswith(itemPath):\n-            base += (\n-                {\n-                    "absolute_url": item_url,\n-                    "Title": utils.pretty_title_or_id(context, context),\n-                    "nav_title": getattr(context, "nav_title", ""),\n-                },\n-            )\n+            base += (last_crumb,)\n         return base\n'

Repository: plone.volto


Branch: refs/heads/main
Date: 2022-11-15T19:19:10-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.volto/commit/00b4529de138fe6fad9edcd284e1a5b9dea12c52

changelog

Files changed:
A news/98.bugfix

b"diff --git a/news/98.bugfix b/news/98.bugfix\nnew file mode 100644\nindex 0000000..6c69af8\n--- /dev/null\n+++ b/news/98.bugfix\n@@ -0,0 +1 @@\n+Don't acquire nav_title from parent in breadcrumbs view. [davisagli]\n"

Repository: plone.volto


Branch: refs/heads/main
Date: 2022-11-16T09:31:28-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.volto/commit/132ecb772d44389425817c3502c0b34d9d0f1928

Merge pull request #98 from plone/fix-navtitle-aq

Don't acquire nav_title in breadcrumbs view

Files changed:
A news/98.bugfix
M src/plone/volto/browser/breadcrumbs.py

b'diff --git a/news/98.bugfix b/news/98.bugfix\nnew file mode 100644\nindex 0000000..6c69af8\n--- /dev/null\n+++ b/news/98.bugfix\n@@ -0,0 +1 @@\n+Don\'t acquire nav_title from parent in breadcrumbs view. [davisagli]\ndiff --git a/src/plone/volto/browser/breadcrumbs.py b/src/plone/volto/browser/breadcrumbs.py\nindex e5a93fa..b9c3b75 100644\n--- a/src/plone/volto/browser/breadcrumbs.py\n+++ b/src/plone/volto/browser/breadcrumbs.py\n@@ -1,4 +1,5 @@\n # -*- coding: utf-8 -*-\n+from Acquisition import aq_base\n from Acquisition import aq_inner\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.app.layout.navigation.root import getNavigationRoot\n@@ -20,15 +21,14 @@ def breadcrumbs(self):\n         container = utils.parent(context)\n \n         name, item_url = get_view_url(context)\n+        last_crumb = {\n+            "absolute_url": item_url,\n+            "Title": utils.pretty_title_or_id(context, context),\n+            "nav_title": getattr(aq_base(context), "nav_title", ""),\n+        }\n \n         if container is None:\n-            return (\n-                {\n-                    "absolute_url": item_url,\n-                    "Title": utils.pretty_title_or_id(context, context),\n-                    "nav_title": getattr(context, "nav_title", ""),\n-                },\n-            )\n+            return (last_crumb,)\n \n         # Replicate Products.CMFPlone.browser.navigaton.RootPhysicalNavigationBreadcrumbs.breadcrumbs()\n         # cause it is not registered during tests\n@@ -50,11 +50,5 @@ def breadcrumbs(self):\n         if not check_default_page_via_view(\n             context, request\n         ) and not rootPath.startswith(itemPath):\n-            base += (\n-                {\n-                    "absolute_url": item_url,\n-                    "Title": utils.pretty_title_or_id(context, context),\n-                    "nav_title": getattr(context, "nav_title", ""),\n-                },\n-            )\n+            base += (last_crumb,)\n         return base\n'

