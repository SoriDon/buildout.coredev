Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-04-06T20:45:35+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.restapi/commit/4b6b17984a1be981e942bb2cb131ea5c5eac3ca5

Fix testing matrix to use correct combos of Python and Plone. (#1356)

* Temporarily include mockup egg on Plone 6.

Otherwise the buildout fails since the ES6 merges yesterday.
See [this GHA run](https://github.com/plone/plone.restapi/runs/5687219593?check_suite_focus=true#step:11:203).

* On Plone 6.0 we need a newer plone.app.testing.

* Fix testing matrix to use correct combos or Python and Plone.

The previous settings were fine for Plone 5.2, but not for 6.0.
They tested unsupported Python 3.6, and were missing the supported Python 3.9.
We could have kept the two lists, but that would mean we need both an exclude (3.6) and an include (3.9).
So instead I specify all valid combinations explicitly.

Files changed:
A news/1356.bugfix
M .github/workflows/tests.yml
M plone-6.0.x.cfg

b'diff --git a/.github/workflows/tests.yml b/.github/workflows/tests.yml\nindex 7cde66b33..5e7a4dff2 100644\n--- a/.github/workflows/tests.yml\n+++ b/.github/workflows/tests.yml\n@@ -6,8 +6,19 @@ jobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        python-version: [3.8, 3.7, 3.6]\n-        plone-version: ["6.0", "5.2"]\n+        include:\n+          - python-version: \'3.6\'\n+            plone-version: \'5.2\'\n+          - python-version: \'3.7\'\n+            plone-version: \'5.2\'\n+          - python-version: \'3.8\'\n+            plone-version: \'5.2\'\n+          - python-version: \'3.7\'\n+            plone-version: \'6.0\'\n+          - python-version: \'3.8\'\n+            plone-version: \'6.0\'\n+          - python-version: \'3.9\'\n+            plone-version: \'6.0\'\n \n     steps:\n       # git checkout\ndiff --git a/news/1356.bugfix b/news/1356.bugfix\nnew file mode 100644\nindex 000000000..11695ce9e\n--- /dev/null\n+++ b/news/1356.bugfix\n@@ -0,0 +1,2 @@\n+Fix testing matrix to use correct combos of Python and Plone.\n+[maurits]\ndiff --git a/plone-6.0.x.cfg b/plone-6.0.x.cfg\nindex 1360f78d2..d7ab95c37 100644\n--- a/plone-6.0.x.cfg\n+++ b/plone-6.0.x.cfg\n@@ -14,11 +14,21 @@ Products.CMFPlone = git https://github.com/plone/Products.CMFPlone.git\n [instance]\n recipe = plone.recipe.zope2instance\n zodb-temporary-storage = off\n+# On March 24 2022, all ES6 stuff was merged.\n+# Since then, mockup is no longer a Python package and is not pulled in by CMFPlone\n+# The plone.app.widgets pinned in 6.0.0a3 still tries to import it.\n+# So temporarily include the egg explicitly, until Plone 6.0.0a4 is out.\n+# Alternative would be to add plone.app.widgets to the checkouts.\n+eggs += mockup\n \n [versions]\n # we need the new traversal\n plone.rest = 2.0.0a3\n \n+# We need newer plone.app.testing to fix test setup errors like this:\n+# ZODB.POSException.POSKeyError: \'RequestContainer\' object has no attribute \'adapters\'\n+plone.app.testing = 7.0.0a2\n+\n black = 21.7b0\n \n # cffi 1.14.3 fails on apple m1\n'

