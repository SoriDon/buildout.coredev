Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2017-10-22T12:48:30+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.portlets/commit/e8a7cfae2d962cff0220302e6ca24784f310082f

Imports are Python3 compatible

Files changed:
M CHANGES.rst
M plone/app/portlets/exportimport/portlets.py
M plone/app/portlets/tests/test_actions_portlet.py
M plone/app/portlets/tests/test_exportimport.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 399c48a..b4befba 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,8 @@ New features:
 
 Bug fixes:
 
+- Imports are Python3 compatible
+  [ale-rt]
 - base.Renderer no longer mixes in Acquisition.Explicit,
   so attributes of the renderer will no longer be wrapped.
   [davisagli]
diff --git a/plone/app/portlets/exportimport/portlets.py b/plone/app/portlets/exportimport/portlets.py
index be7e718..71ebaf6 100644
--- a/plone/app/portlets/exportimport/portlets.py
+++ b/plone/app/portlets/exportimport/portlets.py
@@ -78,57 +78,46 @@
 """  # noqa
 
 from operator import attrgetter
-
-from zope.interface import implementer
-from zope.interface import Interface
-from zope.interface import alsoProvides
-from zope.interface import providedBy
-
+from plone.app.portlets.exportimport.interfaces import IPortletAssignmentExportImportHandler
+from plone.app.portlets.interfaces import IDefaultPortletManager
+from plone.app.portlets.interfaces import IPortletTypeInterface
+from plone.app.portlets.utils import assignment_mapping_from_key
+from plone.portlets.constants import CONTENT_TYPE_CATEGORY
+from plone.portlets.constants import CONTEXT_CATEGORY
+from plone.portlets.constants import GROUP_CATEGORY
+from plone.portlets.constants import USER_CATEGORY
+from plone.portlets.interfaces import ILocalPortletAssignmentManager
+from plone.portlets.interfaces import IPortletAssignmentMapping
+from plone.portlets.interfaces import IPortletAssignmentSettings
+from plone.portlets.interfaces import IPortletManager
+from plone.portlets.interfaces import IPortletManagerRenderer
+from plone.portlets.interfaces import IPortletType
+from plone.portlets.manager import PortletManager
+from plone.portlets.registration import PortletType
+from plone.portlets.storage import PortletCategoryMapping
+from Products.GenericSetup.interfaces import IBody
+from Products.GenericSetup.interfaces import ISetupEnviron
+from Products.GenericSetup.utils import _getDottedName
+from Products.GenericSetup.utils import _resolveDottedName
+from Products.GenericSetup.utils import XMLAdapterBase
 from zope.component import adapts
 from zope.component import getSiteManager
 from zope.component import getUtilitiesFor
+from zope.component import getUtility
 from zope.component import queryMultiAdapter
 from zope.component import queryUtility
-from zope.component import getUtility
-
-from zope.component.interfaces import IFactory
 from zope.component.interfaces import IComponentRegistry
-
-from zope.schema.interfaces import IField
+from zope.component.interfaces import IFactory
+from zope.container.interfaces import INameChooser
+from zope.interface import alsoProvides
+from zope.interface import implementer
+from zope.interface import Interface
+from zope.interface import providedBy
 from zope.schema.interfaces import ICollection
+from zope.schema.interfaces import IField
 from zope.schema.interfaces import IFromUnicode
 
-from zope.container.interfaces import INameChooser
-
-from Products.GenericSetup.interfaces import IBody
-from Products.GenericSetup.interfaces import ISetupEnviron
-
-from Products.GenericSetup.utils import XMLAdapterBase
-from Products.GenericSetup.utils import _getDottedName
-from Products.GenericSetup.utils import _resolveDottedName
-
-from plone.portlets.interfaces import IPortletType
-from plone.portlets.interfaces import IPortletManager
-from plone.portlets.interfaces import IPortletManagerRenderer
-from plone.portlets.interfaces import ILocalPortletAssignmentManager
-from plone.portlets.interfaces import IPortletAssignmentMapping
-from plone.portlets.interfaces import IPortletAssignmentSettings
-
-from plone.app.portlets.interfaces import IDefaultPortletManager
-from plone.app.portlets.interfaces import IPortletTypeInterface
-from plone.app.portlets.utils import assignment_mapping_from_key
-
-from plone.app.portlets.exportimport.interfaces import IPortletAssignmentExportImportHandler
-
-from plone.portlets.constants import USER_CATEGORY
-from plone.portlets.constants import GROUP_CATEGORY
-from plone.portlets.constants import CONTENT_TYPE_CATEGORY
-from plone.portlets.constants import CONTEXT_CATEGORY
-
-from plone.portlets.manager import PortletManager
-from plone.portlets.storage import PortletCategoryMapping
-from plone.portlets.registration import PortletType
-
+import six
 
 
 def dummyGetId():
@@ -235,7 +224,7 @@ def export_field(self, doc, field):
                     list_element.appendChild(doc.createTextNode(str(e)))
                     child.appendChild(list_element)
             else:
-                child.appendChild(doc.createTextNode(unicode(value)))
+                child.appendChild(doc.createTextNode(six.text_type(value)))
 
         return child
 
diff --git a/plone/app/portlets/tests/test_actions_portlet.py b/plone/app/portlets/tests/test_actions_portlet.py
index d8ba2ab..9d84703 100644
--- a/plone/app/portlets/tests/test_actions_portlet.py
+++ b/plone/app/portlets/tests/test_actions_portlet.py
@@ -1,19 +1,19 @@
 # -*- coding: utf-8 -*-
-from zope.component import getUtility, getMultiAdapter
-
-from plone.portlets.interfaces import IPortletType
-from plone.portlets.interfaces import IPortletManager
-from plone.portlets.interfaces import IPortletAssignment
-from plone.portlets.interfaces import IPortletDataProvider
-from plone.portlets.interfaces import IPortletRenderer
-
 from plone.app.portlets.portlets import actions
-
 from plone.app.portlets.storage import PortletAssignmentMapping
 from plone.app.portlets.tests.base import PortletsTestCase
-from plone.app.testing import TEST_USER_ID
 from plone.app.testing import setRoles
+from plone.app.testing import TEST_USER_ID
+from plone.portlets.interfaces import IPortletAssignment
+from plone.portlets.interfaces import IPortletDataProvider
+from plone.portlets.interfaces import IPortletManager
+from plone.portlets.interfaces import IPortletRenderer
+from plone.portlets.interfaces import IPortletType
 from Products.CMFCore.utils import getToolByName
+from zope.component import getMultiAdapter
+from zope.component import getUtility
+
+import six
 
 
 class TestPortlet(PortletsTestCase):
@@ -174,7 +174,7 @@ def test_portal_tabs(self):
 
         # Have our expected tabs ?
         expected = set([u'Test Folder', u'Home', u'Users', u'News', u'Events'])
-        got = set([unicode(link['title']) for link in output])
+        got = set([six.text_type(link['title']) for link in output])
         self.failUnlessEqual(got, expected)
 
     def test_object_buttons(self):
@@ -189,7 +189,7 @@ def test_object_buttons(self):
 
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
-        got = set([unicode(link['title']) for link in output])
+        got = set([six.text_type(link['title']) for link in output])
         self.failUnlessEqual(got, expected)
 
     def test_category(self):
@@ -219,5 +219,5 @@ def test_object_buttons_with_icons(self):
 
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
-        got = set([unicode(link['title']) for link in output])
+        got = set([six.text_type(link['title']) for link in output])
         self.failUnlessEqual(got, expected)
diff --git a/plone/app/portlets/tests/test_exportimport.py b/plone/app/portlets/tests/test_exportimport.py
index ba651b1..ab4af6b 100644
--- a/plone/app/portlets/tests/test_exportimport.py
+++ b/plone/app/portlets/tests/test_exportimport.py
@@ -1,19 +1,4 @@
 # -*- coding: utf-8 -*-
-from StringIO import StringIO
-
-from zope.component import getSiteManager
-from zope.component import getUtility
-from zope.component import queryUtility
-from zope.i18nmessageid import Message
-from zope.interface import Interface
-
-from xml.dom.minidom import parseString
-
-from Products.GenericSetup.testing import DummySetupEnviron
-
-from plone.portlets.interfaces import IPortletManager
-from plone.portlets.interfaces import IPortletType
-from plone.portlets.manager import PortletManager
 
 from plone.app.portlets.exportimport.portlets import PortletsXMLAdapter
 from plone.app.portlets.interfaces import IColumn
@@ -21,6 +6,16 @@
 from plone.app.portlets.interfaces import IDefaultPortletManager
 from plone.app.portlets.tests.base import PortletsTestCase
 from plone.app.portlets.tests.utils import FooPortletManager
+from plone.portlets.interfaces import IPortletManager
+from plone.portlets.interfaces import IPortletType
+from plone.portlets.manager import PortletManager
+from Products.GenericSetup.testing import DummySetupEnviron
+from six import StringIO
+from xml.dom.minidom import parseString
+from zope.component import getSiteManager
+from zope.component import getUtility
+from zope.component import queryUtility
+from zope.i18nmessageid import Message
 
 
 class PortletsExportImportTestCase(PortletsTestCase):
diff --git a/setup.py b/setup.py
index bba16f9..6581ec4 100644
--- a/setup.py
+++ b/setup.py
@@ -2,6 +2,7 @@
 from setuptools import find_packages
 from setuptools import setup
 
+
 version = '4.3.2.dev0'
 
 setup(
@@ -47,6 +48,7 @@
         'plone.app.layout >= 1.2dev',
         'plone.app.vocabularies >= 2.1.15.dev0',
         'plone.app.z3cform',
+        'six',
         'transaction',
         'zope.annotation',
         'zope.browser',


Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2018-02-06T11:00:14+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.portlets/commit/a82beccb9cfe5bc1974e60d4a7528c7d3a18f90e

Merge pull request #104 from plone/py3_imports

Imports are Python3 compatible

Files changed:
M CHANGES.rst
M plone/app/portlets/exportimport/portlets.py
M plone/app/portlets/tests/test_actions_portlet.py
M plone/app/portlets/tests/test_exportimport.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 399c48a..b4befba 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,8 @@ New features:
 
 Bug fixes:
 
+- Imports are Python3 compatible
+  [ale-rt]
 - base.Renderer no longer mixes in Acquisition.Explicit,
   so attributes of the renderer will no longer be wrapped.
   [davisagli]
diff --git a/plone/app/portlets/exportimport/portlets.py b/plone/app/portlets/exportimport/portlets.py
index be7e718..71ebaf6 100644
--- a/plone/app/portlets/exportimport/portlets.py
+++ b/plone/app/portlets/exportimport/portlets.py
@@ -78,57 +78,46 @@
 """  # noqa
 
 from operator import attrgetter
-
-from zope.interface import implementer
-from zope.interface import Interface
-from zope.interface import alsoProvides
-from zope.interface import providedBy
-
+from plone.app.portlets.exportimport.interfaces import IPortletAssignmentExportImportHandler
+from plone.app.portlets.interfaces import IDefaultPortletManager
+from plone.app.portlets.interfaces import IPortletTypeInterface
+from plone.app.portlets.utils import assignment_mapping_from_key
+from plone.portlets.constants import CONTENT_TYPE_CATEGORY
+from plone.portlets.constants import CONTEXT_CATEGORY
+from plone.portlets.constants import GROUP_CATEGORY
+from plone.portlets.constants import USER_CATEGORY
+from plone.portlets.interfaces import ILocalPortletAssignmentManager
+from plone.portlets.interfaces import IPortletAssignmentMapping
+from plone.portlets.interfaces import IPortletAssignmentSettings
+from plone.portlets.interfaces import IPortletManager
+from plone.portlets.interfaces import IPortletManagerRenderer
+from plone.portlets.interfaces import IPortletType
+from plone.portlets.manager import PortletManager
+from plone.portlets.registration import PortletType
+from plone.portlets.storage import PortletCategoryMapping
+from Products.GenericSetup.interfaces import IBody
+from Products.GenericSetup.interfaces import ISetupEnviron
+from Products.GenericSetup.utils import _getDottedName
+from Products.GenericSetup.utils import _resolveDottedName
+from Products.GenericSetup.utils import XMLAdapterBase
 from zope.component import adapts
 from zope.component import getSiteManager
 from zope.component import getUtilitiesFor
+from zope.component import getUtility
 from zope.component import queryMultiAdapter
 from zope.component import queryUtility
-from zope.component import getUtility
-
-from zope.component.interfaces import IFactory
 from zope.component.interfaces import IComponentRegistry
-
-from zope.schema.interfaces import IField
+from zope.component.interfaces import IFactory
+from zope.container.interfaces import INameChooser
+from zope.interface import alsoProvides
+from zope.interface import implementer
+from zope.interface import Interface
+from zope.interface import providedBy
 from zope.schema.interfaces import ICollection
+from zope.schema.interfaces import IField
 from zope.schema.interfaces import IFromUnicode
 
-from zope.container.interfaces import INameChooser
-
-from Products.GenericSetup.interfaces import IBody
-from Products.GenericSetup.interfaces import ISetupEnviron
-
-from Products.GenericSetup.utils import XMLAdapterBase
-from Products.GenericSetup.utils import _getDottedName
-from Products.GenericSetup.utils import _resolveDottedName
-
-from plone.portlets.interfaces import IPortletType
-from plone.portlets.interfaces import IPortletManager
-from plone.portlets.interfaces import IPortletManagerRenderer
-from plone.portlets.interfaces import ILocalPortletAssignmentManager
-from plone.portlets.interfaces import IPortletAssignmentMapping
-from plone.portlets.interfaces import IPortletAssignmentSettings
-
-from plone.app.portlets.interfaces import IDefaultPortletManager
-from plone.app.portlets.interfaces import IPortletTypeInterface
-from plone.app.portlets.utils import assignment_mapping_from_key
-
-from plone.app.portlets.exportimport.interfaces import IPortletAssignmentExportImportHandler
-
-from plone.portlets.constants import USER_CATEGORY
-from plone.portlets.constants import GROUP_CATEGORY
-from plone.portlets.constants import CONTENT_TYPE_CATEGORY
-from plone.portlets.constants import CONTEXT_CATEGORY
-
-from plone.portlets.manager import PortletManager
-from plone.portlets.storage import PortletCategoryMapping
-from plone.portlets.registration import PortletType
-
+import six
 
 
 def dummyGetId():
@@ -235,7 +224,7 @@ def export_field(self, doc, field):
                     list_element.appendChild(doc.createTextNode(str(e)))
                     child.appendChild(list_element)
             else:
-                child.appendChild(doc.createTextNode(unicode(value)))
+                child.appendChild(doc.createTextNode(six.text_type(value)))
 
         return child
 
diff --git a/plone/app/portlets/tests/test_actions_portlet.py b/plone/app/portlets/tests/test_actions_portlet.py
index d8ba2ab..9d84703 100644
--- a/plone/app/portlets/tests/test_actions_portlet.py
+++ b/plone/app/portlets/tests/test_actions_portlet.py
@@ -1,19 +1,19 @@
 # -*- coding: utf-8 -*-
-from zope.component import getUtility, getMultiAdapter
-
-from plone.portlets.interfaces import IPortletType
-from plone.portlets.interfaces import IPortletManager
-from plone.portlets.interfaces import IPortletAssignment
-from plone.portlets.interfaces import IPortletDataProvider
-from plone.portlets.interfaces import IPortletRenderer
-
 from plone.app.portlets.portlets import actions
-
 from plone.app.portlets.storage import PortletAssignmentMapping
 from plone.app.portlets.tests.base import PortletsTestCase
-from plone.app.testing import TEST_USER_ID
 from plone.app.testing import setRoles
+from plone.app.testing import TEST_USER_ID
+from plone.portlets.interfaces import IPortletAssignment
+from plone.portlets.interfaces import IPortletDataProvider
+from plone.portlets.interfaces import IPortletManager
+from plone.portlets.interfaces import IPortletRenderer
+from plone.portlets.interfaces import IPortletType
 from Products.CMFCore.utils import getToolByName
+from zope.component import getMultiAdapter
+from zope.component import getUtility
+
+import six
 
 
 class TestPortlet(PortletsTestCase):
@@ -174,7 +174,7 @@ def test_portal_tabs(self):
 
         # Have our expected tabs ?
         expected = set([u'Test Folder', u'Home', u'Users', u'News', u'Events'])
-        got = set([unicode(link['title']) for link in output])
+        got = set([six.text_type(link['title']) for link in output])
         self.failUnlessEqual(got, expected)
 
     def test_object_buttons(self):
@@ -189,7 +189,7 @@ def test_object_buttons(self):
 
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
-        got = set([unicode(link['title']) for link in output])
+        got = set([six.text_type(link['title']) for link in output])
         self.failUnlessEqual(got, expected)
 
     def test_category(self):
@@ -219,5 +219,5 @@ def test_object_buttons_with_icons(self):
 
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
-        got = set([unicode(link['title']) for link in output])
+        got = set([six.text_type(link['title']) for link in output])
         self.failUnlessEqual(got, expected)
diff --git a/plone/app/portlets/tests/test_exportimport.py b/plone/app/portlets/tests/test_exportimport.py
index ba651b1..ab4af6b 100644
--- a/plone/app/portlets/tests/test_exportimport.py
+++ b/plone/app/portlets/tests/test_exportimport.py
@@ -1,19 +1,4 @@
 # -*- coding: utf-8 -*-
-from StringIO import StringIO
-
-from zope.component import getSiteManager
-from zope.component import getUtility
-from zope.component import queryUtility
-from zope.i18nmessageid import Message
-from zope.interface import Interface
-
-from xml.dom.minidom import parseString
-
-from Products.GenericSetup.testing import DummySetupEnviron
-
-from plone.portlets.interfaces import IPortletManager
-from plone.portlets.interfaces import IPortletType
-from plone.portlets.manager import PortletManager
 
 from plone.app.portlets.exportimport.portlets import PortletsXMLAdapter
 from plone.app.portlets.interfaces import IColumn
@@ -21,6 +6,16 @@
 from plone.app.portlets.interfaces import IDefaultPortletManager
 from plone.app.portlets.tests.base import PortletsTestCase
 from plone.app.portlets.tests.utils import FooPortletManager
+from plone.portlets.interfaces import IPortletManager
+from plone.portlets.interfaces import IPortletType
+from plone.portlets.manager import PortletManager
+from Products.GenericSetup.testing import DummySetupEnviron
+from six import StringIO
+from xml.dom.minidom import parseString
+from zope.component import getSiteManager
+from zope.component import getUtility
+from zope.component import queryUtility
+from zope.i18nmessageid import Message
 
 
 class PortletsExportImportTestCase(PortletsTestCase):
diff --git a/setup.py b/setup.py
index 0ca169f..aacab0a 100644
--- a/setup.py
+++ b/setup.py
@@ -2,6 +2,7 @@
 from setuptools import find_packages
 from setuptools import setup
 
+
 version = '4.3.2.dev0'
 
 setup(
@@ -47,6 +48,7 @@
         'plone.app.layout >= 1.2dev',
         'plone.app.vocabularies >= 2.1.15.dev0',
         'plone.app.z3cform',
+        'six',
         'transaction',
         'zope.annotation',
         'zope.browser',


