Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-07-25T17:27:59+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/3b694d1dd4d234f9c9cc568c388cb5b18231d76d

Makefile BASEDIR optimization, so it runs on first too

Files changed:
M Products/CMFPlone/static/Makefile

diff --git a/Products/CMFPlone/static/Makefile b/Products/CMFPlone/static/Makefile
index 4bec6b2..e016028 100644
--- a/Products/CMFPlone/static/Makefile
+++ b/Products/CMFPlone/static/Makefile
@@ -33,9 +33,12 @@ fontsave:
 		${FONTELLO_HOST}/`cat .fontello`/get
 	unzip .fontello.zip -d .fontello.src
 	mkdir -p ${FONT_DIR}
-	$(eval BASEDIR := $(shell find ./.fontello.src -maxdepth 1 -name 'fontello-*'))
-	cp ${BASEDIR}/config.json ${FONT_DIR}/config.json
-	cp ${BASEDIR}/font/* ${FONT_DIR}/
-	cp ${BASEDIR}/css/fontello.css ${FONT_DIR}/fontello.less 
-	sed -i.bak 's/\.\.\/font\//\@\{fontsPrefix\}plone-/g' fonts/plone-fontello.less
-	rm -rf .fontello.src .fontello.zip .fontello
+	{ \
+        set -e ;\
+	BASEDIR=$$(find ./.fontello.src -maxdepth 1 -name 'fontello-*');\
+	echo Unzipped font in $$BASEDIR;\
+	cp $$BASEDIR/config.json ${FONT_DIR}/config.json;\
+	cp $$BASEDIR/font/* ${FONT_DIR}/;\
+	sed 's/\.\.\/font\//\@\{fontsPrefix\}plone-/g' $$BASEDIR/css/fontello.css >${FONT_DIR}/fontello.less;\
+	rm -rf .fontello.src .fontello.zip ;\
+        }


