Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-10-08T21:38:05+02:00
Author: Jefferson Bledsoe (JeffersonBledsoe) <me@jeffersonbledsoe.com>
Commit: https://github.com/plone/plone.restapi/commit/f5758140d49abdb602cbd3198626fd66871e9b1a

Fix description field missing from form fieldset descriptions (#1499)

* Include description in fieldsets

* Return empty string if no description

* Changelog

* Update tests

* Fix "None" when description is empty

Co-authored-by: Timo Stollenwerk &lt;tisto@users.noreply.github.com&gt;

Files changed:
A news/1499.bugfix
M src/plone/restapi/tests/http-examples/translated_messages_types_folder.resp
M src/plone/restapi/tests/http-examples/types_document.resp
M src/plone/restapi/types/utils.py

b'diff --git a/news/1499.bugfix b/news/1499.bugfix\nnew file mode 100644\nindex 000000000..f985ad41a\n--- /dev/null\n+++ b/news/1499.bugfix\n@@ -0,0 +1,2 @@\n+Fixed the `description` field not being included in fieldsets\n+[JeffersonBledsoe]\ndiff --git a/src/plone/restapi/tests/http-examples/translated_messages_types_folder.resp b/src/plone/restapi/tests/http-examples/translated_messages_types_folder.resp\nindex 7028f92d5..7695f49a0 100644\n--- a/src/plone/restapi/tests/http-examples/translated_messages_types_folder.resp\n+++ b/src/plone/restapi/tests/http-examples/translated_messages_types_folder.resp\n@@ -14,6 +14,7 @@ Content-Type: application/json+schema\n         },\n         {\n             "behavior": "plone",\n+            "description": "",\n             "fields": [\n                 "subjects",\n                 "language",\n@@ -24,6 +25,7 @@ Content-Type: application/json+schema\n         },\n         {\n             "behavior": "plone",\n+            "description": "",\n             "fields": [\n                 "effective",\n                 "expires"\n@@ -33,6 +35,7 @@ Content-Type: application/json+schema\n         },\n         {\n             "behavior": "plone",\n+            "description": "",\n             "fields": [\n                 "creators",\n                 "contributors",\n@@ -43,6 +46,7 @@ Content-Type: application/json+schema\n         },\n         {\n             "behavior": "plone",\n+            "description": "",\n             "fields": [\n                 "allow_discussion",\n                 "exclude_from_nav",\ndiff --git a/src/plone/restapi/tests/http-examples/types_document.resp b/src/plone/restapi/tests/http-examples/types_document.resp\nindex ddb61a645..6400637e4 100644\n--- a/src/plone/restapi/tests/http-examples/types_document.resp\n+++ b/src/plone/restapi/tests/http-examples/types_document.resp\n@@ -17,6 +17,7 @@ Content-Type: application/json+schema\n         },\n         {\n             "behavior": "plone",\n+            "description": "",\n             "fields": [\n                 "allow_discussion",\n                 "exclude_from_nav",\n@@ -29,6 +30,7 @@ Content-Type: application/json+schema\n         },\n         {\n             "behavior": "plone",\n+            "description": "",\n             "fields": [\n                 "subjects",\n                 "language",\n@@ -39,6 +41,7 @@ Content-Type: application/json+schema\n         },\n         {\n             "behavior": "plone",\n+            "description": "",\n             "fields": [\n                 "effective",\n                 "expires"\n@@ -48,6 +51,7 @@ Content-Type: application/json+schema\n         },\n         {\n             "behavior": "plone",\n+            "description": "",\n             "fields": [\n                 "creators",\n                 "contributors",\ndiff --git a/src/plone/restapi/types/utils.py b/src/plone/restapi/types/utils.py\nindex 756fe2d38..5473280fd 100644\n--- a/src/plone/restapi/types/utils.py\n+++ b/src/plone/restapi/types/utils.py\n@@ -119,6 +119,9 @@ def get_form_fieldsets(form):\n         fieldset = {\n             "id": group.__name__,\n             "title": translate(group.label, context=getRequest()),\n+            "description": translate(group.description, context=getRequest())\n+            if group.description is not None\n+            else "",\n             "fields": list(group.fields.values()),\n             "behavior": "plone",\n         }\n'

