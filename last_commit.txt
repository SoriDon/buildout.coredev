Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-07-11T12:08:09+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/5384b810da85fa21aea87c117f60a804d7340061

add test to show problem of #2469, Subobjects are indexing attributes of parent

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testCatalogTool.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 190e842e1..d891b68cf 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -25,6 +25,18 @@ Breaking changes:\n \n - Some tools from CMFCore are now utilities\n   [pbauer]\n+- *add item here*\n+\n+Bug fixes:\n+\n+- Add test for issue #2469.\n+  [jensens]\n+\n+\n+5.1.3 (2018-06-22)\n+------------------\n+\n+Breaking changes:\n \n - Remove five.pt for Zope 4\n   [jensens]\ndiff --git a/Products/CMFPlone/tests/testCatalogTool.py b/Products/CMFPlone/tests/testCatalogTool.py\nindex c64e08ff4..fdf695cc8 100644\n--- a/Products/CMFPlone/tests/testCatalogTool.py\n+++ b/Products/CMFPlone/tests/testCatalogTool.py\n@@ -339,6 +339,20 @@ def testClearFindAndRebuildKeepsModificationDate(self):\n         self.assertEqual(self.folder.doc.modified(), DateTime(0))\n         self.assertEqual(len(self.catalog(modified=DateTime(0))), 1)\n \n+    def test_acquired_attributes_are_not_indexed(self):\n+        # create an index for foo:\n+        # from Products.PluginIndexes.FieldIndex.FieldIndex import FieldIndex\n+        self.catalog.addIndex('foo', 'FieldIndex')\n+\n+        # create attribute foo on folder and index on both, folder and\n+        # contained\n+        self.folder.foo = 'FOO'\n+        self.catalog.clearFindAndRebuild()\n+\n+        # lets see if we have one result for folder, but nothing for doc:\n+        brains = self.catalog(foo='FOO')\n+        self.assertEqual(len(brains), 1)\n+\n \n class TestCatalogSearching(PloneTestCase):\n \n"

