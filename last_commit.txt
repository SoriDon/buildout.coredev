Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-04-15T17:20:34+02:00
Author: Malthe Borch (malthe) <mborch@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/b81f79fb47d715c32bebd6a02fff1f526ba62c7e

Don't set "path" for Plone site root

It doesn't make sense to add a path query targeting the site root â€“ that's a "noop", only making things slower.

Files changed:
M Products/CMFPlone/browser/search.py

b"diff --git a/Products/CMFPlone/browser/search.py b/Products/CMFPlone/browser/search.py\nindex 4d3e25cd2d..3126077306 100644\n--- a/Products/CMFPlone/browser/search.py\n+++ b/Products/CMFPlone/browser/search.py\n@@ -6,6 +6,7 @@\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.browser.navtree import getNavigationRoot\n+from Products.CMFPlone.interfaces import IPloneSiteRoot\n from Products.ZCTextIndex.ParseTree import ParseError\n from zope.cachedescriptors.property import Lazy as lazy_property\n from zope.component import getMultiAdapter\n@@ -142,8 +143,8 @@ def _filter_query(self, query):\n         query['portal_type'] = self.filter_types(types)\n         # respect effective/expiration date\n         query['show_inactive'] = False\n-        # respect navigation root\n-        if 'path' not in query:\n+        # respect navigation root if we're not at the site root.\n+        if 'path' not in query and not IPloneSiteRoot.providedBy(self.context):\n             query['path'] = getNavigationRoot(self.context)\n \n         if 'sort_order' in query and not query['sort_order']:\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-04-15T17:20:34+02:00
Author: Malthe Borch (malthe) <mborch@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/265a70f12c137abf0480fac8947a9d822e5057d0

Added changelog entry

Files changed:
A news/3753.bugfix

b'diff --git a/news/3753.bugfix b/news/3753.bugfix\nnew file mode 100644\nindex 0000000000..3069245b55\n--- /dev/null\n+++ b/news/3753.bugfix\n@@ -0,0 +1,2 @@\n+Removed path query from search view when context is site root.\n+[malthe]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-04-15T17:20:34+02:00
Author: Malthe Borch (malthe) <mborch@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/64cb7cb9adf18e6304ec1cc3a9f5f3a9ad79b689

Fix import location

Files changed:
M Products/CMFPlone/browser/search.py

b'diff --git a/Products/CMFPlone/browser/search.py b/Products/CMFPlone/browser/search.py\nindex 3126077306..902d052720 100644\n--- a/Products/CMFPlone/browser/search.py\n+++ b/Products/CMFPlone/browser/search.py\n@@ -2,11 +2,11 @@\n from plone.app.contentlisting.interfaces import IContentListing\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.base.batch import Batch\n+from plone.base.interfaces.siteroot import IPloneSiteRoot\n from plone.base.interfaces import ISearchSchema\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.browser.navtree import getNavigationRoot\n-from Products.CMFPlone.interfaces import IPloneSiteRoot\n from Products.ZCTextIndex.ParseTree import ParseError\n from zope.cachedescriptors.property import Lazy as lazy_property\n from zope.component import getMultiAdapter\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-04-17T12:43:58+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/5dcc78f4aa73007e2c50fc4caed183da8b9f0944

Merge pull request #3753 from plone/patch/search-root-path

Don't set "path" for Plone site root

Files changed:
A news/3753.bugfix
M Products/CMFPlone/browser/search.py

b"diff --git a/Products/CMFPlone/browser/search.py b/Products/CMFPlone/browser/search.py\nindex 4d3e25cd2d..902d052720 100644\n--- a/Products/CMFPlone/browser/search.py\n+++ b/Products/CMFPlone/browser/search.py\n@@ -2,6 +2,7 @@\n from plone.app.contentlisting.interfaces import IContentListing\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.base.batch import Batch\n+from plone.base.interfaces.siteroot import IPloneSiteRoot\n from plone.base.interfaces import ISearchSchema\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n@@ -142,8 +143,8 @@ def _filter_query(self, query):\n         query['portal_type'] = self.filter_types(types)\n         # respect effective/expiration date\n         query['show_inactive'] = False\n-        # respect navigation root\n-        if 'path' not in query:\n+        # respect navigation root if we're not at the site root.\n+        if 'path' not in query and not IPloneSiteRoot.providedBy(self.context):\n             query['path'] = getNavigationRoot(self.context)\n \n         if 'sort_order' in query and not query['sort_order']:\ndiff --git a/news/3753.bugfix b/news/3753.bugfix\nnew file mode 100644\nindex 0000000000..3069245b55\n--- /dev/null\n+++ b/news/3753.bugfix\n@@ -0,0 +1,2 @@\n+Removed path query from search view when context is site root.\n+[malthe]\n"

