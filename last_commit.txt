Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2016-02-16T11:36:04+01:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/1368e35abbfc464659e2b210231a8d247eee3aee

fix: set path to navigation root by default

Files changed:
M CHANGES.rst
M plone/app/querystring/querybuilder.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b07fa6a..19f7936 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Set path to navigation root by default to have the same results
+  in Collection preview and view.
+  [Gagaro]
 
 
 1.3.13 (2016-02-14)
diff --git a/plone/app/querystring/querybuilder.py b/plone/app/querystring/querybuilder.py
index 9b65380..dd6522d 100644
--- a/plone/app/querystring/querybuilder.py
+++ b/plone/app/querystring/querybuilder.py
@@ -105,6 +105,20 @@ def _makequery(self, query=None, batch=False, b_start=0, b_size=30,
                    sort_on=None, sort_order=None, limit=0, brains=False,
                    custom_query=None):
         """Parse the (form)query and return using multi-adapter"""
+        # Reproduce path behaviours of Collection
+        # See p.a.contenttypes.behaviours.collection.Collection
+        if query:
+            has_path_criteria = any(
+                (criteria['i'] == 'path')
+                for criteria in query
+            )
+            if not has_path_criteria:
+                query.append({
+                    'i': 'path',
+                    'o': 'plone.app.querystring.operation.string.path',
+                    'v': '/',
+                })
+
         parsedquery = queryparser.parseFormquery(
             self.context, query, sort_on, sort_order)
 


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2016-02-16T13:38:28+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.querystring/commit/db9ffe5a077ddb8bf45952ad56c450b51d383f28

Merge pull request #59 from plone/fix-default-path

fix: set path to navigation root by default

Files changed:
M CHANGES.rst
M plone/app/querystring/querybuilder.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b07fa6a..19f7936 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Set path to navigation root by default to have the same results
+  in Collection preview and view.
+  [Gagaro]
 
 
 1.3.13 (2016-02-14)
diff --git a/plone/app/querystring/querybuilder.py b/plone/app/querystring/querybuilder.py
index 9b65380..dd6522d 100644
--- a/plone/app/querystring/querybuilder.py
+++ b/plone/app/querystring/querybuilder.py
@@ -105,6 +105,20 @@ def _makequery(self, query=None, batch=False, b_start=0, b_size=30,
                    sort_on=None, sort_order=None, limit=0, brains=False,
                    custom_query=None):
         """Parse the (form)query and return using multi-adapter"""
+        # Reproduce path behaviours of Collection
+        # See p.a.contenttypes.behaviours.collection.Collection
+        if query:
+            has_path_criteria = any(
+                (criteria['i'] == 'path')
+                for criteria in query
+            )
+            if not has_path_criteria:
+                query.append({
+                    'i': 'path',
+                    'o': 'plone.app.querystring.operation.string.path',
+                    'v': '/',
+                })
+
         parsedquery = queryparser.parseFormquery(
             self.context, query, sort_on, sort_order)
 


