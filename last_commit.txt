Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2022-12-14T01:50:14+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.dexterity/commit/19a8951214108f18b65cd9ab631cdee945844617

Use the tal engine to escape HTML via non-structure variable insertion.

Files changed:
A news/359.bugfix.1
M plone/app/dexterity/browser/modeleditor.pt

b'diff --git a/news/359.bugfix.1 b/news/359.bugfix.1\nnew file mode 100644\nindex 00000000..12dbe5ec\n--- /dev/null\n+++ b/news/359.bugfix.1\n@@ -0,0 +1,2 @@\n+Use the tal engine to escape HTML via non-structure variable insertion.\n+[thet]\ndiff --git a/plone/app/dexterity/browser/modeleditor.pt b/plone/app/dexterity/browser/modeleditor.pt\nindex ad1e2202..6dd75296 100644\n--- a/plone/app/dexterity/browser/modeleditor.pt\n+++ b/plone/app/dexterity/browser/modeleditor.pt\n@@ -45,7 +45,7 @@\n       <textarea\n           name="source"\n           class="modeleditor__source pat-code-editor language-xml"\n-          tal:content="structure view/escaped_model_source"></textarea>\n+          tal:content="view/model_source"></textarea>\n \n       <br />\n       \n'

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2023-02-06T13:38:02+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.dexterity/commit/81daf511a8462e33b54e54f153f331e4341c4543

Deprecate ModelEditorView.escaped_model_source which is not needed anymore.

It will be removed in Plone 7.

Files changed:
A news/359.bugfix.2
M plone/app/dexterity/browser/modeleditor.py

b'diff --git a/news/359.bugfix.2 b/news/359.bugfix.2\nnew file mode 100644\nindex 0000000..5a05e18\n--- /dev/null\n+++ b/news/359.bugfix.2\n@@ -0,0 +1,3 @@\n+Deprecate ModelEditorView.escaped_model_source which is not needed anymore.\n+It will be removed in Plone 7.\n+[thet]\ndiff --git a/plone/app/dexterity/browser/modeleditor.py b/plone/app/dexterity/browser/modeleditor.py\nindex bfbe430..3502c3e 100644\n--- a/plone/app/dexterity/browser/modeleditor.py\n+++ b/plone/app/dexterity/browser/modeleditor.py\n@@ -9,6 +9,7 @@\n from Products.Five import BrowserView\n from Products.statusmessages.interfaces import IStatusMessage\n from zope.component import queryMultiAdapter\n+from zope.deprecation import deprecate\n \n import html\n \n@@ -20,6 +21,11 @@ class ModelEditorView(BrowserView):\n     """Editor view."""\n \n     @property\n+    @deprecate(\n+        """`ModelEditorView.escaped_model_source` is deprecated will be removed\n+in Plone 7. Use `model_source` without the `structure` TALES expression\n+instead."""\n+    )\n     def escaped_model_source(self):\n         # Return the HTML escaped model source.\n         return html.escape(self.model_source, False)\n@@ -74,7 +80,6 @@ def __call__(self):\n         save = "form.button.save" in self.request.form\n         source = self._unescaped_source_from_request()\n         if save and source:\n-\n             # First, check for authenticator\n             if not self.authorized(self.context, self.request):\n                 raise Unauthorized\n'

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2023-02-06T13:38:02+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.dexterity/commit/a7eace4f104382e4492d754542c66474f7fe30bb

Restore and deprecate "ModelEditorView.modelSource".

It will be removed in Plone 7.

Files changed:
A news/359.bugfix.3
M plone/app/dexterity/browser/modeleditor.py

b'diff --git a/news/359.bugfix.3 b/news/359.bugfix.3\nnew file mode 100644\nindex 0000000..b2a4e67\n--- /dev/null\n+++ b/news/359.bugfix.3\n@@ -0,0 +1,3 @@\n+Restore and deprecate "ModelEditorView.modelSource".\n+It will be removed in Plone 7.\n+[thet]\ndiff --git a/plone/app/dexterity/browser/modeleditor.py b/plone/app/dexterity/browser/modeleditor.py\nindex 3502c3e..dc2bcf4 100644\n--- a/plone/app/dexterity/browser/modeleditor.py\n+++ b/plone/app/dexterity/browser/modeleditor.py\n@@ -30,6 +30,15 @@ def escaped_model_source(self):\n         # Return the HTML escaped model source.\n         return html.escape(self.model_source, False)\n \n+    @deprecate(\n+        """`ModelEditorView.modelSource` is deprecated and will be removed in\n+Plone 7. Use `model_source` instead.\n+"""\n+    )\n+    def modelSource(self):\n+        # BBB\n+        return self.model_source\n+\n     @property\n     def model_source(self):\n         # Return modified source from textarea or the original FTI source.\n'

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2023-02-06T15:30:14+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.dexterity/commit/495b2f300d2e671bd82dc53439b22d38411bc6d0

Merge pull request #359 from plone/thet-fixes

Modeleditor simplify

Files changed:
A news/359.bugfix.1
A news/359.bugfix.2
A news/359.bugfix.3
M plone/app/dexterity/browser/modeleditor.pt
M plone/app/dexterity/browser/modeleditor.py

b'diff --git a/news/359.bugfix.1 b/news/359.bugfix.1\nnew file mode 100644\nindex 00000000..12dbe5ec\n--- /dev/null\n+++ b/news/359.bugfix.1\n@@ -0,0 +1,2 @@\n+Use the tal engine to escape HTML via non-structure variable insertion.\n+[thet]\ndiff --git a/news/359.bugfix.2 b/news/359.bugfix.2\nnew file mode 100644\nindex 00000000..5a05e18b\n--- /dev/null\n+++ b/news/359.bugfix.2\n@@ -0,0 +1,3 @@\n+Deprecate ModelEditorView.escaped_model_source which is not needed anymore.\n+It will be removed in Plone 7.\n+[thet]\ndiff --git a/news/359.bugfix.3 b/news/359.bugfix.3\nnew file mode 100644\nindex 00000000..b2a4e67f\n--- /dev/null\n+++ b/news/359.bugfix.3\n@@ -0,0 +1,3 @@\n+Restore and deprecate "ModelEditorView.modelSource".\n+It will be removed in Plone 7.\n+[thet]\ndiff --git a/plone/app/dexterity/browser/modeleditor.pt b/plone/app/dexterity/browser/modeleditor.pt\nindex ad1e2202..6dd75296 100644\n--- a/plone/app/dexterity/browser/modeleditor.pt\n+++ b/plone/app/dexterity/browser/modeleditor.pt\n@@ -45,7 +45,7 @@\n       <textarea\n           name="source"\n           class="modeleditor__source pat-code-editor language-xml"\n-          tal:content="structure view/escaped_model_source"></textarea>\n+          tal:content="view/model_source"></textarea>\n \n       <br />\n       \ndiff --git a/plone/app/dexterity/browser/modeleditor.py b/plone/app/dexterity/browser/modeleditor.py\nindex bfbe430e..dc2bcf48 100644\n--- a/plone/app/dexterity/browser/modeleditor.py\n+++ b/plone/app/dexterity/browser/modeleditor.py\n@@ -9,6 +9,7 @@\n from Products.Five import BrowserView\n from Products.statusmessages.interfaces import IStatusMessage\n from zope.component import queryMultiAdapter\n+from zope.deprecation import deprecate\n \n import html\n \n@@ -20,10 +21,24 @@ class ModelEditorView(BrowserView):\n     """Editor view."""\n \n     @property\n+    @deprecate(\n+        """`ModelEditorView.escaped_model_source` is deprecated will be removed\n+in Plone 7. Use `model_source` without the `structure` TALES expression\n+instead."""\n+    )\n     def escaped_model_source(self):\n         # Return the HTML escaped model source.\n         return html.escape(self.model_source, False)\n \n+    @deprecate(\n+        """`ModelEditorView.modelSource` is deprecated and will be removed in\n+Plone 7. Use `model_source` instead.\n+"""\n+    )\n+    def modelSource(self):\n+        # BBB\n+        return self.model_source\n+\n     @property\n     def model_source(self):\n         # Return modified source from textarea or the original FTI source.\n@@ -74,7 +89,6 @@ def __call__(self):\n         save = "form.button.save" in self.request.form\n         source = self._unescaped_source_from_request()\n         if save and source:\n-\n             # First, check for authenticator\n             if not self.authorized(self.context, self.request):\n                 raise Unauthorized\n'

