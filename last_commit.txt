Repository: mockup


Branch: refs/heads/master
Date: 2017-05-04T12:14:01+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/mockup/commit/38a7519fc47d80558451c52c0fa9ac900f13d680

Resolve ajaxUrl later
For ``pat-modal``, let the ajax modal variant acquire it's ajax url when the modal is shown instead when the pattern is initialized.
This makes the modal respect a dynamically changed href attribute on a anchor tag, after it was initialized.

Files changed:
M CHANGES.rst
M mockup/patterns/modal/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index f2caca0..9d38619 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,6 +10,10 @@ Breaking changes:
 
 New features:
 
+- For ``pat-modal``, let the ajax modal variant acquire it's ajax url when the modal is shown instead when the pattern is initialized.
+  This makes the modal respect a dynamically changed href attribute on a anchor tag, after it was initialized.
+  [thet]
+
 - New pattern ``mockup-patterns-structureupdater`` to update title and description depending on the current context on Plone's folder contents page.
   [thet]
 
diff --git a/mockup/patterns/modal/pattern.js b/mockup/patterns/modal/pattern.js
index 5164493..21673a4 100644
--- a/mockup/patterns/modal/pattern.js
+++ b/mockup/patterns/modal/pattern.js
@@ -545,7 +545,10 @@ define([
             self.options.content = '';
           }
           if (!self.options.ajaxUrl && self.$el.attr('href').substr(0, 1) !== '#') {
-            self.options.ajaxUrl = self.$el.attr('href');
+            self.options.ajaxUrl = function () {
+              // Resolve ``href`` attribute later, when modal is shown.
+              return self.$el.attr('href');
+            };
           }
         }
         self.$el.on('click', function(e) {
@@ -561,8 +564,14 @@ define([
       var self = this;
       self.emit('before-ajax');
       self.loading.show();
+
+      var ajaxUrl = self.options.ajaxUrl;
+      if (typeof ajaxUrl === 'function') {
+        ajaxUrl = ajaxUrl.apply(self, [self.options]);
+      }
+
       self.ajaxXHR = $.ajax({
-        url: self.options.ajaxUrl,
+        url: ajaxUrl,
         type: self.options.ajaxType
       }).done(function(response, textStatus, xhr) {
         self.ajaxXHR = undefined;


Repository: mockup


Branch: refs/heads/master
Date: 2017-05-09T15:45:55+02:00
Author: agitator (agitator) <agitator@users.noreply.github.com>
Commit: https://github.com/plone/mockup/commit/8fcbdcbae225b4f6f14bd9d411c84e4fec63f323

Merge pull request #763 from plone/thet-modalajaxresolve

Resolve ajaxUrl later

Files changed:
M CHANGES.rst
M mockup/patterns/modal/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index f2caca0..9d38619 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,6 +10,10 @@ Breaking changes:
 
 New features:
 
+- For ``pat-modal``, let the ajax modal variant acquire it's ajax url when the modal is shown instead when the pattern is initialized.
+  This makes the modal respect a dynamically changed href attribute on a anchor tag, after it was initialized.
+  [thet]
+
 - New pattern ``mockup-patterns-structureupdater`` to update title and description depending on the current context on Plone's folder contents page.
   [thet]
 
diff --git a/mockup/patterns/modal/pattern.js b/mockup/patterns/modal/pattern.js
index 5164493..21673a4 100644
--- a/mockup/patterns/modal/pattern.js
+++ b/mockup/patterns/modal/pattern.js
@@ -545,7 +545,10 @@ define([
             self.options.content = '';
           }
           if (!self.options.ajaxUrl && self.$el.attr('href').substr(0, 1) !== '#') {
-            self.options.ajaxUrl = self.$el.attr('href');
+            self.options.ajaxUrl = function () {
+              // Resolve ``href`` attribute later, when modal is shown.
+              return self.$el.attr('href');
+            };
           }
         }
         self.$el.on('click', function(e) {
@@ -561,8 +564,14 @@ define([
       var self = this;
       self.emit('before-ajax');
       self.loading.show();
+
+      var ajaxUrl = self.options.ajaxUrl;
+      if (typeof ajaxUrl === 'function') {
+        ajaxUrl = ajaxUrl.apply(self, [self.options]);
+      }
+
       self.ajaxXHR = $.ajax({
-        url: self.options.ajaxUrl,
+        url: ajaxUrl,
         type: self.options.ajaxType
       }).done(function(response, textStatus, xhr) {
         self.ajaxXHR = undefined;


