Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-10-09T12:44:40+02:00
Author: tschorr (tschorr) <t_schorr@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/417e8d9682e81cec868872054e042b2150f9924b

make test more robust

Files changed:
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_usergroups.py

b"diff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_usergroups.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_usergroups.py\nindex ee099614d..e4cad29dc 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_usergroups.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_usergroups.py\n@@ -296,16 +296,19 @@ def test_groups_modify_roles(self):\n \n         # Check that role is not selected yet and then select it and apply it.\n         form = self.browser.getForm(id='groups_search')\n-        ctrl = form._form.get('group_group1:list', index=1)\n-        self.assertEqual(ctrl._value, 'Site Administrator')\n-        self.assertFalse(ctrl.checked)\n-        ctrl.checked = True\n+        ctrls = form._form.fields.get('group_group1:list')\n+        roles = [ctrl._value for ctrl in ctrls]\n+        expected = 'Site Administrator'\n+        self.assertIn(expected, roles)\n+        idx = roles.index(expected)\n+        self.assertFalse(ctrls[idx].checked)\n+        ctrls[idx].checked = True\n         self.browser.getControl('Save').click()\n \n         # Check that role is now selected\n         form = self.browser.getForm(id='groups_search')\n-        ctrl = form._form.get('group_group1:list', index=1)\n-        self.assertEqual(ctrl._value, 'Site Administrator')\n+        ctrl = form._form.get('group_group1:list', index=idx)\n+        self.assertEqual(ctrl._value, expected)\n         self.assertTrue(ctrl.checked)\n \n     def test_groups_delete_group(self):\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-10-09T12:49:21+02:00
Author: tschorr (tschorr) <t_schorr@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/c455b295e967c9b6d39a9af300e8b387e1f861f4

update changelog

Files changed:
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex e6834ab0f..95fda6dd1 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -17,10 +17,10 @@ Breaking changes:\n \n - Removed my_worklist.py skin script. #1801\n   [reinhardt]\n-  \n+\n - Removed getObjectsFromPathList.py skin script. #1801\n   [reinhardt]\n-  \n+\n - Removed redirectToReferrer.py skin script. #1801\n   [tlotze]\n \n@@ -62,6 +62,9 @@ New features:\n \n Bug fixes:\n \n+- make groups_modify_roles test more robust.\n+  [tschorr]\n+\n -- Fix wrong CSS property to allow correct word-break.\n   [tmassman]\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-10-09T14:21:22+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/8358c7cef43a589b7b84119b0fac232cf6b45317

Merge pull request #2587 from plone/more_robust_test_groups_modify_roles

Make test more robust

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_usergroups.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex e6834ab0f..95fda6dd1 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -17,10 +17,10 @@ Breaking changes:\n \n - Removed my_worklist.py skin script. #1801\n   [reinhardt]\n-  \n+\n - Removed getObjectsFromPathList.py skin script. #1801\n   [reinhardt]\n-  \n+\n - Removed redirectToReferrer.py skin script. #1801\n   [tlotze]\n \n@@ -62,6 +62,9 @@ New features:\n \n Bug fixes:\n \n+- make groups_modify_roles test more robust.\n+  [tschorr]\n+\n -- Fix wrong CSS property to allow correct word-break.\n   [tmassman]\n \ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_usergroups.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_usergroups.py\nindex ee099614d..e4cad29dc 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_usergroups.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_usergroups.py\n@@ -296,16 +296,19 @@ def test_groups_modify_roles(self):\n \n         # Check that role is not selected yet and then select it and apply it.\n         form = self.browser.getForm(id='groups_search')\n-        ctrl = form._form.get('group_group1:list', index=1)\n-        self.assertEqual(ctrl._value, 'Site Administrator')\n-        self.assertFalse(ctrl.checked)\n-        ctrl.checked = True\n+        ctrls = form._form.fields.get('group_group1:list')\n+        roles = [ctrl._value for ctrl in ctrls]\n+        expected = 'Site Administrator'\n+        self.assertIn(expected, roles)\n+        idx = roles.index(expected)\n+        self.assertFalse(ctrls[idx].checked)\n+        ctrls[idx].checked = True\n         self.browser.getControl('Save').click()\n \n         # Check that role is now selected\n         form = self.browser.getForm(id='groups_search')\n-        ctrl = form._form.get('group_group1:list', index=1)\n-        self.assertEqual(ctrl._value, 'Site Administrator')\n+        ctrl = form._form.get('group_group1:list', index=idx)\n+        self.assertEqual(ctrl._value, expected)\n         self.assertTrue(ctrl.checked)\n \n     def test_groups_delete_group(self):\n"

