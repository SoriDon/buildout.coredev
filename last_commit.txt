Repository: plone.volto


Branch: refs/heads/main
Date: 2021-10-25T12:34:13+02:00
Author: Ã‰rico Andrei (ericof) <ericof@gmail.com>
Commit: https://github.com/plone/plone.volto/commit/0a742c5b90f8a9e769e4d86a7e5a1824606b5e99

Dependencies cleanup (#16)

* Remove requests from dependencies.

* Remove z3c.jbot from dependencies.

* Remove minimal requirement versions for Products.GenericSetup and plone.testing as the older versions do not support Python 3 anyway.

* Remove jq from dependencies.

* Explicitly require Python 3.7 or superior

* Update package documentation.

* Update to Plone 6.0.0a1

* Remove tests of removed script.

Files changed:
M CHANGES.rst
M Makefile
M README.rst
M plone-5.2.x.cfg
M plone-6.0.x.cfg
M setup.py
M src/plone/volto/dependencies.zcml
M src/plone/volto/tests/test_scripts.py
M versions.cfg
D src/plone/volto/scripts/blocksremoveserver.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 5e61e98..9b085b9 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -4,7 +4,18 @@ Changelog\n 3.1.0a3 (unreleased)\n --------------------\n \n-- Nothing changed yet.\n+- Explicitly require Python 3.7 or superior.\n+  [ericof]\n+\n+- Remove ``jq`` from dependencies and remove old ``blocksremoveserver.py`` script.\n+  [ericof]\n+\n+- Remove ``z3c.jbot`` from dependencies\n+  [ericof]\n+\n+- Remove ``requests`` from dependencies\n+  [ericof]\n+\n \n \n 3.1.0a2 (2021-10-14)\ndiff --git a/Makefile b/Makefile\nindex 0b98702..d499918 100644\n--- a/Makefile\n+++ b/Makefile\n@@ -51,7 +51,7 @@ build: .installed.cfg  ## Build Plone 5.2\n .PHONY: Build Plone 6.0\n build-plone-6.0:  bin/pip ## Build Plone 6.0\n \tbin/pip install --upgrade pip\n-\tbin/pip install -r https://dist.plone.org/release/6.0-dev/requirements.txt\n+\tbin/pip install -r https://dist.plone.org/release/6.0.0a1/requirements.txt\n \tbin/buildout -c plone-6.0.x.cfg\n \n .PHONY: Test\ndiff --git a/README.rst b/README.rst\nindex 1becafa..76fb78a 100644\n--- a/README.rst\n+++ b/README.rst\n@@ -15,7 +15,7 @@ plone.volto configures Plone to work with `Volto <https://www.npmjs.com/package/\n Compatibility\n =============\n \n-plone.volto currently works for both Plone 5.2 and Plone 6 (pre-alpha).\n+plone.volto currently works for both Plone 5.2 and Plone 6 (pre-alpha and alpha).\n It support Python 3.7, 3.8 and 3.9.\n \n \n@@ -107,7 +107,7 @@ Volto Blocks for Plone Site Root\n plone.volto contains a hack to make the Plone site Volto blocks-enabled with some demo content. \n You can take only the hack to enable the blocks on your site.\n \n-You can see it in action in the Volto demo: https://volto.kitconcept.com\n+You can see it in action in the Volto demo: https://6.demo.plone.org\n \n Install the provided profile to install it by default:\n \ndiff --git a/plone-5.2.x.cfg b/plone-5.2.x.cfg\nindex 5903996..b1fde4a 100644\n--- a/plone-5.2.x.cfg\n+++ b/plone-5.2.x.cfg\n@@ -7,7 +7,6 @@ find-links += http://dist.plone.org/thirdparty/\n [versions]\n # Release\n zest.releaser =\n-requests =\n plone.restapi =\n \n # Error: The requirement (\'importlib-metadata>=1\') is not allowed by your [versions] constraint (0.23)\ndiff --git a/plone-6.0.x.cfg b/plone-6.0.x.cfg\nindex fece9bc..3444dcd 100644\n--- a/plone-6.0.x.cfg\n+++ b/plone-6.0.x.cfg\n@@ -1,8 +1,8 @@\n [buildout]\n extends =\n-    https://dist.plone.org/release/6.0-dev/versions.cfg\n+    https://dist.plone.org/release/6.0.0a1/versions.cfg\n     base.cfg\n-find-links = https://dist.plone.org/release/6.0-dev/\n+find-links = https://dist.plone.org/release/6.0.0a1/\n versions=versions\n \n \ndiff --git a/setup.py b/setup.py\nindex 0dcc30d..44b1552 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -37,9 +37,9 @@ def readfile(name):\n         "Operating System :: OS Independent",\n         "License :: OSI Approved :: GNU General Public License v2 (GPLv2)",\n     ],\n-    keywords="Python Plone",\n-    author="kitconcept GmbH",\n-    author_email="info@kitconcept.com",\n+    keywords="Python Plone CMS",\n+    author=\'Plone Foundation\',\n+    author_email=\'releasemanager@plone.org\',\n     url="https://github.com/plone/plone.volto",\n     license="GPL version 2",\n     packages=find_packages("src", exclude=["ez_setup"]),\n@@ -47,23 +47,18 @@ def readfile(name):\n     package_dir={"": "src"},\n     include_package_data=True,\n     zip_safe=False,\n+    python_requires=">=3.7",\n     install_requires=[\n         "plone.api",\n-        "Products.GenericSetup>=1.8.2",\n+        "Products.GenericSetup",\n         "setuptools",\n-        "z3c.jbot",\n         "plone.restapi",\n         "collective.folderishtypes[dexterity]",\n-        "requests",\n-        "jq",\n     ],\n     extras_require={\n         "test": [\n             "plone.app.testing",\n-            # Plone KGS does not use this version, because it would break\n-            # Remove if your package shall be part of coredev.\n-            # plone_coredev tests as of 2016-04-01.\n-            "plone.testing>=5.0.0",\n+            "plone.testing",\n             "plone.app.contenttypes",\n             "plone.app.robotframework[debug]",\n         ]\ndiff --git a/src/plone/volto/dependencies.zcml b/src/plone/volto/dependencies.zcml\nindex fd12cff..d34667f 100644\n--- a/src/plone/volto/dependencies.zcml\n+++ b/src/plone/volto/dependencies.zcml\n@@ -12,11 +12,6 @@\n       file="meta.zcml"\n       />\n   <include package="Products.GenericSetup" />\n-  <include\n-      package="z3c.jbot"\n-      file="meta.zcml"\n-      />\n-  <include package="z3c.jbot" />\n   <include\n       package="plone.restapi"\n       file="meta.zcml"\ndiff --git a/src/plone/volto/scripts/blocksremoveserver.py b/src/plone/volto/scripts/blocksremoveserver.py\ndeleted file mode 100644\nindex bc3fd4e..0000000\n--- a/src/plone/volto/scripts/blocksremoveserver.py\n+++ /dev/null\n@@ -1,134 +0,0 @@\n-"""\n-time bin/instance -O Plone run scripts/blocksremoveserver.py\n-    This script search and replace old server name (pre-production)\n-    for a new one. It searches in all good known places\n-"""\n-\n-from plone import api\n-from plone.restapi.behaviors import IBlocks\n-from copy import deepcopy\n-\n-import jq\n-import os\n-import sys\n-import transaction\n-\n-PATH = "/Plone"\n-\n-DJSLINKS_CHANGED = 0\n-\n-# Make other scripts in this folder available\n-sys.path.append(os.path.abspath(os.path.join("..", "api")))\n-try:\n-    from . import utils  # noqa\n-except ImportError:\n-    from scripts import utils  # noqa\n-\n-\n-def string_href_replace_server(blocks, old, new):\n-    return (\n-        jq.compile(f\'(.. | .href? | strings) |= sub("{old}";"{new}")\')\n-        .input(blocks)\n-        .first()\n-    )\n-\n-\n-def array_href_replace_server(blocks, old, new):\n-    return (\n-        jq.compile(f\'(.. | .href? | arrays | .[]."@id") |= sub("{old}";"{new}")\')\n-        .input(blocks)\n-        .first()\n-    )\n-\n-\n-def string_url_replace_server(blocks, old, new):\n-    return (\n-        jq.compile(f\'(.. | .url? | strings) |= sub("{old}";"{new}")\')\n-        .input(blocks)\n-        .first()\n-    )\n-\n-\n-def array_url_replace_server(blocks, old, new):\n-    return (\n-        jq.compile(f\'(.. | .url? | arrays | .[]."@id") |= sub("{old}";"{new}")\')\n-        .input(blocks)\n-        .first()\n-    )\n-\n-\n-def array_preview_image_replace_server(blocks, old, new):\n-    return (\n-        jq.compile(\n-            f\'(.. | .preview_image? | arrays | .[]."@id") |= sub("{old}";"{new}")\'\n-        )\n-        .input(blocks)\n-        .first()\n-    )\n-\n-\n-def draftjs_replace_server(blocks, old, new):\n-    blocks = deepcopy(blocks)\n-    for blockuid in blocks:\n-        block = blocks[blockuid]\n-        if block["@type"] == "text":\n-            entity_map = block.get("text", {}).get("entityMap", {})\n-            for entity in entity_map.values():\n-                if entity.get("type") == "LINK":\n-                    href = entity.get("data", {}).get("url", "")\n-                    if href and href.startswith(old):\n-                        entity["data"]["url"] = entity["data"]["url"].replace(old, new)\n-\n-    return blocks\n-\n-\n-if __name__ == "__main__":\n-    if len(sys.argv) > 3:\n-        oldservername = sys.argv[3]\n-    else:\n-        oldservername = ""\n-\n-    if len(sys.argv) > 4:\n-        newservername = sys.argv[4]\n-    else:\n-        newservername = ""\n-\n-    utils.print_info(f"Old server: {oldservername} - New server: {newservername}")\n-\n-    pc = api.portal.get_tool("portal_catalog")\n-    for brain in pc.unrestrictedSearchResults(\n-        object_provides=IBlocks.__identifier__, path=PATH\n-    ):\n-        try:\n-            obj = brain.getObject()\n-            blocks = obj.blocks\n-\n-            utils.print_info(f"Processing: {obj.absolute_url()}")\n-\n-            # Search for any text block and replaces the DraftJS links (old style)\n-            blocks = draftjs_replace_server(blocks, oldservername, newservername)\n-\n-            # Search for any href field that is an string (old teasers, non object_browser\n-            # based) and replaces them\n-            blocks = string_href_replace_server(blocks, oldservername, newservername)\n-\n-            # Search for any href field that is an array (object_browser) and replaces the @id field\n-            blocks = array_href_replace_server(blocks, oldservername, newservername)\n-\n-            # Search for any url field that is an string (old image teasers, non object_browser\n-            # based) and replaces them\n-            blocks = string_url_replace_server(blocks, oldservername, newservername)\n-\n-            # Search for any url field that is an array (object_browser) and replaces the @id field\n-            blocks = array_url_replace_server(blocks, oldservername, newservername)\n-\n-            # Search for any preview_image field that is an array (object_browser) and replaces the @id field\n-            blocks = array_preview_image_replace_server(\n-                blocks, oldservername, newservername\n-            )\n-\n-            obj.blocks = blocks\n-        except Exception:\n-            pass\n-\n-    transaction.commit()\ndiff --git a/src/plone/volto/tests/test_scripts.py b/src/plone/volto/tests/test_scripts.py\nindex 0fa598b..d64bd63 100644\n--- a/src/plone/volto/tests/test_scripts.py\n+++ b/src/plone/volto/tests/test_scripts.py\n@@ -1,16 +1,10 @@\n # -*- coding: utf-8 -*-\n \n from plone.dexterity.interfaces import IDexterityFTI\n-from plone.volto.testing import PLONE_VOLTO_CORE_INTEGRATION_TESTING  # noqa\n-from zope.component import queryUtility\n-from plone.volto.scripts.blocksremoveserver import draftjs_replace_server\n-from plone.volto.scripts.blocksremoveserver import string_href_replace_server\n-from plone.volto.scripts.blocksremoveserver import array_href_replace_server\n-from plone.volto.scripts.blocksremoveserver import string_url_replace_server\n-from plone.volto.scripts.blocksremoveserver import array_url_replace_server\n-from plone.volto.scripts.blocksremoveserver import array_preview_image_replace_server\n from plone.volto.scripts.listingaddsummary import migrate_listing_block_to_summary\n from plone.volto.scripts.searchscalesinimageblocks import remove_image_scales\n+from plone.volto.testing import PLONE_VOLTO_CORE_INTEGRATION_TESTING  # noqa\n+from zope.component import queryUtility\n \n import unittest\n \n@@ -35,359 +29,6 @@ def setUp(self):\n             self.portal.invokeFactory("Image", id="image1", title="Target image")\n         ]\n \n-    def test_draftjs_replace_server(self):\n-        blocks = {\n-            "09e39ddf-a945-49f2-b609-ea427ac3430b": {\n-                "@type": "text",\n-                "text": {\n-                    "blocks": [\n-                        {\n-                            "data": {},\n-                            "depth": 0,\n-                            "entityRanges": [{"key": 0, "length": 4, "offset": 0}],\n-                            "inlineStyleRanges": [],\n-                            "key": "ark35",\n-                            "text": "Link",\n-                            "type": "unstyled",\n-                        }\n-                    ],\n-                    "entityMap": {\n-                        "0": {\n-                            "data": {"url": self.doc1.absolute_url()},\n-                            "mutability": "MUTABLE",\n-                            "type": "LINK",\n-                        }\n-                    },\n-                },\n-            },\n-            "21270e22-3a61-4780-b164-d6be56d942f4": {"@type": "title"},\n-        }\n-\n-        result = draftjs_replace_server(blocks, self.portal.absolute_url(), "")\n-\n-        self.assertEqual(\n-            result["09e39ddf-a945-49f2-b609-ea427ac3430b"]["text"]["entityMap"]["0"][\n-                "data"\n-            ]["url"],\n-            "/doc1",\n-        )\n-\n-        result = draftjs_replace_server(\n-            blocks, self.portal.absolute_url(), "https://kitconcept.com"\n-        )\n-\n-        self.assertEqual(\n-            result["09e39ddf-a945-49f2-b609-ea427ac3430b"]["text"]["entityMap"]["0"][\n-                "data"\n-            ]["url"],\n-            "https://kitconcept.com/doc1",\n-        )\n-\n-    def test_array_href_replace_server(self):\n-        blocks = {\n-            "043ebd28-1e05-405a-9384-526ca90488f1": {\n-                "@type": "teaserTab",\n-                "columns": [\n-                    {\n-                        "@id": "e0ab36e5-aed0-451c-8929-2671355d3240",\n-                        "description": "Schneller rechnet derzeit niemand in Europa: Der J\\u00fclicher Supercomputer JUWELS hat dank eines neuen Booster-Moduls noch einmal enorm an Rechenleistung zugelegt. Auf JUWELS k\\u00f6nnen dank des neuen Booster-Moduls nun wissenschaftliche Simulationen laufen, die aufgrund ihrer Komplexit\\u00e4t oder der zu verarbeitenden Datenmenge bisher nicht durchf\\u00fchrbar waren.",\n-                        "href": [\n-                            {\n-                                "@id": "/de/beispiele/highlight1",\n-                                "Description": "Schneller rechnet derzeit niemand in Europa: Der J\\u00fclicher Supercomputer JUWELS hat dank eines neuen Booster-Moduls noch einmal enorm an Rechenleistung zugelegt. Auf JUWELS k\\u00f6nnen dank des neuen Booster-Moduls nun wissenschaftliche Simulationen laufen, die aufgrund ihrer Komplexit\\u00e4t oder der zu verarbeitenden Datenmenge bisher nicht durchf\\u00fchrbar waren.",\n-                                "Title": "Supercomputer f\\u00fcr gro\\u00dfe Rechenaufgaben und KI",\n-                                "hasPreviewImage": True,\n-                                "title": "Supercomputer f\\u00fcr gro\\u00dfe Rechenaufgaben und KI",\n-                            }\n-                        ],\n-                        "title": "Supercomputer f\\u00fcr gro\\u00dfe Rechenaufgaben und KI",\n-                    },\n-                    {\n-                        "@id": "e0ab36e5-aed0-451c-8929-2671355d3240",\n-                        "description": "Schneller rechnet derzeit niemand in Europa: Der J\\u00fclicher Supercomputer JUWELS hat dank eines neuen Booster-Moduls noch einmal enorm an Rechenleistung zugelegt. Auf JUWELS k\\u00f6nnen dank des neuen Booster-Moduls nun wissenschaftliche Simulationen laufen, die aufgrund ihrer Komplexit\\u00e4t oder der zu verarbeitenden Datenmenge bisher nicht durchf\\u00fchrbar waren.",\n-                        "href": [\n-                            {\n-                                "@id": "{}".format(self.doc1.absolute_url()),\n-                                "Description": "Schneller rechnet derzeit niemand in Europa: Der J\\u00fclicher Supercomputer JUWELS hat dank eines neuen Booster-Moduls noch einmal enorm an Rechenleistung zugelegt. Auf JUWELS k\\u00f6nnen dank des neuen Booster-Moduls nun wissenschaftliche Simulationen laufen, die aufgrund ihrer Komplexit\\u00e4t oder der zu verarbeitenden Datenmenge bisher nicht durchf\\u00fchrbar waren.",\n-                                "Title": "Supercomputer f\\u00fcr gro\\u00dfe Rechenaufgaben und KI",\n-                                "hasPreviewImage": True,\n-                                "title": "Supercomputer f\\u00fcr gro\\u00dfe Rechenaufgaben und KI",\n-                            }\n-                        ],\n-                        "title": "Supercomputer f\\u00fcr gro\\u00dfe Rechenaufgaben und KI",\n-                    },\n-                ],\n-            }\n-        }\n-\n-        result = array_href_replace_server(blocks, self.portal.absolute_url(), "")\n-\n-        self.assertEqual(\n-            result["043ebd28-1e05-405a-9384-526ca90488f1"]["columns"][1]["href"][0][\n-                "@id"\n-            ],\n-            "/doc1",\n-        )\n-\n-        self.assertEqual(\n-            result["043ebd28-1e05-405a-9384-526ca90488f1"]["columns"][0]["href"][0][\n-                "@id"\n-            ],\n-            "/de/beispiele/highlight1",\n-        )\n-\n-        result = array_href_replace_server(\n-            blocks, self.portal.absolute_url(), "https://kitconcept.com"\n-        )\n-\n-        self.assertEqual(\n-            result["043ebd28-1e05-405a-9384-526ca90488f1"]["columns"][1]["href"][0][\n-                "@id"\n-            ],\n-            "https://kitconcept.com/doc1",\n-        )\n-\n-    def test_string_href_replace_server(self):\n-        blocks = {\n-            "11d2fa0c-81d3-41c0-84e4-fd7f9c158a5a": {\n-                "@type": "teaserGrid",\n-                "columns": [\n-                    {\n-                        "@type": "teaser",\n-                        "href": "/de/ueber-uns/erklaer-film",\n-                        "id": "db139e89-9545-4b31-aaa5-658c62e5d8da",\n-                        "title": "Video \\\\u00fcber den Fenster",\n-                        "index": 0,\n-                    },\n-                    {\n-                        "@type": "teaser",\n-                        "href": "{}".format(self.doc1.absolute_url()),\n-                        "id": "1e058bee-c31f-437e-ad86-805638a9082a",\n-                        "title": "Pr\\\\u00e4sident",\n-                        "index": 1,\n-                    },\n-                ],\n-            }\n-        }\n-\n-        result = string_href_replace_server(blocks, self.portal.absolute_url(), "")\n-\n-        self.assertEqual(\n-            result["11d2fa0c-81d3-41c0-84e4-fd7f9c158a5a"]["columns"][1]["href"],\n-            "/doc1",\n-        )\n-\n-        self.assertEqual(\n-            result["11d2fa0c-81d3-41c0-84e4-fd7f9c158a5a"]["columns"][0]["href"],\n-            "/de/ueber-uns/erklaer-film",\n-        )\n-\n-        result = string_href_replace_server(\n-            blocks, self.portal.absolute_url(), "https://kitconcept.com"\n-        )\n-\n-        self.assertEqual(\n-            result["11d2fa0c-81d3-41c0-84e4-fd7f9c158a5a"]["columns"][1]["href"],\n-            "https://kitconcept.com/doc1",\n-        )\n-\n-    def test_string_href_replace_server_plain(self):\n-        blocks = {\n-            "720b5582-c80a-48be-843a-8d5990d3c4ec": {\n-                "@type": "teaserHero",\n-                "href": "/de/veroeffentlichungen/produkte/sonderberichte/2019/gesundheitsausgaben-im-fokus-der-eu-rechnungshoefe-pruefungskompendium-des-kontaktausschusses",\n-                "headline": "Sonderbericht",\n-                "title": "Gesundheitsausgaben im Fokus der EU-Rechnungsh\\\\u00f6fe: Pr\\\\u00fcfungskompendium des Kontaktausschusses",\n-                "description": "Die EU-Mitgliedstaaten investieren jedes Jahr Milliarden in die Gesundheitsversorgung. Die EU-Rechnungsh\\\\u00f6fe haben nun exemplarische Pr\\\\u00fcfungen zum Thema \\\\u201e\\\\u00d6ffentliche Gesundheit\\\\u201c zusammengefasst und ver\\\\u00f6ffentlicht.",\n-                "variation": "top",\n-            }\n-        }\n-\n-        result = string_href_replace_server(\n-            blocks, self.portal.absolute_url(), "https://kitconcept.com"\n-        )\n-\n-        self.assertEqual(\n-            result["720b5582-c80a-48be-843a-8d5990d3c4ec"]["href"],\n-            "/de/veroeffentlichungen/produkte/sonderberichte/2019/gesundheitsausgaben-im-fokus-der-eu-rechnungshoefe-pruefungskompendium-des-kontaktausschusses",\n-        )\n-\n-        blocks = {\n-            "720b5582-c80a-48be-843a-8d5990d3c4ec": {\n-                "@type": "teaserHero",\n-                "href": "{}".format(self.doc1.absolute_url()),\n-                "headline": "Sonderbericht",\n-                "title": "Gesundheitsausgaben im Fokus der EU-Rechnungsh\\\\u00f6fe: Pr\\\\u00fcfungskompendium des Kontaktausschusses",\n-                "description": "Die EU-Mitgliedstaaten investieren jedes Jahr Milliarden in die Gesundheitsversorgung. Die EU-Rechnungsh\\\\u00f6fe haben nun exemplarische Pr\\\\u00fcfungen zum Thema \\\\u201e\\\\u00d6ffentliche Gesundheit\\\\u201c zusammengefasst und ver\\\\u00f6ffentlicht.",\n-                "variation": "top",\n-            }\n-        }\n-\n-        result = string_href_replace_server(\n-            blocks, self.portal.absolute_url(), "https://kitconcept.com"\n-        )\n-\n-        self.assertEqual(\n-            result["720b5582-c80a-48be-843a-8d5990d3c4ec"]["href"],\n-            "https://kitconcept.com/doc1",\n-        )\n-\n-    def test_string_url_replace_server(self):\n-        blocks = {\n-            "7bad5afd-ea6a-472a-a521-452810e1d286": {\n-                "@type": "image",\n-                "alt": "Bild 3",\n-                "size": "l",\n-                "url": "{}".format(self.image.absolute_url()),\n-            }\n-        }\n-\n-        result = string_url_replace_server(blocks, self.portal.absolute_url(), "")\n-\n-        self.assertEqual(\n-            result["7bad5afd-ea6a-472a-a521-452810e1d286"]["url"], "/image1"\n-        )\n-\n-        blocks = {\n-            "57714a7e-a4e0-4df2-a03b-0f5ca5613daa": {\n-                "@type": "imagesGrid",\n-                "columns": [\n-                    {"@type": "image", "id": "ccc74a4e-1495-4dc7-a8ef-d325032e744d"},\n-                    {\n-                        "@type": "image",\n-                        "alt": "Bild 2",\n-                        "id": "35bb6f7c-a0af-4c21-a306-accb180b3e8b",\n-                        "index": 1,\n-                        "url": "{}".format(self.image.absolute_url()),\n-                    },\n-                ],\n-            }\n-        }\n-\n-        result = string_url_replace_server(blocks, self.portal.absolute_url(), "")\n-\n-        self.assertEqual(\n-            result["57714a7e-a4e0-4df2-a03b-0f5ca5613daa"]["columns"][1]["url"],\n-            "/image1",\n-        )\n-\n-        result = string_url_replace_server(\n-            blocks, self.portal.absolute_url(), "https://kitconcept.com"\n-        )\n-\n-        self.assertEqual(\n-            result["57714a7e-a4e0-4df2-a03b-0f5ca5613daa"]["columns"][1]["url"],\n-            "https://kitconcept.com/image1",\n-        )\n-\n-    def test_array_preview_image_replace_server(self):\n-        blocks = {\n-            "b53feefa-e6f7-42f0-8f04-534655c6c594": {\n-                "@type": "carousel",\n-                "columns": [\n-                    {\n-                        "@id": "404cb69e-97b9-417a-aa9a-a345009f4411",\n-                        "description": "Das dritte Jahr in Folge ist es zu trocken und warm in Deutschland. Darunter leiden viele B\xc3\xa4ume, insbesondere Fichten. Eine Folge: Sie sind anf\xc3\xa4lliger f\xc3\xbcr Sch\xc3\xa4dlinge. J\xc3\xbclicher Forschende beobachten die Entwicklung in der Eifel und messen die Auswirkungen: etwa auf den CO2-Gehalt in der Atmosph\xc3\xa4re.",\n-                        "href": [\n-                            {\n-                                "@id": "/de/beispiele/highlight2",\n-                                "Description": "Das dritte Jahr in Folge ist es zu trocken und warm in Deutschland. Darunter leiden viele B\xc3\xa4ume, insbesondere Fichten. Eine Folge: Sie sind anf\xc3\xa4lliger f\xc3\xbcr Sch\xc3\xa4dlinge. J\xc3\xbclicher Forschende beobachten die Entwicklung in der Eifel und messen die Auswirkungen: etwa auf den CO2-Gehalt in der Atmosph\xc3\xa4re.",\n-                                "Title": "Sorgenkind Wald",\n-                                "hasPreviewImage": True,\n-                                "title": "Sorgenkind Wald",\n-                            }\n-                        ],\n-                        "title": "Sorgenkind Wald",\n-                    },\n-                    {\n-                        "@id": "404cb69e-97b9-417a-aa9a-a345009f4412",\n-                        "description": "Sie sind klein, aber haben es in sich: Mikroorganismen. Ihre Leistungsf\xc3\xa4higkeit macht sich die sogenannte Wei\xc3\x9fe Biotechnologie auf vielf\xc3\xa4ltige Weise zu Nutze. Eine besondere Herausforderung besteht allerdings oftmals darin, unter Millionen von Zellen die passenden zu finden. J\xc3\xbclicher Forschenden ist es nun gelungen, einen Biosensor zu entwickeln, der die Suche nach geeigneten Kandidaten erleichtert.",\n-                        "href": [\n-                            {\n-                                "@id": "/de/beispiele/highlight3",\n-                                "Description": "Sie sind klein, aber haben es in sich: Mikroorganismen. Ihre Leistungsf\xc3\xa4higkeit macht sich die sogenannte Wei\xc3\x9fe Biotechnologie auf vielf\xc3\xa4ltige Weise zu Nutze. Eine besondere Herausforderung besteht allerdings oftmals darin, unter Millionen von Zellen die passenden zu finden. J\xc3\xbclicher Forschenden ist es nun gelungen, einen Biosensor zu entwickeln, der die Suche nach geeigneten Kandidaten erleichtert.",\n-                                "Title": "Talentscout in der Zellfabrik",\n-                                "hasPreviewImage": True,\n-                                "title": "Talentscout in der Zellfabrik",\n-                            }\n-                        ],\n-                        "preview_image": [\n-                            {\n-                                "@id": "{}".format(self.image.absolute_url()),\n-                                "@type": "Image",\n-                            }\n-                        ],\n-                        "title": "Talentscout in der Zellfabrik",\n-                    },\n-                ],\n-            }\n-        }\n-\n-        result = array_preview_image_replace_server(\n-            blocks, self.portal.absolute_url(), "https://kitconcept.com"\n-        )\n-\n-        self.assertEqual(\n-            result["b53feefa-e6f7-42f0-8f04-534655c6c594"]["columns"][1][\n-                "preview_image"\n-            ][0]["@id"],\n-            "https://kitconcept.com/image1",\n-        )\n-\n-    def test_array_url_replace_server(self):\n-        blocks = {\n-            "b53feefa-e6f7-42f0-8f04-534655c6c594": {\n-                "@type": "carousel",\n-                "columns": [\n-                    {\n-                        "@id": "404cb69e-97b9-417a-aa9a-a345009f4411",\n-                        "description": "Das dritte Jahr in Folge ist es zu trocken und warm in Deutschland. Darunter leiden viele B\xc3\xa4ume, insbesondere Fichten. Eine Folge: Sie sind anf\xc3\xa4lliger f\xc3\xbcr Sch\xc3\xa4dlinge. J\xc3\xbclicher Forschende beobachten die Entwicklung in der Eifel und messen die Auswirkungen: etwa auf den CO2-Gehalt in der Atmosph\xc3\xa4re.",\n-                        "href": [\n-                            {\n-                                "@id": "/de/beispiele/highlight2",\n-                                "Description": "Das dritte Jahr in Folge ist es zu trocken und warm in Deutschland. Darunter leiden viele B\xc3\xa4ume, insbesondere Fichten. Eine Folge: Sie sind anf\xc3\xa4lliger f\xc3\xbcr Sch\xc3\xa4dlinge. J\xc3\xbclicher Forschende beobachten die Entwicklung in der Eifel und messen die Auswirkungen: etwa auf den CO2-Gehalt in der Atmosph\xc3\xa4re.",\n-                                "Title": "Sorgenkind Wald",\n-                                "hasPreviewImage": True,\n-                                "title": "Sorgenkind Wald",\n-                            }\n-                        ],\n-                        "title": "Sorgenkind Wald",\n-                    },\n-                    {\n-                        "@id": "404cb69e-97b9-417a-aa9a-a345009f4412",\n-                        "description": "Sie sind klein, aber haben es in sich: Mikroorganismen. Ihre Leistungsf\xc3\xa4higkeit macht sich die sogenannte Wei\xc3\x9fe Biotechnologie auf vielf\xc3\xa4ltige Weise zu Nutze. Eine besondere Herausforderung besteht allerdings oftmals darin, unter Millionen von Zellen die passenden zu finden. J\xc3\xbclicher Forschenden ist es nun gelungen, einen Biosensor zu entwickeln, der die Suche nach geeigneten Kandidaten erleichtert.",\n-                        "href": [\n-                            {\n-                                "@id": "/de/beispiele/highlight3",\n-                                "Description": "Sie sind klein, aber haben es in sich: Mikroorganismen. Ihre Leistungsf\xc3\xa4higkeit macht sich die sogenannte Wei\xc3\x9fe Biotechnologie auf vielf\xc3\xa4ltige Weise zu Nutze. Eine besondere Herausforderung besteht allerdings oftmals darin, unter Millionen von Zellen die passenden zu finden. J\xc3\xbclicher Forschenden ist es nun gelungen, einen Biosensor zu entwickeln, der die Suche nach geeigneten Kandidaten erleichtert.",\n-                                "Title": "Talentscout in der Zellfabrik",\n-                                "hasPreviewImage": True,\n-                                "title": "Talentscout in der Zellfabrik",\n-                            }\n-                        ],\n-                        "url": [\n-                            {\n-                                "@id": "{}".format(self.image.absolute_url()),\n-                                "@type": "Image",\n-                            }\n-                        ],\n-                        "title": "Talentscout in der Zellfabrik",\n-                    },\n-                ],\n-            }\n-        }\n-\n-        result = array_url_replace_server(\n-            blocks, self.portal.absolute_url(), "https://kitconcept.com"\n-        )\n-\n-        self.assertEqual(\n-            result["b53feefa-e6f7-42f0-8f04-534655c6c594"]["columns"][1]["url"][0][\n-                "@id"\n-            ],\n-            "https://kitconcept.com/image1",\n-        )\n-\n     def test_migrate_listing_block_to_summary(self):\n         blocks = {"@type": "listing"}\n \ndiff --git a/versions.cfg b/versions.cfg\nindex bd4e3f7..c346a2e 100644\n--- a/versions.cfg\n+++ b/versions.cfg\n@@ -24,7 +24,6 @@ pycodestyle = 2.3.1\n # Release\n zest.releaser = 6.17.0\n twine = 1.11.0\n-requests = 2.18.4\n towncrier = 19.2.0\n zestreleaser.towncrier = 1.1.0\n docutils = 0.13.1\n'

