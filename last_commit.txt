Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-08-23T23:00:45+05:30
Author: Anirudh H Kashyap (anirudhhkashyap) <68481927+anirudhhkashyap@users.noreply.github.com>
Commit: https://github.com/plone/plone.restapi/commit/d35126751afcc5d3c5ea222af571dcb430c20f38

Add unrestricted keyword argument to uuidToObject() (#1471)

* Add unrestricted keyword argument to uuidToObject()

Setting the unrestricted flag to True invokes the unrestrictedTraversal() instead of restrictedTraversal().
Invoking the latter threw the Unauthorized Exception. Now the object can be accessed depending on the unrestricted flag.

* Update utils.py

Made changes suggested in code review.

Files changed:
A news/1448.bugfix
M src/plone/restapi/serializer/utils.py

b'diff --git a/news/1448.bugfix b/news/1448.bugfix\nnew file mode 100644\nindex 000000000..9bf359bb6\n--- /dev/null\n+++ b/news/1448.bugfix\n@@ -0,0 +1,2 @@\n+Fix for test cases failing when deprecating uuidToObject() from `plone.outputfilters.browser.resolveuid`.\n+[anirudhhkashyap]\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/serializer/utils.py b/src/plone/restapi/serializer/utils.py\nindex 15b37a41a..c3d9f6db1 100644\n--- a/src/plone/restapi/serializer/utils.py\n+++ b/src/plone/restapi/serializer/utils.py\n@@ -1,4 +1,4 @@\n-from plone.outputfilters.browser.resolveuid import uuidToObject\n+from plone.app.uuid.utils import uuidToObject\n from plone.outputfilters.browser.resolveuid import uuidToURL\n from plone.restapi.interfaces import IObjectPrimaryFieldTarget\n from zope.component import queryMultiAdapter\n@@ -8,7 +8,7 @@\n \n RESOLVEUID_RE = re.compile("^[./]*resolve[Uu]id/([^/]*)/?(.*)$")\n \n-\n+# Takes the resolveID URL and returns a URL to the actual object\n def uid_to_url(path):\n     if not path:\n         return ""\n@@ -23,7 +23,10 @@ def uid_to_url(path):\n     if suffix:\n         href += "/" + suffix\n     else:\n-        target_object = uuidToObject(uid)\n+        # Pass unrestricted flag as true so the object is accessible.\n+        # At uuidToObject(), this leads to unrestrictedTraverse() to be invoked instead of restrictedTraverse().\n+        \n+        target_object = uuidToObject(uid, unrestricted=True)\n         if target_object:\n             adapter = queryMultiAdapter(\n                 (target_object, target_object.REQUEST), IObjectPrimaryFieldTarget\n'

