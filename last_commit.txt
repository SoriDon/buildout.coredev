Repository: mockup


Branch: refs/heads/master
Date: 2019-05-23T12:05:05-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/mockup/commit/e583f013e28028b1f9edc58f919da067b1136185

pat-inlinevalidation: Avoid submitting files. fixes gh-903

Files changed:
A news/903.fix
M mockup/patterns/inlinevalidation/pattern.js

b'diff --git a/mockup/patterns/inlinevalidation/pattern.js b/mockup/patterns/inlinevalidation/pattern.js\nindex f487b1228..a23f89b1b 100644\n--- a/mockup/patterns/inlinevalidation/pattern.js\n+++ b/mockup/patterns/inlinevalidation/pattern.js\n@@ -98,11 +98,14 @@ define([\n         var $input = $(input),\n             $field = $input.closest(\'.field\'),\n             $form = $field.closest(\'form\'),\n+            $cloned_form = $form.clone(),\n             fname = $field.attr(\'data-fieldname\');\n \n+        // XXX: Remove binary files so they are not uploaded to server\n+        $cloned_form.find("input[type=file]").remove();\n         this.queue($.proxy(function(next) {\n-            $form.ajaxSubmit({\n-                url: this.append_url_path($form.attr(\'action\'), \'@@formlib_validate_field\'),\n+            $cloned_form.ajaxSubmit({\n+                url: this.append_url_path($cloned_form.attr(\'action\'), \'@@formlib_validate_field\'),\n                 data: {fname: fname},\n                 iframe: false,\n                 success: $.proxy(function (data) {\n@@ -119,13 +122,16 @@ define([\n         var $input = $(input),\n             $field = $input.closest(\'.field\'),\n             $form = $field.closest(\'form\'),\n+            $cloned_form = $form.clone(),\n             fset = $input.closest(\'fieldset\').attr(\'data-fieldset\'),\n             fname = $field.attr(\'data-fieldname\');\n \n+        // XXX: Remove binary files so they are not uploaded to server\n+        $cloned_form.find("input[type=file]").remove();\n         if (fname) {\n           this.queue($.proxy(function(next) {\n-              $form.ajaxSubmit({\n-                  url: this.append_url_path($form.attr(\'action\'), \'@@z3cform_validate_field\'),\n+              $cloned_form.ajaxSubmit({\n+                  url: this.append_url_path($cloned_form.attr(\'action\'), \'@@z3cform_validate_field\'),\n                   data: {fname: fname, fset: fset},\n                   iframe: false,\n                   success: $.proxy(function (data) {\ndiff --git a/news/903.fix b/news/903.fix\nnew file mode 100644\nindex 000000000..44d074b54\n--- /dev/null\n+++ b/news/903.fix\n@@ -0,0 +1,2 @@\n+* pat-inlinevalidation: Avoid submitting files \n+  [frapell]\n'

Repository: mockup


Branch: refs/heads/master
Date: 2019-05-24T12:03:28-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/mockup/commit/4b696bad8feb99e9e259cde94c30245a7c3fff57

Merge pull request #904 from plone/frapell-inlinevalidation

pat-inlinevalidation: Avoid submitting files

Files changed:
A news/903.fix
M mockup/patterns/inlinevalidation/pattern.js

b'diff --git a/mockup/patterns/inlinevalidation/pattern.js b/mockup/patterns/inlinevalidation/pattern.js\nindex f487b1228..a23f89b1b 100644\n--- a/mockup/patterns/inlinevalidation/pattern.js\n+++ b/mockup/patterns/inlinevalidation/pattern.js\n@@ -98,11 +98,14 @@ define([\n         var $input = $(input),\n             $field = $input.closest(\'.field\'),\n             $form = $field.closest(\'form\'),\n+            $cloned_form = $form.clone(),\n             fname = $field.attr(\'data-fieldname\');\n \n+        // XXX: Remove binary files so they are not uploaded to server\n+        $cloned_form.find("input[type=file]").remove();\n         this.queue($.proxy(function(next) {\n-            $form.ajaxSubmit({\n-                url: this.append_url_path($form.attr(\'action\'), \'@@formlib_validate_field\'),\n+            $cloned_form.ajaxSubmit({\n+                url: this.append_url_path($cloned_form.attr(\'action\'), \'@@formlib_validate_field\'),\n                 data: {fname: fname},\n                 iframe: false,\n                 success: $.proxy(function (data) {\n@@ -119,13 +122,16 @@ define([\n         var $input = $(input),\n             $field = $input.closest(\'.field\'),\n             $form = $field.closest(\'form\'),\n+            $cloned_form = $form.clone(),\n             fset = $input.closest(\'fieldset\').attr(\'data-fieldset\'),\n             fname = $field.attr(\'data-fieldname\');\n \n+        // XXX: Remove binary files so they are not uploaded to server\n+        $cloned_form.find("input[type=file]").remove();\n         if (fname) {\n           this.queue($.proxy(function(next) {\n-              $form.ajaxSubmit({\n-                  url: this.append_url_path($form.attr(\'action\'), \'@@z3cform_validate_field\'),\n+              $cloned_form.ajaxSubmit({\n+                  url: this.append_url_path($cloned_form.attr(\'action\'), \'@@z3cform_validate_field\'),\n                   data: {fname: fname, fset: fset},\n                   iframe: false,\n                   success: $.proxy(function (data) {\ndiff --git a/news/903.fix b/news/903.fix\nnew file mode 100644\nindex 000000000..44d074b54\n--- /dev/null\n+++ b/news/903.fix\n@@ -0,0 +1,2 @@\n+* pat-inlinevalidation: Avoid submitting files \n+  [frapell]\n'

