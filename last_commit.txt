Repository: plone.i18n


Branch: refs/heads/master
Date: 2023-03-14T23:55:54+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.i18n/commit/0b756a48a337ff47b180410ed86063f3b66d81a6

Configuring with plone/meta

Files changed:
A news/0d0704ce.internal
M .meta.toml
M .pre-commit-config.yaml
M pyproject.toml
M setup.cfg
M tox.ini

b'diff --git a/.meta.toml b/.meta.toml\nindex 3a3d3b1..9d3bd37 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -2,7 +2,7 @@\n # https://github.com/plone/meta/tree/master/config/default\n [meta]\n template = "default"\n-commit-id = "25f71b87"\n+commit-id = "0d0704ce"\n \n [codespell]\n additional-ignores = "fo,nam,nd,te,ue"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex a3085c9..582f8ac 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -19,7 +19,7 @@ repos:\n     hooks:\n     -   id: black\n -   repo: https://github.com/collective/zpretty\n-    rev: 3.0.1\n+    rev: 3.0.2\n     hooks:\n     -   id: zpretty\n -   repo: https://github.com/PyCQA/flake8\n@@ -37,6 +37,6 @@ repos:\n     hooks:\n     -   id: check-manifest\n -   repo: https://github.com/regebro/pyroma\n-    rev: "4.1"\n+    rev: "4.2"\n     hooks:\n     -   id: pyroma\ndiff --git a/news/0d0704ce.internal b/news/0d0704ce.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/0d0704ce.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 90aaf4a..49f23bf 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -44,3 +44,22 @@ target-version = ["py38"]\n \n [tool.codespell]\n ignore-words-list = "fo,nam,nd,te,ue"\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex e70eb25..0da8f8f 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -21,4 +21,3 @@ ignore =\n     .meta.toml\n     .pre-commit-config.yaml\n     tox.ini\n-    lint-requirements.txt\ndiff --git a/tox.ini b/tox.ini\nindex 401525a..fea726c 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -4,6 +4,7 @@\n envlist =\n     format\n     lint\n+    test\n \n [testenv]\n allowlist_externals =\n@@ -31,20 +32,19 @@ commands =\n [testenv:dependencies]\n description = check if the package defines all its dependencies and generate a graph out of them\n deps =\n-    z3c.dependencychecker==2.10\n-    pipdeptree==2.3.3\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n     graphviz  # optional dependency of pipdeptree\n commands =\n     dependencychecker\n-    sh -c \'pipdeptree --exclude setuptools,pipdeptree,wheel --graph-output svg > dependencies.svg\'\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n \n [testenv:test]\n-description = run the tests of the distribution\n+usedevelop = true\n deps =\n-    plone.i18n[test]\n-    pytest\n-    gocept.pytestlayer\n+    zope.testrunner\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n commands =\n-    pip install -e .[test]\n-    pytest\n+    zope-testrunner --test-path={toxinidir} -s plone.i18n\n+extras =\n+    test\n'

Repository: plone.i18n


Branch: refs/heads/master
Date: 2023-03-14T23:57:01+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.i18n/commit/7cf39d019d3adef79208bcde1040189e13a53c84

git ignore .tox

Files changed:
M .gitignore

b'diff --git a/.gitignore b/.gitignore\nindex 87d57cb..da2bc97 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -1,5 +1,6 @@\n *.py?\n .installed.cfg\n+.tox\n bin/\n develop-eggs/\n *.egg-info/\n'

Repository: plone.i18n


Branch: refs/heads/master
Date: 2023-03-15T00:40:34+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.i18n/commit/3886cbe059202ae4e0b4c0d0617a93714998934e

Correctly specified dependencies.

`plone.supermodel` and a few others were missing.
Fixes https://github.com/plone/plone.i18n/issues/49

Note that in the middle of working on it, I got this from `tox -e dependencies`:

```
Requirements that should be test requirements
=============================================
     plone.base
```

So I moved `plone.base` from `install_requires` to the `test` extra.
Then `z3c.dependencychecker` was happy, saying there were no missing requirements.

But this was wrong.  Temporarily commenting out `plone.base` in the `test` extra, gave this:

```
INFO: Ignoring package &lt;DottedName plone.base&gt; as is not a dependency of the package being analyzed
INFO: Ignoring package &lt;DottedName python-dateutil&gt; as is not a dependency of the package being analyzed

Missing requirements
====================
     Products.CMFCore.interfaces.IDublinCore
     Products.CMFCore.interfaces.ISiteRoot
     Products.CMFCore.utils.registerToolInterface

Missing test requirements
=========================
     Products.CMFCore.interfaces.IDublinCore
     Products.CMFCore.utils.getToolByName
     Products.CMFCore.utils.getToolInterface
     plone.base.interfaces.ILanguage
```

I chose to keep `plone.base` as test extra, and require `Products.CMFCore`.
Then `z3c.dependencychecker` is happy again.

The alternative is to keep `plone.base` in `install_requires`, but as said: then dependencychecker incorrectly advises that this should be a test requirement.

Files changed:
A news/49.bugfix
M plone/i18n/tests/test_negotiation.py
M setup.py
D news/0d0704ce.internal

b'diff --git a/news/0d0704ce.internal b/news/0d0704ce.internal\ndeleted file mode 100644\nindex c08f539..0000000\n--- a/news/0d0704ce.internal\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-Update configuration files.\n-[plone devs]\ndiff --git a/news/49.bugfix b/news/49.bugfix\nnew file mode 100644\nindex 0000000..9d8ef83\n--- /dev/null\n+++ b/news/49.bugfix\n@@ -0,0 +1,2 @@\n+Correctly specified dependencies.  ``plone.supermodel`` and a few others were missing.\n+[plone devs]\ndiff --git a/plone/i18n/tests/test_negotiation.py b/plone/i18n/tests/test_negotiation.py\nindex 5b81eb0..5fbf90d 100644\n--- a/plone/i18n/tests/test_negotiation.py\n+++ b/plone/i18n/tests/test_negotiation.py\n@@ -2,11 +2,11 @@\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n from plone.app.testing import TEST_USER_PASSWORD\n+from plone.base.interfaces import ILanguage\n from plone.i18n.interfaces import ILanguageSchema\n from plone.i18n.tests import base\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import ILanguage\n from zope.component import getUtility\n \n \ndiff --git a/setup.py b/setup.py\nindex 5a177d1..69a31be 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -35,16 +35,21 @@\n     zip_safe=False,\n     python_requires=">=3.8",\n     install_requires=[\n-        "plone.base",\n         "setuptools",\n+        "plone.registry",\n+        "plone.subrequest",\n+        "plone.supermodel",\n+        "Products.CMFCore",\n         "Unidecode>=1.0.22",\n         "zope.globalrequest",\n     ],\n     extras_require=dict(\n         test=[\n-            "plone.app.contenttypes[testing]",\n+            "plone.app.contenttypes[test]",\n+            "plone.app.multilingual",\n             "plone.app.testing",\n-            "zope.testing",\n+            "plone.base",\n+            "zope.browserresource",\n         ],\n     ),\n )\n'

Repository: plone.i18n


Branch: refs/heads/master
Date: 2023-03-15T10:13:02+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.i18n/commit/dcd6cced769603da866fada18f97056b85e6e492

Merge pull request #51 from plone/config-with-default-template-11bf8094

Fix dependencies

Files changed:
A news/49.bugfix
M .gitignore
M .meta.toml
M .pre-commit-config.yaml
M plone/i18n/tests/test_negotiation.py
M pyproject.toml
M setup.cfg
M setup.py
M tox.ini

b'diff --git a/.gitignore b/.gitignore\nindex 87d57cb..da2bc97 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -1,5 +1,6 @@\n *.py?\n .installed.cfg\n+.tox\n bin/\n develop-eggs/\n *.egg-info/\ndiff --git a/.meta.toml b/.meta.toml\nindex 3a3d3b1..9d3bd37 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -2,7 +2,7 @@\n # https://github.com/plone/meta/tree/master/config/default\n [meta]\n template = "default"\n-commit-id = "25f71b87"\n+commit-id = "0d0704ce"\n \n [codespell]\n additional-ignores = "fo,nam,nd,te,ue"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex a3085c9..582f8ac 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -19,7 +19,7 @@ repos:\n     hooks:\n     -   id: black\n -   repo: https://github.com/collective/zpretty\n-    rev: 3.0.1\n+    rev: 3.0.2\n     hooks:\n     -   id: zpretty\n -   repo: https://github.com/PyCQA/flake8\n@@ -37,6 +37,6 @@ repos:\n     hooks:\n     -   id: check-manifest\n -   repo: https://github.com/regebro/pyroma\n-    rev: "4.1"\n+    rev: "4.2"\n     hooks:\n     -   id: pyroma\ndiff --git a/news/49.bugfix b/news/49.bugfix\nnew file mode 100644\nindex 0000000..9d8ef83\n--- /dev/null\n+++ b/news/49.bugfix\n@@ -0,0 +1,2 @@\n+Correctly specified dependencies.  ``plone.supermodel`` and a few others were missing.\n+[plone devs]\ndiff --git a/plone/i18n/tests/test_negotiation.py b/plone/i18n/tests/test_negotiation.py\nindex 5b81eb0..5fbf90d 100644\n--- a/plone/i18n/tests/test_negotiation.py\n+++ b/plone/i18n/tests/test_negotiation.py\n@@ -2,11 +2,11 @@\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n from plone.app.testing import TEST_USER_PASSWORD\n+from plone.base.interfaces import ILanguage\n from plone.i18n.interfaces import ILanguageSchema\n from plone.i18n.tests import base\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import ILanguage\n from zope.component import getUtility\n \n \ndiff --git a/pyproject.toml b/pyproject.toml\nindex 90aaf4a..49f23bf 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -44,3 +44,22 @@ target-version = ["py38"]\n \n [tool.codespell]\n ignore-words-list = "fo,nam,nd,te,ue"\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex e70eb25..0da8f8f 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -21,4 +21,3 @@ ignore =\n     .meta.toml\n     .pre-commit-config.yaml\n     tox.ini\n-    lint-requirements.txt\ndiff --git a/setup.py b/setup.py\nindex 5a177d1..69a31be 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -35,16 +35,21 @@\n     zip_safe=False,\n     python_requires=">=3.8",\n     install_requires=[\n-        "plone.base",\n         "setuptools",\n+        "plone.registry",\n+        "plone.subrequest",\n+        "plone.supermodel",\n+        "Products.CMFCore",\n         "Unidecode>=1.0.22",\n         "zope.globalrequest",\n     ],\n     extras_require=dict(\n         test=[\n-            "plone.app.contenttypes[testing]",\n+            "plone.app.contenttypes[test]",\n+            "plone.app.multilingual",\n             "plone.app.testing",\n-            "zope.testing",\n+            "plone.base",\n+            "zope.browserresource",\n         ],\n     ),\n )\ndiff --git a/tox.ini b/tox.ini\nindex 401525a..fea726c 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -4,6 +4,7 @@\n envlist =\n     format\n     lint\n+    test\n \n [testenv]\n allowlist_externals =\n@@ -31,20 +32,19 @@ commands =\n [testenv:dependencies]\n description = check if the package defines all its dependencies and generate a graph out of them\n deps =\n-    z3c.dependencychecker==2.10\n-    pipdeptree==2.3.3\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n     graphviz  # optional dependency of pipdeptree\n commands =\n     dependencychecker\n-    sh -c \'pipdeptree --exclude setuptools,pipdeptree,wheel --graph-output svg > dependencies.svg\'\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n \n [testenv:test]\n-description = run the tests of the distribution\n+usedevelop = true\n deps =\n-    plone.i18n[test]\n-    pytest\n-    gocept.pytestlayer\n+    zope.testrunner\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n commands =\n-    pip install -e .[test]\n-    pytest\n+    zope-testrunner --test-path={toxinidir} -s plone.i18n\n+extras =\n+    test\n'

