Repository: Products.PlonePAS


Branch: refs/heads/master
Date: 2017-10-26T20:50:47+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.PlonePAS/commit/368a31209b1d0fbe718375812758c37022f59481

Revert "Revert "no wrapping, add getUserId""

This reverts commit c1573ba26276068e036240b180221b0ddc77eea4.
That one fixed test failures in PlonePAS, but caused lots more failures elsewhere, for example plone.app.contentmenu.

Files changed:
M src/Products/PlonePAS/tools/memberdata.py

diff --git a/src/Products/PlonePAS/tools/memberdata.py b/src/Products/PlonePAS/tools/memberdata.py
index 451e3b2..990051a 100644
--- a/src/Products/PlonePAS/tools/memberdata.py
+++ b/src/Products/PlonePAS/tools/memberdata.py
@@ -1,7 +1,6 @@
 # -*- coding: utf-8 -*-
 from AccessControl import ClassSecurityInfo
 from AccessControl.requestmethod import postonly
-from Acquisition import Implicit
 from App.class_init import InitializeClass
 from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2
 from Products.CMFCore.interfaces import IMember
@@ -189,7 +188,7 @@ def wrapUser(self, u):
         If possible, returns the Member object that corresponds
         to the given User object.
         '''
-        return MemberData(u, self).__of__(u)
+        return MemberData(u, self)
 
     @postonly
     def deleteMemberData(self, member_id, REQUEST=None):
@@ -224,7 +223,7 @@ def _getPlugins(self):
 
 
 @implementer(IManageCapabilities, IMember)
-class MemberData(Implicit, BaseMemberAdapter):
+class MemberData(BaseMemberAdapter):
 
     security = ClassSecurityInfo()
 
@@ -445,5 +444,9 @@ def has_permission(self, permission, object):
     def getGroups(self):
         return self._user.getGroups()
 
+    @security.public
+    def getUserId(self):
+        return self.id
+
 
 InitializeClass(MemberData)


