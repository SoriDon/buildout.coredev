Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2022-08-25T10:15:41+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/ac32e34b932c9729fe15490793636802884cfdf2

Add a timezone property to portal memberdata if it is missing

Fixes #295

Files changed:
A news/295.bugfix
M plone/app/upgrade/v60/betas.py
M plone/app/upgrade/v60/configure.zcml

b'diff --git a/news/295.bugfix b/news/295.bugfix\nnew file mode 100644\nindex 00000000..b16385f0\n--- /dev/null\n+++ b/news/295.bugfix\n@@ -0,0 +1 @@\n+Add a timezone property to portal memberdata if it is missing.\ndiff --git a/plone/app/upgrade/v60/betas.py b/plone/app/upgrade/v60/betas.py\nindex 404ea300..debd2b49 100644\n--- a/plone/app/upgrade/v60/betas.py\n+++ b/plone/app/upgrade/v60/betas.py\n@@ -1,3 +1,12 @@\n+from Products.CMFPlone.utils import getToolByName\n import logging\n \n logger = logging.getLogger("plone.app.upgrade")\n+\n+\n+def add_the_timezone_property(context):\n+    """Ensure that the portal_memberdata tool has the timezone property."""\n+    portal_memberdata = getToolByName(context, "portal_memberdata")\n+    if portal_memberdata.hasProperty("timezone"):\n+        return\n+    portal_memberdata.manage_addProperty("timezone", "", "string")\ndiff --git a/plone/app/upgrade/v60/configure.zcml b/plone/app/upgrade/v60/configure.zcml\nindex 99e528ee..344cd640 100644\n--- a/plone/app/upgrade/v60/configure.zcml\n+++ b/plone/app/upgrade/v60/configure.zcml\n@@ -145,4 +145,18 @@\n \n     </gs:upgradeSteps>\n \n+    <gs:upgradeSteps\n+        profile="Products.CMFPlone:plone"\n+        source="6007"\n+        destination="6008"\n+        >\n+      <!-- Plone 6.0.0b2 -->\n+\n+      <gs:upgradeStep\n+          title="Add a timezone property to portal memberdata if it is missing."\n+          handler=".betas.add_the_timezone_property"\n+          />\n+\n+    </gs:upgradeSteps>\n+\n </configure>\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2022-08-25T10:59:15+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/bc283c24715316689f415b1b66876e79ab37cc75

Fix target version

Files changed:
M plone/app/upgrade/v60/configure.zcml

b'diff --git a/plone/app/upgrade/v60/configure.zcml b/plone/app/upgrade/v60/configure.zcml\nindex 344cd640..78e8883f 100644\n--- a/plone/app/upgrade/v60/configure.zcml\n+++ b/plone/app/upgrade/v60/configure.zcml\n@@ -143,15 +143,6 @@\n           import_profile="plone.app.upgrade.v60:to6007"\n           />\n \n-    </gs:upgradeSteps>\n-\n-    <gs:upgradeSteps\n-        profile="Products.CMFPlone:plone"\n-        source="6007"\n-        destination="6008"\n-        >\n-      <!-- Plone 6.0.0b2 -->\n-\n       <gs:upgradeStep\n           title="Add a timezone property to portal memberdata if it is missing."\n           handler=".betas.add_the_timezone_property"\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2022-08-25T17:26:19+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/6c1094b3c727580dfe9ce8e761b47a4407368ae0

Merge pull request #296 from plone/295.bugfix

Add a timezone property to portal memberdata if it is missing

Files changed:
A news/295.bugfix
M plone/app/upgrade/v60/betas.py
M plone/app/upgrade/v60/configure.zcml

b'diff --git a/news/295.bugfix b/news/295.bugfix\nnew file mode 100644\nindex 00000000..b16385f0\n--- /dev/null\n+++ b/news/295.bugfix\n@@ -0,0 +1 @@\n+Add a timezone property to portal memberdata if it is missing.\ndiff --git a/plone/app/upgrade/v60/betas.py b/plone/app/upgrade/v60/betas.py\nindex 404ea300..debd2b49 100644\n--- a/plone/app/upgrade/v60/betas.py\n+++ b/plone/app/upgrade/v60/betas.py\n@@ -1,3 +1,12 @@\n+from Products.CMFPlone.utils import getToolByName\n import logging\n \n logger = logging.getLogger("plone.app.upgrade")\n+\n+\n+def add_the_timezone_property(context):\n+    """Ensure that the portal_memberdata tool has the timezone property."""\n+    portal_memberdata = getToolByName(context, "portal_memberdata")\n+    if portal_memberdata.hasProperty("timezone"):\n+        return\n+    portal_memberdata.manage_addProperty("timezone", "", "string")\ndiff --git a/plone/app/upgrade/v60/configure.zcml b/plone/app/upgrade/v60/configure.zcml\nindex 99e528ee..78e8883f 100644\n--- a/plone/app/upgrade/v60/configure.zcml\n+++ b/plone/app/upgrade/v60/configure.zcml\n@@ -143,6 +143,11 @@\n           import_profile="plone.app.upgrade.v60:to6007"\n           />\n \n+      <gs:upgradeStep\n+          title="Add a timezone property to portal memberdata if it is missing."\n+          handler=".betas.add_the_timezone_property"\n+          />\n+\n     </gs:upgradeSteps>\n \n </configure>\n'

