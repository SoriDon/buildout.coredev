Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2015-12-07T11:25:43+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.portlet.collection/commit/079389e28451a9b14898789366e22c47950b5396

Fixed sometimes failing test due to sorting.

Sorting on 'created' could give wrong results,
because the four items of this test are probably created in the same second,
which means the order might be wrong.
On Jenkins number 3 and 0 were in the list, instead of the expected 0 and 1.

Files changed:
M CHANGES.rst
M plone/portlet/collection/tests/test_portlet_collection.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 01a511a..218ef37 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fixed sometimes failing test due to sorting.
+  [maurits]
 
 
 3.0.5 (2015-11-26)
diff --git a/plone/portlet/collection/tests/test_portlet_collection.py b/plone/portlet/collection/tests/test_portlet_collection.py
index 8d9389f..ac27d9b 100644
--- a/plone/portlet/collection/tests/test_portlet_collection.py
+++ b/plone/portlet/collection/tests/test_portlet_collection.py
@@ -320,7 +320,7 @@ def test_exclude_context(self):
             'i': 'portal_type',
             'o': 'plone.app.querystring.operation.string.is',
             'v': 'News Item'}]
-        self.folder.collection.sort_on = 'created'
+        self.folder.collection.sort_on = 'id'
         context = self.folder['foo-news-item-title-1']
         included = [
             self.folder['foo-news-item-title-{0}'.format(idx)].absolute_url()


