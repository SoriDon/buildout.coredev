Repository: plone.app.caching


Branch: refs/heads/master
Date: 2022-03-29T18:22:22+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.caching/commit/ef0302383be82d91947e4b147b444087d9b735e9

Update weird changes in ETAG headers when combine_bundles is no longer called and timestamp.txt is not present in portal_resources

Files changed:
M plone/app/caching/tests/test_profile_with_caching_proxy.py
M plone/app/caching/tests/test_profile_without_caching_proxy.py

b'diff --git a/plone/app/caching/tests/test_profile_with_caching_proxy.py b/plone/app/caching/tests/test_profile_with_caching_proxy.py\nindex 78a990e..254dcc8 100644\n--- a/plone/app/caching/tests/test_profile_with_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_with_caching_proxy.py\n@@ -133,7 +133,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"|test_user_1_|%d|en|%s|0|0\'\n+            \'"|test_user_1_|%d|en|%s|0|0|"\'\n             % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n@@ -151,7 +151,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"|test_user_1_|%d|en|%s|0|1\'\n+            \'"|test_user_1_|%d|en|%s|0|1|"\'\n             % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n@@ -177,7 +177,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"|test_user_1_|%d|en|%s|0\'\n+            \'"|test_user_1_|%d|en|%s|0|"\'\n             % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n@@ -232,7 +232,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"||%d|en|%s|0|0\' % (catalog.getCounter(), skins_tool.default_skin),\n+            \'"||%d|en|%s|0|0|"\' % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\n@@ -251,7 +251,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"||%d|en|%s|0\' % (catalog.getCounter(), skins_tool.default_skin),\n+            \'"||%d|en|%s|0|"\' % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\n@@ -274,7 +274,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"||%d|en|%s|0\' % (catalog.getCounter(), skins_tool.default_skin),\n+            \'"||%d|en|%s|0|"\' % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\ndiff --git a/plone/app/caching/tests/test_profile_without_caching_proxy.py b/plone/app/caching/tests/test_profile_without_caching_proxy.py\nindex 897eb26..c59e14e 100644\n--- a/plone/app/caching/tests/test_profile_without_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_without_caching_proxy.py\n@@ -116,7 +116,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"|test_user_1_|{0}|en|{1}|0|0\'.format(\n+        tag = \'"|test_user_1_|{0}|en|{1}|0|0|"\'.format(\n             catalog.getCounter(),\n             default_skin,\n         )\n@@ -134,7 +134,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"|test_user_1_|{0}|en|{1}|0|1\'.format(\n+        tag = \'"|test_user_1_|{0}|en|{1}|0|1|"\'.format(\n             catalog.getCounter(),\n             default_skin,\n         )\n@@ -160,7 +160,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"|test_user_1_|{0}|en|{1}|0\'.format(\n+        tag = \'"|test_user_1_|{0}|en|{1}|0|"\'.format(\n             catalog.getCounter(),\n             default_skin,\n         )\n@@ -214,7 +214,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"||{0}|en|{1}|0|0\'.format(catalog.getCounter(), default_skin)\n+        tag = \'"||{0}|en|{1}|0|0|"\'.format(catalog.getCounter(), default_skin)\n         self.assertEqual(tag, normalize_etag(browser.headers["ETag"]))\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\n \n@@ -231,7 +231,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"||{0}|en|{1}|0\'.format(catalog.getCounter(), default_skin)\n+        tag = \'"||{0}|en|{1}|0|"\'.format(catalog.getCounter(), default_skin)\n         self.assertEqual(tag, normalize_etag(browser.headers["ETag"]))\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\n \n@@ -252,7 +252,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"||{0}|en|{1}|0\'.format(catalog.getCounter(), default_skin)\n+        tag = \'"||{0}|en|{1}|0|"\'.format(catalog.getCounter(), default_skin)\n         self.assertEqual(tag, normalize_etag(browser.headers["ETag"]))\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\n \n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2022-03-29T18:37:12+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.caching/commit/a82ba67d6ecf5e4a57f9d5310cfafd176f1f043c

add changenote

Files changed:
A news/92.bugfix

b'diff --git a/news/92.bugfix b/news/92.bugfix\nnew file mode 100644\nindex 0000000..066f32d\n--- /dev/null\n+++ b/news/92.bugfix\n@@ -0,0 +1,2 @@\n+Caching checks for timestamp.txt in portal_resources which is no longer there. Update ETAG Headers accordingly.\n+[pbauer]\n\\ No newline at end of file\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2022-03-29T21:37:52+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.caching/commit/0a269db0f705a14bb78b9d1321851668483e9a28

Merge pull request #92 from plone/update_cache_headers_without_combine_bundles

Update weird changes in ETAG headers when combine_bundles is gone

Files changed:
A news/92.bugfix
M plone/app/caching/tests/test_profile_with_caching_proxy.py
M plone/app/caching/tests/test_profile_without_caching_proxy.py

b'diff --git a/news/92.bugfix b/news/92.bugfix\nnew file mode 100644\nindex 0000000..066f32d\n--- /dev/null\n+++ b/news/92.bugfix\n@@ -0,0 +1,2 @@\n+Caching checks for timestamp.txt in portal_resources which is no longer there. Update ETAG Headers accordingly.\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/plone/app/caching/tests/test_profile_with_caching_proxy.py b/plone/app/caching/tests/test_profile_with_caching_proxy.py\nindex 78a990e..254dcc8 100644\n--- a/plone/app/caching/tests/test_profile_with_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_with_caching_proxy.py\n@@ -133,7 +133,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"|test_user_1_|%d|en|%s|0|0\'\n+            \'"|test_user_1_|%d|en|%s|0|0|"\'\n             % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n@@ -151,7 +151,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"|test_user_1_|%d|en|%s|0|1\'\n+            \'"|test_user_1_|%d|en|%s|0|1|"\'\n             % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n@@ -177,7 +177,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"|test_user_1_|%d|en|%s|0\'\n+            \'"|test_user_1_|%d|en|%s|0|"\'\n             % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n@@ -232,7 +232,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"||%d|en|%s|0|0\' % (catalog.getCounter(), skins_tool.default_skin),\n+            \'"||%d|en|%s|0|0|"\' % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\n@@ -251,7 +251,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"||%d|en|%s|0\' % (catalog.getCounter(), skins_tool.default_skin),\n+            \'"||%d|en|%s|0|"\' % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\n@@ -274,7 +274,7 @@ def test_composite_viewsxx(self):\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n         self.assertEqual(\n-            \'"||%d|en|%s|0\' % (catalog.getCounter(), skins_tool.default_skin),\n+            \'"||%d|en|%s|0|"\' % (catalog.getCounter(), skins_tool.default_skin),\n             normalize_etag(browser.headers["ETag"]),\n         )\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\ndiff --git a/plone/app/caching/tests/test_profile_without_caching_proxy.py b/plone/app/caching/tests/test_profile_without_caching_proxy.py\nindex 897eb26..c59e14e 100644\n--- a/plone/app/caching/tests/test_profile_without_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_without_caching_proxy.py\n@@ -116,7 +116,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"|test_user_1_|{0}|en|{1}|0|0\'.format(\n+        tag = \'"|test_user_1_|{0}|en|{1}|0|0|"\'.format(\n             catalog.getCounter(),\n             default_skin,\n         )\n@@ -134,7 +134,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"|test_user_1_|{0}|en|{1}|0|1\'.format(\n+        tag = \'"|test_user_1_|{0}|en|{1}|0|1|"\'.format(\n             catalog.getCounter(),\n             default_skin,\n         )\n@@ -160,7 +160,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"|test_user_1_|{0}|en|{1}|0\'.format(\n+        tag = \'"|test_user_1_|{0}|en|{1}|0|"\'.format(\n             catalog.getCounter(),\n             default_skin,\n         )\n@@ -214,7 +214,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"||{0}|en|{1}|0|0\'.format(catalog.getCounter(), default_skin)\n+        tag = \'"||{0}|en|{1}|0|0|"\'.format(catalog.getCounter(), default_skin)\n         self.assertEqual(tag, normalize_etag(browser.headers["ETag"]))\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\n \n@@ -231,7 +231,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"||{0}|en|{1}|0\'.format(catalog.getCounter(), default_skin)\n+        tag = \'"||{0}|en|{1}|0|"\'.format(catalog.getCounter(), default_skin)\n         self.assertEqual(tag, normalize_etag(browser.headers["ETag"]))\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\n \n@@ -252,7 +252,7 @@ def test_composite_views(self):\n         self.assertEqual(\n             "max-age=0, must-revalidate, private", browser.headers["Cache-Control"]\n         )\n-        tag = \'"||{0}|en|{1}|0\'.format(catalog.getCounter(), default_skin)\n+        tag = \'"||{0}|en|{1}|0|"\'.format(catalog.getCounter(), default_skin)\n         self.assertEqual(tag, normalize_etag(browser.headers["ETag"]))\n         self.assertGreater(now, dateutil.parser.parse(browser.headers["Expires"]))\n \n'

