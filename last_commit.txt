Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2017-09-27T10:00:28+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/8fe0e91aabd12e1c6910910773ebb1eb87fd66bf

Fix view @@updateLinkIntegrityInformation after Language='all' no longer works

Files changed:
M CHANGES.rst
M plone/app/linkintegrity/browser/update.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2efd283..d3679e0 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,9 @@ Bug fixes:
   paragraph to be always visible, even without link breaches.
   [arsenico13]
 
+- Fix view @@updateLinkIntegrityInformation after Language='all' no longer works.
+  [pbauer]
+
 
 3.3.2 (2017-08-14)
 ------------------
diff --git a/plone/app/linkintegrity/browser/update.py b/plone/app/linkintegrity/browser/update.py
index c4ddfe1..0ea9cb5 100644
--- a/plone/app/linkintegrity/browser/update.py
+++ b/plone/app/linkintegrity/browser/update.py
@@ -11,25 +11,6 @@
 from zExceptions import NotFound
 
 import logging
-import pkg_resources
-
-
-# Is there a multilingual addon?
-try:
-    pkg_resources.get_distribution('Products.LinguaPlone')
-except pkg_resources.DistributionNotFound:
-    HAS_MULTILINGUAL = False
-else:
-    HAS_MULTILINGUAL = True
-
-if not HAS_MULTILINGUAL:
-    try:
-        pkg_resources.get_distribution('plone.app.multilingual')
-    except pkg_resources.DistributionNotFound:
-        HAS_MULTILINGUAL = False
-    else:
-        HAS_MULTILINGUAL = True
-
 logger = logging.getLogger(__name__)
 
 
@@ -69,8 +50,6 @@ def update(self):
         catalog = getToolByName(self.context, 'portal_catalog')
         count = 0
         query = {}
-        if HAS_MULTILINGUAL and 'Language' in catalog.indexes():
-            query['Language'] = 'all'
 
         for brain in catalog(query):
             try:


Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2017-09-27T12:54:23+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/9cba64c3995527d1d91a67ece8bcbe68dd8919e3

remove obsolete query

Files changed:
M plone/app/linkintegrity/browser/update.py

diff --git a/plone/app/linkintegrity/browser/update.py b/plone/app/linkintegrity/browser/update.py
index 0ea9cb5..4891658 100644
--- a/plone/app/linkintegrity/browser/update.py
+++ b/plone/app/linkintegrity/browser/update.py
@@ -49,9 +49,8 @@ def __call__(self):
     def update(self):
         catalog = getToolByName(self.context, 'portal_catalog')
         count = 0
-        query = {}
 
-        for brain in catalog(query):
+        for brain in catalog():
             try:
                 obj = brain.getObject()
             except (AttributeError, NotFound, KeyError):


Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2017-09-27T14:27:11+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/9d2dc86bb437efee771c9c4b7e21dd2f6d532a7b

Merge pull request #59 from plone/fix_updateLinkIntegrityInformation

Fix view @@updateLinkIntegrityInformation

Files changed:
M CHANGES.rst
M plone/app/linkintegrity/browser/update.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2efd283..d3679e0 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,9 @@ Bug fixes:
   paragraph to be always visible, even without link breaches.
   [arsenico13]
 
+- Fix view @@updateLinkIntegrityInformation after Language='all' no longer works.
+  [pbauer]
+
 
 3.3.2 (2017-08-14)
 ------------------
diff --git a/plone/app/linkintegrity/browser/update.py b/plone/app/linkintegrity/browser/update.py
index c4ddfe1..4891658 100644
--- a/plone/app/linkintegrity/browser/update.py
+++ b/plone/app/linkintegrity/browser/update.py
@@ -11,25 +11,6 @@
 from zExceptions import NotFound
 
 import logging
-import pkg_resources
-
-
-# Is there a multilingual addon?
-try:
-    pkg_resources.get_distribution('Products.LinguaPlone')
-except pkg_resources.DistributionNotFound:
-    HAS_MULTILINGUAL = False
-else:
-    HAS_MULTILINGUAL = True
-
-if not HAS_MULTILINGUAL:
-    try:
-        pkg_resources.get_distribution('plone.app.multilingual')
-    except pkg_resources.DistributionNotFound:
-        HAS_MULTILINGUAL = False
-    else:
-        HAS_MULTILINGUAL = True
-
 logger = logging.getLogger(__name__)
 
 
@@ -68,11 +49,8 @@ def __call__(self):
     def update(self):
         catalog = getToolByName(self.context, 'portal_catalog')
         count = 0
-        query = {}
-        if HAS_MULTILINGUAL and 'Language' in catalog.indexes():
-            query['Language'] = 'all'
 
-        for brain in catalog(query):
+        for brain in catalog():
             try:
                 obj = brain.getObject()
             except (AttributeError, NotFound, KeyError):


