Repository: plone.autoform


Branch: refs/heads/master
Date: 2017-05-17T12:07:23+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.autoform/commit/cabd75ff2ba1185b953180b2694f8870e3a07832

Reduce field move failure logging from error to warning

Files changed:
M CHANGES.rst
M plone/autoform/base.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 99c79ca..eb0e37f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,10 @@ New features:
 
 Bug fixes:
 
+- Reduce field move failure logging from error to warning.
+  Log more information like full rule.
+  [jensens]
+
 - Fix traceback in updateFieldsFromSchemata for forms with no schema.
   [davisagli]
 
diff --git a/plone/autoform/base.py b/plone/autoform/base.py
index e20ba54..7addd53 100644
--- a/plone/autoform/base.py
+++ b/plone/autoform/base.py
@@ -241,15 +241,21 @@ def _process_field_moves(self, rules):
                     )
                 try:
                     move(self, name, before=before, after=after, prefix=prefix)
-                except KeyError:
-                    # The relative_to field doesn't exist
-                    logger.exception(
-                        'No field move possible for non-existing field named '
-                        '{0} with target {1}'.format(
-                            prefix + '.' + name,
-                            before or after
+                except KeyError as e:
+                    if (
+                        e.message.startswith('Field ') and
+                        e.message.endswith(' not found')
+                    ):
+                        # The relative_to field doesn't exist
+                        logger.warning(
+                            'Field move to non-existing: '
+                            'field name: {0}, rule: {1}'.format(
+                                prefix + '.' + name,
+                                str(rule)
+                            )
                         )
-                    )
+                    else:
+                        raise
             self._process_field_moves(rule.get('with', {}))
 
     def _process_group_order(self):


Repository: plone.autoform


Branch: refs/heads/master
Date: 2017-05-17T12:19:28+02:00
Author: Robert Niederreiter (rnixx) <office@squarewave.at>
Commit: https://github.com/plone/plone.autoform/commit/84494fd0772107dd3c43474479479e4c61faf659

Merge pull request #27 from plone/jensens-fieldmovelogging

Reduce field move failure logging from error to warning

Files changed:
M CHANGES.rst
M plone/autoform/base.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 99c79ca..eb0e37f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,10 @@ New features:
 
 Bug fixes:
 
+- Reduce field move failure logging from error to warning.
+  Log more information like full rule.
+  [jensens]
+
 - Fix traceback in updateFieldsFromSchemata for forms with no schema.
   [davisagli]
 
diff --git a/plone/autoform/base.py b/plone/autoform/base.py
index e20ba54..7addd53 100644
--- a/plone/autoform/base.py
+++ b/plone/autoform/base.py
@@ -241,15 +241,21 @@ def _process_field_moves(self, rules):
                     )
                 try:
                     move(self, name, before=before, after=after, prefix=prefix)
-                except KeyError:
-                    # The relative_to field doesn't exist
-                    logger.exception(
-                        'No field move possible for non-existing field named '
-                        '{0} with target {1}'.format(
-                            prefix + '.' + name,
-                            before or after
+                except KeyError as e:
+                    if (
+                        e.message.startswith('Field ') and
+                        e.message.endswith(' not found')
+                    ):
+                        # The relative_to field doesn't exist
+                        logger.warning(
+                            'Field move to non-existing: '
+                            'field name: {0}, rule: {1}'.format(
+                                prefix + '.' + name,
+                                str(rule)
+                            )
                         )
-                    )
+                    else:
+                        raise
             self._process_field_moves(rule.get('with', {}))
 
     def _process_group_order(self):


