Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2019-05-07T17:41:05-05:00
Author: Jens Vagelpohl (dataflake) <jens@netz.ooo>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/e9807380a1561d36786da00d78dca5edf883eba9

Clarify documentation for the `scripts` option

Files changed:
A news/29.bugfix
M README.rst

b"diff --git a/README.rst b/README.rst\nindex 1980fa2..6b1eae1 100644\n--- a/README.rst\n+++ b/README.rst\n@@ -466,10 +466,13 @@ scripts\n     eggs =\n       Plone\n       mr.migrator\n-      zopeskel\n-    scripts = zopeskel\n+      my.package\n+    scripts = my_package_script\n \n-  In the above example, only zopeskel's scripts will be generated.\n+  In the above example, only `my_package_script` will be generated. Keep in\n+  mind that the egg containing the script (``my.package`` in the example) must\n+  be listed explicitly in the eggs option, even if it is a dependency of an\n+  already listed egg.\n \n var\n   Used to configure the base directory for all things going into var.\ndiff --git a/news/29.bugfix b/news/29.bugfix\nnew file mode 100644\nindex 0000000..96a709f\n--- /dev/null\n+++ b/news/29.bugfix\n@@ -0,0 +1 @@\n+Clarify documentation for the `scripts` option\n"

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2019-05-07T21:23:50-05:00
Author: Jens Vagelpohl (dataflake) <jens@netz.ooo>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/c1eb17db57c4eb5a291b17a9c5d7703a6c58c965

Fix handling of ZEO client persistent cache and storage settings

Files changed:
A news/30.bugfix
M README.rst
M src/plone/recipe/zope2instance/ctl.py
M src/plone/recipe/zope2instance/recipe.py
M src/plone/recipe/zope2instance/tests/zope2instance.txt
M src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt

b'diff --git a/README.rst b/README.rst\nindex 6b1eae1..6c153fa 100644\n--- a/README.rst\n+++ b/README.rst\n@@ -336,13 +336,15 @@ Advanced ZEO options\n \n zeo-client-cache-size\n   Set the size of the ZEO client cache. Defaults to \'128MB\'. The ZEO cache is\n-  a disk based cache shared between application threads. It\'s stored inside\n-  the directory designated by the `TMP` environment variable.\n+  a disk based cache shared between application threads. It is stored either in\n+  temporary files or, in case you activate persistent cache files with the\n+  option `client` (see below), in the folder designated by the `zeo-var`\n+  option.\n \n zeo-client-client\n   Set the persistent cache name that is used to construct the cache\n-  filenames. This enabled the ZEO cache to be persisted. Persistent cache\n-  files are disabled by default.\n+  filenames. This enables the ZEO cache to persist across application restarts.\n+  Persistent cache files are disabled by default.\n \n zeo-client-blob-cache-size\n   Set the maximum size of the ZEO blob cache, in bytes.  If not set, then\n@@ -363,8 +365,9 @@ zeo-storage\n   Set the storage number of the ZEO storage. Defaults to \'1\'.\n \n zeo-var\n-  Used in the ZEO storage snippets to configure the ZEO var folder.\n-  Defaults to $INSTANCE_HOME/var.\n+  Used in the ZEO storage snippets to configure the ZEO var folder, which\n+  is used to store persistent ZEO client cache files. Defaults to the system\n+  temporary folder.\n \n Advanced options\n ----------------\ndiff --git a/news/30.bugfix b/news/30.bugfix\nnew file mode 100644\nindex 0000000..6c80528\n--- /dev/null\n+++ b/news/30.bugfix\n@@ -0,0 +1 @@\n+Fix handling of ZEO client persistent cache and storage settings\ndiff --git a/src/plone/recipe/zope2instance/ctl.py b/src/plone/recipe/zope2instance/ctl.py\nindex dc39944..9c326c6 100644\n--- a/src/plone/recipe/zope2instance/ctl.py\n+++ b/src/plone/recipe/zope2instance/ctl.py\n@@ -41,6 +41,7 @@\n import six\n import socket\n import sys\n+import tempfile\n import xml.sax\n import waitress\n import zdaemon\n@@ -104,6 +105,13 @@ def __init__(self):\n                  default=1)\n \n     def realize(self, *args, **kw):\n+        # Before ZConfig interprets the Zope configuration, we need to make\n+        # sure to put a suitable value for ZEO_TMP into the environment.\n+        # This value is used for storing ZEO persistent caches in case\n+        # the var option was not also specified. Otherwise it is not used\n+        # and setting it does not affect anything.\n+        os.environ.update({\'ZEO_TMP\': tempfile.gettempdir()})\n+\n         self.ZopeOptions.realize(self, *args, **kw)\n         # Additional checking of user option; set uid and gid\n         if self.user is not None:\ndiff --git a/src/plone/recipe/zope2instance/recipe.py b/src/plone/recipe/zope2instance/recipe.py\nindex e4edc37..d04405a 100644\n--- a/src/plone/recipe/zope2instance/recipe.py\n+++ b/src/plone/recipe/zope2instance/recipe.py\n@@ -505,9 +505,6 @@ def is_rs_option(name):\n                 zeo_client_drop_cache_rather_verify = (\n                     \'drop-cache-rather-verify %s\'\n                     % zeo_client_drop_cache_rather_verify)\n-            zeo_var_dir = options.get(\'zeo-var\',\n-                                      os.path.join(instance_home, \'var\'))\n-            zeo_client_client = options.get(\'zeo-client-client\', \'\')\n             zeo_client_blob_cache_size = options.get(\n                 \'zeo-client-blob-cache-size\', \'\')\n             zeo_client_blob_cache_size_check = options.get(\n@@ -518,8 +515,15 @@ def is_rs_option(name):\n                 \'max-disconnect-poll\', "")\n             zeo_client_read_only_fallback = options.get(\n                 \'zeo-client-read-only-fallback\', \'false\')\n+            zeo_client_client = options.get(\'zeo-client-client\', \'\')\n             if zeo_client_client:\n                 zeo_client_client = \'client %s\' % zeo_client_client\n+                zeo_var_dir = options.get(\'zeo-var\', \'\')\n+                if not zeo_var_dir:\n+                    zeo_var_dir = \'$(ZEO_TMP)\'\n+                zeo_var_dir = \'var %s\' % zeo_var_dir\n+            else:\n+                zeo_var_dir = \'\'\n             if zeo_client_blob_cache_size:\n                 zeo_client_blob_cache_size = (\n                     \'blob-cache-size %s\' % zeo_client_blob_cache_size)\n@@ -1015,9 +1019,9 @@ def render_file_storage(self, file_storage, blob_storage,\n       %(zeo_address_list)s\n       storage %(zeo_storage)s\n       name zeostorage\n-      var %(zeo_var_dir)s\n       cache-size %(zeo_client_cache_size)s\n       %(zeo_authentication)s\n+      %(zeo_var_dir)s\n       %(zeo_client_client)s\n       %(zeo_client_min_disconnect_poll)s\n       %(zeo_client_max_disconnect_poll)s\n@@ -1035,11 +1039,11 @@ def render_file_storage(self, file_storage, blob_storage,\n       %(zeo_address_list)s\n       storage %(zeo_storage)s\n       name zeostorage\n-      var %(zeo_var_dir)s\n       cache-size %(zeo_client_cache_size)s\n       %(zeo_client_blob_cache_size)s\n       %(zeo_client_blob_cache_size_check)s\n       %(zeo_authentication)s\n+      %(zeo_var_dir)s\n       %(zeo_client_client)s\n       %(zeo_client_min_disconnect_poll)s\n       %(zeo_client_max_disconnect_poll)s\ndiff --git a/src/plone/recipe/zope2instance/tests/zope2instance.txt b/src/plone/recipe/zope2instance/tests/zope2instance.txt\nindex 1d61647..d9d2d44 100644\n--- a/src/plone/recipe/zope2instance/tests/zope2instance.txt\n+++ b/src/plone/recipe/zope2instance/tests/zope2instance.txt\n@@ -827,11 +827,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -860,6 +860,7 @@ specified, they should get included in that section as well.\n     ... zeo-client-blob-cache-size = 5GB\n     ... zeo-client-blob-cache-size-check = 50\n     ... zeo-client-read-only-fallback = true\n+    ... zeo-var = %(sample_buildout)s/var\n     ... \'\'\' % options)\n \n Let\'s run it::\n@@ -888,11 +889,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n             blob-cache-size 5GB\n             blob-cache-size-check 50\n     <BLANKLINE>\n+            var .../sample-buildout/var\n             client persistentcache88\n             min-disconnect-poll 10\n             max-disconnect-poll 20\n@@ -945,11 +946,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         </demostorage>\n@@ -1001,11 +1002,11 @@ We should have a zope instance, with a basic zope.conf::\n           server 8100\n           storage 1\n           name zeostorage\n-          var .../sample-buildout/parts/instance/var\n           cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -1067,13 +1068,13 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n           </zeoclient>\n         </before>\n@@ -1126,11 +1127,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 127.0.0.1:8101\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -1181,11 +1182,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 127.0.0.1:8102\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\ndiff --git a/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt b/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\nindex a8c07cf..d50d763 100644\n--- a/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\n+++ b/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\n@@ -945,11 +945,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -979,6 +979,7 @@ specified, they should get included in that section as well.\n     ... zeo-client-blob-cache-size = 5GB\n     ... zeo-client-blob-cache-size-check = 50\n     ... zeo-client-read-only-fallback = true\n+    ... zeo-var = %(sample_buildout)s/var\n     ... \'\'\' % options)\n \n Let\'s run it::\n@@ -1007,11 +1008,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n             blob-cache-size 5GB\n             blob-cache-size-check 50\n     <BLANKLINE>\n+            var .../sample-buildout/var\n             client persistentcache88\n             min-disconnect-poll 10\n             max-disconnect-poll 20\n@@ -1065,11 +1066,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         </demostorage>\n@@ -1122,11 +1123,11 @@ We should have a zope instance, with a basic zope.conf::\n           server 8100\n           storage 1\n           name zeostorage\n-          var .../sample-buildout/parts/instance/var\n           cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -1189,13 +1190,13 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n           </zeoclient>\n         </before>\n@@ -1249,11 +1250,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 127.0.0.1:8101\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -1305,11 +1306,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 127.0.0.1:8102\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2019-05-08T11:40:41-05:00
Author: Jens Vagelpohl (dataflake) <jens@dataflake.org>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/a392f83e56f5f2a1f0071d9979e1a450bb85c881

Merge pull request #108 from plone/issue_30

Fix handling of ZEO client persistent cache and storage settings

Files changed:
A news/29.bugfix
A news/30.bugfix
M README.rst
M src/plone/recipe/zope2instance/ctl.py
M src/plone/recipe/zope2instance/recipe.py
M src/plone/recipe/zope2instance/tests/zope2instance.txt
M src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt

b'diff --git a/README.rst b/README.rst\nindex 1980fa2..6c153fa 100644\n--- a/README.rst\n+++ b/README.rst\n@@ -336,13 +336,15 @@ Advanced ZEO options\n \n zeo-client-cache-size\n   Set the size of the ZEO client cache. Defaults to \'128MB\'. The ZEO cache is\n-  a disk based cache shared between application threads. It\'s stored inside\n-  the directory designated by the `TMP` environment variable.\n+  a disk based cache shared between application threads. It is stored either in\n+  temporary files or, in case you activate persistent cache files with the\n+  option `client` (see below), in the folder designated by the `zeo-var`\n+  option.\n \n zeo-client-client\n   Set the persistent cache name that is used to construct the cache\n-  filenames. This enabled the ZEO cache to be persisted. Persistent cache\n-  files are disabled by default.\n+  filenames. This enables the ZEO cache to persist across application restarts.\n+  Persistent cache files are disabled by default.\n \n zeo-client-blob-cache-size\n   Set the maximum size of the ZEO blob cache, in bytes.  If not set, then\n@@ -363,8 +365,9 @@ zeo-storage\n   Set the storage number of the ZEO storage. Defaults to \'1\'.\n \n zeo-var\n-  Used in the ZEO storage snippets to configure the ZEO var folder.\n-  Defaults to $INSTANCE_HOME/var.\n+  Used in the ZEO storage snippets to configure the ZEO var folder, which\n+  is used to store persistent ZEO client cache files. Defaults to the system\n+  temporary folder.\n \n Advanced options\n ----------------\n@@ -466,10 +469,13 @@ scripts\n     eggs =\n       Plone\n       mr.migrator\n-      zopeskel\n-    scripts = zopeskel\n+      my.package\n+    scripts = my_package_script\n \n-  In the above example, only zopeskel\'s scripts will be generated.\n+  In the above example, only `my_package_script` will be generated. Keep in\n+  mind that the egg containing the script (``my.package`` in the example) must\n+  be listed explicitly in the eggs option, even if it is a dependency of an\n+  already listed egg.\n \n var\n   Used to configure the base directory for all things going into var.\ndiff --git a/news/29.bugfix b/news/29.bugfix\nnew file mode 100644\nindex 0000000..96a709f\n--- /dev/null\n+++ b/news/29.bugfix\n@@ -0,0 +1 @@\n+Clarify documentation for the `scripts` option\ndiff --git a/news/30.bugfix b/news/30.bugfix\nnew file mode 100644\nindex 0000000..6c80528\n--- /dev/null\n+++ b/news/30.bugfix\n@@ -0,0 +1 @@\n+Fix handling of ZEO client persistent cache and storage settings\ndiff --git a/src/plone/recipe/zope2instance/ctl.py b/src/plone/recipe/zope2instance/ctl.py\nindex dc39944..9c326c6 100644\n--- a/src/plone/recipe/zope2instance/ctl.py\n+++ b/src/plone/recipe/zope2instance/ctl.py\n@@ -41,6 +41,7 @@\n import six\n import socket\n import sys\n+import tempfile\n import xml.sax\n import waitress\n import zdaemon\n@@ -104,6 +105,13 @@ def __init__(self):\n                  default=1)\n \n     def realize(self, *args, **kw):\n+        # Before ZConfig interprets the Zope configuration, we need to make\n+        # sure to put a suitable value for ZEO_TMP into the environment.\n+        # This value is used for storing ZEO persistent caches in case\n+        # the var option was not also specified. Otherwise it is not used\n+        # and setting it does not affect anything.\n+        os.environ.update({\'ZEO_TMP\': tempfile.gettempdir()})\n+\n         self.ZopeOptions.realize(self, *args, **kw)\n         # Additional checking of user option; set uid and gid\n         if self.user is not None:\ndiff --git a/src/plone/recipe/zope2instance/recipe.py b/src/plone/recipe/zope2instance/recipe.py\nindex e4edc37..d04405a 100644\n--- a/src/plone/recipe/zope2instance/recipe.py\n+++ b/src/plone/recipe/zope2instance/recipe.py\n@@ -505,9 +505,6 @@ def is_rs_option(name):\n                 zeo_client_drop_cache_rather_verify = (\n                     \'drop-cache-rather-verify %s\'\n                     % zeo_client_drop_cache_rather_verify)\n-            zeo_var_dir = options.get(\'zeo-var\',\n-                                      os.path.join(instance_home, \'var\'))\n-            zeo_client_client = options.get(\'zeo-client-client\', \'\')\n             zeo_client_blob_cache_size = options.get(\n                 \'zeo-client-blob-cache-size\', \'\')\n             zeo_client_blob_cache_size_check = options.get(\n@@ -518,8 +515,15 @@ def is_rs_option(name):\n                 \'max-disconnect-poll\', "")\n             zeo_client_read_only_fallback = options.get(\n                 \'zeo-client-read-only-fallback\', \'false\')\n+            zeo_client_client = options.get(\'zeo-client-client\', \'\')\n             if zeo_client_client:\n                 zeo_client_client = \'client %s\' % zeo_client_client\n+                zeo_var_dir = options.get(\'zeo-var\', \'\')\n+                if not zeo_var_dir:\n+                    zeo_var_dir = \'$(ZEO_TMP)\'\n+                zeo_var_dir = \'var %s\' % zeo_var_dir\n+            else:\n+                zeo_var_dir = \'\'\n             if zeo_client_blob_cache_size:\n                 zeo_client_blob_cache_size = (\n                     \'blob-cache-size %s\' % zeo_client_blob_cache_size)\n@@ -1015,9 +1019,9 @@ def render_file_storage(self, file_storage, blob_storage,\n       %(zeo_address_list)s\n       storage %(zeo_storage)s\n       name zeostorage\n-      var %(zeo_var_dir)s\n       cache-size %(zeo_client_cache_size)s\n       %(zeo_authentication)s\n+      %(zeo_var_dir)s\n       %(zeo_client_client)s\n       %(zeo_client_min_disconnect_poll)s\n       %(zeo_client_max_disconnect_poll)s\n@@ -1035,11 +1039,11 @@ def render_file_storage(self, file_storage, blob_storage,\n       %(zeo_address_list)s\n       storage %(zeo_storage)s\n       name zeostorage\n-      var %(zeo_var_dir)s\n       cache-size %(zeo_client_cache_size)s\n       %(zeo_client_blob_cache_size)s\n       %(zeo_client_blob_cache_size_check)s\n       %(zeo_authentication)s\n+      %(zeo_var_dir)s\n       %(zeo_client_client)s\n       %(zeo_client_min_disconnect_poll)s\n       %(zeo_client_max_disconnect_poll)s\ndiff --git a/src/plone/recipe/zope2instance/tests/zope2instance.txt b/src/plone/recipe/zope2instance/tests/zope2instance.txt\nindex 1d61647..d9d2d44 100644\n--- a/src/plone/recipe/zope2instance/tests/zope2instance.txt\n+++ b/src/plone/recipe/zope2instance/tests/zope2instance.txt\n@@ -827,11 +827,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -860,6 +860,7 @@ specified, they should get included in that section as well.\n     ... zeo-client-blob-cache-size = 5GB\n     ... zeo-client-blob-cache-size-check = 50\n     ... zeo-client-read-only-fallback = true\n+    ... zeo-var = %(sample_buildout)s/var\n     ... \'\'\' % options)\n \n Let\'s run it::\n@@ -888,11 +889,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n             blob-cache-size 5GB\n             blob-cache-size-check 50\n     <BLANKLINE>\n+            var .../sample-buildout/var\n             client persistentcache88\n             min-disconnect-poll 10\n             max-disconnect-poll 20\n@@ -945,11 +946,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         </demostorage>\n@@ -1001,11 +1002,11 @@ We should have a zope instance, with a basic zope.conf::\n           server 8100\n           storage 1\n           name zeostorage\n-          var .../sample-buildout/parts/instance/var\n           cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -1067,13 +1068,13 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n           </zeoclient>\n         </before>\n@@ -1126,11 +1127,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 127.0.0.1:8101\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -1181,11 +1182,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 127.0.0.1:8102\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\ndiff --git a/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt b/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\nindex a8c07cf..d50d763 100644\n--- a/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\n+++ b/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\n@@ -945,11 +945,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -979,6 +979,7 @@ specified, they should get included in that section as well.\n     ... zeo-client-blob-cache-size = 5GB\n     ... zeo-client-blob-cache-size-check = 50\n     ... zeo-client-read-only-fallback = true\n+    ... zeo-var = %(sample_buildout)s/var\n     ... \'\'\' % options)\n \n Let\'s run it::\n@@ -1007,11 +1008,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n             blob-cache-size 5GB\n             blob-cache-size-check 50\n     <BLANKLINE>\n+            var .../sample-buildout/var\n             client persistentcache88\n             min-disconnect-poll 10\n             max-disconnect-poll 20\n@@ -1065,11 +1066,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         </demostorage>\n@@ -1122,11 +1123,11 @@ We should have a zope instance, with a basic zope.conf::\n           server 8100\n           storage 1\n           name zeostorage\n-          var .../sample-buildout/parts/instance/var\n           cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -1189,13 +1190,13 @@ We should have a zope instance, with a basic zope.conf::\n             server 8100\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n           </zeoclient>\n         </before>\n@@ -1249,11 +1250,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 127.0.0.1:8101\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n@@ -1305,11 +1306,11 @@ We should have a zope instance, with a basic zope.conf::\n             server 127.0.0.1:8102\n             storage 1\n             name zeostorage\n-            var .../sample-buildout/parts/instance/var\n             cache-size 128MB\n     <BLANKLINE>\n     <BLANKLINE>\n     <BLANKLINE>\n+    <BLANKLINE>\n     <BLANKLINE>\n         </zeoclient>\n         ...\n'

