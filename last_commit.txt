Repository: Products.PortalTransforms


Branch: refs/heads/master
Date: 2016-01-26T15:35:57+01:00
Author: Patrick Gerken (do3cc) <patrick.gerken@zumtobelgroup.com>
Commit: https://github.com/plone/Products.PortalTransforms/commit/671454ec33850aa196d361b8c4fd23c5921afe61

Fixed test that depends on ubuntus newer pdftohtml

Aww

Files changed:
M CHANGES.rst
M Products/PortalTransforms/tests/test_transforms.py
M Products/PortalTransforms/tests/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6008311..ab03714 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -24,6 +24,9 @@ Fixes:
   zca decorators, minor manual edits
   [jensens]
 
+- Make tests compatible with OS other than Ubuntu 14.04.
+  [do3cc]
+
 
 2.1.10 (2015-09-15)
 -------------------
diff --git a/Products/PortalTransforms/tests/test_transforms.py b/Products/PortalTransforms/tests/test_transforms.py
index 5399109..a5a2b55 100644
--- a/Products/PortalTransforms/tests/test_transforms.py
+++ b/Products/PortalTransforms/tests/test_transforms.py
@@ -334,7 +334,7 @@ def test_invalid_tags(self):
 
 TRANSFORMS_TESTINFO = (
     ('Products.PortalTransforms.transforms.pdf_to_html',
-     "demo1.pdf", "demo1.html", None, 0,
+     "demo1.pdf", "demo1.html", normalize_html, 0,
      ),
     ('Products.PortalTransforms.transforms.word_to_html',
      "test.doc", "test_word.html", normalize_html, 0,
diff --git a/Products/PortalTransforms/tests/utils.py b/Products/PortalTransforms/tests/utils.py
index 973e9dd..b0ec51d 100644
--- a/Products/PortalTransforms/tests/utils.py
+++ b/Products/PortalTransforms/tests/utils.py
@@ -16,6 +16,7 @@ def normalize_html(s):
     s = re.sub(r"(?s)\s+<", "<", s)
     s = re.sub(r"(?s)>\s+", ">", s)
     s = re.sub(r"\r", "", s)
+    s = re.sub(r"<A", "<a", s)
     return s
 
 


