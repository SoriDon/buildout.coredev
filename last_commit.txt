Repository: Products.PlonePAS


Branch: refs/heads/master
Date: 2017-10-26T20:22:40+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.PlonePAS/commit/c1573ba26276068e036240b180221b0ddc77eea4

Revert "no wrapping, add getUserId"

This reverts commit a80db7d7f59594bb5b9fd50b76baa5b0f3cd89db.

It changes the acquisition chain, resulting in the aq_parent of a memberdata object being acl_users, instead of a PloneUser object.

Files changed:
M src/Products/PlonePAS/tools/memberdata.py

diff --git a/src/Products/PlonePAS/tools/memberdata.py b/src/Products/PlonePAS/tools/memberdata.py
index 990051a..451e3b2 100644
--- a/src/Products/PlonePAS/tools/memberdata.py
+++ b/src/Products/PlonePAS/tools/memberdata.py
@@ -1,6 +1,7 @@
 # -*- coding: utf-8 -*-
 from AccessControl import ClassSecurityInfo
 from AccessControl.requestmethod import postonly
+from Acquisition import Implicit
 from App.class_init import InitializeClass
 from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2
 from Products.CMFCore.interfaces import IMember
@@ -188,7 +189,7 @@ def wrapUser(self, u):
         If possible, returns the Member object that corresponds
         to the given User object.
         '''
-        return MemberData(u, self)
+        return MemberData(u, self).__of__(u)
 
     @postonly
     def deleteMemberData(self, member_id, REQUEST=None):
@@ -223,7 +224,7 @@ def _getPlugins(self):
 
 
 @implementer(IManageCapabilities, IMember)
-class MemberData(BaseMemberAdapter):
+class MemberData(Implicit, BaseMemberAdapter):
 
     security = ClassSecurityInfo()
 
@@ -444,9 +445,5 @@ def has_permission(self, permission, object):
     def getGroups(self):
         return self._user.getGroups()
 
-    @security.public
-    def getUserId(self):
-        return self.id
-
 
 InitializeClass(MemberData)


