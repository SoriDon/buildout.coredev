Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-10-07T10:43:17+02:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.restapi/commit/f823cb21e4852e1d44e03fcf74be0b44ebdbcc7e

Cache buildout eggs between builds (#1515)

* Cache buildout eggs between builds

* changelog

* separate buildout eggs cache for each python version

* also use plone version in cache key

* fix path

* newer version of cache action

* Improve cache keys

Files changed:
A news/1515.internal
M .github/workflows/tests.yml

b"diff --git a/.github/workflows/tests.yml b/.github/workflows/tests.yml\nindex c4f6b7605..1a36bdb40 100644\n--- a/.github/workflows/tests.yml\n+++ b/.github/workflows/tests.yml\n@@ -24,17 +24,19 @@ jobs:\n \n       # python setup\n       - name: Set up Python ${{ matrix.python-version }}\n-        uses: actions/setup-python@v1\n+        uses: actions/setup-python@v4\n         with:\n           python-version: ${{ matrix.python-version }}\n+          cache: 'pip'\n \n-      # python cache\n-      - uses: actions/cache@v1\n+      # buildout eggs cache\n+      - uses: actions/cache@v3\n         with:\n-          path: ~/.cache/pip\n-          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}\n+          path: eggs\n+          key: ${{ runner.os }}-py${{ matrix.python-version }}-plone${{ matrix.plone-version }}-${{ hashFiles('*.cfg') }}\n           restore-keys: |\n-            ${{ runner.os }}-pip-\n+            ${{ runner.os }}-py${{ matrix.python-version }}-plone${{ matrix.plone-version }}-\n+            ${{ runner.os }}-py${{ matrix.python-version }}-\n \n       # python install\n       - run: pip install virtualenv\n@@ -44,7 +46,7 @@ jobs:\n \n       # buildout\n       - name: buildout\n-        run: buildout -t 10 -c plone-${{ matrix.plone-version }}.x.cfg code-analysis:return-status-codes=True\n+        run: buildout -t 10 -c plone-${{ matrix.plone-version }}.x.cfg\n         env:\n           CI: true\n \n@@ -56,8 +58,8 @@ jobs:\n       - name: test\n         run: bin/test\n \n-      # test no uncommited changes\n-      - name: test no uncommited changes\n+      # test no uncommitted changes\n+      - name: test no uncommitted changes\n         run: ./test-no-uncommitted-doc-changes\n         env:\n           PYTHON_VERSION: ${{ matrix.python-version }}\ndiff --git a/news/1515.internal b/news/1515.internal\nnew file mode 100644\nindex 000000000..4384aab80\n--- /dev/null\n+++ b/news/1515.internal\n@@ -0,0 +1 @@\n+Cache buildout eggs between Github Actions runs. [davisagli]\n"

