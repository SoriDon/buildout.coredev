Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2016-03-04T12:26:02Z
Author: Daniel Jowett (djowett) <daniel@jowettenterprises.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/18795ef99a7200bdb763a2c22ba5118b7efa0812

Really don't show the Google Translate button when no API key set (fixes #184 on master)

Also remove unused gtenabled() methods in add.py &amp; edit.py

Files changed:
M CHANGES.rst
M src/plone/app/multilingual/browser/add.py
M src/plone/app/multilingual/browser/edit.py
M src/plone/app/multilingual/browser/javascript/babel_helper.js
M src/plone/app/multilingual/browser/templates/dexterity_edit.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 847bfb8..4796fe4 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -24,6 +24,7 @@ Fixes:
 
 - Clarify naming of Language Independent Folders
   [djowett]
+- Really don't show the Google Translate button when no API key set [djowett]
 
 
 3.0.14 (2016-02-25)
diff --git a/src/plone/app/multilingual/browser/add.py b/src/plone/app/multilingual/browser/add.py
index 2299fe1..90d1b43 100644
--- a/src/plone/app/multilingual/browser/add.py
+++ b/src/plone/app/multilingual/browser/add.py
@@ -120,11 +120,6 @@ class MultilingualAddForm(DefaultAddForm):
 
     group_class = MultilingualAddFormGroup
 
-    def gtenabled(self):
-        registry = getUtility(IRegistry)
-        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
-        return settings.google_translation_key != ''
-
     def portal_url(self):
         portal_tool = getToolByName(self.context, 'portal_url', None)
         if portal_tool is not None:
diff --git a/src/plone/app/multilingual/browser/edit.py b/src/plone/app/multilingual/browser/edit.py
index 129b9cb..6fb190e 100644
--- a/src/plone/app/multilingual/browser/edit.py
+++ b/src/plone/app/multilingual/browser/edit.py
@@ -16,11 +16,6 @@ class MultilingualEditForm(DefaultEditForm):
 
     babel = ViewPageTemplateFile("templates/dexterity_edit.pt")
 
-    def gtenabled(self):
-        registry = getUtility(IRegistry)
-        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
-        return settings.google_translation_key != ''
-
     def languages(self):
         """ Deprecated """
         context = aq_inner(self.context)
diff --git a/src/plone/app/multilingual/browser/javascript/babel_helper.js b/src/plone/app/multilingual/browser/javascript/babel_helper.js
index 470effc..a556e43 100644
--- a/src/plone/app/multilingual/browser/javascript/babel_helper.js
+++ b/src/plone/app/multilingual/browser/javascript/babel_helper.js
@@ -133,7 +133,7 @@
             sync_element_vertically(original_field, destination_field, padding, index === 0);
 
             // Add the google translation field
-            if ($('#gtanslate_service').attr('value') === "True" && ((original_field.find('.richtext-field, .textline-field, .text-field, .localstatic-field, .ArchetypesField-TextField').length > 0) || ($('#at-babel-edit').length > 0))) {
+            if ($('#gtranslate_service_available').attr('value') === "True" && ((original_field.find('.richtext-field, .textline-field, .text-field, .localstatic-field, .ArchetypesField-TextField').length > 0) || ($('#at-babel-edit').length > 0))) {
                 original_field.prepend("<div class='translator-widget' id='item_translation_" + order + "'></div>");
                 original_field.children('.translator-widget').click(function () {
                     var field = $(value).attr("rel");
diff --git a/src/plone/app/multilingual/browser/templates/dexterity_edit.pt b/src/plone/app/multilingual/browser/templates/dexterity_edit.pt
index ba9aa17..d6b9b60 100644
--- a/src/plone/app/multilingual/browser/templates/dexterity_edit.pt
+++ b/src/plone/app/multilingual/browser/templates/dexterity_edit.pt
@@ -10,7 +10,7 @@
 
     <script src="++resource++plone.app.multilingual.javascript/babel_helper.js"></script>
     <input type="hidden" id="url_translate" value="" tal:attributes="value context/absolute_url"/>
-    <input type="hidden" id="gtanslate_service" value="" tal:attributes="value view/gtenabled"/>
+    <input type="hidden" id="gtranslate_service_available" value="" tal:attributes="value pamutils/gtenabled"/>
     <div class='col-md-6'>
         <h1 i18n:translate="heading_available_translations">Available translations for this content</h1>
         <div id="trans-selector"
@@ -47,4 +47,3 @@
     </div>
     </div>
 </div>
-


Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2016-03-04T12:31:18Z
Author: Daniel Jowett (djowett) <daniel@jowettenterprises.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/ea4821ce7508c893653671f4802ab30fc7141acc

Tweak changelog so changes fall in correct release

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 4796fe4..8891f8d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,8 +14,8 @@ New:
 
 Fixes:
 
-- *add item here*
-
+- Really don't show the Google Translate button when no API key set 
+  [djowett]
 
 3.0.15 (2016-03-01)
 -------------------
@@ -24,7 +24,7 @@ Fixes:
 
 - Clarify naming of Language Independent Folders
   [djowett]
-- Really don't show the Google Translate button when no API key set [djowett]
+
 
 
 3.0.14 (2016-02-25)


Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2016-03-07T13:39:36+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.multilingual/commit/059ebac2b751b897a76baf6cc2442d63b12f03a7

Merge pull request #211 from plone/master-fix-issue-184

Really don't show the Google Translate button when no API key set

Files changed:
M CHANGES.rst
M src/plone/app/multilingual/browser/add.py
M src/plone/app/multilingual/browser/edit.py
M src/plone/app/multilingual/browser/javascript/babel_helper.js
M src/plone/app/multilingual/browser/templates/dexterity_edit.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 847bfb8..8891f8d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,8 +14,8 @@ New:
 
 Fixes:
 
-- *add item here*
-
+- Really don't show the Google Translate button when no API key set 
+  [djowett]
 
 3.0.15 (2016-03-01)
 -------------------
@@ -26,6 +26,7 @@ Fixes:
   [djowett]
 
 
+
 3.0.14 (2016-02-25)
 -------------------
 
diff --git a/src/plone/app/multilingual/browser/add.py b/src/plone/app/multilingual/browser/add.py
index 2299fe1..90d1b43 100644
--- a/src/plone/app/multilingual/browser/add.py
+++ b/src/plone/app/multilingual/browser/add.py
@@ -120,11 +120,6 @@ class MultilingualAddForm(DefaultAddForm):
 
     group_class = MultilingualAddFormGroup
 
-    def gtenabled(self):
-        registry = getUtility(IRegistry)
-        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
-        return settings.google_translation_key != ''
-
     def portal_url(self):
         portal_tool = getToolByName(self.context, 'portal_url', None)
         if portal_tool is not None:
diff --git a/src/plone/app/multilingual/browser/edit.py b/src/plone/app/multilingual/browser/edit.py
index 129b9cb..6fb190e 100644
--- a/src/plone/app/multilingual/browser/edit.py
+++ b/src/plone/app/multilingual/browser/edit.py
@@ -16,11 +16,6 @@ class MultilingualEditForm(DefaultEditForm):
 
     babel = ViewPageTemplateFile("templates/dexterity_edit.pt")
 
-    def gtenabled(self):
-        registry = getUtility(IRegistry)
-        settings = registry.forInterface(IMultiLanguageExtraOptionsSchema, prefix="plone")
-        return settings.google_translation_key != ''
-
     def languages(self):
         """ Deprecated """
         context = aq_inner(self.context)
diff --git a/src/plone/app/multilingual/browser/javascript/babel_helper.js b/src/plone/app/multilingual/browser/javascript/babel_helper.js
index 470effc..a556e43 100644
--- a/src/plone/app/multilingual/browser/javascript/babel_helper.js
+++ b/src/plone/app/multilingual/browser/javascript/babel_helper.js
@@ -133,7 +133,7 @@
             sync_element_vertically(original_field, destination_field, padding, index === 0);
 
             // Add the google translation field
-            if ($('#gtanslate_service').attr('value') === "True" && ((original_field.find('.richtext-field, .textline-field, .text-field, .localstatic-field, .ArchetypesField-TextField').length > 0) || ($('#at-babel-edit').length > 0))) {
+            if ($('#gtranslate_service_available').attr('value') === "True" && ((original_field.find('.richtext-field, .textline-field, .text-field, .localstatic-field, .ArchetypesField-TextField').length > 0) || ($('#at-babel-edit').length > 0))) {
                 original_field.prepend("<div class='translator-widget' id='item_translation_" + order + "'></div>");
                 original_field.children('.translator-widget').click(function () {
                     var field = $(value).attr("rel");
diff --git a/src/plone/app/multilingual/browser/templates/dexterity_edit.pt b/src/plone/app/multilingual/browser/templates/dexterity_edit.pt
index ba9aa17..d6b9b60 100644
--- a/src/plone/app/multilingual/browser/templates/dexterity_edit.pt
+++ b/src/plone/app/multilingual/browser/templates/dexterity_edit.pt
@@ -10,7 +10,7 @@
 
     <script src="++resource++plone.app.multilingual.javascript/babel_helper.js"></script>
     <input type="hidden" id="url_translate" value="" tal:attributes="value context/absolute_url"/>
-    <input type="hidden" id="gtanslate_service" value="" tal:attributes="value view/gtenabled"/>
+    <input type="hidden" id="gtranslate_service_available" value="" tal:attributes="value pamutils/gtenabled"/>
     <div class='col-md-6'>
         <h1 i18n:translate="heading_available_translations">Available translations for this content</h1>
         <div id="trans-selector"
@@ -47,4 +47,3 @@
     </div>
     </div>
 </div>
-


