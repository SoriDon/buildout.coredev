Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2017-05-05T11:22:45+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.iterate/commit/36f18a0570a23e4e79fb0f3b42e6d503eea1740b

Prevent using queryUtility with name=None

Files changed:
M CHANGES.rst
M plone/app/iterate/copier.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4239f60..6b52ca5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,8 @@ Bug fixes:
 - removed "change portal events" permission
   [kakshay21]
 
+- Prevent using queryUtility with name=None
+  [pbauer]
 
 3.3.2 (2017-03-23)
 ------------------
diff --git a/plone/app/iterate/copier.py b/plone/app/iterate/copier.py
index ef6dc0b..e7cbb4d 100644
--- a/plone/app/iterate/copier.py
+++ b/plone/app/iterate/copier.py
@@ -239,9 +239,14 @@ def _handleReferences(self, baseline, wc, mode, wc_ref):
 
         # handle forward references
         for relationship in baseline.getRelationships():
-            # look for a named relation adapter first
-            adapter = component.queryAdapter(
-                baseline, interfaces.ICheckinCheckoutReference, relationship)
+            if relationship is None:
+                adapter = None
+            else:
+                # look for a named relation adapter first
+                adapter = component.queryAdapter(
+                    baseline,
+                    interfaces.ICheckinCheckoutReference,
+                    relationship)
 
             if adapter is None:  # default
                 adapter = baseline_adapter
@@ -255,8 +260,15 @@ def _handleReferences(self, baseline, wc, mode, wc_ref):
 
         # handle backward references
         for relationship in baseline.getBRelationships():
-            adapter = component.queryAdapter(
-                baseline, interfaces.ICheckinCheckoutReference, relationship)
+            if relationship is None:
+                adapter = None
+            else:
+                # look for a named relation adapter first
+                adapter = component.queryAdapter(
+                    baseline,
+                    interfaces.ICheckinCheckoutReference,
+                    relationship)
+
             if adapter is None:
                 adapter = baseline_adapter
 


Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2017-05-05T12:43:41+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.iterate/commit/6abd86423aeeb01861e5081c6428af3336bc36bf

Merge pull request #45 from plone/fix-none-adapter-lookup

Prevent using queryUtility with name=None

Files changed:
M CHANGES.rst
M plone/app/iterate/copier.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4239f60..6b52ca5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,8 @@ Bug fixes:
 - removed "change portal events" permission
   [kakshay21]
 
+- Prevent using queryUtility with name=None
+  [pbauer]
 
 3.3.2 (2017-03-23)
 ------------------
diff --git a/plone/app/iterate/copier.py b/plone/app/iterate/copier.py
index ef6dc0b..e7cbb4d 100644
--- a/plone/app/iterate/copier.py
+++ b/plone/app/iterate/copier.py
@@ -239,9 +239,14 @@ def _handleReferences(self, baseline, wc, mode, wc_ref):
 
         # handle forward references
         for relationship in baseline.getRelationships():
-            # look for a named relation adapter first
-            adapter = component.queryAdapter(
-                baseline, interfaces.ICheckinCheckoutReference, relationship)
+            if relationship is None:
+                adapter = None
+            else:
+                # look for a named relation adapter first
+                adapter = component.queryAdapter(
+                    baseline,
+                    interfaces.ICheckinCheckoutReference,
+                    relationship)
 
             if adapter is None:  # default
                 adapter = baseline_adapter
@@ -255,8 +260,15 @@ def _handleReferences(self, baseline, wc, mode, wc_ref):
 
         # handle backward references
         for relationship in baseline.getBRelationships():
-            adapter = component.queryAdapter(
-                baseline, interfaces.ICheckinCheckoutReference, relationship)
+            if relationship is None:
+                adapter = None
+            else:
+                # look for a named relation adapter first
+                adapter = component.queryAdapter(
+                    baseline,
+                    interfaces.ICheckinCheckoutReference,
+                    relationship)
+
             if adapter is None:
                 adapter = baseline_adapter
 


