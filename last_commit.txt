Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2017-07-04T12:25:22+03:00
Author: Valtteri Karppinen (vkarppinen) <karppinenvaltteri@gmail.com>
Commit: https://github.com/plone/Products.Archetypes/commit/7aeea6c024e101b7c2a3be343b267d78634b5c4b

Fix bug with old jquery version and the possibility to add text over max limit

Files changed:
M CHANGES.rst
M Products/Archetypes/skins/archetypes/widgets/js/textcount.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 4f95beed..bbe93737 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,12 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fixed textcount.js support jquery>1.6.
+  [vkarppinen]
+
+- Fixed a bug (that it was possible to enter text length over maxlimit)
+  by replacing maxlimit alert() with highlighting textcountfield.
+  [vkarppinen]
 
 
 1.14.1 (2017-06-16)
diff --git a/Products/Archetypes/skins/archetypes/widgets/js/textcount.js b/Products/Archetypes/skins/archetypes/widgets/js/textcount.js
index 48c9a85f..cd923e3e 100644
--- a/Products/Archetypes/skins/archetypes/widgets/js/textcount.js
+++ b/Products/Archetypes/skins/archetypes/widgets/js/textcount.js
@@ -1,12 +1,13 @@
 <!-- Original:  Ronnie T. Moore -->
 <!-- Dynamic 'fix' by: Nannette Thacker -->
 function textCounter(field, countfield, maxlimit) {
-  var fieldval = jQuery(field).attr('value');
+  var fieldval = jQuery(field).val();
+  var countfield = jQuery('input[name="' + countfield + '"]');
   if (fieldval.length > maxlimit) {
       // if too long...trim it!
-      jQuery(field).attr('value',  fieldval.substring(0, maxlimit));
-      alert( 'This field is limited to ' + maxlimit + ' characters in length.' );
-  } 
-  // update 'characters left' counter	
-  jQuery('input[name="' + countfield + '"]').attr('value', Math.max(maxlimit - fieldval.length, 0));
+      jQuery(field).val(fieldval.substring(0, maxlimit));
+      countfield.css('border', '1px solid red');
+  }
+  // update 'characters left' counter
+  countfield.attr('value', Math.max(maxlimit - fieldval.length, 0));
 }


Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2017-07-06T10:33:55+03:00
Author: Valtteri Karppinen (vkarppinen) <karppinenvaltteri@gmail.com>
Commit: https://github.com/plone/Products.Archetypes/commit/7475150e2c75766199c30af83c71a6c02efe6b76

Fixed comments and clarified variable names

Files changed:
M Products/Archetypes/skins/archetypes/widgets/js/textcount.js

diff --git a/Products/Archetypes/skins/archetypes/widgets/js/textcount.js b/Products/Archetypes/skins/archetypes/widgets/js/textcount.js
index cd923e3e..b09ff827 100644
--- a/Products/Archetypes/skins/archetypes/widgets/js/textcount.js
+++ b/Products/Archetypes/skins/archetypes/widgets/js/textcount.js
@@ -1,13 +1,15 @@
-<!-- Original:  Ronnie T. Moore -->
-<!-- Dynamic 'fix' by: Nannette Thacker -->
+// Original:  Ronnie T. Moore
+// Dynamic 'fix' by: Nannette Thacker
 function textCounter(field, countfield, maxlimit) {
   var fieldval = jQuery(field).val();
-  var countfield = jQuery('input[name="' + countfield + '"]');
+  var counterElem = jQuery('input[name="' + countfield + '"]');
   if (fieldval.length > maxlimit) {
-      // if too long...trim it!
-      jQuery(field).val(fieldval.substring(0, maxlimit));
-      countfield.css('border', '1px solid red');
+    // if too long...trim it!
+    jQuery(field).val(fieldval.substring(0, maxlimit));
+    counterElem.css('border-color', 'red');
+  } else {
+    counterElem.css('border-color', '#ccc');
   }
   // update 'characters left' counter
-  countfield.attr('value', Math.max(maxlimit - fieldval.length, 0));
+  counterElem.val(Math.max(maxlimit - fieldval.length, 0));
 }


Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2017-07-06T10:43:19+03:00
Author: Valtteri Karppinen (vkarppinen) <karppinenvaltteri@gmail.com>
Commit: https://github.com/plone/Products.Archetypes/commit/1a6f23444edc9af93406f121a227b9d0226b4624

Merge remote-tracking branch 'origin/master' into vkarppinen/textcount

Files changed:
M CHANGES.rst
M Products/Archetypes/ReferenceEngine.py

diff --git a/CHANGES.rst b/CHANGES.rst
index bbe93737..8d33c44e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -21,6 +21,10 @@ Bug fixes:
   by replacing maxlimit alert() with highlighting textcountfield.
   [vkarppinen]
 
+- Prevent AttributeError on deleting a Reference from a object that is gone.
+  Fixes https://github.com/plone/plone.app.contenttypes/issues/41
+  [pbauer]
+
 
 1.14.1 (2017-06-16)
 -------------------
diff --git a/Products/Archetypes/ReferenceEngine.py b/Products/Archetypes/ReferenceEngine.py
index 36003c05..36c9e8cd 100644
--- a/Products/Archetypes/ReferenceEngine.py
+++ b/Products/Archetypes/ReferenceEngine.py
@@ -555,6 +555,8 @@ def _getUUIDFor(self, object):
     def _deleteReference(self, referenceObject):
         try:
             sobj = referenceObject.getSourceObject()
+            if sobj is None:
+                return
             referenceObject.delHook(self, sobj,
                                     referenceObject.getTargetObject())
         except ReferenceException:


Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2017-07-10T12:37:10+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.Archetypes/commit/4b4699588be90ba2aa8d8bcfb4c56a0670fe99e3

Merge pull request #93 from plone/vkarppinen/textcount

Fix bugs with old jquery version and textlimit alert

Files changed:
M CHANGES.rst
M Products/Archetypes/skins/archetypes/widgets/js/textcount.js

diff --git a/CHANGES.rst b/CHANGES.rst
index ef472c6b..8d33c44e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,13 @@ New features:
 
 Bug fixes:
 
+- Fixed textcount.js support jquery>1.6.
+  [vkarppinen]
+
+- Fixed a bug (that it was possible to enter text length over maxlimit)
+  by replacing maxlimit alert() with highlighting textcountfield.
+  [vkarppinen]
+
 - Prevent AttributeError on deleting a Reference from a object that is gone.
   Fixes https://github.com/plone/plone.app.contenttypes/issues/41
   [pbauer]
diff --git a/Products/Archetypes/skins/archetypes/widgets/js/textcount.js b/Products/Archetypes/skins/archetypes/widgets/js/textcount.js
index 48c9a85f..b09ff827 100644
--- a/Products/Archetypes/skins/archetypes/widgets/js/textcount.js
+++ b/Products/Archetypes/skins/archetypes/widgets/js/textcount.js
@@ -1,12 +1,15 @@
-<!-- Original:  Ronnie T. Moore -->
-<!-- Dynamic 'fix' by: Nannette Thacker -->
+// Original:  Ronnie T. Moore
+// Dynamic 'fix' by: Nannette Thacker
 function textCounter(field, countfield, maxlimit) {
-  var fieldval = jQuery(field).attr('value');
+  var fieldval = jQuery(field).val();
+  var counterElem = jQuery('input[name="' + countfield + '"]');
   if (fieldval.length > maxlimit) {
-      // if too long...trim it!
-      jQuery(field).attr('value',  fieldval.substring(0, maxlimit));
-      alert( 'This field is limited to ' + maxlimit + ' characters in length.' );
-  } 
-  // update 'characters left' counter	
-  jQuery('input[name="' + countfield + '"]').attr('value', Math.max(maxlimit - fieldval.length, 0));
+    // if too long...trim it!
+    jQuery(field).val(fieldval.substring(0, maxlimit));
+    counterElem.css('border-color', 'red');
+  } else {
+    counterElem.css('border-color', '#ccc');
+  }
+  // update 'characters left' counter
+  counterElem.val(Math.max(maxlimit - fieldval.length, 0));
 }


