Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-10-03T22:49:40+02:00
Author: Thomas Massmann (tmassman) <thomas.massmann@it-spir.it>
Commit: https://github.com/plone/Products.CMFPlone/commit/b5f522dcbf6711e927219f03f927c4d337bc4ecf

Applied fix for #2333 based on changes from nzambello.

5.1.x changes never made it to 5.2.

Files changed:
M Products/CMFPlone/static/patterns/toolbar/src/toolbar.js

b"diff --git a/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js b/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js\nindex fb29ec552..ea9cc466f 100644\n--- a/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js\n+++ b/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js\n@@ -32,11 +32,11 @@ define([\n       desktop_width: '768px'\n     },\n     pxToInt: function(px) {\n-      return parseInt(this.options.desktop_width.split('px')[0], 10);\n+      return parseInt(px.split('px')[0], 10);\n     },\n     setupMobile: function() {\n       var that = this;\n-      that.$container.css('right', '-' + this.options.toolbar_width);\n+      that.$container.css('right', '-' + that.options.toolbar_width);\n       // make sure we are in expanded mode\n       $('body').addClass(that.options.classNames.leftExpanded);\n       $('body').addClass(that.options.classNames.expanded);\n@@ -46,9 +46,9 @@ define([\n       $('body').removeClass(that.options.classNames.topDefault);\n       $('body').removeClass(that.options.classNames.default);\n       $('.' + that.options.classNames.logo, that.$container).off('click').on('click', function() {\n-        var $el = $(this);\n+        var $el = $(that);\n         if ($el.hasClass('open')){\n-          that.$container.css('right', '-' + this.options.toolbar_width);\n+          that.$container.css('right', '-' + that.options.toolbar_width);\n           $('html').css('margin-left', '0');\n           $('html').css('margin-right', '0');\n           $el.removeClass('open');\n@@ -56,8 +56,8 @@ define([\n         } else {\n           that.$container.css('right', '0');\n           $el.addClass('open');\n-          $('html').css('margin-left', '-' + this.options.toolbar_width);\n-          $( 'html' ).css('margin-right', this.options.toolbar_width);\n+          $('html').css('margin-left', '-' + that.options.toolbar_width);\n+          $( 'html' ).css('margin-right', that.options.toolbar_width);\n         }\n       });\n       // Remove desktop event binding\n@@ -69,14 +69,14 @@ define([\n         var $el = $(this).parent();\n         if ($el.hasClass(that.options.classNames.active)) {\n           that.$container.css('right', '0');\n-          $('html').css('margin-left', '-' + this.options.toolbar_width);\n-          $('html').css('margin-right', this.options.toolbar_width);\n+          $('html').css('margin-left', '-' + that.options.toolbar_width);\n+          $('html').css('margin-right', that.options.toolbar_width);\n           $('nav li', that.$container).removeClass(that.options.classNames.active);\n         } else {\n           $('nav li', that.$container).removeClass(that.options.classNames.active);\n           $el.addClass(that.options.classNames.active);\n-          that.$container.css('right', this.options.submenu_width);\n-          var margin = this.pxToInt(this.options.toolbar_width) + this.pxToInt(this.options.submenu_width);\n+          that.$container.css('right', that.options.submenu_width);\n+          var margin = that.pxToInt(that.options.toolbar_width) + that.pxToInt(that.options.submenu_width);\n           $('html').css('margin-left', '-' + margin + 'px' );\n           $('html').css('margin-right', + margin + 'px');\n         }\n@@ -296,7 +296,7 @@ define([\n     },\n     hideElements: function() {\n       var that = this;\n-      if (this.state.left){\n+      if (that.state.left){\n         // only when on top\n         return;\n       }\n@@ -380,7 +380,7 @@ define([\n       }else {\n         that.setupMobile();\n       }\n-      this.$el.addClass('initialized');\n+      that.$el.addClass('initialized');\n \n       /* folder contents changes the context.\n          This is for usability so the menu changes along with\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-10-03T22:49:40+02:00
Author: Thomas Massmann (tmassman) <thomas.massmann@it-spir.it>
Commit: https://github.com/plone/Products.CMFPlone/commit/f0414df352d41978107d805ff45f199448510e9b

Add changelog.

Files changed:
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 6ddbfa514..5586e7352 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -95,6 +95,10 @@ Bug fixes:\n - Remove ``plone-generate-gruntfile`` (it is all available through ``plone-compile-resources``).\n   [jensens]\n \n+- Fix toolbar menu on mobile #2333.\n+  [tmassman]\n+\n+\n New Features:\n \n - Update to latest mockup\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-10-03T22:52:54+02:00
Author: Thomas Massmann (tmassman) <thomas.massmann@it-spir.it>
Commit: https://github.com/plone/Products.CMFPlone/commit/e4d4e63ce5bbd3d13f2e7aff7cd5f0ef7b9c7adc

Fix selector to be able to close toolbar on mobile.

Files changed:
M CHANGES.rst
M Products/CMFPlone/static/patterns/toolbar/src/toolbar.js

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 5586e7352..9e08546b3 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,8 +14,10 @@ Breaking changes:\n   Third party code need either to depend on plone.app.controlpanel 4.0,\n   which is a backward compatibilit package only, or also update to not depend on it anymore.\n   [jensens]\n+\n - Removed getObjectsFromPathList.py skin script. #1801\n   [reinhardt]\n+\n - Removed setAuthCookie.py skin script. #1801\n   [tlotze]\n \n@@ -47,6 +49,9 @@ New features:\n \n Bug fixes:\n \n+- Fix toolbar menu on mobile #2333.\n+  [tmassman]\n+\n - Removed the ``raiseUnauthorized`` skin script.\n   If you use this, please do permission checking in your own Python code instead (likely in a browser view).\n   Refs `issue 1801 <https://github.com/plone/Products.CMFPlone/issues/1801>`_.\n@@ -95,9 +100,6 @@ Bug fixes:\n - Remove ``plone-generate-gruntfile`` (it is all available through ``plone-compile-resources``).\n   [jensens]\n \n-- Fix toolbar menu on mobile #2333.\n-  [tmassman]\n-\n \n New Features:\n \ndiff --git a/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js b/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js\nindex ea9cc466f..f17049678 100644\n--- a/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js\n+++ b/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js\n@@ -46,7 +46,7 @@ define([\n       $('body').removeClass(that.options.classNames.topDefault);\n       $('body').removeClass(that.options.classNames.default);\n       $('.' + that.options.classNames.logo, that.$container).off('click').on('click', function() {\n-        var $el = $(that);\n+        var $el = $(that.$el);\n         if ($el.hasClass('open')){\n           that.$container.css('right', '-' + that.options.toolbar_width);\n           $('html').css('margin-left', '0');\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-10-03T22:53:31+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/5c7148f0bc1c2a98136e44bf0f561248c4192be1

Merge pull request #2561 from plone/2333-toolbar-mobile

Add upstream fix for Plone 5.2.x for #2333

Files changed:
M CHANGES.rst
M Products/CMFPlone/static/patterns/toolbar/src/toolbar.js

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 6ddbfa514..9e08546b3 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,8 +14,10 @@ Breaking changes:\n   Third party code need either to depend on plone.app.controlpanel 4.0,\n   which is a backward compatibilit package only, or also update to not depend on it anymore.\n   [jensens]\n+\n - Removed getObjectsFromPathList.py skin script. #1801\n   [reinhardt]\n+\n - Removed setAuthCookie.py skin script. #1801\n   [tlotze]\n \n@@ -47,6 +49,9 @@ New features:\n \n Bug fixes:\n \n+- Fix toolbar menu on mobile #2333.\n+  [tmassman]\n+\n - Removed the ``raiseUnauthorized`` skin script.\n   If you use this, please do permission checking in your own Python code instead (likely in a browser view).\n   Refs `issue 1801 <https://github.com/plone/Products.CMFPlone/issues/1801>`_.\n@@ -95,6 +100,7 @@ Bug fixes:\n - Remove ``plone-generate-gruntfile`` (it is all available through ``plone-compile-resources``).\n   [jensens]\n \n+\n New Features:\n \n - Update to latest mockup\ndiff --git a/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js b/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js\nindex fb29ec552..f17049678 100644\n--- a/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js\n+++ b/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js\n@@ -32,11 +32,11 @@ define([\n       desktop_width: '768px'\n     },\n     pxToInt: function(px) {\n-      return parseInt(this.options.desktop_width.split('px')[0], 10);\n+      return parseInt(px.split('px')[0], 10);\n     },\n     setupMobile: function() {\n       var that = this;\n-      that.$container.css('right', '-' + this.options.toolbar_width);\n+      that.$container.css('right', '-' + that.options.toolbar_width);\n       // make sure we are in expanded mode\n       $('body').addClass(that.options.classNames.leftExpanded);\n       $('body').addClass(that.options.classNames.expanded);\n@@ -46,9 +46,9 @@ define([\n       $('body').removeClass(that.options.classNames.topDefault);\n       $('body').removeClass(that.options.classNames.default);\n       $('.' + that.options.classNames.logo, that.$container).off('click').on('click', function() {\n-        var $el = $(this);\n+        var $el = $(that.$el);\n         if ($el.hasClass('open')){\n-          that.$container.css('right', '-' + this.options.toolbar_width);\n+          that.$container.css('right', '-' + that.options.toolbar_width);\n           $('html').css('margin-left', '0');\n           $('html').css('margin-right', '0');\n           $el.removeClass('open');\n@@ -56,8 +56,8 @@ define([\n         } else {\n           that.$container.css('right', '0');\n           $el.addClass('open');\n-          $('html').css('margin-left', '-' + this.options.toolbar_width);\n-          $( 'html' ).css('margin-right', this.options.toolbar_width);\n+          $('html').css('margin-left', '-' + that.options.toolbar_width);\n+          $( 'html' ).css('margin-right', that.options.toolbar_width);\n         }\n       });\n       // Remove desktop event binding\n@@ -69,14 +69,14 @@ define([\n         var $el = $(this).parent();\n         if ($el.hasClass(that.options.classNames.active)) {\n           that.$container.css('right', '0');\n-          $('html').css('margin-left', '-' + this.options.toolbar_width);\n-          $('html').css('margin-right', this.options.toolbar_width);\n+          $('html').css('margin-left', '-' + that.options.toolbar_width);\n+          $('html').css('margin-right', that.options.toolbar_width);\n           $('nav li', that.$container).removeClass(that.options.classNames.active);\n         } else {\n           $('nav li', that.$container).removeClass(that.options.classNames.active);\n           $el.addClass(that.options.classNames.active);\n-          that.$container.css('right', this.options.submenu_width);\n-          var margin = this.pxToInt(this.options.toolbar_width) + this.pxToInt(this.options.submenu_width);\n+          that.$container.css('right', that.options.submenu_width);\n+          var margin = that.pxToInt(that.options.toolbar_width) + that.pxToInt(that.options.submenu_width);\n           $('html').css('margin-left', '-' + margin + 'px' );\n           $('html').css('margin-right', + margin + 'px');\n         }\n@@ -296,7 +296,7 @@ define([\n     },\n     hideElements: function() {\n       var that = this;\n-      if (this.state.left){\n+      if (that.state.left){\n         // only when on top\n         return;\n       }\n@@ -380,7 +380,7 @@ define([\n       }else {\n         that.setupMobile();\n       }\n-      this.$el.addClass('initialized');\n+      that.$el.addClass('initialized');\n \n       /* folder contents changes the context.\n          This is for usability so the menu changes along with\n"

