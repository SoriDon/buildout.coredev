Repository: plone.testing


Branch: refs/heads/master
Date: 2018-01-29T12:26:33+01:00
Author: Michael Howitz (icemac) <mh@gocept.com>
Commit: https://github.com/plone/plone.testing/commit/6b809d7921f4e8bfe90a97a11109a846456c63fc

Fix tox config.

Files changed:
M .gitignore
M tox.ini

diff --git a/.gitignore b/.gitignore
index 376d001..945a282 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,7 +1,10 @@
 *.egg-info
 *.pyc
 *.tox
+.coverage
 .installed.cfg
 bin
+coverage.xml
 develop-eggs
 eggs
+htmlcov/
diff --git a/tox.ini b/tox.ini
index 40d2065..4045a1e 100644
--- a/tox.ini
+++ b/tox.ini
@@ -1,20 +1,28 @@
 [tox]
-envlist = py27
-minversion = 1.6
+envlist = py27,
+          coverage-report
+minversion = 1.9
 
 [testenv]
-deps =
-     ZODB3
-     Zope2
-     pytest
-     pytest-cov
-     zope.app.publisher
-     zope.component
-     zope.configuration
-     zope.event
-     zope.interface
-     zope.publisher
-     zope.security
-     zope.testbrowser
-commands = py.test
 usedevelop = True
+pip_pre = True
+deps =
+     .[test]
+     zope.testrunner
+     coverage
+commands = coverage run {envbindir}/zope-testrunner --path=src --all {posargs:-vc}
+setenv =
+    COVERAGE_FILE=.coverage.{envname}
+
+[testenv:coverage-report]
+basepython = python2.7
+deps = coverage
+setenv =
+    COVERAGE_FILE=.coverage
+skip_install = true
+commands =
+    coverage erase
+    coverage combine
+    coverage html -i
+    coverage xml -i
+    coverage report -i


