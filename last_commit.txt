Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-02-26T08:32:53-06:00
Author: nathan.vangheem () <nathan.vangheem@wildcardcorp.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/122bcd9f5f1b27926eab93819aa1ce453ea80e7a

Fix browser spell checking not working with TinyMCE

Files changed:
M CHANGES.rst
M Products/CMFPlone/patterns/__init__.py
M Products/CMFPlone/resources/browser/combine.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c2e0192..d4d2ab7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -28,6 +28,9 @@ New:
 
 Fixes:
 
+- Fix browser spell checking not working with TinyMCE
+  [vangheem]
+
 - Do not fail when viewing any page, or during migration, when Diazo
   is not installed and the persistent resource directory is not
   registered.  Fixes
diff --git a/Products/CMFPlone/patterns/__init__.py b/Products/CMFPlone/patterns/__init__.py
index 5fd72c8..41440cb 100644
--- a/Products/CMFPlone/patterns/__init__.py
+++ b/Products/CMFPlone/patterns/__init__.py
@@ -108,7 +108,8 @@ def get_tiny_config(self):
             'toolbar': settings.toolbar,
             'entity_encoding': settings.entity_encoding,
             'importcss_append': True,
-            'importcss_file_filter': importcss_file_filter
+            'importcss_file_filter': importcss_file_filter,
+            'browser_spellcheck': True
         }
         toolbar_additions = settings.custom_buttons or []
 
diff --git a/Products/CMFPlone/resources/browser/combine.py b/Products/CMFPlone/resources/browser/combine.py
index d0f9540..289a98d 100644
--- a/Products/CMFPlone/resources/browser/combine.py
+++ b/Products/CMFPlone/resources/browser/combine.py
@@ -1,3 +1,4 @@
+from zExceptions import NotFound
 from Acquisition import aq_base
 from datetime import datetime
 from plone.registry.interfaces import IRegistry
@@ -19,7 +20,10 @@ def get_production_resource_directory():
     if persistent_directory is None:
         return ''
     container = persistent_directory[OVERRIDE_RESOURCE_DIRECTORY_NAME]
-    production_folder = container[PRODUCTION_RESOURCE_DIRECTORY]
+    try:
+        production_folder = container[PRODUCTION_RESOURCE_DIRECTORY]
+    except NotFound:
+        return "%s/++unique++1" % PRODUCTION_RESOURCE_DIRECTORY
     timestamp = production_folder.readFile('timestamp.txt')
     return "%s/++unique++%s" % (
         PRODUCTION_RESOURCE_DIRECTORY, timestamp)


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-02-26T12:54:46-06:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/ab4634f88fa641fca9cca2d8ff085fa5c25a434d

Merge pull request #1414 from plone/tinymce-spellchecker

Fix browser spell checking not working with TinyMCE

Files changed:
M CHANGES.rst
M Products/CMFPlone/patterns/__init__.py
M Products/CMFPlone/resources/browser/combine.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c2e0192..d4d2ab7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -28,6 +28,9 @@ New:
 
 Fixes:
 
+- Fix browser spell checking not working with TinyMCE
+  [vangheem]
+
 - Do not fail when viewing any page, or during migration, when Diazo
   is not installed and the persistent resource directory is not
   registered.  Fixes
diff --git a/Products/CMFPlone/patterns/__init__.py b/Products/CMFPlone/patterns/__init__.py
index 5fd72c8..41440cb 100644
--- a/Products/CMFPlone/patterns/__init__.py
+++ b/Products/CMFPlone/patterns/__init__.py
@@ -108,7 +108,8 @@ def get_tiny_config(self):
             'toolbar': settings.toolbar,
             'entity_encoding': settings.entity_encoding,
             'importcss_append': True,
-            'importcss_file_filter': importcss_file_filter
+            'importcss_file_filter': importcss_file_filter,
+            'browser_spellcheck': True
         }
         toolbar_additions = settings.custom_buttons or []
 
diff --git a/Products/CMFPlone/resources/browser/combine.py b/Products/CMFPlone/resources/browser/combine.py
index d0f9540..289a98d 100644
--- a/Products/CMFPlone/resources/browser/combine.py
+++ b/Products/CMFPlone/resources/browser/combine.py
@@ -1,3 +1,4 @@
+from zExceptions import NotFound
 from Acquisition import aq_base
 from datetime import datetime
 from plone.registry.interfaces import IRegistry
@@ -19,7 +20,10 @@ def get_production_resource_directory():
     if persistent_directory is None:
         return ''
     container = persistent_directory[OVERRIDE_RESOURCE_DIRECTORY_NAME]
-    production_folder = container[PRODUCTION_RESOURCE_DIRECTORY]
+    try:
+        production_folder = container[PRODUCTION_RESOURCE_DIRECTORY]
+    except NotFound:
+        return "%s/++unique++1" % PRODUCTION_RESOURCE_DIRECTORY
     timestamp = production_folder.readFile('timestamp.txt')
     return "%s/++unique++%s" % (
         PRODUCTION_RESOURCE_DIRECTORY, timestamp)


