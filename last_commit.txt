Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2022-02-22T23:07:16+01:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/a3a56b2fb3884abaa3a8c2e391d4b0a3992a90cf

Add Upgrade Step "Remove Configlets"

- remove  Controlpanel MemberPassword
- remove  Controlpanel MemberPrefs

Files changed:
A plone/app/upgrade/v60/profiles/to6004/controlpanel.xml
M plone/app/upgrade/utils.py
M plone/app/upgrade/v60/configure.zcml

b'diff --git a/plone/app/upgrade/utils.py b/plone/app/upgrade/utils.py\nindex 4e276e1b..80bf6832 100644\n--- a/plone/app/upgrade/utils.py\n+++ b/plone/app/upgrade/utils.py\n@@ -380,3 +380,21 @@ def get_property(context, property_name, default_value=None):\n         return getattr(context, property_name, default_value)\n     except AttributeError:\n         return default_value\n+\n+\n+def remove_configlets(context):\n+    portal_controlpanel = getToolByName(context, "portal_controlpanel")\n+    # Remove "Change Password" from Controlpanel\n+    _remove_configlet_by_id(portal_controlpanel, "MemberPassword")\n+    # Remove "Personal Preferences" from Controlpanel\n+    _remove_configlet_by_id(portal_controlpanel, "MemberPrefs")\n+\n+\n+def _remove_configlet_by_id(tool, action_id=None):\n+    if not action_id:\n+        return\n+    if not tool:\n+        return\n+    if action_id not in tool.keys():\n+        return\n+    del tool[action_id]\ndiff --git a/plone/app/upgrade/v60/configure.zcml b/plone/app/upgrade/v60/configure.zcml\nindex fdcec2b4..c8a7f5e5 100644\n--- a/plone/app/upgrade/v60/configure.zcml\n+++ b/plone/app/upgrade/v60/configure.zcml\n@@ -92,6 +92,12 @@\n            import_profile="plone.app.upgrade.v60:to6004"\n            />\n \n+      <gs:upgradeStep\n+          title="Remove Controlpanels"\n+          description="remove not really needed controlpanels \'Change Member Password\' and \'Member Prefs\'"\n+          handler="..utils.remove_configlets"\n+          />\n+\n     </gs:upgradeSteps>\n \n </configure>\ndiff --git a/plone/app/upgrade/v60/profiles/to6004/controlpanel.xml b/plone/app/upgrade/v60/profiles/to6004/controlpanel.xml\nnew file mode 100644\nindex 00000000..32b2bbab\n--- /dev/null\n+++ b/plone/app/upgrade/v60/profiles/to6004/controlpanel.xml\n@@ -0,0 +1,21 @@\n+<?xml version="1.0"?>\n+<object\n+    name="portal_controlpanel"\n+    meta_type="Plone Control Panel Tool"\n+    i18n:domain="plone"\n+    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+\n+    <!-- remove -->\n+  <configlet\n+      action_id="MemberPassword"\n+      appId="Plone"\n+      category="Member"\n+      remove="True" />\n+\n+  <configlet\n+      action_id="MemberPrefs"\n+      appId="Plone"\n+      category="Member"\n+      remove="True" />\n+\n+</object>\n\\ No newline at end of file\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2022-02-22T23:11:41+01:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/cf5530277fbfa2e27627be2aa8154f3aef4316bb

Add Message

Files changed:
A news/272.bugfix

b'diff --git a/news/272.bugfix b/news/272.bugfix\nnew file mode 100644\nindex 00000000..e9fd6c71\n--- /dev/null\n+++ b/news/272.bugfix\n@@ -0,0 +1,2 @@\n+Added upgrade to remove Configlets "Change Member Password" and "Member Prefs"\n+[1letter]\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2022-03-04T17:43:29+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/5285e636b47378e339fdbe87d77187bd5741c0fb

Remove Python code for the configlet removals.

Removal via xml works fine.

Files changed:
M plone/app/upgrade/utils.py
M plone/app/upgrade/v60/configure.zcml

b'diff --git a/plone/app/upgrade/utils.py b/plone/app/upgrade/utils.py\nindex 80bf6832..4e276e1b 100644\n--- a/plone/app/upgrade/utils.py\n+++ b/plone/app/upgrade/utils.py\n@@ -380,21 +380,3 @@ def get_property(context, property_name, default_value=None):\n         return getattr(context, property_name, default_value)\n     except AttributeError:\n         return default_value\n-\n-\n-def remove_configlets(context):\n-    portal_controlpanel = getToolByName(context, "portal_controlpanel")\n-    # Remove "Change Password" from Controlpanel\n-    _remove_configlet_by_id(portal_controlpanel, "MemberPassword")\n-    # Remove "Personal Preferences" from Controlpanel\n-    _remove_configlet_by_id(portal_controlpanel, "MemberPrefs")\n-\n-\n-def _remove_configlet_by_id(tool, action_id=None):\n-    if not action_id:\n-        return\n-    if not tool:\n-        return\n-    if action_id not in tool.keys():\n-        return\n-    del tool[action_id]\ndiff --git a/plone/app/upgrade/v60/configure.zcml b/plone/app/upgrade/v60/configure.zcml\nindex c8a7f5e5..7858c180 100644\n--- a/plone/app/upgrade/v60/configure.zcml\n+++ b/plone/app/upgrade/v60/configure.zcml\n@@ -82,22 +82,11 @@\n         destination="6004"\n         profile="Products.CMFPlone:plone">\n \n-      <gs:upgradeStep\n-          title="Miscellaneous upgrades to Plone 6.0.0a4"\n-          handler="..utils.null_upgrade_step"\n-          />\n-\n       <gs:upgradeDepends\n            title="Run to6004 upgrade profile."\n            import_profile="plone.app.upgrade.v60:to6004"\n            />\n \n-      <gs:upgradeStep\n-          title="Remove Controlpanels"\n-          description="remove not really needed controlpanels \'Change Member Password\' and \'Member Prefs\'"\n-          handler="..utils.remove_configlets"\n-          />\n-\n     </gs:upgradeSteps>\n \n </configure>\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2022-03-05T11:53:39+01:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/5728612960986ce5d61d87c004e2275397aafefe

Merge pull request #273 from plone/1letter/issue#3031

1letter/issue#3031

Files changed:
A news/272.bugfix
A plone/app/upgrade/v60/profiles/to6004/controlpanel.xml
M plone/app/upgrade/v60/configure.zcml

b'diff --git a/news/272.bugfix b/news/272.bugfix\nnew file mode 100644\nindex 00000000..e9fd6c71\n--- /dev/null\n+++ b/news/272.bugfix\n@@ -0,0 +1,2 @@\n+Added upgrade to remove Configlets "Change Member Password" and "Member Prefs"\n+[1letter]\ndiff --git a/plone/app/upgrade/v60/configure.zcml b/plone/app/upgrade/v60/configure.zcml\nindex fdcec2b4..7858c180 100644\n--- a/plone/app/upgrade/v60/configure.zcml\n+++ b/plone/app/upgrade/v60/configure.zcml\n@@ -82,11 +82,6 @@\n         destination="6004"\n         profile="Products.CMFPlone:plone">\n \n-      <gs:upgradeStep\n-          title="Miscellaneous upgrades to Plone 6.0.0a4"\n-          handler="..utils.null_upgrade_step"\n-          />\n-\n       <gs:upgradeDepends\n            title="Run to6004 upgrade profile."\n            import_profile="plone.app.upgrade.v60:to6004"\ndiff --git a/plone/app/upgrade/v60/profiles/to6004/controlpanel.xml b/plone/app/upgrade/v60/profiles/to6004/controlpanel.xml\nnew file mode 100644\nindex 00000000..32b2bbab\n--- /dev/null\n+++ b/plone/app/upgrade/v60/profiles/to6004/controlpanel.xml\n@@ -0,0 +1,21 @@\n+<?xml version="1.0"?>\n+<object\n+    name="portal_controlpanel"\n+    meta_type="Plone Control Panel Tool"\n+    i18n:domain="plone"\n+    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+\n+    <!-- remove -->\n+  <configlet\n+      action_id="MemberPassword"\n+      appId="Plone"\n+      category="Member"\n+      remove="True" />\n+\n+  <configlet\n+      action_id="MemberPrefs"\n+      appId="Plone"\n+      category="Member"\n+      remove="True" />\n+\n+</object>\n\\ No newline at end of file\n'

