Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-20T18:59:40+01:00
Author: Steffen Allner (sallner) <sa@gocept.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/c1ac921487f6a596fdaa75df9e1afc19ce2d17ca

Resolve circular dependency between Products.CMFPlone and plone.i18n.

Files changed:
A news/2049.bugfix
M Products/CMFPlone/interfaces/__init__.py
M Products/CMFPlone/interfaces/controlpanel.py
M setup.py

b'diff --git a/Products/CMFPlone/interfaces/__init__.py b/Products/CMFPlone/interfaces/__init__.py\nindex fa0f0b58e..ed7c6417d 100644\n--- a/Products/CMFPlone/interfaces/__init__.py\n+++ b/Products/CMFPlone/interfaces/__init__.py\n@@ -12,7 +12,6 @@\n from Products.CMFPlone.interfaces.controlpanel import IEditingSchema\n from Products.CMFPlone.interfaces.controlpanel import IFilterSchema\n from Products.CMFPlone.interfaces.controlpanel import IImagingSchema\n-from Products.CMFPlone.interfaces.controlpanel import ILanguageSchema\n from Products.CMFPlone.interfaces.controlpanel import ILinkSchema\n from Products.CMFPlone.interfaces.controlpanel import ILoginSchema\n from Products.CMFPlone.interfaces.controlpanel import IMailSchema\n@@ -61,3 +60,11 @@\n from Products.CMFPlone.interfaces.syndication import ISiteSyndicationSettings\n from Products.CMFPlone.interfaces.translationservice import ITranslationServiceTool\n from Products.CMFPlone.interfaces.workflow import IWorkflowChain\n+\n+from zope.deferredimport import deprecated\n+\n+\n+deprecated(\n+    "It has been moved to plone.i18n.interfaces, import from there instead.",\n+    ILanguageSchema=\'plone.i18n.interfaces:ILanguageSchema\',\n+)\ndiff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py\nindex e23ce4a46..c64b89fe1 100644\n--- a/Products/CMFPlone/interfaces/controlpanel.py\n+++ b/Products/CMFPlone/interfaces/controlpanel.py\n@@ -1,5 +1,4 @@\n # -*- coding: utf-8 -*-\n-from plone.supermodel import model\n from Products.CMFPlone import PloneMessageFactory as _\n from Products.CMFPlone._compat import dump_json_to_text\n from Products.CMFPlone.interfaces.basetool import IPloneBaseTool\n@@ -155,180 +154,6 @@ class IEditingSchema(Interface):\n         required=False)\n \n \n-class ILanguageSchema(Interface):\n-    model.fieldset(\n-        \'general\',\n-        label=_(u\'General\'),\n-        fields=[\n-            \'default_language\',\n-            \'available_languages\',\n-            \'use_combined_language_codes\',\n-            \'display_flags\',\n-            \'always_show_selector\'\n-        ],\n-    )\n-\n-    default_language = schema.Choice(\n-        title=_(u\'heading_site_language\', default=u\'Site language\'),\n-        description=_(\n-            u\'description_site_language\',\n-            default=u\'The language used for the content and the UI of \'\n-                    u\'this site.\'\n-        ),\n-        default=\'en\',\n-        required=True,\n-        vocabulary=\'plone.app.vocabularies.AvailableContentLanguages\'\n-    )\n-\n-    available_languages = schema.List(\n-        title=_(u\'heading_available_languages\',\n-                default=u\'Available languages\'),\n-        description=_(u\'description_available_languages\',\n-                      default=u\'The languages in which the site should be \'\n-                              u\'translatable.\'),\n-        required=True,\n-        default=[\'en\'],\n-        missing_value=[],\n-        value_type=schema.Choice(\n-            vocabulary=\'plone.app.vocabularies.AvailableContentLanguages\'\n-        )\n-    )\n-\n-    use_combined_language_codes = schema.Bool(\n-        title=_(\n-            u\'label_allow_combined_language_codes\',\n-            default=u\'Show country-specific language variants\'\n-        ),\n-        description=_(\n-            u\'help_allow_combined_language_codes\',\n-            default=u\'Examples: pt-br (Brazilian Portuguese), \'\n-                    u\'en-us (American English) etc.\'\n-        ),\n-        default=True,\n-        required=False\n-    )\n-\n-    display_flags = schema.Bool(\n-        title=_(\n-            u\'label_display_flags\',\n-            default=u\'Show language flags\'\n-        ),\n-        description=u\'\',\n-        default=False,\n-        required=False\n-    )\n-\n-    always_show_selector = schema.Bool(\n-        title=_(\n-            u\'label_always_show_selector\',\n-            default=u\'Always show language selector\'\n-        ),\n-        description=u\'\',\n-        default=False,\n-        required=False\n-    )\n-\n-    model.fieldset(\n-        \'negotiation_scheme\',\n-        label=_(u\'Negotiation scheme\', default=u\'Negotiation scheme\'),\n-        fields=[\n-            \'use_content_negotiation\',\n-            \'use_path_negotiation\',\n-            \'use_cookie_negotiation\',\n-            \'authenticated_users_only\',\n-            \'set_cookie_always\',\n-            \'use_subdomain_negotiation\',\n-            \'use_cctld_negotiation\',\n-            \'use_request_negotiation\',\n-        ],\n-    )\n-    use_content_negotiation = schema.Bool(\n-        title=_(u\'heading_language_of_the_content\',\n-                default=u\'Use the language of the content item\'),\n-        description=_(u\'description_language_of_the_content\',\n-                      default=u\'Use the language of the content item.\'),\n-        default=False,\n-        required=False,\n-    )\n-\n-    use_path_negotiation = schema.Bool(\n-        title=_(\n-            u\'heading_language_codes_in_URL\',\n-            default=u\'Use language codes in URL path for manual override\'),\n-        description=_(\n-            u\'description_language_codes_in_URL\',\n-            default=u\'Use language codes in URL path for manual override.\'),\n-        default=False,\n-        required=False,\n-    )\n-\n-    use_cookie_negotiation = schema.Bool(\n-        title=_(u\'heading_cookie_manual_override\',\n-                default=(u\'Use cookie for manual override\')),\n-        description=_(\n-            u\'description_cookie_manual_override\',\n-            default=(\n-                u\'Required for the language selector viewlet to be rendered.\'\n-            )\n-        ),\n-        default=False,\n-        required=False,\n-    )\n-\n-    authenticated_users_only = schema.Bool(\n-        title=_(u\'heading_auth_cookie_manual_override\',\n-                default=u\'Authenticated users only\'),\n-        description=_(\n-            u\'description_auth_ookie_manual_override\',\n-            default=(u\'Related to: use cookie for manual override\')\n-        ),\n-        default=False,\n-        required=False,\n-    )\n-\n-    set_cookie_always = schema.Bool(\n-        title=_(\n-            u\'heading_set_language_cookie_always\',\n-            default=(u\'Set the language cookie always\')),\n-        description=_(\n-            u\'description_set_language_cookie_always\',\n-            default=(\n-                u\'i.e. also when the \\\'set_language\\\' request parameter is \'\n-                u\'absent\'\n-            )\n-        ),\n-        default=False,\n-        required=False,\n-    )\n-\n-    use_subdomain_negotiation = schema.Bool(\n-        title=_(u\'heading_use_subdomain\',\n-                default=u\'Use subdomain\'),\n-        description=_(u\'description_use_subdomain\',\n-                      default=u\'e.g.: de.plone.org\'),\n-        default=False,\n-        required=False,\n-    )\n-\n-    use_cctld_negotiation = schema.Bool(\n-        title=_(u\'heading_top_level_domain\',\n-                default=u\'Use top-level domain\'),\n-        description=_(u\'description_top_level_domain\',\n-                      default=u\'e.g.: www.plone.de\'),\n-        default=False,\n-        required=False,\n-    )\n-\n-    use_request_negotiation = schema.Bool(\n-        title=_(u\'heading_browser_language_request_negotiation\',\n-                default=u\'Use browser language request negotiation\'),\n-        description=_(u\'description_browser_language_request_negotiation\',\n-                      default=u\'Use browser language request negotiation.\'),\n-        default=False,\n-        required=False,\n-    )\n-\n-\n class ITagAttrPair(Interface):\n     tags = schema.TextLine(title=u\'tags\')\n     attributes = schema.TextLine(title=u\'attributes\')\ndiff --git a/news/2049.bugfix b/news/2049.bugfix\nnew file mode 100644\nindex 000000000..79b57410f\n--- /dev/null\n+++ b/news/2049.bugfix\n@@ -0,0 +1,3 @@\n+Resolve circular dependency between `Products.CMFPlone` and `plone.i18n` by\n+moving `ILanguageSchema` there.\n+[sallner]\ndiff --git a/setup.py b/setup.py\nindex 2a2288cca..853563f16 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -72,7 +72,7 @@\n         \'plone.browserlayer >= 1.0rc4\',\n         \'plone.contentrules\',\n         \'plone.folder\',\n-        \'plone.i18n\',\n+        \'plone.i18n >= 4.0.4.dev0\',\n         \'plone.indexer\',\n         \'plone.intelligenttext\',\n         \'plone.locking\',\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-20T19:02:40+01:00
Author: Steffen Allner (sallner) <sa@gocept.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/6885dab747c590e0963f02eb2d00df397f232cea

Import interface from new location.

Files changed:
M Products/CMFPlone/controlpanel/README.rst
M Products/CMFPlone/controlpanel/bbb/language.py
M Products/CMFPlone/controlpanel/browser/language.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_language.py
M Products/CMFPlone/tests/AddMoveAndDeleteDocument.txt

b"diff --git a/Products/CMFPlone/controlpanel/README.rst b/Products/CMFPlone/controlpanel/README.rst\nindex d00fd7da4..428d89614 100644\n--- a/Products/CMFPlone/controlpanel/README.rst\n+++ b/Products/CMFPlone/controlpanel/README.rst\n@@ -57,7 +57,7 @@ Editing Control Panel\n Language Control Panel\n ----------------------\n \n-  >>> from Products.CMFPlone.interfaces import ILanguageSchema\n+  >>> from plone.i18n.interfaces import ILanguageSchema\n   >>> language_settings = registry.forInterface(ILanguageSchema, prefix='plone')\n \n   >>> language_settings.default_language\ndiff --git a/Products/CMFPlone/controlpanel/bbb/language.py b/Products/CMFPlone/controlpanel/bbb/language.py\nindex 8c055908c..08e40adc3 100644\n--- a/Products/CMFPlone/controlpanel/bbb/language.py\n+++ b/Products/CMFPlone/controlpanel/bbb/language.py\n@@ -1,8 +1,8 @@\n # -*- coding: utf-8 -*-\n from zope.component import adapts\n-from Products.CMFPlone.interfaces import ILanguageSchema\n from zope.interface import implementer\n from zope.component import getUtility\n+from plone.i18n.interfaces import ILanguageSchema\n from Products.CMFPlone.interfaces import IPloneSiteRoot\n \n from plone.registry.interfaces import IRegistry\ndiff --git a/Products/CMFPlone/controlpanel/browser/language.py b/Products/CMFPlone/controlpanel/browser/language.py\nindex f0ede2134..644acbc97 100644\n--- a/Products/CMFPlone/controlpanel/browser/language.py\n+++ b/Products/CMFPlone/controlpanel/browser/language.py\n@@ -2,7 +2,7 @@\n from Products.CMFPlone import PloneMessageFactory as _\n from plone.app.registry.browser import controlpanel\n \n-from Products.CMFPlone.interfaces import ILanguageSchema\n+from plone.i18n.interfaces import ILanguageSchema\n from Products.statusmessages.interfaces import IStatusMessage\n from z3c.form import button\n \ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py\nindex dba3de5e3..bfb2af1cb 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py\n@@ -1,9 +1,9 @@\n # -*- coding: utf-8 -*-\n-from Products.CMFPlone.interfaces import ILanguageSchema\n from Products.CMFPlone.testing import \\\n     PRODUCTS_CMFPLONE_INTEGRATION_TESTING\n \n from plone.app.testing import TEST_USER_ID, setRoles\n+from plone.i18n.interfaces import ILanguageSchema\n from plone.registry.interfaces import IRegistry\n from zope.component import getUtility\n from zope.component import getAdapter\ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py\nindex 586b24833..685598297 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py\n@@ -1,12 +1,12 @@\n # -*- coding: utf-8 -*-\n from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n+from plone.i18n.interfaces import ILanguageSchema\n from plone.registry.interfaces import IRegistry\n from plone.testing.zope import Browser\n \n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n-from Products.CMFPlone.interfaces import ILanguageSchema\n from Products.CMFPlone.testing import \\\n     PRODUCTS_CMFPLONE_FUNCTIONAL_TESTING\n \ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_language.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_language.py\nindex ae94be930..96b0c865a 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_language.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_language.py\n@@ -1,10 +1,10 @@\n # -*- coding: utf-8 -*-\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n+from plone.i18n.interfaces import ILanguageSchema\n from plone.registry.interfaces import IRegistry\n \n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import ILanguageSchema\n from Products.CMFPlone.testing import \\\n     PRODUCTS_CMFPLONE_INTEGRATION_TESTING\n \ndiff --git a/Products/CMFPlone/tests/AddMoveAndDeleteDocument.txt b/Products/CMFPlone/tests/AddMoveAndDeleteDocument.txt\nindex bf0d378c5..d05582da7 100644\n--- a/Products/CMFPlone/tests/AddMoveAndDeleteDocument.txt\n+++ b/Products/CMFPlone/tests/AddMoveAndDeleteDocument.txt\n@@ -21,7 +21,7 @@ We need to allow multiple languages to see the result of our changes:\n \n     >>> from plone.registry.interfaces import IRegistry\n     >>> from zope.component import getUtility\n-    >>> from Products.CMFPlone.interfaces import ILanguageSchema\n+    >>> from plone.i18n.interfaces import ILanguageSchema\n     >>> settings = getUtility(IRegistry).forInterface(\n     ...     ILanguageSchema,\n     ...     prefix='plone')\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-21T14:16:06+01:00
Author: Steffen Allner (sallner) <sa@gocept.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/25b016b09abd4f4e3be96b6e857b8501382512cb

Update record reference and add more deprecated import.

Files changed:
M Products/CMFPlone/interfaces/controlpanel.py
M Products/CMFPlone/profiles/dependencies/registry.xml

b'diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py\nindex c64b89fe1..d80f00020 100644\n--- a/Products/CMFPlone/interfaces/controlpanel.py\n+++ b/Products/CMFPlone/interfaces/controlpanel.py\n@@ -3,6 +3,7 @@\n from Products.CMFPlone._compat import dump_json_to_text\n from Products.CMFPlone.interfaces.basetool import IPloneBaseTool\n from zope import schema\n+from zope.deferredimport import deprecated\n from zope.interface import Attribute\n from zope.interface import implementer\n from zope.interface import Interface\n@@ -14,6 +15,12 @@\n import six\n \n \n+deprecated(\n+    "It has been moved to plone.i18n.interfaces, import from there instead.",\n+    ILanguageSchema=\'plone.i18n.interfaces:ILanguageSchema\',\n+)\n+\n+\n ROBOTS_TXT = u"""Sitemap: {portal_url}/sitemap.xml.gz\n \n # Define access-restrictions for robots/spiders\ndiff --git a/Products/CMFPlone/profiles/dependencies/registry.xml b/Products/CMFPlone/profiles/dependencies/registry.xml\nindex 22580afb4..b03d08133 100644\n--- a/Products/CMFPlone/profiles/dependencies/registry.xml\n+++ b/Products/CMFPlone/profiles/dependencies/registry.xml\n@@ -2,7 +2,7 @@\n <registry>\n   <records interface="Products.CMFPlone.interfaces.IEditingSchema"\n            prefix="plone" />\n-  <records interface="Products.CMFPlone.interfaces.ILanguageSchema"\n+  <records interface="plone.i18n.interfaces.ILanguageSchema"\n            prefix="plone" />\n   <records interface="Products.CMFPlone.interfaces.IFilterSchema"\n            prefix="plone" />\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-22T10:16:29+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/c90f5c23f05be1aa15e07d00ff30fb6f9580f882

Merge pull request #2769 from plone/2049-circular-dep-plone.i18n

Resolve circular dependency between Products.CMFPlone and plone.i18n.

Files changed:
A news/2049.bugfix
M Products/CMFPlone/controlpanel/README.rst
M Products/CMFPlone/controlpanel/bbb/language.py
M Products/CMFPlone/controlpanel/browser/language.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_language.py
M Products/CMFPlone/interfaces/__init__.py
M Products/CMFPlone/interfaces/controlpanel.py
M Products/CMFPlone/profiles/dependencies/registry.xml
M Products/CMFPlone/tests/AddMoveAndDeleteDocument.txt
M setup.py

b'diff --git a/Products/CMFPlone/controlpanel/README.rst b/Products/CMFPlone/controlpanel/README.rst\nindex d00fd7da4..428d89614 100644\n--- a/Products/CMFPlone/controlpanel/README.rst\n+++ b/Products/CMFPlone/controlpanel/README.rst\n@@ -57,7 +57,7 @@ Editing Control Panel\n Language Control Panel\n ----------------------\n \n-  >>> from Products.CMFPlone.interfaces import ILanguageSchema\n+  >>> from plone.i18n.interfaces import ILanguageSchema\n   >>> language_settings = registry.forInterface(ILanguageSchema, prefix=\'plone\')\n \n   >>> language_settings.default_language\ndiff --git a/Products/CMFPlone/controlpanel/bbb/language.py b/Products/CMFPlone/controlpanel/bbb/language.py\nindex 8c055908c..08e40adc3 100644\n--- a/Products/CMFPlone/controlpanel/bbb/language.py\n+++ b/Products/CMFPlone/controlpanel/bbb/language.py\n@@ -1,8 +1,8 @@\n # -*- coding: utf-8 -*-\n from zope.component import adapts\n-from Products.CMFPlone.interfaces import ILanguageSchema\n from zope.interface import implementer\n from zope.component import getUtility\n+from plone.i18n.interfaces import ILanguageSchema\n from Products.CMFPlone.interfaces import IPloneSiteRoot\n \n from plone.registry.interfaces import IRegistry\ndiff --git a/Products/CMFPlone/controlpanel/browser/language.py b/Products/CMFPlone/controlpanel/browser/language.py\nindex f0ede2134..644acbc97 100644\n--- a/Products/CMFPlone/controlpanel/browser/language.py\n+++ b/Products/CMFPlone/controlpanel/browser/language.py\n@@ -2,7 +2,7 @@\n from Products.CMFPlone import PloneMessageFactory as _\n from plone.app.registry.browser import controlpanel\n \n-from Products.CMFPlone.interfaces import ILanguageSchema\n+from plone.i18n.interfaces import ILanguageSchema\n from Products.statusmessages.interfaces import IStatusMessage\n from z3c.form import button\n \ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py\nindex dba3de5e3..bfb2af1cb 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py\n@@ -1,9 +1,9 @@\n # -*- coding: utf-8 -*-\n-from Products.CMFPlone.interfaces import ILanguageSchema\n from Products.CMFPlone.testing import \\\n     PRODUCTS_CMFPLONE_INTEGRATION_TESTING\n \n from plone.app.testing import TEST_USER_ID, setRoles\n+from plone.i18n.interfaces import ILanguageSchema\n from plone.registry.interfaces import IRegistry\n from zope.component import getUtility\n from zope.component import getAdapter\ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py\nindex 586b24833..685598297 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py\n@@ -1,12 +1,12 @@\n # -*- coding: utf-8 -*-\n from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n+from plone.i18n.interfaces import ILanguageSchema\n from plone.registry.interfaces import IRegistry\n from plone.testing.zope import Browser\n \n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \n-from Products.CMFPlone.interfaces import ILanguageSchema\n from Products.CMFPlone.testing import \\\n     PRODUCTS_CMFPLONE_FUNCTIONAL_TESTING\n \ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_language.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_language.py\nindex ae94be930..96b0c865a 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_language.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_language.py\n@@ -1,10 +1,10 @@\n # -*- coding: utf-8 -*-\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n+from plone.i18n.interfaces import ILanguageSchema\n from plone.registry.interfaces import IRegistry\n \n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import ILanguageSchema\n from Products.CMFPlone.testing import \\\n     PRODUCTS_CMFPLONE_INTEGRATION_TESTING\n \ndiff --git a/Products/CMFPlone/interfaces/__init__.py b/Products/CMFPlone/interfaces/__init__.py\nindex fa0f0b58e..ed7c6417d 100644\n--- a/Products/CMFPlone/interfaces/__init__.py\n+++ b/Products/CMFPlone/interfaces/__init__.py\n@@ -12,7 +12,6 @@\n from Products.CMFPlone.interfaces.controlpanel import IEditingSchema\n from Products.CMFPlone.interfaces.controlpanel import IFilterSchema\n from Products.CMFPlone.interfaces.controlpanel import IImagingSchema\n-from Products.CMFPlone.interfaces.controlpanel import ILanguageSchema\n from Products.CMFPlone.interfaces.controlpanel import ILinkSchema\n from Products.CMFPlone.interfaces.controlpanel import ILoginSchema\n from Products.CMFPlone.interfaces.controlpanel import IMailSchema\n@@ -61,3 +60,11 @@\n from Products.CMFPlone.interfaces.syndication import ISiteSyndicationSettings\n from Products.CMFPlone.interfaces.translationservice import ITranslationServiceTool\n from Products.CMFPlone.interfaces.workflow import IWorkflowChain\n+\n+from zope.deferredimport import deprecated\n+\n+\n+deprecated(\n+    "It has been moved to plone.i18n.interfaces, import from there instead.",\n+    ILanguageSchema=\'plone.i18n.interfaces:ILanguageSchema\',\n+)\ndiff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py\nindex e23ce4a46..d80f00020 100644\n--- a/Products/CMFPlone/interfaces/controlpanel.py\n+++ b/Products/CMFPlone/interfaces/controlpanel.py\n@@ -1,9 +1,9 @@\n # -*- coding: utf-8 -*-\n-from plone.supermodel import model\n from Products.CMFPlone import PloneMessageFactory as _\n from Products.CMFPlone._compat import dump_json_to_text\n from Products.CMFPlone.interfaces.basetool import IPloneBaseTool\n from zope import schema\n+from zope.deferredimport import deprecated\n from zope.interface import Attribute\n from zope.interface import implementer\n from zope.interface import Interface\n@@ -15,6 +15,12 @@\n import six\n \n \n+deprecated(\n+    "It has been moved to plone.i18n.interfaces, import from there instead.",\n+    ILanguageSchema=\'plone.i18n.interfaces:ILanguageSchema\',\n+)\n+\n+\n ROBOTS_TXT = u"""Sitemap: {portal_url}/sitemap.xml.gz\n \n # Define access-restrictions for robots/spiders\n@@ -155,180 +161,6 @@ class IEditingSchema(Interface):\n         required=False)\n \n \n-class ILanguageSchema(Interface):\n-    model.fieldset(\n-        \'general\',\n-        label=_(u\'General\'),\n-        fields=[\n-            \'default_language\',\n-            \'available_languages\',\n-            \'use_combined_language_codes\',\n-            \'display_flags\',\n-            \'always_show_selector\'\n-        ],\n-    )\n-\n-    default_language = schema.Choice(\n-        title=_(u\'heading_site_language\', default=u\'Site language\'),\n-        description=_(\n-            u\'description_site_language\',\n-            default=u\'The language used for the content and the UI of \'\n-                    u\'this site.\'\n-        ),\n-        default=\'en\',\n-        required=True,\n-        vocabulary=\'plone.app.vocabularies.AvailableContentLanguages\'\n-    )\n-\n-    available_languages = schema.List(\n-        title=_(u\'heading_available_languages\',\n-                default=u\'Available languages\'),\n-        description=_(u\'description_available_languages\',\n-                      default=u\'The languages in which the site should be \'\n-                              u\'translatable.\'),\n-        required=True,\n-        default=[\'en\'],\n-        missing_value=[],\n-        value_type=schema.Choice(\n-            vocabulary=\'plone.app.vocabularies.AvailableContentLanguages\'\n-        )\n-    )\n-\n-    use_combined_language_codes = schema.Bool(\n-        title=_(\n-            u\'label_allow_combined_language_codes\',\n-            default=u\'Show country-specific language variants\'\n-        ),\n-        description=_(\n-            u\'help_allow_combined_language_codes\',\n-            default=u\'Examples: pt-br (Brazilian Portuguese), \'\n-                    u\'en-us (American English) etc.\'\n-        ),\n-        default=True,\n-        required=False\n-    )\n-\n-    display_flags = schema.Bool(\n-        title=_(\n-            u\'label_display_flags\',\n-            default=u\'Show language flags\'\n-        ),\n-        description=u\'\',\n-        default=False,\n-        required=False\n-    )\n-\n-    always_show_selector = schema.Bool(\n-        title=_(\n-            u\'label_always_show_selector\',\n-            default=u\'Always show language selector\'\n-        ),\n-        description=u\'\',\n-        default=False,\n-        required=False\n-    )\n-\n-    model.fieldset(\n-        \'negotiation_scheme\',\n-        label=_(u\'Negotiation scheme\', default=u\'Negotiation scheme\'),\n-        fields=[\n-            \'use_content_negotiation\',\n-            \'use_path_negotiation\',\n-            \'use_cookie_negotiation\',\n-            \'authenticated_users_only\',\n-            \'set_cookie_always\',\n-            \'use_subdomain_negotiation\',\n-            \'use_cctld_negotiation\',\n-            \'use_request_negotiation\',\n-        ],\n-    )\n-    use_content_negotiation = schema.Bool(\n-        title=_(u\'heading_language_of_the_content\',\n-                default=u\'Use the language of the content item\'),\n-        description=_(u\'description_language_of_the_content\',\n-                      default=u\'Use the language of the content item.\'),\n-        default=False,\n-        required=False,\n-    )\n-\n-    use_path_negotiation = schema.Bool(\n-        title=_(\n-            u\'heading_language_codes_in_URL\',\n-            default=u\'Use language codes in URL path for manual override\'),\n-        description=_(\n-            u\'description_language_codes_in_URL\',\n-            default=u\'Use language codes in URL path for manual override.\'),\n-        default=False,\n-        required=False,\n-    )\n-\n-    use_cookie_negotiation = schema.Bool(\n-        title=_(u\'heading_cookie_manual_override\',\n-                default=(u\'Use cookie for manual override\')),\n-        description=_(\n-            u\'description_cookie_manual_override\',\n-            default=(\n-                u\'Required for the language selector viewlet to be rendered.\'\n-            )\n-        ),\n-        default=False,\n-        required=False,\n-    )\n-\n-    authenticated_users_only = schema.Bool(\n-        title=_(u\'heading_auth_cookie_manual_override\',\n-                default=u\'Authenticated users only\'),\n-        description=_(\n-            u\'description_auth_ookie_manual_override\',\n-            default=(u\'Related to: use cookie for manual override\')\n-        ),\n-        default=False,\n-        required=False,\n-    )\n-\n-    set_cookie_always = schema.Bool(\n-        title=_(\n-            u\'heading_set_language_cookie_always\',\n-            default=(u\'Set the language cookie always\')),\n-        description=_(\n-            u\'description_set_language_cookie_always\',\n-            default=(\n-                u\'i.e. also when the \\\'set_language\\\' request parameter is \'\n-                u\'absent\'\n-            )\n-        ),\n-        default=False,\n-        required=False,\n-    )\n-\n-    use_subdomain_negotiation = schema.Bool(\n-        title=_(u\'heading_use_subdomain\',\n-                default=u\'Use subdomain\'),\n-        description=_(u\'description_use_subdomain\',\n-                      default=u\'e.g.: de.plone.org\'),\n-        default=False,\n-        required=False,\n-    )\n-\n-    use_cctld_negotiation = schema.Bool(\n-        title=_(u\'heading_top_level_domain\',\n-                default=u\'Use top-level domain\'),\n-        description=_(u\'description_top_level_domain\',\n-                      default=u\'e.g.: www.plone.de\'),\n-        default=False,\n-        required=False,\n-    )\n-\n-    use_request_negotiation = schema.Bool(\n-        title=_(u\'heading_browser_language_request_negotiation\',\n-                default=u\'Use browser language request negotiation\'),\n-        description=_(u\'description_browser_language_request_negotiation\',\n-                      default=u\'Use browser language request negotiation.\'),\n-        default=False,\n-        required=False,\n-    )\n-\n-\n class ITagAttrPair(Interface):\n     tags = schema.TextLine(title=u\'tags\')\n     attributes = schema.TextLine(title=u\'attributes\')\ndiff --git a/Products/CMFPlone/profiles/dependencies/registry.xml b/Products/CMFPlone/profiles/dependencies/registry.xml\nindex 22580afb4..b03d08133 100644\n--- a/Products/CMFPlone/profiles/dependencies/registry.xml\n+++ b/Products/CMFPlone/profiles/dependencies/registry.xml\n@@ -2,7 +2,7 @@\n <registry>\n   <records interface="Products.CMFPlone.interfaces.IEditingSchema"\n            prefix="plone" />\n-  <records interface="Products.CMFPlone.interfaces.ILanguageSchema"\n+  <records interface="plone.i18n.interfaces.ILanguageSchema"\n            prefix="plone" />\n   <records interface="Products.CMFPlone.interfaces.IFilterSchema"\n            prefix="plone" />\ndiff --git a/Products/CMFPlone/tests/AddMoveAndDeleteDocument.txt b/Products/CMFPlone/tests/AddMoveAndDeleteDocument.txt\nindex bf0d378c5..d05582da7 100644\n--- a/Products/CMFPlone/tests/AddMoveAndDeleteDocument.txt\n+++ b/Products/CMFPlone/tests/AddMoveAndDeleteDocument.txt\n@@ -21,7 +21,7 @@ We need to allow multiple languages to see the result of our changes:\n \n     >>> from plone.registry.interfaces import IRegistry\n     >>> from zope.component import getUtility\n-    >>> from Products.CMFPlone.interfaces import ILanguageSchema\n+    >>> from plone.i18n.interfaces import ILanguageSchema\n     >>> settings = getUtility(IRegistry).forInterface(\n     ...     ILanguageSchema,\n     ...     prefix=\'plone\')\ndiff --git a/news/2049.bugfix b/news/2049.bugfix\nnew file mode 100644\nindex 000000000..79b57410f\n--- /dev/null\n+++ b/news/2049.bugfix\n@@ -0,0 +1,3 @@\n+Resolve circular dependency between `Products.CMFPlone` and `plone.i18n` by\n+moving `ILanguageSchema` there.\n+[sallner]\ndiff --git a/setup.py b/setup.py\nindex 2a2288cca..853563f16 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -72,7 +72,7 @@\n         \'plone.browserlayer >= 1.0rc4\',\n         \'plone.contentrules\',\n         \'plone.folder\',\n-        \'plone.i18n\',\n+        \'plone.i18n >= 4.0.4.dev0\',\n         \'plone.indexer\',\n         \'plone.intelligenttext\',\n         \'plone.locking\',\n'

