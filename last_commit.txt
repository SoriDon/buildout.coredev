Repository: plone.app.event


Branch: refs/heads/master
Date: 2022-04-04T12:41:32+02:00
Author: Philipp Auersperg-Castell (zworkb) <phil@bluedynamics.com>
Commit: https://github.com/plone/plone.app.event/commit/8a7757083d4436f88004be68943f6b5418526fd9

PLIP 2780: disable searchable_text_indexer (is now covered by p.a.d.textindexer)

Files changed:
M plone/app/event/dx/behaviors.py
M plone/app/event/dx/configure.zcml
M plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml

b'diff --git a/plone/app/event/dx/behaviors.py b/plone/app/event/dx/behaviors.py\nindex 1fb32f22..f414f080 100644\n--- a/plone/app/event/dx/behaviors.py\n+++ b/plone/app/event/dx/behaviors.py\n@@ -27,7 +27,6 @@\n from plone.indexer import indexer\n from plone.supermodel import model\n from plone.uuid.interfaces import IUUID\n-from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.utils import safe_unicode\n from z3c.form.browser.checkbox import SingleCheckBoxFieldWidget\n from z3c.form.browser.text import TextFieldWidget\n@@ -42,8 +41,6 @@\n from zope.interface import provider\n from zope.schema.interfaces import IContextAwareDefaultFactory\n \n-import six\n-\n \n def first_weekday_sun0():\n     return wkday_to_mon1(first_weekday())\n@@ -375,30 +372,6 @@ def sync_uid_indexer(obj):\n     return sync_uid\n \n \n-# Body text indexing\n-@indexer(IDXEvent)\n-def searchable_text_indexer(obj):\n-    acc = IEventAccessor(obj)\n-    text = u\'\'\n-    text += u\'%s\\n\' % acc.title\n-    text += u\'%s\\n\' % acc.description\n-    textvalue = acc.text\n-    if textvalue is None:\n-        raise AttributeError\n-    transforms = getToolByName(obj, \'portal_transforms\')\n-    if six.PY2:\n-        textvalue = textvalue.encode(\'utf8\', \'replace\')\n-    body_plain = transforms.convertTo(\n-        \'text/plain\',\n-        textvalue,\n-        mimetype=\'text/html\',\n-    ).getData().strip()\n-    text += safe_unicode(body_plain)\n-    if six.PY2:\n-        text = text.strip().encode(\'utf-8\')\n-    return text\n-\n-\n # Object adapters\n \n @adapter(IDXEvent)\ndiff --git a/plone/app/event/dx/configure.zcml b/plone/app/event/dx/configure.zcml\nindex ee4727da..4ab51471 100644\n--- a/plone/app/event/dx/configure.zcml\n+++ b/plone/app/event/dx/configure.zcml\n@@ -23,7 +23,6 @@\n     <adapter name="start" factory=".behaviors.start_indexer" />\n     <adapter name="end" factory=".behaviors.end_indexer" />\n     <adapter name="location" factory=".behaviors.location_indexer" />\n-    <adapter name="SearchableText" factory=".behaviors.searchable_text_indexer" />\n     <adapter name="sync_uid" factory=".behaviors.sync_uid_indexer" />\n \n     <plone:behavior\ndiff --git a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\nindex 5cf35cbd..94515566 100644\n--- a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n+++ b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n@@ -38,6 +38,7 @@\n     <element value="plone.namefromtitle"/>\n     <element value="plone.allowdiscussion"/>\n     <element value="plone.excludefromnavigation"/>\n+    <element value="plone.textindexer"/>\n   </property>\n \n   <!-- View and aliases -->\n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2022-04-04T12:46:56+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.event/commit/1acb5cd03c6d52d9066363f0b43d5212a1898faa

add newsfile

Files changed:
A news/2780.feature

b'diff --git a/news/2780.feature b/news/2780.feature\nnew file mode 100644\nindex 00000000..17ae13b6\n--- /dev/null\n+++ b/news/2780.feature\n@@ -0,0 +1,2 @@\n+PLIP 2780: textindexer, use here.\n+[zworkb]\n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2022-04-07T11:07:47+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.event/commit/bb77ab824cfc60854f267530200fd5a4581af52b

Merge pull request #354 from plone/plip-2780

Disable searchable_text_indexer (is now covered by p.a.d.textindexer)

Files changed:
A news/2780.feature
M plone/app/event/dx/behaviors.py
M plone/app/event/dx/configure.zcml
M plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml

b'diff --git a/news/2780.feature b/news/2780.feature\nnew file mode 100644\nindex 00000000..17ae13b6\n--- /dev/null\n+++ b/news/2780.feature\n@@ -0,0 +1,2 @@\n+PLIP 2780: textindexer, use here.\n+[zworkb]\ndiff --git a/plone/app/event/dx/behaviors.py b/plone/app/event/dx/behaviors.py\nindex 1fb32f22..f414f080 100644\n--- a/plone/app/event/dx/behaviors.py\n+++ b/plone/app/event/dx/behaviors.py\n@@ -27,7 +27,6 @@\n from plone.indexer import indexer\n from plone.supermodel import model\n from plone.uuid.interfaces import IUUID\n-from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.utils import safe_unicode\n from z3c.form.browser.checkbox import SingleCheckBoxFieldWidget\n from z3c.form.browser.text import TextFieldWidget\n@@ -42,8 +41,6 @@\n from zope.interface import provider\n from zope.schema.interfaces import IContextAwareDefaultFactory\n \n-import six\n-\n \n def first_weekday_sun0():\n     return wkday_to_mon1(first_weekday())\n@@ -375,30 +372,6 @@ def sync_uid_indexer(obj):\n     return sync_uid\n \n \n-# Body text indexing\n-@indexer(IDXEvent)\n-def searchable_text_indexer(obj):\n-    acc = IEventAccessor(obj)\n-    text = u\'\'\n-    text += u\'%s\\n\' % acc.title\n-    text += u\'%s\\n\' % acc.description\n-    textvalue = acc.text\n-    if textvalue is None:\n-        raise AttributeError\n-    transforms = getToolByName(obj, \'portal_transforms\')\n-    if six.PY2:\n-        textvalue = textvalue.encode(\'utf8\', \'replace\')\n-    body_plain = transforms.convertTo(\n-        \'text/plain\',\n-        textvalue,\n-        mimetype=\'text/html\',\n-    ).getData().strip()\n-    text += safe_unicode(body_plain)\n-    if six.PY2:\n-        text = text.strip().encode(\'utf-8\')\n-    return text\n-\n-\n # Object adapters\n \n @adapter(IDXEvent)\ndiff --git a/plone/app/event/dx/configure.zcml b/plone/app/event/dx/configure.zcml\nindex ee4727da..4ab51471 100644\n--- a/plone/app/event/dx/configure.zcml\n+++ b/plone/app/event/dx/configure.zcml\n@@ -23,7 +23,6 @@\n     <adapter name="start" factory=".behaviors.start_indexer" />\n     <adapter name="end" factory=".behaviors.end_indexer" />\n     <adapter name="location" factory=".behaviors.location_indexer" />\n-    <adapter name="SearchableText" factory=".behaviors.searchable_text_indexer" />\n     <adapter name="sync_uid" factory=".behaviors.sync_uid_indexer" />\n \n     <plone:behavior\ndiff --git a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\nindex 5cf35cbd..94515566 100644\n--- a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n+++ b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n@@ -38,6 +38,7 @@\n     <element value="plone.namefromtitle"/>\n     <element value="plone.allowdiscussion"/>\n     <element value="plone.excludefromnavigation"/>\n+    <element value="plone.textindexer"/>\n   </property>\n \n   <!-- View and aliases -->\n'

