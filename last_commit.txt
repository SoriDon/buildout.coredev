Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2016-06-22T10:15:59+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.app.portlets/commit/3f700e1729f3ba454f514766681acca734c243d8

Change news portlet to use the new select widget

Files changed:
M CHANGES.rst
M plone/app/portlets/portlets/news.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 33c9f99..07618b7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -13,6 +13,10 @@ New features:
 - Add category as CSS class to actions portlet for easier styling
   [tomgross]
 
+- Upgrade news portlet to use the new select widget;
+  Add dependency on plone.app.z3cform
+  [datakurre]
+
 Bug fixes:
 
 - *add item here*
diff --git a/plone/app/portlets/portlets/news.py b/plone/app/portlets/portlets/news.py
index dab238e..f7c86a7 100644
--- a/plone/app/portlets/portlets/news.py
+++ b/plone/app/portlets/portlets/news.py
@@ -1,17 +1,19 @@
 from Acquisition import aq_inner
 from plone.app.layout.navigation.root import getNavigationRootObject
-from plone.app.portlets import PloneMessageFactory as _
 from plone.app.portlets.cache import render_cachekey
+from plone.app.portlets import PloneMessageFactory as _
 from plone.app.portlets.portlets import base
-from plone.memoize import ram
+from plone.app.z3cform.widget import SelectFieldWidget
+from plone.autoform.directives import widget
 from plone.memoize.compress import xhtml_compress
+from plone.memoize import ram
 from plone.memoize.instance import memoize
 from plone.portlets.interfaces import IPortletDataProvider
 from Products.CMFCore.utils import getToolByName
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
-from zope import schema
 from zope.component import getMultiAdapter
-from zope.interface import implements
+from zope import schema
+from zope.interface import implementer
 
 
 class INewsPortlet(IPortletDataProvider):
@@ -22,6 +24,7 @@ class INewsPortlet(IPortletDataProvider):
                        default=5,
                        min=1)
 
+    widget(state=SelectFieldWidget)
     state = schema.Tuple(
         title=_(u"Workflow state"),
         description=_(u"Items in which workflow state to show."),
@@ -32,8 +35,8 @@ class INewsPortlet(IPortletDataProvider):
         )
 
 
+@implementer(INewsPortlet)
 class Assignment(base.Assignment):
-    implements(INewsPortlet)
 
     def __init__(self, count=5, state=('published', )):
         self.count = count
diff --git a/setup.py b/setup.py
index 2bb0c50..64bfad3 100644
--- a/setup.py
+++ b/setup.py
@@ -39,12 +39,14 @@
     install_requires=[
         'setuptools',
         'five.customerize',
+        'plone.autoform',
         'plone.i18n',
         'plone.memoize',
         'plone.portlets>=1.1',
         'plone.app.i18n',
         'plone.app.layout >= 1.2dev',
         'plone.app.vocabularies >= 2.1.15.dev0',
+        'plone.app.z3cform',
         'transaction',
         'zope.annotation',
         'zope.browser',


Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2016-06-22T12:18:29+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.portlets/commit/055bee123ce5eb30b417866a85f55a34738906fa

Merge pull request #76 from plone/datakurre-news-select-widget

Change news portlet to use the new select widget

Files changed:
M CHANGES.rst
M plone/app/portlets/portlets/news.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 33c9f99..07618b7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -13,6 +13,10 @@ New features:
 - Add category as CSS class to actions portlet for easier styling
   [tomgross]
 
+- Upgrade news portlet to use the new select widget;
+  Add dependency on plone.app.z3cform
+  [datakurre]
+
 Bug fixes:
 
 - *add item here*
diff --git a/plone/app/portlets/portlets/news.py b/plone/app/portlets/portlets/news.py
index dab238e..f7c86a7 100644
--- a/plone/app/portlets/portlets/news.py
+++ b/plone/app/portlets/portlets/news.py
@@ -1,17 +1,19 @@
 from Acquisition import aq_inner
 from plone.app.layout.navigation.root import getNavigationRootObject
-from plone.app.portlets import PloneMessageFactory as _
 from plone.app.portlets.cache import render_cachekey
+from plone.app.portlets import PloneMessageFactory as _
 from plone.app.portlets.portlets import base
-from plone.memoize import ram
+from plone.app.z3cform.widget import SelectFieldWidget
+from plone.autoform.directives import widget
 from plone.memoize.compress import xhtml_compress
+from plone.memoize import ram
 from plone.memoize.instance import memoize
 from plone.portlets.interfaces import IPortletDataProvider
 from Products.CMFCore.utils import getToolByName
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
-from zope import schema
 from zope.component import getMultiAdapter
-from zope.interface import implements
+from zope import schema
+from zope.interface import implementer
 
 
 class INewsPortlet(IPortletDataProvider):
@@ -22,6 +24,7 @@ class INewsPortlet(IPortletDataProvider):
                        default=5,
                        min=1)
 
+    widget(state=SelectFieldWidget)
     state = schema.Tuple(
         title=_(u"Workflow state"),
         description=_(u"Items in which workflow state to show."),
@@ -32,8 +35,8 @@ class INewsPortlet(IPortletDataProvider):
         )
 
 
+@implementer(INewsPortlet)
 class Assignment(base.Assignment):
-    implements(INewsPortlet)
 
     def __init__(self, count=5, state=('published', )):
         self.count = count
diff --git a/setup.py b/setup.py
index 2bb0c50..64bfad3 100644
--- a/setup.py
+++ b/setup.py
@@ -39,12 +39,14 @@
     install_requires=[
         'setuptools',
         'five.customerize',
+        'plone.autoform',
         'plone.i18n',
         'plone.memoize',
         'plone.portlets>=1.1',
         'plone.app.i18n',
         'plone.app.layout >= 1.2dev',
         'plone.app.vocabularies >= 2.1.15.dev0',
+        'plone.app.z3cform',
         'transaction',
         'zope.annotation',
         'zope.browser',


