Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-03-09T09:54:08+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/101b1f044ada3f3f0db92690c46db754ebc2623f

Wrong use of assertTrue in testResourceRegistries

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testResourceRegistries.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4550eea..7efcc4d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -36,6 +36,9 @@ Bug fixes:
   This solves a problem, where Editors couldn't see inactive content, even though they had the required permission on a subpath of the portal (e.g. a subsite).
   [thet]
 
+- Test: Wrong use of assertTrue in testResourceRegistries.
+  [jensens]
+
 
 5.1b2 (2017-02-20)
 ------------------
diff --git a/Products/CMFPlone/tests/testResourceRegistries.py b/Products/CMFPlone/tests/testResourceRegistries.py
index 1806dc7..72c7e42 100644
--- a/Products/CMFPlone/tests/testResourceRegistries.py
+++ b/Products/CMFPlone/tests/testResourceRegistries.py
@@ -306,8 +306,10 @@ def test_insert_after(self):
             """)
         importer._importNode(foobar.documentElement)
         resources = self._get_legacy_bundle().resources
-        self.assertTrue(resources.index('one') + 1,
-                        resources.index('foobar-js'))
+        self.assertEqual(
+            resources.index('one') + 1,
+            resources.index('foobar-js')
+        )
 
     def test_insert_before(self):
         importer = self._get_importer()
@@ -326,8 +328,10 @@ def test_insert_before(self):
             """)
         importer._importNode(foobar.documentElement)
         resources = self._get_legacy_bundle().resources
-        self.assertTrue(resources.index('one') - 1,
-                        resources.index('foobar-js'))
+        self.assertEqual(
+            resources.index('one') - 1,
+            resources.index('foobar-js')
+        )
 
     def test_be_able_to_disable_but_not_remove(self):
         importer = self._get_importer()


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-03-09T20:21:56+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/078e8a863631e0c715f19a4bcc18a5c643e9529f

fix: insert-before in legacy resource import was broken

Files changed:
M CHANGES.rst
M Products/CMFPlone/resources/exportimport/resourceregistry.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7efcc4d..f378854 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -39,6 +39,9 @@ Bug fixes:
 - Test: Wrong use of assertTrue in testResourceRegistries.
   [jensens]
 
+- Fix issue popped iup after fix of use of assertTrue in testResourceRegistries: insert-before in legacy resource import was broken.
+  [jensens]
+
 
 5.1b2 (2017-02-20)
 ------------------
diff --git a/Products/CMFPlone/resources/exportimport/resourceregistry.py b/Products/CMFPlone/resources/exportimport/resourceregistry.py
index 6e636ed..a0343d0 100644
--- a/Products/CMFPlone/resources/exportimport/resourceregistry.py
+++ b/Products/CMFPlone/resources/exportimport/resourceregistry.py
@@ -41,7 +41,7 @@ class ResourceRegistryNodeAdapter(XMLAdapterBase):
 
     resource_blacklist = set()
     registry = None
-    
+
     def _importNode(self, node):
         """Import the object from the DOM node.
         """
@@ -140,12 +140,12 @@ def _importNode(self, node):
                 elif position[0] == 'before':
                     if position[1] in legacy.resources:
                         legacy.resources.insert(
-                            legacy.resources.index(position[1]) + 1,
+                            legacy.resources.index(position[1]),
                             res_id)
                     else:
                         legacy.resources.append(res_id)
 
-            if remove:
+            elif remove:
                 if res_id in legacy.resources:
                     legacy.resources.remove(res_id)
                 if res_id in resources:


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-03-09T21:38:52+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/e25ba821c34d49a6d7b7ef10cf44440eb1e037ed

Merge pull request #1964 from plone/fix-test-wrong-use-of-assertTrue

Wrong use of assertTrue in testResourceRegistries

Files changed:
M CHANGES.rst
M Products/CMFPlone/resources/exportimport/resourceregistry.py
M Products/CMFPlone/tests/testResourceRegistries.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4550eea..f378854 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -36,6 +36,12 @@ Bug fixes:
   This solves a problem, where Editors couldn't see inactive content, even though they had the required permission on a subpath of the portal (e.g. a subsite).
   [thet]
 
+- Test: Wrong use of assertTrue in testResourceRegistries.
+  [jensens]
+
+- Fix issue popped iup after fix of use of assertTrue in testResourceRegistries: insert-before in legacy resource import was broken.
+  [jensens]
+
 
 5.1b2 (2017-02-20)
 ------------------
diff --git a/Products/CMFPlone/resources/exportimport/resourceregistry.py b/Products/CMFPlone/resources/exportimport/resourceregistry.py
index 6e636ed..a0343d0 100644
--- a/Products/CMFPlone/resources/exportimport/resourceregistry.py
+++ b/Products/CMFPlone/resources/exportimport/resourceregistry.py
@@ -41,7 +41,7 @@ class ResourceRegistryNodeAdapter(XMLAdapterBase):
 
     resource_blacklist = set()
     registry = None
-    
+
     def _importNode(self, node):
         """Import the object from the DOM node.
         """
@@ -140,12 +140,12 @@ def _importNode(self, node):
                 elif position[0] == 'before':
                     if position[1] in legacy.resources:
                         legacy.resources.insert(
-                            legacy.resources.index(position[1]) + 1,
+                            legacy.resources.index(position[1]),
                             res_id)
                     else:
                         legacy.resources.append(res_id)
 
-            if remove:
+            elif remove:
                 if res_id in legacy.resources:
                     legacy.resources.remove(res_id)
                 if res_id in resources:
diff --git a/Products/CMFPlone/tests/testResourceRegistries.py b/Products/CMFPlone/tests/testResourceRegistries.py
index 1806dc7..72c7e42 100644
--- a/Products/CMFPlone/tests/testResourceRegistries.py
+++ b/Products/CMFPlone/tests/testResourceRegistries.py
@@ -306,8 +306,10 @@ def test_insert_after(self):
             """)
         importer._importNode(foobar.documentElement)
         resources = self._get_legacy_bundle().resources
-        self.assertTrue(resources.index('one') + 1,
-                        resources.index('foobar-js'))
+        self.assertEqual(
+            resources.index('one') + 1,
+            resources.index('foobar-js')
+        )
 
     def test_insert_before(self):
         importer = self._get_importer()
@@ -326,8 +328,10 @@ def test_insert_before(self):
             """)
         importer._importNode(foobar.documentElement)
         resources = self._get_legacy_bundle().resources
-        self.assertTrue(resources.index('one') - 1,
-                        resources.index('foobar-js'))
+        self.assertEqual(
+            resources.index('one') - 1,
+            resources.index('foobar-js')
+        )
 
     def test_be_able_to_disable_but_not_remove(self):
         importer = self._get_importer()


