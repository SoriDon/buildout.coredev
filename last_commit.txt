Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-03-02T20:56:28+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/af96ef9c887104f857e0dc8ce3cc3c34174aa6b7

Render exceptions as text, not html to fix format of infos after traceback.

Files changed:
M CHANGES.rst
M Products/CMFPlone/browser/exceptions.py
M Products/CMFPlone/browser/templates/error_message.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 740302a17..dc6532bfa 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -41,6 +41,9 @@ Bug Fixes:
 - Fix Exception-View when main_template can't be rendered. Fixes #2325.
   [pbauer]
 
+- Render exceptions as text, not html to fix format of infos after traceback.
+  [pbauer]
+
 - Removed extra methods and tests for CMFQuickInstallerTool.
   Moved those to the Products.CMFQuickInstallerTool package.
   [maurits]
diff --git a/Products/CMFPlone/browser/exceptions.py b/Products/CMFPlone/browser/exceptions.py
index bb3426aaa..7a1a712f6 100644
--- a/Products/CMFPlone/browser/exceptions.py
+++ b/Products/CMFPlone/browser/exceptions.py
@@ -23,7 +23,7 @@ def __call__(self):
         error_type = exception.__class__.__name__
         exc_type, value, traceback = sys.exc_info()
         error_tb = ''.join(
-            format_exception(exc_type, value, traceback, as_html=True))
+            format_exception(exc_type, value, traceback, as_html=False))
         request.response.setStatus(exc_type)
 
         # Indicate exception as JSON
diff --git a/Products/CMFPlone/browser/templates/error_message.pt b/Products/CMFPlone/browser/templates/error_message.pt
index 7d09b29c5..d73e88d70 100644
--- a/Products/CMFPlone/browser/templates/error_message.pt
+++ b/Products/CMFPlone/browser/templates/error_message.pt
@@ -103,7 +103,7 @@
                    Here is the full error message:
                    </p>
 
-                   <div tal:replace="structure err_tb"/>
+                   <pre tal:content="err_tb"/>
                 </div>
 
                 <tal:noentry condition="not:isManager">


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-03-02T20:56:58+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/f740726a9d1b10eb78d41b6334713116be740081

Merge pull request #2328 from plone/render_exception_as_pre

Render exceptions as preformatted text

Files changed:
M CHANGES.rst
M Products/CMFPlone/browser/exceptions.py
M Products/CMFPlone/browser/templates/error_message.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 740302a17..dc6532bfa 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -41,6 +41,9 @@ Bug Fixes:
 - Fix Exception-View when main_template can't be rendered. Fixes #2325.
   [pbauer]
 
+- Render exceptions as text, not html to fix format of infos after traceback.
+  [pbauer]
+
 - Removed extra methods and tests for CMFQuickInstallerTool.
   Moved those to the Products.CMFQuickInstallerTool package.
   [maurits]
diff --git a/Products/CMFPlone/browser/exceptions.py b/Products/CMFPlone/browser/exceptions.py
index bb3426aaa..7a1a712f6 100644
--- a/Products/CMFPlone/browser/exceptions.py
+++ b/Products/CMFPlone/browser/exceptions.py
@@ -23,7 +23,7 @@ def __call__(self):
         error_type = exception.__class__.__name__
         exc_type, value, traceback = sys.exc_info()
         error_tb = ''.join(
-            format_exception(exc_type, value, traceback, as_html=True))
+            format_exception(exc_type, value, traceback, as_html=False))
         request.response.setStatus(exc_type)
 
         # Indicate exception as JSON
diff --git a/Products/CMFPlone/browser/templates/error_message.pt b/Products/CMFPlone/browser/templates/error_message.pt
index 7d09b29c5..d73e88d70 100644
--- a/Products/CMFPlone/browser/templates/error_message.pt
+++ b/Products/CMFPlone/browser/templates/error_message.pt
@@ -103,7 +103,7 @@
                    Here is the full error message:
                    </p>
 
-                   <div tal:replace="structure err_tb"/>
+                   <pre tal:content="err_tb"/>
                 </div>
 
                 <tal:noentry condition="not:isManager">


