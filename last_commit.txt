Repository: plone.portlet.static


Branch: refs/heads/master
Date: 2015-11-25T22:52:11+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.portlet.static/commit/bdf9c9651aca9db49d90e0f0f9e15ffb646e5370

Plone 4 compatibility.

Files changed:
M CHANGES.rst
M plone/portlet/static/static.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7259bb2..238c4e0 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ Fixes:
   and compute 'assignment context' only for 'context' portlet.
   [sverbois]
 
+- Plone 4 compatibility.
+  [thet]
+
 
 3.0.1 (2014-10-23)
 ------------------
diff --git a/plone/portlet/static/static.py b/plone/portlet/static/static.py
index 64c68f1..a9635e0 100644
--- a/plone/portlet/static/static.py
+++ b/plone/portlet/static/static.py
@@ -1,6 +1,7 @@
 # -*- coding: utf-8 -*-
 from Acquisition import aq_inner
 from Products.CMFCore.utils import getToolByName
+from Products.CMFPlone.utils import getFSVersionTuple
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 from plone.app.portlets.portlets import base
 from plone.app.textfield import RichText
@@ -15,6 +16,15 @@
 import re
 
 logger = logging.getLogger('plone.portlet.static')
+PLONE5 = getFSVersionTuple()[0] >= 5
+
+if PLONE5:
+    base_AddForm = base.AddForm
+    base_EditForm = base.EditForm
+else:
+    from plone.app.portlets.browser.z3cformhelper import AddForm as base_AddForm  # noqa
+    from plone.app.portlets.browser.z3cformhelper import EditForm as base_EditForm  # noqa
+    from z3c.form import field
 
 
 class IStaticPortlet(IPortletDataProvider):
@@ -156,14 +166,18 @@ def transformed(self, mt='text/x-html-safe'):
         return None
 
 
-class AddForm(base.AddForm):
+class AddForm(base_AddForm):
     """Portlet add form.
 
     This is registered in configure.zcml. The form_fields variable tells
     zope.formlib which fields to display. The create() method actually
     constructs the assignment that is being added.
     """
-    schema = IStaticPortlet
+    if PLONE5:
+        schema = IStaticPortlet
+    else:
+        fields = field.Fields(IStaticPortlet)
+
     label = _(u"title_add_static_portlet", default=u"Add static text portlet")
     description = _(
         u"description_static_portlet",
@@ -174,13 +188,17 @@ def create(self, data):
         return Assignment(**data)
 
 
-class EditForm(base.EditForm):
+class EditForm(base_EditForm):
     """Portlet edit form.
 
     This is registered with configure.zcml. The form_fields variable tells
     zope.formlib which fields to display.
     """
-    schema = IStaticPortlet
+    if PLONE5:
+        schema = IStaticPortlet
+    else:
+        fields = field.Fields(IStaticPortlet)
+
     label = _(
         u"title_edit_static_portlet",
         default=u"Edit static text portlet"


Repository: plone.portlet.static


Branch: refs/heads/master
Date: 2016-02-01T08:52:43+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.portlet.static/commit/45411dc42885e98a3a0ff165710e02cb9ee2ff8e

Merge pull request #11 from bluedynamics/master

Plone 4 compatibility.

Files changed:
M CHANGES.rst
M plone/portlet/static/static.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7259bb2..238c4e0 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ Fixes:
   and compute 'assignment context' only for 'context' portlet.
   [sverbois]
 
+- Plone 4 compatibility.
+  [thet]
+
 
 3.0.1 (2014-10-23)
 ------------------
diff --git a/plone/portlet/static/static.py b/plone/portlet/static/static.py
index 64c68f1..a9635e0 100644
--- a/plone/portlet/static/static.py
+++ b/plone/portlet/static/static.py
@@ -1,6 +1,7 @@
 # -*- coding: utf-8 -*-
 from Acquisition import aq_inner
 from Products.CMFCore.utils import getToolByName
+from Products.CMFPlone.utils import getFSVersionTuple
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 from plone.app.portlets.portlets import base
 from plone.app.textfield import RichText
@@ -15,6 +16,15 @@
 import re
 
 logger = logging.getLogger('plone.portlet.static')
+PLONE5 = getFSVersionTuple()[0] >= 5
+
+if PLONE5:
+    base_AddForm = base.AddForm
+    base_EditForm = base.EditForm
+else:
+    from plone.app.portlets.browser.z3cformhelper import AddForm as base_AddForm  # noqa
+    from plone.app.portlets.browser.z3cformhelper import EditForm as base_EditForm  # noqa
+    from z3c.form import field
 
 
 class IStaticPortlet(IPortletDataProvider):
@@ -156,14 +166,18 @@ def transformed(self, mt='text/x-html-safe'):
         return None
 
 
-class AddForm(base.AddForm):
+class AddForm(base_AddForm):
     """Portlet add form.
 
     This is registered in configure.zcml. The form_fields variable tells
     zope.formlib which fields to display. The create() method actually
     constructs the assignment that is being added.
     """
-    schema = IStaticPortlet
+    if PLONE5:
+        schema = IStaticPortlet
+    else:
+        fields = field.Fields(IStaticPortlet)
+
     label = _(u"title_add_static_portlet", default=u"Add static text portlet")
     description = _(
         u"description_static_portlet",
@@ -174,13 +188,17 @@ def create(self, data):
         return Assignment(**data)
 
 
-class EditForm(base.EditForm):
+class EditForm(base_EditForm):
     """Portlet edit form.
 
     This is registered with configure.zcml. The form_fields variable tells
     zope.formlib which fields to display.
     """
-    schema = IStaticPortlet
+    if PLONE5:
+        schema = IStaticPortlet
+    else:
+        fields = field.Fields(IStaticPortlet)
+
     label = _(
         u"title_edit_static_portlet",
         default=u"Edit static text portlet"


