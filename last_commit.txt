Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-04-04T13:33:10+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/d011a517dfe5c31c57100d3922fcc00a171fc7d8

Supported 'remove' keyword for configlets in controlpanel.xml.

Files changed:
M CHANGES.rst
M Products/CMFPlone/exportimport/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a0ebf61..1677907 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -37,6 +37,8 @@ Incompatibilities:
 
 New:
 
+- Supported ``remove`` keyword for configlets in controlpanel.xml.  [maurits]
+
 - Upgrade to tinymce to 4.3.4
   [vangheem]
 
diff --git a/Products/CMFPlone/exportimport/controlpanel.py b/Products/CMFPlone/exportimport/controlpanel.py
index cac7675..ecf8107 100644
--- a/Products/CMFPlone/exportimport/controlpanel.py
+++ b/Products/CMFPlone/exportimport/controlpanel.py
@@ -113,6 +113,12 @@ def _initConfiglets(self, node):
                 domain = default_domain
 
             action_id = str(child.getAttribute('action_id'))
+            # Remove previous action with same id and category.
+            controlpanel.unregisterConfiglet(action_id)
+            remove = str(child.getAttribute('remove'))
+            if remove.lower() == 'true':
+                continue
+
             title = Message(str(child.getAttribute('title')), domain=domain)
             url_expr = str(child.getAttribute('url_expr'))
             condition_expr = str(child.getAttribute('condition_expr'))
@@ -137,9 +143,6 @@ def _initConfiglets(self, node):
                     if permission:
                         break
 
-            # Remove previous action with same id and category.
-            controlpanel.unregisterConfiglet(action_id)
-
             controlpanel.registerConfiglet(id=action_id,
                                            name=title,
                                            action=url_expr,


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-04-04T13:33:42+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/151f6804bdfbead44394245814cf48a725251812

rebase and fix CHANGES

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 1677907..0100923 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,8 @@ Incompatibilities:
 
 New:
 
+- Supported ``remove`` keyword for configlets in controlpanel.xml.  [maurits]
+
 - Deprecated Gruntfile generation script ``plone-generate-gruntfile``. 
   Modified the ``plone-compile-resources`` script to support more parameters in order to take over that single task too. 
   Also clean up of parameters, better help and refactored parts of the code.
@@ -37,8 +39,6 @@ Incompatibilities:
 
 New:
 
-- Supported ``remove`` keyword for configlets in controlpanel.xml.  [maurits]
-
 - Upgrade to tinymce to 4.3.4
   [vangheem]
 


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-04-04T13:34:11+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/7c669b1d0e67980afebb851b75a929d1a101e116

Merge pull request #1372 from plone/maurits-support-remove-controlpanel-configlets

Supported 'remove' keyword for configlets in controlpanel.xml.

Files changed:
M CHANGES.rst
M Products/CMFPlone/exportimport/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a0ebf61..0100923 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,8 @@ Incompatibilities:
 
 New:
 
+- Supported ``remove`` keyword for configlets in controlpanel.xml.  [maurits]
+
 - Deprecated Gruntfile generation script ``plone-generate-gruntfile``. 
   Modified the ``plone-compile-resources`` script to support more parameters in order to take over that single task too. 
   Also clean up of parameters, better help and refactored parts of the code.
diff --git a/Products/CMFPlone/exportimport/controlpanel.py b/Products/CMFPlone/exportimport/controlpanel.py
index cac7675..ecf8107 100644
--- a/Products/CMFPlone/exportimport/controlpanel.py
+++ b/Products/CMFPlone/exportimport/controlpanel.py
@@ -113,6 +113,12 @@ def _initConfiglets(self, node):
                 domain = default_domain
 
             action_id = str(child.getAttribute('action_id'))
+            # Remove previous action with same id and category.
+            controlpanel.unregisterConfiglet(action_id)
+            remove = str(child.getAttribute('remove'))
+            if remove.lower() == 'true':
+                continue
+
             title = Message(str(child.getAttribute('title')), domain=domain)
             url_expr = str(child.getAttribute('url_expr'))
             condition_expr = str(child.getAttribute('condition_expr'))
@@ -137,9 +143,6 @@ def _initConfiglets(self, node):
                     if permission:
                         break
 
-            # Remove previous action with same id and category.
-            controlpanel.unregisterConfiglet(action_id)
-
             controlpanel.registerConfiglet(id=action_id,
                                            name=title,
                                            action=url_expr,


