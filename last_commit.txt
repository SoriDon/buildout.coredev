Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:04:49+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/a59b70ad203a1bdba0cd6e4d7260d4f9b6894402

Configuring with plone/meta

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/11f0db91.internal
A tox.ini
M pyproject.toml
M setup.cfg

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 000000000..b4158b89d\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 000000000..b66417080\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "11f0db91"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 000000000..fdafec1c2\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.3.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.4\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/news/11f0db91.internal b/news/11f0db91.internal\nnew file mode 100644\nindex 000000000..c08f53991\n--- /dev/null\n+++ b/news/11f0db91.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615de2..9eb73f3c5 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,43 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 3a6b7a1bc..e7e8dda7e 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -30,14 +30,22 @@ python_requires = >=3.8\n \n [check-manifest]\n ignore =\n-    *.cfg\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\n \n [bdist_wheel]\n universal = 0\n \n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 000000000..0b1bccdee\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,68 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --all --test-path={toxinidir}/src -s plone.app.multilingual {posargs}\n+extras =\n+    test\n+\n+[testenv:coverage]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    coverage\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    coverage run {envbindir}/zope-testrunner --all --test-path={toxinidir}/src -s plone.app.multilingual {posargs}\n+    coverage report -m --format markdown\n+extras =\n+    test\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:04:49+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/b568dea8a19ac516035a6b375cb0035f6cc91166

chore: isort

Files changed:
M src/plone/app/multilingual/browser/menu.py
M src/plone/app/multilingual/browser/setup.py
M src/plone/app/multilingual/dx/cloner.py
M src/plone/app/multilingual/dx/languageindependent.py
M src/plone/app/multilingual/tests/test_selector.py
M src/plone/app/multilingual/upgrades.py

b'diff --git a/src/plone/app/multilingual/browser/menu.py b/src/plone/app/multilingual/browser/menu.py\nindex 5c14a5ad..fcc12ae2 100644\n--- a/src/plone/app/multilingual/browser/menu.py\n+++ b/src/plone/app/multilingual/browser/menu.py\n@@ -14,12 +14,12 @@\n from plone.app.multilingual.interfaces import ITranslatable\n from plone.app.multilingual.interfaces import LANGUAGE_INDEPENDENT\n from plone.app.multilingual.permissions import ManageTranslations\n+from plone.base.defaultpage import is_default_page\n from plone.base.interfaces import ILanguage\n+from plone.base.utils import safe_text\n from plone.memoize import view\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.defaultpage import is_default_page\n-from plone.base.utils import safe_text\n from zope.browsermenu.menu import BrowserMenu\n from zope.browsermenu.menu import BrowserSubMenuItem\n from zope.component import getUtility\ndiff --git a/src/plone/app/multilingual/browser/setup.py b/src/plone/app/multilingual/browser/setup.py\nindex 06e9c259..88f0131d 100644\n--- a/src/plone/app/multilingual/browser/setup.py\n+++ b/src/plone/app/multilingual/browser/setup.py\n@@ -7,11 +7,11 @@\n from plone.app.multilingual.interfaces import LANGUAGE_INDEPENDENT\n from plone.app.multilingual.subscriber import set_recursive_language\n from plone.base.interfaces import ILanguage\n+from plone.base.utils import unrestricted_construct_instance\n from plone.dexterity.interfaces import IDexterityFTI\n from plone.i18n.locales.languages import _combinedlanguagelist\n from plone.i18n.locales.languages import _languagelist\n from Products.CMFCore.utils import getToolByName\n-from plone.base.utils import unrestricted_construct_instance\n from Products.Five import BrowserView\n from zope.component.hooks import getSite\n from zope.event import notify\ndiff --git a/src/plone/app/multilingual/dx/cloner.py b/src/plone/app/multilingual/dx/cloner.py\nindex 340692ac..e1e164ff 100644\n--- a/src/plone/app/multilingual/dx/cloner.py\n+++ b/src/plone/app/multilingual/dx/cloner.py\n@@ -3,8 +3,8 @@\n from plone.app.multilingual.interfaces import ITranslationCloner\n from plone.app.multilingual.interfaces import ITranslationManager\n from plone.base.interfaces import ILanguage\n-from plone.dexterity.utils import iterSchemata\n from plone.base.utils import safe_text\n+from plone.dexterity.utils import iterSchemata\n from z3c.relationfield import RelationValue\n from z3c.relationfield.interfaces import IRelationList\n from z3c.relationfield.interfaces import IRelationValue\ndiff --git a/src/plone/app/multilingual/dx/languageindependent.py b/src/plone/app/multilingual/dx/languageindependent.py\nindex b18bd256..33773b02 100644\n--- a/src/plone/app/multilingual/dx/languageindependent.py\n+++ b/src/plone/app/multilingual/dx/languageindependent.py\n@@ -2,6 +2,7 @@\n from plone.app.event.dx.behaviors import IEventBasic\n from zope.interface import alsoProvides\n \n+\n # configure existing behaviors to be language independent\n alsoProvides(IEventBasic["start"], ILanguageIndependentField)\n alsoProvides(IEventBasic["end"], ILanguageIndependentField)\ndiff --git a/src/plone/app/multilingual/tests/test_selector.py b/src/plone/app/multilingual/tests/test_selector.py\nindex eea4f185..712019e4 100644\n--- a/src/plone/app/multilingual/tests/test_selector.py\n+++ b/src/plone/app/multilingual/tests/test_selector.py\n@@ -11,12 +11,12 @@\n from plone.app.multilingual.testing import PAM_FUNCTIONAL_TESTING\n from plone.app.multilingual.testing import PAM_INTEGRATION_PRESET_TESTING\n from plone.app.multilingual.testing import PAM_INTEGRATION_TESTING\n+from plone.base.utils import safe_text\n from plone.dexterity.utils import createContentInContainer\n from plone.i18n.interfaces import ILanguageSchema\n from plone.registry.interfaces import IRegistry\n from plone.testing.z2 import Browser\n from Products.CMFCore.utils import getToolByName\n-from plone.base.utils import safe_text\n from urllib.parse import parse_qs\n from urllib.parse import urlparse\n from zope.component import getUtility\ndiff --git a/src/plone/app/multilingual/upgrades.py b/src/plone/app/multilingual/upgrades.py\nindex efd21125..ba472534 100644\n--- a/src/plone/app/multilingual/upgrades.py\n+++ b/src/plone/app/multilingual/upgrades.py\n@@ -1,10 +1,10 @@\n from Acquisition import aq_base\n from plone.app.multilingual import logger\n from plone.base.interfaces import ILanguage\n+from plone.base.utils import unrestricted_construct_instance\n from plone.dexterity.interfaces import IDexterityFTI\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.utils import unrestricted_construct_instance\n from time import time\n from zope.component import getUtility\n \n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:04:49+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/66bdc66560d0e870286faca3d1f12ac1379f1aaa

chore: black

Files changed:
M docs/conf.py
M src/plone/app/multilingual/browser/selector.py

b'diff --git a/docs/conf.py b/docs/conf.py\nindex 349a510da..676bcc18a 100644\n--- a/docs/conf.py\n+++ b/docs/conf.py\n@@ -17,196 +17,199 @@\n # If extensions (or modules to document with autodoc) are in another directory,\n # add these directories to sys.path here. If the directory is relative to the\n # documentation root, use os.path.abspath to make it absolute, like shown here.\n-#sys.path.insert(0, os.path.abspath(\'.\'))\n+# sys.path.insert(0, os.path.abspath(\'.\'))\n \n # -- General configuration -----------------------------------------------------\n \n # If your documentation needs a minimal Sphinx version, state it here.\n-#needs_sphinx = \'1.0\'\n+# needs_sphinx = \'1.0\'\n \n # Add any Sphinx extension module names here, as strings. They can be extensions\n # coming with Sphinx (named \'sphinx.ext.*\') or your custom ones.\n extensions = []\n \n # Add any paths that contain templates here, relative to this directory.\n-templates_path = [\'_templates\']\n+templates_path = ["_templates"]\n \n # The suffix of source filenames.\n-source_suffix = \'.rst\'\n+source_suffix = ".rst"\n \n # The encoding of source files.\n-#source_encoding = \'utf-8-sig\'\n+# source_encoding = \'utf-8-sig\'\n \n # The master toctree document.\n-master_doc = \'index\'\n+master_doc = "index"\n \n # General information about the project.\n-project = \'plone.app.multilingual\'\n-copyright = \'2013, Plone Foundation\'\n+project = "plone.app.multilingual"\n+copyright = "2013, Plone Foundation"\n \n # The version info for the project you\'re documenting, acts as replacement for\n # |version| and |release|, also used in various other places throughout the\n # built documents.\n #\n # The short X.Y version.\n-version = \'1.0\'\n+version = "1.0"\n # The full version, including alpha/beta/rc tags.\n-release = \'1.0\'\n+release = "1.0"\n \n # The language for content autogenerated by Sphinx. Refer to documentation\n # for a list of supported languages.\n-#language = None\n+# language = None\n \n # There are two options for replacing |today|: either, you set today to some\n # non-false value, then it is used:\n-#today = \'\'\n+# today = \'\'\n # Else, today_fmt is used as the format for a strftime call.\n-#today_fmt = \'%B %d, %Y\'\n+# today_fmt = \'%B %d, %Y\'\n \n # List of patterns, relative to source directory, that match files and\n # directories to ignore when looking for source files.\n-exclude_patterns = [\'_build\']\n+exclude_patterns = ["_build"]\n \n # The reST default role (used for this markup: `text`) to use for all documents.\n-#default_role = None\n+# default_role = None\n \n # If true, \'()\' will be appended to :func: etc. cross-reference text.\n-#add_function_parentheses = True\n+# add_function_parentheses = True\n \n # If true, the current module name will be prepended to all description\n # unit titles (such as .. function::).\n-#add_module_names = True\n+# add_module_names = True\n \n # If true, sectionauthor and moduleauthor directives will be shown in the\n # output. They are ignored by default.\n-#show_authors = False\n+# show_authors = False\n \n # The name of the Pygments (syntax highlighting) style to use.\n-pygments_style = \'sphinx\'\n+pygments_style = "sphinx"\n \n # A list of ignored prefixes for module index sorting.\n-#modindex_common_prefix = []\n+# modindex_common_prefix = []\n \n \n # -- Options for HTML output ---------------------------------------------------\n \n # The theme to use for HTML and HTML Help pages.  See the documentation for\n # a list of builtin themes.\n-html_theme = \'default\'\n+html_theme = "default"\n \n # Theme options are theme-specific and customize the look and feel of a theme\n # further.  For a list of options available for each theme, see the\n # documentation.\n-#html_theme_options = {}\n+# html_theme_options = {}\n \n # Add any paths that contain custom themes here, relative to this directory.\n-#html_theme_path = []\n+# html_theme_path = []\n \n # The name for this set of Sphinx documents.  If None, it defaults to\n # "<project> v<release> documentation".\n-#html_title = None\n+# html_title = None\n \n # A shorter title for the navigation bar.  Default is the same as html_title.\n-#html_short_title = None\n+# html_short_title = None\n \n # The name of an image file (relative to this directory) to place at the top\n # of the sidebar.\n-#html_logo = None\n+# html_logo = None\n \n # The name of an image file (within the static path) to use as favicon of the\n # docs.  This file should be a Windows icon file (.ico) being 16x16 or 32x32\n # pixels large.\n-#html_favicon = None\n+# html_favicon = None\n \n # Add any paths that contain custom static files (such as style sheets) here,\n # relative to this directory. They are copied after the builtin static files,\n # so a file named "default.css" will overwrite the builtin "default.css".\n-html_static_path = [\'_static\']\n+html_static_path = ["_static"]\n \n # If not \'\', a \'Last updated on:\' timestamp is inserted at every page bottom,\n # using the given strftime format.\n-#html_last_updated_fmt = \'%b %d, %Y\'\n+# html_last_updated_fmt = \'%b %d, %Y\'\n \n # If true, SmartyPants will be used to convert quotes and dashes to\n # typographically correct entities.\n-#html_use_smartypants = True\n+# html_use_smartypants = True\n \n # Custom sidebar templates, maps document names to template names.\n-#html_sidebars = {}\n+# html_sidebars = {}\n \n # Additional templates that should be rendered to pages, maps page names to\n # template names.\n-#html_additional_pages = {}\n+# html_additional_pages = {}\n \n # If false, no module index is generated.\n-#html_domain_indices = True\n+# html_domain_indices = True\n \n # If false, no index is generated.\n-#html_use_index = True\n+# html_use_index = True\n \n # If true, the index is split into individual pages for each letter.\n-#html_split_index = False\n+# html_split_index = False\n \n # If true, links to the reST sources are added to the pages.\n-#html_show_sourcelink = True\n+# html_show_sourcelink = True\n \n # If true, "Created using Sphinx" is shown in the HTML footer. Default is True.\n-#html_show_sphinx = True\n+# html_show_sphinx = True\n \n # If true, "(C) Copyright ..." is shown in the HTML footer. Default is True.\n-#html_show_copyright = True\n+# html_show_copyright = True\n \n # If true, an OpenSearch description file will be output, and all pages will\n # contain a <link> tag referring to it.  The value of this option must be the\n # base URL from which the finished HTML is served.\n-#html_use_opensearch = \'\'\n+# html_use_opensearch = \'\'\n \n # This is the file name suffix for HTML files (e.g. ".xhtml").\n-#html_file_suffix = None\n+# html_file_suffix = None\n \n # Output file base name for HTML help builder.\n-htmlhelp_basename = \'ploneappmultilingualdoc\'\n+htmlhelp_basename = "ploneappmultilingualdoc"\n \n \n # -- Options for LaTeX output --------------------------------------------------\n \n latex_elements = {\n-# The paper size (\'letterpaper\' or \'a4paper\').\n-#\'papersize\': \'letterpaper\',\n-\n-# The font size (\'10pt\', \'11pt\' or \'12pt\').\n-#\'pointsize\': \'10pt\',\n-\n-# Additional stuff for the LaTeX preamble.\n-#\'preamble\': \'\',\n+    # The paper size (\'letterpaper\' or \'a4paper\').\n+    #\'papersize\': \'letterpaper\',\n+    # The font size (\'10pt\', \'11pt\' or \'12pt\').\n+    #\'pointsize\': \'10pt\',\n+    # Additional stuff for the LaTeX preamble.\n+    #\'preamble\': \'\',\n }\n \n # Grouping the document tree into LaTeX files. List of tuples\n # (source start file, target name, title, author, documentclass [howto/manual]).\n latex_documents = [\n-  (\'index\', \'ploneappmultilingual.tex\', \'plone.app.multilingual Documentation\',\n-   \'Plone Foundation\', \'manual\'),\n+    (\n+        "index",\n+        "ploneappmultilingual.tex",\n+        "plone.app.multilingual Documentation",\n+        "Plone Foundation",\n+        "manual",\n+    ),\n ]\n \n # The name of an image file (relative to this directory) to place at the top of\n # the title page.\n-#latex_logo = None\n+# latex_logo = None\n \n # For "manual" documents, if this is true, then toplevel headings are parts,\n # not chapters.\n-#latex_use_parts = False\n+# latex_use_parts = False\n \n # If true, show page references after internal links.\n-#latex_show_pagerefs = False\n+# latex_show_pagerefs = False\n \n # If true, show URL addresses after external links.\n-#latex_show_urls = False\n+# latex_show_urls = False\n \n # Documents to append as an appendix to all manuals.\n-#latex_appendices = []\n+# latex_appendices = []\n \n # If false, no module index is generated.\n-#latex_domain_indices = True\n+# latex_domain_indices = True\n \n \n # -- Options for manual page output --------------------------------------------\n@@ -214,12 +217,17 @@\n # One entry per manual page. List of tuples\n # (source start file, name, description, authors, manual section).\n man_pages = [\n-    (\'index\', \'ploneappmultilingual\', \'plone.app.multilingual Documentation\',\n-     [\'Plone Foundation\'], 1)\n+    (\n+        "index",\n+        "ploneappmultilingual",\n+        "plone.app.multilingual Documentation",\n+        ["Plone Foundation"],\n+        1,\n+    )\n ]\n \n # If true, show URL addresses after external links.\n-#man_show_urls = False\n+# man_show_urls = False\n \n \n # -- Options for Texinfo output ------------------------------------------------\n@@ -228,16 +236,22 @@\n # (source start file, target name, title, author,\n #  dir menu entry, description, category)\n texinfo_documents = [\n-  (\'index\', \'ploneappmultilingual\', \'plone.app.multilingual Documentation\',\n-   \'Plone Foundation\', \'ploneappmultilingual\', \'One line description of project.\',\n-   \'Miscellaneous\'),\n+    (\n+        "index",\n+        "ploneappmultilingual",\n+        "plone.app.multilingual Documentation",\n+        "Plone Foundation",\n+        "ploneappmultilingual",\n+        "One line description of project.",\n+        "Miscellaneous",\n+    ),\n ]\n \n # Documents to append as an appendix to all manuals.\n-#texinfo_appendices = []\n+# texinfo_appendices = []\n \n # If false, no module index is generated.\n-#texinfo_domain_indices = True\n+# texinfo_domain_indices = True\n \n # How to display URL addresses: \'footnote\', \'no\', or \'inline\'.\n-#texinfo_show_urls = \'footnote\'\n+# texinfo_show_urls = \'footnote\'\ndiff --git a/src/plone/app/multilingual/browser/selector.py b/src/plone/app/multilingual/browser/selector.py\nindex 8ded4e9e0..5f6fd0fab 100644\n--- a/src/plone/app/multilingual/browser/selector.py\n+++ b/src/plone/app/multilingual/browser/selector.py\n@@ -110,7 +110,7 @@ def languages(self):\n                 site.absolute_url().rstrip("/")\n                 + "/@@multilingual-selector/%s/%s"\n                 % (translation_group, lang_info["code"]),\n-                **query_extras\n+                **query_extras,\n             )\n             results.append(data)\n         return results\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:04:49+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/dccf75e9f5be531e794f20f1e0cbbd00aaf63787

chore: zpretty ZCML/XML

Files changed:
M src/plone/app/multilingual/browser/configure.zcml
M src/plone/app/multilingual/configure.zcml
M src/plone/app/multilingual/content/lif.xml
M src/plone/app/multilingual/content/lrf.xml
M src/plone/app/multilingual/dx/configure.zcml
M src/plone/app/multilingual/dx/meta.zcml
M src/plone/app/multilingual/overrides.zcml
M src/plone/app/multilingual/permissions.zcml
M src/plone/app/multilingual/profiles/default/browserlayer.xml
M src/plone/app/multilingual/profiles/default/catalog.xml
M src/plone/app/multilingual/profiles/default/metadata.xml
M src/plone/app/multilingual/profiles/default/reference_catalog.xml
M src/plone/app/multilingual/profiles/default/registry.xml
M src/plone/app/multilingual/profiles/default/rolemap.xml
M src/plone/app/multilingual/profiles/default/types.xml
M src/plone/app/multilingual/profiles/default/types/LIF.xml
M src/plone/app/multilingual/profiles/default/types/LRF.xml
M src/plone/app/multilingual/profiles/default/viewlets.xml
M src/plone/app/multilingual/profiles/uninstall/browserlayer.xml
M src/plone/app/multilingual/profiles/uninstall/catalog.xml
M src/plone/app/multilingual/profiles/uninstall/cssregistry.xml
M src/plone/app/multilingual/profiles/uninstall/metadata.xml
M src/plone/app/multilingual/profiles/uninstall/reference_catalog.xml
M src/plone/app/multilingual/profiles/uninstall/types.xml
M src/plone/app/multilingual/profiles/uninstall/viewlets.xml
M src/plone/app/multilingual/profiles/upgrades/to_1000/types/LIF.xml
M src/plone/app/multilingual/profiles/upgrades/to_1000/types/LRF.xml
M src/plone/app/multilingual/profiles/upgrades/to_3/registry.xml
M src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml
M src/plone/app/multilingual/testing.zcml
M src/plone/app/multilingual/upgrades.zcml

b'diff --git a/src/plone/app/multilingual/browser/configure.zcml b/src/plone/app/multilingual/browser/configure.zcml\nindex a8a45c7e3..b27c1f003 100644\n--- a/src/plone/app/multilingual/browser/configure.zcml\n+++ b/src/plone/app/multilingual/browser/configure.zcml\n@@ -1,29 +1,35 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n-  <include package="plone.app.contentmenu"/>\n+  <include package="plone.app.contentmenu" />\n \n   <!-- Resource Directories -->\n   <browser:resourceDirectory\n       name="plone.app.multilingual.javascript"\n-      directory="javascript"/>\n+      directory="javascript"\n+      />\n   <browser:resourceDirectory\n       name="plone.app.multilingual.stylesheet"\n-      directory="stylesheet"/>\n+      directory="stylesheet"\n+      />\n   <browser:resourceDirectory\n       name="plone.app.multilingual.images"\n-      directory="images"/>\n+      directory="images"\n+      />\n \n   <!-- Vocabulary all languages -->\n   <utility\n+      name="plone.app.multilingual.vocabularies.AllContentLanguageVocabulary"\n       component=".vocabularies.AllContentLanguageVocabularyFactory"\n-      name="plone.app.multilingual.vocabularies.AllContentLanguageVocabulary"/>\n+      />\n \n   <utility\n+      name="plone.app.multilingual.vocabularies.AllAvailableLanguageVocabulary"\n       component=".vocabularies.AllAvailableLanguageVocabularyFactory"\n-      name="plone.app.multilingual.vocabularies.AllAvailableLanguageVocabulary"/>\n+      />\n \n   <utility\n       factory=".vocabularies.RootCatalogVocabularyFactory"\n@@ -31,61 +37,69 @@\n       />\n \n   <adapter\n+      factory=".add.AddViewTraverser"\n       name="addtranslation"\n-      factory=".add.AddViewTraverser"/>\n+      />\n \n   <browser:page\n       name="modify_translations"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".modify.ModifyTranslationsForm"\n       template="templates/modify_translations.pt"\n-      permission="plone.app.multilingual.ManageTranslations"/>\n+      permission="plone.app.multilingual.ManageTranslations"\n+      />\n \n   <browser:page\n       name="connect_translation"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".modify.ConnectTranslation"\n-      permission="plone.app.multilingual.ManageTranslations"/>\n+      permission="plone.app.multilingual.ManageTranslations"\n+      />\n \n   <browser:page\n       name="disconnect_translation"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".modify.DisconnectTranslation"\n       template="templates/disconnect_translation.pt"\n-      permission="plone.app.multilingual.ManageTranslations"/>\n+      permission="plone.app.multilingual.ManageTranslations"\n+      />\n \n   <browser:page\n-      for="plone.app.multilingual.interfaces.ITranslatable"\n       name="update_language"\n+      for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".update.update_language_form"\n-      permission="cmf.ModifyPortalContent"/>\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n   <browser:page\n-      for="plone.app.multilingual.interfaces.ITranslatable"\n       name="create_translation"\n+      for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".translate.TranslationForm"\n-      permission="plone.app.multilingual.ManageTranslations"/>\n+      permission="plone.app.multilingual.ManageTranslations"\n+      />\n \n   <!-- Menu for translations on content -->\n   <browser:menu\n       id="plone_contentmenu_multilingual"\n       title="Translate menu - contains translation-related actions"\n-      class=".menu.TranslateMenu"/>\n+      class=".menu.TranslateMenu"\n+      />\n   <adapter\n+      factory=".menu.TranslateSubMenuItem"\n+      provides="plone.app.contentmenu.interfaces.IContentMenuItem"\n       for="plone.app.multilingual.interfaces.ITranslatable\n            ..interfaces.IPloneAppMultilingualInstalled"\n       name="plone.contentmenu.multilingual"\n-      factory=".menu.TranslateSubMenuItem"\n-      provides="plone.app.contentmenu.interfaces.IContentMenuItem"/>\n+      />\n \n   <!-- Control panel -->\n   <browser:page\n-    name="language-controlpanel"\n-    for="plone.base.interfaces.IPloneSiteRoot"\n-    class=".controlpanel.LanguageControlPanel"\n-    permission="plone.app.controlpanel.Language"\n-    layer="..interfaces.IPloneAppMultilingualInstalled"\n-    />\n+      name="language-controlpanel"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n+      class=".controlpanel.LanguageControlPanel"\n+      permission="plone.app.controlpanel.Language"\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Migration Tab -->\n   <browser:page\n@@ -93,36 +107,40 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.MigrationView"\n       permission="plone.app.multilingual.ManageTranslations"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <browser:page\n       name="multilingual-map"\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.multilingualMapView"\n       permission="plone.app.multilingual.ManageTranslations"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Notices Viewlets -->\n   <browser:viewlet\n-      zcml:condition="installed plone.app.controlpanel"\n       name="plone.app.multilingual.supported-languages-notice"\n       for="plone.base.interfaces.IPloneSiteRoot"\n       view="plone.app.controlpanel.interfaces.IPloneControlPanelView"\n       manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n       class=".viewlets.OneLanguageConfiguredNoticeViewlet"\n       template="templates/languages-notice.pt"\n+      permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"\n-      permission="cmf.ManagePortal"/>\n+      zcml:condition="installed plone.app.controlpanel"\n+      />\n   <browser:viewlet\n-      zcml:condition="not-installed plone.app.controlpanel"\n       name="plone.app.multilingual.supported-languages-notice"\n       for="plone.base.interfaces.IPloneSiteRoot"\n       view="plone.base.interfaces.controlpanel.IPloneControlPanelView"\n       manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n       class=".viewlets.OneLanguageConfiguredNoticeViewlet"\n       template="templates/languages-notice.pt"\n+      permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"\n-      permission="cmf.ManagePortal"/>\n+      zcml:condition="not-installed plone.app.controlpanel"\n+      />\n \n   <!-- It comes from a translation DX -->\n   <browser:viewlet\n@@ -132,8 +150,9 @@\n       manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n       class=".viewlets.AddFormIsATranslationViewlet"\n       template="templates/add-form-is-translation.pt"\n+      permission="zope.Public"\n       layer="..interfaces.IPloneAppMultilingualInstalled"\n-      permission="zope.Public"/>\n+      />\n \n   <!-- Alternate language meta tags -->\n   <browser:viewlet\n@@ -142,8 +161,9 @@\n       manager="plone.app.layout.viewlets.interfaces.IHtmlHead"\n       class=".viewlets.AlternateLanguagesViewlet"\n       template="templates/alternate-languages.pt"\n+      permission="zope.Public"\n       layer="..interfaces.IPloneAppMultilingualInstalled"\n-      permission="zope.Public"/>\n+      />\n \n   <!-- Universal Link -->\n   <browser:page\n@@ -151,7 +171,8 @@\n       for="*"\n       class=".helper_views.universal_link"\n       permission="zope.Public"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Translation Group -->\n   <browser:page\n@@ -159,7 +180,8 @@\n       for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".helper_views.TGView"\n       permission="zope.Public"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Selector -->\n   <browser:page\n@@ -167,7 +189,8 @@\n       for="plone.app.layout.navigation.interfaces.INavigationRoot"\n       class=".helper_views.selector_view"\n       permission="zope.Public"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Not Translated Yet -->\n   <browser:page\n@@ -175,7 +198,8 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".helper_views.not_translated_yet"\n       permission="zope.Public"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Multilingual Map ajax helper -->\n   <browser:page\n@@ -183,75 +207,84 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.multilingualMapViewJSON"\n       permission="plone.app.multilingual.ManageTranslations"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Default browser view -->\n   <browser:view\n+      name="language-switcher"\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".switcher.LanguageSwitcher"\n-      name="language-switcher"\n       permission="zope.Public"\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n       menu="plone_displayviews"\n       title="Root language switcher"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      />\n \n   <!-- Viewlet for switching language -->\n   <browser:viewlet\n       name="plone.app.multilingual.languageselector"\n-      template="templates/languageselector.pt"\n+      for="plone.app.multilingual.interfaces.ITranslatable"\n       manager="plone.app.layout.viewlets.interfaces.IPortalHeader"\n       class=".selector.LanguageSelectorViewlet"\n+      template="templates/languageselector.pt"\n       permission="zope2.View"\n-      for="plone.app.multilingual.interfaces.ITranslatable"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- DEXTERITY -->\n   <configure zcml:condition="installed plone.dexterity">\n \n     <!-- GTranslate Service -->\n     <browser:page\n-        for="plone.dexterity.interfaces.IDexterityContent"\n         name="gtranslation_service"\n+        for="plone.dexterity.interfaces.IDexterityContent"\n         class=".translate.gtranslation_service_dexterity"\n-        permission="cmf.ModifyPortalContent"/>\n+        permission="cmf.ModifyPortalContent"\n+        />\n \n     <!-- Standard add view and form - invoked from ++addtranslation++ traverser -->\n     <adapter\n-        name="babel_view"\n+        factory=".add.DefaultMultilingualAddView"\n+        provides="zope.publisher.interfaces.browser.IBrowserPage"\n         for="Products.CMFCore.interfaces.IFolderish\n              zope.publisher.interfaces.browser.IDefaultBrowserLayer\n-        plone.dexterity.interfaces.IDexterityFTI"\n-        provides="zope.publisher.interfaces.browser.IBrowserPage"\n-        factory=".add.DefaultMultilingualAddView"/>\n+             plone.dexterity.interfaces.IDexterityFTI"\n+        name="babel_view"\n+        />\n     <class class=".add.DefaultMultilingualAddView">\n       <require\n           permission="cmf.AddPortalContent"\n-          interface="zope.publisher.interfaces.browser.IBrowserPage"/>\n+          interface="zope.publisher.interfaces.browser.IBrowserPage"\n+          />\n     </class>\n \n     <!-- Edit form -->\n     <browser:page\n-        for="plone.dexterity.interfaces.IDexterityContent"\n         name="babel_edit"\n+        for="plone.dexterity.interfaces.IDexterityContent"\n         class=".edit.DefaultMultilingualEditView"\n-        permission="cmf.ModifyPortalContent"/>\n+        permission="cmf.ModifyPortalContent"\n+        />\n \n \n     <!-- Templates for translation fields info visualization via AJAX -->\n     <browser:page\n-        for="plone.dexterity.interfaces.IDexterityContent"\n         name="babel_view"\n+        for="plone.dexterity.interfaces.IDexterityContent"\n         class=".view.DexterityBabelView"\n         template="templates/dx_babel_view.pt"\n-        permission="cmf.ModifyPortalContent"/>\n+        permission="cmf.ModifyPortalContent"\n+        />\n \n   </configure>\n \n   <browser:page\n-      for="*"\n       name="babel_utils"\n+      for="*"\n       class=".utils.BabelUtils"\n-      permission="zope2.View"/>\n+      permission="zope2.View"\n+      />\n \n   <!-- Migration Views -->\n \n@@ -261,7 +294,8 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMReindexLanguageIndex"\n       permission="cmf.ManagePortal"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Step 1 - Relocates the content if needed -->\n   <browser:page\n@@ -269,7 +303,8 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.moveContentToProperRLF"\n       permission="cmf.ManagePortal"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Step 2 - Migrate multilingual catalog info -->\n   <browser:page\n@@ -277,7 +312,8 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMView"\n       permission="cmf.ManagePortal"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Step 3  - Cleanup tasks after migration -->\n   <browser:page\n@@ -285,7 +321,8 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMAfterView"\n       permission="cmf.ManagePortal"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- For manual folder to LRF migration -->\n   <browser:page\n@@ -302,6 +339,7 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.MigrationViewAfter"\n       permission="plone.app.multilingual.ManageTranslations"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n </configure>\ndiff --git a/src/plone/app/multilingual/configure.zcml b/src/plone/app/multilingual/configure.zcml\nindex 98dd5f8e7..debfb656f 100644\n--- a/src/plone/app/multilingual/configure.zcml\n+++ b/src/plone/app/multilingual/configure.zcml\n@@ -1,10 +1,11 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:zcml="http://namespaces.zope.org/zcml"\n-    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:five="http://namespaces.zope.org/five"\n+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:i18n="http://namespaces.zope.org/i18n"\n-    i18n_domain="plone">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n \n   <include package="plone.behavior" />\n   <include package="plone.dexterity" />\n@@ -13,78 +14,98 @@\n   <!-- <include package="Products.PloneLanguageTool" /> -->\n   <include package="z3c.relationfield" />\n \n-  <five:registerPackage package="."/> <!-- Required for uninstall profile -->\n+  <five:registerPackage package="." />\n+  <!-- Required for uninstall profile -->\n \n-  <include package="Products.CMFCore" file="permissions.zcml"/>\n+  <include\n+      package="Products.CMFCore"\n+      file="permissions.zcml"\n+      />\n \n-  <include file="permissions.zcml"/>\n-  <include file="upgrades.zcml"/>\n-  <include package=".browser"/>\n-  <include package=".dx"/>\n+  <include file="permissions.zcml" />\n+  <include file="upgrades.zcml" />\n+  <include package=".browser" />\n+  <include package=".dx" />\n \n   <!--<adapter factory=".content.lrf.LRFOrdering"/>-->\n-  <adapter factory=".shared_uuid.lrfUUID"/>\n-  <adapter factory=".shared_uuid.lifUUID"/>\n+  <adapter factory=".shared_uuid.lrfUUID" />\n+  <adapter factory=".shared_uuid.lifUUID" />\n \n   <!-- ITranslationGroup and indexer -->\n \n-  <adapter factory=".itg.attributeTG"/>\n-  <adapter factory=".itg.MutableAttributeTG"/>\n-  <subscriber handler=".itg.addAttributeTG"/>\n+  <adapter factory=".itg.attributeTG" />\n+  <adapter factory=".itg.MutableAttributeTG" />\n+  <subscriber handler=".itg.addAttributeTG" />\n \n-  <adapter factory=".indexer.itgIndexer" name="TranslationGroup"/>\n-  <adapter factory=".indexer.LanguageIndexer" name="Language"/>\n+  <adapter\n+      factory=".indexer.itgIndexer"\n+      name="TranslationGroup"\n+      />\n+  <adapter\n+      factory=".indexer.LanguageIndexer"\n+      name="Language"\n+      />\n \n   <subscriber\n       for="plone.app.multilingual.interfaces.ILanguageIndependentFolder\n            zope.lifecycleevent.interfaces.IObjectCreatedEvent"\n-      handler="plone.app.multilingual.content.lif.connect_with_others"/>\n+      handler="plone.app.multilingual.content.lif.connect_with_others"\n+      />\n \n   <!-- Generic plone.app.multilingual subscribers and adapters -->\n \n   <configure zcml:condition="not-installed zope.container">\n-      <subscriber\n-          for="plone.app.multilingual.interfaces.ITranslatable\n-               zope.app.container.interfaces.IObjectAddedEvent"\n-          handler="plone.app.multilingual.subscriber.createdEvent"/>\n+    <subscriber\n+        for="plone.app.multilingual.interfaces.ITranslatable\n+             zope.app.container.interfaces.IObjectAddedEvent"\n+        handler="plone.app.multilingual.subscriber.createdEvent"\n+        />\n   </configure>\n \n   <configure zcml:condition="installed zope.container">\n     <subscriber\n-          for="plone.app.multilingual.interfaces.ITranslatable\n-               zope.container.interfaces.IObjectAddedEvent"\n-          handler="plone.app.multilingual.subscriber.createdEvent"/>\n+        for="plone.app.multilingual.interfaces.ITranslatable\n+             zope.container.interfaces.IObjectAddedEvent"\n+        handler="plone.app.multilingual.subscriber.createdEvent"\n+        />\n   </configure>\n \n   <subscriber\n       for="plone.app.multilingual.interfaces.ITranslatable\n            zope.lifecycleevent.interfaces.IObjectCopiedEvent"\n-      handler="plone.app.multilingual.subscriber.createdEvent"/>\n+      handler="plone.app.multilingual.subscriber.createdEvent"\n+      />\n   <subscriber\n       for="plone.app.multilingual.interfaces.ITranslatable\n            zope.lifecycleevent.interfaces.IObjectMovedEvent"\n-      handler="plone.app.multilingual.subscriber.createdEvent"/>\n+      handler="plone.app.multilingual.subscriber.createdEvent"\n+      />\n \n   <adapter\n-      for="plone.app.multilingual.interfaces.ITranslatable"\n+      factory="plone.app.multilingual.manager.TranslationManager"\n       provides="plone.app.multilingual.interfaces.ITranslationManager"\n-      factory="plone.app.multilingual.manager.TranslationManager"/>\n-  <adapter\n       for="plone.app.multilingual.interfaces.ITranslatable"\n-      provides="plone.app.multilingual.interfaces.ITranslationLocator"\n-      factory="plone.app.multilingual.factory.DefaultTranslationLocator"/>\n+      />\n   <adapter\n+      factory="plone.app.multilingual.factory.DefaultTranslationLocator"\n+      provides="plone.app.multilingual.interfaces.ITranslationLocator"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n-      provides="plone.app.multilingual.interfaces.ITranslationIdChooser"\n-      factory="plone.app.multilingual.factory.DefaultTranslationIdChooser"/>\n+      />\n   <adapter\n+      factory="plone.app.multilingual.factory.DefaultTranslationIdChooser"\n+      provides="plone.app.multilingual.interfaces.ITranslationIdChooser"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n-      provides="plone.app.multilingual.interfaces.ITranslationCloner"\n-      factory="plone.app.multilingual.factory.DefaultTranslationCloner"/>\n+      />\n   <adapter\n+      factory="plone.app.multilingual.factory.DefaultTranslationCloner"\n+      provides="plone.app.multilingual.interfaces.ITranslationCloner"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n+      />\n+  <adapter\n+      factory="plone.app.multilingual.factory.DefaultTranslationFactory"\n       provides="plone.app.multilingual.interfaces.ITranslationFactory"\n-      factory="plone.app.multilingual.factory.DefaultTranslationFactory"/>\n+      for="plone.app.multilingual.interfaces.ITranslatable"\n+      />\n \n \n   <!-- Dexterity Language Independent fields -->\n@@ -92,69 +113,81 @@\n   <subscriber\n       for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable\n            zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n-      handler="plone.app.multilingual.dx.subscriber.handler"/>\n+      handler="plone.app.multilingual.dx.subscriber.handler"\n+      />\n   <adapter\n-      for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable"\n+      factory="plone.app.multilingual.dx.cloner.Cloner"\n       provides="plone.app.multilingual.interfaces.ITranslationCloner"\n-      factory="plone.app.multilingual.dx.cloner.Cloner"/>\n-  <adapter\n       for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable"\n+      />\n+  <adapter\n+      factory="plone.app.multilingual.dx.cloner.LanguageIndependentFieldsManager"\n       provides="plone.app.multilingual.interfaces.ILanguageIndependentFieldsManager"\n-      factory="plone.app.multilingual.dx.cloner.LanguageIndependentFieldsManager"/>\n+      for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable"\n+      />\n \n \n   <!-- Language independent folder content indexers -->\n   <subscriber\n       for="plone.dexterity.interfaces.IDexterityContent\n            zope.lifecycleevent.interfaces.IObjectMovedEvent"\n-      handler=".subscriber.reindex_language_independent"/>\n+      handler=".subscriber.reindex_language_independent"\n+      />\n \n   <subscriber\n       for="plone.dexterity.interfaces.IDexterityContent\n            zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n-      handler=".subscriber.reindex_language_independent"/>\n+      handler=".subscriber.reindex_language_independent"\n+      />\n \n-   <subscriber\n+  <subscriber\n       for="plone.dexterity.interfaces.IDexterityContent\n            Products.CMFCore.interfaces.IActionSucceededEvent"\n-      handler=".subscriber.reindex_language_independent"/>\n+      handler=".subscriber.reindex_language_independent"\n+      />\n \n   <subscriber\n       for="plone.dexterity.interfaces.IDexterityContent\n            OFS.interfaces.IObjectWillBeMovedEvent"\n-      handler=".subscriber.unindex_language_independent"/>\n+      handler=".subscriber.unindex_language_independent"\n+      />\n \n   <subscriber\n       for="plone.dexterity.interfaces.IDexterityContent\n            OFS.interfaces.IObjectWillBeRemovedEvent"\n-      handler=".subscriber.unindex_language_independent"/>\n+      handler=".subscriber.unindex_language_independent"\n+      />\n \n   <adapter\n+      factory=".content.lrf.LRFNameChooser"\n       provides="zope.container.interfaces.INameChooser"\n       for="plone.app.multilingual.interfaces.ILanguageRootFolder"\n-      factory=".content.lrf.LRFNameChooser"/>\n+      />\n \n   <utility\n       factory=".setuphandlers.HiddenProfiles"\n+      provides="plone.base.interfaces.INonInstallable"\n       name="plone.app.multilingual"\n-      provides="plone.base.interfaces.INonInstallable"/>\n+      />\n \n   <genericsetup:registerProfile\n       name="default"\n       title="Multilingual Support"\n       description="Install to enable multilingual content support with plone.app.multilingual"\n-      directory="profiles/default"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       for="plone.base.interfaces.IPloneSiteRoot"\n-      post_handler=".setuphandlers.init_pam"/>\n+      directory="profiles/default"\n+      post_handler=".setuphandlers.init_pam"\n+      />\n \n   <genericsetup:registerProfile\n       name="uninstall"\n       title="Multilingual Support [uninstall]"\n       description="Uninstall, removes multilingual content support with plone.app.multilingual"\n-      directory="profiles/uninstall"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n-      for="plone.base.interfaces.IPloneSiteRoot"/>\n+      for="plone.base.interfaces.IPloneSiteRoot"\n+      directory="profiles/uninstall"\n+      />\n \n   <genericsetup:importStep\n       name="plone.app.multilingual_default"\n@@ -167,6 +200,7 @@\n       name="plone.app.multilingual_uninstall"\n       title="plone.app.multilingual uninstall"\n       description=""\n-      handler=".setuphandlers.step_uninstall_various"/>\n+      handler=".setuphandlers.step_uninstall_various"\n+      />\n \n </configure>\ndiff --git a/src/plone/app/multilingual/content/lif.xml b/src/plone/app/multilingual/content/lif.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/src/plone/app/multilingual/content/lif.xml\n+++ b/src/plone/app/multilingual/content/lif.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/src/plone/app/multilingual/content/lrf.xml b/src/plone/app/multilingual/content/lrf.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/src/plone/app/multilingual/content/lrf.xml\n+++ b/src/plone/app/multilingual/content/lrf.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/src/plone/app/multilingual/dx/configure.zcml b/src/plone/app/multilingual/dx/configure.zcml\nindex 9d4e60c32..349fea424 100644\n--- a/src/plone/app/multilingual/dx/configure.zcml\n+++ b/src/plone/app/multilingual/dx/configure.zcml\n@@ -3,75 +3,86 @@\n     xmlns:five="http://namespaces.zope.org/five"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n   <include file="meta.zcml" />\n \n   <!-- Configure plone.schemaeditor adapter -->\n   <adapter\n+      factory=".schemaeditor.get_li_schema"\n       provides="plone.schemaeditor.interfaces.IFieldEditorExtender"\n       for="zope.schema.interfaces.IField"\n       name="plone.schemaeditor.languageindependent"\n-      factory=".schemaeditor.get_li_schema"/>\n+      />\n \n   <adapter\n+      factory=".schemaeditor.FieldLanguageIndependentAdapter"\n       provides=".schemaeditor.IFieldLanguageIndependent"\n       for="zope.schema.interfaces.IField"\n-      factory=".schemaeditor.FieldLanguageIndependentAdapter"/>\n+      />\n \n \n   <!-- Configure plone.supermodel handler -->\n   <utility\n       factory=".supermodel.LanguageIndependentFieldMetadataHandler"\n-      name="plone.rfc822.lingua"/>\n+      name="plone.rfc822.lingua"\n+      />\n \n   <adapter\n       factory=".directives.LanguageIndependentFieldsPlugin"\n-      name="plone.rfc822.lingua"/>\n+      name="plone.rfc822.lingua"\n+      />\n \n \n   <plone:behavior\n+      name="plone.translatable"\n       title="Multilingual Support"\n       description="Make this content type multilingual aware"\n-      name="plone.translatable"\n-      provides=".interfaces.IDexterityTranslatable"/>\n+      provides=".interfaces.IDexterityTranslatable"\n+      />\n \n   <adapter\n-      for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable"\n+      factory=".cloner.LanguageIndependentFieldsManager"\n       provides="plone.app.multilingual.interfaces.ILanguageIndependentFieldsManager"\n-      factory=".cloner.LanguageIndependentFieldsManager"/>\n+      for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable"\n+      />\n \n   <adapter\n-      for="plone.dexterity.interfaces.IDexterityContent"\n+      factory=".language.Language"\n       provides="plone.base.interfaces.ILanguage"\n-      factory=".language.Language"/>\n+      for="plone.dexterity.interfaces.IDexterityContent"\n+      />\n \n   <adapter\n+      factory=".form.AddingLanguageIndependentValue"\n       for="*\n            *\n            plone.app.multilingual.dx.interfaces.IMultilingualAddForm\n            plone.app.multilingual.dx.interfaces.ILanguageIndependentField\n            z3c.form.interfaces.IWidget"\n-      factory=".form.AddingLanguageIndependentValue"\n-      name="default"/>\n+      name="default"\n+      />\n \n   <adapter\n+      factory=".form.LanguageIndependentFieldValidator"\n+      provides="z3c.form.interfaces.IValidator"\n       for="*\n            plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled\n            plone.app.multilingual.dx.interfaces.IMultilingualAddForm\n            plone.app.multilingual.dx.interfaces.ILanguageIndependentField\n            *"\n-      provides="z3c.form.interfaces.IValidator"\n-      factory=".form.LanguageIndependentFieldValidator"/>\n+      />\n \n   <adapter\n+      factory=".form.LanguageIndependentFieldInputTemplate"\n+      provides="zope.pagetemplate.interfaces.IPageTemplate"\n       for="*\n            plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled\n            plone.app.multilingual.dx.interfaces.IMultilingualAddForm\n            plone.app.multilingual.dx.interfaces.ILanguageIndependentField\n            *"\n-      provides="zope.pagetemplate.interfaces.IPageTemplate"\n       name="input"\n-      factory=".form.LanguageIndependentFieldInputTemplate"/>\n+      />\n \n </configure>\ndiff --git a/src/plone/app/multilingual/dx/meta.zcml b/src/plone/app/multilingual/dx/meta.zcml\nindex 6db436c14..c9a466370 100644\n--- a/src/plone/app/multilingual/dx/meta.zcml\n+++ b/src/plone/app/multilingual/dx/meta.zcml\n@@ -1,3 +1,6 @@\n <configure xmlns="http://namespaces.zope.org/zope">\n-  <include package="plone.behavior" file="meta.zcml" />\n+  <include\n+      package="plone.behavior"\n+      file="meta.zcml"\n+      />\n </configure>\ndiff --git a/src/plone/app/multilingual/overrides.zcml b/src/plone/app/multilingual/overrides.zcml\nindex 03adc3980..652051279 100644\n--- a/src/plone/app/multilingual/overrides.zcml\n+++ b/src/plone/app/multilingual/overrides.zcml\n@@ -1,6 +1,8 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-    i18n_domain="plone">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    i18n_domain="plone"\n+    >\n \n-  <adapter factory=".shared_uuid.attributeUUID"/>\n+  <adapter factory=".shared_uuid.attributeUUID" />\n \n </configure>\ndiff --git a/src/plone/app/multilingual/permissions.zcml b/src/plone/app/multilingual/permissions.zcml\nindex ce04d5479..696f40078 100644\n--- a/src/plone/app/multilingual/permissions.zcml\n+++ b/src/plone/app/multilingual/permissions.zcml\n@@ -1,8 +1,11 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-    i18n_domain="plone">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    i18n_domain="plone"\n+    >\n \n   <permission\n       id="plone.app.multilingual.ManageTranslations"\n-      title="plone.app.multilingual: Manage Translations"/>\n+      title="plone.app.multilingual: Manage Translations"\n+      />\n \n </configure>\ndiff --git a/src/plone/app/multilingual/profiles/default/browserlayer.xml b/src/plone/app/multilingual/profiles/default/browserlayer.xml\nindex 40f722a1f..9b9054d01 100644\n--- a/src/plone/app/multilingual/profiles/default/browserlayer.xml\n+++ b/src/plone/app/multilingual/profiles/default/browserlayer.xml\n@@ -1,5 +1,6 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <layers>\n-  <layer\n-      name="plone.app.multilingual"\n-      interface="plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled"/>\n+  <layer interface="plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled"\n+         name="plone.app.multilingual"\n+  />\n </layers>\ndiff --git a/src/plone/app/multilingual/profiles/default/catalog.xml b/src/plone/app/multilingual/profiles/default/catalog.xml\nindex 24f690fa9..e8d4b91ba 100644\n--- a/src/plone/app/multilingual/profiles/default/catalog.xml\n+++ b/src/plone/app/multilingual/profiles/default/catalog.xml\n@@ -1,14 +1,20 @@\n-<?xml version="1.0"?>\n-<object name="portal_catalog" meta_type="Plone Catalog Tool">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Catalog Tool"\n+        name="portal_catalog"\n+>\n \n-  <index name="Language" meta_type="FieldIndex">\n-    <indexed_attr value="Language"/>\n+  <index meta_type="FieldIndex"\n+         name="Language"\n+  >\n+    <indexed_attr value="Language" />\n   </index>\n-  <column value="Language"/>\n+  <column value="Language" />\n \n-  <index name="TranslationGroup" meta_type="FieldIndex">\n-    <indexed_attr value="TranslationGroup"/>\n+  <index meta_type="FieldIndex"\n+         name="TranslationGroup"\n+  >\n+    <indexed_attr value="TranslationGroup" />\n   </index>\n-  <column value="TranslationGroup"/>\n+  <column value="TranslationGroup" />\n \n </object>\ndiff --git a/src/plone/app/multilingual/profiles/default/metadata.xml b/src/plone/app/multilingual/profiles/default/metadata.xml\nindex f13799b6d..d7e94be60 100644\n--- a/src/plone/app/multilingual/profiles/default/metadata.xml\n+++ b/src/plone/app/multilingual/profiles/default/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>1001</version>\n   <dependencies>\ndiff --git a/src/plone/app/multilingual/profiles/default/reference_catalog.xml b/src/plone/app/multilingual/profiles/default/reference_catalog.xml\nindex e3427c17a..ed3243a09 100644\n--- a/src/plone/app/multilingual/profiles/default/reference_catalog.xml\n+++ b/src/plone/app/multilingual/profiles/default/reference_catalog.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="reference_catalog">\n   <column value="Language" />\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/default/registry.xml b/src/plone/app/multilingual/profiles/default/registry.xml\nindex d10517d7f..9df569696 100644\n--- a/src/plone/app/multilingual/profiles/default/registry.xml\n+++ b/src/plone/app/multilingual/profiles/default/registry.xml\n@@ -1,29 +1,38 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n \n-  <records prefix="plone.bundles/multilingual"\n-            interface=\'plone.base.interfaces.IBundleRegistry\'>\n+  <records interface="plone.base.interfaces.IBundleRegistry"\n+           prefix="plone.bundles/multilingual"\n+  >\n     <value key="enabled">True</value>\n     <value key="csscompilation">++resource++plone.app.multilingual.stylesheet/multilingual.css</value>\n   </records>\n \n-  <records interface="plone.base.interfaces.ITinyMCEResourceTypesSchema" prefix="plone">\n-    <value key="contains_objects" purge="false"><element>LIF</element></value>\n+  <records interface="plone.base.interfaces.ITinyMCEResourceTypesSchema"\n+           prefix="plone"\n+  >\n+    <value key="contains_objects"\n+           purge="false"\n+    ><element>LIF</element></value>\n   </records>\n \n-  <records interface="plone.i18n.interfaces.ILanguageSchema" prefix="plone">\n+  <records interface="plone.i18n.interfaces.ILanguageSchema"\n+           prefix="plone"\n+  >\n     <value key="use_cookie_negotiation">True</value>\n     <value key="use_request_negotiation">False</value>\n     <value key="use_content_negotiation">True</value>\n     <value key="display_flags">False</value>\n   </records>\n \n-  <records interface="plone.app.multilingual.interfaces.IMultiLanguageExtraOptionsSchema" prefix="plone">\n+  <records interface="plone.app.multilingual.interfaces.IMultiLanguageExtraOptionsSchema"\n+           prefix="plone"\n+  >\n     <value key="filter_content">True</value>\n     <value key="redirect_babel_view">True</value>\n     <value key="bypass_languageindependent_field_permission_check">False</value>\n     <value key="buttons_babel_view_up_to_nr_translations">7</value>\n-    <value key="google_translation_key"></value>\n+    <value key="google_translation_key" />\n     <value key="selector_lookup_translations_policy">closest</value>\n   </records>\n \ndiff --git a/src/plone/app/multilingual/profiles/default/rolemap.xml b/src/plone/app/multilingual/profiles/default/rolemap.xml\nindex 3830837d0..b6186286d 100644\n--- a/src/plone/app/multilingual/profiles/default/rolemap.xml\n+++ b/src/plone/app/multilingual/profiles/default/rolemap.xml\n@@ -1,11 +1,13 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <rolemap>\n   <permissions>\n-    <permission name="plone.app.multilingual: Manage Translations" acquire="True">\n-      <role name="Manager"/>\n-      <role name="Site Administrator"/>\n-      <role name="Owner"/>\n-      <role name="Editor"/>\n+    <permission acquire="True"\n+                name="plone.app.multilingual: Manage Translations"\n+    >\n+      <role name="Manager" />\n+      <role name="Site Administrator" />\n+      <role name="Owner" />\n+      <role name="Editor" />\n     </permission>\n   </permissions>\n </rolemap>\ndiff --git a/src/plone/app/multilingual/profiles/default/types.xml b/src/plone/app/multilingual/profiles/default/types.xml\nindex cfc6565fd..530ca0f36 100644\n--- a/src/plone/app/multilingual/profiles/default/types.xml\n+++ b/src/plone/app/multilingual/profiles/default/types.xml\n@@ -1,5 +1,11 @@\n-<?xml version="1.0"?>\n-<object meta_type="Plone Types Tool" name="portal_types">\n-  <object meta_type="Dexterity FTI" name="LRF" />\n-  <object meta_type="Dexterity FTI" name="LIF" />\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n+  <object meta_type="Dexterity FTI"\n+          name="LRF"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="LIF"\n+  />\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/default/types/LIF.xml b/src/plone/app/multilingual/profiles/default/types/LIF.xml\nindex fecf15653..bcb60e361 100644\n--- a/src/plone/app/multilingual/profiles/default/types/LIF.xml\n+++ b/src/plone/app/multilingual/profiles/default/types/LIF.xml\n@@ -1,49 +1,79 @@\n-<?xml version="1.0"?>\n-<object name="LIF" meta_type="Dexterity FTI" i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n-  <property name="title" i18n:translate="">Language Independent Folder</property>\n-  <property name="description" i18n:translate=""></property>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="LIF"\n+        i18n:domain="plone"\n+>\n+  <property name="title"\n+            i18n:translate=""\n+  >Language Independent Folder</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n   <property name="icon_expr">string:contenttype/folder</property>\n   <property name="factory">LIF</property>\n   <property name="add_view_expr">string:${folder_url}/++add++LIF</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n   <property name="immediate_view">view</property>\n   <property name="global_allow">False</property>\n   <property name="filter_content_types">False</property>\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="allow_discussion">False</property>\n   <property name="default_view">folder_listing</property>\n   <property name="view_methods">\n-    <element value="summary_view"/>\n-    <element value="full_view"/>\n-    <element value="tabular_view"/>\n-    <element value="album_view"/>\n-    <element value="folder_listing"/>\n+    <element value="summary_view" />\n+    <element value="full_view" />\n+    <element value="tabular_view" />\n+    <element value="album_view" />\n+    <element value="folder_listing" />\n   </property>\n   <property name="default_view_fallback">False</property>\n   <property name="add_permission">cmf.ManagePortal</property>\n   <property name="klass">plone.dexterity.content.Container</property>\n   <property name="behaviors">\n-    <element value="plone.dublincore"/>\n-    <element value="plone.namefromtitle"/>\n-    <element value="plone.constraintypes"/>\n+    <element value="plone.dublincore" />\n+    <element value="plone.namefromtitle" />\n+    <element value="plone.constraintypes" />\n     <element value="plone.translatable" />\n-    <element value="plone.excludefromnavigation"/>\n+    <element value="plone.excludefromnavigation" />\n   </property>\n   <property name="schema">plone.app.multilingual.interfaces.ILanguageIndependentFolder</property>\n-  <property name="model_source"></property>\n+  <property name="model_source" />\n   <property name="model_file">plone.app.multilingual.content:lif.xml</property>\n-  <alias from="(Default)" to="(dynamic view)"/>\n-  <alias from="edit" to="@@edit"/>\n-  <alias from="sharing" to="@@sharing"/>\n-  <alias from="view" to="(selected layout)"/>\n-  <action title="View" action_id="view" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/view" link_target="" url_expr="string:${object_url}"\n-      visible="True" i18n:attributes="title">\n-    <permission value="View"/>\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n+  />\n+  <alias from="edit"\n+         to="@@edit"\n+  />\n+  <alias from="sharing"\n+         to="@@sharing"\n+  />\n+  <alias from="view"\n+         to="(selected layout)"\n+  />\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          link_target=""\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action title="Edit" action_id="edit" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/edit" link_target="" url_expr="string:${object_url}/edit"\n-      visible="True" i18n:attributes="title">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          link_target=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/default/types/LRF.xml b/src/plone/app/multilingual/profiles/default/types/LRF.xml\nindex 66fb65679..d069fba1e 100644\n--- a/src/plone/app/multilingual/profiles/default/types/LRF.xml\n+++ b/src/plone/app/multilingual/profiles/default/types/LRF.xml\n@@ -1,50 +1,80 @@\n-<?xml version="1.0"?>\n-<object name="LRF" meta_type="Dexterity FTI" i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n-  <property name="title" i18n:translate="">Language Root Folder</property>\n-  <property name="description" i18n:translate=""></property>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="LRF"\n+        i18n:domain="plone"\n+>\n+  <property name="title"\n+            i18n:translate=""\n+  >Language Root Folder</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n   <property name="icon_expr">string:contenttype/folder</property>\n   <property name="factory">LRF</property>\n   <property name="add_view_expr">string:${folder_url}/++add++LRF</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n   <property name="immediate_view">view</property>\n   <property name="global_allow">False</property>\n   <property name="filter_content_types">False</property>\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="allow_discussion">False</property>\n   <property name="default_view">folder_listing</property>\n   <property name="view_methods">\n-    <element value="summary_view"/>\n-    <element value="full_view"/>\n-    <element value="tabular_view"/>\n-    <element value="album_view"/>\n-    <element value="folder_listing"/>\n+    <element value="summary_view" />\n+    <element value="full_view" />\n+    <element value="tabular_view" />\n+    <element value="album_view" />\n+    <element value="folder_listing" />\n   </property>\n   <property name="default_view_fallback">False</property>\n   <property name="add_permission">cmf.ManagePortal</property>\n   <property name="klass">plone.dexterity.content.Container</property>\n   <property name="behaviors">\n-    <element value="plone.dublincore"/>\n-    <element value="plone.namefromtitle"/>\n-    <element value="plone.constraintypes"/>\n+    <element value="plone.dublincore" />\n+    <element value="plone.namefromtitle" />\n+    <element value="plone.constraintypes" />\n     <element value="plone.translatable" />\n-    <element value="plone.excludefromnavigation"/>\n-    <element value="plone.navigationroot"/>\n+    <element value="plone.excludefromnavigation" />\n+    <element value="plone.navigationroot" />\n   </property>\n   <property name="schema">plone.app.multilingual.interfaces.ILanguageRootFolder</property>\n-  <property name="model_source"></property>\n+  <property name="model_source" />\n   <property name="model_file">plone.app.multilingual.content:lrf.xml</property>\n-  <alias from="(Default)" to="(dynamic view)"/>\n-  <alias from="edit" to="@@edit"/>\n-  <alias from="sharing" to="@@sharing"/>\n-  <alias from="view" to="(selected layout)"/>\n-  <action title="View" action_id="view" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/view" link_target="" url_expr="string:${object_url}"\n-      visible="True" i18n:attributes="title">\n-    <permission value="View"/>\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n+  />\n+  <alias from="edit"\n+         to="@@edit"\n+  />\n+  <alias from="sharing"\n+         to="@@sharing"\n+  />\n+  <alias from="view"\n+         to="(selected layout)"\n+  />\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          link_target=""\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action title="Edit" action_id="edit" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/edit" link_target="" url_expr="string:${object_url}/edit"\n-      visible="True" i18n:attributes="title">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          link_target=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/default/viewlets.xml b/src/plone/app/multilingual/profiles/default/viewlets.xml\nindex c7741b9fc..fde5c1cce 100644\n--- a/src/plone/app/multilingual/profiles/default/viewlets.xml\n+++ b/src/plone/app/multilingual/profiles/default/viewlets.xml\n@@ -1,9 +1,15 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object>\n-  <hidden manager="plone.portalheader" skinname="Plone Default">\n+  <hidden manager="plone.portalheader"\n+          skinname="Plone Default"\n+  >\n     <viewlet name="plone.app.i18n.locales.languageselector" />\n   </hidden>\n-  <order manager="plone.portalheader" skinname="Plone Default">\n-    <viewlet name="plone.app.multilingual.languageselector" insert-after="plone.personal_bar" />\n+  <order manager="plone.portalheader"\n+         skinname="Plone Default"\n+  >\n+    <viewlet insert-after="plone.personal_bar"\n+             name="plone.app.multilingual.languageselector"\n+    />\n   </order>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/browserlayer.xml b/src/plone/app/multilingual/profiles/uninstall/browserlayer.xml\nindex 35468acbf..5fd0d5643 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/browserlayer.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/browserlayer.xml\n@@ -1,3 +1,7 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <layers>\n-  <layer remove="True" name="plone.app.multilingual" interface="plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled"/>\n+  <layer interface="plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled"\n+         name="plone.app.multilingual"\n+         remove="True"\n+  />\n </layers>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/catalog.xml b/src/plone/app/multilingual/profiles/uninstall/catalog.xml\nindex a73e51c13..2f1cfc30c 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/catalog.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/catalog.xml\n@@ -1,7 +1,19 @@\n-<?xml version="1.0"?>\n-<object name="portal_catalog" meta_type="Plone Catalog Tool">\n-  <index remove="True" name="Language" meta_type="FieldIndex"/>\n-  <column remove="True" value="Language"/>\n-  <index remove="True" name="TranslationGroup" meta_type="FieldIndex"/>\n-  <column remove="True" value="TranslationGroup"/>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Catalog Tool"\n+        name="portal_catalog"\n+>\n+  <index meta_type="FieldIndex"\n+         name="Language"\n+         remove="True"\n+  />\n+  <column remove="True"\n+          value="Language"\n+  />\n+  <index meta_type="FieldIndex"\n+         name="TranslationGroup"\n+         remove="True"\n+  />\n+  <column remove="True"\n+          value="TranslationGroup"\n+  />\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/cssregistry.xml b/src/plone/app/multilingual/profiles/uninstall/cssregistry.xml\nindex f5e4e306e..e47879c26 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/cssregistry.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/cssregistry.xml\n@@ -1,4 +1,6 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="portal_css">\n-  <stylesheet remove="True" id="++resource++plone.app.multilingual.stylesheet/multilingual.css"/>\n+  <stylesheet id="++resource++plone.app.multilingual.stylesheet/multilingual.css"\n+              remove="True"\n+  />\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/metadata.xml b/src/plone/app/multilingual/profiles/uninstall/metadata.xml\nindex a44cc3495..dbfd3b42e 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/metadata.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>3</version>\n </metadata>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/reference_catalog.xml b/src/plone/app/multilingual/profiles/uninstall/reference_catalog.xml\nindex 133f9d6fb..4d821c905 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/reference_catalog.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/reference_catalog.xml\n@@ -1,5 +1,6 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="reference_catalog">\n-  <column remove="True" value="Language" />\n+  <column remove="True"\n+          value="Language"\n+  />\n </object>\n-\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/types.xml b/src/plone/app/multilingual/profiles/uninstall/types.xml\nindex 3ca476694..acf1aabcb 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/types.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/types.xml\n@@ -1,4 +1,9 @@\n-<?xml version="1.0"?>\n-<object meta_type="Plone Types Tool" name="portal_types">\n-  <object remove="True" meta_type="Dexterity FTI" name="LRF" />\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n+  <object meta_type="Dexterity FTI"\n+          name="LRF"\n+          remove="True"\n+  />\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/viewlets.xml b/src/plone/app/multilingual/profiles/uninstall/viewlets.xml\nindex d54997576..ea57ceebf 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/viewlets.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/viewlets.xml\n@@ -1,10 +1,14 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object>\n-  <hidden manager="plone.portalheader" skinname="Plone Default">\n-    <viewlet name="plone.app.multilingual.languageselector"/>\n+  <hidden manager="plone.portalheader"\n+          skinname="Plone Default"\n+  >\n+    <viewlet name="plone.app.multilingual.languageselector" />\n   </hidden>\n \n-  <order manager="plone.portalheader" skinname="Plone Default">\n-    <viewlet name="plone.app.i18n.locales.languageselector"/>\n+  <order manager="plone.portalheader"\n+         skinname="Plone Default"\n+  >\n+    <viewlet name="plone.app.i18n.locales.languageselector" />\n   </order>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LIF.xml b/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LIF.xml\nindex 0a678610e..4ca397e0a 100644\n--- a/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LIF.xml\n+++ b/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LIF.xml\n@@ -1,15 +1,35 @@\n-<?xml version="1.0"?>\n-<object name="LIF" meta_type="Dexterity FTI" i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n-  <property name="title" i18n:translate="">Language Independent Folder</property>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="LIF"\n+        i18n:domain="plone"\n+>\n+  <property name="title"\n+            i18n:translate=""\n+  >Language Independent Folder</property>\n   <property name="icon_expr">string:contenttype/folder</property>\n-  <action title="View" action_id="view" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/view" link_target="" url_expr="string:${object_url}"\n-      visible="True" i18n:attributes="title">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          link_target=""\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action title="Edit" action_id="edit" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/edit" link_target="" url_expr="string:${object_url}/edit"\n-      visible="True" i18n:attributes="title">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          link_target=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LRF.xml b/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LRF.xml\nindex f411d40b9..2e14f3727 100644\n--- a/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LRF.xml\n+++ b/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LRF.xml\n@@ -1,15 +1,35 @@\n-<?xml version="1.0"?>\n-<object name="LRF" meta_type="Dexterity FTI" i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n-  <property name="title" i18n:translate="">Language Root Folder</property>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="LRF"\n+        i18n:domain="plone"\n+>\n+  <property name="title"\n+            i18n:translate=""\n+  >Language Root Folder</property>\n   <property name="icon_expr">string:contenttype/folder</property>\n-  <action title="View" action_id="view" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/view" link_target="" url_expr="string:${object_url}"\n-      visible="True" i18n:attributes="title">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          link_target=""\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action title="Edit" action_id="edit" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/edit" link_target="" url_expr="string:${object_url}/edit"\n-      visible="True" i18n:attributes="title">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          link_target=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/upgrades/to_3/registry.xml b/src/plone/app/multilingual/profiles/upgrades/to_3/registry.xml\nindex a719a89b2..a7a1f8a00 100644\n--- a/src/plone/app/multilingual/profiles/upgrades/to_3/registry.xml\n+++ b/src/plone/app/multilingual/profiles/upgrades/to_3/registry.xml\n@@ -1,7 +1,8 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n- <records interface="plone.app.multilingual.interfaces.IMultiLanguageExtraOptionsSchema"\n-          prefix="plone">\n+  <records interface="plone.app.multilingual.interfaces.IMultiLanguageExtraOptionsSchema"\n+           prefix="plone"\n+  >\n     <value key="bypass_languageindependent_field_permission_check">False</value>\n- </records>\n+  </records>\n </registry>\ndiff --git a/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml b/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\nindex 9f9fe2c53..70f8c0527 100644\n--- a/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\n+++ b/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\n@@ -1,21 +1,25 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n \n   <!-- remove old resource and bundle registration -->\n-  <record name="plone.bundles/plone-legacy.resources"\n-          interface="plone.base.interfaces.resources.IBundleRegistry" field="resources">\n+  <record field="resources"\n+          interface="plone.base.interfaces.resources.IBundleRegistry"\n+          name="plone.bundles/plone-legacy.resources"\n+  >\n     <value purge="false">\n       <element remove="true">multilingual</element>\n     </value>\n   </record>\n-  <records prefix="plone.resources/multilingual"\n-           interface=\'plone.base.interfaces.IResourceRegistry\'\n-           remove="true">\n-  </records>\n+  <records interface="plone.base.interfaces.IResourceRegistry"\n+           prefix="plone.resources/multilingual"\n+           remove="true"\n+  >\n+</records>\n \n   <!-- register new bundle -->\n-  <records prefix="plone.bundles/multilingual"\n-            interface=\'plone.base.interfaces.IBundleRegistry\'>\n+  <records interface="plone.base.interfaces.IBundleRegistry"\n+           prefix="plone.bundles/multilingual"\n+  >\n     <value key="enabled">True</value>\n     <value key="compile">False</value>\n     <value key="merge_with">logged-in</value>\ndiff --git a/src/plone/app/multilingual/testing.zcml b/src/plone/app/multilingual/testing.zcml\nindex c49356db6..ae4fbf82a 100644\n--- a/src/plone/app/multilingual/testing.zcml\n+++ b/src/plone/app/multilingual/testing.zcml\n@@ -1,6 +1,7 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n   <include file="configure.zcml" />\n   <include package="plone.app.contenttypes" />\ndiff --git a/src/plone/app/multilingual/upgrades.zcml b/src/plone/app/multilingual/upgrades.zcml\nindex b3fa54437..9396c830f 100644\n--- a/src/plone/app/multilingual/upgrades.zcml\n+++ b/src/plone/app/multilingual/upgrades.zcml\n@@ -1,80 +1,86 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n   <genericsetup:upgradeStep\n-      source="1"\n-      destination="2"\n       title="Update css_registry to render styles for authenticated users only."\n       description=""\n       profile="plone.app.multilingual:default"\n+      source="1"\n+      destination="2"\n       handler=".upgrades.reimport_css_registry"\n       />\n \n   <genericsetup:upgradeStep\n       title="Migration for new LRF type"\n       description="Rename old language folders and copy content into new LRF. Migrate shared folder to portal root."\n+      profile="plone.app.multilingual:default"\n       source="1"\n       destination="2"\n       handler="plone.app.multilingual.upgrades.migration_pam_1_to_2"\n-      profile="plone.app.multilingual:default"/>\n+      />\n \n   <genericsetup:registerProfile\n       name="to_3"\n       title="Update new registry key"\n-      directory="profiles/upgrades/to_3"\n-      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/upgrades/to_3"\n       />\n \n   <genericsetup:upgradeStep\n+      title="Add new registry entry"\n       profile="plone.app.multilingual:default"\n       source="2"\n       destination="3"\n-      title="Add new registry entry"\n       handler=".upgrades.upgrade_to_3"\n       />\n \n   <genericsetup:registerProfile\n       name="to_4"\n       title="Update bundle registration"\n-      directory="profiles/upgrades/to_4"\n-      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/upgrades/to_4"\n       />\n \n   <genericsetup:upgradeStep\n+      title="Update bundle registration"\n       profile="plone.app.multilingual:default"\n       source="3"\n       destination="4"\n-      title="Update bundle registration"\n       handler=".upgrades.upgrade_to_4"\n       />\n \n   <genericsetup:registerProfile\n       name="to_1000"\n       title="Update to 1000"\n-      directory="profiles/upgrades/to_1000"\n-      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/upgrades/to_1000"\n       />\n \n-  <genericsetup:upgradeSteps source="4"\n+  <genericsetup:upgradeSteps\n+      profile="plone.app.multilingual:default"\n+      source="4"\n       destination="1000"\n-      profile="plone.app.multilingual:default">\n+      >\n \n-      <genericsetup:upgradeDepends\n+    <genericsetup:upgradeDepends\n         title="Add icon expressions"\n-        import_profile="plone.app.multilingual:to_1000" />\n+        import_profile="plone.app.multilingual:to_1000"\n+        />\n \n   </genericsetup:upgradeSteps>\n \n   <genericsetup:upgradeStep\n+      title="Update old layouts"\n+      profile="plone.app.multilingual:default"\n       source="1000"\n       destination="1001"\n-      profile="plone.app.multilingual:default"\n-      title="Update old layouts"\n-      handler=".upgrades.update_old_layouts" />\n+      handler=".upgrades.update_old_layouts"\n+      />\n \n </configure>\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:04:49+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/749901abb14ea6c6f0067bfa1095c8d2f185a41e

chore: zpretty PT

Files changed:
M src/plone/app/multilingual/browser/templates/add-form-is-translation.pt
M src/plone/app/multilingual/browser/templates/alternate-languages.pt
M src/plone/app/multilingual/browser/templates/cleanup.pt
M src/plone/app/multilingual/browser/templates/cleanup_results.pt
M src/plone/app/multilingual/browser/templates/controlpanel.pt
M src/plone/app/multilingual/browser/templates/dexterity_edit.pt
M src/plone/app/multilingual/browser/templates/disconnect_translation.pt
M src/plone/app/multilingual/browser/templates/dx_babel_view.pt
M src/plone/app/multilingual/browser/templates/languages-notice.pt
M src/plone/app/multilingual/browser/templates/languageselector.pt
M src/plone/app/multilingual/browser/templates/migration.pt
M src/plone/app/multilingual/browser/templates/migrator-results.pt
M src/plone/app/multilingual/browser/templates/mmap.pt
M src/plone/app/multilingual/browser/templates/modify_translations.pt
M src/plone/app/multilingual/browser/templates/not_translated_yet.pt
M src/plone/app/multilingual/browser/templates/reindex-results.pt
M src/plone/app/multilingual/browser/templates/relocate-results.pt

b'diff --git a/src/plone/app/multilingual/browser/templates/add-form-is-translation.pt b/src/plone/app/multilingual/browser/templates/add-form-is-translation.pt\nindex 67af4856..cbe21604 100644\n--- a/src/plone/app/multilingual/browser/templates/add-form-is-translation.pt\n+++ b/src/plone/app/multilingual/browser/templates/add-form-is-translation.pt\n@@ -1,27 +1,46 @@\n <div class="container">\n-    <div class="row">\n-        <div class="alert alert-info col-12" role="alert">\n-            <strong i18n:translate="" i18n:domain="plone">\n+  <div class="row">\n+    <div class="alert alert-info col-12"\n+         role="alert"\n+    >\n+      <strong i18n:domain="plone"\n+              i18n:translate=""\n+      >\n                 Info\n-            </strong>\n-            <tal:block i18n:domain="plone"\n-                     i18n:translate="add-form-is-translation">\n+      </strong>\n+      <tal:block i18n:domain="plone"\n+                 i18n:translate="add-form-is-translation"\n+      >\n                 This object is going to be a translation to\n-                <span i18n:name="language" tal:replace="python:view.language_name(view.language())"></span>\n+        <span tal:replace="python:view.language_name(view.language())"\n+              i18n:name="language"\n+        ></span>\n                 from:\n-            </tal:block>\n-            <ul>\n-                <li tal:repeat="origin view/origin">\n-                    <span tal:content="python:view.language_name(origin.Language)"></span>:\n-                    <a href="#"\n-                       class="link-overlay" tal:attributes="href origin/getURL">\n-                        <span tal:content="origin/Title"></span></a></li>\n-            </ul>\n-            <span i18n:domain="plone" i18n:translate="create-object-without-translation">\n+      </tal:block>\n+      <ul>\n+        <li tal:repeat="origin view/origin">\n+          <span tal:content="python:view.language_name(origin.Language)"></span>:\n+          <a class="link-overlay"\n+             href="#"\n+             tal:attributes="\n+               href origin/getURL;\n+             "\n+          >\n+            <span tal:content="origin/Title"></span></a></li>\n+      </ul>\n+      <span i18n:domain="plone"\n+            i18n:translate="create-object-without-translation"\n+      >\n       If you want to create this object without being a translation press\n-      <a href="#"\n-         class="link-overlay" i18n:name="url" tal:attributes="href view/returnURL" i18n:translate="">here</a>\n-    </span>\n-        </div>\n+        <a class="link-overlay"\n+           href="#"\n+           tal:attributes="\n+             href view/returnURL;\n+           "\n+           i18n:name="url"\n+           i18n:translate=""\n+        >here</a>\n+      </span>\n     </div>\n+  </div>\n </div>\ndiff --git a/src/plone/app/multilingual/browser/templates/alternate-languages.pt b/src/plone/app/multilingual/browser/templates/alternate-languages.pt\nindex 7196b960..1f327b2d 100644\n--- a/src/plone/app/multilingual/browser/templates/alternate-languages.pt\n+++ b/src/plone/app/multilingual/browser/templates/alternate-languages.pt\n@@ -1,4 +1,7 @@\n <link rel="alternate"\n       tal:repeat="item view/alternates"\n-      tal:attributes="hreflang item/lang;\n-                      href string:${item/url}" />\n+      tal:attributes="\n+        hreflang item/lang;\n+        href string:${item/url};\n+      "\n+/>\ndiff --git a/src/plone/app/multilingual/browser/templates/cleanup.pt b/src/plone/app/multilingual/browser/templates/cleanup.pt\nindex 3bc12e19..6fa39935 100644\n--- a/src/plone/app/multilingual/browser/templates/cleanup.pt\n+++ b/src/plone/app/multilingual/browser/templates/cleanup.pt\n@@ -1,16 +1,18 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:block metal:fill-slot="prefs_configlet_main">\n+    <metal:block metal:fill-slot="prefs_configlet_main">\n \n-<script type="text/javascript">\n+      <script type="text/javascript">\n (function($) {\n \n     $().ready(function() {\n@@ -29,83 +31,101 @@\n     });\n \n })(jQuery);\n-</script>\n+      </script>\n \n \n-    <div i18n:domain="plone">\n-        <ul class="contentViews" id="content-views">\n+      <div i18n:domain="plone">\n+        <ul class="contentViews"\n+            id="content-views"\n+        >\n           <li>\n             <a href=""\n-               tal:attributes="href string:${portal_url}/@@language-controlpanel"\n-               i18n:translate="label_general">General</a>\n+               tal:attributes="\n+                 href string:${portal_url}/@@language-controlpanel;\n+               "\n+               i18n:translate="label_general"\n+            >General</a>\n           </li>\n           <li>\n             <a href=""\n-               tal:attributes="href string:${portal_url}/@@multilingual-map"\n-               i18n:translate="label_translation_map">Translation Map</a>\n+               tal:attributes="\n+                 href string:${portal_url}/@@multilingual-map;\n+               "\n+               i18n:translate="label_translation_map"\n+            >Translation Map</a>\n           </li>\n           <li class="selected">\n             <a href=""\n-              tal:attributes="href string:${portal_url}/@@lp-migration-after"\n-              i18n:translate="label_cleanup">Cleanup actions</a>\n+               tal:attributes="\n+                 href string:${portal_url}/@@lp-migration-after;\n+               "\n+               i18n:translate="label_cleanup"\n+            >Cleanup actions</a>\n           </li>\n         </ul>\n-    </div>\n+      </div>\n \n \n-        <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n         Portal status message\n-        </div>\n+      </div>\n \n-        <div class="content-core">\n+      <div class="content-core">\n \n-            <h1 class="documentFirstHeading"\n-                i18n:domain="plone"\n-                i18n:translate="heading_migration_after">Products.LinguaPlone After Migration</h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:domain="plone"\n+            i18n:translate="heading_migration_after"\n+        >Products.LinguaPlone After Migration</h1>\n \n-            <p i18n:translate="description_migrate_after"\n-              i18n:domain="plone">\n+        <p i18n:domain="plone"\n+           i18n:translate="description_migrate_after"\n+        >\n                 It can happen that there are relations left that contain\n                 LinguaPlone relations. By executing this step, the catalog\n                 gets reset and rebuilt. It CAN happen that things go bad.\n                 In that case relations get lost. It is therefor important that\n                 you have a backup!\n-            </p>\n-\n-            <form name="cleanup" tal:attributes="action request/URL" method="post">\n-\n-                <div class="formControls">\n-\n-                  <input\n-                        id="resetrelations"\n-                        type="submit"\n-                        name="form.button.Cleanup"\n-                        class="destructive"\n-                        value="Cleanup"\n-                        i18n:attributes="value" />\n-                  <label i18n:translate="label_catalog_reload">Catalog reload</label>\n-\n-                  <span class="clearfix" />\n-                  <input\n-                        id="move"\n-                        type="submit"\n-                        name="form.button.Move"\n-                        class="destructive"\n-                        value="Move"\n-                        i18n:attributes="value" />\n-                  <label i18n:translate="label_move_content_to_languages">Move content to its corresponding language root folder</label>\n-                </div>\n-\n-                <input tal:replace="structure context/@@authenticator/authenticator" />\n-\n-            </form>\n-\n-            <div class="results">\n-              <!-- The migration results -->\n-            </div>\n+        </p>\n+\n+        <form method="post"\n+              name="cleanup"\n+              tal:attributes="\n+                action request/URL;\n+              "\n+        >\n+\n+          <div class="formControls">\n+\n+            <input class="destructive"\n+                   id="resetrelations"\n+                   name="form.button.Cleanup"\n+                   type="submit"\n+                   value="Cleanup"\n+                   i18n:attributes="value"\n+            />\n+            <label i18n:translate="label_catalog_reload">Catalog reload</label>\n+\n+            <span class="clearfix"></span>\n+            <input class="destructive"\n+                   id="move"\n+                   name="form.button.Move"\n+                   type="submit"\n+                   value="Move"\n+                   i18n:attributes="value"\n+            />\n+            <label i18n:translate="label_move_content_to_languages">Move content to its corresponding language root folder</label>\n+          </div>\n+\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n+\n+        </form>\n+\n+        <div class="results">\n+          <!-- The migration results -->\n         </div>\n+      </div>\n \n-</metal:block>\n+    </metal:block>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/cleanup_results.pt b/src/plone/app/multilingual/browser/templates/cleanup_results.pt\nindex eae4ea91..88411e54 100644\n--- a/src/plone/app/multilingual/browser/templates/cleanup_results.pt\n+++ b/src/plone/app/multilingual/browser/templates/cleanup_results.pt\n@@ -1,39 +1,44 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:prefs fill-slot="prefs_configlet_main">\n+    <metal:prefs fill-slot="prefs_configlet_main">\n \n-<div id="results">\n+      <div id="results">\n \n-<div class="resultInfo">\n-    <h2 i18n:translate=""\n-        tal:content="view/stepinfo">\n+        <div class="resultInfo">\n+          <h2 tal:content="view/stepinfo"\n+              i18n:translate=""\n+          >\n         After migration relation cleanup\n-    </h2>\n+          </h2>\n \n-    <span i18n:translate="label_total_relations">\n+          <span i18n:translate="label_total_relations">\n         Number of relations touched:\n-    </span>\n-    <span tal:content="view/total">Number of objects</span>\n-</div>\n-<div tal:condition="view/bad">\n-    <span i18n:translate="label_bad_relations">\n+          </span>\n+          <span tal:content="view/total">Number of objects</span>\n+        </div>\n+        <div tal:condition="view/bad">\n+          <span i18n:translate="label_bad_relations">\n         Unfortunately a number of relations could not be translated and\n         are lost!\n         here is some debug information:\n-    </span>\n-    <span tal:repeat="one_bad view/bad" tal:content="one_bad">\n+          </span>\n+          <span tal:repeat="one_bad view/bad"\n+                tal:content="one_bad"\n+          >\n         Bad relation\n-    </span>\n-</div>\n-</div>\n-</metal:prefs>\n-</body>\n+          </span>\n+        </div>\n+      </div>\n+    </metal:prefs>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/controlpanel.pt b/src/plone/app/multilingual/browser/templates/controlpanel.pt\nindex b13b2dd9..cab97d88 100644\n--- a/src/plone/app/multilingual/browser/templates/controlpanel.pt\n+++ b/src/plone/app/multilingual/browser/templates/controlpanel.pt\n@@ -1,48 +1,67 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="here/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<tal:main metal:fill-slot="prefs_configlet_main">\n+    <tal:main metal:fill-slot="prefs_configlet_main">\n \n-  <header>\n-    <a id="setup-link" class="link-parent"\n-       tal:attributes="href string:$portal_url/@@overview-controlpanel"\n-       i18n:translate="">\n+      <header>\n+        <a class="link-parent"\n+           id="setup-link"\n+           tal:attributes="\n+             href string:$portal_url/@@overview-controlpanel;\n+           "\n+           i18n:translate=""\n+        >\n         Site Setup\n-    </a>\n+        </a>\n \n-    <h1 class="documentFirstHeading" tal:content="view/label">View Title</h1>\n+        <h1 class="documentFirstHeading"\n+            tal:content="view/label"\n+        >View Title</h1>\n \n-    <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+        <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n       Portal status message\n-    </div>\n-  </header>\n-  <div id="content-core">\n-      <div id="layout-contents">\n-          <span tal:replace="structure view/contents" />\n-      </div>\n-      <div class="mt-4">\n-        <p i18n:translate="">\n+        </div>\n+      </header>\n+      <div id="content-core">\n+        <div id="layout-contents">\n+          <span tal:replace="structure view/contents"></span>\n+        </div>\n+        <div class="mt-4">\n+          <p i18n:translate="">\n           The\n-          <a i18n:name="url" i18n:translate="" tal:attributes="href string:${context/absolute_url}/multilingual-map">multilingual map view\n-          </a>\n+            <a tal:attributes="\n+                 href string:${context/absolute_url}/multilingual-map;\n+               "\n+               i18n:name="url"\n+               i18n:translate=""\n+            >multilingual map view\n+            </a>\n           allows you to view in a graphical manner the already translated items and its relations.\n-        </p>\n-        <p i18n:translate=""\n-            tal:condition="view/isLPinstalled">\n+          </p>\n+          <p tal:condition="view/isLPinstalled"\n+             i18n:translate=""\n+          >\n           In case you want to migrate from Products.LinguaPlone access to the\n-          <a i18n:name="url" i18n:translate="" tal:attributes="href string:${context/absolute_url}/lp-migration">migration procedure.\n-          </a>\n-        </p>\n+            <a tal:attributes="\n+                 href string:${context/absolute_url}/lp-migration;\n+               "\n+               i18n:name="url"\n+               i18n:translate=""\n+            >migration procedure.\n+            </a>\n+          </p>\n+        </div>\n       </div>\n-  </div>\n \n-</tal:main>\n-</body>\n+    </tal:main>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/dexterity_edit.pt b/src/plone/app/multilingual/browser/templates/dexterity_edit.pt\nindex 90954606..1db6a74f 100644\n--- a/src/plone/app/multilingual/browser/templates/dexterity_edit.pt\n+++ b/src/plone/app/multilingual/browser/templates/dexterity_edit.pt\n@@ -1,50 +1,88 @@\n-<div class=\'row\' id=\'babel-edit\'\n-      xmlns="http://www.w3.org/1999/xhtml"\n-      xml:lang="en"\n-      lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      i18n:domain="plone"\n-      tal:define="pamutils context/@@babel_utils;">\n+<div xmlns="http://www.w3.org/1999/xhtml"\n+     xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+     xmlns:metal="http://xml.zope.org/namespaces/metal"\n+     xmlns:tal="http://xml.zope.org/namespaces/tal"\n+     class="row"\n+     id="babel-edit"\n+     lang="en"\n+     xml:lang="en"\n+     tal:define="\n+       pamutils context/@@babel_utils;\n+     "\n+     i18n:domain="plone"\n+>\n \n-    <script src="++resource++plone.app.multilingual.javascript/babel_helper.js"></script>\n-    <input type="hidden" id="url_translate" value="" tal:attributes="value context/absolute_url"/>\n-    <input type="hidden" id="gtranslate_service_available" value="" tal:attributes="value pamutils/gtenabled"/>\n+  <script src="++resource++plone.app.multilingual.javascript/babel_helper.js"></script>\n+  <input id="url_translate"\n+         type="hidden"\n+         value=""\n+         tal:attributes="\n+           value context/absolute_url;\n+         "\n+  />\n+  <input id="gtranslate_service_available"\n+         type="hidden"\n+         value=""\n+         tal:attributes="\n+           value pamutils/gtenabled;\n+         "\n+  />\n \n-    <div class=\'col-md-6\'>\n-        <h2 i18n:translate="heading_available_translations">Available translations for this content</h2>\n-        <div id="trans-selector"\n-             tal:define="languages pamutils/translated_languages;\n-             max_nr_of_buttons view/max_nr_of_buttons">\n-          <div class="btn-group"\n-            tal:define="use_dropdown python:max_nr_of_buttons and max_nr_of_buttons < len(languages)">\n-            <select name="language_selector" tal:condition="use_dropdown">\n-              <option tal:repeat="lang languages"\n-                tal:attributes="value string:${lang/obj/absolute_url}/babel_view;\n-                                      selected python:lang[\'isDefault\'] and \'selected\' or \'\';\n-                                      id string:selection-${lang/code}"\n-                tal:content="lang/info/native|lang/info/name">Language</option>\n-            </select>\n-            <tal:block repeat="lang languages" tal:condition="not:use_dropdown">\n-              <button class="btn"\n-                      tal:attributes="data-url string:${lang/obj/absolute_url}/babel_view;\n-                                      class python:lang[\'isDefault\'] and \'btn active\' or \'btn\';\n-                                      name string:button-${lang/info/name}"\n-                      tal:content="lang/info/native|lang/info/name">Language</button>\n-            </tal:block>\n-          </div>\n-        </div>\n-        <div id="frame-content" i18n:translate="label_translations_should_be_here">\n+  <div class="col-md-6">\n+    <h2 i18n:translate="heading_available_translations">Available translations for this content</h2>\n+    <div id="trans-selector"\n+         tal:define="\n+           languages pamutils/translated_languages;\n+           max_nr_of_buttons view/max_nr_of_buttons;\n+         "\n+    >\n+      <div class="btn-group"\n+           tal:define="\n+             use_dropdown python:max_nr_of_buttons and max_nr_of_buttons &lt; len(languages);\n+           "\n+      >\n+        <select name="language_selector"\n+                tal:condition="use_dropdown"\n+        >\n+          <option tal:repeat="lang languages"\n+                  tal:content="lang/info/native|lang/info/name"\n+                  tal:attributes="\n+                    value string:${lang/obj/absolute_url}/babel_view;\n+                    selected python:lang[\'isDefault\'] and \'selected\' or \'\';\n+                    id string:selection-${lang/code};\n+                  "\n+          >Language</option>\n+        </select>\n+        <tal:block tal:condition="not:use_dropdown"\n+                   repeat="lang languages"\n+        >\n+          <button class="btn"\n+                  tal:content="lang/info/native|lang/info/name"\n+                  tal:attributes="\n+                    data-url string:${lang/obj/absolute_url}/babel_view;\n+                    class python:lang[\'isDefault\'] and \'btn active\' or \'btn\';\n+                    name string:button-${lang/info/name};\n+                  "\n+          >Language</button>\n+        </tal:block>\n+      </div>\n+    </div>\n+    <div id="frame-content"\n+         i18n:translate="label_translations_should_be_here"\n+    >\n             The available translations for this content should be here\n-        </div>\n     </div>\n-    <div class=\'col-md-6\'>\n+  </div>\n+  <div class="col-md-6">\n     <div id="header-translation">\n-        <h2 i18n:translate="translation_to">Translation to <span i18n:name="language" tal:content="pamutils/current_language_name" tal:omit-tag="">es</span></h2>\n+      <h2 i18n:translate="translation_to">Translation to\n+        <span tal:content="pamutils/current_language_name"\n+              tal:omit-tag=""\n+              i18n:name="language"\n+        >es</span></h2>\n     </div>\n     <div id="form-target">\n       <tal:block content="structure view/babel_content">Content edit</tal:block>\n     </div>\n-    </div>\n+  </div>\n </div>\ndiff --git a/src/plone/app/multilingual/browser/templates/disconnect_translation.pt b/src/plone/app/multilingual/browser/templates/disconnect_translation.pt\nindex 18cbe0f3..5c06663f 100644\n--- a/src/plone/app/multilingual/browser/templates/disconnect_translation.pt\n+++ b/src/plone/app/multilingual/browser/templates/disconnect_translation.pt\n@@ -1,35 +1,61 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-    <metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n-    <body>\n+  <body>\n \n-        <metal:main fill-slot="main">\n+    <metal:main fill-slot="main">\n \n-        <h1 class="documentFirstHeading"\n-            i18n:translate="alert_disconnect_translation">\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="alert_disconnect_translation"\n+      >\n             Disconnect translation\n-        </h1>\n-\n-        <div id="content-core">\n-\n-            <form action="" tal:attributes="action string:${context/absolute_url}/disconnect_translation">\n-                <p i18n:translate="confirm_translation_disconnect">Do you really want to disconnect this translation?</p>\n-                <input type="hidden" name="came_from" tal:attributes="value context/REQUEST/form/came_from">\n-                <input type="hidden" name="language" tal:attributes="value context/REQUEST/form/language">\n-                <input type="hidden" name="submitted" value="1">\n-                <span tal:replace="structure context/@@authenticator/authenticator"/>\n-                <button type="submit" i18n:translate="label_disconnect">Disconnect</button>\n-            </form>\n-\n-        </div>\n-\n-        </metal:main>\n-    </body>\n+      </h1>\n+\n+      <div id="content-core">\n+\n+        <form action=""\n+              tal:attributes="\n+                action string:${context/absolute_url}/disconnect_translation;\n+              "\n+        >\n+          <p i18n:translate="confirm_translation_disconnect">Do you really want to disconnect this translation?</p>\n+          <input name="came_from"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value context/REQUEST/form/came_from;\n+                 "\n+          />\n+          <input name="language"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value context/REQUEST/form/language;\n+                 "\n+          />\n+          <input name="submitted"\n+                 type="hidden"\n+                 value="1"\n+          />\n+          <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+          <button type="submit"\n+                  i18n:translate="label_disconnect"\n+          >Disconnect</button>\n+        </form>\n+\n+      </div>\n+\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/dx_babel_view.pt b/src/plone/app/multilingual/browser/templates/dx_babel_view.pt\nindex 3fc7b794..94b86a49 100644\n--- a/src/plone/app/multilingual/browser/templates/dx_babel_view.pt\n+++ b/src/plone/app/multilingual/browser/templates/dx_babel_view.pt\n@@ -1,34 +1,56 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n-      i18n:domain="plone">\n-<body>\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<div id="view_language" tal:content="context/language">\n-</div>\n-\n-<tal:block repeat="widget view/widgets/values">\n-    <div class="field"  id=""\n-         tal:attributes="id python:widget.__name__; rel python:widget.__name__">\n-        <label tal:content="widget/label" />\n-        <br />\n-        <div class="value" tal:content="structure widget/render" />\n+    <div id="view_language"\n+         tal:content="context/language"\n+    >\n     </div>\n-</tal:block>\n \n-<fieldset tal:repeat="group view/groups"\n-          tal:attributes="id python:\'\'.join((group.prefix, \'groups.\', group.__name__)).replace(\'.\', \'-\')">\n-    <legend tal:content="group/label" />\n-    <tal:block repeat="widget group/widgets/values">\n-    <div class="field" rel="" id="" tal:attributes="id python:widget.__name__; rel python:widget.__name__" tal:condition="python:widget.__name__!=\'IDublinCore.language\'">\n-        <label tal:content="widget/label" />\n+    <tal:block repeat="widget view/widgets/values">\n+      <div class="field"\n+           id=""\n+           tal:attributes="\n+             id python:widget.__name__;\n+             rel python:widget.__name__;\n+           "\n+      >\n+        <label tal:content="widget/label"></label>\n         <br />\n-        <div tal:content="structure widget/render" />\n-    </div>\n-  </tal:block>\n-</fieldset>\n+        <div class="value"\n+             tal:content="structure widget/render"\n+        ></div>\n+      </div>\n+    </tal:block>\n+\n+    <fieldset tal:repeat="group view/groups"\n+              tal:attributes="\n+                id python:\'\'.join((group.prefix, \'groups.\', group.__name__)).replace(\'.\', \'-\');\n+              "\n+    >\n+      <legend tal:content="group/label"></legend>\n+      <tal:block repeat="widget group/widgets/values">\n+        <div class="field"\n+             id=""\n+             rel=""\n+             tal:condition="python:widget.__name__!=\'IDublinCore.language\'"\n+             tal:attributes="\n+               id python:widget.__name__;\n+               rel python:widget.__name__;\n+             "\n+        >\n+          <label tal:content="widget/label"></label>\n+          <br />\n+          <div tal:content="structure widget/render"></div>\n+        </div>\n+      </tal:block>\n+    </fieldset>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/languages-notice.pt b/src/plone/app/multilingual/browser/templates/languages-notice.pt\nindex 5b485d46..d755d53a 100644\n--- a/src/plone/app/multilingual/browser/templates/languages-notice.pt\n+++ b/src/plone/app/multilingual/browser/templates/languages-notice.pt\n@@ -1,15 +1,29 @@\n-<dl class="portalMessage warning" role="status">\n-  <dt i18n:translate="" i18n:domain="plone">\n+<dl class="portalMessage warning"\n+    role="status"\n+>\n+  <dt i18n:domain="plone"\n+      i18n:translate=""\n+  >\n     Warning\n   </dt>\n-  <dd id="multilingual-languages-notice" i18n:domain="plone"\n-      tal:define="portal_url context/portal_url"\n-      i18n:translate="not_configured_for_multiple_languages">\n+  <dd id="multilingual-languages-notice"\n+      tal:define="\n+        portal_url context/portal_url;\n+      "\n+      i18n:domain="plone"\n+      i18n:translate="not_configured_for_multiple_languages"\n+  >\n     Your site is not configured with more than one allowed language,\n     but the add-on that provides support for content in multiple\n     language is installed. You can add one or more additional\n-    languages from the <a href="" i18n:translate="" i18n:name="control-panel-link"\n-    tal:attributes="href\n-    string:${portal_url}/@@language-controlpanel">Language control panel</a>.\n+    languages from the\n+    <a href=""\n+       tal:attributes="\n+         href\n+    string:${portal_url}/@@language-controlpanel;\n+       "\n+       i18n:name="control-panel-link"\n+       i18n:translate=""\n+    >Language control panel</a>.\n   </dd>\n </dl>\ndiff --git a/src/plone/app/multilingual/browser/templates/languageselector.pt b/src/plone/app/multilingual/browser/templates/languageselector.pt\nindex a815e56c..544579e2 100644\n--- a/src/plone/app/multilingual/browser/templates/languageselector.pt\n+++ b/src/plone/app/multilingual/browser/templates/languageselector.pt\n@@ -1,34 +1,44 @@\n <tal:language tal:condition="view/available">\n-  <ul\n-      id="portal-languageselector"\n-      tal:define="showFlags view/showFlags;\n-                languages view/languages;\n-                portal_url view/portal_url;\n-                icons python:context.restrictedTraverse(\'@@iconresolver\');">\n+  <ul id="portal-languageselector"\n+      tal:define="\n+        showFlags view/showFlags;\n+        languages view/languages;\n+        portal_url view/portal_url;\n+        icons python:context.restrictedTraverse(\'@@iconresolver\');\n+      "\n+  >\n     <tal:language repeat="lang languages">\n-      <li\n-          tal:define="code lang/code;\n-                    selected lang/selected;\n-                    codeclass string:language-${code};\n-                    current python: selected and \'currentLanguage \' or \'\';"\n-          tal:attributes="class string:${current}${codeclass}">\n-        <a\n-            href=""\n-            tal:define="flag lang/flag|nothing;\n-                       name lang/native|lang/name;\n-                       showflag python:showFlags and flag;"\n-            tal:attributes="href lang/url;\n-                           title name">\n+      <li tal:define="\n+            code lang/code;\n+            selected lang/selected;\n+            codeclass string:language-${code};\n+            current python: selected and \'currentLanguage \' or \'\';\n+          "\n+          tal:attributes="\n+            class string:${current}${codeclass};\n+          "\n+      >\n+        <a href=""\n+           tal:define="\n+             flag lang/flag|nothing;\n+             name lang/native|lang/name;\n+             showflag python:showFlags and flag;\n+           "\n+           tal:attributes="\n+             href lang/url;\n+             title name;\n+           "\n+        >\n           <tal:flag condition="showflag">\n             <tal:flag condition="showflag">\n               <img tal:replace="structure python:icons.tag(flag, tag_class=\'plone-icon-flag\')" />\n             </tal:flag>\n           </tal:flag>\n-          <tal:nonflag\n-              condition="not: showflag"\n-              replace="name">language name</tal:nonflag>\n+          <tal:nonflag condition="not: showflag"\n+                       replace="name"\n+          >language name</tal:nonflag>\n         </a>\n       </li>\n     </tal:language>\n   </ul>\n-</tal:language>\n\\ No newline at end of file\n+</tal:language>\ndiff --git a/src/plone/app/multilingual/browser/templates/migration.pt b/src/plone/app/multilingual/browser/templates/migration.pt\nindex 20eef7ad..205cdd59 100644\n--- a/src/plone/app/multilingual/browser/templates/migration.pt\n+++ b/src/plone/app/multilingual/browser/templates/migration.pt\n@@ -1,16 +1,18 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:block metal:fill-slot="prefs_configlet_main">\n+    <metal:block metal:fill-slot="prefs_configlet_main">\n \n-  <script type="text/javascript">\n+      <script type="text/javascript">\n   (function($) {\n \n       $().ready(function() {\n@@ -56,47 +58,57 @@\n       });\n \n   })(jQuery);\n-  </script>\n+      </script>\n \n-  <style>\n+      <style>\n   .results {\n     border: 1px solid #ccc;\n     padding: 10px;\n     background-color: #eee;\n   }\n \n-  </style>\n-\n-        <div i18n:domain="plone">\n-            <ul>\n-              <li>\n-                <a href=""\n-                   tal:attributes="href string:${portal_url}/@@language-controlpanel"\n-                   i18n:translate="label_general">General</a>\n-              </li>\n-              <li>\n-                <a href=""\n-                   tal:attributes="href string:${portal_url}/@@multilingual-map"\n-                   i18n:translate="label_translation_map">Translation Map</a>\n-              </li>\n-              <li class="selected">\n-                <a href=""\n-                   tal:attributes="href string:${portal_url}/@@lp-migration"\n-                   i18n:translate="label_migration">Migration</a>\n-              </li>\n-            </ul>\n-        </div>\n-\n-        <h1 class="documentFirstHeading"\n-            i18n:translate="heading_migration">Products.LinguaPlone Migration</h1>\n-\n-        <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      </style>\n+\n+      <div i18n:domain="plone">\n+        <ul>\n+          <li>\n+            <a href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@language-controlpanel;\n+               "\n+               i18n:translate="label_general"\n+            >General</a>\n+          </li>\n+          <li>\n+            <a href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@multilingual-map;\n+               "\n+               i18n:translate="label_translation_map"\n+            >Translation Map</a>\n+          </li>\n+          <li class="selected">\n+            <a href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@lp-migration;\n+               "\n+               i18n:translate="label_migration"\n+            >Migration</a>\n+          </li>\n+        </ul>\n+      </div>\n+\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="heading_migration"\n+      >Products.LinguaPlone Migration</h1>\n+\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n         Portal status message\n-        </div>\n+      </div>\n \n-        <div id="content-core">\n+      <div id="content-core">\n \n-            <p i18n:translate="description_migrate">\n+        <p i18n:translate="description_migrate">\n \n                 The migration process is divided into four steps, listed\n                 below. Each one of the steps has a well defined purpose\n@@ -104,49 +116,54 @@\n                 one of it and do not try to run it on production servers\n                 without testing it previously.\n \n-            </p>\n+        </p>\n \n-            <form\n-                  id="lp-migration-reindex-content"\n-                  tal:attributes="action string:${portal_url}/reindex-language-index"\n-                  method="post">\n-              <fieldset>\n-                <legend i18n:translate="legend_reindex_language_index">\n+        <form id="lp-migration-reindex-content"\n+              method="post"\n+              tal:attributes="\n+                action string:${portal_url}/reindex-language-index;\n+              "\n+        >\n+          <fieldset>\n+            <legend i18n:translate="legend_reindex_language_index">\n                   Optional step - Reindex the Language index\n-                </legend>\n+            </legend>\n \n-                <p i18n:translate="help_reindex_language_index">\n+            <p i18n:translate="help_reindex_language_index">\n \n                  The migration of LinguaPlone content depends on an up-to-date Language\n                  index. Use this step to refresh this index.\n                  Warning: Depending on the number of items in your site, this can take\n                  a considerable amount of time.\n \n-                </p>\n+            </p>\n \n-                <div class="formControls">\n-                    <input\n-                        type="submit"\n-                        name="form.button.reindex-language-index"\n-                        class="destructive"\n-                        value="Reindex"\n-                        i18n:attributes="value" />\n-                </div>\n+            <div class="formControls">\n+              <input class="destructive"\n+                     name="form.button.reindex-language-index"\n+                     type="submit"\n+                     value="Reindex"\n+                     i18n:attributes="value"\n+              />\n+            </div>\n \n-                <input tal:replace="structure context/@@authenticator/authenticator" />\n+            <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-              </fieldset>\n-            </form>\n+          </fieldset>\n+        </form>\n \n-            <form id="lp-migration-relocate-content"\n-                  tal:attributes="action string:${portal_url}/relocate-content"\n-                  method="post">\n-              <fieldset>\n-                <legend i18n:translate="legend_relocate_content">\n+        <form id="lp-migration-relocate-content"\n+              method="post"\n+              tal:attributes="\n+                action string:${portal_url}/relocate-content;\n+              "\n+        >\n+          <fieldset>\n+            <legend i18n:translate="legend_relocate_content">\n                   Step 1 - Relocate content to the proper root language folder\n-                </legend>\n+            </legend>\n \n-                <p i18n:translate="description_relocate_content">\n+            <p i18n:translate="description_relocate_content">\n                   This step will move the site\'s content to its corresponding\n                   root language folder and previously will make a search for\n                   misplaced content through the site\'s content tree and will\n@@ -155,120 +172,133 @@\n                   Make sure you have previously configured your site\'s\n                   languages properly in the \'Site Languages\' tab of the\n                   \'Languages\' control panel.\n-                </p>\n+            </p>\n \n-                <div>\n-                    <p i18n:translate="description_relocate_blacklist">\n+            <div>\n+              <p i18n:translate="description_relocate_blacklist">\n                         Use this field to define portal types that will not be traversed for finding content to move.\n                         All content of those types will be moved with all contained sub-items. This is useful\n                         for content types that are themselves translatable, but contain sub-content that is not\n-                        translatable or does not have a language set.<br />\n+                translatable or does not have a language set.<br />\n                         This list is pre-filled with some portal types, but you can add additional ones if needed,\n                         one per line.\n-                    </p>\n-                    <textarea name="blacklist" id="blacklist" rows="5" tal:content="python: \'\\n\'.join(view.portal_types_blacklist)">\n-                    </textarea>\n-                </div>\n-\n-                <div class="formControls">\n-                    <input\n-                        type="submit"\n-                        name="form.button.relocate-content"\n-                        class="destructive"\n-                        value="Relocate"\n-                        i18n:attributes="value" />\n-                </div>\n-\n-                <input tal:replace="structure context/@@authenticator/authenticator" />\n-\n-              </fieldset>\n-            </form>\n-\n-            <form id="lp-migration-transfer-catalog"\n-                  tal:attributes="action string:${portal_url}/transfer-lp-catalog"\n-                  method="post">\n-              <fieldset>\n-                <legend i18n:translate="legend_transfer_multilingual_catalog_info">\n+              </p>\n+              <textarea id="blacklist"\n+                        name="blacklist"\n+                        rows="5"\n+                        tal:content="python: \'\\n\'.join(view.portal_types_blacklist)"\n+              >\n+              </textarea>\n+            </div>\n+\n+            <div class="formControls">\n+              <input class="destructive"\n+                     name="form.button.relocate-content"\n+                     type="submit"\n+                     value="Relocate"\n+                     i18n:attributes="value"\n+              />\n+            </div>\n+\n+            <input tal:replace="structure context/@@authenticator/authenticator" />\n+\n+          </fieldset>\n+        </form>\n+\n+        <form id="lp-migration-transfer-catalog"\n+              method="post"\n+              tal:attributes="\n+                action string:${portal_url}/transfer-lp-catalog;\n+              "\n+        >\n+          <fieldset>\n+            <legend i18n:translate="legend_transfer_multilingual_catalog_info">\n                   Step 2 - Transfer multilingual catalog information\n-                </legend>\n+            </legend>\n \n-                <p i18n:translate="description_transfer_multilingual_catalog_info">\n+            <p i18n:translate="description_transfer_multilingual_catalog_info">\n \n                   This step will transfer the relations between translations\n                   stored by LinguaPlone to the PAM catalog. This step is not\n                   destructive and can be executed as many times as needed.\n \n-                </p>\n+            </p>\n \n-                <div class="formControls">\n-                    <input\n-                        type="submit"\n-                        name="form.button.transfer-lp-catalog"\n-                        class="destructive"\n-                        value="Transfer"\n-                        i18n:attributes="value" />\n-                </div>\n+            <div class="formControls">\n+              <input class="destructive"\n+                     name="form.button.transfer-lp-catalog"\n+                     type="submit"\n+                     value="Transfer"\n+                     i18n:attributes="value"\n+              />\n+            </div>\n \n-                <input tal:replace="structure context/@@authenticator/authenticator" />\n+            <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-              </fieldset>\n-            </form>\n+          </fieldset>\n+        </form>\n \n-            <form id="lp-migration-after-migration"\n-                  tal:attributes="action python:not view.isLPinstalled and view.hasRelationCatalog and portal_url + \'/after-migration-cleanup\'"\n-                  method="post">\n-              <fieldset>\n-                <legend i18n:translate="legend_after_migration_cleanup">\n+        <form id="lp-migration-after-migration"\n+              method="post"\n+              tal:attributes="\n+                action python:not view.isLPinstalled and view.hasRelationCatalog and portal_url + \'/after-migration-cleanup\';\n+              "\n+        >\n+          <fieldset>\n+            <legend i18n:translate="legend_after_migration_cleanup">\n                   Step 3 - Cleanup after migration\n-                </legend>\n+            </legend>\n \n-                <p i18n:translate="description_after_migration_cleanup">\n+            <p i18n:translate="description_after_migration_cleanup">\n \n                   This step will fix some lost dependencies to the\n                   ITranslatable interface hidden in the relation catalog and\n                   it gets rid of them. It must be run only when LinguaPlone is\n                   already uninstalled.\n \n-                </p>\n+            </p>\n \n-                <p tal:condition="view/isLPinstalled"\n-                    i18n:translate="relation_migration_with_lp_not_posible">\n+            <p tal:condition="view/isLPinstalled"\n+               i18n:translate="relation_migration_with_lp_not_posible"\n+            >\n                     It\'s not possible to execute this step without\n                     uninstalling completely LinguaPlone: uninstall in the\n                     add-ons control panel, delete it from your buildout\n                     and re-run buildout. Then come here and try again.\n-                </p>\n+            </p>\n \n-                <p tal:condition="python:not view.isLPinstalled and not view.hasRelationCatalog"\n-                    i18n:translate="relation_migration_with_not_needed">\n+            <p tal:condition="python:not view.isLPinstalled and not view.hasRelationCatalog"\n+               i18n:translate="relation_migration_with_not_needed"\n+            >\n                     Your site has no relation catalog, and therefore this\n                     migration step is not needed\n-                </p>\n-\n-                <div class="formControls"\n-                     tal:condition="python:not view.isLPinstalled and view.hasRelationCatalog">\n-                    <input\n-                        type="submit"\n-                        name="form.button.after-migration-cleanup"\n-                        class="destructive"\n-                        value="Cleanup"\n-                        i18n:attributes="value" />\n-                </div>\n-\n-                <input tal:replace="structure context/@@authenticator/authenticator" />\n-\n-              </fieldset>\n-            </form>\n-\n-            <div class="results">\n-              <h2 i18n:translate="heading_migration_results">Migration results</h2>\n-              <p i18n:translate="description_migration_results">\n-                Here you will see the results of the migration process\n-              </p>\n+            </p>\n+\n+            <div class="formControls"\n+                 tal:condition="python:not view.isLPinstalled and view.hasRelationCatalog"\n+            >\n+              <input class="destructive"\n+                     name="form.button.after-migration-cleanup"\n+                     type="submit"\n+                     value="Cleanup"\n+                     i18n:attributes="value"\n+              />\n             </div>\n+\n+            <input tal:replace="structure context/@@authenticator/authenticator" />\n+\n+          </fieldset>\n+        </form>\n+\n+        <div class="results">\n+          <h2 i18n:translate="heading_migration_results">Migration results</h2>\n+          <p i18n:translate="description_migration_results">\n+                Here you will see the results of the migration process\n+          </p>\n         </div>\n+      </div>\n \n-</metal:block>\n+    </metal:block>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/migrator-results.pt b/src/plone/app/multilingual/browser/templates/migrator-results.pt\nindex 5fad45dd..fa6b5b48 100644\n--- a/src/plone/app/multilingual/browser/templates/migrator-results.pt\n+++ b/src/plone/app/multilingual/browser/templates/migrator-results.pt\n@@ -1,35 +1,43 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:prefs fill-slot="prefs_configlet_main">\n+    <metal:prefs fill-slot="prefs_configlet_main">\n \n-<div id="results">\n+      <div id="results">\n \n-<div class="resultInfo" i18n:domain="plone">\n-    <h2 i18n:translate=""\n-        tal:content="view/stepinfo">\n+        <div class="resultInfo"\n+             i18n:domain="plone"\n+        >\n+          <h2 tal:content="view/stepinfo"\n+              i18n:translate=""\n+          >\n         Transfer multilingual catalog information\n-    </h2>\n-    <span i18n:translate="label_total_objects_translated">\n+          </h2>\n+          <span i18n:translate="label_total_objects_translated">\n         Total objects handled:\n-    </span>\n-    <span tal:content="python: len(view.results)">Number of objects</span>\n-</div>\n+          </span>\n+          <span tal:content="python: len(view.results)">Number of objects</span>\n+        </div>\n \n-<tal:block repeat="result view/results">\n-    <div class="result"\n-    tal:attributes="class python:result.startswith(\'ERROR\') and \'result error\' or \'result\'"\n-    tal:content="result"></div>\n-</tal:block>\n+        <tal:block repeat="result view/results">\n+          <div class="result"\n+               tal:content="result"\n+               tal:attributes="\n+                 class python:result.startswith(\'ERROR\') and \'result error\' or \'result\';\n+               "\n+          ></div>\n+        </tal:block>\n \n-</div>\n-</metal:prefs>\n-</body>\n+      </div>\n+    </metal:prefs>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/mmap.pt b/src/plone/app/multilingual/browser/templates/mmap.pt\nindex e09d7084..b4643538 100644\n--- a/src/plone/app/multilingual/browser/templates/mmap.pt\n+++ b/src/plone/app/multilingual/browser/templates/mmap.pt\n@@ -1,18 +1,24 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n-\n-<body>\n-\n-<metal:block metal:fill-slot="prefs_configlet_main">\n-\n-  <script type="text/javascript" src="++resource++plone.app.multilingual.javascript/jit-yc.js"></script>\n-  <script type="text/javascript" src="++resource++plone.app.multilingual.javascript/mmap_helper.js"></script>\n-  <style>\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+\n+  <body>\n+\n+    <metal:block metal:fill-slot="prefs_configlet_main">\n+\n+      <script src="++resource++plone.app.multilingual.javascript/jit-yc.js"\n+              type="text/javascript"\n+      ></script>\n+      <script src="++resource++plone.app.multilingual.javascript/mmap_helper.js"\n+              type="text/javascript"\n+      ></script>\n+      <style>\n   #pam_mmap_toolbar {\n     border: 1px solid #000;\n     padding: 20px;\n@@ -51,90 +57,127 @@\n     background-color: #777;\n     color: white;\n   }\n-  </style>\n-\n-        <a id="setup-link" class="link-parent"\n-           tal:attributes="href string:$portal_url/@@overview-controlpanel"\n-           i18n:translate="">\n+      </style>\n+\n+      <a class="link-parent"\n+         id="setup-link"\n+         tal:attributes="\n+           href string:$portal_url/@@overview-controlpanel;\n+         "\n+         i18n:translate=""\n+      >\n             Site Setup\n-        </a>\n+      </a>\n \n-        <h1 class="documentFirstHeading"\n-            i18n:translate="heading_translation_map">plone.app.multilingual translation map</h1>\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="heading_translation_map"\n+      >plone.app.multilingual translation map</h1>\n \n-        <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n         Portal status message\n-        </div>\n+      </div>\n \n-        <div id="content-core">\n+      <div id="content-core">\n \n-            <p i18n:translate="description_translation_map">\n+        <p i18n:translate="description_translation_map">\n                 Translation map.\n-            </p>\n-            <div id="pam_ajax_buttons">\n-              <button id="call_missing_translations" i18n:translate="label_missing_translations">Missing translations</button>\n-              <button id="call_all_translations" class="down" i18n:translate="label_all_translations">All translations</button>\n-            </div>\n+        </p>\n+        <div id="pam_ajax_buttons">\n+          <button id="call_missing_translations"\n+                  i18n:translate="label_missing_translations"\n+          >Missing translations</button>\n+          <button class="down"\n+                  id="call_all_translations"\n+                  i18n:translate="label_all_translations"\n+          >All translations</button>\n+        </div>\n \n-            <div id="all_translations">\n+        <div id="all_translations">\n \n-            <div id="pam_mmap_toolbar">\n-              <div id="pam_mmap_language_toolbar">\n-                <div id="pam_language_buttons" tal:define="data view/languages">\n+          <div id="pam_mmap_toolbar">\n+            <div id="pam_mmap_language_toolbar">\n+              <div id="pam_language_buttons"\n+                   tal:define="\n+                     data view/languages;\n+                   "\n+              >\n                 <tal:block repeat="languages data/languages">\n-                  <button id="" tal:attributes="id languages/value;\n-                                                class python: languages.value==data[\'default\'] and \'down\' or \'\'" tal:content="languages/title">Lang</button>\n+                  <button id=""\n+                          tal:content="languages/title"\n+                          tal:attributes="\n+                            id languages/value;\n+                            class python: languages.value==data[\'default\'] and \'down\' or \'\';\n+                          "\n+                  >Lang</button>\n                 </tal:block>\n-                </div>\n+              </div>\n \n-                <div id="actual_language">\n-                </div>\n+              <div id="actual_language">\n               </div>\n+            </div>\n \n             <div id="data_translation">\n             </div>\n           </div>\n-            <div id="translation_map_canvas" style="height: 400px; width: 600px;">\n-\n-            </div>\n-            <div id="log">\n-            </div>\n+          <div id="translation_map_canvas"\n+               style="height: 400px; width: 600px;"\n+          >\n \n           </div>\n-          <div id="missing_translations">\n-            <div tal:define="not_full_translated view/canonicals">\n-              <ul>\n+          <div id="log">\n+          </div>\n+\n+        </div>\n+        <div id="missing_translations">\n+          <div tal:define="\n+                 not_full_translated view/canonicals;\n+               ">\n+            <ul>\n               <tal:block repeat="canonical not_full_translated">\n                 <li>\n-                <span tal:content="canonical/id">Id</span>\n-                <ul tal:define="last_url canonical/last_url">\n-                  <li>\n-                    <span i18n:translate="missing_languages">Missing languages: </span>\n-                    <tal:block2 repeat="missing canonical/missing">\n-                      <a href="" target="_blank" tal:attributes="href string:$last_url/@@create_translation?language=$missing" tal:content="missing">\n+                  <span tal:content="canonical/id">Id</span>\n+                  <ul tal:define="\n+                        last_url canonical/last_url;\n+                      ">\n+                    <li>\n+                      <span i18n:translate="missing_languages">Missing languages:\n+                      </span>\n+                      <tal:block2 repeat="missing canonical/missing">\n+                        <a href=""\n+                           target="_blank"\n+                           tal:content="missing"\n+                           tal:attributes="\n+                             href string:$last_url/@@create_translation?language=$missing;\n+                           "\n+                        >\n                         lang\n-                      </a>\n-                    </tal:block2>\n-                  </li>\n-                  <li>\n-                    <span i18n:translate="translation">Translations: </span>\n-                    <tal:block2 repeat="missing canonical/translated">\n-                      <a href="" tal:attributes="href missing/url">\n-                        <span tal:content="missing/path">Path</span>\n-                        <span tal:content="missing/lang">Lang</span>\n-                      </a>\n-                    </tal:block2>\n-                  </li>\n-                </ul>\n+                        </a>\n+                      </tal:block2>\n+                    </li>\n+                    <li>\n+                      <span i18n:translate="translation">Translations:\n+                      </span>\n+                      <tal:block2 repeat="missing canonical/translated">\n+                        <a href=""\n+                           tal:attributes="\n+                             href missing/url;\n+                           "\n+                        >\n+                          <span tal:content="missing/path">Path</span>\n+                          <span tal:content="missing/lang">Lang</span>\n+                        </a>\n+                      </tal:block2>\n+                    </li>\n+                  </ul>\n                 </li>\n               </tal:block>\n-              </ul>\n-            </div>\n+            </ul>\n           </div>\n-\n         </div>\n \n-</metal:block>\n+      </div>\n+\n+    </metal:block>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/modify_translations.pt b/src/plone/app/multilingual/browser/templates/modify_translations.pt\nindex a32f8adc..3c7b72e6 100644\n--- a/src/plone/app/multilingual/browser/templates/modify_translations.pt\n+++ b/src/plone/app/multilingual/browser/templates/modify_translations.pt\n@@ -1,93 +1,170 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    xml:lang="en" lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:main fill-slot="main">\n+    <metal:main fill-slot="main">\n \n-    <header>\n-      <h1 class="documentFirstHeading"\n-          i18n:translate=""\n-          metal:define-slot="heading">\n+      <header>\n+        <h1 class="documentFirstHeading"\n+            metal:define-slot="heading"\n+            i18n:translate=""\n+        >\n         Modify translations\n-      </h1>\n+        </h1>\n \n-      <div class="documentDescription" i18n:translate="long_description_modify_translations">\n+        <div class="documentDescription"\n+             i18n:translate="long_description_modify_translations"\n+        >\n         This form allows you to add or remove translations for the current object.\n-      </div>\n-    </header>\n+        </div>\n+      </header>\n \n-  <div id="content-core">\n+      <div id="content-core">\n \n-    <table class="table table-bordered table-striped table-sm" id="translations-overview" summary="Translations overview">\n-      <tal:langs repeat="lang view/available_languages">\n-        <tr tal:define="translation python:view.get_translation(lang);">\n-          <td class="align-middle text-center" tal:define="activeLanguage context/Language|nothing">\n-            <span tal:attributes="class python:lang == activeLanguage and \'activeLanguage font-weight-bold\' or None"\n-                  tal:content="lang"></span>\n-          </td>\n-          <td>\n-            <tal:hastranslation condition="python:translation">\n-              <h3 class="translationTitle" tal:content="translation/Title">Title</h3>\n-              <a class="translationURL" href="#" tal:attributes="href translation/absolute_url">\n-                <span tal:replace="python:\'/\'.join(translation.getPhysicalPath())">URL</span>\n-              </a>\n-            </tal:hastranslation>\n-            <tal:notranslation condition="python:not translation">\n-              <h3 class="translationTitle discreet" i18n:translate="">Translation missing</h3>\n-            </tal:notranslation>\n-          </td>\n-          <td class="align-middle text-center">\n-            <tal:hastranslation condition="python:translation and translation != context">\n-              <a href="#" title="Disconnect translation" class="pat-plone-modal disconnectTranslationAction"\n-                 tal:attributes="href string:${context/absolute_url}/disconnect_translation?came_from=${context/UID}&language=${lang}"\n-                 i18n:attributes="title disconnect_translation">\n-                  <img src="" alt="" width="20" height="20" class="icon me-2"\n-                           tal:attributes="src string:++plone++bootstrap-icons/arrows-angle-expand.svg"/><span \n-                    class="d-none d-md-inline-block text-xs-right" i18n:translate="disconnect_translation">Disconnect translation</span>\n-              </a>\n-            </tal:hastranslation>\n-            <tal:notranslation condition="python:not translation">\n-              <a href="#" title="Connect existing translation" class="pat-plone-modal connectTranslationAction"\n-                 tal:attributes="href string:${context/absolute_url}/connect_translation?language=${lang}"\n-                 i18n:attributes="title connect_existing_translation">\n-                  <img src="" alt="" width="20" height="20" class="icon me-2"\n-                           tal:attributes="src string:++plone++bootstrap-icons/arrows-angle-contract.svg"/><span \n-                    class="d-none d-md-inline-block" i18n:translate="connect_existing_translation">Connect existing translation</span>\n-              </a>\n-            </tal:notranslation>\n-          </td>\n-          <td class="align-middle text-center">\n-            <tal:hastranslation condition="python:translation and translation != context">\n-              <a href="#" title="Delete translated item" class="pat-plone-modal deleteTranslationAction"\n-                 tal:attributes="href string:${translation/absolute_url}/delete_confirmation"\n-                 i18n:attributes="title delete_translated_item">\n-                  <img src="" alt="" width="20" height="20" class="icon me-2"\n-                           tal:attributes="src string:++plone++bootstrap-icons/trash.svg"/><span \n-                    class="d-none d-md-inline-block" i18n:translate="delete_translated_item">Delete translated item</span>\n-              </a>\n-            </tal:hastranslation>\n-            <tal:notranslation condition="python:not translation">\n-              <a href="#" title="Add translation" class="pat-plone-modal addTranslationAction"\n-                 tal:attributes="href string:${context/absolute_url}/@@create_translation?language=${lang}"\n-                 i18n:attributes="title add_translation">\n-                  <img src="" alt="" width="20" height="20"\n-                           tal:attributes="src string:++plone++bootstrap-icons/plus.svg"/><span \n-                    class="d-none d-md-inline-block" i18n:translate="add_translation">Add translation</span>\n-              </a>\n-            </tal:notranslation>\n-          </td>\n-        </tr>\n-      </tal:langs>\n-    </table>\n+        <table class="table table-bordered table-striped table-sm"\n+               id="translations-overview"\n+               summary="Translations overview"\n+        >\n+          <tal:langs repeat="lang view/available_languages">\n+            <tr tal:define="\n+                  translation python:view.get_translation(lang);\n+                ">\n+              <td class="align-middle text-center"\n+                  tal:define="\n+                    activeLanguage context/Language|nothing;\n+                  "\n+              >\n+                <span tal:content="lang"\n+                      tal:attributes="\n+                        class python:lang == activeLanguage and \'activeLanguage font-weight-bold\' or None;\n+                      "\n+                ></span>\n+              </td>\n+              <td>\n+                <tal:hastranslation condition="python:translation">\n+                  <h3 class="translationTitle"\n+                      tal:content="translation/Title"\n+                  >Title</h3>\n+                  <a class="translationURL"\n+                     href="#"\n+                     tal:attributes="\n+                       href translation/absolute_url;\n+                     "\n+                  >\n+                    <span tal:replace="python:\'/\'.join(translation.getPhysicalPath())">URL</span>\n+                  </a>\n+                </tal:hastranslation>\n+                <tal:notranslation condition="python:not translation">\n+                  <h3 class="translationTitle discreet"\n+                      i18n:translate=""\n+                  >Translation missing</h3>\n+                </tal:notranslation>\n+              </td>\n+              <td class="align-middle text-center">\n+                <tal:hastranslation condition="python:translation and translation != context">\n+                  <a class="pat-plone-modal disconnectTranslationAction"\n+                     href="#"\n+                     title="Disconnect translation"\n+                     tal:attributes="\n+                       href string:${context/absolute_url}/disconnect_translation?came_from=${context/UID}&language=${lang};\n+                     "\n+                     i18n:attributes="title disconnect_translation"\n+                  >\n+                    <img class="icon me-2"\n+                         alt=""\n+                         height="20"\n+                         src=""\n+                         width="20"\n+                         tal:attributes="\n+                           src string:++plone++bootstrap-icons/arrows-angle-expand.svg;\n+                         "\n+                    /><span class="d-none d-md-inline-block text-xs-right"\n+                          i18n:translate="disconnect_translation"\n+                    >Disconnect translation</span>\n+                  </a>\n+                </tal:hastranslation>\n+                <tal:notranslation condition="python:not translation">\n+                  <a class="pat-plone-modal connectTranslationAction"\n+                     href="#"\n+                     title="Connect existing translation"\n+                     tal:attributes="\n+                       href string:${context/absolute_url}/connect_translation?language=${lang};\n+                     "\n+                     i18n:attributes="title connect_existing_translation"\n+                  >\n+                    <img class="icon me-2"\n+                         alt=""\n+                         height="20"\n+                         src=""\n+                         width="20"\n+                         tal:attributes="\n+                           src string:++plone++bootstrap-icons/arrows-angle-contract.svg;\n+                         "\n+                    /><span class="d-none d-md-inline-block"\n+                          i18n:translate="connect_existing_translation"\n+                    >Connect existing translation</span>\n+                  </a>\n+                </tal:notranslation>\n+              </td>\n+              <td class="align-middle text-center">\n+                <tal:hastranslation condition="python:translation and translation != context">\n+                  <a class="pat-plone-modal deleteTranslationAction"\n+                     href="#"\n+                     title="Delete translated item"\n+                     tal:attributes="\n+                       href string:${translation/absolute_url}/delete_confirmation;\n+                     "\n+                     i18n:attributes="title delete_translated_item"\n+                  >\n+                    <img class="icon me-2"\n+                         alt=""\n+                         height="20"\n+                         src=""\n+                         width="20"\n+                         tal:attributes="\n+                           src string:++plone++bootstrap-icons/trash.svg;\n+                         "\n+                    /><span class="d-none d-md-inline-block"\n+                          i18n:translate="delete_translated_item"\n+                    >Delete translated item</span>\n+                  </a>\n+                </tal:hastranslation>\n+                <tal:notranslation condition="python:not translation">\n+                  <a class="pat-plone-modal addTranslationAction"\n+                     href="#"\n+                     title="Add translation"\n+                     tal:attributes="\n+                       href string:${context/absolute_url}/@@create_translation?language=${lang};\n+                     "\n+                     i18n:attributes="title add_translation"\n+                  >\n+                    <img alt=""\n+                         height="20"\n+                         src=""\n+                         width="20"\n+                         tal:attributes="\n+                           src string:++plone++bootstrap-icons/plus.svg;\n+                         "\n+                    /><span class="d-none d-md-inline-block"\n+                          i18n:translate="add_translation"\n+                    >Add translation</span>\n+                  </a>\n+                </tal:notranslation>\n+              </td>\n+            </tr>\n+          </tal:langs>\n+        </table>\n \n-  </div>\n+      </div>\n \n-</metal:main>\n-</body>\n-</html>\n\\ No newline at end of file\n+    </metal:main>\n+  </body>\n+</html>\ndiff --git a/src/plone/app/multilingual/browser/templates/not_translated_yet.pt b/src/plone/app/multilingual/browser/templates/not_translated_yet.pt\nindex 0f13d868..e69977cf 100644\n--- a/src/plone/app/multilingual/browser/templates/not_translated_yet.pt\n+++ b/src/plone/app/multilingual/browser/templates/not_translated_yet.pt\n@@ -1,57 +1,84 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n-<body>\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:head fill-slot="top_slot"\n-            tal:define="dummy python:request.set(\'disable_border\',1);\n-                        disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                        disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);">\n-</metal:head>\n+    <metal:head fill-slot="top_slot"\n+                tal:define="\n+                  dummy python:request.set(\'disable_border\',1);\n+                  disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                  disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+                "\n+    >\n+    </metal:head>\n \n-<metal:main fill-slot="main">\n-    <metal:main define-macro="main">\n+    <metal:main fill-slot="main">\n+      <metal:main define-macro="main">\n \n-    <h1 class="documentFirstHeading" i18n:translate="heading_not_available_in_language">\n-      Not available in <span i18n:name="language" tal:content="view/language_name" tal:omit-tag="">es</span>\n-    </h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="heading_not_available_in_language"\n+        >\n+      Not available in\n+          <span tal:content="view/language_name"\n+                tal:omit-tag=""\n+                i18n:name="language"\n+          >es</span>\n+        </h1>\n \n-      <div class="documentDescription" id="parent-fieldname-description" i18n:translate="">\n+        <div class="documentDescription"\n+             id="parent-fieldname-description"\n+             i18n:translate=""\n+        >\n         This content is not translated yet to the language requested.\n-      </div>\n-      <section>\n-        <tal:anytranslation condition="view/has_any_translation">\n-          <p i18n:translate="">However, this is the list of the already translated languages for the requested content.</p>\n-          <ul>\n-            <tal:list repeat="trans_content view/already_translated">\n-              <tal:defines define="code python: trans_content[0];\n-                              trans_obj python: trans_content[1]">\n-              <li tal:condition="python:trans_obj.Title()">\n-                <span tal:replace="python:view.language_name(code)" /> - <span tal:replace="code"/>:\n-                <a tal:attributes="href python:trans_obj.absolute_url() + \'?set_language=\' + code"\n-                   tal:content="python:trans_obj.Title()">Translation Link</a></li>\n-              <li tal:condition="python:not trans_obj.Title()">\n-                <span tal:content="python:trans_obj"></span>\n-                <a tal:attributes="href python:trans_obj.absolute_url() + \'?set_language=\' + code"\n-                    i18n:translate="label_no_title">\n-                  (No Title)</a></li>\n-              </tal:defines>\n-            </tal:list>\n-          </ul>\n-        </tal:anytranslation>\n-        <tal:anytranslation condition="not: view/has_any_translation">\n-          <p i18n:translate="">This item doesn\'t have any translation yet. You can return to the portal site:</p>\n+        </div>\n+        <section>\n+          <tal:anytranslation condition="view/has_any_translation">\n+            <p i18n:translate="">However, this is the list of the already translated languages for the requested content.</p>\n+            <ul>\n+              <tal:list repeat="trans_content view/already_translated">\n+                <tal:defines define="\n+                               code python: trans_content[0];\n+                               trans_obj python: trans_content[1];\n+                             ">\n+                  <li tal:condition="python:trans_obj.Title()">\n+                    <span tal:replace="python:view.language_name(code)"></span>\n+                    -\n+                    <span tal:replace="code"></span>:\n+                    <a tal:content="python:trans_obj.Title()"\n+                       tal:attributes="\n+                         href python:trans_obj.absolute_url() + \'?set_language=\' + code;\n+                       "\n+                    >Translation Link</a></li>\n+                  <li tal:condition="python:not trans_obj.Title()">\n+                    <span tal:content="python:trans_obj"></span>\n+                    <a tal:attributes="\n+                         href python:trans_obj.absolute_url() + \'?set_language=\' + code;\n+                       "\n+                       i18n:translate="label_no_title"\n+                    >\n+                      (No Title)</a></li>\n+                </tal:defines>\n+              </tal:list>\n+            </ul>\n+          </tal:anytranslation>\n+          <tal:anytranslation condition="not: view/has_any_translation">\n+            <p i18n:translate="">This item doesn\'t have any translation yet. You can return to the portal site:</p>\n             <ul>\n-              <li><a tal:attributes="href python:context.absolute_url()"\n-                     tal:content="python:context.Title()">Content Link</a></li>\n+              <li><a tal:content="python:context.Title()"\n+                   tal:attributes="\n+                     href python:context.absolute_url();\n+                   "\n+                >Content Link</a></li>\n             </ul>\n-        </tal:anytranslation>\n-      </section>\n+          </tal:anytranslation>\n+        </section>\n+      </metal:main>\n     </metal:main>\n-  </metal:main>\n-</body>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/reindex-results.pt b/src/plone/app/multilingual/browser/templates/reindex-results.pt\nindex 2f3df7c6..2fde5a10 100644\n--- a/src/plone/app/multilingual/browser/templates/reindex-results.pt\n+++ b/src/plone/app/multilingual/browser/templates/reindex-results.pt\n@@ -1,33 +1,42 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:prefs fill-slot="prefs_configlet_main">\n+    <metal:prefs fill-slot="prefs_configlet_main">\n \n-<div id="results">\n+      <div id="results">\n \n-<div class="resultInfo">\n-    <h2 i18n:translate=""\n-        tal:content="view/stepinfo">\n+        <div class="resultInfo">\n+          <h2 tal:content="view/stepinfo"\n+              i18n:translate=""\n+          >\n         Reindex Language Index\n-    </h2>\n+          </h2>\n \n-    <p i18n:translate="migration_reindex_results">\n+          <p i18n:translate="migration_reindex_results">\n       The "Language" index was re-indexed correctly. Before, it contained\n-      <span i18n:name="previous_items_number" tal:content="view/items_before"\n-          tal:omit-tag="" /> items, now it contains <span i18n:name="after_items_number"\n-          tal:content="view/items_after" tal:omit-tag="" />\n+            <span tal:content="view/items_before"\n+                  tal:omit-tag=""\n+                  i18n:name="previous_items_number"\n+            ></span>\n+            items, now it contains\n+            <span tal:content="view/items_after"\n+                  tal:omit-tag=""\n+                  i18n:name="after_items_number"\n+            ></span>\n \n-    </p>\n-</div>\n+          </p>\n+        </div>\n \n-</div>\n-</metal:prefs>\n-</body>\n+      </div>\n+    </metal:prefs>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/relocate-results.pt b/src/plone/app/multilingual/browser/templates/relocate-results.pt\nindex 6f53691a..6a21b653 100644\n--- a/src/plone/app/multilingual/browser/templates/relocate-results.pt\n+++ b/src/plone/app/multilingual/browser/templates/relocate-results.pt\n@@ -1,35 +1,43 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:prefs fill-slot="prefs_configlet_main">\n+    <metal:prefs fill-slot="prefs_configlet_main">\n \n-<div id="results">\n+      <div id="results">\n \n-<div class="resultInfo" i18n:domain="plone">\n-    <h2 i18n:translate=""\n-        tal:content="view/stepinfo">\n+        <div class="resultInfo"\n+             i18n:domain="plone"\n+        >\n+          <h2 tal:content="view/stepinfo"\n+              i18n:translate=""\n+          >\n         Relocate content to the proper root language folder\n-    </h2>\n-    <span i18n:translate="label_total_objects_translated">\n+          </h2>\n+          <span i18n:translate="label_total_objects_translated">\n         Total objects handled:\n-    </span>\n-    <span tal:content="python: len(view.results)">Number of objects</span>\n-</div>\n+          </span>\n+          <span tal:content="python: len(view.results)">Number of objects</span>\n+        </div>\n \n-<tal:block repeat="result view/results">\n-    <div class="result"\n-    tal:attributes="class python:result.startswith(\'ERROR\') and \'result error\' or \'result\'"\n-    tal:content="result"></div>\n-</tal:block>\n+        <tal:block repeat="result view/results">\n+          <div class="result"\n+               tal:content="result"\n+               tal:attributes="\n+                 class python:result.startswith(\'ERROR\') and \'result error\' or \'result\';\n+               "\n+          ></div>\n+        </tal:block>\n \n-</div>\n-</metal:prefs>\n-</body>\n+      </div>\n+    </metal:prefs>\n+  </body>\n </html>\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:04:49+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/3a3a4697e5f8150910e909d633e63f1e8fc82bb2

chore: zpretty

Files changed:
M src/plone/app/multilingual/browser/templates/modify_translations.pt

b'diff --git a/src/plone/app/multilingual/browser/templates/modify_translations.pt b/src/plone/app/multilingual/browser/templates/modify_translations.pt\nindex 3c7b72e6..c72c18d7 100644\n--- a/src/plone/app/multilingual/browser/templates/modify_translations.pt\n+++ b/src/plone/app/multilingual/browser/templates/modify_translations.pt\n@@ -74,7 +74,7 @@\n                      href="#"\n                      title="Disconnect translation"\n                      tal:attributes="\n-                       href string:${context/absolute_url}/disconnect_translation?came_from=${context/UID}&language=${lang};\n+                       href string:${context/absolute_url}/disconnect_translation?came_from=${context/UID}&language=${lang};;\n                      "\n                      i18n:attributes="title disconnect_translation"\n                   >\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:04:50+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/e30de17fb80b52f1ebbe44df1eaaeb5a3f8ccaba

feat: flake8

Files changed:
M docs/conf.py
M src/plone/app/multilingual/browser/helper_views.py
M src/plone/app/multilingual/browser/vocabularies.py
M src/plone/app/multilingual/content/lif.py
M src/plone/app/multilingual/tests/test_setup.py
M src/plone/app/multilingual/upgrades.py

b'diff --git a/docs/conf.py b/docs/conf.py\nindex 676bcc18..42d593c6 100644\n--- a/docs/conf.py\n+++ b/docs/conf.py\n@@ -10,10 +10,6 @@\n # All configuration values have a default; values that are commented out\n # serve to show the default.\n \n-import os\n-import sys\n-\n-\n # If extensions (or modules to document with autodoc) are in another directory,\n # add these directories to sys.path here. If the directory is relative to the\n # documentation root, use os.path.abspath to make it absolute, like shown here.\n@@ -172,11 +168,11 @@\n \n latex_elements = {\n     # The paper size (\'letterpaper\' or \'a4paper\').\n-    #\'papersize\': \'letterpaper\',\n+    # \'papersize\': \'letterpaper\',\n     # The font size (\'10pt\', \'11pt\' or \'12pt\').\n-    #\'pointsize\': \'10pt\',\n+    # \'pointsize\': \'10pt\',\n     # Additional stuff for the LaTeX preamble.\n-    #\'preamble\': \'\',\n+    # \'preamble\': \'\',\n }\n \n # Grouping the document tree into LaTeX files. List of tuples\ndiff --git a/src/plone/app/multilingual/browser/helper_views.py b/src/plone/app/multilingual/browser/helper_views.py\nindex 34c54fec..a93f8f78 100644\n--- a/src/plone/app/multilingual/browser/helper_views.py\n+++ b/src/plone/app/multilingual/browser/helper_views.py\n@@ -1,6 +1,5 @@\n from AccessControl.SecurityManagement import getSecurityManager\n from Acquisition import aq_chain\n-from borg.localrole.interfaces import IFactoryTempFolder\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.app.multilingual.browser.selector import addQuery\n from plone.app.multilingual.browser.selector import NOT_TRANSLATED_YET_TEMPLATE\ndiff --git a/src/plone/app/multilingual/browser/vocabularies.py b/src/plone/app/multilingual/browser/vocabularies.py\nindex ccb36e42..a6f42d28 100644\n--- a/src/plone/app/multilingual/browser/vocabularies.py\n+++ b/src/plone/app/multilingual/browser/vocabularies.py\n@@ -104,8 +104,8 @@ def __call__(self, context):\n             languages = util.getLanguages()\n \n         items = [\n-            (l, languages[l].get("native", languages[l].get("name", l)))\n-            for l in languages\n+            (lang, languages[lang].get("native", languages[lang].get("name", lang)))\n+            for lang in languages\n         ]\n         items.sort(key=sort_key)\n         items = [SimpleTerm(i[0], i[0], i[1]) for i in items]\n@@ -131,9 +131,9 @@ def __call__(self, context):\n \n         supported_languages = ltool.supported_langs\n         items = [\n-            (l, languages[l].get("native", languages[l].get("name", l)))\n-            for l in languages\n-            if l in supported_languages\n+            (lang, languages[lang].get("native", languages[lang].get("name", lang)))\n+            for lang in languages\n+            if lang in supported_languages\n         ]\n \n         items.sort(key=sort_key)\ndiff --git a/src/plone/app/multilingual/content/lif.py b/src/plone/app/multilingual/content/lif.py\nindex c8a29735..b3c9b04a 100644\n--- a/src/plone/app/multilingual/content/lif.py\n+++ b/src/plone/app/multilingual/content/lif.py\n@@ -1,5 +1,4 @@\n from BTrees.OOBTree import OOBTree\n-from plone.dexterity.content import Container\n from Products.CMFCore.utils import getToolByName\n from zope.component.hooks import getSite\n \ndiff --git a/src/plone/app/multilingual/tests/test_setup.py b/src/plone/app/multilingual/tests/test_setup.py\nindex 8b2a5710..289a9f75 100644\n--- a/src/plone/app/multilingual/tests/test_setup.py\n+++ b/src/plone/app/multilingual/tests/test_setup.py\n@@ -1,12 +1,8 @@\n from Acquisition import aq_base\n from plone.app.multilingual.browser.setup import SetupMultilingualSite\n-from plone.app.multilingual.browser.vocabularies import (  # noqa: E501\n-    AllContentLanguageVocabulary,\n-)\n+from plone.app.multilingual.browser.vocabularies import AllContentLanguageVocabulary\n from plone.app.multilingual.interfaces import ATTRIBUTE_NAME\n from plone.app.multilingual.interfaces import IPloneAppMultilingualInstalled\n-from plone.app.multilingual.interfaces import ITG\n-from plone.app.multilingual.interfaces import ITranslatable\n from plone.app.multilingual.testing import PAM_INTEGRATION_PRESET_TESTING\n from plone.app.multilingual.testing import PAM_INTEGRATION_TESTING\n from Products.CMFCore.utils import getToolByName\ndiff --git a/src/plone/app/multilingual/upgrades.py b/src/plone/app/multilingual/upgrades.py\nindex ba472534..54113a0f 100644\n--- a/src/plone/app/multilingual/upgrades.py\n+++ b/src/plone/app/multilingual/upgrades.py\n@@ -1,8 +1,6 @@\n-from Acquisition import aq_base\n from plone.app.multilingual import logger\n from plone.base.interfaces import ILanguage\n from plone.base.utils import unrestricted_construct_instance\n-from plone.dexterity.interfaces import IDexterityFTI\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from time import time\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:26:59+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/6bcb1630c98325d02a8c0b9b249a6616657e2441

feat: configure codespell

Files changed:
M pyproject.toml

b'diff --git a/pyproject.toml b/pyproject.toml\nindex 9eb73f3c..d39e94d2 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,3 +60,6 @@ Zope = [\n   \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n ]\n python-dateutil = [\'dateutil\']\n+\n+[tool.codespell]\n+ignore-words-list = "discreet,pres"\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:26:59+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/6c3aca407217dd3730c258b4e2e34179688cf63a

feat: codespell

Files changed:
M CHANGES.rst
M README.rst
M src/plone/app/multilingual/api.py
M src/plone/app/multilingual/browser/helper_views.py
M src/plone/app/multilingual/browser/javascript/babel_helper.js
M src/plone/app/multilingual/browser/javascript/mmap_helper.js
M src/plone/app/multilingual/browser/migrator.py
M src/plone/app/multilingual/browser/templates/cleanup.pt
M src/plone/app/multilingual/browser/vocabularies.py
M src/plone/app/multilingual/dx/interfaces.py
M src/plone/app/multilingual/dx/subscriber.py
M src/plone/app/multilingual/events.py
M src/plone/app/multilingual/factory.py
M src/plone/app/multilingual/interfaces.py
M src/plone/app/multilingual/tests/test_sitemap.py
M src/plone/app/multilingual/upgrades.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex fab6d3c0..4cc4c268 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -339,7 +339,7 @@ Bug fixes:\n - Remove deprecation warnings in tests.\n   Increase readability\n   Add code comments.\n-  Remove superfluos reindex of "Language" in manager.\n+  Remove superfluous reindex of "Language" in manager.\n   [jensens] (#256)\n - wrong check for default addview in addtranslation traverser\n   [mauro] (#355)\n@@ -617,7 +617,7 @@ Bug fixes:\n Bug fixes:\n \n - Remove travis integration because plone.app.mutlilingual is part of plonecore and should be tested there.\n-- Fix bug where formcontrols were overlaped by fields.\n+- Fix bug where form controls were overlapped by fields.\n   [agitator]\n \n - Fix robot tests to work with improved related items widget.\n@@ -630,7 +630,7 @@ Bug fixes:\n New features:\n \n - Add a new view ``@@tg`` for translatable content. It will return the\n-  current translation group of the content, matching the bahavior of ``@@uuid``\n+  current translation group of the content, matching the behavior of ``@@uuid``\n   of ``plone.app.uuid`` returning UUID of the content.  [datakurre]\n \n \n@@ -662,7 +662,7 @@ Bug fixes:\n \n Bug fixes:\n \n-- Allow to work in an Archtypes free Plone 5.1.\n+- Allow to work in an Archetypes free Plone 5.1.\n   [jensens]\n \n - Replace unittest2 with unittest.\n@@ -760,7 +760,7 @@ Fixes:\n - Wait for visibility of select2 result, instead of time.\n   [jensens]\n \n-- Workaroud in robot test for TinyMCE overlap bug see\n+- Workaround in robot test for TinyMCE overlap bug see\n   https://github.com/plone/plone.app.multilingual/issues/227\n   for details\n   [jensens]\n@@ -954,10 +954,10 @@ Fixes:\n - Refactor locations of code in dx to bundle stuff at a sane place.\n   [jensens]\n \n-- Remove BLACKLIST_IDS, with LIF this is superfluos.\n+- Remove BLACKLIST_IDS, with LIF this is superfluous.\n   [jensens]\n \n-- Remove LanguageTool patch, meanwhile superfluos.\n+- Remove LanguageTool patch, meanwhile superfluous.\n   [jensens]\n \n - Add new ``bootstrap.py`` to support new parameter ``--setuptools-version``.\n@@ -1054,7 +1054,7 @@ Fixes:\n   [saily]\n \n - Huge PEP8 and Flake8 cleanup. Please run ``bin/code-analysis`` before\n-  commiting. A git pre-commit hook should be added automatically through\n+  committing. A git pre-commit hook should be added automatically through\n   buildout.\n   [saily]\n \n@@ -1114,7 +1114,7 @@ Fixes:\n   [jensens]\n \n - Added ++add++ and factory support using session var to store where it comes\n-  from. It maintains the old programatic way so it\'s possible to create\n+  from. It maintains the old programmatic way so it\'s possible to create\n   translations using code.\n   [ramon]\n \n@@ -1132,7 +1132,7 @@ Fixes:\n   [bouchardsyl]\n \n - take care to filter out translated contents\n-  wich do no have supported language information\n+  which do no have supported language information\n   [kiorky]\n \n - added support for language neutral objects with country specific language codes\n@@ -1203,7 +1203,7 @@ Fixes:\n - Multilingual Map\n   [ramon]\n \n-- Univeral link\n+- Universal link\n   [ramon]\n \n - Catalog patch bug solving\n@@ -1237,7 +1237,7 @@ Fixes:\n 1.0b2 - 2012-07-08\n ------------------\n \n-- change language index to Language to LinguaPlone coexistance\n+- change language index to Language to LinguaPlone coexistence\n   [ramon]\n \n - don\'t rebuild the complete catalog on installing\ndiff --git a/README.rst b/README.rst\nindex c68d0c2c..d69a5495 100644\n--- a/README.rst\n+++ b/README.rst\n@@ -168,7 +168,7 @@ Dexterity\n Users should mark a dexterity content type as translatable by assigning a the multilingual behavior to the definition of the content type either via file system, supermodel or through the web.\n \n \n-Marking fields as language independant\n+Marking fields as language independent\n ======================================\n \n Archetypes\n@@ -186,7 +186,7 @@ The language independent fields on Archetype-based content are marked the same w\n \n .. note::\n \n-    If you want to completely remove LinguaPlone of your installation, you should make sure that your code are dependant in any way of LP.\n+    If you want to completely remove LinguaPlone of your installation, you should make sure that your code are dependent in any way of LP.\n \n \n Dexterity\ndiff --git a/src/plone/app/multilingual/api.py b/src/plone/app/multilingual/api.py\nindex b27eb5b5..070d5708 100644\n--- a/src/plone/app/multilingual/api.py\n+++ b/src/plone/app/multilingual/api.py\n@@ -21,7 +21,7 @@ def get_translation_group(content):\n def get_translation_manager(content):\n     """Get the translation manager.\n \n-    :param content: Content for which the tranlation manager is needed.\n+    :param content: Content for which the translation manager is needed.\n     :type content: Content object\n     :returns: translation manager instance.\n     :raises:\ndiff --git a/src/plone/app/multilingual/browser/helper_views.py b/src/plone/app/multilingual/browser/helper_views.py\nindex a93f8f78..b88d7b66 100644\n--- a/src/plone/app/multilingual/browser/helper_views.py\n+++ b/src/plone/app/multilingual/browser/helper_views.py\n@@ -150,9 +150,9 @@ def getClosestDestination(self):\n \n         # We are going to see if there is the preferred language translation\n         # Otherwise we get the first as context to look for translation\n-        prefered = ltool.getPreferredLanguage(self.request)\n-        if prefered in languages:\n-            context = languages[prefered]\n+        preferred = ltool.getPreferredLanguage(self.request)\n+        if preferred in languages:\n+            context = languages[preferred]\n         else:\n             context = languages[list(languages.keys())[0]]\n \ndiff --git a/src/plone/app/multilingual/browser/javascript/babel_helper.js b/src/plone/app/multilingual/browser/javascript/babel_helper.js\nindex 0792d47c..cae87ed9 100644\n--- a/src/plone/app/multilingual/browser/javascript/babel_helper.js\n+++ b/src/plone/app/multilingual/browser/javascript/babel_helper.js\n@@ -53,7 +53,7 @@\n             // The next calculation of padding is necessary if both elements\n             // have to be shifted down.\n             if (!first && original.prev().is(":visible")) {\n-                // Calulate distance between bottom of prev element and top\n+                // Calculate distance between bottom of prev element and top\n                 // of current element. add Padding. If > 0, add to more_padding\n                 new_distance = distance(original.prev(), original);\n                 new_distance += original_padding;\ndiff --git a/src/plone/app/multilingual/browser/javascript/mmap_helper.js b/src/plone/app/multilingual/browser/javascript/mmap_helper.js\nindex b83d220a..0b18bdef 100644\n--- a/src/plone/app/multilingual/browser/javascript/mmap_helper.js\n+++ b/src/plone/app/multilingual/browser/javascript/mmap_helper.js\n@@ -128,8 +128,8 @@ var load = function init(json){\n         //subtree and then handle it to the onComplete callback.\n         //Here we just use a client-side tree generator (the getTree function).\n         request: function(nodeId, level, onComplete) {\n-          var ans = getTree(nodeId, level);\n-          onComplete.onComplete(nodeId, ans);\n+          var answer = getTree(nodeId, level);\n+          onComplete.onComplete(nodeId, answer);\n         },\n \n         onBeforeCompute: function(node){\n@@ -193,7 +193,7 @@ var load = function init(json){\n         //This method is called right before plotting\n         //an edge. It\'s useful for changing an individual edge\n         //style properties before plotting it.\n-        //Edge data proprties prefixed with a dollar sign will\n+        //Edge data properties prefixed with a dollar sign will\n         //override the Edge global style properties.\n         onBeforePlotLine: function(adj){\n             if (adj.nodeFrom.selected && adj.nodeTo.selected) {\n@@ -291,4 +291,4 @@ function get_data(){\n         });\n     });\n \n-})(jQuery);\n\\ No newline at end of file\n+})(jQuery);\ndiff --git a/src/plone/app/multilingual/browser/migrator.py b/src/plone/app/multilingual/browser/migrator.py\nindex ff2f2eee..7d9f3f59 100644\n--- a/src/plone/app/multilingual/browser/migrator.py\n+++ b/src/plone/app/multilingual/browser/migrator.py\n@@ -216,13 +216,13 @@ def step1andstep2(self):\n                     # Test if the id already exist previously\n \n                     try:\n-                        cutted = parent.manage_cutObjects(content.getId())\n+                        obj_cut = parent.manage_cutObjects(content.getId())\n                     except ResourceLockedError:\n                         lockable = ILockable(content)\n                         lockable.unlock()\n-                        cutted = parent.manage_cutObjects(content.getId())\n+                        obj_cut = parent.manage_cutObjects(content.getId())\n                     try:\n-                        target_folder.manage_pasteObjects(cutted)\n+                        target_folder.manage_pasteObjects(obj_cut)\n                         info_str = "Step 2: Moved object {} to folder {}".format(\n                             "/".join(content.getPhysicalPath()),\n                             "/".join(target_folder.getPhysicalPath()),\n@@ -277,14 +277,14 @@ def step3(self):\n                     old_path = brain.getPath()\n \n                     try:\n-                        cutted = self.context.manage_cutObjects(brain.id)\n+                        obj_cut = self.context.manage_cutObjects(brain.id)\n                     except ResourceLockedError:\n                         content = brain.getObject()\n                         lockable = ILockable(content)\n                         lockable.unlock()\n-                        cutted = self.context.manage_cutObjects(brain.id)\n+                        obj_cut = self.context.manage_cutObjects(brain.id)\n                     try:\n-                        folder.manage_pasteObjects(cutted)\n+                        folder.manage_pasteObjects(obj_cut)\n                         info_str = "Moved object %s to language root folder " "%s" % (\n                             old_path,\n                             lang,\ndiff --git a/src/plone/app/multilingual/browser/templates/cleanup.pt b/src/plone/app/multilingual/browser/templates/cleanup.pt\nindex 6fa39935..4442cf90 100644\n--- a/src/plone/app/multilingual/browser/templates/cleanup.pt\n+++ b/src/plone/app/multilingual/browser/templates/cleanup.pt\n@@ -83,7 +83,7 @@\n                 It can happen that there are relations left that contain\n                 LinguaPlone relations. By executing this step, the catalog\n                 gets reset and rebuilt. It CAN happen that things go bad.\n-                In that case relations get lost. It is therefor important that\n+                In that case relations get lost. It is therefore important that\n                 you have a backup!\n         </p>\n \ndiff --git a/src/plone/app/multilingual/browser/vocabularies.py b/src/plone/app/multilingual/browser/vocabularies.py\nindex a6f42d28..33f2e59b 100644\n--- a/src/plone/app/multilingual/browser/vocabularies.py\n+++ b/src/plone/app/multilingual/browser/vocabularies.py\n@@ -37,7 +37,7 @@ def translated_languages(context):\n     language_infos = language_tool.getAvailableLanguages()\n     manager = ITranslationManager(context)\n     # take care to filter out translated contents\n-    # wich do no have supported language information\n+    # which do no have supported language information\n     translated_languages = [\n         a for a in manager.get_translated_languages() if a in language_infos\n     ]\ndiff --git a/src/plone/app/multilingual/dx/interfaces.py b/src/plone/app/multilingual/dx/interfaces.py\nindex ccae20db..683407f0 100644\n--- a/src/plone/app/multilingual/dx/interfaces.py\n+++ b/src/plone/app/multilingual/dx/interfaces.py\n@@ -17,8 +17,8 @@ class IMultilingualAddForm(Interface):\n     """Marker Interface for multilingual add forms\n \n     This marker is intended to be provided by the main multilingual add form\n-    ans to be provided by the groups (aka fieldset) forms\n-    (plone.z3cform.fieldsets.group.Group). This is neccessary in order to\n+    and to be provided by the groups (aka fieldset) forms\n+    (plone.z3cform.fieldsets.group.Group). This is necessary in order to\n     make the special template renderer for ILanguageIndependentField fields\n     work in fieldset tabs too.\n     """\ndiff --git a/src/plone/app/multilingual/dx/subscriber.py b/src/plone/app/multilingual/dx/subscriber.py\nindex fcf73dcb..c050deb4 100644\n--- a/src/plone/app/multilingual/dx/subscriber.py\n+++ b/src/plone/app/multilingual/dx/subscriber.py\n@@ -71,7 +71,7 @@ def handle_modified(self, content):\n             if self.bypass_security_checks():\n                 # Clone the current user and assign a new editor role to\n                 # allow edition of all translated objects even if the\n-                # current user whould not have permission to do that.\n+                # current user would not have permission to do that.\n                 tmp_user = UnrestrictedUser(\n                     sm.getUser().getId(),\n                     "",\n@@ -106,7 +106,7 @@ def reindex_translation(self, translation):\n         descriptions = Attributes(schema)\n         # where is this information needed?\n         # XXX behaviors need to be considered here\n-        # use plone.dexterity.utils.iterSchemata or similiar\n+        # use plone.dexterity.utils.iterSchemata or similar\n \n         # Pass the canonical object as a event description\n         notify(ObjectModifiedEvent(translation, descriptions, self.canonical))\ndiff --git a/src/plone/app/multilingual/events.py b/src/plone/app/multilingual/events.py\nindex d8e16e6f..79ca78be 100644\n--- a/src/plone/app/multilingual/events.py\n+++ b/src/plone/app/multilingual/events.py\n@@ -26,7 +26,7 @@ class ITranslationRegisteredEvent(IObjectEvent):\n \n     object = Attribute("The base object.")\n     target = Attribute("The translated object.")\n-    language = Attribute("The language of the translated obejct.")\n+    language = Attribute("The language of the translated object.")\n \n \n class ITranslationUpdatedEvent(IObjectEvent):\ndiff --git a/src/plone/app/multilingual/factory.py b/src/plone/app/multilingual/factory.py\nindex 1dd7db7e..ef5c5a18 100644\n--- a/src/plone/app/multilingual/factory.py\n+++ b/src/plone/app/multilingual/factory.py\n@@ -67,10 +67,10 @@ def __init__(self, context):\n \n     def __call__(self, parent, language):\n         content_id = self.context.getId()\n-        splitted = content_id.split("-")\n+        parts = content_id.split("-")\n         # ugly heuristic (searching for something like \'de\', \'en\' etc.)\n-        if len(splitted) > 1 and len(splitted[-1]) == 2:\n-            content_id = "-".join(splitted[:-1])\n+        if len(parts) > 1 and len(parts[-1]) == 2:\n+            content_id = "-".join(parts[:-1])\n         while content_id in parent.objectIds():\n             content_id = f"{content_id}-{language}"\n         return content_id\ndiff --git a/src/plone/app/multilingual/interfaces.py b/src/plone/app/multilingual/interfaces.py\nindex 3e94451f..d70201d6 100644\n--- a/src/plone/app/multilingual/interfaces.py\n+++ b/src/plone/app/multilingual/interfaces.py\n@@ -239,7 +239,7 @@ class IMultiLanguageExtraOptionsSchema(ILanguageSchema):\n     buttons_babel_view_up_to_nr_translations = schema.Int(\n         title=_(\n             "heading_buttons_babel_view_up_to_nr_translations",\n-            default="Use buttons in the bable view for up to how many " "translations?",\n+            default="Use buttons in the babel view for up to how many translations?",\n         ),\n         description=_(\n             "description_buttons_babel_view_up_to_nr_translations",\ndiff --git a/src/plone/app/multilingual/tests/test_sitemap.py b/src/plone/app/multilingual/tests/test_sitemap.py\nindex 7418f078..ed3c2239 100644\n--- a/src/plone/app/multilingual/tests/test_sitemap.py\n+++ b/src/plone/app/multilingual/tests/test_sitemap.py\n@@ -42,9 +42,9 @@ def setUp(self):\n \n     def uncompress(self, sitemapdata):\n         sio = BytesIO(sitemapdata)\n-        unziped = GzipFile(fileobj=sio)\n-        xml = unziped.read()\n-        unziped.close()\n+        unzipped = GzipFile(fileobj=sio)\n+        xml = unzipped.read()\n+        unzipped.close()\n         return xml\n \n     def test_portalroot_sitemap(self):\ndiff --git a/src/plone/app/multilingual/upgrades.py b/src/plone/app/multilingual/upgrades.py\nindex 54113a0f..4649df20 100644\n--- a/src/plone/app/multilingual/upgrades.py\n+++ b/src/plone/app/multilingual/upgrades.py\n@@ -50,7 +50,7 @@ def migration_pam_1_to_2(context):\n         older = portal[code]\n \n         if older.portal_type == type_name:\n-            logger.info(f"\'{code}\' is alredy a {type_name}, skipping.")\n+            logger.info(f"\'{code}\' is already a {type_name}, skipping.")\n             continue\n \n         # PHASE 1: rename old language folders\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:32:05+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/b959497c41fa0abfd94d838af870c8cc4fb46674

feat: drop archetypes references/code

Files changed:
M setup.py
M src/plone/app/multilingual/browser/migrator.py
M src/plone/app/multilingual/browser/viewlets.py

b'diff --git a/setup.py b/setup.py\nindex ea656ad8..eaab0960 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -15,9 +15,6 @@\n         "setuptools",\n     ],\n     extras_require={\n-        "archetypes": [\n-            "archetypes.multilingual",\n-        ],\n         "test": [\n             "plone.app.testing[robot]",\n             "plone.app.robotframework",\ndiff --git a/src/plone/app/multilingual/browser/migrator.py b/src/plone/app/multilingual/browser/migrator.py\nindex 7d9f3f59..3e615318 100644\n--- a/src/plone/app/multilingual/browser/migrator.py\n+++ b/src/plone/app/multilingual/browser/migrator.py\n@@ -33,14 +33,6 @@ class IDexterityContent(Interface):\n         pass\n \n \n-try:\n-    from Products.Archetypes.interfaces import IBaseObject\n-except ImportError:\n-\n-    class IBaseObject(Interface):\n-        pass\n-\n-\n with warnings.catch_warnings():\n     warnings.filterwarnings(\n         "ignore",\n@@ -145,9 +137,7 @@ class moveContentToProperRLF(BrowserView):\n \n     def findContent(self, content, depth):\n         # only handle portal content\n-        if not IDexterityContent.providedBy(content) and not IBaseObject.providedBy(\n-            content\n-        ):\n+        if not IDexterityContent.providedBy(content):\n             logger.warning(\n                 "SKIP non-portal content %s (%s)"\n                 % (content.absolute_url(), content.meta_type)\ndiff --git a/src/plone/app/multilingual/browser/viewlets.py b/src/plone/app/multilingual/browser/viewlets.py\nindex ce380c2f..7663b095 100644\n--- a/src/plone/app/multilingual/browser/viewlets.py\n+++ b/src/plone/app/multilingual/browser/viewlets.py\n@@ -124,19 +124,6 @@ def update(self):\n         self.origin = catalog.searchResults(query)\n \n \n-class AddFormATIsATranslationViewlet(AddFormIsATranslationViewlet):\n-    # XXX move this class to archetypes multilingual!\n-    # btw., it is not used in here.\n-    """Notice the user that this AT add form is a translation"""\n-\n-    def update(self):\n-        """It\'s only for AT on factory so we check"""\n-        factory = getToolByName(self.context, "portal_factory", None)\n-        if factory is None or not factory.isTemporary(self.context):\n-            return\n-        super(AddFormIsATranslationViewlet, self).update()\n-\n-\n class AlternateLanguagesViewlet(ViewletBase):\n     """Notice search engines about alternates languages of current\n     content item\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:52:17+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/a0d334ead21dc9cb83303a926c687cdbd04e75a9

feat: configure z3c.dependencychecker

Files changed:
M pyproject.toml

b'diff --git a/pyproject.toml b/pyproject.toml\nindex d39e94d2..78409e00 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,6 +60,7 @@ Zope = [\n   \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n ]\n python-dateutil = [\'dateutil\']\n+ignore-packages = [\'Products.LinguaPlone\', \'Products.CMFPlone\']\n \n [tool.codespell]\n ignore-words-list = "discreet,pres"\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-07T19:52:29+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/a1a05ea03054893fa0282f2de9f6db518c92c8e1

feat: declare dependencies

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex eaab0960..3dddf769 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -13,11 +13,53 @@\n     install_requires=[\n         "plone.i18n>=4.0.4",\n         "setuptools",\n+        "BTrees",\n+        "Products.CMFCore",\n+        "Products.GenericSetup",\n+        "Products.statusmessages",\n+        "plone.app.content",\n+        "plone.app.contentmenu",\n+        "plone.app.dexterity",\n+        "plone.app.event",\n+        "plone.app.i18n",\n+        "plone.app.layout",\n+        "plone.app.registry",\n+        "plone.app.uuid",\n+        "plone.app.vocabularies",\n+        "plone.app.z3cform",\n+        "plone.autoform",\n+        "plone.base",\n+        "plone.behavior",\n+        "plone.dexterity",\n+        "plone.indexer",\n+        "plone.locking",\n+        "plone.memoize",\n+        "plone.protect",\n+        "plone.registry",\n+        "plone.schemaeditor",\n+        "plone.supermodel",\n+        "plone.uuid",\n+        "plone.z3cform",\n+        "z3c.form",\n+        "z3c.relationfield",\n+        "zc.relation",\n+        "zope.app.container",\n+        "zope.browsermenu",\n+        "zope.intid",\n+        "zope.pagetemplate",\n     ],\n     extras_require={\n         "test": [\n             "plone.app.testing[robot]",\n             "plone.app.robotframework",\n+            "lxml",\n+            "plone.api",\n+            "plone.app.contenttypes",\n+            "plone.app.relationfield",\n+            "plone.browserlayer",\n+            "plone.rfc822",\n+            "plone.testing",\n+            "robotsuite",\n         ],\n     },\n     entry_points="""\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-08T17:10:17+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/772d2c1c23ca3082944d31fa3bb3c63c0db9c660

feat: drop z.a.container dependency

Files changed:
M setup.py
M src/plone/app/multilingual/configure.zcml

b'diff --git a/setup.py b/setup.py\nindex 3dddf769..da4d5c90 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -43,7 +43,6 @@\n         "z3c.form",\n         "z3c.relationfield",\n         "zc.relation",\n-        "zope.app.container",\n         "zope.browsermenu",\n         "zope.intid",\n         "zope.pagetemplate",\ndiff --git a/src/plone/app/multilingual/configure.zcml b/src/plone/app/multilingual/configure.zcml\nindex debfb656..2eef1c92 100644\n--- a/src/plone/app/multilingual/configure.zcml\n+++ b/src/plone/app/multilingual/configure.zcml\n@@ -53,22 +53,11 @@\n       />\n \n   <!-- Generic plone.app.multilingual subscribers and adapters -->\n-\n-  <configure zcml:condition="not-installed zope.container">\n-    <subscriber\n-        for="plone.app.multilingual.interfaces.ITranslatable\n-             zope.app.container.interfaces.IObjectAddedEvent"\n-        handler="plone.app.multilingual.subscriber.createdEvent"\n-        />\n-  </configure>\n-\n-  <configure zcml:condition="installed zope.container">\n-    <subscriber\n-        for="plone.app.multilingual.interfaces.ITranslatable\n-             zope.container.interfaces.IObjectAddedEvent"\n-        handler="plone.app.multilingual.subscriber.createdEvent"\n-        />\n-  </configure>\n+  <subscriber\n+      for="plone.app.multilingual.interfaces.ITranslatable\n+           zope.lifecycleevent.interfaces.IObjectAddedEvent"\n+      handler="plone.app.multilingual.subscriber.createdEvent"\n+      />\n \n   <subscriber\n       for="plone.app.multilingual.interfaces.ITranslatable\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2023-04-10T03:08:48+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.multilingual/commit/f1ade5e8593642a45ec3967151dba20448b1a135

Merge pull request #415 from plone/config-with-default-template-90569a05

Config with default template

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/11f0db91.internal
A tox.ini
M CHANGES.rst
M README.rst
M docs/conf.py
M pyproject.toml
M setup.cfg
M setup.py
M src/plone/app/multilingual/api.py
M src/plone/app/multilingual/browser/configure.zcml
M src/plone/app/multilingual/browser/helper_views.py
M src/plone/app/multilingual/browser/javascript/babel_helper.js
M src/plone/app/multilingual/browser/javascript/mmap_helper.js
M src/plone/app/multilingual/browser/menu.py
M src/plone/app/multilingual/browser/migrator.py
M src/plone/app/multilingual/browser/selector.py
M src/plone/app/multilingual/browser/setup.py
M src/plone/app/multilingual/browser/templates/add-form-is-translation.pt
M src/plone/app/multilingual/browser/templates/alternate-languages.pt
M src/plone/app/multilingual/browser/templates/cleanup.pt
M src/plone/app/multilingual/browser/templates/cleanup_results.pt
M src/plone/app/multilingual/browser/templates/controlpanel.pt
M src/plone/app/multilingual/browser/templates/dexterity_edit.pt
M src/plone/app/multilingual/browser/templates/disconnect_translation.pt
M src/plone/app/multilingual/browser/templates/dx_babel_view.pt
M src/plone/app/multilingual/browser/templates/languages-notice.pt
M src/plone/app/multilingual/browser/templates/languageselector.pt
M src/plone/app/multilingual/browser/templates/migration.pt
M src/plone/app/multilingual/browser/templates/migrator-results.pt
M src/plone/app/multilingual/browser/templates/mmap.pt
M src/plone/app/multilingual/browser/templates/modify_translations.pt
M src/plone/app/multilingual/browser/templates/not_translated_yet.pt
M src/plone/app/multilingual/browser/templates/reindex-results.pt
M src/plone/app/multilingual/browser/templates/relocate-results.pt
M src/plone/app/multilingual/browser/viewlets.py
M src/plone/app/multilingual/browser/vocabularies.py
M src/plone/app/multilingual/configure.zcml
M src/plone/app/multilingual/content/lif.py
M src/plone/app/multilingual/content/lif.xml
M src/plone/app/multilingual/content/lrf.xml
M src/plone/app/multilingual/dx/cloner.py
M src/plone/app/multilingual/dx/configure.zcml
M src/plone/app/multilingual/dx/interfaces.py
M src/plone/app/multilingual/dx/languageindependent.py
M src/plone/app/multilingual/dx/meta.zcml
M src/plone/app/multilingual/dx/subscriber.py
M src/plone/app/multilingual/events.py
M src/plone/app/multilingual/factory.py
M src/plone/app/multilingual/interfaces.py
M src/plone/app/multilingual/overrides.zcml
M src/plone/app/multilingual/permissions.zcml
M src/plone/app/multilingual/profiles/default/browserlayer.xml
M src/plone/app/multilingual/profiles/default/catalog.xml
M src/plone/app/multilingual/profiles/default/metadata.xml
M src/plone/app/multilingual/profiles/default/reference_catalog.xml
M src/plone/app/multilingual/profiles/default/registry.xml
M src/plone/app/multilingual/profiles/default/rolemap.xml
M src/plone/app/multilingual/profiles/default/types.xml
M src/plone/app/multilingual/profiles/default/types/LIF.xml
M src/plone/app/multilingual/profiles/default/types/LRF.xml
M src/plone/app/multilingual/profiles/default/viewlets.xml
M src/plone/app/multilingual/profiles/uninstall/browserlayer.xml
M src/plone/app/multilingual/profiles/uninstall/catalog.xml
M src/plone/app/multilingual/profiles/uninstall/cssregistry.xml
M src/plone/app/multilingual/profiles/uninstall/metadata.xml
M src/plone/app/multilingual/profiles/uninstall/reference_catalog.xml
M src/plone/app/multilingual/profiles/uninstall/types.xml
M src/plone/app/multilingual/profiles/uninstall/viewlets.xml
M src/plone/app/multilingual/profiles/upgrades/to_1000/types/LIF.xml
M src/plone/app/multilingual/profiles/upgrades/to_1000/types/LRF.xml
M src/plone/app/multilingual/profiles/upgrades/to_3/registry.xml
M src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml
M src/plone/app/multilingual/testing.zcml
M src/plone/app/multilingual/tests/test_selector.py
M src/plone/app/multilingual/tests/test_setup.py
M src/plone/app/multilingual/tests/test_sitemap.py
M src/plone/app/multilingual/upgrades.py
M src/plone/app/multilingual/upgrades.zcml

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 000000000..b4158b89d\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 000000000..b66417080\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "11f0db91"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 000000000..fdafec1c2\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.3.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.4\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/CHANGES.rst b/CHANGES.rst\nindex fab6d3c0b..4cc4c2689 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -339,7 +339,7 @@ Bug fixes:\n - Remove deprecation warnings in tests.\n   Increase readability\n   Add code comments.\n-  Remove superfluos reindex of "Language" in manager.\n+  Remove superfluous reindex of "Language" in manager.\n   [jensens] (#256)\n - wrong check for default addview in addtranslation traverser\n   [mauro] (#355)\n@@ -617,7 +617,7 @@ Bug fixes:\n Bug fixes:\n \n - Remove travis integration because plone.app.mutlilingual is part of plonecore and should be tested there.\n-- Fix bug where formcontrols were overlaped by fields.\n+- Fix bug where form controls were overlapped by fields.\n   [agitator]\n \n - Fix robot tests to work with improved related items widget.\n@@ -630,7 +630,7 @@ Bug fixes:\n New features:\n \n - Add a new view ``@@tg`` for translatable content. It will return the\n-  current translation group of the content, matching the bahavior of ``@@uuid``\n+  current translation group of the content, matching the behavior of ``@@uuid``\n   of ``plone.app.uuid`` returning UUID of the content.  [datakurre]\n \n \n@@ -662,7 +662,7 @@ Bug fixes:\n \n Bug fixes:\n \n-- Allow to work in an Archtypes free Plone 5.1.\n+- Allow to work in an Archetypes free Plone 5.1.\n   [jensens]\n \n - Replace unittest2 with unittest.\n@@ -760,7 +760,7 @@ Fixes:\n - Wait for visibility of select2 result, instead of time.\n   [jensens]\n \n-- Workaroud in robot test for TinyMCE overlap bug see\n+- Workaround in robot test for TinyMCE overlap bug see\n   https://github.com/plone/plone.app.multilingual/issues/227\n   for details\n   [jensens]\n@@ -954,10 +954,10 @@ Fixes:\n - Refactor locations of code in dx to bundle stuff at a sane place.\n   [jensens]\n \n-- Remove BLACKLIST_IDS, with LIF this is superfluos.\n+- Remove BLACKLIST_IDS, with LIF this is superfluous.\n   [jensens]\n \n-- Remove LanguageTool patch, meanwhile superfluos.\n+- Remove LanguageTool patch, meanwhile superfluous.\n   [jensens]\n \n - Add new ``bootstrap.py`` to support new parameter ``--setuptools-version``.\n@@ -1054,7 +1054,7 @@ Fixes:\n   [saily]\n \n - Huge PEP8 and Flake8 cleanup. Please run ``bin/code-analysis`` before\n-  commiting. A git pre-commit hook should be added automatically through\n+  committing. A git pre-commit hook should be added automatically through\n   buildout.\n   [saily]\n \n@@ -1114,7 +1114,7 @@ Fixes:\n   [jensens]\n \n - Added ++add++ and factory support using session var to store where it comes\n-  from. It maintains the old programatic way so it\'s possible to create\n+  from. It maintains the old programmatic way so it\'s possible to create\n   translations using code.\n   [ramon]\n \n@@ -1132,7 +1132,7 @@ Fixes:\n   [bouchardsyl]\n \n - take care to filter out translated contents\n-  wich do no have supported language information\n+  which do no have supported language information\n   [kiorky]\n \n - added support for language neutral objects with country specific language codes\n@@ -1203,7 +1203,7 @@ Fixes:\n - Multilingual Map\n   [ramon]\n \n-- Univeral link\n+- Universal link\n   [ramon]\n \n - Catalog patch bug solving\n@@ -1237,7 +1237,7 @@ Fixes:\n 1.0b2 - 2012-07-08\n ------------------\n \n-- change language index to Language to LinguaPlone coexistance\n+- change language index to Language to LinguaPlone coexistence\n   [ramon]\n \n - don\'t rebuild the complete catalog on installing\ndiff --git a/README.rst b/README.rst\nindex c68d0c2c7..d69a5495a 100644\n--- a/README.rst\n+++ b/README.rst\n@@ -168,7 +168,7 @@ Dexterity\n Users should mark a dexterity content type as translatable by assigning a the multilingual behavior to the definition of the content type either via file system, supermodel or through the web.\n \n \n-Marking fields as language independant\n+Marking fields as language independent\n ======================================\n \n Archetypes\n@@ -186,7 +186,7 @@ The language independent fields on Archetype-based content are marked the same w\n \n .. note::\n \n-    If you want to completely remove LinguaPlone of your installation, you should make sure that your code are dependant in any way of LP.\n+    If you want to completely remove LinguaPlone of your installation, you should make sure that your code are dependent in any way of LP.\n \n \n Dexterity\ndiff --git a/docs/conf.py b/docs/conf.py\nindex 349a510da..42d593c63 100644\n--- a/docs/conf.py\n+++ b/docs/conf.py\n@@ -10,203 +10,202 @@\n # All configuration values have a default; values that are commented out\n # serve to show the default.\n \n-import os\n-import sys\n-\n-\n # If extensions (or modules to document with autodoc) are in another directory,\n # add these directories to sys.path here. If the directory is relative to the\n # documentation root, use os.path.abspath to make it absolute, like shown here.\n-#sys.path.insert(0, os.path.abspath(\'.\'))\n+# sys.path.insert(0, os.path.abspath(\'.\'))\n \n # -- General configuration -----------------------------------------------------\n \n # If your documentation needs a minimal Sphinx version, state it here.\n-#needs_sphinx = \'1.0\'\n+# needs_sphinx = \'1.0\'\n \n # Add any Sphinx extension module names here, as strings. They can be extensions\n # coming with Sphinx (named \'sphinx.ext.*\') or your custom ones.\n extensions = []\n \n # Add any paths that contain templates here, relative to this directory.\n-templates_path = [\'_templates\']\n+templates_path = ["_templates"]\n \n # The suffix of source filenames.\n-source_suffix = \'.rst\'\n+source_suffix = ".rst"\n \n # The encoding of source files.\n-#source_encoding = \'utf-8-sig\'\n+# source_encoding = \'utf-8-sig\'\n \n # The master toctree document.\n-master_doc = \'index\'\n+master_doc = "index"\n \n # General information about the project.\n-project = \'plone.app.multilingual\'\n-copyright = \'2013, Plone Foundation\'\n+project = "plone.app.multilingual"\n+copyright = "2013, Plone Foundation"\n \n # The version info for the project you\'re documenting, acts as replacement for\n # |version| and |release|, also used in various other places throughout the\n # built documents.\n #\n # The short X.Y version.\n-version = \'1.0\'\n+version = "1.0"\n # The full version, including alpha/beta/rc tags.\n-release = \'1.0\'\n+release = "1.0"\n \n # The language for content autogenerated by Sphinx. Refer to documentation\n # for a list of supported languages.\n-#language = None\n+# language = None\n \n # There are two options for replacing |today|: either, you set today to some\n # non-false value, then it is used:\n-#today = \'\'\n+# today = \'\'\n # Else, today_fmt is used as the format for a strftime call.\n-#today_fmt = \'%B %d, %Y\'\n+# today_fmt = \'%B %d, %Y\'\n \n # List of patterns, relative to source directory, that match files and\n # directories to ignore when looking for source files.\n-exclude_patterns = [\'_build\']\n+exclude_patterns = ["_build"]\n \n # The reST default role (used for this markup: `text`) to use for all documents.\n-#default_role = None\n+# default_role = None\n \n # If true, \'()\' will be appended to :func: etc. cross-reference text.\n-#add_function_parentheses = True\n+# add_function_parentheses = True\n \n # If true, the current module name will be prepended to all description\n # unit titles (such as .. function::).\n-#add_module_names = True\n+# add_module_names = True\n \n # If true, sectionauthor and moduleauthor directives will be shown in the\n # output. They are ignored by default.\n-#show_authors = False\n+# show_authors = False\n \n # The name of the Pygments (syntax highlighting) style to use.\n-pygments_style = \'sphinx\'\n+pygments_style = "sphinx"\n \n # A list of ignored prefixes for module index sorting.\n-#modindex_common_prefix = []\n+# modindex_common_prefix = []\n \n \n # -- Options for HTML output ---------------------------------------------------\n \n # The theme to use for HTML and HTML Help pages.  See the documentation for\n # a list of builtin themes.\n-html_theme = \'default\'\n+html_theme = "default"\n \n # Theme options are theme-specific and customize the look and feel of a theme\n # further.  For a list of options available for each theme, see the\n # documentation.\n-#html_theme_options = {}\n+# html_theme_options = {}\n \n # Add any paths that contain custom themes here, relative to this directory.\n-#html_theme_path = []\n+# html_theme_path = []\n \n # The name for this set of Sphinx documents.  If None, it defaults to\n # "<project> v<release> documentation".\n-#html_title = None\n+# html_title = None\n \n # A shorter title for the navigation bar.  Default is the same as html_title.\n-#html_short_title = None\n+# html_short_title = None\n \n # The name of an image file (relative to this directory) to place at the top\n # of the sidebar.\n-#html_logo = None\n+# html_logo = None\n \n # The name of an image file (within the static path) to use as favicon of the\n # docs.  This file should be a Windows icon file (.ico) being 16x16 or 32x32\n # pixels large.\n-#html_favicon = None\n+# html_favicon = None\n \n # Add any paths that contain custom static files (such as style sheets) here,\n # relative to this directory. They are copied after the builtin static files,\n # so a file named "default.css" will overwrite the builtin "default.css".\n-html_static_path = [\'_static\']\n+html_static_path = ["_static"]\n \n # If not \'\', a \'Last updated on:\' timestamp is inserted at every page bottom,\n # using the given strftime format.\n-#html_last_updated_fmt = \'%b %d, %Y\'\n+# html_last_updated_fmt = \'%b %d, %Y\'\n \n # If true, SmartyPants will be used to convert quotes and dashes to\n # typographically correct entities.\n-#html_use_smartypants = True\n+# html_use_smartypants = True\n \n # Custom sidebar templates, maps document names to template names.\n-#html_sidebars = {}\n+# html_sidebars = {}\n \n # Additional templates that should be rendered to pages, maps page names to\n # template names.\n-#html_additional_pages = {}\n+# html_additional_pages = {}\n \n # If false, no module index is generated.\n-#html_domain_indices = True\n+# html_domain_indices = True\n \n # If false, no index is generated.\n-#html_use_index = True\n+# html_use_index = True\n \n # If true, the index is split into individual pages for each letter.\n-#html_split_index = False\n+# html_split_index = False\n \n # If true, links to the reST sources are added to the pages.\n-#html_show_sourcelink = True\n+# html_show_sourcelink = True\n \n # If true, "Created using Sphinx" is shown in the HTML footer. Default is True.\n-#html_show_sphinx = True\n+# html_show_sphinx = True\n \n # If true, "(C) Copyright ..." is shown in the HTML footer. Default is True.\n-#html_show_copyright = True\n+# html_show_copyright = True\n \n # If true, an OpenSearch description file will be output, and all pages will\n # contain a <link> tag referring to it.  The value of this option must be the\n # base URL from which the finished HTML is served.\n-#html_use_opensearch = \'\'\n+# html_use_opensearch = \'\'\n \n # This is the file name suffix for HTML files (e.g. ".xhtml").\n-#html_file_suffix = None\n+# html_file_suffix = None\n \n # Output file base name for HTML help builder.\n-htmlhelp_basename = \'ploneappmultilingualdoc\'\n+htmlhelp_basename = "ploneappmultilingualdoc"\n \n \n # -- Options for LaTeX output --------------------------------------------------\n \n latex_elements = {\n-# The paper size (\'letterpaper\' or \'a4paper\').\n-#\'papersize\': \'letterpaper\',\n-\n-# The font size (\'10pt\', \'11pt\' or \'12pt\').\n-#\'pointsize\': \'10pt\',\n-\n-# Additional stuff for the LaTeX preamble.\n-#\'preamble\': \'\',\n+    # The paper size (\'letterpaper\' or \'a4paper\').\n+    # \'papersize\': \'letterpaper\',\n+    # The font size (\'10pt\', \'11pt\' or \'12pt\').\n+    # \'pointsize\': \'10pt\',\n+    # Additional stuff for the LaTeX preamble.\n+    # \'preamble\': \'\',\n }\n \n # Grouping the document tree into LaTeX files. List of tuples\n # (source start file, target name, title, author, documentclass [howto/manual]).\n latex_documents = [\n-  (\'index\', \'ploneappmultilingual.tex\', \'plone.app.multilingual Documentation\',\n-   \'Plone Foundation\', \'manual\'),\n+    (\n+        "index",\n+        "ploneappmultilingual.tex",\n+        "plone.app.multilingual Documentation",\n+        "Plone Foundation",\n+        "manual",\n+    ),\n ]\n \n # The name of an image file (relative to this directory) to place at the top of\n # the title page.\n-#latex_logo = None\n+# latex_logo = None\n \n # For "manual" documents, if this is true, then toplevel headings are parts,\n # not chapters.\n-#latex_use_parts = False\n+# latex_use_parts = False\n \n # If true, show page references after internal links.\n-#latex_show_pagerefs = False\n+# latex_show_pagerefs = False\n \n # If true, show URL addresses after external links.\n-#latex_show_urls = False\n+# latex_show_urls = False\n \n # Documents to append as an appendix to all manuals.\n-#latex_appendices = []\n+# latex_appendices = []\n \n # If false, no module index is generated.\n-#latex_domain_indices = True\n+# latex_domain_indices = True\n \n \n # -- Options for manual page output --------------------------------------------\n@@ -214,12 +213,17 @@\n # One entry per manual page. List of tuples\n # (source start file, name, description, authors, manual section).\n man_pages = [\n-    (\'index\', \'ploneappmultilingual\', \'plone.app.multilingual Documentation\',\n-     [\'Plone Foundation\'], 1)\n+    (\n+        "index",\n+        "ploneappmultilingual",\n+        "plone.app.multilingual Documentation",\n+        ["Plone Foundation"],\n+        1,\n+    )\n ]\n \n # If true, show URL addresses after external links.\n-#man_show_urls = False\n+# man_show_urls = False\n \n \n # -- Options for Texinfo output ------------------------------------------------\n@@ -228,16 +232,22 @@\n # (source start file, target name, title, author,\n #  dir menu entry, description, category)\n texinfo_documents = [\n-  (\'index\', \'ploneappmultilingual\', \'plone.app.multilingual Documentation\',\n-   \'Plone Foundation\', \'ploneappmultilingual\', \'One line description of project.\',\n-   \'Miscellaneous\'),\n+    (\n+        "index",\n+        "ploneappmultilingual",\n+        "plone.app.multilingual Documentation",\n+        "Plone Foundation",\n+        "ploneappmultilingual",\n+        "One line description of project.",\n+        "Miscellaneous",\n+    ),\n ]\n \n # Documents to append as an appendix to all manuals.\n-#texinfo_appendices = []\n+# texinfo_appendices = []\n \n # If false, no module index is generated.\n-#texinfo_domain_indices = True\n+# texinfo_domain_indices = True\n \n # How to display URL addresses: \'footnote\', \'no\', or \'inline\'.\n-#texinfo_show_urls = \'footnote\'\n+# texinfo_show_urls = \'footnote\'\ndiff --git a/news/11f0db91.internal b/news/11f0db91.internal\nnew file mode 100644\nindex 000000000..c08f53991\n--- /dev/null\n+++ b/news/11f0db91.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615de2..78409e007 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,47 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\n+ignore-packages = [\'Products.LinguaPlone\', \'Products.CMFPlone\']\n+\n+[tool.codespell]\n+ignore-words-list = "discreet,pres"\ndiff --git a/setup.cfg b/setup.cfg\nindex 3a6b7a1bc..e7e8dda7e 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -30,14 +30,22 @@ python_requires = >=3.8\n \n [check-manifest]\n ignore =\n-    *.cfg\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\n \n [bdist_wheel]\n universal = 0\n \n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\ndiff --git a/setup.py b/setup.py\nindex ea656ad8d..da4d5c90c 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -13,14 +13,52 @@\n     install_requires=[\n         "plone.i18n>=4.0.4",\n         "setuptools",\n+        "BTrees",\n+        "Products.CMFCore",\n+        "Products.GenericSetup",\n+        "Products.statusmessages",\n+        "plone.app.content",\n+        "plone.app.contentmenu",\n+        "plone.app.dexterity",\n+        "plone.app.event",\n+        "plone.app.i18n",\n+        "plone.app.layout",\n+        "plone.app.registry",\n+        "plone.app.uuid",\n+        "plone.app.vocabularies",\n+        "plone.app.z3cform",\n+        "plone.autoform",\n+        "plone.base",\n+        "plone.behavior",\n+        "plone.dexterity",\n+        "plone.indexer",\n+        "plone.locking",\n+        "plone.memoize",\n+        "plone.protect",\n+        "plone.registry",\n+        "plone.schemaeditor",\n+        "plone.supermodel",\n+        "plone.uuid",\n+        "plone.z3cform",\n+        "z3c.form",\n+        "z3c.relationfield",\n+        "zc.relation",\n+        "zope.browsermenu",\n+        "zope.intid",\n+        "zope.pagetemplate",\n     ],\n     extras_require={\n-        "archetypes": [\n-            "archetypes.multilingual",\n-        ],\n         "test": [\n             "plone.app.testing[robot]",\n             "plone.app.robotframework",\n+            "lxml",\n+            "plone.api",\n+            "plone.app.contenttypes",\n+            "plone.app.relationfield",\n+            "plone.browserlayer",\n+            "plone.rfc822",\n+            "plone.testing",\n+            "robotsuite",\n         ],\n     },\n     entry_points="""\ndiff --git a/src/plone/app/multilingual/api.py b/src/plone/app/multilingual/api.py\nindex b27eb5b50..070d5708b 100644\n--- a/src/plone/app/multilingual/api.py\n+++ b/src/plone/app/multilingual/api.py\n@@ -21,7 +21,7 @@ def get_translation_group(content):\n def get_translation_manager(content):\n     """Get the translation manager.\n \n-    :param content: Content for which the tranlation manager is needed.\n+    :param content: Content for which the translation manager is needed.\n     :type content: Content object\n     :returns: translation manager instance.\n     :raises:\ndiff --git a/src/plone/app/multilingual/browser/configure.zcml b/src/plone/app/multilingual/browser/configure.zcml\nindex a8a45c7e3..b27c1f003 100644\n--- a/src/plone/app/multilingual/browser/configure.zcml\n+++ b/src/plone/app/multilingual/browser/configure.zcml\n@@ -1,29 +1,35 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n-  <include package="plone.app.contentmenu"/>\n+  <include package="plone.app.contentmenu" />\n \n   <!-- Resource Directories -->\n   <browser:resourceDirectory\n       name="plone.app.multilingual.javascript"\n-      directory="javascript"/>\n+      directory="javascript"\n+      />\n   <browser:resourceDirectory\n       name="plone.app.multilingual.stylesheet"\n-      directory="stylesheet"/>\n+      directory="stylesheet"\n+      />\n   <browser:resourceDirectory\n       name="plone.app.multilingual.images"\n-      directory="images"/>\n+      directory="images"\n+      />\n \n   <!-- Vocabulary all languages -->\n   <utility\n+      name="plone.app.multilingual.vocabularies.AllContentLanguageVocabulary"\n       component=".vocabularies.AllContentLanguageVocabularyFactory"\n-      name="plone.app.multilingual.vocabularies.AllContentLanguageVocabulary"/>\n+      />\n \n   <utility\n+      name="plone.app.multilingual.vocabularies.AllAvailableLanguageVocabulary"\n       component=".vocabularies.AllAvailableLanguageVocabularyFactory"\n-      name="plone.app.multilingual.vocabularies.AllAvailableLanguageVocabulary"/>\n+      />\n \n   <utility\n       factory=".vocabularies.RootCatalogVocabularyFactory"\n@@ -31,61 +37,69 @@\n       />\n \n   <adapter\n+      factory=".add.AddViewTraverser"\n       name="addtranslation"\n-      factory=".add.AddViewTraverser"/>\n+      />\n \n   <browser:page\n       name="modify_translations"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".modify.ModifyTranslationsForm"\n       template="templates/modify_translations.pt"\n-      permission="plone.app.multilingual.ManageTranslations"/>\n+      permission="plone.app.multilingual.ManageTranslations"\n+      />\n \n   <browser:page\n       name="connect_translation"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".modify.ConnectTranslation"\n-      permission="plone.app.multilingual.ManageTranslations"/>\n+      permission="plone.app.multilingual.ManageTranslations"\n+      />\n \n   <browser:page\n       name="disconnect_translation"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".modify.DisconnectTranslation"\n       template="templates/disconnect_translation.pt"\n-      permission="plone.app.multilingual.ManageTranslations"/>\n+      permission="plone.app.multilingual.ManageTranslations"\n+      />\n \n   <browser:page\n-      for="plone.app.multilingual.interfaces.ITranslatable"\n       name="update_language"\n+      for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".update.update_language_form"\n-      permission="cmf.ModifyPortalContent"/>\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n   <browser:page\n-      for="plone.app.multilingual.interfaces.ITranslatable"\n       name="create_translation"\n+      for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".translate.TranslationForm"\n-      permission="plone.app.multilingual.ManageTranslations"/>\n+      permission="plone.app.multilingual.ManageTranslations"\n+      />\n \n   <!-- Menu for translations on content -->\n   <browser:menu\n       id="plone_contentmenu_multilingual"\n       title="Translate menu - contains translation-related actions"\n-      class=".menu.TranslateMenu"/>\n+      class=".menu.TranslateMenu"\n+      />\n   <adapter\n+      factory=".menu.TranslateSubMenuItem"\n+      provides="plone.app.contentmenu.interfaces.IContentMenuItem"\n       for="plone.app.multilingual.interfaces.ITranslatable\n            ..interfaces.IPloneAppMultilingualInstalled"\n       name="plone.contentmenu.multilingual"\n-      factory=".menu.TranslateSubMenuItem"\n-      provides="plone.app.contentmenu.interfaces.IContentMenuItem"/>\n+      />\n \n   <!-- Control panel -->\n   <browser:page\n-    name="language-controlpanel"\n-    for="plone.base.interfaces.IPloneSiteRoot"\n-    class=".controlpanel.LanguageControlPanel"\n-    permission="plone.app.controlpanel.Language"\n-    layer="..interfaces.IPloneAppMultilingualInstalled"\n-    />\n+      name="language-controlpanel"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n+      class=".controlpanel.LanguageControlPanel"\n+      permission="plone.app.controlpanel.Language"\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Migration Tab -->\n   <browser:page\n@@ -93,36 +107,40 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.MigrationView"\n       permission="plone.app.multilingual.ManageTranslations"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <browser:page\n       name="multilingual-map"\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.multilingualMapView"\n       permission="plone.app.multilingual.ManageTranslations"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Notices Viewlets -->\n   <browser:viewlet\n-      zcml:condition="installed plone.app.controlpanel"\n       name="plone.app.multilingual.supported-languages-notice"\n       for="plone.base.interfaces.IPloneSiteRoot"\n       view="plone.app.controlpanel.interfaces.IPloneControlPanelView"\n       manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n       class=".viewlets.OneLanguageConfiguredNoticeViewlet"\n       template="templates/languages-notice.pt"\n+      permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"\n-      permission="cmf.ManagePortal"/>\n+      zcml:condition="installed plone.app.controlpanel"\n+      />\n   <browser:viewlet\n-      zcml:condition="not-installed plone.app.controlpanel"\n       name="plone.app.multilingual.supported-languages-notice"\n       for="plone.base.interfaces.IPloneSiteRoot"\n       view="plone.base.interfaces.controlpanel.IPloneControlPanelView"\n       manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n       class=".viewlets.OneLanguageConfiguredNoticeViewlet"\n       template="templates/languages-notice.pt"\n+      permission="cmf.ManagePortal"\n       layer="..interfaces.IPloneAppMultilingualInstalled"\n-      permission="cmf.ManagePortal"/>\n+      zcml:condition="not-installed plone.app.controlpanel"\n+      />\n \n   <!-- It comes from a translation DX -->\n   <browser:viewlet\n@@ -132,8 +150,9 @@\n       manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n       class=".viewlets.AddFormIsATranslationViewlet"\n       template="templates/add-form-is-translation.pt"\n+      permission="zope.Public"\n       layer="..interfaces.IPloneAppMultilingualInstalled"\n-      permission="zope.Public"/>\n+      />\n \n   <!-- Alternate language meta tags -->\n   <browser:viewlet\n@@ -142,8 +161,9 @@\n       manager="plone.app.layout.viewlets.interfaces.IHtmlHead"\n       class=".viewlets.AlternateLanguagesViewlet"\n       template="templates/alternate-languages.pt"\n+      permission="zope.Public"\n       layer="..interfaces.IPloneAppMultilingualInstalled"\n-      permission="zope.Public"/>\n+      />\n \n   <!-- Universal Link -->\n   <browser:page\n@@ -151,7 +171,8 @@\n       for="*"\n       class=".helper_views.universal_link"\n       permission="zope.Public"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Translation Group -->\n   <browser:page\n@@ -159,7 +180,8 @@\n       for="plone.app.multilingual.interfaces.ITranslatable"\n       class=".helper_views.TGView"\n       permission="zope.Public"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Selector -->\n   <browser:page\n@@ -167,7 +189,8 @@\n       for="plone.app.layout.navigation.interfaces.INavigationRoot"\n       class=".helper_views.selector_view"\n       permission="zope.Public"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Not Translated Yet -->\n   <browser:page\n@@ -175,7 +198,8 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".helper_views.not_translated_yet"\n       permission="zope.Public"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Multilingual Map ajax helper -->\n   <browser:page\n@@ -183,75 +207,84 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.multilingualMapViewJSON"\n       permission="plone.app.multilingual.ManageTranslations"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Default browser view -->\n   <browser:view\n+      name="language-switcher"\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".switcher.LanguageSwitcher"\n-      name="language-switcher"\n       permission="zope.Public"\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n       menu="plone_displayviews"\n       title="Root language switcher"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      />\n \n   <!-- Viewlet for switching language -->\n   <browser:viewlet\n       name="plone.app.multilingual.languageselector"\n-      template="templates/languageselector.pt"\n+      for="plone.app.multilingual.interfaces.ITranslatable"\n       manager="plone.app.layout.viewlets.interfaces.IPortalHeader"\n       class=".selector.LanguageSelectorViewlet"\n+      template="templates/languageselector.pt"\n       permission="zope2.View"\n-      for="plone.app.multilingual.interfaces.ITranslatable"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- DEXTERITY -->\n   <configure zcml:condition="installed plone.dexterity">\n \n     <!-- GTranslate Service -->\n     <browser:page\n-        for="plone.dexterity.interfaces.IDexterityContent"\n         name="gtranslation_service"\n+        for="plone.dexterity.interfaces.IDexterityContent"\n         class=".translate.gtranslation_service_dexterity"\n-        permission="cmf.ModifyPortalContent"/>\n+        permission="cmf.ModifyPortalContent"\n+        />\n \n     <!-- Standard add view and form - invoked from ++addtranslation++ traverser -->\n     <adapter\n-        name="babel_view"\n+        factory=".add.DefaultMultilingualAddView"\n+        provides="zope.publisher.interfaces.browser.IBrowserPage"\n         for="Products.CMFCore.interfaces.IFolderish\n              zope.publisher.interfaces.browser.IDefaultBrowserLayer\n-        plone.dexterity.interfaces.IDexterityFTI"\n-        provides="zope.publisher.interfaces.browser.IBrowserPage"\n-        factory=".add.DefaultMultilingualAddView"/>\n+             plone.dexterity.interfaces.IDexterityFTI"\n+        name="babel_view"\n+        />\n     <class class=".add.DefaultMultilingualAddView">\n       <require\n           permission="cmf.AddPortalContent"\n-          interface="zope.publisher.interfaces.browser.IBrowserPage"/>\n+          interface="zope.publisher.interfaces.browser.IBrowserPage"\n+          />\n     </class>\n \n     <!-- Edit form -->\n     <browser:page\n-        for="plone.dexterity.interfaces.IDexterityContent"\n         name="babel_edit"\n+        for="plone.dexterity.interfaces.IDexterityContent"\n         class=".edit.DefaultMultilingualEditView"\n-        permission="cmf.ModifyPortalContent"/>\n+        permission="cmf.ModifyPortalContent"\n+        />\n \n \n     <!-- Templates for translation fields info visualization via AJAX -->\n     <browser:page\n-        for="plone.dexterity.interfaces.IDexterityContent"\n         name="babel_view"\n+        for="plone.dexterity.interfaces.IDexterityContent"\n         class=".view.DexterityBabelView"\n         template="templates/dx_babel_view.pt"\n-        permission="cmf.ModifyPortalContent"/>\n+        permission="cmf.ModifyPortalContent"\n+        />\n \n   </configure>\n \n   <browser:page\n-      for="*"\n       name="babel_utils"\n+      for="*"\n       class=".utils.BabelUtils"\n-      permission="zope2.View"/>\n+      permission="zope2.View"\n+      />\n \n   <!-- Migration Views -->\n \n@@ -261,7 +294,8 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMReindexLanguageIndex"\n       permission="cmf.ManagePortal"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Step 1 - Relocates the content if needed -->\n   <browser:page\n@@ -269,7 +303,8 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.moveContentToProperRLF"\n       permission="cmf.ManagePortal"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Step 2 - Migrate multilingual catalog info -->\n   <browser:page\n@@ -277,7 +312,8 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMView"\n       permission="cmf.ManagePortal"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- Step 3  - Cleanup tasks after migration -->\n   <browser:page\n@@ -285,7 +321,8 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".migrator.LP2PAMAfterView"\n       permission="cmf.ManagePortal"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n   <!-- For manual folder to LRF migration -->\n   <browser:page\n@@ -302,6 +339,7 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".controlpanel.MigrationViewAfter"\n       permission="plone.app.multilingual.ManageTranslations"\n-      layer="..interfaces.IPloneAppMultilingualInstalled"/>\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      />\n \n </configure>\ndiff --git a/src/plone/app/multilingual/browser/helper_views.py b/src/plone/app/multilingual/browser/helper_views.py\nindex 34c54fec3..b88d7b669 100644\n--- a/src/plone/app/multilingual/browser/helper_views.py\n+++ b/src/plone/app/multilingual/browser/helper_views.py\n@@ -1,6 +1,5 @@\n from AccessControl.SecurityManagement import getSecurityManager\n from Acquisition import aq_chain\n-from borg.localrole.interfaces import IFactoryTempFolder\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.app.multilingual.browser.selector import addQuery\n from plone.app.multilingual.browser.selector import NOT_TRANSLATED_YET_TEMPLATE\n@@ -151,9 +150,9 @@ def getClosestDestination(self):\n \n         # We are going to see if there is the preferred language translation\n         # Otherwise we get the first as context to look for translation\n-        prefered = ltool.getPreferredLanguage(self.request)\n-        if prefered in languages:\n-            context = languages[prefered]\n+        preferred = ltool.getPreferredLanguage(self.request)\n+        if preferred in languages:\n+            context = languages[preferred]\n         else:\n             context = languages[list(languages.keys())[0]]\n \ndiff --git a/src/plone/app/multilingual/browser/javascript/babel_helper.js b/src/plone/app/multilingual/browser/javascript/babel_helper.js\nindex 0792d47c7..cae87ed9b 100644\n--- a/src/plone/app/multilingual/browser/javascript/babel_helper.js\n+++ b/src/plone/app/multilingual/browser/javascript/babel_helper.js\n@@ -53,7 +53,7 @@\n             // The next calculation of padding is necessary if both elements\n             // have to be shifted down.\n             if (!first && original.prev().is(":visible")) {\n-                // Calulate distance between bottom of prev element and top\n+                // Calculate distance between bottom of prev element and top\n                 // of current element. add Padding. If > 0, add to more_padding\n                 new_distance = distance(original.prev(), original);\n                 new_distance += original_padding;\ndiff --git a/src/plone/app/multilingual/browser/javascript/mmap_helper.js b/src/plone/app/multilingual/browser/javascript/mmap_helper.js\nindex b83d220a5..0b18bdefc 100644\n--- a/src/plone/app/multilingual/browser/javascript/mmap_helper.js\n+++ b/src/plone/app/multilingual/browser/javascript/mmap_helper.js\n@@ -128,8 +128,8 @@ var load = function init(json){\n         //subtree and then handle it to the onComplete callback.\n         //Here we just use a client-side tree generator (the getTree function).\n         request: function(nodeId, level, onComplete) {\n-          var ans = getTree(nodeId, level);\n-          onComplete.onComplete(nodeId, ans);\n+          var answer = getTree(nodeId, level);\n+          onComplete.onComplete(nodeId, answer);\n         },\n \n         onBeforeCompute: function(node){\n@@ -193,7 +193,7 @@ var load = function init(json){\n         //This method is called right before plotting\n         //an edge. It\'s useful for changing an individual edge\n         //style properties before plotting it.\n-        //Edge data proprties prefixed with a dollar sign will\n+        //Edge data properties prefixed with a dollar sign will\n         //override the Edge global style properties.\n         onBeforePlotLine: function(adj){\n             if (adj.nodeFrom.selected && adj.nodeTo.selected) {\n@@ -291,4 +291,4 @@ function get_data(){\n         });\n     });\n \n-})(jQuery);\n\\ No newline at end of file\n+})(jQuery);\ndiff --git a/src/plone/app/multilingual/browser/menu.py b/src/plone/app/multilingual/browser/menu.py\nindex 5c14a5ade..fcc12ae2a 100644\n--- a/src/plone/app/multilingual/browser/menu.py\n+++ b/src/plone/app/multilingual/browser/menu.py\n@@ -14,12 +14,12 @@\n from plone.app.multilingual.interfaces import ITranslatable\n from plone.app.multilingual.interfaces import LANGUAGE_INDEPENDENT\n from plone.app.multilingual.permissions import ManageTranslations\n+from plone.base.defaultpage import is_default_page\n from plone.base.interfaces import ILanguage\n+from plone.base.utils import safe_text\n from plone.memoize import view\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.defaultpage import is_default_page\n-from plone.base.utils import safe_text\n from zope.browsermenu.menu import BrowserMenu\n from zope.browsermenu.menu import BrowserSubMenuItem\n from zope.component import getUtility\ndiff --git a/src/plone/app/multilingual/browser/migrator.py b/src/plone/app/multilingual/browser/migrator.py\nindex ff2f2eeef..3e615318e 100644\n--- a/src/plone/app/multilingual/browser/migrator.py\n+++ b/src/plone/app/multilingual/browser/migrator.py\n@@ -33,14 +33,6 @@ class IDexterityContent(Interface):\n         pass\n \n \n-try:\n-    from Products.Archetypes.interfaces import IBaseObject\n-except ImportError:\n-\n-    class IBaseObject(Interface):\n-        pass\n-\n-\n with warnings.catch_warnings():\n     warnings.filterwarnings(\n         "ignore",\n@@ -145,9 +137,7 @@ class moveContentToProperRLF(BrowserView):\n \n     def findContent(self, content, depth):\n         # only handle portal content\n-        if not IDexterityContent.providedBy(content) and not IBaseObject.providedBy(\n-            content\n-        ):\n+        if not IDexterityContent.providedBy(content):\n             logger.warning(\n                 "SKIP non-portal content %s (%s)"\n                 % (content.absolute_url(), content.meta_type)\n@@ -216,13 +206,13 @@ def step1andstep2(self):\n                     # Test if the id already exist previously\n \n                     try:\n-                        cutted = parent.manage_cutObjects(content.getId())\n+                        obj_cut = parent.manage_cutObjects(content.getId())\n                     except ResourceLockedError:\n                         lockable = ILockable(content)\n                         lockable.unlock()\n-                        cutted = parent.manage_cutObjects(content.getId())\n+                        obj_cut = parent.manage_cutObjects(content.getId())\n                     try:\n-                        target_folder.manage_pasteObjects(cutted)\n+                        target_folder.manage_pasteObjects(obj_cut)\n                         info_str = "Step 2: Moved object {} to folder {}".format(\n                             "/".join(content.getPhysicalPath()),\n                             "/".join(target_folder.getPhysicalPath()),\n@@ -277,14 +267,14 @@ def step3(self):\n                     old_path = brain.getPath()\n \n                     try:\n-                        cutted = self.context.manage_cutObjects(brain.id)\n+                        obj_cut = self.context.manage_cutObjects(brain.id)\n                     except ResourceLockedError:\n                         content = brain.getObject()\n                         lockable = ILockable(content)\n                         lockable.unlock()\n-                        cutted = self.context.manage_cutObjects(brain.id)\n+                        obj_cut = self.context.manage_cutObjects(brain.id)\n                     try:\n-                        folder.manage_pasteObjects(cutted)\n+                        folder.manage_pasteObjects(obj_cut)\n                         info_str = "Moved object %s to language root folder " "%s" % (\n                             old_path,\n                             lang,\ndiff --git a/src/plone/app/multilingual/browser/selector.py b/src/plone/app/multilingual/browser/selector.py\nindex 8ded4e9e0..5f6fd0fab 100644\n--- a/src/plone/app/multilingual/browser/selector.py\n+++ b/src/plone/app/multilingual/browser/selector.py\n@@ -110,7 +110,7 @@ def languages(self):\n                 site.absolute_url().rstrip("/")\n                 + "/@@multilingual-selector/%s/%s"\n                 % (translation_group, lang_info["code"]),\n-                **query_extras\n+                **query_extras,\n             )\n             results.append(data)\n         return results\ndiff --git a/src/plone/app/multilingual/browser/setup.py b/src/plone/app/multilingual/browser/setup.py\nindex 06e9c259d..88f0131d3 100644\n--- a/src/plone/app/multilingual/browser/setup.py\n+++ b/src/plone/app/multilingual/browser/setup.py\n@@ -7,11 +7,11 @@\n from plone.app.multilingual.interfaces import LANGUAGE_INDEPENDENT\n from plone.app.multilingual.subscriber import set_recursive_language\n from plone.base.interfaces import ILanguage\n+from plone.base.utils import unrestricted_construct_instance\n from plone.dexterity.interfaces import IDexterityFTI\n from plone.i18n.locales.languages import _combinedlanguagelist\n from plone.i18n.locales.languages import _languagelist\n from Products.CMFCore.utils import getToolByName\n-from plone.base.utils import unrestricted_construct_instance\n from Products.Five import BrowserView\n from zope.component.hooks import getSite\n from zope.event import notify\ndiff --git a/src/plone/app/multilingual/browser/templates/add-form-is-translation.pt b/src/plone/app/multilingual/browser/templates/add-form-is-translation.pt\nindex 67af48567..cbe21604c 100644\n--- a/src/plone/app/multilingual/browser/templates/add-form-is-translation.pt\n+++ b/src/plone/app/multilingual/browser/templates/add-form-is-translation.pt\n@@ -1,27 +1,46 @@\n <div class="container">\n-    <div class="row">\n-        <div class="alert alert-info col-12" role="alert">\n-            <strong i18n:translate="" i18n:domain="plone">\n+  <div class="row">\n+    <div class="alert alert-info col-12"\n+         role="alert"\n+    >\n+      <strong i18n:domain="plone"\n+              i18n:translate=""\n+      >\n                 Info\n-            </strong>\n-            <tal:block i18n:domain="plone"\n-                     i18n:translate="add-form-is-translation">\n+      </strong>\n+      <tal:block i18n:domain="plone"\n+                 i18n:translate="add-form-is-translation"\n+      >\n                 This object is going to be a translation to\n-                <span i18n:name="language" tal:replace="python:view.language_name(view.language())"></span>\n+        <span tal:replace="python:view.language_name(view.language())"\n+              i18n:name="language"\n+        ></span>\n                 from:\n-            </tal:block>\n-            <ul>\n-                <li tal:repeat="origin view/origin">\n-                    <span tal:content="python:view.language_name(origin.Language)"></span>:\n-                    <a href="#"\n-                       class="link-overlay" tal:attributes="href origin/getURL">\n-                        <span tal:content="origin/Title"></span></a></li>\n-            </ul>\n-            <span i18n:domain="plone" i18n:translate="create-object-without-translation">\n+      </tal:block>\n+      <ul>\n+        <li tal:repeat="origin view/origin">\n+          <span tal:content="python:view.language_name(origin.Language)"></span>:\n+          <a class="link-overlay"\n+             href="#"\n+             tal:attributes="\n+               href origin/getURL;\n+             "\n+          >\n+            <span tal:content="origin/Title"></span></a></li>\n+      </ul>\n+      <span i18n:domain="plone"\n+            i18n:translate="create-object-without-translation"\n+      >\n       If you want to create this object without being a translation press\n-      <a href="#"\n-         class="link-overlay" i18n:name="url" tal:attributes="href view/returnURL" i18n:translate="">here</a>\n-    </span>\n-        </div>\n+        <a class="link-overlay"\n+           href="#"\n+           tal:attributes="\n+             href view/returnURL;\n+           "\n+           i18n:name="url"\n+           i18n:translate=""\n+        >here</a>\n+      </span>\n     </div>\n+  </div>\n </div>\ndiff --git a/src/plone/app/multilingual/browser/templates/alternate-languages.pt b/src/plone/app/multilingual/browser/templates/alternate-languages.pt\nindex 7196b960c..1f327b2d9 100644\n--- a/src/plone/app/multilingual/browser/templates/alternate-languages.pt\n+++ b/src/plone/app/multilingual/browser/templates/alternate-languages.pt\n@@ -1,4 +1,7 @@\n <link rel="alternate"\n       tal:repeat="item view/alternates"\n-      tal:attributes="hreflang item/lang;\n-                      href string:${item/url}" />\n+      tal:attributes="\n+        hreflang item/lang;\n+        href string:${item/url};\n+      "\n+/>\ndiff --git a/src/plone/app/multilingual/browser/templates/cleanup.pt b/src/plone/app/multilingual/browser/templates/cleanup.pt\nindex 3bc12e196..4442cf909 100644\n--- a/src/plone/app/multilingual/browser/templates/cleanup.pt\n+++ b/src/plone/app/multilingual/browser/templates/cleanup.pt\n@@ -1,16 +1,18 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:block metal:fill-slot="prefs_configlet_main">\n+    <metal:block metal:fill-slot="prefs_configlet_main">\n \n-<script type="text/javascript">\n+      <script type="text/javascript">\n (function($) {\n \n     $().ready(function() {\n@@ -29,83 +31,101 @@\n     });\n \n })(jQuery);\n-</script>\n+      </script>\n \n \n-    <div i18n:domain="plone">\n-        <ul class="contentViews" id="content-views">\n+      <div i18n:domain="plone">\n+        <ul class="contentViews"\n+            id="content-views"\n+        >\n           <li>\n             <a href=""\n-               tal:attributes="href string:${portal_url}/@@language-controlpanel"\n-               i18n:translate="label_general">General</a>\n+               tal:attributes="\n+                 href string:${portal_url}/@@language-controlpanel;\n+               "\n+               i18n:translate="label_general"\n+            >General</a>\n           </li>\n           <li>\n             <a href=""\n-               tal:attributes="href string:${portal_url}/@@multilingual-map"\n-               i18n:translate="label_translation_map">Translation Map</a>\n+               tal:attributes="\n+                 href string:${portal_url}/@@multilingual-map;\n+               "\n+               i18n:translate="label_translation_map"\n+            >Translation Map</a>\n           </li>\n           <li class="selected">\n             <a href=""\n-              tal:attributes="href string:${portal_url}/@@lp-migration-after"\n-              i18n:translate="label_cleanup">Cleanup actions</a>\n+               tal:attributes="\n+                 href string:${portal_url}/@@lp-migration-after;\n+               "\n+               i18n:translate="label_cleanup"\n+            >Cleanup actions</a>\n           </li>\n         </ul>\n-    </div>\n+      </div>\n \n \n-        <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n         Portal status message\n-        </div>\n+      </div>\n \n-        <div class="content-core">\n+      <div class="content-core">\n \n-            <h1 class="documentFirstHeading"\n-                i18n:domain="plone"\n-                i18n:translate="heading_migration_after">Products.LinguaPlone After Migration</h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:domain="plone"\n+            i18n:translate="heading_migration_after"\n+        >Products.LinguaPlone After Migration</h1>\n \n-            <p i18n:translate="description_migrate_after"\n-              i18n:domain="plone">\n+        <p i18n:domain="plone"\n+           i18n:translate="description_migrate_after"\n+        >\n                 It can happen that there are relations left that contain\n                 LinguaPlone relations. By executing this step, the catalog\n                 gets reset and rebuilt. It CAN happen that things go bad.\n-                In that case relations get lost. It is therefor important that\n+                In that case relations get lost. It is therefore important that\n                 you have a backup!\n-            </p>\n-\n-            <form name="cleanup" tal:attributes="action request/URL" method="post">\n-\n-                <div class="formControls">\n-\n-                  <input\n-                        id="resetrelations"\n-                        type="submit"\n-                        name="form.button.Cleanup"\n-                        class="destructive"\n-                        value="Cleanup"\n-                        i18n:attributes="value" />\n-                  <label i18n:translate="label_catalog_reload">Catalog reload</label>\n-\n-                  <span class="clearfix" />\n-                  <input\n-                        id="move"\n-                        type="submit"\n-                        name="form.button.Move"\n-                        class="destructive"\n-                        value="Move"\n-                        i18n:attributes="value" />\n-                  <label i18n:translate="label_move_content_to_languages">Move content to its corresponding language root folder</label>\n-                </div>\n-\n-                <input tal:replace="structure context/@@authenticator/authenticator" />\n-\n-            </form>\n-\n-            <div class="results">\n-              <!-- The migration results -->\n-            </div>\n+        </p>\n+\n+        <form method="post"\n+              name="cleanup"\n+              tal:attributes="\n+                action request/URL;\n+              "\n+        >\n+\n+          <div class="formControls">\n+\n+            <input class="destructive"\n+                   id="resetrelations"\n+                   name="form.button.Cleanup"\n+                   type="submit"\n+                   value="Cleanup"\n+                   i18n:attributes="value"\n+            />\n+            <label i18n:translate="label_catalog_reload">Catalog reload</label>\n+\n+            <span class="clearfix"></span>\n+            <input class="destructive"\n+                   id="move"\n+                   name="form.button.Move"\n+                   type="submit"\n+                   value="Move"\n+                   i18n:attributes="value"\n+            />\n+            <label i18n:translate="label_move_content_to_languages">Move content to its corresponding language root folder</label>\n+          </div>\n+\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n+\n+        </form>\n+\n+        <div class="results">\n+          <!-- The migration results -->\n         </div>\n+      </div>\n \n-</metal:block>\n+    </metal:block>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/cleanup_results.pt b/src/plone/app/multilingual/browser/templates/cleanup_results.pt\nindex eae4ea91b..88411e548 100644\n--- a/src/plone/app/multilingual/browser/templates/cleanup_results.pt\n+++ b/src/plone/app/multilingual/browser/templates/cleanup_results.pt\n@@ -1,39 +1,44 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:prefs fill-slot="prefs_configlet_main">\n+    <metal:prefs fill-slot="prefs_configlet_main">\n \n-<div id="results">\n+      <div id="results">\n \n-<div class="resultInfo">\n-    <h2 i18n:translate=""\n-        tal:content="view/stepinfo">\n+        <div class="resultInfo">\n+          <h2 tal:content="view/stepinfo"\n+              i18n:translate=""\n+          >\n         After migration relation cleanup\n-    </h2>\n+          </h2>\n \n-    <span i18n:translate="label_total_relations">\n+          <span i18n:translate="label_total_relations">\n         Number of relations touched:\n-    </span>\n-    <span tal:content="view/total">Number of objects</span>\n-</div>\n-<div tal:condition="view/bad">\n-    <span i18n:translate="label_bad_relations">\n+          </span>\n+          <span tal:content="view/total">Number of objects</span>\n+        </div>\n+        <div tal:condition="view/bad">\n+          <span i18n:translate="label_bad_relations">\n         Unfortunately a number of relations could not be translated and\n         are lost!\n         here is some debug information:\n-    </span>\n-    <span tal:repeat="one_bad view/bad" tal:content="one_bad">\n+          </span>\n+          <span tal:repeat="one_bad view/bad"\n+                tal:content="one_bad"\n+          >\n         Bad relation\n-    </span>\n-</div>\n-</div>\n-</metal:prefs>\n-</body>\n+          </span>\n+        </div>\n+      </div>\n+    </metal:prefs>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/controlpanel.pt b/src/plone/app/multilingual/browser/templates/controlpanel.pt\nindex b13b2dd9f..cab97d88d 100644\n--- a/src/plone/app/multilingual/browser/templates/controlpanel.pt\n+++ b/src/plone/app/multilingual/browser/templates/controlpanel.pt\n@@ -1,48 +1,67 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="here/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<tal:main metal:fill-slot="prefs_configlet_main">\n+    <tal:main metal:fill-slot="prefs_configlet_main">\n \n-  <header>\n-    <a id="setup-link" class="link-parent"\n-       tal:attributes="href string:$portal_url/@@overview-controlpanel"\n-       i18n:translate="">\n+      <header>\n+        <a class="link-parent"\n+           id="setup-link"\n+           tal:attributes="\n+             href string:$portal_url/@@overview-controlpanel;\n+           "\n+           i18n:translate=""\n+        >\n         Site Setup\n-    </a>\n+        </a>\n \n-    <h1 class="documentFirstHeading" tal:content="view/label">View Title</h1>\n+        <h1 class="documentFirstHeading"\n+            tal:content="view/label"\n+        >View Title</h1>\n \n-    <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+        <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n       Portal status message\n-    </div>\n-  </header>\n-  <div id="content-core">\n-      <div id="layout-contents">\n-          <span tal:replace="structure view/contents" />\n-      </div>\n-      <div class="mt-4">\n-        <p i18n:translate="">\n+        </div>\n+      </header>\n+      <div id="content-core">\n+        <div id="layout-contents">\n+          <span tal:replace="structure view/contents"></span>\n+        </div>\n+        <div class="mt-4">\n+          <p i18n:translate="">\n           The\n-          <a i18n:name="url" i18n:translate="" tal:attributes="href string:${context/absolute_url}/multilingual-map">multilingual map view\n-          </a>\n+            <a tal:attributes="\n+                 href string:${context/absolute_url}/multilingual-map;\n+               "\n+               i18n:name="url"\n+               i18n:translate=""\n+            >multilingual map view\n+            </a>\n           allows you to view in a graphical manner the already translated items and its relations.\n-        </p>\n-        <p i18n:translate=""\n-            tal:condition="view/isLPinstalled">\n+          </p>\n+          <p tal:condition="view/isLPinstalled"\n+             i18n:translate=""\n+          >\n           In case you want to migrate from Products.LinguaPlone access to the\n-          <a i18n:name="url" i18n:translate="" tal:attributes="href string:${context/absolute_url}/lp-migration">migration procedure.\n-          </a>\n-        </p>\n+            <a tal:attributes="\n+                 href string:${context/absolute_url}/lp-migration;\n+               "\n+               i18n:name="url"\n+               i18n:translate=""\n+            >migration procedure.\n+            </a>\n+          </p>\n+        </div>\n       </div>\n-  </div>\n \n-</tal:main>\n-</body>\n+    </tal:main>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/dexterity_edit.pt b/src/plone/app/multilingual/browser/templates/dexterity_edit.pt\nindex 90954606c..1db6a74f0 100644\n--- a/src/plone/app/multilingual/browser/templates/dexterity_edit.pt\n+++ b/src/plone/app/multilingual/browser/templates/dexterity_edit.pt\n@@ -1,50 +1,88 @@\n-<div class=\'row\' id=\'babel-edit\'\n-      xmlns="http://www.w3.org/1999/xhtml"\n-      xml:lang="en"\n-      lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      i18n:domain="plone"\n-      tal:define="pamutils context/@@babel_utils;">\n+<div xmlns="http://www.w3.org/1999/xhtml"\n+     xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+     xmlns:metal="http://xml.zope.org/namespaces/metal"\n+     xmlns:tal="http://xml.zope.org/namespaces/tal"\n+     class="row"\n+     id="babel-edit"\n+     lang="en"\n+     xml:lang="en"\n+     tal:define="\n+       pamutils context/@@babel_utils;\n+     "\n+     i18n:domain="plone"\n+>\n \n-    <script src="++resource++plone.app.multilingual.javascript/babel_helper.js"></script>\n-    <input type="hidden" id="url_translate" value="" tal:attributes="value context/absolute_url"/>\n-    <input type="hidden" id="gtranslate_service_available" value="" tal:attributes="value pamutils/gtenabled"/>\n+  <script src="++resource++plone.app.multilingual.javascript/babel_helper.js"></script>\n+  <input id="url_translate"\n+         type="hidden"\n+         value=""\n+         tal:attributes="\n+           value context/absolute_url;\n+         "\n+  />\n+  <input id="gtranslate_service_available"\n+         type="hidden"\n+         value=""\n+         tal:attributes="\n+           value pamutils/gtenabled;\n+         "\n+  />\n \n-    <div class=\'col-md-6\'>\n-        <h2 i18n:translate="heading_available_translations">Available translations for this content</h2>\n-        <div id="trans-selector"\n-             tal:define="languages pamutils/translated_languages;\n-             max_nr_of_buttons view/max_nr_of_buttons">\n-          <div class="btn-group"\n-            tal:define="use_dropdown python:max_nr_of_buttons and max_nr_of_buttons < len(languages)">\n-            <select name="language_selector" tal:condition="use_dropdown">\n-              <option tal:repeat="lang languages"\n-                tal:attributes="value string:${lang/obj/absolute_url}/babel_view;\n-                                      selected python:lang[\'isDefault\'] and \'selected\' or \'\';\n-                                      id string:selection-${lang/code}"\n-                tal:content="lang/info/native|lang/info/name">Language</option>\n-            </select>\n-            <tal:block repeat="lang languages" tal:condition="not:use_dropdown">\n-              <button class="btn"\n-                      tal:attributes="data-url string:${lang/obj/absolute_url}/babel_view;\n-                                      class python:lang[\'isDefault\'] and \'btn active\' or \'btn\';\n-                                      name string:button-${lang/info/name}"\n-                      tal:content="lang/info/native|lang/info/name">Language</button>\n-            </tal:block>\n-          </div>\n-        </div>\n-        <div id="frame-content" i18n:translate="label_translations_should_be_here">\n+  <div class="col-md-6">\n+    <h2 i18n:translate="heading_available_translations">Available translations for this content</h2>\n+    <div id="trans-selector"\n+         tal:define="\n+           languages pamutils/translated_languages;\n+           max_nr_of_buttons view/max_nr_of_buttons;\n+         "\n+    >\n+      <div class="btn-group"\n+           tal:define="\n+             use_dropdown python:max_nr_of_buttons and max_nr_of_buttons &lt; len(languages);\n+           "\n+      >\n+        <select name="language_selector"\n+                tal:condition="use_dropdown"\n+        >\n+          <option tal:repeat="lang languages"\n+                  tal:content="lang/info/native|lang/info/name"\n+                  tal:attributes="\n+                    value string:${lang/obj/absolute_url}/babel_view;\n+                    selected python:lang[\'isDefault\'] and \'selected\' or \'\';\n+                    id string:selection-${lang/code};\n+                  "\n+          >Language</option>\n+        </select>\n+        <tal:block tal:condition="not:use_dropdown"\n+                   repeat="lang languages"\n+        >\n+          <button class="btn"\n+                  tal:content="lang/info/native|lang/info/name"\n+                  tal:attributes="\n+                    data-url string:${lang/obj/absolute_url}/babel_view;\n+                    class python:lang[\'isDefault\'] and \'btn active\' or \'btn\';\n+                    name string:button-${lang/info/name};\n+                  "\n+          >Language</button>\n+        </tal:block>\n+      </div>\n+    </div>\n+    <div id="frame-content"\n+         i18n:translate="label_translations_should_be_here"\n+    >\n             The available translations for this content should be here\n-        </div>\n     </div>\n-    <div class=\'col-md-6\'>\n+  </div>\n+  <div class="col-md-6">\n     <div id="header-translation">\n-        <h2 i18n:translate="translation_to">Translation to <span i18n:name="language" tal:content="pamutils/current_language_name" tal:omit-tag="">es</span></h2>\n+      <h2 i18n:translate="translation_to">Translation to\n+        <span tal:content="pamutils/current_language_name"\n+              tal:omit-tag=""\n+              i18n:name="language"\n+        >es</span></h2>\n     </div>\n     <div id="form-target">\n       <tal:block content="structure view/babel_content">Content edit</tal:block>\n     </div>\n-    </div>\n+  </div>\n </div>\ndiff --git a/src/plone/app/multilingual/browser/templates/disconnect_translation.pt b/src/plone/app/multilingual/browser/templates/disconnect_translation.pt\nindex 18cbe0f3d..5c06663fe 100644\n--- a/src/plone/app/multilingual/browser/templates/disconnect_translation.pt\n+++ b/src/plone/app/multilingual/browser/templates/disconnect_translation.pt\n@@ -1,35 +1,61 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-    <metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n-    <body>\n+  <body>\n \n-        <metal:main fill-slot="main">\n+    <metal:main fill-slot="main">\n \n-        <h1 class="documentFirstHeading"\n-            i18n:translate="alert_disconnect_translation">\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="alert_disconnect_translation"\n+      >\n             Disconnect translation\n-        </h1>\n-\n-        <div id="content-core">\n-\n-            <form action="" tal:attributes="action string:${context/absolute_url}/disconnect_translation">\n-                <p i18n:translate="confirm_translation_disconnect">Do you really want to disconnect this translation?</p>\n-                <input type="hidden" name="came_from" tal:attributes="value context/REQUEST/form/came_from">\n-                <input type="hidden" name="language" tal:attributes="value context/REQUEST/form/language">\n-                <input type="hidden" name="submitted" value="1">\n-                <span tal:replace="structure context/@@authenticator/authenticator"/>\n-                <button type="submit" i18n:translate="label_disconnect">Disconnect</button>\n-            </form>\n-\n-        </div>\n-\n-        </metal:main>\n-    </body>\n+      </h1>\n+\n+      <div id="content-core">\n+\n+        <form action=""\n+              tal:attributes="\n+                action string:${context/absolute_url}/disconnect_translation;\n+              "\n+        >\n+          <p i18n:translate="confirm_translation_disconnect">Do you really want to disconnect this translation?</p>\n+          <input name="came_from"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value context/REQUEST/form/came_from;\n+                 "\n+          />\n+          <input name="language"\n+                 type="hidden"\n+                 tal:attributes="\n+                   value context/REQUEST/form/language;\n+                 "\n+          />\n+          <input name="submitted"\n+                 type="hidden"\n+                 value="1"\n+          />\n+          <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+          <button type="submit"\n+                  i18n:translate="label_disconnect"\n+          >Disconnect</button>\n+        </form>\n+\n+      </div>\n+\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/dx_babel_view.pt b/src/plone/app/multilingual/browser/templates/dx_babel_view.pt\nindex 3fc7b7943..94b86a499 100644\n--- a/src/plone/app/multilingual/browser/templates/dx_babel_view.pt\n+++ b/src/plone/app/multilingual/browser/templates/dx_babel_view.pt\n@@ -1,34 +1,56 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n-      i18n:domain="plone">\n-<body>\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<div id="view_language" tal:content="context/language">\n-</div>\n-\n-<tal:block repeat="widget view/widgets/values">\n-    <div class="field"  id=""\n-         tal:attributes="id python:widget.__name__; rel python:widget.__name__">\n-        <label tal:content="widget/label" />\n-        <br />\n-        <div class="value" tal:content="structure widget/render" />\n+    <div id="view_language"\n+         tal:content="context/language"\n+    >\n     </div>\n-</tal:block>\n \n-<fieldset tal:repeat="group view/groups"\n-          tal:attributes="id python:\'\'.join((group.prefix, \'groups.\', group.__name__)).replace(\'.\', \'-\')">\n-    <legend tal:content="group/label" />\n-    <tal:block repeat="widget group/widgets/values">\n-    <div class="field" rel="" id="" tal:attributes="id python:widget.__name__; rel python:widget.__name__" tal:condition="python:widget.__name__!=\'IDublinCore.language\'">\n-        <label tal:content="widget/label" />\n+    <tal:block repeat="widget view/widgets/values">\n+      <div class="field"\n+           id=""\n+           tal:attributes="\n+             id python:widget.__name__;\n+             rel python:widget.__name__;\n+           "\n+      >\n+        <label tal:content="widget/label"></label>\n         <br />\n-        <div tal:content="structure widget/render" />\n-    </div>\n-  </tal:block>\n-</fieldset>\n+        <div class="value"\n+             tal:content="structure widget/render"\n+        ></div>\n+      </div>\n+    </tal:block>\n+\n+    <fieldset tal:repeat="group view/groups"\n+              tal:attributes="\n+                id python:\'\'.join((group.prefix, \'groups.\', group.__name__)).replace(\'.\', \'-\');\n+              "\n+    >\n+      <legend tal:content="group/label"></legend>\n+      <tal:block repeat="widget group/widgets/values">\n+        <div class="field"\n+             id=""\n+             rel=""\n+             tal:condition="python:widget.__name__!=\'IDublinCore.language\'"\n+             tal:attributes="\n+               id python:widget.__name__;\n+               rel python:widget.__name__;\n+             "\n+        >\n+          <label tal:content="widget/label"></label>\n+          <br />\n+          <div tal:content="structure widget/render"></div>\n+        </div>\n+      </tal:block>\n+    </fieldset>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/languages-notice.pt b/src/plone/app/multilingual/browser/templates/languages-notice.pt\nindex 5b485d46a..d755d53a3 100644\n--- a/src/plone/app/multilingual/browser/templates/languages-notice.pt\n+++ b/src/plone/app/multilingual/browser/templates/languages-notice.pt\n@@ -1,15 +1,29 @@\n-<dl class="portalMessage warning" role="status">\n-  <dt i18n:translate="" i18n:domain="plone">\n+<dl class="portalMessage warning"\n+    role="status"\n+>\n+  <dt i18n:domain="plone"\n+      i18n:translate=""\n+  >\n     Warning\n   </dt>\n-  <dd id="multilingual-languages-notice" i18n:domain="plone"\n-      tal:define="portal_url context/portal_url"\n-      i18n:translate="not_configured_for_multiple_languages">\n+  <dd id="multilingual-languages-notice"\n+      tal:define="\n+        portal_url context/portal_url;\n+      "\n+      i18n:domain="plone"\n+      i18n:translate="not_configured_for_multiple_languages"\n+  >\n     Your site is not configured with more than one allowed language,\n     but the add-on that provides support for content in multiple\n     language is installed. You can add one or more additional\n-    languages from the <a href="" i18n:translate="" i18n:name="control-panel-link"\n-    tal:attributes="href\n-    string:${portal_url}/@@language-controlpanel">Language control panel</a>.\n+    languages from the\n+    <a href=""\n+       tal:attributes="\n+         href\n+    string:${portal_url}/@@language-controlpanel;\n+       "\n+       i18n:name="control-panel-link"\n+       i18n:translate=""\n+    >Language control panel</a>.\n   </dd>\n </dl>\ndiff --git a/src/plone/app/multilingual/browser/templates/languageselector.pt b/src/plone/app/multilingual/browser/templates/languageselector.pt\nindex a815e56c4..544579e2a 100644\n--- a/src/plone/app/multilingual/browser/templates/languageselector.pt\n+++ b/src/plone/app/multilingual/browser/templates/languageselector.pt\n@@ -1,34 +1,44 @@\n <tal:language tal:condition="view/available">\n-  <ul\n-      id="portal-languageselector"\n-      tal:define="showFlags view/showFlags;\n-                languages view/languages;\n-                portal_url view/portal_url;\n-                icons python:context.restrictedTraverse(\'@@iconresolver\');">\n+  <ul id="portal-languageselector"\n+      tal:define="\n+        showFlags view/showFlags;\n+        languages view/languages;\n+        portal_url view/portal_url;\n+        icons python:context.restrictedTraverse(\'@@iconresolver\');\n+      "\n+  >\n     <tal:language repeat="lang languages">\n-      <li\n-          tal:define="code lang/code;\n-                    selected lang/selected;\n-                    codeclass string:language-${code};\n-                    current python: selected and \'currentLanguage \' or \'\';"\n-          tal:attributes="class string:${current}${codeclass}">\n-        <a\n-            href=""\n-            tal:define="flag lang/flag|nothing;\n-                       name lang/native|lang/name;\n-                       showflag python:showFlags and flag;"\n-            tal:attributes="href lang/url;\n-                           title name">\n+      <li tal:define="\n+            code lang/code;\n+            selected lang/selected;\n+            codeclass string:language-${code};\n+            current python: selected and \'currentLanguage \' or \'\';\n+          "\n+          tal:attributes="\n+            class string:${current}${codeclass};\n+          "\n+      >\n+        <a href=""\n+           tal:define="\n+             flag lang/flag|nothing;\n+             name lang/native|lang/name;\n+             showflag python:showFlags and flag;\n+           "\n+           tal:attributes="\n+             href lang/url;\n+             title name;\n+           "\n+        >\n           <tal:flag condition="showflag">\n             <tal:flag condition="showflag">\n               <img tal:replace="structure python:icons.tag(flag, tag_class=\'plone-icon-flag\')" />\n             </tal:flag>\n           </tal:flag>\n-          <tal:nonflag\n-              condition="not: showflag"\n-              replace="name">language name</tal:nonflag>\n+          <tal:nonflag condition="not: showflag"\n+                       replace="name"\n+          >language name</tal:nonflag>\n         </a>\n       </li>\n     </tal:language>\n   </ul>\n-</tal:language>\n\\ No newline at end of file\n+</tal:language>\ndiff --git a/src/plone/app/multilingual/browser/templates/migration.pt b/src/plone/app/multilingual/browser/templates/migration.pt\nindex 20eef7adc..205cdd59f 100644\n--- a/src/plone/app/multilingual/browser/templates/migration.pt\n+++ b/src/plone/app/multilingual/browser/templates/migration.pt\n@@ -1,16 +1,18 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:block metal:fill-slot="prefs_configlet_main">\n+    <metal:block metal:fill-slot="prefs_configlet_main">\n \n-  <script type="text/javascript">\n+      <script type="text/javascript">\n   (function($) {\n \n       $().ready(function() {\n@@ -56,47 +58,57 @@\n       });\n \n   })(jQuery);\n-  </script>\n+      </script>\n \n-  <style>\n+      <style>\n   .results {\n     border: 1px solid #ccc;\n     padding: 10px;\n     background-color: #eee;\n   }\n \n-  </style>\n-\n-        <div i18n:domain="plone">\n-            <ul>\n-              <li>\n-                <a href=""\n-                   tal:attributes="href string:${portal_url}/@@language-controlpanel"\n-                   i18n:translate="label_general">General</a>\n-              </li>\n-              <li>\n-                <a href=""\n-                   tal:attributes="href string:${portal_url}/@@multilingual-map"\n-                   i18n:translate="label_translation_map">Translation Map</a>\n-              </li>\n-              <li class="selected">\n-                <a href=""\n-                   tal:attributes="href string:${portal_url}/@@lp-migration"\n-                   i18n:translate="label_migration">Migration</a>\n-              </li>\n-            </ul>\n-        </div>\n-\n-        <h1 class="documentFirstHeading"\n-            i18n:translate="heading_migration">Products.LinguaPlone Migration</h1>\n-\n-        <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      </style>\n+\n+      <div i18n:domain="plone">\n+        <ul>\n+          <li>\n+            <a href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@language-controlpanel;\n+               "\n+               i18n:translate="label_general"\n+            >General</a>\n+          </li>\n+          <li>\n+            <a href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@multilingual-map;\n+               "\n+               i18n:translate="label_translation_map"\n+            >Translation Map</a>\n+          </li>\n+          <li class="selected">\n+            <a href=""\n+               tal:attributes="\n+                 href string:${portal_url}/@@lp-migration;\n+               "\n+               i18n:translate="label_migration"\n+            >Migration</a>\n+          </li>\n+        </ul>\n+      </div>\n+\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="heading_migration"\n+      >Products.LinguaPlone Migration</h1>\n+\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n         Portal status message\n-        </div>\n+      </div>\n \n-        <div id="content-core">\n+      <div id="content-core">\n \n-            <p i18n:translate="description_migrate">\n+        <p i18n:translate="description_migrate">\n \n                 The migration process is divided into four steps, listed\n                 below. Each one of the steps has a well defined purpose\n@@ -104,49 +116,54 @@\n                 one of it and do not try to run it on production servers\n                 without testing it previously.\n \n-            </p>\n+        </p>\n \n-            <form\n-                  id="lp-migration-reindex-content"\n-                  tal:attributes="action string:${portal_url}/reindex-language-index"\n-                  method="post">\n-              <fieldset>\n-                <legend i18n:translate="legend_reindex_language_index">\n+        <form id="lp-migration-reindex-content"\n+              method="post"\n+              tal:attributes="\n+                action string:${portal_url}/reindex-language-index;\n+              "\n+        >\n+          <fieldset>\n+            <legend i18n:translate="legend_reindex_language_index">\n                   Optional step - Reindex the Language index\n-                </legend>\n+            </legend>\n \n-                <p i18n:translate="help_reindex_language_index">\n+            <p i18n:translate="help_reindex_language_index">\n \n                  The migration of LinguaPlone content depends on an up-to-date Language\n                  index. Use this step to refresh this index.\n                  Warning: Depending on the number of items in your site, this can take\n                  a considerable amount of time.\n \n-                </p>\n+            </p>\n \n-                <div class="formControls">\n-                    <input\n-                        type="submit"\n-                        name="form.button.reindex-language-index"\n-                        class="destructive"\n-                        value="Reindex"\n-                        i18n:attributes="value" />\n-                </div>\n+            <div class="formControls">\n+              <input class="destructive"\n+                     name="form.button.reindex-language-index"\n+                     type="submit"\n+                     value="Reindex"\n+                     i18n:attributes="value"\n+              />\n+            </div>\n \n-                <input tal:replace="structure context/@@authenticator/authenticator" />\n+            <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-              </fieldset>\n-            </form>\n+          </fieldset>\n+        </form>\n \n-            <form id="lp-migration-relocate-content"\n-                  tal:attributes="action string:${portal_url}/relocate-content"\n-                  method="post">\n-              <fieldset>\n-                <legend i18n:translate="legend_relocate_content">\n+        <form id="lp-migration-relocate-content"\n+              method="post"\n+              tal:attributes="\n+                action string:${portal_url}/relocate-content;\n+              "\n+        >\n+          <fieldset>\n+            <legend i18n:translate="legend_relocate_content">\n                   Step 1 - Relocate content to the proper root language folder\n-                </legend>\n+            </legend>\n \n-                <p i18n:translate="description_relocate_content">\n+            <p i18n:translate="description_relocate_content">\n                   This step will move the site\'s content to its corresponding\n                   root language folder and previously will make a search for\n                   misplaced content through the site\'s content tree and will\n@@ -155,120 +172,133 @@\n                   Make sure you have previously configured your site\'s\n                   languages properly in the \'Site Languages\' tab of the\n                   \'Languages\' control panel.\n-                </p>\n+            </p>\n \n-                <div>\n-                    <p i18n:translate="description_relocate_blacklist">\n+            <div>\n+              <p i18n:translate="description_relocate_blacklist">\n                         Use this field to define portal types that will not be traversed for finding content to move.\n                         All content of those types will be moved with all contained sub-items. This is useful\n                         for content types that are themselves translatable, but contain sub-content that is not\n-                        translatable or does not have a language set.<br />\n+                translatable or does not have a language set.<br />\n                         This list is pre-filled with some portal types, but you can add additional ones if needed,\n                         one per line.\n-                    </p>\n-                    <textarea name="blacklist" id="blacklist" rows="5" tal:content="python: \'\\n\'.join(view.portal_types_blacklist)">\n-                    </textarea>\n-                </div>\n-\n-                <div class="formControls">\n-                    <input\n-                        type="submit"\n-                        name="form.button.relocate-content"\n-                        class="destructive"\n-                        value="Relocate"\n-                        i18n:attributes="value" />\n-                </div>\n-\n-                <input tal:replace="structure context/@@authenticator/authenticator" />\n-\n-              </fieldset>\n-            </form>\n-\n-            <form id="lp-migration-transfer-catalog"\n-                  tal:attributes="action string:${portal_url}/transfer-lp-catalog"\n-                  method="post">\n-              <fieldset>\n-                <legend i18n:translate="legend_transfer_multilingual_catalog_info">\n+              </p>\n+              <textarea id="blacklist"\n+                        name="blacklist"\n+                        rows="5"\n+                        tal:content="python: \'\\n\'.join(view.portal_types_blacklist)"\n+              >\n+              </textarea>\n+            </div>\n+\n+            <div class="formControls">\n+              <input class="destructive"\n+                     name="form.button.relocate-content"\n+                     type="submit"\n+                     value="Relocate"\n+                     i18n:attributes="value"\n+              />\n+            </div>\n+\n+            <input tal:replace="structure context/@@authenticator/authenticator" />\n+\n+          </fieldset>\n+        </form>\n+\n+        <form id="lp-migration-transfer-catalog"\n+              method="post"\n+              tal:attributes="\n+                action string:${portal_url}/transfer-lp-catalog;\n+              "\n+        >\n+          <fieldset>\n+            <legend i18n:translate="legend_transfer_multilingual_catalog_info">\n                   Step 2 - Transfer multilingual catalog information\n-                </legend>\n+            </legend>\n \n-                <p i18n:translate="description_transfer_multilingual_catalog_info">\n+            <p i18n:translate="description_transfer_multilingual_catalog_info">\n \n                   This step will transfer the relations between translations\n                   stored by LinguaPlone to the PAM catalog. This step is not\n                   destructive and can be executed as many times as needed.\n \n-                </p>\n+            </p>\n \n-                <div class="formControls">\n-                    <input\n-                        type="submit"\n-                        name="form.button.transfer-lp-catalog"\n-                        class="destructive"\n-                        value="Transfer"\n-                        i18n:attributes="value" />\n-                </div>\n+            <div class="formControls">\n+              <input class="destructive"\n+                     name="form.button.transfer-lp-catalog"\n+                     type="submit"\n+                     value="Transfer"\n+                     i18n:attributes="value"\n+              />\n+            </div>\n \n-                <input tal:replace="structure context/@@authenticator/authenticator" />\n+            <input tal:replace="structure context/@@authenticator/authenticator" />\n \n-              </fieldset>\n-            </form>\n+          </fieldset>\n+        </form>\n \n-            <form id="lp-migration-after-migration"\n-                  tal:attributes="action python:not view.isLPinstalled and view.hasRelationCatalog and portal_url + \'/after-migration-cleanup\'"\n-                  method="post">\n-              <fieldset>\n-                <legend i18n:translate="legend_after_migration_cleanup">\n+        <form id="lp-migration-after-migration"\n+              method="post"\n+              tal:attributes="\n+                action python:not view.isLPinstalled and view.hasRelationCatalog and portal_url + \'/after-migration-cleanup\';\n+              "\n+        >\n+          <fieldset>\n+            <legend i18n:translate="legend_after_migration_cleanup">\n                   Step 3 - Cleanup after migration\n-                </legend>\n+            </legend>\n \n-                <p i18n:translate="description_after_migration_cleanup">\n+            <p i18n:translate="description_after_migration_cleanup">\n \n                   This step will fix some lost dependencies to the\n                   ITranslatable interface hidden in the relation catalog and\n                   it gets rid of them. It must be run only when LinguaPlone is\n                   already uninstalled.\n \n-                </p>\n+            </p>\n \n-                <p tal:condition="view/isLPinstalled"\n-                    i18n:translate="relation_migration_with_lp_not_posible">\n+            <p tal:condition="view/isLPinstalled"\n+               i18n:translate="relation_migration_with_lp_not_posible"\n+            >\n                     It\'s not possible to execute this step without\n                     uninstalling completely LinguaPlone: uninstall in the\n                     add-ons control panel, delete it from your buildout\n                     and re-run buildout. Then come here and try again.\n-                </p>\n+            </p>\n \n-                <p tal:condition="python:not view.isLPinstalled and not view.hasRelationCatalog"\n-                    i18n:translate="relation_migration_with_not_needed">\n+            <p tal:condition="python:not view.isLPinstalled and not view.hasRelationCatalog"\n+               i18n:translate="relation_migration_with_not_needed"\n+            >\n                     Your site has no relation catalog, and therefore this\n                     migration step is not needed\n-                </p>\n-\n-                <div class="formControls"\n-                     tal:condition="python:not view.isLPinstalled and view.hasRelationCatalog">\n-                    <input\n-                        type="submit"\n-                        name="form.button.after-migration-cleanup"\n-                        class="destructive"\n-                        value="Cleanup"\n-                        i18n:attributes="value" />\n-                </div>\n-\n-                <input tal:replace="structure context/@@authenticator/authenticator" />\n-\n-              </fieldset>\n-            </form>\n-\n-            <div class="results">\n-              <h2 i18n:translate="heading_migration_results">Migration results</h2>\n-              <p i18n:translate="description_migration_results">\n-                Here you will see the results of the migration process\n-              </p>\n+            </p>\n+\n+            <div class="formControls"\n+                 tal:condition="python:not view.isLPinstalled and view.hasRelationCatalog"\n+            >\n+              <input class="destructive"\n+                     name="form.button.after-migration-cleanup"\n+                     type="submit"\n+                     value="Cleanup"\n+                     i18n:attributes="value"\n+              />\n             </div>\n+\n+            <input tal:replace="structure context/@@authenticator/authenticator" />\n+\n+          </fieldset>\n+        </form>\n+\n+        <div class="results">\n+          <h2 i18n:translate="heading_migration_results">Migration results</h2>\n+          <p i18n:translate="description_migration_results">\n+                Here you will see the results of the migration process\n+          </p>\n         </div>\n+      </div>\n \n-</metal:block>\n+    </metal:block>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/migrator-results.pt b/src/plone/app/multilingual/browser/templates/migrator-results.pt\nindex 5fad45dd9..fa6b5b480 100644\n--- a/src/plone/app/multilingual/browser/templates/migrator-results.pt\n+++ b/src/plone/app/multilingual/browser/templates/migrator-results.pt\n@@ -1,35 +1,43 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:prefs fill-slot="prefs_configlet_main">\n+    <metal:prefs fill-slot="prefs_configlet_main">\n \n-<div id="results">\n+      <div id="results">\n \n-<div class="resultInfo" i18n:domain="plone">\n-    <h2 i18n:translate=""\n-        tal:content="view/stepinfo">\n+        <div class="resultInfo"\n+             i18n:domain="plone"\n+        >\n+          <h2 tal:content="view/stepinfo"\n+              i18n:translate=""\n+          >\n         Transfer multilingual catalog information\n-    </h2>\n-    <span i18n:translate="label_total_objects_translated">\n+          </h2>\n+          <span i18n:translate="label_total_objects_translated">\n         Total objects handled:\n-    </span>\n-    <span tal:content="python: len(view.results)">Number of objects</span>\n-</div>\n+          </span>\n+          <span tal:content="python: len(view.results)">Number of objects</span>\n+        </div>\n \n-<tal:block repeat="result view/results">\n-    <div class="result"\n-    tal:attributes="class python:result.startswith(\'ERROR\') and \'result error\' or \'result\'"\n-    tal:content="result"></div>\n-</tal:block>\n+        <tal:block repeat="result view/results">\n+          <div class="result"\n+               tal:content="result"\n+               tal:attributes="\n+                 class python:result.startswith(\'ERROR\') and \'result error\' or \'result\';\n+               "\n+          ></div>\n+        </tal:block>\n \n-</div>\n-</metal:prefs>\n-</body>\n+      </div>\n+    </metal:prefs>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/mmap.pt b/src/plone/app/multilingual/browser/templates/mmap.pt\nindex e09d70840..b46435383 100644\n--- a/src/plone/app/multilingual/browser/templates/mmap.pt\n+++ b/src/plone/app/multilingual/browser/templates/mmap.pt\n@@ -1,18 +1,24 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n-\n-<body>\n-\n-<metal:block metal:fill-slot="prefs_configlet_main">\n-\n-  <script type="text/javascript" src="++resource++plone.app.multilingual.javascript/jit-yc.js"></script>\n-  <script type="text/javascript" src="++resource++plone.app.multilingual.javascript/mmap_helper.js"></script>\n-  <style>\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+\n+  <body>\n+\n+    <metal:block metal:fill-slot="prefs_configlet_main">\n+\n+      <script src="++resource++plone.app.multilingual.javascript/jit-yc.js"\n+              type="text/javascript"\n+      ></script>\n+      <script src="++resource++plone.app.multilingual.javascript/mmap_helper.js"\n+              type="text/javascript"\n+      ></script>\n+      <style>\n   #pam_mmap_toolbar {\n     border: 1px solid #000;\n     padding: 20px;\n@@ -51,90 +57,127 @@\n     background-color: #777;\n     color: white;\n   }\n-  </style>\n-\n-        <a id="setup-link" class="link-parent"\n-           tal:attributes="href string:$portal_url/@@overview-controlpanel"\n-           i18n:translate="">\n+      </style>\n+\n+      <a class="link-parent"\n+         id="setup-link"\n+         tal:attributes="\n+           href string:$portal_url/@@overview-controlpanel;\n+         "\n+         i18n:translate=""\n+      >\n             Site Setup\n-        </a>\n+      </a>\n \n-        <h1 class="documentFirstHeading"\n-            i18n:translate="heading_translation_map">plone.app.multilingual translation map</h1>\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="heading_translation_map"\n+      >plone.app.multilingual translation map</h1>\n \n-        <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+      <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n         Portal status message\n-        </div>\n+      </div>\n \n-        <div id="content-core">\n+      <div id="content-core">\n \n-            <p i18n:translate="description_translation_map">\n+        <p i18n:translate="description_translation_map">\n                 Translation map.\n-            </p>\n-            <div id="pam_ajax_buttons">\n-              <button id="call_missing_translations" i18n:translate="label_missing_translations">Missing translations</button>\n-              <button id="call_all_translations" class="down" i18n:translate="label_all_translations">All translations</button>\n-            </div>\n+        </p>\n+        <div id="pam_ajax_buttons">\n+          <button id="call_missing_translations"\n+                  i18n:translate="label_missing_translations"\n+          >Missing translations</button>\n+          <button class="down"\n+                  id="call_all_translations"\n+                  i18n:translate="label_all_translations"\n+          >All translations</button>\n+        </div>\n \n-            <div id="all_translations">\n+        <div id="all_translations">\n \n-            <div id="pam_mmap_toolbar">\n-              <div id="pam_mmap_language_toolbar">\n-                <div id="pam_language_buttons" tal:define="data view/languages">\n+          <div id="pam_mmap_toolbar">\n+            <div id="pam_mmap_language_toolbar">\n+              <div id="pam_language_buttons"\n+                   tal:define="\n+                     data view/languages;\n+                   "\n+              >\n                 <tal:block repeat="languages data/languages">\n-                  <button id="" tal:attributes="id languages/value;\n-                                                class python: languages.value==data[\'default\'] and \'down\' or \'\'" tal:content="languages/title">Lang</button>\n+                  <button id=""\n+                          tal:content="languages/title"\n+                          tal:attributes="\n+                            id languages/value;\n+                            class python: languages.value==data[\'default\'] and \'down\' or \'\';\n+                          "\n+                  >Lang</button>\n                 </tal:block>\n-                </div>\n+              </div>\n \n-                <div id="actual_language">\n-                </div>\n+              <div id="actual_language">\n               </div>\n+            </div>\n \n             <div id="data_translation">\n             </div>\n           </div>\n-            <div id="translation_map_canvas" style="height: 400px; width: 600px;">\n-\n-            </div>\n-            <div id="log">\n-            </div>\n+          <div id="translation_map_canvas"\n+               style="height: 400px; width: 600px;"\n+          >\n \n           </div>\n-          <div id="missing_translations">\n-            <div tal:define="not_full_translated view/canonicals">\n-              <ul>\n+          <div id="log">\n+          </div>\n+\n+        </div>\n+        <div id="missing_translations">\n+          <div tal:define="\n+                 not_full_translated view/canonicals;\n+               ">\n+            <ul>\n               <tal:block repeat="canonical not_full_translated">\n                 <li>\n-                <span tal:content="canonical/id">Id</span>\n-                <ul tal:define="last_url canonical/last_url">\n-                  <li>\n-                    <span i18n:translate="missing_languages">Missing languages: </span>\n-                    <tal:block2 repeat="missing canonical/missing">\n-                      <a href="" target="_blank" tal:attributes="href string:$last_url/@@create_translation?language=$missing" tal:content="missing">\n+                  <span tal:content="canonical/id">Id</span>\n+                  <ul tal:define="\n+                        last_url canonical/last_url;\n+                      ">\n+                    <li>\n+                      <span i18n:translate="missing_languages">Missing languages:\n+                      </span>\n+                      <tal:block2 repeat="missing canonical/missing">\n+                        <a href=""\n+                           target="_blank"\n+                           tal:content="missing"\n+                           tal:attributes="\n+                             href string:$last_url/@@create_translation?language=$missing;\n+                           "\n+                        >\n                         lang\n-                      </a>\n-                    </tal:block2>\n-                  </li>\n-                  <li>\n-                    <span i18n:translate="translation">Translations: </span>\n-                    <tal:block2 repeat="missing canonical/translated">\n-                      <a href="" tal:attributes="href missing/url">\n-                        <span tal:content="missing/path">Path</span>\n-                        <span tal:content="missing/lang">Lang</span>\n-                      </a>\n-                    </tal:block2>\n-                  </li>\n-                </ul>\n+                        </a>\n+                      </tal:block2>\n+                    </li>\n+                    <li>\n+                      <span i18n:translate="translation">Translations:\n+                      </span>\n+                      <tal:block2 repeat="missing canonical/translated">\n+                        <a href=""\n+                           tal:attributes="\n+                             href missing/url;\n+                           "\n+                        >\n+                          <span tal:content="missing/path">Path</span>\n+                          <span tal:content="missing/lang">Lang</span>\n+                        </a>\n+                      </tal:block2>\n+                    </li>\n+                  </ul>\n                 </li>\n               </tal:block>\n-              </ul>\n-            </div>\n+            </ul>\n           </div>\n-\n         </div>\n \n-</metal:block>\n+      </div>\n+\n+    </metal:block>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/modify_translations.pt b/src/plone/app/multilingual/browser/templates/modify_translations.pt\nindex a32f8adc9..c72c18d7c 100644\n--- a/src/plone/app/multilingual/browser/templates/modify_translations.pt\n+++ b/src/plone/app/multilingual/browser/templates/modify_translations.pt\n@@ -1,93 +1,170 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    xml:lang="en" lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:main fill-slot="main">\n+    <metal:main fill-slot="main">\n \n-    <header>\n-      <h1 class="documentFirstHeading"\n-          i18n:translate=""\n-          metal:define-slot="heading">\n+      <header>\n+        <h1 class="documentFirstHeading"\n+            metal:define-slot="heading"\n+            i18n:translate=""\n+        >\n         Modify translations\n-      </h1>\n+        </h1>\n \n-      <div class="documentDescription" i18n:translate="long_description_modify_translations">\n+        <div class="documentDescription"\n+             i18n:translate="long_description_modify_translations"\n+        >\n         This form allows you to add or remove translations for the current object.\n-      </div>\n-    </header>\n+        </div>\n+      </header>\n \n-  <div id="content-core">\n+      <div id="content-core">\n \n-    <table class="table table-bordered table-striped table-sm" id="translations-overview" summary="Translations overview">\n-      <tal:langs repeat="lang view/available_languages">\n-        <tr tal:define="translation python:view.get_translation(lang);">\n-          <td class="align-middle text-center" tal:define="activeLanguage context/Language|nothing">\n-            <span tal:attributes="class python:lang == activeLanguage and \'activeLanguage font-weight-bold\' or None"\n-                  tal:content="lang"></span>\n-          </td>\n-          <td>\n-            <tal:hastranslation condition="python:translation">\n-              <h3 class="translationTitle" tal:content="translation/Title">Title</h3>\n-              <a class="translationURL" href="#" tal:attributes="href translation/absolute_url">\n-                <span tal:replace="python:\'/\'.join(translation.getPhysicalPath())">URL</span>\n-              </a>\n-            </tal:hastranslation>\n-            <tal:notranslation condition="python:not translation">\n-              <h3 class="translationTitle discreet" i18n:translate="">Translation missing</h3>\n-            </tal:notranslation>\n-          </td>\n-          <td class="align-middle text-center">\n-            <tal:hastranslation condition="python:translation and translation != context">\n-              <a href="#" title="Disconnect translation" class="pat-plone-modal disconnectTranslationAction"\n-                 tal:attributes="href string:${context/absolute_url}/disconnect_translation?came_from=${context/UID}&language=${lang}"\n-                 i18n:attributes="title disconnect_translation">\n-                  <img src="" alt="" width="20" height="20" class="icon me-2"\n-                           tal:attributes="src string:++plone++bootstrap-icons/arrows-angle-expand.svg"/><span \n-                    class="d-none d-md-inline-block text-xs-right" i18n:translate="disconnect_translation">Disconnect translation</span>\n-              </a>\n-            </tal:hastranslation>\n-            <tal:notranslation condition="python:not translation">\n-              <a href="#" title="Connect existing translation" class="pat-plone-modal connectTranslationAction"\n-                 tal:attributes="href string:${context/absolute_url}/connect_translation?language=${lang}"\n-                 i18n:attributes="title connect_existing_translation">\n-                  <img src="" alt="" width="20" height="20" class="icon me-2"\n-                           tal:attributes="src string:++plone++bootstrap-icons/arrows-angle-contract.svg"/><span \n-                    class="d-none d-md-inline-block" i18n:translate="connect_existing_translation">Connect existing translation</span>\n-              </a>\n-            </tal:notranslation>\n-          </td>\n-          <td class="align-middle text-center">\n-            <tal:hastranslation condition="python:translation and translation != context">\n-              <a href="#" title="Delete translated item" class="pat-plone-modal deleteTranslationAction"\n-                 tal:attributes="href string:${translation/absolute_url}/delete_confirmation"\n-                 i18n:attributes="title delete_translated_item">\n-                  <img src="" alt="" width="20" height="20" class="icon me-2"\n-                           tal:attributes="src string:++plone++bootstrap-icons/trash.svg"/><span \n-                    class="d-none d-md-inline-block" i18n:translate="delete_translated_item">Delete translated item</span>\n-              </a>\n-            </tal:hastranslation>\n-            <tal:notranslation condition="python:not translation">\n-              <a href="#" title="Add translation" class="pat-plone-modal addTranslationAction"\n-                 tal:attributes="href string:${context/absolute_url}/@@create_translation?language=${lang}"\n-                 i18n:attributes="title add_translation">\n-                  <img src="" alt="" width="20" height="20"\n-                           tal:attributes="src string:++plone++bootstrap-icons/plus.svg"/><span \n-                    class="d-none d-md-inline-block" i18n:translate="add_translation">Add translation</span>\n-              </a>\n-            </tal:notranslation>\n-          </td>\n-        </tr>\n-      </tal:langs>\n-    </table>\n+        <table class="table table-bordered table-striped table-sm"\n+               id="translations-overview"\n+               summary="Translations overview"\n+        >\n+          <tal:langs repeat="lang view/available_languages">\n+            <tr tal:define="\n+                  translation python:view.get_translation(lang);\n+                ">\n+              <td class="align-middle text-center"\n+                  tal:define="\n+                    activeLanguage context/Language|nothing;\n+                  "\n+              >\n+                <span tal:content="lang"\n+                      tal:attributes="\n+                        class python:lang == activeLanguage and \'activeLanguage font-weight-bold\' or None;\n+                      "\n+                ></span>\n+              </td>\n+              <td>\n+                <tal:hastranslation condition="python:translation">\n+                  <h3 class="translationTitle"\n+                      tal:content="translation/Title"\n+                  >Title</h3>\n+                  <a class="translationURL"\n+                     href="#"\n+                     tal:attributes="\n+                       href translation/absolute_url;\n+                     "\n+                  >\n+                    <span tal:replace="python:\'/\'.join(translation.getPhysicalPath())">URL</span>\n+                  </a>\n+                </tal:hastranslation>\n+                <tal:notranslation condition="python:not translation">\n+                  <h3 class="translationTitle discreet"\n+                      i18n:translate=""\n+                  >Translation missing</h3>\n+                </tal:notranslation>\n+              </td>\n+              <td class="align-middle text-center">\n+                <tal:hastranslation condition="python:translation and translation != context">\n+                  <a class="pat-plone-modal disconnectTranslationAction"\n+                     href="#"\n+                     title="Disconnect translation"\n+                     tal:attributes="\n+                       href string:${context/absolute_url}/disconnect_translation?came_from=${context/UID}&language=${lang};;\n+                     "\n+                     i18n:attributes="title disconnect_translation"\n+                  >\n+                    <img class="icon me-2"\n+                         alt=""\n+                         height="20"\n+                         src=""\n+                         width="20"\n+                         tal:attributes="\n+                           src string:++plone++bootstrap-icons/arrows-angle-expand.svg;\n+                         "\n+                    /><span class="d-none d-md-inline-block text-xs-right"\n+                          i18n:translate="disconnect_translation"\n+                    >Disconnect translation</span>\n+                  </a>\n+                </tal:hastranslation>\n+                <tal:notranslation condition="python:not translation">\n+                  <a class="pat-plone-modal connectTranslationAction"\n+                     href="#"\n+                     title="Connect existing translation"\n+                     tal:attributes="\n+                       href string:${context/absolute_url}/connect_translation?language=${lang};\n+                     "\n+                     i18n:attributes="title connect_existing_translation"\n+                  >\n+                    <img class="icon me-2"\n+                         alt=""\n+                         height="20"\n+                         src=""\n+                         width="20"\n+                         tal:attributes="\n+                           src string:++plone++bootstrap-icons/arrows-angle-contract.svg;\n+                         "\n+                    /><span class="d-none d-md-inline-block"\n+                          i18n:translate="connect_existing_translation"\n+                    >Connect existing translation</span>\n+                  </a>\n+                </tal:notranslation>\n+              </td>\n+              <td class="align-middle text-center">\n+                <tal:hastranslation condition="python:translation and translation != context">\n+                  <a class="pat-plone-modal deleteTranslationAction"\n+                     href="#"\n+                     title="Delete translated item"\n+                     tal:attributes="\n+                       href string:${translation/absolute_url}/delete_confirmation;\n+                     "\n+                     i18n:attributes="title delete_translated_item"\n+                  >\n+                    <img class="icon me-2"\n+                         alt=""\n+                         height="20"\n+                         src=""\n+                         width="20"\n+                         tal:attributes="\n+                           src string:++plone++bootstrap-icons/trash.svg;\n+                         "\n+                    /><span class="d-none d-md-inline-block"\n+                          i18n:translate="delete_translated_item"\n+                    >Delete translated item</span>\n+                  </a>\n+                </tal:hastranslation>\n+                <tal:notranslation condition="python:not translation">\n+                  <a class="pat-plone-modal addTranslationAction"\n+                     href="#"\n+                     title="Add translation"\n+                     tal:attributes="\n+                       href string:${context/absolute_url}/@@create_translation?language=${lang};\n+                     "\n+                     i18n:attributes="title add_translation"\n+                  >\n+                    <img alt=""\n+                         height="20"\n+                         src=""\n+                         width="20"\n+                         tal:attributes="\n+                           src string:++plone++bootstrap-icons/plus.svg;\n+                         "\n+                    /><span class="d-none d-md-inline-block"\n+                          i18n:translate="add_translation"\n+                    >Add translation</span>\n+                  </a>\n+                </tal:notranslation>\n+              </td>\n+            </tr>\n+          </tal:langs>\n+        </table>\n \n-  </div>\n+      </div>\n \n-</metal:main>\n-</body>\n-</html>\n\\ No newline at end of file\n+    </metal:main>\n+  </body>\n+</html>\ndiff --git a/src/plone/app/multilingual/browser/templates/not_translated_yet.pt b/src/plone/app/multilingual/browser/templates/not_translated_yet.pt\nindex 0f13d8680..e69977cfd 100644\n--- a/src/plone/app/multilingual/browser/templates/not_translated_yet.pt\n+++ b/src/plone/app/multilingual/browser/templates/not_translated_yet.pt\n@@ -1,57 +1,84 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n-<body>\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:head fill-slot="top_slot"\n-            tal:define="dummy python:request.set(\'disable_border\',1);\n-                        disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                        disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);">\n-</metal:head>\n+    <metal:head fill-slot="top_slot"\n+                tal:define="\n+                  dummy python:request.set(\'disable_border\',1);\n+                  disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                  disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+                "\n+    >\n+    </metal:head>\n \n-<metal:main fill-slot="main">\n-    <metal:main define-macro="main">\n+    <metal:main fill-slot="main">\n+      <metal:main define-macro="main">\n \n-    <h1 class="documentFirstHeading" i18n:translate="heading_not_available_in_language">\n-      Not available in <span i18n:name="language" tal:content="view/language_name" tal:omit-tag="">es</span>\n-    </h1>\n+        <h1 class="documentFirstHeading"\n+            i18n:translate="heading_not_available_in_language"\n+        >\n+      Not available in\n+          <span tal:content="view/language_name"\n+                tal:omit-tag=""\n+                i18n:name="language"\n+          >es</span>\n+        </h1>\n \n-      <div class="documentDescription" id="parent-fieldname-description" i18n:translate="">\n+        <div class="documentDescription"\n+             id="parent-fieldname-description"\n+             i18n:translate=""\n+        >\n         This content is not translated yet to the language requested.\n-      </div>\n-      <section>\n-        <tal:anytranslation condition="view/has_any_translation">\n-          <p i18n:translate="">However, this is the list of the already translated languages for the requested content.</p>\n-          <ul>\n-            <tal:list repeat="trans_content view/already_translated">\n-              <tal:defines define="code python: trans_content[0];\n-                              trans_obj python: trans_content[1]">\n-              <li tal:condition="python:trans_obj.Title()">\n-                <span tal:replace="python:view.language_name(code)" /> - <span tal:replace="code"/>:\n-                <a tal:attributes="href python:trans_obj.absolute_url() + \'?set_language=\' + code"\n-                   tal:content="python:trans_obj.Title()">Translation Link</a></li>\n-              <li tal:condition="python:not trans_obj.Title()">\n-                <span tal:content="python:trans_obj"></span>\n-                <a tal:attributes="href python:trans_obj.absolute_url() + \'?set_language=\' + code"\n-                    i18n:translate="label_no_title">\n-                  (No Title)</a></li>\n-              </tal:defines>\n-            </tal:list>\n-          </ul>\n-        </tal:anytranslation>\n-        <tal:anytranslation condition="not: view/has_any_translation">\n-          <p i18n:translate="">This item doesn\'t have any translation yet. You can return to the portal site:</p>\n+        </div>\n+        <section>\n+          <tal:anytranslation condition="view/has_any_translation">\n+            <p i18n:translate="">However, this is the list of the already translated languages for the requested content.</p>\n+            <ul>\n+              <tal:list repeat="trans_content view/already_translated">\n+                <tal:defines define="\n+                               code python: trans_content[0];\n+                               trans_obj python: trans_content[1];\n+                             ">\n+                  <li tal:condition="python:trans_obj.Title()">\n+                    <span tal:replace="python:view.language_name(code)"></span>\n+                    -\n+                    <span tal:replace="code"></span>:\n+                    <a tal:content="python:trans_obj.Title()"\n+                       tal:attributes="\n+                         href python:trans_obj.absolute_url() + \'?set_language=\' + code;\n+                       "\n+                    >Translation Link</a></li>\n+                  <li tal:condition="python:not trans_obj.Title()">\n+                    <span tal:content="python:trans_obj"></span>\n+                    <a tal:attributes="\n+                         href python:trans_obj.absolute_url() + \'?set_language=\' + code;\n+                       "\n+                       i18n:translate="label_no_title"\n+                    >\n+                      (No Title)</a></li>\n+                </tal:defines>\n+              </tal:list>\n+            </ul>\n+          </tal:anytranslation>\n+          <tal:anytranslation condition="not: view/has_any_translation">\n+            <p i18n:translate="">This item doesn\'t have any translation yet. You can return to the portal site:</p>\n             <ul>\n-              <li><a tal:attributes="href python:context.absolute_url()"\n-                     tal:content="python:context.Title()">Content Link</a></li>\n+              <li><a tal:content="python:context.Title()"\n+                   tal:attributes="\n+                     href python:context.absolute_url();\n+                   "\n+                >Content Link</a></li>\n             </ul>\n-        </tal:anytranslation>\n-      </section>\n+          </tal:anytranslation>\n+        </section>\n+      </metal:main>\n     </metal:main>\n-  </metal:main>\n-</body>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/reindex-results.pt b/src/plone/app/multilingual/browser/templates/reindex-results.pt\nindex 2f3df7c61..2fde5a109 100644\n--- a/src/plone/app/multilingual/browser/templates/reindex-results.pt\n+++ b/src/plone/app/multilingual/browser/templates/reindex-results.pt\n@@ -1,33 +1,42 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:prefs fill-slot="prefs_configlet_main">\n+    <metal:prefs fill-slot="prefs_configlet_main">\n \n-<div id="results">\n+      <div id="results">\n \n-<div class="resultInfo">\n-    <h2 i18n:translate=""\n-        tal:content="view/stepinfo">\n+        <div class="resultInfo">\n+          <h2 tal:content="view/stepinfo"\n+              i18n:translate=""\n+          >\n         Reindex Language Index\n-    </h2>\n+          </h2>\n \n-    <p i18n:translate="migration_reindex_results">\n+          <p i18n:translate="migration_reindex_results">\n       The "Language" index was re-indexed correctly. Before, it contained\n-      <span i18n:name="previous_items_number" tal:content="view/items_before"\n-          tal:omit-tag="" /> items, now it contains <span i18n:name="after_items_number"\n-          tal:content="view/items_after" tal:omit-tag="" />\n+            <span tal:content="view/items_before"\n+                  tal:omit-tag=""\n+                  i18n:name="previous_items_number"\n+            ></span>\n+            items, now it contains\n+            <span tal:content="view/items_after"\n+                  tal:omit-tag=""\n+                  i18n:name="after_items_number"\n+            ></span>\n \n-    </p>\n-</div>\n+          </p>\n+        </div>\n \n-</div>\n-</metal:prefs>\n-</body>\n+      </div>\n+    </metal:prefs>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/templates/relocate-results.pt b/src/plone/app/multilingual/browser/templates/relocate-results.pt\nindex 6f53691a5..6a21b653b 100644\n--- a/src/plone/app/multilingual/browser/templates/relocate-results.pt\n+++ b/src/plone/app/multilingual/browser/templates/relocate-results.pt\n@@ -1,35 +1,43 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/prefs_main_template/macros/master"\n-    i18n:domain="plone">\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<body>\n+  <body>\n \n-<metal:prefs fill-slot="prefs_configlet_main">\n+    <metal:prefs fill-slot="prefs_configlet_main">\n \n-<div id="results">\n+      <div id="results">\n \n-<div class="resultInfo" i18n:domain="plone">\n-    <h2 i18n:translate=""\n-        tal:content="view/stepinfo">\n+        <div class="resultInfo"\n+             i18n:domain="plone"\n+        >\n+          <h2 tal:content="view/stepinfo"\n+              i18n:translate=""\n+          >\n         Relocate content to the proper root language folder\n-    </h2>\n-    <span i18n:translate="label_total_objects_translated">\n+          </h2>\n+          <span i18n:translate="label_total_objects_translated">\n         Total objects handled:\n-    </span>\n-    <span tal:content="python: len(view.results)">Number of objects</span>\n-</div>\n+          </span>\n+          <span tal:content="python: len(view.results)">Number of objects</span>\n+        </div>\n \n-<tal:block repeat="result view/results">\n-    <div class="result"\n-    tal:attributes="class python:result.startswith(\'ERROR\') and \'result error\' or \'result\'"\n-    tal:content="result"></div>\n-</tal:block>\n+        <tal:block repeat="result view/results">\n+          <div class="result"\n+               tal:content="result"\n+               tal:attributes="\n+                 class python:result.startswith(\'ERROR\') and \'result error\' or \'result\';\n+               "\n+          ></div>\n+        </tal:block>\n \n-</div>\n-</metal:prefs>\n-</body>\n+      </div>\n+    </metal:prefs>\n+  </body>\n </html>\ndiff --git a/src/plone/app/multilingual/browser/viewlets.py b/src/plone/app/multilingual/browser/viewlets.py\nindex ce380c2f6..7663b0954 100644\n--- a/src/plone/app/multilingual/browser/viewlets.py\n+++ b/src/plone/app/multilingual/browser/viewlets.py\n@@ -124,19 +124,6 @@ def update(self):\n         self.origin = catalog.searchResults(query)\n \n \n-class AddFormATIsATranslationViewlet(AddFormIsATranslationViewlet):\n-    # XXX move this class to archetypes multilingual!\n-    # btw., it is not used in here.\n-    """Notice the user that this AT add form is a translation"""\n-\n-    def update(self):\n-        """It\'s only for AT on factory so we check"""\n-        factory = getToolByName(self.context, "portal_factory", None)\n-        if factory is None or not factory.isTemporary(self.context):\n-            return\n-        super(AddFormIsATranslationViewlet, self).update()\n-\n-\n class AlternateLanguagesViewlet(ViewletBase):\n     """Notice search engines about alternates languages of current\n     content item\ndiff --git a/src/plone/app/multilingual/browser/vocabularies.py b/src/plone/app/multilingual/browser/vocabularies.py\nindex ccb36e428..33f2e59b3 100644\n--- a/src/plone/app/multilingual/browser/vocabularies.py\n+++ b/src/plone/app/multilingual/browser/vocabularies.py\n@@ -37,7 +37,7 @@ def translated_languages(context):\n     language_infos = language_tool.getAvailableLanguages()\n     manager = ITranslationManager(context)\n     # take care to filter out translated contents\n-    # wich do no have supported language information\n+    # which do no have supported language information\n     translated_languages = [\n         a for a in manager.get_translated_languages() if a in language_infos\n     ]\n@@ -104,8 +104,8 @@ def __call__(self, context):\n             languages = util.getLanguages()\n \n         items = [\n-            (l, languages[l].get("native", languages[l].get("name", l)))\n-            for l in languages\n+            (lang, languages[lang].get("native", languages[lang].get("name", lang)))\n+            for lang in languages\n         ]\n         items.sort(key=sort_key)\n         items = [SimpleTerm(i[0], i[0], i[1]) for i in items]\n@@ -131,9 +131,9 @@ def __call__(self, context):\n \n         supported_languages = ltool.supported_langs\n         items = [\n-            (l, languages[l].get("native", languages[l].get("name", l)))\n-            for l in languages\n-            if l in supported_languages\n+            (lang, languages[lang].get("native", languages[lang].get("name", lang)))\n+            for lang in languages\n+            if lang in supported_languages\n         ]\n \n         items.sort(key=sort_key)\ndiff --git a/src/plone/app/multilingual/configure.zcml b/src/plone/app/multilingual/configure.zcml\nindex 98dd5f8e7..2eef1c924 100644\n--- a/src/plone/app/multilingual/configure.zcml\n+++ b/src/plone/app/multilingual/configure.zcml\n@@ -1,10 +1,11 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:zcml="http://namespaces.zope.org/zcml"\n-    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:five="http://namespaces.zope.org/five"\n+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:i18n="http://namespaces.zope.org/i18n"\n-    i18n_domain="plone">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n \n   <include package="plone.behavior" />\n   <include package="plone.dexterity" />\n@@ -13,78 +14,87 @@\n   <!-- <include package="Products.PloneLanguageTool" /> -->\n   <include package="z3c.relationfield" />\n \n-  <five:registerPackage package="."/> <!-- Required for uninstall profile -->\n+  <five:registerPackage package="." />\n+  <!-- Required for uninstall profile -->\n \n-  <include package="Products.CMFCore" file="permissions.zcml"/>\n+  <include\n+      package="Products.CMFCore"\n+      file="permissions.zcml"\n+      />\n \n-  <include file="permissions.zcml"/>\n-  <include file="upgrades.zcml"/>\n-  <include package=".browser"/>\n-  <include package=".dx"/>\n+  <include file="permissions.zcml" />\n+  <include file="upgrades.zcml" />\n+  <include package=".browser" />\n+  <include package=".dx" />\n \n   <!--<adapter factory=".content.lrf.LRFOrdering"/>-->\n-  <adapter factory=".shared_uuid.lrfUUID"/>\n-  <adapter factory=".shared_uuid.lifUUID"/>\n+  <adapter factory=".shared_uuid.lrfUUID" />\n+  <adapter factory=".shared_uuid.lifUUID" />\n \n   <!-- ITranslationGroup and indexer -->\n \n-  <adapter factory=".itg.attributeTG"/>\n-  <adapter factory=".itg.MutableAttributeTG"/>\n-  <subscriber handler=".itg.addAttributeTG"/>\n+  <adapter factory=".itg.attributeTG" />\n+  <adapter factory=".itg.MutableAttributeTG" />\n+  <subscriber handler=".itg.addAttributeTG" />\n \n-  <adapter factory=".indexer.itgIndexer" name="TranslationGroup"/>\n-  <adapter factory=".indexer.LanguageIndexer" name="Language"/>\n+  <adapter\n+      factory=".indexer.itgIndexer"\n+      name="TranslationGroup"\n+      />\n+  <adapter\n+      factory=".indexer.LanguageIndexer"\n+      name="Language"\n+      />\n \n   <subscriber\n       for="plone.app.multilingual.interfaces.ILanguageIndependentFolder\n            zope.lifecycleevent.interfaces.IObjectCreatedEvent"\n-      handler="plone.app.multilingual.content.lif.connect_with_others"/>\n+      handler="plone.app.multilingual.content.lif.connect_with_others"\n+      />\n \n   <!-- Generic plone.app.multilingual subscribers and adapters -->\n-\n-  <configure zcml:condition="not-installed zope.container">\n-      <subscriber\n-          for="plone.app.multilingual.interfaces.ITranslatable\n-               zope.app.container.interfaces.IObjectAddedEvent"\n-          handler="plone.app.multilingual.subscriber.createdEvent"/>\n-  </configure>\n-\n-  <configure zcml:condition="installed zope.container">\n-    <subscriber\n-          for="plone.app.multilingual.interfaces.ITranslatable\n-               zope.container.interfaces.IObjectAddedEvent"\n-          handler="plone.app.multilingual.subscriber.createdEvent"/>\n-  </configure>\n+  <subscriber\n+      for="plone.app.multilingual.interfaces.ITranslatable\n+           zope.lifecycleevent.interfaces.IObjectAddedEvent"\n+      handler="plone.app.multilingual.subscriber.createdEvent"\n+      />\n \n   <subscriber\n       for="plone.app.multilingual.interfaces.ITranslatable\n            zope.lifecycleevent.interfaces.IObjectCopiedEvent"\n-      handler="plone.app.multilingual.subscriber.createdEvent"/>\n+      handler="plone.app.multilingual.subscriber.createdEvent"\n+      />\n   <subscriber\n       for="plone.app.multilingual.interfaces.ITranslatable\n            zope.lifecycleevent.interfaces.IObjectMovedEvent"\n-      handler="plone.app.multilingual.subscriber.createdEvent"/>\n+      handler="plone.app.multilingual.subscriber.createdEvent"\n+      />\n \n   <adapter\n-      for="plone.app.multilingual.interfaces.ITranslatable"\n+      factory="plone.app.multilingual.manager.TranslationManager"\n       provides="plone.app.multilingual.interfaces.ITranslationManager"\n-      factory="plone.app.multilingual.manager.TranslationManager"/>\n-  <adapter\n       for="plone.app.multilingual.interfaces.ITranslatable"\n-      provides="plone.app.multilingual.interfaces.ITranslationLocator"\n-      factory="plone.app.multilingual.factory.DefaultTranslationLocator"/>\n+      />\n   <adapter\n+      factory="plone.app.multilingual.factory.DefaultTranslationLocator"\n+      provides="plone.app.multilingual.interfaces.ITranslationLocator"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n-      provides="plone.app.multilingual.interfaces.ITranslationIdChooser"\n-      factory="plone.app.multilingual.factory.DefaultTranslationIdChooser"/>\n+      />\n   <adapter\n+      factory="plone.app.multilingual.factory.DefaultTranslationIdChooser"\n+      provides="plone.app.multilingual.interfaces.ITranslationIdChooser"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n-      provides="plone.app.multilingual.interfaces.ITranslationCloner"\n-      factory="plone.app.multilingual.factory.DefaultTranslationCloner"/>\n+      />\n   <adapter\n+      factory="plone.app.multilingual.factory.DefaultTranslationCloner"\n+      provides="plone.app.multilingual.interfaces.ITranslationCloner"\n       for="plone.app.multilingual.interfaces.ITranslatable"\n+      />\n+  <adapter\n+      factory="plone.app.multilingual.factory.DefaultTranslationFactory"\n       provides="plone.app.multilingual.interfaces.ITranslationFactory"\n-      factory="plone.app.multilingual.factory.DefaultTranslationFactory"/>\n+      for="plone.app.multilingual.interfaces.ITranslatable"\n+      />\n \n \n   <!-- Dexterity Language Independent fields -->\n@@ -92,69 +102,81 @@\n   <subscriber\n       for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable\n            zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n-      handler="plone.app.multilingual.dx.subscriber.handler"/>\n+      handler="plone.app.multilingual.dx.subscriber.handler"\n+      />\n   <adapter\n-      for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable"\n+      factory="plone.app.multilingual.dx.cloner.Cloner"\n       provides="plone.app.multilingual.interfaces.ITranslationCloner"\n-      factory="plone.app.multilingual.dx.cloner.Cloner"/>\n-  <adapter\n       for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable"\n+      />\n+  <adapter\n+      factory="plone.app.multilingual.dx.cloner.LanguageIndependentFieldsManager"\n       provides="plone.app.multilingual.interfaces.ILanguageIndependentFieldsManager"\n-      factory="plone.app.multilingual.dx.cloner.LanguageIndependentFieldsManager"/>\n+      for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable"\n+      />\n \n \n   <!-- Language independent folder content indexers -->\n   <subscriber\n       for="plone.dexterity.interfaces.IDexterityContent\n            zope.lifecycleevent.interfaces.IObjectMovedEvent"\n-      handler=".subscriber.reindex_language_independent"/>\n+      handler=".subscriber.reindex_language_independent"\n+      />\n \n   <subscriber\n       for="plone.dexterity.interfaces.IDexterityContent\n            zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n-      handler=".subscriber.reindex_language_independent"/>\n+      handler=".subscriber.reindex_language_independent"\n+      />\n \n-   <subscriber\n+  <subscriber\n       for="plone.dexterity.interfaces.IDexterityContent\n            Products.CMFCore.interfaces.IActionSucceededEvent"\n-      handler=".subscriber.reindex_language_independent"/>\n+      handler=".subscriber.reindex_language_independent"\n+      />\n \n   <subscriber\n       for="plone.dexterity.interfaces.IDexterityContent\n            OFS.interfaces.IObjectWillBeMovedEvent"\n-      handler=".subscriber.unindex_language_independent"/>\n+      handler=".subscriber.unindex_language_independent"\n+      />\n \n   <subscriber\n       for="plone.dexterity.interfaces.IDexterityContent\n            OFS.interfaces.IObjectWillBeRemovedEvent"\n-      handler=".subscriber.unindex_language_independent"/>\n+      handler=".subscriber.unindex_language_independent"\n+      />\n \n   <adapter\n+      factory=".content.lrf.LRFNameChooser"\n       provides="zope.container.interfaces.INameChooser"\n       for="plone.app.multilingual.interfaces.ILanguageRootFolder"\n-      factory=".content.lrf.LRFNameChooser"/>\n+      />\n \n   <utility\n       factory=".setuphandlers.HiddenProfiles"\n+      provides="plone.base.interfaces.INonInstallable"\n       name="plone.app.multilingual"\n-      provides="plone.base.interfaces.INonInstallable"/>\n+      />\n \n   <genericsetup:registerProfile\n       name="default"\n       title="Multilingual Support"\n       description="Install to enable multilingual content support with plone.app.multilingual"\n-      directory="profiles/default"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       for="plone.base.interfaces.IPloneSiteRoot"\n-      post_handler=".setuphandlers.init_pam"/>\n+      directory="profiles/default"\n+      post_handler=".setuphandlers.init_pam"\n+      />\n \n   <genericsetup:registerProfile\n       name="uninstall"\n       title="Multilingual Support [uninstall]"\n       description="Uninstall, removes multilingual content support with plone.app.multilingual"\n-      directory="profiles/uninstall"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n-      for="plone.base.interfaces.IPloneSiteRoot"/>\n+      for="plone.base.interfaces.IPloneSiteRoot"\n+      directory="profiles/uninstall"\n+      />\n \n   <genericsetup:importStep\n       name="plone.app.multilingual_default"\n@@ -167,6 +189,7 @@\n       name="plone.app.multilingual_uninstall"\n       title="plone.app.multilingual uninstall"\n       description=""\n-      handler=".setuphandlers.step_uninstall_various"/>\n+      handler=".setuphandlers.step_uninstall_various"\n+      />\n \n </configure>\ndiff --git a/src/plone/app/multilingual/content/lif.py b/src/plone/app/multilingual/content/lif.py\nindex c8a297355..b3c9b04ad 100644\n--- a/src/plone/app/multilingual/content/lif.py\n+++ b/src/plone/app/multilingual/content/lif.py\n@@ -1,5 +1,4 @@\n from BTrees.OOBTree import OOBTree\n-from plone.dexterity.content import Container\n from Products.CMFCore.utils import getToolByName\n from zope.component.hooks import getSite\n \ndiff --git a/src/plone/app/multilingual/content/lif.xml b/src/plone/app/multilingual/content/lif.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/src/plone/app/multilingual/content/lif.xml\n+++ b/src/plone/app/multilingual/content/lif.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/src/plone/app/multilingual/content/lrf.xml b/src/plone/app/multilingual/content/lrf.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/src/plone/app/multilingual/content/lrf.xml\n+++ b/src/plone/app/multilingual/content/lrf.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/src/plone/app/multilingual/dx/cloner.py b/src/plone/app/multilingual/dx/cloner.py\nindex 340692ac3..e1e164ff5 100644\n--- a/src/plone/app/multilingual/dx/cloner.py\n+++ b/src/plone/app/multilingual/dx/cloner.py\n@@ -3,8 +3,8 @@\n from plone.app.multilingual.interfaces import ITranslationCloner\n from plone.app.multilingual.interfaces import ITranslationManager\n from plone.base.interfaces import ILanguage\n-from plone.dexterity.utils import iterSchemata\n from plone.base.utils import safe_text\n+from plone.dexterity.utils import iterSchemata\n from z3c.relationfield import RelationValue\n from z3c.relationfield.interfaces import IRelationList\n from z3c.relationfield.interfaces import IRelationValue\ndiff --git a/src/plone/app/multilingual/dx/configure.zcml b/src/plone/app/multilingual/dx/configure.zcml\nindex 9d4e60c32..349fea424 100644\n--- a/src/plone/app/multilingual/dx/configure.zcml\n+++ b/src/plone/app/multilingual/dx/configure.zcml\n@@ -3,75 +3,86 @@\n     xmlns:five="http://namespaces.zope.org/five"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n   <include file="meta.zcml" />\n \n   <!-- Configure plone.schemaeditor adapter -->\n   <adapter\n+      factory=".schemaeditor.get_li_schema"\n       provides="plone.schemaeditor.interfaces.IFieldEditorExtender"\n       for="zope.schema.interfaces.IField"\n       name="plone.schemaeditor.languageindependent"\n-      factory=".schemaeditor.get_li_schema"/>\n+      />\n \n   <adapter\n+      factory=".schemaeditor.FieldLanguageIndependentAdapter"\n       provides=".schemaeditor.IFieldLanguageIndependent"\n       for="zope.schema.interfaces.IField"\n-      factory=".schemaeditor.FieldLanguageIndependentAdapter"/>\n+      />\n \n \n   <!-- Configure plone.supermodel handler -->\n   <utility\n       factory=".supermodel.LanguageIndependentFieldMetadataHandler"\n-      name="plone.rfc822.lingua"/>\n+      name="plone.rfc822.lingua"\n+      />\n \n   <adapter\n       factory=".directives.LanguageIndependentFieldsPlugin"\n-      name="plone.rfc822.lingua"/>\n+      name="plone.rfc822.lingua"\n+      />\n \n \n   <plone:behavior\n+      name="plone.translatable"\n       title="Multilingual Support"\n       description="Make this content type multilingual aware"\n-      name="plone.translatable"\n-      provides=".interfaces.IDexterityTranslatable"/>\n+      provides=".interfaces.IDexterityTranslatable"\n+      />\n \n   <adapter\n-      for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable"\n+      factory=".cloner.LanguageIndependentFieldsManager"\n       provides="plone.app.multilingual.interfaces.ILanguageIndependentFieldsManager"\n-      factory=".cloner.LanguageIndependentFieldsManager"/>\n+      for="plone.app.multilingual.dx.interfaces.IDexterityTranslatable"\n+      />\n \n   <adapter\n-      for="plone.dexterity.interfaces.IDexterityContent"\n+      factory=".language.Language"\n       provides="plone.base.interfaces.ILanguage"\n-      factory=".language.Language"/>\n+      for="plone.dexterity.interfaces.IDexterityContent"\n+      />\n \n   <adapter\n+      factory=".form.AddingLanguageIndependentValue"\n       for="*\n            *\n            plone.app.multilingual.dx.interfaces.IMultilingualAddForm\n            plone.app.multilingual.dx.interfaces.ILanguageIndependentField\n            z3c.form.interfaces.IWidget"\n-      factory=".form.AddingLanguageIndependentValue"\n-      name="default"/>\n+      name="default"\n+      />\n \n   <adapter\n+      factory=".form.LanguageIndependentFieldValidator"\n+      provides="z3c.form.interfaces.IValidator"\n       for="*\n            plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled\n            plone.app.multilingual.dx.interfaces.IMultilingualAddForm\n            plone.app.multilingual.dx.interfaces.ILanguageIndependentField\n            *"\n-      provides="z3c.form.interfaces.IValidator"\n-      factory=".form.LanguageIndependentFieldValidator"/>\n+      />\n \n   <adapter\n+      factory=".form.LanguageIndependentFieldInputTemplate"\n+      provides="zope.pagetemplate.interfaces.IPageTemplate"\n       for="*\n            plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled\n            plone.app.multilingual.dx.interfaces.IMultilingualAddForm\n            plone.app.multilingual.dx.interfaces.ILanguageIndependentField\n            *"\n-      provides="zope.pagetemplate.interfaces.IPageTemplate"\n       name="input"\n-      factory=".form.LanguageIndependentFieldInputTemplate"/>\n+      />\n \n </configure>\ndiff --git a/src/plone/app/multilingual/dx/interfaces.py b/src/plone/app/multilingual/dx/interfaces.py\nindex ccae20dbf..683407f04 100644\n--- a/src/plone/app/multilingual/dx/interfaces.py\n+++ b/src/plone/app/multilingual/dx/interfaces.py\n@@ -17,8 +17,8 @@ class IMultilingualAddForm(Interface):\n     """Marker Interface for multilingual add forms\n \n     This marker is intended to be provided by the main multilingual add form\n-    ans to be provided by the groups (aka fieldset) forms\n-    (plone.z3cform.fieldsets.group.Group). This is neccessary in order to\n+    and to be provided by the groups (aka fieldset) forms\n+    (plone.z3cform.fieldsets.group.Group). This is necessary in order to\n     make the special template renderer for ILanguageIndependentField fields\n     work in fieldset tabs too.\n     """\ndiff --git a/src/plone/app/multilingual/dx/languageindependent.py b/src/plone/app/multilingual/dx/languageindependent.py\nindex b18bd256a..33773b02d 100644\n--- a/src/plone/app/multilingual/dx/languageindependent.py\n+++ b/src/plone/app/multilingual/dx/languageindependent.py\n@@ -2,6 +2,7 @@\n from plone.app.event.dx.behaviors import IEventBasic\n from zope.interface import alsoProvides\n \n+\n # configure existing behaviors to be language independent\n alsoProvides(IEventBasic["start"], ILanguageIndependentField)\n alsoProvides(IEventBasic["end"], ILanguageIndependentField)\ndiff --git a/src/plone/app/multilingual/dx/meta.zcml b/src/plone/app/multilingual/dx/meta.zcml\nindex 6db436c14..c9a466370 100644\n--- a/src/plone/app/multilingual/dx/meta.zcml\n+++ b/src/plone/app/multilingual/dx/meta.zcml\n@@ -1,3 +1,6 @@\n <configure xmlns="http://namespaces.zope.org/zope">\n-  <include package="plone.behavior" file="meta.zcml" />\n+  <include\n+      package="plone.behavior"\n+      file="meta.zcml"\n+      />\n </configure>\ndiff --git a/src/plone/app/multilingual/dx/subscriber.py b/src/plone/app/multilingual/dx/subscriber.py\nindex fcf73dcb6..c050deb4c 100644\n--- a/src/plone/app/multilingual/dx/subscriber.py\n+++ b/src/plone/app/multilingual/dx/subscriber.py\n@@ -71,7 +71,7 @@ def handle_modified(self, content):\n             if self.bypass_security_checks():\n                 # Clone the current user and assign a new editor role to\n                 # allow edition of all translated objects even if the\n-                # current user whould not have permission to do that.\n+                # current user would not have permission to do that.\n                 tmp_user = UnrestrictedUser(\n                     sm.getUser().getId(),\n                     "",\n@@ -106,7 +106,7 @@ def reindex_translation(self, translation):\n         descriptions = Attributes(schema)\n         # where is this information needed?\n         # XXX behaviors need to be considered here\n-        # use plone.dexterity.utils.iterSchemata or similiar\n+        # use plone.dexterity.utils.iterSchemata or similar\n \n         # Pass the canonical object as a event description\n         notify(ObjectModifiedEvent(translation, descriptions, self.canonical))\ndiff --git a/src/plone/app/multilingual/events.py b/src/plone/app/multilingual/events.py\nindex d8e16e6f8..79ca78be9 100644\n--- a/src/plone/app/multilingual/events.py\n+++ b/src/plone/app/multilingual/events.py\n@@ -26,7 +26,7 @@ class ITranslationRegisteredEvent(IObjectEvent):\n \n     object = Attribute("The base object.")\n     target = Attribute("The translated object.")\n-    language = Attribute("The language of the translated obejct.")\n+    language = Attribute("The language of the translated object.")\n \n \n class ITranslationUpdatedEvent(IObjectEvent):\ndiff --git a/src/plone/app/multilingual/factory.py b/src/plone/app/multilingual/factory.py\nindex 1dd7db7ea..ef5c5a18a 100644\n--- a/src/plone/app/multilingual/factory.py\n+++ b/src/plone/app/multilingual/factory.py\n@@ -67,10 +67,10 @@ def __init__(self, context):\n \n     def __call__(self, parent, language):\n         content_id = self.context.getId()\n-        splitted = content_id.split("-")\n+        parts = content_id.split("-")\n         # ugly heuristic (searching for something like \'de\', \'en\' etc.)\n-        if len(splitted) > 1 and len(splitted[-1]) == 2:\n-            content_id = "-".join(splitted[:-1])\n+        if len(parts) > 1 and len(parts[-1]) == 2:\n+            content_id = "-".join(parts[:-1])\n         while content_id in parent.objectIds():\n             content_id = f"{content_id}-{language}"\n         return content_id\ndiff --git a/src/plone/app/multilingual/interfaces.py b/src/plone/app/multilingual/interfaces.py\nindex 3e94451f5..d70201d67 100644\n--- a/src/plone/app/multilingual/interfaces.py\n+++ b/src/plone/app/multilingual/interfaces.py\n@@ -239,7 +239,7 @@ class IMultiLanguageExtraOptionsSchema(ILanguageSchema):\n     buttons_babel_view_up_to_nr_translations = schema.Int(\n         title=_(\n             "heading_buttons_babel_view_up_to_nr_translations",\n-            default="Use buttons in the bable view for up to how many " "translations?",\n+            default="Use buttons in the babel view for up to how many translations?",\n         ),\n         description=_(\n             "description_buttons_babel_view_up_to_nr_translations",\ndiff --git a/src/plone/app/multilingual/overrides.zcml b/src/plone/app/multilingual/overrides.zcml\nindex 03adc3980..652051279 100644\n--- a/src/plone/app/multilingual/overrides.zcml\n+++ b/src/plone/app/multilingual/overrides.zcml\n@@ -1,6 +1,8 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-    i18n_domain="plone">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    i18n_domain="plone"\n+    >\n \n-  <adapter factory=".shared_uuid.attributeUUID"/>\n+  <adapter factory=".shared_uuid.attributeUUID" />\n \n </configure>\ndiff --git a/src/plone/app/multilingual/permissions.zcml b/src/plone/app/multilingual/permissions.zcml\nindex ce04d5479..696f40078 100644\n--- a/src/plone/app/multilingual/permissions.zcml\n+++ b/src/plone/app/multilingual/permissions.zcml\n@@ -1,8 +1,11 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-    i18n_domain="plone">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    i18n_domain="plone"\n+    >\n \n   <permission\n       id="plone.app.multilingual.ManageTranslations"\n-      title="plone.app.multilingual: Manage Translations"/>\n+      title="plone.app.multilingual: Manage Translations"\n+      />\n \n </configure>\ndiff --git a/src/plone/app/multilingual/profiles/default/browserlayer.xml b/src/plone/app/multilingual/profiles/default/browserlayer.xml\nindex 40f722a1f..9b9054d01 100644\n--- a/src/plone/app/multilingual/profiles/default/browserlayer.xml\n+++ b/src/plone/app/multilingual/profiles/default/browserlayer.xml\n@@ -1,5 +1,6 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <layers>\n-  <layer\n-      name="plone.app.multilingual"\n-      interface="plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled"/>\n+  <layer interface="plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled"\n+         name="plone.app.multilingual"\n+  />\n </layers>\ndiff --git a/src/plone/app/multilingual/profiles/default/catalog.xml b/src/plone/app/multilingual/profiles/default/catalog.xml\nindex 24f690fa9..e8d4b91ba 100644\n--- a/src/plone/app/multilingual/profiles/default/catalog.xml\n+++ b/src/plone/app/multilingual/profiles/default/catalog.xml\n@@ -1,14 +1,20 @@\n-<?xml version="1.0"?>\n-<object name="portal_catalog" meta_type="Plone Catalog Tool">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Catalog Tool"\n+        name="portal_catalog"\n+>\n \n-  <index name="Language" meta_type="FieldIndex">\n-    <indexed_attr value="Language"/>\n+  <index meta_type="FieldIndex"\n+         name="Language"\n+  >\n+    <indexed_attr value="Language" />\n   </index>\n-  <column value="Language"/>\n+  <column value="Language" />\n \n-  <index name="TranslationGroup" meta_type="FieldIndex">\n-    <indexed_attr value="TranslationGroup"/>\n+  <index meta_type="FieldIndex"\n+         name="TranslationGroup"\n+  >\n+    <indexed_attr value="TranslationGroup" />\n   </index>\n-  <column value="TranslationGroup"/>\n+  <column value="TranslationGroup" />\n \n </object>\ndiff --git a/src/plone/app/multilingual/profiles/default/metadata.xml b/src/plone/app/multilingual/profiles/default/metadata.xml\nindex f13799b6d..d7e94be60 100644\n--- a/src/plone/app/multilingual/profiles/default/metadata.xml\n+++ b/src/plone/app/multilingual/profiles/default/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>1001</version>\n   <dependencies>\ndiff --git a/src/plone/app/multilingual/profiles/default/reference_catalog.xml b/src/plone/app/multilingual/profiles/default/reference_catalog.xml\nindex e3427c17a..ed3243a09 100644\n--- a/src/plone/app/multilingual/profiles/default/reference_catalog.xml\n+++ b/src/plone/app/multilingual/profiles/default/reference_catalog.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="reference_catalog">\n   <column value="Language" />\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/default/registry.xml b/src/plone/app/multilingual/profiles/default/registry.xml\nindex d10517d7f..9df569696 100644\n--- a/src/plone/app/multilingual/profiles/default/registry.xml\n+++ b/src/plone/app/multilingual/profiles/default/registry.xml\n@@ -1,29 +1,38 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n \n-  <records prefix="plone.bundles/multilingual"\n-            interface=\'plone.base.interfaces.IBundleRegistry\'>\n+  <records interface="plone.base.interfaces.IBundleRegistry"\n+           prefix="plone.bundles/multilingual"\n+  >\n     <value key="enabled">True</value>\n     <value key="csscompilation">++resource++plone.app.multilingual.stylesheet/multilingual.css</value>\n   </records>\n \n-  <records interface="plone.base.interfaces.ITinyMCEResourceTypesSchema" prefix="plone">\n-    <value key="contains_objects" purge="false"><element>LIF</element></value>\n+  <records interface="plone.base.interfaces.ITinyMCEResourceTypesSchema"\n+           prefix="plone"\n+  >\n+    <value key="contains_objects"\n+           purge="false"\n+    ><element>LIF</element></value>\n   </records>\n \n-  <records interface="plone.i18n.interfaces.ILanguageSchema" prefix="plone">\n+  <records interface="plone.i18n.interfaces.ILanguageSchema"\n+           prefix="plone"\n+  >\n     <value key="use_cookie_negotiation">True</value>\n     <value key="use_request_negotiation">False</value>\n     <value key="use_content_negotiation">True</value>\n     <value key="display_flags">False</value>\n   </records>\n \n-  <records interface="plone.app.multilingual.interfaces.IMultiLanguageExtraOptionsSchema" prefix="plone">\n+  <records interface="plone.app.multilingual.interfaces.IMultiLanguageExtraOptionsSchema"\n+           prefix="plone"\n+  >\n     <value key="filter_content">True</value>\n     <value key="redirect_babel_view">True</value>\n     <value key="bypass_languageindependent_field_permission_check">False</value>\n     <value key="buttons_babel_view_up_to_nr_translations">7</value>\n-    <value key="google_translation_key"></value>\n+    <value key="google_translation_key" />\n     <value key="selector_lookup_translations_policy">closest</value>\n   </records>\n \ndiff --git a/src/plone/app/multilingual/profiles/default/rolemap.xml b/src/plone/app/multilingual/profiles/default/rolemap.xml\nindex 3830837d0..b6186286d 100644\n--- a/src/plone/app/multilingual/profiles/default/rolemap.xml\n+++ b/src/plone/app/multilingual/profiles/default/rolemap.xml\n@@ -1,11 +1,13 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <rolemap>\n   <permissions>\n-    <permission name="plone.app.multilingual: Manage Translations" acquire="True">\n-      <role name="Manager"/>\n-      <role name="Site Administrator"/>\n-      <role name="Owner"/>\n-      <role name="Editor"/>\n+    <permission acquire="True"\n+                name="plone.app.multilingual: Manage Translations"\n+    >\n+      <role name="Manager" />\n+      <role name="Site Administrator" />\n+      <role name="Owner" />\n+      <role name="Editor" />\n     </permission>\n   </permissions>\n </rolemap>\ndiff --git a/src/plone/app/multilingual/profiles/default/types.xml b/src/plone/app/multilingual/profiles/default/types.xml\nindex cfc6565fd..530ca0f36 100644\n--- a/src/plone/app/multilingual/profiles/default/types.xml\n+++ b/src/plone/app/multilingual/profiles/default/types.xml\n@@ -1,5 +1,11 @@\n-<?xml version="1.0"?>\n-<object meta_type="Plone Types Tool" name="portal_types">\n-  <object meta_type="Dexterity FTI" name="LRF" />\n-  <object meta_type="Dexterity FTI" name="LIF" />\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n+  <object meta_type="Dexterity FTI"\n+          name="LRF"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="LIF"\n+  />\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/default/types/LIF.xml b/src/plone/app/multilingual/profiles/default/types/LIF.xml\nindex fecf15653..bcb60e361 100644\n--- a/src/plone/app/multilingual/profiles/default/types/LIF.xml\n+++ b/src/plone/app/multilingual/profiles/default/types/LIF.xml\n@@ -1,49 +1,79 @@\n-<?xml version="1.0"?>\n-<object name="LIF" meta_type="Dexterity FTI" i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n-  <property name="title" i18n:translate="">Language Independent Folder</property>\n-  <property name="description" i18n:translate=""></property>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="LIF"\n+        i18n:domain="plone"\n+>\n+  <property name="title"\n+            i18n:translate=""\n+  >Language Independent Folder</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n   <property name="icon_expr">string:contenttype/folder</property>\n   <property name="factory">LIF</property>\n   <property name="add_view_expr">string:${folder_url}/++add++LIF</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n   <property name="immediate_view">view</property>\n   <property name="global_allow">False</property>\n   <property name="filter_content_types">False</property>\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="allow_discussion">False</property>\n   <property name="default_view">folder_listing</property>\n   <property name="view_methods">\n-    <element value="summary_view"/>\n-    <element value="full_view"/>\n-    <element value="tabular_view"/>\n-    <element value="album_view"/>\n-    <element value="folder_listing"/>\n+    <element value="summary_view" />\n+    <element value="full_view" />\n+    <element value="tabular_view" />\n+    <element value="album_view" />\n+    <element value="folder_listing" />\n   </property>\n   <property name="default_view_fallback">False</property>\n   <property name="add_permission">cmf.ManagePortal</property>\n   <property name="klass">plone.dexterity.content.Container</property>\n   <property name="behaviors">\n-    <element value="plone.dublincore"/>\n-    <element value="plone.namefromtitle"/>\n-    <element value="plone.constraintypes"/>\n+    <element value="plone.dublincore" />\n+    <element value="plone.namefromtitle" />\n+    <element value="plone.constraintypes" />\n     <element value="plone.translatable" />\n-    <element value="plone.excludefromnavigation"/>\n+    <element value="plone.excludefromnavigation" />\n   </property>\n   <property name="schema">plone.app.multilingual.interfaces.ILanguageIndependentFolder</property>\n-  <property name="model_source"></property>\n+  <property name="model_source" />\n   <property name="model_file">plone.app.multilingual.content:lif.xml</property>\n-  <alias from="(Default)" to="(dynamic view)"/>\n-  <alias from="edit" to="@@edit"/>\n-  <alias from="sharing" to="@@sharing"/>\n-  <alias from="view" to="(selected layout)"/>\n-  <action title="View" action_id="view" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/view" link_target="" url_expr="string:${object_url}"\n-      visible="True" i18n:attributes="title">\n-    <permission value="View"/>\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n+  />\n+  <alias from="edit"\n+         to="@@edit"\n+  />\n+  <alias from="sharing"\n+         to="@@sharing"\n+  />\n+  <alias from="view"\n+         to="(selected layout)"\n+  />\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          link_target=""\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action title="Edit" action_id="edit" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/edit" link_target="" url_expr="string:${object_url}/edit"\n-      visible="True" i18n:attributes="title">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          link_target=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/default/types/LRF.xml b/src/plone/app/multilingual/profiles/default/types/LRF.xml\nindex 66fb65679..d069fba1e 100644\n--- a/src/plone/app/multilingual/profiles/default/types/LRF.xml\n+++ b/src/plone/app/multilingual/profiles/default/types/LRF.xml\n@@ -1,50 +1,80 @@\n-<?xml version="1.0"?>\n-<object name="LRF" meta_type="Dexterity FTI" i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n-  <property name="title" i18n:translate="">Language Root Folder</property>\n-  <property name="description" i18n:translate=""></property>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="LRF"\n+        i18n:domain="plone"\n+>\n+  <property name="title"\n+            i18n:translate=""\n+  >Language Root Folder</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n   <property name="icon_expr">string:contenttype/folder</property>\n   <property name="factory">LRF</property>\n   <property name="add_view_expr">string:${folder_url}/++add++LRF</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n   <property name="immediate_view">view</property>\n   <property name="global_allow">False</property>\n   <property name="filter_content_types">False</property>\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="allow_discussion">False</property>\n   <property name="default_view">folder_listing</property>\n   <property name="view_methods">\n-    <element value="summary_view"/>\n-    <element value="full_view"/>\n-    <element value="tabular_view"/>\n-    <element value="album_view"/>\n-    <element value="folder_listing"/>\n+    <element value="summary_view" />\n+    <element value="full_view" />\n+    <element value="tabular_view" />\n+    <element value="album_view" />\n+    <element value="folder_listing" />\n   </property>\n   <property name="default_view_fallback">False</property>\n   <property name="add_permission">cmf.ManagePortal</property>\n   <property name="klass">plone.dexterity.content.Container</property>\n   <property name="behaviors">\n-    <element value="plone.dublincore"/>\n-    <element value="plone.namefromtitle"/>\n-    <element value="plone.constraintypes"/>\n+    <element value="plone.dublincore" />\n+    <element value="plone.namefromtitle" />\n+    <element value="plone.constraintypes" />\n     <element value="plone.translatable" />\n-    <element value="plone.excludefromnavigation"/>\n-    <element value="plone.navigationroot"/>\n+    <element value="plone.excludefromnavigation" />\n+    <element value="plone.navigationroot" />\n   </property>\n   <property name="schema">plone.app.multilingual.interfaces.ILanguageRootFolder</property>\n-  <property name="model_source"></property>\n+  <property name="model_source" />\n   <property name="model_file">plone.app.multilingual.content:lrf.xml</property>\n-  <alias from="(Default)" to="(dynamic view)"/>\n-  <alias from="edit" to="@@edit"/>\n-  <alias from="sharing" to="@@sharing"/>\n-  <alias from="view" to="(selected layout)"/>\n-  <action title="View" action_id="view" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/view" link_target="" url_expr="string:${object_url}"\n-      visible="True" i18n:attributes="title">\n-    <permission value="View"/>\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n+  />\n+  <alias from="edit"\n+         to="@@edit"\n+  />\n+  <alias from="sharing"\n+         to="@@sharing"\n+  />\n+  <alias from="view"\n+         to="(selected layout)"\n+  />\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          link_target=""\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action title="Edit" action_id="edit" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/edit" link_target="" url_expr="string:${object_url}/edit"\n-      visible="True" i18n:attributes="title">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          link_target=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/default/viewlets.xml b/src/plone/app/multilingual/profiles/default/viewlets.xml\nindex c7741b9fc..fde5c1cce 100644\n--- a/src/plone/app/multilingual/profiles/default/viewlets.xml\n+++ b/src/plone/app/multilingual/profiles/default/viewlets.xml\n@@ -1,9 +1,15 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object>\n-  <hidden manager="plone.portalheader" skinname="Plone Default">\n+  <hidden manager="plone.portalheader"\n+          skinname="Plone Default"\n+  >\n     <viewlet name="plone.app.i18n.locales.languageselector" />\n   </hidden>\n-  <order manager="plone.portalheader" skinname="Plone Default">\n-    <viewlet name="plone.app.multilingual.languageselector" insert-after="plone.personal_bar" />\n+  <order manager="plone.portalheader"\n+         skinname="Plone Default"\n+  >\n+    <viewlet insert-after="plone.personal_bar"\n+             name="plone.app.multilingual.languageselector"\n+    />\n   </order>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/browserlayer.xml b/src/plone/app/multilingual/profiles/uninstall/browserlayer.xml\nindex 35468acbf..5fd0d5643 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/browserlayer.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/browserlayer.xml\n@@ -1,3 +1,7 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <layers>\n-  <layer remove="True" name="plone.app.multilingual" interface="plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled"/>\n+  <layer interface="plone.app.multilingual.interfaces.IPloneAppMultilingualInstalled"\n+         name="plone.app.multilingual"\n+         remove="True"\n+  />\n </layers>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/catalog.xml b/src/plone/app/multilingual/profiles/uninstall/catalog.xml\nindex a73e51c13..2f1cfc30c 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/catalog.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/catalog.xml\n@@ -1,7 +1,19 @@\n-<?xml version="1.0"?>\n-<object name="portal_catalog" meta_type="Plone Catalog Tool">\n-  <index remove="True" name="Language" meta_type="FieldIndex"/>\n-  <column remove="True" value="Language"/>\n-  <index remove="True" name="TranslationGroup" meta_type="FieldIndex"/>\n-  <column remove="True" value="TranslationGroup"/>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Catalog Tool"\n+        name="portal_catalog"\n+>\n+  <index meta_type="FieldIndex"\n+         name="Language"\n+         remove="True"\n+  />\n+  <column remove="True"\n+          value="Language"\n+  />\n+  <index meta_type="FieldIndex"\n+         name="TranslationGroup"\n+         remove="True"\n+  />\n+  <column remove="True"\n+          value="TranslationGroup"\n+  />\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/cssregistry.xml b/src/plone/app/multilingual/profiles/uninstall/cssregistry.xml\nindex f5e4e306e..e47879c26 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/cssregistry.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/cssregistry.xml\n@@ -1,4 +1,6 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="portal_css">\n-  <stylesheet remove="True" id="++resource++plone.app.multilingual.stylesheet/multilingual.css"/>\n+  <stylesheet id="++resource++plone.app.multilingual.stylesheet/multilingual.css"\n+              remove="True"\n+  />\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/metadata.xml b/src/plone/app/multilingual/profiles/uninstall/metadata.xml\nindex a44cc3495..dbfd3b42e 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/metadata.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>3</version>\n </metadata>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/reference_catalog.xml b/src/plone/app/multilingual/profiles/uninstall/reference_catalog.xml\nindex 133f9d6fb..4d821c905 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/reference_catalog.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/reference_catalog.xml\n@@ -1,5 +1,6 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="reference_catalog">\n-  <column remove="True" value="Language" />\n+  <column remove="True"\n+          value="Language"\n+  />\n </object>\n-\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/types.xml b/src/plone/app/multilingual/profiles/uninstall/types.xml\nindex 3ca476694..acf1aabcb 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/types.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/types.xml\n@@ -1,4 +1,9 @@\n-<?xml version="1.0"?>\n-<object meta_type="Plone Types Tool" name="portal_types">\n-  <object remove="True" meta_type="Dexterity FTI" name="LRF" />\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n+  <object meta_type="Dexterity FTI"\n+          name="LRF"\n+          remove="True"\n+  />\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/uninstall/viewlets.xml b/src/plone/app/multilingual/profiles/uninstall/viewlets.xml\nindex d54997576..ea57ceebf 100644\n--- a/src/plone/app/multilingual/profiles/uninstall/viewlets.xml\n+++ b/src/plone/app/multilingual/profiles/uninstall/viewlets.xml\n@@ -1,10 +1,14 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object>\n-  <hidden manager="plone.portalheader" skinname="Plone Default">\n-    <viewlet name="plone.app.multilingual.languageselector"/>\n+  <hidden manager="plone.portalheader"\n+          skinname="Plone Default"\n+  >\n+    <viewlet name="plone.app.multilingual.languageselector" />\n   </hidden>\n \n-  <order manager="plone.portalheader" skinname="Plone Default">\n-    <viewlet name="plone.app.i18n.locales.languageselector"/>\n+  <order manager="plone.portalheader"\n+         skinname="Plone Default"\n+  >\n+    <viewlet name="plone.app.i18n.locales.languageselector" />\n   </order>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LIF.xml b/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LIF.xml\nindex 0a678610e..4ca397e0a 100644\n--- a/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LIF.xml\n+++ b/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LIF.xml\n@@ -1,15 +1,35 @@\n-<?xml version="1.0"?>\n-<object name="LIF" meta_type="Dexterity FTI" i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n-  <property name="title" i18n:translate="">Language Independent Folder</property>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="LIF"\n+        i18n:domain="plone"\n+>\n+  <property name="title"\n+            i18n:translate=""\n+  >Language Independent Folder</property>\n   <property name="icon_expr">string:contenttype/folder</property>\n-  <action title="View" action_id="view" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/view" link_target="" url_expr="string:${object_url}"\n-      visible="True" i18n:attributes="title">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          link_target=""\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action title="Edit" action_id="edit" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/edit" link_target="" url_expr="string:${object_url}/edit"\n-      visible="True" i18n:attributes="title">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          link_target=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LRF.xml b/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LRF.xml\nindex f411d40b9..2e14f3727 100644\n--- a/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LRF.xml\n+++ b/src/plone/app/multilingual/profiles/upgrades/to_1000/types/LRF.xml\n@@ -1,15 +1,35 @@\n-<?xml version="1.0"?>\n-<object name="LRF" meta_type="Dexterity FTI" i18n:domain="plone" xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n-  <property name="title" i18n:translate="">Language Root Folder</property>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="LRF"\n+        i18n:domain="plone"\n+>\n+  <property name="title"\n+            i18n:translate=""\n+  >Language Root Folder</property>\n   <property name="icon_expr">string:contenttype/folder</property>\n-  <action title="View" action_id="view" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/view" link_target="" url_expr="string:${object_url}"\n-      visible="True" i18n:attributes="title">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          link_target=""\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action title="Edit" action_id="edit" category="object" condition_expr=""\n-      icon_expr="string:toolbar-action/edit" link_target="" url_expr="string:${object_url}/edit"\n-      visible="True" i18n:attributes="title">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          link_target=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n </object>\ndiff --git a/src/plone/app/multilingual/profiles/upgrades/to_3/registry.xml b/src/plone/app/multilingual/profiles/upgrades/to_3/registry.xml\nindex a719a89b2..a7a1f8a00 100644\n--- a/src/plone/app/multilingual/profiles/upgrades/to_3/registry.xml\n+++ b/src/plone/app/multilingual/profiles/upgrades/to_3/registry.xml\n@@ -1,7 +1,8 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n- <records interface="plone.app.multilingual.interfaces.IMultiLanguageExtraOptionsSchema"\n-          prefix="plone">\n+  <records interface="plone.app.multilingual.interfaces.IMultiLanguageExtraOptionsSchema"\n+           prefix="plone"\n+  >\n     <value key="bypass_languageindependent_field_permission_check">False</value>\n- </records>\n+  </records>\n </registry>\ndiff --git a/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml b/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\nindex 9f9fe2c53..70f8c0527 100644\n--- a/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\n+++ b/src/plone/app/multilingual/profiles/upgrades/to_4/registry.xml\n@@ -1,21 +1,25 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n \n   <!-- remove old resource and bundle registration -->\n-  <record name="plone.bundles/plone-legacy.resources"\n-          interface="plone.base.interfaces.resources.IBundleRegistry" field="resources">\n+  <record field="resources"\n+          interface="plone.base.interfaces.resources.IBundleRegistry"\n+          name="plone.bundles/plone-legacy.resources"\n+  >\n     <value purge="false">\n       <element remove="true">multilingual</element>\n     </value>\n   </record>\n-  <records prefix="plone.resources/multilingual"\n-           interface=\'plone.base.interfaces.IResourceRegistry\'\n-           remove="true">\n-  </records>\n+  <records interface="plone.base.interfaces.IResourceRegistry"\n+           prefix="plone.resources/multilingual"\n+           remove="true"\n+  >\n+</records>\n \n   <!-- register new bundle -->\n-  <records prefix="plone.bundles/multilingual"\n-            interface=\'plone.base.interfaces.IBundleRegistry\'>\n+  <records interface="plone.base.interfaces.IBundleRegistry"\n+           prefix="plone.bundles/multilingual"\n+  >\n     <value key="enabled">True</value>\n     <value key="compile">False</value>\n     <value key="merge_with">logged-in</value>\ndiff --git a/src/plone/app/multilingual/testing.zcml b/src/plone/app/multilingual/testing.zcml\nindex c49356db6..ae4fbf82a 100644\n--- a/src/plone/app/multilingual/testing.zcml\n+++ b/src/plone/app/multilingual/testing.zcml\n@@ -1,6 +1,7 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n   <include file="configure.zcml" />\n   <include package="plone.app.contenttypes" />\ndiff --git a/src/plone/app/multilingual/tests/test_selector.py b/src/plone/app/multilingual/tests/test_selector.py\nindex eea4f1850..712019e4e 100644\n--- a/src/plone/app/multilingual/tests/test_selector.py\n+++ b/src/plone/app/multilingual/tests/test_selector.py\n@@ -11,12 +11,12 @@\n from plone.app.multilingual.testing import PAM_FUNCTIONAL_TESTING\n from plone.app.multilingual.testing import PAM_INTEGRATION_PRESET_TESTING\n from plone.app.multilingual.testing import PAM_INTEGRATION_TESTING\n+from plone.base.utils import safe_text\n from plone.dexterity.utils import createContentInContainer\n from plone.i18n.interfaces import ILanguageSchema\n from plone.registry.interfaces import IRegistry\n from plone.testing.z2 import Browser\n from Products.CMFCore.utils import getToolByName\n-from plone.base.utils import safe_text\n from urllib.parse import parse_qs\n from urllib.parse import urlparse\n from zope.component import getUtility\ndiff --git a/src/plone/app/multilingual/tests/test_setup.py b/src/plone/app/multilingual/tests/test_setup.py\nindex 8b2a57109..289a9f758 100644\n--- a/src/plone/app/multilingual/tests/test_setup.py\n+++ b/src/plone/app/multilingual/tests/test_setup.py\n@@ -1,12 +1,8 @@\n from Acquisition import aq_base\n from plone.app.multilingual.browser.setup import SetupMultilingualSite\n-from plone.app.multilingual.browser.vocabularies import (  # noqa: E501\n-    AllContentLanguageVocabulary,\n-)\n+from plone.app.multilingual.browser.vocabularies import AllContentLanguageVocabulary\n from plone.app.multilingual.interfaces import ATTRIBUTE_NAME\n from plone.app.multilingual.interfaces import IPloneAppMultilingualInstalled\n-from plone.app.multilingual.interfaces import ITG\n-from plone.app.multilingual.interfaces import ITranslatable\n from plone.app.multilingual.testing import PAM_INTEGRATION_PRESET_TESTING\n from plone.app.multilingual.testing import PAM_INTEGRATION_TESTING\n from Products.CMFCore.utils import getToolByName\ndiff --git a/src/plone/app/multilingual/tests/test_sitemap.py b/src/plone/app/multilingual/tests/test_sitemap.py\nindex 7418f0783..ed3c2239f 100644\n--- a/src/plone/app/multilingual/tests/test_sitemap.py\n+++ b/src/plone/app/multilingual/tests/test_sitemap.py\n@@ -42,9 +42,9 @@ def setUp(self):\n \n     def uncompress(self, sitemapdata):\n         sio = BytesIO(sitemapdata)\n-        unziped = GzipFile(fileobj=sio)\n-        xml = unziped.read()\n-        unziped.close()\n+        unzipped = GzipFile(fileobj=sio)\n+        xml = unzipped.read()\n+        unzipped.close()\n         return xml\n \n     def test_portalroot_sitemap(self):\ndiff --git a/src/plone/app/multilingual/upgrades.py b/src/plone/app/multilingual/upgrades.py\nindex efd211258..4649df20f 100644\n--- a/src/plone/app/multilingual/upgrades.py\n+++ b/src/plone/app/multilingual/upgrades.py\n@@ -1,10 +1,8 @@\n-from Acquisition import aq_base\n from plone.app.multilingual import logger\n from plone.base.interfaces import ILanguage\n-from plone.dexterity.interfaces import IDexterityFTI\n+from plone.base.utils import unrestricted_construct_instance\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n-from plone.base.utils import unrestricted_construct_instance\n from time import time\n from zope.component import getUtility\n \n@@ -52,7 +50,7 @@ def migration_pam_1_to_2(context):\n         older = portal[code]\n \n         if older.portal_type == type_name:\n-            logger.info(f"\'{code}\' is alredy a {type_name}, skipping.")\n+            logger.info(f"\'{code}\' is already a {type_name}, skipping.")\n             continue\n \n         # PHASE 1: rename old language folders\ndiff --git a/src/plone/app/multilingual/upgrades.zcml b/src/plone/app/multilingual/upgrades.zcml\nindex b3fa54437..9396c830f 100644\n--- a/src/plone/app/multilingual/upgrades.zcml\n+++ b/src/plone/app/multilingual/upgrades.zcml\n@@ -1,80 +1,86 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n   <genericsetup:upgradeStep\n-      source="1"\n-      destination="2"\n       title="Update css_registry to render styles for authenticated users only."\n       description=""\n       profile="plone.app.multilingual:default"\n+      source="1"\n+      destination="2"\n       handler=".upgrades.reimport_css_registry"\n       />\n \n   <genericsetup:upgradeStep\n       title="Migration for new LRF type"\n       description="Rename old language folders and copy content into new LRF. Migrate shared folder to portal root."\n+      profile="plone.app.multilingual:default"\n       source="1"\n       destination="2"\n       handler="plone.app.multilingual.upgrades.migration_pam_1_to_2"\n-      profile="plone.app.multilingual:default"/>\n+      />\n \n   <genericsetup:registerProfile\n       name="to_3"\n       title="Update new registry key"\n-      directory="profiles/upgrades/to_3"\n-      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/upgrades/to_3"\n       />\n \n   <genericsetup:upgradeStep\n+      title="Add new registry entry"\n       profile="plone.app.multilingual:default"\n       source="2"\n       destination="3"\n-      title="Add new registry entry"\n       handler=".upgrades.upgrade_to_3"\n       />\n \n   <genericsetup:registerProfile\n       name="to_4"\n       title="Update bundle registration"\n-      directory="profiles/upgrades/to_4"\n-      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/upgrades/to_4"\n       />\n \n   <genericsetup:upgradeStep\n+      title="Update bundle registration"\n       profile="plone.app.multilingual:default"\n       source="3"\n       destination="4"\n-      title="Update bundle registration"\n       handler=".upgrades.upgrade_to_4"\n       />\n \n   <genericsetup:registerProfile\n       name="to_1000"\n       title="Update to 1000"\n-      directory="profiles/upgrades/to_1000"\n-      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/upgrades/to_1000"\n       />\n \n-  <genericsetup:upgradeSteps source="4"\n+  <genericsetup:upgradeSteps\n+      profile="plone.app.multilingual:default"\n+      source="4"\n       destination="1000"\n-      profile="plone.app.multilingual:default">\n+      >\n \n-      <genericsetup:upgradeDepends\n+    <genericsetup:upgradeDepends\n         title="Add icon expressions"\n-        import_profile="plone.app.multilingual:to_1000" />\n+        import_profile="plone.app.multilingual:to_1000"\n+        />\n \n   </genericsetup:upgradeSteps>\n \n   <genericsetup:upgradeStep\n+      title="Update old layouts"\n+      profile="plone.app.multilingual:default"\n       source="1000"\n       destination="1001"\n-      profile="plone.app.multilingual:default"\n-      title="Update old layouts"\n-      handler=".upgrades.update_old_layouts" />\n+      handler=".upgrades.update_old_layouts"\n+      />\n \n </configure>\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 000000000..0b1bccdee\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,68 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --all --test-path={toxinidir}/src -s plone.app.multilingual {posargs}\n+extras =\n+    test\n+\n+[testenv:coverage]\n+usedevelop = true\n+constrain_package_deps = true\n+set_env = ROBOT_BROWSER=headlesschrome\n+deps =\n+    coverage\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    coverage run {envbindir}/zope-testrunner --all --test-path={toxinidir}/src -s plone.app.multilingual {posargs}\n+    coverage report -m --format markdown\n+extras =\n+    test\n'

