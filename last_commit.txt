Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2019-04-19T17:00:23+02:00
Author: Gil Forcada (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFEditions/commit/8ce0c43265869df33369ab485831e7679a1ad9cf

Avoid Resource Warnings

Files changed:
M Products/CMFEditions/StorageMigrationSupport.py
M Products/CMFEditions/tests/test_ATContentTypes.py
M Products/CMFEditions/tests/test_ContentTypes.py

b'diff --git a/Products/CMFEditions/StorageMigrationSupport.py b/Products/CMFEditions/StorageMigrationSupport.py\nindex 085b442..e8f5ad8 100644\n--- a/Products/CMFEditions/StorageMigrationSupport.py\n+++ b/Products/CMFEditions/StorageMigrationSupport.py\n@@ -102,14 +102,14 @@ def editImage(context, version=0):\n         name = name[:-4]\n     filename = "%s_v%s.gif" % (name, version)\n     path = os.path.join(PACKAGE_HOME, "tests", "images", filename)\n+    with open(path) as image_handle:\n+        image = image_handle.read()\n     if not title:\n         title = "0: %s image title" % name\n         desc = "0: %s image description" % name\n-        image = open(path).read()\n     else:\n         title = "%s%s" % (version, title[1:])\n         desc = "%s%s" % (version, desc[1:])\n-        image = open(path).read()\n     context.update(title=title, description=desc, image=image)\n \n def editLink(context, version=0):\ndiff --git a/Products/CMFEditions/tests/test_ATContentTypes.py b/Products/CMFEditions/tests/test_ATContentTypes.py\nindex 0fc6c85..bbd1b27 100644\n--- a/Products/CMFEditions/tests/test_ATContentTypes.py\n+++ b/Products/CMFEditions/tests/test_ATContentTypes.py\n@@ -24,6 +24,12 @@\n import six\n \n \n+def read_image(file_path):\n+    with open(os.path.join(PACKAGE_HOME, file_path), \'rb\') as image:\n+        data = image.read()\n+    return data\n+\n+\n if six.PY2:\n     from Products.CMFEditions import PACKAGE_HOME\n     from plone.app.testing.bbb_at import PloneTestCase\n@@ -100,14 +106,8 @@ def testNewsItem(self):\n \n         def testImage(self):\n             self.folder.invokeFactory(\'Image\', id=\'image\')\n-            img1 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/images/img1.png\'),\n-                \'rb\'\n-            ).read()\n-            img2 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/images/img2.png\'),\n-                \'rb\'\n-            ).read()\n+            img1 = read_image(\'tests/images/img1.png\')\n+            img2 = read_image(\'tests/images/img2.png\')\n             portal_repository = self.portal_repository\n             content = self.folder.image\n             content.edit(image=img1)\n@@ -125,14 +125,8 @@ def testImage(self):\n \n         def testFile(self):\n             self.folder.invokeFactory(\'File\', id=\'file\')\n-            file1 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/file1.dat\'),\n-                \'rb\'\n-            ).read()\n-            file2 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/file2.dat\'),\n-                \'rb\'\n-            ).read()\n+            file1 = read_image(\'tests/file1.dat\')\n+            file2 = read_image(\'tests/file2.dat\')\n             portal_repository = self.portal_repository\n             content = self.folder.file\n             content.edit(file=file1)\n@@ -169,14 +163,8 @@ def testFolder(self):\n \n         def testBlobsNotResavedUnlessChanged(self):\n             self.folder.invokeFactory(\'File\', id=\'file\')\n-            file1 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/images/img1.png\'),\n-                \'rb\'\n-            ).read()\n-            file2 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/images/img2.png\'),\n-                \'rb\'\n-            ).read()\n+            file1 = read_image(\'tests/images/img1.png\')\n+            file2 = read_image(\'tests/images/img2.png\')\n             portal_repository = self.portal_repository\n             content = self.folder.file\n             content.edit(file=file1)\n@@ -215,7 +203,8 @@ def testBlobsNotResavedUnlessChanged(self):\n             self.assertEqual(content.getFile().getBlob(), blob1)\n \n         def testBlobsNotStringConverted(self):\n-            file1 = open(os.path.join(PACKAGE_HOME, \'tests/file1.dat\')).read()\n+            with open(os.path.join(PACKAGE_HOME, \'tests/file1.dat\')) as handle:\n+                file1 = handle.read()\n             content = self.folder[\n                 self.folder.invokeFactory(\'File\', id=\'file\', file=file1)]\n \ndiff --git a/Products/CMFEditions/tests/test_ContentTypes.py b/Products/CMFEditions/tests/test_ContentTypes.py\nindex 4727f88..fcaaa02 100644\n--- a/Products/CMFEditions/tests/test_ContentTypes.py\n+++ b/Products/CMFEditions/tests/test_ContentTypes.py\n@@ -10,6 +10,12 @@\n import os\n \n \n+def read_image(file_path):\n+    with open(os.path.join(PACKAGE_HOME, file_path), \'rb\') as image:\n+        data = image.read()\n+    return data\n+\n+\n class TestPloneContents(CMFEditionsBaseTestCase):\n \n     def setUp(self):\n@@ -105,8 +111,8 @@ def testNewsItem(self):\n     def testImage(self):\n         self.folder.invokeFactory(\'Image\', id=\'image\')\n         portal_repository = self.portal_repository\n-        img1 = open(os.path.join(PACKAGE_HOME, \'tests/images/img1.png\'), \'rb\').read()\n-        img2 = open(os.path.join(PACKAGE_HOME, \'tests/images/img2.png\'), \'rb\').read()\n+        img1 = read_image(\'tests/images/img1.png\')\n+        img2 = read_image(\'tests/images/img2.png\')\n         content = self.folder.image\n         content.image = NamedBlobImage(img1, u\'img1.png\', u\'image/png\')\n         content.title = u\'content\'\n@@ -136,8 +142,8 @@ def testImage(self):\n \n     def testFile(self):\n         self.folder.invokeFactory(\'File\', id=\'file\')\n-        file1 = open(os.path.join(PACKAGE_HOME, \'tests/images/img1.png\'), \'rb\').read()\n-        file2 = open(os.path.join(PACKAGE_HOME, \'tests/images/img2.png\'), \'rb\').read()\n+        file1 = read_image(\'tests/images/img1.png\')\n+        file2 = read_image(\'tests/images/img2.png\')\n         portal_repository = self.portal_repository\n         content = self.folder.file\n         content.file = NamedBlobFile(file1, u\'img1.png\', u\'image/png\')\n'

Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2019-04-19T17:00:33+02:00
Author: Gil Forcada (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFEditions/commit/3e41dd66ea4280ccc386f5c3cf76ac747fe36a99

Add news entry

Files changed:
A news/65.bugfix

b'diff --git a/news/65.bugfix b/news/65.bugfix\nnew file mode 100644\nindex 0000000..d5c13c9\n--- /dev/null\n+++ b/news/65.bugfix\n@@ -0,0 +1,2 @@\n+Avoid ResourceWarnings.\n+[gforcada]\n'

Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2019-04-22T23:32:14+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFEditions/commit/1306e3a59792b29dc6d359543d298403dd16ea3a

Merge pull request #66 from plone/gforcada-patch-1

Avoid resource warnings

Files changed:
A news/65.bugfix
M Products/CMFEditions/StorageMigrationSupport.py
M Products/CMFEditions/tests/test_ATContentTypes.py
M Products/CMFEditions/tests/test_ContentTypes.py

b'diff --git a/Products/CMFEditions/StorageMigrationSupport.py b/Products/CMFEditions/StorageMigrationSupport.py\nindex 085b442..e8f5ad8 100644\n--- a/Products/CMFEditions/StorageMigrationSupport.py\n+++ b/Products/CMFEditions/StorageMigrationSupport.py\n@@ -102,14 +102,14 @@ def editImage(context, version=0):\n         name = name[:-4]\n     filename = "%s_v%s.gif" % (name, version)\n     path = os.path.join(PACKAGE_HOME, "tests", "images", filename)\n+    with open(path) as image_handle:\n+        image = image_handle.read()\n     if not title:\n         title = "0: %s image title" % name\n         desc = "0: %s image description" % name\n-        image = open(path).read()\n     else:\n         title = "%s%s" % (version, title[1:])\n         desc = "%s%s" % (version, desc[1:])\n-        image = open(path).read()\n     context.update(title=title, description=desc, image=image)\n \n def editLink(context, version=0):\ndiff --git a/Products/CMFEditions/tests/test_ATContentTypes.py b/Products/CMFEditions/tests/test_ATContentTypes.py\nindex 0fc6c85..bbd1b27 100644\n--- a/Products/CMFEditions/tests/test_ATContentTypes.py\n+++ b/Products/CMFEditions/tests/test_ATContentTypes.py\n@@ -24,6 +24,12 @@\n import six\n \n \n+def read_image(file_path):\n+    with open(os.path.join(PACKAGE_HOME, file_path), \'rb\') as image:\n+        data = image.read()\n+    return data\n+\n+\n if six.PY2:\n     from Products.CMFEditions import PACKAGE_HOME\n     from plone.app.testing.bbb_at import PloneTestCase\n@@ -100,14 +106,8 @@ def testNewsItem(self):\n \n         def testImage(self):\n             self.folder.invokeFactory(\'Image\', id=\'image\')\n-            img1 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/images/img1.png\'),\n-                \'rb\'\n-            ).read()\n-            img2 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/images/img2.png\'),\n-                \'rb\'\n-            ).read()\n+            img1 = read_image(\'tests/images/img1.png\')\n+            img2 = read_image(\'tests/images/img2.png\')\n             portal_repository = self.portal_repository\n             content = self.folder.image\n             content.edit(image=img1)\n@@ -125,14 +125,8 @@ def testImage(self):\n \n         def testFile(self):\n             self.folder.invokeFactory(\'File\', id=\'file\')\n-            file1 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/file1.dat\'),\n-                \'rb\'\n-            ).read()\n-            file2 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/file2.dat\'),\n-                \'rb\'\n-            ).read()\n+            file1 = read_image(\'tests/file1.dat\')\n+            file2 = read_image(\'tests/file2.dat\')\n             portal_repository = self.portal_repository\n             content = self.folder.file\n             content.edit(file=file1)\n@@ -169,14 +163,8 @@ def testFolder(self):\n \n         def testBlobsNotResavedUnlessChanged(self):\n             self.folder.invokeFactory(\'File\', id=\'file\')\n-            file1 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/images/img1.png\'),\n-                \'rb\'\n-            ).read()\n-            file2 = open(\n-                os.path.join(PACKAGE_HOME, \'tests/images/img2.png\'),\n-                \'rb\'\n-            ).read()\n+            file1 = read_image(\'tests/images/img1.png\')\n+            file2 = read_image(\'tests/images/img2.png\')\n             portal_repository = self.portal_repository\n             content = self.folder.file\n             content.edit(file=file1)\n@@ -215,7 +203,8 @@ def testBlobsNotResavedUnlessChanged(self):\n             self.assertEqual(content.getFile().getBlob(), blob1)\n \n         def testBlobsNotStringConverted(self):\n-            file1 = open(os.path.join(PACKAGE_HOME, \'tests/file1.dat\')).read()\n+            with open(os.path.join(PACKAGE_HOME, \'tests/file1.dat\')) as handle:\n+                file1 = handle.read()\n             content = self.folder[\n                 self.folder.invokeFactory(\'File\', id=\'file\', file=file1)]\n \ndiff --git a/Products/CMFEditions/tests/test_ContentTypes.py b/Products/CMFEditions/tests/test_ContentTypes.py\nindex 4727f88..fcaaa02 100644\n--- a/Products/CMFEditions/tests/test_ContentTypes.py\n+++ b/Products/CMFEditions/tests/test_ContentTypes.py\n@@ -10,6 +10,12 @@\n import os\n \n \n+def read_image(file_path):\n+    with open(os.path.join(PACKAGE_HOME, file_path), \'rb\') as image:\n+        data = image.read()\n+    return data\n+\n+\n class TestPloneContents(CMFEditionsBaseTestCase):\n \n     def setUp(self):\n@@ -105,8 +111,8 @@ def testNewsItem(self):\n     def testImage(self):\n         self.folder.invokeFactory(\'Image\', id=\'image\')\n         portal_repository = self.portal_repository\n-        img1 = open(os.path.join(PACKAGE_HOME, \'tests/images/img1.png\'), \'rb\').read()\n-        img2 = open(os.path.join(PACKAGE_HOME, \'tests/images/img2.png\'), \'rb\').read()\n+        img1 = read_image(\'tests/images/img1.png\')\n+        img2 = read_image(\'tests/images/img2.png\')\n         content = self.folder.image\n         content.image = NamedBlobImage(img1, u\'img1.png\', u\'image/png\')\n         content.title = u\'content\'\n@@ -136,8 +142,8 @@ def testImage(self):\n \n     def testFile(self):\n         self.folder.invokeFactory(\'File\', id=\'file\')\n-        file1 = open(os.path.join(PACKAGE_HOME, \'tests/images/img1.png\'), \'rb\').read()\n-        file2 = open(os.path.join(PACKAGE_HOME, \'tests/images/img2.png\'), \'rb\').read()\n+        file1 = read_image(\'tests/images/img1.png\')\n+        file2 = read_image(\'tests/images/img2.png\')\n         portal_repository = self.portal_repository\n         content = self.folder.file\n         content.file = NamedBlobFile(file1, u\'img1.png\', u\'image/png\')\ndiff --git a/news/65.bugfix b/news/65.bugfix\nnew file mode 100644\nindex 0000000..d5c13c9\n--- /dev/null\n+++ b/news/65.bugfix\n@@ -0,0 +1,2 @@\n+Avoid ResourceWarnings.\n+[gforcada]\n'

