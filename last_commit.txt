Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2022-07-04T12:19:50+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFEditions/commit/ede4566006d2b4779a66e081b3ed7af47f5fb059

fix deprecated imports and not depend on CMFPlone.

Removes indirect also circular dependency.

Files changed:
A news/88.bugfix
M Products/CMFEditions/browser/views.py
M Products/CMFEditions/tests/test_ContentTypes.py
M setup.py

b'diff --git a/Products/CMFEditions/browser/views.py b/Products/CMFEditions/browser/views.py\nindex cbf7e43..0fa4fb3 100644\n--- a/Products/CMFEditions/browser/views.py\n+++ b/Products/CMFEditions/browser/views.py\n@@ -1,11 +1,11 @@\n from Acquisition import aq_inner\n+from plone.base.utils import human_readable_size\n from Products.CMFCore.utils import getToolByName\n from Products.CMFEditions import CMFEditionsMessageFactory as _\n from Products.CMFEditions.interfaces.IModifier import FileTooLargeToVersionError\n from Products.CMFEditions.utilities import isObjectChanged\n from Products.CMFEditions.utilities import isObjectVersioned\n from Products.CMFEditions.utilities import maybeSaveVersion\n-from Products.CMFPlone.utils import human_readable_size\n from Products.Five import BrowserView\n from Products.statusmessages.interfaces import IStatusMessage\n \ndiff --git a/Products/CMFEditions/tests/test_ContentTypes.py b/Products/CMFEditions/tests/test_ContentTypes.py\nindex 68f1ebe..df7e158 100644\n--- a/Products/CMFEditions/tests/test_ContentTypes.py\n+++ b/Products/CMFEditions/tests/test_ContentTypes.py\n@@ -3,7 +3,7 @@\n from plone.namedfile.file import NamedBlobImage\n from Products.CMFEditions import PACKAGE_HOME\n from Products.CMFEditions.tests.base import CMFEditionsBaseTestCase\n-from Products.CMFPlone.utils import _createObjectByType\n+from plone.base.utils import unrestricted_construct_instance\n \n import os\n \n@@ -22,7 +22,7 @@ def setUp(self):\n         self.workflow = self.portal.portal_workflow\n         self.portal_repository = self.portal.portal_repository\n         self.portal_archivist = self.portal.portal_archivist\n-        _createObjectByType("Folder", self.portal, id="folder")\n+        unrestricted_construct_instance("Folder", self.portal, id="folder")\n         self.folder = self.portal.folder\n \n     def getPermissionsOfRole(self, role):\ndiff --git a/news/88.bugfix b/news/88.bugfix\nnew file mode 100644\nindex 0000000..82850db\n--- /dev/null\n+++ b/news/88.bugfix\n@@ -0,0 +1,3 @@\n+Fix deprecated imports and not depend on CMFPlone.\n+Removes also circular dependency.\n+[jensens]\ndiff --git a/setup.py b/setup.py\nindex e861fb2..ab827f0 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -40,7 +40,6 @@\n         test=[\n             "plone.app.testing",\n             "plone.app.textfield",\n-            "Products.CMFPlone",\n             "Products.CMFDynamicViewFTI",\n             "zope.testing",\n         ]\n@@ -51,6 +50,7 @@\n         "zope.dottedname",\n         "zope.i18nmessageid",\n         "zope.interface",\n+        "plone.base",\n         "Products.CMFCore >=2.1",\n         "Products.CMFDiffTool",  # dependency in diff template\n         "Products.CMFUid",\n'

Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2022-07-04T13:53:17+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFEditions/commit/a4db3a2a0d6198cadc67c77c5ec1fe3a6c93cf8d

Merge pull request #88 from plone/fix-deprecation

Fix deprecated imports and not depend on CMFPlone.

Files changed:
A news/88.bugfix
M Products/CMFEditions/browser/views.py
M Products/CMFEditions/tests/test_ContentTypes.py
M setup.py

b'diff --git a/Products/CMFEditions/browser/views.py b/Products/CMFEditions/browser/views.py\nindex cbf7e43..0fa4fb3 100644\n--- a/Products/CMFEditions/browser/views.py\n+++ b/Products/CMFEditions/browser/views.py\n@@ -1,11 +1,11 @@\n from Acquisition import aq_inner\n+from plone.base.utils import human_readable_size\n from Products.CMFCore.utils import getToolByName\n from Products.CMFEditions import CMFEditionsMessageFactory as _\n from Products.CMFEditions.interfaces.IModifier import FileTooLargeToVersionError\n from Products.CMFEditions.utilities import isObjectChanged\n from Products.CMFEditions.utilities import isObjectVersioned\n from Products.CMFEditions.utilities import maybeSaveVersion\n-from Products.CMFPlone.utils import human_readable_size\n from Products.Five import BrowserView\n from Products.statusmessages.interfaces import IStatusMessage\n \ndiff --git a/Products/CMFEditions/tests/test_ContentTypes.py b/Products/CMFEditions/tests/test_ContentTypes.py\nindex 68f1ebe..df7e158 100644\n--- a/Products/CMFEditions/tests/test_ContentTypes.py\n+++ b/Products/CMFEditions/tests/test_ContentTypes.py\n@@ -3,7 +3,7 @@\n from plone.namedfile.file import NamedBlobImage\n from Products.CMFEditions import PACKAGE_HOME\n from Products.CMFEditions.tests.base import CMFEditionsBaseTestCase\n-from Products.CMFPlone.utils import _createObjectByType\n+from plone.base.utils import unrestricted_construct_instance\n \n import os\n \n@@ -22,7 +22,7 @@ def setUp(self):\n         self.workflow = self.portal.portal_workflow\n         self.portal_repository = self.portal.portal_repository\n         self.portal_archivist = self.portal.portal_archivist\n-        _createObjectByType("Folder", self.portal, id="folder")\n+        unrestricted_construct_instance("Folder", self.portal, id="folder")\n         self.folder = self.portal.folder\n \n     def getPermissionsOfRole(self, role):\ndiff --git a/news/88.bugfix b/news/88.bugfix\nnew file mode 100644\nindex 0000000..82850db\n--- /dev/null\n+++ b/news/88.bugfix\n@@ -0,0 +1,3 @@\n+Fix deprecated imports and not depend on CMFPlone.\n+Removes also circular dependency.\n+[jensens]\ndiff --git a/setup.py b/setup.py\nindex e861fb2..ab827f0 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -40,7 +40,6 @@\n         test=[\n             "plone.app.testing",\n             "plone.app.textfield",\n-            "Products.CMFPlone",\n             "Products.CMFDynamicViewFTI",\n             "zope.testing",\n         ]\n@@ -51,6 +50,7 @@\n         "zope.dottedname",\n         "zope.i18nmessageid",\n         "zope.interface",\n+        "plone.base",\n         "Products.CMFCore >=2.1",\n         "Products.CMFDiffTool",  # dependency in diff template\n         "Products.CMFUid",\n'

