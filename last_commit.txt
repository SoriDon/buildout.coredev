Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2019-02-05T20:35:45+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/a87db8c597a276608701e4486e693dc15889b119

replace catalog_get_all(catalog) with catalog.getAllBrains()

Files changed:
M CHANGES.rst
M plone/app/contenttypes/migration/utils.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex eedd7c63..5c28d238 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -20,7 +20,8 @@ Bug fixes:\n - Fix for folder view when there is one item more than the batch size.\n   see `issue <https://github.com/plone/plone.app.contenttypes/issues/500>`\n   [reinhardt]\n-\n+- replace catalog_get_all(catalog) with catalog.getAllBrains()\n+  [pbauer]\n \n 2.0.0 (2018-10-30)\n ------------------\n@@ -56,8 +57,8 @@ Bug fixes:\n   (see plone/Products.CMFPlone#2540)\n   [ale-rt]\n \n-- Fix resource warnings. \n-  [davisagli] \n+- Fix resource warnings.\n+  [davisagli]\n \n 1.4.12 (2018-09-23)\n -------------------\ndiff --git a/plone/app/contenttypes/migration/utils.py b/plone/app/contenttypes/migration/utils.py\nindex 1ba948a8..2b9adfd1 100644\n--- a/plone/app/contenttypes/migration/utils.py\n+++ b/plone/app/contenttypes/migration/utils.py\n@@ -296,25 +296,13 @@ def __call__(self):\n         return json.dumps(data)\n \n \n-def catalog_get_all(catalog, unique_idx=\'UID\'):\n-    """Get all brains from the catalog.\n-    """\n-    res = [\n-        catalog({\n-            unique_idx: catalog._catalog.getIndexDataForRID(it)[unique_idx]\n-        })[0]\n-        for it in catalog._catalog.data\n-    ]\n-    return res\n-\n-\n def get_all_references(context):\n     results = []\n     # Archetypes\n     # Get all data from the reference_catalog if it exists\n     reference_catalog = getToolByName(context, REFERENCE_CATALOG, None)\n     if reference_catalog is not None:\n-        for brain in catalog_get_all(reference_catalog):\n+        for brain in reference_catalog.getAllBrains():\n             results.append({\n                 \'from_uuid\': brain.sourceUID,\n                 \'to_uuid\': brain.targetUID,\n'

