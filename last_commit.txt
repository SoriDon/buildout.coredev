Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-06-09T16:25:20+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.layout/commit/55346eb43767a9ba668a9e871e8d455fe597fc1e

Fix tests for SVG Plone logo

Files changed:
M plone/app/layout/viewlets/logo.pt
M plone/app/layout/viewlets/tests/test_common.py
M plone/app/layout/viewlets/tests/test_social.py

b'diff --git a/plone/app/layout/viewlets/logo.pt b/plone/app/layout/viewlets/logo.pt\nindex ae7f6c2f..5071ce33 100644\n--- a/plone/app/layout/viewlets/logo.pt\n+++ b/plone/app/layout/viewlets/logo.pt\n@@ -4,7 +4,7 @@\n                    title view/navigation_root_title"\n    i18n:domain="plone"\n    i18n:attributes="title">\n-    <img src="logo.png" alt=""\n-         tal:attributes="alt view/logo_title;\n+   <img src="plone-logo.svg" alt=""\n+   tal:attributes="alt view/logo_title;\n                          title view/logo_title;\n                          src view/img_src" /></a>\ndiff --git a/plone/app/layout/viewlets/tests/test_common.py b/plone/app/layout/viewlets/tests/test_common.py\nindex 9332a02a..8bcb5f9c 100644\n--- a/plone/app/layout/viewlets/tests/test_common.py\n+++ b/plone/app/layout/viewlets/tests/test_common.py\n@@ -173,7 +173,7 @@ def test_logo_viewlet_portal_root_default(self):\n         """\n         viewlet = LogoViewlet(self.folder, self.app.REQUEST, None)\n         viewlet.update()\n-        self.assertEqual(viewlet.img_src, f"{self.portal.absolute_url()}/logo.png")\n+        self.assertEqual(viewlet.img_src, f"{self.portal.absolute_url()}/++resource++plone-logo.svg")\n \n     def test_logo_viewlet_portal_root_registry(self):\n         """When a logo is set, and viewlet is opened on a non-navigation root,\n@@ -197,7 +197,7 @@ def test_logo_viewlet_navigation_root_default(self):\n         self._set_site(self.folder)\n         viewlet = LogoViewlet(self.folder, self.app.REQUEST, None)\n         viewlet.update()\n-        self.assertEqual(viewlet.img_src, f"{self.folder.absolute_url()}/logo.png")\n+        self.assertEqual(viewlet.img_src, f"{self.folder.absolute_url()}/++resource++plone-logo.svg")\n \n     def test_viewlet_navigation_root_registry(self):\n         """When a logo is set, and viewlet is opened on a navigation root,\ndiff --git a/plone/app/layout/viewlets/tests/test_social.py b/plone/app/layout/viewlets/tests/test_social.py\nindex 32bc4f72..70a73a0d 100644\n--- a/plone/app/layout/viewlets/tests/test_social.py\n+++ b/plone/app/layout/viewlets/tests/test_social.py\n@@ -131,12 +131,12 @@ def testLogo(self):\n         viewlet.update()\n         self.assertTrue(\n             self.tagFound(\n-                viewlet, "property", "og:image", "http://nohost/plone/logo.png"\n+                viewlet, "property", "og:image", "http://nohost/plone/++resource++plone-logo.svg"\n             )\n         )\n         self.assertFalse(self.tagFound(viewlet, "itemprop"))\n         self.assertTrue(\n             self.bodyTagFound(\n-                viewlet, "itemprop", "image", "http://nohost/plone/logo.png"\n+                viewlet, "itemprop", "image", "http://nohost/plone/++resource++plone-logo.svg"\n             )\n         )\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-06-10T07:14:07+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.layout/commit/a133ec210d99304bfa33469e6c516a84e14a095c

add changenote

Files changed:
A news/310.feature

b'diff --git a/news/310.feature b/news/310.feature\nnew file mode 100644\nindex 00000000..d71ba468\n--- /dev/null\n+++ b/news/310.feature\n@@ -0,0 +1,2 @@\n+Updated tests for SVG Plone logo.\n+[petschki]\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-06-10T09:03:18+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.layout/commit/db68a40e244b5d9ad2c725a49b728f34e6fe9569

use updated getSiteLogo utility

Files changed:
M plone/app/layout/viewlets/social.py

b'diff --git a/plone/app/layout/viewlets/social.py b/plone/app/layout/viewlets/social.py\nindex 07bba8d7..8f96aed2 100644\n--- a/plone/app/layout/viewlets/social.py\n+++ b/plone/app/layout/viewlets/social.py\n@@ -119,12 +119,12 @@ def _get_tags(self):\n                 )\n \n         if not found_image:\n-            url = getSiteLogo()\n+            url, mime_type = getSiteLogo(include_type=True)\n             tags.extend(\n                 [\n                     dict(property="og:image", content=url),\n                     dict(itemprop="image", content=url),\n-                    dict(property="og:image:type", content="image/png"),\n+                    dict(property="og:image:type", content=mime_type),\n                 ]\n             )\n         return tags\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2022-06-10T09:51:59+02:00
Author: agitator (agitator) <agitator@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.layout/commit/83a10acd10c6d57813a635d36a47b45357b2e5fd

Merge pull request #310 from plone/plone-svg-logo

Updates for SVG Plone logo

Files changed:
A news/310.feature
M plone/app/layout/viewlets/logo.pt
M plone/app/layout/viewlets/social.py
M plone/app/layout/viewlets/tests/test_common.py
M plone/app/layout/viewlets/tests/test_social.py

b'diff --git a/news/310.feature b/news/310.feature\nnew file mode 100644\nindex 00000000..d71ba468\n--- /dev/null\n+++ b/news/310.feature\n@@ -0,0 +1,2 @@\n+Updated tests for SVG Plone logo.\n+[petschki]\ndiff --git a/plone/app/layout/viewlets/logo.pt b/plone/app/layout/viewlets/logo.pt\nindex ae7f6c2f..5071ce33 100644\n--- a/plone/app/layout/viewlets/logo.pt\n+++ b/plone/app/layout/viewlets/logo.pt\n@@ -4,7 +4,7 @@\n                    title view/navigation_root_title"\n    i18n:domain="plone"\n    i18n:attributes="title">\n-    <img src="logo.png" alt=""\n-         tal:attributes="alt view/logo_title;\n+   <img src="plone-logo.svg" alt=""\n+   tal:attributes="alt view/logo_title;\n                          title view/logo_title;\n                          src view/img_src" /></a>\ndiff --git a/plone/app/layout/viewlets/social.py b/plone/app/layout/viewlets/social.py\nindex 07bba8d7..8f96aed2 100644\n--- a/plone/app/layout/viewlets/social.py\n+++ b/plone/app/layout/viewlets/social.py\n@@ -119,12 +119,12 @@ def _get_tags(self):\n                 )\n \n         if not found_image:\n-            url = getSiteLogo()\n+            url, mime_type = getSiteLogo(include_type=True)\n             tags.extend(\n                 [\n                     dict(property="og:image", content=url),\n                     dict(itemprop="image", content=url),\n-                    dict(property="og:image:type", content="image/png"),\n+                    dict(property="og:image:type", content=mime_type),\n                 ]\n             )\n         return tags\ndiff --git a/plone/app/layout/viewlets/tests/test_common.py b/plone/app/layout/viewlets/tests/test_common.py\nindex 9332a02a..8bcb5f9c 100644\n--- a/plone/app/layout/viewlets/tests/test_common.py\n+++ b/plone/app/layout/viewlets/tests/test_common.py\n@@ -173,7 +173,7 @@ def test_logo_viewlet_portal_root_default(self):\n         """\n         viewlet = LogoViewlet(self.folder, self.app.REQUEST, None)\n         viewlet.update()\n-        self.assertEqual(viewlet.img_src, f"{self.portal.absolute_url()}/logo.png")\n+        self.assertEqual(viewlet.img_src, f"{self.portal.absolute_url()}/++resource++plone-logo.svg")\n \n     def test_logo_viewlet_portal_root_registry(self):\n         """When a logo is set, and viewlet is opened on a non-navigation root,\n@@ -197,7 +197,7 @@ def test_logo_viewlet_navigation_root_default(self):\n         self._set_site(self.folder)\n         viewlet = LogoViewlet(self.folder, self.app.REQUEST, None)\n         viewlet.update()\n-        self.assertEqual(viewlet.img_src, f"{self.folder.absolute_url()}/logo.png")\n+        self.assertEqual(viewlet.img_src, f"{self.folder.absolute_url()}/++resource++plone-logo.svg")\n \n     def test_viewlet_navigation_root_registry(self):\n         """When a logo is set, and viewlet is opened on a navigation root,\ndiff --git a/plone/app/layout/viewlets/tests/test_social.py b/plone/app/layout/viewlets/tests/test_social.py\nindex 32bc4f72..70a73a0d 100644\n--- a/plone/app/layout/viewlets/tests/test_social.py\n+++ b/plone/app/layout/viewlets/tests/test_social.py\n@@ -131,12 +131,12 @@ def testLogo(self):\n         viewlet.update()\n         self.assertTrue(\n             self.tagFound(\n-                viewlet, "property", "og:image", "http://nohost/plone/logo.png"\n+                viewlet, "property", "og:image", "http://nohost/plone/++resource++plone-logo.svg"\n             )\n         )\n         self.assertFalse(self.tagFound(viewlet, "itemprop"))\n         self.assertTrue(\n             self.bodyTagFound(\n-                viewlet, "itemprop", "image", "http://nohost/plone/logo.png"\n+                viewlet, "itemprop", "image", "http://nohost/plone/++resource++plone-logo.svg"\n             )\n         )\n'

