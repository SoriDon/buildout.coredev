Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2016-12-22T00:09:51+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.Archetypes/commit/db1d07469f883c0840fa2b3d0586089fcd35e195

Default display value of a Vocabulary i18n-message must be unicode.

Files changed:
M CHANGES.rst
M Products/Archetypes/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 318703b..bee0eaf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Bug fixes:
 - Fix tests to work with latest plone.app.widgets 2.1.
   [thet]
 
+- Default display value of a ``Vocabulary`` i18n-message must be unicode, enforce.
+  Needed to work with latest zope.i18nmessageid 4.0.3 release (and later).
+  [jensens]
 
 1.12 (2016-12-06)
 -----------------
diff --git a/Products/Archetypes/utils.py b/Products/Archetypes/utils.py
index f90d3ff..9abfff3 100644
--- a/Products/Archetypes/utils.py
+++ b/Products/Archetypes/utils.py
@@ -598,6 +598,8 @@ def getValue(self, key, default=None):
             # that can be translated elsewhere.
             if not isinstance(msg, unicode):
                 msg = msg.decode('utf-8')
+            if not isinstance(value, unicode):
+                value = value.decode('utf-8')
             return Message(msg, domain=self._i18n_domain, default=value)
         else:
             return value


Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2016-12-22T01:03:51+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.Archetypes/commit/f41c41f271edc2cc174a042d97e5769f213450ba

Merge pull request #72 from plone/jensens-enforce-vocabtermdefault-unicode

Default display value of a Vocabulary i18n-message must be unicode.

Files changed:
M CHANGES.rst
M Products/Archetypes/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 318703b..bee0eaf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Bug fixes:
 - Fix tests to work with latest plone.app.widgets 2.1.
   [thet]
 
+- Default display value of a ``Vocabulary`` i18n-message must be unicode, enforce.
+  Needed to work with latest zope.i18nmessageid 4.0.3 release (and later).
+  [jensens]
 
 1.12 (2016-12-06)
 -----------------
diff --git a/Products/Archetypes/utils.py b/Products/Archetypes/utils.py
index f90d3ff..9abfff3 100644
--- a/Products/Archetypes/utils.py
+++ b/Products/Archetypes/utils.py
@@ -598,6 +598,8 @@ def getValue(self, key, default=None):
             # that can be translated elsewhere.
             if not isinstance(msg, unicode):
                 msg = msg.decode('utf-8')
+            if not isinstance(value, unicode):
+                value = value.decode('utf-8')
             return Message(msg, domain=self._i18n_domain, default=value)
         else:
             return value


