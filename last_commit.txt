Repository: plone.restapi


Branch: refs/heads/master
Date: 2023-03-21T17:57:55-07:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.restapi/commit/acca00ea0a2110c65bac26a9294b5d6858c8abde

Fixed tests in combination with newer plone.app.z3cform. (#1603)

See https://github.com/plone/plone.app.z3cform/pull/162

Instead of

```
&lt;input id="__ac_password" name="__ac_password"
```

we get:

```
&lt;input class="form-control password-widget required password-field" id="__ac_password" name="__ac_password" type="password" /&gt;
```

Files changed:
A news/162.internal
M src/plone/restapi/tests/test_functional_auth.py

b'diff --git a/news/162.internal b/news/162.internal\nnew file mode 100644\nindex 000000000..85012a7e8\n--- /dev/null\n+++ b/news/162.internal\n@@ -0,0 +1,2 @@\n+Fixed tests in combination with newer ``plone.app.z3cform``.\n+[maurits]\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/tests/test_functional_auth.py b/src/plone/restapi/tests/test_functional_auth.py\nindex ea2f5f470..dd1e44bc1 100644\n--- a/src/plone/restapi/tests/test_functional_auth.py\n+++ b/src/plone/restapi/tests/test_functional_auth.py\n@@ -13,7 +13,6 @@\n \n \n class TestFunctionalAuth(unittest.TestCase):\n-\n     layer = PLONE_RESTAPI_DX_FUNCTIONAL_TESTING\n \n     def setUp(self):\n@@ -173,8 +172,17 @@ def test_cookie_login_grants_api(self):\n             200,\n             "Wrong Plone login challenge status code",\n         )\n+        # The input differs slightly per Plone version.\n+        self.assertTrue(\n+            "<input" in challenge_resp.text,\n+            "Plone login challenge response content missing input",\n+        )\n+        self.assertTrue(\n+            \'id="__ac_password"\' in challenge_resp.text,\n+            "Plone login challenge response content missing password field",\n+        )\n         self.assertTrue(\n-            \'<input id="__ac_password" name="__ac_password"\' in challenge_resp.text,\n+            \'name="__ac_password"\' in challenge_resp.text,\n             "Plone login challenge response content missing password field",\n         )\n         login_resp = session.post(\n'

