Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2022-09-19T11:00:34-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFEditions/commit/13b7ef6923283922d635d741027bf07f6a87a2a2

Avoid extra ObjectModifiedEvent on revert

Files changed:
A news/90.bugfix
M Products/CMFEditions/CopyModifyMergeRepositoryTool.py

b'diff --git a/Products/CMFEditions/CopyModifyMergeRepositoryTool.py b/Products/CMFEditions/CopyModifyMergeRepositoryTool.py\nindex 73f386f..3fe4ff6 100644\n--- a/Products/CMFEditions/CopyModifyMergeRepositoryTool.py\n+++ b/Products/CMFEditions/CopyModifyMergeRepositoryTool.py\n@@ -54,9 +54,7 @@\n from Products.CMFEditions.utilities import wrap\n from Products.CMFEditions.VersionPolicies import VersionPolicy\n from ZODB.broken import Broken\n-from zope.event import notify\n from zope.interface import implementer\n-from zope.lifecycleevent import ObjectModifiedEvent\n \n import logging\n import time\n@@ -670,8 +668,8 @@ def _fixupCatalogData(self, obj):\n         """Reindex the object, otherwise the catalog will certainly\n         be out of sync."""\n         portal_catalog = getToolByName(self, "portal_catalog")\n+        # Note: this notifies an ObjectModifiedEvent as a side effect.\n         portal_catalog.indexObject(obj)\n-        notify(ObjectModifiedEvent(obj))\n         # XXX: In theory we should probably be emitting IObjectMoved event\n         # here as it is a possible consequence of a revert.\n         # Perhaps in our current meager z2 existence we should do\ndiff --git a/news/90.bugfix b/news/90.bugfix\nnew file mode 100644\nindex 0000000..c6f6893\n--- /dev/null\n+++ b/news/90.bugfix\n@@ -0,0 +1 @@\n+- Only fire ObjectModifiedEvent once when an item is reverted to an old version. [davisagli]\n'

Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2022-09-19T11:52:03-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFEditions/commit/68c559592a7fe5c4241a6d3ddf796deb69e753fb

Merge pull request #91 from plone/fix-extra-version-on-revert

Avoid extra ObjectModifiedEvent on revert

Files changed:
A news/90.bugfix
M Products/CMFEditions/CopyModifyMergeRepositoryTool.py

b'diff --git a/Products/CMFEditions/CopyModifyMergeRepositoryTool.py b/Products/CMFEditions/CopyModifyMergeRepositoryTool.py\nindex 73f386f..3fe4ff6 100644\n--- a/Products/CMFEditions/CopyModifyMergeRepositoryTool.py\n+++ b/Products/CMFEditions/CopyModifyMergeRepositoryTool.py\n@@ -54,9 +54,7 @@\n from Products.CMFEditions.utilities import wrap\n from Products.CMFEditions.VersionPolicies import VersionPolicy\n from ZODB.broken import Broken\n-from zope.event import notify\n from zope.interface import implementer\n-from zope.lifecycleevent import ObjectModifiedEvent\n \n import logging\n import time\n@@ -670,8 +668,8 @@ def _fixupCatalogData(self, obj):\n         """Reindex the object, otherwise the catalog will certainly\n         be out of sync."""\n         portal_catalog = getToolByName(self, "portal_catalog")\n+        # Note: this notifies an ObjectModifiedEvent as a side effect.\n         portal_catalog.indexObject(obj)\n-        notify(ObjectModifiedEvent(obj))\n         # XXX: In theory we should probably be emitting IObjectMoved event\n         # here as it is a possible consequence of a revert.\n         # Perhaps in our current meager z2 existence we should do\ndiff --git a/news/90.bugfix b/news/90.bugfix\nnew file mode 100644\nindex 0000000..c6f6893\n--- /dev/null\n+++ b/news/90.bugfix\n@@ -0,0 +1 @@\n+- Only fire ObjectModifiedEvent once when an item is reverted to an old version. [davisagli]\n'

