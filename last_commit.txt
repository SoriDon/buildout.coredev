Repository: plone.portlet.static


Branch: refs/heads/master
Date: 2022-06-10T15:35:12+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.portlet.static/commit/7a68078daaa390168ddcd130132e618d86995426

Test-only fix: normalize white space.

Needed to not fail with newer `plone.outputfilters` from this PR: https://github.com/plone/plone.outputfilters/pull/49
The tests then pass for both `plone.outputfilters` master and the PR branch.

Files changed:
A news/49.bugfix
M plone/portlet/static/tests/test_portlet_static.py

b'diff --git a/news/49.bugfix b/news/49.bugfix\nnew file mode 100644\nindex 0000000..c069fed\n--- /dev/null\n+++ b/news/49.bugfix\n@@ -0,0 +1,2 @@\n+Test-only fix: normalize white space.\n+[maurits]\ndiff --git a/plone/portlet/static/tests/test_portlet_static.py b/plone/portlet/static/tests/test_portlet_static.py\nindex bb8e12a..4bb00d9 100644\n--- a/plone/portlet/static/tests/test_portlet_static.py\n+++ b/plone/portlet/static/tests/test_portlet_static.py\n@@ -15,6 +15,22 @@\n import unittest\n \n \n+def normalize(value):\n+    # Strip all white spaces of every line, then join on one line.\n+    # But try to avoid getting \'Go to<a href\' instead of \'Go to <a href\'.\n+    lines = []\n+    for line in value.splitlines():\n+        line = line.strip()\n+        if (\n+            line.startswith("<")\n+            and not line.startswith("</")\n+            and not line.startswith("<br")\n+        ):\n+            line = " " + line\n+        lines.append(line)\n+    return "".join(lines).strip()\n+\n+\n class TestPortlet(unittest.TestCase):\n \n     layer = PLONEPORTLETSTATIC_INTEGRATION_TESTING\n@@ -121,7 +137,7 @@ def test_render(self):\n         r.update()\n         output = r.render()\n         self.assertTrue(\'title\' in output)\n-        self.assertTrue(\'<b>text</b>\' in output)\n+        self.assertTrue(\'<b>text</b>\' in normalize(output))\n \n     def test_no_header(self):\n         r = self.renderer(\n'

Repository: plone.portlet.static


Branch: refs/heads/master
Date: 2022-06-10T17:10:39+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.portlet.static/commit/72a250eabcb41c9c7257d8b9843e16975856b429

Merge pull request #23 from plone/maurits-normalize-html-in-outputfilter-tests

Test-only fix: normalize white space.

Files changed:
A news/49.bugfix
M plone/portlet/static/tests/test_portlet_static.py

b'diff --git a/news/49.bugfix b/news/49.bugfix\nnew file mode 100644\nindex 0000000..c069fed\n--- /dev/null\n+++ b/news/49.bugfix\n@@ -0,0 +1,2 @@\n+Test-only fix: normalize white space.\n+[maurits]\ndiff --git a/plone/portlet/static/tests/test_portlet_static.py b/plone/portlet/static/tests/test_portlet_static.py\nindex bb8e12a..4bb00d9 100644\n--- a/plone/portlet/static/tests/test_portlet_static.py\n+++ b/plone/portlet/static/tests/test_portlet_static.py\n@@ -15,6 +15,22 @@\n import unittest\n \n \n+def normalize(value):\n+    # Strip all white spaces of every line, then join on one line.\n+    # But try to avoid getting \'Go to<a href\' instead of \'Go to <a href\'.\n+    lines = []\n+    for line in value.splitlines():\n+        line = line.strip()\n+        if (\n+            line.startswith("<")\n+            and not line.startswith("</")\n+            and not line.startswith("<br")\n+        ):\n+            line = " " + line\n+        lines.append(line)\n+    return "".join(lines).strip()\n+\n+\n class TestPortlet(unittest.TestCase):\n \n     layer = PLONEPORTLETSTATIC_INTEGRATION_TESTING\n@@ -121,7 +137,7 @@ def test_render(self):\n         r.update()\n         output = r.render()\n         self.assertTrue(\'title\' in output)\n-        self.assertTrue(\'<b>text</b>\' in output)\n+        self.assertTrue(\'<b>text</b>\' in normalize(output))\n \n     def test_no_header(self):\n         r = self.renderer(\n'

