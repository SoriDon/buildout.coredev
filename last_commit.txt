Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-08-06T19:34:36+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/10b09ae0f8a69ec0c63f7969dc90b0144ca0f245

fix test to make sure the email is sent in utf-8

Files changed:
M Products/CMFPlone/tests/testRegistrationTool.py

b'diff --git a/Products/CMFPlone/tests/testRegistrationTool.py b/Products/CMFPlone/tests/testRegistrationTool.py\nindex d7d16eef9b..f9e722d42d 100644\n--- a/Products/CMFPlone/tests/testRegistrationTool.py\n+++ b/Products/CMFPlone/tests/testRegistrationTool.py\n@@ -242,7 +242,7 @@ def testMailPasswordEncoding(self):\n         mail_settings.email_from_address = \'bar@baz.com\'\n \n         # Set the portal email encoding\n-        mail_settings.email_charset = \'us-ascii\'\n+        self.assertEqual(mail_settings.email_charset, \'utf-8\')\n \n         from zope.publisher.browser import TestRequest\n         self.registration.mailPassword(member_id, TestRequest())\n@@ -250,7 +250,7 @@ def testMailPasswordEncoding(self):\n         msg = message_from_bytes(mails.messages[0])\n \n         # Ensure charset (and thus Content-Type) were set via template\n-        self.assertEqual(msg[\'Content-Type\'], \'text/plain; charset="us-ascii"\')\n+        self.assertEqual(msg[\'Content-Type\'], \'text/plain; charset="utf-8"\')\n \n \n class TestPasswordGeneration(PloneTestCase.PloneTestCase):\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-08-06T19:35:24+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/f8fab34e87f5cf636b04cee616d2d599ccdb55c7

changelog

Files changed:
A news/3587.bugfix

b'diff --git a/news/3587.bugfix b/news/3587.bugfix\nnew file mode 100644\nindex 0000000000..dd9e106c25\n--- /dev/null\n+++ b/news/3587.bugfix\n@@ -0,0 +1,2 @@\n+Change test to make sure e-mail is sent in utf-8\n+[erral]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-08-13T16:53:41+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/71f8132448ede917c5ac52e9c700fb12144f18bc

Merge branch 'master' into erral-issue-317-plone.app.layout

Files changed:
A news/3475.bugfix
A news/3582.bugfix
A news/3605.bugfix
M .github/SECURITY.md
M Products/CMFPlone/browser/templates/main_template.pt
M Products/CMFPlone/browser/templates/test_rendering_icons.pt
M Products/CMFPlone/tests/robot/keywords.robot
M Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
M Products/CMFPlone/tests/robot/test_folder_contents.robot
M Products/CMFPlone/tests/robot/test_linkintegrity.robot
M Products/CMFPlone/tests/robot/test_overlays.robot
M Products/CMFPlone/tests/robot/test_querystring.robot
M README.rst

b'diff --git a/.github/SECURITY.md b/.github/SECURITY.md\nindex 8d6d6e3323..368751c557 100644\n--- a/.github/SECURITY.md\n+++ b/.github/SECURITY.md\n@@ -17,5 +17,5 @@ Instead, please contact the Plone Security Team via email: security@plone.org.\n See also https://plone.org/security/report\n \n Only bug reports submitted directly to the security team email will be treated as responsible disclosure.\n-Any offered for sale to third parties or submitted to public bug bounty programmes will be treated as irresponsible public disclosure.\n+Any offered for sale to third parties or submitted to public bug bounty programs will be treated as irresponsible public disclosure.\n We will not confirm any submissions on third party platforms such as "huntr" or "hackerone" and do not give permission for those systems to accept reports on our behalf or to represent themselves as a conduit for vulnerability reports.\ndiff --git a/Products/CMFPlone/browser/templates/main_template.pt b/Products/CMFPlone/browser/templates/main_template.pt\nindex cdebe3b295..50c5be24f0 100644\n--- a/Products/CMFPlone/browser/templates/main_template.pt\n+++ b/Products/CMFPlone/browser/templates/main_template.pt\n@@ -39,7 +39,7 @@\n     <metal:javascriptslot define-slot="javascript_head_slot" />\n \n     <link tal:replace="structure provider:plone.htmlhead.links" />\n-    <meta name="generator" content="Plone - http://plone.com" />\n+    <meta name="generator" content="Plone - https://plone.org/" />\n \n   </head>\n \ndiff --git a/Products/CMFPlone/browser/templates/test_rendering_icons.pt b/Products/CMFPlone/browser/templates/test_rendering_icons.pt\nindex 380a067d19..24fe5c5c6a 100644\n--- a/Products/CMFPlone/browser/templates/test_rendering_icons.pt\n+++ b/Products/CMFPlone/browser/templates/test_rendering_icons.pt\n@@ -12,13 +12,13 @@\n \n     <ul class="nav nav-tabs mb-3">\n       <li class="nav-item">\n-        <a class="nav-link active" href="${portal_url}/@@test-rendering">Test Rendering</a>\n+        <a class="nav-link" href="${portal_url}/@@test-rendering">Test Rendering</a>\n       </li>\n       <li class="nav-item">\n         <a class="nav-link" href="${portal_url}/@@test-rendering-cheatsheet">Bootstrap Cheatsheet</a>\n       </li>\n       <li class="nav-item">\n-        <a class="nav-link" href="${portal_url}/@@test-rendering-icons">Icons</a>\n+        <a class="nav-link active" href="${portal_url}/@@test-rendering-icons">Icons</a>\n       </li>\n     </ul>\n \ndiff --git a/Products/CMFPlone/tests/robot/keywords.robot b/Products/CMFPlone/tests/robot/keywords.robot\nindex 75765ffc38..ca0c598c4b 100644\n--- a/Products/CMFPlone/tests/robot/keywords.robot\n+++ b/Products/CMFPlone/tests/robot/keywords.robot\n@@ -33,3 +33,7 @@ patterns are loaded\n a folder with a document \'${title}\'\n   ${folder_uid}=  Create content  type=Folder  title=folder\n   Create content  type=Document  container=${folder_uid}  title=${title}\n+\n+folder contents pattern loaded\n+    Page should contain element  css=.pat-structure\n+    Wait For Condition  return !!document.querySelector(\'.pat-structure div.navbar\')\ndiff --git a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\nindex 0bad48857c..bcdf3307aa 100644\n--- a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n+++ b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n@@ -75,7 +75,15 @@ Input RichText\n   # or fatal exceptions are not caught by this keyword."\n   # See https://robotframework.org/robotframework/2.6.1/libraries/BuiltIn.html#Wait%20Until%20Keyword%20Succeeds\n   Sleep  1\n-  Wait until keyword succeeds  5s  1s  Execute Javascript  tinyMCE.activeEditor.setContent(\'${input}\');\n+  Wait until keyword succeeds  5s  1s  Set and Check TinyMCE Content  ${input}\n+\n+Set and Check TinyMCE Content\n+  [Arguments]  ${input}\n+  # Simply check if tinyMCE.getContent() isn\'t empty when we set an input\n+  Execute Javascript   tinyMCE.activeEditor.setContent(\'${input}\');\n+  Sleep  0.5\n+  ${check}=  Execute Javascript  return tinyMCE.activeEditor.getContent();\n+  Should not be empty  ${check}\n \n \n # --- WHEN -------------------------------------------------------------------\ndiff --git a/Products/CMFPlone/tests/robot/test_folder_contents.robot b/Products/CMFPlone/tests/robot/test_folder_contents.robot\nindex 054d5f1c28..98cee696e9 100644\n--- a/Products/CMFPlone/tests/robot/test_folder_contents.robot\n+++ b/Products/CMFPlone/tests/robot/test_folder_contents.robot\n@@ -53,7 +53,6 @@ a folder with four pages\n \n the folder contents view\n     Go to  ${PLONE_URL}/my-folder/folder_contents\n-    Page should contain element  css=.pat-structure\n     Given folder contents pattern loaded\n \n I click the \'${link_name}\' link\n@@ -107,6 +106,3 @@ Should be above\n     ${locator1-position} =  Get vertical position  ${locator1}\n     ${locator2-position} =  Get vertical position  ${locator2}\n     Should be true  ${locator1-position} < ${locator2-position}\n-\n-folder contents pattern loaded\n-    Wait For Condition  return !!document.querySelector(\'.pat-structure div.navbar\')\ndiff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex db3f9d888f..b798d6a824 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -93,13 +93,14 @@ a link in rich text\n should show warning when deleting page\n \n   Go To  ${PLONE_URL}/foo\n-  Wait For Then Click Element  css=#plone-contentmenu-actions a\n+  Wait For Then Click Element  css=#plone-contentmenu-actions > a\n   Wait For Then Click Element  css=#plone-contentmenu-actions-delete\n   Wait until page contains element  css=.breach-container .breach-item\n \n \n should show warning when deleting page from folder_contents\n   Go To  ${PLONE_URL}/folder_contents\n+  Given folder contents pattern loaded\n   Wait For Then Click Element  css=tr[data-id="foo"] input\n   Checkbox Should Be Selected  css=tr[data-id="foo"] input\n   Wait until keyword succeeds  30  1  Page should not contain element  css=#btn-delete.disabled\n@@ -113,7 +114,7 @@ should show warning when deleting page from folder_contents\n \n should not show warning when deleting page from folder_contents\n   Go To  ${PLONE_URL}/folder_contents\n-  Wait until page contains element  css=tr[data-id="foo"] input\n+  Given folder contents pattern loaded\n   Wait For Then Click Element  css=tr[data-id="foo"] input\n   Checkbox Should Be Selected  css=tr[data-id="foo"] input\n   Wait until keyword succeeds  30  1  Page should not contain element  css=#btn-delete.disabled\n@@ -127,7 +128,7 @@ should not show warning when deleting page from folder_contents\n \n should not show warning when deleting page\n   Go To  ${PLONE_URL}/foo\n-  Wait For Then Click Element  css=#plone-contentmenu-actions a\n+  Wait For Then Click Element  css=#plone-contentmenu-actions > a\n   Wait For Then Click Element  css=#plone-contentmenu-actions-delete\n   Page should not contain element  css=.breach-container .breach-item\n \ndiff --git a/Products/CMFPlone/tests/robot/test_overlays.robot b/Products/CMFPlone/tests/robot/test_overlays.robot\nindex deee0bdd98..83070070fc 100644\n--- a/Products/CMFPlone/tests/robot/test_overlays.robot\n+++ b/Products/CMFPlone/tests/robot/test_overlays.robot\n@@ -260,13 +260,13 @@ I \'${action}\' the form\n I enter wrong credentials\n     Input text  __ac_name  wrong\n     Input text  __ac_password  user\n-    Click Button  css=div.modal-footer button\n+    Wait For Then Click Element  css=div.modal-footer button\n \n I enter valid credentials\n     Wait until page contains element  name=__ac_name\n     Input text for sure  __ac_name  ${SITE_OWNER_NAME}\n     Input text for sure  __ac_password  ${SITE_OWNER_PASSWORD}\n-    Click Button  css=div.modal-footer button\n+    Wait For Then Click Element  css=div.modal-footer button\n \n I enter valid user data\n     Wait until page contains element  name=form.widgets.password_ctl\ndiff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex 989187671c..5a5e66fbf7 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -271,18 +271,20 @@ I open the Selection Widget\n \n I delete one selection\n     #deletes one element\n-    Wait For Then Click Element  css=a.select2-search-choice-close\n+    Wait For Then Click Element  jquery=a.select2-search-choice-close:visible\n \n I delete my selection\n     #deletes two elements\n-    Wait For Then Click Element  css=a.select2-search-choice-close\n+    Wait For Then Click Element  jquery=a.select2-search-choice-close:visible:first\n     Sleep  0.1\n-    Wait For Then Click Element  css=a.select2-search-choice-close\n+    Wait For Then Click Element  jquery=a.select2-search-choice-close:visible\n \n I search in ${NAME} subfolder in the related items widget\n     mark results\n-    Wait For Then Click Element  css=ul.select2-choices\n+    Wait For Then Click Element  jquery=.pat-relateditems-container ul.select2-choices:visible\n     Wait Until Page Contains  ${NAME}\n+    # I have seen this fail sometimes, where the screen shot showed the NAME just fine.\n+    Sleep  0.1\n     Click Element  //a[contains(concat(\' \', normalize-space(@class), \' \'), \' pat-relateditems-result-select \')]//span[contains(text(),\'${NAME}\')]\n \n I expect to be in Advanced mode\n@@ -309,7 +311,7 @@ I expect to be in Simple mode\n \n open the select box titled ${NAME}\n     Click Element  css=body\n-    Wait For Then Click Element  css=.querystring-criteria-${NAME} .select2-container\n+    Wait For Then Click Element  jquery=.querystring-criteria-${NAME} .select2-container:first\n \n select index type ${INDEX}\n     ${input_selector}  Set Variable  .select2-drop-active[style*="display: block;"] input\ndiff --git a/README.rst b/README.rst\nindex 85245e5725..8c1fdee108 100644\n--- a/README.rst\n+++ b/README.rst\n@@ -3,7 +3,7 @@ About Plone\n \n Plone is a mature, secure and user-friendly Content Management System (CMS).\n \n-Plone - and the Open Source community behind it - aggregates more than 20 years experience in content management.\n+Plone - and the Open Source community behind it - aggregates more than 20 years of experience in content management.\n It offers all major features expected by a modern CMS out-of-the-box.\n \n Lots of customizations can be made trough-the-web, such as creating content types, themes, workflows and much more.\n@@ -39,10 +39,10 @@ What is Plone?\n Plone is a ready-to-run content management system, offering a complete set of features needed by a wide variety of organizations.\n \n Security is built into Plone\'s architecture from the ground up.\n-Plone offers fine grained permission control over content and actions.\n+Plone offers fine-grained permission control over content and actions.\n \n Plone is easy to set up, extremely flexible,\n-and provides you with a system for managing web content that is ideal for project groups, communities, web sites, extranets and intranets.\n+and provides you with a system for managing web content that is ideal for project groups, communities, websites, extranets and intranets.\n \n - *Plone is easy to install.*\n   Several installation options are available for either your local machine or on servers in the cloud.\n@@ -82,9 +82,9 @@ It builds upon Zope, an Open Source web application server and development syste\n Python is the easy-to-learn, widely-used and supported Open Source programming language.\n Python can be used to add new features to Plone, and used to understand or make changes to the way that Plone works.\n \n-Plone stores its contents in Zope\'s built-in transactional hierachical object database, the ZODB.\n+Plone stores its contents in Zope\'s built-in transactional hierarchical object database, the ZODB.\n The ZODB can be connected to simple file-storages, scalable ZEO-Servers or Postgres, MySQL and Oracle.\n-There are addon and techniques, however, to share information with other sources, such as relational databases, LDAP, filesystem\n+There are addons and techniques, however, to share information with other sources, such as relational databases, LDAP, filesystem\n files, etc.\n \n \ndiff --git a/news/3475.bugfix b/news/3475.bugfix\nnew file mode 100644\nindex 0000000000..cb38b56977\n--- /dev/null\n+++ b/news/3475.bugfix\n@@ -0,0 +1,2 @@\n+Fix active tab in ``@@test-rendering-icons``.\n+[petschki]\ndiff --git a/news/3582.bugfix b/news/3582.bugfix\nnew file mode 100644\nindex 0000000000..805f4bdb48\n--- /dev/null\n+++ b/news/3582.bugfix\n@@ -0,0 +1,2 @@\n+Robot tests: be more specific when clicking some elements.\n+[maurits]\ndiff --git a/news/3605.bugfix b/news/3605.bugfix\nnew file mode 100644\nindex 0000000000..eb2d6e2a4a\n--- /dev/null\n+++ b/news/3605.bugfix\n@@ -0,0 +1,2 @@\n+Fixed an error where Main Template (line: 42) referenced plone.com istead of plone.org\n+[rohnsha0]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-08-13T16:54:29+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/cde079ef6fb5a64db97d7f002074c7604b75b712

Merge pull request #3587 from plone/erral-issue-317-plone.app.layout

change tests to be sure that the email is sent in utf-8

Files changed:
A news/3587.bugfix
M Products/CMFPlone/tests/testRegistrationTool.py

b'diff --git a/Products/CMFPlone/tests/testRegistrationTool.py b/Products/CMFPlone/tests/testRegistrationTool.py\nindex d7d16eef9b..f9e722d42d 100644\n--- a/Products/CMFPlone/tests/testRegistrationTool.py\n+++ b/Products/CMFPlone/tests/testRegistrationTool.py\n@@ -242,7 +242,7 @@ def testMailPasswordEncoding(self):\n         mail_settings.email_from_address = \'bar@baz.com\'\n \n         # Set the portal email encoding\n-        mail_settings.email_charset = \'us-ascii\'\n+        self.assertEqual(mail_settings.email_charset, \'utf-8\')\n \n         from zope.publisher.browser import TestRequest\n         self.registration.mailPassword(member_id, TestRequest())\n@@ -250,7 +250,7 @@ def testMailPasswordEncoding(self):\n         msg = message_from_bytes(mails.messages[0])\n \n         # Ensure charset (and thus Content-Type) were set via template\n-        self.assertEqual(msg[\'Content-Type\'], \'text/plain; charset="us-ascii"\')\n+        self.assertEqual(msg[\'Content-Type\'], \'text/plain; charset="utf-8"\')\n \n \n class TestPasswordGeneration(PloneTestCase.PloneTestCase):\ndiff --git a/news/3587.bugfix b/news/3587.bugfix\nnew file mode 100644\nindex 0000000000..dd9e106c25\n--- /dev/null\n+++ b/news/3587.bugfix\n@@ -0,0 +1,2 @@\n+Change test to make sure e-mail is sent in utf-8\n+[erral]\n'

