Repository: plone.app.contentmenu


Branch: refs/heads/master
Date: 2022-05-05T08:00:21+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.contentmenu/commit/a4a41d4612339513bd69ddbb91b63e5480b44b80

check for permission on browser:menuItem

Files changed:
A news/26.bugfix
M plone/app/contentmenu/displayviewsmenu.py

b'diff --git a/news/26.bugfix b/news/26.bugfix\nnew file mode 100644\nindex 0000000..d1f51da\n--- /dev/null\n+++ b/news/26.bugfix\n@@ -0,0 +1 @@\n+Fixed permission handling on browser:menuItem [iham] (#26)\n\\ No newline at end of file\ndiff --git a/plone/app/contentmenu/displayviewsmenu.py b/plone/app/contentmenu/displayviewsmenu.py\nindex e1af54b..9fe74a2 100644\n--- a/plone/app/contentmenu/displayviewsmenu.py\n+++ b/plone/app/contentmenu/displayviewsmenu.py\n@@ -1,6 +1,9 @@\n+from AccessControl.SecurityManagement import getSecurityManager\n from plone.app.contentmenu.interfaces import IDisplayViewsMenu\n from zope.browsermenu.menu import BrowserMenu\n from zope.component import getAdapters\n+from zope.component import getUtility\n+from zope.security.interfaces import IPermission\n from zope.interface import implementer\n \n \n@@ -13,11 +16,17 @@ def getMenuItemByAction(self, context, request, action):\n         if action.startswith("++view++"):\n             action = action[8:]\n \n-        for name, item in getAdapters((context, request), self.getMenuItemType()):\n+        sm = getSecurityManager()\n+\n+        for name, item in getAdapters(\n+            (context, request), self.getMenuItemType()\n+        ):\n             item_action = item.action\n             # Normalize menu item action; never uses ++view++\n             if item_action.startswith("@@"):\n                 item_action = item_action[2:]\n \n             if item_action == action:\n-                return item\n+                permission = getUtility(IPermission, name=item.permission)\n+                if sm.checkPermission(permission.title, context):\n+                    return item\n'

Repository: plone.app.contentmenu


Branch: refs/heads/master
Date: 2022-05-05T18:15:40+02:00
Author: petschki (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.contentmenu/commit/bdcf545d1733d25953062e1b0d62f734acb548ee

use AccessControl.security.checkPermission

Files changed:
M plone/app/contentmenu/displayviewsmenu.py

b'diff --git a/plone/app/contentmenu/displayviewsmenu.py b/plone/app/contentmenu/displayviewsmenu.py\nindex 9fe74a2..bdce107 100644\n--- a/plone/app/contentmenu/displayviewsmenu.py\n+++ b/plone/app/contentmenu/displayviewsmenu.py\n@@ -1,9 +1,7 @@\n-from AccessControl.SecurityManagement import getSecurityManager\n+from AccessControl.security import checkPermission\n from plone.app.contentmenu.interfaces import IDisplayViewsMenu\n from zope.browsermenu.menu import BrowserMenu\n from zope.component import getAdapters\n-from zope.component import getUtility\n-from zope.security.interfaces import IPermission\n from zope.interface import implementer\n \n \n@@ -16,8 +14,6 @@ def getMenuItemByAction(self, context, request, action):\n         if action.startswith("++view++"):\n             action = action[8:]\n \n-        sm = getSecurityManager()\n-\n         for name, item in getAdapters(\n             (context, request), self.getMenuItemType()\n         ):\n@@ -26,7 +22,7 @@ def getMenuItemByAction(self, context, request, action):\n             if item_action.startswith("@@"):\n                 item_action = item_action[2:]\n \n-            if item_action == action:\n-                permission = getUtility(IPermission, name=item.permission)\n-                if sm.checkPermission(permission.title, context):\n-                    return item\n+            if item_action == action and checkPermission(\n+                item.permission, context\n+            ):\n+                return item\n'

Repository: plone.app.contentmenu


Branch: refs/heads/master
Date: 2022-05-06T07:29:32+02:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.contentmenu/commit/2b7454b023e331dd97f50772bdeb7bc29a108cc4

Merge pull request #27 from plone/issue_26

Fixed permission handling on browser:menuItem

Files changed:
A news/26.bugfix
M plone/app/contentmenu/displayviewsmenu.py

b'diff --git a/news/26.bugfix b/news/26.bugfix\nnew file mode 100644\nindex 0000000..d1f51da\n--- /dev/null\n+++ b/news/26.bugfix\n@@ -0,0 +1 @@\n+Fixed permission handling on browser:menuItem [iham] (#26)\n\\ No newline at end of file\ndiff --git a/plone/app/contentmenu/displayviewsmenu.py b/plone/app/contentmenu/displayviewsmenu.py\nindex e1af54b..bdce107 100644\n--- a/plone/app/contentmenu/displayviewsmenu.py\n+++ b/plone/app/contentmenu/displayviewsmenu.py\n@@ -1,3 +1,4 @@\n+from AccessControl.security import checkPermission\n from plone.app.contentmenu.interfaces import IDisplayViewsMenu\n from zope.browsermenu.menu import BrowserMenu\n from zope.component import getAdapters\n@@ -13,11 +14,15 @@ def getMenuItemByAction(self, context, request, action):\n         if action.startswith("++view++"):\n             action = action[8:]\n \n-        for name, item in getAdapters((context, request), self.getMenuItemType()):\n+        for name, item in getAdapters(\n+            (context, request), self.getMenuItemType()\n+        ):\n             item_action = item.action\n             # Normalize menu item action; never uses ++view++\n             if item_action.startswith("@@"):\n                 item_action = item_action[2:]\n \n-            if item_action == action:\n+            if item_action == action and checkPermission(\n+                item.permission, context\n+            ):\n                 return item\n'

