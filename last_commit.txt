Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-11-19T11:50:11-03:00
Author: wesleybl (wesleybl) <wesleybl@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/84a9cfdb7f3401d894784d26dc23b9a1ff1dc6e8

Remove adapter for index location

Adapter for index location only worked with Archetypes content, as it
used getField method. This caused that, when an location index  was
created in the catalog, the indexing would not work for Dexterity
contents, since the adapter trie to use the getField method on a
Dexterity content.

Files changed:
A news/3347.bugfix
M Products/CMFPlone/CatalogTool.py
M Products/CMFPlone/catalog.zcml

b'diff --git a/Products/CMFPlone/CatalogTool.py b/Products/CMFPlone/CatalogTool.py\nindex f63503281c..03810c863e 100644\n--- a/Products/CMFPlone/CatalogTool.py\n+++ b/Products/CMFPlone/CatalogTool.py\n@@ -255,11 +255,6 @@ def mime_type(obj):\n     return aq_base(obj).getPrimaryField().getContentType(obj)\n \n \n-@indexer(Interface)\n-def location(obj):\n-    return obj.getField(\'location\').get(obj)\n-\n-\n @implementer(IPloneCatalogTool)\n class CatalogTool(PloneBaseTool, BaseTool):\n     """Plone\'s catalog tool"""\ndiff --git a/Products/CMFPlone/catalog.zcml b/Products/CMFPlone/catalog.zcml\nindex 97d2852553..ddd04b531f 100644\n--- a/Products/CMFPlone/catalog.zcml\n+++ b/Products/CMFPlone/catalog.zcml\n@@ -17,7 +17,6 @@\n     <adapter factory=".CatalogTool.is_folderish"           name="is_folderish" />\n     <adapter factory=".CatalogTool.is_default_page"        name="is_default_page" />\n     <adapter factory=".CatalogTool.getIcon"                name="getIcon" />\n-    <adapter factory=".CatalogTool.location"               name="location" />\n     <adapter factory=".CatalogTool.mime_type"              name="mime_type" />\n \n </configure>\ndiff --git a/news/3347.bugfix b/news/3347.bugfix\nnew file mode 100644\nindex 0000000000..426bd8d81e\n--- /dev/null\n+++ b/news/3347.bugfix\n@@ -0,0 +1 @@\n+Remove adapter for index location. [wesleybl]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-11-20T22:17:29+01:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/b7ee8a68a62e5c10d0bf47a5e9793daa37941257

Merge branch 'master' into remove_location_adapter

Files changed:
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex be0c349ce6..cfc96d3d86 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -321,7 +321,9 @@ open the select box titled ${NAME}\n     Click Element  css=.querystring-criteria-${NAME} .select2-container a\n \n select index type ${INDEX}\n-    Input Text  jquery=.select2-drop-active[style*="display: block;"] input   text=${INDEX}\n+    ${input_selector}  Set Variable  .select2-drop-active[style*="display: block;"] input\n+    Wait Until Element Is Visible  jquery=${input_selector}\n+    Input Text  jquery=${input_selector}   text=${INDEX}\n     Press Key  jquery=:focus  \\\\13\n \n we expect ${NUM} hits\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-11-22T10:50:14+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/b96d3b3895457ee9c06c742a0b01df9cbf762098

Merge pull request #3361 from plone/remove_location_adapter

Remove adapter for index location

Files changed:
A news/3347.bugfix
M Products/CMFPlone/CatalogTool.py
M Products/CMFPlone/catalog.zcml

b'diff --git a/Products/CMFPlone/CatalogTool.py b/Products/CMFPlone/CatalogTool.py\nindex f63503281c..03810c863e 100644\n--- a/Products/CMFPlone/CatalogTool.py\n+++ b/Products/CMFPlone/CatalogTool.py\n@@ -255,11 +255,6 @@ def mime_type(obj):\n     return aq_base(obj).getPrimaryField().getContentType(obj)\n \n \n-@indexer(Interface)\n-def location(obj):\n-    return obj.getField(\'location\').get(obj)\n-\n-\n @implementer(IPloneCatalogTool)\n class CatalogTool(PloneBaseTool, BaseTool):\n     """Plone\'s catalog tool"""\ndiff --git a/Products/CMFPlone/catalog.zcml b/Products/CMFPlone/catalog.zcml\nindex 97d2852553..ddd04b531f 100644\n--- a/Products/CMFPlone/catalog.zcml\n+++ b/Products/CMFPlone/catalog.zcml\n@@ -17,7 +17,6 @@\n     <adapter factory=".CatalogTool.is_folderish"           name="is_folderish" />\n     <adapter factory=".CatalogTool.is_default_page"        name="is_default_page" />\n     <adapter factory=".CatalogTool.getIcon"                name="getIcon" />\n-    <adapter factory=".CatalogTool.location"               name="location" />\n     <adapter factory=".CatalogTool.mime_type"              name="mime_type" />\n \n </configure>\ndiff --git a/news/3347.bugfix b/news/3347.bugfix\nnew file mode 100644\nindex 0000000000..426bd8d81e\n--- /dev/null\n+++ b/news/3347.bugfix\n@@ -0,0 +1 @@\n+Remove adapter for index location. [wesleybl]\n\\ No newline at end of file\n'

