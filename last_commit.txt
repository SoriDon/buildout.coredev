Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-03-19T10:33:25+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/9b7c9e43a2b96ee7771b9241caa6764c73417d85

Fixed unstable SearchableText querystring robot test.

Fixes https://github.com/plone/Products.CMFPlone/issues/2808

Files changed:
A news/2808.bugfix
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex f06598d1f..de8daf073 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -70,6 +70,7 @@ Scenario: Searchable text query\n     and the querystring pattern\n     When I open the criteria Searchable text\n     and I search for a\n+    and Wait Until Element Is Visible  css=div.querystring-preview\n     and Click Element  css=div.querystring-preview\n     Then we expect 2 hits\n     When I open the criteria Searchable text\ndiff --git a/news/2808.bugfix b/news/2808.bugfix\nnew file mode 100644\nindex 000000000..1db21a730\n--- /dev/null\n+++ b/news/2808.bugfix\n@@ -0,0 +1 @@\n+Fixed unstable SearchableText querystring robot test.  [maurits]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-03-19T10:34:45+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/fde3b1ae9254b0e5e78be6a762fe221f8658f84c

Fixed unstable Markup Control Panel robot test.

Fixes https://github.com/plone/Products.CMFPlone/issues/2809

Files changed:
A news/2809.bugfix
M Products/CMFPlone/tests/robot/test_controlpanel_markup.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_controlpanel_markup.robot b/Products/CMFPlone/tests/robot/test_controlpanel_markup.robot\nindex 6181f7373..0c1310d80 100644\n--- a/Products/CMFPlone/tests/robot/test_controlpanel_markup.robot\n+++ b/Products/CMFPlone/tests/robot/test_controlpanel_markup.robot\n@@ -45,11 +45,15 @@ the markup control panel\n # --- WHEN -------------------------------------------------------------------\n \n I set allowed types to "${type}"\n+  [Documentation]  \'Wait until page contains  Changes saved\' is nicer, but is unstable. See https://github.com/plone/Products.CMFPlone/issues/2809\n   with the label  text/html  UnSelect Checkbox\n   with the label  text/x-web-textile  UnSelect Checkbox\n   with the label  ${type}   Select Checkbox\n   Click Button  Save\n-  Wait until page contains  Changes saved\n+  Go to  ${PLONE_URL}/@@markup-controlpanel\n+  Checkbox Should Be Selected  ${type}\n+  Checkbox Should Not Be Selected  text/html\n+  Checkbox Should Not Be Selected  text/x-web-textile\n \n I set the default type to "${type}"\n   Select from list by label  name=form.widgets.default_type:list  ${type}\ndiff --git a/news/2809.bugfix b/news/2809.bugfix\nnew file mode 100644\nindex 000000000..2188bc701\n--- /dev/null\n+++ b/news/2809.bugfix\n@@ -0,0 +1 @@\n+Fixed unstable Markup Control Panel robot test.  [maurits]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-03-19T10:51:18+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/5f838fdf441a79c4fa266e1fa398de9d5373d81c

Fixed unstable Scenario Type query test.

https://jenkins.plone.org/job/plone-5.2-python-2.7-robot-chrome/1117/robot/Robot/Test%20Querystring/Scenario%20Type%20query/
"Wait Until Element Contains css=div#search-results, No results were found."
sometimes gives error about a stale reference.
I am guessing here that the div is not always visible and we need a few more microseconds.

Files changed:
M Products/CMFPlone/tests/robot/test_querystring.robot
M news/2808.bugfix

b'diff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex de8daf073..3650189af 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -332,6 +332,7 @@ we expect ${NUM} hits\n     mark results\n \n we do not expect any hits\n+    Wait Until Element Is Visible  css=div#search-results\n     Wait Until Element Contains  css=div#search-results  No results were found.\n \n a logged-in manager\ndiff --git a/news/2808.bugfix b/news/2808.bugfix\nindex 1db21a730..36f726fe0 100644\n--- a/news/2808.bugfix\n+++ b/news/2808.bugfix\n@@ -1 +1 @@\n-Fixed unstable SearchableText querystring robot test.  [maurits]\n\\ No newline at end of file\n+Fixed unstable SearchableText and Scenario Type querystring robot tests.  [maurits]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-03-19T14:44:12+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/eae51ddd9724f7ade8918ef5938852ed1849a80a

Sigh, sleep a bit in test_querystring.robot.

Alternatively look at http://www.obeythetestinggoat.com/how-to-get-selenium-to-wait-for-page-load-after-a-click.html
This has a good explanation of why this is a tricky part of Selenium.
It has some possible solutions, but that looks like it needs work in Python code,
or finding the right existing incantations.

Files changed:
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex 3650189af..13c1d71ff 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -70,6 +70,7 @@ Scenario: Searchable text query\n     and the querystring pattern\n     When I open the criteria Searchable text\n     and I search for a\n+    and Sleep  0.2\n     and Wait Until Element Is Visible  css=div.querystring-preview\n     and Click Element  css=div.querystring-preview\n     Then we expect 2 hits\n@@ -332,6 +333,8 @@ we expect ${NUM} hits\n     mark results\n \n we do not expect any hits\n+    [Documentation]  The search results may be the previous results that are still visible for a short time, so sleep a bit.  Alternatively look at http://www.obeythetestinggoat.com/how-to-get-selenium-to-wait-for-page-load-after-a-click.html\n+    Sleep  0.2\n     Wait Until Element Is Visible  css=div#search-results\n     Wait Until Element Contains  css=div#search-results  No results were found.\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-03-19T20:46:03+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/ad7ca5e6df3ac804ff9fcb1afee93da978eaaa73

Merge pull request #2810 from plone/maurit-unstable-robot-tests-2019-march

Fix several unstable robot tests

Files changed:
A news/2808.bugfix
A news/2809.bugfix
M Products/CMFPlone/tests/robot/test_controlpanel_markup.robot
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_controlpanel_markup.robot b/Products/CMFPlone/tests/robot/test_controlpanel_markup.robot\nindex 6181f7373..0c1310d80 100644\n--- a/Products/CMFPlone/tests/robot/test_controlpanel_markup.robot\n+++ b/Products/CMFPlone/tests/robot/test_controlpanel_markup.robot\n@@ -45,11 +45,15 @@ the markup control panel\n # --- WHEN -------------------------------------------------------------------\n \n I set allowed types to "${type}"\n+  [Documentation]  \'Wait until page contains  Changes saved\' is nicer, but is unstable. See https://github.com/plone/Products.CMFPlone/issues/2809\n   with the label  text/html  UnSelect Checkbox\n   with the label  text/x-web-textile  UnSelect Checkbox\n   with the label  ${type}   Select Checkbox\n   Click Button  Save\n-  Wait until page contains  Changes saved\n+  Go to  ${PLONE_URL}/@@markup-controlpanel\n+  Checkbox Should Be Selected  ${type}\n+  Checkbox Should Not Be Selected  text/html\n+  Checkbox Should Not Be Selected  text/x-web-textile\n \n I set the default type to "${type}"\n   Select from list by label  name=form.widgets.default_type:list  ${type}\ndiff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex f06598d1f..13c1d71ff 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -70,6 +70,8 @@ Scenario: Searchable text query\n     and the querystring pattern\n     When I open the criteria Searchable text\n     and I search for a\n+    and Sleep  0.2\n+    and Wait Until Element Is Visible  css=div.querystring-preview\n     and Click Element  css=div.querystring-preview\n     Then we expect 2 hits\n     When I open the criteria Searchable text\n@@ -331,6 +333,9 @@ we expect ${NUM} hits\n     mark results\n \n we do not expect any hits\n+    [Documentation]  The search results may be the previous results that are still visible for a short time, so sleep a bit.  Alternatively look at http://www.obeythetestinggoat.com/how-to-get-selenium-to-wait-for-page-load-after-a-click.html\n+    Sleep  0.2\n+    Wait Until Element Is Visible  css=div#search-results\n     Wait Until Element Contains  css=div#search-results  No results were found.\n \n a logged-in manager\ndiff --git a/news/2808.bugfix b/news/2808.bugfix\nnew file mode 100644\nindex 000000000..36f726fe0\n--- /dev/null\n+++ b/news/2808.bugfix\n@@ -0,0 +1 @@\n+Fixed unstable SearchableText and Scenario Type querystring robot tests.  [maurits]\ndiff --git a/news/2809.bugfix b/news/2809.bugfix\nnew file mode 100644\nindex 000000000..2188bc701\n--- /dev/null\n+++ b/news/2809.bugfix\n@@ -0,0 +1 @@\n+Fixed unstable Markup Control Panel robot test.  [maurits]\n'

