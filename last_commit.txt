Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-05-14T07:50:12+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/98b0f16d1288b369124d367c3302bad520379bde

fix a bunch of deprecation warnings

Files changed:
A news/2862.bugfix
M Products/CMFPlone/URLTool.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_redirection.py
M Products/CMFPlone/factory.py
M Products/CMFPlone/resources/exportimport/resourceregistry.py
M Products/CMFPlone/tests/testBatch.py
M Products/CMFPlone/tests/testPortalCreation.py

b"diff --git a/Products/CMFPlone/URLTool.py b/Products/CMFPlone/URLTool.py\nindex 187c49d98..68cac6f87 100644\n--- a/Products/CMFPlone/URLTool.py\n+++ b/Products/CMFPlone/URLTool.py\n@@ -13,7 +13,9 @@\n from six.moves.urllib import parse\n from zope.component import getUtility\n \n+import html\n import re\n+import six\n \n \n hp = HTMLParser()\n@@ -71,7 +73,10 @@ def isURLInPortal(self, url, context=None):\n             return False\n \n         # Someone may be doing tricks with escaped html code.\n-        unescaped_url = hp.unescape(url)\n+        if six.PY2:\n+            unescaped_url = hp.unescape(url)\n+        else:\n+            unescaped_url = html.unescape(url)\n         if unescaped_url != url:\n             if not self.isURLInPortal(unescaped_url):\n                 return False\ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_redirection.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_redirection.py\nindex d77e96ffd..5373e5202 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_redirection.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_redirection.py\n@@ -3,7 +3,7 @@\n from plone.app.redirector.interfaces import IRedirectionStorage\n from plone.app.testing import SITE_OWNER_NAME\n from plone.app.testing import SITE_OWNER_PASSWORD\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from Products.CMFPlone.controlpanel.browser.redirects import RedirectionSet\n from Products.CMFPlone.PloneBatch import Batch\n from Products.CMFPlone.testing import PRODUCTS_CMFPLONE_FUNCTIONAL_TESTING\ndiff --git a/Products/CMFPlone/factory.py b/Products/CMFPlone/factory.py\nindex ce329e14d..c25e9aec9 100644\n--- a/Products/CMFPlone/factory.py\n+++ b/Products/CMFPlone/factory.py\n@@ -1,16 +1,16 @@\n # -*- coding: utf-8 -*-\n+from logging import getLogger\n+from plone.registry.interfaces import IRegistry\n from Products.CMFPlone import PloneMessageFactory as _\n-from Products.CMFPlone.Portal import PloneSite\n from Products.CMFPlone.events import SiteManagerCreatedEvent\n from Products.CMFPlone.interfaces import INonInstallable\n+from Products.CMFPlone.Portal import PloneSite\n from Products.GenericSetup.tool import SetupTool\n from Products.statusmessages.interfaces import IStatusMessage\n-from logging import getLogger\n-from plone.registry.interfaces import IRegistry\n from zope.component import queryUtility\n+from zope.component.hooks import setSite\n from zope.event import notify\n from zope.interface import implementer\n-from zope.site.hooks import setSite\n \n _TOOL_ID = 'portal_setup'\n _DEFAULT_PROFILE = 'Products.CMFPlone:plone'\ndiff --git a/Products/CMFPlone/resources/exportimport/resourceregistry.py b/Products/CMFPlone/resources/exportimport/resourceregistry.py\nindex a0343d083..b31942247 100644\n--- a/Products/CMFPlone/resources/exportimport/resourceregistry.py\n+++ b/Products/CMFPlone/resources/exportimport/resourceregistry.py\n@@ -9,7 +9,7 @@\n from Products.GenericSetup.utils import XMLAdapterBase\n from zope.component import queryMultiAdapter\n from zope.component import queryUtility\n-from zope.component.interfaces import ComponentLookupError\n+from zope.interface.interfaces import ComponentLookupError\n \n \n def importResRegistry(context, reg_id, reg_title, filename):\ndiff --git a/Products/CMFPlone/tests/testBatch.py b/Products/CMFPlone/tests/testBatch.py\nindex 47e2fed3f..6c755dd7b 100644\n--- a/Products/CMFPlone/tests/testBatch.py\n+++ b/Products/CMFPlone/tests/testBatch.py\n@@ -1,7 +1,7 @@\n # -*- coding: utf-8 -*-\n from Products.CMFPlone.PloneBatch import Batch\n from Products.CMFPlone.testing import PRODUCTS_CMFPLONE_INTEGRATION_TESTING\n-from Products.ZCatalog.Lazy import LazyMap\n+from ZTUtils.Lazy import LazyMap\n \n import unittest\n \ndiff --git a/Products/CMFPlone/tests/testPortalCreation.py b/Products/CMFPlone/tests/testPortalCreation.py\nindex faed08cac..ae33a046e 100644\n--- a/Products/CMFPlone/tests/testPortalCreation.py\n+++ b/Products/CMFPlone/tests/testPortalCreation.py\n@@ -29,11 +29,11 @@\n from zope.component import getSiteManager\n from zope.component import getUtility\n from zope.component import queryUtility\n-from zope.component.interfaces import IComponentLookup\n-from zope.component.interfaces import IComponentRegistry\n+from zope.component.hooks import clearSite\n+from zope.component.hooks import setSite\n+from zope.interface.interfaces import IComponentLookup\n+from zope.interface.interfaces import IComponentRegistry\n from zope.location.interfaces import ISite\n-from zope.site.hooks import clearSite\n-from zope.site.hooks import setSite\n \n \n class TestPortalCreation(PloneTestCase.PloneTestCase):\ndiff --git a/news/2862.bugfix b/news/2862.bugfix\nnew file mode 100644\nindex 000000000..3cc639de9\n--- /dev/null\n+++ b/news/2862.bugfix\n@@ -0,0 +1,2 @@\n+Fix deprecation warnings.\n+[jensens]\n\\ No newline at end of file\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-05-14T08:53:48+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/ce151fcc4694fb8f18cbd2ab7b6a30eceedb84bc

Merge pull request #2862 from plone/fix-deprecation-warnings

fix a bunch of deprecation warnings

Files changed:
A news/2862.bugfix
M Products/CMFPlone/URLTool.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_redirection.py
M Products/CMFPlone/factory.py
M Products/CMFPlone/resources/exportimport/resourceregistry.py
M Products/CMFPlone/tests/testBatch.py
M Products/CMFPlone/tests/testPortalCreation.py

b"diff --git a/Products/CMFPlone/URLTool.py b/Products/CMFPlone/URLTool.py\nindex 187c49d98..68cac6f87 100644\n--- a/Products/CMFPlone/URLTool.py\n+++ b/Products/CMFPlone/URLTool.py\n@@ -13,7 +13,9 @@\n from six.moves.urllib import parse\n from zope.component import getUtility\n \n+import html\n import re\n+import six\n \n \n hp = HTMLParser()\n@@ -71,7 +73,10 @@ def isURLInPortal(self, url, context=None):\n             return False\n \n         # Someone may be doing tricks with escaped html code.\n-        unescaped_url = hp.unescape(url)\n+        if six.PY2:\n+            unescaped_url = hp.unescape(url)\n+        else:\n+            unescaped_url = html.unescape(url)\n         if unescaped_url != url:\n             if not self.isURLInPortal(unescaped_url):\n                 return False\ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_redirection.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_redirection.py\nindex d77e96ffd..5373e5202 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_redirection.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_redirection.py\n@@ -3,7 +3,7 @@\n from plone.app.redirector.interfaces import IRedirectionStorage\n from plone.app.testing import SITE_OWNER_NAME\n from plone.app.testing import SITE_OWNER_PASSWORD\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from Products.CMFPlone.controlpanel.browser.redirects import RedirectionSet\n from Products.CMFPlone.PloneBatch import Batch\n from Products.CMFPlone.testing import PRODUCTS_CMFPLONE_FUNCTIONAL_TESTING\ndiff --git a/Products/CMFPlone/factory.py b/Products/CMFPlone/factory.py\nindex ce329e14d..c25e9aec9 100644\n--- a/Products/CMFPlone/factory.py\n+++ b/Products/CMFPlone/factory.py\n@@ -1,16 +1,16 @@\n # -*- coding: utf-8 -*-\n+from logging import getLogger\n+from plone.registry.interfaces import IRegistry\n from Products.CMFPlone import PloneMessageFactory as _\n-from Products.CMFPlone.Portal import PloneSite\n from Products.CMFPlone.events import SiteManagerCreatedEvent\n from Products.CMFPlone.interfaces import INonInstallable\n+from Products.CMFPlone.Portal import PloneSite\n from Products.GenericSetup.tool import SetupTool\n from Products.statusmessages.interfaces import IStatusMessage\n-from logging import getLogger\n-from plone.registry.interfaces import IRegistry\n from zope.component import queryUtility\n+from zope.component.hooks import setSite\n from zope.event import notify\n from zope.interface import implementer\n-from zope.site.hooks import setSite\n \n _TOOL_ID = 'portal_setup'\n _DEFAULT_PROFILE = 'Products.CMFPlone:plone'\ndiff --git a/Products/CMFPlone/resources/exportimport/resourceregistry.py b/Products/CMFPlone/resources/exportimport/resourceregistry.py\nindex a0343d083..b31942247 100644\n--- a/Products/CMFPlone/resources/exportimport/resourceregistry.py\n+++ b/Products/CMFPlone/resources/exportimport/resourceregistry.py\n@@ -9,7 +9,7 @@\n from Products.GenericSetup.utils import XMLAdapterBase\n from zope.component import queryMultiAdapter\n from zope.component import queryUtility\n-from zope.component.interfaces import ComponentLookupError\n+from zope.interface.interfaces import ComponentLookupError\n \n \n def importResRegistry(context, reg_id, reg_title, filename):\ndiff --git a/Products/CMFPlone/tests/testBatch.py b/Products/CMFPlone/tests/testBatch.py\nindex 47e2fed3f..6c755dd7b 100644\n--- a/Products/CMFPlone/tests/testBatch.py\n+++ b/Products/CMFPlone/tests/testBatch.py\n@@ -1,7 +1,7 @@\n # -*- coding: utf-8 -*-\n from Products.CMFPlone.PloneBatch import Batch\n from Products.CMFPlone.testing import PRODUCTS_CMFPLONE_INTEGRATION_TESTING\n-from Products.ZCatalog.Lazy import LazyMap\n+from ZTUtils.Lazy import LazyMap\n \n import unittest\n \ndiff --git a/Products/CMFPlone/tests/testPortalCreation.py b/Products/CMFPlone/tests/testPortalCreation.py\nindex faed08cac..ae33a046e 100644\n--- a/Products/CMFPlone/tests/testPortalCreation.py\n+++ b/Products/CMFPlone/tests/testPortalCreation.py\n@@ -29,11 +29,11 @@\n from zope.component import getSiteManager\n from zope.component import getUtility\n from zope.component import queryUtility\n-from zope.component.interfaces import IComponentLookup\n-from zope.component.interfaces import IComponentRegistry\n+from zope.component.hooks import clearSite\n+from zope.component.hooks import setSite\n+from zope.interface.interfaces import IComponentLookup\n+from zope.interface.interfaces import IComponentRegistry\n from zope.location.interfaces import ISite\n-from zope.site.hooks import clearSite\n-from zope.site.hooks import setSite\n \n \n class TestPortalCreation(PloneTestCase.PloneTestCase):\ndiff --git a/news/2862.bugfix b/news/2862.bugfix\nnew file mode 100644\nindex 000000000..3cc639de9\n--- /dev/null\n+++ b/news/2862.bugfix\n@@ -0,0 +1,2 @@\n+Fix deprecation warnings.\n+[jensens]\n\\ No newline at end of file\n"

