Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-10-13T09:01:46+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/e0682ef93f8b219de9e8e7c07d66074c6f1c7c68

add missing i18n:translate calls and template fixes detected by Jenkins

Files changed:
A news/3334.bugfix
M Products/CMFPlone/browser/templates/plone-admin-logged-out.pt
M Products/CMFPlone/browser/templates/plone-upgrade.pt
M Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt
M Products/CMFPlone/controlpanel/browser/relations_inspect.pt
M Products/CMFPlone/controlpanel/browser/types.pt

b'diff --git a/Products/CMFPlone/browser/templates/plone-admin-logged-out.pt b/Products/CMFPlone/browser/templates/plone-admin-logged-out.pt\nindex 0fcfb108da..b12de5f1e0 100644\n--- a/Products/CMFPlone/browser/templates/plone-admin-logged-out.pt\n+++ b/Products/CMFPlone/browser/templates/plone-admin-logged-out.pt\n@@ -28,7 +28,7 @@\n               tal:attributes="src string:${context/absolute_url}/++resource++plone-logo.png"\n               alt="Plone logo"\n               i18n:attributes="alt" /></p>\n-      <h1 i18n:translate="">You are now logged out.<h1>\n+      <h1 i18n:translate="">You are now logged out.</h1>\n       <a href="${context/absolute_url}"\n           class="btn btn-primary"\n           i18n:translate="">\ndiff --git a/Products/CMFPlone/browser/templates/plone-upgrade.pt b/Products/CMFPlone/browser/templates/plone-upgrade.pt\nindex d5d5e2ca74..c4a09be6dd 100644\n--- a/Products/CMFPlone/browser/templates/plone-upgrade.pt\n+++ b/Products/CMFPlone/browser/templates/plone-upgrade.pt\n@@ -32,7 +32,7 @@\n                     i18n:attributes="alt" /></p>\n             <h1>\n               <span i18n:translate="">Upgrade this site</span>\n-            <h1>\n+            </h1>\n             <h2>${context/Title} <small>(${context/getId})</small></h2>\n             <p class="lead" i18n:translate="">\n                 More information about the upgrade procedure can be found in the documentation section of plone.org in the\ndiff --git a/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt b/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\nindex c4588f1940..c355e6bef5 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\n+++ b/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\n@@ -25,7 +25,7 @@\n                   <ul class="nav nav-tabs">\n                     <li class="nav-item"\n                         tal:define="overview_url string:$portal_url/@@overview-controlpanel">\n-                      <a class="nav-link ${python:\'active\' if overview_url in current_url else \'\'}" aria-current="page" href="${overview_url}">Overview</a>\n+                      <a class="nav-link ${python:\'active\' if overview_url in current_url else \'\'}" aria-current="page" href="${overview_url}" i18n:translate="">Site Setup</a>\n                     </li>\n                     <tal:group tal:repeat="group groups">\n                       <li tal:define="configlets python:controlPanel.enumConfiglets(group=group[\'id\']);\ndiff --git a/Products/CMFPlone/controlpanel/browser/relations_inspect.pt b/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\nindex d5771e0a50..36337a68d4 100644\n--- a/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\n+++ b/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\n@@ -47,7 +47,7 @@\n       <form id="relationinfo" method="post" action="@@inspect-relations" enctype="multipart/form-data">\n \n         <div class="mb-3 field">\n-          <select class="form-select" aria-label="Default select example" name="relation" id="relation">\n+          <select class="form-select" i18n:attributes="aria-label label_default_select_example" aria-label="Default select example" name="relation" id="relation">\n             <option value="" i18n:translate="">Select a relation</option>\n             <tal:rels tal:repeat="from_attribute python: sorted(relations_stats)">\n               <option tal:attributes="value python: from_attribute;\ndiff --git a/Products/CMFPlone/controlpanel/browser/types.pt b/Products/CMFPlone/controlpanel/browser/types.pt\nindex fbe06c46fd..2f30312d72 100644\n--- a/Products/CMFPlone/controlpanel/browser/types.pt\n+++ b/Products/CMFPlone/controlpanel/browser/types.pt\n@@ -183,7 +183,7 @@\n                                    name="form.button.SelectWorkflow"\n                                    class="btn btn-primary"\n                                    value="Change"\n-                                   i18n:attributes="value label_change;">Change</button>\n+                                   i18n:attributes="value label_change;" i18n:translate="label_change">Change</button>\n                         </noscript>\n                     </div>\n \ndiff --git a/news/3334.bugfix b/news/3334.bugfix\nnew file mode 100644\nindex 0000000000..aaf942afb2\n--- /dev/null\n+++ b/news/3334.bugfix\n@@ -0,0 +1 @@\n+Fix some template issues to have properly translated messages\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-10-13T14:36:07+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/73ac60d5c91cc1914ad7a4e20440f2f197474713

Merge branch 'master' into erral-i18n-missing-strings

Files changed:
A news/2025.bugfix
A news/3329.bugfix
M Products/CMFPlone/browser/navigation.py
M Products/CMFPlone/browser/templates/ajax_main_template.pt
M Products/CMFPlone/browser/templates/main_template.pt
M Products/CMFPlone/browser/templates/plone-frontpage.pt
M Products/CMFPlone/controlpanel/README.rst
M Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_navigation_adapter.py
M Products/CMFPlone/interfaces/controlpanel.py
M Products/CMFPlone/tests/testNavigationView.py
M Products/CMFPlone/www/addPropertySheet.zpt

b'diff --git a/Products/CMFPlone/browser/navigation.py b/Products/CMFPlone/browser/navigation.py\nindex 6a86610057..186b63eccd 100644\n--- a/Products/CMFPlone/browser/navigation.py\n+++ b/Products/CMFPlone/browser/navigation.py\n@@ -102,6 +102,9 @@ def _getNavQuery(self):\n         query[\'is_default_page\'] = False\n \n         if not navigation_settings.show_excluded_items:\n+            # Note:\n+            # Careful with that axe, Eugene!\n+            # This introduces a performance decrease.\n             query[\'exclude_from_nav\'] = False\n \n         if not navigation_settings.nonfolderish_tabs:\ndiff --git a/Products/CMFPlone/browser/templates/ajax_main_template.pt b/Products/CMFPlone/browser/templates/ajax_main_template.pt\nindex 279d53c10e..3f8ef8bc10 100644\n--- a/Products/CMFPlone/browser/templates/ajax_main_template.pt\n+++ b/Products/CMFPlone/browser/templates/ajax_main_template.pt\n@@ -24,7 +24,7 @@\n     <metal:cache tal:replace="structure provider:plone.httpheaders" />\n \n <head>\n-    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n+    <meta charset="utf-8" />\n \n     <tal:ajaxhead condition="ajax_include_head">\n     <div tal:replace="structure provider:plone.htmlhead" />\ndiff --git a/Products/CMFPlone/browser/templates/main_template.pt b/Products/CMFPlone/browser/templates/main_template.pt\nindex 333ee0a205..dac3b37cd9 100644\n--- a/Products/CMFPlone/browser/templates/main_template.pt\n+++ b/Products/CMFPlone/browser/templates/main_template.pt\n@@ -24,7 +24,7 @@\n     <metal:cache tal:replace="structure provider:plone.httpheaders" />\n \n   <head>\n-    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n+    <meta charset="utf-8" />\n \n     <div tal:replace="structure provider:plone.htmlhead" />\n \ndiff --git a/Products/CMFPlone/browser/templates/plone-frontpage.pt b/Products/CMFPlone/browser/templates/plone-frontpage.pt\nindex d04d845f15..badf8795fe 100644\n--- a/Products/CMFPlone/browser/templates/plone-frontpage.pt\n+++ b/Products/CMFPlone/browser/templates/plone-frontpage.pt\n@@ -1,10 +1,11 @@\n+<tal:doctype tal:replace="structure string:&lt;!DOCTYPE html&gt;" />\n <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       lang="en"\n       i18n:domain="plonefrontpage">\n \n <head>\n-    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n+    <meta charset="utf-8" />\n </head>\n \n <body i18n:translate="front-text">\ndiff --git a/Products/CMFPlone/controlpanel/README.rst b/Products/CMFPlone/controlpanel/README.rst\nindex 428d89614e..72e195a909 100644\n--- a/Products/CMFPlone/controlpanel/README.rst\n+++ b/Products/CMFPlone/controlpanel/README.rst\n@@ -132,7 +132,7 @@ Navigation Control Panel\n   ()\n \n   >>> navigation_settings.show_excluded_items\n-  True\n+  False\n \n \n Search Control Panel\ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_navigation_adapter.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_navigation_adapter.py\nindex 2f0d0eacfb..8fa4ea9704 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_navigation_adapter.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_navigation_adapter.py\n@@ -134,21 +134,21 @@ def test_set_workflow_states_to_show(self):\n     def test_get_show_excluded_items(self):\n         self.assertEqual(\n             getAdapter(self.portal, INavigationSchema).show_excluded_items,\n-            True\n+            False\n         )\n-        self.navigation_settings.show_excluded_items = False\n+        self.navigation_settings.show_excluded_items = True\n         self.assertEqual(\n             getAdapter(self.portal, INavigationSchema).show_excluded_items,\n-            False\n+            True\n         )\n \n     def test_set_show_excluded_items(self):\n         self.assertEqual(\n             self.navigation_settings.show_excluded_items,\n-            True\n+            False\n         )\n-        getAdapter(self.portal, INavigationSchema).show_excluded_items = False\n+        getAdapter(self.portal, INavigationSchema).show_excluded_items = True\n         self.assertEqual(\n             self.navigation_settings.show_excluded_items,\n-            False\n+            True\n         )\ndiff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py\nindex 24245cf481..09b96721d0 100644\n--- a/Products/CMFPlone/interfaces/controlpanel.py\n+++ b/Products/CMFPlone/interfaces/controlpanel.py\n@@ -835,7 +835,7 @@ class INavigationSchema(Interface):\n             \'If an item has been excluded from navigation should it be \'\n             \'shown in navigation when viewing content contained within it \'\n             \'or within a subfolder.\'),\n-        default=True,\n+        default=False,\n         required=False)\n \n     root = schema.TextLine(\ndiff --git a/Products/CMFPlone/tests/testNavigationView.py b/Products/CMFPlone/tests/testNavigationView.py\nindex cb6acb4844..0c323400c9 100644\n--- a/Products/CMFPlone/tests/testNavigationView.py\n+++ b/Products/CMFPlone/tests/testNavigationView.py\n@@ -502,12 +502,12 @@ def testCreateTopLevelTabs(self):\n         # Everything shows up by default\n         tabs = view.topLevelTabs(actions=[])\n         self.assertTrue(tabs)\n-        self.assertEqual(len(tabs), 8)\n+        self.assertEqual(len(tabs), 7)\n \n         # Only the folders show up (Members, news, events, folder1, folder2)\n         self.navigation_settings.nonfolderish_tabs = False\n         tabs = view.topLevelTabs(actions=[])\n-        self.assertEqual(len(tabs), 5)\n+        self.assertEqual(len(tabs), 4)\n \n     def testTabsRespectFolderOrder(self):\n         # See if reordering causes a change in the tab order\n@@ -604,18 +604,18 @@ def testTabsExcludeItemsWithExcludeProperty(self):\n         tab_names = [t[\'id\'] for t in tabs]\n         self.assertNotIn(\'folder2\', tab_names)\n \n-        # but if we\'re inside, it should be visible\n+        # if we\'re inside, it also should stay hidden\n         view = self.view_class(self.portal.folder2, self.request)\n         tabs = view.topLevelTabs(actions=[])\n         tab_names = [t[\'id\'] for t in tabs]\n-        self.assertIn(\'folder2\', tab_names)\n+        self.assertNotIn(\'folder2\', tab_names)\n \n         # Now we flip the setting for plone.show_excluded_items\n-        self.navigation_settings.show_excluded_items = False\n+        self.navigation_settings.show_excluded_items = True\n         view = self.view_class(self.portal.folder2, self.request)\n         tabs = view.topLevelTabs(actions=[])\n         tab_names = [t[\'id\'] for t in tabs]\n-        self.assertNotIn(\'folder2\', tab_names)\n+        self.assertIn(\'folder2\', tab_names)\n \n     def testTabsRespectsTypesWithViewAction(self):\n         # With a type in types_use_view_action_in_listings as current action it\ndiff --git a/Products/CMFPlone/www/addPropertySheet.zpt b/Products/CMFPlone/www/addPropertySheet.zpt\nindex 33287009f0..2d01f3bcda 100644\n--- a/Products/CMFPlone/www/addPropertySheet.zpt\n+++ b/Products/CMFPlone/www/addPropertySheet.zpt\n@@ -1,4 +1,4 @@\n-<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">\n+<tal:doctype tal:replace="structure string:&lt;!DOCTYPE html&gt;" />\n <html>\n <head>\n <meta http-equiv="content-type" content="text/html;charset=utf-8"\ndiff --git a/news/2025.bugfix b/news/2025.bugfix\nnew file mode 100644\nindex 0000000000..2a4cfaf3df\n--- /dev/null\n+++ b/news/2025.bugfix\n@@ -0,0 +1,2 @@\n+Use HTML5 meta charset.\n+[malthe]\ndiff --git a/news/3329.bugfix b/news/3329.bugfix\nnew file mode 100644\nindex 0000000000..93046b9f6b\n--- /dev/null\n+++ b/news/3329.bugfix\n@@ -0,0 +1,17 @@\n+Set the "Show excluded items" (``show_excluded_items``) to False per default.\n+Setting it to ``True`` can introduce a performance problem.\n+``False`` should be the default, also from user expectation for the ``exclude_from_nav`` setting on content items.\n+No upgrade step!\n+Previous behavior is just kept, unless you override it manually.\n+See: #3055, first comment.\n+Use this registry snippet to set it false:\n+```\n+<?xml version="1.0"?>\n+<registry>\n+  <records prefix="plone" interface="Products.CMFPlone.interfaces.controlpanel.INavigationSchema">\n+    <value key="show_excluded_items">False</value>\n+  </records>\n+</registry>\n+```\n+Fixes: #3035\n+[thet]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-10-13T23:00:02+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/Products.CMFPlone/commit/84f7138ef70c9760bf3b45eb6826d5286f96caa3

Merge pull request #3334 from plone/erral-i18n-missing-strings

add missing i18n:translate calls and template fixes detected by Jenkins

Files changed:
A news/3334.bugfix
M Products/CMFPlone/browser/templates/plone-admin-logged-out.pt
M Products/CMFPlone/browser/templates/plone-upgrade.pt
M Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt
M Products/CMFPlone/controlpanel/browser/relations_inspect.pt
M Products/CMFPlone/controlpanel/browser/types.pt

b'diff --git a/Products/CMFPlone/browser/templates/plone-admin-logged-out.pt b/Products/CMFPlone/browser/templates/plone-admin-logged-out.pt\nindex 0fcfb108da..b12de5f1e0 100644\n--- a/Products/CMFPlone/browser/templates/plone-admin-logged-out.pt\n+++ b/Products/CMFPlone/browser/templates/plone-admin-logged-out.pt\n@@ -28,7 +28,7 @@\n               tal:attributes="src string:${context/absolute_url}/++resource++plone-logo.png"\n               alt="Plone logo"\n               i18n:attributes="alt" /></p>\n-      <h1 i18n:translate="">You are now logged out.<h1>\n+      <h1 i18n:translate="">You are now logged out.</h1>\n       <a href="${context/absolute_url}"\n           class="btn btn-primary"\n           i18n:translate="">\ndiff --git a/Products/CMFPlone/browser/templates/plone-upgrade.pt b/Products/CMFPlone/browser/templates/plone-upgrade.pt\nindex d5d5e2ca74..c4a09be6dd 100644\n--- a/Products/CMFPlone/browser/templates/plone-upgrade.pt\n+++ b/Products/CMFPlone/browser/templates/plone-upgrade.pt\n@@ -32,7 +32,7 @@\n                     i18n:attributes="alt" /></p>\n             <h1>\n               <span i18n:translate="">Upgrade this site</span>\n-            <h1>\n+            </h1>\n             <h2>${context/Title} <small>(${context/getId})</small></h2>\n             <p class="lead" i18n:translate="">\n                 More information about the upgrade procedure can be found in the documentation section of plone.org in the\ndiff --git a/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt b/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\nindex c4588f1940..c355e6bef5 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\n+++ b/Products/CMFPlone/controlpanel/browser/prefsmaintemplate.pt\n@@ -25,7 +25,7 @@\n                   <ul class="nav nav-tabs">\n                     <li class="nav-item"\n                         tal:define="overview_url string:$portal_url/@@overview-controlpanel">\n-                      <a class="nav-link ${python:\'active\' if overview_url in current_url else \'\'}" aria-current="page" href="${overview_url}">Overview</a>\n+                      <a class="nav-link ${python:\'active\' if overview_url in current_url else \'\'}" aria-current="page" href="${overview_url}" i18n:translate="">Site Setup</a>\n                     </li>\n                     <tal:group tal:repeat="group groups">\n                       <li tal:define="configlets python:controlPanel.enumConfiglets(group=group[\'id\']);\ndiff --git a/Products/CMFPlone/controlpanel/browser/relations_inspect.pt b/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\nindex d5771e0a50..36337a68d4 100644\n--- a/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\n+++ b/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\n@@ -47,7 +47,7 @@\n       <form id="relationinfo" method="post" action="@@inspect-relations" enctype="multipart/form-data">\n \n         <div class="mb-3 field">\n-          <select class="form-select" aria-label="Default select example" name="relation" id="relation">\n+          <select class="form-select" i18n:attributes="aria-label label_default_select_example" aria-label="Default select example" name="relation" id="relation">\n             <option value="" i18n:translate="">Select a relation</option>\n             <tal:rels tal:repeat="from_attribute python: sorted(relations_stats)">\n               <option tal:attributes="value python: from_attribute;\ndiff --git a/Products/CMFPlone/controlpanel/browser/types.pt b/Products/CMFPlone/controlpanel/browser/types.pt\nindex fbe06c46fd..2f30312d72 100644\n--- a/Products/CMFPlone/controlpanel/browser/types.pt\n+++ b/Products/CMFPlone/controlpanel/browser/types.pt\n@@ -183,7 +183,7 @@\n                                    name="form.button.SelectWorkflow"\n                                    class="btn btn-primary"\n                                    value="Change"\n-                                   i18n:attributes="value label_change;">Change</button>\n+                                   i18n:attributes="value label_change;" i18n:translate="label_change">Change</button>\n                         </noscript>\n                     </div>\n \ndiff --git a/news/3334.bugfix b/news/3334.bugfix\nnew file mode 100644\nindex 0000000000..aaf942afb2\n--- /dev/null\n+++ b/news/3334.bugfix\n@@ -0,0 +1 @@\n+Fix some template issues to have properly translated messages\n'

