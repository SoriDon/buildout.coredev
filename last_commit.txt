Repository: plone.namedfile


Branch: refs/heads/master
Date: 2015-12-07T12:25:30+01:00
Author: Godefroid Chapelle (gotcha) <gotcha@bubblenet.be>
Commit: https://github.com/plone/plone.namedfile/commit/4f11ba05a742251f740abe451144328cbf6dd933

remove useless line

Files changed:
M plone/namedfile/scaling.py

diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py
index 8fef433..df04e18 100644
--- a/plone/namedfile/scaling.py
+++ b/plone/namedfile/scaling.py
@@ -290,7 +290,6 @@ def modified(self):
         """ provide a callable to return the modification time of content
             items, so stored image scales can be invalidated """
         context = aq_base(self.context)
-        date = None
         try:
             if hasattr(context, 'modified') and callable(context.modified):
                 date = context.modified()


Repository: plone.namedfile


Branch: refs/heads/master
Date: 2015-12-07T12:28:05+01:00
Author: Godefroid Chapelle (gotcha) <gotcha@bubblenet.be>
Commit: https://github.com/plone/plone.namedfile/commit/91b0c9df5874123980fa83dc836e73900300fbe8

stabilize tests that depends on modified time

modified is measured in milliseconds
wait 5ms to ensure modified will have changed

Files changed:
M plone/namedfile/tests/test_scaling.py

diff --git a/plone/namedfile/tests/test_scaling.py b/plone/namedfile/tests/test_scaling.py
index dafef96..9109bb4 100644
--- a/plone/namedfile/tests/test_scaling.py
+++ b/plone/namedfile/tests/test_scaling.py
@@ -1,3 +1,4 @@
+import time
 from DateTime import DateTime
 from OFS.SimpleItem import SimpleItem
 from plone.namedfile.interfaces import IImageScaleTraversable, IAvailableSizes
@@ -12,10 +13,15 @@
 from zope.component import getSiteManager, getGlobalSiteManager
 from zope.interface import implements
 
-
 import re
 
 
+def wait_to_ensure_modified():
+    # modified is measured in milliseconds
+    # wait 5ms to ensure modified will have changed
+    time.sleep(0.005)
+
+
 class IHasImage(IImageScaleTraversable):
     image = NamedImageField()
 
@@ -91,6 +97,7 @@ def testScaleInvalidation(self):
         # first get the scale of the original image
         self.scaling.available_sizes = {'foo': (23, 23)}
         foo1 = self.scaling.scale('image', scale='foo')
+        wait_to_ensure_modified()
         # now upload a new one and make sure the scale has changed
         data = getFile('image.jpg').read()
         self.item.image = NamedImage(data, 'image/jpeg', u'image.jpg')
@@ -172,6 +179,7 @@ def testScaledImageQuality(self):
         gsm = getGlobalSiteManager()
         qualitySupplier = DummyQualitySupplier()
         gsm.registerUtility(qualitySupplier.getQuality, IScaledImageQuality)
+        wait_to_ensure_modified()
         # now scale again
         bar = self.scaling.scale('image', width=100, height=80)
         size_bar = bar.data.getSize()
@@ -225,6 +233,7 @@ def testScaleInvalidation(self):
         # first view the thumbnail of the original image
         ImageScaling._sizes = {'thumb': (128, 128)}
         uid1, ext, width1, height1 = self.traverse('image/thumb')
+        wait_to_ensure_modified()
         # now upload a new one and make sure the thumbnail has changed
         data = getFile('image.jpg').read()
         self.item.image = NamedImage(data, 'image/jpeg', u'image.jpg')


Repository: plone.namedfile


Branch: refs/heads/master
Date: 2015-12-07T12:28:44+01:00
Author: Godefroid Chapelle (gotcha) <gotcha@bubblenet.be>
Commit: https://github.com/plone/plone.namedfile/commit/86aa7849201732e5e5d1fe9431883d8389ee3785

Merge branch 'master' of git://github.com/plone/plone.namedfile

Files changed:
M CHANGES.rst
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c88565c..9a874a8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,20 +1,28 @@
 Changelog
 =========
 
-3.0.5 (unreleased)
+3.0.6 (unreleased)
 ------------------
 
 New:
 
-- Added webdav support to image scales.
-  https://github.com/plone/Products.CMFPlone/issues/1251
-  [maurits]
+- *add item here*
 
 Fixes:
 
 - *add item here*
 
 
+3.0.5 (2015-11-26)
+------------------
+
+New:
+
+- Added webdav support to image scales.
+  https://github.com/plone/Products.CMFPlone/issues/1251
+  [maurits]
+
+
 3.0.4 (2015-10-28)
 ------------------
 
diff --git a/setup.py b/setup.py
index 9f01324..99292b2 100644
--- a/setup.py
+++ b/setup.py
@@ -1,7 +1,7 @@
 from setuptools import setup, find_packages
 import os
 
-version = '3.0.5.dev0'
+version = '3.0.6.dev0'
 
 long_description = open("README.rst").read()
 long_description += "\n"


