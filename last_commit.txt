Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-08-02T15:53:17+01:00
Author: Jon Pentland (instification) <jon.pentland@pretagov.co.uk>
Commit: https://github.com/plone/plone.restapi/commit/4fb72d51634303cd896cdb8a7bea2e0ee201f844

Use _getsafeMemberId when checking for user portrait

Files changed:
M CHANGES.rst
M CONTRIBUTORS.rst
M src/plone/restapi/serializer/user.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 394ae98e2..41821b313 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -21,6 +21,7 @@ Bug fixes:\n \n \n - Tests: add names to behaviors.  [maurits] (#169)\n+- Sanitise user id when checking for portrait [instification]\n \n \n 8.23.0 (2022-06-23)\ndiff --git a/CONTRIBUTORS.rst b/CONTRIBUTORS.rst\nindex 1adeb8348..35fb75b10 100644\n--- a/CONTRIBUTORS.rst\n+++ b/CONTRIBUTORS.rst\n@@ -37,4 +37,5 @@\n - Elio Schmutz\n - Gauthier Bastien\n - Katja S\xc3\xbcss\n+- Jon Pentland\n   \n\\ No newline at end of file\ndiff --git a/src/plone/restapi/serializer/user.py b/src/plone/restapi/serializer/user.py\nindex e651f3167..ce540cf45 100644\n--- a/src/plone/restapi/serializer/user.py\n+++ b/src/plone/restapi/serializer/user.py\n@@ -38,10 +38,12 @@ def __call__(self):\n \n         for name in getFieldNames(schema):\n             if name == "portrait":\n+                membership = getToolByName(portal, \'portal_membership\')\n                 memberdata = getToolByName(portal, "portal_memberdata")\n-                if user.id in memberdata.portraits:\n+                safe_id = membership._getSafeMemberId(user.id)\n+                if safe_id in memberdata.portraits:\n                     value = "{}/portal_memberdata/portraits/{}".format(\n-                        portal.absolute_url(), user.id\n+                        portal.absolute_url(), safe_id\n                     )\n                 else:\n                     value = None\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-08-02T15:55:13+01:00
Author: Jon Pentland (instification) <jon.pentland@pretagov.co.uk>
Commit: https://github.com/plone/plone.restapi/commit/0aeb3cc458cf29104cedf86d16389dd59a1abd15

Fix formatting. Add PR to changelog

Files changed:
M CHANGES.rst
M src/plone/restapi/serializer/user.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 41821b313..2bc8472ec 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -21,7 +21,7 @@ Bug fixes:\n \n \n - Tests: add names to behaviors.  [maurits] (#169)\n-- Sanitise user id when checking for portrait [instification]\n+- Sanitise user id when checking for portrait [instification] (#1261)\n \n \n 8.23.0 (2022-06-23)\ndiff --git a/src/plone/restapi/serializer/user.py b/src/plone/restapi/serializer/user.py\nindex ce540cf45..bbd6e9518 100644\n--- a/src/plone/restapi/serializer/user.py\n+++ b/src/plone/restapi/serializer/user.py\n@@ -38,7 +38,7 @@ def __call__(self):\n \n         for name in getFieldNames(schema):\n             if name == "portrait":\n-                membership = getToolByName(portal, \'portal_membership\')\n+                membership = getToolByName(portal, "portal_membership")\n                 memberdata = getToolByName(portal, "portal_memberdata")\n                 safe_id = membership._getSafeMemberId(user.id)\n                 if safe_id in memberdata.portraits:\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-08-02T16:07:07+01:00
Author: Jon Pentland (instification) <jon.pentland@pretagov.co.uk>
Commit: https://github.com/plone/plone.restapi/commit/ffbf910baf4ba72a682e7a84b777ec85a9086b94

Revert changes and use news for changelog entry

Files changed:
A news/1466.bugfix
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 2bc8472ec..394ae98e2 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -21,7 +21,6 @@ Bug fixes:\n \n \n - Tests: add names to behaviors.  [maurits] (#169)\n-- Sanitise user id when checking for portrait [instification] (#1261)\n \n \n 8.23.0 (2022-06-23)\ndiff --git a/news/1466.bugfix b/news/1466.bugfix\nnew file mode 100644\nindex 000000000..c4f03dac9\n--- /dev/null\n+++ b/news/1466.bugfix\n@@ -0,0 +1 @@\n+Sanitise user id when checking for portrait [instification]\n\\ No newline at end of file\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-08-05T09:30:51+03:00
Author: Alin Voinea (avoinea) <contact@avoinea.com>
Commit: https://github.com/plone/plone.restapi/commit/1afd17c4e535e641d795725f8afcef34e1d63b46

Merge branch 'master' into fix_portrait_url

Files changed:
M CHANGES.rst
M setup.py
D news/1459.bugfix

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 394ae98e2..4e4f97f88 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -8,6 +8,15 @@ Changelog\n \n .. towncrier release notes start\n \n+8.24.1 (2022-08-04)\n+-------------------\n+\n+Bug fixes:\n+\n+\n+- Fix of users endpoint for Membrane users. [ksuess] (#1459)\n+\n+\n 8.24.0 (2022-07-15)\n -------------------\n \ndiff --git a/news/1459.bugfix b/news/1459.bugfix\ndeleted file mode 100644\nindex f281b0331..000000000\n--- a/news/1459.bugfix\n+++ /dev/null\n@@ -1 +0,0 @@\n-Fix of users endpoint for Membrane users. [ksuess]\n\\ No newline at end of file\ndiff --git a/setup.py b/setup.py\nindex 6071a5089..5ea43aa18 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -1,7 +1,7 @@\n from setuptools import setup, find_packages\n import sys\n \n-version = "8.24.1.dev0"\n+version = "8.24.2.dev0"\n \n assert sys.version_info >= (\n     3,\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-08-05T09:12:54+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.restapi/commit/b1bfc5fd926d94448670d6d86dd21f7557109dc5

Merge pull request #1466 from plone/fix_portrait_url

Use _getsafeMemberId when checking for user portrait

Files changed:
A news/1466.bugfix
M CONTRIBUTORS.rst
M src/plone/restapi/serializer/user.py

b'diff --git a/CONTRIBUTORS.rst b/CONTRIBUTORS.rst\nindex 1adeb8348..35fb75b10 100644\n--- a/CONTRIBUTORS.rst\n+++ b/CONTRIBUTORS.rst\n@@ -37,4 +37,5 @@\n - Elio Schmutz\n - Gauthier Bastien\n - Katja S\xc3\xbcss\n+- Jon Pentland\n   \n\\ No newline at end of file\ndiff --git a/news/1466.bugfix b/news/1466.bugfix\nnew file mode 100644\nindex 000000000..c4f03dac9\n--- /dev/null\n+++ b/news/1466.bugfix\n@@ -0,0 +1 @@\n+Sanitise user id when checking for portrait [instification]\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/serializer/user.py b/src/plone/restapi/serializer/user.py\nindex e651f3167..bbd6e9518 100644\n--- a/src/plone/restapi/serializer/user.py\n+++ b/src/plone/restapi/serializer/user.py\n@@ -38,10 +38,12 @@ def __call__(self):\n \n         for name in getFieldNames(schema):\n             if name == "portrait":\n+                membership = getToolByName(portal, "portal_membership")\n                 memberdata = getToolByName(portal, "portal_memberdata")\n-                if user.id in memberdata.portraits:\n+                safe_id = membership._getSafeMemberId(user.id)\n+                if safe_id in memberdata.portraits:\n                     value = "{}/portal_memberdata/portraits/{}".format(\n-                        portal.absolute_url(), user.id\n+                        portal.absolute_url(), safe_id\n                     )\n                 else:\n                     value = None\n'

