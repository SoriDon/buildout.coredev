Repository: plone.dexterity


Branch: refs/heads/master
Date: 2016-01-18T10:22:57+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.dexterity/commit/a47e7f110a4f4bd66d659843900c447500f07f69

fix: duplicate aq_base w/o using Aqcuistion API resulted in an AttributeError that was masqued in the calling hasattr and resulted in wrong conclusion.

Files changed:
M CHANGES.rst
M plone/dexterity/filerepresentation.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 68b8540..d8d8676 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -11,7 +11,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fix: duplicate aq_base w/o using Aqcuistion API resulted in an AttributeError
+  that was masqued in the calling hasattr and resulted in wrong conclusion.
+  [jensens]
 
 
 2.3.7 (2016-01-08)
diff --git a/plone/dexterity/filerepresentation.py b/plone/dexterity/filerepresentation.py
index 36256c1..bee059f 100644
--- a/plone/dexterity/filerepresentation.py
+++ b/plone/dexterity/filerepresentation.py
@@ -1,7 +1,6 @@
 # -*- coding: utf-8 -*-
-from Acquisition import aq_base, Implicit
-from Products.CMFCore.utils import getToolByName
-from ZPublisher.Iterators import IStreamIterator
+from Acquisition import aq_base
+from Acquisition import Implicit
 from email.generator import Generator
 from email.message import Message
 from email.parser import FeedParser
@@ -13,6 +12,7 @@
 from plone.rfc822 import constructMessageFromSchemata
 from plone.rfc822 import initializeObjectFromSchemata
 from plone.rfc822.interfaces import IPrimaryField
+from Products.CMFCore.utils import getToolByName
 from webdav.Resource import Resource
 from zExceptions import MethodNotAllowed
 from zExceptions import Unauthorized
@@ -28,6 +28,7 @@
 from zope.lifecycleevent import modified, ObjectCreatedEvent
 from zope.schema import getFieldsInOrder
 from zope.size.interfaces import ISized
+from ZPublisher.Iterators import IStreamIterator
 import tempfile
 
 
@@ -233,7 +234,7 @@ def __getattr__(self, name):
         """Fall back on parent for certain things, even if we're aq_base'd.
         This makes propertysheet access work.
         """
-        if hasattr(self.__parent__.aq_base, name):
+        if hasattr(aq_base(self.__parent__), name):
             return getattr(self.__parent__, name)
         raise AttributeError(name)
 


Repository: plone.dexterity


Branch: refs/heads/master
Date: 2016-01-18T11:06:44+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.dexterity/commit/5c46f6a1697607031e6862614e04d97e02bcb55a

fix line length (pep8)

Files changed:
M plone/dexterity/tests/test_webdav.py

diff --git a/plone/dexterity/tests/test_webdav.py b/plone/dexterity/tests/test_webdav.py
index 65dc9b3..02b7162 100644
--- a/plone/dexterity/tests/test_webdav.py
+++ b/plone/dexterity/tests/test_webdav.py
@@ -638,7 +638,8 @@ def content_type(self):
 
         requestBody = """\
 <?xml version="1.0" encoding="utf-8" ?>
-<D:propertyupdate xmlns:D="DAV:" xmlns:n="http://www.zope.org/propsets/default">
+<D:propertyupdate xmlns:D="DAV:"
+                  xmlns:n="http://www.zope.org/propsets/default">
     <D:set>
         <D:prop>
             <n:title>New title</n:title>


Repository: plone.dexterity


Branch: refs/heads/master
Date: 2016-01-18T11:42:18+01:00
Author: agitator (agitator) <hpeter@agitator.com>
Commit: https://github.com/plone/plone.dexterity/commit/a107bdac686cc8e197bdc7666d8db402f3d412bb

Merge pull request #46 from plone/jensens-fix-aq

fix: duplicate aq_base w/o using Aqcuistion API resulted in an AttributeErrorâ€¦

Files changed:
M CHANGES.rst
M plone/dexterity/filerepresentation.py
M plone/dexterity/tests/test_webdav.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 68b8540..d8d8676 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -11,7 +11,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fix: duplicate aq_base w/o using Aqcuistion API resulted in an AttributeError
+  that was masqued in the calling hasattr and resulted in wrong conclusion.
+  [jensens]
 
 
 2.3.7 (2016-01-08)
diff --git a/plone/dexterity/filerepresentation.py b/plone/dexterity/filerepresentation.py
index 36256c1..bee059f 100644
--- a/plone/dexterity/filerepresentation.py
+++ b/plone/dexterity/filerepresentation.py
@@ -1,7 +1,6 @@
 # -*- coding: utf-8 -*-
-from Acquisition import aq_base, Implicit
-from Products.CMFCore.utils import getToolByName
-from ZPublisher.Iterators import IStreamIterator
+from Acquisition import aq_base
+from Acquisition import Implicit
 from email.generator import Generator
 from email.message import Message
 from email.parser import FeedParser
@@ -13,6 +12,7 @@
 from plone.rfc822 import constructMessageFromSchemata
 from plone.rfc822 import initializeObjectFromSchemata
 from plone.rfc822.interfaces import IPrimaryField
+from Products.CMFCore.utils import getToolByName
 from webdav.Resource import Resource
 from zExceptions import MethodNotAllowed
 from zExceptions import Unauthorized
@@ -28,6 +28,7 @@
 from zope.lifecycleevent import modified, ObjectCreatedEvent
 from zope.schema import getFieldsInOrder
 from zope.size.interfaces import ISized
+from ZPublisher.Iterators import IStreamIterator
 import tempfile
 
 
@@ -233,7 +234,7 @@ def __getattr__(self, name):
         """Fall back on parent for certain things, even if we're aq_base'd.
         This makes propertysheet access work.
         """
-        if hasattr(self.__parent__.aq_base, name):
+        if hasattr(aq_base(self.__parent__), name):
             return getattr(self.__parent__, name)
         raise AttributeError(name)
 
diff --git a/plone/dexterity/tests/test_webdav.py b/plone/dexterity/tests/test_webdav.py
index 65dc9b3..02b7162 100644
--- a/plone/dexterity/tests/test_webdav.py
+++ b/plone/dexterity/tests/test_webdav.py
@@ -638,7 +638,8 @@ def content_type(self):
 
         requestBody = """\
 <?xml version="1.0" encoding="utf-8" ?>
-<D:propertyupdate xmlns:D="DAV:" xmlns:n="http://www.zope.org/propsets/default">
+<D:propertyupdate xmlns:D="DAV:"
+                  xmlns:n="http://www.zope.org/propsets/default">
     <D:set>
         <D:prop>
             <n:title>New title</n:title>


