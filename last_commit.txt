Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-12-05T13:37:47-08:00
Author: Dante √Ålvarez (danalvrz) <89805481+danalvrz@users.noreply.github.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/6b13c59f059848b78b31f174d8ff2f10b3766ac2

Search controlpanel form checklist fix (#3694)

* search controlpanel form checklist fix

* Add changelog file

* Fix test assertion to match current implementation

* Update changelog

* Fix changelog

Files changed:
A news/3694.bugfix
M Products/CMFPlone/controlpanel/browser/search.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_search.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/search.py b/Products/CMFPlone/controlpanel/browser/search.py\nindex e447d466dd..8d60d4bc3e 100644\n--- a/Products/CMFPlone/controlpanel/browser/search.py\n+++ b/Products/CMFPlone/controlpanel/browser/search.py\n@@ -1,7 +1,7 @@\n from plone.app.registry.browser import controlpanel\n from plone.base.interfaces import ISearchSchema\n from Products.CMFPlone import PloneMessageFactory as _\n-from Products.CMFPlone.controlpanel.widgets import ReverseCheckBoxFieldWidget\n+from z3c.form.browser.checkbox import CheckBoxFieldWidget\n from zope.component import queryUtility\n from zope.schema.interfaces import IVocabularyFactory\n \n@@ -16,7 +16,7 @@ class SearchControlPanelForm(controlpanel.RegistryEditForm):\n     def updateFields(self):\n         super().updateFields()\n         self.fields[\'types_not_searched\'].widgetFactory = \\\n-            ReverseCheckBoxFieldWidget\n+            CheckBoxFieldWidget\n \n     def updateWidgets(self):\n         super().updateWidgets()\ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_search.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_search.py\nindex 4772dbe5c4..ebcf1f3b02 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_search.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_search.py\n@@ -71,5 +71,5 @@ def test_types_not_searched(self):\n \n         registry = getUtility(IRegistry)\n         settings = registry.forInterface(ISearchSchema, prefix="plone")\n-        self.assertFalse(\'Discussion Item\' in settings.types_not_searched)\n-        self.assertFalse(\'News Item Item\' in settings.types_not_searched)\n+        self.assertTrue(\'Discussion Item\' in settings.types_not_searched)\n+        self.assertTrue(\'News Item\' in settings.types_not_searched)\ndiff --git a/news/3694.bugfix b/news/3694.bugfix\nnew file mode 100644\nindex 0000000000..30cb7496a7\n--- /dev/null\n+++ b/news/3694.bugfix\n@@ -0,0 +1 @@\n+Change the search control panel to select types not searched instead of searchable types. This fixes an inconsistency with Volto. [danalvrz]\n\\ No newline at end of file\n'

