Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-07-22T10:56:13+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/c6be5d373ee0508741dc04a6a1fa7db17d23bbcb

Add ``review_state`` to ``CatalogNavigationTabs.topLevelTabs`` results.
This allows for exposing the items workflow state in portal navigation tabs.

Files changed:
M CHANGES.rst
M Products/CMFPlone/browser/navigation.py
M Products/CMFPlone/tests/testNavigationView.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 608d014..9c0f7e7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,6 +10,10 @@ Changelog
 
 Breaking changes:
 
+- Add ``review_state`` to ``CatalogNavigationTabs.topLevelTabs`` results.
+  This allows for exposing the items workflow state in portal navigation tabs.
+  [thet]
+
 - Remove discontinued module ``grunt-debug-task`` from ``plone-compile-resources``.
   [jensens]
 
diff --git a/Products/CMFPlone/browser/navigation.py b/Products/CMFPlone/browser/navigation.py
index 7dfbd62..27bae58 100644
--- a/Products/CMFPlone/browser/navigation.py
+++ b/Products/CMFPlone/browser/navigation.py
@@ -155,7 +155,8 @@ def _get_url(item):
                 'name': utils.pretty_title_or_id(context, item),
                 'id': item.getId,
                 'url': item_url,
-                'description': item.Description
+                'description': item.Description,
+                'review_state': item.review_state
             }
             result.append(data)
 
diff --git a/Products/CMFPlone/tests/testNavigationView.py b/Products/CMFPlone/tests/testNavigationView.py
index 7974472..35ee18d 100644
--- a/Products/CMFPlone/tests/testNavigationView.py
+++ b/Products/CMFPlone/tests/testNavigationView.py
@@ -565,6 +565,23 @@ def testStateFiltering(self):
         # Should only contain the published folder
         self.assertEqual(len(tabs), 1)
 
+    def testTabInfo(self):
+        self.portal._delObject('Members')
+        self.portal._delObject('news')
+        self.portal._delObject('events')
+
+        view = self.view_class(self.portal, self.request)
+        tabs = view.topLevelTabs(actions=[])
+
+        self.assertEqual(len(tabs), 5)
+
+        tab = tabs[0]
+        self.assertTrue('url' in tab and tab['url'])  # url must not be empty
+        self.assertTrue('description' in tab)  # our description is empty
+        self.assertTrue('name' in tab and tab['name'])
+        self.assertTrue('id' in tab and tab['id'])
+        self.assertTrue('review_state' in tab and tab['review_state'])
+
     def testDisableFolderTabs(self):
         # Setting the site_property disable_folder_sections should remove
         # all folder based tabs


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-07-22T13:01:38+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/aeffdefb90900d0e2bef4670196e8929ee77ce0f

Merge pull request #1689 from plone/thet-reviewstate_portaltabs

Add review state to portal tabs results

Files changed:
M CHANGES.rst
M Products/CMFPlone/browser/navigation.py
M Products/CMFPlone/tests/testNavigationView.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 608d014..9c0f7e7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,6 +10,10 @@ Changelog
 
 Breaking changes:
 
+- Add ``review_state`` to ``CatalogNavigationTabs.topLevelTabs`` results.
+  This allows for exposing the items workflow state in portal navigation tabs.
+  [thet]
+
 - Remove discontinued module ``grunt-debug-task`` from ``plone-compile-resources``.
   [jensens]
 
diff --git a/Products/CMFPlone/browser/navigation.py b/Products/CMFPlone/browser/navigation.py
index 7dfbd62..27bae58 100644
--- a/Products/CMFPlone/browser/navigation.py
+++ b/Products/CMFPlone/browser/navigation.py
@@ -155,7 +155,8 @@ def _get_url(item):
                 'name': utils.pretty_title_or_id(context, item),
                 'id': item.getId,
                 'url': item_url,
-                'description': item.Description
+                'description': item.Description,
+                'review_state': item.review_state
             }
             result.append(data)
 
diff --git a/Products/CMFPlone/tests/testNavigationView.py b/Products/CMFPlone/tests/testNavigationView.py
index 7974472..35ee18d 100644
--- a/Products/CMFPlone/tests/testNavigationView.py
+++ b/Products/CMFPlone/tests/testNavigationView.py
@@ -565,6 +565,23 @@ def testStateFiltering(self):
         # Should only contain the published folder
         self.assertEqual(len(tabs), 1)
 
+    def testTabInfo(self):
+        self.portal._delObject('Members')
+        self.portal._delObject('news')
+        self.portal._delObject('events')
+
+        view = self.view_class(self.portal, self.request)
+        tabs = view.topLevelTabs(actions=[])
+
+        self.assertEqual(len(tabs), 5)
+
+        tab = tabs[0]
+        self.assertTrue('url' in tab and tab['url'])  # url must not be empty
+        self.assertTrue('description' in tab)  # our description is empty
+        self.assertTrue('name' in tab and tab['name'])
+        self.assertTrue('id' in tab and tab['id'])
+        self.assertTrue('review_state' in tab and tab['review_state'])
+
     def testDisableFolderTabs(self):
         # Setting the site_property disable_folder_sections should remove
         # all folder based tabs


