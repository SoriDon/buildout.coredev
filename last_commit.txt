Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2017-10-18T19:22:39+02:00
Author: agitator (agitator) <agitator@users.noreply.github.com>
Commit: https://github.com/plone/plone.portlet.collection/commit/fab63532b56e276c4ec0d0dea9f686d0b05b633c

Fix collection selection for Plone 5.1 (#19)

* Fix collection selection for Plone 5.1

Files changed:
M CHANGES.rst
M plone/portlet/collection/collection.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 76a7027..01a84f7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,7 +1,7 @@
 Changelog
 =========
 
-3.2.1 (unreleased)
+3.3.0 (unreleased)
 ------------------
 
 Breaking changes:
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix collection selection for Plone 5.1
+  [agitator]
 
 
 3.2 (2017-07-03)
@@ -23,11 +24,11 @@ Bug fixes:
 New features:
 
 - add options to supress icons,
-  read thumb_scale from registry plus  option to override thumb_scale individually 
-  or suppress thumbs. 
+  read thumb_scale from registry plus  option to override thumb_scale individually
+  or suppress thumbs.
   Replace paper clip (fontello icon) with mimetype icon
   from mimetype registry for files
-  https://github.com/plone/Products.CMFPlone/issues/1734 
+  https://github.com/plone/Products.CMFPlone/issues/1734
   applied https://github.com/plone/Products.CMFPlone/issues/1483
   [fgrcon]
 
@@ -37,7 +38,7 @@ Bug fixes:
 - fixed css-classes for thumb scales ...
   https://github.com/plone/Products.CMFPlone/issues/2077
   [fgrcon]
-  
+
 - Remove unittest2 dependency
   [kakshay21]
 
diff --git a/plone/portlet/collection/collection.py b/plone/portlet/collection/collection.py
index 8634c75..0fd379d 100644
--- a/plone/portlet/collection/collection.py
+++ b/plone/portlet/collection/collection.py
@@ -5,6 +5,8 @@
 from plone.app.portlets.portlets import base
 from plone.app.uuid.utils import uuidToObject
 from plone.app.vocabularies.catalog import CatalogSource
+from plone.app.z3cform.widget import RelatedItemsFieldWidget
+from plone.autoform.directives import widget
 from plone.i18n.normalizer.interfaces import IIDNormalizer
 from plone.memoize.instance import memoize
 from plone.portlet.collection import PloneMessageFactory as _
@@ -47,12 +49,19 @@ class ICollectionPortlet(IPortletDataProvider):
         description=_(u"Title of the rendered portlet"),
         required=True)
 
+    widget(
+        'uid',
+        RelatedItemsFieldWidget,
+        pattern_options={
+            'selectableTypes': ['Collection']
+        }
+    )
     uid = schema.Choice(
         title=_(u"Target collection"),
         description=_(u"Find the collection which provides the items to list"),
         required=True,
-        source=CatalogSource(portal_type=('Topic', 'Collection')),
-        )
+        vocabulary='plone.app.vocabularies.Catalog',
+    )
 
     limit = schema.Int(
         title=_(u"Limit"),
diff --git a/setup.py b/setup.py
index 4a886fc..d19aef9 100644
--- a/setup.py
+++ b/setup.py
@@ -1,6 +1,6 @@
 from setuptools import setup, find_packages
 
-version = '3.2.1.dev0'
+version = '3.3.0.dev0'
 
 setup(name='plone.portlet.collection',
       version=version,


