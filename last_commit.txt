Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-06-12T18:37:13+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/b853d28505deb0252f6a426937c3360ff52644c8

Cleanup of PLIP #1734

Files changed:
M plone/app/contenttypes/behaviors/thumb_icon.py
M plone/app/contenttypes/browser/folder.py
M plone/app/contenttypes/browser/templates/listing.pt
M plone/app/contenttypes/browser/templates/listing_summary.pt
M plone/app/contenttypes/browser/templates/listing_tabular.pt

diff --git a/plone/app/contenttypes/behaviors/thumb_icon.py b/plone/app/contenttypes/behaviors/thumb_icon.py
index 01e7e516..89a4da1e 100644
--- a/plone/app/contenttypes/behaviors/thumb_icon.py
+++ b/plone/app/contenttypes/behaviors/thumb_icon.py
@@ -15,41 +15,45 @@ class IThumbIconHandling(model.Schema):
     model.fieldset(
         'settings',
         label=_(u'Settings'),
-        fields=['ov_thumbsize_list',
-                'ov_thumbsize_table',
-                'ov_thumbsize_summary',
-                'suppress_icons',
-                'suppress_thumbs'
-                ]
+        fields=[
+            'thumb_scale_list',
+            'thumb_scale_table',
+            'thumb_scale_summary',
+            'suppress_icons',
+            'suppress_thumbs'
+        ]
     )
 
-    ov_thumbsize_list = schema.TextLine(
+    thumb_scale_list = schema.TextLine(
         title=_(u'Override thumb size for list view'),
-        description=_(u'<br><ul><li>  valid size '
-                      u'(see `Image Handling` control panel)'
-                      u' e.g. icon, tile, thumb, mini, preview, ... </li>'
-                      u'<li>leave empty to use default'
-                      u'(see `Site` control panel)</li></ul>'),
+        description=_(
+            u"Enter a valid scale name"
+            u" (see 'Image Handling' control panel) to override"
+            u" (e.g. icon, tile, thumb, mini, preview, ... )."
+            u" Leave empty to use default (see 'Site' control panel)."
+        ),
         required=False,
         default=u'')
 
-    ov_thumbsize_table = schema.TextLine(
+    thumb_scale_table = schema.TextLine(
         title=_(u'Override thumb size for table view'),
-        description=_(u'<br><ul><li>   valid size '
-                      u'(see `Image Handling` control panel)'
-                      u' e.g. icon, tile, thumb, mini, preview, ... ,  </li>'
-                      u'<li>leave empty to use default '
-                      u'(see `Site` control panel)</li></ul>'),
+        description=_(
+            u"Enter a valid scale name"
+            u" (see 'Image Handling' control panel) to override"
+            u" (e.g. icon, tile, thumb, mini, preview, ... )."
+            u" Leave empty to use default (see 'Site' control panel)."
+        ),
         required=False,
         default=u'')
 
-    ov_thumbsize_summary = schema.TextLine(
+    thumb_scale_summary = schema.TextLine(
         title=_(u'Override thumb size for summary view'),
-        description=_(u'<br><ul><li>  valid size '
-                      u'(see `Image Handling` control panel)'
-                      u' e.g. icon, tile, thumb, mini, preview, ... ,  </li>'
-                      u'<li>leave empty to use default '
-                      u'(see `Site` control panel)</li></ul>'),
+        description=_(
+            u"Enter a valid scale name"
+            u" (see 'Image Handling' control panel) to override"
+            u" (e.g. icon, tile, thumb, mini, preview, ... )."
+            u" Leave empty to use default (see 'Site' control panel)."
+        ),
         required=False,
         default=u'')
 
@@ -62,26 +66,30 @@ class IThumbIconHandling(model.Schema):
 
     suppress_thumbs = schema.Bool(
         title=_(u'Suppress thumbs in list, table or summary view'),
-        description=_(u''),
         required=False,
         default=False,
     )
 
-    directives.omitted('ov_thumbsize_list',
-                       'ov_thumbsize_table',
-                       'ov_thumbsize_summary',
-                       'suppress_icons',
-                       'suppress_thumbs'
-                       )
-    directives.no_omit(IEditForm, 'ov_thumbsize_list',
-                       'ov_thumbsize_table',
-                       'ov_thumbsize_summary',
-                       'suppress_icons',
-                       'suppress_thumbs'
-                       )
-    directives.no_omit(IAddForm, 'ov_thumbsize_list',
-                       'ov_thumbsize_table',
-                                 'ov_thumbsize_summary',
-                                 'suppress_icons',
-                                 'suppress_thumbs'
-                       )
+    directives.omitted(
+        'thumb_scale_list',
+        'thumb_scale_table',
+        'thumb_scale_summary',
+        'suppress_icons',
+        'suppress_thumbs'
+    )
+    directives.no_omit(
+        IEditForm,
+        'thumb_scale_list',
+        'thumb_scale_table',
+        'thumb_scale_summary',
+        'suppress_icons',
+        'suppress_thumbs'
+    )
+    directives.no_omit(
+        IAddForm,
+        'thumb_scale_list',
+        'thumb_scale_table',
+        'thumb_scale_summary',
+        'suppress_icons',
+        'suppress_thumbs'
+    )
diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
index 843ab2af..5e0daefb 100644
--- a/plone/app/contenttypes/browser/folder.py
+++ b/plone/app/contenttypes/browser/folder.py
@@ -224,46 +224,46 @@ def no_items_message(self):
         )
 
     @memoize
-    def get_thumbSize_table(self):
+    def get_thumb_scale_table(self):
         if getattr(self.context, 'suppress_thumbs', False):
-            return 'none'
-        thsize = getattr(self.context, 'ov_thumbsize_table', '')
-        if thsize > '':
+            return None
+        thsize = getattr(self.context, 'thumb_scale_table', None)
+        if thsize:
             return thsize
         registry = getUtility(IRegistry)
         settings = registry.forInterface(
             ISiteSchema, prefix='plone', check=False)
         if settings.no_thumbs_tables:
-            return 'none'
-        return settings.thumb_size_table
+            return None
+        return settings.thumb_scale_table
 
     @memoize
-    def get_thumbSize_list(self):
+    def get_thumb_scale_list(self):
         if getattr(self.context, 'suppress_thumbs', False):
-            return 'none'
-        thsize = getattr(self.context, 'ov_thumbsize_list', '')
-        if thsize > '':
+            return None
+        thsize = getattr(self.context, 'thumb_scale_list', None)
+        if thsize:
             return thsize
         registry = getUtility(IRegistry)
         settings = registry.forInterface(
             ISiteSchema, prefix='plone', check=False)
         if settings.no_thumbs_lists:
-            return 'none'
-        return settings.thumb_size_listing
+            return None
+        return settings.thumb_scale_listing
 
     @memoize
-    def get_thumbSize_summary(self):
+    def get_thumb_scale_summary(self):
         if getattr(self.context, 'suppress_thumbs', False):
-            return 'none'
-        thsize = getattr(self.context, 'ov_thumbsize_summary', '')
-        if thsize > '':
+            return None
+        thsize = getattr(self.context, 'thumb_scale_summary', None)
+        if thsize:
             return thsize
         registry = getUtility(IRegistry)
         settings = registry.forInterface(
             ISiteSchema, prefix='plone', check=False)
         if settings.no_thumbs_summary:
-            return 'none'
-        return settings.thumb_size_summary
+            return None
+        return settings.thumb_scale_summary
 
     def show_icons(self):
         return not getattr(self.context, 'suppress_icons', False)
diff --git a/plone/app/contenttypes/browser/templates/listing.pt b/plone/app/contenttypes/browser/templates/listing.pt
index 59546ea3..04529764 100644
--- a/plone/app/contenttypes/browser/templates/listing.pt
+++ b/plone/app/contenttypes/browser/templates/listing.pt
@@ -20,11 +20,11 @@
 
   <metal:listingmacro define-macro="listing">
     <tal:results define="batch view/batch;
-                         thumb_size_list python:view.get_thumbSize_list();
-                         thumb_size_table python:view.get_thumbSize_table();
-                         thumb_size_summary python:view.get_thumbSize_summary();
-                         img_class python:'image-%s pull-right' % thumb_size_list;
-                         showicons view/show_icons ;">
+                         thumb_scale_list view/get_thumb_scale_list;
+                         thumb_scale_table view/get_thumb_scale_table;
+                         thumb_scale_summary view/get_thumb_scale_summary;
+                         img_class python:'image-%s pull-right' % thumb_scale_list;
+                         showicons view/show_icons">
       <tal:listing condition="batch">
         <div class="entries" metal:define-slot="entries"
             tal:define="portal context/@@plone_portal_state/portal;
@@ -63,8 +63,8 @@
                          tal:content="item_title">Item Title
                       </a>
                       <a tal:attributes="href item_link;"
-                         tal:condition="python: item_has_image and (thumb_size_list!='none')">
-                         <img tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_size_list, css_class=img_class)" />
+                         tal:condition="python: item_has_image and thumb_scale_list">
+                         <img tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_scale_list, css_class=img_class)" />
                       </a>
                     </span>
                     <metal:block metal:define-macro="document_byline">
diff --git a/plone/app/contenttypes/browser/templates/listing_summary.pt b/plone/app/contenttypes/browser/templates/listing_summary.pt
index 0bf1499f..1f148283 100644
--- a/plone/app/contenttypes/browser/templates/listing_summary.pt
+++ b/plone/app/contenttypes/browser/templates/listing_summary.pt
@@ -28,12 +28,11 @@
 
           <div metal:use-macro="context/@@listing_view/macros/document_byline"></div>
 
-          <div tal:define="thumb_url python:item_url +'/@@images/image/'+thumb_size_summary;"
-               tal:condition="python:  item_has_image and not thumb_size_summary=='none'"
+          <div tal:define="thumb_url python:item_url + '/@@images/image/' + thumb_scale_summary;"
+               tal:condition="python: item_has_image and thumb_scale_summary"
                tal:attributes="class python: 'tileImage' if item_description else 'tileImageNoFloat'">
             <a tal:attributes="href item_link">
-              <img tal:condition="python: item_has_image and (thumb_size_summary!='none')"
-                tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_size_summary, css_class='image-'+thumb_size_summary)" />
+              <img tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_scale_summary, css_class='image-' + thumb_scale_summary)" />
 
             </a>
           </div>
diff --git a/plone/app/contenttypes/browser/templates/listing_tabular.pt b/plone/app/contenttypes/browser/templates/listing_tabular.pt
index 50f3737c..08efd054 100644
--- a/plone/app/contenttypes/browser/templates/listing_tabular.pt
+++ b/plone/app/contenttypes/browser/templates/listing_tabular.pt
@@ -25,8 +25,8 @@
       <div metal:use-macro="context/batch_macros/macros/navigation" />
       <div class="has-table">
         <table
-            tal:define="thumb_size_table python:view.get_thumbSize_table();
-                        img_class python:'image-%s pull-right' % thumb_size_table;
+            tal:define="thumb_scale_table view/get_thumb_scale_table;
+                        img_class python:'image-%s pull-right' % thumb_scale_table;
                         showicons  view/show_icons;
                         "
             class="listing"
@@ -76,9 +76,9 @@
                                          title item_type"
                          tal:content="item_title">Item Title
                       </a>
-                      <a tal:condition="python: item_has_image and (thumb_size_table!='none')">
-                         <img tal:attributes="href item_link;"
-                              tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_size_table, css_class=img_class)" />
+                      <a tal:condition="python:item_has_image and thumb_scale_table">
+                         <img tal:attributes="href item_link"
+                              tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_scale_table, css_class=img_class)" />
                       </a>
                     </td>
                     <td tal:condition="python:field == 'Creator'"


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-06-14T14:41:40+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/cb1f4d40211e3df62282e62c2e6432e72a864858

Merge pull request #410 from plone/thet-1734-cleanup

Cleanup of PLIP #1734

Files changed:
M plone/app/contenttypes/behaviors/thumb_icon.py
M plone/app/contenttypes/browser/folder.py
M plone/app/contenttypes/browser/templates/listing.pt
M plone/app/contenttypes/browser/templates/listing_summary.pt
M plone/app/contenttypes/browser/templates/listing_tabular.pt

diff --git a/plone/app/contenttypes/behaviors/thumb_icon.py b/plone/app/contenttypes/behaviors/thumb_icon.py
index 01e7e516..89a4da1e 100644
--- a/plone/app/contenttypes/behaviors/thumb_icon.py
+++ b/plone/app/contenttypes/behaviors/thumb_icon.py
@@ -15,41 +15,45 @@ class IThumbIconHandling(model.Schema):
     model.fieldset(
         'settings',
         label=_(u'Settings'),
-        fields=['ov_thumbsize_list',
-                'ov_thumbsize_table',
-                'ov_thumbsize_summary',
-                'suppress_icons',
-                'suppress_thumbs'
-                ]
+        fields=[
+            'thumb_scale_list',
+            'thumb_scale_table',
+            'thumb_scale_summary',
+            'suppress_icons',
+            'suppress_thumbs'
+        ]
     )
 
-    ov_thumbsize_list = schema.TextLine(
+    thumb_scale_list = schema.TextLine(
         title=_(u'Override thumb size for list view'),
-        description=_(u'<br><ul><li>  valid size '
-                      u'(see `Image Handling` control panel)'
-                      u' e.g. icon, tile, thumb, mini, preview, ... </li>'
-                      u'<li>leave empty to use default'
-                      u'(see `Site` control panel)</li></ul>'),
+        description=_(
+            u"Enter a valid scale name"
+            u" (see 'Image Handling' control panel) to override"
+            u" (e.g. icon, tile, thumb, mini, preview, ... )."
+            u" Leave empty to use default (see 'Site' control panel)."
+        ),
         required=False,
         default=u'')
 
-    ov_thumbsize_table = schema.TextLine(
+    thumb_scale_table = schema.TextLine(
         title=_(u'Override thumb size for table view'),
-        description=_(u'<br><ul><li>   valid size '
-                      u'(see `Image Handling` control panel)'
-                      u' e.g. icon, tile, thumb, mini, preview, ... ,  </li>'
-                      u'<li>leave empty to use default '
-                      u'(see `Site` control panel)</li></ul>'),
+        description=_(
+            u"Enter a valid scale name"
+            u" (see 'Image Handling' control panel) to override"
+            u" (e.g. icon, tile, thumb, mini, preview, ... )."
+            u" Leave empty to use default (see 'Site' control panel)."
+        ),
         required=False,
         default=u'')
 
-    ov_thumbsize_summary = schema.TextLine(
+    thumb_scale_summary = schema.TextLine(
         title=_(u'Override thumb size for summary view'),
-        description=_(u'<br><ul><li>  valid size '
-                      u'(see `Image Handling` control panel)'
-                      u' e.g. icon, tile, thumb, mini, preview, ... ,  </li>'
-                      u'<li>leave empty to use default '
-                      u'(see `Site` control panel)</li></ul>'),
+        description=_(
+            u"Enter a valid scale name"
+            u" (see 'Image Handling' control panel) to override"
+            u" (e.g. icon, tile, thumb, mini, preview, ... )."
+            u" Leave empty to use default (see 'Site' control panel)."
+        ),
         required=False,
         default=u'')
 
@@ -62,26 +66,30 @@ class IThumbIconHandling(model.Schema):
 
     suppress_thumbs = schema.Bool(
         title=_(u'Suppress thumbs in list, table or summary view'),
-        description=_(u''),
         required=False,
         default=False,
     )
 
-    directives.omitted('ov_thumbsize_list',
-                       'ov_thumbsize_table',
-                       'ov_thumbsize_summary',
-                       'suppress_icons',
-                       'suppress_thumbs'
-                       )
-    directives.no_omit(IEditForm, 'ov_thumbsize_list',
-                       'ov_thumbsize_table',
-                       'ov_thumbsize_summary',
-                       'suppress_icons',
-                       'suppress_thumbs'
-                       )
-    directives.no_omit(IAddForm, 'ov_thumbsize_list',
-                       'ov_thumbsize_table',
-                                 'ov_thumbsize_summary',
-                                 'suppress_icons',
-                                 'suppress_thumbs'
-                       )
+    directives.omitted(
+        'thumb_scale_list',
+        'thumb_scale_table',
+        'thumb_scale_summary',
+        'suppress_icons',
+        'suppress_thumbs'
+    )
+    directives.no_omit(
+        IEditForm,
+        'thumb_scale_list',
+        'thumb_scale_table',
+        'thumb_scale_summary',
+        'suppress_icons',
+        'suppress_thumbs'
+    )
+    directives.no_omit(
+        IAddForm,
+        'thumb_scale_list',
+        'thumb_scale_table',
+        'thumb_scale_summary',
+        'suppress_icons',
+        'suppress_thumbs'
+    )
diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
index 843ab2af..5e0daefb 100644
--- a/plone/app/contenttypes/browser/folder.py
+++ b/plone/app/contenttypes/browser/folder.py
@@ -224,46 +224,46 @@ def no_items_message(self):
         )
 
     @memoize
-    def get_thumbSize_table(self):
+    def get_thumb_scale_table(self):
         if getattr(self.context, 'suppress_thumbs', False):
-            return 'none'
-        thsize = getattr(self.context, 'ov_thumbsize_table', '')
-        if thsize > '':
+            return None
+        thsize = getattr(self.context, 'thumb_scale_table', None)
+        if thsize:
             return thsize
         registry = getUtility(IRegistry)
         settings = registry.forInterface(
             ISiteSchema, prefix='plone', check=False)
         if settings.no_thumbs_tables:
-            return 'none'
-        return settings.thumb_size_table
+            return None
+        return settings.thumb_scale_table
 
     @memoize
-    def get_thumbSize_list(self):
+    def get_thumb_scale_list(self):
         if getattr(self.context, 'suppress_thumbs', False):
-            return 'none'
-        thsize = getattr(self.context, 'ov_thumbsize_list', '')
-        if thsize > '':
+            return None
+        thsize = getattr(self.context, 'thumb_scale_list', None)
+        if thsize:
             return thsize
         registry = getUtility(IRegistry)
         settings = registry.forInterface(
             ISiteSchema, prefix='plone', check=False)
         if settings.no_thumbs_lists:
-            return 'none'
-        return settings.thumb_size_listing
+            return None
+        return settings.thumb_scale_listing
 
     @memoize
-    def get_thumbSize_summary(self):
+    def get_thumb_scale_summary(self):
         if getattr(self.context, 'suppress_thumbs', False):
-            return 'none'
-        thsize = getattr(self.context, 'ov_thumbsize_summary', '')
-        if thsize > '':
+            return None
+        thsize = getattr(self.context, 'thumb_scale_summary', None)
+        if thsize:
             return thsize
         registry = getUtility(IRegistry)
         settings = registry.forInterface(
             ISiteSchema, prefix='plone', check=False)
         if settings.no_thumbs_summary:
-            return 'none'
-        return settings.thumb_size_summary
+            return None
+        return settings.thumb_scale_summary
 
     def show_icons(self):
         return not getattr(self.context, 'suppress_icons', False)
diff --git a/plone/app/contenttypes/browser/templates/listing.pt b/plone/app/contenttypes/browser/templates/listing.pt
index 59546ea3..04529764 100644
--- a/plone/app/contenttypes/browser/templates/listing.pt
+++ b/plone/app/contenttypes/browser/templates/listing.pt
@@ -20,11 +20,11 @@
 
   <metal:listingmacro define-macro="listing">
     <tal:results define="batch view/batch;
-                         thumb_size_list python:view.get_thumbSize_list();
-                         thumb_size_table python:view.get_thumbSize_table();
-                         thumb_size_summary python:view.get_thumbSize_summary();
-                         img_class python:'image-%s pull-right' % thumb_size_list;
-                         showicons view/show_icons ;">
+                         thumb_scale_list view/get_thumb_scale_list;
+                         thumb_scale_table view/get_thumb_scale_table;
+                         thumb_scale_summary view/get_thumb_scale_summary;
+                         img_class python:'image-%s pull-right' % thumb_scale_list;
+                         showicons view/show_icons">
       <tal:listing condition="batch">
         <div class="entries" metal:define-slot="entries"
             tal:define="portal context/@@plone_portal_state/portal;
@@ -63,8 +63,8 @@
                          tal:content="item_title">Item Title
                       </a>
                       <a tal:attributes="href item_link;"
-                         tal:condition="python: item_has_image and (thumb_size_list!='none')">
-                         <img tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_size_list, css_class=img_class)" />
+                         tal:condition="python: item_has_image and thumb_scale_list">
+                         <img tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_scale_list, css_class=img_class)" />
                       </a>
                     </span>
                     <metal:block metal:define-macro="document_byline">
diff --git a/plone/app/contenttypes/browser/templates/listing_summary.pt b/plone/app/contenttypes/browser/templates/listing_summary.pt
index 0bf1499f..1f148283 100644
--- a/plone/app/contenttypes/browser/templates/listing_summary.pt
+++ b/plone/app/contenttypes/browser/templates/listing_summary.pt
@@ -28,12 +28,11 @@
 
           <div metal:use-macro="context/@@listing_view/macros/document_byline"></div>
 
-          <div tal:define="thumb_url python:item_url +'/@@images/image/'+thumb_size_summary;"
-               tal:condition="python:  item_has_image and not thumb_size_summary=='none'"
+          <div tal:define="thumb_url python:item_url + '/@@images/image/' + thumb_scale_summary;"
+               tal:condition="python: item_has_image and thumb_scale_summary"
                tal:attributes="class python: 'tileImage' if item_description else 'tileImageNoFloat'">
             <a tal:attributes="href item_link">
-              <img tal:condition="python: item_has_image and (thumb_size_summary!='none')"
-                tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_size_summary, css_class='image-'+thumb_size_summary)" />
+              <img tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_scale_summary, css_class='image-' + thumb_scale_summary)" />
 
             </a>
           </div>
diff --git a/plone/app/contenttypes/browser/templates/listing_tabular.pt b/plone/app/contenttypes/browser/templates/listing_tabular.pt
index 50f3737c..08efd054 100644
--- a/plone/app/contenttypes/browser/templates/listing_tabular.pt
+++ b/plone/app/contenttypes/browser/templates/listing_tabular.pt
@@ -25,8 +25,8 @@
       <div metal:use-macro="context/batch_macros/macros/navigation" />
       <div class="has-table">
         <table
-            tal:define="thumb_size_table python:view.get_thumbSize_table();
-                        img_class python:'image-%s pull-right' % thumb_size_table;
+            tal:define="thumb_scale_table view/get_thumb_scale_table;
+                        img_class python:'image-%s pull-right' % thumb_scale_table;
                         showicons  view/show_icons;
                         "
             class="listing"
@@ -76,9 +76,9 @@
                                          title item_type"
                          tal:content="item_title">Item Title
                       </a>
-                      <a tal:condition="python: item_has_image and (thumb_size_table!='none')">
-                         <img tal:attributes="href item_link;"
-                              tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_size_table, css_class=img_class)" />
+                      <a tal:condition="python:item_has_image and thumb_scale_table">
+                         <img tal:attributes="href item_link"
+                              tal:replace="structure python:image_scale.tag(item, 'image', scale=thumb_scale_table, css_class=img_class)" />
                       </a>
                     </td>
                     <td tal:condition="python:field == 'Creator'"


