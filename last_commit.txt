Repository: plone.restapi


Branch: refs/heads/master
Date: 2018-10-01T23:37:30-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.restapi/commit/468129e32718ddb01540653d6b7ee1a9b78e931f

Fix test: normalize difference between Plone 5.2 and previous versions

Files changed:
M src/plone/restapi/tests/test_search.py

b"diff --git a/src/plone/restapi/tests/test_search.py b/src/plone/restapi/tests/test_search.py\nindex ca9619c6..1cb3aef3 100644\n--- a/src/plone/restapi/tests/test_search.py\n+++ b/src/plone/restapi/tests/test_search.py\n@@ -224,6 +224,7 @@ def test_full_metadata_retrieval(self):\n         query = {'SearchableText': 'lorem', 'metadata_fields': '_all'}\n         response = self.api_session.get('/@search', params=query)\n \n+        first_item = response.json()['items'][0]\n         self.assertDictContainsSubset(\n             {u'@id': self.portal_url + u'/folder/doc',\n              u'Creator': u'test_user_1_',\n@@ -243,7 +244,6 @@ def test_full_metadata_retrieval(self):\n              u'exclude_from_nav': False,\n              u'expires': u'1999-01-01T00:00:00+00:00',\n              u'getId': u'doc',\n-             u'getObjSize': u'0 KB',\n              u'getPath': u'/plone/folder/doc',\n              u'getRemoteUrl': None,\n              u'getURL': self.portal_url + u'/folder/doc',\n@@ -260,7 +260,10 @@ def test_full_metadata_retrieval(self):\n              u'sync_uid': None,\n              u'title': u'Lorem Ipsum',\n              u'total_comments': 0},\n-            response.json()['items'][0])\n+            first_item)\n+        # This value changed in Plone 5.2\n+        # (Dexterity gained support for getObjSize)\n+        self.assertIn(first_item[u'getObjSize'], (u'0 KB', u'1 KB'))\n \n     def test_full_objects_retrieval(self):\n         query = {'SearchableText': 'lorem',\n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2018-10-02T07:03:28+02:00
Author: Timo Stollenwerk (tisto) <tisto@users.noreply.github.com>
Commit: https://github.com/plone/plone.restapi/commit/58b63530fb0753276670829742bf45e15ad35024

Merge pull request #622 from plone/fix-test

Fix test: normalize difference between Plone 5.2 and previous versions

Files changed:
M src/plone/restapi/tests/test_search.py

b"diff --git a/src/plone/restapi/tests/test_search.py b/src/plone/restapi/tests/test_search.py\nindex ca9619c6..1cb3aef3 100644\n--- a/src/plone/restapi/tests/test_search.py\n+++ b/src/plone/restapi/tests/test_search.py\n@@ -224,6 +224,7 @@ def test_full_metadata_retrieval(self):\n         query = {'SearchableText': 'lorem', 'metadata_fields': '_all'}\n         response = self.api_session.get('/@search', params=query)\n \n+        first_item = response.json()['items'][0]\n         self.assertDictContainsSubset(\n             {u'@id': self.portal_url + u'/folder/doc',\n              u'Creator': u'test_user_1_',\n@@ -243,7 +244,6 @@ def test_full_metadata_retrieval(self):\n              u'exclude_from_nav': False,\n              u'expires': u'1999-01-01T00:00:00+00:00',\n              u'getId': u'doc',\n-             u'getObjSize': u'0 KB',\n              u'getPath': u'/plone/folder/doc',\n              u'getRemoteUrl': None,\n              u'getURL': self.portal_url + u'/folder/doc',\n@@ -260,7 +260,10 @@ def test_full_metadata_retrieval(self):\n              u'sync_uid': None,\n              u'title': u'Lorem Ipsum',\n              u'total_comments': 0},\n-            response.json()['items'][0])\n+            first_item)\n+        # This value changed in Plone 5.2\n+        # (Dexterity gained support for getObjSize)\n+        self.assertIn(first_item[u'getObjSize'], (u'0 KB', u'1 KB'))\n \n     def test_full_objects_retrieval(self):\n         query = {'SearchableText': 'lorem',\n"

