Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-11-14T15:20:14-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/523970762e749440034c0d1f0f00904c5def6d12

Fix tinymce--missing fixes from 5.1/5.0

Files changed:
M Products/CMFPlone/_scripts/_generate_gruntfile.py
M Products/CMFPlone/profiles/dependencies/registry.xml

b'diff --git a/Products/CMFPlone/_scripts/_generate_gruntfile.py b/Products/CMFPlone/_scripts/_generate_gruntfile.py\nindex 228c67822..b75b183c1 100644\n--- a/Products/CMFPlone/_scripts/_generate_gruntfile.py\n+++ b/Products/CMFPlone/_scripts/_generate_gruntfile.py\n@@ -271,7 +271,7 @@ def resource_to_dir(resource, file_type=\'.js\'):\n # LESS CONFIGURATION\n \n modify_vars = {}\n-modify_vars[\'sitePath\'] = \'/\'\n+modify_vars[\'sitePath\'] = "\'/\'"\n modify_vars[\'isPlone\'] = \'false\'\n modify_vars[\'isMockup\'] = \'false\'\n modify_vars[\'staticPath\'] = \'\\\'\' + os.path.join(\ndiff --git a/Products/CMFPlone/profiles/dependencies/registry.xml b/Products/CMFPlone/profiles/dependencies/registry.xml\nindex 3499ccb51..46b0128c0 100644\n--- a/Products/CMFPlone/profiles/dependencies/registry.xml\n+++ b/Products/CMFPlone/profiles/dependencies/registry.xml\n@@ -623,8 +623,8 @@\n       <value key="export">window.tinyMCE</value>\n       <value key="init">function () { this.tinyMCE.DOM.events.domLoaded = true; return this.tinyMCE; }</value>\n       <value key="css">\n-        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/skin.less</element>\n-        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/Content.less</element>\n+        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/skin.min.css</element>\n+        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/content.min.css</element>\n       </value>\n   </records>\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-11-15T08:24:41-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/343688b37a06d370d82a47b00409b671a6e0174e

add changelog

Co-authored-by: Wildcard Corp. &lt;corporate@wildcardcorp.com&gt;

Files changed:
A news/2630.bugfix

b'diff --git a/news/2630.bugfix b/news/2630.bugfix\nnew file mode 100644\nindex 000000000..4fdfcd35c\n--- /dev/null\n+++ b/news/2630.bugfix\n@@ -0,0 +1,2 @@\n+Forward port TinyMCE fixes from 5.1\n+[vangheem]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-11-30T10:15:57-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/9362b53454c957f33253db042aa1b29011ed3415

Merge branch 'master' into fix-tinymce-52

Files changed:
A news/2620.bugfix
M CHANGES.rst
M Products/CMFPlone/resources/browser/cook.py
M setup.py
D Products/CMFPlone/static/components/pickadate/lib/translations/fa_ir.js

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 630a1a103..7e4b69c06 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -164,6 +164,9 @@ Bug fixes:\n - Remove ``plone-generate-gruntfile`` (it is all available through ``plone-compile-resources``).\n   [jensens]\n \n+- Migrate from ``slimit`` to ``calmjs.parse`` for the JavaScript cooker #2616\n+  [metatoaster]\n+\n \n New Features:\n \ndiff --git a/Products/CMFPlone/resources/browser/cook.py b/Products/CMFPlone/resources/browser/cook.py\nindex c239277ef..8bb55b4ee 100644\n--- a/Products/CMFPlone/resources/browser/cook.py\n+++ b/Products/CMFPlone/resources/browser/cook.py\n@@ -1,4 +1,5 @@\n # -*- coding: utf-8 -*-\n+from calmjs.parse import es5\n from datetime import datetime\n from io import BytesIO\n from plone.protect.interfaces import IDisableCSRFProtection\n@@ -10,7 +11,6 @@\n from Products.CMFPlone.interfaces.resources import OVERRIDE_RESOURCE_DIRECTORY_NAME  # noqa\n from Products.CMFPlone.resources.browser.combine import combine_bundles\n from scss import Compiler\n-from slimit import minify\n from zExceptions import NotFound\n from zope.component import getUtility\n from zope.component.hooks import getSite\n@@ -121,7 +121,7 @@ def cookWhenChangingSettings(context, bundle=None):\n                 cooked_js += '\\n/* resource: {0} */\\n{1}'.format(\n                     resource.js,\n                     js if '.min.js' == resource.js[-7:] else\n-                    minify(js, mangle=False, mangle_toplevel=False)\n+                    es5.minify_print(js)\n                 )\n             except SyntaxError:\n                 cooked_js +=\\\ndiff --git a/Products/CMFPlone/static/components/pickadate/lib/translations/fa_ir.js b/Products/CMFPlone/static/components/pickadate/lib/translations/fa_ir.js\ndeleted file mode 100644\nindex 58215deb2..000000000\n--- a/Products/CMFPlone/static/components/pickadate/lib/translations/fa_ir.js\n+++ /dev/null\n@@ -1,19 +0,0 @@\n-// Farsi\n-\n-jQuery.extend( jQuery.fn.pickadate.defaults, {\n-    monthsFull: [ '\xda\x98\xd8\xa7\xd9\x86\xd9\x88\xdb\x8c\xd9\x87', '\xd9\x81\xd9\x88\xd8\xb1\xdb\x8c\xd9\x87', '\xd9\x85\xd8\xa7\xd8\xb1\xd8\xb3', '\xd8\xa2\xd9\x88\xd8\xb1\xdb\x8c\xd9\x84', '\xd9\x85\xd9\x87', '\xda\x98\xd9\x88\xd8\xa6\xd9\x86', '\xda\x98\xd9\x88\xd8\xa6\xdb\x8c\xd9\x87', '\xd8\xa7\xd9\x88\xd8\xaa', '\xd8\xb3\xd9\xbe\xd8\xaa\xd8\xa7\xd9\x85\xd8\xa8\xd8\xb1', '\xd8\xa7\xda\xa9\xd8\xaa\xd8\xa8\xd8\xb1', '\xd9\x86\xd9\x88\xd8\xa7\xd9\x85\xd8\xa8\xd8\xb1', '\xd8\xaf\xd8\xb3\xd8\xa7\xd9\x85\xd8\xa8\xd8\xb1'],\n-    monthsShort: [ '\xda\x98\xd8\xa7\xd9\x86\xd9\x88\xdb\x8c\xd9\x87', '\xd9\x81\xd9\x88\xd8\xb1\xdb\x8c\xd9\x87', '\xd9\x85\xd8\xa7\xd8\xb1\xd8\xb3', '\xd8\xa2\xd9\x88\xd8\xb1\xdb\x8c\xd9\x84', '\xd9\x85\xd9\x87', '\xda\x98\xd9\x88\xd8\xa6\xd9\x86', '\xda\x98\xd9\x88\xd8\xa6\xdb\x8c\xd9\x87', '\xd8\xa7\xd9\x88\xd8\xaa', '\xd8\xb3\xd9\xbe\xd8\xaa\xd8\xa7\xd9\x85\xd8\xa8\xd8\xb1', '\xd8\xa7\xda\xa9\xd8\xaa\xd8\xa8\xd8\xb1', '\xd9\x86\xd9\x88\xd8\xa7\xd9\x85\xd8\xa8\xd8\xb1', '\xd8\xaf\xd8\xb3\xd8\xa7\xd9\x85\xd8\xa8\xd8\xb1' ],\n-    weekdaysFull: [ '\xdb\x8c\xda\xa9\xd8\xb4\xd9\x86\xd8\xa8\xd9\x87', '\xd8\xaf\xd9\x88\xd8\xb4\xd9\x86\xd8\xa8\xd9\x87', '\xd8\xb3\xd9\x87 \xd8\xb4\xd9\x86\xd8\xa8\xd9\x87', '\xda\x86\xd9\x87\xd8\xa7\xd8\xb1\xd8\xb4\xd9\x86\xd8\xa8\xd9\x87', '\xd9\xbe\xd9\x86\xd8\xac\xd8\xb4\xd9\x86\xd8\xa8\xd9\x87', '\xd8\xac\xd9\x85\xd8\xb9\xd9\x87', '\xd8\xb4\xd9\x86\xd8\xa8\xd9\x87' ],\n-    weekdaysShort: [ '\xdb\x8c\xda\xa9\xd8\xb4\xd9\x86\xd8\xa8\xd9\x87', '\xd8\xaf\xd9\x88\xd8\xb4\xd9\x86\xd8\xa8\xd9\x87', '\xd8\xb3\xd9\x87 \xd8\xb4\xd9\x86\xd8\xa8\xd9\x87', '\xda\x86\xd9\x87\xd8\xa7\xd8\xb1\xd8\xb4\xd9\x86\xd8\xa8\xd9\x87', '\xd9\xbe\xd9\x86\xd8\xac\xd8\xb4\xd9\x86\xd8\xa8\xd9\x87', '\xd8\xac\xd9\x85\xd8\xb9\xd9\x87', '\xd8\xb4\xd9\x86\xd8\xa8\xd9\x87' ],\n-    today: '\xd8\xa7\xd9\x85\xd8\xb1\xd9\x88\xd8\xb2',\n-    clear: '\xd9\xbe\xd8\xa7\xda\xa9 \xda\xa9\xd8\xb1\xd8\xaf\xd9\x86',\n-    close: '\xd8\xa8\xd8\xb3\xd8\xaa\xd9\x86',\n-    format: 'yyyy mmmm dd',\n-    formatSubmit: 'yyyy/mm/dd',\n-    labelMonthNext: '\xd9\x85\xd8\xa7\xd9\x87 \xd8\xa8\xd8\xb9\xd8\xaf\xdb\x8c',\n-\tlabelMonthPrev: '\xd9\x85\xd8\xa7\xd9\x87 \xd9\x82\xd8\xa8\xd9\x84\xdb\x8c'\n-});\n-\n-jQuery.extend( jQuery.fn.pickatime.defaults, {\n-    clear: '\xd9\xbe\xd8\xa7\xda\xa9 \xda\xa9\xd8\xb1\xd8\xaf\xd9\x86'\n-});\ndiff --git a/news/2620.bugfix b/news/2620.bugfix\nnew file mode 100644\nindex 000000000..e4ed2aa10\n--- /dev/null\n+++ b/news/2620.bugfix\n@@ -0,0 +1 @@\n+Delete ``fa_ir.js``.  Keep ```fa_IR.js``.  [maurits]\ndiff --git a/setup.py b/setup.py\nindex 2b47fad1f..52edebef9 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -37,6 +37,7 @@\n         'AccessControl >= 4.0b1',\n         'Acquisition',\n         'borg.localrole',\n+        'calmjs.parse',\n         'DateTime',\n         'ExtensionClass',\n         'five.customerize',\n@@ -110,7 +111,6 @@\n         'pyScss',\n         'setuptools>=36.2',\n         'six',\n-        'slimit',\n         'transaction',\n         'z3c.autoinclude',\n         'ZODB3',\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-12-01T17:59:51+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/b4458a5b5023a3d790f9c044ba51601e3261c21f

Merge pull request #2630 from plone/fix-tinymce-52

Fix tinymce--missing fixes from 5.1/5.0

Files changed:
A news/2630.bugfix
M Products/CMFPlone/_scripts/_generate_gruntfile.py
M Products/CMFPlone/profiles/dependencies/registry.xml

b'diff --git a/Products/CMFPlone/_scripts/_generate_gruntfile.py b/Products/CMFPlone/_scripts/_generate_gruntfile.py\nindex 228c67822..b75b183c1 100644\n--- a/Products/CMFPlone/_scripts/_generate_gruntfile.py\n+++ b/Products/CMFPlone/_scripts/_generate_gruntfile.py\n@@ -271,7 +271,7 @@ def resource_to_dir(resource, file_type=\'.js\'):\n # LESS CONFIGURATION\n \n modify_vars = {}\n-modify_vars[\'sitePath\'] = \'/\'\n+modify_vars[\'sitePath\'] = "\'/\'"\n modify_vars[\'isPlone\'] = \'false\'\n modify_vars[\'isMockup\'] = \'false\'\n modify_vars[\'staticPath\'] = \'\\\'\' + os.path.join(\ndiff --git a/Products/CMFPlone/profiles/dependencies/registry.xml b/Products/CMFPlone/profiles/dependencies/registry.xml\nindex 3499ccb51..46b0128c0 100644\n--- a/Products/CMFPlone/profiles/dependencies/registry.xml\n+++ b/Products/CMFPlone/profiles/dependencies/registry.xml\n@@ -623,8 +623,8 @@\n       <value key="export">window.tinyMCE</value>\n       <value key="init">function () { this.tinyMCE.DOM.events.domLoaded = true; return this.tinyMCE; }</value>\n       <value key="css">\n-        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/skin.less</element>\n-        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/Content.less</element>\n+        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/skin.min.css</element>\n+        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/content.min.css</element>\n       </value>\n   </records>\n \ndiff --git a/news/2630.bugfix b/news/2630.bugfix\nnew file mode 100644\nindex 000000000..4fdfcd35c\n--- /dev/null\n+++ b/news/2630.bugfix\n@@ -0,0 +1,2 @@\n+Forward port TinyMCE fixes from 5.1\n+[vangheem]\n\\ No newline at end of file\n'

