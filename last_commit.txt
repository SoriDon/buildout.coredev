Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-03-15T15:44:30+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/b394ab893ec1790a88b3a471419ae2c6ea713652

Fix userlisting batch/showAll in group membership management template.

Files changed:
M Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.pt
M Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.pt b/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.pt\nindex ffbd86c817..3a5d475f6b 100644\n--- a/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.pt\n+++ b/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.pt\n@@ -44,9 +44,8 @@\n                     Batch python:modules[\'Products.CMFPlone\'].Batch;\n                     resultcount python:len(view.searchResults);\n                     b_size python:resultcount if showAll else 20;\n-                    b_start python:0 if showAll or view.newSearch else view.atoi(request.get(\'b_start\',0));\n-                    b_start python:b_start if b_start &lt;= resultcount else resultcount - resultcount % b_size;\n-                    b_start python:b_start if b_start &lt; resultcount else max(b_start - b_size, 0);\n+                    b_start request/b_start|python:0;\n+                    b_start python:0 if showAll or view.newSearch else b_start;\n                     portal_url context/portal_url;\n                     groupquery python:view.makeQuery(groupname=view.groupname);\n                     groupkeyquery python:view.makeQuery(key=view.groupname);">\n@@ -93,16 +92,12 @@\n                 <thead>\n                   <tr>\n                       <th>\n-                          <input class="noborder"\n+                          <span class="form-check"><input class="form-check-input toggle-all"\n                                   type="checkbox"\n-                                  src="select_all_icon.png"\n                                   name="selectButton"\n                                   title="Select all items"\n-                                  onClick="toggleSelect(this, \'delete:list\');"\n-                                  tal:attributes="src string:$portal_url/select_all_icon.png"\n                                   alt="Select all items"\n-                                  i18n:attributes="title label_select_all_items; alt label_select_all_items;"/>\n-                                  <!--Remove user from this group-->\n+                                  i18n:attributes="title label_select_all_items; alt label_select_all_items;"/></span>\n                       </th>\n                       <th i18n:translate="listingheader_user_name">User name</th>\n                       <th i18n:translate="listingheader_email_address">E-mail Address</th>\n@@ -113,13 +108,13 @@\n                     <tr tal:condition="python:this_user is not None"\n                         tal:define="oddrow repeat/this_user/odd"\n                         tal:attributes="class python:oddrow and \'odd\' or \'even\'">\n-                        <td class="listingCheckbox">\n-                            <input\n+                        <td>\n+                            <span class="form-check"><input\n                                     type="checkbox"\n-                                    class="noborder notify"\n+                                    class="noborder notify form-check-input"\n                                     name="delete:list"\n                                     tal:attributes="value this_user/getId;\n-                                                    disabled python:this_user.canRemoveFromGroup(view.groupname) and default or \'disabled\'" />\n+                                                    disabled python:this_user.canRemoveFromGroup(view.groupname) and default or \'disabled\'" /></span>\n                         </td>\n \n                         <tal:block tal:condition="python: view.isGroup(this_user)">\n@@ -211,16 +206,12 @@\n                     </thead>\n                     <tbody>\n                       <tr tal:condition="batch">\n-                        <th>\n-                            <input class="noborder"\n+                        <th><span class="form-check"><input class="noborder form-check-input toggle-all"\n                                     type="checkbox"\n-                                    src="select_all_icon.png"\n                                     name="selectButton"\n                                     title="Select all items"\n-                                    onClick="toggleSelect(this, \'add:list\');"\n-                                    tal:attributes="src string:$portal_url/select_all_icon.png"\n                                     alt="Select all items"\n-                                    i18n:attributes="title label_select_all_items; alt label_select_all_items;"/>\n+                                    i18n:attributes="title label_select_all_items; alt label_select_all_items;"/></span>\n                         </th>\n \n                         <th i18n:translate="listingheader_group_user_name">Group/User name</th>\n@@ -232,13 +223,13 @@\n                             tal:condition="python:this_user is not None"\n                             tal:attributes="class python:oddrow and \'odd\' or \'even\'">\n \n-                          <td class="listingCheckbox">\n-                            <input type="checkbox"\n-                                    class="noborder"\n+                          <td>\n+                            <span class="form-check"><input type="checkbox"\n+                                    class="noborder form-check-input"\n                                     name="add:list"\n                                     value="value"\n                                     tal:attributes="value this_user/getId;\n-                                                    disabled python:this_user.canAddToGroup(view.groupname) and default or \'disabled\'" />\n+                                                    disabled python:this_user.canAddToGroup(view.groupname) and default or \'disabled\'" /></span>\n                           </td>\n \n                           <td>\ndiff --git a/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.py b/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.py\nindex 9dad09d7d0..57fdd24402 100644\n--- a/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.py\n+++ b/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.py\n@@ -57,14 +57,21 @@ def update(self):\n             search = form.get(\'form.button.Search\', None) is not None\n             edit = form.get(\'form.button.Edit\', None) is not None and toDelete\n             add = form.get(\'form.button.Add\', None) is not None and toAdd\n-            findAll = form.get(\'form.button.FindAll\', None) is not None and \\\n-                not self.many_users\n+            isBatched = form.get("b_start", None) is not None\n+            findAll = (\n+                form.get(\'form.button.FindAll\', None) is not None\n+                and not self.many_users\n+            )\n+            unbatchedAll = (\n+                form.get("showAll", "") == "y"\n+                and not self.many_users\n+            )\n             # The search string should be cleared when one of the\n             # non-search buttons has been clicked.\n-            if findAll or edit or add:\n+            if findAll or unbatchedAll or edit or add:\n                 form[\'searchstring\'] = \'\'\n             self.searchString = form.get(\'searchstring\', \'\')\n-            if findAll or bool(self.searchString):\n+            if findAll or isBatched or unbatchedAll or bool(self.searchString):\n                 self.searchResults = self.getPotentialMembers(\n                     self.searchString)\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-03-15T15:48:58+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/a7f5f4ded617f2a5705fd814343068322e46c3cc

changenote

Files changed:
A news/3738.bugfix

b'diff --git a/news/3738.bugfix b/news/3738.bugfix\nnew file mode 100644\nindex 0000000000..d0e5395ad9\n--- /dev/null\n+++ b/news/3738.bugfix\n@@ -0,0 +1,2 @@\n+Fix userlisting batch/showAll in group membership template.\n+[petschki]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2023-03-16T23:45:44+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/1a19527858773cd9e34234e4d60020a4407fbeca

Merge pull request #3741 from plone/petschki/usergroup-membermangement

Fix userlisting batch/showAll in group membership management template.

Files changed:
A news/3738.bugfix
M Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.pt
M Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.pt b/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.pt\nindex ffbd86c817..3a5d475f6b 100644\n--- a/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.pt\n+++ b/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.pt\n@@ -44,9 +44,8 @@\n                     Batch python:modules[\'Products.CMFPlone\'].Batch;\n                     resultcount python:len(view.searchResults);\n                     b_size python:resultcount if showAll else 20;\n-                    b_start python:0 if showAll or view.newSearch else view.atoi(request.get(\'b_start\',0));\n-                    b_start python:b_start if b_start &lt;= resultcount else resultcount - resultcount % b_size;\n-                    b_start python:b_start if b_start &lt; resultcount else max(b_start - b_size, 0);\n+                    b_start request/b_start|python:0;\n+                    b_start python:0 if showAll or view.newSearch else b_start;\n                     portal_url context/portal_url;\n                     groupquery python:view.makeQuery(groupname=view.groupname);\n                     groupkeyquery python:view.makeQuery(key=view.groupname);">\n@@ -93,16 +92,12 @@\n                 <thead>\n                   <tr>\n                       <th>\n-                          <input class="noborder"\n+                          <span class="form-check"><input class="form-check-input toggle-all"\n                                   type="checkbox"\n-                                  src="select_all_icon.png"\n                                   name="selectButton"\n                                   title="Select all items"\n-                                  onClick="toggleSelect(this, \'delete:list\');"\n-                                  tal:attributes="src string:$portal_url/select_all_icon.png"\n                                   alt="Select all items"\n-                                  i18n:attributes="title label_select_all_items; alt label_select_all_items;"/>\n-                                  <!--Remove user from this group-->\n+                                  i18n:attributes="title label_select_all_items; alt label_select_all_items;"/></span>\n                       </th>\n                       <th i18n:translate="listingheader_user_name">User name</th>\n                       <th i18n:translate="listingheader_email_address">E-mail Address</th>\n@@ -113,13 +108,13 @@\n                     <tr tal:condition="python:this_user is not None"\n                         tal:define="oddrow repeat/this_user/odd"\n                         tal:attributes="class python:oddrow and \'odd\' or \'even\'">\n-                        <td class="listingCheckbox">\n-                            <input\n+                        <td>\n+                            <span class="form-check"><input\n                                     type="checkbox"\n-                                    class="noborder notify"\n+                                    class="noborder notify form-check-input"\n                                     name="delete:list"\n                                     tal:attributes="value this_user/getId;\n-                                                    disabled python:this_user.canRemoveFromGroup(view.groupname) and default or \'disabled\'" />\n+                                                    disabled python:this_user.canRemoveFromGroup(view.groupname) and default or \'disabled\'" /></span>\n                         </td>\n \n                         <tal:block tal:condition="python: view.isGroup(this_user)">\n@@ -211,16 +206,12 @@\n                     </thead>\n                     <tbody>\n                       <tr tal:condition="batch">\n-                        <th>\n-                            <input class="noborder"\n+                        <th><span class="form-check"><input class="noborder form-check-input toggle-all"\n                                     type="checkbox"\n-                                    src="select_all_icon.png"\n                                     name="selectButton"\n                                     title="Select all items"\n-                                    onClick="toggleSelect(this, \'add:list\');"\n-                                    tal:attributes="src string:$portal_url/select_all_icon.png"\n                                     alt="Select all items"\n-                                    i18n:attributes="title label_select_all_items; alt label_select_all_items;"/>\n+                                    i18n:attributes="title label_select_all_items; alt label_select_all_items;"/></span>\n                         </th>\n \n                         <th i18n:translate="listingheader_group_user_name">Group/User name</th>\n@@ -232,13 +223,13 @@\n                             tal:condition="python:this_user is not None"\n                             tal:attributes="class python:oddrow and \'odd\' or \'even\'">\n \n-                          <td class="listingCheckbox">\n-                            <input type="checkbox"\n-                                    class="noborder"\n+                          <td>\n+                            <span class="form-check"><input type="checkbox"\n+                                    class="noborder form-check-input"\n                                     name="add:list"\n                                     value="value"\n                                     tal:attributes="value this_user/getId;\n-                                                    disabled python:this_user.canAddToGroup(view.groupname) and default or \'disabled\'" />\n+                                                    disabled python:this_user.canAddToGroup(view.groupname) and default or \'disabled\'" /></span>\n                           </td>\n \n                           <td>\ndiff --git a/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.py b/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.py\nindex 9dad09d7d0..57fdd24402 100644\n--- a/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.py\n+++ b/Products/CMFPlone/controlpanel/browser/usergroups_groupmembership.py\n@@ -57,14 +57,21 @@ def update(self):\n             search = form.get(\'form.button.Search\', None) is not None\n             edit = form.get(\'form.button.Edit\', None) is not None and toDelete\n             add = form.get(\'form.button.Add\', None) is not None and toAdd\n-            findAll = form.get(\'form.button.FindAll\', None) is not None and \\\n-                not self.many_users\n+            isBatched = form.get("b_start", None) is not None\n+            findAll = (\n+                form.get(\'form.button.FindAll\', None) is not None\n+                and not self.many_users\n+            )\n+            unbatchedAll = (\n+                form.get("showAll", "") == "y"\n+                and not self.many_users\n+            )\n             # The search string should be cleared when one of the\n             # non-search buttons has been clicked.\n-            if findAll or edit or add:\n+            if findAll or unbatchedAll or edit or add:\n                 form[\'searchstring\'] = \'\'\n             self.searchString = form.get(\'searchstring\', \'\')\n-            if findAll or bool(self.searchString):\n+            if findAll or isBatched or unbatchedAll or bool(self.searchString):\n                 self.searchResults = self.getPotentialMembers(\n                     self.searchString)\n \ndiff --git a/news/3738.bugfix b/news/3738.bugfix\nnew file mode 100644\nindex 0000000000..d0e5395ad9\n--- /dev/null\n+++ b/news/3738.bugfix\n@@ -0,0 +1,2 @@\n+Fix userlisting batch/showAll in group membership template.\n+[petschki]\n'

