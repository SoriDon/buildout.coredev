Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-02-17T20:44:23+01:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/6534734fc96cf8f791931e49cda4f3057b1e72c2

Fix broken link
- fix @@rebuild-relations link

Files changed:
A news/3322.bugfix
M Products/CMFPlone/controlpanel/browser/relations_inspect.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/relations_inspect.pt b/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\nindex 36337a68d4..e2eed85065 100644\n--- a/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\n+++ b/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\n@@ -41,7 +41,7 @@\n            class="portalMessage warning alert alert-warning" role="alert"\n            i18n:translate="">\n              <strong>Warning!</strong> You have broken relations!\n-             You can <a href="@@rebuild_relations">inspect and rebuild all relations</a>.\n+             You can <a href="@@rebuild-relations">inspect and rebuild all relations</a>.\n       </div>\n \n       <form id="relationinfo" method="post" action="@@inspect-relations" enctype="multipart/form-data">\ndiff --git a/news/3322.bugfix b/news/3322.bugfix\nnew file mode 100644\nindex 0000000000..f082569004\n--- /dev/null\n+++ b/news/3322.bugfix\n@@ -0,0 +1,2 @@\n+Fix broken link in the RelationsInspectControlpanel\n+[1letter]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-02-19T16:06:04+01:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/4c20da03cde921ef1967638d2083911898a36dc5

Merge branch 'master' into 1letter/issue3322

Files changed:
A news/3290.bugfix
A news/3374.bugfix
M Products/CMFPlone/browser/login/templates/insufficient_privileges.pt
M Products/CMFPlone/browser/templates/author.pt
M README.rst

b'diff --git a/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt b/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt\nindex dc0b859b71..5ce1abb146 100644\n--- a/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt\n+++ b/Products/CMFPlone/browser/login/templates/insufficient_privileges.pt\n@@ -29,4 +29,5 @@\n       </div>\n \n    </metal:content>\n-</html>\n+</body>\n+</html>\n\\ No newline at end of file\ndiff --git a/Products/CMFPlone/browser/templates/author.pt b/Products/CMFPlone/browser/templates/author.pt\nindex cded443192..19cd4b0d6e 100644\n--- a/Products/CMFPlone/browser/templates/author.pt\n+++ b/Products/CMFPlone/browser/templates/author.pt\n@@ -78,11 +78,11 @@\n                 </h1>\n \n                 <div class="autotabs" tal:omit-tag="not:isOwner">\n-                  <nav class="autotoc-nav" tal:condition="isOwner">\n-                    <a class="active"\n+                  <nav class="autotoc-nav nav nav-tabs" tal:condition="isOwner">\n+                    <a class="nav-link active"\n                        href="${portal_url}/author/${view/member_info/url}"\n                        i18n:translate="label_view">View</a>\n-                    <a href="${portal_url}/@@personal-information"\n+                    <a class="nav-link" href="${portal_url}/@@personal-information"\n                        i18n:translate="label_edit">Edit</a>\n                   </nav>\n \n@@ -192,7 +192,7 @@\n                           </h2>\n \n                           <div metal:define-macro="user_content_listing">\n-                          <table class="vertical listing"\n+                          <table class="table"\n                                  summary="Lists content written by an author grouped by content type"\n                                  i18n:attributes="summary summary_author_content_list;">\n                               <thead>\ndiff --git a/README.rst b/README.rst\nindex 4638a5788f..85245e5725 100644\n--- a/README.rst\n+++ b/README.rst\n@@ -3,7 +3,7 @@ About Plone\n \n Plone is a mature, secure and user-friendly Content Management System (CMS).\n \n-Plone - and the Open Source community behind it - aggregates more than 15 years experience in content management.\n+Plone - and the Open Source community behind it - aggregates more than 20 years experience in content management.\n It offers all major features expected by a modern CMS out-of-the-box.\n \n Lots of customizations can be made trough-the-web, such as creating content types, themes, workflows and much more.\n@@ -90,7 +90,6 @@ files, etc.\n \n Official Resources\n ------------------\n-* `plone.com <https://plone.com/>`_ - Official website for decision makers and evaluators.\n * `plone.org <https://plone.org/>`_ - Official website for developers and community.\n * `Plone support <https://plone.org/support>`_ - Where to find help.\n * `community.plone.org <https://community.plone.org/>`_ - Official community forum, the best place to get help.\n@@ -98,5 +97,5 @@ Official Resources\n * `training.plone.org <https://training.plone.org/>`_ - Training classes for developers/integrators/users/designers.\n * `plone.api <https://docs.plone.org/develop/plone.api/docs/index.html>`_ - Documentation for plone.api.\n * `plone.restapi <https://plonerestapi.readthedocs.io/en/latest/>`_ - Documentation for plone.restapi.\n-* `official Gitter chat <https://gitter.im/plone/public>`_ - monitored.\n+* `official Discord chat <https://discord.gg/w8e5WCAKGs>`_ - Join link.\n \ndiff --git a/news/3290.bugfix b/news/3290.bugfix\nnew file mode 100644\nindex 0000000000..4c7d673144\n--- /dev/null\n+++ b/news/3290.bugfix\n@@ -0,0 +1,2 @@\n+Make author template barceloneta/bs5 ready. Add some CSS classes to Markup. \n+[1letter]\n\\ No newline at end of file\ndiff --git a/news/3374.bugfix b/news/3374.bugfix\nnew file mode 100644\nindex 0000000000..3324da5bf3\n--- /dev/null\n+++ b/news/3374.bugfix\n@@ -0,0 +1,2 @@\n+Fix missing closing BODY tag in insufficient_privileges.pt\n+[1letter]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-02-19T18:40:38+01:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/6d2271577aa5f717766ec062b29134d11cbb0c6d

Update relations_inspect Template

- add absolute portal urls to links and action

Files changed:
M Products/CMFPlone/controlpanel/browser/relations_inspect.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/relations_inspect.pt b/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\nindex e2eed85065..c1601d78e0 100644\n--- a/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\n+++ b/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\n@@ -41,10 +41,10 @@\n            class="portalMessage warning alert alert-warning" role="alert"\n            i18n:translate="">\n              <strong>Warning!</strong> You have broken relations!\n-             You can <a href="@@rebuild-relations">inspect and rebuild all relations</a>.\n+             You can <a href="${portal_url}/@@rebuild-relations">inspect and rebuild all relations</a>.\n       </div>\n \n-      <form id="relationinfo" method="post" action="@@inspect-relations" enctype="multipart/form-data">\n+      <form id="relationinfo" method="post" action="${portal_url}/@@inspect-relations" enctype="multipart/form-data">\n \n         <div class="mb-3 field">\n           <select class="form-select" i18n:attributes="aria-label label_default_select_example" aria-label="Default select example" name="relation" id="relation">\n@@ -123,7 +123,7 @@\n         </tbody>\n       </table>\n \n-      <p><a href="@@rebuild-relations" i18n:translate="">Inspect and rebuild all relations</a>.</p>\n+      <p><a href="${portal_url}/@@rebuild-relations" i18n:translate="">Inspect and rebuild all relations</a>.</p>\n \n     </div>\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-02-19T18:41:08+01:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/074059e229c2b34bb746ff0d7bca9d448a7afc1e

Add Test RelationsControlPanelFunctionalTest

- check correct rendering of links

Files changed:
A Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_relations.py

b'diff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_relations.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_relations.py\nnew file mode 100644\nindex 0000000000..a99d71950a\n--- /dev/null\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_relations.py\n@@ -0,0 +1,74 @@\n+import unittest\n+\n+from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n+from plone.testing.zope import Browser\n+from Products.CMFPlone.testing import PRODUCTS_CMFPLONE_FUNCTIONAL_TESTING\n+\n+\n+class RelationsControlPanelFunctionalTest(unittest.TestCase):\n+    """Test that links and actions in controlpanel starts with to absolute portal url."""\n+\n+    layer = PRODUCTS_CMFPLONE_FUNCTIONAL_TESTING\n+\n+    def _add_broken_relation(self):\n+        import transaction\n+        from persistent.list import PersistentList\n+        from z3c.relationfield import RelationValue\n+        from zope.component import getUtility\n+        from zope.intid.interfaces import IIntIds\n+        from zope.lifecycleevent import modified\n+\n+        self.portal.invokeFactory("Document", id="doc1", title="doc1")\n+        doc1 = self.portal["doc1"]\n+        self.portal.invokeFactory("Document", id="doc2", title="doc2")\n+        doc2 = self.portal["doc2"]\n+\n+        intids = getUtility(IIntIds)\n+        doc1.relatedItems = PersistentList()\n+        doc1.relatedItems.append(RelationValue(intids.getId(doc2)))\n+        modified(doc1)\n+        self.portal._delObject("doc2")\n+        transaction.commit()\n+\n+    def setUp(self):\n+        self.app = self.layer["app"]\n+        self.portal = self.layer["portal"]\n+        self.portal_url = self.portal.absolute_url()\n+        self.browser = Browser(self.app)\n+        self.browser.handleErrors = False\n+        self.browser.addHeader(\n+            "Authorization", f"Basic {SITE_OWNER_NAME}:{SITE_OWNER_PASSWORD}"\n+        )\n+\n+    def test_inspect_realtions_form_action(self):\n+        from io import StringIO\n+\n+        from lxml import etree\n+\n+        self.browser.open(f"{self.portal_url}/@@inspect-relations")\n+        tree = etree.parse(StringIO(self.browser.contents), etree.HTMLParser())\n+        action_url = tree.xpath("//form[@id=\'relationinfo\']/@action")[0]\n+        self.assertTrue(\n+            action_url.startswith(self.portal_url),\n+            "URL in relationinfo form should start with portal url",\n+        )\n+\n+    def test_rebuild_relations_links(self):\n+        from io import StringIO\n+\n+        from lxml import etree\n+\n+        # first we need a broken relation\n+        # for conditional rendering alert panel in controlpanel\n+        self._add_broken_relation()\n+\n+        self.browser.open(f"{self.portal_url}/@@inspect-relations")\n+        tree = etree.parse(StringIO(self.browser.contents), etree.HTMLParser())\n+        hrefs = tree.xpath(\n+            "//div[@id=\'content-core\']//a[contains(@href, \'@@rebuild-relations\')]/@href"\n+        )\n+        for href in hrefs:\n+            self.assertTrue(\n+                href.startswith(self.portal_url),\n+                "URL in Link should start with portal url",\n+            )\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-02-19T18:41:25+01:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/0dcd1707c2bc085f87ad5fbf4088a0096f9ab506

Update Towncrier Message

Files changed:
M news/3322.bugfix

b'diff --git a/news/3322.bugfix b/news/3322.bugfix\nindex f082569004..80d2748229 100644\n--- a/news/3322.bugfix\n+++ b/news/3322.bugfix\n@@ -1,2 +1,4 @@\n Fix broken link in the RelationsInspectControlpanel\n+prepend absolute portal url to links\n+add RelationsControlPanelFunctionalTest\n [1letter]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-02-19T19:53:58+01:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/c42578a04a77b8a719b49b847a4da6e03b1c0be3

Merge pull request #3438 from plone/1letter/issue3322

Fix broken link

Files changed:
A Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_relations.py
A news/3322.bugfix
M Products/CMFPlone/controlpanel/browser/relations_inspect.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/relations_inspect.pt b/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\nindex 36337a68d4..c1601d78e0 100644\n--- a/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\n+++ b/Products/CMFPlone/controlpanel/browser/relations_inspect.pt\n@@ -41,10 +41,10 @@\n            class="portalMessage warning alert alert-warning" role="alert"\n            i18n:translate="">\n              <strong>Warning!</strong> You have broken relations!\n-             You can <a href="@@rebuild_relations">inspect and rebuild all relations</a>.\n+             You can <a href="${portal_url}/@@rebuild-relations">inspect and rebuild all relations</a>.\n       </div>\n \n-      <form id="relationinfo" method="post" action="@@inspect-relations" enctype="multipart/form-data">\n+      <form id="relationinfo" method="post" action="${portal_url}/@@inspect-relations" enctype="multipart/form-data">\n \n         <div class="mb-3 field">\n           <select class="form-select" i18n:attributes="aria-label label_default_select_example" aria-label="Default select example" name="relation" id="relation">\n@@ -123,7 +123,7 @@\n         </tbody>\n       </table>\n \n-      <p><a href="@@rebuild-relations" i18n:translate="">Inspect and rebuild all relations</a>.</p>\n+      <p><a href="${portal_url}/@@rebuild-relations" i18n:translate="">Inspect and rebuild all relations</a>.</p>\n \n     </div>\n \ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_relations.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_relations.py\nnew file mode 100644\nindex 0000000000..a99d71950a\n--- /dev/null\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_relations.py\n@@ -0,0 +1,74 @@\n+import unittest\n+\n+from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n+from plone.testing.zope import Browser\n+from Products.CMFPlone.testing import PRODUCTS_CMFPLONE_FUNCTIONAL_TESTING\n+\n+\n+class RelationsControlPanelFunctionalTest(unittest.TestCase):\n+    """Test that links and actions in controlpanel starts with to absolute portal url."""\n+\n+    layer = PRODUCTS_CMFPLONE_FUNCTIONAL_TESTING\n+\n+    def _add_broken_relation(self):\n+        import transaction\n+        from persistent.list import PersistentList\n+        from z3c.relationfield import RelationValue\n+        from zope.component import getUtility\n+        from zope.intid.interfaces import IIntIds\n+        from zope.lifecycleevent import modified\n+\n+        self.portal.invokeFactory("Document", id="doc1", title="doc1")\n+        doc1 = self.portal["doc1"]\n+        self.portal.invokeFactory("Document", id="doc2", title="doc2")\n+        doc2 = self.portal["doc2"]\n+\n+        intids = getUtility(IIntIds)\n+        doc1.relatedItems = PersistentList()\n+        doc1.relatedItems.append(RelationValue(intids.getId(doc2)))\n+        modified(doc1)\n+        self.portal._delObject("doc2")\n+        transaction.commit()\n+\n+    def setUp(self):\n+        self.app = self.layer["app"]\n+        self.portal = self.layer["portal"]\n+        self.portal_url = self.portal.absolute_url()\n+        self.browser = Browser(self.app)\n+        self.browser.handleErrors = False\n+        self.browser.addHeader(\n+            "Authorization", f"Basic {SITE_OWNER_NAME}:{SITE_OWNER_PASSWORD}"\n+        )\n+\n+    def test_inspect_realtions_form_action(self):\n+        from io import StringIO\n+\n+        from lxml import etree\n+\n+        self.browser.open(f"{self.portal_url}/@@inspect-relations")\n+        tree = etree.parse(StringIO(self.browser.contents), etree.HTMLParser())\n+        action_url = tree.xpath("//form[@id=\'relationinfo\']/@action")[0]\n+        self.assertTrue(\n+            action_url.startswith(self.portal_url),\n+            "URL in relationinfo form should start with portal url",\n+        )\n+\n+    def test_rebuild_relations_links(self):\n+        from io import StringIO\n+\n+        from lxml import etree\n+\n+        # first we need a broken relation\n+        # for conditional rendering alert panel in controlpanel\n+        self._add_broken_relation()\n+\n+        self.browser.open(f"{self.portal_url}/@@inspect-relations")\n+        tree = etree.parse(StringIO(self.browser.contents), etree.HTMLParser())\n+        hrefs = tree.xpath(\n+            "//div[@id=\'content-core\']//a[contains(@href, \'@@rebuild-relations\')]/@href"\n+        )\n+        for href in hrefs:\n+            self.assertTrue(\n+                href.startswith(self.portal_url),\n+                "URL in Link should start with portal url",\n+            )\ndiff --git a/news/3322.bugfix b/news/3322.bugfix\nnew file mode 100644\nindex 0000000000..80d2748229\n--- /dev/null\n+++ b/news/3322.bugfix\n@@ -0,0 +1,4 @@\n+Fix broken link in the RelationsInspectControlpanel\n+prepend absolute portal url to links\n+add RelationsControlPanelFunctionalTest\n+[1letter]\n\\ No newline at end of file\n'

