Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2022-12-12T05:01:43+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.dexterity/commit/5a0febbb3bb297b227960efa1a286c3d87cd291d

Modeleditor: Don't double escape the xml.

Use the page template's structure keyword when inserting the escaped HTML into
the modeleditor's textarea. This allows the source code pattern to properly
parse and display the XML for editing.

Fixes: #357

Files changed:
A news/358.bugfix
M plone/app/dexterity/browser/modeleditor.pt

b'diff --git a/news/358.bugfix b/news/358.bugfix\nnew file mode 100644\nindex 00000000..8d7577e8\n--- /dev/null\n+++ b/news/358.bugfix\n@@ -0,0 +1,7 @@\n+Modeleditor: Don\'t double escape the xml.\n+\n+Use the page template\'s structure keyword when inserting the escaped HTML into\n+the modeleditor\'s textarea. This allows the source code pattern to properly\n+parse and display the XML for editing.\n+\n+Fixes: #357\ndiff --git a/plone/app/dexterity/browser/modeleditor.pt b/plone/app/dexterity/browser/modeleditor.pt\nindex fa191afe..ad1e2202 100644\n--- a/plone/app/dexterity/browser/modeleditor.pt\n+++ b/plone/app/dexterity/browser/modeleditor.pt\n@@ -44,8 +44,8 @@\n \n       <textarea\n           name="source"\n-          class="modeleditor__source pat-code-editor"\n-          data-pat-code-editor="language: xml; theme: okaidia">${view/escaped_model_source}</textarea>\n+          class="modeleditor__source pat-code-editor language-xml"\n+          tal:content="structure view/escaped_model_source"></textarea>\n \n       <br />\n       \n'

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2022-12-12T10:15:43+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/077775eafec337b67e3a6a993f4a7dade07435b5

fix tests

Files changed:
M plone/app/dexterity/tests/editing.rst

b'diff --git a/plone/app/dexterity/tests/editing.rst b/plone/app/dexterity/tests/editing.rst\nindex 91f5466..514f665 100644\n--- a/plone/app/dexterity/tests/editing.rst\n+++ b/plone/app/dexterity/tests/editing.rst\n@@ -173,15 +173,12 @@ Go there and find the XML model source in a textarea, ready to be edited\n   >>> \'<textarea name="source"\' in browser.contents\n   True\n \n-  >>> \'&amp;lt;schema&amp;gt;\' in browser.contents\n+  >>> \'&lt;schema&gt;\' in browser.contents\n   True\n \n   >>> model_source = portal.portal_types.plonista.model_source\n   >>> escaped_model_source = escape(model_source, quote=False)\n   >>> escaped_model_source in browser.contents\n-  False\n-  >>> again_escaped_model_source = escape(escaped_model_source, quote=False)\n-  >>> again_escaped_model_source in browser.contents\n   True\n \n There should be an authenticator in the `save` form::\n'

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2022-12-12T11:37:12+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.dexterity/commit/caeeaff8097a27a3095a3ece138cc10bda01378c

Merge pull request #358 from plone/fix-model-editor-display

Modeleditor: Don't double escape the xml.

Files changed:
A news/358.bugfix
M plone/app/dexterity/browser/modeleditor.pt
M plone/app/dexterity/tests/editing.rst

b'diff --git a/news/358.bugfix b/news/358.bugfix\nnew file mode 100644\nindex 00000000..8d7577e8\n--- /dev/null\n+++ b/news/358.bugfix\n@@ -0,0 +1,7 @@\n+Modeleditor: Don\'t double escape the xml.\n+\n+Use the page template\'s structure keyword when inserting the escaped HTML into\n+the modeleditor\'s textarea. This allows the source code pattern to properly\n+parse and display the XML for editing.\n+\n+Fixes: #357\ndiff --git a/plone/app/dexterity/browser/modeleditor.pt b/plone/app/dexterity/browser/modeleditor.pt\nindex fa191afe..ad1e2202 100644\n--- a/plone/app/dexterity/browser/modeleditor.pt\n+++ b/plone/app/dexterity/browser/modeleditor.pt\n@@ -44,8 +44,8 @@\n \n       <textarea\n           name="source"\n-          class="modeleditor__source pat-code-editor"\n-          data-pat-code-editor="language: xml; theme: okaidia">${view/escaped_model_source}</textarea>\n+          class="modeleditor__source pat-code-editor language-xml"\n+          tal:content="structure view/escaped_model_source"></textarea>\n \n       <br />\n       \ndiff --git a/plone/app/dexterity/tests/editing.rst b/plone/app/dexterity/tests/editing.rst\nindex 91f5466d..514f6650 100644\n--- a/plone/app/dexterity/tests/editing.rst\n+++ b/plone/app/dexterity/tests/editing.rst\n@@ -173,15 +173,12 @@ Go there and find the XML model source in a textarea, ready to be edited\n   >>> \'<textarea name="source"\' in browser.contents\n   True\n \n-  >>> \'&amp;lt;schema&amp;gt;\' in browser.contents\n+  >>> \'&lt;schema&gt;\' in browser.contents\n   True\n \n   >>> model_source = portal.portal_types.plonista.model_source\n   >>> escaped_model_source = escape(model_source, quote=False)\n   >>> escaped_model_source in browser.contents\n-  False\n-  >>> again_escaped_model_source = escape(escaped_model_source, quote=False)\n-  >>> again_escaped_model_source in browser.contents\n   True\n \n There should be an authenticator in the `save` form::\n'

