Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2017-01-26T14:45:32+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.dexterity/commit/d1033426dce1562609fc2200a66da3e517910d35

Do not remove newlines in description setter
When setting the Description field, do not remove new lines but keep the input as-is.
Instead remove new lines in the plone.dexterity ``Description`` metadata accessor.

Files changed:
M CHANGES.rst
M plone/app/dexterity/behaviors/metadata.py
M plone/app/dexterity/behaviors/tests/test_metadata.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 69b874c..29dfef0 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,12 +1,14 @@
 Changelog
 =========
 
-2.3.7 (unreleased)
+2.4.0 (unreleased)
 ------------------
 
 Breaking changes:
 
-- *add item here*
+- When setting the Description field, do not remove new lines but keep the input as-is.
+  Instead remove new lines in the plone.dexterity ``Description`` metadata accessor.
+  [thet]
 
 New features:
 
diff --git a/plone/app/dexterity/behaviors/metadata.py b/plone/app/dexterity/behaviors/metadata.py
index 75ab54a..08a1542 100644
--- a/plone/app/dexterity/behaviors/metadata.py
+++ b/plone/app/dexterity/behaviors/metadata.py
@@ -365,12 +365,6 @@ def _set_description(self, value):
         if isinstance(value, str):
             raise ValueError('Description must be unicode.')
 
-        # If description is containing linefeeds the HTML
-        # validation can break.
-        # See http://bo.geekworld.dk/diazo-bug-on-html5-validation-errors/
-        # Remember: \r\n - Windows, \r - OS X, \n - Linux/Unix
-        value = value.replace('\r\n', ' ').replace('\r', ' ').replace('\n', ' ')  # noqa
-
         self.context.description = value
 
     description = property(_get_description, _set_description)
diff --git a/plone/app/dexterity/behaviors/tests/test_metadata.py b/plone/app/dexterity/behaviors/tests/test_metadata.py
index 207b27b..9ef01ee 100644
--- a/plone/app/dexterity/behaviors/tests/test_metadata.py
+++ b/plone/app/dexterity/behaviors/tests/test_metadata.py
@@ -39,6 +39,11 @@ def test_description_getter(self):
         b.context.description = u'foo'
         self.assertEqual(u'foo', b.description)
 
+    def test_description_remains_newlines(self):
+        b = self._makeOne()
+        b.description = u'foo\r\nbar\nbaz\r'
+        self.assertEqual(u'foo\r\nbar\nbaz\r', b.context.description)
+
 
 class TestCategorization(unittest.TestCase):
 
diff --git a/setup.py b/setup.py
index fc077c0..3371d15 100644
--- a/setup.py
+++ b/setup.py
@@ -3,7 +3,7 @@
 from setuptools import setup
 
 
-version = '2.3.7.dev0'
+version = '2.4.0.dev0'
 
 short_description = (
     'Dexterity is a content type framework for CMF  applications, '


Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2017-01-26T14:53:42+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/50c4f7e67f50ba39db71f83fb2fe32aa0bb914c3

Merge pull request #234 from plone/thet-descnewlines

Do not remove newlines in description setter

Files changed:
M CHANGES.rst
M plone/app/dexterity/behaviors/metadata.py
M plone/app/dexterity/behaviors/tests/test_metadata.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 69b874c..29dfef0 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,12 +1,14 @@
 Changelog
 =========
 
-2.3.7 (unreleased)
+2.4.0 (unreleased)
 ------------------
 
 Breaking changes:
 
-- *add item here*
+- When setting the Description field, do not remove new lines but keep the input as-is.
+  Instead remove new lines in the plone.dexterity ``Description`` metadata accessor.
+  [thet]
 
 New features:
 
diff --git a/plone/app/dexterity/behaviors/metadata.py b/plone/app/dexterity/behaviors/metadata.py
index 75ab54a..08a1542 100644
--- a/plone/app/dexterity/behaviors/metadata.py
+++ b/plone/app/dexterity/behaviors/metadata.py
@@ -365,12 +365,6 @@ def _set_description(self, value):
         if isinstance(value, str):
             raise ValueError('Description must be unicode.')
 
-        # If description is containing linefeeds the HTML
-        # validation can break.
-        # See http://bo.geekworld.dk/diazo-bug-on-html5-validation-errors/
-        # Remember: \r\n - Windows, \r - OS X, \n - Linux/Unix
-        value = value.replace('\r\n', ' ').replace('\r', ' ').replace('\n', ' ')  # noqa
-
         self.context.description = value
 
     description = property(_get_description, _set_description)
diff --git a/plone/app/dexterity/behaviors/tests/test_metadata.py b/plone/app/dexterity/behaviors/tests/test_metadata.py
index 207b27b..9ef01ee 100644
--- a/plone/app/dexterity/behaviors/tests/test_metadata.py
+++ b/plone/app/dexterity/behaviors/tests/test_metadata.py
@@ -39,6 +39,11 @@ def test_description_getter(self):
         b.context.description = u'foo'
         self.assertEqual(u'foo', b.description)
 
+    def test_description_remains_newlines(self):
+        b = self._makeOne()
+        b.description = u'foo\r\nbar\nbaz\r'
+        self.assertEqual(u'foo\r\nbar\nbaz\r', b.context.description)
+
 
 class TestCategorization(unittest.TestCase):
 
diff --git a/setup.py b/setup.py
index fc077c0..3371d15 100644
--- a/setup.py
+++ b/setup.py
@@ -3,7 +3,7 @@
 from setuptools import setup
 
 
-version = '2.3.7.dev0'
+version = '2.4.0.dev0'
 
 short_description = (
     'Dexterity is a content type framework for CMF  applications, '


