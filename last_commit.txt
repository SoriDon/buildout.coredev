Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-12-30T11:21:41+01:00
Author: Jan Mevissen (jmevissen) <mevissen@interaktiv.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/928fc03ad770ed1e779fae901ba27df3c3f18f29

ref #3241 nicer error log form

Files changed:
M Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt b/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\nindex 4a6f2cc652..3e78e12123 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\n+++ b/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\n@@ -10,172 +10,172 @@\n \n <metal:main fill-slot="prefs_configlet_main">\n \n-    <h1 class="documentFirstHeading"\n-        i18n:translate="heading_error_log">Error log</h1>\n-\n-    <div class="documentDescription" i18n:translate="description_error_log_setup">\n+    <header>\n+      <h1 i18n:translate="heading_error_log">Error log</h1>\n+      <p class="lead" i18n:translate="description_error_log_setup">\n         This page lists the exceptions that have occurred in this site\n         recently. You can configure how many exceptions should be kept\n         and whether the exceptions should be copied to Zope\'s event log\n         file(s).\n-    </div>\n+      </p>\n+      <p class="discreet">\n+        <a href="https://docs.plone.org/appendices/error-reference.html"\n+           i18n:translate="description_error_rerference_link">\n+          Refer to the plone.org error reference for more information about\n+          these exceptions.\n+        </a>\n+      </p>\n+    </header>\n \n     <div id="content-core">\n-\n-        <p>\n-            <a href="https://docs.plone.org/appendices/error-reference.html"\n-               i18n:translate="description_error_rerference_link">\n-                Refer to the plone.org error reference for more information about\n-                these exceptions.\n-            </a>\n-        </p>\n-\n-        <form action="prefs_error_log_update" method="get">\n-\n-            <fieldset tal:define="entries context/error_log/getLogEntries">\n-\n-                <legend i18n:translate="legend_logexception">Exception Log (most recent first)</legend>\n-\n-                <div class="field">\n-                    <label for="search_entry"\n-                           i18n:translate="label_search_entry">Search for an error log entry <span class="formHelp"> (such as "1257962690.640.49636048561")</span></label>\n-\n-                    <input type="text"\n-                           name="search_entry"\n-                           id="search_entry"\n-                           size="35" />\n-                </div>\n-\n-                <div class="field" tal:condition="not:entries" i18n:translate="legend_lognoexceptions">\n-                    No exceptions logged.\n-                </div>\n-\n-                <div class="formControls">\n-                    <input class="btn btn-primary"\n-                           type="submit"\n-                           name="form.button.search"\n-                           value="Search"\n-                           i18n:attributes="value label_search;" />\n-                    <input class="btn btn-secondary"\n-                           type="submit"\n-                           name="form.button.refresh"\n-                           value="Refresh"\n-                           i18n:attributes="value label_refresh;" />\n-                    <input class="btn btn-secondary"\n-                           type="submit"\n-                           name="form.button.clear"\n-                           value="Clear Displayed Entries"\n-                           i18n:attributes="value label_clear_displayed_entries;" />\n-                    <input class="btn btn-secondary"\n-                           type="submit"\n-                           name="form.button.showall"\n-                           value="Show all entries"\n-                           i18n:attributes="value label_show_all_entries;" />\n-                </div>\n-\n-                <table class="listing"\n-                       id="sortable"\n-                       summary="Exception Log (most recent first)"\n-                       i18n:attributes="summary summary_exception_log;"\n-                       tal:condition="entries">\n-                    <thead>\n-                        <tr>\n-                            <th i18n:translate="label_time">Time</th>\n-                            <th i18n:translate="label_user_name">User Name</th>\n-                            <th i18n:translate="label_exception">Exception</th>\n-                        </tr>\n-                    </thead>\n-\n-                    <tbody tal:define="member context/@@plone_portal_state/member;\n-                                       updatetime python:member.getProperty(\'error_log_update\', 0.0);\n-                                       updatetime python:updatetime and updatetime or 0.0;\n-                                       updatetime python:float(updatetime)">\n-\n-                        <tal:entry tal:repeat="entry entries">\n-                        <tr tal:define="oddrow repeat/entry/odd;"\n-                            tal:attributes="class python: oddrow and \'odd\' or \'even\'"\n-                            tal:condition="python: entry[\'time\'] > updatetime">\n-\n-                            <td\n-                                tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;"\n-                                tal:content="python:toLocalizedTime(entry[\'time\'], long_format=True)">13:04:41</td>\n-                            <td tal:content="string:${entry/username} (${entry/userid})">joe</td>\n-                            <td>\n-                                <a href="showEntry"\n-                                   tal:attributes="href string:prefs_error_log_showEntry?id=${entry/id}">\n-                                    <span tal:replace="entry/type">AttributeError</span>:\n-                                    <span tal:define="value entry/value"\n-                                          tal:content="python: len(value) &lt; 70 and value or value[:70] + \'...\'">\n-                                    Application object has no attribute "gak"\n-                                    </span>\n-                                </a>\n-                            </td>\n-                        </tr>\n-                        </tal:entry>\n-                    </tbody>\n-                </table>\n-\n-            </fieldset>\n+      <div id="layout-contents">\n+\n+        <form class="mb-4" action="prefs_error_log_update" method="get">\n+          <fieldset class="mb-3" tal:define="entries context/error_log/getLogEntries">\n+            <div class="field" tal:condition="not:entries" i18n:translate="legend_lognoexceptions">\n+              No exceptions logged.\n+            </div>\n+\n+            <table class="table table-responsive table-bordered table-striped" tal:condition="entries">\n+              <caption i18n:translate="summary_exception_log">Exception Log (most recent first)</caption>\n+\n+              <thead>\n+                <tr>\n+                  <th i18n:translate="label_time">Time</th>\n+                  <th i18n:translate="label_user_name">User Name</th>\n+                  <th i18n:translate="label_exception">Exception</th>\n+                </tr>\n+              </thead>\n+\n+              <tbody tal:define="member context/@@plone_portal_state/member;\n+                                 updatetime python:member.getProperty(\'error_log_update\', 0.0);\n+                                 updatetime python:updatetime and updatetime or 0.0;\n+                                 updatetime python:float(updatetime)">\n+\n+                <tal:entry tal:repeat="entry entries">\n+                  <tr tal:define="oddrow repeat/entry/odd;"\n+                      tal:attributes="class python: oddrow and \'odd\' or \'even\'"\n+                      tal:condition="python: entry[\'time\'] > updatetime">\n+\n+                    <td tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;"\n+                        tal:content="python:toLocalizedTime(entry[\'time\'], long_format=True)">13:04:41</td>\n+                    <td tal:content="string:${entry/username} (${entry/userid})">joe</td>\n+                    <td>\n+                      <a href="showEntry"\n+                         tal:attributes="href string:prefs_error_log_showEntry?id=${entry/id}">\n+                        <span tal:replace="entry/type">AttributeError</span>:\n+                        <span tal:define="value entry/value"\n+                              tal:content="python: len(value) &lt; 70 and value or value[:70] + \'...\'">\n+                          Application object has no attribute "gak"\n+                        </span>\n+                      </a>\n+                    </td>\n+                  </tr>\n+                </tal:entry>\n+              </tbody>\n+            </table>\n+\n+            <div class="formControls">\n+              <input class="btn btn-secondary"\n+                     type="submit"\n+                     name="form.button.refresh"\n+                     value="Refresh"\n+                     i18n:attributes="value label_refresh;" />\n+              <input class="btn btn-secondary"\n+                     type="submit"\n+                     name="form.button.clear"\n+                     value="Clear Displayed Entries"\n+                     i18n:attributes="value label_clear_displayed_entries;" />\n+              <input class="btn btn-secondary"\n+                     type="submit"\n+                     name="form.button.showall"\n+                     value="Show all entries"\n+                     i18n:attributes="value label_show_all_entries;" />\n+            </div>\n+\n+          </fieldset>\n         </form>\n \n-        <form action="prefs_error_log_setProperties"\n-              method="post"\n-              class="pat-formunloadalert">\n-\n-            <fieldset tal:define="props context/error_log/getProperties">\n-\n-                <legend i18n:translate="legend_logdetails">Log details</legend>\n-\n-                <div class="field">\n-                    <label for="keep_entries"\n-                           i18n:translate="label_number_exceptions">Number of exceptions to keep</label>\n-\n-                    <div></div>\n-\n-                    <input type="text"\n-                           name="keep_entries"\n-                           id="keep_entries"\n-                           size="40"\n-                           tal:attributes="value props/keep_entries" />\n-                </div>\n-\n-                <div class="field">\n-                    <input type="checkbox"\n-                           class="noborder"\n-                           id="cb_copy_to_zlog"\n-                           name="copy_to_zlog"\n-                           tal:attributes="checked props/copy_to_zlog;\n-                                           disabled not:context/error_log/checkEventLogPermission|nothing" />\n-\n-                    <label for="cb_copy_to_zlog" i18n:translate="label_copy_exceptions">\n-                        Copy exceptions to the event log\n-                    </label>\n-\n-                </div>\n-\n-                <div class="field">\n-                    <label for="ignored_exceptions"\n-                           i18n:translate="label_ignored_exception">Ignored exception types</label>\n-\n-                    <br>\n-                    <textarea name="ignored_exceptions:lines"\n-                              id="ignored_exceptions"\n-                              cols="40"\n-                              rows="3"\n-                              tal:content="python: \'\\n\'.join(props[\'ignored_exceptions\'])"></textarea>\n-                </div>\n-\n-                <div class="formControls">\n-                    <input class="btn btn-primary"\n-                           type="submit"\n-                           name="submit"\n-                           value="Save"\n-                           i18n:attributes="value label_save;" />\n-                </div>\n-\n-            </fieldset>\n+        <form class="mb-4" action="prefs_error_log_update" method="get">\n+          <fieldset class="mb-3">\n+            <legend i18n:translate="label_search_entry">\n+              Search for an error log entry <span class="formHelp"> (such as "1257962690.640.49636048561")\n+            </legend>\n+\n+            <div class="mb-3 field widget-mode-input">\n+              <input type="text"\n+                     name="search_entry"\n+                     id="search_entry"\n+                     class="form-control text-widget textline-field"/>\n+            </div>\n+\n+            <div class="formControls">\n+              <input class="btn btn-primary"\n+                     type="submit"\n+                     name="form.button.search"\n+                     value="Search"\n+                     i18n:attributes="value label_search;" />\n+            </div>\n+\n+          </fieldset>\n+        </form>\n \n+        <hr />\n+\n+        <form class="mb-4" action="prefs_error_log_setProperties" method="post">\n+          <fieldset class="mb-3" tal:define="props context/error_log/getProperties">\n+\n+            <legend i18n:translate="legend_logdetails">Log details</legend>\n+\n+            <div class="mb-3 field widget-mode-input">\n+              <label class="form-label" for="keep_entries"\n+                     i18n:translate="label_number_exceptions">Number of exceptions to keep</label>\n+\n+              <input type="text"\n+                     name="keep_entries"\n+                     id="keep_entries"\n+                     class="form-control text-widget textline-field"\n+                     tal:attributes="value props/keep_entries" />\n+            </div>\n+\n+            <div class="mb-3 form-check">\n+              <input type="checkbox"\n+                     class="form-check-input single-checkbox-bool-widget bool-field"\n+                     id="cb_copy_to_zlog"\n+                     name="copy_to_zlog"\n+                     tal:attributes="checked props/copy_to_zlog;\n+                                     disabled not:context/error_log/checkEventLogPermission|nothing" />\n+\n+              <label class="form-check-label" for="cb_copy_to_zlog" i18n:translate="label_copy_exceptions">\n+                Copy exceptions to the event log\n+              </label>\n+            </div>\n+\n+            <div class="mb-3 field widget-mode-input">\n+              <label class="form-label" for="ignored_exceptions"\n+                     i18n:translate="label_ignored_exception">Ignored exception types</label>\n+\n+              <br>\n+              <textarea name="ignored_exceptions:lines"\n+                        id="ignored_exceptions"\n+                        cols="40"\n+                        rows="3"\n+                        class="form-control textarea-widget list-field"\n+                        tal:content="python: \'\\n\'.join(props[\'ignored_exceptions\'])"></textarea>\n+            </div>\n+\n+            <div class="formControls">\n+              <input class="btn btn-primary"\n+                     type="submit"\n+                     name="submit"\n+                     value="Save"\n+                     i18n:attributes="value label_save;" />\n+            </div>\n+\n+          </fieldset>\n         </form>\n+\n+      </div>\n     </div>\n \n </metal:main>\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-12-30T11:23:04+01:00
Author: Jan Mevissen (jmevissen) <mevissen@interaktiv.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/9b556740c8c82737ac382767c307a76d6a866cbd

ref #3241 remove error log table actions

Files changed:
M Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt b/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\nindex 3e78e12123..afe729c4a1 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\n+++ b/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\n@@ -75,24 +75,6 @@\n               </tbody>\n             </table>\n \n-            <div class="formControls">\n-              <input class="btn btn-secondary"\n-                     type="submit"\n-                     name="form.button.refresh"\n-                     value="Refresh"\n-                     i18n:attributes="value label_refresh;" />\n-              <input class="btn btn-secondary"\n-                     type="submit"\n-                     name="form.button.clear"\n-                     value="Clear Displayed Entries"\n-                     i18n:attributes="value label_clear_displayed_entries;" />\n-              <input class="btn btn-secondary"\n-                     type="submit"\n-                     name="form.button.showall"\n-                     value="Show all entries"\n-                     i18n:attributes="value label_show_all_entries;" />\n-            </div>\n-\n           </fieldset>\n         </form>\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-12-30T11:57:11+01:00
Author: Jan Mevissen (jmevissen) <mevissen@interaktiv.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/991292634313a3c0c559d3852e28d9cd1b33c057

ref #3241 Error Log not Exception Log

Files changed:
M Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt b/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\nindex afe729c4a1..21af898397 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\n+++ b/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\n@@ -37,7 +37,7 @@\n             </div>\n \n             <table class="table table-responsive table-bordered table-striped" tal:condition="entries">\n-              <caption i18n:translate="summary_exception_log">Exception Log (most recent first)</caption>\n+              <caption i18n:translate="summary_exception_log">Error Log (most recent first)</caption>\n \n               <thead>\n                 <tr>\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-01-06T11:34:35+01:00
Author: Jan Mevissen (jmevissen) <mevissen@interaktiv.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/e680242dfc5c0627d0cc8e08222736db604fad70

ref #3241 rename error log form views

Files changed:
A Products/CMFPlone/controlpanel/browser/error_log_form.pt
A Products/CMFPlone/controlpanel/browser/error_log_form.py
A Products/CMFPlone/controlpanel/browser/error_log_showEntry.pt
M Products/CMFPlone/controlpanel/browser/configure.zcml
M Products/CMFPlone/profiles/default/controlpanel.xml
D Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt
D Products/CMFPlone/controlpanel/browser/prefs_error_log_form.py
D Products/CMFPlone/controlpanel/browser/prefs_error_log_showEntry.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/configure.zcml b/Products/CMFPlone/controlpanel/browser/configure.zcml\nindex fa419f3c44..a45eb0b326 100644\n--- a/Products/CMFPlone/controlpanel/browser/configure.zcml\n+++ b/Products/CMFPlone/controlpanel/browser/configure.zcml\n@@ -111,32 +111,32 @@\n       permission="cmf.ManagePortal"\n       />\n \n-  <!-- Prefs Error Log Form Control Panel -->\n+  <!-- Error Log Form Control Panel -->\n   <browser:page\n-      name="prefs_error_log_form"\n+      name="error-log-form"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      template="prefs_error_log_form.pt"\n+      template="error_log_form.pt"\n       permission="cmf.ManagePortal"\n       />\n \n   <browser:page\n-      name="prefs_error_log_showEntry"\n+      name="error-log-showEntry"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      template="prefs_error_log_showEntry.pt"\n+      template="error_log_showEntry.pt"\n       permission="cmf.ManagePortal"\n       />\n \n   <browser:page\n-      name="prefs_error_log_update"\n+      name="error-log-update"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      class=".prefs_error_log_form.PrefsErrorLogUpdate"\n+      class=".error_log_form.ErrorLogUpdate"\n       permission="cmf.ManagePortal"\n       />\n \n   <browser:page\n-      name="prefs_error_log_setProperties"\n+      name="error-log-setProperties"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      class=".prefs_error_log_form.PrefsErrorLogSetProperties"\n+      class=".error_log_form.ErrorLogSetProperties"\n       permission="cmf.ManagePortal"\n       />\n \ndiff --git a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt b/Products/CMFPlone/controlpanel/browser/error_log_form.pt\nsimilarity index 95%\nrename from Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\nrename to Products/CMFPlone/controlpanel/browser/error_log_form.pt\nindex 21af898397..de78220d9b 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\n+++ b/Products/CMFPlone/controlpanel/browser/error_log_form.pt\n@@ -30,7 +30,7 @@\n     <div id="content-core">\n       <div id="layout-contents">\n \n-        <form class="mb-4" action="prefs_error_log_update" method="get">\n+        <form class="mb-4" action="@@error-log-update" method="get">\n           <fieldset class="mb-3" tal:define="entries context/error_log/getLogEntries">\n             <div class="field" tal:condition="not:entries" i18n:translate="legend_lognoexceptions">\n               No exceptions logged.\n@@ -62,7 +62,7 @@\n                     <td tal:content="string:${entry/username} (${entry/userid})">joe</td>\n                     <td>\n                       <a href="showEntry"\n-                         tal:attributes="href string:prefs_error_log_showEntry?id=${entry/id}">\n+                         tal:attributes="href string:@@error-log-showEntry?id=${entry/id}">\n                         <span tal:replace="entry/type">AttributeError</span>:\n                         <span tal:define="value entry/value"\n                               tal:content="python: len(value) &lt; 70 and value or value[:70] + \'...\'">\n@@ -78,7 +78,7 @@\n           </fieldset>\n         </form>\n \n-        <form class="mb-4" action="prefs_error_log_update" method="get">\n+        <form class="mb-4" action="@@error-log-update" method="get">\n           <fieldset class="mb-3">\n             <legend i18n:translate="label_search_entry">\n               Search for an error log entry <span class="formHelp"> (such as "1257962690.640.49636048561")\n@@ -104,7 +104,7 @@\n \n         <hr />\n \n-        <form class="mb-4" action="prefs_error_log_setProperties" method="post">\n+        <form class="mb-4" action="@@error-log-setProperties" method="post">\n           <fieldset class="mb-3" tal:define="props context/error_log/getProperties">\n \n             <legend i18n:translate="legend_logdetails">Log details</legend>\ndiff --git a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.py b/Products/CMFPlone/controlpanel/browser/error_log_form.py\nsimilarity index 81%\nrename from Products/CMFPlone/controlpanel/browser/prefs_error_log_form.py\nrename to Products/CMFPlone/controlpanel/browser/error_log_form.py\nindex d73f68cbd5..cdc5e20474 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.py\n+++ b/Products/CMFPlone/controlpanel/browser/error_log_form.py\n@@ -3,10 +3,9 @@\n from Products.CMFPlone import PloneMessageFactory as _\n from Products.CMFPlone.utils import safe_nativestring\n from Products.Five import BrowserView\n-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n \n \n-class PrefsErrorLogUpdate(BrowserView):\n+class ErrorLogUpdate(BrowserView):\n \n     def __call__(self):\n         member = api.user.get_current()\n@@ -16,24 +15,24 @@ def __call__(self):\n             if search == \'\':\n                 member.setProperties(error_log_update=0.0)\n                 self.context.plone_utils.addPortalMessage(_(\'Showing all entries\'))\n-                return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_form\')\n-            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_showEntry?id=%s\' % search)\n+                return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-form\')\n+            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-showEntry?id=%s\' % search)\n \n         elif getattr(self.request, \'form.button.showall\', None) is not None:\n             member.setProperties(error_log_update=0.0)\n             self.context.plone_utils.addPortalMessage(_(\'Showing all entries\'))\n-            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_form\')\n+            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-form\')\n \n         elif getattr(self.request, \'form.button.clear\', None) is not None:\n             member.setProperties(error_log_update=DateTime().timeTime())\n             self.context.plone_utils.addPortalMessage(_(\'Entries cleared\'))\n-            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_form\')\n+            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-form\')\n \n         else:\n-            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_form\')\n+            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-form\')\n \n \n-class PrefsErrorLogSetProperties(BrowserView):\n+class ErrorLogSetProperties(BrowserView):\n \n     def __call__(self):\n         keep_entries = self.request.form.get(\'keep_entries\')\n@@ -44,4 +43,4 @@ def __call__(self):\n         self.context.error_log.setProperties(keep_entries, copy_to_zlog, ignored_exceptions)\n         self.context.plone_utils.addPortalMessage(_(\'Changes made.\'))\n \n-        return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_form\')\n+        return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-form\')\ndiff --git a/Products/CMFPlone/controlpanel/browser/prefs_error_log_showEntry.pt b/Products/CMFPlone/controlpanel/browser/error_log_showEntry.pt\nsimilarity index 98%\nrename from Products/CMFPlone/controlpanel/browser/prefs_error_log_showEntry.pt\nrename to Products/CMFPlone/controlpanel/browser/error_log_showEntry.pt\nindex dbaa22cfff..2e89da22ba 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefs_error_log_showEntry.pt\n+++ b/Products/CMFPlone/controlpanel/browser/error_log_showEntry.pt\n@@ -20,7 +20,7 @@\n     <div id="content-core">\n         <a href=""\n            class="link-parent"\n-           tal:attributes="href string:$portal_url/prefs_error_log_form"\n+           tal:attributes="href string:$portal_url/@@error-log-form"\n            i18n:translate="label_back_to_errorlog">\n         Back to Error Log\n         </a>\ndiff --git a/Products/CMFPlone/profiles/default/controlpanel.xml b/Products/CMFPlone/profiles/default/controlpanel.xml\nindex fd652eb20b..1cf104e4b7 100644\n--- a/Products/CMFPlone/profiles/default/controlpanel.xml\n+++ b/Products/CMFPlone/profiles/default/controlpanel.xml\n@@ -88,7 +88,7 @@\n  <configlet title="Errors" action_id="errorLog" appId="ErrorLog"\n     category="plone-security" condition_expr=""\n     icon_expr="string:exclamation-square"\n-    url_expr="string:${portal_url}/prefs_error_log_form" visible="True"\n+    url_expr="string:${portal_url}/@@error-log-form" visible="True"\n     i18n:attributes="title">\n   <permission>Manage portal</permission>\n  </configlet>\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-01-06T12:08:17+01:00
Author: Jan Mevissen (jmevissen) <mevissen@interaktiv.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/0641a4c2a745e86f06b4228ffce91f77ef779493

ref #3241 rename error log form views II

Files changed:
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py
M Products/CMFPlone/tests/robot/robodoc/config-screens.robot

b'diff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\nindex 848a9e721d..52e6e15ee4 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\n@@ -41,7 +41,7 @@ def test_error_log_control_panel_link(self):\n         self.browser.open("%s/@@overview-controlpanel" % self.portal_url)\n         self.browser.getLink(\'Errors\').click()\n \n-        self.assertEqual(self.browser.url, "%s/prefs_error_log_form" % self.portal_url)\n+        self.assertEqual(self.browser.url, "%s/@@error-log-form" % self.portal_url)\n         self.assertIn(\'<h1 class="documentFirstHeading">Error log</h1>\', self.browser.contents)\n \n     def test_error_log_set_properties(self):\ndiff --git a/Products/CMFPlone/tests/robot/robodoc/config-screens.robot b/Products/CMFPlone/tests/robot/robodoc/config-screens.robot\nindex 230a0e4552..c810bec965 100644\n--- a/Products/CMFPlone/tests/robot/robodoc/config-screens.robot\n+++ b/Products/CMFPlone/tests/robot/robodoc/config-screens.robot\n@@ -78,7 +78,7 @@ Show Editing setup screen\n     ...  css=#content\n \n Show Error log setup screen\n-    Go to  ${PLONE_URL}/prefs_error_log_form\n+    Go to  ${PLONE_URL}/@@error-log-form\n     Capture and crop page screenshot\n     ...  ${CURDIR}/_robot/errorlog-setup.png\n     ...  css=#content\n@@ -213,4 +213,4 @@ Changing the logo\n     Capture and crop page screenshot\n     ...    ${CURDIR}/_robot/change-logo-in-site-control-panel.png\n     ...    css=#content\n-    ...    css=#formfield-form-widgets-site_logo\n\\ No newline at end of file\n+    ...    css=#formfield-form-widgets-site_logo\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-01-06T13:08:54+01:00
Author: Jan Mevissen (jmevissen) <mevissen@interaktiv.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/97e8b9150a02613dc8dba5fa32555b8eb2fbfd69

ref #3241 add news file

Files changed:
A news/3393.enhancement

b'diff --git a/news/3393.enhancement b/news/3393.enhancement\nnew file mode 100644\nindex 0000000000..de652bdf6c\n--- /dev/null\n+++ b/news/3393.enhancement\n@@ -0,0 +1,3 @@\n+Update Controlpanel Error Log Form Layout\n+Rename ControlPanel Error Log Form View prefs_error_log_form -> error-log-form\n+[jmevissen]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-01-06T13:20:51+01:00
Author: Jan Mevissen (jmevissen) <mevissen@interaktiv.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/62d664cf246580d90567da044126bff359c6b8ea

ref #3241 rename more error log form views

Files changed:
A Products/CMFPlone/controlpanel/browser/error_log_show_entry.pt
M Products/CMFPlone/controlpanel/browser/configure.zcml
M Products/CMFPlone/controlpanel/browser/error_log_form.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py
D Products/CMFPlone/controlpanel/browser/error_log_showEntry.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/configure.zcml b/Products/CMFPlone/controlpanel/browser/configure.zcml\nindex a45eb0b326..1204b15af6 100644\n--- a/Products/CMFPlone/controlpanel/browser/configure.zcml\n+++ b/Products/CMFPlone/controlpanel/browser/configure.zcml\n@@ -120,9 +120,9 @@\n       />\n \n   <browser:page\n-      name="error-log-showEntry"\n+      name="error-log-show-entry"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      template="error_log_showEntry.pt"\n+      template="error_log_show_entry.pt"\n       permission="cmf.ManagePortal"\n       />\n \n@@ -134,7 +134,7 @@\n       />\n \n   <browser:page\n-      name="error-log-setProperties"\n+      name="error-log-set-properties"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n       class=".error_log_form.ErrorLogSetProperties"\n       permission="cmf.ManagePortal"\ndiff --git a/Products/CMFPlone/controlpanel/browser/error_log_form.py b/Products/CMFPlone/controlpanel/browser/error_log_form.py\nindex cdc5e20474..c2d2d2f495 100644\n--- a/Products/CMFPlone/controlpanel/browser/error_log_form.py\n+++ b/Products/CMFPlone/controlpanel/browser/error_log_form.py\n@@ -16,7 +16,7 @@ def __call__(self):\n                 member.setProperties(error_log_update=0.0)\n                 self.context.plone_utils.addPortalMessage(_(\'Showing all entries\'))\n                 return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-form\')\n-            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-showEntry?id=%s\' % search)\n+            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-show-entry?id=%s\' % search)\n \n         elif getattr(self.request, \'form.button.showall\', None) is not None:\n             member.setProperties(error_log_update=0.0)\ndiff --git a/Products/CMFPlone/controlpanel/browser/error_log_showEntry.pt b/Products/CMFPlone/controlpanel/browser/error_log_show_entry.pt\nsimilarity index 100%\nrename from Products/CMFPlone/controlpanel/browser/error_log_showEntry.pt\nrename to Products/CMFPlone/controlpanel/browser/error_log_show_entry.pt\ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\nindex 52e6e15ee4..4450833285 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\n@@ -55,7 +55,7 @@ def test_error_log_set_properties(self):\n         }\n \n         set_properties_view = getMultiAdapter((self.portal, self.request),\n-                                name=\'prefs_error_log_setProperties\')\n+                                name=\'error-log-set-properties\')\n         set_properties_view()\n \n         error_log_properties = self.portal.error_log.getProperties()\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-01-06T13:22:43+01:00
Author: Jan Mevissen (jmevissen) <mevissen@interaktiv.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/e696ef5e453d4f602109ccdefcc5106a430ec927

ref #3241 rename more error log form views II

Files changed:
M Products/CMFPlone/controlpanel/browser/error_log_form.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/error_log_form.pt b/Products/CMFPlone/controlpanel/browser/error_log_form.pt\nindex de78220d9b..221df55ae8 100644\n--- a/Products/CMFPlone/controlpanel/browser/error_log_form.pt\n+++ b/Products/CMFPlone/controlpanel/browser/error_log_form.pt\n@@ -62,7 +62,7 @@\n                     <td tal:content="string:${entry/username} (${entry/userid})">joe</td>\n                     <td>\n                       <a href="showEntry"\n-                         tal:attributes="href string:@@error-log-showEntry?id=${entry/id}">\n+                         tal:attributes="href string:@@error-log-show-entry?id=${entry/id}">\n                         <span tal:replace="entry/type">AttributeError</span>:\n                         <span tal:define="value entry/value"\n                               tal:content="python: len(value) &lt; 70 and value or value[:70] + \'...\'">\n@@ -104,7 +104,7 @@\n \n         <hr />\n \n-        <form class="mb-4" action="@@error-log-setProperties" method="post">\n+        <form class="mb-4" action="@@error-log-set-properties" method="post">\n           <fieldset class="mb-3" tal:define="props context/error_log/getProperties">\n \n             <legend i18n:translate="legend_logdetails">Log details</legend>\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-01-06T15:48:21+01:00
Author: Jan Mevissen (jmevissen) <mevissen@interaktiv.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/cc00caba6c0a99a7a4013d90e5202cfcbe9de87e

ref #3241 update error log form test

Files changed:
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py

b'diff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\nindex 4450833285..ae797cd070 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\n@@ -42,7 +42,7 @@ def test_error_log_control_panel_link(self):\n         self.browser.getLink(\'Errors\').click()\n \n         self.assertEqual(self.browser.url, "%s/@@error-log-form" % self.portal_url)\n-        self.assertIn(\'<h1 class="documentFirstHeading">Error log</h1>\', self.browser.contents)\n+        self.assertIn(\'<h1>Error log</h1>\', self.browser.contents)\n \n     def test_error_log_set_properties(self):\n         self.assertEqual(self.error_log_properties[\'keep_entries\'], 20)\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-01-09T00:12:05+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/8e21587df4c7888a30b84acd9a2f7b244407fed0

Merge pull request #3393 from plone/jmevissen-3241_enhance_error_log_form

Jmevissen 3241 enhance error log form

Files changed:
A Products/CMFPlone/controlpanel/browser/error_log_form.pt
A Products/CMFPlone/controlpanel/browser/error_log_form.py
A Products/CMFPlone/controlpanel/browser/error_log_show_entry.pt
A news/3393.enhancement
M Products/CMFPlone/controlpanel/browser/configure.zcml
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py
M Products/CMFPlone/profiles/default/controlpanel.xml
M Products/CMFPlone/tests/robot/robodoc/config-screens.robot
D Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt
D Products/CMFPlone/controlpanel/browser/prefs_error_log_form.py
D Products/CMFPlone/controlpanel/browser/prefs_error_log_showEntry.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/configure.zcml b/Products/CMFPlone/controlpanel/browser/configure.zcml\nindex fa419f3c44..1204b15af6 100644\n--- a/Products/CMFPlone/controlpanel/browser/configure.zcml\n+++ b/Products/CMFPlone/controlpanel/browser/configure.zcml\n@@ -111,32 +111,32 @@\n       permission="cmf.ManagePortal"\n       />\n \n-  <!-- Prefs Error Log Form Control Panel -->\n+  <!-- Error Log Form Control Panel -->\n   <browser:page\n-      name="prefs_error_log_form"\n+      name="error-log-form"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      template="prefs_error_log_form.pt"\n+      template="error_log_form.pt"\n       permission="cmf.ManagePortal"\n       />\n \n   <browser:page\n-      name="prefs_error_log_showEntry"\n+      name="error-log-show-entry"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      template="prefs_error_log_showEntry.pt"\n+      template="error_log_show_entry.pt"\n       permission="cmf.ManagePortal"\n       />\n \n   <browser:page\n-      name="prefs_error_log_update"\n+      name="error-log-update"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      class=".prefs_error_log_form.PrefsErrorLogUpdate"\n+      class=".error_log_form.ErrorLogUpdate"\n       permission="cmf.ManagePortal"\n       />\n \n   <browser:page\n-      name="prefs_error_log_setProperties"\n+      name="error-log-set-properties"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      class=".prefs_error_log_form.PrefsErrorLogSetProperties"\n+      class=".error_log_form.ErrorLogSetProperties"\n       permission="cmf.ManagePortal"\n       />\n \ndiff --git a/Products/CMFPlone/controlpanel/browser/error_log_form.pt b/Products/CMFPlone/controlpanel/browser/error_log_form.pt\nnew file mode 100644\nindex 0000000000..221df55ae8\n--- /dev/null\n+++ b/Products/CMFPlone/controlpanel/browser/error_log_form.pt\n@@ -0,0 +1,166 @@\n+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      lang="en"\n+      metal:use-macro="context/prefs_main_template/macros/master"\n+      i18n:domain="plone">\n+\n+<body>\n+\n+<metal:main fill-slot="prefs_configlet_main">\n+\n+    <header>\n+      <h1 i18n:translate="heading_error_log">Error log</h1>\n+      <p class="lead" i18n:translate="description_error_log_setup">\n+        This page lists the exceptions that have occurred in this site\n+        recently. You can configure how many exceptions should be kept\n+        and whether the exceptions should be copied to Zope\'s event log\n+        file(s).\n+      </p>\n+      <p class="discreet">\n+        <a href="https://docs.plone.org/appendices/error-reference.html"\n+           i18n:translate="description_error_rerference_link">\n+          Refer to the plone.org error reference for more information about\n+          these exceptions.\n+        </a>\n+      </p>\n+    </header>\n+\n+    <div id="content-core">\n+      <div id="layout-contents">\n+\n+        <form class="mb-4" action="@@error-log-update" method="get">\n+          <fieldset class="mb-3" tal:define="entries context/error_log/getLogEntries">\n+            <div class="field" tal:condition="not:entries" i18n:translate="legend_lognoexceptions">\n+              No exceptions logged.\n+            </div>\n+\n+            <table class="table table-responsive table-bordered table-striped" tal:condition="entries">\n+              <caption i18n:translate="summary_exception_log">Error Log (most recent first)</caption>\n+\n+              <thead>\n+                <tr>\n+                  <th i18n:translate="label_time">Time</th>\n+                  <th i18n:translate="label_user_name">User Name</th>\n+                  <th i18n:translate="label_exception">Exception</th>\n+                </tr>\n+              </thead>\n+\n+              <tbody tal:define="member context/@@plone_portal_state/member;\n+                                 updatetime python:member.getProperty(\'error_log_update\', 0.0);\n+                                 updatetime python:updatetime and updatetime or 0.0;\n+                                 updatetime python:float(updatetime)">\n+\n+                <tal:entry tal:repeat="entry entries">\n+                  <tr tal:define="oddrow repeat/entry/odd;"\n+                      tal:attributes="class python: oddrow and \'odd\' or \'even\'"\n+                      tal:condition="python: entry[\'time\'] > updatetime">\n+\n+                    <td tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;"\n+                        tal:content="python:toLocalizedTime(entry[\'time\'], long_format=True)">13:04:41</td>\n+                    <td tal:content="string:${entry/username} (${entry/userid})">joe</td>\n+                    <td>\n+                      <a href="showEntry"\n+                         tal:attributes="href string:@@error-log-show-entry?id=${entry/id}">\n+                        <span tal:replace="entry/type">AttributeError</span>:\n+                        <span tal:define="value entry/value"\n+                              tal:content="python: len(value) &lt; 70 and value or value[:70] + \'...\'">\n+                          Application object has no attribute "gak"\n+                        </span>\n+                      </a>\n+                    </td>\n+                  </tr>\n+                </tal:entry>\n+              </tbody>\n+            </table>\n+\n+          </fieldset>\n+        </form>\n+\n+        <form class="mb-4" action="@@error-log-update" method="get">\n+          <fieldset class="mb-3">\n+            <legend i18n:translate="label_search_entry">\n+              Search for an error log entry <span class="formHelp"> (such as "1257962690.640.49636048561")\n+            </legend>\n+\n+            <div class="mb-3 field widget-mode-input">\n+              <input type="text"\n+                     name="search_entry"\n+                     id="search_entry"\n+                     class="form-control text-widget textline-field"/>\n+            </div>\n+\n+            <div class="formControls">\n+              <input class="btn btn-primary"\n+                     type="submit"\n+                     name="form.button.search"\n+                     value="Search"\n+                     i18n:attributes="value label_search;" />\n+            </div>\n+\n+          </fieldset>\n+        </form>\n+\n+        <hr />\n+\n+        <form class="mb-4" action="@@error-log-set-properties" method="post">\n+          <fieldset class="mb-3" tal:define="props context/error_log/getProperties">\n+\n+            <legend i18n:translate="legend_logdetails">Log details</legend>\n+\n+            <div class="mb-3 field widget-mode-input">\n+              <label class="form-label" for="keep_entries"\n+                     i18n:translate="label_number_exceptions">Number of exceptions to keep</label>\n+\n+              <input type="text"\n+                     name="keep_entries"\n+                     id="keep_entries"\n+                     class="form-control text-widget textline-field"\n+                     tal:attributes="value props/keep_entries" />\n+            </div>\n+\n+            <div class="mb-3 form-check">\n+              <input type="checkbox"\n+                     class="form-check-input single-checkbox-bool-widget bool-field"\n+                     id="cb_copy_to_zlog"\n+                     name="copy_to_zlog"\n+                     tal:attributes="checked props/copy_to_zlog;\n+                                     disabled not:context/error_log/checkEventLogPermission|nothing" />\n+\n+              <label class="form-check-label" for="cb_copy_to_zlog" i18n:translate="label_copy_exceptions">\n+                Copy exceptions to the event log\n+              </label>\n+            </div>\n+\n+            <div class="mb-3 field widget-mode-input">\n+              <label class="form-label" for="ignored_exceptions"\n+                     i18n:translate="label_ignored_exception">Ignored exception types</label>\n+\n+              <br>\n+              <textarea name="ignored_exceptions:lines"\n+                        id="ignored_exceptions"\n+                        cols="40"\n+                        rows="3"\n+                        class="form-control textarea-widget list-field"\n+                        tal:content="python: \'\\n\'.join(props[\'ignored_exceptions\'])"></textarea>\n+            </div>\n+\n+            <div class="formControls">\n+              <input class="btn btn-primary"\n+                     type="submit"\n+                     name="submit"\n+                     value="Save"\n+                     i18n:attributes="value label_save;" />\n+            </div>\n+\n+          </fieldset>\n+        </form>\n+\n+      </div>\n+    </div>\n+\n+</metal:main>\n+\n+</body>\n+</html>\ndiff --git a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.py b/Products/CMFPlone/controlpanel/browser/error_log_form.py\nsimilarity index 81%\nrename from Products/CMFPlone/controlpanel/browser/prefs_error_log_form.py\nrename to Products/CMFPlone/controlpanel/browser/error_log_form.py\nindex d73f68cbd5..c2d2d2f495 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.py\n+++ b/Products/CMFPlone/controlpanel/browser/error_log_form.py\n@@ -3,10 +3,9 @@\n from Products.CMFPlone import PloneMessageFactory as _\n from Products.CMFPlone.utils import safe_nativestring\n from Products.Five import BrowserView\n-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n \n \n-class PrefsErrorLogUpdate(BrowserView):\n+class ErrorLogUpdate(BrowserView):\n \n     def __call__(self):\n         member = api.user.get_current()\n@@ -16,24 +15,24 @@ def __call__(self):\n             if search == \'\':\n                 member.setProperties(error_log_update=0.0)\n                 self.context.plone_utils.addPortalMessage(_(\'Showing all entries\'))\n-                return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_form\')\n-            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_showEntry?id=%s\' % search)\n+                return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-form\')\n+            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-show-entry?id=%s\' % search)\n \n         elif getattr(self.request, \'form.button.showall\', None) is not None:\n             member.setProperties(error_log_update=0.0)\n             self.context.plone_utils.addPortalMessage(_(\'Showing all entries\'))\n-            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_form\')\n+            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-form\')\n \n         elif getattr(self.request, \'form.button.clear\', None) is not None:\n             member.setProperties(error_log_update=DateTime().timeTime())\n             self.context.plone_utils.addPortalMessage(_(\'Entries cleared\'))\n-            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_form\')\n+            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-form\')\n \n         else:\n-            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_form\')\n+            return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-form\')\n \n \n-class PrefsErrorLogSetProperties(BrowserView):\n+class ErrorLogSetProperties(BrowserView):\n \n     def __call__(self):\n         keep_entries = self.request.form.get(\'keep_entries\')\n@@ -44,4 +43,4 @@ def __call__(self):\n         self.context.error_log.setProperties(keep_entries, copy_to_zlog, ignored_exceptions)\n         self.context.plone_utils.addPortalMessage(_(\'Changes made.\'))\n \n-        return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/prefs_error_log_form\')\n+        return self.request.RESPONSE.redirect(self.context.absolute_url() + \'/@@error-log-form\')\ndiff --git a/Products/CMFPlone/controlpanel/browser/prefs_error_log_showEntry.pt b/Products/CMFPlone/controlpanel/browser/error_log_show_entry.pt\nsimilarity index 98%\nrename from Products/CMFPlone/controlpanel/browser/prefs_error_log_showEntry.pt\nrename to Products/CMFPlone/controlpanel/browser/error_log_show_entry.pt\nindex dbaa22cfff..2e89da22ba 100644\n--- a/Products/CMFPlone/controlpanel/browser/prefs_error_log_showEntry.pt\n+++ b/Products/CMFPlone/controlpanel/browser/error_log_show_entry.pt\n@@ -20,7 +20,7 @@\n     <div id="content-core">\n         <a href=""\n            class="link-parent"\n-           tal:attributes="href string:$portal_url/prefs_error_log_form"\n+           tal:attributes="href string:$portal_url/@@error-log-form"\n            i18n:translate="label_back_to_errorlog">\n         Back to Error Log\n         </a>\ndiff --git a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt b/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\ndeleted file mode 100644\nindex 4a6f2cc652..0000000000\n--- a/Products/CMFPlone/controlpanel/browser/prefs_error_log_form.pt\n+++ /dev/null\n@@ -1,184 +0,0 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      lang="en"\n-      metal:use-macro="context/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n-\n-<body>\n-\n-<metal:main fill-slot="prefs_configlet_main">\n-\n-    <h1 class="documentFirstHeading"\n-        i18n:translate="heading_error_log">Error log</h1>\n-\n-    <div class="documentDescription" i18n:translate="description_error_log_setup">\n-        This page lists the exceptions that have occurred in this site\n-        recently. You can configure how many exceptions should be kept\n-        and whether the exceptions should be copied to Zope\'s event log\n-        file(s).\n-    </div>\n-\n-    <div id="content-core">\n-\n-        <p>\n-            <a href="https://docs.plone.org/appendices/error-reference.html"\n-               i18n:translate="description_error_rerference_link">\n-                Refer to the plone.org error reference for more information about\n-                these exceptions.\n-            </a>\n-        </p>\n-\n-        <form action="prefs_error_log_update" method="get">\n-\n-            <fieldset tal:define="entries context/error_log/getLogEntries">\n-\n-                <legend i18n:translate="legend_logexception">Exception Log (most recent first)</legend>\n-\n-                <div class="field">\n-                    <label for="search_entry"\n-                           i18n:translate="label_search_entry">Search for an error log entry <span class="formHelp"> (such as "1257962690.640.49636048561")</span></label>\n-\n-                    <input type="text"\n-                           name="search_entry"\n-                           id="search_entry"\n-                           size="35" />\n-                </div>\n-\n-                <div class="field" tal:condition="not:entries" i18n:translate="legend_lognoexceptions">\n-                    No exceptions logged.\n-                </div>\n-\n-                <div class="formControls">\n-                    <input class="btn btn-primary"\n-                           type="submit"\n-                           name="form.button.search"\n-                           value="Search"\n-                           i18n:attributes="value label_search;" />\n-                    <input class="btn btn-secondary"\n-                           type="submit"\n-                           name="form.button.refresh"\n-                           value="Refresh"\n-                           i18n:attributes="value label_refresh;" />\n-                    <input class="btn btn-secondary"\n-                           type="submit"\n-                           name="form.button.clear"\n-                           value="Clear Displayed Entries"\n-                           i18n:attributes="value label_clear_displayed_entries;" />\n-                    <input class="btn btn-secondary"\n-                           type="submit"\n-                           name="form.button.showall"\n-                           value="Show all entries"\n-                           i18n:attributes="value label_show_all_entries;" />\n-                </div>\n-\n-                <table class="listing"\n-                       id="sortable"\n-                       summary="Exception Log (most recent first)"\n-                       i18n:attributes="summary summary_exception_log;"\n-                       tal:condition="entries">\n-                    <thead>\n-                        <tr>\n-                            <th i18n:translate="label_time">Time</th>\n-                            <th i18n:translate="label_user_name">User Name</th>\n-                            <th i18n:translate="label_exception">Exception</th>\n-                        </tr>\n-                    </thead>\n-\n-                    <tbody tal:define="member context/@@plone_portal_state/member;\n-                                       updatetime python:member.getProperty(\'error_log_update\', 0.0);\n-                                       updatetime python:updatetime and updatetime or 0.0;\n-                                       updatetime python:float(updatetime)">\n-\n-                        <tal:entry tal:repeat="entry entries">\n-                        <tr tal:define="oddrow repeat/entry/odd;"\n-                            tal:attributes="class python: oddrow and \'odd\' or \'even\'"\n-                            tal:condition="python: entry[\'time\'] > updatetime">\n-\n-                            <td\n-                                tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;"\n-                                tal:content="python:toLocalizedTime(entry[\'time\'], long_format=True)">13:04:41</td>\n-                            <td tal:content="string:${entry/username} (${entry/userid})">joe</td>\n-                            <td>\n-                                <a href="showEntry"\n-                                   tal:attributes="href string:prefs_error_log_showEntry?id=${entry/id}">\n-                                    <span tal:replace="entry/type">AttributeError</span>:\n-                                    <span tal:define="value entry/value"\n-                                          tal:content="python: len(value) &lt; 70 and value or value[:70] + \'...\'">\n-                                    Application object has no attribute "gak"\n-                                    </span>\n-                                </a>\n-                            </td>\n-                        </tr>\n-                        </tal:entry>\n-                    </tbody>\n-                </table>\n-\n-            </fieldset>\n-        </form>\n-\n-        <form action="prefs_error_log_setProperties"\n-              method="post"\n-              class="pat-formunloadalert">\n-\n-            <fieldset tal:define="props context/error_log/getProperties">\n-\n-                <legend i18n:translate="legend_logdetails">Log details</legend>\n-\n-                <div class="field">\n-                    <label for="keep_entries"\n-                           i18n:translate="label_number_exceptions">Number of exceptions to keep</label>\n-\n-                    <div></div>\n-\n-                    <input type="text"\n-                           name="keep_entries"\n-                           id="keep_entries"\n-                           size="40"\n-                           tal:attributes="value props/keep_entries" />\n-                </div>\n-\n-                <div class="field">\n-                    <input type="checkbox"\n-                           class="noborder"\n-                           id="cb_copy_to_zlog"\n-                           name="copy_to_zlog"\n-                           tal:attributes="checked props/copy_to_zlog;\n-                                           disabled not:context/error_log/checkEventLogPermission|nothing" />\n-\n-                    <label for="cb_copy_to_zlog" i18n:translate="label_copy_exceptions">\n-                        Copy exceptions to the event log\n-                    </label>\n-\n-                </div>\n-\n-                <div class="field">\n-                    <label for="ignored_exceptions"\n-                           i18n:translate="label_ignored_exception">Ignored exception types</label>\n-\n-                    <br>\n-                    <textarea name="ignored_exceptions:lines"\n-                              id="ignored_exceptions"\n-                              cols="40"\n-                              rows="3"\n-                              tal:content="python: \'\\n\'.join(props[\'ignored_exceptions\'])"></textarea>\n-                </div>\n-\n-                <div class="formControls">\n-                    <input class="btn btn-primary"\n-                           type="submit"\n-                           name="submit"\n-                           value="Save"\n-                           i18n:attributes="value label_save;" />\n-                </div>\n-\n-            </fieldset>\n-\n-        </form>\n-    </div>\n-\n-</metal:main>\n-\n-</body>\n-</html>\ndiff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\nindex 848a9e721d..ae797cd070 100644\n--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\n+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_error_log.py\n@@ -41,8 +41,8 @@ def test_error_log_control_panel_link(self):\n         self.browser.open("%s/@@overview-controlpanel" % self.portal_url)\n         self.browser.getLink(\'Errors\').click()\n \n-        self.assertEqual(self.browser.url, "%s/prefs_error_log_form" % self.portal_url)\n-        self.assertIn(\'<h1 class="documentFirstHeading">Error log</h1>\', self.browser.contents)\n+        self.assertEqual(self.browser.url, "%s/@@error-log-form" % self.portal_url)\n+        self.assertIn(\'<h1>Error log</h1>\', self.browser.contents)\n \n     def test_error_log_set_properties(self):\n         self.assertEqual(self.error_log_properties[\'keep_entries\'], 20)\n@@ -55,7 +55,7 @@ def test_error_log_set_properties(self):\n         }\n \n         set_properties_view = getMultiAdapter((self.portal, self.request),\n-                                name=\'prefs_error_log_setProperties\')\n+                                name=\'error-log-set-properties\')\n         set_properties_view()\n \n         error_log_properties = self.portal.error_log.getProperties()\ndiff --git a/Products/CMFPlone/profiles/default/controlpanel.xml b/Products/CMFPlone/profiles/default/controlpanel.xml\nindex fd652eb20b..1cf104e4b7 100644\n--- a/Products/CMFPlone/profiles/default/controlpanel.xml\n+++ b/Products/CMFPlone/profiles/default/controlpanel.xml\n@@ -88,7 +88,7 @@\n  <configlet title="Errors" action_id="errorLog" appId="ErrorLog"\n     category="plone-security" condition_expr=""\n     icon_expr="string:exclamation-square"\n-    url_expr="string:${portal_url}/prefs_error_log_form" visible="True"\n+    url_expr="string:${portal_url}/@@error-log-form" visible="True"\n     i18n:attributes="title">\n   <permission>Manage portal</permission>\n  </configlet>\ndiff --git a/Products/CMFPlone/tests/robot/robodoc/config-screens.robot b/Products/CMFPlone/tests/robot/robodoc/config-screens.robot\nindex 230a0e4552..c810bec965 100644\n--- a/Products/CMFPlone/tests/robot/robodoc/config-screens.robot\n+++ b/Products/CMFPlone/tests/robot/robodoc/config-screens.robot\n@@ -78,7 +78,7 @@ Show Editing setup screen\n     ...  css=#content\n \n Show Error log setup screen\n-    Go to  ${PLONE_URL}/prefs_error_log_form\n+    Go to  ${PLONE_URL}/@@error-log-form\n     Capture and crop page screenshot\n     ...  ${CURDIR}/_robot/errorlog-setup.png\n     ...  css=#content\n@@ -213,4 +213,4 @@ Changing the logo\n     Capture and crop page screenshot\n     ...    ${CURDIR}/_robot/change-logo-in-site-control-panel.png\n     ...    css=#content\n-    ...    css=#formfield-form-widgets-site_logo\n\\ No newline at end of file\n+    ...    css=#formfield-form-widgets-site_logo\ndiff --git a/news/3393.enhancement b/news/3393.enhancement\nnew file mode 100644\nindex 0000000000..de652bdf6c\n--- /dev/null\n+++ b/news/3393.enhancement\n@@ -0,0 +1,3 @@\n+Update Controlpanel Error Log Form Layout\n+Rename ControlPanel Error Log Form View prefs_error_log_form -> error-log-form\n+[jmevissen]\n'

