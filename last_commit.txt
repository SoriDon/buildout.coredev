Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-08-21T22:11:07+02:00
Author: Fred van Dijk (fredvd) <fredvd@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/a428777002c208a6dfb6dd0b4be07d31fe9135eb

Add translation namesspace and i18n:translate to the dexterity schema
definitions for the content types that have extra field defined on top of the
behavior composition. Otherwise no translations can be picked up.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/schema/file.xml
M plone/app/contenttypes/schema/image.xml
M plone/app/contenttypes/schema/link.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index fab05499..c76b70d3 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,11 @@ New features:
 
 Bug fixes:
 
+- Add translation namesspace and i18n:translate to the dexterity schema
+  definitions for the content types that have extra field defined on top of the
+  behavior composition. Otherwise no translations can be picked up.
+  [fredvd]
+
 - Use original raw text and mimetype when indexing rich text.
   This avoids a double transform (raw source to output mimetype to plain text).
   Includes a reindex of the SearchableText index for Collections, Documents and News Items.
diff --git a/plone/app/contenttypes/schema/file.xml b/plone/app/contenttypes/schema/file.xml
index f35082a0..23b0727e 100644
--- a/plone/app/contenttypes/schema/file.xml
+++ b/plone/app/contenttypes/schema/file.xml
@@ -6,12 +6,12 @@
     <field name="title" type="zope.schema.TextLine">
       <description />
       <required>False</required>
-      <title>Title</title>
+      <title i18n:translate="">Title</title>
     </field>
     <field name="description" type="zope.schema.Text">
       <description />
       <required>False</required>
-      <title>Description</title>
+      <title i18n:translate="">Description</title>
     </field>
     <field name="file" type="plone.namedfile.field.NamedBlobFile"
         marshal:primary="true">
diff --git a/plone/app/contenttypes/schema/image.xml b/plone/app/contenttypes/schema/image.xml
index 4795d8d8..63c24e42 100644
--- a/plone/app/contenttypes/schema/image.xml
+++ b/plone/app/contenttypes/schema/image.xml
@@ -6,12 +6,12 @@
     <field name="title" type="zope.schema.TextLine">
       <description />
       <required>False</required>
-      <title>Title</title>
+      <title i18n:translate="">Title</title>
     </field>
     <field name="description" type="zope.schema.Text">
       <description />
       <required>False</required>
-      <title>Description</title>
+      <title i18n:translate="">Description</title>
     </field>
     <field name="image" type="plone.namedfile.field.NamedBlobImage"
         marshal:primary="true">
diff --git a/plone/app/contenttypes/schema/link.xml b/plone/app/contenttypes/schema/link.xml
index 75df3d80..b5a2d65c 100644
--- a/plone/app/contenttypes/schema/link.xml
+++ b/plone/app/contenttypes/schema/link.xml
@@ -1,11 +1,14 @@
 <model xmlns="http://namespaces.plone.org/supermodel/schema"
-       xmlns:form="http://namespaces.plone.org/supermodel/form">
+       xmlns:form="http://namespaces.plone.org/supermodel/form"
+       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"
+       xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+       i18n:domain="plone">
     <schema>
       <field name="remoteUrl" type="zope.schema.TextLine" form:widget="plone.app.z3cform.widget.LinkFieldWidget">
         <default>http://</default>
-        <description>The link is used almost verbatim, relative links become absolute and the strings "${navigation_root_url}" and "${portal_url}" get replaced with the real navigation_root_url or portal_url. If in doubt which one to use, please use navigation_root_url.
+        <description i18n:translate="description_linktype_url">The link is used almost verbatim, relative links become absolute and the strings "${navigation_root_url}" and "${portal_url}" get replaced with the real navigation_root_url or portal_url. If in doubt which one to use, please use navigation_root_url.
         </description>
-        <title>URL</title>
+        <title i18n:translate="">URL</title>
       </field>
     </schema>
 </model>


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-08-22T11:20:55+02:00
Author: Fred van Dijk (fredvd) <fredvd@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/f17bd0d09ad77e7c0823927f713acf0e3adc23e4

Fix buildout.cfg to run with Plone 5.1
This is the master branch. Remove unnecessary pinning already in 5.1-latest/versions.cfg

Files changed:
M buildout.cfg

diff --git a/buildout.cfg b/buildout.cfg
index d2b91575..5027b31a 100644
--- a/buildout.cfg
+++ b/buildout.cfg
@@ -1,5 +1,5 @@
 [buildout]
-extends = http://dist.plone.org/release/5.0-latest/versions.cfg
+extends = http://dist.plone.org/release/5.1-latest/versions.cfg
 extensions = mr.developer
 package-name = plone.app.contenttypes
 package-extras = [test]
@@ -85,11 +85,6 @@ plone.app.contenttypes =
 # Temporarily until next Plone version is out:
 plone.app.querystring = 1.3.4
 
-setuptools = 18.2
-zc.buildout = 2.4.1
-zc.recipe.egg = 2.0.2
-flake8 = 2.3.0
-i18ndude = 3.4.0
 robotframework = 2.8.4
 robotframework-ride = 1.3
 robotframework-selenium2library = 1.6.0


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2017-08-22T11:34:14+02:00
Author: Fred van Dijk (fredvd) <fredvd@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/ee8d1e6ecbe6783f22e0ba102bf7e2d0a6627e0a

Fix code-analysis/Flake8 warnings

Files changed:
M plone/app/contenttypes/behaviors/collection.py
M plone/app/contenttypes/migration/utils.py
M plone/app/contenttypes/tests/test_content_profile.py
M plone/app/contenttypes/tests/test_file.py
M plone/app/contenttypes/tests/test_indexes.py
M plone/app/contenttypes/tests/test_link.py

diff --git a/plone/app/contenttypes/behaviors/collection.py b/plone/app/contenttypes/behaviors/collection.py
index e57fa4ee..234bac44 100644
--- a/plone/app/contenttypes/behaviors/collection.py
+++ b/plone/app/contenttypes/behaviors/collection.py
@@ -31,6 +31,7 @@ def __call__(self, context):
         ]
         return SimpleVocabulary(items)
 
+
 MetaDataFieldsVocabularyFactory = MetaDataFieldsVocabulary()
 
 
diff --git a/plone/app/contenttypes/migration/utils.py b/plone/app/contenttypes/migration/utils.py
index 03648535..64ecca54 100644
--- a/plone/app/contenttypes/migration/utils.py
+++ b/plone/app/contenttypes/migration/utils.py
@@ -330,7 +330,8 @@ def get_all_references(context):
     relation_catalog = queryUtility(ICatalog)
     for rel in relation_catalog.findRelations():
         if rel.from_path and rel.to_path:
-            from_brain = portal_catalog(path=dict(query=rel.from_path, depth=0))
+            from_brain = portal_catalog(path=dict(query=rel.from_path,
+                                                  depth=0))
             to_brain = portal_catalog(path=dict(query=rel.to_path, depth=0))
             if len(from_brain) > 0 and len(to_brain) > 0:
                 results.append({
diff --git a/plone/app/contenttypes/tests/test_content_profile.py b/plone/app/contenttypes/tests/test_content_profile.py
index 97ef504b..03c1cc3e 100644
--- a/plone/app/contenttypes/tests/test_content_profile.py
+++ b/plone/app/contenttypes/tests/test_content_profile.py
@@ -29,6 +29,7 @@ def setUpPloneSite(self, portal):
         # Necessary to set up some Plone stuff, such as Workflow.
         self.applyProfile(portal, 'plone.app.contenttypes:plone-content')
 
+
 PLONE_APP_CONTENTTYPES_CONTENT_FIXTURE = PloneAppContenttypesContent()
 PLONE_APP_CONTENTTYPES_CONTENT_INTEGRATION_TESTING = \
     IntegrationTesting(bases=(PLONE_APP_CONTENTTYPES_CONTENT_FIXTURE,),
diff --git a/plone/app/contenttypes/tests/test_file.py b/plone/app/contenttypes/tests/test_file.py
index d24490f3..147aaa21 100644
--- a/plone/app/contenttypes/tests/test_file.py
+++ b/plone/app/contenttypes/tests/test_file.py
@@ -181,7 +181,8 @@ def test_alternative_mime_icon_doc_for_file(self):
         self.browser.getControl(name=widget).value = 'This is my doc file.'
         file_path = os.path.join(os.path.dirname(__file__), 'file.doc')
         file_ctl = self.browser.getControl(name='form.widgets.file')
-        file_ctl.add_file(io.FileIO(file_path), 'application/msword', 'file.doc')
+        file_ctl.add_file(io.FileIO(file_path), 'application/msword',
+                          'file.doc')
         self.browser.getControl('Save').click()
         self.assertTrue(self.browser.url.endswith('file.doc/view'))
         self.assertTrue('custom.png' in self.browser.contents)
diff --git a/plone/app/contenttypes/tests/test_indexes.py b/plone/app/contenttypes/tests/test_indexes.py
index 0117313c..52fa7fc4 100644
--- a/plone/app/contenttypes/tests/test_indexes.py
+++ b/plone/app/contenttypes/tests/test_indexes.py
@@ -229,7 +229,8 @@ def test_raw_text_searchable_text_index(self):
         searchable text, but you will usually have a hard time setting it.
         """
         self.document.text = RichTextValue(
-            u"""<script type="text/javascript">alert('Lorem ipsum')</script>""",
+            u"""<script type="text/javascript">alert('Lorem ipsum')"""
+            u"""</script>""",
             mimeType='text/html',
             outputMimeType='text/x-html-safe'
         )
diff --git a/plone/app/contenttypes/tests/test_link.py b/plone/app/contenttypes/tests/test_link.py
index 3412556c..01d804ed 100644
--- a/plone/app/contenttypes/tests/test_link.py
+++ b/plone/app/contenttypes/tests/test_link.py
@@ -281,9 +281,9 @@ class LinkWidgetIntegrationTest(unittest.TestCase):
     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING
 
     default_result = {'internal': u'',
-              'external': u'',
-              'email': u'',
-              'email_subject': u''}
+                      'external': u'',
+                      'email': u'',
+                      'email_subject': u''}
 
     def setUp(self):
         self.portal = self.layer['portal']


