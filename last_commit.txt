Repository: plone.namedfile


Branch: refs/heads/master
Date: 2016-12-23T14:59:52+01:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.namedfile/commit/42d4bcbb50fbf237fd2d968be1953627d1fce003

svg_support

Files changed:
M CHANGES.rst
M plone/namedfile/scaling.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1fd1bac..073b761 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,9 @@ New features:
   For Orientation examples and description see http://www.daveperrett.com/articles/2012/07/28/exif-orientation-handling-is-a-ghetto/ test data https://github.com/recurser/exif-orientation-examples
   Additional Test Images with different MIME-Types (JPEG and TIFF) and possible problems: https://github.com/ianare/exif-samples.git
   [loechel]
+- Support SVG images
+  [tomgross]
+
 
 Bug fixes:
 
diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py
index 6dd32ac..b3501ec 100644
--- a/plone/namedfile/scaling.py
+++ b/plone/namedfile/scaling.py
@@ -221,6 +221,17 @@ def __call__(
             )
         except (ConflictError, KeyboardInterrupt):
             raise
+        except IOError:
+            if orig_value.contentType == 'image/svg+xml':
+                result = orig_data.read(), 'SVG', (width, height)
+            else:
+                logger.exception(
+                    'Could not scale "{0!r}" of {1!r}'.format(
+                        orig_value,
+                        self.context.absolute_url
+                    ),
+                )
+                return
         except Exception:
             logger.exception(
                 'Could not scale "{0!r}" of {1!r}'.format(


Repository: plone.namedfile


Branch: refs/heads/master
Date: 2017-01-03T07:20:00Z
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.namedfile/commit/e71b1aeccb19a31f1fa8b5dc0c34da8a98237f04

be safe on getting content-type

Files changed:
M plone/namedfile/scaling.py

diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py
index b3501ec..e32ed15 100644
--- a/plone/namedfile/scaling.py
+++ b/plone/namedfile/scaling.py
@@ -222,7 +222,7 @@ def __call__(
         except (ConflictError, KeyboardInterrupt):
             raise
         except IOError:
-            if orig_value.contentType == 'image/svg+xml':
+            if getattr(orig_value, 'contentType', '') == 'image/svg+xml':
                 result = orig_data.read(), 'SVG', (width, height)
             else:
                 logger.exception(


Repository: plone.namedfile


Branch: refs/heads/master
Date: 2017-01-03T17:42:56+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.namedfile/commit/deb83cb076066c9ddb06ae86dfab70f3fe2e37cb

Merge pull request #39 from plone/svg_support

SVG support

Files changed:
M CHANGES.rst
M plone/namedfile/scaling.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1fd1bac..073b761 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,9 @@ New features:
   For Orientation examples and description see http://www.daveperrett.com/articles/2012/07/28/exif-orientation-handling-is-a-ghetto/ test data https://github.com/recurser/exif-orientation-examples
   Additional Test Images with different MIME-Types (JPEG and TIFF) and possible problems: https://github.com/ianare/exif-samples.git
   [loechel]
+- Support SVG images
+  [tomgross]
+
 
 Bug fixes:
 
diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py
index 6dd32ac..e32ed15 100644
--- a/plone/namedfile/scaling.py
+++ b/plone/namedfile/scaling.py
@@ -221,6 +221,17 @@ def __call__(
             )
         except (ConflictError, KeyboardInterrupt):
             raise
+        except IOError:
+            if getattr(orig_value, 'contentType', '') == 'image/svg+xml':
+                result = orig_data.read(), 'SVG', (width, height)
+            else:
+                logger.exception(
+                    'Could not scale "{0!r}" of {1!r}'.format(
+                        orig_value,
+                        self.context.absolute_url
+                    ),
+                )
+                return
         except Exception:
             logger.exception(
                 'Could not scale "{0!r}" of {1!r}'.format(


