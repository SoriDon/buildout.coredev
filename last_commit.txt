Repository: plone.app.textfield


Branch: refs/heads/master
Date: 2019-03-14T14:01:09+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.textfield/commit/45832cb2cd546ff91bcdc23861907fbc14af035f

fix python 3 issue in transformer

Files changed:
A news/34.bugfix
M plone/app/textfield/transform.py

b'diff --git a/news/34.bugfix b/news/34.bugfix\nnew file mode 100644\nindex 0000000..a4aa15d\n--- /dev/null\n+++ b/news/34.bugfix\n@@ -0,0 +1,2 @@\n+fix python 3 issue when checking referenced images in transform\n+[petschki]\ndiff --git a/plone/app/textfield/transform.py b/plone/app/textfield/transform.py\nindex 38ffb13..eb2ecc7 100644\n--- a/plone/app/textfield/transform.py\n+++ b/plone/app/textfield/transform.py\n@@ -111,9 +111,12 @@ def check_referenced_images(self, value, target_mimetype, cache_obj):\n             return\n \n         # get the original save time from the cached data dict\n-        orig_time = getattr(cache_obj, cache._id).values()[0][0]\n-        modified_imgs = self.catalog(\n-            UID=uids, modified=dict(query=orig_time, range="min"))\n+        cached_values = list(getattr(cache_obj, cache._id, {}).values())\n+        modified_imgs = []\n+        if len(cached_values):\n+            orig_time = cached_values[0][0]\n+            modified_imgs = self.catalog(\n+                UID=uids, modified=dict(query=orig_time, range="min"))\n \n         if len(modified_imgs) > 0:\n             cache.purgeCache()\n'

Repository: plone.app.textfield


Branch: refs/heads/master
Date: 2019-03-15T14:49:23+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.textfield/commit/17e8874ed6d0bf53e1d25efa4688924a040a4a4b

Merge pull request #35 from plone/issue_34

fix python 3 issue in transformer

Files changed:
A news/34.bugfix
M plone/app/textfield/transform.py

b'diff --git a/news/34.bugfix b/news/34.bugfix\nnew file mode 100644\nindex 0000000..a4aa15d\n--- /dev/null\n+++ b/news/34.bugfix\n@@ -0,0 +1,2 @@\n+fix python 3 issue when checking referenced images in transform\n+[petschki]\ndiff --git a/plone/app/textfield/transform.py b/plone/app/textfield/transform.py\nindex 38ffb13..eb2ecc7 100644\n--- a/plone/app/textfield/transform.py\n+++ b/plone/app/textfield/transform.py\n@@ -111,9 +111,12 @@ def check_referenced_images(self, value, target_mimetype, cache_obj):\n             return\n \n         # get the original save time from the cached data dict\n-        orig_time = getattr(cache_obj, cache._id).values()[0][0]\n-        modified_imgs = self.catalog(\n-            UID=uids, modified=dict(query=orig_time, range="min"))\n+        cached_values = list(getattr(cache_obj, cache._id, {}).values())\n+        modified_imgs = []\n+        if len(cached_values):\n+            orig_time = cached_values[0][0]\n+            modified_imgs = self.catalog(\n+                UID=uids, modified=dict(query=orig_time, range="min"))\n \n         if len(modified_imgs) > 0:\n             cache.purgeCache()\n'

