Repository: mockup


Branch: refs/heads/master
Date: 2016-02-02T11:59:53+01:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/mockup/commit/95e5999039d3e629e7a1d7b5d5731b6f2967b534

fix: path widgets initialization in querystring pattern

Files changed:
M CHANGES.rst
M mockup/patterns/querystring/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index e626f8a..4ecb4c2 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -20,6 +20,8 @@ Fixes:
 - Calculate z-index for modals dynamically to always be on top
   [vangheem]
 
+- Fix path widgets initialization in querystring pattern.
+  [Gagaro]
 
 2.1.2 (2016-01-08)
 ------------------
diff --git a/mockup/patterns/querystring/pattern.js b/mockup/patterns/querystring/pattern.js
index 713fb15..833f913 100644
--- a/mockup/patterns/querystring/pattern.js
+++ b/mockup/patterns/querystring/pattern.js
@@ -242,6 +242,12 @@ define([
       self.removeOperator();
       self.createPathOperators();
 
+      // We must test if we have a "simple" path or an "advanced" one and change the widgets accordingly
+      if (index === 'path' && value && value !== '.::1' && value !== '..::1' && !value.match(/^[0-9a-f]{32}::-?[0-9]+$/)) {
+        self.advanced = true;
+        self.resetPathOperators();
+      }
+
       self.appendOperators(index);
 
       if (operator === undefined) {
@@ -447,7 +453,7 @@ define([
         else {
           var trimmedValue = value;
           if( typeof value === "string" && widget !== 'RelativePathWidget') {
-            trimmedValue = value.replace(/::[0-9]+/, '');
+            trimmedValue = value.replace(/::-?[0-9]+/, '');
           }
           self.$value.select2('val', trimmedValue);
         }


Repository: mockup


Branch: refs/heads/master
Date: 2016-02-02T08:43:23-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/14acee99c205e328cdf634fbf90a3ee33d86c15a

Merge pull request #620 from plone/fix-querystring-path

fix: path widgets initialization in querystring pattern

Files changed:
M CHANGES.rst
M mockup/patterns/querystring/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index e626f8a..4ecb4c2 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -20,6 +20,8 @@ Fixes:
 - Calculate z-index for modals dynamically to always be on top
   [vangheem]
 
+- Fix path widgets initialization in querystring pattern.
+  [Gagaro]
 
 2.1.2 (2016-01-08)
 ------------------
diff --git a/mockup/patterns/querystring/pattern.js b/mockup/patterns/querystring/pattern.js
index 713fb15..833f913 100644
--- a/mockup/patterns/querystring/pattern.js
+++ b/mockup/patterns/querystring/pattern.js
@@ -242,6 +242,12 @@ define([
       self.removeOperator();
       self.createPathOperators();
 
+      // We must test if we have a "simple" path or an "advanced" one and change the widgets accordingly
+      if (index === 'path' && value && value !== '.::1' && value !== '..::1' && !value.match(/^[0-9a-f]{32}::-?[0-9]+$/)) {
+        self.advanced = true;
+        self.resetPathOperators();
+      }
+
       self.appendOperators(index);
 
       if (operator === undefined) {
@@ -447,7 +453,7 @@ define([
         else {
           var trimmedValue = value;
           if( typeof value === "string" && widget !== 'RelativePathWidget') {
-            trimmedValue = value.replace(/::[0-9]+/, '');
+            trimmedValue = value.replace(/::-?[0-9]+/, '');
           }
           self.$value.select2('val', trimmedValue);
         }


