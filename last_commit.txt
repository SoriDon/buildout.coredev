Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-13T15:13:59+01:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/628ee7b7de4e01626179af2f63e20f389ee4a6c1

Views for title and description.

Views for title and description.

Files changed:
A Products/CMFPlone/browser/templates/description.pt
A Products/CMFPlone/browser/templates/title.pt
A news/2740.feature
M Products/CMFPlone/browser/configure.zcml
M Products/CMFPlone/browser/templates/main_template.pt

b'diff --git a/Products/CMFPlone/browser/configure.zcml b/Products/CMFPlone/browser/configure.zcml\nindex d66dee577..0e5d916fc 100644\n--- a/Products/CMFPlone/browser/configure.zcml\n+++ b/Products/CMFPlone/browser/configure.zcml\n@@ -95,6 +95,20 @@\n       permission="zope.Public"\n       />\n \n+  <browser:page\n+      for="*"\n+      name="title"\n+      template="templates/title.pt"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      for="*"\n+      name="description"\n+      template="templates/description.pt"\n+      permission="zope.Public"\n+      />\n+\n   <browser:page\n       for="*"\n       name="render-toolbar"\ndiff --git a/Products/CMFPlone/browser/templates/description.pt b/Products/CMFPlone/browser/templates/description.pt\nnew file mode 100644\nindex 000000000..159c3534b\n--- /dev/null\n+++ b/Products/CMFPlone/browser/templates/description.pt\n@@ -0,0 +1,6 @@\n+<div class="documentDescription description"\n+    tal:define="description context/Description"\n+    tal:content="description"\n+    tal:condition="description">\n+  Description\n+</div>\ndiff --git a/Products/CMFPlone/browser/templates/main_template.pt b/Products/CMFPlone/browser/templates/main_template.pt\nindex 2660dbce8..2b1d3915a 100644\n--- a/Products/CMFPlone/browser/templates/main_template.pt\n+++ b/Products/CMFPlone/browser/templates/main_template.pt\n@@ -85,20 +85,12 @@\n           <header>\n             <div id="viewlet-above-content-title" tal:content="structure provider:plone.abovecontenttitle" />\n             <metal:title define-slot="content-title">\n-                <h1 class="documentFirstHeading"\n-                    tal:define="title context/Title"\n-                    tal:condition="title"\n-                    tal:content="title">Title or id</h1>\n+              <h1 tal:replace="structure context/@@title" />\n             </metal:title>\n             <div id="viewlet-below-content-title" tal:content="structure provider:plone.belowcontenttitle" />\n \n             <metal:description define-slot="content-description">\n-                <div class="documentDescription description"\n-                     tal:define="description context/Description"\n-                     tal:content="description"\n-                     tal:condition="description">\n-                    Description\n-                </div>\n+              <p tal:replace="structure context/@@description" />\n             </metal:description>\n           </header>\n \ndiff --git a/Products/CMFPlone/browser/templates/title.pt b/Products/CMFPlone/browser/templates/title.pt\nnew file mode 100644\nindex 000000000..8c6e94193\n--- /dev/null\n+++ b/Products/CMFPlone/browser/templates/title.pt\n@@ -0,0 +1,4 @@\n+<h1 class="documentFirstHeading"\n+  tal:define="title context/Title"\n+  tal:condition="title"\n+  tal:content="title">Title or id</h1>\ndiff --git a/news/2740.feature b/news/2740.feature\nnew file mode 100644\nindex 000000000..340ea9a2f\n--- /dev/null\n+++ b/news/2740.feature\n@@ -0,0 +1 @@\n+Views for title and description. [iham]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-15T08:02:19+01:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/3646495595e1db371a3e054090c8454291b4cdf6

Merge branch 'master' into plip-2740

Files changed:
M CHANGES.rst
M setup.py
D news/1486.feature
D news/2258.bugfix
D news/2464.bugfix
D news/2516.feature
D news/2542.breaking
D news/2595.bugfix
D news/260.bugfix
D news/2645.bugfix
D news/2665.bugfix
D news/2675.bugfix
D news/2683.bugfix
D news/2694.bugfix
D news/2707.bugfix
D news/2736.feature

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 10c0db9c8..fbd6ba40b 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -12,6 +12,54 @@ Changelog\n \n .. towncrier release notes start\n \n+5.2b1 (2019-02-13)\n+------------------\n+\n+Breaking changes:\n+\n+\n+- - Factor out all static resources and the ``plone-compile-resources`` script\n+  into plone.staticresources. [thet] (#2542)\n+\n+\n+New features:\n+\n+\n+- PLIP 1486: Merge Products.RedirectionTool into core. Allow users to manage\n+  redirects on their site and aliases to content. See\n+  https://github.com/plone/Products.CMFPlone/issues/1486 [staeff, maurits]\n+  (#1486)\n+- - Added multilevel dropdown navigation [agitator] (#2516)\n+- No longer mark special links by default. [pbauer] (#2736)\n+\n+\n+Bug fixes:\n+\n+\n+- Switched allowedRolesAndUsers indexer from 'View' to the correct permission\n+  'Access contents information' for displaying metadata. 'View' permission\n+  should be used on the item itself. The change should not matter for default\n+  Plone workflows, since they always use those permissions together. [agitator]\n+  (#260)\n+- deprecate catalog_get_all(catalog) in favor of catalog.getAllBrains()\n+  [pbauer] (#2258)\n+- Restore the possibility to sort catalog query results with multiple indexes\n+  (#2464)\n+- Review list portlet showed nothing to review with plone.app.multilingual, As\n+  WorkflowTool bypassed languages only for p.a.m<2.x or linguaplone. fixed and\n+  now compatible to both lang-bypassing methods. [iham] (#2595)\n+- Fixed fallback to default view when selected layout does not exist for\n+  Folder. [gbastien] (#2645)\n+- The patched init method for the class zope.sendmail.mailer.SMTPMailer has\n+  been updated, fixing a bug that was preventing to send emails. [ale-rt,\n+  nazrulworld] (#2665)\n+- a11y: Added role attribute for portalMessage [nzambello] (#2675)\n+- Fix several warnings shown when running tests on Python 3+. [gforcada]\n+  (#2683)\n+- fixed Python 3 related str decoding issue in breadcrumbs (#2694)\n+- Fixed unstable robot test Scenario: A page is opened to edit in TinyMCE.\n+  [maurits] (#2707)\n+\n \n 5.2a2 (2018-12-30)\n ------------------\ndiff --git a/news/1486.feature b/news/1486.feature\ndeleted file mode 100644\nindex 2cf99dbc6..000000000\n--- a/news/1486.feature\n+++ /dev/null\n@@ -1,4 +0,0 @@\n-PLIP 1486: Merge Products.RedirectionTool into core.\n-Allow users to manage redirects on their site and aliases to content.\n-See https://github.com/plone/Products.CMFPlone/issues/1486\n-[staeff, maurits]\n\\ No newline at end of file\ndiff --git a/news/2258.bugfix b/news/2258.bugfix\ndeleted file mode 100644\nindex d0d434c45..000000000\n--- a/news/2258.bugfix\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-deprecate catalog_get_all(catalog) in favor of catalog.getAllBrains()\n-[pbauer]\ndiff --git a/news/2464.bugfix b/news/2464.bugfix\ndeleted file mode 100644\nindex 208e85080..000000000\n--- a/news/2464.bugfix\n+++ /dev/null\n@@ -1 +0,0 @@\n-Restore the possibility to sort catalog query results with multiple indexes\ndiff --git a/news/2516.feature b/news/2516.feature\ndeleted file mode 100644\nindex fe30bfe98..000000000\n--- a/news/2516.feature\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-- Added multilevel dropdown navigation\n-  [agitator]\ndiff --git a/news/2542.breaking b/news/2542.breaking\ndeleted file mode 100644\nindex ed83c1ae6..000000000\n--- a/news/2542.breaking\n+++ /dev/null\n@@ -1,3 +0,0 @@\n-- Factor out all static resources and the ``plone-compile-resources`` script into plone.staticresources.\n-  [thet]\n-\ndiff --git a/news/2595.bugfix b/news/2595.bugfix\ndeleted file mode 100644\nindex 5aa8b69ba..000000000\n--- a/news/2595.bugfix\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-Review list portlet showed nothing to review with plone.app.multilingual, As WorkflowTool bypassed languages only for p.a.m<2.x or linguaplone. fixed and now compatible to both lang-bypassing methods.\n-[iham]\ndiff --git a/news/260.bugfix b/news/260.bugfix\ndeleted file mode 100644\nindex dcb164708..000000000\n--- a/news/260.bugfix\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-Switched allowedRolesAndUsers indexer from 'View' to the correct permission 'Access contents information' for displaying metadata. 'View' permission should be used on the item itself. The change should not matter for default Plone workflows, since they always use those permissions together.\n-[agitator]\n\\ No newline at end of file\ndiff --git a/news/2645.bugfix b/news/2645.bugfix\ndeleted file mode 100644\nindex 415054689..000000000\n--- a/news/2645.bugfix\n+++ /dev/null\n@@ -1 +0,0 @@\n-Fixed fallback to default view when selected layout does not exist for Folder. [gbastien]\ndiff --git a/news/2665.bugfix b/news/2665.bugfix\ndeleted file mode 100644\nindex 1cd3f0170..000000000\n--- a/news/2665.bugfix\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-The patched init method for the class zope.sendmail.mailer.SMTPMailer has been updated, fixing a bug that was preventing to send emails.\n-[ale-rt, nazrulworld]\ndiff --git a/news/2675.bugfix b/news/2675.bugfix\ndeleted file mode 100644\nindex b2711e323..000000000\n--- a/news/2675.bugfix\n+++ /dev/null\n@@ -1 +0,0 @@\n-a11y: Added role attribute for portalMessage [nzambello]\ndiff --git a/news/2683.bugfix b/news/2683.bugfix\ndeleted file mode 100644\nindex 0aa5b2ff9..000000000\n--- a/news/2683.bugfix\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-Fix several warnings shown when running tests on Python 3+.\n-[gforcada]\ndiff --git a/news/2694.bugfix b/news/2694.bugfix\ndeleted file mode 100644\nindex 830b6ce5e..000000000\n--- a/news/2694.bugfix\n+++ /dev/null\n@@ -1 +0,0 @@\n-fixed Python 3 related str decoding issue in breadcrumbs\ndiff --git a/news/2707.bugfix b/news/2707.bugfix\ndeleted file mode 100644\nindex 55fafb884..000000000\n--- a/news/2707.bugfix\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-Fixed unstable robot test Scenario: A page is opened to edit in TinyMCE.\n-[maurits]\ndiff --git a/news/2736.feature b/news/2736.feature\ndeleted file mode 100644\nindex 341d8c24a..000000000\n--- a/news/2736.feature\n+++ /dev/null\n@@ -1 +0,0 @@\n-No longer mark special links by default. [pbauer]\n\\ No newline at end of file\ndiff --git a/setup.py b/setup.py\nindex 6c3118600..2a2288cca 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -2,7 +2,7 @@\n from setuptools import setup\n from setuptools import find_packages\n \n-version = '5.2b1.dev0'\n+version = '5.2b2.dev0'\n \n \n setup(\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-19T09:30:32+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/6f92ae29652523d56050819e0647191c18a3761d

Merge branch 'master' into plip-2740

Files changed:
A news/2752.bugfix
M Products/CMFPlone/tests/robot/test_linkintegrity.robot

b"diff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex 38f916f68..6f812fda8 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -17,7 +17,7 @@ Library  Remote  ${PLONE_URL}/RobotRemote\n \n Resource  keywords.robot\n \n-#Suite setup  Set Selenium speed  0.5s\n+# Suite setup  Set Selenium speed  0.5s\n Test Setup  Run keywords  Plone Test Setup\n Test Teardown  Run keywords  Plone Test Teardown\n \n@@ -79,8 +79,8 @@ a link in rich text\n   Given patterns are loaded\n   Wait until element is visible  css=.pat-relateditems .select2-input.select2-default\n   Click Element  css=.pat-relateditems .select2-input.select2-default\n-  Wait until element is visible  xpath=(//span[contains(., 'One level up')])\n-  Click Element  xpath=(//span[contains(., 'One level up')])\n+  Wait until element is visible  css=.pattern-relateditems-result.one-level-up a.pattern-relateditems-result-browse\n+  Click Element  css=.pattern-relateditems-result.one-level-up a.pattern-relateditems-result-browse\n   Wait until element is visible  xpath=(//span[contains(., 'Foo')])\n   Click Element  xpath=(//span[contains(., 'Foo')])\n   Wait until page contains  Foo\n@@ -92,6 +92,7 @@ a link in rich text\n should show warning when deleting page\n   Go To  ${PLONE_URL}/foo\n   Click Link  css=#plone-contentmenu-actions a\n+  Wait until element is visible  css=#plone-contentmenu-actions-delete\n   Click Link  css=#plone-contentmenu-actions-delete\n   Wait until page contains element  css=.breach-container .breach-item\n \n@@ -126,6 +127,7 @@ should not show warning when deleting page from folder_contents\n should not show warning when deleting page\n   Go To  ${PLONE_URL}/foo\n   Click Link  css=#plone-contentmenu-actions a\n+  Wait until element is visible  css=#plone-contentmenu-actions-delete\n   Click Link  css=#plone-contentmenu-actions-delete\n   Page should not contain element  css=.breach-container .breach-item\n \ndiff --git a/news/2752.bugfix b/news/2752.bugfix\nnew file mode 100644\nindex 000000000..5b96ce973\n--- /dev/null\n+++ b/news/2752.bugfix\n@@ -0,0 +1,2 @@\n+- make linkintegrity robot test more reliable\n+  [MrTango]\n\\ No newline at end of file\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-19T11:35:25+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/217755cf3e93e9bfa9cba661fef7d74855ba8662

Merge branch 'master' into plip-2740

Files changed:
A news/2516.fixed
M Products/CMFPlone/browser/navigation.py
M Products/CMFPlone/tests/testNavigationView.py

b"diff --git a/Products/CMFPlone/browser/navigation.py b/Products/CMFPlone/browser/navigation.py\nindex 27bae5816..ba9c12031 100644\n--- a/Products/CMFPlone/browser/navigation.py\n+++ b/Products/CMFPlone/browser/navigation.py\n@@ -148,8 +148,9 @@ def _get_url(item):\n \n         # now add the content to results\n         for item in rawresult:\n-            if item.exclude_from_nav:\n-                continue\n+            if not navigation_settings.show_excluded_items:\n+                if item.exclude_from_nav:\n+                    continue\n             cid, item_url = _get_url(item)\n             data = {\n                 'name': utils.pretty_title_or_id(context, item),\ndiff --git a/Products/CMFPlone/tests/testNavigationView.py b/Products/CMFPlone/tests/testNavigationView.py\nindex 7c2080a90..e18f08897 100644\n--- a/Products/CMFPlone/tests/testNavigationView.py\n+++ b/Products/CMFPlone/tests/testNavigationView.py\n@@ -597,17 +597,29 @@ def testDisableFolderTabs(self):\n \n     def testTabsExcludeItemsWithExcludeProperty(self):\n         # Make sure that items witht he exclude_from_nav property are purged\n-        view = self.view_class(self.portal, self.request)\n+        view = self.view_class(self.portal, self.request.clone())\n         tabs = view.topLevelTabs(actions=[])\n         orig_len = len(tabs)\n         self.portal.folder2.exclude_from_nav = True\n         self.portal.folder2.reindexObject()\n+\n+        # For the moment nothing changes because the default for\n+        # plone.show_excluded_items is True\n+        view = self.view_class(self.portal, self.request.clone())\n+        tabs = view.topLevelTabs(actions=[])\n+        self.assertTrue(tabs)\n+        self.assertEqual(len(tabs), orig_len)\n+        tab_names = [t['id'] for t in tabs]\n+        self.assertIn('folder2', tab_names)\n+\n+        # Now we flip the setting for plone.show_excluded_items\n+        self.navigation_settings.show_excluded_items = False\n         view = self.view_class(self.portal, self.request)\n         tabs = view.topLevelTabs(actions=[])\n         self.assertTrue(tabs)\n         self.assertEqual(len(tabs), orig_len - 1)\n         tab_names = [t['id'] for t in tabs]\n-        self.assertFalse('folder2' in tab_names)\n+        self.assertNotIn('folder2', tab_names)\n \n     def testTabsRespectsTypesWithViewAction(self):\n         # With a type in types_use_view_action_in_listings as current action it\ndiff --git a/news/2516.fixed b/news/2516.fixed\nnew file mode 100644\nindex 000000000..f78be280a\n--- /dev/null\n+++ b/news/2516.fixed\n@@ -0,0 +1 @@\n+Fix excluded items in navigation [ale-rt]\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-19T11:35:34+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/b214d44dd92816edf3b41ce5a93da93b1dc78628

Merge pull request #2747 from plone/plip-2740

Views for title and description.

Files changed:
A Products/CMFPlone/browser/templates/description.pt
A Products/CMFPlone/browser/templates/title.pt
A news/2740.feature
M Products/CMFPlone/browser/configure.zcml
M Products/CMFPlone/browser/templates/main_template.pt

b'diff --git a/Products/CMFPlone/browser/configure.zcml b/Products/CMFPlone/browser/configure.zcml\nindex d66dee577..0e5d916fc 100644\n--- a/Products/CMFPlone/browser/configure.zcml\n+++ b/Products/CMFPlone/browser/configure.zcml\n@@ -95,6 +95,20 @@\n       permission="zope.Public"\n       />\n \n+  <browser:page\n+      for="*"\n+      name="title"\n+      template="templates/title.pt"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      for="*"\n+      name="description"\n+      template="templates/description.pt"\n+      permission="zope.Public"\n+      />\n+\n   <browser:page\n       for="*"\n       name="render-toolbar"\ndiff --git a/Products/CMFPlone/browser/templates/description.pt b/Products/CMFPlone/browser/templates/description.pt\nnew file mode 100644\nindex 000000000..159c3534b\n--- /dev/null\n+++ b/Products/CMFPlone/browser/templates/description.pt\n@@ -0,0 +1,6 @@\n+<div class="documentDescription description"\n+    tal:define="description context/Description"\n+    tal:content="description"\n+    tal:condition="description">\n+  Description\n+</div>\ndiff --git a/Products/CMFPlone/browser/templates/main_template.pt b/Products/CMFPlone/browser/templates/main_template.pt\nindex 2660dbce8..2b1d3915a 100644\n--- a/Products/CMFPlone/browser/templates/main_template.pt\n+++ b/Products/CMFPlone/browser/templates/main_template.pt\n@@ -85,20 +85,12 @@\n           <header>\n             <div id="viewlet-above-content-title" tal:content="structure provider:plone.abovecontenttitle" />\n             <metal:title define-slot="content-title">\n-                <h1 class="documentFirstHeading"\n-                    tal:define="title context/Title"\n-                    tal:condition="title"\n-                    tal:content="title">Title or id</h1>\n+              <h1 tal:replace="structure context/@@title" />\n             </metal:title>\n             <div id="viewlet-below-content-title" tal:content="structure provider:plone.belowcontenttitle" />\n \n             <metal:description define-slot="content-description">\n-                <div class="documentDescription description"\n-                     tal:define="description context/Description"\n-                     tal:content="description"\n-                     tal:condition="description">\n-                    Description\n-                </div>\n+              <p tal:replace="structure context/@@description" />\n             </metal:description>\n           </header>\n \ndiff --git a/Products/CMFPlone/browser/templates/title.pt b/Products/CMFPlone/browser/templates/title.pt\nnew file mode 100644\nindex 000000000..8c6e94193\n--- /dev/null\n+++ b/Products/CMFPlone/browser/templates/title.pt\n@@ -0,0 +1,4 @@\n+<h1 class="documentFirstHeading"\n+  tal:define="title context/Title"\n+  tal:condition="title"\n+  tal:content="title">Title or id</h1>\ndiff --git a/news/2740.feature b/news/2740.feature\nnew file mode 100644\nindex 000000000..340ea9a2f\n--- /dev/null\n+++ b/news/2740.feature\n@@ -0,0 +1 @@\n+Views for title and description. [iham]\n\\ No newline at end of file\n'

