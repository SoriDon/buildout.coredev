Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-07-19T13:53:38+02:00
Author: Víctor Fernández de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/292e6885138ea2c3a7f9087934ab4bcc809c6f14

Improve extensibility story in smart field serializer/deserializer (#1180)

* Improve extensibility story in smart field serializer/deserializer

* Rename it to just 'fields'

Files changed:
A news/1179.feature
M src/plone/restapi/deserializer/blocks.py
M src/plone/restapi/serializer/blocks.py

b'diff --git a/news/1179.feature b/news/1179.feature\nnew file mode 100644\nindex 000000000..0754559a6\n--- /dev/null\n+++ b/news/1179.feature\n@@ -0,0 +1,2 @@\n+Improve extensibility story in smart field serializer/deserializer\n+[sneridagh]\ndiff --git a/src/plone/restapi/deserializer/blocks.py b/src/plone/restapi/deserializer/blocks.py\nindex 45310a26b..f6be51b63 100644\n--- a/src/plone/restapi/deserializer/blocks.py\n+++ b/src/plone/restapi/deserializer/blocks.py\n@@ -136,6 +136,7 @@ class ResolveUIDDeserializerBase:\n \n     order = 1\n     block_type = None\n+    fields = ["url", "href"]\n     disabled = os.environ.get("disable_transform_resolveuid", False)\n \n     def __init__(self, context, request):\n@@ -144,7 +145,7 @@ def __init__(self, context, request):\n \n     def __call__(self, block):\n         # Convert absolute links to resolveuid\n-        for field in ["url", "href"]:\n+        for field in self.fields:\n             link = block.get(field, "")\n             if link and isinstance(link, str):\n                 block[field] = path2uid(context=self.context, link=link)\ndiff --git a/src/plone/restapi/serializer/blocks.py b/src/plone/restapi/serializer/blocks.py\nindex cd3a09b0d..67f5a65e8 100644\n--- a/src/plone/restapi/serializer/blocks.py\n+++ b/src/plone/restapi/serializer/blocks.py\n@@ -110,6 +110,7 @@ def __call__(self):\n class ResolveUIDSerializerBase:\n     order = 1\n     block_type = None\n+    fields = ["url", "href"]\n     disabled = os.environ.get("disable_transform_resolveuid", False)\n \n     def __init__(self, context, request):\n@@ -117,7 +118,7 @@ def __init__(self, context, request):\n         self.request = request\n \n     def __call__(self, value):\n-        for field in ["url", "href"]:\n+        for field in self.fields:\n             if field in value.keys():\n                 link = value.get(field, "")\n                 if isinstance(link, str):\n'

