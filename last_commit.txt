Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2021-09-28T18:28:35+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/a7f60a0f6b1620d750ddad2059af4bccbcbe3e00

Fix form error alert, includes rendering for invariants

Files changed:
A news/129.bugfix
M plone/app/z3cform/templates/macros.pt

b'diff --git a/news/129.bugfix b/news/129.bugfix\nnew file mode 100644\nindex 0000000..bc6218e\n--- /dev/null\n+++ b/news/129.bugfix\n@@ -0,0 +1,2 @@\n+Fix form-error alert for BS5 (including invariants errors). [jensens]\n+\ndiff --git a/plone/app/z3cform/templates/macros.pt b/plone/app/z3cform/templates/macros.pt\nindex 26b81c1..b920f4a 100644\n--- a/plone/app/z3cform/templates/macros.pt\n+++ b/plone/app/z3cform/templates/macros.pt\n@@ -13,28 +13,45 @@\n             </metal:title-slot>\n \n             <metal:define define-macro="titlelessform"\n-                          tal:define="status view/status;\n-                                      has_error python:view.widgets.errors or status == getattr(view, \'formErrorsMessage\', None)"\n                           i18n:domain="plone">\n \n-                <tal:status condition="status">\n-                    <div class="alert alert-danger" tal:condition="has_error" role="alert">\n-                        <span tal:replace="status" />\n+                <tal:status tal:define="status view/status;\n+                                        has_error python:view.widgets.errors or status == getattr(view, \'formErrorsMessage\', None);\n+                                        errors view/widgets/errors;\n+                                        icons nocall: context/@@iconresolver"\n+                            tal:condition="python: status">\n+                    <div tal:condition="python:not (has_error or errors)"\n+                         class="portalMessage statusmessage statusmessage-info alter alert-info"\n+                         role="alert">\n+                        <tal:icon tal:replace="structure python:icons.tag(\'plone-statusmessage-info\', tag_alt=\'Info\', tag_class=\'statusmessage-icon mb-1 me-2\')" i18n:attributes="alt"/>\n+                        <span class="content"\n+                              tal:replace="structure status | nothing"\n+                              i18n:translate="">\n+                              The info status message.\n+                        </span>\n                     </div>\n-                    <div class="alert alert-info" tal:condition="not:has_error" role="alert">\n-                        <span tal:replace="status" />\n+                    <div tal:condition="python:has_error or errors"\n+                         class="portalMessage statusmessage statusmessage-error alert alert-danger"\n+                         role="alert">\n+                        <tal:icon tal:replace="structure python:icons.tag(\'plone-statusmessage-error\', tag_alt=\'Error\', tag_class=\'statusmessage-icon mb-1 me-2\')" i18n:attributes="alt"/>\n+                        <span class="content"\n+                              tal:replace="structure status | nothing"\n+                              i18n:translate="">\n+                              The error status message.\n+                        </span>\n+                        <div class="mt-2 field error" tal:condition="python:[e for e in errors if not getattr(e, \'widget\', None)]">\n+                            <ul>\n+                                <tal:loop tal:repeat="error errors">\n+                                    <li tal:condition="not:nocall:error/widget"\n+                                        tal:content="structure error/render">\n+                                        Error\n+                                    </li>\n+                                </tal:loop>\n+                            </ul>\n+                        </div>\n                     </div>\n                 </tal:status>\n \n-                <tal:errors define="errors view/widgets/errors" condition="errors">\n-                    <tal:error repeat="error errors">\n-                        <div class="field error"\n-                             tal:condition="not:nocall:error/widget"\n-                             tal:content="structure error/render">\n-                             Error\n-                        </div>\n-                    </tal:error>\n-                </tal:errors>\n \n                 <form data-pat-autotoc="levels: legend; section: fieldset; className: autotabs"\n                       class="rowlike enableUnloadProtection" action="." method="post" novalidate\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2021-10-02T15:07:56+02:00
Author: agitator (agitator) <agitator@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/c19e7884a7b344ee2cccf2f4210dc63f8b3226f8

Merge pull request #129 from plone/fix-formerror-alert

Fix form error alert, includes rendering for invariants

Files changed:
A news/129.bugfix
M plone/app/z3cform/templates/macros.pt

b'diff --git a/news/129.bugfix b/news/129.bugfix\nnew file mode 100644\nindex 0000000..bc6218e\n--- /dev/null\n+++ b/news/129.bugfix\n@@ -0,0 +1,2 @@\n+Fix form-error alert for BS5 (including invariants errors). [jensens]\n+\ndiff --git a/plone/app/z3cform/templates/macros.pt b/plone/app/z3cform/templates/macros.pt\nindex 26b81c1..b920f4a 100644\n--- a/plone/app/z3cform/templates/macros.pt\n+++ b/plone/app/z3cform/templates/macros.pt\n@@ -13,28 +13,45 @@\n             </metal:title-slot>\n \n             <metal:define define-macro="titlelessform"\n-                          tal:define="status view/status;\n-                                      has_error python:view.widgets.errors or status == getattr(view, \'formErrorsMessage\', None)"\n                           i18n:domain="plone">\n \n-                <tal:status condition="status">\n-                    <div class="alert alert-danger" tal:condition="has_error" role="alert">\n-                        <span tal:replace="status" />\n+                <tal:status tal:define="status view/status;\n+                                        has_error python:view.widgets.errors or status == getattr(view, \'formErrorsMessage\', None);\n+                                        errors view/widgets/errors;\n+                                        icons nocall: context/@@iconresolver"\n+                            tal:condition="python: status">\n+                    <div tal:condition="python:not (has_error or errors)"\n+                         class="portalMessage statusmessage statusmessage-info alter alert-info"\n+                         role="alert">\n+                        <tal:icon tal:replace="structure python:icons.tag(\'plone-statusmessage-info\', tag_alt=\'Info\', tag_class=\'statusmessage-icon mb-1 me-2\')" i18n:attributes="alt"/>\n+                        <span class="content"\n+                              tal:replace="structure status | nothing"\n+                              i18n:translate="">\n+                              The info status message.\n+                        </span>\n                     </div>\n-                    <div class="alert alert-info" tal:condition="not:has_error" role="alert">\n-                        <span tal:replace="status" />\n+                    <div tal:condition="python:has_error or errors"\n+                         class="portalMessage statusmessage statusmessage-error alert alert-danger"\n+                         role="alert">\n+                        <tal:icon tal:replace="structure python:icons.tag(\'plone-statusmessage-error\', tag_alt=\'Error\', tag_class=\'statusmessage-icon mb-1 me-2\')" i18n:attributes="alt"/>\n+                        <span class="content"\n+                              tal:replace="structure status | nothing"\n+                              i18n:translate="">\n+                              The error status message.\n+                        </span>\n+                        <div class="mt-2 field error" tal:condition="python:[e for e in errors if not getattr(e, \'widget\', None)]">\n+                            <ul>\n+                                <tal:loop tal:repeat="error errors">\n+                                    <li tal:condition="not:nocall:error/widget"\n+                                        tal:content="structure error/render">\n+                                        Error\n+                                    </li>\n+                                </tal:loop>\n+                            </ul>\n+                        </div>\n                     </div>\n                 </tal:status>\n \n-                <tal:errors define="errors view/widgets/errors" condition="errors">\n-                    <tal:error repeat="error errors">\n-                        <div class="field error"\n-                             tal:condition="not:nocall:error/widget"\n-                             tal:content="structure error/render">\n-                             Error\n-                        </div>\n-                    </tal:error>\n-                </tal:errors>\n \n                 <form data-pat-autotoc="levels: legend; section: fieldset; className: autotabs"\n                       class="rowlike enableUnloadProtection" action="." method="post" novalidate\n'

