Repository: plone.volto


Branch: refs/heads/main
Date: 2022-04-24T15:56:37+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.volto/commit/5dddba6bb7fa3aeffc06b654764e35f10c9efd68

allow calling migrate_richtext_to_slate without arguments

Files changed:
M src/plone/volto/browser/migrate_richtext.py

b'diff --git a/src/plone/volto/browser/migrate_richtext.py b/src/plone/volto/browser/migrate_richtext.py\nindex 6b7a64a..701a38d 100644\n--- a/src/plone/volto/browser/migrate_richtext.py\n+++ b/src/plone/volto/browser/migrate_richtext.py\n@@ -60,10 +60,11 @@ def types_with_blocks(self):\n \n \n def migrate_richtext_to_slate(\n-    portal_types, service_url="http://localhost:5000/html", purge_richtext=False\n+    portal_types=None, service_url="http://localhost:5000/html", purge_richtext=False\n ):\n-\n-    if isinstance(portal_types, str):\n+    if portal_types is None:\n+        portal_types = types_with_blocks()\n+    elif isinstance(portal_types, str):\n         portal_types = [portal_types]\n     fieldname = "text"\n     headers = {\n@@ -127,3 +128,14 @@ def migrate_richtext_to_slate(\n         msg = f"Migrated {index} {portal_type} to slate"\n         logger.info(msg)\n     return results\n+\n+\n+def types_with_blocks():\n+    """A list of content types with volto.blocks behavior"""\n+    portal_types = api.portal.get_tool("portal_types")\n+    results = []\n+    for fti in portal_types.listTypeInfo():\n+        behaviors = getattr(fti, "behaviors", [])\n+        if "volto.blocks" in behaviors:\n+            results.append(fti.id)\n+    return results\n'

