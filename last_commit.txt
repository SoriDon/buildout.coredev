Repository: mockup


Branch: refs/heads/master
Date: 2016-01-25T10:22:16-05:00
Author: nathan.vangheem () <nathan.vangheem@wildcardcorp.com>
Commit: https://github.com/plone/mockup/commit/51e3136b565a129b3a383cfb7aa57628d70e0d34

Fix issue where if existing querystring path value is ".::1",
  after edit, the wrong value will be selected

Files changed:
M CHANGES.rst
M mockup/patterns/querystring/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 9f75a2d..f1575e5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,6 +10,8 @@ Fixes:
 
 - be able to use multiple importcss_file_filter files
   [vangheem]
+- Fix issue where if existing querystring path value is ".::1",
+  after edit, the wrong value will be selected
 
 - Calculate z-index for modals dynamically to always be on top
   [vangheem]
diff --git a/mockup/patterns/querystring/pattern.js b/mockup/patterns/querystring/pattern.js
index 240d7d6..5f6e2c7 100644
--- a/mockup/patterns/querystring/pattern.js
+++ b/mockup/patterns/querystring/pattern.js
@@ -364,7 +364,6 @@ define([
         self.appendOperators(index);
         self.createValue(index);
       } else if (widget === 'RelativePathWidget') {
-
         if( self.advanced ) {
           self.$value = $('<input type="text"/>')
             .addClass(self.options.classValueName + '-' + widget)
@@ -376,14 +375,20 @@ define([
         }else{
           //These 2 hard-coded values correspond to the "Current (./)" and "Parent (../)" options
           //under the location index.
-          var val = ".::1";
-          if ( self.$operator.val().indexOf('relativePath') > 0 ) {
-            val = "..::1";
+          if(!value){
+            value = ".::1";
+            if ( self.$operator.val().indexOf('relativePath') > 0 ) {
+              value = "..::1";
+            }
+          }else{
+            if(value === '.::1'){
+              self.$operator.select2('val', 'plone.app.querystring.operation.string.path');
+            }
           }
           self.$value = $('<input type="hidden"/>')
           .addClass(self.options.classValueName + '-' + widget)
           .appendTo($wrapper)
-          .val(val);
+          .val(value);
         }
       } else if (widget === 'ReferenceWidget') {
         if( self.advanced ) {
@@ -441,7 +446,7 @@ define([
         }
         else {
           var trimmedValue = value;
-          if( typeof value === "string" ) {
+          if( typeof value === "string" && widget !== 'RelativePathWidget') {
             trimmedValue = value.replace(/::[0-9]+/, '');
           }
           self.$value.select2('val', trimmedValue);


Repository: mockup


Branch: refs/heads/master
Date: 2016-01-26T00:29:11-05:00
Author: nathan.vangheem () <nathan.vangheem@wildcardcorp.com>
Commit: https://github.com/plone/mockup/commit/de0d09769ec7385b1514f4c5ef38d1d079e8c3e4

fix saving value for query string

Files changed:
M CHANGES.rst
M mockup/patterns/querystring/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index f1575e5..e626f8a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,8 +8,12 @@ New:
 
 Fixes:
 
+- fix saving values for query string
+  [vangheem]
+
 - be able to use multiple importcss_file_filter files
   [vangheem]
+
 - Fix issue where if existing querystring path value is ".::1",
   after edit, the wrong value will be selected
 
diff --git a/mockup/patterns/querystring/pattern.js b/mockup/patterns/querystring/pattern.js
index 5f6e2c7..713fb15 100644
--- a/mockup/patterns/querystring/pattern.js
+++ b/mockup/patterns/querystring/pattern.js
@@ -591,7 +591,12 @@ define([
       }
       else if (typeof self.$value !== 'undefined') {
         var value = self.$value.val();
-        value += self.getDepthString();
+        if(typeof(value) === 'string'){
+          var depth = self.getDepthString();
+          if(depth){
+            value += depth;
+          }
+        }
         varr.push(value);
       }
       var vval;


Repository: mockup


Branch: refs/heads/master
Date: 2016-01-26T00:29:34-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/829773264a82cfdf6b87421f9e56b96a1e287f37

Merge pull request #619 from plone/querystring-path-fix

Fix issue with query string widget

Files changed:
M CHANGES.rst
M mockup/patterns/querystring/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 9f75a2d..e626f8a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,9 +8,15 @@ New:
 
 Fixes:
 
+- fix saving values for query string
+  [vangheem]
+
 - be able to use multiple importcss_file_filter files
   [vangheem]
 
+- Fix issue where if existing querystring path value is ".::1",
+  after edit, the wrong value will be selected
+
 - Calculate z-index for modals dynamically to always be on top
   [vangheem]
 
diff --git a/mockup/patterns/querystring/pattern.js b/mockup/patterns/querystring/pattern.js
index 240d7d6..713fb15 100644
--- a/mockup/patterns/querystring/pattern.js
+++ b/mockup/patterns/querystring/pattern.js
@@ -364,7 +364,6 @@ define([
         self.appendOperators(index);
         self.createValue(index);
       } else if (widget === 'RelativePathWidget') {
-
         if( self.advanced ) {
           self.$value = $('<input type="text"/>')
             .addClass(self.options.classValueName + '-' + widget)
@@ -376,14 +375,20 @@ define([
         }else{
           //These 2 hard-coded values correspond to the "Current (./)" and "Parent (../)" options
           //under the location index.
-          var val = ".::1";
-          if ( self.$operator.val().indexOf('relativePath') > 0 ) {
-            val = "..::1";
+          if(!value){
+            value = ".::1";
+            if ( self.$operator.val().indexOf('relativePath') > 0 ) {
+              value = "..::1";
+            }
+          }else{
+            if(value === '.::1'){
+              self.$operator.select2('val', 'plone.app.querystring.operation.string.path');
+            }
           }
           self.$value = $('<input type="hidden"/>')
           .addClass(self.options.classValueName + '-' + widget)
           .appendTo($wrapper)
-          .val(val);
+          .val(value);
         }
       } else if (widget === 'ReferenceWidget') {
         if( self.advanced ) {
@@ -441,7 +446,7 @@ define([
         }
         else {
           var trimmedValue = value;
-          if( typeof value === "string" ) {
+          if( typeof value === "string" && widget !== 'RelativePathWidget') {
             trimmedValue = value.replace(/::[0-9]+/, '');
           }
           self.$value.select2('val', trimmedValue);
@@ -586,7 +591,12 @@ define([
       }
       else if (typeof self.$value !== 'undefined') {
         var value = self.$value.val();
-        value += self.getDepthString();
+        if(typeof(value) === 'string'){
+          var depth = self.getDepthString();
+          if(depth){
+            value += depth;
+          }
+        }
         varr.push(value);
       }
       var vval;


