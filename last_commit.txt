Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-07-07T17:22:14+02:00
Author: Víctor Fernández de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/69b057acb47b00f0459b8d0857068b200fe82af2

Fix interpolation variable present in response after serialization (#1165)

Files changed:
A news/1164.bugfix
M src/plone/restapi/serializer/dxfields.py
M src/plone/restapi/tests/http-examples/link.resp
M src/plone/restapi/tests/test_documentation.py

b'diff --git a/news/1164.bugfix b/news/1164.bugfix\nnew file mode 100644\nindex 000000000..df25db09a\n--- /dev/null\n+++ b/news/1164.bugfix\n@@ -0,0 +1,2 @@\n+Fix interpolation variable present in response after serialization\n+[sneridagh]\ndiff --git a/src/plone/restapi/serializer/dxfields.py b/src/plone/restapi/serializer/dxfields.py\nindex 06043fa07..110abb14f 100644\n--- a/src/plone/restapi/serializer/dxfields.py\n+++ b/src/plone/restapi/serializer/dxfields.py\n@@ -146,7 +146,8 @@ def __call__(self):\n         ref_obj = portal.restrictedTraverse(path, None)\n         if ref_obj:\n             value = ref_obj.absolute_url()\n-        return json_compatible(value)\n+            return json_compatible(value)\n+        return json_compatible(path)\n \n \n @adapter(IField, IDexterityContent, Interface)\ndiff --git a/src/plone/restapi/tests/http-examples/link.resp b/src/plone/restapi/tests/http-examples/link.resp\nindex 7e57f8c08..eee5d6f96 100644\n--- a/src/plone/restapi/tests/http-examples/link.resp\n+++ b/src/plone/restapi/tests/http-examples/link.resp\n@@ -54,7 +54,7 @@ Content-Type: application/json\n     "description": "Congratulations! You have successfully installed Plone.", \n     "title": "Welcome to Plone"\n   }, \n-  "remoteUrl": "http://localhost:55001/plone", \n+  "remoteUrl": "http://plone.org", \n   "review_state": "private", \n   "rights": "", \n   "subjects": [], \ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex 09ca25cd0..232b00d6d 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -348,7 +348,7 @@ def test_documentation_link(self):\n         self.portal.invokeFactory("Link", id="link")\n         self.portal.link.title = "My Link"\n         self.portal.link.description = u"This is a link"\n-        self.portal.remoteUrl = "http://plone.org"\n+        self.portal.link.remoteUrl = "http://plone.org"\n         transaction.commit()\n         response = self.api_session.get(self.portal.link.absolute_url())\n         save_request_and_response_for_docs("link", response)\n'

