Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2021-12-14T16:46:18+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.contentrules/commit/81d4f91a66d4fc6f2c80ebcf1c457167bbe2573d

Remove obsolete info icon

Files changed:
A news/66.bugfix
M plone/app/contentrules/browser/elements.py

b"diff --git a/news/66.bugfix b/news/66.bugfix\nnew file mode 100644\nindex 0000000..98009fc\n--- /dev/null\n+++ b/news/66.bugfix\n@@ -0,0 +1,3 @@\n+remove obsolete info icon\n+update element management to bootstrap5\n+[petschki]\ndiff --git a/plone/app/contentrules/browser/elements.py b/plone/app/contentrules/browser/elements.py\nindex 5f45fe6..b017bf8 100644\n--- a/plone/app/contentrules/browser/elements.py\n+++ b/plone/app/contentrules/browser/elements.py\n@@ -154,9 +154,6 @@ def assignments(self):\n         site = getToolByName(rule, 'portal_url').getPortalObject()\n         site_path = '/'.join(site.getPhysicalPath())\n \n-        plone_layout_view = getMultiAdapter((rule, self.request),\n-                                            name='plone_layout')\n-\n         info = []\n         if site_path in paths:\n             paths.remove(site_path)\n@@ -164,7 +161,7 @@ def assignments(self):\n                 'url': site.absolute_url(),\n                 'title': site.title_or_id(),\n                 'description': site.Description(),\n-                'icon': plone_layout_view.getIcon(site)})\n+            })\n \n         catalog = getToolByName(rule, 'portal_catalog')\n         for a in catalog(path=dict(query=list(paths), depth=0),\n@@ -173,7 +170,7 @@ def assignments(self):\n                 'url': a.getURL(),\n                 'title': a.Title or a.getId,\n                 'description': a.Description,\n-                'icon': plone_layout_view.getIcon(a)})\n+            })\n \n         return info\n \n"

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2021-12-14T16:46:43+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.contentrules/commit/70e7c647f3ae1113d5891d74bcaf1ad9cc77c509

update rule management to bootstrap5

Files changed:
M plone/app/contentrules/browser/contentrules.css
M plone/app/contentrules/browser/templates/manage-elements.pt

b'diff --git a/plone/app/contentrules/browser/contentrules.css b/plone/app/contentrules/browser/contentrules.css\nindex a950ce6..f523aa0 100644\n--- a/plone/app/contentrules/browser/contentrules.css\n+++ b/plone/app/contentrules/browser/contentrules.css\n@@ -21,11 +21,6 @@\n   white-space: nowrap;\n }\n \n-.rule-operations{\n-  float: right;\n-  margin: 10px;\n-}\n-\n #configure-conditions,\n #configure-actions{\n   width: 50%;\n@@ -33,27 +28,6 @@\n   float: left;\n }\n \n-.rule-operations input[type="submit"],\n-.rule-operations a.plone-btn{\n-  font-size: 80%;\n-  padding: 5px 10px;\n-  margin: -1px -2px -1px -2px;\n-  border-radius: 0;\n-  border-right: none;\n-}\n-\n-.rule-operations input:first-child,\n-.rule-operations a:first-child{\n-  border-bottom-left-radius: 4px;\n-  border-top-left-radius: 4px;\n-}\n-\n-.rule-operations > input:last-child{\n-  border-bottom-right-radius: 4px;\n-  border-top-right-radius: 4px;\n-  border-right: 1px solid #1b6899;\n-}\n-\n #manage-assignments{\n   clear: both;\n }\n@@ -67,4 +41,4 @@\n }\n .chooser-right input{\n   display: inline-block;\n-}\n\\ No newline at end of file\n+}\ndiff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex 8f482cb..33b4776 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -41,7 +41,7 @@\n         </legend>\n         <a name="condition"></a>\n \n-        <div tal:condition="not:conditions" class="portalMessage info">\n+        <div tal:condition="not:conditions" class="alert alert-secondary">\n           <strong>Info</strong>\n           <span i18n:translate="">\n           There is not any additional condition checked on this rule.\n@@ -53,15 +53,21 @@\n             <span tal:replace="structure context/@@authenticator/authenticator"></span>\n             <a tal:attributes="name string:condition++${condition/idx}"></a>\n             <input type="hidden" name="element_id:int" tal:attributes="value condition/idx" />\n-            <div class="rule-element">\n-                <div class="rule-operations">\n+            <div class="rule-element border border-secondary rounded d-flex align-items-center justify-content-between px-2">\n+                <div>\n+                    <strong tal:content="condition/title" i18n:translate="">Transition was publish.</strong>\n+                    <span tal:content="condition/summary">\n+                        Something happened\n+                    </span>\n+                </div>\n+                <div class="rule-operations flex-shrink-0">\n                     <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n-                       class="pat-plone-modal plone-btn-primary btn btn-primary"\n+                       class="pat-plone-modal plone-btn-primary btn btn-sm btn-primary"\n                        tal:condition="condition/editview" i18n:translate="label_edit">Edit</a>\n                     <button type="submit"\n                            name="form.button.DeleteCondition"\n                            value="Remove"\n-                           class="context btn btn-danger"\n+                           class="context btn btn-sm btn-danger"\n                            i18n:attributes="value label_remove;"\n                            i18n:translate="label_remove"\n                            >Remove</button>\n@@ -69,21 +75,15 @@\n                            type="submit"\n                            name="form.button.MoveConditionUp"\n                            value="&uarr;"\n-                           class="context btn btn-primary"\n+                           class="context btn btn-sm btn-primary"\n                            >&uarr;</button>\n                     <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n                            type="submit"\n                            name="form.button.MoveConditionDown"\n                            value="&darr;"\n-                           class="context btn btn-primary"\n+                           class="context btn btn-sm btn-primary"\n                            >&darr;</button>\n                 </div>\n-                <div class="portalMessage warning">\n-                    <strong tal:content="condition/title" i18n:translate="">Transition was publish.</strong>\n-                    <span tal:content="condition/summary">\n-                        Something happened\n-                    </span>\n-                </div>\n             </div>\n         </form>\n \n@@ -96,14 +96,14 @@\n                     Add condition\n                 </label>\n \n-                <select name=":action" size="1" id="contentrules-add-condition" class="form-control">\n+                <select name=":action" size="1" id="contentrules-add-condition" class="form-select">\n                     <tal:block repeat="condition view/addable_conditions">\n                         <option tal:attributes="value condition/addview"\n                                 i18n:translate=""\n                                 tal:content="condition/title" />\n                     </tal:block>\n                 </select>\n-                <button class="context allowMultiSubmit btn btn-primary"\n+                <button class="context allowMultiSubmit btn btn-sm btn-primary"\n                        type="submit"\n                        name="form.button.AddCondition"\n                        value="Add"\n@@ -119,7 +119,7 @@\n             Perform the following actions:\n         </legend>\n         <a name="action"></a>\n-        <div tal:condition="not:actions" class="portalMessage warning">\n+        <div tal:condition="not:actions" class="alert alert-warning">\n           <strong>Warning</strong>\n           <span i18n:translate="">\n           There is not any action performed by this rule.\n@@ -132,14 +132,21 @@\n             <span tal:replace="structure context/@@authenticator/authenticator"></span>\n             <a tal:attributes="name string:action++${action/idx}"></a>\n             <input type="hidden" name="element_id:int" tal:attributes="value action/idx" />\n-            <div class="rule-element">\n-                <div class="rule-operations">\n+            <div class="rule-element border border-secondary rounded d-flex align-items-center justify-content-between px-2">\n+                <div>\n+                    <strong tal:content="action/title"\n+                    i18n:translate="">Move to folder</strong>\n+                    <span tal:content="action/summary">\n+                        Something happened\n+                    </span>\n+                </div>\n+                <div class="rule-operations flex-shrink-0">\n                     <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}" class="pat-plone-modal"\n                        tal:condition="action/editview">\n                       <button type="submit"\n                              name="form.button.EditAction"\n                              value="Edit"\n-                             class="context btn btn-primary"\n+                             class="context btn btn-sm btn-primary"\n                              i18n:attributes="value label_edit;"\n                              i18n:translate="label_edit;"\n                              >Edit</button>\n@@ -147,7 +154,7 @@\n                     <button type="submit"\n                            name="form.button.DeleteAction"\n                            value="Remove"\n-                           class="context btn btn-danger"\n+                           class="context btn btn-sm btn-danger"\n                            i18n:attributes="value label_remove;"\n                            i18n:translate="label_remove"\n                            >Remove</button>\n@@ -155,22 +162,15 @@\n                            type="submit"\n                            name="form.button.MoveActionUp"\n                            value="&uarr;"\n-                           class="context btn btn-primary"\n+                           class="context btn btn-sm btn-primary"\n                            >&uarr;</button>\n                     <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n                            type="submit"\n                            name="form.button.MoveActionDown"\n                            value="&darr;"\n-                           class="context btn btn-primary"\n+                           class="context btn btn-sm btn-primary"\n                            >&darr;</button>\n                 </div>\n-                <div class="portalMessage warning">\n-                    <strong tal:content="action/title"\n-                        i18n:translate="">Move to folder</strong>\n-                    <span tal:content="action/summary">\n-                        Something happened\n-                    </span>\n-                </div>\n             </div>\n         </form>\n \n@@ -180,14 +180,14 @@\n             <div class="chooser-right">\n                 <label class="form-label" i18n:translate="contentrules_add_action"\n                        for="contentrules-add-action">Add action</label>\n-                <select name=":action" size="1" id="contentrules-add-action" class="form-control">\n+                <select name=":action" size="1" id="contentrules-add-action" class="form-select">\n                     <tal:block repeat="action view/addable_actions">\n                         <option tal:attributes="value action/addview"\n                                 i18n:translate=""\n                                 tal:content="action/title"></option>\n                     </tal:block>\n                 </select>\n-                <button class="context allowMultiSubmit btn btn-primary"\n+                <button class="context allowMultiSubmit btn btn-sm btn-primary"\n                        type="submit"\n                        name="form.button.AddAction"\n                        value="Add"\n@@ -203,7 +203,7 @@\n         <fieldset id="manage-assignments">\n           <legend i18n:translate="label_contentrules_rule_assignments">Assignments</legend>\n           <tal:noassignments condition="not:assignments">\n-            <div class="portalMessage warning">\n+            <div class="alert alert-warning">\n               <strong i18n:translate="">This rule is not assigned to any location</strong>\n \n             <tal:enabled condition="view/rule_enabled">\n@@ -219,7 +219,7 @@\n               <form class="mb-3" tal:attributes="action view/view_url" method="post">\n                 <span tal:replace="structure context/@@authenticator/authenticator"/>\n                 <label class="form-label" i18n:translate="contentrules_assignments_shortcuts">Shortcuts:</label>\n-                <input type="submit" class="btn btn-primary"\n+                <input type="submit" class="btn btn-sm btn-primary"\n                        value="Apply rule on the whole site"\n                        name="form.button.ApplyOnWholeSite"\n                        i18n:attributes="value" />\n@@ -229,7 +229,7 @@\n \n           </tal:noassignments>\n           <tal:assignments condition="nocall:assignments">\n-            <div class="portalMessage info">\n+            <div class="alert alert-secondary">\n               <strong>Info</strong>\n               <span\n                 i18n:translate="description_contentrules_rule_assignments">\n@@ -250,61 +250,61 @@\n \n     <fieldset id="configure-rule">\n         <legend i18n:translate="">Configure rule</legend>\n-        <form class="mb-3" tal:attributes="action view/view_url" method="post">\n+        <form tal:attributes="action view/view_url" method="post">\n             <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <div class="field">\n-                <label for="form.title" i18n:translate="label_title">Title</label>\n-                <div class="formHelp" i18n:translate="description_contentrule_title">\n-                    Please set a descriptive title for the rule.\n-                </div>\n+            <div class="mb-3">\n+                <label class="form-label" for="form.title" i18n:translate="label_title">Title</label>\n                 <input id="form.title" class="form-control" type="text" width="50" name="title"\n                     tal:attributes="value request/ruleTitle | view/rule_title"/>\n-            </div>\n-            <div class="field">\n-                <label for="form.description" i18n:translate="label_description">Description</label>\n-                <div class="formHelp" i18n:translate="contentrules_description_description">\n-                    Enter a short description of the rule and its purpose.\n+                <div class="form-text" i18n:translate="description_contentrule_title">\n+                    Please set a descriptive title for the rule.\n                 </div>\n+            </div>\n+            <div class="mb-3">\n+                <label class="form-label" for="form.description" i18n:translate="label_description">Description</label>\n                 <textarea id="form.description" class="form-control" name="description"\n-                          tal:content="request/ruleDescription | view/rule_description ">\n+                    tal:content="request/ruleDescription | view/rule_description ">\n                 </textarea>\n+                <div class="form-text" i18n:translate="contentrules_description_description">\n+                    Enter a short description of the rule and its purpose.\n+                </div>\n             </div>\n \n-            <div class="field">\n-                <label i18n:translate="label_rule_event_trigger">\n-                    Event trigger: <span i18n:name="trigger" tal:content="view/rule_event"></span>\n-                </label>\n-                <div class="formHelp" i18n:translate="contentrules_description_trigger">\n+            <div class="mb-3">\n+                <div class="form-label" i18n:translate="contentrules_description_trigger">\n                     The rule will execute when the following event occurs.\n                 </div>\n+                <label class="form-text" i18n:translate="label_rule_event_trigger">\n+                    Event trigger: <span i18n:name="trigger" tal:content="view/rule_event"></span>\n+                </label>\n             </div>\n \n-            <div class="field">\n-                <input type="checkbox" id="stop" name="stopExecuting"\n+            <div class="mb-3 form-check">\n+                <input type="checkbox" id="stop" name="stopExecuting" class="form-check-input"\n                        tal:attributes="checked view/rule_stop"/>\n-                <label for="stop" i18n:translate="contentrules_description_stop">\n+                <label class="form-check-label" for="stop" i18n:translate="contentrules_description_stop">\n                     Stop evaluating content rules after this rule completes\n                 </label>\n             </div>\n \n-            <div class="field">\n-                <input type="checkbox" id="cascading" name="cascading"\n+            <div class="mb-3 form-check">\n+                <input type="checkbox" id="cascading" name="cascading" class="form-check-input"\n                        tal:attributes="checked view/rule_cascading"/>\n-                <label for="cascading" i18n:translate="contentrules_description_cascading">\n+                <label class="form-check-label" for="cascading" i18n:translate="contentrules_description_cascading">\n                     The actions executed by this rule can trigger other rules\n                 </label>\n             </div>\n \n-            <div class="field">\n-                <input type="checkbox" id="enabled" name="enabled"\n+            <div class="mb-3 form-check">\n+                <input type="checkbox" id="enabled" name="enabled" class="form-check-input"\n                        tal:attributes="checked view/rule_enabled"/>\n-                <label for="enabled" i18n:translate="">\n+                <label class="form-check-label" for="enabled" i18n:translate="">\n                     Enabled\n                 </label>\n             </div>\n \n-            <div class="formControls">\n-                <button class="context btn btn-primary"\n+            <div class="mb-3">\n+                <button class="context btn btn-sm btn-primary"\n                        type="submit"\n                        name="form.button.Save"\n                        value="Save"\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2021-12-15T09:22:36+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.contentrules/commit/268e6973de2937dc67e07fae7a728d8702b17bd6

update assignment and element management to bootstrap5

Files changed:
M plone/app/contentrules/browser/templates/manage-assignments.pt
M plone/app/contentrules/browser/templates/manage-elements.pt

b'diff --git a/plone/app/contentrules/browser/templates/manage-assignments.pt b/plone/app/contentrules/browser/templates/manage-assignments.pt\nindex 41efcce..b320ef4 100644\n--- a/plone/app/contentrules/browser/templates/manage-assignments.pt\n+++ b/plone/app/contentrules/browser/templates/manage-assignments.pt\n@@ -11,7 +11,9 @@\n \n <body>\n \n-<metal:body fill-slot="body">\n+<metal:body fill-slot="body"\n+    tal:define="icons python:context.restrictedTraverse(\'@@iconresolver\')">\n+\n       <link rel="stylesheet" type="text/css" media="all"\n           href="++resource++manage-contentrules.css"\n           tal:attributes="href string:${context/portal_url}/++resource++manage-contentrules.css" />\n@@ -63,7 +65,7 @@\n             <div class="active">\n                 <div tal:define="acquired_rules view/acquired_rules"\n                      tal:condition="acquired_rules">\n-                    <table class="listing nosort">\n+                    <table class="table table-striped">\n                         <thead>\n                             <tr>\n                                 <th i18n:translate="label_contentrules_from_parent">\n@@ -89,12 +91,9 @@\n                                         </dl>\n                                     </td>\n                                     <td class="checker">\n-                                        <img tal:condition="rule/enabled"\n-                                             tal:attributes="src string:$portal_url/confirm_icon.png"\n-                                             alt="Active"\n-                                             width="16"\n-                                             height="16"\n-                                             i18n:attributes="alt label_contentrules_active;" />\n+                                        <tal:icon\n+                                            condition="rule/enabled"\n+                                            replace="structure python:icons.tag(\'check-circle\')" />\n                                     </td>\n                                 </tr>\n                             </tal:rules>\n@@ -104,12 +103,12 @@\n \n                 <form class="formControls mb-3" tal:define="assignable_rules view/assignable_rules" tal:condition="assignable_rules"\n                       tal:attributes="action string:${view/view_url}" method="post">\n-                    <div class="field chooser-right">\n-                        <label for="" i18n:translate="contentrules_add_assignment">\n+                    <div class="mb-3">\n+                        <label class="form-label" for="" i18n:translate="contentrules_add_assignment">\n                             Assign rule here\n                         </label>\n                         <div>\n-                          <select class="form-control" name="rule_id" size="1" id="select-rules">\n+                          <select class="form-select" name="rule_id" size="1" id="select-rules">\n                               <tal:options repeat="rule assignable_rules">\n                                   <option tal:attributes="value rule/id"\n                                           tal:content="rule/title">Addable rule name</option>\n@@ -125,11 +124,13 @@\n                     </div>\n                 </form>\n \n-                <div class="visualClear"><!-- --></div>\n+                <div class="clearfix"></div>\n \n                 <form class="mb-3" tal:attributes="action view/view_url" method="post"\n-                      tal:define="assigned_rules view/assigned_rules" tal:condition="assigned_rules">\n-                    <table class="listing nosort">\n+                      tal:define="assigned_rules view/assigned_rules;\n+                                  auth_token context/@@authenticator/token"\n+                      tal:condition="assigned_rules">\n+                    <table class="table table-striped">\n                         <thead>\n                             <tr>\n                                 <th class="smallcolumn">&nbsp;</th>\n@@ -173,43 +174,34 @@\n                                         </dd>\n                                     </dl>\n                                 </td>\n-                                <td class="checker">\n-                                    <a tal:condition="not:repeat/rule/start"\n+                                <td class="text-center">\n+                                    <a tal:condition=""\n                                        title="Move up"\n                                        i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id}">\n-                                        <img tal:replace="structure context/arrowUp.png" />\n+                                       tal:attributes="href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id}&amp;_authenticator=${auth_token}">\n+                                       <tal:icon replace="structure python:icons.tag(\'arrow-up\')" />\n                                     </a>\n                                     <a tal:condition="not:repeat/rule/end"\n                                        title="Move down"\n                                        i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id}">\n-                                        <img tal:replace="structure context/arrowDown.png" />\n+                                       tal:attributes="href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id}&amp;_authenticator=${auth_token}">\n+                                       <tal:icon replace="structure python:icons.tag(\'arrow-down\')" />\n                                     </a>\n                                 </td>\n-                                <td class="checker listingCheckbox">\n-                                    <img tal:condition="rule/bubbles"\n-                                         tal:attributes="src string:$portal_url/confirm_icon.png"\n-                                         alt="Active"\n-                                         width="16"\n-                                         height="16"\n-                                         i18n:attributes="alt label_contentrules_active;" />\n+                                <td class="text-center">\n+                                    <tal:icon\n+                                            condition="rule/bubbles"\n+                                            replace="structure python:icons.tag(\'check-circle\')" />\n                                 </td>\n-                                <td class="checker listingCheckbox">\n-                                    <img tal:condition="rule/enabled"\n-                                         tal:attributes="src string:$portal_url/confirm_icon.png"\n-                                         alt="Active"\n-                                         width="16"\n-                                         height="16"\n-                                         i18n:attributes="alt label_contentrules_active;" />\n+                                <td class="text-center">\n+                                    <tal:icon\n+                                            condition="rule/enabled"\n+                                            replace="structure python:icons.tag(\'check-circle\')" />\n                                 </td>\n-                                <td class="checker listingCheckbox">\n-                                    <img tal:condition="rule/global_enabled"\n-                                         tal:attributes="src string:$portal_url/confirm_icon.png"\n-                                         alt="Active"\n-                                         width="16"\n-                                         height="16"\n-                                         i18n:attributes="alt label_contentrules_active;" />\n+                                <td class="text-center">\n+                                    <tal:icon\n+                                            condition="rule/global_enabled"\n+                                            replace="structure python:icons.tag(\'check-circle\')" />\n                                 </td>\n                             </tr>\n                             </tal:rules>\ndiff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex 33b4776..b22d292 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -36,17 +36,18 @@\n     </p>\n \n     <fieldset id="configure-conditions" tal:define="conditions view/conditions">\n-        <legend i18n:translate="if_all_conditions_met">\n-            If all of the following conditions are met:\n-        </legend>\n-        <a name="condition"></a>\n \n         <div tal:condition="not:conditions" class="alert alert-secondary">\n-          <strong>Info</strong>\n-          <span i18n:translate="">\n-          There is not any additional condition checked on this rule.\n-          </span>\n+            <strong i18n:translate="">Info</strong>\n+            <span i18n:translate="">\n+                There is not any additional condition checked on this rule.\n+            </span>\n         </div>\n+\n+        <legend tal:condition="conditions" i18n:translate="if_all_conditions_met">\n+            If all of the following conditions are met:\n+        </legend>\n+\n         <form class="mb-3" tal:attributes="action view/view_url" method="post"\n               tal:define="auth_token context/@@authenticator/token"\n               tal:repeat="condition conditions">\n@@ -115,17 +116,18 @@\n     </fieldset>\n \n     <fieldset id="configure-actions" tal:define="actions view/actions">\n-        <legend i18n:translate="contentrules_perform_actions">\n-            Perform the following actions:\n-        </legend>\n-        <a name="action"></a>\n         <div tal:condition="not:actions" class="alert alert-warning">\n-          <strong>Warning</strong>\n-          <span i18n:translate="">\n-          There is not any action performed by this rule.\n-          Click on Add button to setup an action.\n-          </span>\n+            <strong i18n:translate="">Warning</strong>\n+            <span i18n:translate="">\n+                There is not any action performed by this rule.\n+                Click on Add button to setup an action.\n+            </span>\n         </div>\n+\n+        <legend tal:condition="actions" i18n:translate="contentrules_perform_actions">\n+            Perform the following actions:\n+        </legend>\n+\n         <form class="mb-3" tal:attributes="action view/view_url" method="post"\n               tal:define="auth_token context/@@authenticator/token"\n               tal:repeat="action actions">\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2021-12-15T09:27:05+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.contentrules/commit/26c67f00da4e3acb9cfd334f87de2a4b3753a875

missing condition

Files changed:
M plone/app/contentrules/browser/templates/manage-assignments.pt

b'diff --git a/plone/app/contentrules/browser/templates/manage-assignments.pt b/plone/app/contentrules/browser/templates/manage-assignments.pt\nindex b320ef4..2c4b668 100644\n--- a/plone/app/contentrules/browser/templates/manage-assignments.pt\n+++ b/plone/app/contentrules/browser/templates/manage-assignments.pt\n@@ -175,7 +175,7 @@\n                                     </dl>\n                                 </td>\n                                 <td class="text-center">\n-                                    <a tal:condition=""\n+                                    <a tal:condition="not:repeat/rule/start"\n                                        title="Move up"\n                                        i18n:attributes="title"\n                                        tal:attributes="href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id}&amp;_authenticator=${auth_token}">\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2021-12-15T11:14:00+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contentrules/commit/6fc43b8c37ed36582aa17673030e727381a35f54

Merge pull request #67 from plone/issue-66

Fix obsolete info icon and update templates

Files changed:
A news/66.bugfix
M plone/app/contentrules/browser/contentrules.css
M plone/app/contentrules/browser/elements.py
M plone/app/contentrules/browser/templates/manage-assignments.pt
M plone/app/contentrules/browser/templates/manage-elements.pt

b'diff --git a/news/66.bugfix b/news/66.bugfix\nnew file mode 100644\nindex 0000000..98009fc\n--- /dev/null\n+++ b/news/66.bugfix\n@@ -0,0 +1,3 @@\n+remove obsolete info icon\n+update element management to bootstrap5\n+[petschki]\ndiff --git a/plone/app/contentrules/browser/contentrules.css b/plone/app/contentrules/browser/contentrules.css\nindex a950ce6..f523aa0 100644\n--- a/plone/app/contentrules/browser/contentrules.css\n+++ b/plone/app/contentrules/browser/contentrules.css\n@@ -21,11 +21,6 @@\n   white-space: nowrap;\n }\n \n-.rule-operations{\n-  float: right;\n-  margin: 10px;\n-}\n-\n #configure-conditions,\n #configure-actions{\n   width: 50%;\n@@ -33,27 +28,6 @@\n   float: left;\n }\n \n-.rule-operations input[type="submit"],\n-.rule-operations a.plone-btn{\n-  font-size: 80%;\n-  padding: 5px 10px;\n-  margin: -1px -2px -1px -2px;\n-  border-radius: 0;\n-  border-right: none;\n-}\n-\n-.rule-operations input:first-child,\n-.rule-operations a:first-child{\n-  border-bottom-left-radius: 4px;\n-  border-top-left-radius: 4px;\n-}\n-\n-.rule-operations > input:last-child{\n-  border-bottom-right-radius: 4px;\n-  border-top-right-radius: 4px;\n-  border-right: 1px solid #1b6899;\n-}\n-\n #manage-assignments{\n   clear: both;\n }\n@@ -67,4 +41,4 @@\n }\n .chooser-right input{\n   display: inline-block;\n-}\n\\ No newline at end of file\n+}\ndiff --git a/plone/app/contentrules/browser/elements.py b/plone/app/contentrules/browser/elements.py\nindex 5f45fe6..b017bf8 100644\n--- a/plone/app/contentrules/browser/elements.py\n+++ b/plone/app/contentrules/browser/elements.py\n@@ -154,9 +154,6 @@ def assignments(self):\n         site = getToolByName(rule, \'portal_url\').getPortalObject()\n         site_path = \'/\'.join(site.getPhysicalPath())\n \n-        plone_layout_view = getMultiAdapter((rule, self.request),\n-                                            name=\'plone_layout\')\n-\n         info = []\n         if site_path in paths:\n             paths.remove(site_path)\n@@ -164,7 +161,7 @@ def assignments(self):\n                 \'url\': site.absolute_url(),\n                 \'title\': site.title_or_id(),\n                 \'description\': site.Description(),\n-                \'icon\': plone_layout_view.getIcon(site)})\n+            })\n \n         catalog = getToolByName(rule, \'portal_catalog\')\n         for a in catalog(path=dict(query=list(paths), depth=0),\n@@ -173,7 +170,7 @@ def assignments(self):\n                 \'url\': a.getURL(),\n                 \'title\': a.Title or a.getId,\n                 \'description\': a.Description,\n-                \'icon\': plone_layout_view.getIcon(a)})\n+            })\n \n         return info\n \ndiff --git a/plone/app/contentrules/browser/templates/manage-assignments.pt b/plone/app/contentrules/browser/templates/manage-assignments.pt\nindex 41efcce..2c4b668 100644\n--- a/plone/app/contentrules/browser/templates/manage-assignments.pt\n+++ b/plone/app/contentrules/browser/templates/manage-assignments.pt\n@@ -11,7 +11,9 @@\n \n <body>\n \n-<metal:body fill-slot="body">\n+<metal:body fill-slot="body"\n+    tal:define="icons python:context.restrictedTraverse(\'@@iconresolver\')">\n+\n       <link rel="stylesheet" type="text/css" media="all"\n           href="++resource++manage-contentrules.css"\n           tal:attributes="href string:${context/portal_url}/++resource++manage-contentrules.css" />\n@@ -63,7 +65,7 @@\n             <div class="active">\n                 <div tal:define="acquired_rules view/acquired_rules"\n                      tal:condition="acquired_rules">\n-                    <table class="listing nosort">\n+                    <table class="table table-striped">\n                         <thead>\n                             <tr>\n                                 <th i18n:translate="label_contentrules_from_parent">\n@@ -89,12 +91,9 @@\n                                         </dl>\n                                     </td>\n                                     <td class="checker">\n-                                        <img tal:condition="rule/enabled"\n-                                             tal:attributes="src string:$portal_url/confirm_icon.png"\n-                                             alt="Active"\n-                                             width="16"\n-                                             height="16"\n-                                             i18n:attributes="alt label_contentrules_active;" />\n+                                        <tal:icon\n+                                            condition="rule/enabled"\n+                                            replace="structure python:icons.tag(\'check-circle\')" />\n                                     </td>\n                                 </tr>\n                             </tal:rules>\n@@ -104,12 +103,12 @@\n \n                 <form class="formControls mb-3" tal:define="assignable_rules view/assignable_rules" tal:condition="assignable_rules"\n                       tal:attributes="action string:${view/view_url}" method="post">\n-                    <div class="field chooser-right">\n-                        <label for="" i18n:translate="contentrules_add_assignment">\n+                    <div class="mb-3">\n+                        <label class="form-label" for="" i18n:translate="contentrules_add_assignment">\n                             Assign rule here\n                         </label>\n                         <div>\n-                          <select class="form-control" name="rule_id" size="1" id="select-rules">\n+                          <select class="form-select" name="rule_id" size="1" id="select-rules">\n                               <tal:options repeat="rule assignable_rules">\n                                   <option tal:attributes="value rule/id"\n                                           tal:content="rule/title">Addable rule name</option>\n@@ -125,11 +124,13 @@\n                     </div>\n                 </form>\n \n-                <div class="visualClear"><!-- --></div>\n+                <div class="clearfix"></div>\n \n                 <form class="mb-3" tal:attributes="action view/view_url" method="post"\n-                      tal:define="assigned_rules view/assigned_rules" tal:condition="assigned_rules">\n-                    <table class="listing nosort">\n+                      tal:define="assigned_rules view/assigned_rules;\n+                                  auth_token context/@@authenticator/token"\n+                      tal:condition="assigned_rules">\n+                    <table class="table table-striped">\n                         <thead>\n                             <tr>\n                                 <th class="smallcolumn">&nbsp;</th>\n@@ -173,43 +174,34 @@\n                                         </dd>\n                                     </dl>\n                                 </td>\n-                                <td class="checker">\n+                                <td class="text-center">\n                                     <a tal:condition="not:repeat/rule/start"\n                                        title="Move up"\n                                        i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id}">\n-                                        <img tal:replace="structure context/arrowUp.png" />\n+                                       tal:attributes="href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id}&amp;_authenticator=${auth_token}">\n+                                       <tal:icon replace="structure python:icons.tag(\'arrow-up\')" />\n                                     </a>\n                                     <a tal:condition="not:repeat/rule/end"\n                                        title="Move down"\n                                        i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id}">\n-                                        <img tal:replace="structure context/arrowDown.png" />\n+                                       tal:attributes="href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id}&amp;_authenticator=${auth_token}">\n+                                       <tal:icon replace="structure python:icons.tag(\'arrow-down\')" />\n                                     </a>\n                                 </td>\n-                                <td class="checker listingCheckbox">\n-                                    <img tal:condition="rule/bubbles"\n-                                         tal:attributes="src string:$portal_url/confirm_icon.png"\n-                                         alt="Active"\n-                                         width="16"\n-                                         height="16"\n-                                         i18n:attributes="alt label_contentrules_active;" />\n+                                <td class="text-center">\n+                                    <tal:icon\n+                                            condition="rule/bubbles"\n+                                            replace="structure python:icons.tag(\'check-circle\')" />\n                                 </td>\n-                                <td class="checker listingCheckbox">\n-                                    <img tal:condition="rule/enabled"\n-                                         tal:attributes="src string:$portal_url/confirm_icon.png"\n-                                         alt="Active"\n-                                         width="16"\n-                                         height="16"\n-                                         i18n:attributes="alt label_contentrules_active;" />\n+                                <td class="text-center">\n+                                    <tal:icon\n+                                            condition="rule/enabled"\n+                                            replace="structure python:icons.tag(\'check-circle\')" />\n                                 </td>\n-                                <td class="checker listingCheckbox">\n-                                    <img tal:condition="rule/global_enabled"\n-                                         tal:attributes="src string:$portal_url/confirm_icon.png"\n-                                         alt="Active"\n-                                         width="16"\n-                                         height="16"\n-                                         i18n:attributes="alt label_contentrules_active;" />\n+                                <td class="text-center">\n+                                    <tal:icon\n+                                            condition="rule/global_enabled"\n+                                            replace="structure python:icons.tag(\'check-circle\')" />\n                                 </td>\n                             </tr>\n                             </tal:rules>\ndiff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex 8f482cb..b22d292 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -36,32 +36,39 @@\n     </p>\n \n     <fieldset id="configure-conditions" tal:define="conditions view/conditions">\n-        <legend i18n:translate="if_all_conditions_met">\n+\n+        <div tal:condition="not:conditions" class="alert alert-secondary">\n+            <strong i18n:translate="">Info</strong>\n+            <span i18n:translate="">\n+                There is not any additional condition checked on this rule.\n+            </span>\n+        </div>\n+\n+        <legend tal:condition="conditions" i18n:translate="if_all_conditions_met">\n             If all of the following conditions are met:\n         </legend>\n-        <a name="condition"></a>\n \n-        <div tal:condition="not:conditions" class="portalMessage info">\n-          <strong>Info</strong>\n-          <span i18n:translate="">\n-          There is not any additional condition checked on this rule.\n-          </span>\n-        </div>\n         <form class="mb-3" tal:attributes="action view/view_url" method="post"\n               tal:define="auth_token context/@@authenticator/token"\n               tal:repeat="condition conditions">\n             <span tal:replace="structure context/@@authenticator/authenticator"></span>\n             <a tal:attributes="name string:condition++${condition/idx}"></a>\n             <input type="hidden" name="element_id:int" tal:attributes="value condition/idx" />\n-            <div class="rule-element">\n-                <div class="rule-operations">\n+            <div class="rule-element border border-secondary rounded d-flex align-items-center justify-content-between px-2">\n+                <div>\n+                    <strong tal:content="condition/title" i18n:translate="">Transition was publish.</strong>\n+                    <span tal:content="condition/summary">\n+                        Something happened\n+                    </span>\n+                </div>\n+                <div class="rule-operations flex-shrink-0">\n                     <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n-                       class="pat-plone-modal plone-btn-primary btn btn-primary"\n+                       class="pat-plone-modal plone-btn-primary btn btn-sm btn-primary"\n                        tal:condition="condition/editview" i18n:translate="label_edit">Edit</a>\n                     <button type="submit"\n                            name="form.button.DeleteCondition"\n                            value="Remove"\n-                           class="context btn btn-danger"\n+                           class="context btn btn-sm btn-danger"\n                            i18n:attributes="value label_remove;"\n                            i18n:translate="label_remove"\n                            >Remove</button>\n@@ -69,21 +76,15 @@\n                            type="submit"\n                            name="form.button.MoveConditionUp"\n                            value="&uarr;"\n-                           class="context btn btn-primary"\n+                           class="context btn btn-sm btn-primary"\n                            >&uarr;</button>\n                     <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n                            type="submit"\n                            name="form.button.MoveConditionDown"\n                            value="&darr;"\n-                           class="context btn btn-primary"\n+                           class="context btn btn-sm btn-primary"\n                            >&darr;</button>\n                 </div>\n-                <div class="portalMessage warning">\n-                    <strong tal:content="condition/title" i18n:translate="">Transition was publish.</strong>\n-                    <span tal:content="condition/summary">\n-                        Something happened\n-                    </span>\n-                </div>\n             </div>\n         </form>\n \n@@ -96,14 +97,14 @@\n                     Add condition\n                 </label>\n \n-                <select name=":action" size="1" id="contentrules-add-condition" class="form-control">\n+                <select name=":action" size="1" id="contentrules-add-condition" class="form-select">\n                     <tal:block repeat="condition view/addable_conditions">\n                         <option tal:attributes="value condition/addview"\n                                 i18n:translate=""\n                                 tal:content="condition/title" />\n                     </tal:block>\n                 </select>\n-                <button class="context allowMultiSubmit btn btn-primary"\n+                <button class="context allowMultiSubmit btn btn-sm btn-primary"\n                        type="submit"\n                        name="form.button.AddCondition"\n                        value="Add"\n@@ -115,31 +116,39 @@\n     </fieldset>\n \n     <fieldset id="configure-actions" tal:define="actions view/actions">\n-        <legend i18n:translate="contentrules_perform_actions">\n+        <div tal:condition="not:actions" class="alert alert-warning">\n+            <strong i18n:translate="">Warning</strong>\n+            <span i18n:translate="">\n+                There is not any action performed by this rule.\n+                Click on Add button to setup an action.\n+            </span>\n+        </div>\n+\n+        <legend tal:condition="actions" i18n:translate="contentrules_perform_actions">\n             Perform the following actions:\n         </legend>\n-        <a name="action"></a>\n-        <div tal:condition="not:actions" class="portalMessage warning">\n-          <strong>Warning</strong>\n-          <span i18n:translate="">\n-          There is not any action performed by this rule.\n-          Click on Add button to setup an action.\n-          </span>\n-        </div>\n+\n         <form class="mb-3" tal:attributes="action view/view_url" method="post"\n               tal:define="auth_token context/@@authenticator/token"\n               tal:repeat="action actions">\n             <span tal:replace="structure context/@@authenticator/authenticator"></span>\n             <a tal:attributes="name string:action++${action/idx}"></a>\n             <input type="hidden" name="element_id:int" tal:attributes="value action/idx" />\n-            <div class="rule-element">\n-                <div class="rule-operations">\n+            <div class="rule-element border border-secondary rounded d-flex align-items-center justify-content-between px-2">\n+                <div>\n+                    <strong tal:content="action/title"\n+                    i18n:translate="">Move to folder</strong>\n+                    <span tal:content="action/summary">\n+                        Something happened\n+                    </span>\n+                </div>\n+                <div class="rule-operations flex-shrink-0">\n                     <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}" class="pat-plone-modal"\n                        tal:condition="action/editview">\n                       <button type="submit"\n                              name="form.button.EditAction"\n                              value="Edit"\n-                             class="context btn btn-primary"\n+                             class="context btn btn-sm btn-primary"\n                              i18n:attributes="value label_edit;"\n                              i18n:translate="label_edit;"\n                              >Edit</button>\n@@ -147,7 +156,7 @@\n                     <button type="submit"\n                            name="form.button.DeleteAction"\n                            value="Remove"\n-                           class="context btn btn-danger"\n+                           class="context btn btn-sm btn-danger"\n                            i18n:attributes="value label_remove;"\n                            i18n:translate="label_remove"\n                            >Remove</button>\n@@ -155,22 +164,15 @@\n                            type="submit"\n                            name="form.button.MoveActionUp"\n                            value="&uarr;"\n-                           class="context btn btn-primary"\n+                           class="context btn btn-sm btn-primary"\n                            >&uarr;</button>\n                     <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n                            type="submit"\n                            name="form.button.MoveActionDown"\n                            value="&darr;"\n-                           class="context btn btn-primary"\n+                           class="context btn btn-sm btn-primary"\n                            >&darr;</button>\n                 </div>\n-                <div class="portalMessage warning">\n-                    <strong tal:content="action/title"\n-                        i18n:translate="">Move to folder</strong>\n-                    <span tal:content="action/summary">\n-                        Something happened\n-                    </span>\n-                </div>\n             </div>\n         </form>\n \n@@ -180,14 +182,14 @@\n             <div class="chooser-right">\n                 <label class="form-label" i18n:translate="contentrules_add_action"\n                        for="contentrules-add-action">Add action</label>\n-                <select name=":action" size="1" id="contentrules-add-action" class="form-control">\n+                <select name=":action" size="1" id="contentrules-add-action" class="form-select">\n                     <tal:block repeat="action view/addable_actions">\n                         <option tal:attributes="value action/addview"\n                                 i18n:translate=""\n                                 tal:content="action/title"></option>\n                     </tal:block>\n                 </select>\n-                <button class="context allowMultiSubmit btn btn-primary"\n+                <button class="context allowMultiSubmit btn btn-sm btn-primary"\n                        type="submit"\n                        name="form.button.AddAction"\n                        value="Add"\n@@ -203,7 +205,7 @@\n         <fieldset id="manage-assignments">\n           <legend i18n:translate="label_contentrules_rule_assignments">Assignments</legend>\n           <tal:noassignments condition="not:assignments">\n-            <div class="portalMessage warning">\n+            <div class="alert alert-warning">\n               <strong i18n:translate="">This rule is not assigned to any location</strong>\n \n             <tal:enabled condition="view/rule_enabled">\n@@ -219,7 +221,7 @@\n               <form class="mb-3" tal:attributes="action view/view_url" method="post">\n                 <span tal:replace="structure context/@@authenticator/authenticator"/>\n                 <label class="form-label" i18n:translate="contentrules_assignments_shortcuts">Shortcuts:</label>\n-                <input type="submit" class="btn btn-primary"\n+                <input type="submit" class="btn btn-sm btn-primary"\n                        value="Apply rule on the whole site"\n                        name="form.button.ApplyOnWholeSite"\n                        i18n:attributes="value" />\n@@ -229,7 +231,7 @@\n \n           </tal:noassignments>\n           <tal:assignments condition="nocall:assignments">\n-            <div class="portalMessage info">\n+            <div class="alert alert-secondary">\n               <strong>Info</strong>\n               <span\n                 i18n:translate="description_contentrules_rule_assignments">\n@@ -250,61 +252,61 @@\n \n     <fieldset id="configure-rule">\n         <legend i18n:translate="">Configure rule</legend>\n-        <form class="mb-3" tal:attributes="action view/view_url" method="post">\n+        <form tal:attributes="action view/view_url" method="post">\n             <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <div class="field">\n-                <label for="form.title" i18n:translate="label_title">Title</label>\n-                <div class="formHelp" i18n:translate="description_contentrule_title">\n-                    Please set a descriptive title for the rule.\n-                </div>\n+            <div class="mb-3">\n+                <label class="form-label" for="form.title" i18n:translate="label_title">Title</label>\n                 <input id="form.title" class="form-control" type="text" width="50" name="title"\n                     tal:attributes="value request/ruleTitle | view/rule_title"/>\n-            </div>\n-            <div class="field">\n-                <label for="form.description" i18n:translate="label_description">Description</label>\n-                <div class="formHelp" i18n:translate="contentrules_description_description">\n-                    Enter a short description of the rule and its purpose.\n+                <div class="form-text" i18n:translate="description_contentrule_title">\n+                    Please set a descriptive title for the rule.\n                 </div>\n+            </div>\n+            <div class="mb-3">\n+                <label class="form-label" for="form.description" i18n:translate="label_description">Description</label>\n                 <textarea id="form.description" class="form-control" name="description"\n-                          tal:content="request/ruleDescription | view/rule_description ">\n+                    tal:content="request/ruleDescription | view/rule_description ">\n                 </textarea>\n+                <div class="form-text" i18n:translate="contentrules_description_description">\n+                    Enter a short description of the rule and its purpose.\n+                </div>\n             </div>\n \n-            <div class="field">\n-                <label i18n:translate="label_rule_event_trigger">\n-                    Event trigger: <span i18n:name="trigger" tal:content="view/rule_event"></span>\n-                </label>\n-                <div class="formHelp" i18n:translate="contentrules_description_trigger">\n+            <div class="mb-3">\n+                <div class="form-label" i18n:translate="contentrules_description_trigger">\n                     The rule will execute when the following event occurs.\n                 </div>\n+                <label class="form-text" i18n:translate="label_rule_event_trigger">\n+                    Event trigger: <span i18n:name="trigger" tal:content="view/rule_event"></span>\n+                </label>\n             </div>\n \n-            <div class="field">\n-                <input type="checkbox" id="stop" name="stopExecuting"\n+            <div class="mb-3 form-check">\n+                <input type="checkbox" id="stop" name="stopExecuting" class="form-check-input"\n                        tal:attributes="checked view/rule_stop"/>\n-                <label for="stop" i18n:translate="contentrules_description_stop">\n+                <label class="form-check-label" for="stop" i18n:translate="contentrules_description_stop">\n                     Stop evaluating content rules after this rule completes\n                 </label>\n             </div>\n \n-            <div class="field">\n-                <input type="checkbox" id="cascading" name="cascading"\n+            <div class="mb-3 form-check">\n+                <input type="checkbox" id="cascading" name="cascading" class="form-check-input"\n                        tal:attributes="checked view/rule_cascading"/>\n-                <label for="cascading" i18n:translate="contentrules_description_cascading">\n+                <label class="form-check-label" for="cascading" i18n:translate="contentrules_description_cascading">\n                     The actions executed by this rule can trigger other rules\n                 </label>\n             </div>\n \n-            <div class="field">\n-                <input type="checkbox" id="enabled" name="enabled"\n+            <div class="mb-3 form-check">\n+                <input type="checkbox" id="enabled" name="enabled" class="form-check-input"\n                        tal:attributes="checked view/rule_enabled"/>\n-                <label for="enabled" i18n:translate="">\n+                <label class="form-check-label" for="enabled" i18n:translate="">\n                     Enabled\n                 </label>\n             </div>\n \n-            <div class="formControls">\n-                <button class="context btn btn-primary"\n+            <div class="mb-3">\n+                <button class="context btn btn-sm btn-primary"\n                        type="submit"\n                        name="form.button.Save"\n                        value="Save"\n'

