Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-02-12T15:14:11+01:00
Author: Thomas Clement Mogensen (tmog) <mogensen@diku.dk>
Commit: https://github.com/plone/Products.CMFPlone/commit/946b6bff6720df21088aa172ff728739d80844eb

fix #1382 get email_from_name from settings registry

Files changed:
M Products/CMFPlone/browser/author.py
M Products/CMFPlone/browser/templates/author_feedback_template.pt

diff --git a/Products/CMFPlone/browser/author.py b/Products/CMFPlone/browser/author.py
index 66bb948..0977a19 100644
--- a/Products/CMFPlone/browser/author.py
+++ b/Products/CMFPlone/browser/author.py
@@ -104,7 +104,8 @@ def handle_send(self, action):
             message = self.feedback_template(
                 self, send_from_address=send_from_address,
                 sender_id=sender_id, url=referer, subject=subject,
-                message=message, encoding=email_charset
+                message=message, encoding=email_charset,
+                email_from_name=mail_settings.email_from_name
             )
 
             message = message.encode(email_charset)
diff --git a/Products/CMFPlone/browser/templates/author_feedback_template.pt b/Products/CMFPlone/browser/templates/author_feedback_template.pt
index d31d10f..412e3f1 100644
--- a/Products/CMFPlone/browser/templates/author_feedback_template.pt
+++ b/Products/CMFPlone/browser/templates/author_feedback_template.pt
@@ -5,14 +5,13 @@
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone"
      tal:omit-tag=""
-     tal:define="portal context/@@plone_portal_state/portal;
-                 dummy python:request.RESPONSE.setHeader('Content-Type', 'text/html;;charset=%s' % options['encoding']);"
+     tal:define="dummy python:request.RESPONSE.setHeader('Content-Type', 'text/html;;charset=%s' % options['encoding']);"
 >
 
 <span tal:omit-tag="" tal:content="options/message | nothing" />
 
 --
-<span tal:replace="portal/email_from_name" />
+<span tal:replace="options/email_from_name" />
 
 <div i18n:translate="author_feedback_mailtemplate_body" tal:omit-tag="" tal:condition="options/url">
 You are receiving this mail because <span i18n:name="from_address"
@@ -22,4 +21,4 @@ tal:omit-tag="" tal:content="options/sender_id"/> is sending feedback about cont
 <div i18n:translate="author_message_mailtemplate_body" tal:omit-tag="" tal:condition="not:options/url">
 You have received a message from <span i18n:name="from_address" tal:omit-tag="" tal:content="options/sender_id"/>.
 </div>
-</div>
\ No newline at end of file
+</div>


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-02-12T21:49:47+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/0130e3fdc49b6417a0352f1e045427f78ea8a789

Merge remote-tracking branch 'origin/author_feedback_form'

Files changed:
M Products/CMFPlone/browser/author.py
M Products/CMFPlone/browser/templates/author_feedback_template.pt

diff --git a/Products/CMFPlone/browser/author.py b/Products/CMFPlone/browser/author.py
index 66bb948..0977a19 100644
--- a/Products/CMFPlone/browser/author.py
+++ b/Products/CMFPlone/browser/author.py
@@ -104,7 +104,8 @@ def handle_send(self, action):
             message = self.feedback_template(
                 self, send_from_address=send_from_address,
                 sender_id=sender_id, url=referer, subject=subject,
-                message=message, encoding=email_charset
+                message=message, encoding=email_charset,
+                email_from_name=mail_settings.email_from_name
             )
 
             message = message.encode(email_charset)
diff --git a/Products/CMFPlone/browser/templates/author_feedback_template.pt b/Products/CMFPlone/browser/templates/author_feedback_template.pt
index d31d10f..412e3f1 100644
--- a/Products/CMFPlone/browser/templates/author_feedback_template.pt
+++ b/Products/CMFPlone/browser/templates/author_feedback_template.pt
@@ -5,14 +5,13 @@
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone"
      tal:omit-tag=""
-     tal:define="portal context/@@plone_portal_state/portal;
-                 dummy python:request.RESPONSE.setHeader('Content-Type', 'text/html;;charset=%s' % options['encoding']);"
+     tal:define="dummy python:request.RESPONSE.setHeader('Content-Type', 'text/html;;charset=%s' % options['encoding']);"
 >
 
 <span tal:omit-tag="" tal:content="options/message | nothing" />
 
 --
-<span tal:replace="portal/email_from_name" />
+<span tal:replace="options/email_from_name" />
 
 <div i18n:translate="author_feedback_mailtemplate_body" tal:omit-tag="" tal:condition="options/url">
 You are receiving this mail because <span i18n:name="from_address"
@@ -22,4 +21,4 @@ tal:omit-tag="" tal:content="options/sender_id"/> is sending feedback about cont
 <div i18n:translate="author_message_mailtemplate_body" tal:omit-tag="" tal:condition="not:options/url">
 You have received a message from <span i18n:name="from_address" tal:omit-tag="" tal:content="options/sender_id"/>.
 </div>
-</div>
\ No newline at end of file
+</div>


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2016-02-12T21:51:31+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/34d66f02fc86d6147af2dbe3ce2c5fd12a9d60ea

Added changelog entry.

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index a4cec22..34ed3bf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,10 @@ New:
 
 Fixes:
 
+- Get ``email_from_name`` from the mail settings registry.
+  Fixes https://github.com/plone/Products.CMFPlone/issues/1382
+  [tmog]
+
 - No longer rely on deprecated ``bobobase_modification_time`` from
   ``Persistence.Persistent``.
   [thet]


