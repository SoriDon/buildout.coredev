Repository: plone.app.users


Branch: refs/heads/master
Date: 2018-06-18T17:17:55+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.users/commit/dbbef62dbe0da1cdc318efe562b086e818c6f493

another test fix for plone.login merge

Files changed:
M plone/app/users/browser/register.py
M plone/app/users/browser/registered.pt
M plone/app/users/tests/email_login.rst

b'diff --git a/plone/app/users/browser/register.py b/plone/app/users/browser/register.py\nindex 6b5ecd0..9b6122c 100644\n--- a/plone/app/users/browser/register.py\n+++ b/plone/app/users/browser/register.py\n@@ -495,7 +495,6 @@ def handle_join_success(self, data):\n                           "to your email address: ${address}",\n                           mapping={u\'address\': data.get(\'email\', \'\')}),\n                         type=\'error\')\n-                    return\n                 else:\n                     # This should only happen when an admin registers\n                     # a user.  The admin should have seen a warning\n@@ -507,9 +506,6 @@ def handle_join_success(self, data):\n                           "password to this email address: ${address}",\n                           mapping={u\'address\': data.get(\'email\', \'\')}),\n                         type=\'warning\')\n-                    return\n-\n-        return\n \n     def applyProperties(self, userid, data):\n         portal = getToolByName(self.context, \'portal_url\').getPortalObject()\n@@ -694,8 +690,9 @@ def action_join(self, action):\n         portal_groups = getToolByName(self.context, \'portal_groups\')\n         user_id = data[\'user_id\']\n         is_zope_manager = getSecurityManager().checkPermission(\n-            ManagePortal, self.context)\n-\n+            ManagePortal,\n+            self.context,\n+        )\n         try:\n             # Add user to the selected group(s)\n             if \'groups\' in data.keys():\ndiff --git a/plone/app/users/browser/registered.pt b/plone/app/users/browser/registered.pt\nindex af64f8e..8566ece 100644\n--- a/plone/app/users/browser/registered.pt\n+++ b/plone/app/users/browser/registered.pt\n@@ -89,6 +89,7 @@\n                     <input class="standalone"\n                            type="submit"\n                            value="Log in"\n+                           name="buttons.login"\n                            i18n:attributes="value label_log_in;"\n                            />\n                 </form>\ndiff --git a/plone/app/users/tests/email_login.rst b/plone/app/users/tests/email_login.rst\nindex c99985a..19f28e2 100644\n--- a/plone/app/users/tests/email_login.rst\n+++ b/plone/app/users/tests/email_login.rst\n@@ -83,8 +83,8 @@ Fill out the form, using an odd email address that should not give problems.\n     We login as manager. The login form now has a different label for\n     the login name.\n     >>> browser.open(\'http://nohost/plone/login_form\')\n-    >>> browser.getControl(\'E-mail\').value = SITE_OWNER_NAME\n-    >>> browser.getControl(\'Password\').value = SITE_OWNER_PASSWORD\n+    >>> browser.getControl(name=\'__ac_name\').value = SITE_OWNER_NAME\n+    >>> browser.getControl(name=\'__ac_password\').value = SITE_OWNER_PASSWORD\n     >>> browser.getControl(\'Log in\').click()\n \n The user id is now bob-jones, based on the full name:\n'

