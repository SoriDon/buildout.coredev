Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-12-11T10:01:45+01:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/045ac7197be6f4260ed1ca82bae1bde205459ace

fix: do not include domain in internal links and images src

Files changed:
M CHANGES.rst
M Products/CMFPlone/patterns/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 85a3e7e..7e9c8c9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -52,6 +52,9 @@ New:
 
 Fixes:
 
+- Fix internal links and images src to not include the domain.
+  [Gagaro]
+
 - Update Site Setup link in all control panels (fixes .. _`#1255`)
   [davilima6]
 
diff --git a/Products/CMFPlone/patterns/__init__.py b/Products/CMFPlone/patterns/__init__.py
index 3588322..dd87eae 100644
--- a/Products/CMFPlone/patterns/__init__.py
+++ b/Products/CMFPlone/patterns/__init__.py
@@ -26,6 +26,7 @@ def __init__(self, context, request):
         self.settings = registry.forInterface(
             ITinyMCESchema, prefix="plone", check=False)
         self.portal_url = get_portal_url(self.portal)
+        self.portal_url_path = self.portal.absolute_url_path()
 
     def get_theme(self):
         return theming_policy().get_theme()
@@ -261,7 +262,7 @@ def tinymce(self):
             'tiny': generator.get_tiny_config(),
             # This is for loading the languages on tinymce
             'loadingBaseUrl': '%s/++plone++static/components/tinymce-builded/js/tinymce' % generator.portal_url,  # noqa
-            'prependToUrl': '{0}/resolveuid/'.format(generator.portal_url),
+            'prependToUrl': '{0}/resolveuid/'.format(generator.portal_url_path),
             'linkAttribute': 'UID',
             'prependToScalePart': '/@@images/image/',
             'imageTypes': image_types


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-12-11T17:17:09+01:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/4ddb1227922b3cc11e857f4093fae6daed43d630

Merge pull request #1287 from plone/fix-internal-links

fix: do not include domain in internal links and images src

Files changed:
M CHANGES.rst
M Products/CMFPlone/patterns/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 85a3e7e..7e9c8c9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -52,6 +52,9 @@ New:
 
 Fixes:
 
+- Fix internal links and images src to not include the domain.
+  [Gagaro]
+
 - Update Site Setup link in all control panels (fixes .. _`#1255`)
   [davilima6]
 
diff --git a/Products/CMFPlone/patterns/__init__.py b/Products/CMFPlone/patterns/__init__.py
index 3588322..dd87eae 100644
--- a/Products/CMFPlone/patterns/__init__.py
+++ b/Products/CMFPlone/patterns/__init__.py
@@ -26,6 +26,7 @@ def __init__(self, context, request):
         self.settings = registry.forInterface(
             ITinyMCESchema, prefix="plone", check=False)
         self.portal_url = get_portal_url(self.portal)
+        self.portal_url_path = self.portal.absolute_url_path()
 
     def get_theme(self):
         return theming_policy().get_theme()
@@ -261,7 +262,7 @@ def tinymce(self):
             'tiny': generator.get_tiny_config(),
             # This is for loading the languages on tinymce
             'loadingBaseUrl': '%s/++plone++static/components/tinymce-builded/js/tinymce' % generator.portal_url,  # noqa
-            'prependToUrl': '{0}/resolveuid/'.format(generator.portal_url),
+            'prependToUrl': '{0}/resolveuid/'.format(generator.portal_url_path),
             'linkAttribute': 'UID',
             'prependToScalePart': '/@@images/image/',
             'imageTypes': image_types


