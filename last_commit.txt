Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2022-02-17T08:27:31+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/7591dfab6d32623d2f58fbca14d9ae04aab5e255

No text attribute (#540)

* fix: context might not have a text attribute

* Add news entry

Files changed:
A news/1.bugfix
M plone/app/contenttypes/behaviors/richtext.py

b"diff --git a/news/1.bugfix b/news/1.bugfix\nnew file mode 100644\nindex 00000000..9df252e3\n--- /dev/null\n+++ b/news/1.bugfix\n@@ -0,0 +1,3 @@\n+A content type with the richtext behavior might not have a `text` attribute,\n+handle that gracefully.\n+[gforcada]\ndiff --git a/plone/app/contenttypes/behaviors/richtext.py b/plone/app/contenttypes/behaviors/richtext.py\nindex 5809a65c..ed7feeef 100644\n--- a/plone/app/contenttypes/behaviors/richtext.py\n+++ b/plone/app/contenttypes/behaviors/richtext.py\n@@ -1,4 +1,5 @@\n # -*- coding: utf-8 -*-\n+from Acquisition import aq_base\n from plone.app.contenttypes import _\n from plone.app.textfield import RichText as RichTextField\n from plone.app.z3cform.widget import RichTextFieldWidget\n@@ -38,7 +39,7 @@ def __init__(self, context):\n \n     @property\n     def text(self):\n-        return self.context.text\n+        return getattr(aq_base(self.context), 'text', '')\n \n     @text.setter\n     def text(self, value):\n"

