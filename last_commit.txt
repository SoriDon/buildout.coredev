Repository: plone.app.users


Branch: refs/heads/master
Date: 2021-10-07T17:22:41+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.users/commit/db322f08598fc19ad56a531db851c5740c339106

remove bbb adapter to access controlpanel registry data

Files changed:
A news/104.bugfix
M plone/app/users/browser/register.py

b'diff --git a/news/104.bugfix b/news/104.bugfix\nnew file mode 100644\nindex 0000000..b060b88\n--- /dev/null\n+++ b/news/104.bugfix\n@@ -0,0 +1,3 @@\n+Use registry API to access usergroup settings. \n+Removes usages of deprecated API. \n+[jensens]\ndiff --git a/plone/app/users/browser/register.py b/plone/app/users/browser/register.py\nindex c4985db..ee767a9 100644\n--- a/plone/app/users/browser/register.py\n+++ b/plone/app/users/browser/register.py\n@@ -647,10 +647,8 @@ def updateFields(self):\n                 not settings.enable_user_pwd_choice\n \n         # Append the manager-focused fields\n-        user_group_settings = getAdapter(\n-            aq_inner(self.context),\n-            IUserGroupsSettingsSchema,\n-        )\n+        registry = getUtility(IRegistry)\n+        user_group_settings = registry.forInterface(IUserGroupsSettingsSchema, prefix="plone")\n         many_groups = user_group_settings.many_groups\n         if not many_groups:\n             allFields = defaultFields + field.Fields(IAddUserSchema)\n'

Repository: plone.app.users


Branch: refs/heads/master
Date: 2021-10-08T12:37:11+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.users/commit/7132145e3306a99a268f3683daab9d3afdac6f52

Merge pull request #104 from plone/rm-bbb-controlpanel-adapter

Remove bbb adapter to access controlpanel registry data

Files changed:
A news/104.bugfix
M plone/app/users/browser/register.py

b'diff --git a/news/104.bugfix b/news/104.bugfix\nnew file mode 100644\nindex 0000000..b060b88\n--- /dev/null\n+++ b/news/104.bugfix\n@@ -0,0 +1,3 @@\n+Use registry API to access usergroup settings. \n+Removes usages of deprecated API. \n+[jensens]\ndiff --git a/plone/app/users/browser/register.py b/plone/app/users/browser/register.py\nindex c4985db..ee767a9 100644\n--- a/plone/app/users/browser/register.py\n+++ b/plone/app/users/browser/register.py\n@@ -647,10 +647,8 @@ def updateFields(self):\n                 not settings.enable_user_pwd_choice\n \n         # Append the manager-focused fields\n-        user_group_settings = getAdapter(\n-            aq_inner(self.context),\n-            IUserGroupsSettingsSchema,\n-        )\n+        registry = getUtility(IRegistry)\n+        user_group_settings = registry.forInterface(IUserGroupsSettingsSchema, prefix="plone")\n         many_groups = user_group_settings.many_groups\n         if not many_groups:\n             allFields = defaultFields + field.Fields(IAddUserSchema)\n'

