Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-09-27T13:38:57+02:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/e701dd52685e0527eeedb324d907e58ff41b4bc9

Remove unused mail_password.py from skins/plone_scripts

Files changed:
M CHANGES.rst
D Products/CMFPlone/skins/plone_scripts/mail_password.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 6abe6b79e..65ab55379 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -135,6 +135,9 @@ Bug Fixes:\n   This is a follow up to `issue 476 <https://github.com/plone/plone.app.contenttypes/issues/476>`_.\n   [iham]\n \n+- Remove unused mail_password.py from skins/plone_scripts\n+  [agitator]\n+\n - Hide ``plone.app.querystring`` from add-ons control panel.\n   Fixes `issue 2426 <https://github.com/plone/Products.CMFPlone/issues/2426>`_.\n   [maurits]\ndiff --git a/Products/CMFPlone/skins/plone_scripts/mail_password.py b/Products/CMFPlone/skins/plone_scripts/mail_password.py\ndeleted file mode 100644\nindex 902d427c1..000000000\n--- a/Products/CMFPlone/skins/plone_scripts/mail_password.py\n+++ /dev/null\n@@ -1,26 +0,0 @@\n-## Script (Python) "mail_password"\n-##bind container=container\n-##bind context=context\n-##bind namespace=\n-##bind script=script\n-##bind subpath=traverse_subpath\n-##title=Mail a user\'s password\n-##parameters=\n-\n-from Products.CMFPlone import PloneMessageFactory as pmf\n-from AccessControl import Unauthorized\n-\n-REQUEST = context.REQUEST\n-try:\n-    response = context.portal_registration.mailPassword(\n-                    REQUEST.get(\'userid\', \'\'), REQUEST)\n-except ValueError as e:\n-    try:\n-        msg = pmf(str(e))\n-    except Unauthorized:\n-        # If we are not allowed to tell the user, what is wrong, he\n-        # should get an error message and contact the admins\n-        raise e\n-    context.plone_utils.addPortalMessage(msg)\n-    response = context.mail_password_form()\n-return response\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-09-28T00:29:13+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/e9c8f557d930ed3ed8b566a55b98f36fce61b129

seemis it was used, wow

Files changed:
A Products/CMFPlone/browser/login/mail_password.py
M Products/CMFPlone/browser/login/configure.zcml

b'diff --git a/Products/CMFPlone/browser/login/configure.zcml b/Products/CMFPlone/browser/login/configure.zcml\nindex e56bbb0b7..f576522ac 100644\n--- a/Products/CMFPlone/browser/login/configure.zcml\n+++ b/Products/CMFPlone/browser/login/configure.zcml\n@@ -106,6 +106,13 @@\n         permission="zope.Public"\n         />\n \n+    <browser:page\n+        name="mail_password"\n+        for="*"\n+        class=".mail_password.MailPasswordView"\n+        permission="zope.Public"\n+        />\n+\n     <browser:page\n         name="mail_password_response"\n         for="*"\ndiff --git a/Products/CMFPlone/browser/login/mail_password.py b/Products/CMFPlone/browser/login/mail_password.py\nnew file mode 100644\nindex 000000000..63dda4b13\n--- /dev/null\n+++ b/Products/CMFPlone/browser/login/mail_password.py\n@@ -0,0 +1,27 @@\n+# -*- coding: utf-8 -*-\n+from AccessControl import Unauthorized\n+from Products.CMFPlone import PloneMessageFactory as _\n+from Products.Five import BrowserView\n+from Products.statusmessages.interfaces import IStatusMessage\n+\n+\n+class MailPasswordView(BrowserView):\n+\n+    def __call__(self):\n+        try:\n+            response = self.context.portal_registration.mailPassword(\n+                self.request.form.get(\'userid\', \'\'),\n+                self.request,\n+            )\n+        except ValueError as e:\n+            try:\n+                msg = _(str(e))\n+            except Unauthorized:\n+                # If we are not allowed to tell the user, what is wrong, he\n+                # should get an error message and contact the admins\n+                raise e\n+            IStatusMessage(self.request).add(msg)\n+            self.request.response.redirect(\n+                self.context.absolute_url() + \'mail_password_form\'\n+            )\n+        return response\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-09-28T01:20:39+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/96b1b092818f7c7c84bddbd5928aa8b1186cef57

Merge pull request #2444 from plone/remove_unused_mail_password_script

Remove unused mail_password.py from skins/plone_scripts

Files changed:
A Products/CMFPlone/browser/login/mail_password.py
M CHANGES.rst
M Products/CMFPlone/browser/login/configure.zcml
D Products/CMFPlone/skins/plone_scripts/mail_password.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 6abe6b79e..65ab55379 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -135,6 +135,9 @@ Bug Fixes:\n   This is a follow up to `issue 476 <https://github.com/plone/plone.app.contenttypes/issues/476>`_.\n   [iham]\n \n+- Remove unused mail_password.py from skins/plone_scripts\n+  [agitator]\n+\n - Hide ``plone.app.querystring`` from add-ons control panel.\n   Fixes `issue 2426 <https://github.com/plone/Products.CMFPlone/issues/2426>`_.\n   [maurits]\ndiff --git a/Products/CMFPlone/browser/login/configure.zcml b/Products/CMFPlone/browser/login/configure.zcml\nindex e56bbb0b7..f576522ac 100644\n--- a/Products/CMFPlone/browser/login/configure.zcml\n+++ b/Products/CMFPlone/browser/login/configure.zcml\n@@ -106,6 +106,13 @@\n         permission="zope.Public"\n         />\n \n+    <browser:page\n+        name="mail_password"\n+        for="*"\n+        class=".mail_password.MailPasswordView"\n+        permission="zope.Public"\n+        />\n+\n     <browser:page\n         name="mail_password_response"\n         for="*"\ndiff --git a/Products/CMFPlone/browser/login/mail_password.py b/Products/CMFPlone/browser/login/mail_password.py\nnew file mode 100644\nindex 000000000..63dda4b13\n--- /dev/null\n+++ b/Products/CMFPlone/browser/login/mail_password.py\n@@ -0,0 +1,27 @@\n+# -*- coding: utf-8 -*-\n+from AccessControl import Unauthorized\n+from Products.CMFPlone import PloneMessageFactory as _\n+from Products.Five import BrowserView\n+from Products.statusmessages.interfaces import IStatusMessage\n+\n+\n+class MailPasswordView(BrowserView):\n+\n+    def __call__(self):\n+        try:\n+            response = self.context.portal_registration.mailPassword(\n+                self.request.form.get(\'userid\', \'\'),\n+                self.request,\n+            )\n+        except ValueError as e:\n+            try:\n+                msg = _(str(e))\n+            except Unauthorized:\n+                # If we are not allowed to tell the user, what is wrong, he\n+                # should get an error message and contact the admins\n+                raise e\n+            IStatusMessage(self.request).add(msg)\n+            self.request.response.redirect(\n+                self.context.absolute_url() + \'mail_password_form\'\n+            )\n+        return response\ndiff --git a/Products/CMFPlone/skins/plone_scripts/mail_password.py b/Products/CMFPlone/skins/plone_scripts/mail_password.py\ndeleted file mode 100644\nindex 902d427c1..000000000\n--- a/Products/CMFPlone/skins/plone_scripts/mail_password.py\n+++ /dev/null\n@@ -1,26 +0,0 @@\n-## Script (Python) "mail_password"\n-##bind container=container\n-##bind context=context\n-##bind namespace=\n-##bind script=script\n-##bind subpath=traverse_subpath\n-##title=Mail a user\'s password\n-##parameters=\n-\n-from Products.CMFPlone import PloneMessageFactory as pmf\n-from AccessControl import Unauthorized\n-\n-REQUEST = context.REQUEST\n-try:\n-    response = context.portal_registration.mailPassword(\n-                    REQUEST.get(\'userid\', \'\'), REQUEST)\n-except ValueError as e:\n-    try:\n-        msg = pmf(str(e))\n-    except Unauthorized:\n-        # If we are not allowed to tell the user, what is wrong, he\n-        # should get an error message and contact the admins\n-        raise e\n-    context.plone_utils.addPortalMessage(msg)\n-    response = context.mail_password_form()\n-return response\n'

