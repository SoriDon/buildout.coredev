Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:28:40+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.app.contentrules/commit/b424acb0e26e1d196de496a798df917b907efe87

move contentrules into mockup/pat/controlpanels

Files changed:
M plone/app/contentrules/browser/configure.zcml
M plone/app/contentrules/browser/templates/controlpanel.pt
M plone/app/contentrules/browser/templates/manage-elements.pt
D plone/app/contentrules/browser/contentrule-elements.js
D plone/app/contentrules/browser/contentrules.js

b'diff --git a/plone/app/contentrules/browser/configure.zcml b/plone/app/contentrules/browser/configure.zcml\nindex 4418515..a97da0b 100644\n--- a/plone/app/contentrules/browser/configure.zcml\n+++ b/plone/app/contentrules/browser/configure.zcml\n@@ -183,21 +183,6 @@\n \n     </configure>\n \n-    <!-- Resources -->\n-    <browser:resource\n-        name="manage-contentrules.js"\n-        file="contentrules.js"\n-        />\n-    <!-- Resources -->\n-    <browser:resource\n-        name="manage-contentrule-elements.js"\n-        file="contentrule-elements.js"\n-        />\n-    <browser:resource\n-        name="manage-contentrules.css"\n-        file="contentrules.css"\n-        />\n-\n     <!-- Rule breadcrumb -->\n \n   <browser:page\ndiff --git a/plone/app/contentrules/browser/contentrule-elements.js b/plone/app/contentrules/browser/contentrule-elements.js\ndeleted file mode 100644\nindex 86f1101..0000000\n--- a/plone/app/contentrules/browser/contentrule-elements.js\n+++ /dev/null\n@@ -1,69 +0,0 @@\n-/* global require */\n-\n-var SKIP_OVERLAY_ACTIONS = [\n-  \'plone.actions.Delete\'\n-];\n-\n-require([\n-  \'jquery\',\n-  \'mockup-patterns-modal\'\n-], function($, Modal) {\n-  \'use strict\';\n-  function initforms(){\n-    $(\'#configure-conditions .rule-element input, #configure-actions .rule-element input\').unbind(\'click\').click(function(){\n-      var name = $(this).attr(\'name\');\n-      if(name==\'form.button.EditCondition\' || name==\'form.button.EditAction\'){\n-        return true;\n-      }\n-      $(\'#spinner\').show();\n-      var form = $(this).parents(\'form\').first();\n-      var fieldset = form.parents(\'fieldset\').first();\n-      var data = form.serialize() + \'&\' + name + \'=1\';\n-      var url = form.attr(\'action\');\n-      $.post(url, data, function(html){\n-        var newfieldset = $(html).find(\'#\' + fieldset.attr(\'id\'));\n-        fieldset.replaceWith(newfieldset);\n-        initforms();\n-        $(\'#spinner\').hide();\n-      });\n-      return false;\n-    });\n-\n-    $(\'input[name="form.button.AddCondition"],input[name="form.button.AddAction"]\').unbind(\'click\').click(function(e){\n-      var form = $(this).parent().parent();\n-      var data = form.serialize();\n-      for(var i=0; i<SKIP_OVERLAY_ACTIONS.length; i++){\n-        if(data.indexOf(SKIP_OVERLAY_ACTIONS[i]) !== -1){\n-          return;\n-        }\n-      }\n-      e.preventDefault();\n-      var url = form.attr(\'action\') + \'?\' + data;\n-      var conditionAnchor = $(\'<a href="\' + url + \'" />\').css(\'display\', \'none\');\n-      conditionAnchor.insertAfter(this);\n-      new Modal(conditionAnchor, {\n-        actionOptions: {\n-          isForm: true,\n-          redirectOnResponse: true,\n-          redirectToUrl: function(){\n-            /* reload on submit */\n-            return window.location.href;\n-          }\n-        }\n-      });\n-      conditionAnchor.trigger(\'click\');\n-    });\n-  }\n-  $(document).ready(function(){\n-    initforms();\n-\n-    /*\n-    var $config = $(\'#configure-rule\');\n-    $(\'form\', $config).hide();\n-    $(\'legend\', $config).replaceWith(\'<legend><a href="#">\' + $(\'legend\', $config).text() + \'</a></legend>\');\n-    $(\'legend a\', $config).click(function(e){\n-      e.preventDefault();\n-      $(\'form\', $config).slideToggle();\n-    });*/\n-  });\n-});\ndiff --git a/plone/app/contentrules/browser/contentrules.js b/plone/app/contentrules/browser/contentrules.js\ndeleted file mode 100644\nindex cdb9747..0000000\n--- a/plone/app/contentrules/browser/contentrules.js\n+++ /dev/null\n@@ -1,133 +0,0 @@\n-/* global require */\n-\n-require([\n-  \'jquery\',\n-], function($) {\n-  \'use strict\';\n-\n-  function updatezebra(table){\n-    table.find(\'tr:visible:odd\').removeClass(\'odd even\').addClass(\'odd\');\n-    table.find(\'tr:visible:even\').removeClass(\'odd even\').addClass(\'even\');\n-  }\n-\n-  function addStatusMessage(message, type){\n-    if(type === undefined){\n-      type = \'info\';\n-    }\n-    var _show = function(){\n-      var msg = $(\'<dl class="portalMessage \' + type + \'">\' +\n-                  \'<dt>\' + type + \'</dt>\' +\n-                  \'<dd>\' + message + \'</dd>\' +\n-                \'</dl>\');\n-      $(\'#content\').before(msg);\n-      msg.fadeIn();\n-    };\n-    var vis = $(\'dl.portalMessage:visible\');\n-    if(vis.length === 0){\n-      _show();\n-    }else{\n-      vis.fadeOut(_show);\n-    }\n-  }\n-\n-  // TODO find out why is it binding multiple times\n-  $(\'.btn-rule-action\').unbind(\'click\').bind(\'click\', function(e) {\n-    e.preventDefault();\n-\n-    var $this = $(this),\n-        $row = $this.parents(\'tr\').first(),\n-        $table = $row.parent(),\n-        id = $this.data(\'value\'),\n-        url = $this.data(\'url\');\n-\n-    $.ajax({\n-      type: \'POST\',\n-      url: url,\n-      data: {\n-        \'rule-id\': id,\n-        \'_authenticator\': $(\'input[name="_authenticator"]\').val()\n-      },\n-      beforeSend: function() {\n-        $(\'#spinner\').show();\n-      },\n-      error: function() {\n-        addStatusMessage($(\'#trns_form_error\').html(), \'warn\');\n-      },\n-      success: function() {\n-        // Enable\n-\n-        if($this.hasClass(\'btn-rule-enable\')) {\n-            $row.removeClass(\'state-disabled\').addClass(\'state-enabled\');\n-        }\n-\n-        // Disable\n-\n-        if($this.hasClass(\'btn-rule-disable\')) {\n-            $row.removeClass(\'state-enabled\').addClass(\'state-disabled\');\n-        }\n-\n-        // DELETE\n-\n-        if($this.hasClass(\'btn-rule-delete\')) {\n-            $row.remove();\n-            updatezebra($table);\n-        }\n-        addStatusMessage($(\'#trns_form_success\').html(), \'info\');\n-      },\n-      complete: function() {\n-        $(\'#spinner\').hide();\n-      }\n-    });\n-  });\n-\n-\n-  $(\'.filter-option input\').unbind(\'change\').bind(\'change\', function() {\n-    // Go through the checkboxes and map up what is the filtering criterea\n-    var $table = $(\'#rules_table_form table\');\n-    var state_filters = $(\'.state-filters input:checked\');\n-    var type_filters = $(\'.type-filters input:checked\');\n-\n-    $table.find(\'tr\').show();\n-    if(state_filters.length > 0){\n-      $(\'.state-filters input:not(:checked)\').each(function(){\n-        $table.find(\'.\' + this.id).hide();\n-      });\n-    }\n-    if(type_filters.length > 0){\n-      $(\'.type-filters input:not(:checked)\').each(function(){\n-        $table.find(\'.\' + this.id).hide();\n-      });\n-    }\n-      updatezebra($table);\n-  });\n-\n-  $(\'#rules_disable_globally\').change(function(){\n-    var form = $(\'#fieldset-global form\');\n-    var disabled = \'\';\n-    if($(\'#rules_disable_globally\')[0].checked){\n-      disabled = \'True\';\n-    }\n-\n-    $.ajax({\n-      type: \'POST\',\n-      url: form.attr(\'action\'),\n-      data: {\n-        \'global_disable:boolean\': disabled,\n-        \'_authenticator\': $(\'input[name="_authenticator"]\').val()\n-      },\n-      beforeSend: function() {\n-        $(\'#spinner\').show();\n-      },\n-      error: function() {\n-        addStatusMessage($(\'#trns_form_error\').html(), \'warn\');\n-      },\n-      success: function() {\n-        addStatusMessage($(\'#trns_form_success\').html(), \'info\');\n-      },\n-      complete: function() {\n-        $(\'#spinner\').hide();\n-      }\n-    });\n-  });\n-\n-});\ndiff --git a/plone/app/contentrules/browser/templates/controlpanel.pt b/plone/app/contentrules/browser/templates/controlpanel.pt\nindex b4035cc..3a86b0f 100644\n--- a/plone/app/contentrules/browser/templates/controlpanel.pt\n+++ b/plone/app/contentrules/browser/templates/controlpanel.pt\n@@ -11,13 +11,6 @@\n <metal:main metal:fill-slot="prefs_configlet_main"\n      tal:define="rules view/registeredRules">\n \n-  <script type="text/javascript" src="++resource++manage-contentrules.js"\n-      tal:attributes="src string:${context/portal_url}/++resource++manage-contentrules.js">\n-  </script>\n-  <link rel="stylesheet" type="text/css" media="all"\n-        href="++resource++manage-contentrules.css"\n-        tal:attributes="href string:${context/portal_url}/++resource++manage-contentrules.css" />\n-\n   <header>\n     <h1 class="documentFirstHeading"\n         i18n:translate="title_manage_contentrules">Content Rules</h1>\n@@ -145,15 +138,15 @@\n                                   i18n:translate="">trigger</span>\n                         </td>\n                         <td class="checker">\n-                            <span \n-                                class="badge badge-primary icon-contentrule-enabled-assigned" \n+                            <span\n+                                class="badge badge-primary icon-contentrule-enabled-assigned"\n                                 alt="enabled"\n                                 i18n:attributes="alt label_contentrules_rule_enabled;">\n                                   <i class="glyphicon glyphicon-ok"></i>\n                             </span>\n \n-                            <span \n-                                class="badge badge-danger icon-contentrule-enabled-unassigned" \n+                            <span\n+                                class="badge badge-danger icon-contentrule-enabled-unassigned"\n                                 alt="unassigned"\n                                 title="this rule has not been assigned"\n                                 i18n:attributes="alt label_contentrules_rule_unassigned;\ndiff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex b22d292..2144fc7 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -1,321 +1,360 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      lang="en"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      metal:use-macro="here/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+    xml:lang="en"\n+    lang="en"\n+    xmlns:metal="http://xml.zope.org/namespaces/metal"\n+    xmlns:tal="http://xml.zope.org/namespaces/tal"\n+    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+    metal:use-macro="here/prefs_main_template/macros/master"\n+    i18n:domain="plone">\n \n-<body>\n+    <body>\n \n-<div metal:fill-slot="prefs_configlet_main">\n+        <div metal:fill-slot="prefs_configlet_main">\n \n-    <link rel="stylesheet" type="text/css" media="all"\n-          href="++resource++manage-contentrules.css"\n-          tal:attributes="href string:${context/portal_url}/++resource++manage-contentrules.css" />\n+            <div class="pat-contentrules-elements">\n \n-    <script type="text/javascript" src="++resource++manage-contentrule-elements.js"\n-        tal:attributes="src string:${context/portal_url}/++resource++manage-contentrule-elements.js">\n-    </script>\n+                <h1 class="documentFirstHeading"\n+                    i18n:translate="title_edit_contentrule">Edit content rule</h1>\n \n-    <h1 class="documentFirstHeading"\n-        i18n:translate="title_edit_contentrule">Edit content rule</h1>\n-\n-    <a href=""\n-       class="link-parent"\n-       tal:attributes="href string:${portal_url}/@@rules-controlpanel"\n-       i18n:translate="go_to_contentrules_management">\n+                <a href=""\n+                    class="link-parent"\n+                    tal:attributes="href string:${portal_url}/@@rules-controlpanel"\n+                    i18n:translate="go_to_contentrules_management">\n         Up to rule management\n-    </a>\n+                </a>\n \n-     <p i18n:translate="contentrules_description_execution"\n-        class="documentDescription">\n+                <p i18n:translate="contentrules_description_execution"\n+                    class="documentDescription">\n         Rules execute when a triggering event occurs. Rule actions will only\n         be invoked if all the rule\'s conditions are met. You can add new\n         actions and conditions using the buttons below.\n-    </p>\n-\n-    <fieldset id="configure-conditions" tal:define="conditions view/conditions">\n+                </p>\n \n-        <div tal:condition="not:conditions" class="alert alert-secondary">\n-            <strong i18n:translate="">Info</strong>\n-            <span i18n:translate="">\n-                There is not any additional condition checked on this rule.\n-            </span>\n-        </div>\n-\n-        <legend tal:condition="conditions" i18n:translate="if_all_conditions_met">\n+                <fieldset id="configure-conditions"\n+                    tal:define="conditions view/conditions">\n+                    <legend i18n:translate="if_all_conditions_met">\n             If all of the following conditions are met:\n-        </legend>\n-\n-        <form class="mb-3" tal:attributes="action view/view_url" method="post"\n-              tal:define="auth_token context/@@authenticator/token"\n-              tal:repeat="condition conditions">\n-            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <a tal:attributes="name string:condition++${condition/idx}"></a>\n-            <input type="hidden" name="element_id:int" tal:attributes="value condition/idx" />\n-            <div class="rule-element border border-secondary rounded d-flex align-items-center justify-content-between px-2">\n-                <div>\n-                    <strong tal:content="condition/title" i18n:translate="">Transition was publish.</strong>\n-                    <span tal:content="condition/summary">\n+                    </legend>\n+                    <a name="condition"></a>\n+\n+                    <div tal:condition="not:conditions"\n+                        class="portalMessage info">\n+                        <strong>Info</strong>\n+                        <span i18n:translate="">\n+          There is not any additional condition checked on this rule.\n+                        </span>\n+                    </div>\n+                    <form class="mb-3"\n+                        tal:attributes="action view/view_url"\n+                        method="post"\n+                        tal:define="auth_token context/@@authenticator/token"\n+                        tal:repeat="condition conditions">\n+                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                        <a tal:attributes="name string:condition++${condition/idx}"></a>\n+                        <input type="hidden"\n+                            name="element_id:int"\n+                            tal:attributes="value condition/idx" />\n+                        <div class="rule-element">\n+                            <div class="rule-operations">\n+                                <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n+                                    class="pat-plone-modal plone-btn-primary btn btn-primary"\n+                                    tal:condition="condition/editview"\n+                                    i18n:translate="label_edit">Edit</a>\n+                                <button type="submit"\n+                                    name="form.button.DeleteCondition"\n+                                    value="Remove"\n+                                    class="context btn btn-danger"\n+                                    i18n:attributes="value label_remove;"\n+                                    i18n:translate="label_remove">Remove</button>\n+                                <button tal:attributes="disabled python:condition[\'first\'] and \'disabled\' or None"\n+                                    type="submit"\n+                                    name="form.button.MoveConditionUp"\n+                                    value="&uarr;"\n+                                    class="context btn btn-primary">&uarr;</button>\n+                                <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n+                                    type="submit"\n+                                    name="form.button.MoveConditionDown"\n+                                    value="&darr;"\n+                                    class="context btn btn-primary">&darr;</button>\n+                            </div>\n+                            <div class="portalMessage warning">\n+                                <strong tal:content="condition/title"\n+                                    i18n:translate="">Transition was publish.</strong>\n+                                <span tal:content="condition/summary">\n                         Something happened\n-                    </span>\n-                </div>\n-                <div class="rule-operations flex-shrink-0">\n-                    <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n-                       class="pat-plone-modal plone-btn-primary btn btn-sm btn-primary"\n-                       tal:condition="condition/editview" i18n:translate="label_edit">Edit</a>\n-                    <button type="submit"\n-                           name="form.button.DeleteCondition"\n-                           value="Remove"\n-                           class="context btn btn-sm btn-danger"\n-                           i18n:attributes="value label_remove;"\n-                           i18n:translate="label_remove"\n-                           >Remove</button>\n-                    <button tal:attributes="disabled python:condition[\'first\'] and \'disabled\' or None"\n-                           type="submit"\n-                           name="form.button.MoveConditionUp"\n-                           value="&uarr;"\n-                           class="context btn btn-sm btn-primary"\n-                           >&uarr;</button>\n-                    <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n-                           type="submit"\n-                           name="form.button.MoveConditionDown"\n-                           value="&darr;"\n-                           class="context btn btn-sm btn-primary"\n-                           >&darr;</button>\n-                </div>\n-            </div>\n-        </form>\n-\n-        <form class="mb-3" tal:attributes="action string:${view/base_url}/+condition" method="get"\n-            id="add-condition">\n-            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <div class="chooser-right">\n-                <label i18n:translate="contentrules_add_condition"\n-                       for="contentrules-add-condition">\n+                                </span>\n+                            </div>\n+                        </div>\n+                    </form>\n+\n+                    <form class="mb-3"\n+                        tal:attributes="action string:${view/base_url}/+condition"\n+                        method="get"\n+                        id="add-condition">\n+                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                        <div class="chooser-right">\n+                            <label i18n:translate="contentrules_add_condition"\n+                                for="contentrules-add-condition">\n                     Add condition\n-                </label>\n-\n-                <select name=":action" size="1" id="contentrules-add-condition" class="form-select">\n-                    <tal:block repeat="condition view/addable_conditions">\n-                        <option tal:attributes="value condition/addview"\n-                                i18n:translate=""\n-                                tal:content="condition/title" />\n-                    </tal:block>\n-                </select>\n-                <button class="context allowMultiSubmit btn btn-sm btn-primary"\n-                       type="submit"\n-                       name="form.button.AddCondition"\n-                       value="Add"\n-                       i18n:attributes="value label_add;"\n-                       i18n:translate="label_add">Add</button>\n-            </div>\n-            &nbsp; <!-- For Safari -->\n-        </form>\n-    </fieldset>\n-\n-    <fieldset id="configure-actions" tal:define="actions view/actions">\n-        <div tal:condition="not:actions" class="alert alert-warning">\n-            <strong i18n:translate="">Warning</strong>\n-            <span i18n:translate="">\n-                There is not any action performed by this rule.\n-                Click on Add button to setup an action.\n-            </span>\n-        </div>\n-\n-        <legend tal:condition="actions" i18n:translate="contentrules_perform_actions">\n+                            </label>\n+\n+                            <select name=":action"\n+                                size="1"\n+                                id="contentrules-add-condition"\n+                                class="form-control">\n+                                <tal:block repeat="condition view/addable_conditions">\n+                                    <option tal:attributes="value condition/addview"\n+                                        i18n:translate=""\n+                                        tal:content="condition/title" />\n+                                </tal:block>\n+                            </select>\n+                            <button class="context allowMultiSubmit btn btn-primary"\n+                                type="submit"\n+                                name="form.button.AddCondition"\n+                                value="Add"\n+                                i18n:attributes="value label_add;"\n+                                i18n:translate="label_add">Add</button>\n+                        </div>\n+            &nbsp;                         <!-- For Safari -->\n+                    </form>\n+                </fieldset>\n+\n+                <fieldset id="configure-actions"\n+                    tal:define="actions view/actions">\n+                    <legend i18n:translate="contentrules_perform_actions">\n             Perform the following actions:\n-        </legend>\n-\n-        <form class="mb-3" tal:attributes="action view/view_url" method="post"\n-              tal:define="auth_token context/@@authenticator/token"\n-              tal:repeat="action actions">\n-            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <a tal:attributes="name string:action++${action/idx}"></a>\n-            <input type="hidden" name="element_id:int" tal:attributes="value action/idx" />\n-            <div class="rule-element border border-secondary rounded d-flex align-items-center justify-content-between px-2">\n-                <div>\n-                    <strong tal:content="action/title"\n-                    i18n:translate="">Move to folder</strong>\n-                    <span tal:content="action/summary">\n+                    </legend>\n+                    <a name="action"></a>\n+                    <div tal:condition="not:actions"\n+                        class="portalMessage warning">\n+                        <strong>Warning</strong>\n+                        <span i18n:translate="">\n+          There is not any action performed by this rule.\n+          Click on Add button to setup an action.\n+                        </span>\n+                    </div>\n+                    <form class="mb-3"\n+                        tal:attributes="action view/view_url"\n+                        method="post"\n+                        tal:define="auth_token context/@@authenticator/token"\n+                        tal:repeat="action actions">\n+                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                        <a tal:attributes="name string:action++${action/idx}"></a>\n+                        <input type="hidden"\n+                            name="element_id:int"\n+                            tal:attributes="value action/idx" />\n+                        <div class="rule-element">\n+                            <div class="rule-operations">\n+                                <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}"\n+                                    class="pat-plone-modal"\n+                                    tal:condition="action/editview">\n+                                    <button type="submit"\n+                                        name="form.button.EditAction"\n+                                        value="Edit"\n+                                        class="context btn btn-primary"\n+                                        i18n:attributes="value label_edit;"\n+                                        i18n:translate="label_edit;">Edit</button>\n+                                </a>\n+                                <button type="submit"\n+                                    name="form.button.DeleteAction"\n+                                    value="Remove"\n+                                    class="context btn btn-danger"\n+                                    i18n:attributes="value label_remove;"\n+                                    i18n:translate="label_remove">Remove</button>\n+                                <button tal:attributes="disabled python:action[\'first\'] and \'disabled\' or None"\n+                                    type="submit"\n+                                    name="form.button.MoveActionUp"\n+                                    value="&uarr;"\n+                                    class="context btn btn-primary">&uarr;</button>\n+                                <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n+                                    type="submit"\n+                                    name="form.button.MoveActionDown"\n+                                    value="&darr;"\n+                                    class="context btn btn-primary">&darr;</button>\n+                            </div>\n+                            <div class="portalMessage warning">\n+                                <strong tal:content="action/title"\n+                                    i18n:translate="">Move to folder</strong>\n+                                <span tal:content="action/summary">\n                         Something happened\n-                    </span>\n-                </div>\n-                <div class="rule-operations flex-shrink-0">\n-                    <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}" class="pat-plone-modal"\n-                       tal:condition="action/editview">\n-                      <button type="submit"\n-                             name="form.button.EditAction"\n-                             value="Edit"\n-                             class="context btn btn-sm btn-primary"\n-                             i18n:attributes="value label_edit;"\n-                             i18n:translate="label_edit;"\n-                             >Edit</button>\n-                    </a>\n-                    <button type="submit"\n-                           name="form.button.DeleteAction"\n-                           value="Remove"\n-                           class="context btn btn-sm btn-danger"\n-                           i18n:attributes="value label_remove;"\n-                           i18n:translate="label_remove"\n-                           >Remove</button>\n-                    <button tal:attributes="disabled python:action[\'first\'] and \'disabled\' or None"\n-                           type="submit"\n-                           name="form.button.MoveActionUp"\n-                           value="&uarr;"\n-                           class="context btn btn-sm btn-primary"\n-                           >&uarr;</button>\n-                    <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n-                           type="submit"\n-                           name="form.button.MoveActionDown"\n-                           value="&darr;"\n-                           class="context btn btn-sm btn-primary"\n-                           >&darr;</button>\n-                </div>\n-            </div>\n-        </form>\n-\n-        <form class="mb-3" tal:attributes="action string:${view/base_url}/+action" method="get"\n-          id="add-action">\n-            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <div class="chooser-right">\n-                <label class="form-label" i18n:translate="contentrules_add_action"\n-                       for="contentrules-add-action">Add action</label>\n-                <select name=":action" size="1" id="contentrules-add-action" class="form-select">\n-                    <tal:block repeat="action view/addable_actions">\n-                        <option tal:attributes="value action/addview"\n-                                i18n:translate=""\n-                                tal:content="action/title"></option>\n-                    </tal:block>\n-                </select>\n-                <button class="context allowMultiSubmit btn btn-sm btn-primary"\n-                       type="submit"\n-                       name="form.button.AddAction"\n-                       value="Add"\n-                       i18n:attributes="value label_add;"\n-                       i18n:translate="label_add">Add</button>\n-            </div>\n-            &nbsp; <!-- For Safari -->\n-        </form>\n-    </fieldset>\n-\n-    <tal:assignments define="assignments view/assignments">\n-\n-        <fieldset id="manage-assignments">\n-          <legend i18n:translate="label_contentrules_rule_assignments">Assignments</legend>\n-          <tal:noassignments condition="not:assignments">\n-            <div class="alert alert-warning">\n-              <strong i18n:translate="">This rule is not assigned to any location</strong>\n-\n-            <tal:enabled condition="view/rule_enabled">\n-              <span i18n:translate="">\n+                                </span>\n+                            </div>\n+                        </div>\n+                    </form>\n+\n+                    <form class="mb-3"\n+                        tal:attributes="action string:${view/base_url}/+action"\n+                        method="get"\n+                        id="add-action">\n+                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                        <div class="chooser-right">\n+                            <label class="form-label"\n+                                i18n:translate="contentrules_add_action"\n+                                for="contentrules-add-action">Add action</label>\n+                            <select name=":action"\n+                                size="1"\n+                                id="contentrules-add-action"\n+                                class="form-control">\n+                                <tal:block repeat="action view/addable_actions">\n+                                    <option tal:attributes="value action/addview"\n+                                        i18n:translate=""\n+                                        tal:content="action/title"></option>\n+                                </tal:block>\n+                            </select>\n+                            <button class="context allowMultiSubmit btn btn-primary"\n+                                type="submit"\n+                                name="form.button.AddAction"\n+                                value="Add"\n+                                i18n:attributes="value label_add;"\n+                                i18n:translate="label_add">Add</button>\n+                        </div>\n+            &nbsp;                         <!-- For Safari -->\n+                    </form>\n+                </fieldset>\n+\n+                <tal:assignments define="assignments view/assignments">\n+\n+                    <fieldset id="manage-assignments">\n+                        <legend i18n:translate="label_contentrules_rule_assignments">Assignments</legend>\n+                        <tal:noassignments condition="not:assignments">\n+                            <div class="portalMessage warning">\n+                                <strong i18n:translate="">This rule is not assigned to any location</strong>\n+\n+                                <tal:enabled condition="view/rule_enabled">\n+                                    <span i18n:translate="">\n                 The rule is enabled but will perform nothing since it is not assigned anywhere.\n-              </span>\n-                <br />\n-              <span i18n:translate="">\n+                                    </span>\n+                                    <br />\n+                                    <span i18n:translate="">\n                 Go to the folder where you want the rule to apply, or at the site root,\n                 click on \'rule\' tab, and then locally setup the rules.\n-              </span>\n-\n-              <form class="mb-3" tal:attributes="action view/view_url" method="post">\n-                <span tal:replace="structure context/@@authenticator/authenticator"/>\n-                <label class="form-label" i18n:translate="contentrules_assignments_shortcuts">Shortcuts:</label>\n-                <input type="submit" class="btn btn-sm btn-primary"\n-                       value="Apply rule on the whole site"\n-                       name="form.button.ApplyOnWholeSite"\n-                       i18n:attributes="value" />\n-              </form>\n-            </tal:enabled>\n-            </div>\n-\n-          </tal:noassignments>\n-          <tal:assignments condition="nocall:assignments">\n-            <div class="alert alert-secondary">\n-              <strong>Info</strong>\n-              <span\n-                i18n:translate="description_contentrules_rule_assignments">\n+                                    </span>\n+\n+                                    <form class="mb-3"\n+                                        tal:attributes="action view/view_url"\n+                                        method="post">\n+                                        <span tal:replace="structure context/@@authenticator/authenticator" />\n+                                        <label class="form-label"\n+                                            i18n:translate="contentrules_assignments_shortcuts">Shortcuts:</label>\n+                                        <input type="submit"\n+                                            class="btn btn-primary"\n+                                            value="Apply rule on the whole site"\n+                                            name="form.button.ApplyOnWholeSite"\n+                                            i18n:attributes="value" />\n+                                    </form>\n+                                </tal:enabled>\n+                            </div>\n+\n+                        </tal:noassignments>\n+                        <tal:assignments condition="nocall:assignments">\n+                            <div class="portalMessage info">\n+                                <strong>Info</strong>\n+                                <span i18n:translate="description_contentrules_rule_assignments">\n                 This rule is assigned to the following locations:\n-              </span>\n-\n-                <tal:items repeat="assignment assignments">\n-\n-                        <a tal:attributes="href string:${assignment/url}/@@manage-content-rules"\n-                           tal:content="assignment/title" />\n-\n-                </tal:items>\n-            </div>\n-          </tal:assignments>\n-        </fieldset>\n-\n-    </tal:assignments>\n-\n-    <fieldset id="configure-rule">\n-        <legend i18n:translate="">Configure rule</legend>\n-        <form tal:attributes="action view/view_url" method="post">\n-            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <div class="mb-3">\n-                <label class="form-label" for="form.title" i18n:translate="label_title">Title</label>\n-                <input id="form.title" class="form-control" type="text" width="50" name="title"\n-                    tal:attributes="value request/ruleTitle | view/rule_title"/>\n-                <div class="form-text" i18n:translate="description_contentrule_title">\n+                                </span>\n+\n+                                <tal:items repeat="assignment assignments">\n+\n+                                    <a tal:attributes="href string:${assignment/url}/@@manage-content-rules"\n+                                        tal:content="assignment/title" />\n+\n+                                </tal:items>\n+                            </div>\n+                        </tal:assignments>\n+                    </fieldset>\n+\n+                </tal:assignments>\n+\n+                <fieldset id="configure-rule">\n+                    <legend i18n:translate="">Configure rule</legend>\n+                    <form class="mb-3"\n+                        tal:attributes="action view/view_url"\n+                        method="post">\n+                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                        <div class="field">\n+                            <label for="form.title"\n+                                i18n:translate="label_title">Title</label>\n+                            <div class="formHelp"\n+                                i18n:translate="description_contentrule_title">\n                     Please set a descriptive title for the rule.\n-                </div>\n-            </div>\n-            <div class="mb-3">\n-                <label class="form-label" for="form.description" i18n:translate="label_description">Description</label>\n-                <textarea id="form.description" class="form-control" name="description"\n-                    tal:content="request/ruleDescription | view/rule_description ">\n-                </textarea>\n-                <div class="form-text" i18n:translate="contentrules_description_description">\n+                            </div>\n+                            <input id="form.title"\n+                                class="form-control"\n+                                type="text"\n+                                width="50"\n+                                name="title"\n+                                tal:attributes="value request/ruleTitle | view/rule_title" />\n+                        </div>\n+                        <div class="field">\n+                            <label for="form.description"\n+                                i18n:translate="label_description">Description</label>\n+                            <div class="formHelp"\n+                                i18n:translate="contentrules_description_description">\n                     Enter a short description of the rule and its purpose.\n-                </div>\n-            </div>\n-\n-            <div class="mb-3">\n-                <div class="form-label" i18n:translate="contentrules_description_trigger">\n+                            </div>\n+                            <textarea id="form.description"\n+                                class="form-control"\n+                                name="description"\n+                                tal:content="request/ruleDescription | view/rule_description ">\n+                            </textarea>\n+                        </div>\n+\n+                        <div class="field">\n+                            <label i18n:translate="label_rule_event_trigger">\n+                    Event trigger: <span i18n:name="trigger"\n+                                tal:content="view/rule_event"></span>\n+                            </label>\n+                            <div class="formHelp"\n+                                i18n:translate="contentrules_description_trigger">\n                     The rule will execute when the following event occurs.\n-                </div>\n-                <label class="form-text" i18n:translate="label_rule_event_trigger">\n-                    Event trigger: <span i18n:name="trigger" tal:content="view/rule_event"></span>\n-                </label>\n-            </div>\n-\n-            <div class="mb-3 form-check">\n-                <input type="checkbox" id="stop" name="stopExecuting" class="form-check-input"\n-                       tal:attributes="checked view/rule_stop"/>\n-                <label class="form-check-label" for="stop" i18n:translate="contentrules_description_stop">\n+                            </div>\n+                        </div>\n+\n+                        <div class="field">\n+                            <input type="checkbox"\n+                                id="stop"\n+                                name="stopExecuting"\n+                                tal:attributes="checked view/rule_stop" />\n+                            <label for="stop"\n+                                i18n:translate="contentrules_description_stop">\n                     Stop evaluating content rules after this rule completes\n-                </label>\n-            </div>\n-\n-            <div class="mb-3 form-check">\n-                <input type="checkbox" id="cascading" name="cascading" class="form-check-input"\n-                       tal:attributes="checked view/rule_cascading"/>\n-                <label class="form-check-label" for="cascading" i18n:translate="contentrules_description_cascading">\n+                            </label>\n+                        </div>\n+\n+                        <div class="field">\n+                            <input type="checkbox"\n+                                id="cascading"\n+                                name="cascading"\n+                                tal:attributes="checked view/rule_cascading" />\n+                            <label for="cascading"\n+                                i18n:translate="contentrules_description_cascading">\n                     The actions executed by this rule can trigger other rules\n-                </label>\n-            </div>\n-\n-            <div class="mb-3 form-check">\n-                <input type="checkbox" id="enabled" name="enabled" class="form-check-input"\n-                       tal:attributes="checked view/rule_enabled"/>\n-                <label class="form-check-label" for="enabled" i18n:translate="">\n+                            </label>\n+                        </div>\n+\n+                        <div class="field">\n+                            <input type="checkbox"\n+                                id="enabled"\n+                                name="enabled"\n+                                tal:attributes="checked view/rule_enabled" />\n+                            <label for="enabled"\n+                                i18n:translate="">\n                     Enabled\n-                </label>\n-            </div>\n+                            </label>\n+                        </div>\n+\n+                        <div class="formControls">\n+                            <button class="context btn btn-primary"\n+                                type="submit"\n+                                name="form.button.Save"\n+                                value="Save"\n+                                i18n:attributes="value label_save;"\n+                                i18n:translate="label_save">Save</button>\n+                        </div>\n+                    </form>\n+                </fieldset>\n \n-            <div class="mb-3">\n-                <button class="context btn btn-sm btn-primary"\n-                       type="submit"\n-                       name="form.button.Save"\n-                       value="Save"\n-                       i18n:attributes="value label_save;"\n-                       i18n:translate="label_save">Save</button>\n             </div>\n-        </form>\n-    </fieldset>\n-\n-</div>\n-</body>\n+        </div>\n+    </body>\n </html>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:28:54+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.app.contentrules/commit/e2ba04d4b7cc4dc0f0ddba4051ec30e9bb3efa96

define bootstrap grid

Files changed:
M plone/app/contentrules/browser/templates/manage-elements.pt

b'diff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex 2144fc7..2819f27 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -11,8 +11,8 @@\n \n         <div metal:fill-slot="prefs_configlet_main">\n \n-            <div class="pat-contentrules-elements">\n-\n+            <div class="pat-contentrules-elements row">\n+                <div class="col-12">\n                 <h1 class="documentFirstHeading"\n                     i18n:translate="title_edit_contentrule">Edit content rule</h1>\n \n@@ -29,8 +29,9 @@\n         be invoked if all the rule\'s conditions are met. You can add new\n         actions and conditions using the buttons below.\n                 </p>\n-\n+                </div>\n                 <fieldset id="configure-conditions"\n+                    class="col-lg-6 col-12"\n                     tal:define="conditions view/conditions">\n                     <legend i18n:translate="if_all_conditions_met">\n             If all of the following conditions are met:\n@@ -120,6 +121,7 @@\n                 </fieldset>\n \n                 <fieldset id="configure-actions"\n+                    class="col-lg-6 col-12"\n                     tal:define="actions view/actions">\n                     <legend i18n:translate="contentrules_perform_actions">\n             Perform the following actions:\n@@ -214,7 +216,7 @@\n \n                 <tal:assignments define="assignments view/assignments">\n \n-                    <fieldset id="manage-assignments">\n+                    <fieldset id="manage-assignments" class="col-12">\n                         <legend i18n:translate="label_contentrules_rule_assignments">Assignments</legend>\n                         <tal:noassignments condition="not:assignments">\n                             <div class="portalMessage warning">\n@@ -265,7 +267,7 @@\n \n                 </tal:assignments>\n \n-                <fieldset id="configure-rule">\n+                <fieldset id="configure-rule" class="col-12">\n                     <legend i18n:translate="">Configure rule</legend>\n                     <form class="mb-3"\n                         tal:attributes="action view/view_url"\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:28:54+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/2cfd5d824ab58f2ad630e2d52386aca39ae4152e

cleanup &amp; update conditions/actions markup

Files changed:
M plone/app/contentrules/browser/templates/manage-elements.pt

b'diff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex 2819f27..29a2464 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -9,42 +9,46 @@\n \n     <body>\n \n-        <div metal:fill-slot="prefs_configlet_main">\n+        <metal:main metal:fill-slot="prefs_configlet_main">\n \n-            <div class="pat-contentrules-elements row">\n-                <div class="col-12">\n+            <header>\n                 <h1 class="documentFirstHeading"\n                     i18n:translate="title_edit_contentrule">Edit content rule</h1>\n \n+                <p i18n:translate="contentrules_description_execution"\n+                    class="text-muted">\n+                    Rules execute when a triggering event occurs. Rule actions will only\n+                    be invoked if all the rule\'s conditions are met. You can add new\n+                    actions and conditions using the buttons below.\n+                </p>\n+            </header>\n+\n+            <div id="content-core" class="pat-contentrules-elements">\n+\n                 <a href=""\n-                    class="link-parent"\n+                    class="link-parent d-block mb-3"\n                     tal:attributes="href string:${portal_url}/@@rules-controlpanel"\n                     i18n:translate="go_to_contentrules_management">\n-        Up to rule management\n+                    Up to rule management\n                 </a>\n \n-                <p i18n:translate="contentrules_description_execution"\n-                    class="documentDescription">\n-        Rules execute when a triggering event occurs. Rule actions will only\n-        be invoked if all the rule\'s conditions are met. You can add new\n-        actions and conditions using the buttons below.\n-                </p>\n-                </div>\n-                <fieldset id="configure-conditions"\n-                    class="col-lg-6 col-12"\n+\n+            <div class="row row-cols-1 row-cols-md-2">\n+                <fieldset id="configure-conditions" class="col"\n                     tal:define="conditions view/conditions">\n                     <legend i18n:translate="if_all_conditions_met">\n-            If all of the following conditions are met:\n+                        If all of the following conditions are met:\n                     </legend>\n                     <a name="condition"></a>\n \n                     <div tal:condition="not:conditions"\n-                        class="portalMessage info">\n+                        class="alert alert-info">\n                         <strong>Info</strong>\n                         <span i18n:translate="">\n-          There is not any additional condition checked on this rule.\n+                            There is not any additional condition checked on this rule.\n                         </span>\n                     </div>\n+\n                     <form class="mb-3"\n                         tal:attributes="action view/view_url"\n                         method="post"\n@@ -55,35 +59,41 @@\n                         <input type="hidden"\n                             name="element_id:int"\n                             tal:attributes="value condition/idx" />\n-                        <div class="rule-element">\n-                            <div class="rule-operations">\n-                                <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n-                                    class="pat-plone-modal plone-btn-primary btn btn-primary"\n-                                    tal:condition="condition/editview"\n-                                    i18n:translate="label_edit">Edit</a>\n-                                <button type="submit"\n-                                    name="form.button.DeleteCondition"\n-                                    value="Remove"\n-                                    class="context btn btn-danger"\n-                                    i18n:attributes="value label_remove;"\n-                                    i18n:translate="label_remove">Remove</button>\n-                                <button tal:attributes="disabled python:condition[\'first\'] and \'disabled\' or None"\n-                                    type="submit"\n-                                    name="form.button.MoveConditionUp"\n-                                    value="&uarr;"\n-                                    class="context btn btn-primary">&uarr;</button>\n-                                <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n-                                    type="submit"\n-                                    name="form.button.MoveConditionDown"\n-                                    value="&darr;"\n-                                    class="context btn btn-primary">&darr;</button>\n-                            </div>\n-                            <div class="portalMessage warning">\n-                                <strong tal:content="condition/title"\n-                                    i18n:translate="">Transition was publish.</strong>\n-                                <span tal:content="condition/summary">\n-                        Something happened\n-                                </span>\n+\n+                        <div class="card">\n+                            <div class="card-body row">\n+                                <div class="col">\n+                                    <h5 class="card-title"\n+                                    tal:content="condition/title"\n+                                    i18n:translate="">Transition was publish.</h5>\n+                                </div>\n+                                <div class="col-auto">\n+                                    <div class="rule-operations">\n+                                        <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n+                                            class="pat-plone-modal btn btn-sm btn-primary"\n+                                            tal:condition="condition/editview"\n+                                            i18n:translate="label_edit">Edit</a>\n+                                        <button type="submit"\n+                                            name="form.button.DeleteCondition"\n+                                            value="Remove"\n+                                            class="context btn btn-sm btn-danger"\n+                                            i18n:attributes="value label_remove;"\n+                                            i18n:translate="label_remove">Remove</button>\n+                                        <button tal:attributes="disabled python:condition[\'first\'] and \'disabled\' or None"\n+                                            type="submit"\n+                                            name="form.button.MoveConditionUp"\n+                                            value="&uarr;"\n+                                            class="context btn btn-sm btn-primary">&uarr;</button>\n+                                        <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n+                                            type="submit"\n+                                            name="form.button.MoveConditionDown"\n+                                            value="&darr;"\n+                                            class="context btn btn-sm btn-primary">&darr;</button>\n+                                    </div>\n+                                </div>\n+                                <p class="card-text" tal:content="condition/summary">\n+                                    Something happened\n+                                </p>\n                             </div>\n                         </div>\n                     </form>\n@@ -93,46 +103,54 @@\n                         method="get"\n                         id="add-condition">\n                         <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                        <div class="chooser-right">\n-                            <label i18n:translate="contentrules_add_condition"\n+                        <div class="input-group">\n+\n+                            <!-- <label class="form-label" i18n:translate="contentrules_add_condition"\n                                 for="contentrules-add-condition">\n-                    Add condition\n-                            </label>\n+                                Condition\n+                            </label> -->\n+\n+                            <span class="input-group-text" i18n:translate="contentrules_condition"\n+                                for="contentrules-add-condition">\n+                                Condition\n+                            </span>\n \n                             <select name=":action"\n                                 size="1"\n                                 id="contentrules-add-condition"\n-                                class="form-control">\n+                                class="form-select"\n+                                aria-label="Add condition"\n+                                i18n:attributes="aria-label contentrules_add_condition">\n                                 <tal:block repeat="condition view/addable_conditions">\n                                     <option tal:attributes="value condition/addview"\n                                         i18n:translate=""\n                                         tal:content="condition/title" />\n                                 </tal:block>\n                             </select>\n-                            <button class="context allowMultiSubmit btn btn-primary"\n+                            <button class="context allowMultiSubmit btn btn-success"\n                                 type="submit"\n                                 name="form.button.AddCondition"\n                                 value="Add"\n                                 i18n:attributes="value label_add;"\n                                 i18n:translate="label_add">Add</button>\n                         </div>\n-            &nbsp;                         <!-- For Safari -->\n+                        &nbsp;                         <!-- For Safari -->\n                     </form>\n                 </fieldset>\n \n-                <fieldset id="configure-actions"\n-                    class="col-lg-6 col-12"\n+                <fieldset id="configure-actions" class="col"\n                     tal:define="actions view/actions">\n                     <legend i18n:translate="contentrules_perform_actions">\n-            Perform the following actions:\n+                        Perform the following actions:\n                     </legend>\n                     <a name="action"></a>\n+\n                     <div tal:condition="not:actions"\n-                        class="portalMessage warning">\n+                        class="alert alert-warning">\n                         <strong>Warning</strong>\n                         <span i18n:translate="">\n-          There is not any action performed by this rule.\n-          Click on Add button to setup an action.\n+                            There is not any action performed by this rule.\n+                            Click on Add button to setup an action.\n                         </span>\n                     </div>\n                     <form class="mb-3"\n@@ -145,43 +163,45 @@\n                         <input type="hidden"\n                             name="element_id:int"\n                             tal:attributes="value action/idx" />\n-                        <div class="rule-element">\n-                            <div class="rule-operations">\n-                                <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}"\n-                                    class="pat-plone-modal"\n-                                    tal:condition="action/editview">\n-                                    <button type="submit"\n-                                        name="form.button.EditAction"\n-                                        value="Edit"\n-                                        class="context btn btn-primary"\n-                                        i18n:attributes="value label_edit;"\n-                                        i18n:translate="label_edit;">Edit</button>\n-                                </a>\n-                                <button type="submit"\n-                                    name="form.button.DeleteAction"\n-                                    value="Remove"\n-                                    class="context btn btn-danger"\n-                                    i18n:attributes="value label_remove;"\n-                                    i18n:translate="label_remove">Remove</button>\n-                                <button tal:attributes="disabled python:action[\'first\'] and \'disabled\' or None"\n-                                    type="submit"\n-                                    name="form.button.MoveActionUp"\n-                                    value="&uarr;"\n-                                    class="context btn btn-primary">&uarr;</button>\n-                                <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n-                                    type="submit"\n-                                    name="form.button.MoveActionDown"\n-                                    value="&darr;"\n-                                    class="context btn btn-primary">&darr;</button>\n-                            </div>\n-                            <div class="portalMessage warning">\n-                                <strong tal:content="action/title"\n-                                    i18n:translate="">Move to folder</strong>\n-                                <span tal:content="action/summary">\n-                        Something happened\n-                                </span>\n+\n+                        <div class="card">\n+                            <div class="card-body row">\n+                                <div class="col">\n+                                    <h5 class="card-title"\n+                                    tal:content="action/title"\n+                                    i18n:translate="">Move to folder</h5>\n+                                </div>\n+                                <div class="col-auto">\n+                                    <div class="rule-operations">\n+                                        <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}"\n+                                            class="pat-plone-modal btn btn-sm btn-primary"\n+                                            tal:condition="action/editview"\n+                                            i18n:translate="label_edit">Edit</a>\n+                                        <button type="submit"\n+                                            name="form.button.DeleteAction"\n+                                            value="Remove"\n+                                            class="context btn btn-sm btn-danger"\n+                                            i18n:attributes="value label_remove;"\n+                                            i18n:translate="label_remove">Remove</button>\n+                                        <button tal:attributes="disabled python:action[\'first\'] and \'disabled\' or None"\n+                                            type="submit"\n+                                            name="form.button.MoveActionUp"\n+                                            value="&uarr;"\n+                                            class="context btn btn-sm btn-primary">&uarr;</button>\n+                                        <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n+                                            type="submit"\n+                                            name="form.button.MoveActionDown"\n+                                            value="&darr;"\n+                                            class="context btn btn-sm btn-primary">&darr;</button>\n+                                    </div>\n+                                </div>\n+                                <p class="card-text" tal:content="action/summary">\n+                                    Something happened\n+                                </p>\n                             </div>\n                         </div>\n+\n+\n                     </form>\n \n                     <form class="mb-3"\n@@ -189,34 +209,44 @@\n                         method="get"\n                         id="add-action">\n                         <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                        <div class="chooser-right">\n-                            <label class="form-label"\n+                        <div class="input-group">\n+                            <!-- <label class="form-label"\n                                 i18n:translate="contentrules_add_action"\n-                                for="contentrules-add-action">Add action</label>\n+                                for="contentrules-add-action">Add action</label> -->\n+\n+                            <span class="input-group-text"\n+                                i18n:translate="contentrules_action"\n+                                for="contentrules-add-action">Action</span>\n+\n                             <select name=":action"\n                                 size="1"\n                                 id="contentrules-add-action"\n-                                class="form-control">\n+                                class="form-select"\n+                                aria-label="Add action"\n+                                i18n:attributes="aria-label contentrules_add_action">\n                                 <tal:block repeat="action view/addable_actions">\n                                     <option tal:attributes="value action/addview"\n                                         i18n:translate=""\n                                         tal:content="action/title"></option>\n                                 </tal:block>\n                             </select>\n-                            <button class="context allowMultiSubmit btn btn-primary"\n+                            <button class="context allowMultiSubmit btn btn-success"\n                                 type="submit"\n                                 name="form.button.AddAction"\n                                 value="Add"\n                                 i18n:attributes="value label_add;"\n                                 i18n:translate="label_add">Add</button>\n                         </div>\n-            &nbsp;                         <!-- For Safari -->\n+                        &nbsp;                         <!-- For Safari -->\n                     </form>\n                 </fieldset>\n+            </div>\n+\n+\n \n                 <tal:assignments define="assignments view/assignments">\n \n-                    <fieldset id="manage-assignments" class="col-12">\n+                    <fieldset id="manage-assignments" class="col">\n                         <legend i18n:translate="label_contentrules_rule_assignments">Assignments</legend>\n                         <tal:noassignments condition="not:assignments">\n                             <div class="portalMessage warning">\n@@ -249,7 +279,7 @@\n \n                         </tal:noassignments>\n                         <tal:assignments condition="nocall:assignments">\n-                            <div class="portalMessage info">\n+                            <div class="alert alert-info">\n                                 <strong>Info</strong>\n                                 <span i18n:translate="description_contentrules_rule_assignments">\n                 This rule is assigned to the following locations:\n@@ -267,7 +297,7 @@\n \n                 </tal:assignments>\n \n-                <fieldset id="configure-rule" class="col-12">\n+                <fieldset id="configure-rule" class="col">\n                     <legend i18n:translate="">Configure rule</legend>\n                     <form class="mb-3"\n                         tal:attributes="action view/view_url"\n@@ -357,6 +387,6 @@\n                 </fieldset>\n \n             </div>\n-        </div>\n+        </metal:main>\n     </body>\n </html>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:28:54+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/cdcdac1c960a2384f1d0d20088bcf77acad1c143

hide edit form in manage elements

Files changed:
M plone/app/contentrules/browser/templates/manage-elements.pt

b'diff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex 29a2464..9f2639b 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -33,6 +33,98 @@\n                 </a>\n \n \n+                <!-- <fieldset id="configure-rule" class="col">\n+                    <legend i18n:translate="">Configure rule</legend>\n+                    <form class="mb-3"\n+                        tal:attributes="action view/view_url"\n+                        method="post">\n+                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                        <div class="field">\n+                            <label for="form.title"\n+                                i18n:translate="label_title">Title</label>\n+                            <div class="formHelp"\n+                                i18n:translate="description_contentrule_title">\n+                    Please set a descriptive title for the rule.\n+                            </div>\n+                            <input id="form.title"\n+                                class="form-control"\n+                                type="text"\n+                                width="50"\n+                                name="title"\n+                                tal:attributes="value request/ruleTitle | view/rule_title" />\n+                        </div>\n+                        <div class="field">\n+                            <label for="form.description"\n+                                i18n:translate="label_description">Description</label>\n+                            <div class="formHelp"\n+                                i18n:translate="contentrules_description_description">\n+                    Enter a short description of the rule and its purpose.\n+                            </div>\n+                            <textarea id="form.description"\n+                                class="form-control"\n+                                name="description"\n+                                tal:content="request/ruleDescription | view/rule_description ">\n+                            </textarea>\n+                        </div>\n+\n+                        <div class="field">\n+                            <label i18n:translate="label_rule_event_trigger">\n+                    Event trigger: <span i18n:name="trigger"\n+                                tal:content="view/rule_event"></span>\n+                            </label>\n+                            <div class="formHelp"\n+                                i18n:translate="contentrules_description_trigger">\n+                    The rule will execute when the following event occurs.\n+                            </div>\n+                        </div>\n+\n+                        <div class="field">\n+                            <input type="checkbox"\n+                                id="stop"\n+                                name="stopExecuting"\n+                                tal:attributes="checked view/rule_stop" />\n+                            <label for="stop"\n+                                i18n:translate="contentrules_description_stop">\n+                    Stop evaluating content rules after this rule completes\n+                            </label>\n+                        </div>\n+\n+                        <div class="field">\n+                            <input type="checkbox"\n+                                id="cascading"\n+                                name="cascading"\n+                                tal:attributes="checked view/rule_cascading" />\n+                            <label for="cascading"\n+                                i18n:translate="contentrules_description_cascading">\n+                    The actions executed by this rule can trigger other rules\n+                            </label>\n+                        </div>\n+\n+                        <div class="field">\n+                            <input type="checkbox"\n+                                id="enabled"\n+                                name="enabled"\n+                                tal:attributes="checked view/rule_enabled" />\n+                            <label for="enabled"\n+                                i18n:translate="">\n+                    Enabled\n+                            </label>\n+                        </div>\n+\n+                        <div class="formControls">\n+                            <button class="context btn btn-primary"\n+                                type="submit"\n+                                name="form.button.Save"\n+                                value="Save"\n+                                i18n:attributes="value label_save;"\n+                                i18n:translate="label_save">Save</button>\n+                        </div>\n+                    </form>\n+                </fieldset> -->\n+\n+\n+\n+\n             <div class="row row-cols-1 row-cols-md-2">\n                 <fieldset id="configure-conditions" class="col"\n                     tal:define="conditions view/conditions">\n@@ -297,95 +389,6 @@\n \n                 </tal:assignments>\n \n-                <fieldset id="configure-rule" class="col">\n-                    <legend i18n:translate="">Configure rule</legend>\n-                    <form class="mb-3"\n-                        tal:attributes="action view/view_url"\n-                        method="post">\n-                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                        <div class="field">\n-                            <label for="form.title"\n-                                i18n:translate="label_title">Title</label>\n-                            <div class="formHelp"\n-                                i18n:translate="description_contentrule_title">\n-                    Please set a descriptive title for the rule.\n-                            </div>\n-                            <input id="form.title"\n-                                class="form-control"\n-                                type="text"\n-                                width="50"\n-                                name="title"\n-                                tal:attributes="value request/ruleTitle | view/rule_title" />\n-                        </div>\n-                        <div class="field">\n-                            <label for="form.description"\n-                                i18n:translate="label_description">Description</label>\n-                            <div class="formHelp"\n-                                i18n:translate="contentrules_description_description">\n-                    Enter a short description of the rule and its purpose.\n-                            </div>\n-                            <textarea id="form.description"\n-                                class="form-control"\n-                                name="description"\n-                                tal:content="request/ruleDescription | view/rule_description ">\n-                            </textarea>\n-                        </div>\n-\n-                        <div class="field">\n-                            <label i18n:translate="label_rule_event_trigger">\n-                    Event trigger: <span i18n:name="trigger"\n-                                tal:content="view/rule_event"></span>\n-                            </label>\n-                            <div class="formHelp"\n-                                i18n:translate="contentrules_description_trigger">\n-                    The rule will execute when the following event occurs.\n-                            </div>\n-                        </div>\n-\n-                        <div class="field">\n-                            <input type="checkbox"\n-                                id="stop"\n-                                name="stopExecuting"\n-                                tal:attributes="checked view/rule_stop" />\n-                            <label for="stop"\n-                                i18n:translate="contentrules_description_stop">\n-                    Stop evaluating content rules after this rule completes\n-                            </label>\n-                        </div>\n-\n-                        <div class="field">\n-                            <input type="checkbox"\n-                                id="cascading"\n-                                name="cascading"\n-                                tal:attributes="checked view/rule_cascading" />\n-                            <label for="cascading"\n-                                i18n:translate="contentrules_description_cascading">\n-                    The actions executed by this rule can trigger other rules\n-                            </label>\n-                        </div>\n-\n-                        <div class="field">\n-                            <input type="checkbox"\n-                                id="enabled"\n-                                name="enabled"\n-                                tal:attributes="checked view/rule_enabled" />\n-                            <label for="enabled"\n-                                i18n:translate="">\n-                    Enabled\n-                            </label>\n-                        </div>\n-\n-                        <div class="formControls">\n-                            <button class="context btn btn-primary"\n-                                type="submit"\n-                                name="form.button.Save"\n-                                value="Save"\n-                                i18n:attributes="value label_save;"\n-                                i18n:translate="label_save">Save</button>\n-                        </div>\n-                    </form>\n-                </fieldset>\n-\n             </div>\n         </metal:main>\n     </body>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:28:54+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/a1c34d7fc3983e2e2de71cbe5671776dee6912ee

add edit and configure action to overview

Files changed:
M plone/app/contentrules/browser/templates/controlpanel.pt

b'diff --git a/plone/app/contentrules/browser/templates/controlpanel.pt b/plone/app/contentrules/browser/templates/controlpanel.pt\nindex 3a86b0f..6a96e2b 100644\n--- a/plone/app/contentrules/browser/templates/controlpanel.pt\n+++ b/plone/app/contentrules/browser/templates/controlpanel.pt\n@@ -113,7 +113,7 @@\n                     <tr>\n                         <th scope="col" i18n:translate="label_contentrules_rule_listing">Content rule</th>\n                         <th scope="col" i18n:translate="label_contentrules_rule_event">Event</th>\n-                        <th scope="col" i18n:translate="label_contentrules_rule_enabled">Enabled</th>\n+                        <!-- <th scope="col" i18n:translate="label_contentrules_rule_enabled">Enabled</th> -->\n                         <th scope="col" i18n:translate="label_contentrules_rule_actions">Actions</th>\n                     </tr>\n                 </thead>\n@@ -137,49 +137,54 @@\n                                   tal:content="rule/trigger"\n                                   i18n:translate="">trigger</span>\n                         </td>\n-                        <td class="checker">\n+                        <!-- <td class="checker">\n+                        </td> -->\n+                        <td>\n                             <span\n-                                class="badge badge-primary icon-contentrule-enabled-assigned"\n+                                class="badge bg-primary icon-contentrule-enabled-assigned"\n                                 alt="enabled"\n                                 i18n:attributes="alt label_contentrules_rule_enabled;">\n-                                  <i class="glyphicon glyphicon-ok"></i>\n+                                  <i class="glyphicon glyphicon-ok"></i>enabled\n                             </span>\n \n                             <span\n-                                class="badge badge-danger icon-contentrule-enabled-unassigned"\n+                                class="badge bg-danger icon-contentrule-enabled-unassigned"\n                                 alt="unassigned"\n                                 title="this rule has not been assigned"\n                                 i18n:attributes="alt label_contentrules_rule_unassigned;\n                                                  title title_contentrule_rule_unassigned;">\n-                                  <i class="glyphicon glyphicon-remove"></i>\n+                                  <i class="glyphicon glyphicon-remove"></i>not assigned\n                             </span>\n-                        </td>\n-                        <td>\n-                        <form style="display: inline" method="POST"\n-                              tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n-                        <span tal:replace="structure context/@@authenticator/authenticator"/>\n-                        <input type="hidden"\n-                               name="rule-id"\n-                               tal:attributes="value rule/id">\n-                        <button class="context btn-rule-action btn-rule-enable btn btn-primary" type="submit" value="Enable"\n-                               name="form.button.EnableRule"\n-                               tal:attributes="data-value rule/id;\n-                                               data-url string:$portal_url/@@contentrule-enable"\n-                               i18n:translate=""\n-                               i18n:attributes="value label_enable;">Enable</button>\n-                        <button class="standalone btn-rule-action btn-rule-disable btn btn-secondary" type="submit" value="Disable"\n-                               name="form.button.DisableRule"\n-                               tal:attributes="data-value rule/id;\n-                                               data-url string:$portal_url/@@contentrule-disable"\n-                               i18n:translate=""\n-                               i18n:attributes="value label_disable;">Disable</button>\n-                        <button class="destructive btn-rule-action btn-rule-delete btn btn-danger" type="submit" value="Delete"\n-                               tal:attributes="data-value rule/id;\n-                                               data-url string:$portal_url/@@contentrule-delete"\n-                               name="form.button.DeleteRule"\n-                               i18n:translate=""\n-                               i18n:attributes="value label_delete;">Delete</button>\n-                         </form>\n+                          <form style="display: inline" method="POST"\n+                                tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n+                          <span tal:replace="structure context/@@authenticator/authenticator"/>\n+                          <input type="hidden"\n+                                name="rule-id"\n+                                tal:attributes="value rule/id">\n+                          <button class="context btn-rule-action btn-rule-enable btn btn-primary" type="submit" value="Enable"\n+                                name="form.button.EnableRule"\n+                                tal:attributes="data-value rule/id;\n+                                                data-url string:$portal_url/@@contentrule-enable"\n+                                i18n:translate=""\n+                                i18n:attributes="value label_enable;">Enable</button>\n+                          <button class="standalone btn-rule-action btn-rule-disable btn btn-secondary" type="submit" value="Disable"\n+                                name="form.button.DisableRule"\n+                                tal:attributes="data-value rule/id;\n+                                                data-url string:$portal_url/@@contentrule-disable"\n+                                i18n:translate=""\n+                                i18n:attributes="value label_disable;">Disable</button>\n+                          <a href="" class="btn btn-primary"\n+                                tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@edit">Edit</a>\n+                          <a href="" class="btn btn-primary"\n+                                tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements">Configure</a>\n+\n+                          <button class="destructive btn-rule-action btn-rule-delete btn btn-danger" type="submit" value="Delete"\n+                                tal:attributes="data-value rule/id;\n+                                                data-url string:$portal_url/@@contentrule-delete"\n+                                name="form.button.DeleteRule"\n+                                i18n:translate=""\n+                                i18n:attributes="value label_delete;">Delete</button>\n+                          </form>\n                         </td>\n                     </tr>\n                     </tal:rules>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:28:54+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/d6e40945708897c64b823a398fde5f4ece3f8899

format markup

Files changed:
M plone/app/contentrules/browser/templates/manage-elements.pt

b'diff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex 9f2639b..b54286c 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -346,12 +346,12 @@\n \n                                 <tal:enabled condition="view/rule_enabled">\n                                     <span i18n:translate="">\n-                The rule is enabled but will perform nothing since it is not assigned anywhere.\n+                                        The rule is enabled but will perform nothing since it is not assigned anywhere.\n                                     </span>\n                                     <br />\n                                     <span i18n:translate="">\n-                Go to the folder where you want the rule to apply, or at the site root,\n-                click on \'rule\' tab, and then locally setup the rules.\n+                                        Go to the folder where you want the rule to apply, or at the site root,\n+                                        click on \'rule\' tab, and then locally setup the rules.\n                                     </span>\n \n                                     <form class="mb-3"\n@@ -374,7 +374,7 @@\n                             <div class="alert alert-info">\n                                 <strong>Info</strong>\n                                 <span i18n:translate="description_contentrules_rule_assignments">\n-                This rule is assigned to the following locations:\n+                                    This rule is assigned to the following locations:\n                                 </span>\n \n                                 <tal:items repeat="assignment assignments">\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:33:35+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/c41e5524c1088774bd537cd6ddedac4e4567c4d2

improve rules overview

Files changed:
M plone/app/contentrules/browser/templates/controlpanel.pt

b'diff --git a/plone/app/contentrules/browser/templates/controlpanel.pt b/plone/app/contentrules/browser/templates/controlpanel.pt\nindex 6a96e2b..c1eb3f5 100644\n--- a/plone/app/contentrules/browser/templates/controlpanel.pt\n+++ b/plone/app/contentrules/browser/templates/controlpanel.pt\n@@ -37,15 +37,16 @@\n         <form name="ruleSettings" method="POST"\n              tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n             <span tal:replace="structure context/@@authenticator/authenticator"/>\n-            <div class="field">\n+            <div class="form-check">\n                 <input type="hidden" name="global_disable:boolean:default" value="" />\n                 <input type="checkbox"\n+                       class="form-check-input"\n                        id="rules_disable_globally"\n                        name="global_disable:boolean"\n                        value="True"\n                        tal:attributes="checked python:view.globally_disabled() and \'checked\' or None" />\n-                <label for="rules_disable_globally" i18n:translate="">Disable globally</label>\n-                <div class="formHelp" i18n:translate="">\n+                <label class="form-check-label" for="rules_disable_globally" i18n:translate="">Disable globally</label>\n+                <div class="form-text" i18n:translate="">\n                     Whether or not content rules should be disabled globally. If this is selected,\n                     no rules will be executed anywhere in the portal.\n                 </div>\n@@ -109,11 +110,11 @@\n                  metal:define-macro="rules_table_form">\n             <table  class="listing nosort controlpanel-listing table"\n                     tal:condition="rules">\n-                <thead>\n+                <thead class="">\n                     <tr>\n                         <th scope="col" i18n:translate="label_contentrules_rule_listing">Content rule</th>\n                         <th scope="col" i18n:translate="label_contentrules_rule_event">Event</th>\n-                        <!-- <th scope="col" i18n:translate="label_contentrules_rule_enabled">Enabled</th> -->\n+                        <th scope="col" i18n:translate="label_contentrules_rule_status"><span class="ps-2">Status</span></th>\n                         <th scope="col" i18n:translate="label_contentrules_rule_actions">Actions</th>\n                     </tr>\n                 </thead>\n@@ -122,63 +123,73 @@\n                     <tr tal:define="oddrow repeat/rule/odd"\n                         tal:attributes="class python:(oddrow and \'even \' or \'odd \') + rule[\'row_class\'];">\n                         <td>\n-                            <dl>\n-                                <dt>\n-                                  <a tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements"><span\n-                                     tal:replace="rule/title">Rule Title</span></a>\n-                                </dt>\n-                                <dd tal:content="rule/description">\n-                                    Rule Description.\n-                                </dd>\n-                            </dl>\n+                          <h5>\n+                            <span\n+                               tal:replace="rule/title">Rule Title</span>\n+                          </h5>\n+                            <div tal:content="rule/description">\n+                                Rule Description.\n+                            </div>\n                         </td>\n                         <td>\n                             <span class="trigger"\n                                   tal:content="rule/trigger"\n                                   i18n:translate="">trigger</span>\n                         </td>\n-                        <!-- <td class="checker">\n-                        </td> -->\n-                        <td>\n-                            <span\n-                                class="badge bg-primary icon-contentrule-enabled-assigned"\n-                                alt="enabled"\n-                                i18n:attributes="alt label_contentrules_rule_enabled;">\n-                                  <i class="glyphicon glyphicon-ok"></i>enabled\n-                            </span>\n+                        <td class="status">\n \n-                            <span\n-                                class="badge bg-danger icon-contentrule-enabled-unassigned"\n-                                alt="unassigned"\n-                                title="this rule has not been assigned"\n-                                i18n:attributes="alt label_contentrules_rule_unassigned;\n-                                                 title title_contentrule_rule_unassigned;">\n-                                  <i class="glyphicon glyphicon-remove"></i>not assigned\n-                            </span>\n                           <form style="display: inline" method="POST"\n                                 tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n                           <span tal:replace="structure context/@@authenticator/authenticator"/>\n                           <input type="hidden"\n                                 name="rule-id"\n                                 tal:attributes="value rule/id">\n-                          <button class="context btn-rule-action btn-rule-enable btn btn-primary" type="submit" value="Enable"\n+                          <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link" type="submit" value="Enable"\n                                 name="form.button.EnableRule"\n                                 tal:attributes="data-value rule/id;\n                                                 data-url string:$portal_url/@@contentrule-enable"\n+                                tal:condition="python:not rule[\'enabled\']"\n                                 i18n:translate=""\n-                                i18n:attributes="value label_enable;">Enable</button>\n-                          <button class="standalone btn-rule-action btn-rule-disable btn btn-secondary" type="submit" value="Disable"\n+                                i18n:attributes="value label_enable;">\n+                                <tal:icon tal:replace="structure python:icons.tag(\'square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="">enabled</span>\n+                          </button>\n+                          <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link" type="submit" value="Disable"\n                                 name="form.button.DisableRule"\n                                 tal:attributes="data-value rule/id;\n                                                 data-url string:$portal_url/@@contentrule-disable"\n+                                tal:condition="python:rule[\'enabled\']"\n                                 i18n:translate=""\n-                                i18n:attributes="value label_disable;">Disable</button>\n-                          <a href="" class="btn btn-primary"\n+                                i18n:attributes="value label_disable;">\n+                                <tal:icon tal:replace="structure python:icons.tag(\'check-square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="">enabled</span>\n+                              </button>\n+                          </form>\n+\n+                          <span\n+                            class="badge bg-warning text-dark icon-contentrule-enabled-unassigned"\n+                            alt="unassigned"\n+                            title="this rule has not been assigned"\n+                            tal:condition="python:not rule[\'assigned\']"\n+                            i18n:attributes="alt label_contentrules_rule_unassigned;\n+                                            title title_contentrule_rule_unassigned;">\n+                            <tal:icon tal:replace="structure python:icons.tag(\'exclamation-triangle-fill\', tag_alt=\'not assigned\')" /><span class="ms-2" i18n:translate="">not assigned</span>\n+                      </span>\n+\n+\n+\n+                        </td>\n+                        <td>\n+                          <form style="display: inline" method="POST"\n+                                tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n+                          <span tal:replace="structure context/@@authenticator/authenticator"/>\n+                          <input type="hidden"\n+                                name="rule-id"\n+                                tal:attributes="value rule/id">\n+                          <a href="" class="btn btn-sm btn-primary"\n+                          tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements">Configure</a>\n+                          <a href="" class="btn btn-sm btn-secondary"\n                                 tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@edit">Edit</a>\n-                          <a href="" class="btn btn-primary"\n-                                tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements">Configure</a>\n \n-                          <button class="destructive btn-rule-action btn-rule-delete btn btn-danger" type="submit" value="Delete"\n+                          <button class="destructive btn-rule-action btn-rule-delete btn btn-sm btn-danger" type="submit" value="Delete"\n                                 tal:attributes="data-value rule/id;\n                                                 data-url string:$portal_url/@@contentrule-delete"\n                                 name="form.button.DeleteRule"\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:33:35+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/cdd31e251c594f871e40a801874b40cd5fd4b3b8

improve status and messages

Files changed:
M plone/app/contentrules/browser/templates/controlpanel.pt

b'diff --git a/plone/app/contentrules/browser/templates/controlpanel.pt b/plone/app/contentrules/browser/templates/controlpanel.pt\nindex c1eb3f5..615f034 100644\n--- a/plone/app/contentrules/browser/templates/controlpanel.pt\n+++ b/plone/app/contentrules/browser/templates/controlpanel.pt\n@@ -31,9 +31,18 @@\n       <span id="trns_form_success" i18n:translate="">\n         Content rule settings updated.\n       </span>\n+      <span id="trns_form_success_enabled" i18n:translate="">\n+        Content rule enabled.\n+      </span>\n+      <span id="trns_form_success_disabled" i18n:translate="">\n+        Content rule disabled.\n+      </span>\n+      <span id="trns_form_success_deleted" i18n:translate="">\n+        Content rule deleted.\n+      </span>\n     </div>\n \n-      <div id="fieldset-global">\n+      <div id="fieldset-global" class="mb-5">\n         <form name="ruleSettings" method="POST"\n              tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n             <span tal:replace="structure context/@@authenticator/authenticator"/>\n@@ -64,12 +73,11 @@\n             </noscript>\n         </form>\n \n-        <hr class="my-4">\n       </div>\n \n-       <fieldset id="fieldset-rules"\n-                 tal:define="rules rules|view/registeredRules;\n-                             add_url string:${context/absolute_url}/+rule/plone.ContentRule;">\n+      <div class="card">\n+       <fieldset id="fieldset-rules" class="card-body"\n+                 tal:define="rules rules|view/registeredRules;">\n             <legend id="fieldsetlegend-rules" i18n:translate="legend-contentrules">Content rules</legend>\n \n             <div class="filters mt-2 mb-3" tal:condition="rules">\n@@ -144,20 +152,18 @@\n                           <input type="hidden"\n                                 name="rule-id"\n                                 tal:attributes="value rule/id">\n-                          <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link" type="submit" value="Enable"\n+                          <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link ${python:not rule[\'enabled\'] and \'d-none\'}" type="submit" value="Enable"\n                                 name="form.button.EnableRule"\n                                 tal:attributes="data-value rule/id;\n                                                 data-url string:$portal_url/@@contentrule-enable"\n-                                tal:condition="python:not rule[\'enabled\']"\n                                 i18n:translate=""\n                                 i18n:attributes="value label_enable;">\n                                 <tal:icon tal:replace="structure python:icons.tag(\'square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="">enabled</span>\n                           </button>\n-                          <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link" type="submit" value="Disable"\n+                          <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link ${python:rule[\'enabled\'] and \'d-none\'}" type="submit" value="Disable"\n                                 name="form.button.DisableRule"\n                                 tal:attributes="data-value rule/id;\n                                                 data-url string:$portal_url/@@contentrule-disable"\n-                                tal:condition="python:rule[\'enabled\']"\n                                 i18n:translate=""\n                                 i18n:attributes="value label_disable;">\n                                 <tal:icon tal:replace="structure python:icons.tag(\'check-square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="">enabled</span>\n@@ -202,11 +208,12 @@\n                 </tbody>\n             </table>\n             </div>\n-            <a id="#addcontentrule" tal:attributes="href add_url"\n-               class="plone-btn plone-btn-primary btn btn-primary"\n-               i18n:translate="label_contentrule_add">Add content rule</a>\n-       </fieldset>\n-  </div>\n+          </fieldset>\n+        </div>\n+        <a id="#addcontentrule" tal:attributes="href string:${context/absolute_url}/+rule/plone.ContentRule;"\n+           class="plone-btn plone-btn-primary btn btn-success"\n+           i18n:translate="label_contentrule_add">Add content rule</a>\n+    </div>\n </metal:main>\n </body>\n </html>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:34:41+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/5add30164f500ebb1b3852906952e15bcfad0b4d

fix icons

Files changed:
M plone/app/contentrules/browser/elements.py
M plone/app/contentrules/browser/templates/manage-elements.pt

b'diff --git a/plone/app/contentrules/browser/elements.py b/plone/app/contentrules/browser/elements.py\nindex b017bf8..05e650b 100644\n--- a/plone/app/contentrules/browser/elements.py\n+++ b/plone/app/contentrules/browser/elements.py\n@@ -170,7 +170,8 @@ def assignments(self):\n                 \'url\': a.getURL(),\n                 \'title\': a.Title or a.getId,\n                 \'description\': a.Description,\n-            })\n+                \'icon\': f\'contenttype/{a.portal_type.lower()}\'\n+                })\n \n         return info\n \ndiff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex b54286c..9357949 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -378,10 +378,9 @@\n                                 </span>\n \n                                 <tal:items repeat="assignment assignments">\n-\n-                                    <a tal:attributes="href string:${assignment/url}/@@manage-content-rules"\n-                                        tal:content="assignment/title" />\n-\n+                                    <a tal:attributes="href string:${assignment/url}/@@manage-content-rules">\n+                                        <tal:icon tal:replace="structure python:icons.tag(assignment[\'icon\'])" /><span class="ms-2" tal:content="assignment/title">title</span>\n+                                    </a>&nbsp;\n                                 </tal:items>\n                             </div>\n                         </tal:assignments>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:34:51+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.app.contentrules/commit/cffdd7464218e039b498aac8e7ac7c499340cd15

fix enabled/disabled condition

Files changed:
M plone/app/contentrules/browser/templates/controlpanel.pt

b'diff --git a/plone/app/contentrules/browser/templates/controlpanel.pt b/plone/app/contentrules/browser/templates/controlpanel.pt\nindex 615f034..4bb20c1 100644\n--- a/plone/app/contentrules/browser/templates/controlpanel.pt\n+++ b/plone/app/contentrules/browser/templates/controlpanel.pt\n@@ -152,7 +152,7 @@\n                           <input type="hidden"\n                                 name="rule-id"\n                                 tal:attributes="value rule/id">\n-                          <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link ${python:not rule[\'enabled\'] and \'d-none\'}" type="submit" value="Enable"\n+                          <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link ${python: rule[\'enabled\'] and \'d-none\'}" type="submit" value="Enable"\n                                 name="form.button.EnableRule"\n                                 tal:attributes="data-value rule/id;\n                                                 data-url string:$portal_url/@@contentrule-enable"\n@@ -160,7 +160,7 @@\n                                 i18n:attributes="value label_enable;">\n                                 <tal:icon tal:replace="structure python:icons.tag(\'square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="">enabled</span>\n                           </button>\n-                          <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link ${python:rule[\'enabled\'] and \'d-none\'}" type="submit" value="Disable"\n+                          <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link ${python: not rule[\'enabled\'] and \'d-none\'}" type="submit" value="Disable"\n                                 name="form.button.DisableRule"\n                                 tal:attributes="data-value rule/id;\n                                                 data-url string:$portal_url/@@contentrule-disable"\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:34:51+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.app.contentrules/commit/3cf13de77ede23d5c4dafb813b7acfca1e253989

add rule-title class to make it easier to look it up

Files changed:
M plone/app/contentrules/browser/templates/controlpanel.pt

b'diff --git a/plone/app/contentrules/browser/templates/controlpanel.pt b/plone/app/contentrules/browser/templates/controlpanel.pt\nindex 4bb20c1..ea2ab9d 100644\n--- a/plone/app/contentrules/browser/templates/controlpanel.pt\n+++ b/plone/app/contentrules/browser/templates/controlpanel.pt\n@@ -131,7 +131,7 @@\n                     <tr tal:define="oddrow repeat/rule/odd"\n                         tal:attributes="class python:(oddrow and \'even \' or \'odd \') + rule[\'row_class\'];">\n                         <td>\n-                          <h5>\n+                          <h5 class="rule-title">\n                             <span\n                                tal:replace="rule/title">Rule Title</span>\n                           </h5>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:34:51+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/b6339bc2e75d79a8a438a86fc9306853b78b72e7

new style for assignments

Files changed:
M plone/app/contentrules/browser/templates/controlpanel.pt
M plone/app/contentrules/browser/templates/manage-elements.pt

b'diff --git a/plone/app/contentrules/browser/templates/controlpanel.pt b/plone/app/contentrules/browser/templates/controlpanel.pt\nindex ea2ab9d..0994897 100644\n--- a/plone/app/contentrules/browser/templates/controlpanel.pt\n+++ b/plone/app/contentrules/browser/templates/controlpanel.pt\n@@ -15,12 +15,47 @@\n     <h1 class="documentFirstHeading"\n         i18n:translate="title_manage_contentrules">Content Rules</h1>\n \n-    <p i18n:translate="description-contentrules-controlpanel" class="documentDescription">\n+    <p i18n:translate="description-contentrules-controlpanel" class="lead">\n         Use the form below to define, change or remove content rules. Rules\n         will automatically perform actions on content when certain triggers\n         take place. After defining rules, you may want to go to a folder\n         to assign them, using the "rules" item in the actions menu.\n     </p>\n+\n+    <div id="fieldset-global">\n+      <form name="ruleSettings" method="POST"\n+           tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n+          <span tal:replace="structure context/@@authenticator/authenticator"/>\n+          <div class="form-check">\n+              <input type="hidden" name="global_disable:boolean:default" value="" />\n+              <input type="checkbox"\n+                     class="form-check-input"\n+                     id="rules_disable_globally"\n+                     name="global_disable:boolean"\n+                     value="True"\n+                     tal:attributes="checked python:view.globally_disabled() and \'checked\' or None" />\n+              <label class="form-check-label" for="rules_disable_globally" i18n:translate="">Disable globally</label>\n+              <div class="form-text" i18n:translate="">\n+                  Whether or not content rules should be disabled globally. If this is selected,\n+                  no rules will be executed anywhere in the portal.\n+              </div>\n+          </div>\n+\n+          <noscript>\n+          <!-- we\'ll use js to submit this normally -->\n+            <div class="formControls">\n+                <input type="submit"\n+                       name="form.button.SaveSettings"\n+                       class="btn btn-primary"\n+                       value="Save"\n+                       i18n:attributes="value label_save;" />\n+            </div>\n+          </noscript>\n+      </form>\n+\n+    </div>\n+\n+\n   </header>\n \n   <div id="content-core">\n@@ -42,177 +77,147 @@\n       </span>\n     </div>\n \n-      <div id="fieldset-global" class="mb-5">\n-        <form name="ruleSettings" method="POST"\n-             tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n-            <span tal:replace="structure context/@@authenticator/authenticator"/>\n-            <div class="form-check">\n-                <input type="hidden" name="global_disable:boolean:default" value="" />\n-                <input type="checkbox"\n-                       class="form-check-input"\n-                       id="rules_disable_globally"\n-                       name="global_disable:boolean"\n-                       value="True"\n-                       tal:attributes="checked python:view.globally_disabled() and \'checked\' or None" />\n-                <label class="form-check-label" for="rules_disable_globally" i18n:translate="">Disable globally</label>\n-                <div class="form-text" i18n:translate="">\n-                    Whether or not content rules should be disabled globally. If this is selected,\n-                    no rules will be executed anywhere in the portal.\n-                </div>\n-            </div>\n \n-            <noscript>\n-            <!-- we\'ll use js to submit this normally -->\n-              <div class="formControls">\n-                  <input type="submit"\n-                         name="form.button.SaveSettings"\n-                         class="btn btn-primary"\n-                         value="Save"\n-                         i18n:attributes="value label_save;" />\n-              </div>\n-            </noscript>\n-        </form>\n-\n-      </div>\n-\n-      <div class="card">\n-       <fieldset id="fieldset-rules" class="card-body"\n-                 tal:define="rules rules|view/registeredRules;">\n-            <legend id="fieldsetlegend-rules" i18n:translate="legend-contentrules">Content rules</legend>\n-\n-            <div class="filters mt-2 mb-3" tal:condition="rules">\n-              <span class="type-filters">\n-                <span i18n:translate="">Filter:</span>\n-                <span class="filter-option"\n-                      tal:repeat="rule view/ruleTypesToShow">\n-                    <div class="form-check form-check-inline">\n-                      <input id="all" class="form-check-input" type="checkbox"\n-                             tal:attributes="id rule/id"\n-                             />\n-                      <label class="form-check-label"\n-                             for="all"\n-                             tal:attributes="for rule/id"\n-                             tal:content="rule/title">\n-                             All</label>\n-                    </div>\n-                </span>\n+    <div class="card">\n+      <fieldset id="fieldset-rules" class="card-body"\n+                tal:define="rules rules|view/registeredRules;">\n+\n+          <div class="filters row row-cols-lg-auto g-3 align-items-center" tal:condition="rules">\n+            <span class="type-filters">\n+              <label class="col-form-label pe-3" i18n:translate="">Filter rules:</label>\n+              <span class="filter-option"\n+                    tal:repeat="rule view/ruleTypesToShow">\n+                  <div class="form-check form-check-inline">\n+                    <input id="all" class="form-check-input" type="checkbox"\n+                            tal:attributes="id rule/id"\n+                            />\n+                    <label class="form-check-label"\n+                            for="all"\n+                            tal:attributes="for rule/id"\n+                            tal:content="rule/title">\n+                            All</label>\n+                  </div>\n               </span>\n-              <span class="state-filters" tal:condition="rules">\n-                <span class="filter-option"\n-                      tal:repeat="state view/statesToShow">\n-                    <div class="form-check form-check-inline">\n-                      <input id="all" class="form-check-input" type="checkbox"\n-                             tal:attributes="id state/id"\n-                             />\n-                      <label class="form-check-label"\n-                             for="all"\n-                             tal:attributes="for state/id"\n-                             tal:content="state/title">\n-                             All</label>\n-                    </div>\n-                </span>\n+            </span>\n+            <span class="state-filters">\n+              <span class="filter-option"\n+                    tal:repeat="state view/statesToShow">\n+                  <div class="form-check form-check-inline">\n+                    <input id="all" class="form-check-input" type="checkbox"\n+                            tal:attributes="id state/id"\n+                            />\n+                    <label class="form-check-label"\n+                            for="all"\n+                            tal:attributes="for state/id"\n+                            tal:content="state/title">\n+                            All</label>\n+                  </div>\n               </span>\n-            </div>\n-            <div class="visualClear"><!-- --></div>\n-            <div id="rules_table_form"\n-                 metal:define-macro="rules_table_form">\n-            <table  class="listing nosort controlpanel-listing table"\n-                    tal:condition="rules">\n-                <thead class="">\n-                    <tr>\n-                        <th scope="col" i18n:translate="label_contentrules_rule_listing">Content rule</th>\n-                        <th scope="col" i18n:translate="label_contentrules_rule_event">Event</th>\n-                        <th scope="col" i18n:translate="label_contentrules_rule_status"><span class="ps-2">Status</span></th>\n-                        <th scope="col" i18n:translate="label_contentrules_rule_actions">Actions</th>\n-                    </tr>\n-                </thead>\n-                <tbody>\n-                    <tal:rules repeat="rule view/registeredRules">\n-                    <tr tal:define="oddrow repeat/rule/odd"\n-                        tal:attributes="class python:(oddrow and \'even \' or \'odd \') + rule[\'row_class\'];">\n-                        <td>\n-                          <h5 class="rule-title">\n-                            <span\n-                               tal:replace="rule/title">Rule Title</span>\n-                          </h5>\n-                            <div tal:content="rule/description">\n-                                Rule Description.\n-                            </div>\n-                        </td>\n-                        <td>\n-                            <span class="trigger"\n-                                  tal:content="rule/trigger"\n-                                  i18n:translate="">trigger</span>\n-                        </td>\n-                        <td class="status">\n-\n-                          <form style="display: inline" method="POST"\n-                                tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n-                          <span tal:replace="structure context/@@authenticator/authenticator"/>\n-                          <input type="hidden"\n-                                name="rule-id"\n-                                tal:attributes="value rule/id">\n-                          <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link ${python: rule[\'enabled\'] and \'d-none\'}" type="submit" value="Enable"\n-                                name="form.button.EnableRule"\n-                                tal:attributes="data-value rule/id;\n-                                                data-url string:$portal_url/@@contentrule-enable"\n-                                i18n:translate=""\n-                                i18n:attributes="value label_enable;">\n-                                <tal:icon tal:replace="structure python:icons.tag(\'square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="">enabled</span>\n-                          </button>\n-                          <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link ${python: not rule[\'enabled\'] and \'d-none\'}" type="submit" value="Disable"\n-                                name="form.button.DisableRule"\n-                                tal:attributes="data-value rule/id;\n-                                                data-url string:$portal_url/@@contentrule-disable"\n-                                i18n:translate=""\n-                                i18n:attributes="value label_disable;">\n-                                <tal:icon tal:replace="structure python:icons.tag(\'check-square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="">enabled</span>\n-                              </button>\n-                          </form>\n-\n+            </span>\n+          </div>\n+\n+          <div class="visualClear"><!-- --></div>\n+          <div id="rules_table_form"\n+                metal:define-macro="rules_table_form">\n+          <table  class="listing nosort controlpanel-listing table mb-0"\n+                  tal:condition="rules">\n+              <thead class="">\n+                  <tr>\n+                      <th scope="col" i18n:translate="label_contentrules_rule_listing">Content rule</th>\n+                      <th scope="col" i18n:translate="label_contentrules_rule_event">Event</th>\n+                      <th scope="col" i18n:translate="label_contentrules_rule_status"><span class="ps-2">Status</span></th>\n+                      <th scope="col" i18n:translate="label_contentrules_rule_actions">Actions</th>\n+                  </tr>\n+              </thead>\n+              <tbody>\n+                  <tal:rules repeat="rule view/registeredRules">\n+                  <tr tal:define="oddrow repeat/rule/odd"\n+                      tal:attributes="class python:(oddrow and \'even \' or \'odd \') + rule[\'row_class\'];">\n+                      <td>\n+                        <h5 class="rule-title">\n                           <span\n-                            class="badge bg-warning text-dark icon-contentrule-enabled-unassigned"\n-                            alt="unassigned"\n-                            title="this rule has not been assigned"\n-                            tal:condition="python:not rule[\'assigned\']"\n-                            i18n:attributes="alt label_contentrules_rule_unassigned;\n-                                            title title_contentrule_rule_unassigned;">\n-                            <tal:icon tal:replace="structure python:icons.tag(\'exclamation-triangle-fill\', tag_alt=\'not assigned\')" /><span class="ms-2" i18n:translate="">not assigned</span>\n-                      </span>\n-\n-\n-\n-                        </td>\n-                        <td>\n-                          <form style="display: inline" method="POST"\n-                                tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n-                          <span tal:replace="structure context/@@authenticator/authenticator"/>\n-                          <input type="hidden"\n-                                name="rule-id"\n-                                tal:attributes="value rule/id">\n-                          <a href="" class="btn btn-sm btn-primary"\n-                          tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements">Configure</a>\n-                          <a href="" class="btn btn-sm btn-secondary"\n-                                tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@edit">Edit</a>\n-\n-                          <button class="destructive btn-rule-action btn-rule-delete btn btn-sm btn-danger" type="submit" value="Delete"\n-                                tal:attributes="data-value rule/id;\n-                                                data-url string:$portal_url/@@contentrule-delete"\n-                                name="form.button.DeleteRule"\n-                                i18n:translate=""\n-                                i18n:attributes="value label_delete;">Delete</button>\n-                          </form>\n-                        </td>\n-                    </tr>\n-                    </tal:rules>\n-                </tbody>\n-            </table>\n-            </div>\n-          </fieldset>\n-        </div>\n+                              tal:replace="rule/title">Rule Title</span>\n+                        </h5>\n+                          <div tal:content="rule/description">\n+                              Rule Description.\n+                          </div>\n+                      </td>\n+                      <td>\n+                          <span class="trigger"\n+                                tal:content="rule/trigger"\n+                                i18n:translate="">trigger</span>\n+                      </td>\n+                      <td class="status">\n+\n+                        <form style="display: inline" method="POST"\n+                              tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n+                        <span tal:replace="structure context/@@authenticator/authenticator"/>\n+                        <input type="hidden"\n+                              name="rule-id"\n+                              tal:attributes="value rule/id">\n+                        <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link ${python: rule[\'enabled\'] and \'d-none\'}" type="submit" value="Enable"\n+                              name="form.button.EnableRule"\n+                              tal:attributes="data-value rule/id;\n+                                              data-url string:$portal_url/@@contentrule-enable"\n+                              i18n:translate=""\n+                              i18n:attributes="value label_enable;">\n+                              <tal:icon tal:replace="structure python:icons.tag(\'square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="">enabled</span>\n+                        </button>\n+                        <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link ${python: not rule[\'enabled\'] and \'d-none\'}" type="submit" value="Disable"\n+                              name="form.button.DisableRule"\n+                              tal:attributes="data-value rule/id;\n+                                              data-url string:$portal_url/@@contentrule-disable"\n+                              i18n:translate=""\n+                              i18n:attributes="value label_disable;">\n+                              <tal:icon tal:replace="structure python:icons.tag(\'check-square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="">enabled</span>\n+                            </button>\n+                        </form>\n+\n+                        <span\n+                          class="badge bg-warning text-dark icon-contentrule-enabled-unassigned"\n+                          alt="unassigned"\n+                          title="this rule has not been assigned"\n+                          tal:condition="python:not rule[\'assigned\']"\n+                          i18n:attributes="alt label_contentrules_rule_unassigned;\n+                                          title title_contentrule_rule_unassigned;">\n+                          <tal:icon tal:replace="structure python:icons.tag(\'exclamation-triangle-fill\', tag_alt=\'not assigned\')" /><span class="ms-2" i18n:translate="">not assigned</span>\n+                    </span>\n+\n+\n+\n+                      </td>\n+                      <td>\n+                        <form style="display: inline" method="POST"\n+                              tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n+                        <span tal:replace="structure context/@@authenticator/authenticator"/>\n+                        <input type="hidden"\n+                              name="rule-id"\n+                              tal:attributes="value rule/id">\n+                        <a href="" class="btn btn-sm btn-primary"\n+                        tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements">Configure</a>\n+                        <a href="" class="btn btn-sm btn-secondary"\n+                              tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@edit">Edit</a>\n+\n+                        <button class="destructive btn-rule-action btn-rule-delete btn btn-sm btn-danger" type="submit" value="Delete"\n+                              tal:attributes="data-value rule/id;\n+                                              data-url string:$portal_url/@@contentrule-delete"\n+                              name="form.button.DeleteRule"\n+                              i18n:translate=""\n+                              i18n:attributes="value label_delete;">Delete</button>\n+                        </form>\n+                      </td>\n+                  </tr>\n+                  </tal:rules>\n+              </tbody>\n+          </table>\n+          </div>\n+        </fieldset>\n+      </div>\n+      <div class="mt-3">\n         <a id="#addcontentrule" tal:attributes="href string:${context/absolute_url}/+rule/plone.ContentRule;"\n-           class="plone-btn plone-btn-primary btn btn-success"\n-           i18n:translate="label_contentrule_add">Add content rule</a>\n+            class="plone-btn plone-btn-primary btn btn-success"\n+            i18n:translate="label_contentrule_add">Add content rule</a>\n+      </div>\n     </div>\n </metal:main>\n </body>\ndiff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex 9357949..62f672d 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -12,354 +12,254 @@\n         <metal:main metal:fill-slot="prefs_configlet_main">\n \n             <header>\n-                <h1 class="documentFirstHeading"\n-                    i18n:translate="title_edit_contentrule">Edit content rule</h1>\n+                <h1 class="documentFirstHeading">\n+                    <span i18n:translate="title_edit_contentrule">Edit content rule</span>:\n+                    <span tal:replace="view/rule_title"></span>\n+                </h1>\n \n                 <p i18n:translate="contentrules_description_execution"\n-                    class="text-muted">\n+                    class="lead">\n                     Rules execute when a triggering event occurs. Rule actions will only\n                     be invoked if all the rule\'s conditions are met. You can add new\n                     actions and conditions using the buttons below.\n                 </p>\n-            </header>\n-\n-            <div id="content-core" class="pat-contentrules-elements">\n-\n                 <a href=""\n-                    class="link-parent d-block mb-3"\n+                    class="link-parent d-block"\n                     tal:attributes="href string:${portal_url}/@@rules-controlpanel"\n-                    i18n:translate="go_to_contentrules_management">\n-                    Up to rule management\n+                    i18n:translate="go_to_contentrules_overview">\n+                    Up to rule overview\n                 </a>\n+            </header>\n \n+            <div id="content-core" class="pat-contentrules-elements">\n \n-                <!-- <fieldset id="configure-rule" class="col">\n-                    <legend i18n:translate="">Configure rule</legend>\n-                    <form class="mb-3"\n-                        tal:attributes="action view/view_url"\n-                        method="post">\n-                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                        <div class="field">\n-                            <label for="form.title"\n-                                i18n:translate="label_title">Title</label>\n-                            <div class="formHelp"\n-                                i18n:translate="description_contentrule_title">\n-                    Please set a descriptive title for the rule.\n-                            </div>\n-                            <input id="form.title"\n-                                class="form-control"\n-                                type="text"\n-                                width="50"\n-                                name="title"\n-                                tal:attributes="value request/ruleTitle | view/rule_title" />\n-                        </div>\n-                        <div class="field">\n-                            <label for="form.description"\n-                                i18n:translate="label_description">Description</label>\n-                            <div class="formHelp"\n-                                i18n:translate="contentrules_description_description">\n-                    Enter a short description of the rule and its purpose.\n-                            </div>\n-                            <textarea id="form.description"\n-                                class="form-control"\n-                                name="description"\n-                                tal:content="request/ruleDescription | view/rule_description ">\n-                            </textarea>\n-                        </div>\n-\n-                        <div class="field">\n-                            <label i18n:translate="label_rule_event_trigger">\n-                    Event trigger: <span i18n:name="trigger"\n-                                tal:content="view/rule_event"></span>\n-                            </label>\n-                            <div class="formHelp"\n-                                i18n:translate="contentrules_description_trigger">\n-                    The rule will execute when the following event occurs.\n-                            </div>\n-                        </div>\n-\n-                        <div class="field">\n-                            <input type="checkbox"\n-                                id="stop"\n-                                name="stopExecuting"\n-                                tal:attributes="checked view/rule_stop" />\n-                            <label for="stop"\n-                                i18n:translate="contentrules_description_stop">\n-                    Stop evaluating content rules after this rule completes\n-                            </label>\n-                        </div>\n-\n-                        <div class="field">\n-                            <input type="checkbox"\n-                                id="cascading"\n-                                name="cascading"\n-                                tal:attributes="checked view/rule_cascading" />\n-                            <label for="cascading"\n-                                i18n:translate="contentrules_description_cascading">\n-                    The actions executed by this rule can trigger other rules\n-                            </label>\n-                        </div>\n-\n-                        <div class="field">\n-                            <input type="checkbox"\n-                                id="enabled"\n-                                name="enabled"\n-                                tal:attributes="checked view/rule_enabled" />\n-                            <label for="enabled"\n-                                i18n:translate="">\n-                    Enabled\n-                            </label>\n-                        </div>\n-\n-                        <div class="formControls">\n-                            <button class="context btn btn-primary"\n-                                type="submit"\n-                                name="form.button.Save"\n-                                value="Save"\n-                                i18n:attributes="value label_save;"\n-                                i18n:translate="label_save">Save</button>\n+                <div class="row row-cols-1 row-cols-md-2">\n+                    <fieldset id="configure-conditions" class="col"\n+                        tal:define="conditions view/conditions">\n+                        <legend i18n:translate="if_all_conditions_met" class="float-none">\n+                            If all of the following conditions are met:\n+                        </legend>\n+\n+                        <div tal:condition="not:conditions"\n+                            class="alert alert-info">\n+                            <strong i18n:translate="">Info</strong>\n+                            <span i18n:translate="">\n+                                There is not any additional condition checked on this rule.\n+                            </span>\n                         </div>\n-                    </form>\n-                </fieldset> -->\n-\n-\n-\n-\n-            <div class="row row-cols-1 row-cols-md-2">\n-                <fieldset id="configure-conditions" class="col"\n-                    tal:define="conditions view/conditions">\n-                    <legend i18n:translate="if_all_conditions_met">\n-                        If all of the following conditions are met:\n-                    </legend>\n-                    <a name="condition"></a>\n \n-                    <div tal:condition="not:conditions"\n-                        class="alert alert-info">\n-                        <strong>Info</strong>\n-                        <span i18n:translate="">\n-                            There is not any additional condition checked on this rule.\n-                        </span>\n-                    </div>\n-\n-                    <form class="mb-3"\n-                        tal:attributes="action view/view_url"\n-                        method="post"\n-                        tal:define="auth_token context/@@authenticator/token"\n-                        tal:repeat="condition conditions">\n-                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                        <a tal:attributes="name string:condition++${condition/idx}"></a>\n-                        <input type="hidden"\n-                            name="element_id:int"\n-                            tal:attributes="value condition/idx" />\n-\n-                        <div class="card">\n-                            <div class="card-body row">\n-                                <div class="col">\n-                                    <h5 class="card-title"\n-                                    tal:content="condition/title"\n-                                    i18n:translate="">Transition was publish.</h5>\n-                                </div>\n-                                <div class="col-auto">\n-                                    <div class="rule-operations">\n-                                        <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n-                                            class="pat-plone-modal btn btn-sm btn-primary"\n-                                            tal:condition="condition/editview"\n-                                            i18n:translate="label_edit">Edit</a>\n-                                        <button type="submit"\n-                                            name="form.button.DeleteCondition"\n-                                            value="Remove"\n-                                            class="context btn btn-sm btn-danger"\n-                                            i18n:attributes="value label_remove;"\n-                                            i18n:translate="label_remove">Remove</button>\n-                                        <button tal:attributes="disabled python:condition[\'first\'] and \'disabled\' or None"\n-                                            type="submit"\n-                                            name="form.button.MoveConditionUp"\n-                                            value="&uarr;"\n-                                            class="context btn btn-sm btn-primary">&uarr;</button>\n-                                        <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n-                                            type="submit"\n-                                            name="form.button.MoveConditionDown"\n-                                            value="&darr;"\n-                                            class="context btn btn-sm btn-primary">&darr;</button>\n+                        <form class="mb-3"\n+                            tal:attributes="action view/view_url"\n+                            method="post"\n+                            tal:define="auth_token context/@@authenticator/token"\n+                            tal:repeat="condition conditions">\n+                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                            <a tal:attributes="name string:condition++${condition/idx}"></a>\n+                            <input type="hidden"\n+                                name="element_id:int"\n+                                tal:attributes="value condition/idx" />\n+\n+                            <div class="card">\n+                                <div class="card-body row">\n+                                    <div class="col">\n+                                        <h5 class="card-title"\n+                                        tal:content="condition/title"\n+                                        i18n:translate="">Transition was publish.</h5>\n+                                    </div>\n+                                    <div class="col-auto">\n+                                        <div class="rule-operations">\n+                                            <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n+                                                class="pat-plone-modal btn btn-sm btn-primary"\n+                                                tal:condition="condition/editview"\n+                                                i18n:translate="label_edit">Edit</a>\n+                                            <button type="submit"\n+                                                name="form.button.DeleteCondition"\n+                                                value="Remove"\n+                                                class="context btn btn-sm btn-danger"\n+                                                i18n:attributes="value label_remove;"\n+                                                i18n:translate="label_remove">Remove</button>\n+                                            <button tal:attributes="disabled python:condition[\'first\'] and \'disabled\' or None"\n+                                                type="submit"\n+                                                name="form.button.MoveConditionUp"\n+                                                value="&uarr;"\n+                                                class="context btn btn-sm btn-primary">&uarr;</button>\n+                                            <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n+                                                type="submit"\n+                                                name="form.button.MoveConditionDown"\n+                                                value="&darr;"\n+                                                class="context btn btn-sm btn-primary">&darr;</button>\n+                                        </div>\n                                     </div>\n+                                    <p class="card-text" tal:content="condition/summary">\n+                                        Something happened\n+                                    </p>\n                                 </div>\n-                                <p class="card-text" tal:content="condition/summary">\n-                                    Something happened\n-                                </p>\n                             </div>\n-                        </div>\n-                    </form>\n-\n-                    <form class="mb-3"\n-                        tal:attributes="action string:${view/base_url}/+condition"\n-                        method="get"\n-                        id="add-condition">\n-                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                        <div class="input-group">\n+                        </form>\n+\n+                        <form class="mb-3"\n+                            tal:attributes="action string:${view/base_url}/+condition"\n+                            method="get"\n+                            id="add-condition">\n+                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                            <div class="input-group">\n+\n+                                <span class="input-group-text" i18n:translate="contentrules_condition"\n+                                    for="contentrules-add-condition">\n+                                    Condition:\n+                                </span>\n \n-                            <!-- <label class="form-label" i18n:translate="contentrules_add_condition"\n-                                for="contentrules-add-condition">\n-                                Condition\n-                            </label> -->\n+                                <select name=":action"\n+                                    size="1"\n+                                    id="contentrules-add-condition"\n+                                    class="form-select"\n+                                    aria-label="Add condition"\n+                                    i18n:attributes="aria-label contentrules_add_condition">\n+                                    <tal:block repeat="condition view/addable_conditions">\n+                                        <option tal:attributes="value condition/addview"\n+                                            i18n:translate=""\n+                                            tal:content="condition/title" />\n+                                    </tal:block>\n+                                </select>\n+                                <button class="context allowMultiSubmit btn btn-success"\n+                                    type="submit"\n+                                    name="form.button.AddCondition"\n+                                    value="Add"\n+                                    i18n:attributes="value label_add;"\n+                                    i18n:translate="label_add">Add</button>\n+                            </div>\n+                            &nbsp; <!-- For Safari -->\n+                        </form>\n+                    </fieldset>\n \n-                            <span class="input-group-text" i18n:translate="contentrules_condition"\n-                                for="contentrules-add-condition">\n-                                Condition\n+                    <fieldset id="configure-actions" class="col"\n+                        tal:define="actions view/actions">\n+                        <legend i18n:translate="contentrules_perform_actions" class="float-none">\n+                            Perform the following actions:\n+                        </legend>\n+\n+                        <div tal:condition="not:actions"\n+                            class="alert alert-warning">\n+                            <strong i18n:translate="">Warning</strong>\n+                            <span i18n:translate="">\n+                                There is not any action performed by this rule.\n+                                Click on Add button to setup an action.\n                             </span>\n-\n-                            <select name=":action"\n-                                size="1"\n-                                id="contentrules-add-condition"\n-                                class="form-select"\n-                                aria-label="Add condition"\n-                                i18n:attributes="aria-label contentrules_add_condition">\n-                                <tal:block repeat="condition view/addable_conditions">\n-                                    <option tal:attributes="value condition/addview"\n-                                        i18n:translate=""\n-                                        tal:content="condition/title" />\n-                                </tal:block>\n-                            </select>\n-                            <button class="context allowMultiSubmit btn btn-success"\n-                                type="submit"\n-                                name="form.button.AddCondition"\n-                                value="Add"\n-                                i18n:attributes="value label_add;"\n-                                i18n:translate="label_add">Add</button>\n                         </div>\n-                        &nbsp;                         <!-- For Safari -->\n-                    </form>\n-                </fieldset>\n-\n-                <fieldset id="configure-actions" class="col"\n-                    tal:define="actions view/actions">\n-                    <legend i18n:translate="contentrules_perform_actions">\n-                        Perform the following actions:\n-                    </legend>\n-                    <a name="action"></a>\n-\n-                    <div tal:condition="not:actions"\n-                        class="alert alert-warning">\n-                        <strong>Warning</strong>\n-                        <span i18n:translate="">\n-                            There is not any action performed by this rule.\n-                            Click on Add button to setup an action.\n-                        </span>\n-                    </div>\n-                    <form class="mb-3"\n-                        tal:attributes="action view/view_url"\n-                        method="post"\n-                        tal:define="auth_token context/@@authenticator/token"\n-                        tal:repeat="action actions">\n-                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                        <a tal:attributes="name string:action++${action/idx}"></a>\n-                        <input type="hidden"\n-                            name="element_id:int"\n-                            tal:attributes="value action/idx" />\n-\n-                        <div class="card">\n-                            <div class="card-body row">\n-                                <div class="col">\n-                                    <h5 class="card-title"\n-                                    tal:content="action/title"\n-                                    i18n:translate="">Move to folder</h5>\n-                                </div>\n-                                <div class="col-auto">\n-                                    <div class="rule-operations">\n-                                        <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}"\n-                                            class="pat-plone-modal btn btn-sm btn-primary"\n-                                            tal:condition="action/editview"\n-                                            i18n:translate="label_edit">Edit</a>\n-                                        <button type="submit"\n-                                            name="form.button.DeleteAction"\n-                                            value="Remove"\n-                                            class="context btn btn-sm btn-danger"\n-                                            i18n:attributes="value label_remove;"\n-                                            i18n:translate="label_remove">Remove</button>\n-                                        <button tal:attributes="disabled python:action[\'first\'] and \'disabled\' or None"\n-                                            type="submit"\n-                                            name="form.button.MoveActionUp"\n-                                            value="&uarr;"\n-                                            class="context btn btn-sm btn-primary">&uarr;</button>\n-                                        <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n-                                            type="submit"\n-                                            name="form.button.MoveActionDown"\n-                                            value="&darr;"\n-                                            class="context btn btn-sm btn-primary">&darr;</button>\n+                        <form class="mb-3"\n+                            tal:attributes="action view/view_url"\n+                            method="post"\n+                            tal:define="auth_token context/@@authenticator/token"\n+                            tal:repeat="action actions">\n+                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                            <a tal:attributes="name string:action++${action/idx}"></a>\n+                            <input type="hidden"\n+                                name="element_id:int"\n+                                tal:attributes="value action/idx" />\n+\n+                            <div class="card">\n+                                <div class="card-body row">\n+                                    <div class="col">\n+                                        <h5 class="card-title"\n+                                        tal:content="action/title"\n+                                        i18n:translate="">Move to folder</h5>\n+                                    </div>\n+                                    <div class="col-auto">\n+                                        <div class="rule-operations">\n+                                            <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}"\n+                                                class="pat-plone-modal btn btn-sm btn-primary"\n+                                                tal:condition="action/editview"\n+                                                i18n:translate="label_edit">Edit</a>\n+                                            <button type="submit"\n+                                                name="form.button.DeleteAction"\n+                                                value="Remove"\n+                                                class="context btn btn-sm btn-danger"\n+                                                i18n:attributes="value label_remove;"\n+                                                i18n:translate="label_remove">Remove</button>\n+                                            <button tal:attributes="disabled python:action[\'first\'] and \'disabled\' or None"\n+                                                type="submit"\n+                                                name="form.button.MoveActionUp"\n+                                                value="&uarr;"\n+                                                class="context btn btn-sm btn-primary">&uarr;</button>\n+                                            <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n+                                                type="submit"\n+                                                name="form.button.MoveActionDown"\n+                                                value="&darr;"\n+                                                class="context btn btn-sm btn-primary">&darr;</button>\n+                                        </div>\n                                     </div>\n+                                    <p class="card-text" tal:content="action/summary">\n+                                        Something happened\n+                                    </p>\n                                 </div>\n-                                <p class="card-text" tal:content="action/summary">\n-                                    Something happened\n-                                </p>\n                             </div>\n-                        </div>\n-\n \n-                    </form>\n \n-                    <form class="mb-3"\n-                        tal:attributes="action string:${view/base_url}/+action"\n-                        method="get"\n-                        id="add-action">\n-                        <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-                        <div class="input-group">\n-                            <!-- <label class="form-label"\n-                                i18n:translate="contentrules_add_action"\n-                                for="contentrules-add-action">Add action</label> -->\n-\n-                            <span class="input-group-text"\n-                                i18n:translate="contentrules_action"\n-                                for="contentrules-add-action">Action</span>\n-\n-                            <select name=":action"\n-                                size="1"\n-                                id="contentrules-add-action"\n-                                class="form-select"\n-                                aria-label="Add action"\n-                                i18n:attributes="aria-label contentrules_add_action">\n-                                <tal:block repeat="action view/addable_actions">\n-                                    <option tal:attributes="value action/addview"\n-                                        i18n:translate=""\n-                                        tal:content="action/title"></option>\n-                                </tal:block>\n-                            </select>\n-                            <button class="context allowMultiSubmit btn btn-success"\n-                                type="submit"\n-                                name="form.button.AddAction"\n-                                value="Add"\n-                                i18n:attributes="value label_add;"\n-                                i18n:translate="label_add">Add</button>\n-                        </div>\n-                        &nbsp;                         <!-- For Safari -->\n-                    </form>\n-                </fieldset>\n-            </div>\n+                        </form>\n+\n+                        <form class="mb-3"\n+                            tal:attributes="action string:${view/base_url}/+action"\n+                            method="get"\n+                            id="add-action">\n+                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                            <div class="input-group">\n+\n+                                <span class="input-group-text"\n+                                    i18n:translate="contentrules_action"\n+                                    for="contentrules-add-action">Action:</span>\n+\n+                                <select name=":action"\n+                                    size="1"\n+                                    id="contentrules-add-action"\n+                                    class="form-select"\n+                                    aria-label="Add action"\n+                                    i18n:attributes="aria-label contentrules_add_action">\n+                                    <tal:block repeat="action view/addable_actions">\n+                                        <option tal:attributes="value action/addview"\n+                                            i18n:translate=""\n+                                            tal:content="action/title"></option>\n+                                    </tal:block>\n+                                </select>\n+                                <button class="context allowMultiSubmit btn btn-success"\n+                                    type="submit"\n+                                    name="form.button.AddAction"\n+                                    value="Add"\n+                                    i18n:attributes="value label_add;"\n+                                    i18n:translate="label_add">Add</button>\n+                            </div>\n+                            &nbsp; <!-- For Safari -->\n+                        </form>\n+                    </fieldset>\n+                </div>\n \n \n \n                 <tal:assignments define="assignments view/assignments">\n \n                     <fieldset id="manage-assignments" class="col">\n-                        <legend i18n:translate="label_contentrules_rule_assignments">Assignments</legend>\n+                        <legend i18n:translate="label_contentrules_rule_assignments" class="float-none">Assignments</legend>\n+\n+\n                         <tal:noassignments condition="not:assignments">\n-                            <div class="portalMessage warning">\n+                            <div class="alert alert-info">\n                                 <strong i18n:translate="">This rule is not assigned to any location</strong>\n-\n                                 <tal:enabled condition="view/rule_enabled">\n-                                    <span i18n:translate="">\n+                                    <div i18n:translate="">\n                                         The rule is enabled but will perform nothing since it is not assigned anywhere.\n-                                    </span>\n-                                    <br />\n-                                    <span i18n:translate="">\n+                                    </div>\n+                                </tal:enabled>\n+                            </div>\n+\n+                                <tal:enabled condition="view/rule_enabled">\n+                                    <p i18n:translate="">\n                                         Go to the folder where you want the rule to apply, or at the site root,\n                                         click on \'rule\' tab, and then locally setup the rules.\n-                                    </span>\n+                                    </p>\n \n                                     <form class="mb-3"\n                                         tal:attributes="action view/view_url"\n                                         method="post">\n                                         <span tal:replace="structure context/@@authenticator/authenticator" />\n-                                        <label class="form-label"\n-                                            i18n:translate="contentrules_assignments_shortcuts">Shortcuts:</label>\n                                         <input type="submit"\n                                             class="btn btn-primary"\n                                             value="Apply rule on the whole site"\n@@ -367,21 +267,23 @@\n                                             i18n:attributes="value" />\n                                     </form>\n                                 </tal:enabled>\n-                            </div>\n-\n                         </tal:noassignments>\n                         <tal:assignments condition="nocall:assignments">\n-                            <div class="alert alert-info">\n-                                <strong>Info</strong>\n-                                <span i18n:translate="description_contentrules_rule_assignments">\n-                                    This rule is assigned to the following locations:\n-                                </span>\n-\n+                            <div class="card">\n+                                <div class="card-header">\n+                                    <span i18n:translate="description_contentrules_rule_assignments">\n+                                        This rule is assigned to the following locations:\n+                                    </span>\n+                                </div>\n+                                <ul class="list-group list-group-flush">\n                                 <tal:items repeat="assignment assignments">\n-                                    <a tal:attributes="href string:${assignment/url}/@@manage-content-rules">\n-                                        <tal:icon tal:replace="structure python:icons.tag(assignment[\'icon\'])" /><span class="ms-2" tal:content="assignment/title">title</span>\n-                                    </a>&nbsp;\n+                                    <li class="list-group-item">\n+                                        <a tal:attributes="href string:${assignment/url}/@@manage-content-rules">\n+                                            <tal:icon tal:replace="structure python:icons.tag(assignment[\'icon\'])" /><span class="ms-2" tal:content="assignment/title">title</span>\n+                                        </a>&nbsp;\n+                                    </li>\n                                 </tal:items>\n+                                </ul>\n                             </div>\n                         </tal:assignments>\n                     </fieldset>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:35:35+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/6d1286c88e6b16dff1478ff0ca635e4c0d0bc95d

fix site icon

Files changed:
M plone/app/contentrules/browser/elements.py

b"diff --git a/plone/app/contentrules/browser/elements.py b/plone/app/contentrules/browser/elements.py\nindex 05e650b..97879c6 100644\n--- a/plone/app/contentrules/browser/elements.py\n+++ b/plone/app/contentrules/browser/elements.py\n@@ -161,7 +161,8 @@ def assignments(self):\n                 'url': site.absolute_url(),\n                 'title': site.title_or_id(),\n                 'description': site.Description(),\n-            })\n+                'icon': 'plone-home'\n+                })\n \n         catalog = getToolByName(rule, 'portal_catalog')\n         for a in catalog(path=dict(query=list(paths), depth=0),\n"

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:37:23+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/34b5f5f7ef6eacf04c4849e0589bb552165f0784

update rule assignment view

Files changed:
M plone/app/contentrules/browser/templates/manage-assignments.pt

b'diff --git a/plone/app/contentrules/browser/templates/manage-assignments.pt b/plone/app/contentrules/browser/templates/manage-assignments.pt\nindex 2c4b668..e1310c9 100644\n--- a/plone/app/contentrules/browser/templates/manage-assignments.pt\n+++ b/plone/app/contentrules/browser/templates/manage-assignments.pt\n@@ -19,7 +19,7 @@\n           tal:attributes="href string:${context/portal_url}/++resource++manage-contentrules.css" />\n \n     <div tal:condition="not:view/globally_enabled"\n-         class="portalMessage info">\n+         class="alert alert-info">\n         <strong i18n:translate="">\n             Info\n         </strong>\n@@ -36,36 +36,44 @@\n     </div>\n \n     <article id="content">\n-        <h1 class="documentFirstHeading"\n-            i18n:translate="title_contentrules_assigned">\n-            Content rules for <q i18n:name="context" tal:content="context/Title">title</q>\n-        </h1>\n-\n-        <div class="documentDescription"\n-           i18n:translate="description_contentrules_assigned" tal:condition="view/has_rules">\n-            The following content rules are active in this\n-            <span i18n:name="type_name" tal:content="view/type_name" />.\n-        </div>\n-        <div class="documentDescription"\n-           i18n:translate="description_contentrules_assigned_norules" tal:condition="not:view/has_rules">\n-            There are currently no active content rules in this\n-            <span i18n:name="type_name" tal:content="view/type_name" />.\n-        </div>\n+        <header>\n+            <h1 class="documentFirstHeading"\n+                i18n:translate="title_contentrules_assigned">\n+                Content rules for <q i18n:name="context" tal:content="context/Title">title</q>\n+            </h1>\n+\n+            <div class="lead">\n+\n+                <span i18n:translate="description_contentrules_assigned" tal:condition="view/has_rules">\n+                    The following content rules are active in this\n+                    <span i18n:name="type_name" tal:content="view/type_name" />.\n+                </span>\n+                <span i18n:translate="description_contentrules_assigned_norules" tal:condition="not:view/has_rules">\n+                    There are currently no active content rules in this\n+                    <span i18n:name="type_name" tal:content="view/type_name" />.\n+                </span>\n+\n+                <span i18n:translate="contentrules_controlpanel_link">\n+                    Use the\n+                    <a i18n:name="controlpanel_link"\n+                       i18n:translate="contentrules_control_panel"\n+                       tal:attributes="href string:${portal_url}/@@rules-controlpanel">\n+                        content rules control panel\n+                    </a>\n+                    to create new rules or delete or modify existing ones.\n+                </span>\n+\n+\n+            </div>\n+\n+\n+        </header>\n \n         <div id="content-core">\n-            <p i18n:translate="contentrules_controlpanel_link">\n-                Use the\n-                <a i18n:name="controlpanel_link"\n-                   i18n:translate="contentrules_control_panel"\n-                   tal:attributes="href string:${portal_url}/@@rules-controlpanel">\n-                    content rules control panel\n-                </a>\n-                to create new rules or delete or modify existing ones.\n-            </p>\n             <div class="active">\n                 <div tal:define="acquired_rules view/acquired_rules"\n                      tal:condition="acquired_rules">\n-                    <table class="table table-striped">\n+                    <table class="table listing nosort">\n                         <thead>\n                             <tr>\n                                 <th i18n:translate="label_contentrules_from_parent">\n@@ -101,36 +109,40 @@\n                     </table>\n                 </div>\n \n-                <form class="formControls mb-3" tal:define="assignable_rules view/assignable_rules" tal:condition="assignable_rules"\n-                      tal:attributes="action string:${view/view_url}" method="post">\n-                    <div class="mb-3">\n-                        <label class="form-label" for="" i18n:translate="contentrules_add_assignment">\n-                            Assign rule here\n-                        </label>\n-                        <div>\n-                          <select class="form-select" name="rule_id" size="1" id="select-rules">\n-                              <tal:options repeat="rule assignable_rules">\n-                                  <option tal:attributes="value rule/id"\n-                                          tal:content="rule/title">Addable rule name</option>\n-                              </tal:options>\n-                          </select>\n-                          <button class="context btn btn-primary"\n-                                 type="submit"\n-                                 name="form.button.AddAssignment"\n-                                 value="Add"\n-                                 i18n:attributes="value label_add;"\n-                                 i18n:translate="label_add">Add</button>\n-                        </div>\n+                <div id="assignable-content-rules" class="mb-4"\n+                    tal:define="assignable_rules view/assignable_rules"\n+                    tal:condition="assignable_rules">\n+                    <div class="col-form-label" i18n:translate="contentrules_available_rules">\n+                        Available content rules:\n                     </div>\n-                </form>\n+                    <form class="row row-cols-auto g-3 align-items-center"\n+                        tal:attributes="action string:${view/view_url}" method="post">\n+                            <div class="col-auto">\n+                                <select class="form-select" name="rule_id" size="1" id="select-rules">\n+                                    <tal:options repeat="rule assignable_rules">\n+                                        <option tal:attributes="value rule/id"\n+                                                tal:content="rule/title">Addable rule name</option>\n+                                    </tal:options>\n+                                </select>\n+                            </div>\n+\n+                            <div class="col-auto">\n+                                <button class="context btn btn-primary"\n+                                    type="submit"\n+                                    name="form.button.AddAssignment"\n+                                    value="Add"\n+                                    i18n:attributes="value label_add;"\n+                                    i18n:translate="label_add">Add</button>\n+                            </div>\n+                    </form>\n+                </div>\n+\n \n                 <div class="clearfix"></div>\n \n                 <form class="mb-3" tal:attributes="action view/view_url" method="post"\n-                      tal:define="assigned_rules view/assigned_rules;\n-                                  auth_token context/@@authenticator/token"\n-                      tal:condition="assigned_rules">\n-                    <table class="table table-striped">\n+                      tal:define="assigned_rules view/assigned_rules" tal:condition="assigned_rules">\n+                    <table class="table listing nosort">\n                         <thead>\n                             <tr>\n                                 <th class="smallcolumn">&nbsp;</th>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:37:26+01:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/plone.app.contentrules/commit/0029f933ce810de521f23165324bc823b9cebb71

remove period from status messages

Files changed:
M plone/app/contentrules/browser/templates/controlpanel.pt

b'diff --git a/plone/app/contentrules/browser/templates/controlpanel.pt b/plone/app/contentrules/browser/templates/controlpanel.pt\nindex 0994897..3f5f9d4 100644\n--- a/plone/app/contentrules/browser/templates/controlpanel.pt\n+++ b/plone/app/contentrules/browser/templates/controlpanel.pt\n@@ -67,13 +67,13 @@\n         Content rule settings updated.\n       </span>\n       <span id="trns_form_success_enabled" i18n:translate="">\n-        Content rule enabled.\n+        Content rule enabled\n       </span>\n       <span id="trns_form_success_disabled" i18n:translate="">\n-        Content rule disabled.\n+        Content rule disabled\n       </span>\n       <span id="trns_form_success_deleted" i18n:translate="">\n-        Content rule deleted.\n+        Content rule deleted\n       </span>\n     </div>\n \n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:38:26+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/08d7d2b8b9011569eb5ea5d45eb08763be9b1512

use svg icons

Files changed:
M plone/app/contentrules/browser/templates/manage-assignments.pt

b'diff --git a/plone/app/contentrules/browser/templates/manage-assignments.pt b/plone/app/contentrules/browser/templates/manage-assignments.pt\nindex e1310c9..a7672b7 100644\n--- a/plone/app/contentrules/browser/templates/manage-assignments.pt\n+++ b/plone/app/contentrules/browser/templates/manage-assignments.pt\n@@ -99,9 +99,9 @@\n                                         </dl>\n                                     </td>\n                                     <td class="checker">\n-                                        <tal:icon\n-                                            condition="rule/enabled"\n-                                            replace="structure python:icons.tag(\'check-circle\')" />\n+                                        <tal:icon tal:condition="rule/enabled"\n+                                            i18n:attributes="alt label_contentrules_active;"\n+                                            tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n                                     </td>\n                                 </tr>\n                             </tal:rules>\n@@ -190,30 +190,30 @@\n                                     <a tal:condition="not:repeat/rule/start"\n                                        title="Move up"\n                                        i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id}&amp;_authenticator=${auth_token}">\n-                                       <tal:icon replace="structure python:icons.tag(\'arrow-up\')" />\n+                                       tal:attributes="href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id}">\n+                                        <tal:icon tal:replace="structure python:icons.tag(\'caret-up-fill\', tag_class=\'\', tag_alt=\'\')" />\n                                     </a>\n                                     <a tal:condition="not:repeat/rule/end"\n                                        title="Move down"\n                                        i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id}&amp;_authenticator=${auth_token}">\n-                                       <tal:icon replace="structure python:icons.tag(\'arrow-down\')" />\n+                                       tal:attributes="href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id}">\n+                                        <tal:icon tal:replace="structure python:icons.tag(\'caret-down-fill\', tag_class=\'\', tag_alt=\'\')" />\n                                     </a>\n                                 </td>\n-                                <td class="text-center">\n-                                    <tal:icon\n-                                            condition="rule/bubbles"\n-                                            replace="structure python:icons.tag(\'check-circle\')" />\n+                                <td class="checker listingCheckbox">\n+                                    <tal:icon tal:condition="rule/bubbles"\n+                                        i18n:attributes="alt label_contentrules_active;"\n+                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n                                 </td>\n-                                <td class="text-center">\n-                                    <tal:icon\n-                                            condition="rule/enabled"\n-                                            replace="structure python:icons.tag(\'check-circle\')" />\n+                                <td class="checker listingCheckbox">\n+                                    <tal:icon tal:condition="rule/enabled"\n+                                        i18n:attributes="alt label_contentrules_active;"\n+                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n                                 </td>\n-                                <td class="text-center">\n-                                    <tal:icon\n-                                            condition="rule/global_enabled"\n-                                            replace="structure python:icons.tag(\'check-circle\')" />\n+                                <td class="checker listingCheckbox">\n+                                    <tal:icon tal:condition="rule/global_enabled"\n+                                        i18n:attributes="alt label_contentrules_active;"\n+                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n                                 </td>\n                             </tr>\n                             </tal:rules>\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:50:05+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/eda608f1f2b3851058ca9780fc9ae98c5d30dfc2

remove unused css file

Files changed:
D plone/app/contentrules/browser/contentrules.css

b'diff --git a/plone/app/contentrules/browser/contentrules.css b/plone/app/contentrules/browser/contentrules.css\ndeleted file mode 100644\nindex f523aa0..0000000\n--- a/plone/app/contentrules/browser/contentrules.css\n+++ /dev/null\n@@ -1,44 +0,0 @@\n-#rules_table_form .state-disabled .icon-contentrule-enabled-assigned,\n-#rules_table_form .state-disabled .icon-contentrule-enabled-unassigned{\n-    display: none;\n-}\n-\n-#rules_table_form .assignment-unassigned .icon-contentrule-enabled-assigned{\n-    display: none;\n-}\n-\n-#rules_table_form .assignment-assigned .icon-contentrule-enabled-unassigned{\n-    display: none;\n-}\n-\n-#rules_table_form .state-disabled .btn-rule-disable {\n-    display: none;\n-}\n-#rules_table_form .state-enabled .btn-rule-enable {\n-    display: none;\n-}\n-.filter-option{\n-  white-space: nowrap;\n-}\n-\n-#configure-conditions,\n-#configure-actions{\n-  width: 50%;\n-  padding: 5px;\n-  float: left;\n-}\n-\n-#manage-assignments{\n-  clear: both;\n-}\n-\n-.chooser-right label{\n-  width: 100%;\n-}\n-.chooser-right select{\n-  display: inline-block;\n-  width: 70%;\n-}\n-.chooser-right input{\n-  display: inline-block;\n-}\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-12T18:52:22+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/879f99564c7f60225864667b3aa128eb2a640e5b

add news

Files changed:
A news/70.breaking

b'diff --git a/news/70.breaking b/news/70.breaking\nnew file mode 100644\nindex 0000000..c121139\n--- /dev/null\n+++ b/news/70.breaking\n@@ -0,0 +1,2 @@\n+Improve management UI and move JS to mockup es6.\n+[agitator, MrTango]\n\\ No newline at end of file\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-01-19T10:29:03+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contentrules/commit/b83f56d445897df1f2bef98e9007569859b9fa97

fix doctests

Files changed:
M plone/app/contentrules/tests/assignment.txt
M plone/app/contentrules/tests/multipublish.txt
M plone/app/contentrules/tests/simplepublish.txt

b'diff --git a/plone/app/contentrules/tests/assignment.txt b/plone/app/contentrules/tests/assignment.txt\nindex 62e266b..06bf575 100644\n--- a/plone/app/contentrules/tests/assignment.txt\n+++ b/plone/app/contentrules/tests/assignment.txt\n@@ -4,7 +4,7 @@ Setup\n   >>> from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n   >>> from plone.app.testing import setRoles\n   >>> from plone.app.testing import TEST_USER_ID\n-  >>> from plone.testing.z2 import Browser\n+  >>> from plone.testing.zope import Browser\n \n   >>> portal = layer[\'portal\']\n   >>> setRoles(portal, TEST_USER_ID, [\'Manager\'])\n@@ -38,13 +38,13 @@ condition for *published*:\n \n   >>> browser.url\n   \'http://nohost/plone/++rule++rule-1/@@manage-elements\'\n-  >>> browser.getControl(\'Add condition\').value = [\n+  >>> browser.getControl(name=":action", index=0).value = [\n   ...     \'plone.conditions.PortalType\']\n   >>> browser.getControl(name=\'form.button.AddCondition\').click()\n   >>> browser.getControl(\'Content type\').value = [\'News Item\']\n   >>> browser.getControl(\'Save\').click()\n \n-  >>> browser.getControl(\'Add condition\').value = [\n+  >>> browser.getControl(name=":action", index=0).value = [\n   ...     \'plone.conditions.WorkflowState\']\n   >>> browser.getControl(name=\'form.button.AddCondition\').click()\n   >>> browser.getControl(\'Workflow state\').value = [\'published\']\n@@ -53,7 +53,7 @@ condition for *published*:\n Now comes the action, we want all news items to be copied into the\n `/news` folder:\n \n-  >>> browser.getControl(\'Add action\').value = [\'plone.actions.Copy\']\n+  >>> browser.getControl(name=":action", index=1).value = [\'plone.actions.Copy\']\n   >>> browser.getControl(name=\'form.button.AddAction\').click()\n   >>> ctrl = browser.getControl(name=\'form.widgets.target_folder\')\n   >>> from plone.uuid.interfaces import IUUID\n@@ -71,7 +71,7 @@ A second rule will be added to notify users when a content is added.\n   >>> ctrl.value = [\'Object added to this container\']\n   >>> browser.getControl(\'Save\').click()\n   >>> browser.open(\'http://nohost/plone/++rule++rule-2/@@manage-elements\')\n-  >>> browser.getControl(\'Add action\').value = [\'plone.actions.Notify\']\n+  >>> browser.getControl(name=":action", index=1).value = [\'plone.actions.Notify\']\n   >>> browser.getControl(name=\'form.button.AddAction\').click()\n   >>> ctrl = browser.getControl(name=\'form.widgets.message\')\n   >>> ctrl.value = \'Content added\'\ndiff --git a/plone/app/contentrules/tests/multipublish.txt b/plone/app/contentrules/tests/multipublish.txt\nindex d022797..90608e4 100644\n--- a/plone/app/contentrules/tests/multipublish.txt\n+++ b/plone/app/contentrules/tests/multipublish.txt\n@@ -5,7 +5,7 @@ Setup\n -----\n \n   >>> from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n-  >>> from plone.testing.z2 import Browser\n+  >>> from plone.testing.zope import Browser\n   >>> from plone.app.testing import setRoles\n   >>> from plone.app.testing import TEST_USER_ID\n \n@@ -37,13 +37,13 @@ condition for *published*:\n \n   >>> browser.url\n   \'http://nohost/plone/++rule++rule-1/@@manage-elements\'\n-  >>> browser.getControl(\'Add condition\').value = [\n+  >>> browser.getControl(name=":action", index=0).value = [\n   ...     \'plone.conditions.PortalType\']\n   >>> browser.getControl(name=\'form.button.AddCondition\').click()\n   >>> browser.getControl(\'Content type\').value = [\'News Item\']\n   >>> browser.getControl(\'Save\').click()\n \n-  >>> browser.getControl(\'Add condition\').value = [\n+  >>> browser.getControl(name=":action", index=0).value = [\n   ...     \'plone.conditions.WorkflowState\']\n   >>> browser.getControl(name=\'form.button.AddCondition\').click()\n   >>> browser.getControl(\'Workflow state\').value = [\'published\']\n@@ -52,7 +52,7 @@ condition for *published*:\n Now comes the action, we want all news items to be moved into the\n `/news` folder:\n \n-  >>> browser.getControl(\'Add action\').value = [\'plone.actions.Move\']\n+  >>> browser.getControl(name=":action", index=1).value = [\'plone.actions.Move\']\n   >>> browser.getControl(name=\'form.button.AddAction\').click()\n   >>> ctrl = browser.getControl(name=\'form.widgets.target_folder\')\n   >>> from plone.uuid.interfaces import IUUID\ndiff --git a/plone/app/contentrules/tests/simplepublish.txt b/plone/app/contentrules/tests/simplepublish.txt\nindex 9c74964..fca7c27 100644\n--- a/plone/app/contentrules/tests/simplepublish.txt\n+++ b/plone/app/contentrules/tests/simplepublish.txt\n@@ -2,7 +2,7 @@ Setup\n -----\n \n   >>> from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n-  >>> from plone.testing.z2 import Browser\n+  >>> from plone.testing.zope import Browser\n   >>> from plone.app.testing import setRoles\n   >>> from plone.app.testing import TEST_USER_ID\n \n@@ -38,20 +38,20 @@ condition for *published*:\n \n   >>> browser.url\n   \'http://nohost/plone/++rule++rule-1/@@manage-elements\'\n-  >>> browser.getControl(\'Add condition\').value = [\'plone.conditions.PortalType\']\n-  >>> browser.getControl(\'Add\', index=1).click()\n+  >>> browser.getControl(name=":action", index=0).value = [\'plone.conditions.PortalType\']\n+  >>> browser.getControl(\'Add\', index=0).click()\n   >>> browser.getControl(\'Content type\').value = [\'News Item\']\n   >>> browser.getControl(\'Save\').click()\n \n-  >>> browser.getControl(\'Add condition\').value = [\'plone.conditions.WorkflowState\']\n-  >>> browser.getControl(\'Add\', index=1).click()\n+  >>> browser.getControl(name=":action", index=0).value = [\'plone.conditions.WorkflowState\']\n+  >>> browser.getControl(\'Add\', index=0).click()\n   >>> browser.getControl(\'Workflow state\').value = [\'published\']\n   >>> browser.getControl(\'Save\').click()\n \n Now comes the action, we want all news items to be copied into the\n `/news` folder:\n \n-  >>> browser.getControl(\'Add action\').value = [\'plone.actions.Copy\']\n+  >>> browser.getControl(name=":action", index=1).value = [\'plone.actions.Copy\']\n   >>> browser.getControl(name=\'form.button.AddAction\').click()\n   >>> ctrl = browser.getControl(name=\'form.widgets.target_folder\')\n   >>> from plone.uuid.interfaces import IUUID\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-03-24T12:29:00+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contentrules/commit/86b8420683911e6d43c1d35264dcbb0793ce031a

Remove handling of Archetypes and portal_factory

Files changed:
A news/70-2.breaking
M plone/app/contentrules/handlers.py

b'diff --git a/news/70-2.breaking b/news/70-2.breaking\nnew file mode 100644\nindex 0000000..2020436\n--- /dev/null\n+++ b/news/70-2.breaking\n@@ -0,0 +1,2 @@\n+Remove handling of Archetypes and portal_factory.\n+[pbauer]\ndiff --git a/plone/app/contentrules/handlers.py b/plone/app/contentrules/handlers.py\nindex 9722e20..b105cb0 100644\n--- a/plone/app/contentrules/handlers.py\n+++ b/plone/app/contentrules/handlers.py\n@@ -8,31 +8,16 @@\n from plone.uuid.interfaces import IUUID\n from Products.CMFCore.interfaces import IContentish\n from Products.CMFCore.interfaces import ISiteRoot\n-from Products.CMFCore.utils import getToolByName\n from zope.component import queryUtility\n from zope.component.hooks import getSite\n from zope.container.interfaces import IContainerModifiedEvent\n from zope.container.interfaces import IObjectAddedEvent\n from zope.container.interfaces import IObjectRemovedEvent\n-from zope.interface import Interface\n from zope.lifecycleevent.interfaces import IObjectCopiedEvent\n \n import threading\n \n \n-try:\n-    from Products.Archetypes.interfaces import IBaseObject\n-    from Products.Archetypes.interfaces import IObjectInitializedEvent\n-    HAS_ARCHETYPES = True\n-except ImportError:\n-    class IBaseObject(Interface):\n-        pass\n-\n-    class IObjectInitializedEvent(Interface):\n-        pass\n-    HAS_ARCHETYPES = False\n-\n-\n def _get_uid(context):\n     uid = IUUID(context, None)\n     if uid is not None:\n@@ -79,8 +64,6 @@ def __call__(self, context, rule, event):\n def init():\n     if not hasattr(_status, \'rule_filter\'):\n         _status.rule_filter = DuplicateRuleFilter()\n-    if not hasattr(_status, \'delayed_events\'):\n-        _status.delayed_events = {}\n \n \n def close(event):\n@@ -89,9 +72,6 @@ def close(event):\n     if hasattr(_status, \'rule_filter\'):\n         _status.rule_filter.reset()\n \n-    if hasattr(_status, \'delayed_events\'):\n-        _status.delayed_events = {}\n-\n \n def execute(context, event):\n     """Execute all rules relative to the context, and bubble as appropriate.\n@@ -144,72 +124,24 @@ def execute(context, event):\n     rule_filter.in_progress = False\n \n # Event handlers\n-\n-\n-def is_portal_factory(context):\n-    """Find out if the given object is in portal_factory\n-    """\n-    portal_factory = getToolByName(context, \'portal_factory\', None)\n-    if portal_factory is not None:\n-        return portal_factory.isTemporary(context)\n-    else:\n-        return False\n-\n-\n def execute_rules(event):\n     """ When an action is invoked on an object,\n         execute rules assigned to its parent.\n         Base action executor handler """\n-    if is_portal_factory(event.object):\n-        return\n-\n     execute(aq_parent(aq_inner(event.object)), event)\n \n \n def added(event):\n     """When an object is added, execute rules assigned to its new parent.\n-\n-    There is special handling for Archetypes objects.\n     """\n     obj = event.object\n-    if is_portal_factory(obj):\n-        return\n \n-    # The object added event executes too early for Archetypes objects.\n-    # We need to delay execution until we receive a subsequent\n-    # IObjectInitializedEvent\n-    if HAS_ARCHETYPES and IBaseObject.providedBy(obj):\n-        init()\n-        uid = _get_uid(obj)\n-        new_key = \'IObjectInitializedEvent-{0}\'.format(uid)\n-        _status.delayed_events[new_key] = event\n-    elif IContentish.providedBy(obj) or IComment.providedBy(obj):\n+    if IContentish.providedBy(obj) or IComment.providedBy(obj):\n         execute(event.newParent, event)\n     else:\n         return\n \n \n-if HAS_ARCHETYPES:\n-    def archetypes_initialized(event):\n-        """Pick up the delayed IObjectAddedEvent when an Archetypes object is\n-        initialised.\n-        """\n-        obj = event.object\n-        if is_portal_factory(obj):\n-            return\n-\n-        if not IBaseObject.providedBy(obj):\n-            return\n-\n-        init()\n-        uid = _get_uid(obj)\n-        key = \'IObjectInitializedEvent-{0}\'.format(uid)\n-        delayed_event = _status.delayed_events.get(key, None)\n-        if delayed_event is not None:\n-            _status.delayed_events[key] = None\n-            execute(delayed_event.newParent, delayed_event)\n-\n-\n def removed(event):\n     """When an IObjectRemovedEvent was received, execute rules assigned to its\n      previous parent.\n@@ -218,9 +150,6 @@ def removed(event):\n     if not (IContentish.providedBy(obj) or IComment.providedBy(obj)):\n         return\n \n-    if is_portal_factory(obj):\n-        return\n-\n     execute(event.oldParent, event)\n \n \n@@ -232,9 +161,7 @@ def modified(event):\n     if not (IContentish.providedBy(obj) or IComment.providedBy(obj)):\n         return\n \n-    # Let the special handler take care of IObjectInitializedEvent\n     object_events = (\n-        IObjectInitializedEvent,\n         IObjectAddedEvent,\n         IObjectRemovedEvent,\n         IContainerModifiedEvent,\n@@ -254,9 +181,6 @@ def copied(event):\n     if not (IContentish.providedBy(obj) or IComment.providedBy(obj)):\n         return\n \n-    if is_portal_factory(obj):\n-        return\n-\n     execute(aq_parent(aq_inner(event.original)), event)\n \n \n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2022-03-24T15:29:11+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.contentrules/commit/f1f8352c6d80594dba3cd904171b8509d5901ea9

Merge pull request #70 from plone/es6-pat-contentrules

move contentrules js into mockup/pat/controlpanels

Files changed:
A news/70-2.breaking
A news/70.breaking
M plone/app/contentrules/browser/configure.zcml
M plone/app/contentrules/browser/elements.py
M plone/app/contentrules/browser/templates/controlpanel.pt
M plone/app/contentrules/browser/templates/manage-assignments.pt
M plone/app/contentrules/browser/templates/manage-elements.pt
M plone/app/contentrules/handlers.py
M plone/app/contentrules/tests/assignment.txt
M plone/app/contentrules/tests/multipublish.txt
M plone/app/contentrules/tests/simplepublish.txt
D plone/app/contentrules/browser/contentrule-elements.js
D plone/app/contentrules/browser/contentrules.css
D plone/app/contentrules/browser/contentrules.js

b'diff --git a/news/70-2.breaking b/news/70-2.breaking\nnew file mode 100644\nindex 0000000..2020436\n--- /dev/null\n+++ b/news/70-2.breaking\n@@ -0,0 +1,2 @@\n+Remove handling of Archetypes and portal_factory.\n+[pbauer]\ndiff --git a/news/70.breaking b/news/70.breaking\nnew file mode 100644\nindex 0000000..c121139\n--- /dev/null\n+++ b/news/70.breaking\n@@ -0,0 +1,2 @@\n+Improve management UI and move JS to mockup es6.\n+[agitator, MrTango]\n\\ No newline at end of file\ndiff --git a/plone/app/contentrules/browser/configure.zcml b/plone/app/contentrules/browser/configure.zcml\nindex 4418515..a97da0b 100644\n--- a/plone/app/contentrules/browser/configure.zcml\n+++ b/plone/app/contentrules/browser/configure.zcml\n@@ -183,21 +183,6 @@\n \n     </configure>\n \n-    <!-- Resources -->\n-    <browser:resource\n-        name="manage-contentrules.js"\n-        file="contentrules.js"\n-        />\n-    <!-- Resources -->\n-    <browser:resource\n-        name="manage-contentrule-elements.js"\n-        file="contentrule-elements.js"\n-        />\n-    <browser:resource\n-        name="manage-contentrules.css"\n-        file="contentrules.css"\n-        />\n-\n     <!-- Rule breadcrumb -->\n \n   <browser:page\ndiff --git a/plone/app/contentrules/browser/contentrule-elements.js b/plone/app/contentrules/browser/contentrule-elements.js\ndeleted file mode 100644\nindex 86f1101..0000000\n--- a/plone/app/contentrules/browser/contentrule-elements.js\n+++ /dev/null\n@@ -1,69 +0,0 @@\n-/* global require */\n-\n-var SKIP_OVERLAY_ACTIONS = [\n-  \'plone.actions.Delete\'\n-];\n-\n-require([\n-  \'jquery\',\n-  \'mockup-patterns-modal\'\n-], function($, Modal) {\n-  \'use strict\';\n-  function initforms(){\n-    $(\'#configure-conditions .rule-element input, #configure-actions .rule-element input\').unbind(\'click\').click(function(){\n-      var name = $(this).attr(\'name\');\n-      if(name==\'form.button.EditCondition\' || name==\'form.button.EditAction\'){\n-        return true;\n-      }\n-      $(\'#spinner\').show();\n-      var form = $(this).parents(\'form\').first();\n-      var fieldset = form.parents(\'fieldset\').first();\n-      var data = form.serialize() + \'&\' + name + \'=1\';\n-      var url = form.attr(\'action\');\n-      $.post(url, data, function(html){\n-        var newfieldset = $(html).find(\'#\' + fieldset.attr(\'id\'));\n-        fieldset.replaceWith(newfieldset);\n-        initforms();\n-        $(\'#spinner\').hide();\n-      });\n-      return false;\n-    });\n-\n-    $(\'input[name="form.button.AddCondition"],input[name="form.button.AddAction"]\').unbind(\'click\').click(function(e){\n-      var form = $(this).parent().parent();\n-      var data = form.serialize();\n-      for(var i=0; i<SKIP_OVERLAY_ACTIONS.length; i++){\n-        if(data.indexOf(SKIP_OVERLAY_ACTIONS[i]) !== -1){\n-          return;\n-        }\n-      }\n-      e.preventDefault();\n-      var url = form.attr(\'action\') + \'?\' + data;\n-      var conditionAnchor = $(\'<a href="\' + url + \'" />\').css(\'display\', \'none\');\n-      conditionAnchor.insertAfter(this);\n-      new Modal(conditionAnchor, {\n-        actionOptions: {\n-          isForm: true,\n-          redirectOnResponse: true,\n-          redirectToUrl: function(){\n-            /* reload on submit */\n-            return window.location.href;\n-          }\n-        }\n-      });\n-      conditionAnchor.trigger(\'click\');\n-    });\n-  }\n-  $(document).ready(function(){\n-    initforms();\n-\n-    /*\n-    var $config = $(\'#configure-rule\');\n-    $(\'form\', $config).hide();\n-    $(\'legend\', $config).replaceWith(\'<legend><a href="#">\' + $(\'legend\', $config).text() + \'</a></legend>\');\n-    $(\'legend a\', $config).click(function(e){\n-      e.preventDefault();\n-      $(\'form\', $config).slideToggle();\n-    });*/\n-  });\n-});\ndiff --git a/plone/app/contentrules/browser/contentrules.css b/plone/app/contentrules/browser/contentrules.css\ndeleted file mode 100644\nindex f523aa0..0000000\n--- a/plone/app/contentrules/browser/contentrules.css\n+++ /dev/null\n@@ -1,44 +0,0 @@\n-#rules_table_form .state-disabled .icon-contentrule-enabled-assigned,\n-#rules_table_form .state-disabled .icon-contentrule-enabled-unassigned{\n-    display: none;\n-}\n-\n-#rules_table_form .assignment-unassigned .icon-contentrule-enabled-assigned{\n-    display: none;\n-}\n-\n-#rules_table_form .assignment-assigned .icon-contentrule-enabled-unassigned{\n-    display: none;\n-}\n-\n-#rules_table_form .state-disabled .btn-rule-disable {\n-    display: none;\n-}\n-#rules_table_form .state-enabled .btn-rule-enable {\n-    display: none;\n-}\n-.filter-option{\n-  white-space: nowrap;\n-}\n-\n-#configure-conditions,\n-#configure-actions{\n-  width: 50%;\n-  padding: 5px;\n-  float: left;\n-}\n-\n-#manage-assignments{\n-  clear: both;\n-}\n-\n-.chooser-right label{\n-  width: 100%;\n-}\n-.chooser-right select{\n-  display: inline-block;\n-  width: 70%;\n-}\n-.chooser-right input{\n-  display: inline-block;\n-}\ndiff --git a/plone/app/contentrules/browser/contentrules.js b/plone/app/contentrules/browser/contentrules.js\ndeleted file mode 100644\nindex cdb9747..0000000\n--- a/plone/app/contentrules/browser/contentrules.js\n+++ /dev/null\n@@ -1,133 +0,0 @@\n-/* global require */\n-\n-require([\n-  \'jquery\',\n-], function($) {\n-  \'use strict\';\n-\n-  function updatezebra(table){\n-    table.find(\'tr:visible:odd\').removeClass(\'odd even\').addClass(\'odd\');\n-    table.find(\'tr:visible:even\').removeClass(\'odd even\').addClass(\'even\');\n-  }\n-\n-  function addStatusMessage(message, type){\n-    if(type === undefined){\n-      type = \'info\';\n-    }\n-    var _show = function(){\n-      var msg = $(\'<dl class="portalMessage \' + type + \'">\' +\n-                  \'<dt>\' + type + \'</dt>\' +\n-                  \'<dd>\' + message + \'</dd>\' +\n-                \'</dl>\');\n-      $(\'#content\').before(msg);\n-      msg.fadeIn();\n-    };\n-    var vis = $(\'dl.portalMessage:visible\');\n-    if(vis.length === 0){\n-      _show();\n-    }else{\n-      vis.fadeOut(_show);\n-    }\n-  }\n-\n-  // TODO find out why is it binding multiple times\n-  $(\'.btn-rule-action\').unbind(\'click\').bind(\'click\', function(e) {\n-    e.preventDefault();\n-\n-    var $this = $(this),\n-        $row = $this.parents(\'tr\').first(),\n-        $table = $row.parent(),\n-        id = $this.data(\'value\'),\n-        url = $this.data(\'url\');\n-\n-    $.ajax({\n-      type: \'POST\',\n-      url: url,\n-      data: {\n-        \'rule-id\': id,\n-        \'_authenticator\': $(\'input[name="_authenticator"]\').val()\n-      },\n-      beforeSend: function() {\n-        $(\'#spinner\').show();\n-      },\n-      error: function() {\n-        addStatusMessage($(\'#trns_form_error\').html(), \'warn\');\n-      },\n-      success: function() {\n-        // Enable\n-\n-        if($this.hasClass(\'btn-rule-enable\')) {\n-            $row.removeClass(\'state-disabled\').addClass(\'state-enabled\');\n-        }\n-\n-        // Disable\n-\n-        if($this.hasClass(\'btn-rule-disable\')) {\n-            $row.removeClass(\'state-enabled\').addClass(\'state-disabled\');\n-        }\n-\n-        // DELETE\n-\n-        if($this.hasClass(\'btn-rule-delete\')) {\n-            $row.remove();\n-            updatezebra($table);\n-        }\n-        addStatusMessage($(\'#trns_form_success\').html(), \'info\');\n-      },\n-      complete: function() {\n-        $(\'#spinner\').hide();\n-      }\n-    });\n-  });\n-\n-\n-  $(\'.filter-option input\').unbind(\'change\').bind(\'change\', function() {\n-    // Go through the checkboxes and map up what is the filtering criterea\n-    var $table = $(\'#rules_table_form table\');\n-    var state_filters = $(\'.state-filters input:checked\');\n-    var type_filters = $(\'.type-filters input:checked\');\n-\n-    $table.find(\'tr\').show();\n-    if(state_filters.length > 0){\n-      $(\'.state-filters input:not(:checked)\').each(function(){\n-        $table.find(\'.\' + this.id).hide();\n-      });\n-    }\n-    if(type_filters.length > 0){\n-      $(\'.type-filters input:not(:checked)\').each(function(){\n-        $table.find(\'.\' + this.id).hide();\n-      });\n-    }\n-      updatezebra($table);\n-  });\n-\n-  $(\'#rules_disable_globally\').change(function(){\n-    var form = $(\'#fieldset-global form\');\n-    var disabled = \'\';\n-    if($(\'#rules_disable_globally\')[0].checked){\n-      disabled = \'True\';\n-    }\n-\n-    $.ajax({\n-      type: \'POST\',\n-      url: form.attr(\'action\'),\n-      data: {\n-        \'global_disable:boolean\': disabled,\n-        \'_authenticator\': $(\'input[name="_authenticator"]\').val()\n-      },\n-      beforeSend: function() {\n-        $(\'#spinner\').show();\n-      },\n-      error: function() {\n-        addStatusMessage($(\'#trns_form_error\').html(), \'warn\');\n-      },\n-      success: function() {\n-        addStatusMessage($(\'#trns_form_success\').html(), \'info\');\n-      },\n-      complete: function() {\n-        $(\'#spinner\').hide();\n-      }\n-    });\n-  });\n-\n-});\ndiff --git a/plone/app/contentrules/browser/elements.py b/plone/app/contentrules/browser/elements.py\nindex b017bf8..97879c6 100644\n--- a/plone/app/contentrules/browser/elements.py\n+++ b/plone/app/contentrules/browser/elements.py\n@@ -161,7 +161,8 @@ def assignments(self):\n                 \'url\': site.absolute_url(),\n                 \'title\': site.title_or_id(),\n                 \'description\': site.Description(),\n-            })\n+                \'icon\': \'plone-home\'\n+                })\n \n         catalog = getToolByName(rule, \'portal_catalog\')\n         for a in catalog(path=dict(query=list(paths), depth=0),\n@@ -170,7 +171,8 @@ def assignments(self):\n                 \'url\': a.getURL(),\n                 \'title\': a.Title or a.getId,\n                 \'description\': a.Description,\n-            })\n+                \'icon\': f\'contenttype/{a.portal_type.lower()}\'\n+                })\n \n         return info\n \ndiff --git a/plone/app/contentrules/browser/templates/controlpanel.pt b/plone/app/contentrules/browser/templates/controlpanel.pt\nindex b4035cc..3f5f9d4 100644\n--- a/plone/app/contentrules/browser/templates/controlpanel.pt\n+++ b/plone/app/contentrules/browser/templates/controlpanel.pt\n@@ -11,23 +11,51 @@\n <metal:main metal:fill-slot="prefs_configlet_main"\n      tal:define="rules view/registeredRules">\n \n-  <script type="text/javascript" src="++resource++manage-contentrules.js"\n-      tal:attributes="src string:${context/portal_url}/++resource++manage-contentrules.js">\n-  </script>\n-  <link rel="stylesheet" type="text/css" media="all"\n-        href="++resource++manage-contentrules.css"\n-        tal:attributes="href string:${context/portal_url}/++resource++manage-contentrules.css" />\n-\n   <header>\n     <h1 class="documentFirstHeading"\n         i18n:translate="title_manage_contentrules">Content Rules</h1>\n \n-    <p i18n:translate="description-contentrules-controlpanel" class="documentDescription">\n+    <p i18n:translate="description-contentrules-controlpanel" class="lead">\n         Use the form below to define, change or remove content rules. Rules\n         will automatically perform actions on content when certain triggers\n         take place. After defining rules, you may want to go to a folder\n         to assign them, using the "rules" item in the actions menu.\n     </p>\n+\n+    <div id="fieldset-global">\n+      <form name="ruleSettings" method="POST"\n+           tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n+          <span tal:replace="structure context/@@authenticator/authenticator"/>\n+          <div class="form-check">\n+              <input type="hidden" name="global_disable:boolean:default" value="" />\n+              <input type="checkbox"\n+                     class="form-check-input"\n+                     id="rules_disable_globally"\n+                     name="global_disable:boolean"\n+                     value="True"\n+                     tal:attributes="checked python:view.globally_disabled() and \'checked\' or None" />\n+              <label class="form-check-label" for="rules_disable_globally" i18n:translate="">Disable globally</label>\n+              <div class="form-text" i18n:translate="">\n+                  Whether or not content rules should be disabled globally. If this is selected,\n+                  no rules will be executed anywhere in the portal.\n+              </div>\n+          </div>\n+\n+          <noscript>\n+          <!-- we\'ll use js to submit this normally -->\n+            <div class="formControls">\n+                <input type="submit"\n+                       name="form.button.SaveSettings"\n+                       class="btn btn-primary"\n+                       value="Save"\n+                       i18n:attributes="value label_save;" />\n+            </div>\n+          </noscript>\n+      </form>\n+\n+    </div>\n+\n+\n   </header>\n \n   <div id="content-core">\n@@ -38,166 +66,159 @@\n       <span id="trns_form_success" i18n:translate="">\n         Content rule settings updated.\n       </span>\n+      <span id="trns_form_success_enabled" i18n:translate="">\n+        Content rule enabled\n+      </span>\n+      <span id="trns_form_success_disabled" i18n:translate="">\n+        Content rule disabled\n+      </span>\n+      <span id="trns_form_success_deleted" i18n:translate="">\n+        Content rule deleted\n+      </span>\n     </div>\n \n-      <div id="fieldset-global">\n-        <form name="ruleSettings" method="POST"\n-             tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n-            <span tal:replace="structure context/@@authenticator/authenticator"/>\n-            <div class="field">\n-                <input type="hidden" name="global_disable:boolean:default" value="" />\n-                <input type="checkbox"\n-                       id="rules_disable_globally"\n-                       name="global_disable:boolean"\n-                       value="True"\n-                       tal:attributes="checked python:view.globally_disabled() and \'checked\' or None" />\n-                <label for="rules_disable_globally" i18n:translate="">Disable globally</label>\n-                <div class="formHelp" i18n:translate="">\n-                    Whether or not content rules should be disabled globally. If this is selected,\n-                    no rules will be executed anywhere in the portal.\n-                </div>\n-            </div>\n-\n-            <noscript>\n-            <!-- we\'ll use js to submit this normally -->\n-              <div class="formControls">\n-                  <input type="submit"\n-                         name="form.button.SaveSettings"\n-                         class="btn btn-primary"\n-                         value="Save"\n-                         i18n:attributes="value label_save;" />\n-              </div>\n-            </noscript>\n-        </form>\n \n-        <hr class="my-4">\n-      </div>\n+    <div class="card">\n+      <fieldset id="fieldset-rules" class="card-body"\n+                tal:define="rules rules|view/registeredRules;">\n \n-       <fieldset id="fieldset-rules"\n-                 tal:define="rules rules|view/registeredRules;\n-                             add_url string:${context/absolute_url}/+rule/plone.ContentRule;">\n-            <legend id="fieldsetlegend-rules" i18n:translate="legend-contentrules">Content rules</legend>\n-\n-            <div class="filters mt-2 mb-3" tal:condition="rules">\n-              <span class="type-filters">\n-                <span i18n:translate="">Filter:</span>\n-                <span class="filter-option"\n-                      tal:repeat="rule view/ruleTypesToShow">\n-                    <div class="form-check form-check-inline">\n-                      <input id="all" class="form-check-input" type="checkbox"\n-                             tal:attributes="id rule/id"\n-                             />\n-                      <label class="form-check-label"\n-                             for="all"\n-                             tal:attributes="for rule/id"\n-                             tal:content="rule/title">\n-                             All</label>\n-                    </div>\n-                </span>\n+          <div class="filters row row-cols-lg-auto g-3 align-items-center" tal:condition="rules">\n+            <span class="type-filters">\n+              <label class="col-form-label pe-3" i18n:translate="">Filter rules:</label>\n+              <span class="filter-option"\n+                    tal:repeat="rule view/ruleTypesToShow">\n+                  <div class="form-check form-check-inline">\n+                    <input id="all" class="form-check-input" type="checkbox"\n+                            tal:attributes="id rule/id"\n+                            />\n+                    <label class="form-check-label"\n+                            for="all"\n+                            tal:attributes="for rule/id"\n+                            tal:content="rule/title">\n+                            All</label>\n+                  </div>\n               </span>\n-              <span class="state-filters" tal:condition="rules">\n-                <span class="filter-option"\n-                      tal:repeat="state view/statesToShow">\n-                    <div class="form-check form-check-inline">\n-                      <input id="all" class="form-check-input" type="checkbox"\n-                             tal:attributes="id state/id"\n-                             />\n-                      <label class="form-check-label"\n-                             for="all"\n-                             tal:attributes="for state/id"\n-                             tal:content="state/title">\n-                             All</label>\n-                    </div>\n-                </span>\n+            </span>\n+            <span class="state-filters">\n+              <span class="filter-option"\n+                    tal:repeat="state view/statesToShow">\n+                  <div class="form-check form-check-inline">\n+                    <input id="all" class="form-check-input" type="checkbox"\n+                            tal:attributes="id state/id"\n+                            />\n+                    <label class="form-check-label"\n+                            for="all"\n+                            tal:attributes="for state/id"\n+                            tal:content="state/title">\n+                            All</label>\n+                  </div>\n               </span>\n-            </div>\n-            <div class="visualClear"><!-- --></div>\n-            <div id="rules_table_form"\n-                 metal:define-macro="rules_table_form">\n-            <table  class="listing nosort controlpanel-listing table"\n-                    tal:condition="rules">\n-                <thead>\n-                    <tr>\n-                        <th scope="col" i18n:translate="label_contentrules_rule_listing">Content rule</th>\n-                        <th scope="col" i18n:translate="label_contentrules_rule_event">Event</th>\n-                        <th scope="col" i18n:translate="label_contentrules_rule_enabled">Enabled</th>\n-                        <th scope="col" i18n:translate="label_contentrules_rule_actions">Actions</th>\n-                    </tr>\n-                </thead>\n-                <tbody>\n-                    <tal:rules repeat="rule view/registeredRules">\n-                    <tr tal:define="oddrow repeat/rule/odd"\n-                        tal:attributes="class python:(oddrow and \'even \' or \'odd \') + rule[\'row_class\'];">\n-                        <td>\n-                            <dl>\n-                                <dt>\n-                                  <a tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements"><span\n-                                     tal:replace="rule/title">Rule Title</span></a>\n-                                </dt>\n-                                <dd tal:content="rule/description">\n-                                    Rule Description.\n-                                </dd>\n-                            </dl>\n-                        </td>\n-                        <td>\n-                            <span class="trigger"\n-                                  tal:content="rule/trigger"\n-                                  i18n:translate="">trigger</span>\n-                        </td>\n-                        <td class="checker">\n-                            <span \n-                                class="badge badge-primary icon-contentrule-enabled-assigned" \n-                                alt="enabled"\n-                                i18n:attributes="alt label_contentrules_rule_enabled;">\n-                                  <i class="glyphicon glyphicon-ok"></i>\n-                            </span>\n-\n-                            <span \n-                                class="badge badge-danger icon-contentrule-enabled-unassigned" \n-                                alt="unassigned"\n-                                title="this rule has not been assigned"\n-                                i18n:attributes="alt label_contentrules_rule_unassigned;\n-                                                 title title_contentrule_rule_unassigned;">\n-                                  <i class="glyphicon glyphicon-remove"></i>\n-                            </span>\n-                        </td>\n-                        <td>\n+            </span>\n+          </div>\n+\n+          <div class="visualClear"><!-- --></div>\n+          <div id="rules_table_form"\n+                metal:define-macro="rules_table_form">\n+          <table  class="listing nosort controlpanel-listing table mb-0"\n+                  tal:condition="rules">\n+              <thead class="">\n+                  <tr>\n+                      <th scope="col" i18n:translate="label_contentrules_rule_listing">Content rule</th>\n+                      <th scope="col" i18n:translate="label_contentrules_rule_event">Event</th>\n+                      <th scope="col" i18n:translate="label_contentrules_rule_status"><span class="ps-2">Status</span></th>\n+                      <th scope="col" i18n:translate="label_contentrules_rule_actions">Actions</th>\n+                  </tr>\n+              </thead>\n+              <tbody>\n+                  <tal:rules repeat="rule view/registeredRules">\n+                  <tr tal:define="oddrow repeat/rule/odd"\n+                      tal:attributes="class python:(oddrow and \'even \' or \'odd \') + rule[\'row_class\'];">\n+                      <td>\n+                        <h5 class="rule-title">\n+                          <span\n+                              tal:replace="rule/title">Rule Title</span>\n+                        </h5>\n+                          <div tal:content="rule/description">\n+                              Rule Description.\n+                          </div>\n+                      </td>\n+                      <td>\n+                          <span class="trigger"\n+                                tal:content="rule/trigger"\n+                                i18n:translate="">trigger</span>\n+                      </td>\n+                      <td class="status">\n+\n                         <form style="display: inline" method="POST"\n                               tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n                         <span tal:replace="structure context/@@authenticator/authenticator"/>\n                         <input type="hidden"\n-                               name="rule-id"\n-                               tal:attributes="value rule/id">\n-                        <button class="context btn-rule-action btn-rule-enable btn btn-primary" type="submit" value="Enable"\n-                               name="form.button.EnableRule"\n-                               tal:attributes="data-value rule/id;\n-                                               data-url string:$portal_url/@@contentrule-enable"\n-                               i18n:translate=""\n-                               i18n:attributes="value label_enable;">Enable</button>\n-                        <button class="standalone btn-rule-action btn-rule-disable btn btn-secondary" type="submit" value="Disable"\n-                               name="form.button.DisableRule"\n-                               tal:attributes="data-value rule/id;\n-                                               data-url string:$portal_url/@@contentrule-disable"\n-                               i18n:translate=""\n-                               i18n:attributes="value label_disable;">Disable</button>\n-                        <button class="destructive btn-rule-action btn-rule-delete btn btn-danger" type="submit" value="Delete"\n-                               tal:attributes="data-value rule/id;\n-                                               data-url string:$portal_url/@@contentrule-delete"\n-                               name="form.button.DeleteRule"\n-                               i18n:translate=""\n-                               i18n:attributes="value label_delete;">Delete</button>\n-                         </form>\n-                        </td>\n-                    </tr>\n-                    </tal:rules>\n-                </tbody>\n-            </table>\n-            </div>\n-            <a id="#addcontentrule" tal:attributes="href add_url"\n-               class="plone-btn plone-btn-primary btn btn-primary"\n-               i18n:translate="label_contentrule_add">Add content rule</a>\n-       </fieldset>\n-  </div>\n+                              name="rule-id"\n+                              tal:attributes="value rule/id">\n+                        <button class="context btn-rule-action btn-rule-enable btn btn-sm btn-link ${python: rule[\'enabled\'] and \'d-none\'}" type="submit" value="Enable"\n+                              name="form.button.EnableRule"\n+                              tal:attributes="data-value rule/id;\n+                                              data-url string:$portal_url/@@contentrule-enable"\n+                              i18n:translate=""\n+                              i18n:attributes="value label_enable;">\n+                              <tal:icon tal:replace="structure python:icons.tag(\'square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="">enabled</span>\n+                        </button>\n+                        <button class="standalone btn-rule-action btn-rule-disable btn btn-sm btn-link ${python: not rule[\'enabled\'] and \'d-none\'}" type="submit" value="Disable"\n+                              name="form.button.DisableRule"\n+                              tal:attributes="data-value rule/id;\n+                                              data-url string:$portal_url/@@contentrule-disable"\n+                              i18n:translate=""\n+                              i18n:attributes="value label_disable;">\n+                              <tal:icon tal:replace="structure python:icons.tag(\'check-square\', tag_alt=\'Toggle to show\')" /><span class="ms-2" i18n:translate="">enabled</span>\n+                            </button>\n+                        </form>\n+\n+                        <span\n+                          class="badge bg-warning text-dark icon-contentrule-enabled-unassigned"\n+                          alt="unassigned"\n+                          title="this rule has not been assigned"\n+                          tal:condition="python:not rule[\'assigned\']"\n+                          i18n:attributes="alt label_contentrules_rule_unassigned;\n+                                          title title_contentrule_rule_unassigned;">\n+                          <tal:icon tal:replace="structure python:icons.tag(\'exclamation-triangle-fill\', tag_alt=\'not assigned\')" /><span class="ms-2" i18n:translate="">not assigned</span>\n+                    </span>\n+\n+\n+\n+                      </td>\n+                      <td>\n+                        <form style="display: inline" method="POST"\n+                              tal:attributes="action string:${context/absolute_url}/@@rules-controlpanel">\n+                        <span tal:replace="structure context/@@authenticator/authenticator"/>\n+                        <input type="hidden"\n+                              name="rule-id"\n+                              tal:attributes="value rule/id">\n+                        <a href="" class="btn btn-sm btn-primary"\n+                        tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@manage-elements">Configure</a>\n+                        <a href="" class="btn btn-sm btn-secondary"\n+                              tal:attributes="href string:${context/absolute_url}/++rule++${rule/id}/@@edit">Edit</a>\n+\n+                        <button class="destructive btn-rule-action btn-rule-delete btn btn-sm btn-danger" type="submit" value="Delete"\n+                              tal:attributes="data-value rule/id;\n+                                              data-url string:$portal_url/@@contentrule-delete"\n+                              name="form.button.DeleteRule"\n+                              i18n:translate=""\n+                              i18n:attributes="value label_delete;">Delete</button>\n+                        </form>\n+                      </td>\n+                  </tr>\n+                  </tal:rules>\n+              </tbody>\n+          </table>\n+          </div>\n+        </fieldset>\n+      </div>\n+      <div class="mt-3">\n+        <a id="#addcontentrule" tal:attributes="href string:${context/absolute_url}/+rule/plone.ContentRule;"\n+            class="plone-btn plone-btn-primary btn btn-success"\n+            i18n:translate="label_contentrule_add">Add content rule</a>\n+      </div>\n+    </div>\n </metal:main>\n </body>\n </html>\ndiff --git a/plone/app/contentrules/browser/templates/manage-assignments.pt b/plone/app/contentrules/browser/templates/manage-assignments.pt\nindex 2c4b668..a7672b7 100644\n--- a/plone/app/contentrules/browser/templates/manage-assignments.pt\n+++ b/plone/app/contentrules/browser/templates/manage-assignments.pt\n@@ -19,7 +19,7 @@\n           tal:attributes="href string:${context/portal_url}/++resource++manage-contentrules.css" />\n \n     <div tal:condition="not:view/globally_enabled"\n-         class="portalMessage info">\n+         class="alert alert-info">\n         <strong i18n:translate="">\n             Info\n         </strong>\n@@ -36,36 +36,44 @@\n     </div>\n \n     <article id="content">\n-        <h1 class="documentFirstHeading"\n-            i18n:translate="title_contentrules_assigned">\n-            Content rules for <q i18n:name="context" tal:content="context/Title">title</q>\n-        </h1>\n-\n-        <div class="documentDescription"\n-           i18n:translate="description_contentrules_assigned" tal:condition="view/has_rules">\n-            The following content rules are active in this\n-            <span i18n:name="type_name" tal:content="view/type_name" />.\n-        </div>\n-        <div class="documentDescription"\n-           i18n:translate="description_contentrules_assigned_norules" tal:condition="not:view/has_rules">\n-            There are currently no active content rules in this\n-            <span i18n:name="type_name" tal:content="view/type_name" />.\n-        </div>\n+        <header>\n+            <h1 class="documentFirstHeading"\n+                i18n:translate="title_contentrules_assigned">\n+                Content rules for <q i18n:name="context" tal:content="context/Title">title</q>\n+            </h1>\n+\n+            <div class="lead">\n+\n+                <span i18n:translate="description_contentrules_assigned" tal:condition="view/has_rules">\n+                    The following content rules are active in this\n+                    <span i18n:name="type_name" tal:content="view/type_name" />.\n+                </span>\n+                <span i18n:translate="description_contentrules_assigned_norules" tal:condition="not:view/has_rules">\n+                    There are currently no active content rules in this\n+                    <span i18n:name="type_name" tal:content="view/type_name" />.\n+                </span>\n+\n+                <span i18n:translate="contentrules_controlpanel_link">\n+                    Use the\n+                    <a i18n:name="controlpanel_link"\n+                       i18n:translate="contentrules_control_panel"\n+                       tal:attributes="href string:${portal_url}/@@rules-controlpanel">\n+                        content rules control panel\n+                    </a>\n+                    to create new rules or delete or modify existing ones.\n+                </span>\n+\n+\n+            </div>\n+\n+\n+        </header>\n \n         <div id="content-core">\n-            <p i18n:translate="contentrules_controlpanel_link">\n-                Use the\n-                <a i18n:name="controlpanel_link"\n-                   i18n:translate="contentrules_control_panel"\n-                   tal:attributes="href string:${portal_url}/@@rules-controlpanel">\n-                    content rules control panel\n-                </a>\n-                to create new rules or delete or modify existing ones.\n-            </p>\n             <div class="active">\n                 <div tal:define="acquired_rules view/acquired_rules"\n                      tal:condition="acquired_rules">\n-                    <table class="table table-striped">\n+                    <table class="table listing nosort">\n                         <thead>\n                             <tr>\n                                 <th i18n:translate="label_contentrules_from_parent">\n@@ -91,9 +99,9 @@\n                                         </dl>\n                                     </td>\n                                     <td class="checker">\n-                                        <tal:icon\n-                                            condition="rule/enabled"\n-                                            replace="structure python:icons.tag(\'check-circle\')" />\n+                                        <tal:icon tal:condition="rule/enabled"\n+                                            i18n:attributes="alt label_contentrules_active;"\n+                                            tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n                                     </td>\n                                 </tr>\n                             </tal:rules>\n@@ -101,36 +109,40 @@\n                     </table>\n                 </div>\n \n-                <form class="formControls mb-3" tal:define="assignable_rules view/assignable_rules" tal:condition="assignable_rules"\n-                      tal:attributes="action string:${view/view_url}" method="post">\n-                    <div class="mb-3">\n-                        <label class="form-label" for="" i18n:translate="contentrules_add_assignment">\n-                            Assign rule here\n-                        </label>\n-                        <div>\n-                          <select class="form-select" name="rule_id" size="1" id="select-rules">\n-                              <tal:options repeat="rule assignable_rules">\n-                                  <option tal:attributes="value rule/id"\n-                                          tal:content="rule/title">Addable rule name</option>\n-                              </tal:options>\n-                          </select>\n-                          <button class="context btn btn-primary"\n-                                 type="submit"\n-                                 name="form.button.AddAssignment"\n-                                 value="Add"\n-                                 i18n:attributes="value label_add;"\n-                                 i18n:translate="label_add">Add</button>\n-                        </div>\n+                <div id="assignable-content-rules" class="mb-4"\n+                    tal:define="assignable_rules view/assignable_rules"\n+                    tal:condition="assignable_rules">\n+                    <div class="col-form-label" i18n:translate="contentrules_available_rules">\n+                        Available content rules:\n                     </div>\n-                </form>\n+                    <form class="row row-cols-auto g-3 align-items-center"\n+                        tal:attributes="action string:${view/view_url}" method="post">\n+                            <div class="col-auto">\n+                                <select class="form-select" name="rule_id" size="1" id="select-rules">\n+                                    <tal:options repeat="rule assignable_rules">\n+                                        <option tal:attributes="value rule/id"\n+                                                tal:content="rule/title">Addable rule name</option>\n+                                    </tal:options>\n+                                </select>\n+                            </div>\n+\n+                            <div class="col-auto">\n+                                <button class="context btn btn-primary"\n+                                    type="submit"\n+                                    name="form.button.AddAssignment"\n+                                    value="Add"\n+                                    i18n:attributes="value label_add;"\n+                                    i18n:translate="label_add">Add</button>\n+                            </div>\n+                    </form>\n+                </div>\n+\n \n                 <div class="clearfix"></div>\n \n                 <form class="mb-3" tal:attributes="action view/view_url" method="post"\n-                      tal:define="assigned_rules view/assigned_rules;\n-                                  auth_token context/@@authenticator/token"\n-                      tal:condition="assigned_rules">\n-                    <table class="table table-striped">\n+                      tal:define="assigned_rules view/assigned_rules" tal:condition="assigned_rules">\n+                    <table class="table listing nosort">\n                         <thead>\n                             <tr>\n                                 <th class="smallcolumn">&nbsp;</th>\n@@ -178,30 +190,30 @@\n                                     <a tal:condition="not:repeat/rule/start"\n                                        title="Move up"\n                                        i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id}&amp;_authenticator=${auth_token}">\n-                                       <tal:icon replace="structure python:icons.tag(\'arrow-up\')" />\n+                                       tal:attributes="href string:${view/view_url}?operation=move_up&amp;rule_id=${rule/id}">\n+                                        <tal:icon tal:replace="structure python:icons.tag(\'caret-up-fill\', tag_class=\'\', tag_alt=\'\')" />\n                                     </a>\n                                     <a tal:condition="not:repeat/rule/end"\n                                        title="Move down"\n                                        i18n:attributes="title"\n-                                       tal:attributes="href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id}&amp;_authenticator=${auth_token}">\n-                                       <tal:icon replace="structure python:icons.tag(\'arrow-down\')" />\n+                                       tal:attributes="href string:${view/view_url}?operation=move_down&amp;rule_id=${rule/id}">\n+                                        <tal:icon tal:replace="structure python:icons.tag(\'caret-down-fill\', tag_class=\'\', tag_alt=\'\')" />\n                                     </a>\n                                 </td>\n-                                <td class="text-center">\n-                                    <tal:icon\n-                                            condition="rule/bubbles"\n-                                            replace="structure python:icons.tag(\'check-circle\')" />\n+                                <td class="checker listingCheckbox">\n+                                    <tal:icon tal:condition="rule/bubbles"\n+                                        i18n:attributes="alt label_contentrules_active;"\n+                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n                                 </td>\n-                                <td class="text-center">\n-                                    <tal:icon\n-                                            condition="rule/enabled"\n-                                            replace="structure python:icons.tag(\'check-circle\')" />\n+                                <td class="checker listingCheckbox">\n+                                    <tal:icon tal:condition="rule/enabled"\n+                                        i18n:attributes="alt label_contentrules_active;"\n+                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n                                 </td>\n-                                <td class="text-center">\n-                                    <tal:icon\n-                                            condition="rule/global_enabled"\n-                                            replace="structure python:icons.tag(\'check-circle\')" />\n+                                <td class="checker listingCheckbox">\n+                                    <tal:icon tal:condition="rule/global_enabled"\n+                                        i18n:attributes="alt label_contentrules_active;"\n+                                        tal:replace="structure python:icons.tag(\'check-circle-fill\', tag_class=\'text-success\', tag_alt=\'Active\')" />\n                                 </td>\n                             </tr>\n                             </tal:rules>\ndiff --git a/plone/app/contentrules/browser/templates/manage-elements.pt b/plone/app/contentrules/browser/templates/manage-elements.pt\nindex b22d292..62f672d 100644\n--- a/plone/app/contentrules/browser/templates/manage-elements.pt\n+++ b/plone/app/contentrules/browser/templates/manage-elements.pt\n@@ -1,321 +1,296 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      lang="en"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      metal:use-macro="here/prefs_main_template/macros/master"\n-      i18n:domain="plone">\n-\n-<body>\n-\n-<div metal:fill-slot="prefs_configlet_main">\n-\n-    <link rel="stylesheet" type="text/css" media="all"\n-          href="++resource++manage-contentrules.css"\n-          tal:attributes="href string:${context/portal_url}/++resource++manage-contentrules.css" />\n-\n-    <script type="text/javascript" src="++resource++manage-contentrule-elements.js"\n-        tal:attributes="src string:${context/portal_url}/++resource++manage-contentrule-elements.js">\n-    </script>\n-\n-    <h1 class="documentFirstHeading"\n-        i18n:translate="title_edit_contentrule">Edit content rule</h1>\n-\n-    <a href=""\n-       class="link-parent"\n-       tal:attributes="href string:${portal_url}/@@rules-controlpanel"\n-       i18n:translate="go_to_contentrules_management">\n-        Up to rule management\n-    </a>\n-\n-     <p i18n:translate="contentrules_description_execution"\n-        class="documentDescription">\n-        Rules execute when a triggering event occurs. Rule actions will only\n-        be invoked if all the rule\'s conditions are met. You can add new\n-        actions and conditions using the buttons below.\n-    </p>\n-\n-    <fieldset id="configure-conditions" tal:define="conditions view/conditions">\n-\n-        <div tal:condition="not:conditions" class="alert alert-secondary">\n-            <strong i18n:translate="">Info</strong>\n-            <span i18n:translate="">\n-                There is not any additional condition checked on this rule.\n-            </span>\n-        </div>\n-\n-        <legend tal:condition="conditions" i18n:translate="if_all_conditions_met">\n-            If all of the following conditions are met:\n-        </legend>\n-\n-        <form class="mb-3" tal:attributes="action view/view_url" method="post"\n-              tal:define="auth_token context/@@authenticator/token"\n-              tal:repeat="condition conditions">\n-            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <a tal:attributes="name string:condition++${condition/idx}"></a>\n-            <input type="hidden" name="element_id:int" tal:attributes="value condition/idx" />\n-            <div class="rule-element border border-secondary rounded d-flex align-items-center justify-content-between px-2">\n-                <div>\n-                    <strong tal:content="condition/title" i18n:translate="">Transition was publish.</strong>\n-                    <span tal:content="condition/summary">\n-                        Something happened\n-                    </span>\n-                </div>\n-                <div class="rule-operations flex-shrink-0">\n-                    <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n-                       class="pat-plone-modal plone-btn-primary btn btn-sm btn-primary"\n-                       tal:condition="condition/editview" i18n:translate="label_edit">Edit</a>\n-                    <button type="submit"\n-                           name="form.button.DeleteCondition"\n-                           value="Remove"\n-                           class="context btn btn-sm btn-danger"\n-                           i18n:attributes="value label_remove;"\n-                           i18n:translate="label_remove"\n-                           >Remove</button>\n-                    <button tal:attributes="disabled python:condition[\'first\'] and \'disabled\' or None"\n-                           type="submit"\n-                           name="form.button.MoveConditionUp"\n-                           value="&uarr;"\n-                           class="context btn btn-sm btn-primary"\n-                           >&uarr;</button>\n-                    <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n-                           type="submit"\n-                           name="form.button.MoveConditionDown"\n-                           value="&darr;"\n-                           class="context btn btn-sm btn-primary"\n-                           >&darr;</button>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+    xml:lang="en"\n+    lang="en"\n+    xmlns:metal="http://xml.zope.org/namespaces/metal"\n+    xmlns:tal="http://xml.zope.org/namespaces/tal"\n+    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+    metal:use-macro="here/prefs_main_template/macros/master"\n+    i18n:domain="plone">\n+\n+    <body>\n+\n+        <metal:main metal:fill-slot="prefs_configlet_main">\n+\n+            <header>\n+                <h1 class="documentFirstHeading">\n+                    <span i18n:translate="title_edit_contentrule">Edit content rule</span>:\n+                    <span tal:replace="view/rule_title"></span>\n+                </h1>\n+\n+                <p i18n:translate="contentrules_description_execution"\n+                    class="lead">\n+                    Rules execute when a triggering event occurs. Rule actions will only\n+                    be invoked if all the rule\'s conditions are met. You can add new\n+                    actions and conditions using the buttons below.\n+                </p>\n+                <a href=""\n+                    class="link-parent d-block"\n+                    tal:attributes="href string:${portal_url}/@@rules-controlpanel"\n+                    i18n:translate="go_to_contentrules_overview">\n+                    Up to rule overview\n+                </a>\n+            </header>\n+\n+            <div id="content-core" class="pat-contentrules-elements">\n+\n+                <div class="row row-cols-1 row-cols-md-2">\n+                    <fieldset id="configure-conditions" class="col"\n+                        tal:define="conditions view/conditions">\n+                        <legend i18n:translate="if_all_conditions_met" class="float-none">\n+                            If all of the following conditions are met:\n+                        </legend>\n+\n+                        <div tal:condition="not:conditions"\n+                            class="alert alert-info">\n+                            <strong i18n:translate="">Info</strong>\n+                            <span i18n:translate="">\n+                                There is not any additional condition checked on this rule.\n+                            </span>\n+                        </div>\n+\n+                        <form class="mb-3"\n+                            tal:attributes="action view/view_url"\n+                            method="post"\n+                            tal:define="auth_token context/@@authenticator/token"\n+                            tal:repeat="condition conditions">\n+                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                            <a tal:attributes="name string:condition++${condition/idx}"></a>\n+                            <input type="hidden"\n+                                name="element_id:int"\n+                                tal:attributes="value condition/idx" />\n+\n+                            <div class="card">\n+                                <div class="card-body row">\n+                                    <div class="col">\n+                                        <h5 class="card-title"\n+                                        tal:content="condition/title"\n+                                        i18n:translate="">Transition was publish.</h5>\n+                                    </div>\n+                                    <div class="col-auto">\n+                                        <div class="rule-operations">\n+                                            <a tal:attributes="href string:${condition/editview}?_authenticator=${auth_token}"\n+                                                class="pat-plone-modal btn btn-sm btn-primary"\n+                                                tal:condition="condition/editview"\n+                                                i18n:translate="label_edit">Edit</a>\n+                                            <button type="submit"\n+                                                name="form.button.DeleteCondition"\n+                                                value="Remove"\n+                                                class="context btn btn-sm btn-danger"\n+                                                i18n:attributes="value label_remove;"\n+                                                i18n:translate="label_remove">Remove</button>\n+                                            <button tal:attributes="disabled python:condition[\'first\'] and \'disabled\' or None"\n+                                                type="submit"\n+                                                name="form.button.MoveConditionUp"\n+                                                value="&uarr;"\n+                                                class="context btn btn-sm btn-primary">&uarr;</button>\n+                                            <button tal:attributes="disabled python:condition[\'last\'] and \'disabled\' or None"\n+                                                type="submit"\n+                                                name="form.button.MoveConditionDown"\n+                                                value="&darr;"\n+                                                class="context btn btn-sm btn-primary">&darr;</button>\n+                                        </div>\n+                                    </div>\n+                                    <p class="card-text" tal:content="condition/summary">\n+                                        Something happened\n+                                    </p>\n+                                </div>\n+                            </div>\n+                        </form>\n+\n+                        <form class="mb-3"\n+                            tal:attributes="action string:${view/base_url}/+condition"\n+                            method="get"\n+                            id="add-condition">\n+                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                            <div class="input-group">\n+\n+                                <span class="input-group-text" i18n:translate="contentrules_condition"\n+                                    for="contentrules-add-condition">\n+                                    Condition:\n+                                </span>\n+\n+                                <select name=":action"\n+                                    size="1"\n+                                    id="contentrules-add-condition"\n+                                    class="form-select"\n+                                    aria-label="Add condition"\n+                                    i18n:attributes="aria-label contentrules_add_condition">\n+                                    <tal:block repeat="condition view/addable_conditions">\n+                                        <option tal:attributes="value condition/addview"\n+                                            i18n:translate=""\n+                                            tal:content="condition/title" />\n+                                    </tal:block>\n+                                </select>\n+                                <button class="context allowMultiSubmit btn btn-success"\n+                                    type="submit"\n+                                    name="form.button.AddCondition"\n+                                    value="Add"\n+                                    i18n:attributes="value label_add;"\n+                                    i18n:translate="label_add">Add</button>\n+                            </div>\n+                            &nbsp; <!-- For Safari -->\n+                        </form>\n+                    </fieldset>\n+\n+                    <fieldset id="configure-actions" class="col"\n+                        tal:define="actions view/actions">\n+                        <legend i18n:translate="contentrules_perform_actions" class="float-none">\n+                            Perform the following actions:\n+                        </legend>\n+\n+                        <div tal:condition="not:actions"\n+                            class="alert alert-warning">\n+                            <strong i18n:translate="">Warning</strong>\n+                            <span i18n:translate="">\n+                                There is not any action performed by this rule.\n+                                Click on Add button to setup an action.\n+                            </span>\n+                        </div>\n+                        <form class="mb-3"\n+                            tal:attributes="action view/view_url"\n+                            method="post"\n+                            tal:define="auth_token context/@@authenticator/token"\n+                            tal:repeat="action actions">\n+                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                            <a tal:attributes="name string:action++${action/idx}"></a>\n+                            <input type="hidden"\n+                                name="element_id:int"\n+                                tal:attributes="value action/idx" />\n+\n+                            <div class="card">\n+                                <div class="card-body row">\n+                                    <div class="col">\n+                                        <h5 class="card-title"\n+                                        tal:content="action/title"\n+                                        i18n:translate="">Move to folder</h5>\n+                                    </div>\n+                                    <div class="col-auto">\n+                                        <div class="rule-operations">\n+                                            <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}"\n+                                                class="pat-plone-modal btn btn-sm btn-primary"\n+                                                tal:condition="action/editview"\n+                                                i18n:translate="label_edit">Edit</a>\n+                                            <button type="submit"\n+                                                name="form.button.DeleteAction"\n+                                                value="Remove"\n+                                                class="context btn btn-sm btn-danger"\n+                                                i18n:attributes="value label_remove;"\n+                                                i18n:translate="label_remove">Remove</button>\n+                                            <button tal:attributes="disabled python:action[\'first\'] and \'disabled\' or None"\n+                                                type="submit"\n+                                                name="form.button.MoveActionUp"\n+                                                value="&uarr;"\n+                                                class="context btn btn-sm btn-primary">&uarr;</button>\n+                                            <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n+                                                type="submit"\n+                                                name="form.button.MoveActionDown"\n+                                                value="&darr;"\n+                                                class="context btn btn-sm btn-primary">&darr;</button>\n+                                        </div>\n+                                    </div>\n+                                    <p class="card-text" tal:content="action/summary">\n+                                        Something happened\n+                                    </p>\n+                                </div>\n+                            </div>\n+\n+\n+                        </form>\n+\n+                        <form class="mb-3"\n+                            tal:attributes="action string:${view/base_url}/+action"\n+                            method="get"\n+                            id="add-action">\n+                            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n+                            <div class="input-group">\n+\n+                                <span class="input-group-text"\n+                                    i18n:translate="contentrules_action"\n+                                    for="contentrules-add-action">Action:</span>\n+\n+                                <select name=":action"\n+                                    size="1"\n+                                    id="contentrules-add-action"\n+                                    class="form-select"\n+                                    aria-label="Add action"\n+                                    i18n:attributes="aria-label contentrules_add_action">\n+                                    <tal:block repeat="action view/addable_actions">\n+                                        <option tal:attributes="value action/addview"\n+                                            i18n:translate=""\n+                                            tal:content="action/title"></option>\n+                                    </tal:block>\n+                                </select>\n+                                <button class="context allowMultiSubmit btn btn-success"\n+                                    type="submit"\n+                                    name="form.button.AddAction"\n+                                    value="Add"\n+                                    i18n:attributes="value label_add;"\n+                                    i18n:translate="label_add">Add</button>\n+                            </div>\n+                            &nbsp; <!-- For Safari -->\n+                        </form>\n+                    </fieldset>\n                 </div>\n-            </div>\n-        </form>\n-\n-        <form class="mb-3" tal:attributes="action string:${view/base_url}/+condition" method="get"\n-            id="add-condition">\n-            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <div class="chooser-right">\n-                <label i18n:translate="contentrules_add_condition"\n-                       for="contentrules-add-condition">\n-                    Add condition\n-                </label>\n-\n-                <select name=":action" size="1" id="contentrules-add-condition" class="form-select">\n-                    <tal:block repeat="condition view/addable_conditions">\n-                        <option tal:attributes="value condition/addview"\n-                                i18n:translate=""\n-                                tal:content="condition/title" />\n-                    </tal:block>\n-                </select>\n-                <button class="context allowMultiSubmit btn btn-sm btn-primary"\n-                       type="submit"\n-                       name="form.button.AddCondition"\n-                       value="Add"\n-                       i18n:attributes="value label_add;"\n-                       i18n:translate="label_add">Add</button>\n-            </div>\n-            &nbsp; <!-- For Safari -->\n-        </form>\n-    </fieldset>\n-\n-    <fieldset id="configure-actions" tal:define="actions view/actions">\n-        <div tal:condition="not:actions" class="alert alert-warning">\n-            <strong i18n:translate="">Warning</strong>\n-            <span i18n:translate="">\n-                There is not any action performed by this rule.\n-                Click on Add button to setup an action.\n-            </span>\n-        </div>\n-\n-        <legend tal:condition="actions" i18n:translate="contentrules_perform_actions">\n-            Perform the following actions:\n-        </legend>\n-\n-        <form class="mb-3" tal:attributes="action view/view_url" method="post"\n-              tal:define="auth_token context/@@authenticator/token"\n-              tal:repeat="action actions">\n-            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <a tal:attributes="name string:action++${action/idx}"></a>\n-            <input type="hidden" name="element_id:int" tal:attributes="value action/idx" />\n-            <div class="rule-element border border-secondary rounded d-flex align-items-center justify-content-between px-2">\n-                <div>\n-                    <strong tal:content="action/title"\n-                    i18n:translate="">Move to folder</strong>\n-                    <span tal:content="action/summary">\n-                        Something happened\n-                    </span>\n-                </div>\n-                <div class="rule-operations flex-shrink-0">\n-                    <a tal:attributes="href string:${action/editview}?_authenticator=${auth_token}" class="pat-plone-modal"\n-                       tal:condition="action/editview">\n-                      <button type="submit"\n-                             name="form.button.EditAction"\n-                             value="Edit"\n-                             class="context btn btn-sm btn-primary"\n-                             i18n:attributes="value label_edit;"\n-                             i18n:translate="label_edit;"\n-                             >Edit</button>\n-                    </a>\n-                    <button type="submit"\n-                           name="form.button.DeleteAction"\n-                           value="Remove"\n-                           class="context btn btn-sm btn-danger"\n-                           i18n:attributes="value label_remove;"\n-                           i18n:translate="label_remove"\n-                           >Remove</button>\n-                    <button tal:attributes="disabled python:action[\'first\'] and \'disabled\' or None"\n-                           type="submit"\n-                           name="form.button.MoveActionUp"\n-                           value="&uarr;"\n-                           class="context btn btn-sm btn-primary"\n-                           >&uarr;</button>\n-                    <button tal:attributes="disabled python:action[\'last\'] and \'disabled\' or None"\n-                           type="submit"\n-                           name="form.button.MoveActionDown"\n-                           value="&darr;"\n-                           class="context btn btn-sm btn-primary"\n-                           >&darr;</button>\n-                </div>\n-            </div>\n-        </form>\n-\n-        <form class="mb-3" tal:attributes="action string:${view/base_url}/+action" method="get"\n-          id="add-action">\n-            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <div class="chooser-right">\n-                <label class="form-label" i18n:translate="contentrules_add_action"\n-                       for="contentrules-add-action">Add action</label>\n-                <select name=":action" size="1" id="contentrules-add-action" class="form-select">\n-                    <tal:block repeat="action view/addable_actions">\n-                        <option tal:attributes="value action/addview"\n-                                i18n:translate=""\n-                                tal:content="action/title"></option>\n-                    </tal:block>\n-                </select>\n-                <button class="context allowMultiSubmit btn btn-sm btn-primary"\n-                       type="submit"\n-                       name="form.button.AddAction"\n-                       value="Add"\n-                       i18n:attributes="value label_add;"\n-                       i18n:translate="label_add">Add</button>\n-            </div>\n-            &nbsp; <!-- For Safari -->\n-        </form>\n-    </fieldset>\n \n-    <tal:assignments define="assignments view/assignments">\n \n-        <fieldset id="manage-assignments">\n-          <legend i18n:translate="label_contentrules_rule_assignments">Assignments</legend>\n-          <tal:noassignments condition="not:assignments">\n-            <div class="alert alert-warning">\n-              <strong i18n:translate="">This rule is not assigned to any location</strong>\n \n-            <tal:enabled condition="view/rule_enabled">\n-              <span i18n:translate="">\n-                The rule is enabled but will perform nothing since it is not assigned anywhere.\n-              </span>\n-                <br />\n-              <span i18n:translate="">\n-                Go to the folder where you want the rule to apply, or at the site root,\n-                click on \'rule\' tab, and then locally setup the rules.\n-              </span>\n+                <tal:assignments define="assignments view/assignments">\n+\n+                    <fieldset id="manage-assignments" class="col">\n+                        <legend i18n:translate="label_contentrules_rule_assignments" class="float-none">Assignments</legend>\n+\n+\n+                        <tal:noassignments condition="not:assignments">\n+                            <div class="alert alert-info">\n+                                <strong i18n:translate="">This rule is not assigned to any location</strong>\n+                                <tal:enabled condition="view/rule_enabled">\n+                                    <div i18n:translate="">\n+                                        The rule is enabled but will perform nothing since it is not assigned anywhere.\n+                                    </div>\n+                                </tal:enabled>\n+                            </div>\n+\n+                                <tal:enabled condition="view/rule_enabled">\n+                                    <p i18n:translate="">\n+                                        Go to the folder where you want the rule to apply, or at the site root,\n+                                        click on \'rule\' tab, and then locally setup the rules.\n+                                    </p>\n+\n+                                    <form class="mb-3"\n+                                        tal:attributes="action view/view_url"\n+                                        method="post">\n+                                        <span tal:replace="structure context/@@authenticator/authenticator" />\n+                                        <input type="submit"\n+                                            class="btn btn-primary"\n+                                            value="Apply rule on the whole site"\n+                                            name="form.button.ApplyOnWholeSite"\n+                                            i18n:attributes="value" />\n+                                    </form>\n+                                </tal:enabled>\n+                        </tal:noassignments>\n+                        <tal:assignments condition="nocall:assignments">\n+                            <div class="card">\n+                                <div class="card-header">\n+                                    <span i18n:translate="description_contentrules_rule_assignments">\n+                                        This rule is assigned to the following locations:\n+                                    </span>\n+                                </div>\n+                                <ul class="list-group list-group-flush">\n+                                <tal:items repeat="assignment assignments">\n+                                    <li class="list-group-item">\n+                                        <a tal:attributes="href string:${assignment/url}/@@manage-content-rules">\n+                                            <tal:icon tal:replace="structure python:icons.tag(assignment[\'icon\'])" /><span class="ms-2" tal:content="assignment/title">title</span>\n+                                        </a>&nbsp;\n+                                    </li>\n+                                </tal:items>\n+                                </ul>\n+                            </div>\n+                        </tal:assignments>\n+                    </fieldset>\n+\n+                </tal:assignments>\n \n-              <form class="mb-3" tal:attributes="action view/view_url" method="post">\n-                <span tal:replace="structure context/@@authenticator/authenticator"/>\n-                <label class="form-label" i18n:translate="contentrules_assignments_shortcuts">Shortcuts:</label>\n-                <input type="submit" class="btn btn-sm btn-primary"\n-                       value="Apply rule on the whole site"\n-                       name="form.button.ApplyOnWholeSite"\n-                       i18n:attributes="value" />\n-              </form>\n-            </tal:enabled>\n             </div>\n-\n-          </tal:noassignments>\n-          <tal:assignments condition="nocall:assignments">\n-            <div class="alert alert-secondary">\n-              <strong>Info</strong>\n-              <span\n-                i18n:translate="description_contentrules_rule_assignments">\n-                This rule is assigned to the following locations:\n-              </span>\n-\n-                <tal:items repeat="assignment assignments">\n-\n-                        <a tal:attributes="href string:${assignment/url}/@@manage-content-rules"\n-                           tal:content="assignment/title" />\n-\n-                </tal:items>\n-            </div>\n-          </tal:assignments>\n-        </fieldset>\n-\n-    </tal:assignments>\n-\n-    <fieldset id="configure-rule">\n-        <legend i18n:translate="">Configure rule</legend>\n-        <form tal:attributes="action view/view_url" method="post">\n-            <span tal:replace="structure context/@@authenticator/authenticator"></span>\n-            <div class="mb-3">\n-                <label class="form-label" for="form.title" i18n:translate="label_title">Title</label>\n-                <input id="form.title" class="form-control" type="text" width="50" name="title"\n-                    tal:attributes="value request/ruleTitle | view/rule_title"/>\n-                <div class="form-text" i18n:translate="description_contentrule_title">\n-                    Please set a descriptive title for the rule.\n-                </div>\n-            </div>\n-            <div class="mb-3">\n-                <label class="form-label" for="form.description" i18n:translate="label_description">Description</label>\n-                <textarea id="form.description" class="form-control" name="description"\n-                    tal:content="request/ruleDescription | view/rule_description ">\n-                </textarea>\n-                <div class="form-text" i18n:translate="contentrules_description_description">\n-                    Enter a short description of the rule and its purpose.\n-                </div>\n-            </div>\n-\n-            <div class="mb-3">\n-                <div class="form-label" i18n:translate="contentrules_description_trigger">\n-                    The rule will execute when the following event occurs.\n-                </div>\n-                <label class="form-text" i18n:translate="label_rule_event_trigger">\n-                    Event trigger: <span i18n:name="trigger" tal:content="view/rule_event"></span>\n-                </label>\n-            </div>\n-\n-            <div class="mb-3 form-check">\n-                <input type="checkbox" id="stop" name="stopExecuting" class="form-check-input"\n-                       tal:attributes="checked view/rule_stop"/>\n-                <label class="form-check-label" for="stop" i18n:translate="contentrules_description_stop">\n-                    Stop evaluating content rules after this rule completes\n-                </label>\n-            </div>\n-\n-            <div class="mb-3 form-check">\n-                <input type="checkbox" id="cascading" name="cascading" class="form-check-input"\n-                       tal:attributes="checked view/rule_cascading"/>\n-                <label class="form-check-label" for="cascading" i18n:translate="contentrules_description_cascading">\n-                    The actions executed by this rule can trigger other rules\n-                </label>\n-            </div>\n-\n-            <div class="mb-3 form-check">\n-                <input type="checkbox" id="enabled" name="enabled" class="form-check-input"\n-                       tal:attributes="checked view/rule_enabled"/>\n-                <label class="form-check-label" for="enabled" i18n:translate="">\n-                    Enabled\n-                </label>\n-            </div>\n-\n-            <div class="mb-3">\n-                <button class="context btn btn-sm btn-primary"\n-                       type="submit"\n-                       name="form.button.Save"\n-                       value="Save"\n-                       i18n:attributes="value label_save;"\n-                       i18n:translate="label_save">Save</button>\n-            </div>\n-        </form>\n-    </fieldset>\n-\n-</div>\n-</body>\n+        </metal:main>\n+    </body>\n </html>\ndiff --git a/plone/app/contentrules/handlers.py b/plone/app/contentrules/handlers.py\nindex 9722e20..b105cb0 100644\n--- a/plone/app/contentrules/handlers.py\n+++ b/plone/app/contentrules/handlers.py\n@@ -8,31 +8,16 @@\n from plone.uuid.interfaces import IUUID\n from Products.CMFCore.interfaces import IContentish\n from Products.CMFCore.interfaces import ISiteRoot\n-from Products.CMFCore.utils import getToolByName\n from zope.component import queryUtility\n from zope.component.hooks import getSite\n from zope.container.interfaces import IContainerModifiedEvent\n from zope.container.interfaces import IObjectAddedEvent\n from zope.container.interfaces import IObjectRemovedEvent\n-from zope.interface import Interface\n from zope.lifecycleevent.interfaces import IObjectCopiedEvent\n \n import threading\n \n \n-try:\n-    from Products.Archetypes.interfaces import IBaseObject\n-    from Products.Archetypes.interfaces import IObjectInitializedEvent\n-    HAS_ARCHETYPES = True\n-except ImportError:\n-    class IBaseObject(Interface):\n-        pass\n-\n-    class IObjectInitializedEvent(Interface):\n-        pass\n-    HAS_ARCHETYPES = False\n-\n-\n def _get_uid(context):\n     uid = IUUID(context, None)\n     if uid is not None:\n@@ -79,8 +64,6 @@ def __call__(self, context, rule, event):\n def init():\n     if not hasattr(_status, \'rule_filter\'):\n         _status.rule_filter = DuplicateRuleFilter()\n-    if not hasattr(_status, \'delayed_events\'):\n-        _status.delayed_events = {}\n \n \n def close(event):\n@@ -89,9 +72,6 @@ def close(event):\n     if hasattr(_status, \'rule_filter\'):\n         _status.rule_filter.reset()\n \n-    if hasattr(_status, \'delayed_events\'):\n-        _status.delayed_events = {}\n-\n \n def execute(context, event):\n     """Execute all rules relative to the context, and bubble as appropriate.\n@@ -144,72 +124,24 @@ def execute(context, event):\n     rule_filter.in_progress = False\n \n # Event handlers\n-\n-\n-def is_portal_factory(context):\n-    """Find out if the given object is in portal_factory\n-    """\n-    portal_factory = getToolByName(context, \'portal_factory\', None)\n-    if portal_factory is not None:\n-        return portal_factory.isTemporary(context)\n-    else:\n-        return False\n-\n-\n def execute_rules(event):\n     """ When an action is invoked on an object,\n         execute rules assigned to its parent.\n         Base action executor handler """\n-    if is_portal_factory(event.object):\n-        return\n-\n     execute(aq_parent(aq_inner(event.object)), event)\n \n \n def added(event):\n     """When an object is added, execute rules assigned to its new parent.\n-\n-    There is special handling for Archetypes objects.\n     """\n     obj = event.object\n-    if is_portal_factory(obj):\n-        return\n \n-    # The object added event executes too early for Archetypes objects.\n-    # We need to delay execution until we receive a subsequent\n-    # IObjectInitializedEvent\n-    if HAS_ARCHETYPES and IBaseObject.providedBy(obj):\n-        init()\n-        uid = _get_uid(obj)\n-        new_key = \'IObjectInitializedEvent-{0}\'.format(uid)\n-        _status.delayed_events[new_key] = event\n-    elif IContentish.providedBy(obj) or IComment.providedBy(obj):\n+    if IContentish.providedBy(obj) or IComment.providedBy(obj):\n         execute(event.newParent, event)\n     else:\n         return\n \n \n-if HAS_ARCHETYPES:\n-    def archetypes_initialized(event):\n-        """Pick up the delayed IObjectAddedEvent when an Archetypes object is\n-        initialised.\n-        """\n-        obj = event.object\n-        if is_portal_factory(obj):\n-            return\n-\n-        if not IBaseObject.providedBy(obj):\n-            return\n-\n-        init()\n-        uid = _get_uid(obj)\n-        key = \'IObjectInitializedEvent-{0}\'.format(uid)\n-        delayed_event = _status.delayed_events.get(key, None)\n-        if delayed_event is not None:\n-            _status.delayed_events[key] = None\n-            execute(delayed_event.newParent, delayed_event)\n-\n-\n def removed(event):\n     """When an IObjectRemovedEvent was received, execute rules assigned to its\n      previous parent.\n@@ -218,9 +150,6 @@ def removed(event):\n     if not (IContentish.providedBy(obj) or IComment.providedBy(obj)):\n         return\n \n-    if is_portal_factory(obj):\n-        return\n-\n     execute(event.oldParent, event)\n \n \n@@ -232,9 +161,7 @@ def modified(event):\n     if not (IContentish.providedBy(obj) or IComment.providedBy(obj)):\n         return\n \n-    # Let the special handler take care of IObjectInitializedEvent\n     object_events = (\n-        IObjectInitializedEvent,\n         IObjectAddedEvent,\n         IObjectRemovedEvent,\n         IContainerModifiedEvent,\n@@ -254,9 +181,6 @@ def copied(event):\n     if not (IContentish.providedBy(obj) or IComment.providedBy(obj)):\n         return\n \n-    if is_portal_factory(obj):\n-        return\n-\n     execute(aq_parent(aq_inner(event.original)), event)\n \n \ndiff --git a/plone/app/contentrules/tests/assignment.txt b/plone/app/contentrules/tests/assignment.txt\nindex 62e266b..06bf575 100644\n--- a/plone/app/contentrules/tests/assignment.txt\n+++ b/plone/app/contentrules/tests/assignment.txt\n@@ -4,7 +4,7 @@ Setup\n   >>> from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n   >>> from plone.app.testing import setRoles\n   >>> from plone.app.testing import TEST_USER_ID\n-  >>> from plone.testing.z2 import Browser\n+  >>> from plone.testing.zope import Browser\n \n   >>> portal = layer[\'portal\']\n   >>> setRoles(portal, TEST_USER_ID, [\'Manager\'])\n@@ -38,13 +38,13 @@ condition for *published*:\n \n   >>> browser.url\n   \'http://nohost/plone/++rule++rule-1/@@manage-elements\'\n-  >>> browser.getControl(\'Add condition\').value = [\n+  >>> browser.getControl(name=":action", index=0).value = [\n   ...     \'plone.conditions.PortalType\']\n   >>> browser.getControl(name=\'form.button.AddCondition\').click()\n   >>> browser.getControl(\'Content type\').value = [\'News Item\']\n   >>> browser.getControl(\'Save\').click()\n \n-  >>> browser.getControl(\'Add condition\').value = [\n+  >>> browser.getControl(name=":action", index=0).value = [\n   ...     \'plone.conditions.WorkflowState\']\n   >>> browser.getControl(name=\'form.button.AddCondition\').click()\n   >>> browser.getControl(\'Workflow state\').value = [\'published\']\n@@ -53,7 +53,7 @@ condition for *published*:\n Now comes the action, we want all news items to be copied into the\n `/news` folder:\n \n-  >>> browser.getControl(\'Add action\').value = [\'plone.actions.Copy\']\n+  >>> browser.getControl(name=":action", index=1).value = [\'plone.actions.Copy\']\n   >>> browser.getControl(name=\'form.button.AddAction\').click()\n   >>> ctrl = browser.getControl(name=\'form.widgets.target_folder\')\n   >>> from plone.uuid.interfaces import IUUID\n@@ -71,7 +71,7 @@ A second rule will be added to notify users when a content is added.\n   >>> ctrl.value = [\'Object added to this container\']\n   >>> browser.getControl(\'Save\').click()\n   >>> browser.open(\'http://nohost/plone/++rule++rule-2/@@manage-elements\')\n-  >>> browser.getControl(\'Add action\').value = [\'plone.actions.Notify\']\n+  >>> browser.getControl(name=":action", index=1).value = [\'plone.actions.Notify\']\n   >>> browser.getControl(name=\'form.button.AddAction\').click()\n   >>> ctrl = browser.getControl(name=\'form.widgets.message\')\n   >>> ctrl.value = \'Content added\'\ndiff --git a/plone/app/contentrules/tests/multipublish.txt b/plone/app/contentrules/tests/multipublish.txt\nindex d022797..90608e4 100644\n--- a/plone/app/contentrules/tests/multipublish.txt\n+++ b/plone/app/contentrules/tests/multipublish.txt\n@@ -5,7 +5,7 @@ Setup\n -----\n \n   >>> from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n-  >>> from plone.testing.z2 import Browser\n+  >>> from plone.testing.zope import Browser\n   >>> from plone.app.testing import setRoles\n   >>> from plone.app.testing import TEST_USER_ID\n \n@@ -37,13 +37,13 @@ condition for *published*:\n \n   >>> browser.url\n   \'http://nohost/plone/++rule++rule-1/@@manage-elements\'\n-  >>> browser.getControl(\'Add condition\').value = [\n+  >>> browser.getControl(name=":action", index=0).value = [\n   ...     \'plone.conditions.PortalType\']\n   >>> browser.getControl(name=\'form.button.AddCondition\').click()\n   >>> browser.getControl(\'Content type\').value = [\'News Item\']\n   >>> browser.getControl(\'Save\').click()\n \n-  >>> browser.getControl(\'Add condition\').value = [\n+  >>> browser.getControl(name=":action", index=0).value = [\n   ...     \'plone.conditions.WorkflowState\']\n   >>> browser.getControl(name=\'form.button.AddCondition\').click()\n   >>> browser.getControl(\'Workflow state\').value = [\'published\']\n@@ -52,7 +52,7 @@ condition for *published*:\n Now comes the action, we want all news items to be moved into the\n `/news` folder:\n \n-  >>> browser.getControl(\'Add action\').value = [\'plone.actions.Move\']\n+  >>> browser.getControl(name=":action", index=1).value = [\'plone.actions.Move\']\n   >>> browser.getControl(name=\'form.button.AddAction\').click()\n   >>> ctrl = browser.getControl(name=\'form.widgets.target_folder\')\n   >>> from plone.uuid.interfaces import IUUID\ndiff --git a/plone/app/contentrules/tests/simplepublish.txt b/plone/app/contentrules/tests/simplepublish.txt\nindex 9c74964..fca7c27 100644\n--- a/plone/app/contentrules/tests/simplepublish.txt\n+++ b/plone/app/contentrules/tests/simplepublish.txt\n@@ -2,7 +2,7 @@ Setup\n -----\n \n   >>> from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD\n-  >>> from plone.testing.z2 import Browser\n+  >>> from plone.testing.zope import Browser\n   >>> from plone.app.testing import setRoles\n   >>> from plone.app.testing import TEST_USER_ID\n \n@@ -38,20 +38,20 @@ condition for *published*:\n \n   >>> browser.url\n   \'http://nohost/plone/++rule++rule-1/@@manage-elements\'\n-  >>> browser.getControl(\'Add condition\').value = [\'plone.conditions.PortalType\']\n-  >>> browser.getControl(\'Add\', index=1).click()\n+  >>> browser.getControl(name=":action", index=0).value = [\'plone.conditions.PortalType\']\n+  >>> browser.getControl(\'Add\', index=0).click()\n   >>> browser.getControl(\'Content type\').value = [\'News Item\']\n   >>> browser.getControl(\'Save\').click()\n \n-  >>> browser.getControl(\'Add condition\').value = [\'plone.conditions.WorkflowState\']\n-  >>> browser.getControl(\'Add\', index=1).click()\n+  >>> browser.getControl(name=":action", index=0).value = [\'plone.conditions.WorkflowState\']\n+  >>> browser.getControl(\'Add\', index=0).click()\n   >>> browser.getControl(\'Workflow state\').value = [\'published\']\n   >>> browser.getControl(\'Save\').click()\n \n Now comes the action, we want all news items to be copied into the\n `/news` folder:\n \n-  >>> browser.getControl(\'Add action\').value = [\'plone.actions.Copy\']\n+  >>> browser.getControl(name=":action", index=1).value = [\'plone.actions.Copy\']\n   >>> browser.getControl(name=\'form.button.AddAction\').click()\n   >>> ctrl = browser.getControl(name=\'form.widgets.target_folder\')\n   >>> from plone.uuid.interfaces import IUUID\n'

