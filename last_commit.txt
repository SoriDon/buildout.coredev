Repository: plone.namedfile


Branch: refs/heads/master
Date: 2017-04-26T00:28:34+02:00
Author: Rodrigo Ferreira de Souza (rodfersou) <rodfersou@gmail.com>
Commit: https://github.com/plone/plone.namedfile/commit/c3b2121167a33c8e0b9704ac1df3e9cb344a8f48

Add test to show the error

Files changed:
M plone/namedfile/tests/test_scaling.py

diff --git a/plone/namedfile/tests/test_scaling.py b/plone/namedfile/tests/test_scaling.py
index 3e1da92..6044afc 100644
--- a/plone/namedfile/tests/test_scaling.py
+++ b/plone/namedfile/tests/test_scaling.py
@@ -74,6 +74,9 @@ def testCreateScale(self):
         foo = self.scaling.scale('image', width=100, height=80)
         self.assertTrue(foo.uid)
         self.assertEqual(foo.mimetype, 'image/png')
+        self.assertIsInstance(foo.mimetype, str)
+        self.assertEqual(foo.data.contentType, 'image/png')
+        self.assertIsInstance(foo.data.contentType, str)
         self.assertEqual(foo.width, 80)
         self.assertEqual(foo.height, 80)
         assertImage(self, foo.data.data, 'PNG', (80, 80))
@@ -105,6 +108,9 @@ def testGetScaleByName(self):
         foo = self.scaling.scale('image', scale='foo')
         self.assertTrue(foo.uid)
         self.assertEqual(foo.mimetype, 'image/png')
+        self.assertIsInstance(foo.mimetype, str)
+        self.assertEqual(foo.data.contentType, 'image/png')
+        self.assertIsInstance(foo.data.contentType, str)
         self.assertEqual(foo.width, 60)
         self.assertEqual(foo.height, 60)
         assertImage(self, foo.data.data, 'PNG', (60, 60))


Repository: plone.namedfile


Branch: refs/heads/master
Date: 2017-04-26T00:31:29+02:00
Author: Rodrigo Ferreira de Souza (rodfersou) <rodfersou@gmail.com>
Commit: https://github.com/plone/plone.namedfile/commit/98239b9776bee3903e96994dbfacb1204b4efe95

* Add changelog
* Change contentType attribute to str type

Files changed:
M CHANGES.rst
M plone/namedfile/scaling.py

diff --git a/CHANGES.rst b/CHANGES.rst
index db77719..d650c7f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Fix contentType attribute should be str type, what leads to validation errors (fixes `#38`_).
+  [rodfersou]
+
 - Fix bug on Image rotation if ImageIFD.XResolution or ImageIFD.YResolution are not set.
   [loechel]
 
@@ -461,3 +464,6 @@ Fixes:
 ------------------
 
 * Initial release
+
+
+.. _`#38`: https://github.com/plone/plone.namedfile/issues/38
diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py
index 4d4dec6..7593012 100644
--- a/plone/namedfile/scaling.py
+++ b/plone/namedfile/scaling.py
@@ -265,7 +265,7 @@ def __call__(
             return
 
         data, format_, dimensions = result
-        mimetype = u'image/{0}'.format(format_.lower())
+        mimetype = 'image/{0}'.format(format_.lower())
         value = orig_value.__class__(
             data,
             contentType=mimetype,


Repository: plone.namedfile


Branch: refs/heads/master
Date: 2017-04-26T01:30:50+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.namedfile/commit/d7fcec354d673e0c431e129da35a52a87f71851b

Merge pull request #45 from plone/issue_38_master

Issue 38 master

Files changed:
M CHANGES.rst
M plone/namedfile/scaling.py
M plone/namedfile/tests/test_scaling.py

diff --git a/CHANGES.rst b/CHANGES.rst
index db77719..d650c7f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Fix contentType attribute should be str type, what leads to validation errors (fixes `#38`_).
+  [rodfersou]
+
 - Fix bug on Image rotation if ImageIFD.XResolution or ImageIFD.YResolution are not set.
   [loechel]
 
@@ -461,3 +464,6 @@ Fixes:
 ------------------
 
 * Initial release
+
+
+.. _`#38`: https://github.com/plone/plone.namedfile/issues/38
diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py
index 4d4dec6..7593012 100644
--- a/plone/namedfile/scaling.py
+++ b/plone/namedfile/scaling.py
@@ -265,7 +265,7 @@ def __call__(
             return
 
         data, format_, dimensions = result
-        mimetype = u'image/{0}'.format(format_.lower())
+        mimetype = 'image/{0}'.format(format_.lower())
         value = orig_value.__class__(
             data,
             contentType=mimetype,
diff --git a/plone/namedfile/tests/test_scaling.py b/plone/namedfile/tests/test_scaling.py
index 3e1da92..6044afc 100644
--- a/plone/namedfile/tests/test_scaling.py
+++ b/plone/namedfile/tests/test_scaling.py
@@ -74,6 +74,9 @@ def testCreateScale(self):
         foo = self.scaling.scale('image', width=100, height=80)
         self.assertTrue(foo.uid)
         self.assertEqual(foo.mimetype, 'image/png')
+        self.assertIsInstance(foo.mimetype, str)
+        self.assertEqual(foo.data.contentType, 'image/png')
+        self.assertIsInstance(foo.data.contentType, str)
         self.assertEqual(foo.width, 80)
         self.assertEqual(foo.height, 80)
         assertImage(self, foo.data.data, 'PNG', (80, 80))
@@ -105,6 +108,9 @@ def testGetScaleByName(self):
         foo = self.scaling.scale('image', scale='foo')
         self.assertTrue(foo.uid)
         self.assertEqual(foo.mimetype, 'image/png')
+        self.assertIsInstance(foo.mimetype, str)
+        self.assertEqual(foo.data.contentType, 'image/png')
+        self.assertIsInstance(foo.data.contentType, str)
         self.assertEqual(foo.width, 60)
         self.assertEqual(foo.height, 60)
         assertImage(self, foo.data.data, 'PNG', (60, 60))


