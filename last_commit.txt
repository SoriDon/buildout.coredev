Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-12-21T00:12:41+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/8097d18b80da44441cbd0f403223239311ac8b46

Removed management_page_charset support from usergroup-groupdetails page.

This is related to deprecated unicode property types, like ustring.
Core Plone should not need them, but there could be custom groups that use them,
so we keep the compatibility checks in here.
Part of https://github.com/plone/Products.CMFPlone/issues/3305

Files changed:
A news/3305.bugfix
M Products/CMFPlone/controlpanel/browser/usergroups_groupdetails.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/usergroups_groupdetails.pt b/Products/CMFPlone/controlpanel/browser/usergroups_groupdetails.pt\nindex cb1c97ebc3..67e738a52d 100644\n--- a/Products/CMFPlone/controlpanel/browser/usergroups_groupdetails.pt\n+++ b/Products/CMFPlone/controlpanel/browser/usergroups_groupdetails.pt\n@@ -93,14 +93,6 @@\n                             tal:attributes="value view/groupname | string:"/>\n                   </div>\n \n-                   <tal:set tal:condition="targetobject/management_page_charset|nothing"\n-                            tal:define="dummy python:request.set(\'management_page_charset_tag\',\'\')" />\n-\n-                   <tal:set tal:condition="not:targetobject/management_page_charset|nothing">\n-                      <tal:defines define="dummy python:request.set(\'management_page_charset\',\'UTF-8\');\n-                                           dummy python:request.set(\'management_page_charset_tag\',\'UTF-8:\');" />\n-                   </tal:set>\n-\n                   <tal:properties repeat="property targetobject/propertyMap">\n                       <div class="field mb-3"\n                            tal:define="id property/id;\n@@ -125,14 +117,18 @@\n \n                       <input type="text" name="id" size="35" class="form-control"\n                               tal:condition="python:type in (\'float\',\'date\')"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}$type;\n+                              tal:attributes="name string:$id:$type;\n                                               id id;\n                                               value python:propertyvalue if propertyvalue else \'\';\n                                               disabled disabled;" />\n-\n+                      <tal:comment condition="nothing">\n+                        Unicode property types, like ustring, are deprecated and should not be used in Plone 6 (Zope 5).\n+                        Core Plone should not need them, but there could be custom groups that use them,\n+                        so we keep the compatibility checks in here.\n+                      </tal:comment>\n                       <input type="text" name="string and ustring" size="35" class="form-control"\n                               tal:condition="python:type in (\'string\',\'ustring\')"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}$type;\n+                              tal:attributes="name string:$id:$type;\n                                               id id;\n                                               value python:propertyvalue if propertyvalue else \'\';\n                                               disabled disabled;" />\n@@ -149,7 +145,7 @@\n \n                       <input name="tokens and utokens" value="" type="text" size="35" class="form-control"\n                               tal:condition="python:type in (\'tokens\', \'utokens\')"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}$type;\n+                              tal:attributes="name string:$id:$type;\n                                               value python:propertyvalue if propertyvalue else \'\';\n                                               disabled disabled;" />\n \n@@ -157,7 +153,7 @@\n                               rows="6"\n                               cols="35"\n                               tal:condition="python: type in (\'text\', \'utext\')"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}$type;\n+                              tal:attributes="name string:$id:$type;\n                                               disabled disabled;"\n                               tal:content="propertyvalue">some data</textarea>\n \n@@ -165,7 +161,7 @@\n                               rows="6"\n                               cols="35"\n                               tal:condition="python: type in (\'lines\', \'ulines\')"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}$type;\n+                              tal:attributes="name string:$id:$type;\n                                               disabled disabled;"\n                               tal:content="python: propertyvalue and \'\\n\'.join(propertyvalue) or \'\'">\n                       </textarea>\n@@ -176,7 +172,7 @@\n                                       select_value python:select_variable and path(\'context/%s\' %select_variable) or [];">\n \n                       <select name="selection" tal:condition="python:type in (\'selection\',)"\n-                          tal:attributes="name string:$id:${request/management_page_charset_tag}text;\n+                          tal:attributes="name string:$id:text;\n                                           disabled disabled;">\n                           <tal:values repeat="option select_value">\n                               <option tal:attributes="SELECTED python:\'SELECTED\' if propertyvalue==option else \'\'"\n@@ -185,7 +181,7 @@\n                       </select>\n \n                       <select name="multiple selection" multiple="multiple" tal:condition="python:type in (\'multiple selection\',)"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}list:string;\n+                              tal:attributes="name string:$id:list:string;\n                                               size python:min(7, len(select_value));\n                                               disabled disabled;">\n                           <tal:values repeat="option select_value">\ndiff --git a/news/3305.bugfix b/news/3305.bugfix\nnew file mode 100644\nindex 0000000000..546804c038\n--- /dev/null\n+++ b/news/3305.bugfix\n@@ -0,0 +1,4 @@\n+Removed management_page_charset support from usergroup-groupdetails page.\n+This is related to deprecated unicode property types, like ustring.\n+Part of `issue 3305 <https://github.com/plone/Products.CMFPlone/issues/3305>`_.\n+[maurits]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2021-12-22T11:57:29+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/09c33640325941250486392bb892258efcc74609

Merge pull request #3385 from plone/maurits-management-page-charset-remove-ustring

Removed management_page_charset support from usergroup-groupdetails

Files changed:
A news/3305.bugfix
M Products/CMFPlone/controlpanel/browser/usergroups_groupdetails.pt

b'diff --git a/Products/CMFPlone/controlpanel/browser/usergroups_groupdetails.pt b/Products/CMFPlone/controlpanel/browser/usergroups_groupdetails.pt\nindex cb1c97ebc3..67e738a52d 100644\n--- a/Products/CMFPlone/controlpanel/browser/usergroups_groupdetails.pt\n+++ b/Products/CMFPlone/controlpanel/browser/usergroups_groupdetails.pt\n@@ -93,14 +93,6 @@\n                             tal:attributes="value view/groupname | string:"/>\n                   </div>\n \n-                   <tal:set tal:condition="targetobject/management_page_charset|nothing"\n-                            tal:define="dummy python:request.set(\'management_page_charset_tag\',\'\')" />\n-\n-                   <tal:set tal:condition="not:targetobject/management_page_charset|nothing">\n-                      <tal:defines define="dummy python:request.set(\'management_page_charset\',\'UTF-8\');\n-                                           dummy python:request.set(\'management_page_charset_tag\',\'UTF-8:\');" />\n-                   </tal:set>\n-\n                   <tal:properties repeat="property targetobject/propertyMap">\n                       <div class="field mb-3"\n                            tal:define="id property/id;\n@@ -125,14 +117,18 @@\n \n                       <input type="text" name="id" size="35" class="form-control"\n                               tal:condition="python:type in (\'float\',\'date\')"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}$type;\n+                              tal:attributes="name string:$id:$type;\n                                               id id;\n                                               value python:propertyvalue if propertyvalue else \'\';\n                                               disabled disabled;" />\n-\n+                      <tal:comment condition="nothing">\n+                        Unicode property types, like ustring, are deprecated and should not be used in Plone 6 (Zope 5).\n+                        Core Plone should not need them, but there could be custom groups that use them,\n+                        so we keep the compatibility checks in here.\n+                      </tal:comment>\n                       <input type="text" name="string and ustring" size="35" class="form-control"\n                               tal:condition="python:type in (\'string\',\'ustring\')"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}$type;\n+                              tal:attributes="name string:$id:$type;\n                                               id id;\n                                               value python:propertyvalue if propertyvalue else \'\';\n                                               disabled disabled;" />\n@@ -149,7 +145,7 @@\n \n                       <input name="tokens and utokens" value="" type="text" size="35" class="form-control"\n                               tal:condition="python:type in (\'tokens\', \'utokens\')"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}$type;\n+                              tal:attributes="name string:$id:$type;\n                                               value python:propertyvalue if propertyvalue else \'\';\n                                               disabled disabled;" />\n \n@@ -157,7 +153,7 @@\n                               rows="6"\n                               cols="35"\n                               tal:condition="python: type in (\'text\', \'utext\')"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}$type;\n+                              tal:attributes="name string:$id:$type;\n                                               disabled disabled;"\n                               tal:content="propertyvalue">some data</textarea>\n \n@@ -165,7 +161,7 @@\n                               rows="6"\n                               cols="35"\n                               tal:condition="python: type in (\'lines\', \'ulines\')"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}$type;\n+                              tal:attributes="name string:$id:$type;\n                                               disabled disabled;"\n                               tal:content="python: propertyvalue and \'\\n\'.join(propertyvalue) or \'\'">\n                       </textarea>\n@@ -176,7 +172,7 @@\n                                       select_value python:select_variable and path(\'context/%s\' %select_variable) or [];">\n \n                       <select name="selection" tal:condition="python:type in (\'selection\',)"\n-                          tal:attributes="name string:$id:${request/management_page_charset_tag}text;\n+                          tal:attributes="name string:$id:text;\n                                           disabled disabled;">\n                           <tal:values repeat="option select_value">\n                               <option tal:attributes="SELECTED python:\'SELECTED\' if propertyvalue==option else \'\'"\n@@ -185,7 +181,7 @@\n                       </select>\n \n                       <select name="multiple selection" multiple="multiple" tal:condition="python:type in (\'multiple selection\',)"\n-                              tal:attributes="name string:$id:${request/management_page_charset_tag}list:string;\n+                              tal:attributes="name string:$id:list:string;\n                                               size python:min(7, len(select_value));\n                                               disabled disabled;">\n                           <tal:values repeat="option select_value">\ndiff --git a/news/3305.bugfix b/news/3305.bugfix\nnew file mode 100644\nindex 0000000000..546804c038\n--- /dev/null\n+++ b/news/3305.bugfix\n@@ -0,0 +1,4 @@\n+Removed management_page_charset support from usergroup-groupdetails page.\n+This is related to deprecated unicode property types, like ustring.\n+Part of `issue 3305 <https://github.com/plone/Products.CMFPlone/issues/3305>`_.\n+[maurits]\n'

