Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2023-03-25T23:30:41+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/109e4ecb2f299b88667fd603c97c66485bf74bce

Configuring with plone/meta

Files changed:
A .meta.toml
A .pre-commit-config.yaml
A news/47959565.internal
A tox.ini
M .editorconfig
M pyproject.toml
M setup.cfg

b'diff --git a/.editorconfig b/.editorconfig\nindex a83363bf8..b4158b89d 100644\n--- a/.editorconfig\n+++ b/.editorconfig\n@@ -1,15 +1,39 @@\n-[*]\n-indent_style = space\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n end_of_line = lf\n insert_final_newline = true\n trim_trailing_whitespace = true\n+# Set default charset\n charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n \n-[{*.py,*.cfg}]\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n indent_size = 4\n \n-[{*.html,*.dtml,*.pt,*.zpt,*.xml,*.zcml,*.js}]\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n indent_size = 2\n \n-[Makefile]\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 000000000..07dde259a\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "47959565"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 000000000..582f8acd8\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.2\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/news/47959565.internal b/news/47959565.internal\nnew file mode 100644\nindex 000000000..c08f53991\n--- /dev/null\n+++ b/news/47959565.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615de2..9eb73f3c5 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,43 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 300e56d0e..b2d4c9c05 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,16 +1,24 @@\n-[check-manifest]\n-ignore =\n-    *.sh\n-    .coveragerc\n-    .editorconfig\n-\n-\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n \n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    .coveragerc\n+    tox.ini\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 000000000..8a2a54124\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,53 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --test-path={toxinidir} -s plone.app.contenttypes\n+extras =\n+    test\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2023-03-25T23:30:42+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/6cd43629e9b373eb0dbd56e1f4de46f9adbe5ba7

chore: black

Files changed:
M plone/app/contenttypes/behaviors/collection.py
M plone/app/contenttypes/behaviors/leadimage.py
M plone/app/contenttypes/behaviors/richtext.py
M plone/app/contenttypes/behaviors/tableofcontents.py
M plone/app/contenttypes/behaviors/thumb_icon.py
M plone/app/contenttypes/browser/folder.py
M plone/app/contenttypes/browser/link_redirect_view.py
M plone/app/contenttypes/browser/migration.py
M plone/app/contenttypes/testing.py
M plone/app/contenttypes/tests/test_behaviors_collection.py
M plone/app/contenttypes/tests/test_behaviors_leadimage.py
M plone/app/contenttypes/tests/test_behaviors_table_of_contents.py
M plone/app/contenttypes/tests/test_browser_utils.py
M plone/app/contenttypes/tests/test_collection.py
M plone/app/contenttypes/tests/test_collection_rss.py
M plone/app/contenttypes/tests/test_document.py
M plone/app/contenttypes/tests/test_event.py
M plone/app/contenttypes/tests/test_file.py
M plone/app/contenttypes/tests/test_folder.py
M plone/app/contenttypes/tests/test_image.py
M plone/app/contenttypes/tests/test_indexes.py
M plone/app/contenttypes/tests/test_link.py
M plone/app/contenttypes/tests/test_news_item.py
M plone/app/contenttypes/tests/test_setup.py

b'diff --git a/plone/app/contenttypes/behaviors/collection.py b/plone/app/contenttypes/behaviors/collection.py\nindex 221addac..1d1daf60 100644\n--- a/plone/app/contenttypes/behaviors/collection.py\n+++ b/plone/app/contenttypes/behaviors/collection.py\n@@ -34,7 +34,6 @@\n \n @provider(IFormFieldProvider, ISyndicatable)\n class ICollection(model.Schema):\n-\n     query = schema.List(\n         title=_("Search terms"),\n         description=_(\ndiff --git a/plone/app/contenttypes/behaviors/leadimage.py b/plone/app/contenttypes/behaviors/leadimage.py\nindex 5987d085..486e3b07 100644\n--- a/plone/app/contenttypes/behaviors/leadimage.py\n+++ b/plone/app/contenttypes/behaviors/leadimage.py\n@@ -16,7 +16,6 @@ class ILeadImage(Interface):\n \n @provider(IFormFieldProvider)\n class ILeadImageBehavior(model.Schema):\n-\n     image = namedfile.NamedBlobImage(\n         title=_("label_leadimage", default="Lead Image"),\n         description="",\ndiff --git a/plone/app/contenttypes/behaviors/richtext.py b/plone/app/contenttypes/behaviors/richtext.py\nindex ab3f492c..adc38d5f 100644\n--- a/plone/app/contenttypes/behaviors/richtext.py\n+++ b/plone/app/contenttypes/behaviors/richtext.py\n@@ -20,7 +20,6 @@ class IRichText(Interface):\n \n @provider(IFormFieldProvider)\n class IRichTextBehavior(model.Schema):\n-\n     text = RichTextField(\n         title=_("Text"),\n         description="",\ndiff --git a/plone/app/contenttypes/behaviors/tableofcontents.py b/plone/app/contenttypes/behaviors/tableofcontents.py\nindex b4c7a6a5..156ae362 100644\n--- a/plone/app/contenttypes/behaviors/tableofcontents.py\n+++ b/plone/app/contenttypes/behaviors/tableofcontents.py\n@@ -10,7 +10,6 @@\n \n @provider(IFormFieldProvider)\n class ITableOfContents(model.Schema):\n-\n     model.fieldset("settings", label=_("Settings"), fields=["table_of_contents"])\n \n     table_of_contents = schema.Bool(\ndiff --git a/plone/app/contenttypes/behaviors/thumb_icon.py b/plone/app/contenttypes/behaviors/thumb_icon.py\nindex 3ef985d2..3d10d9aa 100644\n--- a/plone/app/contenttypes/behaviors/thumb_icon.py\n+++ b/plone/app/contenttypes/behaviors/thumb_icon.py\n@@ -10,7 +10,6 @@\n \n @provider(IFormFieldProvider)\n class IThumbIconHandling(model.Schema):\n-\n     model.fieldset(\n         "settings",\n         label=_("Settings"),\ndiff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py\nindex f6f00f25..9bdac03b 100644\n--- a/plone/app/contenttypes/browser/folder.py\n+++ b/plone/app/contenttypes/browser/folder.py\n@@ -21,7 +21,6 @@\n \n \n class FolderView(BrowserView):\n-\n     text_class = None\n     _plone_view = None\n     _portal_state = None\ndiff --git a/plone/app/contenttypes/browser/link_redirect_view.py b/plone/app/contenttypes/browser/link_redirect_view.py\nindex 9f15a725..d780e96a 100644\n--- a/plone/app/contenttypes/browser/link_redirect_view.py\n+++ b/plone/app/contenttypes/browser/link_redirect_view.py\n@@ -26,7 +26,6 @@\n \n \n class LinkRedirectView(BrowserView):\n-\n     index = ViewPageTemplateFile("templates/link.pt")\n \n     def _url_uses_scheme(self, schemes, url=None):\ndiff --git a/plone/app/contenttypes/browser/migration.py b/plone/app/contenttypes/browser/migration.py\nindex a6aa76e1..9597fd52 100644\n--- a/plone/app/contenttypes/browser/migration.py\n+++ b/plone/app/contenttypes/browser/migration.py\n@@ -54,7 +54,6 @@ def __call__(self, context):\n \n \n class IBaseClassMigratorForm(Interface):\n-\n     changed_base_classes = schema.List(\n         title="Changed base classes (old class, new class and number of items)",\n         description="Select changed base classes you want to migrate. "\n@@ -68,7 +67,6 @@ class IBaseClassMigratorForm(Interface):\n \n \n class BaseClassMigratorForm(form.Form):\n-\n     label = _(\n         "heading_class_migrator",\n         default="Update base-classes for content with changed classes",\ndiff --git a/plone/app/contenttypes/testing.py b/plone/app/contenttypes/testing.py\nindex 3444331f..32da14a2 100644\n--- a/plone/app/contenttypes/testing.py\n+++ b/plone/app/contenttypes/testing.py\n@@ -23,7 +23,6 @@ def set_browserlayer(request):\n \n \n class PloneAppContenttypes(PloneSandboxLayer):\n-\n     defaultBases = (\n         PAEvent_FIXTURE,\n         PLONE_FIXTURE,\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_collection.py b/plone/app/contenttypes/tests/test_behaviors_collection.py\nindex dacd057a..180ced35 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_collection.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_collection.py\n@@ -24,7 +24,6 @@\n \n \n class CollectionBehaviorFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_leadimage.py b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\nindex 06859fbc..1ac27043 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n@@ -16,7 +16,6 @@\n \n \n class LeadImageBehaviorFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_table_of_contents.py b/plone/app/contenttypes/tests/test_behaviors_table_of_contents.py\nindex ef673ef1..34a2fda5 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_table_of_contents.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_table_of_contents.py\n@@ -14,7 +14,6 @@\n \n \n class TableOfContentsBehaviorFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_browser_utils.py b/plone/app/contenttypes/tests/test_browser_utils.py\nindex b61df8dc..6e488054 100644\n--- a/plone/app/contenttypes/tests/test_browser_utils.py\n+++ b/plone/app/contenttypes/tests/test_browser_utils.py\n@@ -24,7 +24,6 @@ def __init__(self, contentType, filename):\n \n \n class MimeTypeIconIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py\nindex d52544e3..a851b008 100644\n--- a/plone/app/contenttypes/tests/test_collection.py\n+++ b/plone/app/contenttypes/tests/test_collection.py\n@@ -46,7 +46,6 @@ def dummy_image():\n \n \n class PloneAppCollectionClassTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -63,7 +62,6 @@ def test_syndicatable(self):\n \n \n class PloneAppCollectionIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -96,7 +94,6 @@ def test_adding(self):\n \n \n class PloneAppCollectionViewsIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\n@@ -378,7 +375,6 @@ def test_respect_navigation_root(self):\n \n \n class PloneAppCollectionEditViewsIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_collection_rss.py b/plone/app/contenttypes/tests/test_collection_rss.py\nindex d2abfaed..5dd017fd 100644\n--- a/plone/app/contenttypes/tests/test_collection_rss.py\n+++ b/plone/app/contenttypes/tests/test_collection_rss.py\n@@ -22,7 +22,6 @@\n \n \n class RSSViewTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_document.py b/plone/app/contenttypes/tests/test_document.py\nindex 0432d838..f609b20e 100644\n--- a/plone/app/contenttypes/tests/test_document.py\n+++ b/plone/app/contenttypes/tests/test_document.py\n@@ -21,7 +21,6 @@\n \n \n class DocumentIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -76,7 +75,6 @@ def tearDown(self):\n \n \n class DocumentFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_event.py b/plone/app/contenttypes/tests/test_event.py\nindex 36f51924..2ce96911 100644\n--- a/plone/app/contenttypes/tests/test_event.py\n+++ b/plone/app/contenttypes/tests/test_event.py\n@@ -21,7 +21,6 @@\n \n \n class EventIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -72,7 +71,6 @@ def test_view(self):\n \n \n class EventFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_file.py b/plone/app/contenttypes/tests/test_file.py\nindex 8977906b..cf26591b 100644\n--- a/plone/app/contenttypes/tests/test_file.py\n+++ b/plone/app/contenttypes/tests/test_file.py\n@@ -25,7 +25,6 @@\n \n \n class FileIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -101,7 +100,6 @@ def test_view_audio_tag(self):\n \n \n class FileFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_folder.py b/plone/app/contenttypes/tests/test_folder.py\nindex 47b17a2f..440eb6c2 100644\n--- a/plone/app/contenttypes/tests/test_folder.py\n+++ b/plone/app/contenttypes/tests/test_folder.py\n@@ -20,7 +20,6 @@\n \n \n class FolderIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -50,7 +49,6 @@ def test_adding(self):\n \n \n class FolderViewIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -119,7 +117,6 @@ def test_result_batching(self):\n \n \n class FolderFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\n@@ -162,7 +159,6 @@ def test_add_folder_with_shortname(self):\n \n \n class FolderViewFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_image.py b/plone/app/contenttypes/tests/test_image.py\nindex 396fd01c..b31a514a 100644\n--- a/plone/app/contenttypes/tests/test_image.py\n+++ b/plone/app/contenttypes/tests/test_image.py\n@@ -31,7 +31,6 @@ def dummy_image(filename="image.jpg"):\n \n \n class ImageIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -61,7 +60,6 @@ def test_adding(self):\n \n \n class ImageViewIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -109,7 +107,6 @@ def test_svg_image(self):\n \n \n class ImageFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_indexes.py b/plone/app/contenttypes/tests/test_indexes.py\nindex 3211c9cb..ff26726f 100644\n--- a/plone/app/contenttypes/tests/test_indexes.py\n+++ b/plone/app/contenttypes/tests/test_indexes.py\n@@ -12,7 +12,6 @@\n \n \n class CatalogIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_link.py b/plone/app/contenttypes/tests/test_link.py\nindex 7593f361..a7abb033 100644\n--- a/plone/app/contenttypes/tests/test_link.py\n+++ b/plone/app/contenttypes/tests/test_link.py\n@@ -30,7 +30,6 @@\n \n \n class LinkIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -60,7 +59,6 @@ def test_adding(self):\n \n \n class LinkViewIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -248,7 +246,6 @@ def _get_link_redirect_view(self, obj):\n \n \n class LinkFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\n@@ -287,7 +284,6 @@ def test_add_link(self):\n \n \n class LinkWidgetIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     default_result = {\ndiff --git a/plone/app/contenttypes/tests/test_news_item.py b/plone/app/contenttypes/tests/test_news_item.py\nindex 11e2efc4..9bab672b 100644\n--- a/plone/app/contenttypes/tests/test_news_item.py\n+++ b/plone/app/contenttypes/tests/test_news_item.py\n@@ -24,7 +24,6 @@\n \n \n class NewsItemIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -93,7 +92,6 @@ def test_leadimage_viewlet_does_not_show_up_for_newsitems(self):\n \n \n class NewsItemFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_setup.py b/plone/app/contenttypes/tests/test_setup.py\nindex dc5935df..ceab2fe3 100644\n--- a/plone/app/contenttypes/tests/test_setup.py\n+++ b/plone/app/contenttypes/tests/test_setup.py\n@@ -8,7 +8,6 @@\n \n \n class PloneAppContenttypesSetupTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2023-03-25T23:30:42+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/ee031f8d14e4cdb579523987a47d676286d45a70

chore: zpretty ZCML/XML

Files changed:
M plone/app/contenttypes/behaviors/configure.zcml
M plone/app/contenttypes/browser/configure.zcml
M plone/app/contenttypes/configure.zcml
M plone/app/contenttypes/indexers.zcml
M plone/app/contenttypes/permissions.zcml
M plone/app/contenttypes/profiles.zcml
M plone/app/contenttypes/profiles/content/metadata.xml
M plone/app/contenttypes/profiles/content/portlets.xml
M plone/app/contenttypes/profiles/default/browserlayer.xml
M plone/app/contenttypes/profiles/default/diff_tool.xml
M plone/app/contenttypes/profiles/default/metadata.xml
M plone/app/contenttypes/profiles/default/rolemap.xml
M plone/app/contenttypes/profiles/default/types.xml
M plone/app/contenttypes/profiles/default/types/Collection.xml
M plone/app/contenttypes/profiles/default/types/Document.xml
M plone/app/contenttypes/profiles/default/types/Event.xml
M plone/app/contenttypes/profiles/default/types/File.xml
M plone/app/contenttypes/profiles/default/types/Folder.xml
M plone/app/contenttypes/profiles/default/types/Image.xml
M plone/app/contenttypes/profiles/default/types/Link.xml
M plone/app/contenttypes/profiles/default/types/News_Item.xml
M plone/app/contenttypes/profiles/default/types/Plone_Site.xml
M plone/app/contenttypes/schema/collection.xml
M plone/app/contenttypes/schema/document.xml
M plone/app/contenttypes/schema/event.xml
M plone/app/contenttypes/schema/file.xml
M plone/app/contenttypes/schema/folder.xml
M plone/app/contenttypes/schema/image.xml
M plone/app/contenttypes/schema/link.xml
M plone/app/contenttypes/schema/news_item.xml
M plone/app/contenttypes/subscribers.zcml
M plone/app/contenttypes/upgrades.zcml

b'diff --git a/plone/app/contenttypes/behaviors/configure.zcml b/plone/app/contenttypes/behaviors/configure.zcml\nindex 92560d5eb..a0e836be0 100644\n--- a/plone/app/contenttypes/behaviors/configure.zcml\n+++ b/plone/app/contenttypes/behaviors/configure.zcml\n@@ -1,61 +1,65 @@\n <configure\n-  xmlns="http://namespaces.zope.org/zope"\n-  xmlns:browser="http://namespaces.zope.org/browser"\n-  xmlns:plone="http://namespaces.plone.org/plone"\n-  xmlns:zcml="http://namespaces.zope.org/zcml"\n-  i18n_domain="plone">\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n \n-  <include package="plone.behavior" file="meta.zcml"/>\n+  <include\n+      package="plone.behavior"\n+      file="meta.zcml"\n+      />\n \n   <plone:behavior\n-    name="plone.leadimage"\n-    title="Lead Image"\n-    description="Adds image and image caption fields"\n-    provides=".leadimage.ILeadImageBehavior"\n-    factory=".leadimage.LeadImage"\n-    for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".leadimage.ILeadImage"\n-    former_dotted_names="plone.app.contenttypes.behaviors.leadimage.ILeadImage"\n-    />\n+      name="plone.leadimage"\n+      title="Lead Image"\n+      description="Adds image and image caption fields"\n+      factory=".leadimage.LeadImage"\n+      provides=".leadimage.ILeadImageBehavior"\n+      for="plone.dexterity.interfaces.IDexterityContent"\n+      marker=".leadimage.ILeadImage"\n+      former_dotted_names="plone.app.contenttypes.behaviors.leadimage.ILeadImage"\n+      />\n \n   <browser:viewlet\n-    name="contentleadimage"\n-    for=".leadimage.ILeadImage"\n-    view="plone.app.layout.globals.interfaces.IViewView"\n-    class=".viewlets.LeadImageViewlet"\n-    manager="plone.app.layout.viewlets.interfaces.IAboveContentTitle"\n-    template="leadimage.pt"\n-    permission="zope2.View"\n-    />\n+      name="contentleadimage"\n+      for=".leadimage.ILeadImage"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager="plone.app.layout.viewlets.interfaces.IAboveContentTitle"\n+      class=".viewlets.LeadImageViewlet"\n+      template="leadimage.pt"\n+      permission="zope2.View"\n+      />\n \n   <plone:behavior\n-    name="plone.tableofcontents"\n-    title="Table of contents"\n-    description="Adds a table of contents"\n-    provides=".tableofcontents.ITableOfContents"\n-    marker=".tableofcontents.ITableOfContents"\n-    />\n+      name="plone.tableofcontents"\n+      title="Table of contents"\n+      description="Adds a table of contents"\n+      provides=".tableofcontents.ITableOfContents"\n+      marker=".tableofcontents.ITableOfContents"\n+      />\n \n   <plone:behavior\n-    name="plone.collection"\n-    title="Collection"\n-    description="Adds collection behavior"\n-    provides=".collection.ICollection"\n-    factory=".collection.Collection"\n-    for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".collection.ISyndicatableCollection"\n-    />\n+      name="plone.collection"\n+      title="Collection"\n+      description="Adds collection behavior"\n+      factory=".collection.Collection"\n+      provides=".collection.ICollection"\n+      for="plone.dexterity.interfaces.IDexterityContent"\n+      marker=".collection.ISyndicatableCollection"\n+      />\n \n   <plone:behavior\n-    name="plone.richtext"\n-    title="RichText"\n-    description="Adds richtext behavior"\n-    provides=".richtext.IRichTextBehavior"\n-    factory=".richtext.RichText"\n-    for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".richtext.IRichText"\n-    former_dotted_names="plone.app.contenttypes.behaviors.richtext.IRichText"\n-    />\n+      name="plone.richtext"\n+      title="RichText"\n+      description="Adds richtext behavior"\n+      factory=".richtext.RichText"\n+      provides=".richtext.IRichTextBehavior"\n+      for="plone.dexterity.interfaces.IDexterityContent"\n+      marker=".richtext.IRichText"\n+      former_dotted_names="plone.app.contenttypes.behaviors.richtext.IRichText"\n+      />\n \n   <plone:behavior\n       name="plone.thumb_icon"\n@@ -65,20 +69,23 @@\n       />\n \n   <browser:page\n-    name="getText"\n-    for=".richtext.IRichText"\n-    class=".richtext.WidgetView"\n-    permission="zope2.View"\n-    template="richtext_gettext.pt"\n-    />\n+      name="getText"\n+      for=".richtext.IRichText"\n+      class=".richtext.WidgetView"\n+      template="richtext_gettext.pt"\n+      permission="zope2.View"\n+      />\n \n   <!-- Register the plone.app.vocabularies.MetadataFields under the old\n        name for backward compatibility. -->\n   <utility\n+      name="plone.app.contenttypes.metadatafields"\n       component="plone.app.vocabularies.metadatafields.MetaDataFieldsVocabularyFactory"\n-      name="plone.app.contenttypes.metadatafields" />\n+      />\n \n-  <adapter factory=".collection.CollectionFeed"\n-           for=".collection.ISyndicatableCollection" />\n+  <adapter\n+      factory=".collection.CollectionFeed"\n+      for=".collection.ISyndicatableCollection"\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/browser/configure.zcml b/plone/app/contenttypes/browser/configure.zcml\nindex df0a68817..ae3464175 100644\n--- a/plone/app/contenttypes/browser/configure.zcml\n+++ b/plone/app/contenttypes/browser/configure.zcml\n@@ -1,9 +1,10 @@\n <configure\n-  xmlns="http://namespaces.zope.org/zope"\n-  xmlns:browser="http://namespaces.zope.org/browser"\n-  xmlns:z3c="http://namespaces.zope.org/z3c"\n-  xmlns:zcml="http://namespaces.zope.org/zcml"\n-  i18n_domain="plone">\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:z3c="http://namespaces.zope.org/z3c"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n \n   <include package="plone.app.contentmenu" />\n \n@@ -11,7 +12,8 @@\n   <browser:pages\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".folder.FolderView"\n-      permission="zope2.View">\n+      permission="zope2.View"\n+      >\n     <browser:page\n         name="listing_view"\n         template="templates/listing.pt"\n@@ -49,7 +51,8 @@\n   <browser:pages\n       for="plone.dexterity.interfaces.IDexterityContainer"\n       class=".folder.FolderView"\n-      permission="zope2.View">\n+      permission="zope2.View"\n+      >\n     <browser:page\n         name="listing_view"\n         template="templates/listing.pt"\n@@ -99,7 +102,8 @@\n   <browser:pages\n       for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"\n       class=".collection.CollectionView"\n-      permission="zope2.View">\n+      permission="zope2.View"\n+      >\n     <browser:page\n         name="listing_view"\n         template="templates/listing.pt"\n@@ -139,14 +143,14 @@\n       for="*"\n       class=".full_view.FullViewItem"\n       template="templates/full_view_item.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       />\n   <browser:page\n       name="document_view"\n       template="templates/document.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View Document"\n       />\n@@ -155,8 +159,8 @@\n       for="plone.app.contenttypes.interfaces.IFile"\n       class=".file.FileView"\n       template="templates/file.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View File"\n       />\n@@ -164,8 +168,8 @@\n       name="image_view"\n       for="plone.app.contenttypes.interfaces.IImage"\n       template="templates/image.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View Image"\n       />\n@@ -173,8 +177,8 @@\n       name="image_view_fullscreen"\n       for="plone.app.contenttypes.interfaces.IImage"\n       template="templates/image_view_fullscreen.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View Image Fullscreen"\n       />\n@@ -182,8 +186,8 @@\n       name="link_redirect_view"\n       for="plone.app.contenttypes.interfaces.ILink"\n       class=".link_redirect_view.LinkRedirectView"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View Link"\n       />\n@@ -191,8 +195,8 @@\n       name="newsitem_view"\n       for="plone.app.contenttypes.interfaces.INewsItem"\n       template="templates/newsitem.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View News Item"\n       />\n@@ -201,21 +205,22 @@\n       for="*"\n       class=".utils.Utils"\n       allowed_interface="plone.app.contenttypes.browser.utils.IUtils"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       />\n \n   <browser:page\n       name="base_class_migrator_form"\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class="plone.app.contenttypes.browser.migration.BaseClassMigrator"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="cmf.ManagePortal"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       />\n \n   <utility\n       factory="plone.app.contenttypes.browser.migration.ChangedBaseClasses"\n+      provides="zope.schema.interfaces.IVocabularyFactory"\n       name="plone.app.contenttypes.migration.changed_base_classes"\n-      provides="zope.schema.interfaces.IVocabularyFactory" />\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/configure.zcml b/plone/app/contenttypes/configure.zcml\nindex 540ce04bf..ddfd9d3d2 100644\n--- a/plone/app/contenttypes/configure.zcml\n+++ b/plone/app/contenttypes/configure.zcml\n@@ -1,17 +1,34 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:zcml="http://namespaces.zope.org/zcml"\n-           xmlns:five="http://namespaces.zope.org/five"\n-           xmlns:i18n="http://namespaces.zope.org/i18n"\n-           xmlns:gs="http://namespaces.zope.org/genericsetup"\n-           xmlns:cmf="http://namespaces.zope.org/cmf"\n-           xmlns:plone="http://namespaces.plone.org/plone"\n-           i18n_domain="plone">\n-\n-  <include package="Products.CMFCore" file="meta.zcml" />\n-  <include package="Products.GenericSetup" file="meta.zcml" />\n-  <include package="plone.behavior" file="meta.zcml"/>\n-  <include package="plone.dexterity" file="meta.zcml"/>\n-  <include package="plone.app.dexterity" file="meta.zcml"/>\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:cmf="http://namespaces.zope.org/cmf"\n+    xmlns:five="http://namespaces.zope.org/five"\n+    xmlns:gs="http://namespaces.zope.org/genericsetup"\n+    xmlns:i18n="http://namespaces.zope.org/i18n"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n+\n+  <include\n+      package="Products.CMFCore"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="Products.GenericSetup"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="plone.behavior"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="plone.dexterity"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="plone.app.dexterity"\n+      file="meta.zcml"\n+      />\n \n   <include package="plone.behavior" />\n   <include package="plone.dexterity" />\n@@ -40,7 +57,8 @@\n \n   <utility\n       factory=".setuphandlers.HiddenProfiles"\n+      provides="plone.base.interfaces.INonInstallable"\n       name="plone.app.contenttypes"\n-      provides="plone.base.interfaces.INonInstallable" />\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/indexers.zcml b/plone/app/contenttypes/indexers.zcml\nindex a48ba5128..52b15f0c9 100644\n--- a/plone/app/contenttypes/indexers.zcml\n+++ b/plone/app/contenttypes/indexers.zcml\n@@ -1,20 +1,54 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:five="http://namespaces.zope.org/five"\n-    xmlns:i18n="http://namespaces.zope.org/i18n"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    i18n_domain="plone">\n+    xmlns:i18n="http://namespaces.zope.org/i18n"\n+    i18n_domain="plone"\n+    >\n \n-  <adapter name="SearchableText" factory=".indexers.SearchableText_collection" />\n-  <adapter name="SearchableText" factory=".indexers.SearchableText_document" />\n-  <adapter name="SearchableText" factory=".indexers.SearchableText_file" />\n-  <adapter name="SearchableText" factory=".indexers.SearchableText_folder" />\n-  <adapter name="SearchableText" factory=".indexers.SearchableText_link" />\n-  <adapter name="SearchableText" factory=".indexers.SearchableText_news" />\n-  <adapter name="getRemoteUrl" factory=".indexers.getRemoteUrl" />\n-  <adapter name="getObjSize" factory=".indexers.getObjSize_image" />\n-  <adapter name="getObjSize" factory=".indexers.getObjSize_file" />\n-  <adapter name="getIcon" factory=".indexers.getIcon" />\n-  <adapter name="mime_type" factory=".indexers.mime_type" />\n+  <adapter\n+      factory=".indexers.SearchableText_collection"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.SearchableText_document"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.SearchableText_file"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.SearchableText_folder"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.SearchableText_link"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.SearchableText_news"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.getRemoteUrl"\n+      name="getRemoteUrl"\n+      />\n+  <adapter\n+      factory=".indexers.getObjSize_image"\n+      name="getObjSize"\n+      />\n+  <adapter\n+      factory=".indexers.getObjSize_file"\n+      name="getObjSize"\n+      />\n+  <adapter\n+      factory=".indexers.getIcon"\n+      name="getIcon"\n+      />\n+  <adapter\n+      factory=".indexers.mime_type"\n+      name="mime_type"\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/permissions.zcml b/plone/app/contenttypes/permissions.zcml\nindex d0ec8bbca..55da54b97 100644\n--- a/plone/app/contenttypes/permissions.zcml\n+++ b/plone/app/contenttypes/permissions.zcml\n@@ -1,42 +1,43 @@\n <configure\n-  xmlns="http://namespaces.zope.org/zope"\n-  xmlns:zcml="http://namespaces.zope.org/zcml"\n-  i18n_domain="plone">\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n \n   <configure zcml:condition="installed AccessControl.security">\n \n     <permission\n-      id="plone.app.contenttypes.addCollection"\n-      title="plone.app.contenttypes: Add Collection"\n-      />\n+        id="plone.app.contenttypes.addCollection"\n+        title="plone.app.contenttypes: Add Collection"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addDocument"\n-      title="plone.app.contenttypes: Add Document"\n-      />\n+        id="plone.app.contenttypes.addDocument"\n+        title="plone.app.contenttypes: Add Document"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addEvent"\n-      title="plone.app.contenttypes: Add Event"\n-      />\n+        id="plone.app.contenttypes.addEvent"\n+        title="plone.app.contenttypes: Add Event"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addFile"\n-      title="plone.app.contenttypes: Add File"\n-      />\n+        id="plone.app.contenttypes.addFile"\n+        title="plone.app.contenttypes: Add File"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addFolder"\n-      title="plone.app.contenttypes: Add Folder"\n-      />\n+        id="plone.app.contenttypes.addFolder"\n+        title="plone.app.contenttypes: Add Folder"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addImage"\n-      title="plone.app.contenttypes: Add Image"\n-      />\n+        id="plone.app.contenttypes.addImage"\n+        title="plone.app.contenttypes: Add Image"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addLink"\n-      title="plone.app.contenttypes: Add Link"\n-      />\n+        id="plone.app.contenttypes.addLink"\n+        title="plone.app.contenttypes: Add Link"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addNewsItem"\n-      title="plone.app.contenttypes: Add News Item"\n-      />\n+        id="plone.app.contenttypes.addNewsItem"\n+        title="plone.app.contenttypes: Add News Item"\n+        />\n \n   </configure>\n \ndiff --git a/plone/app/contenttypes/profiles.zcml b/plone/app/contenttypes/profiles.zcml\nindex 0e3bb57b0..3f44121ed 100644\n--- a/plone/app/contenttypes/profiles.zcml\n+++ b/plone/app/contenttypes/profiles.zcml\n@@ -1,25 +1,27 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:gs="http://namespaces.zope.org/genericsetup"\n-           xmlns:zcml="http://namespaces.zope.org/zcml">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:gs="http://namespaces.zope.org/genericsetup"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <!-- Default plone content (frontpage etc.), depends default -->\n   <gs:registerProfile\n-    name="plone-content"\n-    title="Content-types plus example content (plone.app.contenttypes)"\n-    directory="profiles/content"\n-    description="Plone default content-types (plone.app.contenttypes)"\n-    provides="Products.GenericSetup.interfaces.EXTENSION"\n-    post_handler=".setuphandlers.import_content"\n-    />\n+      name="plone-content"\n+      title="Content-types plus example content (plone.app.contenttypes)"\n+      description="Plone default content-types (plone.app.contenttypes)"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/content"\n+      post_handler=".setuphandlers.import_content"\n+      />\n \n   <!-- All types, no sample content. -->\n   <gs:registerProfile\n-    name="default"\n-    title="Content-types (plone.app.contenttypes)"\n-    directory="profiles/default"\n-    description="Plone default content-types (plone.app.contenttypes)"\n-    provides="Products.GenericSetup.interfaces.EXTENSION"\n-    post_handler=".setuphandlers.setup_various"\n-    />\n+      name="default"\n+      title="Content-types (plone.app.contenttypes)"\n+      description="Plone default content-types (plone.app.contenttypes)"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/default"\n+      post_handler=".setuphandlers.setup_various"\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/profiles/content/metadata.xml b/plone/app/contenttypes/profiles/content/metadata.xml\nindex f6e89970a..455626f77 100644\n--- a/plone/app/contenttypes/profiles/content/metadata.xml\n+++ b/plone/app/contenttypes/profiles/content/metadata.xml\n@@ -1,6 +1,7 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n- <version>1000</version>\n- <dependencies>\n-  <dependency>profile-plone.app.contenttypes:default</dependency>\n- </dependencies>\n+  <version>1000</version>\n+  <dependencies>\n+    <dependency>profile-plone.app.contenttypes:default</dependency>\n+  </dependencies>\n </metadata>\ndiff --git a/plone/app/contenttypes/profiles/content/portlets.xml b/plone/app/contenttypes/profiles/content/portlets.xml\nindex 55ff7809e..1fa7201da 100644\n--- a/plone/app/contenttypes/profiles/content/portlets.xml\n+++ b/plone/app/contenttypes/profiles/content/portlets.xml\n@@ -1,23 +1,21 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <portlets>\n- <!-- Assign the standard portlets -->\n- <assignment\n-     manager="plone.leftcolumn"\n-     category="context"\n-     key="/"\n-     type="portlets.Navigation"\n-     name="navigation"\n-     />\n+  <!-- Assign the standard portlets -->\n+  <assignment category="context"\n+              key="/"\n+              manager="plone.leftcolumn"\n+              name="navigation"\n+              type="portlets.Navigation"\n+  />\n \n- <assignment\n-     manager="plone.rightcolumn"\n-     category="context"\n-     key="/"\n-     type="portlets.News"\n-     name="news"\n-     />\n+  <assignment category="context"\n+              key="/"\n+              manager="plone.rightcolumn"\n+              name="news"\n+              type="portlets.News"\n+  />\n \n-<!--  <assignment\n+  <!--  <assignment\n      manager="plone.rightcolumn"\n      category="context"\n      key="/"\ndiff --git a/plone/app/contenttypes/profiles/default/browserlayer.xml b/plone/app/contenttypes/profiles/default/browserlayer.xml\nindex 6f39600f5..2643915ec 100644\n--- a/plone/app/contenttypes/profiles/default/browserlayer.xml\n+++ b/plone/app/contenttypes/profiles/default/browserlayer.xml\n@@ -1,6 +1,6 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <layers>\n-  <layer\n-    name="plone.app.contenttypes"\n-    interface="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n-    />\n-</layers>\n\\ No newline at end of file\n+  <layer interface="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n+         name="plone.app.contenttypes"\n+  />\n+</layers>\ndiff --git a/plone/app/contenttypes/profiles/default/diff_tool.xml b/plone/app/contenttypes/profiles/default/diff_tool.xml\nindex 834b9b6a1..eda2013f5 100644\n--- a/plone/app/contenttypes/profiles/default/diff_tool.xml\n+++ b/plone/app/contenttypes/profiles/default/diff_tool.xml\n@@ -1,26 +1,40 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object>\n   <difftypes>\n     <type portal_type="Document">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="Event">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="File">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="Folder">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="Image">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="Link">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="News Item">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n   </difftypes>\n-</object>\n\\ No newline at end of file\n+</object>\ndiff --git a/plone/app/contenttypes/profiles/default/metadata.xml b/plone/app/contenttypes/profiles/default/metadata.xml\nindex 245c492ad..5c9f46a8e 100644\n--- a/plone/app/contenttypes/profiles/default/metadata.xml\n+++ b/plone/app/contenttypes/profiles/default/metadata.xml\n@@ -1,11 +1,12 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n- <version>3000</version>\n- <dependencies>\n-  <dependency>profile-plone.app.dexterity:default</dependency>\n-  <dependency>profile-plone.app.event:default</dependency>\n-  <dependency>profile-plone.app.querystring:default</dependency>\n-  <dependency>profile-plone.app.relationfield:default</dependency>\n-  <dependency>profile-plone.app.versioningbehavior:default</dependency>\n-  <dependency>profile-plone.app.z3cform:default</dependency>\n- </dependencies>\n+  <version>3000</version>\n+  <dependencies>\n+    <dependency>profile-plone.app.dexterity:default</dependency>\n+    <dependency>profile-plone.app.event:default</dependency>\n+    <dependency>profile-plone.app.querystring:default</dependency>\n+    <dependency>profile-plone.app.relationfield:default</dependency>\n+    <dependency>profile-plone.app.versioningbehavior:default</dependency>\n+    <dependency>profile-plone.app.z3cform:default</dependency>\n+  </dependencies>\n </metadata>\ndiff --git a/plone/app/contenttypes/profiles/default/rolemap.xml b/plone/app/contenttypes/profiles/default/rolemap.xml\nindex 035f1b5d8..06b993da0 100644\n--- a/plone/app/contenttypes/profiles/default/rolemap.xml\n+++ b/plone/app/contenttypes/profiles/default/rolemap.xml\n@@ -1,56 +1,72 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <rolemap>\n   <roles>\n-    <role name="Manager"></role>\n+    <role name="Manager" />\n   </roles>\n   <permissions>\n-    <permission name="plone.app.contenttypes: Add Collection" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Collection"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add Document" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Document"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add Event" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Event"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add File" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add File"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add Folder" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Folder"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add Image" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Image"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add Link" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Link"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add News Item" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add News Item"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n   </permissions>\n </rolemap>\ndiff --git a/plone/app/contenttypes/profiles/default/types.xml b/plone/app/contenttypes/profiles/default/types.xml\nindex 5a4505e90..5499ce027 100644\n--- a/plone/app/contenttypes/profiles/default/types.xml\n+++ b/plone/app/contenttypes/profiles/default/types.xml\n@@ -1,35 +1,71 @@\n-<?xml version="1.0"?>\n-<object meta_type="Plone Types Tool" name="portal_types">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n \n- <!-- We remove old ATContentTypes if they exist.\n+  <!-- We remove old ATContentTypes if they exist.\n       Instances of these types can still be looked at since the\n       skin-templates in CMFPlone are there but they cannot be edited -->\n- <object name="Collection" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Document" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Event" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="File" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Folder" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Image" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Link" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="News Item" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Topic" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Collection"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Document"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Event"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="File"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Folder"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Image"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Link"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="News Item"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Topic"\n+          remove="True"\n+  />\n \n- <object meta_type="Dexterity FTI" name="Collection" />\n- <object meta_type="Dexterity FTI" name="Document" />\n- <object meta_type="Dexterity FTI" name="Folder" />\n- <object meta_type="Dexterity FTI" name="Link" />\n- <object meta_type="Dexterity FTI" name="File" />\n- <object meta_type="Dexterity FTI" name="Image" />\n- <object meta_type="Dexterity FTI" name="News Item" />\n- <object meta_type="Dexterity FTI" name="Event" />\n+  <object meta_type="Dexterity FTI"\n+          name="Collection"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Document"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Folder"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Link"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="File"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Image"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="News Item"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Event"\n+  />\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Collection.xml b/plone/app/contenttypes/profiles/default/types/Collection.xml\nindex 2f9e192b9..05c04bab9 100644\n--- a/plone/app/contenttypes/profiles/default/types/Collection.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Collection.xml\n@@ -1,22 +1,22 @@\n-<?xml version="1.0"?>\n-<object\n-    name="Collection"\n-    meta_type="Dexterity FTI"\n-    i18n:domain="plone"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Collection"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Collection</property>\n-  <property\n-     i18n:translate=""\n-      name="description"></property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Collection</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Collection</property>\n   <property name="icon_expr">string:contenttype/collection</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n   <property name="allowed_content_types" />\n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addCollection</property>\n   <property name="klass">plone.app.contenttypes.content.Collection</property>\n   <property name="model_file">plone.app.contenttypes.schema:collection.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.namefromtitle" />\n     <element value="plone.collection" />\n     <element value="plone.allowdiscussion" />\n@@ -49,54 +51,50 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="album_view"/>\n-    <element value="event_listing"/>\n-    <element value="full_view"/>\n-    <element value="listing_view"/>\n-    <element value="summary_view"/>\n-    <element value="tabular_view"/>\n+    <element value="album_view" />\n+    <element value="event_listing" />\n+    <element value="full_view" />\n+    <element value="listing_view" />\n+    <element value="summary_view" />\n+    <element value="tabular_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Document.xml b/plone/app/contenttypes/profiles/default/types/Document.xml\nindex 152c61738..76da466b6 100644\n--- a/plone/app/contenttypes/profiles/default/types/Document.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Document.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="Document"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Document"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Page</property>\n-  <property\n-      i18n:translate=""\n-      name="description"></property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Page</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Document</property>\n   <property name="icon_expr">string:contenttype/document</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addDocument</property>\n   <property name="klass">plone.app.contenttypes.content.Document</property>\n   <property name="model_file">plone.app.contenttypes.schema:document.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.namefromtitle" />\n     <element value="plone.allowdiscussion" />\n     <element value="plone.excludefromnavigation" />\n@@ -50,49 +52,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="document_view"/>\n+    <element value="document_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Event.xml b/plone/app/contenttypes/profiles/default/types/Event.xml\nindex ab761508e..7ad26a452 100644\n--- a/plone/app/contenttypes/profiles/default/types/Event.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Event.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="Event"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Event"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Event</property>\n-  <property\n-      i18n:translate=""\n-      name="description">Events can be shown in calendars.</property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Event</property>\n+  <property name="description"\n+            i18n:translate=""\n+  >Events can be shown in calendars.</property>\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Event</property>\n   <property name="icon_expr">string:contenttype/event</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addEvent</property>\n   <property name="klass">plone.app.contenttypes.content.Event</property>\n   <property name="model_file">plone.app.contenttypes.schema:event.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.textindexer" />\n     <element value="plone.eventbasic" />\n     <element value="plone.eventrecurrence" />\n@@ -55,49 +57,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="event_view"/>\n+    <element value="event_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/File.xml b/plone/app/contenttypes/profiles/default/types/File.xml\nindex 634be6c9c..a9b9211b0 100644\n--- a/plone/app/contenttypes/profiles/default/types/File.xml\n+++ b/plone/app/contenttypes/profiles/default/types/File.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="File"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="File"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">File</property>\n-  <property\n-      i18n:translate=""\n-      name="description">Lets you upload a file to the site.</property>\n+  <property name="title"\n+            i18n:translate=""\n+  >File</property>\n+  <property name="description"\n+            i18n:translate=""\n+  >Lets you upload a file to the site.</property>\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">File</property>\n   <property name="icon_expr">string:contenttype/file</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addFile</property>\n   <property name="klass">plone.app.contenttypes.content.File</property>\n   <property name="model_file">plone.app.contenttypes.schema:file.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.categorization" />\n     <element value="plone.publication" />\n     <element value="plone.ownership" />\n@@ -48,49 +50,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="file_view"/>\n+    <element value="file_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="@@display-file"\n+  <alias from="(Default)"\n+         to="@@display-file"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Folder.xml b/plone/app/contenttypes/profiles/default/types/Folder.xml\nindex 09cd76539..e42362888 100644\n--- a/plone/app/contenttypes/profiles/default/types/Folder.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Folder.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="Folder"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Folder"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Folder</property>\n-  <property\n-      i18n:translate=""\n-      name="description"></property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Folder</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Folder</property>\n   <property name="icon_expr">string:contenttype/folder</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">False</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addFolder</property>\n   <property name="klass">plone.app.contenttypes.content.Folder</property>\n   <property name="model_file">plone.app.contenttypes.schema:folder.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.dublincore" />\n     <element value="plone.namefromtitle" />\n     <element value="plone.allowdiscussion" />\n@@ -48,54 +50,50 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="album_view"/>\n-    <element value="event_listing"/>\n-    <element value="full_view"/>\n-    <element value="listing_view"/>\n-    <element value="summary_view"/>\n-    <element value="tabular_view"/>\n+    <element value="album_view" />\n+    <element value="event_listing" />\n+    <element value="full_view" />\n+    <element value="listing_view" />\n+    <element value="summary_view" />\n+    <element value="tabular_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Image.xml b/plone/app/contenttypes/profiles/default/types/Image.xml\nindex 1df16a50b..90b223c8f 100644\n--- a/plone/app/contenttypes/profiles/default/types/Image.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Image.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="Image"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Image"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Image</property>\n-  <property\n-      i18n:translate=""\n-      name="description">Images can be referenced in pages or displayed in an album.</property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Image</property>\n+  <property name="description"\n+            i18n:translate=""\n+  >Images can be referenced in pages or displayed in an album.</property>\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Image</property>\n   <property name="icon_expr">string:contenttype/image</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addImage</property>\n   <property name="klass">plone.app.contenttypes.content.Image</property>\n   <property name="model_file">plone.app.contenttypes.schema:image.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.categorization" />\n     <element value="plone.publication" />\n     <element value="plone.ownership" />\n@@ -48,49 +50,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="image_view"/>\n+    <element value="image_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="@@display-file"\n+  <alias from="(Default)"\n+         to="@@display-file"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Link.xml b/plone/app/contenttypes/profiles/default/types/Link.xml\nindex 11858f632..33fa21f45 100644\n--- a/plone/app/contenttypes/profiles/default/types/Link.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Link.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="Link"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Link"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Link</property>\n-  <property\n-      i18n:translate=""\n-      name="description"></property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Link</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Link</property>\n   <property name="icon_expr">string:contenttype/link</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addLink</property>\n   <property name="klass">plone.app.contenttypes.content.Link</property>\n   <property name="model_file">plone.app.contenttypes.schema:link.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.allowdiscussion" />\n     <element value="plone.shortname" />\n     <element value="plone.dublincore" />\n@@ -46,49 +48,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="link_redirect_view"/>\n+    <element value="link_redirect_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/News_Item.xml b/plone/app/contenttypes/profiles/default/types/News_Item.xml\nindex 30538d7dc..0ddebb6f3 100644\n--- a/plone/app/contenttypes/profiles/default/types/News_Item.xml\n+++ b/plone/app/contenttypes/profiles/default/types/News_Item.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="News Item"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="News Item"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">News Item</property>\n-  <property\n-      i18n:translate=""\n-      name="description"></property>\n+  <property name="title"\n+            i18n:translate=""\n+  >News Item</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">News Item</property>\n   <property name="icon_expr">string:contenttype/news-item</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addNewsItem</property>\n   <property name="klass">plone.app.contenttypes.content.NewsItem</property>\n   <property name="model_file">plone.app.contenttypes.schema:news_item.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.dublincore" />\n     <element value="plone.richtext" />\n     <element value="plone.namefromtitle" />\n@@ -50,49 +52,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="newsitem_view"/>\n+    <element value="newsitem_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Plone_Site.xml b/plone/app/contenttypes/profiles/default/types/Plone_Site.xml\nindex 359a432f8..14b8b7a65 100644\n--- a/plone/app/contenttypes/profiles/default/types/Plone_Site.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Plone_Site.xml\n@@ -1,8 +1,8 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    name="Plone Site"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        name="Plone Site"\n+        i18n:domain="plone"\n+>\n \n   <property name="icon_expr">string:contenttype/plone</property>\n \ndiff --git a/plone/app/contenttypes/schema/collection.xml b/plone/app/contenttypes/schema/collection.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/plone/app/contenttypes/schema/collection.xml\n+++ b/plone/app/contenttypes/schema/collection.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/plone/app/contenttypes/schema/document.xml b/plone/app/contenttypes/schema/document.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/plone/app/contenttypes/schema/document.xml\n+++ b/plone/app/contenttypes/schema/document.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/plone/app/contenttypes/schema/event.xml b/plone/app/contenttypes/schema/event.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/plone/app/contenttypes/schema/event.xml\n+++ b/plone/app/contenttypes/schema/event.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/plone/app/contenttypes/schema/file.xml b/plone/app/contenttypes/schema/file.xml\nindex 23b0727ec..59af73101 100644\n--- a/plone/app/contenttypes/schema/file.xml\n+++ b/plone/app/contenttypes/schema/file.xml\n@@ -1,20 +1,28 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema"\n-       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n        xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-       i18n:domain="plone">\n+       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n+       i18n:domain="plone"\n+>\n   <schema>\n-    <field name="title" type="zope.schema.TextLine">\n+    <field name="title"\n+           type="zope.schema.TextLine"\n+    >\n       <description />\n       <required>False</required>\n       <title i18n:translate="">Title</title>\n     </field>\n-    <field name="description" type="zope.schema.Text">\n+    <field name="description"\n+           type="zope.schema.Text"\n+    >\n       <description />\n       <required>False</required>\n       <title i18n:translate="">Description</title>\n     </field>\n-    <field name="file" type="plone.namedfile.field.NamedBlobFile"\n-        marshal:primary="true">\n+    <field marshal:primary="true"\n+           name="file"\n+           type="plone.namedfile.field.NamedBlobFile"\n+    >\n       <description />\n       <title i18n:translate="label_file">File</title>\n     </field>\ndiff --git a/plone/app/contenttypes/schema/folder.xml b/plone/app/contenttypes/schema/folder.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/plone/app/contenttypes/schema/folder.xml\n+++ b/plone/app/contenttypes/schema/folder.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/plone/app/contenttypes/schema/image.xml b/plone/app/contenttypes/schema/image.xml\nindex 63c24e427..05c459720 100644\n--- a/plone/app/contenttypes/schema/image.xml\n+++ b/plone/app/contenttypes/schema/image.xml\n@@ -1,20 +1,28 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema"\n-       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n        xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-       i18n:domain="plone">\n+       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n+       i18n:domain="plone"\n+>\n   <schema>\n-    <field name="title" type="zope.schema.TextLine">\n+    <field name="title"\n+           type="zope.schema.TextLine"\n+    >\n       <description />\n       <required>False</required>\n       <title i18n:translate="">Title</title>\n     </field>\n-    <field name="description" type="zope.schema.Text">\n+    <field name="description"\n+           type="zope.schema.Text"\n+    >\n       <description />\n       <required>False</required>\n       <title i18n:translate="">Description</title>\n     </field>\n-    <field name="image" type="plone.namedfile.field.NamedBlobImage"\n-        marshal:primary="true">\n+    <field marshal:primary="true"\n+           name="image"\n+           type="plone.namedfile.field.NamedBlobImage"\n+    >\n       <description />\n       <title i18n:translate="label_image">Image</title>\n     </field>\ndiff --git a/plone/app/contenttypes/schema/link.xml b/plone/app/contenttypes/schema/link.xml\nindex 3698f9164..972c389f6 100644\n--- a/plone/app/contenttypes/schema/link.xml\n+++ b/plone/app/contenttypes/schema/link.xml\n@@ -1,13 +1,18 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema"\n        xmlns:form="http://namespaces.plone.org/supermodel/form"\n-       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n        xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-       i18n:domain="plone">\n-    <schema>\n-      <field name="remoteUrl" type="zope.schema.TextLine" form:widget="plone.app.z3cform.widget.LinkFieldWidget">\n-        <description i18n:translate="description_linktype_url">The link is used almost verbatim, relative links become absolute and the strings "${navigation_root_url}" and "${portal_url}" get replaced with the real navigation_root_url or portal_url. If in doubt which one to use, please use navigation_root_url.\n+       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n+       i18n:domain="plone"\n+>\n+  <schema>\n+    <field form:widget="plone.app.z3cform.widget.LinkFieldWidget"\n+           name="remoteUrl"\n+           type="zope.schema.TextLine"\n+    >\n+      <description i18n:translate="description_linktype_url">The link is used almost verbatim, relative links become absolute and the strings "${navigation_root_url}" and "${portal_url}" get replaced with the real navigation_root_url or portal_url. If in doubt which one to use, please use navigation_root_url.\n         </description>\n-        <title i18n:translate="">URL</title>\n-      </field>\n-    </schema>\n+      <title i18n:translate="">URL</title>\n+    </field>\n+  </schema>\n </model>\ndiff --git a/plone/app/contenttypes/schema/news_item.xml b/plone/app/contenttypes/schema/news_item.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/plone/app/contenttypes/schema/news_item.xml\n+++ b/plone/app/contenttypes/schema/news_item.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/plone/app/contenttypes/subscribers.zcml b/plone/app/contenttypes/subscribers.zcml\nindex efe96d4ca..a929cc35f 100644\n--- a/plone/app/contenttypes/subscribers.zcml\n+++ b/plone/app/contenttypes/subscribers.zcml\n@@ -1,15 +1,15 @@\n <configure xmlns="http://namespaces.zope.org/zope">\n \n   <subscriber\n-    for=".interfaces.IFile\n-         zope.lifecycleevent.interfaces.IObjectCreatedEvent"\n-    handler=".subscribers.set_title_description"\n-  />\n+      for=".interfaces.IFile\n+           zope.lifecycleevent.interfaces.IObjectCreatedEvent"\n+      handler=".subscribers.set_title_description"\n+      />\n \n   <subscriber\n-    for=".interfaces.IImage\n-         zope.lifecycleevent.interfaces.IObjectCreatedEvent"\n-    handler=".subscribers.set_title_description"\n-  />\n+      for=".interfaces.IImage\n+           zope.lifecycleevent.interfaces.IObjectCreatedEvent"\n+      handler=".subscribers.set_title_description"\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/upgrades.zcml b/plone/app/contenttypes/upgrades.zcml\nindex 13cba2537..9ecfe4be8 100644\n--- a/plone/app/contenttypes/upgrades.zcml\n+++ b/plone/app/contenttypes/upgrades.zcml\n@@ -1,13 +1,15 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <genericsetup:upgradeStep\n+      title="Update Type icons"\n+      profile="plone.app.contenttypes:default"\n       source="*"\n       destination="3000"\n-      profile="plone.app.contenttypes:default"\n-      title="Update Type icons"\n-      handler=".upgrades.update_type_icons" />\n+      handler=".upgrades.update_type_icons"\n+      />\n \n </configure>\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2023-03-25T23:30:42+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/154f7f7510fadc5c5932c67fce573d1d25268e6d

chore: zpretty PT

Files changed:
M plone/app/contenttypes/behaviors/leadimage.pt
M plone/app/contenttypes/behaviors/richtext_gettext.pt
M plone/app/contenttypes/browser/templates/document.pt
M plone/app/contenttypes/browser/templates/file.pt
M plone/app/contenttypes/browser/templates/full_view.pt
M plone/app/contenttypes/browser/templates/full_view_item.pt
M plone/app/contenttypes/browser/templates/image.pt
M plone/app/contenttypes/browser/templates/image_view_fullscreen.pt
M plone/app/contenttypes/browser/templates/link.pt
M plone/app/contenttypes/browser/templates/listing.pt
M plone/app/contenttypes/browser/templates/listing_album.pt
M plone/app/contenttypes/browser/templates/listing_summary.pt
M plone/app/contenttypes/browser/templates/listing_tabular.pt
M plone/app/contenttypes/browser/templates/newsitem.pt

b'diff --git a/plone/app/contenttypes/behaviors/leadimage.pt b/plone/app/contenttypes/behaviors/leadimage.pt\nindex 6becd24c..c6ec0bf5 100644\n--- a/plone/app/contenttypes/behaviors/leadimage.pt\n+++ b/plone/app/contenttypes/behaviors/leadimage.pt\n@@ -1,9 +1,17 @@\n <section id="section-leadimage"\n-         tal:condition="view/available">\n-  <figure class="newsImageContainer" tal:define="images context/@@images">\n-      <img tal:replace="structure python: images.tag(\'image\', scale=\'large\', css_class=\'figure-img img-fluid\')" />\n-      <figcaption class="figure-caption" tal:condition="python: getattr(context, \'image_caption\', None)" tal:content="python: context.image_caption">\n+         tal:condition="view/available"\n+>\n+  <figure class="newsImageContainer"\n+          tal:define="\n+            images context/@@images;\n+          "\n+  >\n+    <img tal:replace="structure python: images.tag(\'image\', scale=\'large\', css_class=\'figure-img img-fluid\')" />\n+    <figcaption class="figure-caption"\n+                tal:condition="python: getattr(context, \'image_caption\', None)"\n+                tal:content="python: context.image_caption"\n+    >\n         Image caption\n-      </figcaption>\n+    </figcaption>\n   </figure>\n </section>\ndiff --git a/plone/app/contenttypes/behaviors/richtext_gettext.pt b/plone/app/contenttypes/behaviors/richtext_gettext.pt\nindex 2cfe2736..666cbd9e 100644\n--- a/plone/app/contenttypes/behaviors/richtext_gettext.pt\n+++ b/plone/app/contenttypes/behaviors/richtext_gettext.pt\n@@ -1 +1 @@\n-<div tal:replace="structure view/++widget++text/render" />\n\\ No newline at end of file\n+<div tal:replace="structure view/++widget++text/render"></div>\ndiff --git a/plone/app/contenttypes/browser/templates/document.pt b/plone/app/contenttypes/browser/templates/document.pt\nindex 93c1f19b..5e4da56a 100644\n--- a/plone/app/contenttypes/browser/templates/document.pt\n+++ b/plone/app/contenttypes/browser/templates/document.pt\n@@ -1,26 +1,33 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:content-core define-macro="content-core"\n-                    tal:define="toc python:  getattr(context, \'table_of_contents\', False);">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:content-core define-macro="content-core"\n+                          tal:define="\n+                            toc python:  getattr(context, \'table_of_contents\', False);\n+                          "\n+      >\n \n-  <section id="section-text">\n-    <div id="parent-fieldname-text" class="${python: toc and \'pat-autotoc\' or \'\'}"\n-         tal:condition="python:getattr(context, \'text\', None)"\n-         tal:content="structure python:context.text.output_relative_to(view.context)">\n+        <section id="section-text">\n+          <div class="${python: toc and \'pat-autotoc\' or \'\'}"\n+               id="parent-fieldname-text"\n+               tal:condition="python:getattr(context, \'text\', None)"\n+               tal:content="structure python:context.text.output_relative_to(view.context)"\n+          >\n       Text\n-    </div>\n-  </section>\n+          </div>\n+        </section>\n \n-</metal:content-core>\n-</metal:content-core>\n+      </metal:content-core>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/file.pt b/plone/app/contenttypes/browser/templates/file.pt\nindex ce81f8be..845af29c 100644\n--- a/plone/app/contenttypes/browser/templates/file.pt\n+++ b/plone/app/contenttypes/browser/templates/file.pt\n@@ -1,60 +1,89 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core"\n-             tal:define="content_type python: context.file.contentType;\n-                         filename python: context.file.filename;\n-                         mimetype_icon python: \'mimetype-\' + content_type;\n-                         download_url python: \'{}/@@download/file/{}\'.format(context.absolute_url(), filename)">\n-\n-  <section class="section section-main">\n-\n-    <div tal:condition="python: not view.is_videotype() and not view.is_audiotype()">\n-      <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-    </div>\n-\n-    <video class="w-100 mb-3" controls="controls" tal:condition="python: view.is_videotype()">\n-      <source src="${python:download_url}" type="${python:content_type}"></source>\n-      <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-      <div i18n:translate="embedded_video_not_supported" class="small text-muted">Sorry, your browser doesn\'t support embedded videos.</div>\n-    </video>\n-\n-    <audio class="w-100 mb-3" controls="controls" tal:condition="python:view.is_audiotype()">\n-      <source tal:attributes="src python: download_url; type python: content_type"></source>\n-      <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-      <div i18n:translate="embedded_audio_not_supported" class="small text-muted">Sorry, your browser doesn\'t support embedded audio.</div>\n-    </audio>\n-\n-    <div class="h5 mb-2">\n-      <a href="${python:download_url}" tal:content="python: filename">Filename</a>\n-    </div>\n-\n-    <div class="metadata d-flex justify-content-center text-muted small">\n-      <div class="px-2">\n-        <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n-        <span tal:replace="python: content_type">image/jpeg</span>\n-      </div>\n-      <div class="px-2">\n-        <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n-        <span tal:define="size python: view.human_readable_size()" tal:content="python: size">1000 kB</span>\n-      </div>\n-    </div>\n-\n-  </section>\n-\n-  <section class="section section-actions">\n-    <a class="btn btn-primary download" href="${python:download_url}" i18n:translate="">Download</a>\n-  </section>\n-\n-</metal:block>\n-</metal:content-core>\n-\n-</body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core"\n+                   tal:define="\n+                     content_type python: context.file.contentType;\n+                     filename python: context.file.filename;\n+                     mimetype_icon python: \'mimetype-\' + content_type;\n+                     download_url python: \'{}/@@download/file/{}\'.format(context.absolute_url(), filename);\n+                   "\n+      >\n+\n+        <section class="section section-main">\n+\n+          <div tal:condition="python: not view.is_videotype() and not view.is_audiotype()">\n+            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+          </div>\n+\n+          <video class="w-100 mb-3"\n+                 controls="controls"\n+                 tal:condition="python: view.is_videotype()"\n+          >\n+            <source src="${python:download_url}"\n+                    type="${python:content_type}"\n+            />\n+            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+            <div class="small text-muted"\n+                 i18n:translate="embedded_video_not_supported"\n+            >Sorry, your browser doesn\'t support embedded videos.</div>\n+          </video>\n+\n+          <audio class="w-100 mb-3"\n+                 controls="controls"\n+                 tal:condition="python:view.is_audiotype()"\n+          >\n+            <source tal:attributes="\n+                      src python: download_url;\n+                      type python: content_type;\n+                    " />\n+            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+            <div class="small text-muted"\n+                 i18n:translate="embedded_audio_not_supported"\n+            >Sorry, your browser doesn\'t support embedded audio.</div>\n+          </audio>\n+\n+          <div class="h5 mb-2">\n+            <a href="${python:download_url}"\n+               tal:content="python: filename"\n+            >Filename</a>\n+          </div>\n+\n+          <div class="metadata d-flex justify-content-center text-muted small">\n+            <div class="px-2">\n+              <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n+              <span tal:replace="python: content_type">image/jpeg</span>\n+            </div>\n+            <div class="px-2">\n+              <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n+              <span tal:define="\n+                      size python: view.human_readable_size();\n+                    "\n+                    tal:content="python: size"\n+              >1000 kB</span>\n+            </div>\n+          </div>\n+\n+        </section>\n+\n+        <section class="section section-actions">\n+          <a class="btn btn-primary download"\n+             href="${python:download_url}"\n+             i18n:translate=""\n+          >Download</a>\n+        </section>\n+\n+      </metal:block>\n+    </metal:content-core>\n+\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/full_view.pt b/plone/app/contenttypes/browser/templates/full_view.pt\nindex 898e2c9a..dee5d811 100644\n--- a/plone/app/contenttypes/browser/templates/full_view.pt\n+++ b/plone/app/contenttypes/browser/templates/full_view.pt\n@@ -1,31 +1,43 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core" tal:define="uuid context/@@uuid | nothing">\n-\n-  <metal:listing use-macro="context/@@listing_view/macros/content-core">\n-    <metal:entries fill-slot="entries">\n-\n-      <metal:block use-macro="context/@@listing_view/macros/entries">\n-\n-        <metal:entry fill-slot="entry" tal:condition="python: item.UID != uuid">\n-          <div tal:define="obj item/getObject;" tal:replace="structure obj/@@full_view_item | nothing" />\n-        </metal:entry>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core"\n+                   tal:define="\n+                     uuid context/@@uuid | nothing;\n+                   "\n+      >\n+\n+        <metal:listing use-macro="context/@@listing_view/macros/content-core">\n+          <metal:entries fill-slot="entries">\n+\n+            <metal:block use-macro="context/@@listing_view/macros/entries">\n+\n+              <metal:entry fill-slot="entry"\n+                           tal:condition="python: item.UID != uuid"\n+              >\n+                <div tal:define="\n+                       obj item/getObject;\n+                     "\n+                     tal:replace="structure obj/@@full_view_item | nothing"\n+                ></div>\n+              </metal:entry>\n+\n+            </metal:block>\n+\n+          </metal:entries>\n+        </metal:listing>\n \n       </metal:block>\n+    </metal:content-core>\n \n-    </metal:entries>\n-  </metal:listing>\n-\n-</metal:block>\n-</metal:content-core>\n-\n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/full_view_item.pt b/plone/app/contenttypes/browser/templates/full_view_item.pt\nindex 0f656564..208207d2 100644\n--- a/plone/app/contenttypes/browser/templates/full_view_item.pt\n+++ b/plone/app/contenttypes/browser/templates/full_view_item.pt\n@@ -1,67 +1,91 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    i18n:domain="plone"\n-    tal:omit-tag="">\n-<body tal:omit-tag="">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      xml:lang="en"\n+      tal:omit-tag=""\n+      i18n:domain="plone"\n+>\n+  <body tal:omit-tag="">\n \n-  <div class="item"\n-       tal:define="item_macro nocall:view/item_macros/content-core|nothing;\n-                   item_url view/item_url;\n-                   rendering_error python:[];">\n+    <div class="item"\n+         tal:define="\n+           item_macro nocall:view/item_macros/content-core|nothing;\n+           item_url view/item_url;\n+           rendering_error python:[];\n+         "\n+    >\n \n-    <div tal:replace="structure provider:plone.abovecontenttitle" />\n+      <div tal:replace="structure provider:plone.abovecontenttitle"></div>\n \n-    <h1>\n-      <a class="summary url" tal:content="context/Title" tal:attributes="href item_url;">\n+      <h1>\n+        <a class="summary url"\n+           tal:content="context/Title"\n+           tal:attributes="\n+             href item_url;\n+           "\n+        >\n         Title\n-      </a>\n-    </h1>\n+        </a>\n+      </h1>\n \n-    <div tal:replace="structure provider:plone.belowcontenttitle" />\n+      <div tal:replace="structure provider:plone.belowcontenttitle"></div>\n \n-    <p class="lead" tal:content="context/Description" tal:condition="context/Description">\n+      <p class="lead"\n+         tal:condition="context/Description"\n+         tal:content="context/Description"\n+      >\n       Description\n-    </p>\n+      </p>\n \n-    <section id="section-item" class="mb-5" tal:condition="item_macro">\n+      <section class="mb-5"\n+               id="section-item"\n+               tal:condition="item_macro"\n+      >\n \n-      <div tal:replace="structure provider:plone.abovecontentbody" />\n+        <div tal:replace="structure provider:plone.abovecontentbody"></div>\n \n-      <div tal:define="view nocall:view/default_view;\n-                       plone_view context/@@plone;\n-                       icons python:context.restrictedTraverse(\'@@iconresolver\');\n-                       portal_state context/@@plone_portal_state;\n-                       context_state context/@@plone_context_state;\n-                       plone_layout context/@@plone_layout;\n-                       lang portal_state/language;\n-                       dummy python: plone_layout.mark_view(view);\n-                       portal_url portal_state/portal_url;\n-                       checkPermission nocall: context/portal_membership/checkPermission;\n-                       site_properties context/portal_properties/site_properties;">\n+        <div tal:define="\n+               view nocall:view/default_view;\n+               plone_view context/@@plone;\n+               icons python:context.restrictedTraverse(\'@@iconresolver\');\n+               portal_state context/@@plone_portal_state;\n+               context_state context/@@plone_context_state;\n+               plone_layout context/@@plone_layout;\n+               lang portal_state/language;\n+               dummy python: plone_layout.mark_view(view);\n+               portal_url portal_state/portal_url;\n+               checkPermission nocall: context/portal_membership/checkPermission;\n+               site_properties context/portal_properties/site_properties;\n+             ">\n \n-        <div metal:use-macro="item_macro">\n+          <div metal:use-macro="item_macro">\n           content\n-        </div>\n+          </div>\n \n-      </div>\n+        </div>\n \n-      <div tal:replace="structure provider:plone.belowcontentbody" />\n+        <div tal:replace="structure provider:plone.belowcontentbody"></div>\n \n-    </section>\n+      </section>\n \n-    <tal:block tal:condition="rendering_error">\n-      <!-- Error rendering item macro -->\n-    </tal:block>\n+      <tal:block tal:condition="rendering_error">\n+        <!-- Error rendering item macro -->\n+      </tal:block>\n \n-    <p class="more" tal:condition="python:not(item_macro) or rendering_error">\n-      <a tal:attributes="href item_url" i18n:translate="read_more">\n+      <p class="more"\n+         tal:condition="python:not(item_macro) or rendering_error"\n+      >\n+        <a tal:attributes="\n+             href item_url;\n+           "\n+           i18n:translate="read_more"\n+        >\n         Read More&hellip;\n-      </a>\n-    </p>\n+        </a>\n+      </p>\n \n-  </div>\n-</body>\n+    </div>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/image.pt b/plone/app/contenttypes/browser/templates/image.pt\nindex 2a4459a9..b2f4d397 100644\n--- a/plone/app/contenttypes/browser/templates/image.pt\n+++ b/plone/app/contenttypes/browser/templates/image.pt\n@@ -1,65 +1,88 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core"\n-             tal:define="content_type python: context.image.contentType;\n-                         size context/image/getSize;\n-                         image_dimension context/image/getImageSize;\n-                         use_MB python: size > 1024*1024;\n-                         dimension python: str(image_dimension[0])+\'x\'+str(image_dimension[1]);\n-                         filename python: context.image.filename;\n-                         mimetype_icon python: \'mimetype-\' + content_type;\n-                         download_url python: \'{}/@@download/image/{}\'.format(context.absolute_url(), filename)\n-                                                     ">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core"\n+                   tal:define="\n+                     content_type python: context.image.contentType;\n+                     size context/image/getSize;\n+                     image_dimension context/image/getImageSize;\n+                     use_MB python: size &gt; 1024*1024;\n+                     dimension python: str(image_dimension[0])+\'x\'+str(image_dimension[1]);\n+                     filename python: context.image.filename;\n+                     mimetype_icon python: \'mimetype-\' + content_type;\n+                     download_url python: \'{}/@@download/image/{}\'.format(context.absolute_url(), filename);\n+                   "\n+      >\n \n-  <section class="section section-main">\n-    <figure class="figure">\n-      <a tal:attributes="href string:${context/@@plone_context_state/object_url}/image_view_fullscreen"\n-         tal:define="scale context/@@images; img_tag python:scale.tag(\'image\', scale=\'large\', css_class=\'figure-img img-fluid\')"\n-         tal:on-error="string: Image cannot be displayed">\n-        <img tal:replace="structure img_tag" />\n-      </a>\n-    </figure>\n+        <section class="section section-main">\n+          <figure class="figure">\n+            <a tal:define="\n+                 scale context/@@images;\n+                 img_tag python:scale.tag(\'image\', scale=\'large\', css_class=\'figure-img img-fluid\');\n+               "\n+               tal:attributes="\n+                 href string:${context/@@plone_context_state/object_url}/image_view_fullscreen;\n+               "\n+               tal:on-error="string: Image cannot be displayed"\n+            >\n+              <img tal:replace="structure img_tag" />\n+            </a>\n+          </figure>\n \n-    <div class="h5 mb-2">\n-      <a href="${python:download_url}" tal:content="python: filename">Filename</a>\n-    </div>\n-    <div class="metadata d-flex justify-content-center text-muted small">\n-      <div class="px-2">\n-        <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n-        <span i18n:translate="image_kind_label" class="d-none">Type</span>\n-        <span tal:replace="python: content_type">image/jpeg</span>\n-      </div>\n-      <div class="px-2">\n-        <tal:icon tal:replace="structure python:icons.tag(\'aspect-ratio\', tag_class=\'icon-inline\', tag_alt=\'Dimension\')" />\n-        <span i18n:translate="image_dimension_label" class="d-none">Dimension</span>\n-        <span tal:replace="python: dimension">400x300</span>\n-      </div>\n-      <div class="px-2">\n-        <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n-        <span i18n:translate="image_size_label" class="d-none">File size</span>\n-        <tal:MB condition="use_MB">${python:round(size/1024/1024, 1)} MB</tal:MB>\n-        <tal:KB condition="not: use_MB">${python:round(size/1024, 1)} KB</tal:KB>\n-      </div>\n-    </div>\n+          <div class="h5 mb-2">\n+            <a href="${python:download_url}"\n+               tal:content="python: filename"\n+            >Filename</a>\n+          </div>\n+          <div class="metadata d-flex justify-content-center text-muted small">\n+            <div class="px-2">\n+              <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n+              <span class="d-none"\n+                    i18n:translate="image_kind_label"\n+              >Type</span>\n+              <span tal:replace="python: content_type">image/jpeg</span>\n+            </div>\n+            <div class="px-2">\n+              <tal:icon tal:replace="structure python:icons.tag(\'aspect-ratio\', tag_class=\'icon-inline\', tag_alt=\'Dimension\')" />\n+              <span class="d-none"\n+                    i18n:translate="image_dimension_label"\n+              >Dimension</span>\n+              <span tal:replace="python: dimension">400x300</span>\n+            </div>\n+            <div class="px-2">\n+              <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n+              <span class="d-none"\n+                    i18n:translate="image_size_label"\n+              >File size</span>\n+              <tal:mb condition="use_MB">${python:round(size/1024/1024, 1)} MB</tal:mb>\n+              <tal:kb condition="not: use_MB">${python:round(size/1024, 1)} KB</tal:kb>\n+            </div>\n+          </div>\n \n-  </section>\n+        </section>\n \n-  <section class="section section-actions">\n-    <a class="btn btn-primary download" href="${python:download_url}" i18n:translate="">Download</a>\n-    <a class="btn btn-primary fullscreen" href="${context/@@plone_context_state/object_url}/image_view_fullscreen"><span i18n:translate="label_click_to_view_full_image">View full-size image</span></a>\n-  </section>\n+        <section class="section section-actions">\n+          <a class="btn btn-primary download"\n+             href="${python:download_url}"\n+             i18n:translate=""\n+          >Download</a>\n+          <a class="btn btn-primary fullscreen"\n+             href="${context/@@plone_context_state/object_url}/image_view_fullscreen"\n+          ><span i18n:translate="label_click_to_view_full_image">View full-size image</span></a>\n+        </section>\n \n \n-</metal:block>\n-</metal:content-core>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/image_view_fullscreen.pt b/plone/app/contenttypes/browser/templates/image_view_fullscreen.pt\nindex 6f72ad1b..828d0ad9 100644\n--- a/plone/app/contenttypes/browser/templates/image_view_fullscreen.pt\n+++ b/plone/app/contenttypes/browser/templates/image_view_fullscreen.pt\n@@ -1,15 +1,23 @@\n <!DOCTYPE html>\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    i18n:domain="plone">\n-<head>\n-  <metal:block tal:define="dummy python:request.RESPONSE.setHeader(\'Content-Type\', \'text/html;;charset=utf-8\')" />\n-  <meta name="viewport" content="width=device-width, initial-scale=1">\n-  <title tal:content="context/Title">Title</title>\n-  <style type="text/css" media="screen">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <head>\n+    <metal:block tal:define="\n+                   dummy python:request.RESPONSE.setHeader(\'Content-Type\', \'text/html;;charset=utf-8\');\n+                 " />\n+    <meta name="viewport"\n+          content="width=device-width, initial-scale=1"\n+    />\n+    <title tal:content="context/Title">Title</title>\n+    <style media="screen"\n+           type="text/css"\n+    >\n \n     body {\n       font-family: Helvetica, Arial, sans-serif;\n@@ -42,24 +50,36 @@\n       height: auto;\n     }\n \n-  </style>\n-</head>\n+    </style>\n+  </head>\n \n-<body>\n-  <div id="content-core" tal:condition="context/@@images">\n-    <tal:block define="referer request/HTTP_REFERER;\n-                       url_tool nocall:context/portal_url;\n-                       referer python:referer if referer and url_tool.isURLInPortal(referer) else \'\';">\n-    <a tal:attributes="href referer" tal:condition="referer">\n-      <tal:block replace="structure context/@@images/image" />\n-      <span i18n:translate="label_back_to_site">Back to site</span>\n-    </a>\n-    <a tal:attributes="href python:url_tool()" tal:condition="not: referer">\n-      <tal:block replace="structure context/@@images/image" />\n-      <span i18n:translate="label_home">Home</span>\n-    </a>\n-  </tal:block>\n-  </div>\n-</body>\n+  <body>\n+    <div id="content-core"\n+         tal:condition="context/@@images"\n+    >\n+      <tal:block define="\n+                   referer request/HTTP_REFERER;\n+                   url_tool nocall:context/portal_url;\n+                   referer python:referer if referer and url_tool.isURLInPortal(referer) else \'\';\n+                 ">\n+        <a tal:condition="referer"\n+           tal:attributes="\n+             href referer;\n+           "\n+        >\n+          <tal:block replace="structure context/@@images/image" />\n+          <span i18n:translate="label_back_to_site">Back to site</span>\n+        </a>\n+        <a tal:condition="not: referer"\n+           tal:attributes="\n+             href python:url_tool();\n+           "\n+        >\n+          <tal:block replace="structure context/@@images/image" />\n+          <span i18n:translate="label_home">Home</span>\n+        </a>\n+      </tal:block>\n+    </div>\n+  </body>\n \n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/link.pt b/plone/app/contenttypes/browser/templates/link.pt\nindex 36f3a132..f6ff2d31 100644\n--- a/plone/app/contenttypes/browser/templates/link.pt\n+++ b/plone/app/contenttypes/browser/templates/link.pt\n@@ -1,51 +1,69 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core"\n-             tal:define="external python:view.url().startswith(\'http\');\n-                         mail python:view.url().startswith(\'mailto\');\n-                         link python: not external and not mail;\n-                         display_link python: view.display_link()">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core"\n+                   tal:define="\n+                     external python:view.url().startswith(\'http\');\n+                     mail python:view.url().startswith(\'mailto\');\n+                     link python: not external and not mail;\n+                     display_link python: view.display_link();\n+                   "\n+      >\n \n \n-  <section class="section section-main">\n-    <div>\n-      <tal:icon tal:condition="link"\n-        tal:replace="structure python:icons.tag(\'plone-link\', tag_class=\'icon-x4 mb-2\')" />\n-      <tal:icon tal:condition="external"\n-        tal:replace="structure python:icons.tag(\'plone-link/external\', tag_class=\'icon-x4 mb-2\')" />\n-      <tal:icon tal:condition="mail"\n-        tal:replace="structure python:icons.tag(\'plone-link/mail\', tag_class=\'icon-x4 mb-2\')" />\n-    </div>\n-    <div class="h5 mb-2">\n-      <a href="" tal:attributes="href python: view.absolute_target_url()" \n-         tal:content="python: display_link[\'title\']">remote url</a>\n-    </div>\n-    <div class="metadata d-flex justify-content-center text-muted small"\n-        tal:condition="python: display_link[\'meta\']">\n-      <div tal:replace="python: display_link[\'meta\']"></div>\n-    </div>\n+        <section class="section section-main">\n+          <div>\n+            <tal:icon tal:condition="link"\n+                      tal:replace="structure python:icons.tag(\'plone-link\', tag_class=\'icon-x4 mb-2\')"\n+            />\n+            <tal:icon tal:condition="external"\n+                      tal:replace="structure python:icons.tag(\'plone-link/external\', tag_class=\'icon-x4 mb-2\')"\n+            />\n+            <tal:icon tal:condition="mail"\n+                      tal:replace="structure python:icons.tag(\'plone-link/mail\', tag_class=\'icon-x4 mb-2\')"\n+            />\n+          </div>\n+          <div class="h5 mb-2">\n+            <a href=""\n+               tal:content="python: display_link[\'title\']"\n+               tal:attributes="\n+                 href python: view.absolute_target_url();\n+               "\n+            >remote url</a>\n+          </div>\n+          <div class="metadata d-flex justify-content-center text-muted small"\n+               tal:condition="python: display_link[\'meta\']"\n+          >\n+            <div tal:replace="python: display_link[\'meta\']"></div>\n+          </div>\n \n-    <div class="info-redirect small text-muted mt-4" \n-      tal:define="redirect_links python:context.portal_registry[\'plone.redirect_links\']" \n-      tal:condition="python: redirect_links and checkPermission(\'Modify portal content\', context)">\n-      <span tal:omit-tag="" i18n:translate="message_permissions_blocking_link_redirect">\n+          <div class="info-redirect small text-muted mt-4"\n+               tal:define="\n+                 redirect_links python:context.portal_registry[\'plone.redirect_links\'];\n+               "\n+               tal:condition="python: redirect_links and checkPermission(\'Modify portal content\', context)"\n+          >\n+            <span tal:omit-tag=""\n+                  i18n:translate="message_permissions_blocking_link_redirect"\n+            >\n         You see this page because you have permission to edit this link.\n         Others will be immediately redirected to the link\'s target URL.\n-      </span>\n-    </div>\n+            </span>\n+          </div>\n \n-  </section>\n+        </section>\n \n-</metal:block>\n-</metal:content-core>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/listing.pt b/plone/app/contenttypes/browser/templates/listing.pt\nindex c2088d37..9e2d7553 100644\n--- a/plone/app/contenttypes/browser/templates/listing.pt\n+++ b/plone/app/contenttypes/browser/templates/listing.pt\n@@ -1,148 +1,194 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core">\n-\n-  <div metal:define-macro="text-field-view"\n-      id="parent-fieldname-text" class="stx"\n-      tal:define="text python:view.text"\n-      tal:condition="python:text"\n-      tal:attributes="class python:view.text_class">\n-    <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n-  </div>\n-\n-\n-  <metal:listingmacro define-macro="listing">\n-    <tal:results define="batch python:view.batch();\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core">\n+\n+        <div class="stx"\n+             id="parent-fieldname-text"\n+             metal:define-macro="text-field-view"\n+             tal:define="\n+               text python:view.text;\n+             "\n+             tal:condition="python:text"\n+             tal:attributes="\n+               class python:view.text_class;\n+             "\n+        >\n+          <div metal:define-slot="inside"\n+               tal:replace="structure text"\n+          >The body</div>\n+        </div>\n+\n+\n+        <metal:listingmacro define-macro="listing">\n+          <tal:results define="\n+                         batch python:view.batch();\n                          thumb_scale_list python:view.get_thumb_scale_list();\n                          thumb_scale_table python:view.get_thumb_scale_table();\n                          thumb_scale_summary python:view.get_thumb_scale_summary();\n                          img_class python:\'thumb-{} image-responsive\'.format(thumb_scale_list);\n-                         showicons python:view.show_icons()">\n-      <tal:listing condition="python:batch">\n-        <div class="entries" metal:define-slot="entries"\n-            tal:define="portal python:portal_state.portal();\n-                        image_scale portal/@@image_scale">\n-\n-          <tal:repeat repeat="item python:batch" metal:define-macro="entries">\n-            <tal:block tal:define="obj python:item.getObject();\n-                item_url python:item.getURL();\n-                item_id python:item.getId();\n-                item_title python:item.Title();\n-                item_title python:item_title or item_id;\n-                item_description python:item.Description();\n-                item_type python:item.PortalType();\n-                item_modified python:item.ModificationDate();\n-                item_created python:item.CreationDate();\n-                item_wf_state python:item.review_state();\n-                item_wf_state_class python:\'state-\' + view.normalizeString(item_wf_state);\n-                item_creator python:item.Creator();\n-                item_link python:item_type in view.use_view_action and item_url+\'/view\' or item_url;\n-                item_is_event python:view.is_event(obj);\n-                item_has_image python:item.getIcon;\n-                item_type_class python:(\'contenttype-\' + view.normalizeString(item_type)) if showicons else \'\' ;\n-                ">\n-              <metal:block define-slot="entry">\n-\n-                <article class="mb-3 row">\n-\n-                  <div class="col" metal:define-macro="listitem">\n-\n-                      <div class="mb-1">\n-                        <a tal:attributes="href python:item_link; class string:$item_type_class $item_wf_state_class url; title item_type" tal:content="python:item_title">\n+                         showicons python:view.show_icons();\n+                       ">\n+            <tal:listing condition="python:batch">\n+              <div class="entries"\n+                   metal:define-slot="entries"\n+                   tal:define="\n+                     portal python:portal_state.portal();\n+                     image_scale portal/@@image_scale;\n+                   "\n+              >\n+\n+                <tal:repeat metal:define-macro="entries"\n+                            repeat="item python:batch"\n+                >\n+                  <tal:block tal:define="\n+                               obj python:item.getObject();\n+                               item_url python:item.getURL();\n+                               item_id python:item.getId();\n+                               item_title python:item.Title();\n+                               item_title python:item_title or item_id;\n+                               item_description python:item.Description();\n+                               item_type python:item.PortalType();\n+                               item_modified python:item.ModificationDate();\n+                               item_created python:item.CreationDate();\n+                               item_wf_state python:item.review_state();\n+                               item_wf_state_class python:\'state-\' + view.normalizeString(item_wf_state);\n+                               item_creator python:item.Creator();\n+                               item_link python:item_type in view.use_view_action and item_url+\'/view\' or item_url;\n+                               item_is_event python:view.is_event(obj);\n+                               item_has_image python:item.getIcon;\n+                               item_type_class python:(\'contenttype-\' + view.normalizeString(item_type)) if showicons else \'\';\n+                             ">\n+                    <metal:block define-slot="entry">\n+\n+                      <article class="mb-3 row">\n+\n+                        <div class="col"\n+                             metal:define-macro="listitem"\n+                        >\n+\n+                          <div class="mb-1">\n+                            <a tal:content="python:item_title"\n+                               tal:attributes="\n+                                 href python:item_link;\n+                                 class string:$item_type_class $item_wf_state_class url;\n+                                 title item_type;\n+                               "\n+                            >\n                           Item Title\n-                        </a>\n-                      </div>\n+                            </a>\n+                          </div>\n \n-                      <metal:block metal:define-macro="document_byline">\n-                      <div class="mb-1">\n+                          <metal:block metal:define-macro="document_byline">\n+                            <div class="mb-1">\n \n-                        <tal:event condition="python:item_is_event">\n-                          <tal:date tal:replace="structure python:view.formatted_date(obj)"/>\n-                          <span tal:condition="python:obj.location" i18n:translate="label_event_byline_location">\n+                              <tal:event condition="python:item_is_event">\n+                                <tal:date tal:replace="structure python:view.formatted_date(obj)" />\n+                                <span tal:condition="python:obj.location"\n+                                      i18n:translate="label_event_byline_location"\n+                                >\n                             &mdash;\n-                            <span tal:content="python:obj.location" class="location" i18n:name="location">Oslo</span>\n-                          </span>\n+                                  <span class="location"\n+                                        tal:content="python:obj.location"\n+                                        i18n:name="location"\n+                                  >Oslo</span>\n+                                </span>\n                           &mdash;\n-                        </tal:event>\n-\n-                        <tal:byline condition="python:view.show_about">\n-                          <tal:name tal:condition="python:item_creator"\n-                              tal:define="author python:view.pas_member.info(item_creator);\n-                                          creator_short_form python:author.get(\'username\');\n-                                          creator_long_form string:?author=$${python:author.username};\n-                                          creator_is_openid python:\'/\' in creator_short_form;\n-                                          creator_id python:(creator_short_form, creator_long_form)[creator_is_openid];">\n-                          <span i18n:translate="label_by_author">\n+                              </tal:event>\n+\n+                              <tal:byline condition="python:view.show_about">\n+                                <tal:name tal:define="\n+                                            author python:view.pas_member.info(item_creator);\n+                                            creator_short_form python:author.get(\'username\');\n+                                            creator_long_form string:?author=$${python:author.username};\n+                                            creator_is_openid python:\'/\' in creator_short_form;\n+                                            creator_id python:(creator_short_form, creator_long_form)[creator_is_openid];\n+                                          "\n+                                          tal:condition="python:item_creator"\n+                                >\n+                                  <span i18n:translate="label_by_author">\n                             by\n-                            <a tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"\n-                                tal:content="python: author.get(\'name_or_id\')"\n-                                tal:omit-tag="python: not author"\n-                                i18n:name="author">\n+                                    <a tal:content="python: author.get(\'name_or_id\')"\n+                                       tal:omit-tag="python: not author"\n+                                       tal:attributes="\n+                                         href string:${view/navigation_root_url}/author/${item_creator};\n+                                       "\n+                                       i18n:name="author"\n+                                    >\n                               Bob Dobalina\n-                            </a>\n-                          </span>\n-                          </tal:name>\n+                                    </a>\n+                                  </span>\n+                                </tal:name>\n \n-                          <tal:modified condition="python:item_type != \'Event\'">\n+                                <tal:modified condition="python:item_type != \'Event\'">\n                             &mdash;\n-                            <tal:mod i18n:translate="box_last_modified">last modified</tal:mod>\n-                            <span tal:replace="python:view.toLocalizedTime(item_modified,long_format=1)">\n+                                  <tal:mod i18n:translate="box_last_modified">last modified</tal:mod>\n+                                  <span tal:replace="python:view.toLocalizedTime(item_modified,long_format=1)">\n                               August 16, 2001 at 23:35:59\n-                            </span>\n-                          </tal:modified>\n+                                  </span>\n+                                </tal:modified>\n \n-                          <metal:description define-slot="description_slot">\n-                            <tal:comment replace="nothing">\n+                                <metal:description define-slot="description_slot">\n+                                  <tal:comment replace="nothing">\n                               Place custom listing info for custom types here\n-                            </tal:comment>\n-                          </metal:description>\n+                                  </tal:comment>\n+                                </metal:description>\n \n-                        </tal:byline>\n-                      </div>\n-                      </metal:block>\n+                              </tal:byline>\n+                            </div>\n+                          </metal:block>\n \n-                      <p class="me-3" tal:condition="python:item_description" tal:content="python:item_description">\n+                          <p class="me-3"\n+                             tal:condition="python:item_description"\n+                             tal:content="python:item_description"\n+                          >\n                         description\n-                      </p>\n-                  </div>\n-\n-                  <div class="col-3 text-end" tal:condition="python:item_has_image and thumb_scale_list">\n-                    <a tal:attributes="href python:item_link;">\n-                      <img tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_list, css_class=img_class, loading=\'lazy\')" />\n-                    </a>\n-                  </div>\n-                </article>\n-\n-              </metal:block>\n-            </tal:block>\n-          </tal:repeat>\n-        </div>\n-\n-        <div metal:use-macro="context/batch_macros/macros/navigation" />\n-\n-      </tal:listing>\n-\n-      <metal:empty metal:define-slot="no_items_in_listing">\n-        <p class="discreet"\n-            tal:condition="python: not batch"\n-            tal:content="python: view.no_items_message">\n+                          </p>\n+                        </div>\n+\n+                        <div class="col-3 text-end"\n+                             tal:condition="python:item_has_image and thumb_scale_list"\n+                        >\n+                          <a tal:attributes="\n+                               href python:item_link;\n+                             ">\n+                            <img tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_list, css_class=img_class, loading=\'lazy\')" />\n+                          </a>\n+                        </div>\n+                      </article>\n+\n+                    </metal:block>\n+                  </tal:block>\n+                </tal:repeat>\n+              </div>\n+\n+              <div metal:use-macro="context/batch_macros/macros/navigation"></div>\n+\n+            </tal:listing>\n+\n+            <metal:empty metal:define-slot="no_items_in_listing">\n+              <p class="discreet"\n+                 tal:condition="python: not batch"\n+                 tal:content="python: view.no_items_message"\n+              >\n           There are currently no items in this folder.\n-        </p>\n-      </metal:empty>\n+              </p>\n+            </metal:empty>\n \n-    </tal:results>\n-  </metal:listingmacro>\n+          </tal:results>\n+        </metal:listingmacro>\n \n-</metal:block>\n-</metal:content-core>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/listing_album.pt b/plone/app/contenttypes/browser/templates/listing_album.pt\nindex 6774f606..70561c0e 100644\n--- a/plone/app/contenttypes/browser/templates/listing_album.pt\n+++ b/plone/app/contenttypes/browser/templates/listing_album.pt\n@@ -1,67 +1,124 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="here/main_template/macros/master"\n-      i18n:domain="plone">\n-<body>\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:main_macro define-macro="content-core" tal:define="images view/album_images; albums view/album_folders">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:main_macro define-macro="content-core"\n+                        tal:define="\n+                          images view/album_images;\n+                          albums view/album_folders;\n+                        "\n+      >\n \n-  <div metal:define-macro="text-field-view" id="parent-fieldname-text" class="stx" tal:define="text view/text" tal:condition="text" tal:attributes="class view/text_class">\n-    <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n-  </div>\n+        <div class="stx"\n+             id="parent-fieldname-text"\n+             metal:define-macro="text-field-view"\n+             tal:define="\n+               text view/text;\n+             "\n+             tal:condition="text"\n+             tal:attributes="\n+               class view/text_class;\n+             "\n+        >\n+          <div metal:define-slot="inside"\n+               tal:replace="structure text"\n+          >The body</div>\n+        </div>\n \n-  <metal:listingmacro define-macro="listing" tal:define="portal context/@@plone_portal_state/portal; image_scale portal/@@image_scale">\n+        <metal:listingmacro define-macro="listing"\n+                            tal:define="\n+                              portal context/@@plone_portal_state/portal;\n+                              image_scale portal/@@image_scale;\n+                            "\n+        >\n \n-  <div class="row">\n+          <div class="row">\n \n-  <tal:images tal:repeat="image images">\n-    <div class="col mb-5">\n-      <div class="card h-100">\n-        <div tal:define="scale python:image_scale.tag(image, \'image\', scale=\'mini\', loading=\'lazy\')" tal:condition="scale" class="card-image d-flex justify-content-center align-items-center" style="height: 14rem;">\n-          <img tal:replace="structure scale" />\n-        </div>\n-        <div class="card-body">\n-          <h5 class="card-title" tal:content="image/Title">Image title</h5>\n-          <p class="card-text" tal:content="image/Description">Description</p>\n-          <a class="card-link stretched-link" tal:attributes="href string:${image/getURL}/view; title image/Description" i18n:translate="label_view">View</a>\n-        </div>\n-      </div>\n-    </div>\n-  </tal:images>\n+            <tal:images tal:repeat="image images">\n+              <div class="col mb-5">\n+                <div class="card h-100">\n+                  <div class="card-image d-flex justify-content-center align-items-center"\n+                       style="height: 14rem;"\n+                       tal:define="\n+                         scale python:image_scale.tag(image, \'image\', scale=\'mini\', loading=\'lazy\');\n+                       "\n+                       tal:condition="scale"\n+                  >\n+                    <img tal:replace="structure scale" />\n+                  </div>\n+                  <div class="card-body">\n+                    <h5 class="card-title"\n+                        tal:content="image/Title"\n+                    >Image title</h5>\n+                    <p class="card-text"\n+                       tal:content="image/Description"\n+                    >Description</p>\n+                    <a class="card-link stretched-link"\n+                       tal:attributes="\n+                         href string:${image/getURL}/view;\n+                         title image/Description;\n+                       "\n+                       i18n:translate="label_view"\n+                    >View</a>\n+                  </div>\n+                </div>\n+              </div>\n+            </tal:images>\n \n-  <tal:albums tal:repeat="album albums">\n-    <div class="col mb-5">\n-      <div class="card album h-100">\n-        <div tal:define="scale python:image_scale.tag(album, \'image\', scale=\'mini\', loading=\'lazy\') if getattr(album, \'image\', None) else None"\n-         tal:condition="scale" class="card-image d-flex justify-content-center align-items-center" style="height: 14rem;">\n-          <img tal:replace="structure scale" />\n-        </div>\n-        <div class="card-body">\n-          <h5 class="card-title" tal:content="album/Title">Image title</h5>\n-          <p class="card-text" tal:content="album/Description">Description</p>\n-          <a class="card-link stretched-link" tal:attributes="href string:${album/getURL}/view; title album/Description" i18n:translate="label_view">View</a>\n-        </div>\n-      </div>\n-    </div>\n-  </tal:albums>\n+            <tal:albums tal:repeat="album albums">\n+              <div class="col mb-5">\n+                <div class="card album h-100">\n+                  <div class="card-image d-flex justify-content-center align-items-center"\n+                       style="height: 14rem;"\n+                       tal:define="\n+                         scale python:image_scale.tag(album, \'image\', scale=\'mini\', loading=\'lazy\') if getattr(album, \'image\', None) else None;\n+                       "\n+                       tal:condition="scale"\n+                  >\n+                    <img tal:replace="structure scale" />\n+                  </div>\n+                  <div class="card-body">\n+                    <h5 class="card-title"\n+                        tal:content="album/Title"\n+                    >Image title</h5>\n+                    <p class="card-text"\n+                       tal:content="album/Description"\n+                    >Description</p>\n+                    <a class="card-link stretched-link"\n+                       tal:attributes="\n+                         href string:${album/getURL}/view;\n+                         title album/Description;\n+                       "\n+                       i18n:translate="label_view"\n+                    >View</a>\n+                  </div>\n+                </div>\n+              </div>\n+            </tal:albums>\n \n-  </div>\n+          </div>\n \n-  <div metal:use-macro="context/batch_macros/macros/navigation" />\n+          <div metal:use-macro="context/batch_macros/macros/navigation"></div>\n \n-  <metal:empty metal:define-slot="no_items_in_listing">\n-    <p tal:condition="python: not images and not albums" tal:content="view/no_items_message">\n+          <metal:empty metal:define-slot="no_items_in_listing">\n+            <p tal:condition="python: not images and not albums"\n+               tal:content="view/no_items_message"\n+            >\n       There are currently no items in this folder.\n-    </p>\n-  </metal:empty>\n-  </metal:listingmacro>\n+            </p>\n+          </metal:empty>\n+        </metal:listingmacro>\n \n-</metal:main_macro>\n-</metal:content-core>\n+      </metal:main_macro>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/listing_summary.pt b/plone/app/contenttypes/browser/templates/listing_summary.pt\nindex b11a43d6..fec35e61 100644\n--- a/plone/app/contenttypes/browser/templates/listing_summary.pt\n+++ b/plone/app/contenttypes/browser/templates/listing_summary.pt\n@@ -1,67 +1,91 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core">\n-\n-<metal:block use-macro="context/@@listing_view/macros/content-core">\n-\n-  <metal:entries fill-slot="entries">\n-    <metal:block use-macro="context/@@listing_view/macros/entries" tal:define="portal context/@@plone_portal_state/portal; image_scale portal/@@image_scale">\n-\n-      <metal:entry fill-slot="entry">\n-\n-        <article class="row mb-3">\n-\n-          <div class="col">\n-\n-          <h2 metal:define-macro="listitem">\n-            <a class="summary url" tal:attributes="href item_link; title item_type" tal:content="item_title">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core">\n+\n+        <metal:block use-macro="context/@@listing_view/macros/content-core">\n+\n+          <metal:entries fill-slot="entries">\n+            <metal:block use-macro="context/@@listing_view/macros/entries"\n+                         tal:define="\n+                           portal context/@@plone_portal_state/portal;\n+                           image_scale portal/@@image_scale;\n+                         "\n+            >\n+\n+              <metal:entry fill-slot="entry">\n+\n+                <article class="row mb-3">\n+\n+                  <div class="col">\n+\n+                    <h2 metal:define-macro="listitem">\n+                      <a class="summary url"\n+                         tal:content="item_title"\n+                         tal:attributes="\n+                           href item_link;\n+                           title item_type;\n+                         "\n+                      >\n               Item Title\n-            </a>\n-          </h2>\n-\n-          <div class="mb-3">\n-            <div metal:use-macro="context/@@listing_view/macros/document_byline"></div>\n-          </div>\n-\n-          <div class="mb-1" tal:condition="item_description">\n-            <span class="description" tal:content="item_description">\n+                      </a>\n+                    </h2>\n+\n+                    <div class="mb-3">\n+                      <div metal:use-macro="context/@@listing_view/macros/document_byline"></div>\n+                    </div>\n+\n+                    <div class="mb-1"\n+                         tal:condition="item_description"\n+                    >\n+                      <span class="description"\n+                            tal:content="item_description"\n+                      >\n               description\n-            </span>\n-          </div>\n-\n-          <div class="mb-1">\n-            <a tal:attributes="href item_link" i18n:translate="read_more">\n+                      </span>\n+                    </div>\n+\n+                    <div class="mb-1">\n+                      <a tal:attributes="\n+                           href item_link;\n+                         "\n+                         i18n:translate="read_more"\n+                      >\n               Read More&hellip;\n-            </a>\n-          </div>\n+                      </a>\n+                    </div>\n \n-          </div>\n+                  </div>\n \n-          <div class="col-3"\n-               tal:condition="python: item_has_image and thumb_scale_summary">\n-            <a tal:attributes="href item_link">\n-              <img tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_summary, css_class=\'image-responsive thumb-\' + thumb_scale_summary, loading=\'lazy\')" />\n-            </a>\n-          </div>\n+                  <div class="col-3"\n+                       tal:condition="python: item_has_image and thumb_scale_summary"\n+                  >\n+                    <a tal:attributes="\n+                         href item_link;\n+                       ">\n+                      <img tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_summary, css_class=\'image-responsive thumb-\' + thumb_scale_summary, loading=\'lazy\')" />\n+                    </a>\n+                  </div>\n \n-        </article>\n+                </article>\n \n-      </metal:entry>\n-    </metal:block>\n-  </metal:entries>\n+              </metal:entry>\n+            </metal:block>\n+          </metal:entries>\n \n-</metal:block>\n+        </metal:block>\n \n-</metal:block>\n-</metal:content-core>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/listing_tabular.pt b/plone/app/contenttypes/browser/templates/listing_tabular.pt\nindex 0447709d..29b8cdc3 100644\n--- a/plone/app/contenttypes/browser/templates/listing_tabular.pt\n+++ b/plone/app/contenttypes/browser/templates/listing_tabular.pt\n@@ -1,111 +1,177 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core">\n-\n-  <div metal:define-macro="text-field-view" id="parent-fieldname-text" class="stx" tal:define="text python:view.text" tal:condition="python:text" tal:attributes="class python:view.text_class">\n-    <div metal:define-slot="inside" tal:replace="structure python:text">The body</div>\n-  </div>\n-\n-  <metal:listingmacro define-macro="listing">\n-  <tal:results define="batch python:view.batch()">\n-    <tal:listing condition="python:batch">\n-\n-      <div metal:use-macro="context/batch_macros/macros/navigation" />\n-\n-      <div class="table-responsive">\n-\n-        <table class="table table-striped" tal:define="tabular_fields view/tabular_fields; thumb_scale_table python:view.get_thumb_scale_table(); img_class python:\'thumb-%s float-end\' % thumb_scale_table; showicons  python:view.show_icons();" summary="Content listing" i18n:attributes="summary summary_content_listing;">\n-\n-          <thead>\n-            <tr>\n-              <th class="text-nowrap"></th>\n-              <th class="text-nowrap" tal:repeat="field tabular_fields" tal:content="python:view.tabular_field_label(field)">Field name</th>\n-              <th class="text-nowrap" i18n:translate="image" tal:condition="python:thumb_scale_table">Image</th>\n-            </tr>\n-          </thead>\n-\n-          <tbody tal:define="portal python:portal_state.portal(); image_scale portal/@@image_scale">\n-            <tal:entries tal:repeat="item python:batch">\n-              <tal:block tal:define="item_url python:item.getURL();\n-                                      item_id python:item.getId();\n-                                      item_title python:item.Title();\n-                                      item_title python:item_title or item_id;\n-                                      item_type python:item.PortalType();\n-                                      item_type_class python:\'contenttype/\' + view.normalizeString(item_type) if showicons else \'\';\n-                                      item_wf_state python:item.review_state();\n-                                      item_wf_state_class python:\'state-\' + view.normalizeString(item_wf_state);\n-                                      item_creator python:item.Creator();\n-                                      item_has_image python:item.getIcon;\n-                                      item_link python:item_type in view.use_view_action and item_url+\'/view\' or item_url;\n-                                      item_mime_type python:item.mime_type;\n-                                      item_mime_type_icon python: \'mimetype-\' + item_mime_type;\n-                                      ">\n-\n-                <tr metal:define-macro="listitem">\n-\n-                  <td>\n-                    <tal:icon tal:condition="python: item_type == \'File\'" tal:replace="structure python:icons.tag(item_mime_type_icon)" />\n-                    <tal:icon tal:condition="python: item_type != \'File\'" tal:replace="structure python:icons.tag(item_type_class)" />\n-                  </td>\n-\n-                  <tal:block tal:repeat="field python:tabular_fields">\n-\n-                  <td class="text-nowrap" tal:condition="python:field not in [\'Title\', \'Creator\', \'getIcon\']" tal:define="field_data python:view.tabular_fielddata(item, field)">\n-                    <tal:block tal:replace="python: field_data.get(\'value\')" />\n-                  </td>\n-\n-                  <td class="text-nowrap" tal:condition="python:field == \'Title\'">\n-                    <a tal:attributes="href python:item_link; class string:$item_type_class $item_wf_state_class url; title python:item_type" tal:content="python: item_title">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core">\n+\n+        <div class="stx"\n+             id="parent-fieldname-text"\n+             metal:define-macro="text-field-view"\n+             tal:define="\n+               text python:view.text;\n+             "\n+             tal:condition="python:text"\n+             tal:attributes="\n+               class python:view.text_class;\n+             "\n+        >\n+          <div metal:define-slot="inside"\n+               tal:replace="structure python:text"\n+          >The body</div>\n+        </div>\n+\n+        <metal:listingmacro define-macro="listing">\n+          <tal:results define="\n+                         batch python:view.batch();\n+                       ">\n+            <tal:listing condition="python:batch">\n+\n+              <div metal:use-macro="context/batch_macros/macros/navigation"></div>\n+\n+              <div class="table-responsive">\n+\n+                <table class="table table-striped"\n+                       summary="Content listing"\n+                       tal:define="\n+                         tabular_fields view/tabular_fields;\n+                         thumb_scale_table python:view.get_thumb_scale_table();\n+                         img_class python:\'thumb-%s float-end\' % thumb_scale_table;\n+                         showicons  python:view.show_icons();\n+                       "\n+                       i18n:attributes="summary summary_content_listing;"\n+                >\n+\n+                  <thead>\n+                    <tr>\n+                      <th class="text-nowrap"></th>\n+                      <th class="text-nowrap"\n+                          tal:repeat="field tabular_fields"\n+                          tal:content="python:view.tabular_field_label(field)"\n+                      >Field name</th>\n+                      <th class="text-nowrap"\n+                          tal:condition="python:thumb_scale_table"\n+                          i18n:translate="image"\n+                      >Image</th>\n+                    </tr>\n+                  </thead>\n+\n+                  <tbody tal:define="\n+                           portal python:portal_state.portal();\n+                           image_scale portal/@@image_scale;\n+                         ">\n+                    <tal:entries tal:repeat="item python:batch">\n+                      <tal:block tal:define="\n+                                   item_url python:item.getURL();\n+                                   item_id python:item.getId();\n+                                   item_title python:item.Title();\n+                                   item_title python:item_title or item_id;\n+                                   item_type python:item.PortalType();\n+                                   item_type_class python:\'contenttype/\' + view.normalizeString(item_type) if showicons else \'\';\n+                                   item_wf_state python:item.review_state();\n+                                   item_wf_state_class python:\'state-\' + view.normalizeString(item_wf_state);\n+                                   item_creator python:item.Creator();\n+                                   item_has_image python:item.getIcon;\n+                                   item_link python:item_type in view.use_view_action and item_url+\'/view\' or item_url;\n+                                   item_mime_type python:item.mime_type;\n+                                   item_mime_type_icon python: \'mimetype-\' + item_mime_type;\n+                                 ">\n+\n+                        <tr metal:define-macro="listitem">\n+\n+                          <td>\n+                            <tal:icon tal:condition="python: item_type == \'File\'"\n+                                      tal:replace="structure python:icons.tag(item_mime_type_icon)"\n+                            />\n+                            <tal:icon tal:condition="python: item_type != \'File\'"\n+                                      tal:replace="structure python:icons.tag(item_type_class)"\n+                            />\n+                          </td>\n+\n+                          <tal:block tal:repeat="field python:tabular_fields">\n+\n+                            <td class="text-nowrap"\n+                                tal:define="\n+                                  field_data python:view.tabular_fielddata(item, field);\n+                                "\n+                                tal:condition="python:field not in [\'Title\', \'Creator\', \'getIcon\']"\n+                            >\n+                              <tal:block tal:replace="python: field_data.get(\'value\')" />\n+                            </td>\n+\n+                            <td class="text-nowrap"\n+                                tal:condition="python:field == \'Title\'"\n+                            >\n+                              <a tal:content="python: item_title"\n+                                 tal:attributes="\n+                                   href python:item_link;\n+                                   class string:$item_type_class $item_wf_state_class url;\n+                                   title python:item_type;\n+                                 "\n+                              >\n                       Item Title\n-                    </a>\n-                  </td>\n-\n-                  <td class="text-nowrap" tal:condition="python:field == \'Creator\'" tal:define="author python:view.pas_member.info(item_creator); name python:author[\'fullname\'] or author[\'username\']">\n-                    <a tal:condition="python: author" href="${view/navigation_root_url}/author/${item_creator}">\n+                              </a>\n+                            </td>\n+\n+                            <td class="text-nowrap"\n+                                tal:define="\n+                                  author python:view.pas_member.info(item_creator);\n+                                  name python:author[\'fullname\'] or author[\'username\'];\n+                                "\n+                                tal:condition="python:field == \'Creator\'"\n+                            >\n+                              <a href="${view/navigation_root_url}/author/${item_creator}"\n+                                 tal:condition="python: author"\n+                              >\n                       ${name}\n-                    </a>\n-                  </td>\n+                              </a>\n+                            </td>\n \n-                  </tal:block>\n+                          </tal:block>\n \n-                  <td>\n-                    <a tal:condition="python:item_has_image and thumb_scale_table">\n-                      <img tal:attributes="href python: item_link" tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_table, css_class=img_class, loading=\'lazy\')" />\n-                    </a>\n-                  </td>\n+                          <td>\n+                            <a tal:condition="python:item_has_image and thumb_scale_table">\n+                              <img tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_table, css_class=img_class, loading=\'lazy\')"\n+                                   tal:attributes="\n+                                     href python: item_link;\n+                                   "\n+                              />\n+                            </a>\n+                          </td>\n \n-                </tr>\n+                        </tr>\n \n-              </tal:block>\n-            </tal:entries>\n-          </tbody>\n-        </table>\n+                      </tal:block>\n+                    </tal:entries>\n+                  </tbody>\n+                </table>\n \n-      </div>\n+              </div>\n \n-      <div metal:use-macro="context/batch_macros/macros/navigation" />\n+              <div metal:use-macro="context/batch_macros/macros/navigation"></div>\n \n-    </tal:listing>\n+            </tal:listing>\n \n-    <metal:empty metal:define-slot="no_items_in_listing">\n-    <p tal:condition="python: not batch" tal:content="python: view.no_items_message">\n+            <metal:empty metal:define-slot="no_items_in_listing">\n+              <p tal:condition="python: not batch"\n+                 tal:content="python: view.no_items_message"\n+              >\n       There are currently no items in this folder.\n-    </p>\n-    </metal:empty>\n+              </p>\n+            </metal:empty>\n \n-  </tal:results>\n-  </metal:listingmacro>\n+          </tal:results>\n+        </metal:listingmacro>\n \n-</metal:block>\n-</metal:content-core>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/newsitem.pt b/plone/app/contenttypes/browser/templates/newsitem.pt\nindex c3754bb8..77d7eac2 100644\n--- a/plone/app/contenttypes/browser/templates/newsitem.pt\n+++ b/plone/app/contenttypes/browser/templates/newsitem.pt\n@@ -1,27 +1,35 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:content-core define-macro="content-core"\n-                    tal:define="toc python: getattr(context, \'table_of_contents\', False)">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:content-core define-macro="content-core"\n+                          tal:define="\n+                            toc python: getattr(context, \'table_of_contents\', False);\n+                          "\n+      >\n \n-  <section id="section-text">\n-    <div id="parent-fieldname-text"\n-         tal:condition="python:getattr(context, \'text\', None)"\n-         tal:content="structure python:context.text.output_relative_to(view.context)"\n-         tal:attributes="class python: toc and \'pat-autotoc\' or \'\'">\n+        <section id="section-text">\n+          <div id="parent-fieldname-text"\n+               tal:condition="python:getattr(context, \'text\', None)"\n+               tal:content="structure python:context.text.output_relative_to(view.context)"\n+               tal:attributes="\n+                 class python: toc and \'pat-autotoc\' or \'\';\n+               "\n+          >\n       Text\n-    </div>\n-  </section>\n+          </div>\n+        </section>\n \n-</metal:content-core>\n-</metal:content-core>\n+      </metal:content-core>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2023-03-25T23:30:42+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/84901169fb20cdbd55cee363c570a3786905ee12

feat: no need the fallback

Files changed:
M plone/__init__.py
M plone/app/__init__.py

b'diff --git a/plone/__init__.py b/plone/__init__.py\nindex 5f9c2f42..5284146e 100644\n--- a/plone/__init__.py\n+++ b/plone/__init__.py\n@@ -1,7 +1 @@\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:  # pragma: no cover\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/__init__.py b/plone/app/__init__.py\nindex 5f9c2f42..5284146e 100644\n--- a/plone/app/__init__.py\n+++ b/plone/app/__init__.py\n@@ -1,7 +1 @@\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:  # pragma: no cover\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2023-03-25T23:30:42+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/bff2af8378eee45746e40d64690b2669098d8cce

feat: flake8

Files changed:
M docs/source/conf.py
M plone/app/contenttypes/behaviors/collection.py
M plone/app/contenttypes/browser/migration.py
M plone/app/contenttypes/tests/test_content_profile.py
M plone/app/contenttypes/tests/test_security.py

b"diff --git a/docs/source/conf.py b/docs/source/conf.py\nindex c2bc52ab..0657c9ba 100644\n--- a/docs/source/conf.py\n+++ b/docs/source/conf.py\n@@ -10,10 +10,6 @@\n # All configuration values have a default; values that are commented out\n # serve to show the default.\n \n-import os\n-import sys\n-\n-\n # If extensions (or modules to document with autodoc) are in another directory,\n # add these directories to sys.path here. If the directory is relative to the\n # documentation root, use os.path.abspath to make it absolute, like shown here.\n@@ -171,12 +167,12 @@\n # -- Options for LaTeX output --------------------------------------------------\n \n latex_elements = {\n-    # The paper size ('letterpaper' or 'a4paper').\n-    #'papersize': 'letterpaper',\n-    # The font size ('10pt', '11pt' or '12pt').\n-    #'pointsize': '10pt',\n-    # Additional stuff for the LaTeX preamble.\n-    #'preamble': '',\n+    #  The paper size ('letterpaper' or 'a4paper').\n+    # 'papersize': 'letterpaper',\n+    #  The font size ('10pt', '11pt' or '12pt').\n+    # 'pointsize': '10pt',\n+    #  Additional stuff for the LaTeX preamble.\n+    # 'preamble': '',\n }\n \n # Grouping the document tree into LaTeX files. List of tuples\ndiff --git a/plone/app/contenttypes/behaviors/collection.py b/plone/app/contenttypes/behaviors/collection.py\nindex 1d1daf60..2e97c06a 100644\n--- a/plone/app/contenttypes/behaviors/collection.py\n+++ b/plone/app/contenttypes/behaviors/collection.py\n@@ -6,7 +6,6 @@\n from plone.base.interfaces.syndication import ISyndicatable\n from plone.dexterity.interfaces import IDexterityContent\n from plone.supermodel import model\n-from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.browser.syndication.adapters import (\n     CollectionFeed as BaseCollectionFeed,\n )\ndiff --git a/plone/app/contenttypes/browser/migration.py b/plone/app/contenttypes/browser/migration.py\nindex 9597fd52..61354f40 100644\n--- a/plone/app/contenttypes/browser/migration.py\n+++ b/plone/app/contenttypes/browser/migration.py\n@@ -1,39 +1,22 @@\n-from plone.app.contenttypes.content import Document\n-from plone.app.contenttypes.content import File\n-from plone.app.contenttypes.content import Folder\n-from plone.app.contenttypes.content import Image\n-from plone.app.contenttypes.content import Link\n-from plone.app.contenttypes.content import NewsItem\n from plone.app.contenttypes.utils import changed_base_classes\n-from plone.app.contenttypes.utils import DEFAULT_TYPES\n from plone.app.contenttypes.utils import get_old_class_name_string\n from plone.app.contenttypes.utils import migrate_base_class_to_new_class\n from plone.base import PloneMessageFactory as _\n-from plone.base.utils import get_installer\n-from plone.browserlayer.interfaces import ILocalBrowserLayerType\n-from plone.dexterity.interfaces import IDexterityContent\n-from plone.dexterity.interfaces import IDexterityFTI\n from plone.z3cform.layout import wrap_form\n from Products.CMFCore.utils import getToolByName\n-from Products.Five.browser import BrowserView\n-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.statusmessages.interfaces import IStatusMessage\n from z3c.form import button\n from z3c.form import field\n from z3c.form import form\n from z3c.form.browser.checkbox import CheckBoxFieldWidget\n-from z3c.form.interfaces import HIDDEN_MODE\n from zExceptions import NotFound\n from zope import schema\n-from zope.component import getMultiAdapter\n-from zope.component import queryUtility\n from zope.interface import implementer\n from zope.interface import Interface\n from zope.schema.interfaces import IVocabularyFactory\n from zope.schema.vocabulary import SimpleVocabulary\n \n import logging\n-import pkg_resources\n \n \n logger = logging.getLogger(__name__)\ndiff --git a/plone/app/contenttypes/tests/test_content_profile.py b/plone/app/contenttypes/tests/test_content_profile.py\nindex 1f2cefa3..9556756d 100644\n--- a/plone/app/contenttypes/tests/test_content_profile.py\n+++ b/plone/app/contenttypes/tests/test_content_profile.py\n@@ -1,11 +1,9 @@\n from plone.app.contenttypes.testing import PLONE_APP_CONTENTTYPES_FIXTURE\n from plone.app.testing import IntegrationTesting\n from plone.app.testing import PloneSandboxLayer\n-from plone.base.interfaces.constrains import ISelectableConstrainTypes\n from plone.portlets.interfaces import ILocalPortletAssignmentManager\n from plone.portlets.interfaces import IPortletManager\n from Products.CMFCore.utils import getToolByName\n-from Products.PythonScripts.PythonScript import PythonScript\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \ndiff --git a/plone/app/contenttypes/tests/test_security.py b/plone/app/contenttypes/tests/test_security.py\nindex af6d24de..9cda9ae0 100644\n--- a/plone/app/contenttypes/tests/test_security.py\n+++ b/plone/app/contenttypes/tests/test_security.py\n@@ -7,11 +7,8 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n-from plone.testing.zope import Browser\n \n import base64\n-import os\n-import pkg_resources\n import re\n import sys\n import transaction\n"

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2023-03-25T23:30:42+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/5100caead4c4bad69db52efd6be2970433137d00

feat: configure codespell

Files changed:
M pyproject.toml

b'diff --git a/pyproject.toml b/pyproject.toml\nindex 9eb73f3c..1324970a 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -60,3 +60,6 @@ Zope = [\n   \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n ]\n python-dateutil = [\'dateutil\']\n+\n+[tool.codespell]\n+ignore-words-list = "discreet,oder,ist,crate"\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2023-03-25T23:30:42+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/26df9375407b84522f1970f74238fcd448470ac3

feat: codespell

Files changed:
M CHANGES.rst
M plone/app/contenttypes/setuphandlers.py
M plone/app/contenttypes/tests/test_browser_utils.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 3e3c59a0..1cf056c9 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -786,7 +786,7 @@ New features:\n   https://github.com/plone/Products.CMFPlone/issues/1995\n   [fgrcon]\n \n-- new behavior: IThumbIconHandling, supress thumbs /icons, adjust thumb size, templates adapted\n+- new behavior: IThumbIconHandling, suppress thumbs /icons, adjust thumb size, templates adapted\n   https://github.com/plone/Products.CMFPlone/issues/1734 (PLIP)\n \n Bug fixes:\n@@ -904,7 +904,7 @@ New features:\n - Configure edit urls for locking support, where locking support is enabled.\n   [thet]\n \n-- Add ``i18n:attribute`` properies to all action nodes for FTI types.\n+- Add ``i18n:attribute`` properties to all action nodes for FTI types.\n   [thet]\n \n - added few pypi links in \'Migration\' section\n@@ -1145,7 +1145,7 @@ Fixes:\n - Fixed full_view error when collection contains itself.\n   [vangheem]\n \n-- test_content_profile: do not appy Products.CMFPlone:plone.\n+- test_content_profile: do not apply Products.CMFPlone:plone.\n   [maurits]\n \n \n@@ -1162,7 +1162,7 @@ Fixes:\n   [pbauer]\n \n - Fix an error with logging an exception on indexing SearchableText for files\n-  and concating utf-8 encoded strings.\n+  and concatenating utf-8 encoded strings.\n   [thet]\n \n - Make consistent use of LeadImage behavior everywhere. Related to\n@@ -1173,7 +1173,7 @@ Fixes:\n - Fixed the summary_view styling\n   [sneridagh]\n - redirect_links property has moved to the configuration registry.\n-- redirect_links, types_view_action_in_listings properies have moved to the\n+- redirect_links, types_view_action_in_listings properties have moved to the\n   configuration registry.\n   [esteele]\n \n@@ -1440,7 +1440,7 @@ Fixes:\n - Code modernization: sorted imports, use decorators, utf8 headers.\n   [jensens]\n \n-- Fix: Added missing types to CMFDiffTool configuraion.\n+- Fix: Added missing types to CMFDiffTool configuration.\n   [jensens]\n \n - Integration of the new markup update and CSS for both Plone and Barceloneta\n@@ -1480,7 +1480,7 @@ Fixes:\n - Replace AT-fti with DX-fti when migrating a type.\n   [esteele, pbauer]\n \n-- Only show migrateable types (fixes #155)\n+- Only show migratable types (fixes #155)\n   [pbauer]\n \n - Add logging during and after migration (fixes #156)\n@@ -1579,7 +1579,7 @@ Fixes:\n - Remove enabling simple_publication_workflow from testing fixture.\n   [timo]\n \n-- Only show migrateable types (fixes #155)\n+- Only show migratable types (fixes #155)\n   [pbauer]\n \n - Add logging during and after migration (fixes #156)\n@@ -1745,7 +1745,7 @@ Fixes:\n   [jensens]\n \n - Add contributor role as default for all add permissions in order to\n-  work together with the different plone worklfows, which assume it is\n+  work together with the different plone workflows, which assume it is\n   set this way.\n   [jensens]\n \n@@ -1760,7 +1760,7 @@ Fixes:\n   [jensens]\n \n - Fix Bug on SearchableText_file indexer when input stream contains\n-  characters not convertable in ASCII. Assumes now utf-8 and replaces\n+  characters not convertible in ASCII. Assumes now utf-8 and replaces\n   all unknown. Even if search can not find the words with special\n   characters in, indexer does not break completely on those items.\n   [jensens]\ndiff --git a/plone/app/contenttypes/setuphandlers.py b/plone/app/contenttypes/setuphandlers.py\nindex 5697a224..ad88700a 100644\n--- a/plone/app/contenttypes/setuphandlers.py\n+++ b/plone/app/contenttypes/setuphandlers.py\n@@ -271,7 +271,7 @@ def create_events_topic(portal, target_language):\n         )\n         aggregator = container["aggregator"]\n \n-        # Constain types\n+        # Constrain types\n         allowed_types = [\n             "Event",\n         ]\ndiff --git a/plone/app/contenttypes/tests/test_browser_utils.py b/plone/app/contenttypes/tests/test_browser_utils.py\nindex 6e488054..6b28a89c 100644\n--- a/plone/app/contenttypes/tests/test_browser_utils.py\n+++ b/plone/app/contenttypes/tests/test_browser_utils.py\n@@ -36,7 +36,7 @@ def test_none(self):\n \n     def test_unknown(self):\n         self.assertEqual(\n-            self.view.getMimeTypeIcon(DummyFile("some/unknown", "unkown.unknown")),\n+            self.view.getMimeTypeIcon(DummyFile("some/unknown", "unknown.unknown")),\n             FALLBACK,\n         )\n \n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2023-03-26T15:33:36+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/2ddfb2643c4f0fe09d52be57be630141654022b7

feat: declare dependencies

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex 8cfe14e9..7e415f23 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -59,15 +59,40 @@ def read(*rnames):\n         "plone.app.vocabularies > 4.1.2",\n         "plone.app.lockingbehavior",\n         "plone.behavior >= 1.3.0",\n-        "pytz",\n         "plone.app.z3cform>=1.1.0",\n         "zope.deprecation",\n+        "plone.base",\n+        "Products.GenericSetup",\n+        "Products.MimetypesRegistry",\n+        "Products.PortalTransforms",\n+        "Products.statusmessages",\n+        "plone.app.layout",\n+        "plone.app.textfield",\n+        "plone.app.uuid",\n+        "plone.autoform",\n+        "plone.event",\n+        "plone.folder",\n+        "plone.i18n",\n+        "plone.indexer",\n+        "plone.memoize",\n+        "plone.portlets",\n+        "plone.registry",\n+        "plone.rfc822",\n+        "plone.supermodel",\n+        "plone.z3cform",\n+        "z3c.form",\n+        "zope.contentprovider",\n     ],\n     extras_require={\n         "test": [\n             "lxml",\n             "plone.app.robotframework [debug] > 0.9.8",  # create image and file content for Image, File and News Item if not given.  # noqa\n             "plone.app.testing [robot] >= 4.2.4",  # we need ROBOT_TEST_LEVEL\n+            "plone.testing",\n+            "plone.browserlayer",\n+            "plone.uuid",\n+            "zope.viewlet",\n+            "robotsuite",\n         ],\n     },\n )\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2023-03-27T13:26:50+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/406becb2156f79a30084cf798a03b35d3d03fdbc

Merge pull request #657 from plone/config-with-default-template-4f5b18cf

Config with default template

Files changed:
A .meta.toml
A .pre-commit-config.yaml
A news/47959565.internal
A tox.ini
M .editorconfig
M CHANGES.rst
M docs/source/conf.py
M plone/__init__.py
M plone/app/__init__.py
M plone/app/contenttypes/behaviors/collection.py
M plone/app/contenttypes/behaviors/configure.zcml
M plone/app/contenttypes/behaviors/leadimage.pt
M plone/app/contenttypes/behaviors/leadimage.py
M plone/app/contenttypes/behaviors/richtext.py
M plone/app/contenttypes/behaviors/richtext_gettext.pt
M plone/app/contenttypes/behaviors/tableofcontents.py
M plone/app/contenttypes/behaviors/thumb_icon.py
M plone/app/contenttypes/browser/configure.zcml
M plone/app/contenttypes/browser/folder.py
M plone/app/contenttypes/browser/link_redirect_view.py
M plone/app/contenttypes/browser/migration.py
M plone/app/contenttypes/browser/templates/document.pt
M plone/app/contenttypes/browser/templates/file.pt
M plone/app/contenttypes/browser/templates/full_view.pt
M plone/app/contenttypes/browser/templates/full_view_item.pt
M plone/app/contenttypes/browser/templates/image.pt
M plone/app/contenttypes/browser/templates/image_view_fullscreen.pt
M plone/app/contenttypes/browser/templates/link.pt
M plone/app/contenttypes/browser/templates/listing.pt
M plone/app/contenttypes/browser/templates/listing_album.pt
M plone/app/contenttypes/browser/templates/listing_summary.pt
M plone/app/contenttypes/browser/templates/listing_tabular.pt
M plone/app/contenttypes/browser/templates/newsitem.pt
M plone/app/contenttypes/configure.zcml
M plone/app/contenttypes/indexers.zcml
M plone/app/contenttypes/permissions.zcml
M plone/app/contenttypes/profiles.zcml
M plone/app/contenttypes/profiles/content/metadata.xml
M plone/app/contenttypes/profiles/content/portlets.xml
M plone/app/contenttypes/profiles/default/browserlayer.xml
M plone/app/contenttypes/profiles/default/diff_tool.xml
M plone/app/contenttypes/profiles/default/metadata.xml
M plone/app/contenttypes/profiles/default/rolemap.xml
M plone/app/contenttypes/profiles/default/types.xml
M plone/app/contenttypes/profiles/default/types/Collection.xml
M plone/app/contenttypes/profiles/default/types/Document.xml
M plone/app/contenttypes/profiles/default/types/Event.xml
M plone/app/contenttypes/profiles/default/types/File.xml
M plone/app/contenttypes/profiles/default/types/Folder.xml
M plone/app/contenttypes/profiles/default/types/Image.xml
M plone/app/contenttypes/profiles/default/types/Link.xml
M plone/app/contenttypes/profiles/default/types/News_Item.xml
M plone/app/contenttypes/profiles/default/types/Plone_Site.xml
M plone/app/contenttypes/schema/collection.xml
M plone/app/contenttypes/schema/document.xml
M plone/app/contenttypes/schema/event.xml
M plone/app/contenttypes/schema/file.xml
M plone/app/contenttypes/schema/folder.xml
M plone/app/contenttypes/schema/image.xml
M plone/app/contenttypes/schema/link.xml
M plone/app/contenttypes/schema/news_item.xml
M plone/app/contenttypes/setuphandlers.py
M plone/app/contenttypes/subscribers.zcml
M plone/app/contenttypes/testing.py
M plone/app/contenttypes/tests/test_behaviors_collection.py
M plone/app/contenttypes/tests/test_behaviors_leadimage.py
M plone/app/contenttypes/tests/test_behaviors_table_of_contents.py
M plone/app/contenttypes/tests/test_browser_utils.py
M plone/app/contenttypes/tests/test_collection.py
M plone/app/contenttypes/tests/test_collection_rss.py
M plone/app/contenttypes/tests/test_content_profile.py
M plone/app/contenttypes/tests/test_document.py
M plone/app/contenttypes/tests/test_event.py
M plone/app/contenttypes/tests/test_file.py
M plone/app/contenttypes/tests/test_folder.py
M plone/app/contenttypes/tests/test_image.py
M plone/app/contenttypes/tests/test_indexes.py
M plone/app/contenttypes/tests/test_link.py
M plone/app/contenttypes/tests/test_news_item.py
M plone/app/contenttypes/tests/test_security.py
M plone/app/contenttypes/tests/test_setup.py
M plone/app/contenttypes/upgrades.zcml
M pyproject.toml
M setup.cfg
M setup.py

b'diff --git a/.editorconfig b/.editorconfig\nindex a83363bf8..b4158b89d 100644\n--- a/.editorconfig\n+++ b/.editorconfig\n@@ -1,15 +1,39 @@\n-[*]\n-indent_style = space\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n end_of_line = lf\n insert_final_newline = true\n trim_trailing_whitespace = true\n+# Set default charset\n charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n \n-[{*.py,*.cfg}]\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n indent_size = 4\n \n-[{*.html,*.dtml,*.pt,*.zpt,*.xml,*.zcml,*.js}]\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n indent_size = 2\n \n-[Makefile]\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 000000000..07dde259a\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "47959565"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 000000000..582f8acd8\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.2\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/CHANGES.rst b/CHANGES.rst\nindex 3e3c59a0b..1cf056c90 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -786,7 +786,7 @@ New features:\n   https://github.com/plone/Products.CMFPlone/issues/1995\n   [fgrcon]\n \n-- new behavior: IThumbIconHandling, supress thumbs /icons, adjust thumb size, templates adapted\n+- new behavior: IThumbIconHandling, suppress thumbs /icons, adjust thumb size, templates adapted\n   https://github.com/plone/Products.CMFPlone/issues/1734 (PLIP)\n \n Bug fixes:\n@@ -904,7 +904,7 @@ New features:\n - Configure edit urls for locking support, where locking support is enabled.\n   [thet]\n \n-- Add ``i18n:attribute`` properies to all action nodes for FTI types.\n+- Add ``i18n:attribute`` properties to all action nodes for FTI types.\n   [thet]\n \n - added few pypi links in \'Migration\' section\n@@ -1145,7 +1145,7 @@ Fixes:\n - Fixed full_view error when collection contains itself.\n   [vangheem]\n \n-- test_content_profile: do not appy Products.CMFPlone:plone.\n+- test_content_profile: do not apply Products.CMFPlone:plone.\n   [maurits]\n \n \n@@ -1162,7 +1162,7 @@ Fixes:\n   [pbauer]\n \n - Fix an error with logging an exception on indexing SearchableText for files\n-  and concating utf-8 encoded strings.\n+  and concatenating utf-8 encoded strings.\n   [thet]\n \n - Make consistent use of LeadImage behavior everywhere. Related to\n@@ -1173,7 +1173,7 @@ Fixes:\n - Fixed the summary_view styling\n   [sneridagh]\n - redirect_links property has moved to the configuration registry.\n-- redirect_links, types_view_action_in_listings properies have moved to the\n+- redirect_links, types_view_action_in_listings properties have moved to the\n   configuration registry.\n   [esteele]\n \n@@ -1440,7 +1440,7 @@ Fixes:\n - Code modernization: sorted imports, use decorators, utf8 headers.\n   [jensens]\n \n-- Fix: Added missing types to CMFDiffTool configuraion.\n+- Fix: Added missing types to CMFDiffTool configuration.\n   [jensens]\n \n - Integration of the new markup update and CSS for both Plone and Barceloneta\n@@ -1480,7 +1480,7 @@ Fixes:\n - Replace AT-fti with DX-fti when migrating a type.\n   [esteele, pbauer]\n \n-- Only show migrateable types (fixes #155)\n+- Only show migratable types (fixes #155)\n   [pbauer]\n \n - Add logging during and after migration (fixes #156)\n@@ -1579,7 +1579,7 @@ Fixes:\n - Remove enabling simple_publication_workflow from testing fixture.\n   [timo]\n \n-- Only show migrateable types (fixes #155)\n+- Only show migratable types (fixes #155)\n   [pbauer]\n \n - Add logging during and after migration (fixes #156)\n@@ -1745,7 +1745,7 @@ Fixes:\n   [jensens]\n \n - Add contributor role as default for all add permissions in order to\n-  work together with the different plone worklfows, which assume it is\n+  work together with the different plone workflows, which assume it is\n   set this way.\n   [jensens]\n \n@@ -1760,7 +1760,7 @@ Fixes:\n   [jensens]\n \n - Fix Bug on SearchableText_file indexer when input stream contains\n-  characters not convertable in ASCII. Assumes now utf-8 and replaces\n+  characters not convertible in ASCII. Assumes now utf-8 and replaces\n   all unknown. Even if search can not find the words with special\n   characters in, indexer does not break completely on those items.\n   [jensens]\ndiff --git a/docs/source/conf.py b/docs/source/conf.py\nindex c2bc52abe..0657c9ba4 100644\n--- a/docs/source/conf.py\n+++ b/docs/source/conf.py\n@@ -10,10 +10,6 @@\n # All configuration values have a default; values that are commented out\n # serve to show the default.\n \n-import os\n-import sys\n-\n-\n # If extensions (or modules to document with autodoc) are in another directory,\n # add these directories to sys.path here. If the directory is relative to the\n # documentation root, use os.path.abspath to make it absolute, like shown here.\n@@ -171,12 +167,12 @@\n # -- Options for LaTeX output --------------------------------------------------\n \n latex_elements = {\n-    # The paper size (\'letterpaper\' or \'a4paper\').\n-    #\'papersize\': \'letterpaper\',\n-    # The font size (\'10pt\', \'11pt\' or \'12pt\').\n-    #\'pointsize\': \'10pt\',\n-    # Additional stuff for the LaTeX preamble.\n-    #\'preamble\': \'\',\n+    #  The paper size (\'letterpaper\' or \'a4paper\').\n+    # \'papersize\': \'letterpaper\',\n+    #  The font size (\'10pt\', \'11pt\' or \'12pt\').\n+    # \'pointsize\': \'10pt\',\n+    #  Additional stuff for the LaTeX preamble.\n+    # \'preamble\': \'\',\n }\n \n # Grouping the document tree into LaTeX files. List of tuples\ndiff --git a/news/47959565.internal b/news/47959565.internal\nnew file mode 100644\nindex 000000000..c08f53991\n--- /dev/null\n+++ b/news/47959565.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/plone/__init__.py b/plone/__init__.py\nindex 5f9c2f42a..5284146eb 100644\n--- a/plone/__init__.py\n+++ b/plone/__init__.py\n@@ -1,7 +1 @@\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:  # pragma: no cover\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/__init__.py b/plone/app/__init__.py\nindex 5f9c2f42a..5284146eb 100644\n--- a/plone/app/__init__.py\n+++ b/plone/app/__init__.py\n@@ -1,7 +1 @@\n-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages\n-try:\n-    __import__("pkg_resources").declare_namespace(__name__)\n-except ImportError:  # pragma: no cover\n-    from pkgutil import extend_path\n-\n-    __path__ = extend_path(__path__, __name__)\n+__import__("pkg_resources").declare_namespace(__name__)\ndiff --git a/plone/app/contenttypes/behaviors/collection.py b/plone/app/contenttypes/behaviors/collection.py\nindex 221addac5..2e97c06ab 100644\n--- a/plone/app/contenttypes/behaviors/collection.py\n+++ b/plone/app/contenttypes/behaviors/collection.py\n@@ -6,7 +6,6 @@\n from plone.base.interfaces.syndication import ISyndicatable\n from plone.dexterity.interfaces import IDexterityContent\n from plone.supermodel import model\n-from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.browser.syndication.adapters import (\n     CollectionFeed as BaseCollectionFeed,\n )\n@@ -34,7 +33,6 @@\n \n @provider(IFormFieldProvider, ISyndicatable)\n class ICollection(model.Schema):\n-\n     query = schema.List(\n         title=_("Search terms"),\n         description=_(\ndiff --git a/plone/app/contenttypes/behaviors/configure.zcml b/plone/app/contenttypes/behaviors/configure.zcml\nindex 92560d5eb..a0e836be0 100644\n--- a/plone/app/contenttypes/behaviors/configure.zcml\n+++ b/plone/app/contenttypes/behaviors/configure.zcml\n@@ -1,61 +1,65 @@\n <configure\n-  xmlns="http://namespaces.zope.org/zope"\n-  xmlns:browser="http://namespaces.zope.org/browser"\n-  xmlns:plone="http://namespaces.plone.org/plone"\n-  xmlns:zcml="http://namespaces.zope.org/zcml"\n-  i18n_domain="plone">\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n \n-  <include package="plone.behavior" file="meta.zcml"/>\n+  <include\n+      package="plone.behavior"\n+      file="meta.zcml"\n+      />\n \n   <plone:behavior\n-    name="plone.leadimage"\n-    title="Lead Image"\n-    description="Adds image and image caption fields"\n-    provides=".leadimage.ILeadImageBehavior"\n-    factory=".leadimage.LeadImage"\n-    for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".leadimage.ILeadImage"\n-    former_dotted_names="plone.app.contenttypes.behaviors.leadimage.ILeadImage"\n-    />\n+      name="plone.leadimage"\n+      title="Lead Image"\n+      description="Adds image and image caption fields"\n+      factory=".leadimage.LeadImage"\n+      provides=".leadimage.ILeadImageBehavior"\n+      for="plone.dexterity.interfaces.IDexterityContent"\n+      marker=".leadimage.ILeadImage"\n+      former_dotted_names="plone.app.contenttypes.behaviors.leadimage.ILeadImage"\n+      />\n \n   <browser:viewlet\n-    name="contentleadimage"\n-    for=".leadimage.ILeadImage"\n-    view="plone.app.layout.globals.interfaces.IViewView"\n-    class=".viewlets.LeadImageViewlet"\n-    manager="plone.app.layout.viewlets.interfaces.IAboveContentTitle"\n-    template="leadimage.pt"\n-    permission="zope2.View"\n-    />\n+      name="contentleadimage"\n+      for=".leadimage.ILeadImage"\n+      view="plone.app.layout.globals.interfaces.IViewView"\n+      manager="plone.app.layout.viewlets.interfaces.IAboveContentTitle"\n+      class=".viewlets.LeadImageViewlet"\n+      template="leadimage.pt"\n+      permission="zope2.View"\n+      />\n \n   <plone:behavior\n-    name="plone.tableofcontents"\n-    title="Table of contents"\n-    description="Adds a table of contents"\n-    provides=".tableofcontents.ITableOfContents"\n-    marker=".tableofcontents.ITableOfContents"\n-    />\n+      name="plone.tableofcontents"\n+      title="Table of contents"\n+      description="Adds a table of contents"\n+      provides=".tableofcontents.ITableOfContents"\n+      marker=".tableofcontents.ITableOfContents"\n+      />\n \n   <plone:behavior\n-    name="plone.collection"\n-    title="Collection"\n-    description="Adds collection behavior"\n-    provides=".collection.ICollection"\n-    factory=".collection.Collection"\n-    for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".collection.ISyndicatableCollection"\n-    />\n+      name="plone.collection"\n+      title="Collection"\n+      description="Adds collection behavior"\n+      factory=".collection.Collection"\n+      provides=".collection.ICollection"\n+      for="plone.dexterity.interfaces.IDexterityContent"\n+      marker=".collection.ISyndicatableCollection"\n+      />\n \n   <plone:behavior\n-    name="plone.richtext"\n-    title="RichText"\n-    description="Adds richtext behavior"\n-    provides=".richtext.IRichTextBehavior"\n-    factory=".richtext.RichText"\n-    for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".richtext.IRichText"\n-    former_dotted_names="plone.app.contenttypes.behaviors.richtext.IRichText"\n-    />\n+      name="plone.richtext"\n+      title="RichText"\n+      description="Adds richtext behavior"\n+      factory=".richtext.RichText"\n+      provides=".richtext.IRichTextBehavior"\n+      for="plone.dexterity.interfaces.IDexterityContent"\n+      marker=".richtext.IRichText"\n+      former_dotted_names="plone.app.contenttypes.behaviors.richtext.IRichText"\n+      />\n \n   <plone:behavior\n       name="plone.thumb_icon"\n@@ -65,20 +69,23 @@\n       />\n \n   <browser:page\n-    name="getText"\n-    for=".richtext.IRichText"\n-    class=".richtext.WidgetView"\n-    permission="zope2.View"\n-    template="richtext_gettext.pt"\n-    />\n+      name="getText"\n+      for=".richtext.IRichText"\n+      class=".richtext.WidgetView"\n+      template="richtext_gettext.pt"\n+      permission="zope2.View"\n+      />\n \n   <!-- Register the plone.app.vocabularies.MetadataFields under the old\n        name for backward compatibility. -->\n   <utility\n+      name="plone.app.contenttypes.metadatafields"\n       component="plone.app.vocabularies.metadatafields.MetaDataFieldsVocabularyFactory"\n-      name="plone.app.contenttypes.metadatafields" />\n+      />\n \n-  <adapter factory=".collection.CollectionFeed"\n-           for=".collection.ISyndicatableCollection" />\n+  <adapter\n+      factory=".collection.CollectionFeed"\n+      for=".collection.ISyndicatableCollection"\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/behaviors/leadimage.pt b/plone/app/contenttypes/behaviors/leadimage.pt\nindex 6becd24c5..c6ec0bf51 100644\n--- a/plone/app/contenttypes/behaviors/leadimage.pt\n+++ b/plone/app/contenttypes/behaviors/leadimage.pt\n@@ -1,9 +1,17 @@\n <section id="section-leadimage"\n-         tal:condition="view/available">\n-  <figure class="newsImageContainer" tal:define="images context/@@images">\n-      <img tal:replace="structure python: images.tag(\'image\', scale=\'large\', css_class=\'figure-img img-fluid\')" />\n-      <figcaption class="figure-caption" tal:condition="python: getattr(context, \'image_caption\', None)" tal:content="python: context.image_caption">\n+         tal:condition="view/available"\n+>\n+  <figure class="newsImageContainer"\n+          tal:define="\n+            images context/@@images;\n+          "\n+  >\n+    <img tal:replace="structure python: images.tag(\'image\', scale=\'large\', css_class=\'figure-img img-fluid\')" />\n+    <figcaption class="figure-caption"\n+                tal:condition="python: getattr(context, \'image_caption\', None)"\n+                tal:content="python: context.image_caption"\n+    >\n         Image caption\n-      </figcaption>\n+    </figcaption>\n   </figure>\n </section>\ndiff --git a/plone/app/contenttypes/behaviors/leadimage.py b/plone/app/contenttypes/behaviors/leadimage.py\nindex 5987d085d..486e3b076 100644\n--- a/plone/app/contenttypes/behaviors/leadimage.py\n+++ b/plone/app/contenttypes/behaviors/leadimage.py\n@@ -16,7 +16,6 @@ class ILeadImage(Interface):\n \n @provider(IFormFieldProvider)\n class ILeadImageBehavior(model.Schema):\n-\n     image = namedfile.NamedBlobImage(\n         title=_("label_leadimage", default="Lead Image"),\n         description="",\ndiff --git a/plone/app/contenttypes/behaviors/richtext.py b/plone/app/contenttypes/behaviors/richtext.py\nindex ab3f492c2..adc38d5f5 100644\n--- a/plone/app/contenttypes/behaviors/richtext.py\n+++ b/plone/app/contenttypes/behaviors/richtext.py\n@@ -20,7 +20,6 @@ class IRichText(Interface):\n \n @provider(IFormFieldProvider)\n class IRichTextBehavior(model.Schema):\n-\n     text = RichTextField(\n         title=_("Text"),\n         description="",\ndiff --git a/plone/app/contenttypes/behaviors/richtext_gettext.pt b/plone/app/contenttypes/behaviors/richtext_gettext.pt\nindex 2cfe2736e..666cbd9e2 100644\n--- a/plone/app/contenttypes/behaviors/richtext_gettext.pt\n+++ b/plone/app/contenttypes/behaviors/richtext_gettext.pt\n@@ -1 +1 @@\n-<div tal:replace="structure view/++widget++text/render" />\n\\ No newline at end of file\n+<div tal:replace="structure view/++widget++text/render"></div>\ndiff --git a/plone/app/contenttypes/behaviors/tableofcontents.py b/plone/app/contenttypes/behaviors/tableofcontents.py\nindex b4c7a6a59..156ae362d 100644\n--- a/plone/app/contenttypes/behaviors/tableofcontents.py\n+++ b/plone/app/contenttypes/behaviors/tableofcontents.py\n@@ -10,7 +10,6 @@\n \n @provider(IFormFieldProvider)\n class ITableOfContents(model.Schema):\n-\n     model.fieldset("settings", label=_("Settings"), fields=["table_of_contents"])\n \n     table_of_contents = schema.Bool(\ndiff --git a/plone/app/contenttypes/behaviors/thumb_icon.py b/plone/app/contenttypes/behaviors/thumb_icon.py\nindex 3ef985d21..3d10d9aae 100644\n--- a/plone/app/contenttypes/behaviors/thumb_icon.py\n+++ b/plone/app/contenttypes/behaviors/thumb_icon.py\n@@ -10,7 +10,6 @@\n \n @provider(IFormFieldProvider)\n class IThumbIconHandling(model.Schema):\n-\n     model.fieldset(\n         "settings",\n         label=_("Settings"),\ndiff --git a/plone/app/contenttypes/browser/configure.zcml b/plone/app/contenttypes/browser/configure.zcml\nindex df0a68817..ae3464175 100644\n--- a/plone/app/contenttypes/browser/configure.zcml\n+++ b/plone/app/contenttypes/browser/configure.zcml\n@@ -1,9 +1,10 @@\n <configure\n-  xmlns="http://namespaces.zope.org/zope"\n-  xmlns:browser="http://namespaces.zope.org/browser"\n-  xmlns:z3c="http://namespaces.zope.org/z3c"\n-  xmlns:zcml="http://namespaces.zope.org/zcml"\n-  i18n_domain="plone">\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:z3c="http://namespaces.zope.org/z3c"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n \n   <include package="plone.app.contentmenu" />\n \n@@ -11,7 +12,8 @@\n   <browser:pages\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class=".folder.FolderView"\n-      permission="zope2.View">\n+      permission="zope2.View"\n+      >\n     <browser:page\n         name="listing_view"\n         template="templates/listing.pt"\n@@ -49,7 +51,8 @@\n   <browser:pages\n       for="plone.dexterity.interfaces.IDexterityContainer"\n       class=".folder.FolderView"\n-      permission="zope2.View">\n+      permission="zope2.View"\n+      >\n     <browser:page\n         name="listing_view"\n         template="templates/listing.pt"\n@@ -99,7 +102,8 @@\n   <browser:pages\n       for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"\n       class=".collection.CollectionView"\n-      permission="zope2.View">\n+      permission="zope2.View"\n+      >\n     <browser:page\n         name="listing_view"\n         template="templates/listing.pt"\n@@ -139,14 +143,14 @@\n       for="*"\n       class=".full_view.FullViewItem"\n       template="templates/full_view_item.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       />\n   <browser:page\n       name="document_view"\n       template="templates/document.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View Document"\n       />\n@@ -155,8 +159,8 @@\n       for="plone.app.contenttypes.interfaces.IFile"\n       class=".file.FileView"\n       template="templates/file.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View File"\n       />\n@@ -164,8 +168,8 @@\n       name="image_view"\n       for="plone.app.contenttypes.interfaces.IImage"\n       template="templates/image.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View Image"\n       />\n@@ -173,8 +177,8 @@\n       name="image_view_fullscreen"\n       for="plone.app.contenttypes.interfaces.IImage"\n       template="templates/image_view_fullscreen.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View Image Fullscreen"\n       />\n@@ -182,8 +186,8 @@\n       name="link_redirect_view"\n       for="plone.app.contenttypes.interfaces.ILink"\n       class=".link_redirect_view.LinkRedirectView"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View Link"\n       />\n@@ -191,8 +195,8 @@\n       name="newsitem_view"\n       for="plone.app.contenttypes.interfaces.INewsItem"\n       template="templates/newsitem.pt"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       menu="plone_displayviews"\n       title="View News Item"\n       />\n@@ -201,21 +205,22 @@\n       for="*"\n       class=".utils.Utils"\n       allowed_interface="plone.app.contenttypes.browser.utils.IUtils"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="zope2.View"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       />\n \n   <browser:page\n       name="base_class_migrator_form"\n       for="plone.base.interfaces.IPloneSiteRoot"\n       class="plone.app.contenttypes.browser.migration.BaseClassMigrator"\n-      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       permission="cmf.ManagePortal"\n+      layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n       />\n \n   <utility\n       factory="plone.app.contenttypes.browser.migration.ChangedBaseClasses"\n+      provides="zope.schema.interfaces.IVocabularyFactory"\n       name="plone.app.contenttypes.migration.changed_base_classes"\n-      provides="zope.schema.interfaces.IVocabularyFactory" />\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py\nindex f6f00f25b..9bdac03b4 100644\n--- a/plone/app/contenttypes/browser/folder.py\n+++ b/plone/app/contenttypes/browser/folder.py\n@@ -21,7 +21,6 @@\n \n \n class FolderView(BrowserView):\n-\n     text_class = None\n     _plone_view = None\n     _portal_state = None\ndiff --git a/plone/app/contenttypes/browser/link_redirect_view.py b/plone/app/contenttypes/browser/link_redirect_view.py\nindex 9f15a725d..d780e96ad 100644\n--- a/plone/app/contenttypes/browser/link_redirect_view.py\n+++ b/plone/app/contenttypes/browser/link_redirect_view.py\n@@ -26,7 +26,6 @@\n \n \n class LinkRedirectView(BrowserView):\n-\n     index = ViewPageTemplateFile("templates/link.pt")\n \n     def _url_uses_scheme(self, schemes, url=None):\ndiff --git a/plone/app/contenttypes/browser/migration.py b/plone/app/contenttypes/browser/migration.py\nindex a6aa76e16..61354f405 100644\n--- a/plone/app/contenttypes/browser/migration.py\n+++ b/plone/app/contenttypes/browser/migration.py\n@@ -1,39 +1,22 @@\n-from plone.app.contenttypes.content import Document\n-from plone.app.contenttypes.content import File\n-from plone.app.contenttypes.content import Folder\n-from plone.app.contenttypes.content import Image\n-from plone.app.contenttypes.content import Link\n-from plone.app.contenttypes.content import NewsItem\n from plone.app.contenttypes.utils import changed_base_classes\n-from plone.app.contenttypes.utils import DEFAULT_TYPES\n from plone.app.contenttypes.utils import get_old_class_name_string\n from plone.app.contenttypes.utils import migrate_base_class_to_new_class\n from plone.base import PloneMessageFactory as _\n-from plone.base.utils import get_installer\n-from plone.browserlayer.interfaces import ILocalBrowserLayerType\n-from plone.dexterity.interfaces import IDexterityContent\n-from plone.dexterity.interfaces import IDexterityFTI\n from plone.z3cform.layout import wrap_form\n from Products.CMFCore.utils import getToolByName\n-from Products.Five.browser import BrowserView\n-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.statusmessages.interfaces import IStatusMessage\n from z3c.form import button\n from z3c.form import field\n from z3c.form import form\n from z3c.form.browser.checkbox import CheckBoxFieldWidget\n-from z3c.form.interfaces import HIDDEN_MODE\n from zExceptions import NotFound\n from zope import schema\n-from zope.component import getMultiAdapter\n-from zope.component import queryUtility\n from zope.interface import implementer\n from zope.interface import Interface\n from zope.schema.interfaces import IVocabularyFactory\n from zope.schema.vocabulary import SimpleVocabulary\n \n import logging\n-import pkg_resources\n \n \n logger = logging.getLogger(__name__)\n@@ -54,7 +37,6 @@ def __call__(self, context):\n \n \n class IBaseClassMigratorForm(Interface):\n-\n     changed_base_classes = schema.List(\n         title="Changed base classes (old class, new class and number of items)",\n         description="Select changed base classes you want to migrate. "\n@@ -68,7 +50,6 @@ class IBaseClassMigratorForm(Interface):\n \n \n class BaseClassMigratorForm(form.Form):\n-\n     label = _(\n         "heading_class_migrator",\n         default="Update base-classes for content with changed classes",\ndiff --git a/plone/app/contenttypes/browser/templates/document.pt b/plone/app/contenttypes/browser/templates/document.pt\nindex 93c1f19bc..5e4da56a3 100644\n--- a/plone/app/contenttypes/browser/templates/document.pt\n+++ b/plone/app/contenttypes/browser/templates/document.pt\n@@ -1,26 +1,33 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:content-core define-macro="content-core"\n-                    tal:define="toc python:  getattr(context, \'table_of_contents\', False);">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:content-core define-macro="content-core"\n+                          tal:define="\n+                            toc python:  getattr(context, \'table_of_contents\', False);\n+                          "\n+      >\n \n-  <section id="section-text">\n-    <div id="parent-fieldname-text" class="${python: toc and \'pat-autotoc\' or \'\'}"\n-         tal:condition="python:getattr(context, \'text\', None)"\n-         tal:content="structure python:context.text.output_relative_to(view.context)">\n+        <section id="section-text">\n+          <div class="${python: toc and \'pat-autotoc\' or \'\'}"\n+               id="parent-fieldname-text"\n+               tal:condition="python:getattr(context, \'text\', None)"\n+               tal:content="structure python:context.text.output_relative_to(view.context)"\n+          >\n       Text\n-    </div>\n-  </section>\n+          </div>\n+        </section>\n \n-</metal:content-core>\n-</metal:content-core>\n+      </metal:content-core>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/file.pt b/plone/app/contenttypes/browser/templates/file.pt\nindex ce81f8be6..845af29c4 100644\n--- a/plone/app/contenttypes/browser/templates/file.pt\n+++ b/plone/app/contenttypes/browser/templates/file.pt\n@@ -1,60 +1,89 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core"\n-             tal:define="content_type python: context.file.contentType;\n-                         filename python: context.file.filename;\n-                         mimetype_icon python: \'mimetype-\' + content_type;\n-                         download_url python: \'{}/@@download/file/{}\'.format(context.absolute_url(), filename)">\n-\n-  <section class="section section-main">\n-\n-    <div tal:condition="python: not view.is_videotype() and not view.is_audiotype()">\n-      <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-    </div>\n-\n-    <video class="w-100 mb-3" controls="controls" tal:condition="python: view.is_videotype()">\n-      <source src="${python:download_url}" type="${python:content_type}"></source>\n-      <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-      <div i18n:translate="embedded_video_not_supported" class="small text-muted">Sorry, your browser doesn\'t support embedded videos.</div>\n-    </video>\n-\n-    <audio class="w-100 mb-3" controls="controls" tal:condition="python:view.is_audiotype()">\n-      <source tal:attributes="src python: download_url; type python: content_type"></source>\n-      <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-      <div i18n:translate="embedded_audio_not_supported" class="small text-muted">Sorry, your browser doesn\'t support embedded audio.</div>\n-    </audio>\n-\n-    <div class="h5 mb-2">\n-      <a href="${python:download_url}" tal:content="python: filename">Filename</a>\n-    </div>\n-\n-    <div class="metadata d-flex justify-content-center text-muted small">\n-      <div class="px-2">\n-        <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n-        <span tal:replace="python: content_type">image/jpeg</span>\n-      </div>\n-      <div class="px-2">\n-        <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n-        <span tal:define="size python: view.human_readable_size()" tal:content="python: size">1000 kB</span>\n-      </div>\n-    </div>\n-\n-  </section>\n-\n-  <section class="section section-actions">\n-    <a class="btn btn-primary download" href="${python:download_url}" i18n:translate="">Download</a>\n-  </section>\n-\n-</metal:block>\n-</metal:content-core>\n-\n-</body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core"\n+                   tal:define="\n+                     content_type python: context.file.contentType;\n+                     filename python: context.file.filename;\n+                     mimetype_icon python: \'mimetype-\' + content_type;\n+                     download_url python: \'{}/@@download/file/{}\'.format(context.absolute_url(), filename);\n+                   "\n+      >\n+\n+        <section class="section section-main">\n+\n+          <div tal:condition="python: not view.is_videotype() and not view.is_audiotype()">\n+            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+          </div>\n+\n+          <video class="w-100 mb-3"\n+                 controls="controls"\n+                 tal:condition="python: view.is_videotype()"\n+          >\n+            <source src="${python:download_url}"\n+                    type="${python:content_type}"\n+            />\n+            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+            <div class="small text-muted"\n+                 i18n:translate="embedded_video_not_supported"\n+            >Sorry, your browser doesn\'t support embedded videos.</div>\n+          </video>\n+\n+          <audio class="w-100 mb-3"\n+                 controls="controls"\n+                 tal:condition="python:view.is_audiotype()"\n+          >\n+            <source tal:attributes="\n+                      src python: download_url;\n+                      type python: content_type;\n+                    " />\n+            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+            <div class="small text-muted"\n+                 i18n:translate="embedded_audio_not_supported"\n+            >Sorry, your browser doesn\'t support embedded audio.</div>\n+          </audio>\n+\n+          <div class="h5 mb-2">\n+            <a href="${python:download_url}"\n+               tal:content="python: filename"\n+            >Filename</a>\n+          </div>\n+\n+          <div class="metadata d-flex justify-content-center text-muted small">\n+            <div class="px-2">\n+              <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n+              <span tal:replace="python: content_type">image/jpeg</span>\n+            </div>\n+            <div class="px-2">\n+              <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n+              <span tal:define="\n+                      size python: view.human_readable_size();\n+                    "\n+                    tal:content="python: size"\n+              >1000 kB</span>\n+            </div>\n+          </div>\n+\n+        </section>\n+\n+        <section class="section section-actions">\n+          <a class="btn btn-primary download"\n+             href="${python:download_url}"\n+             i18n:translate=""\n+          >Download</a>\n+        </section>\n+\n+      </metal:block>\n+    </metal:content-core>\n+\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/full_view.pt b/plone/app/contenttypes/browser/templates/full_view.pt\nindex 898e2c9aa..dee5d8118 100644\n--- a/plone/app/contenttypes/browser/templates/full_view.pt\n+++ b/plone/app/contenttypes/browser/templates/full_view.pt\n@@ -1,31 +1,43 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core" tal:define="uuid context/@@uuid | nothing">\n-\n-  <metal:listing use-macro="context/@@listing_view/macros/content-core">\n-    <metal:entries fill-slot="entries">\n-\n-      <metal:block use-macro="context/@@listing_view/macros/entries">\n-\n-        <metal:entry fill-slot="entry" tal:condition="python: item.UID != uuid">\n-          <div tal:define="obj item/getObject;" tal:replace="structure obj/@@full_view_item | nothing" />\n-        </metal:entry>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core"\n+                   tal:define="\n+                     uuid context/@@uuid | nothing;\n+                   "\n+      >\n+\n+        <metal:listing use-macro="context/@@listing_view/macros/content-core">\n+          <metal:entries fill-slot="entries">\n+\n+            <metal:block use-macro="context/@@listing_view/macros/entries">\n+\n+              <metal:entry fill-slot="entry"\n+                           tal:condition="python: item.UID != uuid"\n+              >\n+                <div tal:define="\n+                       obj item/getObject;\n+                     "\n+                     tal:replace="structure obj/@@full_view_item | nothing"\n+                ></div>\n+              </metal:entry>\n+\n+            </metal:block>\n+\n+          </metal:entries>\n+        </metal:listing>\n \n       </metal:block>\n+    </metal:content-core>\n \n-    </metal:entries>\n-  </metal:listing>\n-\n-</metal:block>\n-</metal:content-core>\n-\n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/full_view_item.pt b/plone/app/contenttypes/browser/templates/full_view_item.pt\nindex 0f6565644..208207d2f 100644\n--- a/plone/app/contenttypes/browser/templates/full_view_item.pt\n+++ b/plone/app/contenttypes/browser/templates/full_view_item.pt\n@@ -1,67 +1,91 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    i18n:domain="plone"\n-    tal:omit-tag="">\n-<body tal:omit-tag="">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      xml:lang="en"\n+      tal:omit-tag=""\n+      i18n:domain="plone"\n+>\n+  <body tal:omit-tag="">\n \n-  <div class="item"\n-       tal:define="item_macro nocall:view/item_macros/content-core|nothing;\n-                   item_url view/item_url;\n-                   rendering_error python:[];">\n+    <div class="item"\n+         tal:define="\n+           item_macro nocall:view/item_macros/content-core|nothing;\n+           item_url view/item_url;\n+           rendering_error python:[];\n+         "\n+    >\n \n-    <div tal:replace="structure provider:plone.abovecontenttitle" />\n+      <div tal:replace="structure provider:plone.abovecontenttitle"></div>\n \n-    <h1>\n-      <a class="summary url" tal:content="context/Title" tal:attributes="href item_url;">\n+      <h1>\n+        <a class="summary url"\n+           tal:content="context/Title"\n+           tal:attributes="\n+             href item_url;\n+           "\n+        >\n         Title\n-      </a>\n-    </h1>\n+        </a>\n+      </h1>\n \n-    <div tal:replace="structure provider:plone.belowcontenttitle" />\n+      <div tal:replace="structure provider:plone.belowcontenttitle"></div>\n \n-    <p class="lead" tal:content="context/Description" tal:condition="context/Description">\n+      <p class="lead"\n+         tal:condition="context/Description"\n+         tal:content="context/Description"\n+      >\n       Description\n-    </p>\n+      </p>\n \n-    <section id="section-item" class="mb-5" tal:condition="item_macro">\n+      <section class="mb-5"\n+               id="section-item"\n+               tal:condition="item_macro"\n+      >\n \n-      <div tal:replace="structure provider:plone.abovecontentbody" />\n+        <div tal:replace="structure provider:plone.abovecontentbody"></div>\n \n-      <div tal:define="view nocall:view/default_view;\n-                       plone_view context/@@plone;\n-                       icons python:context.restrictedTraverse(\'@@iconresolver\');\n-                       portal_state context/@@plone_portal_state;\n-                       context_state context/@@plone_context_state;\n-                       plone_layout context/@@plone_layout;\n-                       lang portal_state/language;\n-                       dummy python: plone_layout.mark_view(view);\n-                       portal_url portal_state/portal_url;\n-                       checkPermission nocall: context/portal_membership/checkPermission;\n-                       site_properties context/portal_properties/site_properties;">\n+        <div tal:define="\n+               view nocall:view/default_view;\n+               plone_view context/@@plone;\n+               icons python:context.restrictedTraverse(\'@@iconresolver\');\n+               portal_state context/@@plone_portal_state;\n+               context_state context/@@plone_context_state;\n+               plone_layout context/@@plone_layout;\n+               lang portal_state/language;\n+               dummy python: plone_layout.mark_view(view);\n+               portal_url portal_state/portal_url;\n+               checkPermission nocall: context/portal_membership/checkPermission;\n+               site_properties context/portal_properties/site_properties;\n+             ">\n \n-        <div metal:use-macro="item_macro">\n+          <div metal:use-macro="item_macro">\n           content\n-        </div>\n+          </div>\n \n-      </div>\n+        </div>\n \n-      <div tal:replace="structure provider:plone.belowcontentbody" />\n+        <div tal:replace="structure provider:plone.belowcontentbody"></div>\n \n-    </section>\n+      </section>\n \n-    <tal:block tal:condition="rendering_error">\n-      <!-- Error rendering item macro -->\n-    </tal:block>\n+      <tal:block tal:condition="rendering_error">\n+        <!-- Error rendering item macro -->\n+      </tal:block>\n \n-    <p class="more" tal:condition="python:not(item_macro) or rendering_error">\n-      <a tal:attributes="href item_url" i18n:translate="read_more">\n+      <p class="more"\n+         tal:condition="python:not(item_macro) or rendering_error"\n+      >\n+        <a tal:attributes="\n+             href item_url;\n+           "\n+           i18n:translate="read_more"\n+        >\n         Read More&hellip;\n-      </a>\n-    </p>\n+        </a>\n+      </p>\n \n-  </div>\n-</body>\n+    </div>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/image.pt b/plone/app/contenttypes/browser/templates/image.pt\nindex 2a4459a9e..b2f4d397d 100644\n--- a/plone/app/contenttypes/browser/templates/image.pt\n+++ b/plone/app/contenttypes/browser/templates/image.pt\n@@ -1,65 +1,88 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core"\n-             tal:define="content_type python: context.image.contentType;\n-                         size context/image/getSize;\n-                         image_dimension context/image/getImageSize;\n-                         use_MB python: size > 1024*1024;\n-                         dimension python: str(image_dimension[0])+\'x\'+str(image_dimension[1]);\n-                         filename python: context.image.filename;\n-                         mimetype_icon python: \'mimetype-\' + content_type;\n-                         download_url python: \'{}/@@download/image/{}\'.format(context.absolute_url(), filename)\n-                                                     ">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core"\n+                   tal:define="\n+                     content_type python: context.image.contentType;\n+                     size context/image/getSize;\n+                     image_dimension context/image/getImageSize;\n+                     use_MB python: size &gt; 1024*1024;\n+                     dimension python: str(image_dimension[0])+\'x\'+str(image_dimension[1]);\n+                     filename python: context.image.filename;\n+                     mimetype_icon python: \'mimetype-\' + content_type;\n+                     download_url python: \'{}/@@download/image/{}\'.format(context.absolute_url(), filename);\n+                   "\n+      >\n \n-  <section class="section section-main">\n-    <figure class="figure">\n-      <a tal:attributes="href string:${context/@@plone_context_state/object_url}/image_view_fullscreen"\n-         tal:define="scale context/@@images; img_tag python:scale.tag(\'image\', scale=\'large\', css_class=\'figure-img img-fluid\')"\n-         tal:on-error="string: Image cannot be displayed">\n-        <img tal:replace="structure img_tag" />\n-      </a>\n-    </figure>\n+        <section class="section section-main">\n+          <figure class="figure">\n+            <a tal:define="\n+                 scale context/@@images;\n+                 img_tag python:scale.tag(\'image\', scale=\'large\', css_class=\'figure-img img-fluid\');\n+               "\n+               tal:attributes="\n+                 href string:${context/@@plone_context_state/object_url}/image_view_fullscreen;\n+               "\n+               tal:on-error="string: Image cannot be displayed"\n+            >\n+              <img tal:replace="structure img_tag" />\n+            </a>\n+          </figure>\n \n-    <div class="h5 mb-2">\n-      <a href="${python:download_url}" tal:content="python: filename">Filename</a>\n-    </div>\n-    <div class="metadata d-flex justify-content-center text-muted small">\n-      <div class="px-2">\n-        <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n-        <span i18n:translate="image_kind_label" class="d-none">Type</span>\n-        <span tal:replace="python: content_type">image/jpeg</span>\n-      </div>\n-      <div class="px-2">\n-        <tal:icon tal:replace="structure python:icons.tag(\'aspect-ratio\', tag_class=\'icon-inline\', tag_alt=\'Dimension\')" />\n-        <span i18n:translate="image_dimension_label" class="d-none">Dimension</span>\n-        <span tal:replace="python: dimension">400x300</span>\n-      </div>\n-      <div class="px-2">\n-        <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n-        <span i18n:translate="image_size_label" class="d-none">File size</span>\n-        <tal:MB condition="use_MB">${python:round(size/1024/1024, 1)} MB</tal:MB>\n-        <tal:KB condition="not: use_MB">${python:round(size/1024, 1)} KB</tal:KB>\n-      </div>\n-    </div>\n+          <div class="h5 mb-2">\n+            <a href="${python:download_url}"\n+               tal:content="python: filename"\n+            >Filename</a>\n+          </div>\n+          <div class="metadata d-flex justify-content-center text-muted small">\n+            <div class="px-2">\n+              <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n+              <span class="d-none"\n+                    i18n:translate="image_kind_label"\n+              >Type</span>\n+              <span tal:replace="python: content_type">image/jpeg</span>\n+            </div>\n+            <div class="px-2">\n+              <tal:icon tal:replace="structure python:icons.tag(\'aspect-ratio\', tag_class=\'icon-inline\', tag_alt=\'Dimension\')" />\n+              <span class="d-none"\n+                    i18n:translate="image_dimension_label"\n+              >Dimension</span>\n+              <span tal:replace="python: dimension">400x300</span>\n+            </div>\n+            <div class="px-2">\n+              <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n+              <span class="d-none"\n+                    i18n:translate="image_size_label"\n+              >File size</span>\n+              <tal:mb condition="use_MB">${python:round(size/1024/1024, 1)} MB</tal:mb>\n+              <tal:kb condition="not: use_MB">${python:round(size/1024, 1)} KB</tal:kb>\n+            </div>\n+          </div>\n \n-  </section>\n+        </section>\n \n-  <section class="section section-actions">\n-    <a class="btn btn-primary download" href="${python:download_url}" i18n:translate="">Download</a>\n-    <a class="btn btn-primary fullscreen" href="${context/@@plone_context_state/object_url}/image_view_fullscreen"><span i18n:translate="label_click_to_view_full_image">View full-size image</span></a>\n-  </section>\n+        <section class="section section-actions">\n+          <a class="btn btn-primary download"\n+             href="${python:download_url}"\n+             i18n:translate=""\n+          >Download</a>\n+          <a class="btn btn-primary fullscreen"\n+             href="${context/@@plone_context_state/object_url}/image_view_fullscreen"\n+          ><span i18n:translate="label_click_to_view_full_image">View full-size image</span></a>\n+        </section>\n \n \n-</metal:block>\n-</metal:content-core>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/image_view_fullscreen.pt b/plone/app/contenttypes/browser/templates/image_view_fullscreen.pt\nindex 6f72ad1b6..828d0ad92 100644\n--- a/plone/app/contenttypes/browser/templates/image_view_fullscreen.pt\n+++ b/plone/app/contenttypes/browser/templates/image_view_fullscreen.pt\n@@ -1,15 +1,23 @@\n <!DOCTYPE html>\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    i18n:domain="plone">\n-<head>\n-  <metal:block tal:define="dummy python:request.RESPONSE.setHeader(\'Content-Type\', \'text/html;;charset=utf-8\')" />\n-  <meta name="viewport" content="width=device-width, initial-scale=1">\n-  <title tal:content="context/Title">Title</title>\n-  <style type="text/css" media="screen">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <head>\n+    <metal:block tal:define="\n+                   dummy python:request.RESPONSE.setHeader(\'Content-Type\', \'text/html;;charset=utf-8\');\n+                 " />\n+    <meta name="viewport"\n+          content="width=device-width, initial-scale=1"\n+    />\n+    <title tal:content="context/Title">Title</title>\n+    <style media="screen"\n+           type="text/css"\n+    >\n \n     body {\n       font-family: Helvetica, Arial, sans-serif;\n@@ -42,24 +50,36 @@\n       height: auto;\n     }\n \n-  </style>\n-</head>\n+    </style>\n+  </head>\n \n-<body>\n-  <div id="content-core" tal:condition="context/@@images">\n-    <tal:block define="referer request/HTTP_REFERER;\n-                       url_tool nocall:context/portal_url;\n-                       referer python:referer if referer and url_tool.isURLInPortal(referer) else \'\';">\n-    <a tal:attributes="href referer" tal:condition="referer">\n-      <tal:block replace="structure context/@@images/image" />\n-      <span i18n:translate="label_back_to_site">Back to site</span>\n-    </a>\n-    <a tal:attributes="href python:url_tool()" tal:condition="not: referer">\n-      <tal:block replace="structure context/@@images/image" />\n-      <span i18n:translate="label_home">Home</span>\n-    </a>\n-  </tal:block>\n-  </div>\n-</body>\n+  <body>\n+    <div id="content-core"\n+         tal:condition="context/@@images"\n+    >\n+      <tal:block define="\n+                   referer request/HTTP_REFERER;\n+                   url_tool nocall:context/portal_url;\n+                   referer python:referer if referer and url_tool.isURLInPortal(referer) else \'\';\n+                 ">\n+        <a tal:condition="referer"\n+           tal:attributes="\n+             href referer;\n+           "\n+        >\n+          <tal:block replace="structure context/@@images/image" />\n+          <span i18n:translate="label_back_to_site">Back to site</span>\n+        </a>\n+        <a tal:condition="not: referer"\n+           tal:attributes="\n+             href python:url_tool();\n+           "\n+        >\n+          <tal:block replace="structure context/@@images/image" />\n+          <span i18n:translate="label_home">Home</span>\n+        </a>\n+      </tal:block>\n+    </div>\n+  </body>\n \n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/link.pt b/plone/app/contenttypes/browser/templates/link.pt\nindex 36f3a1324..f6ff2d317 100644\n--- a/plone/app/contenttypes/browser/templates/link.pt\n+++ b/plone/app/contenttypes/browser/templates/link.pt\n@@ -1,51 +1,69 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core"\n-             tal:define="external python:view.url().startswith(\'http\');\n-                         mail python:view.url().startswith(\'mailto\');\n-                         link python: not external and not mail;\n-                         display_link python: view.display_link()">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core"\n+                   tal:define="\n+                     external python:view.url().startswith(\'http\');\n+                     mail python:view.url().startswith(\'mailto\');\n+                     link python: not external and not mail;\n+                     display_link python: view.display_link();\n+                   "\n+      >\n \n \n-  <section class="section section-main">\n-    <div>\n-      <tal:icon tal:condition="link"\n-        tal:replace="structure python:icons.tag(\'plone-link\', tag_class=\'icon-x4 mb-2\')" />\n-      <tal:icon tal:condition="external"\n-        tal:replace="structure python:icons.tag(\'plone-link/external\', tag_class=\'icon-x4 mb-2\')" />\n-      <tal:icon tal:condition="mail"\n-        tal:replace="structure python:icons.tag(\'plone-link/mail\', tag_class=\'icon-x4 mb-2\')" />\n-    </div>\n-    <div class="h5 mb-2">\n-      <a href="" tal:attributes="href python: view.absolute_target_url()" \n-         tal:content="python: display_link[\'title\']">remote url</a>\n-    </div>\n-    <div class="metadata d-flex justify-content-center text-muted small"\n-        tal:condition="python: display_link[\'meta\']">\n-      <div tal:replace="python: display_link[\'meta\']"></div>\n-    </div>\n+        <section class="section section-main">\n+          <div>\n+            <tal:icon tal:condition="link"\n+                      tal:replace="structure python:icons.tag(\'plone-link\', tag_class=\'icon-x4 mb-2\')"\n+            />\n+            <tal:icon tal:condition="external"\n+                      tal:replace="structure python:icons.tag(\'plone-link/external\', tag_class=\'icon-x4 mb-2\')"\n+            />\n+            <tal:icon tal:condition="mail"\n+                      tal:replace="structure python:icons.tag(\'plone-link/mail\', tag_class=\'icon-x4 mb-2\')"\n+            />\n+          </div>\n+          <div class="h5 mb-2">\n+            <a href=""\n+               tal:content="python: display_link[\'title\']"\n+               tal:attributes="\n+                 href python: view.absolute_target_url();\n+               "\n+            >remote url</a>\n+          </div>\n+          <div class="metadata d-flex justify-content-center text-muted small"\n+               tal:condition="python: display_link[\'meta\']"\n+          >\n+            <div tal:replace="python: display_link[\'meta\']"></div>\n+          </div>\n \n-    <div class="info-redirect small text-muted mt-4" \n-      tal:define="redirect_links python:context.portal_registry[\'plone.redirect_links\']" \n-      tal:condition="python: redirect_links and checkPermission(\'Modify portal content\', context)">\n-      <span tal:omit-tag="" i18n:translate="message_permissions_blocking_link_redirect">\n+          <div class="info-redirect small text-muted mt-4"\n+               tal:define="\n+                 redirect_links python:context.portal_registry[\'plone.redirect_links\'];\n+               "\n+               tal:condition="python: redirect_links and checkPermission(\'Modify portal content\', context)"\n+          >\n+            <span tal:omit-tag=""\n+                  i18n:translate="message_permissions_blocking_link_redirect"\n+            >\n         You see this page because you have permission to edit this link.\n         Others will be immediately redirected to the link\'s target URL.\n-      </span>\n-    </div>\n+            </span>\n+          </div>\n \n-  </section>\n+        </section>\n \n-</metal:block>\n-</metal:content-core>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/listing.pt b/plone/app/contenttypes/browser/templates/listing.pt\nindex c2088d372..9e2d7553f 100644\n--- a/plone/app/contenttypes/browser/templates/listing.pt\n+++ b/plone/app/contenttypes/browser/templates/listing.pt\n@@ -1,148 +1,194 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core">\n-\n-  <div metal:define-macro="text-field-view"\n-      id="parent-fieldname-text" class="stx"\n-      tal:define="text python:view.text"\n-      tal:condition="python:text"\n-      tal:attributes="class python:view.text_class">\n-    <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n-  </div>\n-\n-\n-  <metal:listingmacro define-macro="listing">\n-    <tal:results define="batch python:view.batch();\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core">\n+\n+        <div class="stx"\n+             id="parent-fieldname-text"\n+             metal:define-macro="text-field-view"\n+             tal:define="\n+               text python:view.text;\n+             "\n+             tal:condition="python:text"\n+             tal:attributes="\n+               class python:view.text_class;\n+             "\n+        >\n+          <div metal:define-slot="inside"\n+               tal:replace="structure text"\n+          >The body</div>\n+        </div>\n+\n+\n+        <metal:listingmacro define-macro="listing">\n+          <tal:results define="\n+                         batch python:view.batch();\n                          thumb_scale_list python:view.get_thumb_scale_list();\n                          thumb_scale_table python:view.get_thumb_scale_table();\n                          thumb_scale_summary python:view.get_thumb_scale_summary();\n                          img_class python:\'thumb-{} image-responsive\'.format(thumb_scale_list);\n-                         showicons python:view.show_icons()">\n-      <tal:listing condition="python:batch">\n-        <div class="entries" metal:define-slot="entries"\n-            tal:define="portal python:portal_state.portal();\n-                        image_scale portal/@@image_scale">\n-\n-          <tal:repeat repeat="item python:batch" metal:define-macro="entries">\n-            <tal:block tal:define="obj python:item.getObject();\n-                item_url python:item.getURL();\n-                item_id python:item.getId();\n-                item_title python:item.Title();\n-                item_title python:item_title or item_id;\n-                item_description python:item.Description();\n-                item_type python:item.PortalType();\n-                item_modified python:item.ModificationDate();\n-                item_created python:item.CreationDate();\n-                item_wf_state python:item.review_state();\n-                item_wf_state_class python:\'state-\' + view.normalizeString(item_wf_state);\n-                item_creator python:item.Creator();\n-                item_link python:item_type in view.use_view_action and item_url+\'/view\' or item_url;\n-                item_is_event python:view.is_event(obj);\n-                item_has_image python:item.getIcon;\n-                item_type_class python:(\'contenttype-\' + view.normalizeString(item_type)) if showicons else \'\' ;\n-                ">\n-              <metal:block define-slot="entry">\n-\n-                <article class="mb-3 row">\n-\n-                  <div class="col" metal:define-macro="listitem">\n-\n-                      <div class="mb-1">\n-                        <a tal:attributes="href python:item_link; class string:$item_type_class $item_wf_state_class url; title item_type" tal:content="python:item_title">\n+                         showicons python:view.show_icons();\n+                       ">\n+            <tal:listing condition="python:batch">\n+              <div class="entries"\n+                   metal:define-slot="entries"\n+                   tal:define="\n+                     portal python:portal_state.portal();\n+                     image_scale portal/@@image_scale;\n+                   "\n+              >\n+\n+                <tal:repeat metal:define-macro="entries"\n+                            repeat="item python:batch"\n+                >\n+                  <tal:block tal:define="\n+                               obj python:item.getObject();\n+                               item_url python:item.getURL();\n+                               item_id python:item.getId();\n+                               item_title python:item.Title();\n+                               item_title python:item_title or item_id;\n+                               item_description python:item.Description();\n+                               item_type python:item.PortalType();\n+                               item_modified python:item.ModificationDate();\n+                               item_created python:item.CreationDate();\n+                               item_wf_state python:item.review_state();\n+                               item_wf_state_class python:\'state-\' + view.normalizeString(item_wf_state);\n+                               item_creator python:item.Creator();\n+                               item_link python:item_type in view.use_view_action and item_url+\'/view\' or item_url;\n+                               item_is_event python:view.is_event(obj);\n+                               item_has_image python:item.getIcon;\n+                               item_type_class python:(\'contenttype-\' + view.normalizeString(item_type)) if showicons else \'\';\n+                             ">\n+                    <metal:block define-slot="entry">\n+\n+                      <article class="mb-3 row">\n+\n+                        <div class="col"\n+                             metal:define-macro="listitem"\n+                        >\n+\n+                          <div class="mb-1">\n+                            <a tal:content="python:item_title"\n+                               tal:attributes="\n+                                 href python:item_link;\n+                                 class string:$item_type_class $item_wf_state_class url;\n+                                 title item_type;\n+                               "\n+                            >\n                           Item Title\n-                        </a>\n-                      </div>\n+                            </a>\n+                          </div>\n \n-                      <metal:block metal:define-macro="document_byline">\n-                      <div class="mb-1">\n+                          <metal:block metal:define-macro="document_byline">\n+                            <div class="mb-1">\n \n-                        <tal:event condition="python:item_is_event">\n-                          <tal:date tal:replace="structure python:view.formatted_date(obj)"/>\n-                          <span tal:condition="python:obj.location" i18n:translate="label_event_byline_location">\n+                              <tal:event condition="python:item_is_event">\n+                                <tal:date tal:replace="structure python:view.formatted_date(obj)" />\n+                                <span tal:condition="python:obj.location"\n+                                      i18n:translate="label_event_byline_location"\n+                                >\n                             &mdash;\n-                            <span tal:content="python:obj.location" class="location" i18n:name="location">Oslo</span>\n-                          </span>\n+                                  <span class="location"\n+                                        tal:content="python:obj.location"\n+                                        i18n:name="location"\n+                                  >Oslo</span>\n+                                </span>\n                           &mdash;\n-                        </tal:event>\n-\n-                        <tal:byline condition="python:view.show_about">\n-                          <tal:name tal:condition="python:item_creator"\n-                              tal:define="author python:view.pas_member.info(item_creator);\n-                                          creator_short_form python:author.get(\'username\');\n-                                          creator_long_form string:?author=$${python:author.username};\n-                                          creator_is_openid python:\'/\' in creator_short_form;\n-                                          creator_id python:(creator_short_form, creator_long_form)[creator_is_openid];">\n-                          <span i18n:translate="label_by_author">\n+                              </tal:event>\n+\n+                              <tal:byline condition="python:view.show_about">\n+                                <tal:name tal:define="\n+                                            author python:view.pas_member.info(item_creator);\n+                                            creator_short_form python:author.get(\'username\');\n+                                            creator_long_form string:?author=$${python:author.username};\n+                                            creator_is_openid python:\'/\' in creator_short_form;\n+                                            creator_id python:(creator_short_form, creator_long_form)[creator_is_openid];\n+                                          "\n+                                          tal:condition="python:item_creator"\n+                                >\n+                                  <span i18n:translate="label_by_author">\n                             by\n-                            <a tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"\n-                                tal:content="python: author.get(\'name_or_id\')"\n-                                tal:omit-tag="python: not author"\n-                                i18n:name="author">\n+                                    <a tal:content="python: author.get(\'name_or_id\')"\n+                                       tal:omit-tag="python: not author"\n+                                       tal:attributes="\n+                                         href string:${view/navigation_root_url}/author/${item_creator};\n+                                       "\n+                                       i18n:name="author"\n+                                    >\n                               Bob Dobalina\n-                            </a>\n-                          </span>\n-                          </tal:name>\n+                                    </a>\n+                                  </span>\n+                                </tal:name>\n \n-                          <tal:modified condition="python:item_type != \'Event\'">\n+                                <tal:modified condition="python:item_type != \'Event\'">\n                             &mdash;\n-                            <tal:mod i18n:translate="box_last_modified">last modified</tal:mod>\n-                            <span tal:replace="python:view.toLocalizedTime(item_modified,long_format=1)">\n+                                  <tal:mod i18n:translate="box_last_modified">last modified</tal:mod>\n+                                  <span tal:replace="python:view.toLocalizedTime(item_modified,long_format=1)">\n                               August 16, 2001 at 23:35:59\n-                            </span>\n-                          </tal:modified>\n+                                  </span>\n+                                </tal:modified>\n \n-                          <metal:description define-slot="description_slot">\n-                            <tal:comment replace="nothing">\n+                                <metal:description define-slot="description_slot">\n+                                  <tal:comment replace="nothing">\n                               Place custom listing info for custom types here\n-                            </tal:comment>\n-                          </metal:description>\n+                                  </tal:comment>\n+                                </metal:description>\n \n-                        </tal:byline>\n-                      </div>\n-                      </metal:block>\n+                              </tal:byline>\n+                            </div>\n+                          </metal:block>\n \n-                      <p class="me-3" tal:condition="python:item_description" tal:content="python:item_description">\n+                          <p class="me-3"\n+                             tal:condition="python:item_description"\n+                             tal:content="python:item_description"\n+                          >\n                         description\n-                      </p>\n-                  </div>\n-\n-                  <div class="col-3 text-end" tal:condition="python:item_has_image and thumb_scale_list">\n-                    <a tal:attributes="href python:item_link;">\n-                      <img tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_list, css_class=img_class, loading=\'lazy\')" />\n-                    </a>\n-                  </div>\n-                </article>\n-\n-              </metal:block>\n-            </tal:block>\n-          </tal:repeat>\n-        </div>\n-\n-        <div metal:use-macro="context/batch_macros/macros/navigation" />\n-\n-      </tal:listing>\n-\n-      <metal:empty metal:define-slot="no_items_in_listing">\n-        <p class="discreet"\n-            tal:condition="python: not batch"\n-            tal:content="python: view.no_items_message">\n+                          </p>\n+                        </div>\n+\n+                        <div class="col-3 text-end"\n+                             tal:condition="python:item_has_image and thumb_scale_list"\n+                        >\n+                          <a tal:attributes="\n+                               href python:item_link;\n+                             ">\n+                            <img tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_list, css_class=img_class, loading=\'lazy\')" />\n+                          </a>\n+                        </div>\n+                      </article>\n+\n+                    </metal:block>\n+                  </tal:block>\n+                </tal:repeat>\n+              </div>\n+\n+              <div metal:use-macro="context/batch_macros/macros/navigation"></div>\n+\n+            </tal:listing>\n+\n+            <metal:empty metal:define-slot="no_items_in_listing">\n+              <p class="discreet"\n+                 tal:condition="python: not batch"\n+                 tal:content="python: view.no_items_message"\n+              >\n           There are currently no items in this folder.\n-        </p>\n-      </metal:empty>\n+              </p>\n+            </metal:empty>\n \n-    </tal:results>\n-  </metal:listingmacro>\n+          </tal:results>\n+        </metal:listingmacro>\n \n-</metal:block>\n-</metal:content-core>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/listing_album.pt b/plone/app/contenttypes/browser/templates/listing_album.pt\nindex 6774f6066..70561c0e6 100644\n--- a/plone/app/contenttypes/browser/templates/listing_album.pt\n+++ b/plone/app/contenttypes/browser/templates/listing_album.pt\n@@ -1,67 +1,124 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="here/main_template/macros/master"\n-      i18n:domain="plone">\n-<body>\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:main_macro define-macro="content-core" tal:define="images view/album_images; albums view/album_folders">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:main_macro define-macro="content-core"\n+                        tal:define="\n+                          images view/album_images;\n+                          albums view/album_folders;\n+                        "\n+      >\n \n-  <div metal:define-macro="text-field-view" id="parent-fieldname-text" class="stx" tal:define="text view/text" tal:condition="text" tal:attributes="class view/text_class">\n-    <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n-  </div>\n+        <div class="stx"\n+             id="parent-fieldname-text"\n+             metal:define-macro="text-field-view"\n+             tal:define="\n+               text view/text;\n+             "\n+             tal:condition="text"\n+             tal:attributes="\n+               class view/text_class;\n+             "\n+        >\n+          <div metal:define-slot="inside"\n+               tal:replace="structure text"\n+          >The body</div>\n+        </div>\n \n-  <metal:listingmacro define-macro="listing" tal:define="portal context/@@plone_portal_state/portal; image_scale portal/@@image_scale">\n+        <metal:listingmacro define-macro="listing"\n+                            tal:define="\n+                              portal context/@@plone_portal_state/portal;\n+                              image_scale portal/@@image_scale;\n+                            "\n+        >\n \n-  <div class="row">\n+          <div class="row">\n \n-  <tal:images tal:repeat="image images">\n-    <div class="col mb-5">\n-      <div class="card h-100">\n-        <div tal:define="scale python:image_scale.tag(image, \'image\', scale=\'mini\', loading=\'lazy\')" tal:condition="scale" class="card-image d-flex justify-content-center align-items-center" style="height: 14rem;">\n-          <img tal:replace="structure scale" />\n-        </div>\n-        <div class="card-body">\n-          <h5 class="card-title" tal:content="image/Title">Image title</h5>\n-          <p class="card-text" tal:content="image/Description">Description</p>\n-          <a class="card-link stretched-link" tal:attributes="href string:${image/getURL}/view; title image/Description" i18n:translate="label_view">View</a>\n-        </div>\n-      </div>\n-    </div>\n-  </tal:images>\n+            <tal:images tal:repeat="image images">\n+              <div class="col mb-5">\n+                <div class="card h-100">\n+                  <div class="card-image d-flex justify-content-center align-items-center"\n+                       style="height: 14rem;"\n+                       tal:define="\n+                         scale python:image_scale.tag(image, \'image\', scale=\'mini\', loading=\'lazy\');\n+                       "\n+                       tal:condition="scale"\n+                  >\n+                    <img tal:replace="structure scale" />\n+                  </div>\n+                  <div class="card-body">\n+                    <h5 class="card-title"\n+                        tal:content="image/Title"\n+                    >Image title</h5>\n+                    <p class="card-text"\n+                       tal:content="image/Description"\n+                    >Description</p>\n+                    <a class="card-link stretched-link"\n+                       tal:attributes="\n+                         href string:${image/getURL}/view;\n+                         title image/Description;\n+                       "\n+                       i18n:translate="label_view"\n+                    >View</a>\n+                  </div>\n+                </div>\n+              </div>\n+            </tal:images>\n \n-  <tal:albums tal:repeat="album albums">\n-    <div class="col mb-5">\n-      <div class="card album h-100">\n-        <div tal:define="scale python:image_scale.tag(album, \'image\', scale=\'mini\', loading=\'lazy\') if getattr(album, \'image\', None) else None"\n-         tal:condition="scale" class="card-image d-flex justify-content-center align-items-center" style="height: 14rem;">\n-          <img tal:replace="structure scale" />\n-        </div>\n-        <div class="card-body">\n-          <h5 class="card-title" tal:content="album/Title">Image title</h5>\n-          <p class="card-text" tal:content="album/Description">Description</p>\n-          <a class="card-link stretched-link" tal:attributes="href string:${album/getURL}/view; title album/Description" i18n:translate="label_view">View</a>\n-        </div>\n-      </div>\n-    </div>\n-  </tal:albums>\n+            <tal:albums tal:repeat="album albums">\n+              <div class="col mb-5">\n+                <div class="card album h-100">\n+                  <div class="card-image d-flex justify-content-center align-items-center"\n+                       style="height: 14rem;"\n+                       tal:define="\n+                         scale python:image_scale.tag(album, \'image\', scale=\'mini\', loading=\'lazy\') if getattr(album, \'image\', None) else None;\n+                       "\n+                       tal:condition="scale"\n+                  >\n+                    <img tal:replace="structure scale" />\n+                  </div>\n+                  <div class="card-body">\n+                    <h5 class="card-title"\n+                        tal:content="album/Title"\n+                    >Image title</h5>\n+                    <p class="card-text"\n+                       tal:content="album/Description"\n+                    >Description</p>\n+                    <a class="card-link stretched-link"\n+                       tal:attributes="\n+                         href string:${album/getURL}/view;\n+                         title album/Description;\n+                       "\n+                       i18n:translate="label_view"\n+                    >View</a>\n+                  </div>\n+                </div>\n+              </div>\n+            </tal:albums>\n \n-  </div>\n+          </div>\n \n-  <div metal:use-macro="context/batch_macros/macros/navigation" />\n+          <div metal:use-macro="context/batch_macros/macros/navigation"></div>\n \n-  <metal:empty metal:define-slot="no_items_in_listing">\n-    <p tal:condition="python: not images and not albums" tal:content="view/no_items_message">\n+          <metal:empty metal:define-slot="no_items_in_listing">\n+            <p tal:condition="python: not images and not albums"\n+               tal:content="view/no_items_message"\n+            >\n       There are currently no items in this folder.\n-    </p>\n-  </metal:empty>\n-  </metal:listingmacro>\n+            </p>\n+          </metal:empty>\n+        </metal:listingmacro>\n \n-</metal:main_macro>\n-</metal:content-core>\n+      </metal:main_macro>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/listing_summary.pt b/plone/app/contenttypes/browser/templates/listing_summary.pt\nindex b11a43d63..fec35e619 100644\n--- a/plone/app/contenttypes/browser/templates/listing_summary.pt\n+++ b/plone/app/contenttypes/browser/templates/listing_summary.pt\n@@ -1,67 +1,91 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core">\n-\n-<metal:block use-macro="context/@@listing_view/macros/content-core">\n-\n-  <metal:entries fill-slot="entries">\n-    <metal:block use-macro="context/@@listing_view/macros/entries" tal:define="portal context/@@plone_portal_state/portal; image_scale portal/@@image_scale">\n-\n-      <metal:entry fill-slot="entry">\n-\n-        <article class="row mb-3">\n-\n-          <div class="col">\n-\n-          <h2 metal:define-macro="listitem">\n-            <a class="summary url" tal:attributes="href item_link; title item_type" tal:content="item_title">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core">\n+\n+        <metal:block use-macro="context/@@listing_view/macros/content-core">\n+\n+          <metal:entries fill-slot="entries">\n+            <metal:block use-macro="context/@@listing_view/macros/entries"\n+                         tal:define="\n+                           portal context/@@plone_portal_state/portal;\n+                           image_scale portal/@@image_scale;\n+                         "\n+            >\n+\n+              <metal:entry fill-slot="entry">\n+\n+                <article class="row mb-3">\n+\n+                  <div class="col">\n+\n+                    <h2 metal:define-macro="listitem">\n+                      <a class="summary url"\n+                         tal:content="item_title"\n+                         tal:attributes="\n+                           href item_link;\n+                           title item_type;\n+                         "\n+                      >\n               Item Title\n-            </a>\n-          </h2>\n-\n-          <div class="mb-3">\n-            <div metal:use-macro="context/@@listing_view/macros/document_byline"></div>\n-          </div>\n-\n-          <div class="mb-1" tal:condition="item_description">\n-            <span class="description" tal:content="item_description">\n+                      </a>\n+                    </h2>\n+\n+                    <div class="mb-3">\n+                      <div metal:use-macro="context/@@listing_view/macros/document_byline"></div>\n+                    </div>\n+\n+                    <div class="mb-1"\n+                         tal:condition="item_description"\n+                    >\n+                      <span class="description"\n+                            tal:content="item_description"\n+                      >\n               description\n-            </span>\n-          </div>\n-\n-          <div class="mb-1">\n-            <a tal:attributes="href item_link" i18n:translate="read_more">\n+                      </span>\n+                    </div>\n+\n+                    <div class="mb-1">\n+                      <a tal:attributes="\n+                           href item_link;\n+                         "\n+                         i18n:translate="read_more"\n+                      >\n               Read More&hellip;\n-            </a>\n-          </div>\n+                      </a>\n+                    </div>\n \n-          </div>\n+                  </div>\n \n-          <div class="col-3"\n-               tal:condition="python: item_has_image and thumb_scale_summary">\n-            <a tal:attributes="href item_link">\n-              <img tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_summary, css_class=\'image-responsive thumb-\' + thumb_scale_summary, loading=\'lazy\')" />\n-            </a>\n-          </div>\n+                  <div class="col-3"\n+                       tal:condition="python: item_has_image and thumb_scale_summary"\n+                  >\n+                    <a tal:attributes="\n+                         href item_link;\n+                       ">\n+                      <img tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_summary, css_class=\'image-responsive thumb-\' + thumb_scale_summary, loading=\'lazy\')" />\n+                    </a>\n+                  </div>\n \n-        </article>\n+                </article>\n \n-      </metal:entry>\n-    </metal:block>\n-  </metal:entries>\n+              </metal:entry>\n+            </metal:block>\n+          </metal:entries>\n \n-</metal:block>\n+        </metal:block>\n \n-</metal:block>\n-</metal:content-core>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/listing_tabular.pt b/plone/app/contenttypes/browser/templates/listing_tabular.pt\nindex 0447709db..29b8cdc39 100644\n--- a/plone/app/contenttypes/browser/templates/listing_tabular.pt\n+++ b/plone/app/contenttypes/browser/templates/listing_tabular.pt\n@@ -1,111 +1,177 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n-\n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core">\n-\n-  <div metal:define-macro="text-field-view" id="parent-fieldname-text" class="stx" tal:define="text python:view.text" tal:condition="python:text" tal:attributes="class python:view.text_class">\n-    <div metal:define-slot="inside" tal:replace="structure python:text">The body</div>\n-  </div>\n-\n-  <metal:listingmacro define-macro="listing">\n-  <tal:results define="batch python:view.batch()">\n-    <tal:listing condition="python:batch">\n-\n-      <div metal:use-macro="context/batch_macros/macros/navigation" />\n-\n-      <div class="table-responsive">\n-\n-        <table class="table table-striped" tal:define="tabular_fields view/tabular_fields; thumb_scale_table python:view.get_thumb_scale_table(); img_class python:\'thumb-%s float-end\' % thumb_scale_table; showicons  python:view.show_icons();" summary="Content listing" i18n:attributes="summary summary_content_listing;">\n-\n-          <thead>\n-            <tr>\n-              <th class="text-nowrap"></th>\n-              <th class="text-nowrap" tal:repeat="field tabular_fields" tal:content="python:view.tabular_field_label(field)">Field name</th>\n-              <th class="text-nowrap" i18n:translate="image" tal:condition="python:thumb_scale_table">Image</th>\n-            </tr>\n-          </thead>\n-\n-          <tbody tal:define="portal python:portal_state.portal(); image_scale portal/@@image_scale">\n-            <tal:entries tal:repeat="item python:batch">\n-              <tal:block tal:define="item_url python:item.getURL();\n-                                      item_id python:item.getId();\n-                                      item_title python:item.Title();\n-                                      item_title python:item_title or item_id;\n-                                      item_type python:item.PortalType();\n-                                      item_type_class python:\'contenttype/\' + view.normalizeString(item_type) if showicons else \'\';\n-                                      item_wf_state python:item.review_state();\n-                                      item_wf_state_class python:\'state-\' + view.normalizeString(item_wf_state);\n-                                      item_creator python:item.Creator();\n-                                      item_has_image python:item.getIcon;\n-                                      item_link python:item_type in view.use_view_action and item_url+\'/view\' or item_url;\n-                                      item_mime_type python:item.mime_type;\n-                                      item_mime_type_icon python: \'mimetype-\' + item_mime_type;\n-                                      ">\n-\n-                <tr metal:define-macro="listitem">\n-\n-                  <td>\n-                    <tal:icon tal:condition="python: item_type == \'File\'" tal:replace="structure python:icons.tag(item_mime_type_icon)" />\n-                    <tal:icon tal:condition="python: item_type != \'File\'" tal:replace="structure python:icons.tag(item_type_class)" />\n-                  </td>\n-\n-                  <tal:block tal:repeat="field python:tabular_fields">\n-\n-                  <td class="text-nowrap" tal:condition="python:field not in [\'Title\', \'Creator\', \'getIcon\']" tal:define="field_data python:view.tabular_fielddata(item, field)">\n-                    <tal:block tal:replace="python: field_data.get(\'value\')" />\n-                  </td>\n-\n-                  <td class="text-nowrap" tal:condition="python:field == \'Title\'">\n-                    <a tal:attributes="href python:item_link; class string:$item_type_class $item_wf_state_class url; title python:item_type" tal:content="python: item_title">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n+\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core">\n+\n+        <div class="stx"\n+             id="parent-fieldname-text"\n+             metal:define-macro="text-field-view"\n+             tal:define="\n+               text python:view.text;\n+             "\n+             tal:condition="python:text"\n+             tal:attributes="\n+               class python:view.text_class;\n+             "\n+        >\n+          <div metal:define-slot="inside"\n+               tal:replace="structure python:text"\n+          >The body</div>\n+        </div>\n+\n+        <metal:listingmacro define-macro="listing">\n+          <tal:results define="\n+                         batch python:view.batch();\n+                       ">\n+            <tal:listing condition="python:batch">\n+\n+              <div metal:use-macro="context/batch_macros/macros/navigation"></div>\n+\n+              <div class="table-responsive">\n+\n+                <table class="table table-striped"\n+                       summary="Content listing"\n+                       tal:define="\n+                         tabular_fields view/tabular_fields;\n+                         thumb_scale_table python:view.get_thumb_scale_table();\n+                         img_class python:\'thumb-%s float-end\' % thumb_scale_table;\n+                         showicons  python:view.show_icons();\n+                       "\n+                       i18n:attributes="summary summary_content_listing;"\n+                >\n+\n+                  <thead>\n+                    <tr>\n+                      <th class="text-nowrap"></th>\n+                      <th class="text-nowrap"\n+                          tal:repeat="field tabular_fields"\n+                          tal:content="python:view.tabular_field_label(field)"\n+                      >Field name</th>\n+                      <th class="text-nowrap"\n+                          tal:condition="python:thumb_scale_table"\n+                          i18n:translate="image"\n+                      >Image</th>\n+                    </tr>\n+                  </thead>\n+\n+                  <tbody tal:define="\n+                           portal python:portal_state.portal();\n+                           image_scale portal/@@image_scale;\n+                         ">\n+                    <tal:entries tal:repeat="item python:batch">\n+                      <tal:block tal:define="\n+                                   item_url python:item.getURL();\n+                                   item_id python:item.getId();\n+                                   item_title python:item.Title();\n+                                   item_title python:item_title or item_id;\n+                                   item_type python:item.PortalType();\n+                                   item_type_class python:\'contenttype/\' + view.normalizeString(item_type) if showicons else \'\';\n+                                   item_wf_state python:item.review_state();\n+                                   item_wf_state_class python:\'state-\' + view.normalizeString(item_wf_state);\n+                                   item_creator python:item.Creator();\n+                                   item_has_image python:item.getIcon;\n+                                   item_link python:item_type in view.use_view_action and item_url+\'/view\' or item_url;\n+                                   item_mime_type python:item.mime_type;\n+                                   item_mime_type_icon python: \'mimetype-\' + item_mime_type;\n+                                 ">\n+\n+                        <tr metal:define-macro="listitem">\n+\n+                          <td>\n+                            <tal:icon tal:condition="python: item_type == \'File\'"\n+                                      tal:replace="structure python:icons.tag(item_mime_type_icon)"\n+                            />\n+                            <tal:icon tal:condition="python: item_type != \'File\'"\n+                                      tal:replace="structure python:icons.tag(item_type_class)"\n+                            />\n+                          </td>\n+\n+                          <tal:block tal:repeat="field python:tabular_fields">\n+\n+                            <td class="text-nowrap"\n+                                tal:define="\n+                                  field_data python:view.tabular_fielddata(item, field);\n+                                "\n+                                tal:condition="python:field not in [\'Title\', \'Creator\', \'getIcon\']"\n+                            >\n+                              <tal:block tal:replace="python: field_data.get(\'value\')" />\n+                            </td>\n+\n+                            <td class="text-nowrap"\n+                                tal:condition="python:field == \'Title\'"\n+                            >\n+                              <a tal:content="python: item_title"\n+                                 tal:attributes="\n+                                   href python:item_link;\n+                                   class string:$item_type_class $item_wf_state_class url;\n+                                   title python:item_type;\n+                                 "\n+                              >\n                       Item Title\n-                    </a>\n-                  </td>\n-\n-                  <td class="text-nowrap" tal:condition="python:field == \'Creator\'" tal:define="author python:view.pas_member.info(item_creator); name python:author[\'fullname\'] or author[\'username\']">\n-                    <a tal:condition="python: author" href="${view/navigation_root_url}/author/${item_creator}">\n+                              </a>\n+                            </td>\n+\n+                            <td class="text-nowrap"\n+                                tal:define="\n+                                  author python:view.pas_member.info(item_creator);\n+                                  name python:author[\'fullname\'] or author[\'username\'];\n+                                "\n+                                tal:condition="python:field == \'Creator\'"\n+                            >\n+                              <a href="${view/navigation_root_url}/author/${item_creator}"\n+                                 tal:condition="python: author"\n+                              >\n                       ${name}\n-                    </a>\n-                  </td>\n+                              </a>\n+                            </td>\n \n-                  </tal:block>\n+                          </tal:block>\n \n-                  <td>\n-                    <a tal:condition="python:item_has_image and thumb_scale_table">\n-                      <img tal:attributes="href python: item_link" tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_table, css_class=img_class, loading=\'lazy\')" />\n-                    </a>\n-                  </td>\n+                          <td>\n+                            <a tal:condition="python:item_has_image and thumb_scale_table">\n+                              <img tal:replace="structure python:image_scale.tag(item, \'image\', scale=thumb_scale_table, css_class=img_class, loading=\'lazy\')"\n+                                   tal:attributes="\n+                                     href python: item_link;\n+                                   "\n+                              />\n+                            </a>\n+                          </td>\n \n-                </tr>\n+                        </tr>\n \n-              </tal:block>\n-            </tal:entries>\n-          </tbody>\n-        </table>\n+                      </tal:block>\n+                    </tal:entries>\n+                  </tbody>\n+                </table>\n \n-      </div>\n+              </div>\n \n-      <div metal:use-macro="context/batch_macros/macros/navigation" />\n+              <div metal:use-macro="context/batch_macros/macros/navigation"></div>\n \n-    </tal:listing>\n+            </tal:listing>\n \n-    <metal:empty metal:define-slot="no_items_in_listing">\n-    <p tal:condition="python: not batch" tal:content="python: view.no_items_message">\n+            <metal:empty metal:define-slot="no_items_in_listing">\n+              <p tal:condition="python: not batch"\n+                 tal:content="python: view.no_items_message"\n+              >\n       There are currently no items in this folder.\n-    </p>\n-    </metal:empty>\n+              </p>\n+            </metal:empty>\n \n-  </tal:results>\n-  </metal:listingmacro>\n+          </tal:results>\n+        </metal:listingmacro>\n \n-</metal:block>\n-</metal:content-core>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/browser/templates/newsitem.pt b/plone/app/contenttypes/browser/templates/newsitem.pt\nindex c3754bb8f..77d7eac23 100644\n--- a/plone/app/contenttypes/browser/templates/newsitem.pt\n+++ b/plone/app/contenttypes/browser/templates/newsitem.pt\n@@ -1,27 +1,35 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/@@main_template/macros/master"\n-    i18n:domain="plone">\n-<body>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/@@main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:content-core define-macro="content-core"\n-                    tal:define="toc python: getattr(context, \'table_of_contents\', False)">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:content-core define-macro="content-core"\n+                          tal:define="\n+                            toc python: getattr(context, \'table_of_contents\', False);\n+                          "\n+      >\n \n-  <section id="section-text">\n-    <div id="parent-fieldname-text"\n-         tal:condition="python:getattr(context, \'text\', None)"\n-         tal:content="structure python:context.text.output_relative_to(view.context)"\n-         tal:attributes="class python: toc and \'pat-autotoc\' or \'\'">\n+        <section id="section-text">\n+          <div id="parent-fieldname-text"\n+               tal:condition="python:getattr(context, \'text\', None)"\n+               tal:content="structure python:context.text.output_relative_to(view.context)"\n+               tal:attributes="\n+                 class python: toc and \'pat-autotoc\' or \'\';\n+               "\n+          >\n       Text\n-    </div>\n-  </section>\n+          </div>\n+        </section>\n \n-</metal:content-core>\n-</metal:content-core>\n+      </metal:content-core>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/contenttypes/configure.zcml b/plone/app/contenttypes/configure.zcml\nindex 540ce04bf..ddfd9d3d2 100644\n--- a/plone/app/contenttypes/configure.zcml\n+++ b/plone/app/contenttypes/configure.zcml\n@@ -1,17 +1,34 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:zcml="http://namespaces.zope.org/zcml"\n-           xmlns:five="http://namespaces.zope.org/five"\n-           xmlns:i18n="http://namespaces.zope.org/i18n"\n-           xmlns:gs="http://namespaces.zope.org/genericsetup"\n-           xmlns:cmf="http://namespaces.zope.org/cmf"\n-           xmlns:plone="http://namespaces.plone.org/plone"\n-           i18n_domain="plone">\n-\n-  <include package="Products.CMFCore" file="meta.zcml" />\n-  <include package="Products.GenericSetup" file="meta.zcml" />\n-  <include package="plone.behavior" file="meta.zcml"/>\n-  <include package="plone.dexterity" file="meta.zcml"/>\n-  <include package="plone.app.dexterity" file="meta.zcml"/>\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:cmf="http://namespaces.zope.org/cmf"\n+    xmlns:five="http://namespaces.zope.org/five"\n+    xmlns:gs="http://namespaces.zope.org/genericsetup"\n+    xmlns:i18n="http://namespaces.zope.org/i18n"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n+\n+  <include\n+      package="Products.CMFCore"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="Products.GenericSetup"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="plone.behavior"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="plone.dexterity"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="plone.app.dexterity"\n+      file="meta.zcml"\n+      />\n \n   <include package="plone.behavior" />\n   <include package="plone.dexterity" />\n@@ -40,7 +57,8 @@\n \n   <utility\n       factory=".setuphandlers.HiddenProfiles"\n+      provides="plone.base.interfaces.INonInstallable"\n       name="plone.app.contenttypes"\n-      provides="plone.base.interfaces.INonInstallable" />\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/indexers.zcml b/plone/app/contenttypes/indexers.zcml\nindex a48ba5128..52b15f0c9 100644\n--- a/plone/app/contenttypes/indexers.zcml\n+++ b/plone/app/contenttypes/indexers.zcml\n@@ -1,20 +1,54 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:five="http://namespaces.zope.org/five"\n-    xmlns:i18n="http://namespaces.zope.org/i18n"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    i18n_domain="plone">\n+    xmlns:i18n="http://namespaces.zope.org/i18n"\n+    i18n_domain="plone"\n+    >\n \n-  <adapter name="SearchableText" factory=".indexers.SearchableText_collection" />\n-  <adapter name="SearchableText" factory=".indexers.SearchableText_document" />\n-  <adapter name="SearchableText" factory=".indexers.SearchableText_file" />\n-  <adapter name="SearchableText" factory=".indexers.SearchableText_folder" />\n-  <adapter name="SearchableText" factory=".indexers.SearchableText_link" />\n-  <adapter name="SearchableText" factory=".indexers.SearchableText_news" />\n-  <adapter name="getRemoteUrl" factory=".indexers.getRemoteUrl" />\n-  <adapter name="getObjSize" factory=".indexers.getObjSize_image" />\n-  <adapter name="getObjSize" factory=".indexers.getObjSize_file" />\n-  <adapter name="getIcon" factory=".indexers.getIcon" />\n-  <adapter name="mime_type" factory=".indexers.mime_type" />\n+  <adapter\n+      factory=".indexers.SearchableText_collection"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.SearchableText_document"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.SearchableText_file"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.SearchableText_folder"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.SearchableText_link"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.SearchableText_news"\n+      name="SearchableText"\n+      />\n+  <adapter\n+      factory=".indexers.getRemoteUrl"\n+      name="getRemoteUrl"\n+      />\n+  <adapter\n+      factory=".indexers.getObjSize_image"\n+      name="getObjSize"\n+      />\n+  <adapter\n+      factory=".indexers.getObjSize_file"\n+      name="getObjSize"\n+      />\n+  <adapter\n+      factory=".indexers.getIcon"\n+      name="getIcon"\n+      />\n+  <adapter\n+      factory=".indexers.mime_type"\n+      name="mime_type"\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/permissions.zcml b/plone/app/contenttypes/permissions.zcml\nindex d0ec8bbca..55da54b97 100644\n--- a/plone/app/contenttypes/permissions.zcml\n+++ b/plone/app/contenttypes/permissions.zcml\n@@ -1,42 +1,43 @@\n <configure\n-  xmlns="http://namespaces.zope.org/zope"\n-  xmlns:zcml="http://namespaces.zope.org/zcml"\n-  i18n_domain="plone">\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n \n   <configure zcml:condition="installed AccessControl.security">\n \n     <permission\n-      id="plone.app.contenttypes.addCollection"\n-      title="plone.app.contenttypes: Add Collection"\n-      />\n+        id="plone.app.contenttypes.addCollection"\n+        title="plone.app.contenttypes: Add Collection"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addDocument"\n-      title="plone.app.contenttypes: Add Document"\n-      />\n+        id="plone.app.contenttypes.addDocument"\n+        title="plone.app.contenttypes: Add Document"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addEvent"\n-      title="plone.app.contenttypes: Add Event"\n-      />\n+        id="plone.app.contenttypes.addEvent"\n+        title="plone.app.contenttypes: Add Event"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addFile"\n-      title="plone.app.contenttypes: Add File"\n-      />\n+        id="plone.app.contenttypes.addFile"\n+        title="plone.app.contenttypes: Add File"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addFolder"\n-      title="plone.app.contenttypes: Add Folder"\n-      />\n+        id="plone.app.contenttypes.addFolder"\n+        title="plone.app.contenttypes: Add Folder"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addImage"\n-      title="plone.app.contenttypes: Add Image"\n-      />\n+        id="plone.app.contenttypes.addImage"\n+        title="plone.app.contenttypes: Add Image"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addLink"\n-      title="plone.app.contenttypes: Add Link"\n-      />\n+        id="plone.app.contenttypes.addLink"\n+        title="plone.app.contenttypes: Add Link"\n+        />\n     <permission\n-      id="plone.app.contenttypes.addNewsItem"\n-      title="plone.app.contenttypes: Add News Item"\n-      />\n+        id="plone.app.contenttypes.addNewsItem"\n+        title="plone.app.contenttypes: Add News Item"\n+        />\n \n   </configure>\n \ndiff --git a/plone/app/contenttypes/profiles.zcml b/plone/app/contenttypes/profiles.zcml\nindex 0e3bb57b0..3f44121ed 100644\n--- a/plone/app/contenttypes/profiles.zcml\n+++ b/plone/app/contenttypes/profiles.zcml\n@@ -1,25 +1,27 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n-           xmlns:gs="http://namespaces.zope.org/genericsetup"\n-           xmlns:zcml="http://namespaces.zope.org/zcml">\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:gs="http://namespaces.zope.org/genericsetup"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <!-- Default plone content (frontpage etc.), depends default -->\n   <gs:registerProfile\n-    name="plone-content"\n-    title="Content-types plus example content (plone.app.contenttypes)"\n-    directory="profiles/content"\n-    description="Plone default content-types (plone.app.contenttypes)"\n-    provides="Products.GenericSetup.interfaces.EXTENSION"\n-    post_handler=".setuphandlers.import_content"\n-    />\n+      name="plone-content"\n+      title="Content-types plus example content (plone.app.contenttypes)"\n+      description="Plone default content-types (plone.app.contenttypes)"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/content"\n+      post_handler=".setuphandlers.import_content"\n+      />\n \n   <!-- All types, no sample content. -->\n   <gs:registerProfile\n-    name="default"\n-    title="Content-types (plone.app.contenttypes)"\n-    directory="profiles/default"\n-    description="Plone default content-types (plone.app.contenttypes)"\n-    provides="Products.GenericSetup.interfaces.EXTENSION"\n-    post_handler=".setuphandlers.setup_various"\n-    />\n+      name="default"\n+      title="Content-types (plone.app.contenttypes)"\n+      description="Plone default content-types (plone.app.contenttypes)"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/default"\n+      post_handler=".setuphandlers.setup_various"\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/profiles/content/metadata.xml b/plone/app/contenttypes/profiles/content/metadata.xml\nindex f6e89970a..455626f77 100644\n--- a/plone/app/contenttypes/profiles/content/metadata.xml\n+++ b/plone/app/contenttypes/profiles/content/metadata.xml\n@@ -1,6 +1,7 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n- <version>1000</version>\n- <dependencies>\n-  <dependency>profile-plone.app.contenttypes:default</dependency>\n- </dependencies>\n+  <version>1000</version>\n+  <dependencies>\n+    <dependency>profile-plone.app.contenttypes:default</dependency>\n+  </dependencies>\n </metadata>\ndiff --git a/plone/app/contenttypes/profiles/content/portlets.xml b/plone/app/contenttypes/profiles/content/portlets.xml\nindex 55ff7809e..1fa7201da 100644\n--- a/plone/app/contenttypes/profiles/content/portlets.xml\n+++ b/plone/app/contenttypes/profiles/content/portlets.xml\n@@ -1,23 +1,21 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <portlets>\n- <!-- Assign the standard portlets -->\n- <assignment\n-     manager="plone.leftcolumn"\n-     category="context"\n-     key="/"\n-     type="portlets.Navigation"\n-     name="navigation"\n-     />\n+  <!-- Assign the standard portlets -->\n+  <assignment category="context"\n+              key="/"\n+              manager="plone.leftcolumn"\n+              name="navigation"\n+              type="portlets.Navigation"\n+  />\n \n- <assignment\n-     manager="plone.rightcolumn"\n-     category="context"\n-     key="/"\n-     type="portlets.News"\n-     name="news"\n-     />\n+  <assignment category="context"\n+              key="/"\n+              manager="plone.rightcolumn"\n+              name="news"\n+              type="portlets.News"\n+  />\n \n-<!--  <assignment\n+  <!--  <assignment\n      manager="plone.rightcolumn"\n      category="context"\n      key="/"\ndiff --git a/plone/app/contenttypes/profiles/default/browserlayer.xml b/plone/app/contenttypes/profiles/default/browserlayer.xml\nindex 6f39600f5..2643915ec 100644\n--- a/plone/app/contenttypes/profiles/default/browserlayer.xml\n+++ b/plone/app/contenttypes/profiles/default/browserlayer.xml\n@@ -1,6 +1,6 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <layers>\n-  <layer\n-    name="plone.app.contenttypes"\n-    interface="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n-    />\n-</layers>\n\\ No newline at end of file\n+  <layer interface="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"\n+         name="plone.app.contenttypes"\n+  />\n+</layers>\ndiff --git a/plone/app/contenttypes/profiles/default/diff_tool.xml b/plone/app/contenttypes/profiles/default/diff_tool.xml\nindex 834b9b6a1..eda2013f5 100644\n--- a/plone/app/contenttypes/profiles/default/diff_tool.xml\n+++ b/plone/app/contenttypes/profiles/default/diff_tool.xml\n@@ -1,26 +1,40 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object>\n   <difftypes>\n     <type portal_type="Document">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="Event">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="File">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="Folder">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="Image">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="Link">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n     <type portal_type="News Item">\n-      <field name="any" difftype="Compound Diff for Dexterity types"/>\n+      <field difftype="Compound Diff for Dexterity types"\n+             name="any"\n+      />\n     </type>\n   </difftypes>\n-</object>\n\\ No newline at end of file\n+</object>\ndiff --git a/plone/app/contenttypes/profiles/default/metadata.xml b/plone/app/contenttypes/profiles/default/metadata.xml\nindex 245c492ad..5c9f46a8e 100644\n--- a/plone/app/contenttypes/profiles/default/metadata.xml\n+++ b/plone/app/contenttypes/profiles/default/metadata.xml\n@@ -1,11 +1,12 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n- <version>3000</version>\n- <dependencies>\n-  <dependency>profile-plone.app.dexterity:default</dependency>\n-  <dependency>profile-plone.app.event:default</dependency>\n-  <dependency>profile-plone.app.querystring:default</dependency>\n-  <dependency>profile-plone.app.relationfield:default</dependency>\n-  <dependency>profile-plone.app.versioningbehavior:default</dependency>\n-  <dependency>profile-plone.app.z3cform:default</dependency>\n- </dependencies>\n+  <version>3000</version>\n+  <dependencies>\n+    <dependency>profile-plone.app.dexterity:default</dependency>\n+    <dependency>profile-plone.app.event:default</dependency>\n+    <dependency>profile-plone.app.querystring:default</dependency>\n+    <dependency>profile-plone.app.relationfield:default</dependency>\n+    <dependency>profile-plone.app.versioningbehavior:default</dependency>\n+    <dependency>profile-plone.app.z3cform:default</dependency>\n+  </dependencies>\n </metadata>\ndiff --git a/plone/app/contenttypes/profiles/default/rolemap.xml b/plone/app/contenttypes/profiles/default/rolemap.xml\nindex 035f1b5d8..06b993da0 100644\n--- a/plone/app/contenttypes/profiles/default/rolemap.xml\n+++ b/plone/app/contenttypes/profiles/default/rolemap.xml\n@@ -1,56 +1,72 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <rolemap>\n   <roles>\n-    <role name="Manager"></role>\n+    <role name="Manager" />\n   </roles>\n   <permissions>\n-    <permission name="plone.app.contenttypes: Add Collection" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Collection"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add Document" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Document"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add Event" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Event"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add File" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add File"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add Folder" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Folder"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add Image" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Image"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add Link" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add Link"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n-    <permission name="plone.app.contenttypes: Add News Item" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.contenttypes: Add News Item"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Owner"/>\n-      <role name="Contributor"/>\n+      <role name="Owner" />\n+      <role name="Contributor" />\n     </permission>\n   </permissions>\n </rolemap>\ndiff --git a/plone/app/contenttypes/profiles/default/types.xml b/plone/app/contenttypes/profiles/default/types.xml\nindex 5a4505e90..5499ce027 100644\n--- a/plone/app/contenttypes/profiles/default/types.xml\n+++ b/plone/app/contenttypes/profiles/default/types.xml\n@@ -1,35 +1,71 @@\n-<?xml version="1.0"?>\n-<object meta_type="Plone Types Tool" name="portal_types">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n \n- <!-- We remove old ATContentTypes if they exist.\n+  <!-- We remove old ATContentTypes if they exist.\n       Instances of these types can still be looked at since the\n       skin-templates in CMFPlone are there but they cannot be edited -->\n- <object name="Collection" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Document" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Event" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="File" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Folder" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Image" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Link" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="News Item" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n- <object name="Topic" remove="True"\n-    meta_type="Factory-based Type Information with dynamic views"/>\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Collection"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Document"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Event"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="File"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Folder"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Image"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Link"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="News Item"\n+          remove="True"\n+  />\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Topic"\n+          remove="True"\n+  />\n \n- <object meta_type="Dexterity FTI" name="Collection" />\n- <object meta_type="Dexterity FTI" name="Document" />\n- <object meta_type="Dexterity FTI" name="Folder" />\n- <object meta_type="Dexterity FTI" name="Link" />\n- <object meta_type="Dexterity FTI" name="File" />\n- <object meta_type="Dexterity FTI" name="Image" />\n- <object meta_type="Dexterity FTI" name="News Item" />\n- <object meta_type="Dexterity FTI" name="Event" />\n+  <object meta_type="Dexterity FTI"\n+          name="Collection"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Document"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Folder"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Link"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="File"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Image"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="News Item"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Event"\n+  />\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Collection.xml b/plone/app/contenttypes/profiles/default/types/Collection.xml\nindex 2f9e192b9..05c04bab9 100644\n--- a/plone/app/contenttypes/profiles/default/types/Collection.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Collection.xml\n@@ -1,22 +1,22 @@\n-<?xml version="1.0"?>\n-<object\n-    name="Collection"\n-    meta_type="Dexterity FTI"\n-    i18n:domain="plone"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Collection"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Collection</property>\n-  <property\n-     i18n:translate=""\n-      name="description"></property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Collection</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Collection</property>\n   <property name="icon_expr">string:contenttype/collection</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n   <property name="allowed_content_types" />\n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addCollection</property>\n   <property name="klass">plone.app.contenttypes.content.Collection</property>\n   <property name="model_file">plone.app.contenttypes.schema:collection.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.namefromtitle" />\n     <element value="plone.collection" />\n     <element value="plone.allowdiscussion" />\n@@ -49,54 +51,50 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="album_view"/>\n-    <element value="event_listing"/>\n-    <element value="full_view"/>\n-    <element value="listing_view"/>\n-    <element value="summary_view"/>\n-    <element value="tabular_view"/>\n+    <element value="album_view" />\n+    <element value="event_listing" />\n+    <element value="full_view" />\n+    <element value="listing_view" />\n+    <element value="summary_view" />\n+    <element value="tabular_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Document.xml b/plone/app/contenttypes/profiles/default/types/Document.xml\nindex 152c61738..76da466b6 100644\n--- a/plone/app/contenttypes/profiles/default/types/Document.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Document.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="Document"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Document"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Page</property>\n-  <property\n-      i18n:translate=""\n-      name="description"></property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Page</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Document</property>\n   <property name="icon_expr">string:contenttype/document</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addDocument</property>\n   <property name="klass">plone.app.contenttypes.content.Document</property>\n   <property name="model_file">plone.app.contenttypes.schema:document.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.namefromtitle" />\n     <element value="plone.allowdiscussion" />\n     <element value="plone.excludefromnavigation" />\n@@ -50,49 +52,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="document_view"/>\n+    <element value="document_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Event.xml b/plone/app/contenttypes/profiles/default/types/Event.xml\nindex ab761508e..7ad26a452 100644\n--- a/plone/app/contenttypes/profiles/default/types/Event.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Event.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="Event"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Event"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Event</property>\n-  <property\n-      i18n:translate=""\n-      name="description">Events can be shown in calendars.</property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Event</property>\n+  <property name="description"\n+            i18n:translate=""\n+  >Events can be shown in calendars.</property>\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Event</property>\n   <property name="icon_expr">string:contenttype/event</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addEvent</property>\n   <property name="klass">plone.app.contenttypes.content.Event</property>\n   <property name="model_file">plone.app.contenttypes.schema:event.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.textindexer" />\n     <element value="plone.eventbasic" />\n     <element value="plone.eventrecurrence" />\n@@ -55,49 +57,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="event_view"/>\n+    <element value="event_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/File.xml b/plone/app/contenttypes/profiles/default/types/File.xml\nindex 634be6c9c..a9b9211b0 100644\n--- a/plone/app/contenttypes/profiles/default/types/File.xml\n+++ b/plone/app/contenttypes/profiles/default/types/File.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="File"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="File"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">File</property>\n-  <property\n-      i18n:translate=""\n-      name="description">Lets you upload a file to the site.</property>\n+  <property name="title"\n+            i18n:translate=""\n+  >File</property>\n+  <property name="description"\n+            i18n:translate=""\n+  >Lets you upload a file to the site.</property>\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">File</property>\n   <property name="icon_expr">string:contenttype/file</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addFile</property>\n   <property name="klass">plone.app.contenttypes.content.File</property>\n   <property name="model_file">plone.app.contenttypes.schema:file.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.categorization" />\n     <element value="plone.publication" />\n     <element value="plone.ownership" />\n@@ -48,49 +50,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="file_view"/>\n+    <element value="file_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="@@display-file"\n+  <alias from="(Default)"\n+         to="@@display-file"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Folder.xml b/plone/app/contenttypes/profiles/default/types/Folder.xml\nindex 09cd76539..e42362888 100644\n--- a/plone/app/contenttypes/profiles/default/types/Folder.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Folder.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="Folder"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Folder"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Folder</property>\n-  <property\n-      i18n:translate=""\n-      name="description"></property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Folder</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Folder</property>\n   <property name="icon_expr">string:contenttype/folder</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">False</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addFolder</property>\n   <property name="klass">plone.app.contenttypes.content.Folder</property>\n   <property name="model_file">plone.app.contenttypes.schema:folder.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.dublincore" />\n     <element value="plone.namefromtitle" />\n     <element value="plone.allowdiscussion" />\n@@ -48,54 +50,50 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="album_view"/>\n-    <element value="event_listing"/>\n-    <element value="full_view"/>\n-    <element value="listing_view"/>\n-    <element value="summary_view"/>\n-    <element value="tabular_view"/>\n+    <element value="album_view" />\n+    <element value="event_listing" />\n+    <element value="full_view" />\n+    <element value="listing_view" />\n+    <element value="summary_view" />\n+    <element value="tabular_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Image.xml b/plone/app/contenttypes/profiles/default/types/Image.xml\nindex 1df16a50b..90b223c8f 100644\n--- a/plone/app/contenttypes/profiles/default/types/Image.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Image.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="Image"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Image"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Image</property>\n-  <property\n-      i18n:translate=""\n-      name="description">Images can be referenced in pages or displayed in an album.</property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Image</property>\n+  <property name="description"\n+            i18n:translate=""\n+  >Images can be referenced in pages or displayed in an album.</property>\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Image</property>\n   <property name="icon_expr">string:contenttype/image</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addImage</property>\n   <property name="klass">plone.app.contenttypes.content.Image</property>\n   <property name="model_file">plone.app.contenttypes.schema:image.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.categorization" />\n     <element value="plone.publication" />\n     <element value="plone.ownership" />\n@@ -48,49 +50,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="image_view"/>\n+    <element value="image_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="@@display-file"\n+  <alias from="(Default)"\n+         to="@@display-file"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Link.xml b/plone/app/contenttypes/profiles/default/types/Link.xml\nindex 11858f632..33fa21f45 100644\n--- a/plone/app/contenttypes/profiles/default/types/Link.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Link.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="Link"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="Link"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">Link</property>\n-  <property\n-      i18n:translate=""\n-      name="description"></property>\n+  <property name="title"\n+            i18n:translate=""\n+  >Link</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">Link</property>\n   <property name="icon_expr">string:contenttype/link</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addLink</property>\n   <property name="klass">plone.app.contenttypes.content.Link</property>\n   <property name="model_file">plone.app.contenttypes.schema:link.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.allowdiscussion" />\n     <element value="plone.shortname" />\n     <element value="plone.dublincore" />\n@@ -46,49 +48,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="link_redirect_view"/>\n+    <element value="link_redirect_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/News_Item.xml b/plone/app/contenttypes/profiles/default/types/News_Item.xml\nindex 30538d7dc..0ddebb6f3 100644\n--- a/plone/app/contenttypes/profiles/default/types/News_Item.xml\n+++ b/plone/app/contenttypes/profiles/default/types/News_Item.xml\n@@ -1,25 +1,25 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    meta_type="Dexterity FTI"\n-    name="News Item"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="News Item"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property\n-      i18n:translate=""\n-      name="title">News Item</property>\n-  <property\n-      i18n:translate=""\n-      name="description"></property>\n+  <property name="title"\n+            i18n:translate=""\n+  >News Item</property>\n+  <property name="description"\n+            i18n:translate=""\n+  />\n \n   <property name="allow_discussion">False</property>\n   <property name="factory">News Item</property>\n   <property name="icon_expr">string:contenttype/news-item</property>\n-  <property name="link_target"></property>\n+  <property name="link_target" />\n \n   <!-- Hierarchy control -->\n-  <property name="allowed_content_types"/>\n+  <property name="allowed_content_types" />\n   <property name="filter_content_types">True</property>\n   <property name="global_allow">True</property>\n \n@@ -27,11 +27,13 @@\n   <property name="add_permission">plone.app.contenttypes.addNewsItem</property>\n   <property name="klass">plone.app.contenttypes.content.NewsItem</property>\n   <property name="model_file">plone.app.contenttypes.schema:news_item.xml</property>\n-  <property name="model_source"></property>\n-  <property name="schema"></property>\n+  <property name="model_source" />\n+  <property name="schema" />\n \n   <!-- Enabled behaviors -->\n-  <property name="behaviors" purge="false">\n+  <property name="behaviors"\n+            purge="false"\n+  >\n     <element value="plone.dublincore" />\n     <element value="plone.richtext" />\n     <element value="plone.namefromtitle" />\n@@ -50,49 +52,45 @@\n   <property name="default_view_fallback">False</property>\n   <property name="immediate_view">view</property>\n   <property name="view_methods">\n-    <element value="newsitem_view"/>\n+    <element value="newsitem_view" />\n   </property>\n \n   <!-- Method aliases -->\n-  <alias\n-      from="(Default)"\n-      to="(dynamic view)"\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n   />\n-  <alias\n-      from="edit"\n-      to="@@edit"\n+  <alias from="edit"\n+         to="@@edit"\n   />\n-  <alias\n-      from="sharing"\n-      to="@@sharing"\n+  <alias from="sharing"\n+         to="@@sharing"\n   />\n-  <alias\n-      from="view"\n-      to="(selected layout)"\n+  <alias from="view"\n+         to="(selected layout)"\n   />\n \n   <!-- Actions -->\n-  <action\n-      action_id="view"\n-      category="object"\n-      condition_expr=""\n-      i18n:attributes="title"\n-      title="View"\n-      url_expr="string:${object_url}"\n-      icon_expr="string:toolbar-action/view"\n-      visible="True">\n-    <permission value="View"/>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n   </action>\n-  <action\n-      action_id="edit"\n-      category="object"\n-      condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n-      i18n:attributes="title"\n-      title="Edit"\n-      url_expr="string:${object_url}/edit"\n-      icon_expr="string:toolbar-action/edit"\n-      visible="True">\n-    <permission value="Modify portal content"/>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr="not:object/@@plone_lock_info/is_locked_for_current_user|python:True"\n+          icon_expr="string:toolbar-action/edit"\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n   </action>\n \n </object>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Plone_Site.xml b/plone/app/contenttypes/profiles/default/types/Plone_Site.xml\nindex 359a432f8..14b8b7a65 100644\n--- a/plone/app/contenttypes/profiles/default/types/Plone_Site.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Plone_Site.xml\n@@ -1,8 +1,8 @@\n-<?xml version="1.0"?>\n-<object\n-    i18n:domain="plone"\n-    name="Plone Site"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        name="Plone Site"\n+        i18n:domain="plone"\n+>\n \n   <property name="icon_expr">string:contenttype/plone</property>\n \ndiff --git a/plone/app/contenttypes/schema/collection.xml b/plone/app/contenttypes/schema/collection.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/plone/app/contenttypes/schema/collection.xml\n+++ b/plone/app/contenttypes/schema/collection.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/plone/app/contenttypes/schema/document.xml b/plone/app/contenttypes/schema/document.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/plone/app/contenttypes/schema/document.xml\n+++ b/plone/app/contenttypes/schema/document.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/plone/app/contenttypes/schema/event.xml b/plone/app/contenttypes/schema/event.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/plone/app/contenttypes/schema/event.xml\n+++ b/plone/app/contenttypes/schema/event.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/plone/app/contenttypes/schema/file.xml b/plone/app/contenttypes/schema/file.xml\nindex 23b0727ec..59af73101 100644\n--- a/plone/app/contenttypes/schema/file.xml\n+++ b/plone/app/contenttypes/schema/file.xml\n@@ -1,20 +1,28 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema"\n-       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n        xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-       i18n:domain="plone">\n+       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n+       i18n:domain="plone"\n+>\n   <schema>\n-    <field name="title" type="zope.schema.TextLine">\n+    <field name="title"\n+           type="zope.schema.TextLine"\n+    >\n       <description />\n       <required>False</required>\n       <title i18n:translate="">Title</title>\n     </field>\n-    <field name="description" type="zope.schema.Text">\n+    <field name="description"\n+           type="zope.schema.Text"\n+    >\n       <description />\n       <required>False</required>\n       <title i18n:translate="">Description</title>\n     </field>\n-    <field name="file" type="plone.namedfile.field.NamedBlobFile"\n-        marshal:primary="true">\n+    <field marshal:primary="true"\n+           name="file"\n+           type="plone.namedfile.field.NamedBlobFile"\n+    >\n       <description />\n       <title i18n:translate="label_file">File</title>\n     </field>\ndiff --git a/plone/app/contenttypes/schema/folder.xml b/plone/app/contenttypes/schema/folder.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/plone/app/contenttypes/schema/folder.xml\n+++ b/plone/app/contenttypes/schema/folder.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/plone/app/contenttypes/schema/image.xml b/plone/app/contenttypes/schema/image.xml\nindex 63c24e427..05c459720 100644\n--- a/plone/app/contenttypes/schema/image.xml\n+++ b/plone/app/contenttypes/schema/image.xml\n@@ -1,20 +1,28 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema"\n-       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n        xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-       i18n:domain="plone">\n+       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n+       i18n:domain="plone"\n+>\n   <schema>\n-    <field name="title" type="zope.schema.TextLine">\n+    <field name="title"\n+           type="zope.schema.TextLine"\n+    >\n       <description />\n       <required>False</required>\n       <title i18n:translate="">Title</title>\n     </field>\n-    <field name="description" type="zope.schema.Text">\n+    <field name="description"\n+           type="zope.schema.Text"\n+    >\n       <description />\n       <required>False</required>\n       <title i18n:translate="">Description</title>\n     </field>\n-    <field name="image" type="plone.namedfile.field.NamedBlobImage"\n-        marshal:primary="true">\n+    <field marshal:primary="true"\n+           name="image"\n+           type="plone.namedfile.field.NamedBlobImage"\n+    >\n       <description />\n       <title i18n:translate="label_image">Image</title>\n     </field>\ndiff --git a/plone/app/contenttypes/schema/link.xml b/plone/app/contenttypes/schema/link.xml\nindex 3698f9164..972c389f6 100644\n--- a/plone/app/contenttypes/schema/link.xml\n+++ b/plone/app/contenttypes/schema/link.xml\n@@ -1,13 +1,18 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema"\n        xmlns:form="http://namespaces.plone.org/supermodel/form"\n-       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n        xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-       i18n:domain="plone">\n-    <schema>\n-      <field name="remoteUrl" type="zope.schema.TextLine" form:widget="plone.app.z3cform.widget.LinkFieldWidget">\n-        <description i18n:translate="description_linktype_url">The link is used almost verbatim, relative links become absolute and the strings "${navigation_root_url}" and "${portal_url}" get replaced with the real navigation_root_url or portal_url. If in doubt which one to use, please use navigation_root_url.\n+       xmlns:marshal="http://namespaces.plone.org/supermodel/marshal"\n+       i18n:domain="plone"\n+>\n+  <schema>\n+    <field form:widget="plone.app.z3cform.widget.LinkFieldWidget"\n+           name="remoteUrl"\n+           type="zope.schema.TextLine"\n+    >\n+      <description i18n:translate="description_linktype_url">The link is used almost verbatim, relative links become absolute and the strings "${navigation_root_url}" and "${portal_url}" get replaced with the real navigation_root_url or portal_url. If in doubt which one to use, please use navigation_root_url.\n         </description>\n-        <title i18n:translate="">URL</title>\n-      </field>\n-    </schema>\n+      <title i18n:translate="">URL</title>\n+    </field>\n+  </schema>\n </model>\ndiff --git a/plone/app/contenttypes/schema/news_item.xml b/plone/app/contenttypes/schema/news_item.xml\nindex f76eaf8d8..d82b4f039 100644\n--- a/plone/app/contenttypes/schema/news_item.xml\n+++ b/plone/app/contenttypes/schema/news_item.xml\n@@ -1,4 +1,5 @@\n+<?xml version="1.0" encoding="utf-8"?>\n <model xmlns="http://namespaces.plone.org/supermodel/schema">\n-    <schema>\n-    </schema>\n-</model>\n\\ No newline at end of file\n+  <schema>\n+</schema>\n+</model>\ndiff --git a/plone/app/contenttypes/setuphandlers.py b/plone/app/contenttypes/setuphandlers.py\nindex 5697a2249..ad88700a7 100644\n--- a/plone/app/contenttypes/setuphandlers.py\n+++ b/plone/app/contenttypes/setuphandlers.py\n@@ -271,7 +271,7 @@ def create_events_topic(portal, target_language):\n         )\n         aggregator = container["aggregator"]\n \n-        # Constain types\n+        # Constrain types\n         allowed_types = [\n             "Event",\n         ]\ndiff --git a/plone/app/contenttypes/subscribers.zcml b/plone/app/contenttypes/subscribers.zcml\nindex efe96d4ca..a929cc35f 100644\n--- a/plone/app/contenttypes/subscribers.zcml\n+++ b/plone/app/contenttypes/subscribers.zcml\n@@ -1,15 +1,15 @@\n <configure xmlns="http://namespaces.zope.org/zope">\n \n   <subscriber\n-    for=".interfaces.IFile\n-         zope.lifecycleevent.interfaces.IObjectCreatedEvent"\n-    handler=".subscribers.set_title_description"\n-  />\n+      for=".interfaces.IFile\n+           zope.lifecycleevent.interfaces.IObjectCreatedEvent"\n+      handler=".subscribers.set_title_description"\n+      />\n \n   <subscriber\n-    for=".interfaces.IImage\n-         zope.lifecycleevent.interfaces.IObjectCreatedEvent"\n-    handler=".subscribers.set_title_description"\n-  />\n+      for=".interfaces.IImage\n+           zope.lifecycleevent.interfaces.IObjectCreatedEvent"\n+      handler=".subscribers.set_title_description"\n+      />\n \n </configure>\ndiff --git a/plone/app/contenttypes/testing.py b/plone/app/contenttypes/testing.py\nindex 3444331fb..32da14a27 100644\n--- a/plone/app/contenttypes/testing.py\n+++ b/plone/app/contenttypes/testing.py\n@@ -23,7 +23,6 @@ def set_browserlayer(request):\n \n \n class PloneAppContenttypes(PloneSandboxLayer):\n-\n     defaultBases = (\n         PAEvent_FIXTURE,\n         PLONE_FIXTURE,\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_collection.py b/plone/app/contenttypes/tests/test_behaviors_collection.py\nindex dacd057a2..180ced353 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_collection.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_collection.py\n@@ -24,7 +24,6 @@\n \n \n class CollectionBehaviorFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_leadimage.py b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\nindex 06859fbc7..1ac270438 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n@@ -16,7 +16,6 @@\n \n \n class LeadImageBehaviorFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_table_of_contents.py b/plone/app/contenttypes/tests/test_behaviors_table_of_contents.py\nindex ef673ef1c..34a2fda5f 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_table_of_contents.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_table_of_contents.py\n@@ -14,7 +14,6 @@\n \n \n class TableOfContentsBehaviorFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_browser_utils.py b/plone/app/contenttypes/tests/test_browser_utils.py\nindex b61df8dc6..6b28a89ca 100644\n--- a/plone/app/contenttypes/tests/test_browser_utils.py\n+++ b/plone/app/contenttypes/tests/test_browser_utils.py\n@@ -24,7 +24,6 @@ def __init__(self, contentType, filename):\n \n \n class MimeTypeIconIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -37,7 +36,7 @@ def test_none(self):\n \n     def test_unknown(self):\n         self.assertEqual(\n-            self.view.getMimeTypeIcon(DummyFile("some/unknown", "unkown.unknown")),\n+            self.view.getMimeTypeIcon(DummyFile("some/unknown", "unknown.unknown")),\n             FALLBACK,\n         )\n \ndiff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py\nindex d52544e3e..a851b008c 100644\n--- a/plone/app/contenttypes/tests/test_collection.py\n+++ b/plone/app/contenttypes/tests/test_collection.py\n@@ -46,7 +46,6 @@ def dummy_image():\n \n \n class PloneAppCollectionClassTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -63,7 +62,6 @@ def test_syndicatable(self):\n \n \n class PloneAppCollectionIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -96,7 +94,6 @@ def test_adding(self):\n \n \n class PloneAppCollectionViewsIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\n@@ -378,7 +375,6 @@ def test_respect_navigation_root(self):\n \n \n class PloneAppCollectionEditViewsIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_collection_rss.py b/plone/app/contenttypes/tests/test_collection_rss.py\nindex d2abfaedb..5dd017fd0 100644\n--- a/plone/app/contenttypes/tests/test_collection_rss.py\n+++ b/plone/app/contenttypes/tests/test_collection_rss.py\n@@ -22,7 +22,6 @@\n \n \n class RSSViewTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_content_profile.py b/plone/app/contenttypes/tests/test_content_profile.py\nindex 1f2cefa32..9556756d2 100644\n--- a/plone/app/contenttypes/tests/test_content_profile.py\n+++ b/plone/app/contenttypes/tests/test_content_profile.py\n@@ -1,11 +1,9 @@\n from plone.app.contenttypes.testing import PLONE_APP_CONTENTTYPES_FIXTURE\n from plone.app.testing import IntegrationTesting\n from plone.app.testing import PloneSandboxLayer\n-from plone.base.interfaces.constrains import ISelectableConstrainTypes\n from plone.portlets.interfaces import ILocalPortletAssignmentManager\n from plone.portlets.interfaces import IPortletManager\n from Products.CMFCore.utils import getToolByName\n-from Products.PythonScripts.PythonScript import PythonScript\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n \ndiff --git a/plone/app/contenttypes/tests/test_document.py b/plone/app/contenttypes/tests/test_document.py\nindex 0432d8384..f609b20ef 100644\n--- a/plone/app/contenttypes/tests/test_document.py\n+++ b/plone/app/contenttypes/tests/test_document.py\n@@ -21,7 +21,6 @@\n \n \n class DocumentIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -76,7 +75,6 @@ def tearDown(self):\n \n \n class DocumentFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_event.py b/plone/app/contenttypes/tests/test_event.py\nindex 36f519248..2ce969116 100644\n--- a/plone/app/contenttypes/tests/test_event.py\n+++ b/plone/app/contenttypes/tests/test_event.py\n@@ -21,7 +21,6 @@\n \n \n class EventIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -72,7 +71,6 @@ def test_view(self):\n \n \n class EventFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_file.py b/plone/app/contenttypes/tests/test_file.py\nindex 8977906b9..cf26591b6 100644\n--- a/plone/app/contenttypes/tests/test_file.py\n+++ b/plone/app/contenttypes/tests/test_file.py\n@@ -25,7 +25,6 @@\n \n \n class FileIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -101,7 +100,6 @@ def test_view_audio_tag(self):\n \n \n class FileFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_folder.py b/plone/app/contenttypes/tests/test_folder.py\nindex 47b17a2f1..440eb6c2c 100644\n--- a/plone/app/contenttypes/tests/test_folder.py\n+++ b/plone/app/contenttypes/tests/test_folder.py\n@@ -20,7 +20,6 @@\n \n \n class FolderIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -50,7 +49,6 @@ def test_adding(self):\n \n \n class FolderViewIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -119,7 +117,6 @@ def test_result_batching(self):\n \n \n class FolderFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\n@@ -162,7 +159,6 @@ def test_add_folder_with_shortname(self):\n \n \n class FolderViewFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_image.py b/plone/app/contenttypes/tests/test_image.py\nindex 396fd01cf..b31a514aa 100644\n--- a/plone/app/contenttypes/tests/test_image.py\n+++ b/plone/app/contenttypes/tests/test_image.py\n@@ -31,7 +31,6 @@ def dummy_image(filename="image.jpg"):\n \n \n class ImageIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -61,7 +60,6 @@ def test_adding(self):\n \n \n class ImageViewIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -109,7 +107,6 @@ def test_svg_image(self):\n \n \n class ImageFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_indexes.py b/plone/app/contenttypes/tests/test_indexes.py\nindex 3211c9cbf..ff26726f0 100644\n--- a/plone/app/contenttypes/tests/test_indexes.py\n+++ b/plone/app/contenttypes/tests/test_indexes.py\n@@ -12,7 +12,6 @@\n \n \n class CatalogIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_link.py b/plone/app/contenttypes/tests/test_link.py\nindex 7593f3619..a7abb0336 100644\n--- a/plone/app/contenttypes/tests/test_link.py\n+++ b/plone/app/contenttypes/tests/test_link.py\n@@ -30,7 +30,6 @@\n \n \n class LinkIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -60,7 +59,6 @@ def test_adding(self):\n \n \n class LinkViewIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -248,7 +246,6 @@ def _get_link_redirect_view(self, obj):\n \n \n class LinkFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\n@@ -287,7 +284,6 @@ def test_add_link(self):\n \n \n class LinkWidgetIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     default_result = {\ndiff --git a/plone/app/contenttypes/tests/test_news_item.py b/plone/app/contenttypes/tests/test_news_item.py\nindex 11e2efc49..9bab672be 100644\n--- a/plone/app/contenttypes/tests/test_news_item.py\n+++ b/plone/app/contenttypes/tests/test_news_item.py\n@@ -24,7 +24,6 @@\n \n \n class NewsItemIntegrationTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -93,7 +92,6 @@ def test_leadimage_viewlet_does_not_show_up_for_newsitems(self):\n \n \n class NewsItemFunctionalTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_security.py b/plone/app/contenttypes/tests/test_security.py\nindex af6d24ded..9cda9ae0c 100644\n--- a/plone/app/contenttypes/tests/test_security.py\n+++ b/plone/app/contenttypes/tests/test_security.py\n@@ -7,11 +7,8 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n-from plone.testing.zope import Browser\n \n import base64\n-import os\n-import pkg_resources\n import re\n import sys\n import transaction\ndiff --git a/plone/app/contenttypes/tests/test_setup.py b/plone/app/contenttypes/tests/test_setup.py\nindex dc5935df2..ceab2fe3d 100644\n--- a/plone/app/contenttypes/tests/test_setup.py\n+++ b/plone/app/contenttypes/tests/test_setup.py\n@@ -8,7 +8,6 @@\n \n \n class PloneAppContenttypesSetupTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/upgrades.zcml b/plone/app/contenttypes/upgrades.zcml\nindex 13cba2537..9ecfe4be8 100644\n--- a/plone/app/contenttypes/upgrades.zcml\n+++ b/plone/app/contenttypes/upgrades.zcml\n@@ -1,13 +1,15 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <genericsetup:upgradeStep\n+      title="Update Type icons"\n+      profile="plone.app.contenttypes:default"\n       source="*"\n       destination="3000"\n-      profile="plone.app.contenttypes:default"\n-      title="Update Type icons"\n-      handler=".upgrades.update_type_icons" />\n+      handler=".upgrades.update_type_icons"\n+      />\n \n </configure>\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615de2..1324970af 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,46 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\n+\n+[tool.codespell]\n+ignore-words-list = "discreet,oder,ist,crate"\ndiff --git a/setup.cfg b/setup.cfg\nindex 300e56d0e..b2d4c9c05 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,16 +1,24 @@\n-[check-manifest]\n-ignore =\n-    *.sh\n-    .coveragerc\n-    .editorconfig\n-\n-\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n \n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    .coveragerc\n+    tox.ini\ndiff --git a/setup.py b/setup.py\nindex 8cfe14e97..7e415f237 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -59,15 +59,40 @@ def read(*rnames):\n         "plone.app.vocabularies > 4.1.2",\n         "plone.app.lockingbehavior",\n         "plone.behavior >= 1.3.0",\n-        "pytz",\n         "plone.app.z3cform>=1.1.0",\n         "zope.deprecation",\n+        "plone.base",\n+        "Products.GenericSetup",\n+        "Products.MimetypesRegistry",\n+        "Products.PortalTransforms",\n+        "Products.statusmessages",\n+        "plone.app.layout",\n+        "plone.app.textfield",\n+        "plone.app.uuid",\n+        "plone.autoform",\n+        "plone.event",\n+        "plone.folder",\n+        "plone.i18n",\n+        "plone.indexer",\n+        "plone.memoize",\n+        "plone.portlets",\n+        "plone.registry",\n+        "plone.rfc822",\n+        "plone.supermodel",\n+        "plone.z3cform",\n+        "z3c.form",\n+        "zope.contentprovider",\n     ],\n     extras_require={\n         "test": [\n             "lxml",\n             "plone.app.robotframework [debug] > 0.9.8",  # create image and file content for Image, File and News Item if not given.  # noqa\n             "plone.app.testing [robot] >= 4.2.4",  # we need ROBOT_TEST_LEVEL\n+            "plone.testing",\n+            "plone.browserlayer",\n+            "plone.uuid",\n+            "zope.viewlet",\n+            "robotsuite",\n         ],\n     },\n )\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 000000000..8a2a54124\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,53 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --test-path={toxinidir} -s plone.app.contenttypes\n+extras =\n+    test\n'

