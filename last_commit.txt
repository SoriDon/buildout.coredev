Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2019-05-02T15:34:29+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/Products.CMFEditions/commit/bd80aa01b86896871c893ade4e790919038ead1f

Made removing of versioning behaviors less strict (named vs dotted).

Files changed:
A news/67.bugfix
M Products/CMFEditions/testing.py

b"diff --git a/Products/CMFEditions/testing.py b/Products/CMFEditions/testing.py\nindex 7b952c0..448454f 100644\n--- a/Products/CMFEditions/testing.py\n+++ b/Products/CMFEditions/testing.py\n@@ -22,11 +22,23 @@ def setUpZope(self, app, configurationContext):\n \n     def setUpPloneSite(self, portal):\n         applyProfile(portal, 'Products.CMFEditions:CMFEditions')\n+        # with named AND dotted behaviors we need to take care of both\n+        versioning_behavior = set(\n+            [\n+                'plone.app.versioningbehavior.behaviors.IVersionable',\n+                'plone.versioning',\n+            ],\n+        )\n         for name in ('Document', 'Event', 'Link', 'News Item'):\n             fti = portal.portal_types[name]\n-            behaviors = list(fti.behaviors)\n-            behaviors.remove('plone.app.versioningbehavior.behaviors.IVersionable')\n-            fti.behaviors = tuple(behaviors)\n+            # write back the behaviors without the versioning behaviors\n+            # using a Set to keep it simple\n+            # a = set((1,2,3))\n+            # b = set([2,4])\n+            # res = tuple(a.difference(b)) >> (1,3)\n+            fti.behaviors = tuple(\n+                set(fti.behaviors).difference(versioning_behavior),\n+            )\n \n \n PRODUCTS_CMFEDITIONS_FIXTURE = ProductsCmfeditionsLayer()\ndiff --git a/news/67.bugfix b/news/67.bugfix\nnew file mode 100644\nindex 0000000..45a337c\n--- /dev/null\n+++ b/news/67.bugfix\n@@ -0,0 +1,2 @@\n+Made removing of versioning behaviors less strict (named vs dotted).\n+[iham]\n"

Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2019-05-02T16:26:28+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFEditions/commit/dfc1a3f29143ff70cd80ca5c789f79ec60a82db3

Merge pull request #68 from plone/issue_67

Made removing of versioning behaviors less strict (named vs dotted).

Files changed:
A news/67.bugfix
M Products/CMFEditions/testing.py

b"diff --git a/Products/CMFEditions/testing.py b/Products/CMFEditions/testing.py\nindex 7b952c0..448454f 100644\n--- a/Products/CMFEditions/testing.py\n+++ b/Products/CMFEditions/testing.py\n@@ -22,11 +22,23 @@ def setUpZope(self, app, configurationContext):\n \n     def setUpPloneSite(self, portal):\n         applyProfile(portal, 'Products.CMFEditions:CMFEditions')\n+        # with named AND dotted behaviors we need to take care of both\n+        versioning_behavior = set(\n+            [\n+                'plone.app.versioningbehavior.behaviors.IVersionable',\n+                'plone.versioning',\n+            ],\n+        )\n         for name in ('Document', 'Event', 'Link', 'News Item'):\n             fti = portal.portal_types[name]\n-            behaviors = list(fti.behaviors)\n-            behaviors.remove('plone.app.versioningbehavior.behaviors.IVersionable')\n-            fti.behaviors = tuple(behaviors)\n+            # write back the behaviors without the versioning behaviors\n+            # using a Set to keep it simple\n+            # a = set((1,2,3))\n+            # b = set([2,4])\n+            # res = tuple(a.difference(b)) >> (1,3)\n+            fti.behaviors = tuple(\n+                set(fti.behaviors).difference(versioning_behavior),\n+            )\n \n \n PRODUCTS_CMFEDITIONS_FIXTURE = ProductsCmfeditionsLayer()\ndiff --git a/news/67.bugfix b/news/67.bugfix\nnew file mode 100644\nindex 0000000..45a337c\n--- /dev/null\n+++ b/news/67.bugfix\n@@ -0,0 +1,2 @@\n+Made removing of versioning behaviors less strict (named vs dotted).\n+[iham]\n"

