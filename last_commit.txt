Repository: plone.app.content


Branch: refs/heads/master
Date: 2018-10-02T09:36:20+02:00
Author: Manuel Reinhardt (reinhardt) <reinhardt@syslab.com>
Commit: https://github.com/plone/plone.app.content/commit/111f1f55f22073b660b8421aa692dd51188ae267

Added get_objects_from_path_list to replace skin script. #1801

Files changed:
M CHANGES.rst
M plone/app/content/browser/content_status_history.py
M plone/app/content/browser/templates/content_status_history.pt

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 4cd7d7c..96cb1fd 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,8 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Added get_objects_from_path_list to replace skin script. #1801\n+  [reinhardt]\n \n Bug fixes:\n \ndiff --git a/plone/app/content/browser/content_status_history.py b/plone/app/content/browser/content_status_history.py\nindex 2dce48b..efa382d 100644\n--- a/plone/app/content/browser/content_status_history.py\n+++ b/plone/app/content/browser/content_status_history.py\n@@ -119,3 +119,12 @@ def validate(self, workflow_action=None, paths=[]):\n             # Set paths using orgi_paths, otherwise users are getting confused\n             orig_paths = self.request.get(\'orig_paths\')\n             self.request.set(\'paths\', orig_paths)\n+\n+    def get_objects_from_path_list(self, paths=[]):\n+        contents = []\n+        portal = getToolByName(self.context, \'portal_url\').getPortalObject()\n+        for path in paths:\n+            obj = portal.restrictedTraverse(str(path), None)\n+            if obj is not None:\n+                contents.append(obj)\n+        return contents\ndiff --git a/plone/app/content/browser/templates/content_status_history.pt b/plone/app/content/browser/templates/content_status_history.pt\nindex 737b048..eb2cffc 100644\n--- a/plone/app/content/browser/templates/content_status_history.pt\n+++ b/plone/app/content/browser/templates/content_status_history.pt\n@@ -39,7 +39,7 @@\n            tal:define="errors view/errors;\n                        review_state context_state/workflow_state;\n                        paths python:request.get(\'paths\', [\'/\'.join(context.getPhysicalPath())]);\n-                       batch python:context.getObjectsFromPathList(paths, batch=False);\n+                       batch python:view.get_objects_from_path_list(paths);\n                        folders_in_publishing python:[o.getId for o in batch if o.isPrincipiaFolderish];\n                        came_from python:request.get(\'HTTP_REFERER\', context.absolute_url()).split(\'?\')[0];\n                        dummy python:request.set(\'orig_template\', came_from);\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2018-10-02T14:14:16+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/8b51c1d49130939e4f31de4bf7c3673bd33b4ad0

Merge pull request #162 from plone/1801-get-from-paths

Added get_objects_from_path_list

Files changed:
M CHANGES.rst
M plone/app/content/browser/content_status_history.py
M plone/app/content/browser/templates/content_status_history.pt

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 4cd7d7c..96cb1fd 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,8 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Added get_objects_from_path_list to replace skin script. #1801\n+  [reinhardt]\n \n Bug fixes:\n \ndiff --git a/plone/app/content/browser/content_status_history.py b/plone/app/content/browser/content_status_history.py\nindex 2dce48b..efa382d 100644\n--- a/plone/app/content/browser/content_status_history.py\n+++ b/plone/app/content/browser/content_status_history.py\n@@ -119,3 +119,12 @@ def validate(self, workflow_action=None, paths=[]):\n             # Set paths using orgi_paths, otherwise users are getting confused\n             orig_paths = self.request.get(\'orig_paths\')\n             self.request.set(\'paths\', orig_paths)\n+\n+    def get_objects_from_path_list(self, paths=[]):\n+        contents = []\n+        portal = getToolByName(self.context, \'portal_url\').getPortalObject()\n+        for path in paths:\n+            obj = portal.restrictedTraverse(str(path), None)\n+            if obj is not None:\n+                contents.append(obj)\n+        return contents\ndiff --git a/plone/app/content/browser/templates/content_status_history.pt b/plone/app/content/browser/templates/content_status_history.pt\nindex 737b048..eb2cffc 100644\n--- a/plone/app/content/browser/templates/content_status_history.pt\n+++ b/plone/app/content/browser/templates/content_status_history.pt\n@@ -39,7 +39,7 @@\n            tal:define="errors view/errors;\n                        review_state context_state/workflow_state;\n                        paths python:request.get(\'paths\', [\'/\'.join(context.getPhysicalPath())]);\n-                       batch python:context.getObjectsFromPathList(paths, batch=False);\n+                       batch python:view.get_objects_from_path_list(paths);\n                        folders_in_publishing python:[o.getId for o in batch if o.isPrincipiaFolderish];\n                        came_from python:request.get(\'HTTP_REFERER\', context.absolute_url()).split(\'?\')[0];\n                        dummy python:request.set(\'orig_template\', came_from);\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2018-10-02T17:44:41+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/8f0e691870d9bb6166d1050bcc0aaa067eee85f8

Merge branch 'python3'

Files changed:
M CHANGES.rst
M plone/app/content/browser/content_status_history.py
M plone/app/content/browser/templates/content_status_history.pt

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 32cee5e..8384646 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -18,6 +18,8 @@ New features:\n Bug fixes:\n \n - *add item here*\n+- Added get_objects_from_path_list to replace skin script. #1801\n+  [reinhardt]\n \n \n 3.5.4 (2018-09-23)\ndiff --git a/plone/app/content/browser/content_status_history.py b/plone/app/content/browser/content_status_history.py\nindex 2dce48b..efa382d 100644\n--- a/plone/app/content/browser/content_status_history.py\n+++ b/plone/app/content/browser/content_status_history.py\n@@ -119,3 +119,12 @@ def validate(self, workflow_action=None, paths=[]):\n             # Set paths using orgi_paths, otherwise users are getting confused\n             orig_paths = self.request.get(\'orig_paths\')\n             self.request.set(\'paths\', orig_paths)\n+\n+    def get_objects_from_path_list(self, paths=[]):\n+        contents = []\n+        portal = getToolByName(self.context, \'portal_url\').getPortalObject()\n+        for path in paths:\n+            obj = portal.restrictedTraverse(str(path), None)\n+            if obj is not None:\n+                contents.append(obj)\n+        return contents\ndiff --git a/plone/app/content/browser/templates/content_status_history.pt b/plone/app/content/browser/templates/content_status_history.pt\nindex 737b048..eb2cffc 100644\n--- a/plone/app/content/browser/templates/content_status_history.pt\n+++ b/plone/app/content/browser/templates/content_status_history.pt\n@@ -39,7 +39,7 @@\n            tal:define="errors view/errors;\n                        review_state context_state/workflow_state;\n                        paths python:request.get(\'paths\', [\'/\'.join(context.getPhysicalPath())]);\n-                       batch python:context.getObjectsFromPathList(paths, batch=False);\n+                       batch python:view.get_objects_from_path_list(paths);\n                        folders_in_publishing python:[o.getId for o in batch if o.isPrincipiaFolderish];\n                        came_from python:request.get(\'HTTP_REFERER\', context.absolute_url()).split(\'?\')[0];\n                        dummy python:request.set(\'orig_template\', came_from);\n'

