Repository: plone.testing


Branch: refs/heads/master
Date: 2019-03-01T17:38:54+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.testing/commit/e7a34f57749bed8612e084c0c22e13a190d6ef72

Fixed test for 'Connection refused' which could be 'Connection reset'.

Files changed:
A news/59.bugfix
M src/plone/testing/zope.rst
M src/plone/testing/zserver.rst

b"diff --git a/news/59.bugfix b/news/59.bugfix\nnew file mode 100644\nindex 0000000..59f688a\n--- /dev/null\n+++ b/news/59.bugfix\n@@ -0,0 +1 @@\n+Fixed test for 'Connection refused' which could be 'Connection reset'.  [maurits]\ndiff --git a/src/plone/testing/zope.rst b/src/plone/testing/zope.rst\nindex 61cdb79..9c351de 100644\n--- a/src/plone/testing/zope.rst\n+++ b/src/plone/testing/zope.rst\n@@ -523,7 +523,14 @@ When the server is torn down, the WSGIServer thread is stopped.::\n     Tear down plone.testing.zope.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\n \n-    >>> conn = urlopen(app_url + '/folder1', timeout=5)\n-    Traceback (most recent call last):\n-    ...\n-    URLError: <urlopen error [Errno ...] Connection refused>\n+We can expect one of these exceptions:\n+- URLError: <urlopen error [Errno ...] Connection refused>\n+- error: [Errno 104] Connection reset by peer\n+\n+    >>> try:\n+    ...     conn = urlopen(app_url + '/folder1', timeout=5)\n+    ... except Exception as exc:\n+    ...     if 'Connection refused' not in str(exc) and 'Connection reset' not in str(exc):\n+    ...         raise exc\n+    ... else:\n+    ...     print('urlopen should have raised exception')\ndiff --git a/src/plone/testing/zserver.rst b/src/plone/testing/zserver.rst\nindex df94d1c..d7ec4f4 100644\n--- a/src/plone/testing/zserver.rst\n+++ b/src/plone/testing/zserver.rst\n@@ -526,10 +526,18 @@ When the server is torn down, the ZServer thread is stopped.::\n     Tear down plone.testing.zserver.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\n \n-    >>> conn = urllib2.urlopen(app_url + '/folder1', timeout=5)\n-    Traceback (most recent call last):\n-    ...\n-    URLError: <urlopen error [Errno ...] Connection refused>\n+We can expect one of these exceptions:\n+- URLError: <urlopen error [Errno ...] Connection refused>\n+- error: [Errno 104] Connection reset by peer\n+\n+    >>> try:\n+    ...     conn = urllib2.urlopen(app_url + '/folder1', timeout=5)\n+    ... except Exception as exc:\n+    ...     if 'Connection refused' not in str(exc) and 'Connection reset' not in str(exc):\n+    ...         raise exc\n+    ... else:\n+    ...     print('urllib2.urlopen should have raised exception')\n+\n \n FTP server\n ~~~~~~~~~~\n"

Repository: plone.testing


Branch: refs/heads/master
Date: 2019-03-01T20:54:34+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.testing/commit/cc3fe1a7598107b9edee75412a1bd9c04a07269a

Fixed flake8 errors, and ignore W503.

Either W503 will fail or W504.

lint-py27 runtests: commands[2] | flake8 --doctests src tests setup.py
src/plone/testing/layer.py:126:26: W504 line break after binary operator
src/plone/testing/layer.py:127:74: W504 line break after binary operator
setup.py:49:36: W504 line break after binary operator

Files changed:
M setup.py
M src/plone/testing/layer.py
M tox.ini

b'diff --git a/setup.py b/setup.py\nindex 9fd0f00..cde47b9 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -5,6 +5,7 @@\n import os\n import os.path\n \n+\n version = \'7.0.1.dev0\'\n \n install_requires = [\n@@ -46,8 +47,8 @@\n     long_description=(u\'\\n\\n\'.join([\n         open(os.path.join("src", "plone", "testing", "README.rst")).read(),\n         open("CHANGES.rst").read(),\n-        "Detailed documentation\\n" +\n-        "======================",\n+        "Detailed documentation\\n"\n+        + "======================",\n         open(os.path.join("src", "plone", "testing", "layer.rst")).read(),\n         open(os.path.join("src", "plone", "testing", "zca.rst")).read(),\n         open(os.path.join("src", "plone", "testing", "security.rst")).read(),\ndiff --git a/src/plone/testing/layer.py b/src/plone/testing/layer.py\nindex a95b8c6..90dc791 100644\n--- a/src/plone/testing/layer.py\n+++ b/src/plone/testing/layer.py\n@@ -123,9 +123,9 @@ def _mergeResourceManagers(self, seqs):\n \n     def _resourceResolutionOrder(self, instance):\n         return self._mergeResourceManagers(\n-            [[instance]] +\n-            list(map(self._resourceResolutionOrder, instance.__bases__)) +\n-            [list(instance.__bases__)]\n+            [[instance]]\n+            + list(map(self._resourceResolutionOrder, instance.__bases__))\n+            + [list(instance.__bases__)]\n         )\n \n \ndiff --git a/tox.ini b/tox.ini\nindex 4cf753d..4efe363 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -81,7 +81,7 @@ deps =\n commands =\n     mkdir -p {toxinidir}/_build/reports/flake8\n     - flake8 --format=html --htmldir={toxinidir}/_build/reports/flake8 --doctests src setup.py\n-    flake8 --doctests src tests setup.py\n+    flake8 --doctests --ignore=W503 src tests setup.py\n     isort --check-only --recursive {toxinidir}/src\n \n whitelist_externals =\n'

Repository: plone.testing


Branch: refs/heads/master
Date: 2019-03-01T20:57:55+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.testing/commit/6f92e577c80efa052661c11cf9a724def38837cc

Disable flake8-pytest and flake8-todo.

It's strange.  Without this, when I run flake8 I get this:
$ .tox/lint-py27/bin/flake8 --doctests src tests setup.py
src/plone/testing/layer.py:127:13: W503 line break before binary operator
src/plone/testing/layer.py:128:13: W503 line break before binary operator
setup.py:51:9: W503 line break before binary operator

We should ignore W503, so I pass an extra option, and then I get different errors:
$ .tox/lint-py27/bin/flake8 --doctests --ignore=W503 src tests setup.py
src/plone/testing/zope.py:124:19: T000 Todo note found.
src/plone/testing/tests.py:95:9: T003 use of Django-style assert statement found (instead of regular assert): assertIsNotNone

Files changed:
M tox.ini

b'diff --git a/tox.ini b/tox.ini\nindex 4efe363..7447371 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -62,8 +62,8 @@ deps =\n     flake8-debugger\n     flake8-deprecated\n     flake8-print\n-    flake8-pytest\n-    flake8-todo\n+    # flake8-pytest\n+    # flake8-todo\n     flake8-isort\n     mccabe\n     # Potential flake8 plugins that should be used:  # TBD\n'

Repository: plone.testing


Branch: refs/heads/master
Date: 2019-03-01T22:40:00+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.testing/commit/6f54d0e6123f9d50919a843895a0654257ca6375

Merge pull request #61 from plone/issue-59-connection-refused-reset

Fixed test for 'Connection refused' which could be 'Connection reset'.

Files changed:
A news/59.bugfix
M setup.py
M src/plone/testing/layer.py
M src/plone/testing/zope.rst
M src/plone/testing/zserver.rst
M tox.ini

b'diff --git a/news/59.bugfix b/news/59.bugfix\nnew file mode 100644\nindex 0000000..59f688a\n--- /dev/null\n+++ b/news/59.bugfix\n@@ -0,0 +1 @@\n+Fixed test for \'Connection refused\' which could be \'Connection reset\'.  [maurits]\ndiff --git a/setup.py b/setup.py\nindex 9fd0f00..cde47b9 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -5,6 +5,7 @@\n import os\n import os.path\n \n+\n version = \'7.0.1.dev0\'\n \n install_requires = [\n@@ -46,8 +47,8 @@\n     long_description=(u\'\\n\\n\'.join([\n         open(os.path.join("src", "plone", "testing", "README.rst")).read(),\n         open("CHANGES.rst").read(),\n-        "Detailed documentation\\n" +\n-        "======================",\n+        "Detailed documentation\\n"\n+        + "======================",\n         open(os.path.join("src", "plone", "testing", "layer.rst")).read(),\n         open(os.path.join("src", "plone", "testing", "zca.rst")).read(),\n         open(os.path.join("src", "plone", "testing", "security.rst")).read(),\ndiff --git a/src/plone/testing/layer.py b/src/plone/testing/layer.py\nindex a95b8c6..90dc791 100644\n--- a/src/plone/testing/layer.py\n+++ b/src/plone/testing/layer.py\n@@ -123,9 +123,9 @@ def _mergeResourceManagers(self, seqs):\n \n     def _resourceResolutionOrder(self, instance):\n         return self._mergeResourceManagers(\n-            [[instance]] +\n-            list(map(self._resourceResolutionOrder, instance.__bases__)) +\n-            [list(instance.__bases__)]\n+            [[instance]]\n+            + list(map(self._resourceResolutionOrder, instance.__bases__))\n+            + [list(instance.__bases__)]\n         )\n \n \ndiff --git a/src/plone/testing/zope.rst b/src/plone/testing/zope.rst\nindex 61cdb79..9c351de 100644\n--- a/src/plone/testing/zope.rst\n+++ b/src/plone/testing/zope.rst\n@@ -523,7 +523,14 @@ When the server is torn down, the WSGIServer thread is stopped.::\n     Tear down plone.testing.zope.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\n \n-    >>> conn = urlopen(app_url + \'/folder1\', timeout=5)\n-    Traceback (most recent call last):\n-    ...\n-    URLError: <urlopen error [Errno ...] Connection refused>\n+We can expect one of these exceptions:\n+- URLError: <urlopen error [Errno ...] Connection refused>\n+- error: [Errno 104] Connection reset by peer\n+\n+    >>> try:\n+    ...     conn = urlopen(app_url + \'/folder1\', timeout=5)\n+    ... except Exception as exc:\n+    ...     if \'Connection refused\' not in str(exc) and \'Connection reset\' not in str(exc):\n+    ...         raise exc\n+    ... else:\n+    ...     print(\'urlopen should have raised exception\')\ndiff --git a/src/plone/testing/zserver.rst b/src/plone/testing/zserver.rst\nindex df94d1c..d7ec4f4 100644\n--- a/src/plone/testing/zserver.rst\n+++ b/src/plone/testing/zserver.rst\n@@ -526,10 +526,18 @@ When the server is torn down, the ZServer thread is stopped.::\n     Tear down plone.testing.zserver.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\n \n-    >>> conn = urllib2.urlopen(app_url + \'/folder1\', timeout=5)\n-    Traceback (most recent call last):\n-    ...\n-    URLError: <urlopen error [Errno ...] Connection refused>\n+We can expect one of these exceptions:\n+- URLError: <urlopen error [Errno ...] Connection refused>\n+- error: [Errno 104] Connection reset by peer\n+\n+    >>> try:\n+    ...     conn = urllib2.urlopen(app_url + \'/folder1\', timeout=5)\n+    ... except Exception as exc:\n+    ...     if \'Connection refused\' not in str(exc) and \'Connection reset\' not in str(exc):\n+    ...         raise exc\n+    ... else:\n+    ...     print(\'urllib2.urlopen should have raised exception\')\n+\n \n FTP server\n ~~~~~~~~~~\ndiff --git a/tox.ini b/tox.ini\nindex 4cf753d..7447371 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -62,8 +62,8 @@ deps =\n     flake8-debugger\n     flake8-deprecated\n     flake8-print\n-    flake8-pytest\n-    flake8-todo\n+    # flake8-pytest\n+    # flake8-todo\n     flake8-isort\n     mccabe\n     # Potential flake8 plugins that should be used:  # TBD\n@@ -81,7 +81,7 @@ deps =\n commands =\n     mkdir -p {toxinidir}/_build/reports/flake8\n     - flake8 --format=html --htmldir={toxinidir}/_build/reports/flake8 --doctests src setup.py\n-    flake8 --doctests src tests setup.py\n+    flake8 --doctests --ignore=W503 src tests setup.py\n     isort --check-only --recursive {toxinidir}/src\n \n whitelist_externals =\n'

