Repository: Products.PlonePAS


Branch: refs/heads/master
Date: 2016-02-21T20:12:41+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.PlonePAS/commit/2548295dba4093e5f489a319d7235f3152bea244

Let cleanId return a string when getting a unicode.

Files changed:
M CHANGES.rst
M src/Products/PlonePAS/tests/test_membershiptool.py
M src/Products/PlonePAS/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7152180..49004e8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,6 +10,8 @@ New:
 
 Fixes:
 
+- Let ``cleanId`` return a string when getting a unicode.  [maurits]
+
 - Fixed AttributeError with Python 2.6 when reading setup.py.  [maurits]
 
 
diff --git a/src/Products/PlonePAS/tests/test_membershiptool.py b/src/Products/PlonePAS/tests/test_membershiptool.py
index 1a61eef..fb8396f 100644
--- a/src/Products/PlonePAS/tests/test_membershiptool.py
+++ b/src/Products/PlonePAS/tests/test_membershiptool.py
@@ -114,6 +114,10 @@ def test_id_clean(self):
         ac = zip(a, c)
         for aa, cc in ac:
             self.assertTrue(aa == cc)
+        cleaned = cleanId(u'abc')
+        self.assertEqual(cleaned, 'abc')
+        self.assertTrue(isinstance(cleaned, str))
+        self.assertFalse(isinstance(cleaned, unicode))
 
 
 class MemberAreaTest(base.TestCase):
diff --git a/src/Products/PlonePAS/utils.py b/src/Products/PlonePAS/utils.py
index 4a7d55c..6f0db2f 100644
--- a/src/Products/PlonePAS/utils.py
+++ b/src/Products/PlonePAS/utils.py
@@ -23,6 +23,8 @@ def cleanId(id):
     __traceback_info__ = (id,)
     if id:
         # note: we provide the 'safe' param to get '/' encoded
+        if isinstance(id, unicode):
+            id = id.encode('utf-8')
         return url_quote(id, '').replace('-', '--').replace('%', '-')
     return ''
 


Repository: Products.PlonePAS


Branch: refs/heads/master
Date: 2016-02-23T13:41:54-05:00
Author: Eric Steele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/Products.PlonePAS/commit/2e38598286c49059215d070187afb74ecca69c54

Merge pull request #15 from plone/maurits-cleanid-no-unicode

Let cleanId return a string when getting a unicode.

Files changed:
M CHANGES.rst
M src/Products/PlonePAS/tests/test_membershiptool.py
M src/Products/PlonePAS/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7152180..49004e8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,6 +10,8 @@ New:
 
 Fixes:
 
+- Let ``cleanId`` return a string when getting a unicode.  [maurits]
+
 - Fixed AttributeError with Python 2.6 when reading setup.py.  [maurits]
 
 
diff --git a/src/Products/PlonePAS/tests/test_membershiptool.py b/src/Products/PlonePAS/tests/test_membershiptool.py
index 1a61eef..fb8396f 100644
--- a/src/Products/PlonePAS/tests/test_membershiptool.py
+++ b/src/Products/PlonePAS/tests/test_membershiptool.py
@@ -114,6 +114,10 @@ def test_id_clean(self):
         ac = zip(a, c)
         for aa, cc in ac:
             self.assertTrue(aa == cc)
+        cleaned = cleanId(u'abc')
+        self.assertEqual(cleaned, 'abc')
+        self.assertTrue(isinstance(cleaned, str))
+        self.assertFalse(isinstance(cleaned, unicode))
 
 
 class MemberAreaTest(base.TestCase):
diff --git a/src/Products/PlonePAS/utils.py b/src/Products/PlonePAS/utils.py
index 4a7d55c..6f0db2f 100644
--- a/src/Products/PlonePAS/utils.py
+++ b/src/Products/PlonePAS/utils.py
@@ -23,6 +23,8 @@ def cleanId(id):
     __traceback_info__ = (id,)
     if id:
         # note: we provide the 'safe' param to get '/' encoded
+        if isinstance(id, unicode):
+            id = id.encode('utf-8')
         return url_quote(id, '').replace('-', '--').replace('%', '-')
     return ''
 


