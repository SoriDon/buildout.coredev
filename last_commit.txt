Repository: plone.app.testing


Branch: refs/heads/master
Date: 2016-02-23T15:56:27+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.testing/commit/2b9aca35d25081e4a45f9c67960103675ea8fdca

Replace deprecated zope.site.hooks import with zope.component.hooks.

Files changed:
M CHANGES.rst
M plone/app/testing/helpers.py
M plone/app/testing/layers.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0392f9e..d4ff4e5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Replace deprecated ``zope.site.hooks`` import with ``zope.component.hooks``.
+  [thet]
 
 
 5.0.0 (2016-02-20)
diff --git a/plone/app/testing/helpers.py b/plone/app/testing/helpers.py
index 24b3555..905ed21 100644
--- a/plone/app/testing/helpers.py
+++ b/plone/app/testing/helpers.py
@@ -11,6 +11,10 @@
 from plone.testing import z2
 from plone.testing import zca
 from plone.testing import zodb
+from zope.component import getGlobalSiteManager
+from zope.component.hooks import getSite
+from zope.component.hooks import setHooks
+from zope.component.hooks import setSite
 from zope.configuration import xmlconfig
 
 import contextlib
@@ -144,8 +148,6 @@ def pushGlobalRegistry(portal, new=None, name=None):
     Also ensure that the persistent component registry at ``portal`` has the
     new global registry as its base.
     """
-
-    from zope.site.hooks import setSite, getSite, setHooks
     site = getSite()
 
     localSiteManager = portal.getSiteManager()
@@ -173,15 +175,9 @@ def popGlobalRegistry(portal):
     # First, check if the component site has the global site manager in its
     # bases. If so, that site manager is about to disappear, so set its
     # base(s) as the new base(s) for the local site manager.
-
-    from zope.component import getGlobalSiteManager
     globalSiteManager = getGlobalSiteManager()
-
     gsmBases = globalSiteManager.__bases__
-
-    from zope.site.hooks import setSite, getSite, setHooks
     site = getSite()
-
     localSiteManager = portal.getSiteManager()
 
     bases = []
@@ -225,10 +221,7 @@ def ploneSite(db=None, connection=None, environ=None):
     pass an open connection as ``connection`` (the connection will not be
     closed).
     """
-
-    from zope.site.hooks import setSite, getSite, setHooks
     setHooks()
-
     site = getSite()
 
     with z2.zopeApp(db, connection, environ) as app:
@@ -323,8 +316,6 @@ def setUp(self):
                                               name=contextName))
 
             with ploneSite() as portal:
-
-                from zope.site.hooks import setSite, setHooks
                 setHooks()
 
                 # Make sure there's no local site manager while we load ZCML
@@ -364,8 +355,6 @@ def tearDown(self):
         with z2.zopeApp() as app:
 
             portal = app[PLONE_SITE_ID]
-
-            from zope.site.hooks import setSite, setHooks
             setHooks()
             setSite(portal)
 
diff --git a/plone/app/testing/layers.py b/plone/app/testing/layers.py
index f1fed28..5dc418d 100644
--- a/plone/app/testing/layers.py
+++ b/plone/app/testing/layers.py
@@ -19,6 +19,7 @@
 from plone.testing import zodb
 from Products.MailHost.interfaces import IMailHost
 from zope.component import getSiteManager
+from zope.component.hooks import setSite
 from zope.event import notify
 from zope.traversing.interfaces import BeforeTraverseEvent
 
@@ -280,7 +281,6 @@ def setUpEnvironment(self, portal):
         """
 
         # Set up the local site manager
-        from zope.site.hooks import setSite
         setSite(portal)
 
         # Reset skin data
@@ -312,7 +312,6 @@ def tearDownEnvironment(self, portal):
             cache.invalidateAll()
 
         # Unset the local component site
-        from zope.site.hooks import setSite
         setSite(None)
 
 
diff --git a/setup.py b/setup.py
index 5cf71af..8649da8 100644
--- a/setup.py
+++ b/setup.py
@@ -58,7 +58,6 @@ def read(*rnames):
         'zope.configuration',
         'zope.component',
         'zope.dottedname',
-        'zope.site',
         'zope.testing',
         'five.localsitemanager',
         'plone.memoize',


Repository: plone.app.testing


Branch: refs/heads/master
Date: 2016-02-24T10:32:26+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.testing/commit/0405f758334699c21f438df8aec5f949c1e7dd9a

Merge pull request #26 from plone/thet-zopesite

Replace deprecated zope.site.hooks import with zope.component.hooks.

Files changed:
M CHANGES.rst
M plone/app/testing/helpers.py
M plone/app/testing/layers.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0392f9e..d4ff4e5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Replace deprecated ``zope.site.hooks`` import with ``zope.component.hooks``.
+  [thet]
 
 
 5.0.0 (2016-02-20)
diff --git a/plone/app/testing/helpers.py b/plone/app/testing/helpers.py
index 24b3555..905ed21 100644
--- a/plone/app/testing/helpers.py
+++ b/plone/app/testing/helpers.py
@@ -11,6 +11,10 @@
 from plone.testing import z2
 from plone.testing import zca
 from plone.testing import zodb
+from zope.component import getGlobalSiteManager
+from zope.component.hooks import getSite
+from zope.component.hooks import setHooks
+from zope.component.hooks import setSite
 from zope.configuration import xmlconfig
 
 import contextlib
@@ -144,8 +148,6 @@ def pushGlobalRegistry(portal, new=None, name=None):
     Also ensure that the persistent component registry at ``portal`` has the
     new global registry as its base.
     """
-
-    from zope.site.hooks import setSite, getSite, setHooks
     site = getSite()
 
     localSiteManager = portal.getSiteManager()
@@ -173,15 +175,9 @@ def popGlobalRegistry(portal):
     # First, check if the component site has the global site manager in its
     # bases. If so, that site manager is about to disappear, so set its
     # base(s) as the new base(s) for the local site manager.
-
-    from zope.component import getGlobalSiteManager
     globalSiteManager = getGlobalSiteManager()
-
     gsmBases = globalSiteManager.__bases__
-
-    from zope.site.hooks import setSite, getSite, setHooks
     site = getSite()
-
     localSiteManager = portal.getSiteManager()
 
     bases = []
@@ -225,10 +221,7 @@ def ploneSite(db=None, connection=None, environ=None):
     pass an open connection as ``connection`` (the connection will not be
     closed).
     """
-
-    from zope.site.hooks import setSite, getSite, setHooks
     setHooks()
-
     site = getSite()
 
     with z2.zopeApp(db, connection, environ) as app:
@@ -323,8 +316,6 @@ def setUp(self):
                                               name=contextName))
 
             with ploneSite() as portal:
-
-                from zope.site.hooks import setSite, setHooks
                 setHooks()
 
                 # Make sure there's no local site manager while we load ZCML
@@ -364,8 +355,6 @@ def tearDown(self):
         with z2.zopeApp() as app:
 
             portal = app[PLONE_SITE_ID]
-
-            from zope.site.hooks import setSite, setHooks
             setHooks()
             setSite(portal)
 
diff --git a/plone/app/testing/layers.py b/plone/app/testing/layers.py
index f1fed28..5dc418d 100644
--- a/plone/app/testing/layers.py
+++ b/plone/app/testing/layers.py
@@ -19,6 +19,7 @@
 from plone.testing import zodb
 from Products.MailHost.interfaces import IMailHost
 from zope.component import getSiteManager
+from zope.component.hooks import setSite
 from zope.event import notify
 from zope.traversing.interfaces import BeforeTraverseEvent
 
@@ -280,7 +281,6 @@ def setUpEnvironment(self, portal):
         """
 
         # Set up the local site manager
-        from zope.site.hooks import setSite
         setSite(portal)
 
         # Reset skin data
@@ -312,7 +312,6 @@ def tearDownEnvironment(self, portal):
             cache.invalidateAll()
 
         # Unset the local component site
-        from zope.site.hooks import setSite
         setSite(None)
 
 
diff --git a/setup.py b/setup.py
index 5cf71af..8649da8 100644
--- a/setup.py
+++ b/setup.py
@@ -58,7 +58,6 @@ def read(*rnames):
         'zope.configuration',
         'zope.component',
         'zope.dottedname',
-        'zope.site',
         'zope.testing',
         'five.localsitemanager',
         'plone.memoize',


