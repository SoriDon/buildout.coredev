Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2017-10-04T14:11:27+02:00
Author: Roel Bruggink (jaroel) <roel@jaroel.nl>
Commit: https://github.com/plone/plone.app.z3cform/commit/533c9f7e39a41ef91948c8e7ae57bc5434fef44d

Use output_relative_to(self.context) in RichTextWidget

Files changed:
M plone/app/z3cform/widget.py

diff --git a/plone/app/z3cform/widget.py b/plone/app/z3cform/widget.py
index 0409d44..d430f9e 100644
--- a/plone/app/z3cform/widget.py
+++ b/plone/app/z3cform/widget.py
@@ -694,7 +694,7 @@ def render(self):
             return ''
 
         if isinstance(self.value, RichTextValue):
-            return self.value.output
+            return self.value.output_relative_to(self.context)
 
         return super(RichTextWidget, self).render()
 


Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2017-10-04T14:13:49+02:00
Author: Roel Bruggink (jaroel) <roel@jaroel.nl>
Commit: https://github.com/plone/plone.app.z3cform/commit/5575b9ba9bf56c40aadbfb22a8b8978dc8c7caed

Update CHANGES.rst

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index e8a8c48..6cdced2 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,9 @@ New features:
 
 Bug fixes:
 
+- Use RichTextValue's output_relative_to(self.context) in RichTextWidget so the ITransform doesn't use siteroot.
+  [jaroel]
+
 - Fix in link widget data converter for ``toWidgetValue`` to return an empty structure when the field value is empty instead of returning the portal root object.
   Fixes: https://github.com/plone/Products.CMFPlone/issues/2163
   [thet]


Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2017-10-05T12:10:55+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/2c1ae9a4b6a25ee0e93a55a3437e0b47d6de4792

Merge pull request #78 from plone/jaroel-patch-1

Use output_relative_to(self.context) in RichTextWidget

Files changed:
M CHANGES.rst
M plone/app/z3cform/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e8a8c48..6cdced2 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,9 @@ New features:
 
 Bug fixes:
 
+- Use RichTextValue's output_relative_to(self.context) in RichTextWidget so the ITransform doesn't use siteroot.
+  [jaroel]
+
 - Fix in link widget data converter for ``toWidgetValue`` to return an empty structure when the field value is empty instead of returning the portal root object.
   Fixes: https://github.com/plone/Products.CMFPlone/issues/2163
   [thet]
diff --git a/plone/app/z3cform/widget.py b/plone/app/z3cform/widget.py
index 0409d44..d430f9e 100644
--- a/plone/app/z3cform/widget.py
+++ b/plone/app/z3cform/widget.py
@@ -694,7 +694,7 @@ def render(self):
             return ''
 
         if isinstance(self.value, RichTextValue):
-            return self.value.output
+            return self.value.output_relative_to(self.context)
 
         return super(RichTextWidget, self).render()
 


