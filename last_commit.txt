Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-03-21T12:04:52+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.iterate/commit/29d0928b14cfacbc7edf40c7ca749fa7719c382b

Use proper action icons in Plone 6.

Files changed:
A news/60.bugfix
M plone/app/iterate/profiles/default/actions.xml

b'diff --git a/news/60.bugfix b/news/60.bugfix\nnew file mode 100644\nindex 0000000..c5f6356\n--- /dev/null\n+++ b/news/60.bugfix\n@@ -0,0 +1,2 @@\n+Use proper action icons in Plone 6.\n+[maurits]\ndiff --git a/plone/app/iterate/profiles/default/actions.xml b/plone/app/iterate/profiles/default/actions.xml\nindex d4d7232..49c3118 100644\n--- a/plone/app/iterate/profiles/default/actions.xml\n+++ b/plone/app/iterate/profiles/default/actions.xml\n@@ -7,7 +7,7 @@\n    <property name="title" i18n:translate="">Check in</property>\n    <property name="description" i18n:translate=""></property>\n    <property name="url_expr">string:${object_url}/@@content-checkin</property>\n-   <property name="icon_expr">string:${portal_url}/++resource++checkout.png</property>\n+   <property name="icon_expr">string:box-arrow-in-up-right</property>\n    <property name="available_expr">python:path(\'object/@@iterate_control\').checkin_allowed()</property>\n    <property name="permissions">\n     <element value="View"/>\n@@ -19,7 +19,7 @@\n    <property name="title" i18n:translate="">Check out</property>\n    <property name="description" i18n:translate=""></property>\n    <property name="url_expr">string:${object_url}/@@content-checkout</property>\n-   <property name="icon_expr">string:${portal_url}/++resource++checkout.png</property>\n+   <property name="icon_expr">string:box-arrow-down-left</property>\n    <property name="available_expr">python:path(\'object/@@iterate_control\').checkout_allowed()</property>\n    <property name="permissions">\n     <element value="View"/>\n@@ -31,7 +31,7 @@\n    <property name="title" i18n:translate="">Cancel check-out</property>\n    <property name="description" i18n:translate=""></property>\n    <property name="url_expr">string:${object_url}/@@content-cancel-checkout</property>\n-   <property name="icon_expr">string:${portal_url}/++resource++cancel-checkout.png</property>\n+   <property name="icon_expr">string:arrow-counterclockwise</property>\n    <property name="available_expr">python:path(\'object/@@iterate_control\').cancel_allowed()</property>\n    <property name="permissions">\n     <element value="Modify portal content"/>\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-03-21T14:27:16+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.iterate/commit/8d89c7d2899372e11e7bb5cac5803f7757dae7fd

Add upgrade step and profile to update the action icons.

Removed old upgrade step that was only needed for upgrading from Plone 4.0.0 alpha/beta.

Files changed:
A plone/app/iterate/profiles/to1000/actions.xml
M plone/app/iterate/browser/configure.zcml
M plone/app/iterate/configure.zcml
M plone/app/iterate/profiles/default/metadata.xml
M plone/app/iterate/util.py

b'diff --git a/plone/app/iterate/browser/configure.zcml b/plone/app/iterate/browser/configure.zcml\nindex ffcb1f4..3215c38 100644\n--- a/plone/app/iterate/browser/configure.zcml\n+++ b/plone/app/iterate/browser/configure.zcml\n@@ -67,7 +67,7 @@\n         />\n \n     <!-- Resources -->\n-\n+    <!-- These resources are deprecated.  Remove them in Plone 7. -->\n     <browser:resource\n         name="checkin.png"\n         image="checkin.png"\ndiff --git a/plone/app/iterate/configure.zcml b/plone/app/iterate/configure.zcml\nindex a788755..d295c17 100644\n--- a/plone/app/iterate/configure.zcml\n+++ b/plone/app/iterate/configure.zcml\n@@ -70,15 +70,22 @@\n       title="Working Copy Support (Iterate) [uninstall]"\n       directory="profiles/uninstall"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       />\n \n-  <genericsetup:upgradeStep\n-      source="*"\n-      destination="121"\n-      title="Reinstall plone.app.iterate"\n-      description=""\n-      profile="plone.app.iterate:plone.app.iterate"\n-      handler="plone.app.iterate.util.upgrade_by_reinstall"\n+  <genericsetup:registerProfile\n+      name="to1000"\n+      title="Use new icons"\n+      directory="profiles/to1000"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      />\n+\n+  <genericsetup:upgradeDepends\n+      source="121"\n+      destination="1000"\n+      title="Use new icons"\n+      profile="plone.app.iterate:default"\n+      import_profile="plone.app.iterate:to1000"\n       />\n \n   <utility\ndiff --git a/plone/app/iterate/profiles/default/metadata.xml b/plone/app/iterate/profiles/default/metadata.xml\nindex d5c2fad..b22370d 100644\n--- a/plone/app/iterate/profiles/default/metadata.xml\n+++ b/plone/app/iterate/profiles/default/metadata.xml\n@@ -1,7 +1,4 @@\n <?xml version="1.0"?>\n <metadata>\n-  <!-- When this version is updated, be sure to update the target version\n-       of the \'upgrade_by_reinstall\' upgrade step, or (better) add a real\n-       upgrade step that only makes necessary changes. -->\n-  <version>121</version>\n+  <version>1000</version>\n </metadata>\ndiff --git a/plone/app/iterate/profiles/to1000/actions.xml b/plone/app/iterate/profiles/to1000/actions.xml\nnew file mode 100644\nindex 0000000..0d33102\n--- /dev/null\n+++ b/plone/app/iterate/profiles/to1000/actions.xml\n@@ -0,0 +1,19 @@\n+<?xml version="1.0"?>\n+<object name="portal_actions" meta_type="Plone Actions Tool"\n+   xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+ <object name="object_buttons" meta_type="CMF Action Category">\n+\n+  <object name="iterate_checkin" meta_type="CMF Action" i18n:domain="plone">\n+   <property name="icon_expr">string:box-arrow-in-up-right</property>\n+  </object>\n+\n+  <object name="iterate_checkout" meta_type="CMF Action" i18n:domain="plone">\n+   <property name="icon_expr">string:box-arrow-down-left</property>\n+  </object>\n+\n+  <object name="iterate_checkout_cancel" meta_type="CMF Action" i18n:domain="plone">\n+   <property name="icon_expr">string:arrow-counterclockwise</property>\n+  </object>\n+\n+ </object>\n+</object>\ndiff --git a/plone/app/iterate/util.py b/plone/app/iterate/util.py\nindex 542b9aa..fac5e9a 100644\n--- a/plone/app/iterate/util.py\n+++ b/plone/app/iterate/util.py\n@@ -23,7 +23,6 @@\n \n from .interfaces import annotation_key\n from persistent.dict import PersistentDict\n-from plone.base.utils import get_installer\n from zope.annotation import IAnnotations\n \n \n@@ -34,9 +33,3 @@ def get_storage(context, default=None):\n             return default\n         annotations[annotation_key] = PersistentDict()\n     return annotations[annotation_key]\n-\n-\n-def upgrade_by_reinstall(context):\n-    qi = get_installer(context)\n-    qi.uninstall_product("plone.app.iterate")\n-    qi.install_product("plone.app.iterate")\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2023-03-21T20:34:19+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.iterate/commit/0237e19920607455dcc3327f4121b375306285c5

Merge pull request #105 from plone/maurits-icons

Update action icons

Files changed:
A news/60.bugfix
A plone/app/iterate/profiles/to1000/actions.xml
M plone/app/iterate/browser/configure.zcml
M plone/app/iterate/configure.zcml
M plone/app/iterate/profiles/default/actions.xml
M plone/app/iterate/profiles/default/metadata.xml
M plone/app/iterate/util.py

b'diff --git a/news/60.bugfix b/news/60.bugfix\nnew file mode 100644\nindex 0000000..c5f6356\n--- /dev/null\n+++ b/news/60.bugfix\n@@ -0,0 +1,2 @@\n+Use proper action icons in Plone 6.\n+[maurits]\ndiff --git a/plone/app/iterate/browser/configure.zcml b/plone/app/iterate/browser/configure.zcml\nindex ffcb1f4..3215c38 100644\n--- a/plone/app/iterate/browser/configure.zcml\n+++ b/plone/app/iterate/browser/configure.zcml\n@@ -67,7 +67,7 @@\n         />\n \n     <!-- Resources -->\n-\n+    <!-- These resources are deprecated.  Remove them in Plone 7. -->\n     <browser:resource\n         name="checkin.png"\n         image="checkin.png"\ndiff --git a/plone/app/iterate/configure.zcml b/plone/app/iterate/configure.zcml\nindex a788755..d295c17 100644\n--- a/plone/app/iterate/configure.zcml\n+++ b/plone/app/iterate/configure.zcml\n@@ -70,15 +70,22 @@\n       title="Working Copy Support (Iterate) [uninstall]"\n       directory="profiles/uninstall"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n       />\n \n-  <genericsetup:upgradeStep\n-      source="*"\n-      destination="121"\n-      title="Reinstall plone.app.iterate"\n-      description=""\n-      profile="plone.app.iterate:plone.app.iterate"\n-      handler="plone.app.iterate.util.upgrade_by_reinstall"\n+  <genericsetup:registerProfile\n+      name="to1000"\n+      title="Use new icons"\n+      directory="profiles/to1000"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      />\n+\n+  <genericsetup:upgradeDepends\n+      source="121"\n+      destination="1000"\n+      title="Use new icons"\n+      profile="plone.app.iterate:default"\n+      import_profile="plone.app.iterate:to1000"\n       />\n \n   <utility\ndiff --git a/plone/app/iterate/profiles/default/actions.xml b/plone/app/iterate/profiles/default/actions.xml\nindex d4d7232..49c3118 100644\n--- a/plone/app/iterate/profiles/default/actions.xml\n+++ b/plone/app/iterate/profiles/default/actions.xml\n@@ -7,7 +7,7 @@\n    <property name="title" i18n:translate="">Check in</property>\n    <property name="description" i18n:translate=""></property>\n    <property name="url_expr">string:${object_url}/@@content-checkin</property>\n-   <property name="icon_expr">string:${portal_url}/++resource++checkout.png</property>\n+   <property name="icon_expr">string:box-arrow-in-up-right</property>\n    <property name="available_expr">python:path(\'object/@@iterate_control\').checkin_allowed()</property>\n    <property name="permissions">\n     <element value="View"/>\n@@ -19,7 +19,7 @@\n    <property name="title" i18n:translate="">Check out</property>\n    <property name="description" i18n:translate=""></property>\n    <property name="url_expr">string:${object_url}/@@content-checkout</property>\n-   <property name="icon_expr">string:${portal_url}/++resource++checkout.png</property>\n+   <property name="icon_expr">string:box-arrow-down-left</property>\n    <property name="available_expr">python:path(\'object/@@iterate_control\').checkout_allowed()</property>\n    <property name="permissions">\n     <element value="View"/>\n@@ -31,7 +31,7 @@\n    <property name="title" i18n:translate="">Cancel check-out</property>\n    <property name="description" i18n:translate=""></property>\n    <property name="url_expr">string:${object_url}/@@content-cancel-checkout</property>\n-   <property name="icon_expr">string:${portal_url}/++resource++cancel-checkout.png</property>\n+   <property name="icon_expr">string:arrow-counterclockwise</property>\n    <property name="available_expr">python:path(\'object/@@iterate_control\').cancel_allowed()</property>\n    <property name="permissions">\n     <element value="Modify portal content"/>\ndiff --git a/plone/app/iterate/profiles/default/metadata.xml b/plone/app/iterate/profiles/default/metadata.xml\nindex d5c2fad..b22370d 100644\n--- a/plone/app/iterate/profiles/default/metadata.xml\n+++ b/plone/app/iterate/profiles/default/metadata.xml\n@@ -1,7 +1,4 @@\n <?xml version="1.0"?>\n <metadata>\n-  <!-- When this version is updated, be sure to update the target version\n-       of the \'upgrade_by_reinstall\' upgrade step, or (better) add a real\n-       upgrade step that only makes necessary changes. -->\n-  <version>121</version>\n+  <version>1000</version>\n </metadata>\ndiff --git a/plone/app/iterate/profiles/to1000/actions.xml b/plone/app/iterate/profiles/to1000/actions.xml\nnew file mode 100644\nindex 0000000..0d33102\n--- /dev/null\n+++ b/plone/app/iterate/profiles/to1000/actions.xml\n@@ -0,0 +1,19 @@\n+<?xml version="1.0"?>\n+<object name="portal_actions" meta_type="Plone Actions Tool"\n+   xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+ <object name="object_buttons" meta_type="CMF Action Category">\n+\n+  <object name="iterate_checkin" meta_type="CMF Action" i18n:domain="plone">\n+   <property name="icon_expr">string:box-arrow-in-up-right</property>\n+  </object>\n+\n+  <object name="iterate_checkout" meta_type="CMF Action" i18n:domain="plone">\n+   <property name="icon_expr">string:box-arrow-down-left</property>\n+  </object>\n+\n+  <object name="iterate_checkout_cancel" meta_type="CMF Action" i18n:domain="plone">\n+   <property name="icon_expr">string:arrow-counterclockwise</property>\n+  </object>\n+\n+ </object>\n+</object>\ndiff --git a/plone/app/iterate/util.py b/plone/app/iterate/util.py\nindex 542b9aa..fac5e9a 100644\n--- a/plone/app/iterate/util.py\n+++ b/plone/app/iterate/util.py\n@@ -23,7 +23,6 @@\n \n from .interfaces import annotation_key\n from persistent.dict import PersistentDict\n-from plone.base.utils import get_installer\n from zope.annotation import IAnnotations\n \n \n@@ -34,9 +33,3 @@ def get_storage(context, default=None):\n             return default\n         annotations[annotation_key] = PersistentDict()\n     return annotations[annotation_key]\n-\n-\n-def upgrade_by_reinstall(context):\n-    qi = get_installer(context)\n-    qi.uninstall_product("plone.app.iterate")\n-    qi.install_product("plone.app.iterate")\n'

