Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-05T19:27:42+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/4a359e2fc794f3955554becb0720f4fb18c65704

deprecate catalog_get_all (fixes https://github.com/plone/Products.CMFPlone/issues/2258)

Files changed:
A news/2258.bugfix
M Products/CMFPlone/CatalogTool.py

b'diff --git a/Products/CMFPlone/CatalogTool.py b/Products/CMFPlone/CatalogTool.py\nindex cafc4b433..c14e059cd 100644\n--- a/Products/CMFPlone/CatalogTool.py\n+++ b/Products/CMFPlone/CatalogTool.py\n@@ -35,6 +35,7 @@\n from zope.annotation.interfaces import IAnnotations\n from zope.component import queryMultiAdapter\n from zope.component.hooks import getSite\n+from zope.deprecation.deprecation import deprecate\n from zope.interface import implementer\n from zope.interface import Interface\n from zope.interface import providedBy\n@@ -125,16 +126,12 @@\n ))\n \n \n+@deprecate(\'Use catalog.getAllBrains() instead. \' +\n+           \'catalog_get_all will be removed in Plone 6\')\n def catalog_get_all(catalog, unique_idx=\'UID\'):\n     """Get all brains from the catalog.\n     """\n-    res = [\n-        catalog({\n-            unique_idx: catalog._catalog.getIndexDataForRID(it)[unique_idx]\n-        })[0]\n-        for it in catalog._catalog.data\n-    ]\n-    return res\n+    return catalog.getAllBrains()\n \n \n @indexer(Interface)\ndiff --git a/news/2258.bugfix b/news/2258.bugfix\nnew file mode 100644\nindex 000000000..d0d434c45\n--- /dev/null\n+++ b/news/2258.bugfix\n@@ -0,0 +1,2 @@\n+deprecate catalog_get_all(catalog) in favor of catalog.getAllBrains()\n+[pbauer]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-05T20:36:19+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/450c7690eedea0ef15a8f543f8b49ef1e9a8d4fc

Merge pull request #2720 from plone/deprecate_catalog_get_all

deprecate catalog_get_all

Files changed:
A news/2258.bugfix
M Products/CMFPlone/CatalogTool.py

b'diff --git a/Products/CMFPlone/CatalogTool.py b/Products/CMFPlone/CatalogTool.py\nindex cafc4b433..c14e059cd 100644\n--- a/Products/CMFPlone/CatalogTool.py\n+++ b/Products/CMFPlone/CatalogTool.py\n@@ -35,6 +35,7 @@\n from zope.annotation.interfaces import IAnnotations\n from zope.component import queryMultiAdapter\n from zope.component.hooks import getSite\n+from zope.deprecation.deprecation import deprecate\n from zope.interface import implementer\n from zope.interface import Interface\n from zope.interface import providedBy\n@@ -125,16 +126,12 @@\n ))\n \n \n+@deprecate(\'Use catalog.getAllBrains() instead. \' +\n+           \'catalog_get_all will be removed in Plone 6\')\n def catalog_get_all(catalog, unique_idx=\'UID\'):\n     """Get all brains from the catalog.\n     """\n-    res = [\n-        catalog({\n-            unique_idx: catalog._catalog.getIndexDataForRID(it)[unique_idx]\n-        })[0]\n-        for it in catalog._catalog.data\n-    ]\n-    return res\n+    return catalog.getAllBrains()\n \n \n @indexer(Interface)\ndiff --git a/news/2258.bugfix b/news/2258.bugfix\nnew file mode 100644\nindex 000000000..d0d434c45\n--- /dev/null\n+++ b/news/2258.bugfix\n@@ -0,0 +1,2 @@\n+deprecate catalog_get_all(catalog) in favor of catalog.getAllBrains()\n+[pbauer]\n'

