Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2022-09-12T18:54:27+05:30
Author: anirudhhkashyap (anirudhhkashyap) <anirudh.k.harish@gmail.com>
Commit: https://github.com/plone/plone.outputfilters/commit/d87816acada4ba53a7a79ebeeed45fd4503b082c

Use our new uuidToObject() from plone.app.uuid.utils

Files changed:
A news/52.bugfix
M plone/outputfilters/browser/resolveuid.py
M plone/outputfilters/filters/resolveuid_and_caption.py
M setup.py

b'diff --git a/news/52.bugfix b/news/52.bugfix\nnew file mode 100644\nindex 0000000..fba7aff\n--- /dev/null\n+++ b/news/52.bugfix\n@@ -0,0 +1,2 @@\n+Use our new version of uuidToObject() from plone.app.uuid.utils\n+[anirudhhkashyap] \n\\ No newline at end of file\ndiff --git a/plone/outputfilters/browser/resolveuid.py b/plone/outputfilters/browser/resolveuid.py\nindex 8c1e05b..b6929e7 100644\n--- a/plone/outputfilters/browser/resolveuid.py\n+++ b/plone/outputfilters/browser/resolveuid.py\n@@ -5,6 +5,7 @@\n from zope.interface import implementer\n from zope.publisher.browser import BrowserView\n from zope.publisher.interfaces import IPublishTraverse\n+from plone.app.uuid.utils import uuidToObject as new_uuidToObject\n \n \n try:\n@@ -27,11 +28,8 @@ def uuidToURL(uuid):\n     "But be aware that this does an extra security check."\n )\n def uuidToObject(uuid):\n-    """Resolves a UUID to an object via the UID index of portal_catalog."""\n-    catalog = getToolByName(getSite(), "portal_catalog")\n-    res = catalog.unrestrictedSearchResults(UID=uuid)\n-    if res:\n-        return res[0]._unrestrictedGetObject()\n+    """Resolves a UUID to an object via the Physical Path"""\n+    return new_uuidToObject(uuid, unrestricted=True)\n \n \n try:\ndiff --git a/plone/outputfilters/filters/resolveuid_and_caption.py b/plone/outputfilters/filters/resolveuid_and_caption.py\nindex fc2b411..6d3b10b 100644\n--- a/plone/outputfilters/filters/resolveuid_and_caption.py\n+++ b/plone/outputfilters/filters/resolveuid_and_caption.py\n@@ -6,7 +6,7 @@\n from DocumentTemplate.DT_Var import newline_to_br\n from DocumentTemplate.html_quote import html_quote\n from plone.base.utils import safe_text\n-from plone.outputfilters.browser.resolveuid import uuidToObject\n+from plone.app.uuid.utils import uuidToObject\n from plone.outputfilters.interfaces import IFilter\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.interfaces import IContentish\n@@ -274,7 +274,8 @@ def resolve_link(self, href):\n             match = resolveuid_re.match(subpath)\n             if match is not None:\n                 uid, _subpath = match.groups()\n-                obj = uuidToObject(uid)\n+                # Getting URL of an object from it\'s UUID needs no permission checks\n+                obj = uuidToObject(uid, unrestricted=True)\n                 if obj is not None:\n                     subpath = _subpath\n \ndiff --git a/setup.py b/setup.py\nindex c02b1d5..a61746e 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -64,7 +64,7 @@ def read(filename):\n         "Products.MimetypesRegistry",\n         "Products.PortalTransforms>=2.0",\n         "plone.namedfile",\n-        "plone.app.uuid",\n+        "plone.app.uuid>=2.2.0",\n         "setuptools",\n         "unidecode",\n         "zope.deprecation",\n'

Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2022-09-12T18:57:20+05:30
Author: anirudhhkashyap (anirudhhkashyap) <anirudh.k.harish@gmail.com>
Commit: https://github.com/plone/plone.outputfilters/commit/7d6406f0876f73b5af36d9a2929729d1c29358b6

Updated deprecation message

Files changed:
M plone/outputfilters/browser/resolveuid.py

b'diff --git a/plone/outputfilters/browser/resolveuid.py b/plone/outputfilters/browser/resolveuid.py\nindex b6929e7..b3328ad 100644\n--- a/plone/outputfilters/browser/resolveuid.py\n+++ b/plone/outputfilters/browser/resolveuid.py\n@@ -24,8 +24,7 @@ def uuidToURL(uuid):\n \n \n @deprecate(\n-    "Please use plone.app.uuid.utils.uuidToObject instead. "\n-    "But be aware that this does an extra security check."\n+    "Import from plone.app.uuid.utils instead. To be removed in version 6"\n )\n def uuidToObject(uuid):\n     """Resolves a UUID to an object via the Physical Path"""\n'

Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2022-11-15T10:52:02+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.outputfilters/commit/6c203791b25cc5139e4b19fe449a3f6d48d0b490

Merge pull request #55 from plone/new-uuidToObject

Use our new uuidToObject()

Files changed:
A news/52.bugfix
M plone/outputfilters/browser/resolveuid.py
M plone/outputfilters/filters/resolveuid_and_caption.py
M setup.py

b'diff --git a/news/52.bugfix b/news/52.bugfix\nnew file mode 100644\nindex 0000000..fba7aff\n--- /dev/null\n+++ b/news/52.bugfix\n@@ -0,0 +1,2 @@\n+Use our new version of uuidToObject() from plone.app.uuid.utils\n+[anirudhhkashyap] \n\\ No newline at end of file\ndiff --git a/plone/outputfilters/browser/resolveuid.py b/plone/outputfilters/browser/resolveuid.py\nindex 8c1e05b..b3328ad 100644\n--- a/plone/outputfilters/browser/resolveuid.py\n+++ b/plone/outputfilters/browser/resolveuid.py\n@@ -5,6 +5,7 @@\n from zope.interface import implementer\n from zope.publisher.browser import BrowserView\n from zope.publisher.interfaces import IPublishTraverse\n+from plone.app.uuid.utils import uuidToObject as new_uuidToObject\n \n \n try:\n@@ -23,15 +24,11 @@ def uuidToURL(uuid):\n \n \n @deprecate(\n-    "Please use plone.app.uuid.utils.uuidToObject instead. "\n-    "But be aware that this does an extra security check."\n+    "Import from plone.app.uuid.utils instead. To be removed in version 6"\n )\n def uuidToObject(uuid):\n-    """Resolves a UUID to an object via the UID index of portal_catalog."""\n-    catalog = getToolByName(getSite(), "portal_catalog")\n-    res = catalog.unrestrictedSearchResults(UID=uuid)\n-    if res:\n-        return res[0]._unrestrictedGetObject()\n+    """Resolves a UUID to an object via the Physical Path"""\n+    return new_uuidToObject(uuid, unrestricted=True)\n \n \n try:\ndiff --git a/plone/outputfilters/filters/resolveuid_and_caption.py b/plone/outputfilters/filters/resolveuid_and_caption.py\nindex fc2b411..6d3b10b 100644\n--- a/plone/outputfilters/filters/resolveuid_and_caption.py\n+++ b/plone/outputfilters/filters/resolveuid_and_caption.py\n@@ -6,7 +6,7 @@\n from DocumentTemplate.DT_Var import newline_to_br\n from DocumentTemplate.html_quote import html_quote\n from plone.base.utils import safe_text\n-from plone.outputfilters.browser.resolveuid import uuidToObject\n+from plone.app.uuid.utils import uuidToObject\n from plone.outputfilters.interfaces import IFilter\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.interfaces import IContentish\n@@ -274,7 +274,8 @@ def resolve_link(self, href):\n             match = resolveuid_re.match(subpath)\n             if match is not None:\n                 uid, _subpath = match.groups()\n-                obj = uuidToObject(uid)\n+                # Getting URL of an object from it\'s UUID needs no permission checks\n+                obj = uuidToObject(uid, unrestricted=True)\n                 if obj is not None:\n                     subpath = _subpath\n \ndiff --git a/setup.py b/setup.py\nindex 3d7b358..33d330d 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -64,7 +64,7 @@ def read(filename):\n         "Products.MimetypesRegistry",\n         "Products.PortalTransforms>=2.0",\n         "plone.namedfile",\n-        "plone.app.uuid",\n+        "plone.app.uuid>=2.2.0",\n         "setuptools",\n         "unidecode",\n         "zope.deprecation",\n'

