Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2021-10-07T11:11:38+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/28f19832db32d5156c3566d1ba4518efead69801

fix display mode of a widget in BS5

Files changed:
A news/130.bugfix
M plone/app/z3cform/templates/widget.pt

b'diff --git a/news/130.bugfix b/news/130.bugfix\nnew file mode 100644\nindex 0000000..350abd3\n--- /dev/null\n+++ b/news/130.bugfix\n@@ -0,0 +1 @@\n+Fix widget display mode for Bootstrap 5. [jensens]\ndiff --git a/plone/app/z3cform/templates/widget.pt b/plone/app/z3cform/templates/widget.pt\nindex e68bd02..63f8bed 100644\n--- a/plone/app/z3cform/templates/widget.pt\n+++ b/plone/app/z3cform/templates/widget.pt\n@@ -2,40 +2,42 @@\n    metal:define-macro="widget-wrapper"\n    i18n:domain="plone"\n    tal:define="widget nocall:context;\n-               hidden python:widget.mode == \'hidden\';\n-               error widget/error;\n+               error python:widget.error;\n                error_class python:error and \' error\' or \'\';\n                empty_values python: (None, \'\', [], (\'\', \'\', \'\', \'00\', \'00\', \'\'), (\'\', \'\', \'\'));\n                empty_class python: (widget.value in empty_values) and \' empty\' or \'\';\n-               wrapper_css_class  widget/wrapper_css_class|nothing;\n-               fieldname_class string:kssattr-fieldname-${widget/name};"\n-   id="formfield-${widget/id}"\n-   class="mb-3 field pat-inlinevalidation ${fieldname_class}${error_class}${empty_class} ${wrapper_css_class}"\n+               "\n+   id="formfield-${python:widget.id}"\n+   class="mb-3 field pat-inlinevalidation fieldname-${python:widget.name}} widget-mode-${python:widget.mode}${error_class}${empty_class} ${python:getattr(widget, \'wrapper_css_class\', False) or False}"\n    data-fieldname="${widget/name}"\n    data-pat-inlinevalidation=\'{"type":"z3c.form"}\'>\n-    <label for="" class="form-label"\n-        tal:attributes="for widget/id"\n-        tal:condition="python: not hidden and widget.label">\n-        <span i18n:translate="" tal:replace="widget/label">label</span>\n+    <label for="${python:widget.id}"\n+           class="form-label"\n+           tal:condition="python: widget.mode == \'input\' and widget.label">\n+        <span i18n:translate="" tal:replace="python:widget.label">label</span>\n \n         <span class="required" title="Required"\n-              tal:condition="python:widget.required and widget.mode == \'input\'"\n+              tal:condition="python:widget.required"\n               i18n:attributes="title title_required;"></span>\n     </label>\n+    <b class="widget-label form-label d-block"\n+          tal:condition="python: widget.mode == \'display\' and widget.label">\n+        <span i18n:translate="" tal:replace="python:widget.label">label</span>\n+    </b>\n \n-    <input type="text" tal:replace="structure widget/render"\n+    <input type="text" tal:replace="structure python:widget.render()"\n            metal:define-slot="widget" />\n \n     <div tal:define="description python: getattr(widget, \'description\', widget.field.description)"\n            i18n:translate=""\n            tal:content="structure description"\n-           tal:condition="python:description and not hidden"\n+           tal:condition="python:description and widget.mode == \'input\'"\n            class="form-text">\n       help text\n     </div>\n \n     <div tal:condition="error"\n-         tal:replace="structure error/render|nothing">\n+         tal:replace="structure python:error.render() or False">\n         Error\n     </div>\n \n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2021-10-07T13:58:06+02:00
Author: agitator (agitator) <agitator@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/bc4453e704768275e1783db21e3e01b4c17d58d7

Merge pull request #130 from plone/widget-display-mode-bs5

fix display mode of a widget in BS5

Files changed:
A news/130.bugfix
M plone/app/z3cform/templates/widget.pt

b'diff --git a/news/130.bugfix b/news/130.bugfix\nnew file mode 100644\nindex 0000000..350abd3\n--- /dev/null\n+++ b/news/130.bugfix\n@@ -0,0 +1 @@\n+Fix widget display mode for Bootstrap 5. [jensens]\ndiff --git a/plone/app/z3cform/templates/widget.pt b/plone/app/z3cform/templates/widget.pt\nindex e68bd02..63f8bed 100644\n--- a/plone/app/z3cform/templates/widget.pt\n+++ b/plone/app/z3cform/templates/widget.pt\n@@ -2,40 +2,42 @@\n    metal:define-macro="widget-wrapper"\n    i18n:domain="plone"\n    tal:define="widget nocall:context;\n-               hidden python:widget.mode == \'hidden\';\n-               error widget/error;\n+               error python:widget.error;\n                error_class python:error and \' error\' or \'\';\n                empty_values python: (None, \'\', [], (\'\', \'\', \'\', \'00\', \'00\', \'\'), (\'\', \'\', \'\'));\n                empty_class python: (widget.value in empty_values) and \' empty\' or \'\';\n-               wrapper_css_class  widget/wrapper_css_class|nothing;\n-               fieldname_class string:kssattr-fieldname-${widget/name};"\n-   id="formfield-${widget/id}"\n-   class="mb-3 field pat-inlinevalidation ${fieldname_class}${error_class}${empty_class} ${wrapper_css_class}"\n+               "\n+   id="formfield-${python:widget.id}"\n+   class="mb-3 field pat-inlinevalidation fieldname-${python:widget.name}} widget-mode-${python:widget.mode}${error_class}${empty_class} ${python:getattr(widget, \'wrapper_css_class\', False) or False}"\n    data-fieldname="${widget/name}"\n    data-pat-inlinevalidation=\'{"type":"z3c.form"}\'>\n-    <label for="" class="form-label"\n-        tal:attributes="for widget/id"\n-        tal:condition="python: not hidden and widget.label">\n-        <span i18n:translate="" tal:replace="widget/label">label</span>\n+    <label for="${python:widget.id}"\n+           class="form-label"\n+           tal:condition="python: widget.mode == \'input\' and widget.label">\n+        <span i18n:translate="" tal:replace="python:widget.label">label</span>\n \n         <span class="required" title="Required"\n-              tal:condition="python:widget.required and widget.mode == \'input\'"\n+              tal:condition="python:widget.required"\n               i18n:attributes="title title_required;"></span>\n     </label>\n+    <b class="widget-label form-label d-block"\n+          tal:condition="python: widget.mode == \'display\' and widget.label">\n+        <span i18n:translate="" tal:replace="python:widget.label">label</span>\n+    </b>\n \n-    <input type="text" tal:replace="structure widget/render"\n+    <input type="text" tal:replace="structure python:widget.render()"\n            metal:define-slot="widget" />\n \n     <div tal:define="description python: getattr(widget, \'description\', widget.field.description)"\n            i18n:translate=""\n            tal:content="structure description"\n-           tal:condition="python:description and not hidden"\n+           tal:condition="python:description and widget.mode == \'input\'"\n            class="form-text">\n       help text\n     </div>\n \n     <div tal:condition="error"\n-         tal:replace="structure error/render|nothing">\n+         tal:replace="structure python:error.render() or False">\n         Error\n     </div>\n \n'

