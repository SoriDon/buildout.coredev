Repository: plone.autoform


Branch: refs/heads/master
Date: 2017-05-03T13:47:53-05:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.autoform/commit/0beaeb85057759aab310b496fce2be959be5e75c

Fix updateFieldsFromSchemata

Files changed:
M plone/autoform/base.py
M plone/autoform/tests/test_base.py

diff --git a/plone/autoform/base.py b/plone/autoform/base.py
index b06d5d4..e20ba54 100644
--- a/plone/autoform/base.py
+++ b/plone/autoform/base.py
@@ -119,7 +119,7 @@ def updateFieldsFromSchemata(self):
         # Then process relative field movements. The base schema is processed
         # last to allow it to override any movements made in additional
         # schemata.
-        rules = None
+        rules = {'__all__': {}}
         for schema in self.additionalSchemata:
             order = mergedTaggedValueList(schema, ORDER_KEY)
             rules = self._calculate_field_moves(
diff --git a/plone/autoform/tests/test_base.py b/plone/autoform/tests/test_base.py
index 4e99c43..39bc0d6 100644
--- a/plone/autoform/tests/test_base.py
+++ b/plone/autoform/tests/test_base.py
@@ -119,3 +119,9 @@ def test_calc_field_move_override(self):
         self.assertIn('z', rules)
         self.assertNotIn('a', rules)
         self.assertNotIn('c', rules)
+
+    def test_updateFieldsFromSchemata(self):
+        from plone.autoform.base import AutoFields
+        autofields = AutoFields()
+        autofields.updateFieldsFromSchemata()
+        # (the assertion is that is doesn't break)


Repository: plone.autoform


Branch: refs/heads/master
Date: 2017-05-03T13:49:56-05:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.autoform/commit/0922a5b060badf43441ffc2fdccbe1c8a83ee410

changelog

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 0282ad2..777da38 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix traceback in updateFieldsFromSchemata for forms with no schema.
+  [davisagli]
 
 
 1.7.2 (2017-04-01)


Repository: plone.autoform


Branch: refs/heads/master
Date: 2017-05-03T14:37:56-05:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.autoform/commit/8c4cb7e98484ac68ff68fbec04df0e1e671c898f

fix test

Files changed:
M plone/autoform/tests/test_base.py

diff --git a/plone/autoform/tests/test_base.py b/plone/autoform/tests/test_base.py
index 39bc0d6..1cbcfe4 100644
--- a/plone/autoform/tests/test_base.py
+++ b/plone/autoform/tests/test_base.py
@@ -123,5 +123,6 @@ def test_calc_field_move_override(self):
     def test_updateFieldsFromSchemata(self):
         from plone.autoform.base import AutoFields
         autofields = AutoFields()
+        autofields.request = {}
         autofields.updateFieldsFromSchemata()
         # (the assertion is that is doesn't break)


Repository: plone.autoform


Branch: refs/heads/master
Date: 2017-05-03T15:12:41-05:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.autoform/commit/3352a4cc5ebc4690d5337519e81d5eea40e067ee

Actually make an assertion in the test

Files changed:
M plone/autoform/tests/test_base.py

diff --git a/plone/autoform/tests/test_base.py b/plone/autoform/tests/test_base.py
index 1cbcfe4..602fec3 100644
--- a/plone/autoform/tests/test_base.py
+++ b/plone/autoform/tests/test_base.py
@@ -125,4 +125,4 @@ def test_updateFieldsFromSchemata(self):
         autofields = AutoFields()
         autofields.request = {}
         autofields.updateFieldsFromSchemata()
-        # (the assertion is that is doesn't break)
+        self.assertEqual(autofields.groups, [])


Repository: plone.autoform


Branch: refs/heads/master
Date: 2017-05-03T23:44:09+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.autoform/commit/9c493dee6b4404d12dcca5df187e6989449ef0e1

Merge pull request #25 from plone/davisagli-fix-autofields

Fix updateFieldsFromSchemata for schemaless forms

Files changed:
M CHANGES.rst
M plone/autoform/base.py
M plone/autoform/tests/test_base.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0282ad2..777da38 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix traceback in updateFieldsFromSchemata for forms with no schema.
+  [davisagli]
 
 
 1.7.2 (2017-04-01)
diff --git a/plone/autoform/base.py b/plone/autoform/base.py
index b06d5d4..e20ba54 100644
--- a/plone/autoform/base.py
+++ b/plone/autoform/base.py
@@ -119,7 +119,7 @@ def updateFieldsFromSchemata(self):
         # Then process relative field movements. The base schema is processed
         # last to allow it to override any movements made in additional
         # schemata.
-        rules = None
+        rules = {'__all__': {}}
         for schema in self.additionalSchemata:
             order = mergedTaggedValueList(schema, ORDER_KEY)
             rules = self._calculate_field_moves(
diff --git a/plone/autoform/tests/test_base.py b/plone/autoform/tests/test_base.py
index 4e99c43..602fec3 100644
--- a/plone/autoform/tests/test_base.py
+++ b/plone/autoform/tests/test_base.py
@@ -119,3 +119,10 @@ def test_calc_field_move_override(self):
         self.assertIn('z', rules)
         self.assertNotIn('a', rules)
         self.assertNotIn('c', rules)
+
+    def test_updateFieldsFromSchemata(self):
+        from plone.autoform.base import AutoFields
+        autofields = AutoFields()
+        autofields.request = {}
+        autofields.updateFieldsFromSchemata()
+        self.assertEqual(autofields.groups, [])


