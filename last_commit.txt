Repository: plone.tiles


Branch: refs/heads/master
Date: 2016-02-15T16:35:50+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.tiles/commit/aaf9110049c41776c82644bb601d58ee42d6fccf

better caching

Files changed:
M .travis.yml

diff --git a/.travis.yml b/.travis.yml
index 51555f8..bf856f8 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,13 +1,20 @@
 language: python
 python: 2.7
 sudo: false
-cache:
-  directories:
-  - eggs
 env:
 - PLONE_VERSION=4.2.x
 - PLONE_VERSION=4.3.x
 - PLONE_VERSION=5.x
+cache:
+  pip: true
+  directories:
+  - $HOME/buildout-cache
+before_install:
+  - mkdir -p $HOME/buildout-cache/{eggs,downloads}
+  - mkdir $HOME/.buildout
+  - echo "[buildout]" > $HOME/.buildout/default.cfg
+  - echo "download-cache = $HOME/buildout-cache/downloads" >> $HOME/.buildout/default.cfg
+  - echo "eggs-directory = $HOME/buildout-cache/eggs" >> $HOME/.buildout/default.cfg
 install:
 - python bootstrap.py -c test-$PLONE_VERSION.cfg
 - bin/buildout -N -t 3 -c test-$PLONE_VERSION.cfg annotate


Repository: plone.tiles


Branch: refs/heads/master
Date: 2016-02-15T16:36:16+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.tiles/commit/504164e3524cec57954fcf1e22462f8404935852

isort

Files changed:
A .isort.cfg
M bootstrap.py
M plone/tiles/absoluteurl.py
M plone/tiles/data.py
M plone/tiles/esi.py
M plone/tiles/fieldtypeconverters.py
M plone/tiles/interfaces.py
M plone/tiles/meta.py
M plone/tiles/tests.py
M plone/tiles/type.py
M setup.py

diff --git a/.isort.cfg b/.isort.cfg
new file mode 100644
index 0000000..fb79921
--- /dev/null
+++ b/.isort.cfg
@@ -0,0 +1,5 @@
+[settings]
+force_alphabetical_sort=True
+force_single_line=True
+lines_after_imports=2
+line_length=200
diff --git a/bootstrap.py b/bootstrap.py
index c90ed48..7461c2a 100644
--- a/bootstrap.py
+++ b/bootstrap.py
@@ -20,9 +20,16 @@
 $Id$
 """
 
-import os, shutil, sys, tempfile, urllib2
 from optparse import OptionParser
 
+import os
+import shutil
+import sys
+import tempfile
+import urllib2
+import zc.buildout.buildout
+
+
 tmpeggs = tempfile.mkdtemp()
 
 is_jython = sys.platform.startswith('java')
@@ -122,6 +129,5 @@ def quote (c):
 
 ws.add_entry(tmpeggs)
 ws.require('zc.buildout' + VERSION)
-import zc.buildout.buildout
 zc.buildout.buildout.main(args)
 shutil.rmtree(tmpeggs)
diff --git a/plone/tiles/absoluteurl.py b/plone/tiles/absoluteurl.py
index 9e86186..dd2b66a 100644
--- a/plone/tiles/absoluteurl.py
+++ b/plone/tiles/absoluteurl.py
@@ -1,15 +1,15 @@
 # -*- coding: utf-8 -*-
 
-import urllib
-
+from plone.tiles.data import encode
+from plone.tiles.interfaces import ITileDataManager
+from plone.tiles.interfaces import ITileType
 from zope.component import getMultiAdapter
 from zope.component import queryUtility
-
-from zope.traversing.browser.interfaces import IAbsoluteURL
 from zope.traversing.browser.absoluteurl import AbsoluteURL
+from zope.traversing.browser.interfaces import IAbsoluteURL
+
+import urllib
 
-from plone.tiles.interfaces import ITileType, ITileDataManager
-from plone.tiles.data import encode
 
 _safe = '@+'
 
diff --git a/plone/tiles/data.py b/plone/tiles/data.py
index 268a3be..072a198 100644
--- a/plone/tiles/data.py
+++ b/plone/tiles/data.py
@@ -1,25 +1,27 @@
 # -*- coding: utf-8 -*-
-import logging
-import urllib
-from zope.interface import implements
-from zope.interface import implementer
-from zope.interface import Interface
-from zope.component import adapts
+from persistent.dict import PersistentDict
+from plone.tiles.interfaces import IFieldTypeConverter
+from plone.tiles.interfaces import IPersistentTile
+from plone.tiles.interfaces import ITile
+from plone.tiles.interfaces import ITileDataContext
+from plone.tiles.interfaces import ITileDataManager
+from plone.tiles.interfaces import ITileType
+from zope.annotation.interfaces import IAnnotations
 from zope.component import adapter
-from zope.component import queryUtility
+from zope.component import adapts
 from zope.component import getMultiAdapter
+from zope.component import queryUtility
 from zope.component.interfaces import ComponentLookupError
-from zope.schema import getFieldsInOrder
+from zope.interface import implementer
+from zope.interface import implements
+from zope.interface import Interface
 from zope.schema import getFields
+from zope.schema import getFieldsInOrder
 from zope.schema.interfaces import ISequence
-from zope.annotation.interfaces import IAnnotations
-from plone.tiles.interfaces import ITileType
-from plone.tiles.interfaces import ITile
-from plone.tiles.interfaces import IPersistentTile
-from plone.tiles.interfaces import ITileDataManager
-from plone.tiles.interfaces import ITileDataContext
-from plone.tiles.interfaces import IFieldTypeConverter
-from persistent.dict import PersistentDict
+
+import logging
+import urllib
+
 
 try:
     import json
diff --git a/plone/tiles/esi.py b/plone/tiles/esi.py
index 8cdc45e..69518cb 100644
--- a/plone/tiles/esi.py
+++ b/plone/tiles/esi.py
@@ -1,11 +1,14 @@
 # -*- coding: utf-8 -*-
 
-import re
-
+from plone.tiles.interfaces import ESI_HEADER
+from plone.tiles.interfaces import ESI_HEADER_KEY
+from plone.tiles.interfaces import IESIRendered
+from plone.tiles.tile import PersistentTile
+from plone.tiles.tile import Tile
 from zope.interface import implements
 
-from plone.tiles.interfaces import IESIRendered, ESI_HEADER, ESI_HEADER_KEY
-from plone.tiles.tile import Tile, PersistentTile
+import re
+
 
 HEAD_CHILDREN = re.compile(r'<head[^>]*>(.*)</head>', re.I | re.S)
 BODY_CHILDREN = re.compile(r'<body[^>]*>(.*)</body>', re.I | re.S)
diff --git a/plone/tiles/fieldtypeconverters.py b/plone/tiles/fieldtypeconverters.py
index 379f1cf..7fd620f 100644
--- a/plone/tiles/fieldtypeconverters.py
+++ b/plone/tiles/fieldtypeconverters.py
@@ -1,7 +1,7 @@
 # -*- coding: utf-8 -*-
 
-from zope.interface import implements
 from plone.tiles.interfaces import IFieldTypeConverter
+from zope.interface import implements
 
 
 class NoConverter(object):
diff --git a/plone/tiles/interfaces.py b/plone/tiles/interfaces.py
index 67ceb1b..5a43ea1 100644
--- a/plone/tiles/interfaces.py
+++ b/plone/tiles/interfaces.py
@@ -1,11 +1,12 @@
 # -*- coding: utf-8 -*-
 
 from zope.interface import Interface
-import zope.schema
-
 from zope.interface.interfaces import IInterface
 from zope.publisher.interfaces.browser import IBrowserView
 
+import zope.schema
+
+
 ESI_HEADER = 'X-ESI-Enabled'
 ESI_HEADER_KEY = 'HTTP_' + ESI_HEADER.replace('-', '_').upper()
 
diff --git a/plone/tiles/meta.py b/plone/tiles/meta.py
index 401573b..9c66d2a 100644
--- a/plone/tiles/meta.py
+++ b/plone/tiles/meta.py
@@ -1,21 +1,19 @@
 # -*- coding: utf-8 -*-
 
-from zope.interface import Interface
-
+from plone.tiles.interfaces import ITileType
+from plone.tiles.tile import Tile
+from plone.tiles.type import TileType
 from zope import schema
-from zope.configuration.fields import (
-    GlobalObject, GlobalInterface, MessageID, Path)
-from zope.security.zcml import Permission
-
+from zope.component.zcml import utility
 from zope.configuration.exceptions import ConfigurationError
-
+from zope.configuration.fields import GlobalInterface
+from zope.configuration.fields import GlobalObject
+from zope.configuration.fields import MessageID
+from zope.configuration.fields import Path
+from zope.interface import Interface
 from zope.publisher.interfaces.browser import IDefaultBrowserLayer
+from zope.security.zcml import Permission
 
-from plone.tiles.interfaces import ITileType
-from plone.tiles.type import TileType
-from plone.tiles.tile import Tile
-
-from zope.component.zcml import utility
 
 try:
     from Products.Five.browser.metaconfigure import page
diff --git a/plone/tiles/tests.py b/plone/tiles/tests.py
index 7e9bc08..848a27e 100644
--- a/plone/tiles/tests.py
+++ b/plone/tiles/tests.py
@@ -1,18 +1,22 @@
 # -*- coding: utf-8 -*-
 
-import unittest2 as unittest
+from plone.testing import Layer
+from plone.testing import layered
+from plone.testing import z2
+from plone.testing import zca
+from plone.tiles import PersistentTile
+from plone.tiles import Tile
+from zope import schema
+from zope.configuration import xmlconfig
+from zope.interface import Interface
+
 import doctest
-from plone.testing import Layer, layered
-from plone.testing import zca, z2
+import unittest2 as unittest
 
-from zope.configuration import xmlconfig
 
 # For directive tests
 
-from zope.interface import Interface
-from zope import schema
 
-from plone.tiles import Tile, PersistentTile
 
 
 class IDummySchema(Interface):
diff --git a/plone/tiles/type.py b/plone/tiles/type.py
index a89738d..7f52d58 100644
--- a/plone/tiles/type.py
+++ b/plone/tiles/type.py
@@ -1,7 +1,7 @@
 # -*- coding: utf-8 -*-
 
-from zope.interface import implements
 from plone.tiles.interfaces import ITileType
+from zope.interface import implements
 
 
 class TileType(object):
diff --git a/setup.py b/setup.py
index 4bd3042..6b61630 100644
--- a/setup.py
+++ b/setup.py
@@ -1,6 +1,8 @@
-import os
-from setuptools import setup
 from setuptools import find_packages
+from setuptools import setup
+
+import os
+
 
 version = '1.5.2.dev0'
 


Repository: plone.tiles


Branch: refs/heads/master
Date: 2016-02-15T16:36:46+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.tiles/commit/1d01a51f22dcb5544f0ab846aa5b0dea61ad8154

autopep8 -ir .

Files changed:
M bootstrap.py
M plone/tiles/tests.py

diff --git a/bootstrap.py b/bootstrap.py
index 7461c2a..2cc139e 100644
--- a/bootstrap.py
+++ b/bootstrap.py
@@ -40,16 +40,16 @@
     'intended to meet a temporary need if you encounter problems with '
     'the zc.buildout 1.5 release.')
 parser.add_option("-v", "--version", dest="version", default='1.5.2',
-                          help='Use a specific zc.buildout version.  *This '
-                          'bootstrap script defaults to '
-                          '1.5.2, unlike usual buildout bootstrap scripts.*')
+                  help='Use a specific zc.buildout version.  *This '
+                  'bootstrap script defaults to '
+                  '1.5.2, unlike usual buildout bootstrap scripts.*')
 parser.add_option("-d", "--distribute",
-                   action="store_true", dest="distribute", default=False,
-                   help="Use Disribute rather than Setuptools.")
+                  action="store_true", dest="distribute", default=False,
+                  help="Use Disribute rather than Setuptools.")
 
 parser.add_option("-c", None, action="store", dest="config_file",
-                   help=("Specify the path to the buildout configuration "
-                         "file to be used."))
+                  help=("Specify the path to the buildout configuration "
+                        "file to be used."))
 
 options, args = parser.parse_args()
 
@@ -75,7 +75,7 @@
     ez = {}
     if USE_DISTRIBUTE:
         exec urllib2.urlopen('http://python-distribute.org/distribute_setup.py'
-                         ).read() in ez
+                             ).read() in ez
         ez['use_setuptools'](to_dir=tmpeggs, download_delay=0, no_fake=True)
     else:
         exec urllib2.urlopen('http://peak.telecommunity.com/dist/ez_setup.py'
@@ -90,14 +90,14 @@
 if sys.platform == 'win32':
     def quote(c):
         if ' ' in c:
-            return '"%s"' % c # work around spawn lamosity on windows
+            return '"%s"' % c  # work around spawn lamosity on windows
         else:
             return c
 else:
-    def quote (c):
+    def quote(c):
         return c
 
-ws  = pkg_resources.working_set
+ws = pkg_resources.working_set
 
 if USE_DISTRIBUTE:
     requirement = 'distribute'
@@ -105,8 +105,8 @@ def quote (c):
     requirement = 'setuptools'
 
 env = dict(os.environ,
-           PYTHONPATH=
-           ws.find(pkg_resources.Requirement.parse(requirement)).location
+           PYTHONPATH=ws.find(
+               pkg_resources.Requirement.parse(requirement)).location
            )
 
 cmd = [quote(sys.executable),
@@ -123,7 +123,7 @@ def quote (c):
 if is_jython:
     import subprocess
     exitcode = subprocess.Popen(cmd, env=env).wait()
-else: # Windows prefers this, apparently; otherwise we would prefer subprocess
+else:  # Windows prefers this, apparently; otherwise we would prefer subprocess
     exitcode = os.spawnle(*([os.P_WAIT, sys.executable] + cmd + [env]))
 assert exitcode == 0
 
diff --git a/plone/tiles/tests.py b/plone/tiles/tests.py
index 848a27e..8de88c5 100644
--- a/plone/tiles/tests.py
+++ b/plone/tiles/tests.py
@@ -17,8 +17,6 @@
 # For directive tests
 
 
-
-
 class IDummySchema(Interface):
     foo = schema.TextLine(title=u"Foo")
 
@@ -32,6 +30,7 @@ class IDummyLayer(Interface):
 
 
 class DummyTile(Tile):
+
     def __call__(self):
         return u"dummy"
 


Repository: plone.tiles


Branch: refs/heads/master
Date: 2016-02-15T16:37:07+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.tiles/commit/ac34e213bc90dd96e08f06190fc1539dc2956803

autopep8 -ira .

Files changed:
M plone/tiles/data.py

diff --git a/plone/tiles/data.py b/plone/tiles/data.py
index 072a198..24af156 100644
--- a/plone/tiles/data.py
+++ b/plone/tiles/data.py
@@ -301,7 +301,8 @@ def decode(data, schema, missing=True):
             for item in value:
                 if isinstance(item, str):
                     value = unicode(item, 'utf-8')
-                if field.value_type._type and not isinstance(item, field.value_type._type):
+                if field.value_type._type and not isinstance(
+                        item, field.value_type._type):
                     item = value_type_field_type(item)
                 converted.append(item)
 


Repository: plone.tiles


Branch: refs/heads/master
Date: 2016-02-15T16:46:10+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.tiles/commit/9a51936007643626af2d045c686dde3136e544d4

do not touch bootstrap

Files changed:
M bootstrap.py

diff --git a/bootstrap.py b/bootstrap.py
index 2cc139e..ed57894 100644
--- a/bootstrap.py
+++ b/bootstrap.py
@@ -16,118 +16,163 @@
 Simply run this script in a directory containing a buildout.cfg.
 The script accepts buildout command-line options, so you can
 use the -c option to specify an alternate configuration file.
-
-$Id$
 """
 
-from optparse import OptionParser
-
 import os
 import shutil
 import sys
 import tempfile
-import urllib2
-import zc.buildout.buildout
 
+from optparse import OptionParser
 
 tmpeggs = tempfile.mkdtemp()
 
-is_jython = sys.platform.startswith('java')
-
-# parsing arguments
-parser = OptionParser(
-    'This is a custom version of the zc.buildout %prog script.  It is '
-    'intended to meet a temporary need if you encounter problems with '
-    'the zc.buildout 1.5 release.')
-parser.add_option("-v", "--version", dest="version", default='1.5.2',
-                  help='Use a specific zc.buildout version.  *This '
-                  'bootstrap script defaults to '
-                  '1.5.2, unlike usual buildout bootstrap scripts.*')
-parser.add_option("-d", "--distribute",
-                  action="store_true", dest="distribute", default=False,
-                  help="Use Disribute rather than Setuptools.")
-
-parser.add_option("-c", None, action="store", dest="config_file",
+usage = '''\
+[DESIRED PYTHON FOR BUILDOUT] bootstrap.py [options]
+
+Bootstraps a buildout-based project.
+
+Simply run this script in a directory containing a buildout.cfg, using the
+Python that you want bin/buildout to use.
+
+Note that by using --find-links to point to local resources, you can keep 
+this script from going over the network.
+'''
+
+parser = OptionParser(usage=usage)
+parser.add_option("-v", "--version", help="use a specific zc.buildout version")
+
+parser.add_option("-t", "--accept-buildout-test-releases",
+                  dest='accept_buildout_test_releases',
+                  action="store_true", default=False,
+                  help=("Normally, if you do not specify a --version, the "
+                        "bootstrap script and buildout gets the newest "
+                        "*final* versions of zc.buildout and its recipes and "
+                        "extensions for you.  If you use this flag, "
+                        "bootstrap and buildout will get the newest releases "
+                        "even if they are alphas or betas."))
+parser.add_option("-c", "--config-file",
                   help=("Specify the path to the buildout configuration "
                         "file to be used."))
+parser.add_option("-f", "--find-links",
+                  help=("Specify a URL to search for buildout releases"))
+parser.add_option("--allow-site-packages",
+                  action="store_true", default=False,
+                  help=("Let bootstrap.py use existing site packages"))
 
-options, args = parser.parse_args()
 
-# if -c was provided, we push it back into args for buildout' main function
-if options.config_file is not None:
-    args += ['-c', options.config_file]
-
-if options.version is not None:
-    VERSION = '==%s' % options.version
-else:
-    VERSION = ''
+options, args = parser.parse_args()
 
-USE_DISTRIBUTE = options.distribute
-args = args + ['bootstrap']
+######################################################################
+# load/install setuptools
 
-to_reload = False
 try:
-    import pkg_resources
-    if not hasattr(pkg_resources, '_distribute'):
-        to_reload = True
-        raise ImportError
-except ImportError:
-    ez = {}
-    if USE_DISTRIBUTE:
-        exec urllib2.urlopen('http://python-distribute.org/distribute_setup.py'
-                             ).read() in ez
-        ez['use_setuptools'](to_dir=tmpeggs, download_delay=0, no_fake=True)
-    else:
-        exec urllib2.urlopen('http://peak.telecommunity.com/dist/ez_setup.py'
-                             ).read() in ez
-        ez['use_setuptools'](to_dir=tmpeggs, download_delay=0)
-
-    if to_reload:
-        reload(pkg_resources)
-    else:
+    if options.allow_site_packages:
+        import setuptools
         import pkg_resources
-
-if sys.platform == 'win32':
-    def quote(c):
-        if ' ' in c:
-            return '"%s"' % c  # work around spawn lamosity on windows
-        else:
-            return c
-else:
-    def quote(c):
-        return c
+    from urllib.request import urlopen
+except ImportError:
+    from urllib2 import urlopen
+
+ez = {}
+exec(urlopen('https://bootstrap.pypa.io/ez_setup.py').read(), ez)
+
+if not options.allow_site_packages:
+    # ez_setup imports site, which adds site packages
+    # this will remove them from the path to ensure that incompatible versions 
+    # of setuptools are not in the path
+    import site
+    # inside a virtualenv, there is no 'getsitepackages'. 
+    # We can't remove these reliably
+    if hasattr(site, 'getsitepackages'):
+        for sitepackage_path in site.getsitepackages():
+            sys.path[:] = [x for x in sys.path if sitepackage_path not in x]
+
+setup_args = dict(to_dir=tmpeggs, download_delay=0)
+ez['use_setuptools'](**setup_args)
+import setuptools
+import pkg_resources
+
+# This does not (always?) update the default working set.  We will
+# do it.
+for path in sys.path:
+    if path not in pkg_resources.working_set.entries:
+        pkg_resources.working_set.add_entry(path)
+
+######################################################################
+# Install buildout
 
 ws = pkg_resources.working_set
 
-if USE_DISTRIBUTE:
-    requirement = 'distribute'
-else:
-    requirement = 'setuptools'
-
-env = dict(os.environ,
-           PYTHONPATH=ws.find(
-               pkg_resources.Requirement.parse(requirement)).location
-           )
+cmd = [sys.executable, '-c',
+       'from setuptools.command.easy_install import main; main()',
+       '-mZqNxd', tmpeggs]
+
+find_links = os.environ.get(
+    'bootstrap-testing-find-links',
+    options.find_links or
+    ('http://downloads.buildout.org/'
+     if options.accept_buildout_test_releases else None)
+    )
+if find_links:
+    cmd.extend(['-f', find_links])
+
+setuptools_path = ws.find(
+    pkg_resources.Requirement.parse('setuptools')).location
+
+requirement = 'zc.buildout'
+version = options.version
+if version is None and not options.accept_buildout_test_releases:
+    # Figure out the most recent final version of zc.buildout.
+    import setuptools.package_index
+    _final_parts = '*final-', '*final'
+
+    def _final_version(parsed_version):
+        for part in parsed_version:
+            if (part[:1] == '*') and (part not in _final_parts):
+                return False
+        return True
+    index = setuptools.package_index.PackageIndex(
+        search_path=[setuptools_path])
+    if find_links:
+        index.add_find_links((find_links,))
+    req = pkg_resources.Requirement.parse(requirement)
+    if index.obtain(req) is not None:
+        best = []
+        bestv = None
+        for dist in index[req.project_name]:
+            distv = dist.parsed_version
+            if _final_version(distv):
+                if bestv is None or distv > bestv:
+                    best = [dist]
+                    bestv = distv
+                elif distv == bestv:
+                    best.append(dist)
+        if best:
+            best.sort()
+            version = best[-1].version
+if version:
+    requirement = '=='.join((requirement, version))
+cmd.append(requirement)
+
+import subprocess
+if subprocess.call(cmd, env=dict(os.environ, PYTHONPATH=setuptools_path)) != 0:
+    raise Exception(
+        "Failed to execute command:\n%s" % repr(cmd)[1:-1])
+
+######################################################################
+# Import and run buildout
 
-cmd = [quote(sys.executable),
-       '-c',
-       quote('from setuptools.command.easy_install import main; main()'),
-       '-mqNxd',
-       quote(tmpeggs)]
-
-if 'bootstrap-testing-find-links' in os.environ:
-    cmd.extend(['-f', os.environ['bootstrap-testing-find-links']])
+ws.add_entry(tmpeggs)
+ws.require(requirement)
+import zc.buildout.buildout
 
-cmd.append('zc.buildout' + VERSION)
+if not [a for a in args if '=' not in a]:
+    args.append('bootstrap')
 
-if is_jython:
-    import subprocess
-    exitcode = subprocess.Popen(cmd, env=env).wait()
-else:  # Windows prefers this, apparently; otherwise we would prefer subprocess
-    exitcode = os.spawnle(*([os.P_WAIT, sys.executable] + cmd + [env]))
-assert exitcode == 0
+# if -c was provided, we push it back into args for buildout' main function
+if options.config_file is not None:
+    args[0:0] = ['-c', options.config_file]
 
-ws.add_entry(tmpeggs)
-ws.require('zc.buildout' + VERSION)
 zc.buildout.buildout.main(args)
 shutil.rmtree(tmpeggs)


Repository: plone.tiles


Branch: refs/heads/master
Date: 2016-02-15T17:07:47+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.tiles/commit/be7ad7982f8cd7512149c2adb3ce3b64457ba003

dont fight with setuptools versions

Files changed:
M test-4.2.x.cfg
M test-4.3.x.cfg
M test-5.x.cfg

diff --git a/test-4.2.x.cfg b/test-4.2.x.cfg
index 2ddcdb1..96331dd 100644
--- a/test-4.2.x.cfg
+++ b/test-4.2.x.cfg
@@ -19,3 +19,6 @@ flake8-ignore = E501,C901
 
 [versions]
 coverage = 3.7
+
+# dont fight with setuptools versions
+setuptools =
diff --git a/test-4.3.x.cfg b/test-4.3.x.cfg
index 2af8913..b7f24e6 100644
--- a/test-4.3.x.cfg
+++ b/test-4.3.x.cfg
@@ -19,3 +19,6 @@ flake8-ignore = E501,C901
 
 [versions]
 coverage = 3.7
+
+# dont fight with setuptools versions
+setuptools =
diff --git a/test-5.x.cfg b/test-5.x.cfg
index fccbaaf..f41f343 100644
--- a/test-5.x.cfg
+++ b/test-5.x.cfg
@@ -20,3 +20,6 @@ flake8-ignore = E501,C901
 
 [versions]
 coverage = 3.7
+
+# dont fight with setuptools versions
+setuptools =


Repository: plone.tiles


Branch: refs/heads/master
Date: 2016-02-15T17:21:03+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.tiles/commit/c87ed5b2ad017c065cbae3dc26c3ddf04fb27472

doc style

Files changed:
M README.rst

diff --git a/README.rst b/README.rst
index bd4509c..03de474 100644
--- a/README.rst
+++ b/README.rst
@@ -13,44 +13,48 @@ creating "tiles" in the Deco layout system.
 Introduction
 ------------
 
-For the purposes of this package, a tile is a browser view and an associated
-utility providing some metadata about that view. The metadata includes a title
-and description, an 'add' permission and optionally a schema interface
-describing configurable aspects of the tile. The idea is that a UI (such as
-Deco) can present the user with a list of insertable tiles and optionally
-render a form to configure the tile upon insertion.
+For the purposes of this package,
+a tile is a browser view and an associated utility providing some metadata about that view.
+The metadata includes a title and description,
+an 'add' permission and optionally a schema interface describing configurable aspects of the tile.
+The idea is that a UI (such as Deco) can present the user with a list of insertable tiles and optionally render a form to configure the tile upon insertion.
 
-A tile is inserted into a layout as a link::
+A tile is inserted into a layout as a link:
+
+.. code_block:: xml
 
     <link rel="tile" target="placeholder" href="./@@sample.tile/tile1?option1=value1" />
 
-The sub-path (`tile1` in this case) is used to set the tile `id` attribute.
-This allows the tile to know its unique id, and, in the case of persistent
-tiles, look up its data. `sample.tile` is the name of the browser view that
-implements the tile. This is made available as the `__name__` attribute. Other
-parameters may be turned into tile data, available under the `data` attribute,
-a dict, for regular tiles. For persistent tiles (those deriving from the
-`PersistentTile` base class), the data is fetched from annotations instead,
+The sub-path (``tile1`` in this case) is used to set the tile ``id`` attribute.
+This allows the tile to know its unique id, and, in the case of persistent tiles, look up its data.
+``sample.tile`` is the name of the browser view that implements the tile.
+This is made available as the ``__name__`` attribute.
+Other parameters may be turned into tile data, available under the ``data`` attribute, a dict, for regular tiles.
+For persistent tiles
+(those deriving from the ``PersistentTile`` base class),
+the data is fetched from annotations instead,
 based on the tile id.
 
 There are three interfaces describing tiles in this package:
 
-* `IBasicTile` is the low-level interface for tiles. It extends
-  `IBrowserView` to describe the semantics of the `__name__` and  `id`
-  attributes.
-* `ITile` describes a tile that can be configured with some data. The data
-  is accessible via a dict called `data`. The default implementation of this
-  interface, `plone.tiles.Tile`, will use the schema of the tile type and
-  the query string (`self.request.form`) to construct that dictionary. This
-  interface also describes an attribute `url`, which gives the canonical
-  tile URL, including the id sub-path and any query string parameters. (Note
-  that tiles also correctly implement `IAbsoluteURL`.)
-* `IPersistentTile` describes a tile that stores its configuration in
-  object annotations, and is needed when configuration values cannot be
-  encoded into a query string. The default implementation is in
-  `plone.tiles.PersistentTile`. To make it possible to have several tiles
-  of a given type on the same layout, the annotations are keyed by the
-  tile `__name__`.
+``IBasicTile``
+    is the low-level interface for tiles.
+    It extends ``IBrowserView`` to describe the semantics of the ``__name__`` and  ``id`` attributes.
+``ITile``
+    describes a tile that can be configured with some data.
+    The data is accessible via a dict called ``data``.
+    The default implementation of this interface, ``plone.tiles.Tile``,
+    will use the schema of the tile type and the query string (``self.request.form``) to construct that dictionary.
+    This interface also describes an attribute ``url``,
+    which gives the canonical tile URL,
+    including the id sub-path and any query string parameters.
+    (Note that tiles also correctly implement ``IAbsoluteURL``.)
+```IPersistentTile``
+    describes a tile that stores its configuration in object annotations,
+    and is needed when configuration values cannot be encoded into a query string.
+    The default implementation is in ``plone.tiles.PersistentTile``.
+    To make it possible to have several tiles of a given type on the same layout,
+    the annotations are keyed by the tile ``__name__``.
 
 In addition, tiles are described by `ITileType`, which contains attributes
 for the tile name, title, description, add permission and schema (if
@@ -71,7 +75,9 @@ with a tile's schema interface.
 Creating a Simple Tile
 ----------------------
 
-The most basic tile looks like this::
+The most basic tile looks like this:
+
+.. code_block:: python
 
     from plone.tiles import Tile
 


Repository: plone.tiles


Branch: refs/heads/master
Date: 2016-02-15T17:21:49+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.tiles/commit/1a554f542be40f4cd534b0158a7d08cb4f380731

zca decorators et al

Files changed:
M CHANGELOG.rst
M plone/__init__.py
M plone/tiles/absoluteurl.py
M plone/tiles/fieldtypeconverters.py
M plone/tiles/tile.py
M plone/tiles/type.py
M setup.py

diff --git a/CHANGELOG.rst b/CHANGELOG.rst
index ebfc34d..f0b3dd4 100644
--- a/CHANGELOG.rst
+++ b/CHANGELOG.rst
@@ -4,8 +4,8 @@ Changelog
 1.5.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
-
+- PEP8, make code-analysis happy, fix RST and docstyle.
+  [jensens]
 
 1.5.1 (2015-10-09)
 ------------------
diff --git a/plone/__init__.py b/plone/__init__.py
index f48ad10..68c04af 100644
--- a/plone/__init__.py
+++ b/plone/__init__.py
@@ -1,6 +1,2 @@
-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
-try:
-    __import__('pkg_resources').declare_namespace(__name__)
-except ImportError:
-    from pkgutil import extend_path
-    __path__ = extend_path(__path__, __name__)
+# -*- coding: utf-8 -*-
+__import__('pkg_resources').declare_namespace(__name__)
diff --git a/plone/tiles/absoluteurl.py b/plone/tiles/absoluteurl.py
index dd2b66a..dbc3fba 100644
--- a/plone/tiles/absoluteurl.py
+++ b/plone/tiles/absoluteurl.py
@@ -22,7 +22,7 @@ def __str__(self):
         tile = self.context
         request = self.request
 
-        id = tile.id
+        tid = tile.id
         name = tile.__name__
         context = tile.__parent__
 
@@ -30,8 +30,8 @@ def __str__(self):
             raise TypeError("Insufficient context to determine URL")
 
         tileFragment = "@@" + urllib.quote(name.encode('utf-8'), _safe)
-        if id:
-            tileFragment += '/' + urllib.quote(id.encode('utf-8'), _safe)
+        if tid:
+            tileFragment += '/' + urllib.quote(tid.encode('utf-8'), _safe)
 
         absolute_url = getMultiAdapter((context, request), IAbsoluteURL)
         try:
@@ -45,13 +45,13 @@ def breadcrumbs(self):
         tile = self.context
         request = self.request
 
-        id = tile.id
+        tid = tile.id
         name = tile.__name__
         context = tile.__parent__
 
         tileFragment = "@@" + urllib.quote(name.encode('utf-8'), _safe)
-        if id:
-            tileFragment += '/' + urllib.quote(id.encode('utf-8'), _safe)
+        if tid:
+            tileFragment += '/' + urllib.quote(tid.encode('utf-8'), _safe)
 
         base = tuple(
             getMultiAdapter((context, request), IAbsoluteURL).breadcrumbs())
diff --git a/plone/tiles/fieldtypeconverters.py b/plone/tiles/fieldtypeconverters.py
index 7fd620f..903bff6 100644
--- a/plone/tiles/fieldtypeconverters.py
+++ b/plone/tiles/fieldtypeconverters.py
@@ -1,11 +1,11 @@
 # -*- coding: utf-8 -*-
 
 from plone.tiles.interfaces import IFieldTypeConverter
-from zope.interface import implements
+from zope.interface import implementer
 
 
+@implementer(IFieldTypeConverter)
 class NoConverter(object):
-    implements(IFieldTypeConverter)
 
     def __init__(self, field):
         self.field = field
diff --git a/plone/tiles/tile.py b/plone/tiles/tile.py
index b6cea78..529538f 100644
--- a/plone/tiles/tile.py
+++ b/plone/tiles/tile.py
@@ -3,11 +3,12 @@
 from plone.tiles.interfaces import ITile
 from plone.tiles.interfaces import ITileDataManager
 from zope.component import queryMultiAdapter
-from zope.interface import implements
+from zope.interface import implementer
 from zope.publisher.browser import BrowserView
 from zope.traversing.browser.absoluteurl import absoluteURL
 
 
+@implementer(ITile)
 class Tile(BrowserView):
     """Basic implementation of a transient tile. Subclasses should override
     __call__ or set an 'index' variable to point to a view page template file.
@@ -26,8 +27,6 @@ class Tile(BrowserView):
       `foo`.
     """
 
-    implements(ITile)
-
     __cachedData = None
     __cachedURL = None
 
@@ -97,9 +96,8 @@ def url(self):
         return absoluteURL(self, self.request)
 
 
+@implementer(IPersistentTile)
 class PersistentTile(Tile):
     """Base class for persistent tiles. Identical to `Tile`, except that the
     data dict is never serialized with the URL.
     """
-
-    implements(IPersistentTile)
diff --git a/plone/tiles/type.py b/plone/tiles/type.py
index 7f52d58..6a33f54 100644
--- a/plone/tiles/type.py
+++ b/plone/tiles/type.py
@@ -1,15 +1,14 @@
 # -*- coding: utf-8 -*-
 
 from plone.tiles.interfaces import ITileType
-from zope.interface import implements
+from zope.interface import implementer
 
 
+@implementer(ITileType)
 class TileType(object):
     """A utility that describes a type of tile
     """
 
-    implements(ITileType)
-
     def __init__(self, name, title, add_permission, edit_permission=None,
                  delete_permission=None, description=None, icon=None,
                  schema=None):
diff --git a/setup.py b/setup.py
index 6b61630..c6f51fa 100644
--- a/setup.py
+++ b/setup.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from setuptools import find_packages
 from setuptools import setup
 


Repository: plone.tiles


Branch: refs/heads/master
Date: 2016-02-15T17:55:57+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.tiles/commit/1ada11be162cc26ccd11a840a9f15ae24f128873

Merge pull request #5 from plone/cleanup

Cleanup

Files changed:
A .isort.cfg
M .travis.yml
M CHANGELOG.rst
M README.rst
M bootstrap.py
M plone/__init__.py
M plone/tiles/absoluteurl.py
M plone/tiles/data.py
M plone/tiles/esi.py
M plone/tiles/fieldtypeconverters.py
M plone/tiles/interfaces.py
M plone/tiles/meta.py
M plone/tiles/tests.py
M plone/tiles/tile.py
M plone/tiles/type.py
M setup.py
M test-4.2.x.cfg
M test-4.3.x.cfg
M test-5.x.cfg

diff --git a/.isort.cfg b/.isort.cfg
new file mode 100644
index 0000000..fb79921
--- /dev/null
+++ b/.isort.cfg
@@ -0,0 +1,5 @@
+[settings]
+force_alphabetical_sort=True
+force_single_line=True
+lines_after_imports=2
+line_length=200
diff --git a/.travis.yml b/.travis.yml
index 51555f8..bf856f8 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,13 +1,20 @@
 language: python
 python: 2.7
 sudo: false
-cache:
-  directories:
-  - eggs
 env:
 - PLONE_VERSION=4.2.x
 - PLONE_VERSION=4.3.x
 - PLONE_VERSION=5.x
+cache:
+  pip: true
+  directories:
+  - $HOME/buildout-cache
+before_install:
+  - mkdir -p $HOME/buildout-cache/{eggs,downloads}
+  - mkdir $HOME/.buildout
+  - echo "[buildout]" > $HOME/.buildout/default.cfg
+  - echo "download-cache = $HOME/buildout-cache/downloads" >> $HOME/.buildout/default.cfg
+  - echo "eggs-directory = $HOME/buildout-cache/eggs" >> $HOME/.buildout/default.cfg
 install:
 - python bootstrap.py -c test-$PLONE_VERSION.cfg
 - bin/buildout -N -t 3 -c test-$PLONE_VERSION.cfg annotate
diff --git a/CHANGELOG.rst b/CHANGELOG.rst
index ebfc34d..f0b3dd4 100644
--- a/CHANGELOG.rst
+++ b/CHANGELOG.rst
@@ -4,8 +4,8 @@ Changelog
 1.5.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
-
+- PEP8, make code-analysis happy, fix RST and docstyle.
+  [jensens]
 
 1.5.1 (2015-10-09)
 ------------------
diff --git a/README.rst b/README.rst
index bd4509c..03de474 100644
--- a/README.rst
+++ b/README.rst
@@ -13,44 +13,48 @@ creating "tiles" in the Deco layout system.
 Introduction
 ------------
 
-For the purposes of this package, a tile is a browser view and an associated
-utility providing some metadata about that view. The metadata includes a title
-and description, an 'add' permission and optionally a schema interface
-describing configurable aspects of the tile. The idea is that a UI (such as
-Deco) can present the user with a list of insertable tiles and optionally
-render a form to configure the tile upon insertion.
+For the purposes of this package,
+a tile is a browser view and an associated utility providing some metadata about that view.
+The metadata includes a title and description,
+an 'add' permission and optionally a schema interface describing configurable aspects of the tile.
+The idea is that a UI (such as Deco) can present the user with a list of insertable tiles and optionally render a form to configure the tile upon insertion.
 
-A tile is inserted into a layout as a link::
+A tile is inserted into a layout as a link:
+
+.. code_block:: xml
 
     <link rel="tile" target="placeholder" href="./@@sample.tile/tile1?option1=value1" />
 
-The sub-path (`tile1` in this case) is used to set the tile `id` attribute.
-This allows the tile to know its unique id, and, in the case of persistent
-tiles, look up its data. `sample.tile` is the name of the browser view that
-implements the tile. This is made available as the `__name__` attribute. Other
-parameters may be turned into tile data, available under the `data` attribute,
-a dict, for regular tiles. For persistent tiles (those deriving from the
-`PersistentTile` base class), the data is fetched from annotations instead,
+The sub-path (``tile1`` in this case) is used to set the tile ``id`` attribute.
+This allows the tile to know its unique id, and, in the case of persistent tiles, look up its data.
+``sample.tile`` is the name of the browser view that implements the tile.
+This is made available as the ``__name__`` attribute.
+Other parameters may be turned into tile data, available under the ``data`` attribute, a dict, for regular tiles.
+For persistent tiles
+(those deriving from the ``PersistentTile`` base class),
+the data is fetched from annotations instead,
 based on the tile id.
 
 There are three interfaces describing tiles in this package:
 
-* `IBasicTile` is the low-level interface for tiles. It extends
-  `IBrowserView` to describe the semantics of the `__name__` and  `id`
-  attributes.
-* `ITile` describes a tile that can be configured with some data. The data
-  is accessible via a dict called `data`. The default implementation of this
-  interface, `plone.tiles.Tile`, will use the schema of the tile type and
-  the query string (`self.request.form`) to construct that dictionary. This
-  interface also describes an attribute `url`, which gives the canonical
-  tile URL, including the id sub-path and any query string parameters. (Note
-  that tiles also correctly implement `IAbsoluteURL`.)
-* `IPersistentTile` describes a tile that stores its configuration in
-  object annotations, and is needed when configuration values cannot be
-  encoded into a query string. The default implementation is in
-  `plone.tiles.PersistentTile`. To make it possible to have several tiles
-  of a given type on the same layout, the annotations are keyed by the
-  tile `__name__`.
+``IBasicTile``
+    is the low-level interface for tiles.
+    It extends ``IBrowserView`` to describe the semantics of the ``__name__`` and  ``id`` attributes.
+``ITile``
+    describes a tile that can be configured with some data.
+    The data is accessible via a dict called ``data``.
+    The default implementation of this interface, ``plone.tiles.Tile``,
+    will use the schema of the tile type and the query string (``self.request.form``) to construct that dictionary.
+    This interface also describes an attribute ``url``,
+    which gives the canonical tile URL,
+    including the id sub-path and any query string parameters.
+    (Note that tiles also correctly implement ``IAbsoluteURL``.)
+```IPersistentTile``
+    describes a tile that stores its configuration in object annotations,
+    and is needed when configuration values cannot be encoded into a query string.
+    The default implementation is in ``plone.tiles.PersistentTile``.
+    To make it possible to have several tiles of a given type on the same layout,
+    the annotations are keyed by the tile ``__name__``.
 
 In addition, tiles are described by `ITileType`, which contains attributes
 for the tile name, title, description, add permission and schema (if
@@ -71,7 +75,9 @@ with a tile's schema interface.
 Creating a Simple Tile
 ----------------------
 
-The most basic tile looks like this::
+The most basic tile looks like this:
+
+.. code_block:: python
 
     from plone.tiles import Tile
 
diff --git a/bootstrap.py b/bootstrap.py
index c90ed48..ed57894 100644
--- a/bootstrap.py
+++ b/bootstrap.py
@@ -16,112 +16,163 @@
 Simply run this script in a directory containing a buildout.cfg.
 The script accepts buildout command-line options, so you can
 use the -c option to specify an alternate configuration file.
-
-$Id$
 """
 
-import os, shutil, sys, tempfile, urllib2
+import os
+import shutil
+import sys
+import tempfile
+
 from optparse import OptionParser
 
 tmpeggs = tempfile.mkdtemp()
 
-is_jython = sys.platform.startswith('java')
-
-# parsing arguments
-parser = OptionParser(
-    'This is a custom version of the zc.buildout %prog script.  It is '
-    'intended to meet a temporary need if you encounter problems with '
-    'the zc.buildout 1.5 release.')
-parser.add_option("-v", "--version", dest="version", default='1.5.2',
-                          help='Use a specific zc.buildout version.  *This '
-                          'bootstrap script defaults to '
-                          '1.5.2, unlike usual buildout bootstrap scripts.*')
-parser.add_option("-d", "--distribute",
-                   action="store_true", dest="distribute", default=False,
-                   help="Use Disribute rather than Setuptools.")
-
-parser.add_option("-c", None, action="store", dest="config_file",
-                   help=("Specify the path to the buildout configuration "
-                         "file to be used."))
+usage = '''\
+[DESIRED PYTHON FOR BUILDOUT] bootstrap.py [options]
 
-options, args = parser.parse_args()
+Bootstraps a buildout-based project.
+
+Simply run this script in a directory containing a buildout.cfg, using the
+Python that you want bin/buildout to use.
+
+Note that by using --find-links to point to local resources, you can keep 
+this script from going over the network.
+'''
+
+parser = OptionParser(usage=usage)
+parser.add_option("-v", "--version", help="use a specific zc.buildout version")
+
+parser.add_option("-t", "--accept-buildout-test-releases",
+                  dest='accept_buildout_test_releases',
+                  action="store_true", default=False,
+                  help=("Normally, if you do not specify a --version, the "
+                        "bootstrap script and buildout gets the newest "
+                        "*final* versions of zc.buildout and its recipes and "
+                        "extensions for you.  If you use this flag, "
+                        "bootstrap and buildout will get the newest releases "
+                        "even if they are alphas or betas."))
+parser.add_option("-c", "--config-file",
+                  help=("Specify the path to the buildout configuration "
+                        "file to be used."))
+parser.add_option("-f", "--find-links",
+                  help=("Specify a URL to search for buildout releases"))
+parser.add_option("--allow-site-packages",
+                  action="store_true", default=False,
+                  help=("Let bootstrap.py use existing site packages"))
 
-# if -c was provided, we push it back into args for buildout' main function
-if options.config_file is not None:
-    args += ['-c', options.config_file]
 
-if options.version is not None:
-    VERSION = '==%s' % options.version
-else:
-    VERSION = ''
+options, args = parser.parse_args()
 
-USE_DISTRIBUTE = options.distribute
-args = args + ['bootstrap']
+######################################################################
+# load/install setuptools
 
-to_reload = False
 try:
-    import pkg_resources
-    if not hasattr(pkg_resources, '_distribute'):
-        to_reload = True
-        raise ImportError
-except ImportError:
-    ez = {}
-    if USE_DISTRIBUTE:
-        exec urllib2.urlopen('http://python-distribute.org/distribute_setup.py'
-                         ).read() in ez
-        ez['use_setuptools'](to_dir=tmpeggs, download_delay=0, no_fake=True)
-    else:
-        exec urllib2.urlopen('http://peak.telecommunity.com/dist/ez_setup.py'
-                             ).read() in ez
-        ez['use_setuptools'](to_dir=tmpeggs, download_delay=0)
-
-    if to_reload:
-        reload(pkg_resources)
-    else:
+    if options.allow_site_packages:
+        import setuptools
         import pkg_resources
-
-if sys.platform == 'win32':
-    def quote(c):
-        if ' ' in c:
-            return '"%s"' % c # work around spawn lamosity on windows
-        else:
-            return c
-else:
-    def quote (c):
-        return c
-
-ws  = pkg_resources.working_set
-
-if USE_DISTRIBUTE:
-    requirement = 'distribute'
-else:
-    requirement = 'setuptools'
-
-env = dict(os.environ,
-           PYTHONPATH=
-           ws.find(pkg_resources.Requirement.parse(requirement)).location
-           )
-
-cmd = [quote(sys.executable),
-       '-c',
-       quote('from setuptools.command.easy_install import main; main()'),
-       '-mqNxd',
-       quote(tmpeggs)]
-
-if 'bootstrap-testing-find-links' in os.environ:
-    cmd.extend(['-f', os.environ['bootstrap-testing-find-links']])
-
-cmd.append('zc.buildout' + VERSION)
-
-if is_jython:
-    import subprocess
-    exitcode = subprocess.Popen(cmd, env=env).wait()
-else: # Windows prefers this, apparently; otherwise we would prefer subprocess
-    exitcode = os.spawnle(*([os.P_WAIT, sys.executable] + cmd + [env]))
-assert exitcode == 0
+    from urllib.request import urlopen
+except ImportError:
+    from urllib2 import urlopen
+
+ez = {}
+exec(urlopen('https://bootstrap.pypa.io/ez_setup.py').read(), ez)
+
+if not options.allow_site_packages:
+    # ez_setup imports site, which adds site packages
+    # this will remove them from the path to ensure that incompatible versions 
+    # of setuptools are not in the path
+    import site
+    # inside a virtualenv, there is no 'getsitepackages'. 
+    # We can't remove these reliably
+    if hasattr(site, 'getsitepackages'):
+        for sitepackage_path in site.getsitepackages():
+            sys.path[:] = [x for x in sys.path if sitepackage_path not in x]
+
+setup_args = dict(to_dir=tmpeggs, download_delay=0)
+ez['use_setuptools'](**setup_args)
+import setuptools
+import pkg_resources
+
+# This does not (always?) update the default working set.  We will
+# do it.
+for path in sys.path:
+    if path not in pkg_resources.working_set.entries:
+        pkg_resources.working_set.add_entry(path)
+
+######################################################################
+# Install buildout
+
+ws = pkg_resources.working_set
+
+cmd = [sys.executable, '-c',
+       'from setuptools.command.easy_install import main; main()',
+       '-mZqNxd', tmpeggs]
+
+find_links = os.environ.get(
+    'bootstrap-testing-find-links',
+    options.find_links or
+    ('http://downloads.buildout.org/'
+     if options.accept_buildout_test_releases else None)
+    )
+if find_links:
+    cmd.extend(['-f', find_links])
+
+setuptools_path = ws.find(
+    pkg_resources.Requirement.parse('setuptools')).location
+
+requirement = 'zc.buildout'
+version = options.version
+if version is None and not options.accept_buildout_test_releases:
+    # Figure out the most recent final version of zc.buildout.
+    import setuptools.package_index
+    _final_parts = '*final-', '*final'
+
+    def _final_version(parsed_version):
+        for part in parsed_version:
+            if (part[:1] == '*') and (part not in _final_parts):
+                return False
+        return True
+    index = setuptools.package_index.PackageIndex(
+        search_path=[setuptools_path])
+    if find_links:
+        index.add_find_links((find_links,))
+    req = pkg_resources.Requirement.parse(requirement)
+    if index.obtain(req) is not None:
+        best = []
+        bestv = None
+        for dist in index[req.project_name]:
+            distv = dist.parsed_version
+            if _final_version(distv):
+                if bestv is None or distv > bestv:
+                    best = [dist]
+                    bestv = distv
+                elif distv == bestv:
+                    best.append(dist)
+        if best:
+            best.sort()
+            version = best[-1].version
+if version:
+    requirement = '=='.join((requirement, version))
+cmd.append(requirement)
+
+import subprocess
+if subprocess.call(cmd, env=dict(os.environ, PYTHONPATH=setuptools_path)) != 0:
+    raise Exception(
+        "Failed to execute command:\n%s" % repr(cmd)[1:-1])
+
+######################################################################
+# Import and run buildout
 
 ws.add_entry(tmpeggs)
-ws.require('zc.buildout' + VERSION)
+ws.require(requirement)
 import zc.buildout.buildout
+
+if not [a for a in args if '=' not in a]:
+    args.append('bootstrap')
+
+# if -c was provided, we push it back into args for buildout' main function
+if options.config_file is not None:
+    args[0:0] = ['-c', options.config_file]
+
 zc.buildout.buildout.main(args)
 shutil.rmtree(tmpeggs)
diff --git a/plone/__init__.py b/plone/__init__.py
index f48ad10..68c04af 100644
--- a/plone/__init__.py
+++ b/plone/__init__.py
@@ -1,6 +1,2 @@
-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
-try:
-    __import__('pkg_resources').declare_namespace(__name__)
-except ImportError:
-    from pkgutil import extend_path
-    __path__ = extend_path(__path__, __name__)
+# -*- coding: utf-8 -*-
+__import__('pkg_resources').declare_namespace(__name__)
diff --git a/plone/tiles/absoluteurl.py b/plone/tiles/absoluteurl.py
index 9e86186..dbc3fba 100644
--- a/plone/tiles/absoluteurl.py
+++ b/plone/tiles/absoluteurl.py
@@ -1,15 +1,15 @@
 # -*- coding: utf-8 -*-
 
-import urllib
-
+from plone.tiles.data import encode
+from plone.tiles.interfaces import ITileDataManager
+from plone.tiles.interfaces import ITileType
 from zope.component import getMultiAdapter
 from zope.component import queryUtility
-
-from zope.traversing.browser.interfaces import IAbsoluteURL
 from zope.traversing.browser.absoluteurl import AbsoluteURL
+from zope.traversing.browser.interfaces import IAbsoluteURL
+
+import urllib
 
-from plone.tiles.interfaces import ITileType, ITileDataManager
-from plone.tiles.data import encode
 
 _safe = '@+'
 
@@ -22,7 +22,7 @@ def __str__(self):
         tile = self.context
         request = self.request
 
-        id = tile.id
+        tid = tile.id
         name = tile.__name__
         context = tile.__parent__
 
@@ -30,8 +30,8 @@ def __str__(self):
             raise TypeError("Insufficient context to determine URL")
 
         tileFragment = "@@" + urllib.quote(name.encode('utf-8'), _safe)
-        if id:
-            tileFragment += '/' + urllib.quote(id.encode('utf-8'), _safe)
+        if tid:
+            tileFragment += '/' + urllib.quote(tid.encode('utf-8'), _safe)
 
         absolute_url = getMultiAdapter((context, request), IAbsoluteURL)
         try:
@@ -45,13 +45,13 @@ def breadcrumbs(self):
         tile = self.context
         request = self.request
 
-        id = tile.id
+        tid = tile.id
         name = tile.__name__
         context = tile.__parent__
 
         tileFragment = "@@" + urllib.quote(name.encode('utf-8'), _safe)
-        if id:
-            tileFragment += '/' + urllib.quote(id.encode('utf-8'), _safe)
+        if tid:
+            tileFragment += '/' + urllib.quote(tid.encode('utf-8'), _safe)
 
         base = tuple(
             getMultiAdapter((context, request), IAbsoluteURL).breadcrumbs())
diff --git a/plone/tiles/data.py b/plone/tiles/data.py
index 268a3be..24af156 100644
--- a/plone/tiles/data.py
+++ b/plone/tiles/data.py
@@ -1,25 +1,27 @@
 # -*- coding: utf-8 -*-
-import logging
-import urllib
-from zope.interface import implements
-from zope.interface import implementer
-from zope.interface import Interface
-from zope.component import adapts
+from persistent.dict import PersistentDict
+from plone.tiles.interfaces import IFieldTypeConverter
+from plone.tiles.interfaces import IPersistentTile
+from plone.tiles.interfaces import ITile
+from plone.tiles.interfaces import ITileDataContext
+from plone.tiles.interfaces import ITileDataManager
+from plone.tiles.interfaces import ITileType
+from zope.annotation.interfaces import IAnnotations
 from zope.component import adapter
-from zope.component import queryUtility
+from zope.component import adapts
 from zope.component import getMultiAdapter
+from zope.component import queryUtility
 from zope.component.interfaces import ComponentLookupError
-from zope.schema import getFieldsInOrder
+from zope.interface import implementer
+from zope.interface import implements
+from zope.interface import Interface
 from zope.schema import getFields
+from zope.schema import getFieldsInOrder
 from zope.schema.interfaces import ISequence
-from zope.annotation.interfaces import IAnnotations
-from plone.tiles.interfaces import ITileType
-from plone.tiles.interfaces import ITile
-from plone.tiles.interfaces import IPersistentTile
-from plone.tiles.interfaces import ITileDataManager
-from plone.tiles.interfaces import ITileDataContext
-from plone.tiles.interfaces import IFieldTypeConverter
-from persistent.dict import PersistentDict
+
+import logging
+import urllib
+
 
 try:
     import json
@@ -299,7 +301,8 @@ def decode(data, schema, missing=True):
             for item in value:
                 if isinstance(item, str):
                     value = unicode(item, 'utf-8')
-                if field.value_type._type and not isinstance(item, field.value_type._type):
+                if field.value_type._type and not isinstance(
+                        item, field.value_type._type):
                     item = value_type_field_type(item)
                 converted.append(item)
 
diff --git a/plone/tiles/esi.py b/plone/tiles/esi.py
index 8cdc45e..69518cb 100644
--- a/plone/tiles/esi.py
+++ b/plone/tiles/esi.py
@@ -1,11 +1,14 @@
 # -*- coding: utf-8 -*-
 
-import re
-
+from plone.tiles.interfaces import ESI_HEADER
+from plone.tiles.interfaces import ESI_HEADER_KEY
+from plone.tiles.interfaces import IESIRendered
+from plone.tiles.tile import PersistentTile
+from plone.tiles.tile import Tile
 from zope.interface import implements
 
-from plone.tiles.interfaces import IESIRendered, ESI_HEADER, ESI_HEADER_KEY
-from plone.tiles.tile import Tile, PersistentTile
+import re
+
 
 HEAD_CHILDREN = re.compile(r'<head[^>]*>(.*)</head>', re.I | re.S)
 BODY_CHILDREN = re.compile(r'<body[^>]*>(.*)</body>', re.I | re.S)
diff --git a/plone/tiles/fieldtypeconverters.py b/plone/tiles/fieldtypeconverters.py
index 379f1cf..903bff6 100644
--- a/plone/tiles/fieldtypeconverters.py
+++ b/plone/tiles/fieldtypeconverters.py
@@ -1,11 +1,11 @@
 # -*- coding: utf-8 -*-
 
-from zope.interface import implements
 from plone.tiles.interfaces import IFieldTypeConverter
+from zope.interface import implementer
 
 
+@implementer(IFieldTypeConverter)
 class NoConverter(object):
-    implements(IFieldTypeConverter)
 
     def __init__(self, field):
         self.field = field
diff --git a/plone/tiles/interfaces.py b/plone/tiles/interfaces.py
index 67ceb1b..5a43ea1 100644
--- a/plone/tiles/interfaces.py
+++ b/plone/tiles/interfaces.py
@@ -1,11 +1,12 @@
 # -*- coding: utf-8 -*-
 
 from zope.interface import Interface
-import zope.schema
-
 from zope.interface.interfaces import IInterface
 from zope.publisher.interfaces.browser import IBrowserView
 
+import zope.schema
+
+
 ESI_HEADER = 'X-ESI-Enabled'
 ESI_HEADER_KEY = 'HTTP_' + ESI_HEADER.replace('-', '_').upper()
 
diff --git a/plone/tiles/meta.py b/plone/tiles/meta.py
index 401573b..9c66d2a 100644
--- a/plone/tiles/meta.py
+++ b/plone/tiles/meta.py
@@ -1,21 +1,19 @@
 # -*- coding: utf-8 -*-
 
-from zope.interface import Interface
-
+from plone.tiles.interfaces import ITileType
+from plone.tiles.tile import Tile
+from plone.tiles.type import TileType
 from zope import schema
-from zope.configuration.fields import (
-    GlobalObject, GlobalInterface, MessageID, Path)
-from zope.security.zcml import Permission
-
+from zope.component.zcml import utility
 from zope.configuration.exceptions import ConfigurationError
-
+from zope.configuration.fields import GlobalInterface
+from zope.configuration.fields import GlobalObject
+from zope.configuration.fields import MessageID
+from zope.configuration.fields import Path
+from zope.interface import Interface
 from zope.publisher.interfaces.browser import IDefaultBrowserLayer
+from zope.security.zcml import Permission
 
-from plone.tiles.interfaces import ITileType
-from plone.tiles.type import TileType
-from plone.tiles.tile import Tile
-
-from zope.component.zcml import utility
 
 try:
     from Products.Five.browser.metaconfigure import page
diff --git a/plone/tiles/tests.py b/plone/tiles/tests.py
index 7e9bc08..8de88c5 100644
--- a/plone/tiles/tests.py
+++ b/plone/tiles/tests.py
@@ -1,18 +1,20 @@
 # -*- coding: utf-8 -*-
 
-import unittest2 as unittest
-import doctest
-from plone.testing import Layer, layered
-from plone.testing import zca, z2
-
+from plone.testing import Layer
+from plone.testing import layered
+from plone.testing import z2
+from plone.testing import zca
+from plone.tiles import PersistentTile
+from plone.tiles import Tile
+from zope import schema
 from zope.configuration import xmlconfig
+from zope.interface import Interface
 
-# For directive tests
+import doctest
+import unittest2 as unittest
 
-from zope.interface import Interface
-from zope import schema
 
-from plone.tiles import Tile, PersistentTile
+# For directive tests
 
 
 class IDummySchema(Interface):
@@ -28,6 +30,7 @@ class IDummyLayer(Interface):
 
 
 class DummyTile(Tile):
+
     def __call__(self):
         return u"dummy"
 
diff --git a/plone/tiles/tile.py b/plone/tiles/tile.py
index b6cea78..529538f 100644
--- a/plone/tiles/tile.py
+++ b/plone/tiles/tile.py
@@ -3,11 +3,12 @@
 from plone.tiles.interfaces import ITile
 from plone.tiles.interfaces import ITileDataManager
 from zope.component import queryMultiAdapter
-from zope.interface import implements
+from zope.interface import implementer
 from zope.publisher.browser import BrowserView
 from zope.traversing.browser.absoluteurl import absoluteURL
 
 
+@implementer(ITile)
 class Tile(BrowserView):
     """Basic implementation of a transient tile. Subclasses should override
     __call__ or set an 'index' variable to point to a view page template file.
@@ -26,8 +27,6 @@ class Tile(BrowserView):
       `foo`.
     """
 
-    implements(ITile)
-
     __cachedData = None
     __cachedURL = None
 
@@ -97,9 +96,8 @@ def url(self):
         return absoluteURL(self, self.request)
 
 
+@implementer(IPersistentTile)
 class PersistentTile(Tile):
     """Base class for persistent tiles. Identical to `Tile`, except that the
     data dict is never serialized with the URL.
     """
-
-    implements(IPersistentTile)
diff --git a/plone/tiles/type.py b/plone/tiles/type.py
index a89738d..6a33f54 100644
--- a/plone/tiles/type.py
+++ b/plone/tiles/type.py
@@ -1,15 +1,14 @@
 # -*- coding: utf-8 -*-
 
-from zope.interface import implements
 from plone.tiles.interfaces import ITileType
+from zope.interface import implementer
 
 
+@implementer(ITileType)
 class TileType(object):
     """A utility that describes a type of tile
     """
 
-    implements(ITileType)
-
     def __init__(self, name, title, add_permission, edit_permission=None,
                  delete_permission=None, description=None, icon=None,
                  schema=None):
diff --git a/setup.py b/setup.py
index 4bd3042..c6f51fa 100644
--- a/setup.py
+++ b/setup.py
@@ -1,6 +1,9 @@
-import os
-from setuptools import setup
+# -*- coding: utf-8 -*-
 from setuptools import find_packages
+from setuptools import setup
+
+import os
+
 
 version = '1.5.2.dev0'
 
diff --git a/test-4.2.x.cfg b/test-4.2.x.cfg
index 2ddcdb1..96331dd 100644
--- a/test-4.2.x.cfg
+++ b/test-4.2.x.cfg
@@ -19,3 +19,6 @@ flake8-ignore = E501,C901
 
 [versions]
 coverage = 3.7
+
+# dont fight with setuptools versions
+setuptools =
diff --git a/test-4.3.x.cfg b/test-4.3.x.cfg
index 2af8913..b7f24e6 100644
--- a/test-4.3.x.cfg
+++ b/test-4.3.x.cfg
@@ -19,3 +19,6 @@ flake8-ignore = E501,C901
 
 [versions]
 coverage = 3.7
+
+# dont fight with setuptools versions
+setuptools =
diff --git a/test-5.x.cfg b/test-5.x.cfg
index fccbaaf..f41f343 100644
--- a/test-5.x.cfg
+++ b/test-5.x.cfg
@@ -20,3 +20,6 @@ flake8-ignore = E501,C901
 
 [versions]
 coverage = 3.7
+
+# dont fight with setuptools versions
+setuptools =


