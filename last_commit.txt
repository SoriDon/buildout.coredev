Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-06T00:06:15+02:00
Author: petschki (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/f668701e5f5e81a32355ec348ff1bd36cc708af7

try fixing flaky robottests

Files changed:
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex ef22e81206..dcaef23c8d 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -318,7 +318,7 @@ I expect to be in Simple mode\n \n open the select box titled ${NAME}\n     Click Element  css=body\n-    ${select_criteria_selector}  Set Variable  .querystring-criteria-${NAME} .select2-container a\n+    ${select_criteria_selector}  Set Variable  .querystring-criteria-${NAME} .select2-container\n     Wait Until Element Is Visible  css=${select_criteria_selector}\n     Click Element  css=${select_criteria_selector}\n \n@@ -326,7 +326,7 @@ select index type ${INDEX}\n     ${input_selector}  Set Variable  .select2-drop-active[style*="display: block;"] input\n     Wait Until Element Is Visible  jquery=${input_selector}\n     Input Text  jquery=${input_selector}   text=${INDEX}\n-    Press Key  jquery=:focus  \\\\13\n+    Press Keys  jquery=:focus  RETURN\n \n we expect ${NUM} hits\n     #This assumes we have the 2 "Test document" and "Test folder" items from the\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-07T14:42:52+02:00
Author: Fred van Dijk (fredvd) <fredvd@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/60777b50b85668207efaf9256fcaf5b33c4964d8

Add extra visible/focus commands around querystring select index type.

Files changed:
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex dcaef23c8d..bd7ac861be 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -323,7 +323,11 @@ open the select box titled ${NAME}\n     Click Element  css=${select_criteria_selector}\n \n select index type ${INDEX}\n+    Set Focus To Element  css=.select2-drop-active[style*="display: block;"] input\n+    Wait Until Element Is Visible  css=.select2-drop-active[style*="display: block;"] input\n     ${input_selector}  Set Variable  .select2-drop-active[style*="display: block;"] input\n+\n+    Set Focus To Element  jquery=${input_selector}\n     Wait Until Element Is Visible  jquery=${input_selector}\n     Input Text  jquery=${input_selector}   text=${INDEX}\n     Press Keys  jquery=:focus  RETURN\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-07T16:46:47+02:00
Author: Fred van Dijk (fredvd) <fredvd@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/79c243320db5992e084b7cd82993e032297f9f22

More robust linkintegrity robot tests

Files changed:
M Products/CMFPlone/tests/robot/test_linkintegrity.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex bf2b03adcf..69eb7aa4a4 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -86,10 +86,14 @@ a link in rich text\n   Wait until page contains  Foo\n \n   Click Button  css=.modal-footer .btn-primary\n+\n+  Set Focus To Element  css=#form-buttons-save\n+  Wait Until Element Is Visible  css=#form-buttons-save\n   Click Button  css=#form-buttons-save\n \n \n should show warning when deleting page\n+\n   Go To  ${PLONE_URL}/foo\n   Wait until element is visible  css=#plone-contentmenu-actions a\n   Click Link  css=#plone-contentmenu-actions a\n@@ -102,13 +106,19 @@ should show warning when deleting page from folder_contents\n   Go To  ${PLONE_URL}/folder_contents\n   Wait until keyword succeeds  30  1  Page should contain element  css=tr[data-id="foo"] input\n   # Might still take a bit before it is clickable.\n-  Sleep  1\n+  Set Focus To Element  css=tr[data-id="foo"] input\n+  Wait Until Element Is Visible  css=tr[data-id="foo"] input\n   Click Element  css=tr[data-id="foo"] input\n   Checkbox Should Be Selected  css=tr[data-id="foo"] input\n   Wait until keyword succeeds  30  1  Page should not contain element  css=#btn-delete.disabled\n+\n+  Set Focus To Element  css=#btngroup-mainbuttons #btn-delete\n+  Wait Until Element Is Visible  css=#btngroup-mainbuttons #btn-delete\n   Click Element  css=#btngroup-mainbuttons #btn-delete\n   Wait until page contains element  css=.popover-content .btn-danger\n   Page should contain element  css=.breach-container .breach-item\n+  Set Focus To Element  css=#popover-delete .closeBtn\n+  Wait Until Element Is Visible  css=#popover-delete .closeBtn\n   Click Element  css=#popover-delete .closeBtn\n   Checkbox Should Be Selected  css=tr[data-id="foo"] input\n \n@@ -148,4 +158,7 @@ remove link to page\n   Execute Javascript    function selectElementContents(el) {var range = document.createRange(); range.selectNodeContents(el); var sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);} var el = document.getElementById("tinymce"); selectElementContents(el);\n   UnSelect Frame\n   Click Button  css=button[aria-label="Remove link"]\n+\n+  Set Focus To Element  css=#form-buttons-save\n+  Wait Until Element Is Visible  css=#form-buttons-save\n   Click Button  css=#form-buttons-save\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-07T21:09:52+02:00
Author: Fred van Dijk (fredvd) <fredvd@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/7b5ba87969f92c8b2add3e1d969704198f25dc83

Make test_edit_user_schema robottest more stable

Files changed:
M Products/CMFPlone/tests/robot/test_edit_user_schema.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_edit_user_schema.robot b/Products/CMFPlone/tests/robot/test_edit_user_schema.robot\nindex bbb8e87b4f..74a7e1fc89 100644\n--- a/Products/CMFPlone/tests/robot/test_edit_user_schema.robot\n+++ b/Products/CMFPlone/tests/robot/test_edit_user_schema.robot\n@@ -142,6 +142,7 @@ add a min/max constraint to the field\n   Wait until page contains element  form.widgets.min_length\n   Input Text  form.widgets.min_length  4\n   Input Text  form.widgets.max_length  6\n+  Wait Until Element Is visible  css=.pattern-modal-buttons button#form-buttons-save\n   Click Button  css=.pattern-modal-buttons button#form-buttons-save\n   Sleep  1\n \n@@ -172,7 +173,11 @@ a logged-in user will see the field on top of the user profile\n a logged-in user will see a field with min/max constraints\n   a logged-in user will see the field in the user profile\n   Input Text  form.widgets.email  test@plone.org\n+  Set Focus To Element  css=#form-widgets-test_field\n+  Wait Until Element Is visible  css=#form-widgets-test_field\n   Input Text  form.widgets.test_field  1\n+  Set Focus To Element  css=.formControls button#form-buttons-save  \n+  Wait Until Element Is visible  css=.formControls button#form-buttons-save\n   Click Button  Save\n   Wait until page contains  There were some errors.\n   Page should contain  Value is too short\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-07T21:31:13+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/5a6be31362fab485aed65168dbae5a1ef8912985

Yet more focus and wait until visible in test_querystring.robot.

Files changed:
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex bd7ac861be..91b8a7d6cb 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -72,8 +72,10 @@ Scenario: Searchable text query\n     When I open the criteria Searchable text\n     and I search for a\n     and Sleep  0.2\n-    and Wait Until Element Is Visible  css=div.querystring-preview\n-    and Click Element  css=div.querystring-preview\n+    ${preview_selector}  Set Variable  div.querystring-preview\n+    Set Focus To Element  css=${preview_selector}\n+    and Wait Until Element Is Visible  css=${preview_selector}\n+    and Click Element  css=${preview_selector}\n     Then we expect 2 hits\n     When I open the criteria Searchable text\n     and I search for d\n@@ -86,21 +88,26 @@ Scenario: Tag query one\n     and the querystring pattern\n     When I activate the default operator in the criteria Tag\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    ${base_option_selector}  Set Variable  li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option\n+    Set Focus To Element  css=${base_option_selector}-o\n+    and Wait Until Element Is Visible  css=${base_option_selector}-o\n+    and Click Element  css=${base_option_selector}-o\n     Then we expect 4 hits\n     When I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    Set Focus To Element  css=${base_option_selector}-n\n+    and Wait Until Element Is Visible  css=${base_option_selector}-n\n+    and Click Element  css=${base_option_selector}-n\n     Then we expect 4 hits\n     When I delete my selection\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    Set Focus To Element  css=${base_option_selector}-p\n+    and Wait Until Element Is Visible  css=${base_option_selector}-p\n+    and Click Element  css=${base_option_selector}-p\n     Then we expect 1 hits\n     When I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    Set Focus To Element  css=${base_option_selector}-e\n+    and Wait Until Element Is Visible  css=${base_option_selector}-e\n+    and Click Element  css=${base_option_selector}-e\n     Then we expect 2 hits\n \n Scenario Tag query two\n@@ -110,21 +117,26 @@ Scenario Tag query two\n     and the querystring pattern\n     When I expect an empty result after open the operator Matches all of in the criteria Tag\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    ${base_option_selector}  Set Variable  li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option\n+    Set Focus To Element  css=${base_option_selector}-o\n+    and Wait Until Element Is Visible  css=${base_option_selector}-o\n+    and Click Element  css=${base_option_selector}-o\n     Then we expect 4 hits\n     When and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    Set Focus To Element  css=${base_option_selector}-n\n+    and Wait Until Element Is Visible  css=${base_option_selector}-n\n+    and Click Element  css=${base_option_selector}-n\n     Then we expect 3 hits\n     When I delete my selection\n     and and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    Set Focus To Element  css=${base_option_selector}-p\n+    and Wait Until Element Is Visible  css=${base_option_selector}-p\n+    and Click Element  css=${base_option_selector}-p\n     Then we expect 1 hits\n     When and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    Set Focus To Element  css=${base_option_selector}-e\n+    and Wait Until Element Is Visible  css=${base_option_selector}-e\n+    and Click Element  css=${base_option_selector}-e\n     Then we expect 1 hits\n \n \n@@ -171,8 +183,10 @@ Scenario Review state query\n     and the querystring pattern\n     When I open the criteria Review State\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-private\n-    and Click Element  css=li.select2-option-private\n+    ${query_selector}  Set Variable  li.select2-option-private\n+    Set Focus To Element  css=${query_selector}\n+    and Wait Until Element Is Visible  css=${query_selector}\n+    and Click Element  css=${query_selector}\n     Then we expect 7 hits\n \n Scenario Type query\n@@ -181,32 +195,44 @@ Scenario Type query\n     and the querystring pattern\n     When I open the criteria Type\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-event\n-    and Click Element  css=li.select2-option-event\n+    ${query_selector}  Set Variable  li.select2-option-event\n+    Set Focus To Element  css=${query_selector}\n+    and Wait Until Element Is Visible  css=${query_selector}\n+    and Click Element  css=${query_selector}\n     Then we expect 4 hits\n     When I delete one selection\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-file\n-    and Click Element  css=li.select2-option-file\n+    ${query_selector}  Set Variable  li.select2-option-file\n+    Set Focus To Element  css=${query_selector}\n+    and Wait Until Element Is Visible  css=${query_selector}\n+    and Click Element  css=${query_selector}\n     Then we do not expect any hits\n     When I delete one selection\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-folder\n-    and Click Element  css=li.select2-option-folder\n+    ${query_selector}  Set Variable  li.select2-option-folder\n+    Set Focus To Element  css=${query_selector}\n+    and Wait Until Element Is Visible  css=${query_selector}\n+    and Click Element  css=${query_selector}\n     Then we expect 5 hits\n     When I delete one selection\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-link\n-    and Click Element  css=li.select2-option-link\n+    ${query_selector}  Set Variable  li.select2-option-link\n+    Set Focus To Element  css=${query_selector}\n+    and Wait Until Element Is Visible  css=${query_selector}\n+    and Click Element  css=${query_selector}\n     Then we expect 1 hits\n     When I delete one selection\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-document\n-    and Click Element  css=li.select2-option-document\n+    ${query_selector}  Set Variable  li.select2-option-document\n+    Set Focus To Element  css=${query_selector}\n+    and Wait Until Element Is Visible  css=${query_selector}\n+    and Click Element  css=${query_selector}\n     Then we expect 2 hits\n     When I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-link\n-    and Click Element  css=li.select2-option-link\n+    ${query_selector}  Set Variable  li.select2-option-link\n+    Set Focus To Element  css=${query_selector}\n+    and Wait Until Element Is Visible  css=${query_selector}\n+    and Click Element  css=${query_selector}\n     Then we expect 3 hits\n \n Scenario Creator query\n@@ -225,7 +251,9 @@ save\n the querystring pattern\n     #We go the /a to give more useful query results\n     Go to  ${PLONE_URL}/a/++add++Collection\n-    Wait until page contains element  css=.pat-querystring\n+    ${pattern_selector}  Set Variable  .pat-querystring\n+    Set Focus To Element  css=${pattern_selector}\n+    Wait until page contains element  css=${pattern_selector}\n     Given querystring pattern loaded\n     # for some unknown reason unload protection pops up, but only in robot tests\n     Execute Javascript  $(window).unbind(\'beforeunload\')\n@@ -274,62 +302,78 @@ I open the criteria ${CRITERIA}\n     select index type ${CRITERIA}\n \n I search for ${KEYWORD}\n-    Wait Until Element Is Visible  css=input.querystring-criteria-value-StringWidget\n-    Click Element  css=input.querystring-criteria-value-StringWidget\n-    Input Text  css=input.querystring-criteria-value-StringWidget  ${KEYWORD}\n+    ${keyword_selector}  Set Variable  input.querystring-criteria-value-StringWidget\n+    Set Focus To Element  css=${keyword_selector}\n+    Wait Until Element Is Visible  css=${keyword_selector}\n+    Click Element  css=${keyword_selector}\n+    Input Text  css=${keyword_selector}  ${KEYWORD}\n     Click Element  css=div#content-core\n \n I open the Selection Widget\n-    wait until element is visible  css=div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n-    click element  css=div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n+    ${widget_selector}  Set Variable  div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n+    Set Focus To Element  css=${widget_selector}\n+    wait until element is visible  css=${widget_selector}\n+    click element  css=${widget_selector}\n \n I delete one selection\n     #deletes one element\n-    Click Element  css=a.select2-search-choice-close\n+    ${selection_selector}  Set Variable  a.select2-search-choice-close\n+    Set Focus To Element  css=${selection_selector}\n+    Click Element  css=${selection_selector}\n \n I delete my selection\n     #deletes two elements\n-    Click Element  css=a.select2-search-choice-close\n-    Click Element  css=a.select2-search-choice-close\n+    ${selection_selector}  Set Variable  a.select2-search-choice-close\n+    Set Focus To Element  css=${selection_selector}\n+    Click Element  css=${selection_selector}\n+    Sleep  0.1\n+    Set Focus To Element  css=${selection_selector}\n+    Click Element  css=${selection_selector}\n \n I search in ${NAME} subfolder in the related items widget\n     mark results\n-    Click Element  css=ul.select2-choices\n+    ${selector}  Set Variable  ul.select2-choices\n+    Set Focus To Element  css=${selector}\n+    Click Element  css=${selector}\n     Wait Until Page Contains  ${NAME}\n     Click Element  //a[contains(concat(\' \', normalize-space(@class), \' \'), \' pat-relateditems-result-select \')]//span[contains(text(),\'${NAME}\')]\n \n I expect to be in Advanced mode\n     open the select box titled operator\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Navigation Path\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Absolute Path\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Relative Path\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Simple Mode\n-    Click Element  css=div#select2-drop-mask\n-    Wait Until Element Is Not Visible  css=div#select2-drop-mask\n+    ${selector}  Set Variable  .select2-drop-active[style*="display: block;"]\n+    Element Should Contain  jquery=${selector}   Navigation Path\n+    Element Should Contain  jquery=${selector}   Absolute Path\n+    Element Should Contain  jquery=${selector}   Relative Path\n+    Element Should Contain  jquery=${selector}   Simple Mode\n+    ${selector}  Set Variable  div#select2-drop-mask\n+    Set Focus To Element  css=${selector}\n+    Click Element  css=${selector}\n+    Wait Until Element Is Not Visible  css=${selector}\n \n I expect to be in Simple mode\n     open the select box titled operator\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Custom\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Parent (../)\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Current (./)\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Advanced Mode\n-    Click Element  css=div#select2-drop-mask\n-    Wait Until Element Is Not Visible  css=div#select2-drop-mask\n+    ${selector}  Set Variable  .select2-drop-active[style*="display: block;"]\n+    Element Should Contain  jquery=${selector}   Custom\n+    Element Should Contain  jquery=${selector}   Parent (../)\n+    Element Should Contain  jquery=${selector}   Current (./)\n+    Element Should Contain  jquery=${selector}   Advanced Mode\n+    ${selector}  Set Variable  div#select2-drop-mask\n+    Set Focus To Element  css=${selector}\n+    Click Element  css=${selector}\n+    Wait Until Element Is Not Visible  css=${selector}\n \n open the select box titled ${NAME}\n     Click Element  css=body\n     ${select_criteria_selector}  Set Variable  .querystring-criteria-${NAME} .select2-container\n+    Set Focus To Element  css=${select_criteria_selector}\n     Wait Until Element Is Visible  css=${select_criteria_selector}\n     Click Element  css=${select_criteria_selector}\n \n select index type ${INDEX}\n-    Set Focus To Element  css=.select2-drop-active[style*="display: block;"] input\n-    Wait Until Element Is Visible  css=.select2-drop-active[style*="display: block;"] input\n     ${input_selector}  Set Variable  .select2-drop-active[style*="display: block;"] input\n-\n-    Set Focus To Element  jquery=${input_selector}\n-    Wait Until Element Is Visible  jquery=${input_selector}\n-    Input Text  jquery=${input_selector}   text=${INDEX}\n+    Set Focus To Element  css=${input_selector}\n+    Wait Until Element Is Visible  css=${input_selector}\n+    Input Text  css=${input_selector}   text=${INDEX}\n     Press Keys  jquery=:focus  RETURN\n \n we expect ${NUM} hits\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-07T22:54:11+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/5f6a843e8f99691f766ea28b16cea81248c60925

Add robot keyword 'Wait For Then Click Element'.

Also 'Wait For Element' and 'Wait For Then Click Hidden Element'.

Update test_querystring.robot to use them.

Files changed:
M Products/CMFPlone/tests/robot/keywords.robot
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/keywords.robot b/Products/CMFPlone/tests/robot/keywords.robot\nindex 75765ffc38..89b4a4ee21 100644\n--- a/Products/CMFPlone/tests/robot/keywords.robot\n+++ b/Products/CMFPlone/tests/robot/keywords.robot\n@@ -33,3 +33,23 @@ patterns are loaded\n a folder with a document \'${title}\'\n   ${folder_uid}=  Create content  type=Folder  title=folder\n   Create content  type=Document  container=${folder_uid}  title=${title}\n+\n+Wait For Element\n+  [Arguments]  ${element}\n+  [Documentation]  Can contain css=, jquery=, or any other element selector.\n+  Wait Until Page Contains Element  ${element}\n+  Set Focus To Element  ${element}\n+  Wait Until Element Is Visible  ${element}\n+\n+Wait For Then Click Element\n+  [Arguments]  ${element}\n+  [Documentation]  Can contain css=, jquery=, or any other element selector.\n+  Wait For Element  ${element}\n+  Click Element  ${element}\n+\n+Wait For Then Click Hidden Element\n+  [Arguments]  ${element}\n+  [Documentation]  Meant for invisible elements.  Can contain css=, jquery=, or any other element selector.\n+  Wait Until Page Contains Element  ${element}\n+  Set Focus To Element  ${element}\n+  Click Element  ${element}\ndiff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex 91b8a7d6cb..d9106af259 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -72,10 +72,7 @@ Scenario: Searchable text query\n     When I open the criteria Searchable text\n     and I search for a\n     and Sleep  0.2\n-    ${preview_selector}  Set Variable  div.querystring-preview\n-    Set Focus To Element  css=${preview_selector}\n-    and Wait Until Element Is Visible  css=${preview_selector}\n-    and Click Element  css=${preview_selector}\n+    and Wait For Then Click Element  css=div.querystring-preview\n     Then we expect 2 hits\n     When I open the criteria Searchable text\n     and I search for d\n@@ -89,25 +86,17 @@ Scenario: Tag query one\n     When I activate the default operator in the criteria Tag\n     and I open the Selection Widget\n     ${base_option_selector}  Set Variable  li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option\n-    Set Focus To Element  css=${base_option_selector}-o\n-    and Wait Until Element Is Visible  css=${base_option_selector}-o\n-    and Click Element  css=${base_option_selector}-o\n+    and Wait For Then Click Element  css=${base_option_selector}-o\n     Then we expect 4 hits\n     When I open the Selection Widget\n-    Set Focus To Element  css=${base_option_selector}-n\n-    and Wait Until Element Is Visible  css=${base_option_selector}-n\n-    and Click Element  css=${base_option_selector}-n\n+    and Wait For Then Click Element  css=${base_option_selector}-n\n     Then we expect 4 hits\n     When I delete my selection\n     and I open the Selection Widget\n-    Set Focus To Element  css=${base_option_selector}-p\n-    and Wait Until Element Is Visible  css=${base_option_selector}-p\n-    and Click Element  css=${base_option_selector}-p\n+    and Wait For Then Click Element  css=${base_option_selector}-p\n     Then we expect 1 hits\n     When I open the Selection Widget\n-    Set Focus To Element  css=${base_option_selector}-e\n-    and Wait Until Element Is Visible  css=${base_option_selector}-e\n-    and Click Element  css=${base_option_selector}-e\n+    and Wait For Then Click Element  css=${base_option_selector}-e\n     Then we expect 2 hits\n \n Scenario Tag query two\n@@ -118,25 +107,17 @@ Scenario Tag query two\n     When I expect an empty result after open the operator Matches all of in the criteria Tag\n     and I open the Selection Widget\n     ${base_option_selector}  Set Variable  li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option\n-    Set Focus To Element  css=${base_option_selector}-o\n-    and Wait Until Element Is Visible  css=${base_option_selector}-o\n-    and Click Element  css=${base_option_selector}-o\n+    and Wait For Then Click Element  css=${base_option_selector}-o\n     Then we expect 4 hits\n     When and I open the Selection Widget\n-    Set Focus To Element  css=${base_option_selector}-n\n-    and Wait Until Element Is Visible  css=${base_option_selector}-n\n-    and Click Element  css=${base_option_selector}-n\n+    and Wait For Then Click Element  css=${base_option_selector}-n\n     Then we expect 3 hits\n     When I delete my selection\n     and and I open the Selection Widget\n-    Set Focus To Element  css=${base_option_selector}-p\n-    and Wait Until Element Is Visible  css=${base_option_selector}-p\n-    and Click Element  css=${base_option_selector}-p\n+    and Wait For Then Click Element  css=${base_option_selector}-p\n     Then we expect 1 hits\n     When and I open the Selection Widget\n-    Set Focus To Element  css=${base_option_selector}-e\n-    and Wait Until Element Is Visible  css=${base_option_selector}-e\n-    and Click Element  css=${base_option_selector}-e\n+    and Wait For Then Click Element  css=${base_option_selector}-e\n     Then we expect 1 hits\n \n \n@@ -183,10 +164,7 @@ Scenario Review state query\n     and the querystring pattern\n     When I open the criteria Review State\n     and I open the Selection Widget\n-    ${query_selector}  Set Variable  li.select2-option-private\n-    Set Focus To Element  css=${query_selector}\n-    and Wait Until Element Is Visible  css=${query_selector}\n-    and Click Element  css=${query_selector}\n+    and Wait For Then Click Element  css=li.select2-option-private\n     Then we expect 7 hits\n \n Scenario Type query\n@@ -195,44 +173,26 @@ Scenario Type query\n     and the querystring pattern\n     When I open the criteria Type\n     and I open the Selection Widget\n-    ${query_selector}  Set Variable  li.select2-option-event\n-    Set Focus To Element  css=${query_selector}\n-    and Wait Until Element Is Visible  css=${query_selector}\n-    and Click Element  css=${query_selector}\n+    and Wait For Then Click Element  css=li.select2-option-event\n     Then we expect 4 hits\n     When I delete one selection\n     and I open the Selection Widget\n-    ${query_selector}  Set Variable  li.select2-option-file\n-    Set Focus To Element  css=${query_selector}\n-    and Wait Until Element Is Visible  css=${query_selector}\n-    and Click Element  css=${query_selector}\n+    and Wait For Then Click Element  css=li.select2-option-file\n     Then we do not expect any hits\n     When I delete one selection\n     and I open the Selection Widget\n-    ${query_selector}  Set Variable  li.select2-option-folder\n-    Set Focus To Element  css=${query_selector}\n-    and Wait Until Element Is Visible  css=${query_selector}\n-    and Click Element  css=${query_selector}\n+    and Wait For Then Click Element  css=li.select2-option-folder\n     Then we expect 5 hits\n     When I delete one selection\n     and I open the Selection Widget\n-    ${query_selector}  Set Variable  li.select2-option-link\n-    Set Focus To Element  css=${query_selector}\n-    and Wait Until Element Is Visible  css=${query_selector}\n-    and Click Element  css=${query_selector}\n+    and Wait For Then Click Element  css=li.select2-option-link\n     Then we expect 1 hits\n     When I delete one selection\n     and I open the Selection Widget\n-    ${query_selector}  Set Variable  li.select2-option-document\n-    Set Focus To Element  css=${query_selector}\n-    and Wait Until Element Is Visible  css=${query_selector}\n-    and Click Element  css=${query_selector}\n+    and Wait For Then Click Element  css=li.select2-option-document\n     Then we expect 2 hits\n     When I open the Selection Widget\n-    ${query_selector}  Set Variable  li.select2-option-link\n-    Set Focus To Element  css=${query_selector}\n-    and Wait Until Element Is Visible  css=${query_selector}\n-    and Click Element  css=${query_selector}\n+    and Wait For Then Click Element  css=li.select2-option-link\n     Then we expect 3 hits\n \n Scenario Creator query\n@@ -251,9 +211,7 @@ save\n the querystring pattern\n     #We go the /a to give more useful query results\n     Go to  ${PLONE_URL}/a/++add++Collection\n-    ${pattern_selector}  Set Variable  .pat-querystring\n-    Set Focus To Element  css=${pattern_selector}\n-    Wait until page contains element  css=${pattern_selector}\n+    Wait until page contains element  css=.pat-querystring\n     Given querystring pattern loaded\n     # for some unknown reason unload protection pops up, but only in robot tests\n     Execute Javascript  $(window).unbind(\'beforeunload\')\n@@ -292,7 +250,6 @@ I activate the operator ${OPERATOR} in the criteria ${CRITERIA}\n I expect an empty result after open the operator ${OPERATOR} in the criteria ${CRITERIA}\n     open the select box titled index\n     select index type ${CRITERIA}\n-    sleep  0.75\n     Wait for condition  return $("dl.searchResults").length == 0\n     open the select box titled operator\n     select index type ${OPERATOR}\n@@ -303,38 +260,26 @@ I open the criteria ${CRITERIA}\n \n I search for ${KEYWORD}\n     ${keyword_selector}  Set Variable  input.querystring-criteria-value-StringWidget\n-    Set Focus To Element  css=${keyword_selector}\n-    Wait Until Element Is Visible  css=${keyword_selector}\n-    Click Element  css=${keyword_selector}\n+    Wait For Then Click Element  css=${keyword_selector}\n     Input Text  css=${keyword_selector}  ${KEYWORD}\n     Click Element  css=div#content-core\n \n I open the Selection Widget\n-    ${widget_selector}  Set Variable  div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n-    Set Focus To Element  css=${widget_selector}\n-    wait until element is visible  css=${widget_selector}\n-    click element  css=${widget_selector}\n+    Wait For Then Click Element  css=div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n \n I delete one selection\n     #deletes one element\n-    ${selection_selector}  Set Variable  a.select2-search-choice-close\n-    Set Focus To Element  css=${selection_selector}\n-    Click Element  css=${selection_selector}\n+    Wait For Then Click Element  css=a.select2-search-choice-close\n \n I delete my selection\n     #deletes two elements\n-    ${selection_selector}  Set Variable  a.select2-search-choice-close\n-    Set Focus To Element  css=${selection_selector}\n-    Click Element  css=${selection_selector}\n+    Wait For Then Click Element  css=a.select2-search-choice-close\n     Sleep  0.1\n-    Set Focus To Element  css=${selection_selector}\n-    Click Element  css=${selection_selector}\n+    Wait For Then Click Element  css=a.select2-search-choice-close\n \n I search in ${NAME} subfolder in the related items widget\n     mark results\n-    ${selector}  Set Variable  ul.select2-choices\n-    Set Focus To Element  css=${selector}\n-    Click Element  css=${selector}\n+    Wait For Then Click Element  css=ul.select2-choices\n     Wait Until Page Contains  ${NAME}\n     Click Element  //a[contains(concat(\' \', normalize-space(@class), \' \'), \' pat-relateditems-result-select \')]//span[contains(text(),\'${NAME}\')]\n \n@@ -346,8 +291,7 @@ I expect to be in Advanced mode\n     Element Should Contain  jquery=${selector}   Relative Path\n     Element Should Contain  jquery=${selector}   Simple Mode\n     ${selector}  Set Variable  div#select2-drop-mask\n-    Set Focus To Element  css=${selector}\n-    Click Element  css=${selector}\n+    Wait For Then Click Hidden Element  css=${selector}\n     Wait Until Element Is Not Visible  css=${selector}\n \n I expect to be in Simple mode\n@@ -358,21 +302,16 @@ I expect to be in Simple mode\n     Element Should Contain  jquery=${selector}   Current (./)\n     Element Should Contain  jquery=${selector}   Advanced Mode\n     ${selector}  Set Variable  div#select2-drop-mask\n-    Set Focus To Element  css=${selector}\n-    Click Element  css=${selector}\n+    Wait For Then Click Hidden Element  css=${selector}\n     Wait Until Element Is Not Visible  css=${selector}\n \n open the select box titled ${NAME}\n     Click Element  css=body\n-    ${select_criteria_selector}  Set Variable  .querystring-criteria-${NAME} .select2-container\n-    Set Focus To Element  css=${select_criteria_selector}\n-    Wait Until Element Is Visible  css=${select_criteria_selector}\n-    Click Element  css=${select_criteria_selector}\n+    Wait For Then Click Element  css=.querystring-criteria-${NAME} .select2-container\n \n select index type ${INDEX}\n     ${input_selector}  Set Variable  .select2-drop-active[style*="display: block;"] input\n-    Set Focus To Element  css=${input_selector}\n-    Wait Until Element Is Visible  css=${input_selector}\n+    Wait For Element  css=${input_selector}\n     Input Text  css=${input_selector}   text=${INDEX}\n     Press Keys  jquery=:focus  RETURN\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-06-07T23:46:40+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/701c05990b3ad6cbd0a2fc956bb1cfc29d04e24e

Merge pull request #3552 from plone/robottest-fix

try fixing flaky robottests

Files changed:
M Products/CMFPlone/tests/robot/keywords.robot
M Products/CMFPlone/tests/robot/test_edit_user_schema.robot
M Products/CMFPlone/tests/robot/test_linkintegrity.robot
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/keywords.robot b/Products/CMFPlone/tests/robot/keywords.robot\nindex 75765ffc38..89b4a4ee21 100644\n--- a/Products/CMFPlone/tests/robot/keywords.robot\n+++ b/Products/CMFPlone/tests/robot/keywords.robot\n@@ -33,3 +33,23 @@ patterns are loaded\n a folder with a document \'${title}\'\n   ${folder_uid}=  Create content  type=Folder  title=folder\n   Create content  type=Document  container=${folder_uid}  title=${title}\n+\n+Wait For Element\n+  [Arguments]  ${element}\n+  [Documentation]  Can contain css=, jquery=, or any other element selector.\n+  Wait Until Page Contains Element  ${element}\n+  Set Focus To Element  ${element}\n+  Wait Until Element Is Visible  ${element}\n+\n+Wait For Then Click Element\n+  [Arguments]  ${element}\n+  [Documentation]  Can contain css=, jquery=, or any other element selector.\n+  Wait For Element  ${element}\n+  Click Element  ${element}\n+\n+Wait For Then Click Hidden Element\n+  [Arguments]  ${element}\n+  [Documentation]  Meant for invisible elements.  Can contain css=, jquery=, or any other element selector.\n+  Wait Until Page Contains Element  ${element}\n+  Set Focus To Element  ${element}\n+  Click Element  ${element}\ndiff --git a/Products/CMFPlone/tests/robot/test_edit_user_schema.robot b/Products/CMFPlone/tests/robot/test_edit_user_schema.robot\nindex bbb8e87b4f..74a7e1fc89 100644\n--- a/Products/CMFPlone/tests/robot/test_edit_user_schema.robot\n+++ b/Products/CMFPlone/tests/robot/test_edit_user_schema.robot\n@@ -142,6 +142,7 @@ add a min/max constraint to the field\n   Wait until page contains element  form.widgets.min_length\n   Input Text  form.widgets.min_length  4\n   Input Text  form.widgets.max_length  6\n+  Wait Until Element Is visible  css=.pattern-modal-buttons button#form-buttons-save\n   Click Button  css=.pattern-modal-buttons button#form-buttons-save\n   Sleep  1\n \n@@ -172,7 +173,11 @@ a logged-in user will see the field on top of the user profile\n a logged-in user will see a field with min/max constraints\n   a logged-in user will see the field in the user profile\n   Input Text  form.widgets.email  test@plone.org\n+  Set Focus To Element  css=#form-widgets-test_field\n+  Wait Until Element Is visible  css=#form-widgets-test_field\n   Input Text  form.widgets.test_field  1\n+  Set Focus To Element  css=.formControls button#form-buttons-save  \n+  Wait Until Element Is visible  css=.formControls button#form-buttons-save\n   Click Button  Save\n   Wait until page contains  There were some errors.\n   Page should contain  Value is too short\ndiff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex bf2b03adcf..69eb7aa4a4 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -86,10 +86,14 @@ a link in rich text\n   Wait until page contains  Foo\n \n   Click Button  css=.modal-footer .btn-primary\n+\n+  Set Focus To Element  css=#form-buttons-save\n+  Wait Until Element Is Visible  css=#form-buttons-save\n   Click Button  css=#form-buttons-save\n \n \n should show warning when deleting page\n+\n   Go To  ${PLONE_URL}/foo\n   Wait until element is visible  css=#plone-contentmenu-actions a\n   Click Link  css=#plone-contentmenu-actions a\n@@ -102,13 +106,19 @@ should show warning when deleting page from folder_contents\n   Go To  ${PLONE_URL}/folder_contents\n   Wait until keyword succeeds  30  1  Page should contain element  css=tr[data-id="foo"] input\n   # Might still take a bit before it is clickable.\n-  Sleep  1\n+  Set Focus To Element  css=tr[data-id="foo"] input\n+  Wait Until Element Is Visible  css=tr[data-id="foo"] input\n   Click Element  css=tr[data-id="foo"] input\n   Checkbox Should Be Selected  css=tr[data-id="foo"] input\n   Wait until keyword succeeds  30  1  Page should not contain element  css=#btn-delete.disabled\n+\n+  Set Focus To Element  css=#btngroup-mainbuttons #btn-delete\n+  Wait Until Element Is Visible  css=#btngroup-mainbuttons #btn-delete\n   Click Element  css=#btngroup-mainbuttons #btn-delete\n   Wait until page contains element  css=.popover-content .btn-danger\n   Page should contain element  css=.breach-container .breach-item\n+  Set Focus To Element  css=#popover-delete .closeBtn\n+  Wait Until Element Is Visible  css=#popover-delete .closeBtn\n   Click Element  css=#popover-delete .closeBtn\n   Checkbox Should Be Selected  css=tr[data-id="foo"] input\n \n@@ -148,4 +158,7 @@ remove link to page\n   Execute Javascript    function selectElementContents(el) {var range = document.createRange(); range.selectNodeContents(el); var sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);} var el = document.getElementById("tinymce"); selectElementContents(el);\n   UnSelect Frame\n   Click Button  css=button[aria-label="Remove link"]\n+\n+  Set Focus To Element  css=#form-buttons-save\n+  Wait Until Element Is Visible  css=#form-buttons-save\n   Click Button  css=#form-buttons-save\ndiff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex ef22e81206..d9106af259 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -72,8 +72,7 @@ Scenario: Searchable text query\n     When I open the criteria Searchable text\n     and I search for a\n     and Sleep  0.2\n-    and Wait Until Element Is Visible  css=div.querystring-preview\n-    and Click Element  css=div.querystring-preview\n+    and Wait For Then Click Element  css=div.querystring-preview\n     Then we expect 2 hits\n     When I open the criteria Searchable text\n     and I search for d\n@@ -86,21 +85,18 @@ Scenario: Tag query one\n     and the querystring pattern\n     When I activate the default operator in the criteria Tag\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    ${base_option_selector}  Set Variable  li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option\n+    and Wait For Then Click Element  css=${base_option_selector}-o\n     Then we expect 4 hits\n     When I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    and Wait For Then Click Element  css=${base_option_selector}-n\n     Then we expect 4 hits\n     When I delete my selection\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    and Wait For Then Click Element  css=${base_option_selector}-p\n     Then we expect 1 hits\n     When I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    and Wait For Then Click Element  css=${base_option_selector}-e\n     Then we expect 2 hits\n \n Scenario Tag query two\n@@ -110,21 +106,18 @@ Scenario Tag query two\n     and the querystring pattern\n     When I expect an empty result after open the operator Matches all of in the criteria Tag\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-o\n+    ${base_option_selector}  Set Variable  li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option\n+    and Wait For Then Click Element  css=${base_option_selector}-o\n     Then we expect 4 hits\n     When and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-n\n+    and Wait For Then Click Element  css=${base_option_selector}-n\n     Then we expect 3 hits\n     When I delete my selection\n     and and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-p\n+    and Wait For Then Click Element  css=${base_option_selector}-p\n     Then we expect 1 hits\n     When and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n-    and Click Element  css=li.select2-results-dept-0.select2-result.select2-result-selectable.select2-option-e\n+    and Wait For Then Click Element  css=${base_option_selector}-e\n     Then we expect 1 hits\n \n \n@@ -171,8 +164,7 @@ Scenario Review state query\n     and the querystring pattern\n     When I open the criteria Review State\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-private\n-    and Click Element  css=li.select2-option-private\n+    and Wait For Then Click Element  css=li.select2-option-private\n     Then we expect 7 hits\n \n Scenario Type query\n@@ -181,32 +173,26 @@ Scenario Type query\n     and the querystring pattern\n     When I open the criteria Type\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-event\n-    and Click Element  css=li.select2-option-event\n+    and Wait For Then Click Element  css=li.select2-option-event\n     Then we expect 4 hits\n     When I delete one selection\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-file\n-    and Click Element  css=li.select2-option-file\n+    and Wait For Then Click Element  css=li.select2-option-file\n     Then we do not expect any hits\n     When I delete one selection\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-folder\n-    and Click Element  css=li.select2-option-folder\n+    and Wait For Then Click Element  css=li.select2-option-folder\n     Then we expect 5 hits\n     When I delete one selection\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-link\n-    and Click Element  css=li.select2-option-link\n+    and Wait For Then Click Element  css=li.select2-option-link\n     Then we expect 1 hits\n     When I delete one selection\n     and I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-document\n-    and Click Element  css=li.select2-option-document\n+    and Wait For Then Click Element  css=li.select2-option-document\n     Then we expect 2 hits\n     When I open the Selection Widget\n-    and Wait Until Element Is Visible  css=li.select2-option-link\n-    and Click Element  css=li.select2-option-link\n+    and Wait For Then Click Element  css=li.select2-option-link\n     Then we expect 3 hits\n \n Scenario Creator query\n@@ -264,7 +250,6 @@ I activate the operator ${OPERATOR} in the criteria ${CRITERIA}\n I expect an empty result after open the operator ${OPERATOR} in the criteria ${CRITERIA}\n     open the select box titled index\n     select index type ${CRITERIA}\n-    sleep  0.75\n     Wait for condition  return $("dl.searchResults").length == 0\n     open the select box titled operator\n     select index type ${OPERATOR}\n@@ -274,59 +259,61 @@ I open the criteria ${CRITERIA}\n     select index type ${CRITERIA}\n \n I search for ${KEYWORD}\n-    Wait Until Element Is Visible  css=input.querystring-criteria-value-StringWidget\n-    Click Element  css=input.querystring-criteria-value-StringWidget\n-    Input Text  css=input.querystring-criteria-value-StringWidget  ${KEYWORD}\n+    ${keyword_selector}  Set Variable  input.querystring-criteria-value-StringWidget\n+    Wait For Then Click Element  css=${keyword_selector}\n+    Input Text  css=${keyword_selector}  ${KEYWORD}\n     Click Element  css=div#content-core\n \n I open the Selection Widget\n-    wait until element is visible  css=div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n-    click element  css=div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n+    Wait For Then Click Element  css=div.select2-container-multi.querystring-criteria-value-MultipleSelectionWidget\n \n I delete one selection\n     #deletes one element\n-    Click Element  css=a.select2-search-choice-close\n+    Wait For Then Click Element  css=a.select2-search-choice-close\n \n I delete my selection\n     #deletes two elements\n-    Click Element  css=a.select2-search-choice-close\n-    Click Element  css=a.select2-search-choice-close\n+    Wait For Then Click Element  css=a.select2-search-choice-close\n+    Sleep  0.1\n+    Wait For Then Click Element  css=a.select2-search-choice-close\n \n I search in ${NAME} subfolder in the related items widget\n     mark results\n-    Click Element  css=ul.select2-choices\n+    Wait For Then Click Element  css=ul.select2-choices\n     Wait Until Page Contains  ${NAME}\n     Click Element  //a[contains(concat(\' \', normalize-space(@class), \' \'), \' pat-relateditems-result-select \')]//span[contains(text(),\'${NAME}\')]\n \n I expect to be in Advanced mode\n     open the select box titled operator\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Navigation Path\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Absolute Path\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Relative Path\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Simple Mode\n-    Click Element  css=div#select2-drop-mask\n-    Wait Until Element Is Not Visible  css=div#select2-drop-mask\n+    ${selector}  Set Variable  .select2-drop-active[style*="display: block;"]\n+    Element Should Contain  jquery=${selector}   Navigation Path\n+    Element Should Contain  jquery=${selector}   Absolute Path\n+    Element Should Contain  jquery=${selector}   Relative Path\n+    Element Should Contain  jquery=${selector}   Simple Mode\n+    ${selector}  Set Variable  div#select2-drop-mask\n+    Wait For Then Click Hidden Element  css=${selector}\n+    Wait Until Element Is Not Visible  css=${selector}\n \n I expect to be in Simple mode\n     open the select box titled operator\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Custom\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Parent (../)\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Current (./)\n-    Element Should Contain  jquery=.select2-drop-active[style*="display: block;"]   Advanced Mode\n-    Click Element  css=div#select2-drop-mask\n-    Wait Until Element Is Not Visible  css=div#select2-drop-mask\n+    ${selector}  Set Variable  .select2-drop-active[style*="display: block;"]\n+    Element Should Contain  jquery=${selector}   Custom\n+    Element Should Contain  jquery=${selector}   Parent (../)\n+    Element Should Contain  jquery=${selector}   Current (./)\n+    Element Should Contain  jquery=${selector}   Advanced Mode\n+    ${selector}  Set Variable  div#select2-drop-mask\n+    Wait For Then Click Hidden Element  css=${selector}\n+    Wait Until Element Is Not Visible  css=${selector}\n \n open the select box titled ${NAME}\n     Click Element  css=body\n-    ${select_criteria_selector}  Set Variable  .querystring-criteria-${NAME} .select2-container a\n-    Wait Until Element Is Visible  css=${select_criteria_selector}\n-    Click Element  css=${select_criteria_selector}\n+    Wait For Then Click Element  css=.querystring-criteria-${NAME} .select2-container\n \n select index type ${INDEX}\n     ${input_selector}  Set Variable  .select2-drop-active[style*="display: block;"] input\n-    Wait Until Element Is Visible  jquery=${input_selector}\n-    Input Text  jquery=${input_selector}   text=${INDEX}\n-    Press Key  jquery=:focus  \\\\13\n+    Wait For Element  css=${input_selector}\n+    Input Text  css=${input_selector}   text=${INDEX}\n+    Press Keys  jquery=:focus  RETURN\n \n we expect ${NUM} hits\n     #This assumes we have the 2 "Test document" and "Test folder" items from the\n'

