Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2017-06-06T12:52:35+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.dexterity/commit/f286cf5c926deb7ef6a5d4e84be6d395c04d04ec

Remove the transaction.begin and transaction.commit calls

Remove the transaction.begin call before creating a dx object.
Remove the transaction.commit call after creating a dx object.
Fixes #243

Files changed:
M CHANGES.rst
M plone/app/dexterity/factories.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c2c5057..e6f8cf5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,13 +10,16 @@ Breaking changes:
 
 New features:
 
-  add documentation for plone.app.contenttypes.behaviors.thumb_icon.IThumbIconHandling 
+  add documentation for plone.app.contenttypes.behaviors.thumb_icon.IThumbIconHandling
   see PLIP https://github.com/plone/Products.CMFPlone/issues/1734
   [fgrcon]
 
 Bug fixes:
 
-- *add item here*
+- Remove the transaction.begin call before creating a dx object,
+  remove the transaction.commit call after creating a dx object.
+  Fixes #243.
+  [ale-rt]
 
 
 2.4.2 (2017-05-24)
@@ -32,7 +35,7 @@ Bug fixes:
   As great side effect vocabularies for i.e. AjaxSelectWidget from ``plone.app.content``,
   which are using the check, are working on add forms in a context w/o "Modify portal content".
   [jensens]
-- removed deprecated getIcon() from documentation 
+- removed deprecated getIcon() from documentation
   [fgrcon]
 
 - JavaScript formating according to style guides.
diff --git a/plone/app/dexterity/factories.py b/plone/app/dexterity/factories.py
index 59e4569..391a085 100644
--- a/plone/app/dexterity/factories.py
+++ b/plone/app/dexterity/factories.py
@@ -38,8 +38,6 @@ def __call__(self, name, content_type, data):
 
         newid = chooser.chooseName(name, self.context.aq_parent)
         try:
-            transaction.begin()
-
             # Try to determine which kind of NamedBlob we need
             # This will suffice for standard p.a.contenttypes File/Image
             # and any other custom type that would have 'File' or 'Image' in
@@ -73,7 +71,6 @@ def __call__(self, name, content_type, data):
 
             obj.title = name
             obj.reindexObject()
-            transaction.commit()
 
         finally:
             upload_lock.release()


Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2017-06-06T14:17:10+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.dexterity/commit/e95cdaae8f3944c2da7361f346b6e3c1542f9d3c

Merge pull request #244 from plone/243-remove-transaction-begin

Remove the transaction.begin and transaction.commit calls

Files changed:
M CHANGES.rst
M plone/app/dexterity/factories.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c2c5057..e6f8cf5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,13 +10,16 @@ Breaking changes:
 
 New features:
 
-  add documentation for plone.app.contenttypes.behaviors.thumb_icon.IThumbIconHandling 
+  add documentation for plone.app.contenttypes.behaviors.thumb_icon.IThumbIconHandling
   see PLIP https://github.com/plone/Products.CMFPlone/issues/1734
   [fgrcon]
 
 Bug fixes:
 
-- *add item here*
+- Remove the transaction.begin call before creating a dx object,
+  remove the transaction.commit call after creating a dx object.
+  Fixes #243.
+  [ale-rt]
 
 
 2.4.2 (2017-05-24)
@@ -32,7 +35,7 @@ Bug fixes:
   As great side effect vocabularies for i.e. AjaxSelectWidget from ``plone.app.content``,
   which are using the check, are working on add forms in a context w/o "Modify portal content".
   [jensens]
-- removed deprecated getIcon() from documentation 
+- removed deprecated getIcon() from documentation
   [fgrcon]
 
 - JavaScript formating according to style guides.
diff --git a/plone/app/dexterity/factories.py b/plone/app/dexterity/factories.py
index 59e4569..391a085 100644
--- a/plone/app/dexterity/factories.py
+++ b/plone/app/dexterity/factories.py
@@ -38,8 +38,6 @@ def __call__(self, name, content_type, data):
 
         newid = chooser.chooseName(name, self.context.aq_parent)
         try:
-            transaction.begin()
-
             # Try to determine which kind of NamedBlob we need
             # This will suffice for standard p.a.contenttypes File/Image
             # and any other custom type that would have 'File' or 'Image' in
@@ -73,7 +71,6 @@ def __call__(self, name, content_type, data):
 
             obj.title = name
             obj.reindexObject()
-            transaction.commit()
 
         finally:
             upload_lock.release()


