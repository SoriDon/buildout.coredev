Repository: mockup


Branch: refs/heads/master
Date: 2016-05-02T13:53:24-05:00
Author: nathan.vangheem () <nathan.vangheem@wildcardcorp.com>
Commit: https://github.com/plone/mockup/commit/5a2311301308e1c0ead44abdc2e70040a38c3812

add body class for active popover

Files changed:
M CHANGES.rst
M mockup/js/ui/views/popover.js
M mockup/patterns/structure/js/views/app.js
M mockup/patterns/structure/js/views/textfilter.js

diff --git a/CHANGES.rst b/CHANGES.rst
index e835a76..ba162ad 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,9 @@ Incompatibilities:
 
 New:
 
+- add body class for active popover
+  [vangheem]
+
 - Be able to set structure status from server with object of { text: '', label: '', type: 'warning'}
   so you can customize the status message from ajax handlers.
   [vangheem]
diff --git a/mockup/js/ui/views/popover.js b/mockup/js/ui/views/popover.js
index 6f27e83..a181358 100644
--- a/mockup/js/ui/views/popover.js
+++ b/mockup/js/ui/views/popover.js
@@ -73,6 +73,7 @@ define([
         }, this);
       }
     },
+
     getPosition: function() {
       var $el = this.triggerView.$el;
       return $.extend({}, {
@@ -80,6 +81,16 @@ define([
         height: $el[0].offsetHeight
       }, $el.offset());
     },
+
+    getBodyClassName: function(){
+      var name = 'popover-';
+      if(this.options.id){
+        name += this.options.id + '-';
+      }
+      name += 'active';
+      return name;
+    },
+
     show: function() {
       /* hide existing */
       $('.popover:visible').each(function(){
@@ -104,6 +115,7 @@ define([
 
       this.uiEventTrigger('show', this);
       this.$el.attr('aria-hidden', 'false');
+      $('body').addClass(this.getBodyClassName());
     },
 
     position: function(){
@@ -194,6 +206,7 @@ define([
       }
       this.uiEventTrigger('hide', this);
       this.$el.attr('aria-hidden', 'true');
+      $('body').removeClass(this.getBodyClassName());
     },
     toggle: function(button, e) {
       if (this.opened) {
diff --git a/mockup/patterns/structure/js/views/app.js b/mockup/patterns/structure/js/views/app.js
index c778f08..693f81a 100644
--- a/mockup/patterns/structure/js/views/app.js
+++ b/mockup/patterns/structure/js/views/app.js
@@ -88,7 +88,8 @@ define([
       self.wellView = new SelectionWellView({
         collection: self.selectedCollection,
         triggerView: self.toolbar.get('selected-items'),
-        app: self
+        app: self,
+        id: 'structure-well'
       });
 
       self.toolbar.get('selected-items').disable();
@@ -353,7 +354,8 @@ define([
 
       self.columnsView = new ColumnsView({
         app: self,
-        triggerView: columnsBtn
+        triggerView: columnsBtn,
+        id: 'structure-columns'
       });
       items.push(columnsBtn);
 
@@ -373,7 +375,8 @@ define([
         });
         self.rearrangeView = new RearrangeView({
           triggerView: rearrangeButton,
-          app: self
+          app: self,
+          id: 'structure-rearrange'
         });
         items.push(rearrangeButton);
       }
diff --git a/mockup/patterns/structure/js/views/textfilter.js b/mockup/patterns/structure/js/views/textfilter.js
index 2a8ef84..13f1b73 100644
--- a/mockup/patterns/structure/js/views/textfilter.js
+++ b/mockup/patterns/structure/js/views/textfilter.js
@@ -42,6 +42,7 @@ define([
       });
       this.popover = new PopoverView({
         triggerView: this.button,
+        id: 'structure-query',
         title: _.template(_t('Query')),
         content: this.popoverContent,
         placement: 'left'


Repository: mockup


Branch: refs/heads/master
Date: 2016-05-02T23:38:39-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/5c875522c71bb4ff6e5f16b795d9eedbec992b92

Merge pull request #667 from plone/popover-active-class

add body class for active popover

Files changed:
M CHANGES.rst
M mockup/js/ui/views/popover.js
M mockup/patterns/structure/js/views/app.js
M mockup/patterns/structure/js/views/textfilter.js

diff --git a/CHANGES.rst b/CHANGES.rst
index e835a76..ba162ad 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,9 @@ Incompatibilities:
 
 New:
 
+- add body class for active popover
+  [vangheem]
+
 - Be able to set structure status from server with object of { text: '', label: '', type: 'warning'}
   so you can customize the status message from ajax handlers.
   [vangheem]
diff --git a/mockup/js/ui/views/popover.js b/mockup/js/ui/views/popover.js
index 6f27e83..a181358 100644
--- a/mockup/js/ui/views/popover.js
+++ b/mockup/js/ui/views/popover.js
@@ -73,6 +73,7 @@ define([
         }, this);
       }
     },
+
     getPosition: function() {
       var $el = this.triggerView.$el;
       return $.extend({}, {
@@ -80,6 +81,16 @@ define([
         height: $el[0].offsetHeight
       }, $el.offset());
     },
+
+    getBodyClassName: function(){
+      var name = 'popover-';
+      if(this.options.id){
+        name += this.options.id + '-';
+      }
+      name += 'active';
+      return name;
+    },
+
     show: function() {
       /* hide existing */
       $('.popover:visible').each(function(){
@@ -104,6 +115,7 @@ define([
 
       this.uiEventTrigger('show', this);
       this.$el.attr('aria-hidden', 'false');
+      $('body').addClass(this.getBodyClassName());
     },
 
     position: function(){
@@ -194,6 +206,7 @@ define([
       }
       this.uiEventTrigger('hide', this);
       this.$el.attr('aria-hidden', 'true');
+      $('body').removeClass(this.getBodyClassName());
     },
     toggle: function(button, e) {
       if (this.opened) {
diff --git a/mockup/patterns/structure/js/views/app.js b/mockup/patterns/structure/js/views/app.js
index c778f08..693f81a 100644
--- a/mockup/patterns/structure/js/views/app.js
+++ b/mockup/patterns/structure/js/views/app.js
@@ -88,7 +88,8 @@ define([
       self.wellView = new SelectionWellView({
         collection: self.selectedCollection,
         triggerView: self.toolbar.get('selected-items'),
-        app: self
+        app: self,
+        id: 'structure-well'
       });
 
       self.toolbar.get('selected-items').disable();
@@ -353,7 +354,8 @@ define([
 
       self.columnsView = new ColumnsView({
         app: self,
-        triggerView: columnsBtn
+        triggerView: columnsBtn,
+        id: 'structure-columns'
       });
       items.push(columnsBtn);
 
@@ -373,7 +375,8 @@ define([
         });
         self.rearrangeView = new RearrangeView({
           triggerView: rearrangeButton,
-          app: self
+          app: self,
+          id: 'structure-rearrange'
         });
         items.push(rearrangeButton);
       }
diff --git a/mockup/patterns/structure/js/views/textfilter.js b/mockup/patterns/structure/js/views/textfilter.js
index 2a8ef84..13f1b73 100644
--- a/mockup/patterns/structure/js/views/textfilter.js
+++ b/mockup/patterns/structure/js/views/textfilter.js
@@ -42,6 +42,7 @@ define([
       });
       this.popover = new PopoverView({
         triggerView: this.button,
+        id: 'structure-query',
         title: _.template(_t('Query')),
         content: this.popoverContent,
         placement: 'left'


