Repository: plone.app.content


Branch: refs/heads/master
Date: 2015-12-08T11:24:47+01:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/de00bd66f6a676384f69ffac72001c0cdd6b0238

feat: Ensure the base context allows ordering during rearranging

Files changed:
M CHANGES.rst
M plone/app/content/browser/contents/rearrange.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 44e6087..d43906e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,7 +6,8 @@ Changelog
 
 New:
 
-- *add item here*
+- Ensure the base context allows ordering during rearranging.
+  [Gagaro]
 
 Fixes:
 
diff --git a/plone/app/content/browser/contents/rearrange.py b/plone/app/content/browser/contents/rearrange.py
index d12a670..19005a9 100644
--- a/plone/app/content/browser/contents/rearrange.py
+++ b/plone/app/content/browser/contents/rearrange.py
@@ -12,7 +12,10 @@ class OrderContentsBaseAction(ContentsBaseAction):
     def getOrdering(self):
         if IPloneSiteRoot.providedBy(self.context):
             return self.context
-        ordering = self.context.getOrdering()
+        try:
+            ordering = self.context.aq_base.getOrdering()
+        except AttributeError:
+            return None
         if not IExplicitOrdering.providedBy(ordering):
             return None
         return ordering


Repository: plone.app.content


Branch: refs/heads/master
Date: 2015-12-08T11:24:58+01:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/44b26826306b6430e34d4c8a5a57509179938985

fix: error message displaying during rearranging

Files changed:
M CHANGES.rst
M plone/app/content/browser/contents/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d43906e..204148c 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -11,7 +11,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Fixed error message displaying during rearranging.
+  [Gagaro]
 
 
 3.0.14 (2015-11-26)
diff --git a/plone/app/content/browser/contents/__init__.py b/plone/app/content/browser/contents/__init__.py
index e89fd47..1701603 100644
--- a/plone/app/content/browser/contents/__init__.py
+++ b/plone/app/content/browser/contents/__init__.py
@@ -121,9 +121,9 @@ def message(self, missing=[]):
             translated_errors = [
                 translate(error, context=self.request) for error in self.errors
             ]
-            translated_msg = '{0:s}: {0:s}'.format(
+            translated_msg = u'{0:s}: {1:s}'.format(
                 translated_msg,
-                '\n'.join(translated_errors)
+                u'\n'.join(translated_errors)
             )
 
         return self.json({


Repository: plone.app.content


Branch: refs/heads/master
Date: 2015-12-08T15:14:28+01:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/b0b19d0f4c45ccb6983faa0b9c5f8285f65ae433

fix: fix rearrange for archetypes

Files changed:
M CHANGES.rst
M plone/app/content/browser/contents/rearrange.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 204148c..6a7d2d7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -11,6 +11,9 @@ New:
 
 Fixes:
 
+- Fixed rearranging for archetypes.
+  [Gagaro]
+
 - Fixed error message displaying during rearranging.
   [Gagaro]
 
diff --git a/plone/app/content/browser/contents/rearrange.py b/plone/app/content/browser/contents/rearrange.py
index 19005a9..079d6b5 100644
--- a/plone/app/content/browser/contents/rearrange.py
+++ b/plone/app/content/browser/contents/rearrange.py
@@ -1,4 +1,5 @@
 # -*- coding: utf-8 -*-
+from OFS.interfaces import IOrderedContainer
 from plone.app.content.browser.contents import ContentsBaseAction
 from plone.app.content.utils import json_loads
 from plone.folder.interfaces import IExplicitOrdering
@@ -15,6 +16,9 @@ def getOrdering(self):
         try:
             ordering = self.context.aq_base.getOrdering()
         except AttributeError:
+            if IOrderedContainer.providedBy(self.context):
+                # Archetype
+                return IOrderedContainer(self.context)
             return None
         if not IExplicitOrdering.providedBy(ordering):
             return None


Repository: plone.app.content


Branch: refs/heads/master
Date: 2015-12-08T11:20:39-06:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/35754c878038728b36d9297bd8ff4f52dd22f89b

Merge pull request #66 from plone/fix-rearrange

Fix rearrange

Files changed:
M CHANGES.rst
M plone/app/content/browser/contents/__init__.py
M plone/app/content/browser/contents/rearrange.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 44e6087..6a7d2d7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,11 +6,16 @@ Changelog
 
 New:
 
-- *add item here*
+- Ensure the base context allows ordering during rearranging.
+  [Gagaro]
 
 Fixes:
 
-- *add item here*
+- Fixed rearranging for archetypes.
+  [Gagaro]
+
+- Fixed error message displaying during rearranging.
+  [Gagaro]
 
 
 3.0.14 (2015-11-26)
diff --git a/plone/app/content/browser/contents/__init__.py b/plone/app/content/browser/contents/__init__.py
index e89fd47..1701603 100644
--- a/plone/app/content/browser/contents/__init__.py
+++ b/plone/app/content/browser/contents/__init__.py
@@ -121,9 +121,9 @@ def message(self, missing=[]):
             translated_errors = [
                 translate(error, context=self.request) for error in self.errors
             ]
-            translated_msg = '{0:s}: {0:s}'.format(
+            translated_msg = u'{0:s}: {1:s}'.format(
                 translated_msg,
-                '\n'.join(translated_errors)
+                u'\n'.join(translated_errors)
             )
 
         return self.json({
diff --git a/plone/app/content/browser/contents/rearrange.py b/plone/app/content/browser/contents/rearrange.py
index d12a670..079d6b5 100644
--- a/plone/app/content/browser/contents/rearrange.py
+++ b/plone/app/content/browser/contents/rearrange.py
@@ -1,4 +1,5 @@
 # -*- coding: utf-8 -*-
+from OFS.interfaces import IOrderedContainer
 from plone.app.content.browser.contents import ContentsBaseAction
 from plone.app.content.utils import json_loads
 from plone.folder.interfaces import IExplicitOrdering
@@ -12,7 +13,13 @@ class OrderContentsBaseAction(ContentsBaseAction):
     def getOrdering(self):
         if IPloneSiteRoot.providedBy(self.context):
             return self.context
-        ordering = self.context.getOrdering()
+        try:
+            ordering = self.context.aq_base.getOrdering()
+        except AttributeError:
+            if IOrderedContainer.providedBy(self.context):
+                # Archetype
+                return IOrderedContainer(self.context)
+            return None
         if not IExplicitOrdering.providedBy(ordering):
             return None
         return ordering


