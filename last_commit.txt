Repository: plone.api


Branch: refs/heads/master
Date: 2021-09-27T17:49:04+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.api/commit/7abc274c2b1d82d2c748f9beb455246e39763a97

Prevent startup error in relation code when plone.app.iterate is missing.

Fixes https://github.com/plone/plone.api/issues/462

Files changed:
A news/462.bugfix
M src/plone/api/relation.py

b'diff --git a/news/462.bugfix b/news/462.bugfix\nnew file mode 100644\nindex 0000000..35b5941\n--- /dev/null\n+++ b/news/462.bugfix\n@@ -0,0 +1,2 @@\n+Prevent startup error in relation code when ``plone.app.iterate`` is missing.\n+[maurits]\ndiff --git a/src/plone/api/relation.py b/src/plone/api/relation.py\nindex a34c0ad..36a1bdd 100644\n--- a/src/plone/api/relation.py\n+++ b/src/plone/api/relation.py\n@@ -7,8 +7,6 @@\n from plone.api.exc import InvalidParameterError\n from plone.api.validation import at_least_one_of\n from plone.api.validation import required_parameters\n-from plone.app.iterate.dexterity import ITERATE_RELATION_NAME\n-from plone.app.iterate.dexterity.relation import StagingRelationValue\n from plone.app.linkintegrity.handlers import modifiedContent\n from plone.app.linkintegrity.utils import referencedRelationship\n from plone.dexterity.utils import iterSchemataForType\n@@ -24,6 +22,16 @@\n from zope.lifecycleevent import modified\n \n import logging\n+import pkg_resources\n+\n+try:\n+    pkg_resources.get_distribution("plone.app.iterate")\n+except pkg_resources.DistributionNotFound:\n+    ITERATE_RELATION_NAME = None\n+    StagingRelationValue = None\n+else:\n+    from plone.app.iterate.dexterity import ITERATE_RELATION_NAME\n+    from plone.app.iterate.dexterity.relation import StagingRelationValue\n \n \n logger = logging.getLogger(__name__)\n'

Repository: plone.api


Branch: refs/heads/master
Date: 2021-09-28T08:50:11+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.api/commit/38bdebdd3a840b108d587be2ab0d434bf669e0f2

Merge pull request #463 from plone/maurits/fix-iterate

Prevent startup error in relations when plone.app.iterate is missing

Files changed:
A news/462.bugfix
M src/plone/api/relation.py

b'diff --git a/news/462.bugfix b/news/462.bugfix\nnew file mode 100644\nindex 0000000..35b5941\n--- /dev/null\n+++ b/news/462.bugfix\n@@ -0,0 +1,2 @@\n+Prevent startup error in relation code when ``plone.app.iterate`` is missing.\n+[maurits]\ndiff --git a/src/plone/api/relation.py b/src/plone/api/relation.py\nindex a34c0ad..36a1bdd 100644\n--- a/src/plone/api/relation.py\n+++ b/src/plone/api/relation.py\n@@ -7,8 +7,6 @@\n from plone.api.exc import InvalidParameterError\n from plone.api.validation import at_least_one_of\n from plone.api.validation import required_parameters\n-from plone.app.iterate.dexterity import ITERATE_RELATION_NAME\n-from plone.app.iterate.dexterity.relation import StagingRelationValue\n from plone.app.linkintegrity.handlers import modifiedContent\n from plone.app.linkintegrity.utils import referencedRelationship\n from plone.dexterity.utils import iterSchemataForType\n@@ -24,6 +22,16 @@\n from zope.lifecycleevent import modified\n \n import logging\n+import pkg_resources\n+\n+try:\n+    pkg_resources.get_distribution("plone.app.iterate")\n+except pkg_resources.DistributionNotFound:\n+    ITERATE_RELATION_NAME = None\n+    StagingRelationValue = None\n+else:\n+    from plone.app.iterate.dexterity import ITERATE_RELATION_NAME\n+    from plone.app.iterate.dexterity.relation import StagingRelationValue\n \n \n logger = logging.getLogger(__name__)\n'

