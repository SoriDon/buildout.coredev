Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-04-03T15:38:03+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.layout/commit/54eaf940f7179add58901b6508a6ce83674a8cc6

fix cachekey generation in py3

Files changed:
M plone/app/layout/links/viewlets.py

diff --git a/plone/app/layout/links/viewlets.py b/plone/app/layout/links/viewlets.py
index 36802a3..7d02e10 100644
--- a/plone/app/layout/links/viewlets.py
+++ b/plone/app/layout/links/viewlets.py
@@ -26,9 +26,9 @@ def render_cachekey(fun, self):
     key = StringIO()
     # Include the name of the viewlet as the underlying cache key only
     # takes the module and function name into account, but not the class
-    print >> key, self.__name__
-    print >> key, self.site_url
-    print >> key, get_language(aq_inner(self.context), self.request)
+    print(self.__name__, file=key)
+    print(self.site_url, file=key)
+    print(get_language(aq_inner(self.context), self.request), file=key)
 
     return key.getvalue()
 


Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-04-11T22:17:18+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/c0003195f57c43a8c5381bd35ad5996912a68028

Merge branch 'master' into python3

Files changed:
M CHANGES.rst
M plone/app/layout/viewlets/common.py

diff --git a/CHANGES.rst b/CHANGES.rst
index dce7034..5e4d028 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Make it easier to override seperator in title viewlet
+  [tomgross]
 
 Bug fixes:
 
diff --git a/plone/app/layout/viewlets/common.py b/plone/app/layout/viewlets/common.py
index 5cf5f76..0da1f9f 100644
--- a/plone/app/layout/viewlets/common.py
+++ b/plone/app/layout/viewlets/common.py
@@ -66,6 +66,9 @@ def index(self):
 class TitleViewlet(ViewletBase):
     index = ViewPageTemplateFile('title.pt')
 
+    # seperator of page- and portal-title
+    sep = u' &mdash; '
+
     @property
     @memoize
     def site_title_setting(self):
@@ -121,8 +124,7 @@ def update(self):
         if self.page_title == portal_title:
             self.site_title = portal_title
         else:
-            self.site_title = u"%s &mdash; %s" % (self.page_title,
-                                                  portal_title)
+            self.site_title = self.sep.join([self.page_title, portal_title])
 
 
 class DublinCoreViewlet(ViewletBase):


Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-04-12T10:14:25+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/320f75b0673317139e8af24c7aba70ed1cc89a99

No need for StringIO overhead.

Files changed:
M plone/app/layout/links/viewlets.py

diff --git a/plone/app/layout/links/viewlets.py b/plone/app/layout/links/viewlets.py
index 7d02e10..7d48bf3 100644
--- a/plone/app/layout/links/viewlets.py
+++ b/plone/app/layout/links/viewlets.py
@@ -10,7 +10,6 @@
 from Products.CMFPlone.interfaces.syndication import IFeedSettings
 from Products.CMFPlone.interfaces.syndication import ISiteSyndicationSettings
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
-from six import StringIO
 from zope.component import getMultiAdapter
 from zope.component import getUtility
 from zope.schema.interfaces import IVocabularyFactory
@@ -23,14 +22,11 @@ def get_language(context, request):
 
 
 def render_cachekey(fun, self):
-    key = StringIO()
-    # Include the name of the viewlet as the underlying cache key only
-    # takes the module and function name into account, but not the class
-    print(self.__name__, file=key)
-    print(self.site_url, file=key)
-    print(get_language(aq_inner(self.context), self.request), file=key)
-
-    return key.getvalue()
+    return '\n'.join([
+        self.__name__,
+        self.site_url,
+        get_language(aq_inner(self.context), self.request),
+    ])
 
 
 class FaviconViewlet(ViewletBase):


Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-04-12T10:15:23+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/a4ac27519ba28876867aa05927d146b55314b7a9

restore comment

Files changed:
M plone/app/layout/links/viewlets.py

diff --git a/plone/app/layout/links/viewlets.py b/plone/app/layout/links/viewlets.py
index 7d48bf3..e0fda5b 100644
--- a/plone/app/layout/links/viewlets.py
+++ b/plone/app/layout/links/viewlets.py
@@ -22,6 +22,8 @@ def get_language(context, request):
 
 
 def render_cachekey(fun, self):
+    # Include the name of the viewlet as the underlying cache key only
+    # takes the module and function name into account, but not the class
     return '\n'.join([
         self.__name__,
         self.site_url,


Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-04-12T11:15:46+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/b1cef91b31ca5988cbe6d9817a309ff1ff66c9b8

Merge pull request #143 from plone/python3

fix cachekey generation in py3

Files changed:
M plone/app/layout/links/viewlets.py

diff --git a/plone/app/layout/links/viewlets.py b/plone/app/layout/links/viewlets.py
index 36802a3..e0fda5b 100644
--- a/plone/app/layout/links/viewlets.py
+++ b/plone/app/layout/links/viewlets.py
@@ -10,7 +10,6 @@
 from Products.CMFPlone.interfaces.syndication import IFeedSettings
 from Products.CMFPlone.interfaces.syndication import ISiteSyndicationSettings
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
-from six import StringIO
 from zope.component import getMultiAdapter
 from zope.component import getUtility
 from zope.schema.interfaces import IVocabularyFactory
@@ -23,14 +22,13 @@ def get_language(context, request):
 
 
 def render_cachekey(fun, self):
-    key = StringIO()
     # Include the name of the viewlet as the underlying cache key only
     # takes the module and function name into account, but not the class
-    print >> key, self.__name__
-    print >> key, self.site_url
-    print >> key, get_language(aq_inner(self.context), self.request)
-
-    return key.getvalue()
+    return '\n'.join([
+        self.__name__,
+        self.site_url,
+        get_language(aq_inner(self.context), self.request),
+    ])
 
 
 class FaviconViewlet(ViewletBase):


