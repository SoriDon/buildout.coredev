Repository: plone.volto


Branch: refs/heads/main
Date: 2023-02-09T11:19:22+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.volto/commit/34efa0a3d07790d3134917d91173ed17cb459993

Add fallback to cache-invalidation when migrating to FolderishDocument (Fixes #109)

Files changed:
A news/109.bugfix
M src/plone/volto/browser/migrate_to_volto.py

b'diff --git a/news/109.bugfix b/news/109.bugfix\nnew file mode 100644\nindex 00000000..c2a61e05\n--- /dev/null\n+++ b/news/109.bugfix\n@@ -0,0 +1,2 @@\n+Prevent AttributeError when migrating to FolderishDocument.\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/src/plone/volto/browser/migrate_to_volto.py b/src/plone/volto/browser/migrate_to_volto.py\nindex 86431810..34eb439c 100644\n--- a/src/plone/volto/browser/migrate_to_volto.py\n+++ b/src/plone/volto/browser/migrate_to_volto.py\n@@ -314,7 +314,8 @@ def make_document(obj, slate=True):\n \n     obj.portal_type = "Document"\n     # Invalidate cache to find the behaviors\n-    del obj._v__providedBy__\n+    if getattr(obj, "_v__providedBy__", None) is not None:\n+        del obj._v__providedBy__\n \n     if not obj.blocks:\n         obj.blocks = blocks\n'

Repository: plone.volto


Branch: refs/heads/main
Date: 2023-02-27T09:03:13+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.volto/commit/227bfdde764620052579efa5ec5c9412bd24ba43

Merge pull request #110 from plone/missing_cache_fallback

Files changed:
A news/109.bugfix
M src/plone/volto/browser/migrate_to_volto.py

b'diff --git a/news/109.bugfix b/news/109.bugfix\nnew file mode 100644\nindex 00000000..c2a61e05\n--- /dev/null\n+++ b/news/109.bugfix\n@@ -0,0 +1,2 @@\n+Prevent AttributeError when migrating to FolderishDocument.\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/src/plone/volto/browser/migrate_to_volto.py b/src/plone/volto/browser/migrate_to_volto.py\nindex 86431810..34eb439c 100644\n--- a/src/plone/volto/browser/migrate_to_volto.py\n+++ b/src/plone/volto/browser/migrate_to_volto.py\n@@ -314,7 +314,8 @@ def make_document(obj, slate=True):\n \n     obj.portal_type = "Document"\n     # Invalidate cache to find the behaviors\n-    del obj._v__providedBy__\n+    if getattr(obj, "_v__providedBy__", None) is not None:\n+        del obj._v__providedBy__\n \n     if not obj.blocks:\n         obj.blocks = blocks\n'

