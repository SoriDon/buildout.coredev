Repository: plone.app.event


Branch: refs/heads/master
Date: 2022-12-20T07:53:59+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.event/commit/95a4e3e0ba389da9e45c43b0e733001f56c7e800

fixed doubled first occurrence of recurring event

Files changed:
A news/348.bugfix
M plone/app/event/base.py

b'diff --git a/news/348.bugfix b/news/348.bugfix\nnew file mode 100644\nindex 000000000..2f985f309\n--- /dev/null\n+++ b/news/348.bugfix\n@@ -0,0 +1,2 @@\n+Fix `expand_events` doubling the first occurrence with the original event\n+[petschki]\ndiff --git a/plone/app/event/base.py b/plone/app/event/base.py\nindex 91fef1be1..5da8252b1 100644\n--- a/plone/app/event/base.py\n+++ b/plone/app/event/base.py\n@@ -281,10 +281,9 @@ def expand_events(events, ret_mode, start=None, end=None, sort=None, sort_revers\n     for it in events:\n         obj = it.getObject() if getattr(it, "getObject", False) else it\n         if IEventRecurrence.providedBy(obj):\n-\n             occ_list = list(IRecurrenceSupport(obj).occurrences(start, end))\n             # add original event (to make expand_events not remove one item of the original list)\n-            if (start or end) and (IEventAccessor(obj).start >= (end or start)):\n+            if (start or end) and (obj.start >= (end or start)):\n                 if obj not in occ_list:\n                     occ_list.append(obj)\n             occurrences = [_obj_or_acc(occ, ret_mode) for occ in occ_list]\n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2023-03-25T10:42:43+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.event/commit/788a38883bf2f6cf0fd9d16cc1587f76eb264ebb

Merge pull request #349 from plone/issue-348

Fixes doubled first occurrence of recurring event

Files changed:
A news/348.bugfix
M plone/app/event/base.py

b'diff --git a/news/348.bugfix b/news/348.bugfix\nnew file mode 100644\nindex 000000000..2f985f309\n--- /dev/null\n+++ b/news/348.bugfix\n@@ -0,0 +1,2 @@\n+Fix `expand_events` doubling the first occurrence with the original event\n+[petschki]\ndiff --git a/plone/app/event/base.py b/plone/app/event/base.py\nindex 91fef1be1..5da8252b1 100644\n--- a/plone/app/event/base.py\n+++ b/plone/app/event/base.py\n@@ -281,10 +281,9 @@ def expand_events(events, ret_mode, start=None, end=None, sort=None, sort_revers\n     for it in events:\n         obj = it.getObject() if getattr(it, "getObject", False) else it\n         if IEventRecurrence.providedBy(obj):\n-\n             occ_list = list(IRecurrenceSupport(obj).occurrences(start, end))\n             # add original event (to make expand_events not remove one item of the original list)\n-            if (start or end) and (IEventAccessor(obj).start >= (end or start)):\n+            if (start or end) and (obj.start >= (end or start)):\n                 if obj not in occ_list:\n                     occ_list.append(obj)\n             occurrences = [_obj_or_acc(occ, ret_mode) for occ in occ_list]\n'

