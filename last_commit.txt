Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2022-05-07T00:25:15+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/7ef9dc855a3aa3434ca059febfdb203915858a2c

sort addons by title in addon controlpanel (#3524)

* Fix tests for #3486

* sort addons by title

* Sort case insensitively

Co-authored-by: Philip Bauer &lt;bauer@starzel.de&gt;

Files changed:
A news/3523.feature
M Products/CMFPlone/controlpanel/browser/quickinstaller.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/quickinstaller.py b/Products/CMFPlone/controlpanel/browser/quickinstaller.py\nindex 69b0c2c6ff..3a8b574afb 100644\n--- a/Products/CMFPlone/controlpanel/browser/quickinstaller.py\n+++ b/Products/CMFPlone/controlpanel/browser/quickinstaller.py\n@@ -7,6 +7,7 @@\n from Products.statusmessages.interfaces import IStatusMessage\n from plone.memoize import view\n from zope.component import getAllUtilitiesRegisteredFor\n+from zope.i18n import translate\n import logging\n import pkg_resources\n import transaction\n@@ -487,20 +488,24 @@ def get_addons(self, apply_filter=None, product_name=None):\n \n         return filtered\n \n+    def get_sorted_addon_values(self, apply_filter=None, product_name=None):\n+        values = self.get_addons(apply_filter, product_name).values()\n+        return sorted(values, key=lambda x: translate(x.get(\'title\', \'\'), context=self.request).upper())\n+\n     def get_upgrades(self):\n         """\n         Return a list of products that have upgrades on tap\n         """\n-        return self.get_addons(apply_filter=\'upgrades\').values()\n+        return self.get_sorted_addon_values(apply_filter=\'upgrades\')\n \n     def get_installed(self):\n-        return self.get_addons(apply_filter=\'installed\').values()\n+        return self.get_sorted_addon_values(apply_filter=\'installed\')\n \n     def get_available(self):\n-        return self.get_addons(apply_filter=\'available\').values()\n+        return self.get_sorted_addon_values(apply_filter=\'available\')\n \n     def get_broken(self):\n-        return self.get_addons(apply_filter=\'broken\').values()\n+        return self.get_sorted_addon_values(apply_filter=\'broken\')\n \n \n class UpgradeProductsView(InstallerView):\ndiff --git a/news/3523.feature b/news/3523.feature\nnew file mode 100644\nindex 0000000000..0324e21acb\n--- /dev/null\n+++ b/news/3523.feature\n@@ -0,0 +1,2 @@\n+Sort addons by title\n+[erral]\n'

