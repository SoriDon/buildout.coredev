Repository: plone.app.testing


Branch: refs/heads/master
Date: 2022-04-21T22:12:04+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.testing/commit/65afbe08e8d4c1b3e66aec9d6c266de81f60256a

Load CMFFormController in Plone 5, be silent when this fails in Plone 6.

This restores compatibility with Plone 5.2 for now.
Note that this `plone.app.testing` version is only meant for Python 3.
(Technically I think it may still work on Python 2, but that can change at any moment.)

Files changed:
A news/3467.feature
M setup.py
M src/plone/app/testing/layers.py

b'diff --git a/news/3467.feature b/news/3467.feature\nnew file mode 100644\nindex 0000000..140c6a5\n--- /dev/null\n+++ b/news/3467.feature\n@@ -0,0 +1,4 @@\n+Load CMFFormController in Plone 5, be silent when this fails in Plone 6.\n+This restores compatibility with Plone 5.2 for now.\n+Note that this ``plone.app.testing`` version is only meant for Python 3.\n+[maurits]\ndiff --git a/setup.py b/setup.py\nindex 8842291..c8c5e59 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -51,15 +51,16 @@ def read(*rnames):\n         "Environment :: Web Environment",\n         "Framework :: Plone",\n         "Framework :: Plone :: 5.2",\n+        "Framework :: Plone :: 6.0",\n         "Framework :: Plone :: Core",\n         "Framework :: Zope :: 4",\n         "License :: OSI Approved :: GNU General Public License v2 (GPLv2)",\n         "Operating System :: OS Independent",\n         "Programming Language :: Python",\n-        "Programming Language :: Python :: 2.7",\n         "Programming Language :: Python :: 3.6",\n         "Programming Language :: Python :: 3.7",\n         "Programming Language :: Python :: 3.8",\n+        "Programming Language :: Python :: 3.9",\n         "Topic :: Internet :: WWW/HTTP :: Dynamic Content",\n     ],\n     keywords=\'plone tests\',\ndiff --git a/src/plone/app/testing/layers.py b/src/plone/app/testing/layers.py\nindex 4a94a1e..3628082 100644\n--- a/src/plone/app/testing/layers.py\n+++ b/src/plone/app/testing/layers.py\n@@ -23,6 +23,7 @@\n from zope.component import getSiteManager\n from zope.component import getUtility\n from zope.component.hooks import setSite\n+from zope.dottedname.resolve import resolve\n from zope.event import notify\n from zope.traversing.interfaces import BeforeTraverseEvent\n \n@@ -54,6 +55,8 @@ class PloneFixture(Layer):\n         (\'Products.PluggableAuthService\', {\'loadZCML\': True}, ),\n         (\'Products.PluginRegistry\', {\'loadZCML\': True}, ),\n         (\'Products.PlonePAS\', {\'loadZCML\': True}, ),\n+        # product for Plone 5.2 only, be silent when not available on Plone 6:\n+        (\'Products.CMFFormController\', {\'loadZCML\': True, \'silent\': True}, ),\n         (\'Products.CMFDynamicViewFTI\', {\'loadZCML\': True}, ),\n         (\'Products.CMFPlacefulWorkflow\', {\'loadZCML\': True}, ),\n         (\'Products.MimetypesRegistry\', {\'loadZCML\': True}, ),\n@@ -148,8 +151,6 @@ def setUpZCML(self):\n         # Load dependent products\'s ZCML - Plone doesn\'t specify dependencies\n         # on Products.* packages fully\n \n-        from zope.dottedname.resolve import resolve\n-\n         def loadAll(filename):\n             for p, config in self.products:\n                 if not config[\'loadZCML\']:\n@@ -184,6 +185,12 @@ def setUpProducts(self, app):\n \n         for p, config in self.products:\n             if config.get(\'install\', True):\n+                if config.get(\'silent\'):\n+                    # When product is not available, do not complain or warn.\n+                    try:\n+                        resolve(p)\n+                    except ImportError:\n+                        continue\n                 zope.installProduct(app, p)\n \n     def tearDownProducts(self, app):\n'

Repository: plone.app.testing


Branch: refs/heads/master
Date: 2022-04-26T16:54:07+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.testing/commit/62024e81fc5d981c251e53fef17c4aeb0e134bb7

Merge pull request #77 from plone/maurits-load-cmfformcontroller-silently

Load CMFFormController in Plone 5, be silent when this fails in Plone 6.

Files changed:
A news/3467.feature
M setup.py
M src/plone/app/testing/layers.py

b'diff --git a/news/3467.feature b/news/3467.feature\nnew file mode 100644\nindex 0000000..140c6a5\n--- /dev/null\n+++ b/news/3467.feature\n@@ -0,0 +1,4 @@\n+Load CMFFormController in Plone 5, be silent when this fails in Plone 6.\n+This restores compatibility with Plone 5.2 for now.\n+Note that this ``plone.app.testing`` version is only meant for Python 3.\n+[maurits]\ndiff --git a/setup.py b/setup.py\nindex 8842291..c8c5e59 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -51,15 +51,16 @@ def read(*rnames):\n         "Environment :: Web Environment",\n         "Framework :: Plone",\n         "Framework :: Plone :: 5.2",\n+        "Framework :: Plone :: 6.0",\n         "Framework :: Plone :: Core",\n         "Framework :: Zope :: 4",\n         "License :: OSI Approved :: GNU General Public License v2 (GPLv2)",\n         "Operating System :: OS Independent",\n         "Programming Language :: Python",\n-        "Programming Language :: Python :: 2.7",\n         "Programming Language :: Python :: 3.6",\n         "Programming Language :: Python :: 3.7",\n         "Programming Language :: Python :: 3.8",\n+        "Programming Language :: Python :: 3.9",\n         "Topic :: Internet :: WWW/HTTP :: Dynamic Content",\n     ],\n     keywords=\'plone tests\',\ndiff --git a/src/plone/app/testing/layers.py b/src/plone/app/testing/layers.py\nindex 4a94a1e..3628082 100644\n--- a/src/plone/app/testing/layers.py\n+++ b/src/plone/app/testing/layers.py\n@@ -23,6 +23,7 @@\n from zope.component import getSiteManager\n from zope.component import getUtility\n from zope.component.hooks import setSite\n+from zope.dottedname.resolve import resolve\n from zope.event import notify\n from zope.traversing.interfaces import BeforeTraverseEvent\n \n@@ -54,6 +55,8 @@ class PloneFixture(Layer):\n         (\'Products.PluggableAuthService\', {\'loadZCML\': True}, ),\n         (\'Products.PluginRegistry\', {\'loadZCML\': True}, ),\n         (\'Products.PlonePAS\', {\'loadZCML\': True}, ),\n+        # product for Plone 5.2 only, be silent when not available on Plone 6:\n+        (\'Products.CMFFormController\', {\'loadZCML\': True, \'silent\': True}, ),\n         (\'Products.CMFDynamicViewFTI\', {\'loadZCML\': True}, ),\n         (\'Products.CMFPlacefulWorkflow\', {\'loadZCML\': True}, ),\n         (\'Products.MimetypesRegistry\', {\'loadZCML\': True}, ),\n@@ -148,8 +151,6 @@ def setUpZCML(self):\n         # Load dependent products\'s ZCML - Plone doesn\'t specify dependencies\n         # on Products.* packages fully\n \n-        from zope.dottedname.resolve import resolve\n-\n         def loadAll(filename):\n             for p, config in self.products:\n                 if not config[\'loadZCML\']:\n@@ -184,6 +185,12 @@ def setUpProducts(self, app):\n \n         for p, config in self.products:\n             if config.get(\'install\', True):\n+                if config.get(\'silent\'):\n+                    # When product is not available, do not complain or warn.\n+                    try:\n+                        resolve(p)\n+                    except ImportError:\n+                        continue\n                 zope.installProduct(app, p)\n \n     def tearDownProducts(self, app):\n'

