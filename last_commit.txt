Repository: plone.app.content


Branch: refs/heads/master
Date: 2016-02-19T14:21:25-08:00
Author: Alec Mitchell (alecpm) <alecpm@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/d97dca00521e1558dd61973de19ecff289ac67b4

Add fallback to global vocabulary permission check when permission checker can't be found.

Files changed:
M CHANGES.rst
M plone/app/content/browser/vocabulary.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e010215..3d0d95f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Add fallback to global vocabulary permission check when permission
+  checker can't be found.
+  [alecm]
 
 
 3.0.18 (2016-02-19)
diff --git a/plone/app/content/browser/vocabulary.py b/plone/app/content/browser/vocabulary.py
index 3e19121..4931aa5 100644
--- a/plone/app/content/browser/vocabulary.py
+++ b/plone/app/content/browser/vocabulary.py
@@ -223,8 +223,13 @@ def get_vocabulary(self):
                 if permission_checker is not None:
                     authorized = permission_checker.validate(field_name,
                                                              factory_name)
+                elif sm.checkPermission(_permissions[factory_name], context):
+                    # If no checker, fall back to checking the global registry
+                    authorized = True
+
             if not authorized:
                 raise VocabLookupException('Vocabulary lookup not allowed')
+
         # Short circuit if we are on the site root and permission is
         # in global registry
         elif not sm.checkPermission(_permissions[factory_name], context):


Repository: plone.app.content


Branch: refs/heads/master
Date: 2016-02-22T15:59:33+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/6d4f5097390fdecfbccea2137783483c17340d89

Merge pull request #72 from plone/navroot-fixes

Add fallback to global vocabulary permission check when permission checker can't be found.

Files changed:
M CHANGES.rst
M plone/app/content/browser/vocabulary.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e010215..3d0d95f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Add fallback to global vocabulary permission check when permission
+  checker can't be found.
+  [alecm]
 
 
 3.0.18 (2016-02-19)
diff --git a/plone/app/content/browser/vocabulary.py b/plone/app/content/browser/vocabulary.py
index 3e19121..4931aa5 100644
--- a/plone/app/content/browser/vocabulary.py
+++ b/plone/app/content/browser/vocabulary.py
@@ -223,8 +223,13 @@ def get_vocabulary(self):
                 if permission_checker is not None:
                     authorized = permission_checker.validate(field_name,
                                                              factory_name)
+                elif sm.checkPermission(_permissions[factory_name], context):
+                    # If no checker, fall back to checking the global registry
+                    authorized = True
+
             if not authorized:
                 raise VocabLookupException('Vocabulary lookup not allowed')
+
         # Short circuit if we are on the site root and permission is
         # in global registry
         elif not sm.checkPermission(_permissions[factory_name], context):


