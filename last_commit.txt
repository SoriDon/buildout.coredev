Repository: mockup


Branch: refs/heads/master
Date: 2016-05-01T18:05:36-05:00
Author: nathan.vangheem () <nathan.vangheem@wildcardcorp.com>
Commit: https://github.com/plone/mockup/commit/3e5d3114974a05f10a7403a49f33cf1e5e86d661

Fix positioning of popovers in structure

Files changed:
M CHANGES.rst
M mockup/js/ui/views/popover.js
M mockup/patterns/structure/js/views/generic-popover.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 7f47cb0..e835a76 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -38,6 +38,9 @@ New:
 
 Fixes:
 
+- Fix positioning of popovers in structure
+  [vangheem]
+
 - Fix structure to always default to page 1 of results when moving between breadcrumbs
   [vangheem]
 
diff --git a/mockup/js/ui/views/popover.js b/mockup/js/ui/views/popover.js
index 2a94113..6f27e83 100644
--- a/mockup/js/ui/views/popover.js
+++ b/mockup/js/ui/views/popover.js
@@ -89,6 +89,24 @@ define([
         }
       });
 
+      this.position();
+
+      this.setBackdrop();
+      if (this.useBackdrop === true) {
+        this.backdrop.show();
+      }
+
+      this.opened = true;
+
+      if (this.triggerView) {
+        this.triggerView.$el.addClass('active');
+      }
+
+      this.uiEventTrigger('show', this);
+      this.$el.attr('aria-hidden', 'false');
+    },
+
+    position: function(){
       var pos = this.getPosition();
       var $tip = this.$el, tp, placement, actualWidth, actualHeight;
 
@@ -115,21 +133,8 @@ define([
       }
 
       this.applyPlacement(tp, placement);
-
-      this.setBackdrop();
-      if (this.useBackdrop === true) {
-        this.backdrop.show();
-      }
-
-      this.opened = true;
-
-      if (this.triggerView) {
-        this.triggerView.$el.addClass('active');
-      }
-
-      this.uiEventTrigger('show', this);
-      this.$el.attr('aria-hidden', 'false');
     },
+
     applyPlacement: function(offset, placement) {
       var $el = this.$el,
         $tip = this.$el,
@@ -223,4 +228,3 @@ define([
 
   return PopoverView;
 });
-
diff --git a/mockup/patterns/structure/js/views/generic-popover.js b/mockup/patterns/structure/js/views/generic-popover.js
index ea28bbd..5b577f6 100644
--- a/mockup/patterns/structure/js/views/generic-popover.js
+++ b/mockup/patterns/structure/js/views/generic-popover.js
@@ -85,9 +85,11 @@ define([
           self.content = originalContent;
         }).always(function() {
           self.app.loading.hide();
+          self.position();
         });
       } else {
         registry.scan(self.$el);
+        self.position();
       }
     },
     toggle: function(button, e) {
@@ -97,6 +99,7 @@ define([
         return;
       } else {
         this.$el.replaceWith(this.render().el);
+        this.position();
       }
     }
   });


Repository: mockup


Branch: refs/heads/master
Date: 2016-05-01T18:17:57-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/1dbb50e2156ecccbeb86ddf3bea153d3851c9574

Merge pull request #666 from plone/popover-positioning

Fix positioning of popovers in structure

Files changed:
M CHANGES.rst
M mockup/js/ui/views/popover.js
M mockup/patterns/structure/js/views/generic-popover.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 7f47cb0..e835a76 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -38,6 +38,9 @@ New:
 
 Fixes:
 
+- Fix positioning of popovers in structure
+  [vangheem]
+
 - Fix structure to always default to page 1 of results when moving between breadcrumbs
   [vangheem]
 
diff --git a/mockup/js/ui/views/popover.js b/mockup/js/ui/views/popover.js
index 2a94113..6f27e83 100644
--- a/mockup/js/ui/views/popover.js
+++ b/mockup/js/ui/views/popover.js
@@ -89,6 +89,24 @@ define([
         }
       });
 
+      this.position();
+
+      this.setBackdrop();
+      if (this.useBackdrop === true) {
+        this.backdrop.show();
+      }
+
+      this.opened = true;
+
+      if (this.triggerView) {
+        this.triggerView.$el.addClass('active');
+      }
+
+      this.uiEventTrigger('show', this);
+      this.$el.attr('aria-hidden', 'false');
+    },
+
+    position: function(){
       var pos = this.getPosition();
       var $tip = this.$el, tp, placement, actualWidth, actualHeight;
 
@@ -115,21 +133,8 @@ define([
       }
 
       this.applyPlacement(tp, placement);
-
-      this.setBackdrop();
-      if (this.useBackdrop === true) {
-        this.backdrop.show();
-      }
-
-      this.opened = true;
-
-      if (this.triggerView) {
-        this.triggerView.$el.addClass('active');
-      }
-
-      this.uiEventTrigger('show', this);
-      this.$el.attr('aria-hidden', 'false');
     },
+
     applyPlacement: function(offset, placement) {
       var $el = this.$el,
         $tip = this.$el,
@@ -223,4 +228,3 @@ define([
 
   return PopoverView;
 });
-
diff --git a/mockup/patterns/structure/js/views/generic-popover.js b/mockup/patterns/structure/js/views/generic-popover.js
index ea28bbd..5b577f6 100644
--- a/mockup/patterns/structure/js/views/generic-popover.js
+++ b/mockup/patterns/structure/js/views/generic-popover.js
@@ -85,9 +85,11 @@ define([
           self.content = originalContent;
         }).always(function() {
           self.app.loading.hide();
+          self.position();
         });
       } else {
         registry.scan(self.$el);
+        self.position();
       }
     },
     toggle: function(button, e) {
@@ -97,6 +99,7 @@ define([
         return;
       } else {
         this.$el.replaceWith(this.render().el);
+        this.position();
       }
     }
   });


