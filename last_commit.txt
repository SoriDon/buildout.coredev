Repository: plone.namedfile


Branch: refs/heads/master
Date: 2022-05-17T11:13:16+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.namedfile/commit/2e54b2c949adcdcda8afd57e73898a781224de69

Only look at the width when checking if a HiDPI image would be larger than the original.

Otherwise HiDPI srcsets are never included when the scale is defined with a height of 65536.
Fixes https://github.com/plone/plone.namedfile/issues/114

Files changed:
A news/114.bugfix
M plone/namedfile/scaling.py

b'diff --git a/news/114.bugfix b/news/114.bugfix\nnew file mode 100644\nindex 0000000..a9127a9\n--- /dev/null\n+++ b/news/114.bugfix\n@@ -0,0 +1,3 @@\n+Only look at the width when checking if a HiDPI image would be larger than the original.\n+Otherwise HiDPI srcsets are never included when the scale is defined with a height of 65536.\n+[maurits]\ndiff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py\nindex cf4133a..e8fb860 100644\n--- a/plone/namedfile/scaling.py\n+++ b/plone/namedfile/scaling.py\n@@ -538,9 +538,8 @@ def calculate_srcset(\n         (orig_width, orig_height) = self.getImageSize(fieldname)\n         for hdScale in self.getHighPixelDensityScales():\n             # Don\'t create retina scales larger than the source image.\n-            if (height and orig_height and orig_height < height * hdScale["scale"]) or (\n-                width and orig_width and orig_width < width * hdScale["scale"]\n-            ):\n+            # We only care about the width, because height might be 65536.\n+            if width and orig_width and orig_width < width * hdScale["scale"]:\n                 continue\n             parameters["quality"] = hdScale["quality"]\n             scale_src = storage.scale(\n'

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2022-05-17T22:27:23+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.namedfile/commit/8f910cd1fd15115d32cbc21da121e31e85b6c5aa

Merge pull request #115 from plone/maurits-ignore-height-check-for-hidpi

Only look at width when checking if HiDPI image would be too large

Files changed:
A news/114.bugfix
M plone/namedfile/scaling.py

b'diff --git a/news/114.bugfix b/news/114.bugfix\nnew file mode 100644\nindex 0000000..a9127a9\n--- /dev/null\n+++ b/news/114.bugfix\n@@ -0,0 +1,3 @@\n+Only look at the width when checking if a HiDPI image would be larger than the original.\n+Otherwise HiDPI srcsets are never included when the scale is defined with a height of 65536.\n+[maurits]\ndiff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py\nindex cf4133a..e8fb860 100644\n--- a/plone/namedfile/scaling.py\n+++ b/plone/namedfile/scaling.py\n@@ -538,9 +538,8 @@ def calculate_srcset(\n         (orig_width, orig_height) = self.getImageSize(fieldname)\n         for hdScale in self.getHighPixelDensityScales():\n             # Don\'t create retina scales larger than the source image.\n-            if (height and orig_height and orig_height < height * hdScale["scale"]) or (\n-                width and orig_width and orig_width < width * hdScale["scale"]\n-            ):\n+            # We only care about the width, because height might be 65536.\n+            if width and orig_width and orig_width < width * hdScale["scale"]:\n                 continue\n             parameters["quality"] = hdScale["quality"]\n             scale_src = storage.scale(\n'

