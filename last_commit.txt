Repository: plone.dexterity


Branch: refs/heads/master
Date: 2019-10-01T14:38:51+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.dexterity/commit/b3f8cc6c8317f5ce24559814ad0a2cbc12c11288

Refine pre-filtering of attributes on content __getattr__

Files changed:
A news/116.bugfix
M plone/dexterity/content.py

b"diff --git a/news/116.bugfix b/news/116.bugfix\nnew file mode 100644\nindex 0000000..b062ffc\n--- /dev/null\n+++ b/news/116.bugfix\n@@ -0,0 +1,5 @@\n+Performance enhancement:\n+Refine pre-filtering of attributes on content ``__getattr__``.\n+Filter out all permissions (ending with ``_Permission``) and some portal-tools.\n+Also often called aquired functions are skipped.\n+[jensens]\n\\ No newline at end of file\ndiff --git a/plone/dexterity/content.py b/plone/dexterity/content.py\nindex c177aa6..5e83ad7 100644\n--- a/plone/dexterity/content.py\n+++ b/plone/dexterity/content.py\n@@ -58,10 +58,16 @@\n \n # see comment in DexterityContent.__getattr__ method\n ATTRIBUTE_NAMES_TO_IGNORE = (\n-    '_v__providedBy__',\n-    'im_self',  # python 2 only, on python 3 it was renamed to __self__\n+    '_dav_writelocks',\n     'aq_inner',\n-    '_Access_contents_information_Permission'\n+    'getCurrentSkinName',\n+    'getURL',\n+    'im_self',  # python 2 only, on python 3 it was renamed to __self__\n+    'plone_utils',\n+    'portal_membership',\n+    'portal_placeful_workflow',\n+    'portal_properties',\n+    'translation_service',\n )\n \n \n@@ -340,8 +346,13 @@ def __getattr__(self, name):\n         # defined).\n         # also handle special dynamic providedBy cache here.\n         # Ignore also some other well known names like\n-        # Acquisition and AccessControl related ones.\n-        if name.startswith('__') or name in ATTRIBUTE_NAMES_TO_IGNORE:\n+        # Permission, Acquisition and AccessControl related ones.\n+        if (\n+            name.startswith('__')\n+            or name.startswith('_v')\n+            or name.endswith('_Permission')\n+            or name in ATTRIBUTE_NAMES_TO_IGNORE\n+        ):\n             raise AttributeError(name)\n \n         # attribute was not found; try to look it up in the schema and return\n"

Repository: plone.dexterity


Branch: refs/heads/master
Date: 2019-10-01T16:19:05+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.dexterity/commit/c8d7916ab6cd829c5961e204b25aca29133870d9

Merge pull request #116 from plone/jensens-performance-getattr-prefiltering

Performance: Refine pre-filtering of attributes on content __getattr__

Files changed:
A news/116.bugfix
M plone/dexterity/content.py

b"diff --git a/news/116.bugfix b/news/116.bugfix\nnew file mode 100644\nindex 0000000..b062ffc\n--- /dev/null\n+++ b/news/116.bugfix\n@@ -0,0 +1,5 @@\n+Performance enhancement:\n+Refine pre-filtering of attributes on content ``__getattr__``.\n+Filter out all permissions (ending with ``_Permission``) and some portal-tools.\n+Also often called aquired functions are skipped.\n+[jensens]\n\\ No newline at end of file\ndiff --git a/plone/dexterity/content.py b/plone/dexterity/content.py\nindex c177aa6..5e83ad7 100644\n--- a/plone/dexterity/content.py\n+++ b/plone/dexterity/content.py\n@@ -58,10 +58,16 @@\n \n # see comment in DexterityContent.__getattr__ method\n ATTRIBUTE_NAMES_TO_IGNORE = (\n-    '_v__providedBy__',\n-    'im_self',  # python 2 only, on python 3 it was renamed to __self__\n+    '_dav_writelocks',\n     'aq_inner',\n-    '_Access_contents_information_Permission'\n+    'getCurrentSkinName',\n+    'getURL',\n+    'im_self',  # python 2 only, on python 3 it was renamed to __self__\n+    'plone_utils',\n+    'portal_membership',\n+    'portal_placeful_workflow',\n+    'portal_properties',\n+    'translation_service',\n )\n \n \n@@ -340,8 +346,13 @@ def __getattr__(self, name):\n         # defined).\n         # also handle special dynamic providedBy cache here.\n         # Ignore also some other well known names like\n-        # Acquisition and AccessControl related ones.\n-        if name.startswith('__') or name in ATTRIBUTE_NAMES_TO_IGNORE:\n+        # Permission, Acquisition and AccessControl related ones.\n+        if (\n+            name.startswith('__')\n+            or name.startswith('_v')\n+            or name.endswith('_Permission')\n+            or name in ATTRIBUTE_NAMES_TO_IGNORE\n+        ):\n             raise AttributeError(name)\n \n         # attribute was not found; try to look it up in the schema and return\n"

