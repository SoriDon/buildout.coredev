Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-01-14T20:18:38+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/e325c93093e67449c28c16f1ca3c0bfd0bac7ded

Fixed tests with newer plone.app.discussion.

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testPortalCreation.py
M Products/CMFPlone/tests/testWorkflowTool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 811b256..449e28e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -139,6 +139,8 @@ New features:
 
 Bug fixes:
 
+- Fixed workflow tests for new ``comment_one_state_workflow``.  [maurits]
+
 - Fixed sometimes failing search order tests.  [maurits]
 
 - Load some Products.CMFPlone.patches earlier, instead of in our initialize method.
diff --git a/Products/CMFPlone/tests/testPortalCreation.py b/Products/CMFPlone/tests/testPortalCreation.py
index f493c2e..ea3b84c 100644
--- a/Products/CMFPlone/tests/testPortalCreation.py
+++ b/Products/CMFPlone/tests/testPortalCreation.py
@@ -622,10 +622,10 @@ def testMemberHasViewGroupsPermission(self):
         self.assertTrue(member_has_permission['selected'])
 
     def testDiscussionItemWorkflow(self):
-        # By default the discussion item has the one_state_workflow
+        # By default the discussion item has the comment_one_state_workflow
         self.assertEqual(
             self.workflow.getChainForPortalType('Discussion Item'),
-            ('one_state_workflow',))
+            ('comment_one_state_workflow',))
 
     def testFolderHasFolderListingView(self):
         # Folder type should allow 'folder_listing'
diff --git a/Products/CMFPlone/tests/testWorkflowTool.py b/Products/CMFPlone/tests/testWorkflowTool.py
index 1fdc3cc..64df3c1 100644
--- a/Products/CMFPlone/tests/testWorkflowTool.py
+++ b/Products/CMFPlone/tests/testWorkflowTool.py
@@ -26,6 +26,7 @@ class IDocument(Interface):
     'one_state_workflow': ('published',),
     'plone_workflow': ('pending', 'private', 'published', 'visible',),
     'simple_publication_workflow': ('private', 'published', 'pending',),
+    'comment_one_state_workflow': ('published',),
     'comment_review_workflow': ('pending', 'published',)
 }
 # then we join all states into one master list


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-01-16T16:40:03+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/774dc305a764e7e6fb9f7a398876e15b74903fd9

Merge pull request #1909 from plone/comment-one-state-workflow-51

Fixed tests with newer plone.app.discussion. [5.1]

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testPortalCreation.py
M Products/CMFPlone/tests/testWorkflowTool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 811b256..449e28e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -139,6 +139,8 @@ New features:
 
 Bug fixes:
 
+- Fixed workflow tests for new ``comment_one_state_workflow``.  [maurits]
+
 - Fixed sometimes failing search order tests.  [maurits]
 
 - Load some Products.CMFPlone.patches earlier, instead of in our initialize method.
diff --git a/Products/CMFPlone/tests/testPortalCreation.py b/Products/CMFPlone/tests/testPortalCreation.py
index f493c2e..ea3b84c 100644
--- a/Products/CMFPlone/tests/testPortalCreation.py
+++ b/Products/CMFPlone/tests/testPortalCreation.py
@@ -622,10 +622,10 @@ def testMemberHasViewGroupsPermission(self):
         self.assertTrue(member_has_permission['selected'])
 
     def testDiscussionItemWorkflow(self):
-        # By default the discussion item has the one_state_workflow
+        # By default the discussion item has the comment_one_state_workflow
         self.assertEqual(
             self.workflow.getChainForPortalType('Discussion Item'),
-            ('one_state_workflow',))
+            ('comment_one_state_workflow',))
 
     def testFolderHasFolderListingView(self):
         # Folder type should allow 'folder_listing'
diff --git a/Products/CMFPlone/tests/testWorkflowTool.py b/Products/CMFPlone/tests/testWorkflowTool.py
index 1fdc3cc..64df3c1 100644
--- a/Products/CMFPlone/tests/testWorkflowTool.py
+++ b/Products/CMFPlone/tests/testWorkflowTool.py
@@ -26,6 +26,7 @@ class IDocument(Interface):
     'one_state_workflow': ('published',),
     'plone_workflow': ('pending', 'private', 'published', 'visible',),
     'simple_publication_workflow': ('private', 'published', 'pending',),
+    'comment_one_state_workflow': ('published',),
     'comment_review_workflow': ('pending', 'published',)
 }
 # then we join all states into one master list


