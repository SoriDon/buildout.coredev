Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2017-10-21T23:01:49+02:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/2de92a2ad8b039a2522bcab1bf171241cdbfcedd

avoid faulty acquisition wrapping from CMFCore

Files changed:
M Products/CMFPlone/URLTool.py

diff --git a/Products/CMFPlone/URLTool.py b/Products/CMFPlone/URLTool.py
index 6c2db81ab..fc5bddc62 100644
--- a/Products/CMFPlone/URLTool.py
+++ b/Products/CMFPlone/URLTool.py
@@ -1,5 +1,6 @@
 # -*- coding: utf-8 -*-
 from AccessControl import ClassSecurityInfo
+from Acquisition import aq_parent, aq_inner
 from App.class_init import InitializeClass
 from plone.registry.interfaces import IRegistry
 from posixpath import normpath
@@ -82,6 +83,10 @@ def isURLInPortal(self, url, context=None):
                 return True
         return False
 
+    def getPortalObject(self):
+        # Make sure portal is wrapped properly
+        return aq_parent(aq_inner(self))
+
 
 URLTool.__doc__ = BaseTool.__doc__
 


