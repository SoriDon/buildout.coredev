Repository: plone.app.event


Branch: refs/heads/master
Date: 2023-03-27T13:30:55+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.event/commit/748d36f824bb1000a7b7044ecec87cc3a0b05447

remove obsolete config and script

Files changed:
D build-i18n.sh
D buildout.cfg

b'diff --git a/build-i18n.sh b/build-i18n.sh\ndeleted file mode 100755\nindex 99c3e74c..00000000\n--- a/build-i18n.sh\n+++ /dev/null\n@@ -1,13 +0,0 @@\n-#!/bin/sh\n-# Make sure, i18ndude is in your path.\n-I18NDUDE=i18ndude\n-I18NPATH=plone/app/event\n-DOMAIN=plone.app.event\n-$I18NDUDE rebuild-pot --pot $I18NPATH/locales/$DOMAIN.pot --create $DOMAIN $I18NPATH\n-$I18NDUDE sync --pot $I18NPATH/locales/$DOMAIN.pot $I18NPATH/locales/*/LC_MESSAGES/$DOMAIN.po\n-\n-## Don\'t automatically run the rebuild for the "plone" domain, as it puts too\n-## much message strings into it.\n-#DOMAIN=plone\n-#$I18NDUDE rebuild-pot --pot $I18NPATH/locales/$DOMAIN.pot --merge $I18NPATH/locales/merge-plone.pot --create $DOMAIN $I18NPATH\n-#$I18NDUDE sync --pot $I18NPATH/locales/$DOMAIN.pot $I18NPATH/locales/*/LC_MESSAGES/$DOMAIN.po\ndiff --git a/buildout.cfg b/buildout.cfg\ndeleted file mode 100644\nindex 8d58cd26..00000000\n--- a/buildout.cfg\n+++ /dev/null\n@@ -1,129 +0,0 @@\n-[buildout]\n-extends =\n-    https://raw.githubusercontent.com/plone/buildout.coredev/5.0/versions.cfg\n-parts =\n-    instance\n-# DEV\n-    i18ndude\n-    omelette\n-    zopepy\n-    sphinx\n-    checkversions\n-# TESTING\n-    test\n-    coverage-test\n-    coverage-report\n-    robot\n-\n-auto-checkout =\n-    Products.DateRecurringIndex\n-    icalendar\n-    jquery.recurrenceinput.js\n-    plone.app.event\n-    plone.event\n-    plone.formwidget.recurrence\n-\n-extensions += mr.developer\n-sources-dir = ${buildout:directory}/devsrc\n-develop = .\n-versions = versions\n-\n-# One of: CRITICAL, ERROR, WARNING, INFO, DEBUG, NOTSET\n-log-level = INFO\n-\n-\n-[instance]\n-recipe = plone.recipe.zope2instance\n-user = admin:admin\n-environment-vars = zope_i18n_compile_mo_files true\n-eggs =\n-    Plone\n-    Pillow\n-    plone.app.event\n-# DEVELOPMENT\n-    plone.reload\n-    plone.app.debugtoolbar\n-\n-# DEVELOPMENT\n-\n-[sources]\n-Products.DateRecurringIndex  = git git@github.com:collective/Products.DateRecurringIndex.git\n-icalendar                    = git git@github.com:collective/icalendar.git\n-jquery.recurrenceinput.js    = git git@github.com:collective/jquery.recurrenceinput.js.git egg=false\n-plone.event                  = git git@github.com:plone/plone.event.git\n-plone.formwidget.recurrence  = git git@github.com:plone/plone.formwidget.recurrence.git branch=master\n-# Looks like, `develop = .` doesn\'t work well with mr.developer. So we checkout\n-# plone.app.event to the buildout directory path.\n-plone.app.event = git git@github.com:plone/plone.app.event.git branch=master full-path=${buildout:directory}\n-\n-[i18ndude]\n-unzip = true\n-recipe = zc.recipe.egg\n-eggs = i18ndude\n-\n-[omelette]\n-recipe = collective.recipe.omelette\n-eggs =\n-    ${instance:eggs}\n-    ${test:eggs}\n-    ${robot:eggs}\n-\n-[zopepy]\n-recipe = zc.recipe.egg\n-eggs =\n-    ${instance:eggs}\n-    ${test:eggs}\n-    ${robot:eggs}\n-interpreter = zopepy\n-scripts = zopepy\n-\n-[sphinx]\n-recipe = collective.recipe.sphinxbuilder\n-source = ${buildout:directory}/docs\n-interpreter = ${buildout:directory}/bin/zopepy\n-\n-[checkversions]\n-recipe=zc.recipe.egg\n-eggs=z3c.checkversions [buildout]\n-\n-\n-# TESTING\n-\n-[environment]\n-BUILDOUT_DIR = ${buildout:directory}\n-zope_i18n_compile_mo_files = true\n-\n-[test]\n-recipe = zc.recipe.testrunner\n-defaults = [\'--auto-color\', \'--auto-progress\']\n-eggs =\n-    Products.DateRecurringIndex [test]\n-    icalendar [test]\n-    plone.app.event [test]\n-    plone.event [test]\n-    plone.formwidget.recurrence [test]\n-environment = environment\n-\n-[coverage-test]\n-recipe = zc.recipe.testrunner\n-eggs = ${test:eggs}\n-defaults = [\'--coverage\', \'../../coverage\', \'-v\', \'--auto-progress\']\n-\n-[coverage-report]\n-recipe = zc.recipe.egg\n-eggs = z3c.coverage\n-scripts = coveragereport\n-arguments = (\'coverage\', \'report\')\n-\n-[robot]\n-recipe = zc.recipe.egg\n-eggs =\n-    ${instance:eggs}\n-    plone.app.robotframework [debug]\n-\n-\n-# ALL\n-\n-[versions]\n-setuptools =\n-zc.buildout =\n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2023-03-27T13:31:04+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.event/commit/1343fa0b189b44788c4e641f45f2fcea5863e8e2

add python_requires

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex 0995488d..2bc248b1 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -41,6 +41,7 @@\n     packages=find_packages(),\n     namespace_packages=["plone", "plone.app"],\n     include_package_data=True,\n+    python_requires=">=3.7",\n     zip_safe=False,\n     install_requires=[\n         "setuptools",\n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2023-03-27T13:52:47+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.event/commit/2fc93dc925027a3bf1f136fcacad9df212d3966c

Configuring with plone/meta

Files changed:
A news/e380661b.internal
A tox.ini
M pyproject.toml
M setup.cfg

b'diff --git a/news/e380661b.internal b/news/e380661b.internal\nnew file mode 100644\nindex 00000000..c08f5399\n--- /dev/null\n+++ b/news/e380661b.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615de..9eb73f3c 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,43 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 5032d920..0da8f8fb 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,14 +1,23 @@\n-[check-manifest]\n-ignore =\n-    *.cfg\n-    *.sh\n-\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n \n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 00000000..59995ab7\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,53 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --test-path={toxinidir} -s plone.app.event\n+extras =\n+    test\n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2023-03-27T13:53:38+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.event/commit/8527df9258d8ccd7128e8c1718f10f4e1d37ada4

changed code from plone/meta

Files changed:
M CHANGES.rst
M docs/architectural-overview.rst
M docs/conf.py
M docs/designchoices.rst
M docs/index.rst
M plone/app/event/base.py
M plone/app/event/browser/configure.zcml
M plone/app/event/browser/event_listing.pt
M plone/app/event/browser/event_summary.pt
M plone/app/event/browser/event_view.pt
M plone/app/event/browser/formatted_date.pt
M plone/app/event/browser/formatted_start_date.pt
M plone/app/event/configure.zcml
M plone/app/event/dx/configure.zcml
M plone/app/event/dx/ical.zcml
M plone/app/event/ical/__init__.py
M plone/app/event/ical/configure.zcml
M plone/app/event/ical/exporter.py
M plone/app/event/ical/importer.py
M plone/app/event/portlets/configure.zcml
M plone/app/event/portlets/portlet_calendar.pt
M plone/app/event/portlets/portlet_events.pt
M plone/app/event/portlets/portlet_events.py
M plone/app/event/profiles/default/actions.xml
M plone/app/event/profiles/default/browserlayer.xml
M plone/app/event/profiles/default/controlpanel.xml
M plone/app/event/profiles/default/metadata.xml
M plone/app/event/profiles/default/portlets.xml
M plone/app/event/profiles/default/registry.xml
M plone/app/event/profiles/default/rolemap.xml
M plone/app/event/profiles/default/types.xml
M plone/app/event/profiles/default/types/Collection.xml
M plone/app/event/profiles/default/types/Folder.xml
M plone/app/event/profiles/default/types/Plone_Site.xml
M plone/app/event/profiles/testing/metadata.xml
M plone/app/event/profiles/testing/types.xml
M plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml
M plone/app/event/recurrence.zcml
M plone/app/event/testing.py
M plone/app/event/tests/javascripts/test_event.html
M plone/app/event/tests/qunit/qunit.js
M plone/app/event/tests/test_base_module.py
M plone/app/event/tests/test_dx_behaviors.py
M plone/app/event/tests/test_event_listing.py
M plone/app/event/tests/test_ical_import.py
M plone/app/event/tests/test_icalendar.py
M plone/app/event/tests/test_portlet_events.py
M plone/app/event/tests/test_recurrence.py
M plone/app/event/upgrades/configure.zcml
M plone/app/event/upgrades/upgrades.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex c27c91a8b..f3c7e2604 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -251,7 +251,7 @@ Bug fixes:\n \n - Fixed searchable text indexer to avoid breaking when there is no text.\n   [davisagli]\n-- iCalendar categories are exepected as a comma separated string, not as multiple entries.\n+- iCalendar categories are expected as a comma separated string, not as multiple entries.\n   See https://www.kanzaki.com/docs/ical/categories.html\n   Needs fixed iCalendar >4.0.2\n   [jensens]\n@@ -751,7 +751,7 @@ Fixes:\n   addons (specifically ``collective.venue``) to override it and return a html\n   link to a location object instead. Instead of this hack, which also only\n   works for the location use case, override the necessary templates in your\n-  addons. In case of doubt, simplicity outweight extensibility options.\n+  addons. In case of doubt, simplicity outweigh extensibility options.\n   [thet]\n \n - Change ``adapts`` and ``implements`` to their decorator equivalents\n@@ -1109,7 +1109,7 @@ Fixes:\n \n - For ical exports, remove X-WR-CALNAME, X-WR-CALID and X-WR-CALDESC.\n   X-WR-CALNAME caused Outlook to create a new calendar on every import. These\n-  properties are not neccessary and not specified by RFC5545 anyways.\n+  properties are not necessary and not specified by RFC5545 anyways.\n   Fixes #109, closes #132.\n   [tomgross, thet]\n \n@@ -1218,14 +1218,14 @@ Fixes:\n   installations.\n   [thet]\n \n-- Remove the behaviors plone.app.relationfield.behavior.IRelatedItems adn\n+- Remove the behaviors plone.app.relationfield.behavior.IRelatedItems and\n   plone.app.versioningbehavior.behaviors.IVersionable from the Dexterity\n   example type. We don\'t depend on these packages and won\'t introduce an\n   explicit dependency on it.\n   [thet]\n \n - In portlet calendar and events, don\'t use the search_base directly to\n-  constuct calendar urls. The search base always starts from the Plone site\n+  construct calendar urls. The search base always starts from the Plone site\n   root, which led to wrong urls in Lineage subsites.\n   [thet]\n \n@@ -1270,7 +1270,7 @@ Fixes:\n   [jensens]\n \n - Remove event and calendar portlet assignments on plone.rightcolumn.\n-  Integrators should do assignments themselfes, as they are likely different\n+  Integrators should do assignments themselves, as they are likely different\n   from the standard assignment.\n   [thet]\n \n@@ -1321,10 +1321,10 @@ Fixes:\n   [thet]\n \n - Remove dependency on "persistent" to not use that one over the ZODB bundled\n-  package. "persistent" will become available as seperate package with ZODB 4.\n+  package. "persistent" will become available as separate package with ZODB 4.\n   [thet]\n \n-- Declare mimimum dependency on plone.event 1.0rc1.\n+- Declare minimum dependency on plone.event 1.0rc1.\n   [thet]\n \n - Buildout infrastructure update.\n@@ -1414,7 +1414,7 @@ Please note, the next release will have all deprections removed.\n - Fix compact event edit form layouts and don\'t float the recurrence widget.\n   [thet]\n \n-- Change default listing mode in event_listing and replace "All" with seperate\n+- Change default listing mode in event_listing and replace "All" with separate\n   "Future" and "Past" buttons.\n   [thet]\n \n@@ -1475,7 +1475,7 @@ Please note, the next release will have all deprections removed.\n \n - Let EventAccessor for Archetypes based content type return it\'s values from\n   property accessors instead properties directly. This let\'s return the correct\n-  value when an property get\'s overridden by archetypes.schemaextender.\n+  value when an property gets overridden by archetypes.schemaextender.\n   [thet]\n \n - Deprecate upgrade_step_2 to plone.app.event beta 2, which is likely not\n@@ -1498,7 +1498,7 @@ Please note, the next release will have all deprections removed.\n   Move related cmf_edit tests from Products.CMFPlone to plone.app.event.\n   [thet]\n \n-- Add Event profile definition for ATEvent completly in order to remove it from\n+- Add Event profile definition for ATEvent completely in order to remove it from\n   Products.CMFPlone. ATEvent is installed by ATContentTypes automatically as\n   part of upcoming plone.app.contenttypes merge.\n   [thet]\n@@ -1593,7 +1593,7 @@ Please note, the next release will have all deprections removed.\n   mode to \'day\' if a date was passed.\n   [thet]\n \n-- Backport from plone.app.portlets: Don\'t fail on invalid (ambigous) date\n+- Backport from plone.app.portlets: Don\'t fail on invalid (ambiguous) date\n   information in request (Commit a322676 on plone.app.portlets).\n   [tomgross]\n \n@@ -1720,7 +1720,7 @@ Please note, the next release will have all deprections removed.\n \n   - date_speller to format a date in a readable manner,\n \n-  - start_end_from_mode to return start and end date accordin to a mode string\n+  - start_end_from_mode to return start and end date according to a mode string\n     (today, past, future, etc.),\n \n   - dt_start_of_day and dt_end_of_day to set a date to the start of the day\ndiff --git a/docs/architectural-overview.rst b/docs/architectural-overview.rst\nindex 0ca5b828e..5635d3025 100644\n--- a/docs/architectural-overview.rst\n+++ b/docs/architectural-overview.rst\n@@ -6,11 +6,11 @@ Design goals\n \n The development of plone.app.event was done with following design goals in mind:\n \n-  [a] Encapsulation and independence: All event related code should reside in a seperate package (splitted into other packages, where appropriate). Plone should be least dependend on plone.app.event. Best would be that one can deinstall this feature completly.\n+  [a] Encapsulation and independence: All event related code should reside in a separate package (split into other packages, where appropriate). Plone should be least depend on plone.app.event. Best would be that one can deinstall this feature completely.\n \n   [b] Dexterity support: plone.app.event should provide Dexterity behaviors, which can be used in Dexterity type.\n \n-  [c] Standards compliancy: the iCalendar / `RFC5545 <http://tools.ietf.org/html/rfc5545>`_ standard is wonderful flexible, so plone.app.event should provide support for it by allowing ical exports. This is also available for the current ATContentType based implementation, but plone.app.event aims to improve it. A future goal is to support CalDAV also.\n+  [c] Standards compliance: the iCalendar / `RFC5545 <http://tools.ietf.org/html/rfc5545>`_ standard is wonderful flexible, so plone.app.event should provide support for it by allowing ical exports. This is also available for the current ATContentType based implementation, but plone.app.event aims to improve it. A future goal is to support CalDAV also.\n \n   [d] Recurring events support based on the RFC5545 standard.\n \n@@ -20,7 +20,7 @@ The development of plone.app.event was done with following design goals in mind:\n \n   [g] Timezone support.\n \n-Encapsulation and independence: plone.app.event provides the Dexterity behaviors.  The calendar and event portlets were moved from plone.app.portlets into plone.app.event, where they belong semantically - thus improving encapsulation and independence and reducing interwoven dependencies.  The calendar portlet was completly refactored. The functionality of the CalendarTool (portal_calendar) was reimplenented. Important settings from the calendar-controlpanel are now available in the event configlet. Since the calendar portlet was the only consumer of the CalendarTool, the CalendarTool, the calendar controlpanel and the dependency to Products.CMFCalendar can be dropped. The new plone.app.widgets package implements z3cform based widgets, so the old datetime widget can be dropped. Python-dateutil provides recurrence calculations based on the RFC5545 standard - plone.formwidget.recurrence provides a awidget for recurrence and Products.DateRecurringIndex an appropriate index as a drop-in replacement for Zope\'s DateIndex. The iCalendar package was improved and is now used for plone.app.event to provide icalendar serialization. The timezone support is based on the pytz package. Plone now haves a portal timezone, User timezones and every event can define another timezone, if wished. User timezones are planned. Whole day events get their starttime set to 0:00 and endtime set to 23:59:59 - thats should be feasable in most cases (excluding any scientific events...).\n+Encapsulation and independence: plone.app.event provides the Dexterity behaviors.  The calendar and event portlets were moved from plone.app.portlets into plone.app.event, where they belong semantically - thus improving encapsulation and independence and reducing interwoven dependencies.  The calendar portlet was completely refactored. The functionality of the CalendarTool (portal_calendar) was reimplenented. Important settings from the calendar-controlpanel are now available in the event configlet. Since the calendar portlet was the only consumer of the CalendarTool, the CalendarTool, the calendar controlpanel and the dependency to Products.CMFCalendar can be dropped. The new plone.app.widgets package implements z3cform based widgets, so the old datetime widget can be dropped. Python-dateutil provides recurrence calculations based on the RFC5545 standard - plone.formwidget.recurrence provides a awidget for recurrence and Products.DateRecurringIndex an appropriate index as a drop-in replacement for Zope\'s DateIndex. The iCalendar package was improved and is now used for plone.app.event to provide icalendar serialization. The timezone support is based on the pytz package. Plone now haves a portal timezone, User timezones and every event can define another timezone, if wished. User timezones are planned. Whole day events get their starttime set to 0:00 and endtime set to 23:59:59 - that\'s should be feasible in most cases (excluding any scientific events...).\n \n \n Packages\n@@ -36,7 +36,7 @@ The "dx" submodule provides Dexterity behaviors (some granular ones). Like in th\n \n Both subpackages are only loaded, if the neccassary features are installed.\n \n-plone.app.event does not depend on CMFCalendar and the portal_calendar tool any more. Plone core\'s only consumer of this package was the calendar portlet anyways, which was completly rewritten.\n+plone.app.event does not depend on CMFCalendar and the portal_calendar tool any more. Plone core\'s only consumer of this package was the calendar portlet anyways, which was completely rewritten.\n \n base.py provides some basic event related functionality. Many of them need a context in order to get the correct timezone.\n \n@@ -72,7 +72,7 @@ Products.DateRecurringIndex\n \n Github: https://github.com/collective/Products.DateRecurringIndex\n \n-A drop-in replacement for Zope\'s DateIndex with support for recurring events.  Each recurrence get\'s an index entry.\n+A drop-in replacement for Zope\'s DateIndex with support for recurring events.  Each recurrence gets an index entry.\n \n \n icalendar\ndiff --git a/docs/conf.py b/docs/conf.py\nindex 754e531f5..b5d4d3368 100644\n--- a/docs/conf.py\n+++ b/docs/conf.py\n@@ -14,7 +14,7 @@\n \n language = "en"\n \n-from pkg_resources import get_distribution\n+from pkg_resources import get_distribution  # noqa: E402\n \n \n version = release = get_distribution(project).version\ndiff --git a/docs/designchoices.rst b/docs/designchoices.rst\nindex f1aede8c3..255188425 100644\n--- a/docs/designchoices.rst\n+++ b/docs/designchoices.rst\n@@ -19,6 +19,6 @@ Development design choices\n \n - We identified two major use-cases: 1) The event happens at a physical location, i.e. a project meeting happens in Madrid with participant traveling to Madrid weekly on monday at 9:00am.  2) A phone conference of an international organisation with participants from all over the world happens every work day at 10:00 am.\n \n-  In both cases we create the event with the date with a given timezone. So for use-case (1) the editor sits in Taipeh but edits a conference in Madrid, so she has to set the timezone of the event in the form. At display time usally the viewer is interested to see the local time of the conference in the output, so display should be in Europe/Madrid timezone.\n+  In both cases we create the event with the date with a given timezone. So for use-case (1) the editor sits in Taipeh but edits a conference in Madrid, so she has to set the timezone of the event in the form. At display time usually the viewer is interested to see the local time of the conference in the output, so display should be in Europe/Madrid timezone.\n \n-  In use-case (2) the editor usally refers to his own local timezone. He will keep the preset in the form. At display time the viewer is interested to see the date and time in his local timezone. On change of daylight-saving time in the original timezone the datetime was entered stays on 10:00am.  But if the participant in a other timezone has not this change it means he has the call scheduled one hour earlier or later in summer or winter time. So DST makes things again difficult, but heres no way to get rid of it as long as theres the concept of daylightsaving time is handled differently all over the world.\n+  In use-case (2) the editor usually refers to his own local timezone. He will keep the preset in the form. At display time the viewer is interested to see the date and time in his local timezone. On change of daylight-saving time in the original timezone the datetime was entered stays on 10:00am.  But if the participant in a other timezone has not this change it means he has the call scheduled one hour earlier or later in summer or winter time. So DST makes things again difficult, but heres no way to get rid of it as long as there\'s the concept of daylightsaving time is handled differently all over the world.\ndiff --git a/docs/index.rst b/docs/index.rst\nindex 98f2b4e89..f100ba03e 100644\n--- a/docs/index.rst\n+++ b/docs/index.rst\n@@ -21,11 +21,11 @@ plone.app.event - a calendar framework for Plone\n \n     It was developed with these goals in mind:\n \n-    - Encapsulation and independence: All event related code should reside in a single package. Relevant, re-usable functionality is split to seperate packages.  Plone\'s dependencies on calendar related code should be reduced to a minimum. plone.app.event should be able to be deinstalled from Plone.\n+    - Encapsulation and independence: All event related code should reside in a single package. Relevant, re-usable functionality is split to separate packages.  Plone\'s dependencies on calendar related code should be reduced to a minimum. plone.app.event should be able to be deinstalled from Plone.\n \n     - Dexterity and Archetypes support: plone.app.event should provide Dexterity behaviors, which can be used in Dexterity types and an ATEvent content type (factored out from ATContentTypes). For a Dexterity event type, use plone.app.contenttypes 1.1 or newer.\n \n-    - Standards compliancy: We support the icalendar standard (`RFC5545 <http://tools.ietf.org/html/rfc5545>`_) including recurrence.\n+    - Standards compliance: We support the icalendar standard (`RFC5545 <http://tools.ietf.org/html/rfc5545>`_) including recurrence.\n \n     - Recurring events based on the RFC5545 standard.\n \ndiff --git a/plone/app/event/base.py b/plone/app/event/base.py\nindex 5da8252b1..fb3989bf1 100644\n--- a/plone/app/event/base.py\n+++ b/plone/app/event/base.py\n@@ -375,7 +375,7 @@ def _add_to_cal(cal_data, event, date):\n \n             # avoid long loops\n             if start and end_date < start:\n-                break  # if the date is completly outside the range\n+                break  # if the date is completely outside the range\n             if start and next_start_date < start:\n                 continue  # if start_date is outside but end reaches into range\n             if end and next_start_date > end:\n@@ -566,7 +566,7 @@ def DT(dt, exact=False):\n \n     :param dt: Python datetime, Python date, Zope DateTime instance or string.\n     :param exact: If True, the resolution goes down to microseconds. If False,\n-                  the resolution are seconds. Defaul is False.\n+                  the resolution are seconds. Default is False.\n     :type exact: Boolean\n     :returns: Zope DateTime\n     :rtype: Zope DateTime\n@@ -612,7 +612,7 @@ def guess_date_from(datestr, context=None):\n     """Returns a timezone aware date object if an arbitrary ASCII string is\n     formatted in an ISO date format, otherwise None is returned.\n \n-    Used for traversing and Occurence ids.\n+    Used for traversing and Occurrence ids.\n \n     :param datestr: Date string in an ISO format.\n     :type datestr: string\n@@ -964,7 +964,7 @@ def find_context(context, viewname=None, iface=None, as_url=False, append_view=T\n                         as_url, append the viewname to the url, if the context\n                         hasn\'t configured it as defaultView. Otherwise ignore\n                         this parameter.\n-    :returns: A context with the given view name, inteface or ISite root.\n+    :returns: A context with the given view name, interface or ISite root.\n     """\n     context = aq_inner(context)\n     ret = None\n@@ -1014,7 +1014,7 @@ def find_event_listing(context, as_url=False):\n # Workaround for buggy strftime with timezone handling in DateTime.\n # See: https://github.com/plone/plone.app.event/pull/47\n # TODO: should land in CMFPlone or fixed in DateTime.\n-_strftime = lambda v, fmt: pydt(v).strftime(fmt)\n+_strftime = lambda v, fmt: pydt(v).strftime(fmt)  # noqa: E731\n \n \n class PatchedDateTime(DateTime):\ndiff --git a/plone/app/event/browser/configure.zcml b/plone/app/event/browser/configure.zcml\nindex 27531808a..ea49f92b7 100644\n--- a/plone/app/event/browser/configure.zcml\n+++ b/plone/app/event/browser/configure.zcml\n@@ -3,115 +3,117 @@\n     xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:plone="http://namespaces.plone.org/plone"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <plone:static\n-        name="plone.app.event"\n-        type="plone"\n-        directory="resources"\n-        />\n+  <plone:static\n+      directory="resources"\n+      name="plone.app.event"\n+      type="plone"\n+      />\n \n-    <!-- Event listing -->\n-    <browser:page\n-        for="plone.event.interfaces.IEvent"\n-        name="event_listing"\n-        class=".event_listing.EventEventListing"\n-        template="event_listing.pt"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        menu="plone_displayviews"\n-        title="Event listing"\n-        />\n-    <browser:page\n-        for="*"\n-        name="event_listing"\n-        class=".event_listing.EventListing"\n-        template="event_listing.pt"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        menu="plone_displayviews"\n-        title="Event listing"\n-        />\n-    <browser:page\n-        for="*"\n-        name="event_listing_ical"\n-        class=".event_listing.EventListingIcal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <!-- Event listing -->\n+  <browser:page\n+      name="event_listing"\n+      for="plone.event.interfaces.IEvent"\n+      class=".event_listing.EventEventListing"\n+      template="event_listing.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      menu="plone_displayviews"\n+      title="Event listing"\n+      />\n+  <browser:page\n+      name="event_listing"\n+      for="*"\n+      class=".event_listing.EventListing"\n+      template="event_listing.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      menu="plone_displayviews"\n+      title="Event listing"\n+      />\n+  <browser:page\n+      name="event_listing_ical"\n+      for="*"\n+      class=".event_listing.EventListingIcal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n-    <!-- Event view -->\n-    <browser:page\n-        for="plone.event.interfaces.IEvent"\n-        name="event_view"\n-        class=".event_view.EventView"\n-        template="event_view.pt"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <!-- Event view -->\n+  <browser:page\n+      name="event_view"\n+      for="plone.event.interfaces.IEvent"\n+      class=".event_view.EventView"\n+      template="event_view.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n-    <browser:page\n-        for="plone.event.interfaces.IOccurrence"\n-        name="event_view"\n-        class=".event_view.EventView"\n-        template="event_view.pt"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <browser:page\n+      name="event_view"\n+      for="plone.event.interfaces.IOccurrence"\n+      class=".event_view.EventView"\n+      template="event_view.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n-    <browser:defaultView\n-        for="plone.event.interfaces.IOccurrence"\n-        name="event_view"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <browser:defaultView\n+      name="event_view"\n+      for="plone.event.interfaces.IOccurrence"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n-    <browser:page\n-        for="plone.event.interfaces.IEvent"\n-        name="event_summary"\n-        class=".event_summary.EventSummaryView"\n-        template="event_summary.pt"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <browser:page\n+      name="event_summary"\n+      for="plone.event.interfaces.IEvent"\n+      class=".event_summary.EventSummaryView"\n+      template="event_summary.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="event_summary"\n+      for="plone.event.interfaces.IOccurrence"\n+      class=".event_summary.EventSummaryView"\n+      template="event_summary.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n-    <browser:page\n+  <configure\n+      package="plone.app.contenttypes.behaviors"\n+      zcml:condition="installed plone.app.contenttypes"\n+      >\n+    <browser:viewlet\n+        name="contentleadimage"\n         for="plone.event.interfaces.IOccurrence"\n-        name="event_summary"\n-        class=".event_summary.EventSummaryView"\n-        template="event_summary.pt"\n+        manager="plone.app.layout.viewlets.interfaces.IAboveContentTitle"\n+        class="plone.app.event.browser.leadimage_viewlet.LeadImageViewlet"\n+        template="leadimage.pt"\n         permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n         />\n+  </configure>\n \n-    <configure\n-        zcml:condition="installed plone.app.contenttypes"\n-        package="plone.app.contenttypes.behaviors">\n-      <browser:viewlet\n-          name="contentleadimage"\n-          for="plone.event.interfaces.IOccurrence"\n-          class="plone.app.event.browser.leadimage_viewlet.LeadImageViewlet"\n-          manager="plone.app.layout.viewlets.interfaces.IAboveContentTitle"\n-          template="leadimage.pt"\n-          permission="zope2.View"\n-          />\n-    </configure>\n+  <adapter\n+      factory=".formatted_date.FormattedDateProvider"\n+      provides="zope.contentprovider.interfaces.IContentProvider"\n+      for="zope.interface.Interface\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           zope.publisher.interfaces.browser.IBrowserView"\n+      name="formatted_date"\n+      />\n \n-    <adapter\n-        name="formatted_date"\n-        provides="zope.contentprovider.interfaces.IContentProvider"\n-        for="zope.interface.Interface\n-             zope.publisher.interfaces.browser.IBrowserRequest\n-             zope.publisher.interfaces.browser.IBrowserView"\n-        factory=".formatted_date.FormattedDateProvider"\n-        />\n-\n-    <adapter\n-        name="formatted_date"\n-        provides="zope.contentprovider.interfaces.IContentProvider"\n-        for="zope.interface.Interface\n-             zope.publisher.interfaces.browser.IBrowserRequest\n-             plone.portlets.interfaces.IPortletRenderer"\n-        factory=".formatted_date.FormattedStartDateProvider"\n-        />\n+  <adapter\n+      factory=".formatted_date.FormattedStartDateProvider"\n+      provides="zope.contentprovider.interfaces.IContentProvider"\n+      for="zope.interface.Interface\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           plone.portlets.interfaces.IPortletRenderer"\n+      name="formatted_date"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/browser/event_listing.pt b/plone/app/event/browser/event_listing.pt\nindex d9ae03141..e66e25e9c 100644\n--- a/plone/app/event/browser/event_listing.pt\n+++ b/plone/app/event/browser/event_listing.pt\n@@ -1,134 +1,151 @@\n-<html\n-    xmlns="http://www.w3.org/1999/xhtml"\n-    xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n   <body>\n \n-    <metal:custom_title\n-        fill-slot="content-title"\n-        tal:define="header view/header_string">\n+    <metal:custom_title fill-slot="content-title"\n+                        tal:define="\n+                          header view/header_string;\n+                        "\n+    >\n       <h1 class="documentFirstHeading">\n-        <span\n-            tal:replace="header/main"\n-            tal:condition="header/main" />\n+        <span tal:condition="header/main"\n+              tal:replace="header/main"\n+        ></span>\n       </h1>\n-      <nav tal:define="mode request/mode|string:future; show_filter view/show_filter">\n+      <nav tal:define="\n+             mode request/mode|string:future;\n+             show_filter view/show_filter;\n+           ">\n         <ul class="mode_selector nav justify-content-end">\n           <tal:cond condition="show_filter">\n-            <li\n-                class="nav-item"\n-                tal:condition="python:mode==\'past\'">\n-              <a\n-                  class="mode_future nav-link"\n-                  href=""\n-                  tal:attributes="href view/mode_future_url"\n-                  i18n:translate="mode_future_link">Upcoming</a>\n+            <li class="nav-item"\n+                tal:condition="python:mode==\'past\'"\n+            >\n+              <a class="mode_future nav-link"\n+                 href=""\n+                 tal:attributes="\n+                   href view/mode_future_url;\n+                 "\n+                 i18n:translate="mode_future_link"\n+              >Upcoming</a>\n             </li>\n-            <li\n-                class="nav-item"\n-                tal:condition="python:mode==\'future\'">\n-              <a\n-                  class="mode_past nav-link"\n-                  href=""\n-                  tal:attributes="href view/mode_past_url"\n-                  i18n:translate="mode_past_link">Past</a>\n+            <li class="nav-item"\n+                tal:condition="python:mode==\'future\'"\n+            >\n+              <a class="mode_past nav-link"\n+                 href=""\n+                 tal:attributes="\n+                   href view/mode_past_url;\n+                 "\n+                 i18n:translate="mode_past_link"\n+              >Past</a>\n             </li>\n           </tal:cond>\n           <li class="nav-item">\n-            <a\n-                class="mode_ical nav-link"\n-                href=""\n-                tal:attributes="href view/ical_url"\n-                title="Download this event in iCal format"\n-                i18n:attributes="title title_add_to_ical;">\n+            <a class="mode_ical nav-link"\n+               href=""\n+               title="Download this event in iCal format"\n+               tal:attributes="\n+                 href view/ical_url;\n+               "\n+               i18n:attributes="title title_add_to_ical;"\n+            >\n               <span i18n:translate="label_add_to_ical">iCal</span>\n             </a>\n \n           </li>\n         </ul>\n       </nav>\n-      <h2\n+      <h2 tal:condition="header/sub"\n           tal:content="header/sub"\n-          tal:condition="header/sub" />\n+      ></h2>\n     </metal:custom_title>\n \n     <metal:content-core fill-slot="content-core">\n       <metal:block define-macro="content-core">\n-        <tal:def define="batch view/events;\n-                 toLocalizedTime nocall: context/@@plone/toLocalizedTime;">\n+        <tal:def define="\n+                   batch view/events;\n+                   toLocalizedTime nocall: context/@@plone/toLocalizedTime;\n+                 ">\n \n           <section>\n \n             <tal:items repeat="data batch">\n \n-              <article\n-                  itemscope\n-                  itemtype="https://schema.org/Event"\n-                  class="vevent tileItem d-flex align-items-start mb-3"\n-                  tal:define="startf python:view.date_speller(data.start)">\n+              <article class="vevent tileItem d-flex align-items-start mb-3"\n+                       itemscope\n+                       itemtype="https://schema.org/Event"\n+                       tal:define="\n+                         startf python:view.date_speller(data.start);\n+                       "\n+              >\n \n                 <ul class="hiddenStructure">\n-                  <li\n+                  <li class="dtstart"\n                       itemprop="startDate"\n-                      class="dtstart"\n-                      tal:content="data/start/isoformat">end</li>\n-                  <li\n+                      tal:content="data/start/isoformat"\n+                  >end</li>\n+                  <li class="dtend"\n                       itemprop="endDate"\n-                      class="dtend"\n-                      tal:content="data/end/isoformat">end</li>\n-                  <li\n-                      class="location"\n-                      itemscope\n+                      tal:content="data/end/isoformat"\n+                  >end</li>\n+                  <li class="location"\n                       itemprop="location"\n-                      itemtype="http://schema.org/Place">\n-                    <span\n-                        itemprop="address"\n-                        tal:content="data/location">location</span>\n+                      itemscope\n+                      itemtype="http://schema.org/Place"\n+                  >\n+                    <span itemprop="address"\n+                          tal:content="data/location"\n+                    >location</span>\n                   </li>\n                 </ul>\n \n                 <div class="cal_date card me-3 flex-shrink-0 text-center">\n-                  <div\n-                      class="cal_month card-header p-2"\n-                      tal:content="string:${startf/month_name}">Oct.\n+                  <div class="cal_month card-header p-2"\n+                       tal:content="string:${startf/month_name}"\n+                  >Oct.\n                   </div>\n                   <div class="card-body d-flex flex-column p-2">\n-                    <h3\n-                        class="cal_day card-title fs-1 m-0"\n-                        tal:content="string:${startf/day}">15</h3>\n-                    <span\n-                        class="cal_wkday card-text"\n-                        tal:content="python:startf[\'wkday_name\']">Tue</span>\n+                    <h3 class="cal_day card-title fs-1 m-0"\n+                        tal:content="string:${startf/day}"\n+                    >15</h3>\n+                    <span class="cal_wkday card-text"\n+                          tal:content="python:startf[\'wkday_name\']"\n+                    >Tue</span>\n                   </div>\n                 </div>\n \n                 <div class="cal_info clearfix">\n                   <h2 class="tileHeadline">\n-                    <a\n-                        href=""\n-                        itemprop="url"\n-                        class="url"\n-                        tal:attributes="href data/url">\n-                      <span\n-                          itemprop="name"\n-                          class="summary"\n-                          tal:content="data/title">Title</span>\n+                    <a class="url"\n+                       href=""\n+                       itemprop="url"\n+                       tal:attributes="\n+                         href data/url;\n+                       "\n+                    >\n+                      <span class="summary"\n+                            itemprop="name"\n+                            tal:content="data/title"\n+                      >Title</span>\n                     </a>\n                   </h2>\n                   <div class="documentByLine">\n                     <tal:date tal:replace="structure python:view.formatted_date(data)" />\n                   </div>\n \n-                  <p\n-                      itemprop="description"\n-                      class="description"\n-                      tal:condition="data/description"\n-                      tal:content="data/description" />\n+                  <p class="description"\n+                     itemprop="description"\n+                     tal:condition="data/description"\n+                     tal:content="data/description"\n+                  ></p>\n \n \n                 </div>\n@@ -139,7 +156,7 @@\n \n           </section>\n \n-          <div metal:use-macro="context/batch_macros/macros/navigation" />\n+          <div metal:use-macro="context/batch_macros/macros/navigation"></div>\n \n         </tal:def>\n       </metal:block>\ndiff --git a/plone/app/event/browser/event_summary.pt b/plone/app/event/browser/event_summary.pt\nindex 10ccf499b..be49b0daa 100644\n--- a/plone/app/event/browser/event_summary.pt\n+++ b/plone/app/event/browser/event_summary.pt\n@@ -1,24 +1,29 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n+      xml:lang="en"\n+      tal:omit-tag=""\n       i18n:domain="plone"\n-      tal:omit-tag="">\n+>\n \n   <div class="card event-summary">\n     <div class="card-body pb-1"\n-         tal:define="portal_url context/@@plone_portal_state/portal_url;\n-                     data python:view.data;\n-                     start_tzname data/timezone;\n-                     start_utcdelta python:data.start.tzinfo.utcoffset(data.start);\n-                     start_utcoffset python:(start_utcdelta.days*86400+start_utcdelta.seconds)*100/60/60;\n-                     start_utcoffset python:int(start_utcoffset);\n-                     excludes view/excludes;\n-                     next_occs view/next_occurrences;\n-                     has_occs view/has_occurrences;\n-                     num_more_occs view/num_more_occurrences;\n-                     icons python:context.restrictedTraverse(\'@@iconresolver\')">\n+         tal:define="\n+           portal_url context/@@plone_portal_state/portal_url;\n+           data python:view.data;\n+           start_tzname data/timezone;\n+           start_utcdelta python:data.start.tzinfo.utcoffset(data.start);\n+           start_utcoffset python:(start_utcdelta.days*86400+start_utcdelta.seconds)*100/60/60;\n+           start_utcoffset python:int(start_utcoffset);\n+           excludes view/excludes;\n+           next_occs view/next_occurrences;\n+           has_occs view/has_occurrences;\n+           num_more_occs view/num_more_occurrences;\n+           icons python:context.restrictedTraverse(\'@@iconresolver\');\n+         "\n+    >\n \n       <div class="row">\n         <div class="col event-when">\n@@ -27,14 +32,18 @@\n               <tal:icon replace="structure python:icons.tag(\'calendar\', tag_class=\'icon-inline\')" />\n             </div>\n             <div>\n-              <strong class="meta-label" i18n:translate="event_when">When</strong>\n+              <strong class="meta-label"\n+                      i18n:translate="event_when"\n+              >When</strong>\n               <p class="card-text h5">\n                 <span>\n                   <tal:date replace="structure python:view.formatted_date(context)" />\n                 </span>\n                 <span class="timezone text-muted small"\n-                      tal:condition="start_tzname">\n-                  (<tal:tzname replace="start_tzname">timezone name</tal:tzname> / UTC<tal:tzoffset replace="start_utcoffset" />)\n+                      tal:condition="start_tzname"\n+                >\n+                  (<tal:tzname replace="start_tzname">timezone name</tal:tzname>\n+                  / UTC<tal:tzoffset replace="start_utcoffset" />)\n                 </span>\n               </p>\n             </div>\n@@ -44,118 +53,193 @@\n \n       <div class="row ${python:has_occs and \'row-cols-1 row-cols-md-2\' or \'\'}">\n         <tal:cond condition="python:\'occurrences\' not in excludes and has_occs">\n-        <div class="col event-occurences">\n-          <div class="mb-3">\n-            <div class="d-flex">\n-              <div class="meta-icon">\n-                <tal:icon replace="structure python:icons.tag(\'calendar-week\', tag_class=\'icon-inline\')" />\n-              </div>\n-              <div class="event-all-dates">\n-                <strong class="meta-label" i18n:translate="">\n+          <div class="col event-occurences">\n+            <div class="mb-3">\n+              <div class="d-flex">\n+                <div class="meta-icon">\n+                  <tal:icon replace="structure python:icons.tag(\'calendar-week\', tag_class=\'icon-inline\')" />\n+                </div>\n+                <div class="event-all-dates">\n+                  <strong class="meta-label"\n+                          i18n:translate=""\n+                  >\n                   All dates\n-                </strong>\n-                <p class="card-text">\n-                  <span tal:repeat="occ next_occs">\n-                    <tal:def define="this_is_occ python: occ.absolute_url() == context.absolute_url()">\n-                    <a tal:attributes="href occ/absolute_url" tal:omit-tag="this_is_occ">\n-                      <strong tal:omit-tag="not: this_is_occ">\n-                        <tal:date replace="structure python:view.formatted_date(occ)"/>\n-                      </strong>\n-                    </a>\n-                    </tal:def>\n-                    <br />\n-                  </span>\n-                  <span tal:condition="num_more_occs">\n-                    <a tal:attributes="href string:${view/event_context/absolute_url}/@@event_listing"\n-                        tal:content="view/more_occurrences_text">\n+                  </strong>\n+                  <p class="card-text">\n+                    <span tal:repeat="occ next_occs">\n+                      <tal:def define="\n+                                 this_is_occ python: occ.absolute_url() == context.absolute_url();\n+                               ">\n+                        <a tal:omit-tag="this_is_occ"\n+                           tal:attributes="\n+                             href occ/absolute_url;\n+                           "\n+                        >\n+                          <strong tal:omit-tag="not: this_is_occ">\n+                            <tal:date replace="structure python:view.formatted_date(occ)" />\n+                          </strong>\n+                        </a>\n+                      </tal:def>\n+                      <br />\n+                    </span>\n+                    <span tal:condition="num_more_occs">\n+                      <a tal:content="view/more_occurrences_text"\n+                         tal:attributes="\n+                           href string:${view/event_context/absolute_url}/@@event_listing;\n+                         "\n+                      >\n                       There are 12 more occurrences.\n-                    </a>\n-                  </span>\n-                </p>\n+                      </a>\n+                    </span>\n+                  </p>\n+                </div>\n               </div>\n             </div>\n           </div>\n-        </div>\n         </tal:cond>\n \n-        <div class="row col ${python:len(next_occs) > 1 and \'row-cols-1 row-cols-md-1\' or \'row-cols-1 row-cols-md-2\'}">\n+        <div class="row col ${python:len(next_occs) &gt; 1 and \'row-cols-1 row-cols-md-1\' or \'row-cols-1 row-cols-md-2\'}">\n \n-          <div class="col event-location mb-3" tal:condition="python: data.location and \'location\' not in excludes">\n+          <div class="col event-location mb-3"\n+               tal:condition="python: data.location and \'location\' not in excludes"\n+          >\n             <div class="d-flex">\n               <div class="meta-icon">\n                 <tal:icon replace="structure python:icons.tag(\'geo-alt\', tag_class=\'icon-inline\')" />\n               </div>\n               <div>\n-                <strong class="meta-label" i18n:translate="event_where">Where</strong>\n-                <p class="card-text" itemprop="location" tal:content="data/location">Location</p>\n+                <strong class="meta-label"\n+                        i18n:translate="event_where"\n+                >Where</strong>\n+                <p class="card-text"\n+                   itemprop="location"\n+                   tal:content="data/location"\n+                >Location</p>\n               </div>\n             </div>\n           </div>\n \n           <tal:cond condition="python:\'contact\' not in excludes">\n \n-          <div class="col event-contact mb-3" tal:define="mail data/contact_email; name data/contact_name;" tal:condition="python:name or mail">\n-            <div class="d-flex">\n-              <div class="meta-icon">\n-                <tal:icon replace="structure python:icons.tag(\'person\', tag_class=\'icon-inline\')" />\n-              </div>\n-              <div>\n-                <strong class="meta-label" i18n:translate="contact_name">Contact Name</strong>\n-                <p class="card-text" tal:condition="mail"><a class="email" tal:attributes="href string:mailto:${mail}" tal:content="name">Mail</a></p>\n-                <p class="card-text" tal:condition="not:mail" tal:content="name">Name</p>\n+            <div class="col event-contact mb-3"\n+                 tal:define="\n+                   mail data/contact_email;\n+                   name data/contact_name;\n+                 "\n+                 tal:condition="python:name or mail"\n+            >\n+              <div class="d-flex">\n+                <div class="meta-icon">\n+                  <tal:icon replace="structure python:icons.tag(\'person\', tag_class=\'icon-inline\')" />\n+                </div>\n+                <div>\n+                  <strong class="meta-label"\n+                          i18n:translate="contact_name"\n+                  >Contact Name</strong>\n+                  <p class="card-text"\n+                     tal:condition="mail"\n+                  ><a class="email"\n+                       tal:content="name"\n+                       tal:attributes="\n+                         href string:mailto:${mail};\n+                       "\n+                    >Mail</a></p>\n+                  <p class="card-text"\n+                     tal:condition="not:mail"\n+                     tal:content="name"\n+                  >Name</p>\n+                </div>\n               </div>\n             </div>\n-          </div>\n \n-          <div class="col event-phone mb-3" tal:condition="data/contact_phone">\n-            <div class="d-flex">\n-              <div class="meta-icon">\n-                <tal:icon replace="structure python:icons.tag(\'phone\', tag_class=\'icon-inline\')" />\n-              </div>\n-              <div>\n-                <strong class="meta-label" i18n:translate="contact_phone">Contact Phone</strong>\n-                <p class="card-text"><a href="tel:${data/contact_phone}" title="Contact Phone" i18n:attributes="title contact_phone" tal:content="data/contact_phone">Contact Phone</a></p>\n+            <div class="col event-phone mb-3"\n+                 tal:condition="data/contact_phone"\n+            >\n+              <div class="d-flex">\n+                <div class="meta-icon">\n+                  <tal:icon replace="structure python:icons.tag(\'phone\', tag_class=\'icon-inline\')" />\n+                </div>\n+                <div>\n+                  <strong class="meta-label"\n+                          i18n:translate="contact_phone"\n+                  >Contact Phone</strong>\n+                  <p class="card-text"><a href="tel:${data/contact_phone}"\n+                       title="Contact Phone"\n+                       tal:content="data/contact_phone"\n+                       i18n:attributes="title contact_phone"\n+                    >Contact Phone</a></p>\n+                </div>\n               </div>\n             </div>\n-          </div>\n \n-          <div class="col event-attendees mb-3" tal:condition="data/attendees|nothing">\n-            <div class="d-flex">\n-              <div class="meta-icon">\n-                <tal:icon replace="structure python:icons.tag(\'people\', tag_class=\'icon-inline\')" />\n-              </div>\n-              <div>\n-                <strong class="meta-label" i18n:translate="contact_attendees">Attendees</strong>\n-                <p class="card-text">\n-                  <tal:attendees tal:repeat="item data/attendees"><span class="text-no-wrap" tal:content="item">Attendee</span><span tal:condition="not:repeat/item/end">, </span></tal:attendees>\n-                </p>\n+            <div class="col event-attendees mb-3"\n+                 tal:condition="data/attendees|nothing"\n+            >\n+              <div class="d-flex">\n+                <div class="meta-icon">\n+                  <tal:icon replace="structure python:icons.tag(\'people\', tag_class=\'icon-inline\')" />\n+                </div>\n+                <div>\n+                  <strong class="meta-label"\n+                          i18n:translate="contact_attendees"\n+                  >Attendees</strong>\n+                  <p class="card-text">\n+                    <tal:attendees tal:repeat="item data/attendees"><span class="text-no-wrap"\n+                            tal:content="item"\n+                      >Attendee</span><span tal:condition="not:repeat/item/end">,\n+                      </span></tal:attendees>\n+                  </p>\n+                </div>\n               </div>\n             </div>\n-          </div>\n \n           </tal:cond>\n \n-          <div class="col event-url mb-3" tal:condition="python: data.event_url and \'event_url\' not in excludes">\n+          <div class="col event-url mb-3"\n+               tal:condition="python: data.event_url and \'event_url\' not in excludes"\n+          >\n             <div class="d-flex">\n               <div class="meta-icon">\n                 <tal:icon replace="structure python:icons.tag(\'laptop\', tag_class=\'icon-inline\')" />\n               </div>\n               <div>\n-                <strong class="meta-label" i18n:translate="event_url">Web</strong>\n-                <p class="card-text"><a href="" tal:attributes="href data/event_url" i18n:translate="external_website">Visit external website</a></p>\n+                <strong class="meta-label"\n+                        i18n:translate="event_url"\n+                >Web</strong>\n+                <p class="card-text"><a href=""\n+                     tal:attributes="\n+                       href data/event_url;\n+                     "\n+                     i18n:translate="external_website"\n+                  >Visit external website</a></p>\n               </div>\n             </div>\n           </div>\n \n-          <div class="col event-add-ical mb-3" tal:condition="python:\'ical\' not in excludes">\n+          <div class="col event-add-ical mb-3"\n+               tal:condition="python:\'ical\' not in excludes"\n+          >\n             <div class="d-flex">\n               <div class="meta-icon">\n                 <tal:icon replace="structure python:icons.tag(\'calendar-plus\', tag_class=\'icon-inline\')" />\n               </div>\n               <div>\n-                <strong class="meta-label" i18n:translate="heading_add_to_calendar">Add event to calendar</strong>\n-                <p class="card-text" tal:define="here_url context/@@plone_context_state/object_url">\n-                  <a href="#" rel="nofollow" tal:attributes="href string:$here_url/ics_view" title="Download this event in iCal format" i18n:attributes="title title_add_to_ical;">iCal</a>\n+                <strong class="meta-label"\n+                        i18n:translate="heading_add_to_calendar"\n+                >Add event to calendar</strong>\n+                <p class="card-text"\n+                   tal:define="\n+                     here_url context/@@plone_context_state/object_url;\n+                   "\n+                >\n+                  <a href="#"\n+                     rel="nofollow"\n+                     title="Download this event in iCal format"\n+                     tal:attributes="\n+                       href string:$here_url/ics_view;\n+                     "\n+                     i18n:attributes="title title_add_to_ical;"\n+                  >iCal</a>\n                 </p>\n               </div>\n             </div>\ndiff --git a/plone/app/event/browser/event_view.pt b/plone/app/event/browser/event_view.pt\nindex 538fc067d..704521b77 100644\n--- a/plone/app/event/browser/event_view.pt\n+++ b/plone/app/event/browser/event_view.pt\n@@ -1,37 +1,65 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n-<body>\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core">\n-<tal:def tal:define="data nocall:view/data">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core">\n+        <tal:def tal:define="\n+                   data nocall:view/data;\n+                 ">\n \n-  <div class="event clearfix" itemscope itemtype="https://schema.org/Event">\n+          <div class="event clearfix"\n+               itemscope\n+               itemtype="https://schema.org/Event"\n+          >\n \n-    <ul class="hiddenStructure">\n-      <li><a itemprop="url" class="url" href="" tal:attributes="href data/url" tal:content="data/url">url</a></li>\n-      <li itemprop="name" class="summary" tal:content="data/title">title</li>\n-      <li itemprop="startDate" class="dtstart" tal:content="data/start/isoformat">start</li>\n-      <li itemprop="endDate" class="dtend" tal:content="data/end/isoformat">end</li>\n-      <li itemprop="description" class="description" tal:content="data/description">description</li>\n-    </ul>\n+            <ul class="hiddenStructure">\n+              <li><a class="url"\n+                   href=""\n+                   itemprop="url"\n+                   tal:content="data/url"\n+                   tal:attributes="\n+                     href data/url;\n+                   "\n+                >url</a></li>\n+              <li class="summary"\n+                  itemprop="name"\n+                  tal:content="data/title"\n+              >title</li>\n+              <li class="dtstart"\n+                  itemprop="startDate"\n+                  tal:content="data/start/isoformat"\n+              >start</li>\n+              <li class="dtend"\n+                  itemprop="endDate"\n+                  tal:content="data/end/isoformat"\n+              >end</li>\n+              <li class="description"\n+                  itemprop="description"\n+                  tal:content="data/description"\n+              >description</li>\n+            </ul>\n \n-    <tal:eventsummary replace="structure context/@@event_summary"/>\n+            <tal:eventsummary replace="structure context/@@event_summary" />\n \n-    <div id="parent-fieldname-text" tal:condition="data/text">\n-      <tal:text content="structure data/text" />\n-    </div>\n+            <div id="parent-fieldname-text"\n+                 tal:condition="data/text"\n+            >\n+              <tal:text content="structure data/text" />\n+            </div>\n \n-  </div>\n+          </div>\n \n-</tal:def>\n-</metal:block>\n-</metal:content-core>\n+        </tal:def>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/event/browser/formatted_date.pt b/plone/app/event/browser/formatted_date.pt\nindex 777758e05..bf34010f4 100644\n--- a/plone/app/event/browser/formatted_date.pt\n+++ b/plone/app/event/browser/formatted_date.pt\n@@ -1,80 +1,103 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n+      xml:lang="en"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n-<body tal:omit-tag="" tal:define="date_dict view/date_dict;\n-                                  whole_day date_dict/whole_day;\n-                                  open_end date_dict/open_end">\n+      i18n:domain="plone"\n+>\n+  <body tal:define="\n+          date_dict view/date_dict;\n+          whole_day date_dict/whole_day;\n+          open_end date_dict/open_end;\n+        "\n+        tal:omit-tag=""\n+  >\n \n-  <tal:differentday\n-      tal:condition="not:date_dict/same_day"\n-      i18n:translate="event_when_differentday">\n-    <abbr class="dtstart"\n-        i18n:name="startdate"\n-        tal:attributes="title date_dict/start_iso">\n-      <span class="explain">\n-        <span tal:replace="date_dict/start_date">Start Date</span>\n-        <tal:notwholeday condition="not:whole_day">\n-          <tal:word\n-              i18n:translate="event_when_differentday_optional_word_between_date_and_time" />\n-          <span tal:replace="date_dict/start_time">Start Time</span>\n-        </tal:notwholeday>\n-      </span>\n-    </abbr>\n+    <tal:differentday tal:condition="not:date_dict/same_day"\n+                      i18n:translate="event_when_differentday"\n+    >\n+      <abbr class="dtstart"\n+            tal:attributes="\n+              title date_dict/start_iso;\n+            "\n+            i18n:name="startdate"\n+      >\n+        <span class="explain">\n+          <span tal:replace="date_dict/start_date">Start Date</span>\n+          <tal:notwholeday condition="not:whole_day">\n+            <tal:word i18n:translate="event_when_differentday_optional_word_between_date_and_time" />\n+            <span tal:replace="date_dict/start_time">Start Time</span>\n+          </tal:notwholeday>\n+        </span>\n+      </abbr>\n     to\n-    <abbr class="dtend"\n-        i18n:name="enddate"\n-        tal:attributes="title date_dict/end_iso">\n-      <span class="explain">\n-        <span tal:replace="date_dict/end_date">End Date</span>\n-        <tal:notwholeday condition="not:whole_day">\n-          <tal:word\n-              i18n:translate="event_when_differentday_optional_word_between_date_and_time" />\n-          <span tal:replace="date_dict/end_time">End Time</span>\n-        </tal:notwholeday>\n-      </span>\n-    </abbr>\n-  </tal:differentday>\n+      <abbr class="dtend"\n+            tal:attributes="\n+              title date_dict/end_iso;\n+            "\n+            i18n:name="enddate"\n+      >\n+        <span class="explain">\n+          <span tal:replace="date_dict/end_date">End Date</span>\n+          <tal:notwholeday condition="not:whole_day">\n+            <tal:word i18n:translate="event_when_differentday_optional_word_between_date_and_time" />\n+            <span tal:replace="date_dict/end_time">End Time</span>\n+          </tal:notwholeday>\n+        </span>\n+      </abbr>\n+    </tal:differentday>\n \n-  <tal:sameday tal:condition="date_dict/same_day">\n-    <tal:wholeday condition="whole_day">\n-      <span tal:replace="date_dict/start_date" i18n:translate="" />\n-    </tal:wholeday>\n-    <tal:open_end\n-        condition="python:open_end and not whole_day"\n-        i18n:translate="event_when_sameday_openend">\n-      <span class="datedisplay"\n-          tal:content="date_dict/start_date"\n-          i18n:name="date">Start Date</span>\n+    <tal:sameday tal:condition="date_dict/same_day">\n+      <tal:wholeday condition="whole_day">\n+        <span tal:replace="date_dict/start_date"\n+              i18n:translate=""\n+        ></span>\n+      </tal:wholeday>\n+      <tal:open_end condition="python:open_end and not whole_day"\n+                    i18n:translate="event_when_sameday_openend"\n+      >\n+        <span class="datedisplay"\n+              tal:content="date_dict/start_date"\n+              i18n:name="date"\n+        >Start Date</span>\n       from\n-      <abbr class="dtstart"\n-          tal:attributes="title date_dict/start_iso"\n-          i18n:name="starttime"\n-          tal:content="date_dict/start_time">Start Time\n-      </abbr>\n-    </tal:open_end>\n-    <tal:normal\n-        condition="python:not (whole_day or open_end)"\n-        i18n:translate="event_when_sameday">\n-      <span class="datedisplay"\n-          tal:content="date_dict/start_date"\n-          i18n:name="date">Start Date</span>\n+        <abbr class="dtstart"\n+              tal:content="date_dict/start_time"\n+              tal:attributes="\n+                title date_dict/start_iso;\n+              "\n+              i18n:name="starttime"\n+        >Start Time\n+        </abbr>\n+      </tal:open_end>\n+      <tal:normal condition="python:not (whole_day or open_end)"\n+                  i18n:translate="event_when_sameday"\n+      >\n+        <span class="datedisplay"\n+              tal:content="date_dict/start_date"\n+              i18n:name="date"\n+        >Start Date</span>\n       from\n-      <abbr class="dtstart"\n-          tal:attributes="title date_dict/start_iso"\n-          i18n:name="starttime"\n-          tal:content="date_dict/start_time">Start Time\n-      </abbr>\n+        <abbr class="dtstart"\n+              tal:content="date_dict/start_time"\n+              tal:attributes="\n+                title date_dict/start_iso;\n+              "\n+              i18n:name="starttime"\n+        >Start Time\n+        </abbr>\n       to\n-      <abbr class="dtend"\n-          tal:attributes="title date_dict/end_iso"\n-          i18n:name="endtime"\n-          tal:content="date_dict/end_time">End Time\n-      </abbr>\n-    </tal:normal>\n-  </tal:sameday>\n+        <abbr class="dtend"\n+              tal:content="date_dict/end_time"\n+              tal:attributes="\n+                title date_dict/end_iso;\n+              "\n+              i18n:name="endtime"\n+        >End Time\n+        </abbr>\n+      </tal:normal>\n+    </tal:sameday>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/event/browser/formatted_start_date.pt b/plone/app/event/browser/formatted_start_date.pt\nindex bf2375cbb..1857234b8 100644\n--- a/plone/app/event/browser/formatted_start_date.pt\n+++ b/plone/app/event/browser/formatted_start_date.pt\n@@ -1,17 +1,29 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n+      xml:lang="en"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n-<body tal:omit-tag="" tal:define="date_dict view/date_dict">\n+      i18n:domain="plone"\n+>\n+  <body tal:define="\n+          date_dict view/date_dict;\n+        "\n+        tal:omit-tag=""\n+  >\n \n-  <span tal:replace="date_dict/start_date" />\n-  <tal:notwholeday condition="not:date_dict/whole_day">\n-    <abbr class="dtstart" tal:attributes="title date_dict/start_iso">\n-      <span class="explain" tal:content="date_dict/start_time">Start Time</span>\n-    </abbr>\n-  </tal:notwholeday>\n+    <span tal:replace="date_dict/start_date"></span>\n+    <tal:notwholeday condition="not:date_dict/whole_day">\n+      <abbr class="dtstart"\n+            tal:attributes="\n+              title date_dict/start_iso;\n+            "\n+      >\n+        <span class="explain"\n+              tal:content="date_dict/start_time"\n+        >Start Time</span>\n+      </abbr>\n+    </tal:notwholeday>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/event/configure.zcml b/plone/app/event/configure.zcml\nindex 64e995a17..d2ab79b46 100644\n--- a/plone/app/event/configure.zcml\n+++ b/plone/app/event/configure.zcml\n@@ -4,7 +4,8 @@\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:i18n="http://namespaces.zope.org/i18n"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n   <!-- external dependencies -->\n   <include package="plone.browserlayer" />\n@@ -25,39 +26,41 @@\n   <include package=".upgrades" />\n \n   <utility\n-      component=".vocabularies.SynchronizationStrategies"\n       name="plone.app.event.SynchronizationStrategies"\n+      component=".vocabularies.SynchronizationStrategies"\n       />\n \n   <genericsetup:registerProfile\n       name="default"\n-      directory="profiles/default"\n       title="plone.app.event"\n       description="plone.app.event framework registration."\n-      for="plone.base.interfaces.IPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n+      directory="profiles/default"\n       />\n \n   <genericsetup:registerProfile\n       name="testing"\n       title="plone.app.event testing"\n-      directory="profiles/testing"\n       description="Testing profile for plone.app.event"\n-      for="plone.base.interfaces.IPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n+      directory="profiles/testing"\n       />\n \n   <genericsetup:importStep\n       name="plone.app.event-catalog"\n-      handler="plone.app.event.setuphandlers.setup_catalog"\n       title="plone.app.event catalog setup"\n-      description="registers indices and metadata columns for plone.app.event">\n+      description="registers indices and metadata columns for plone.app.event"\n+      handler="plone.app.event.setuphandlers.setup_catalog"\n+      >\n     <depends name="plone.app.registry" />\n   </genericsetup:importStep>\n \n   <utility\n       factory=".setuphandlers.HiddenProfiles"\n+      provides="plone.base.interfaces.INonInstallable"\n       name="plone.app.event"\n-      provides="plone.base.interfaces.INonInstallable" />\n+      />\n \n </configure>\ndiff --git a/plone/app/event/dx/configure.zcml b/plone/app/event/dx/configure.zcml\nindex 4ab514716..850a06b2b 100644\n--- a/plone/app/event/dx/configure.zcml\n+++ b/plone/app/event/dx/configure.zcml\n@@ -1,63 +1,79 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    i18n_domain="plone">\n-\n-    <include package="plone.dexterity" />\n-    <include package="plone.app.dexterity" /><!-- To initialize DublinCore behaviors -->\n-    <include package="plone.behavior" file="meta.zcml" />\n-\n-    <!-- http://groups.google.com/group/zope-core-dev/browse_thread/thread/6c10ebc16027017f -->\n-    <!-- ZCML of this package fails in Zope 2.13 for strange reason -->\n-    <exclude package="zope.contentprovider" />\n-\n-    <include file="ical.zcml" />\n-\n-    <adapter\n-        factory=".traverser.OccurrenceTraverser"\n-        permission="zope.Public"\n-        />\n-\n-    <adapter factory=".behaviors.EventAccessor" />\n-\n-    <adapter name="start" factory=".behaviors.start_indexer" />\n-    <adapter name="end" factory=".behaviors.end_indexer" />\n-    <adapter name="location" factory=".behaviors.location_indexer" />\n-    <adapter name="sync_uid" factory=".behaviors.sync_uid_indexer" />\n-\n-    <plone:behavior\n-        name="plone.eventbasic"\n-        title="Event Basic"\n-        description="Basic Event schema."\n-        provides=".behaviors.IEventBasic"\n-        />\n-\n-    <plone:behavior\n-        name="plone.eventrecurrence"\n-        title="Event Recurrence"\n-        description="Recurrence extension for Events."\n-        provides=".behaviors.IEventRecurrence"\n-        />\n-\n-    <plone:behavior\n-        name="plone.eventlocation"\n-        title="Event Location"\n-        description="Location extension for Events."\n-        provides=".behaviors.IEventLocation"\n-        />\n-\n-    <plone:behavior\n-        name="plone.eventattendees"\n-        title="Event Attendees"\n-        description="Attendees extension for Events."\n-        provides=".behaviors.IEventAttendees"\n-        />\n-\n-    <plone:behavior\n-        name="plone.eventcontact"\n-        title="Event Contact"\n-        description="Contact extension for Events."\n-        provides=".behaviors.IEventContact"\n-        />\n+    i18n_domain="plone"\n+    >\n+\n+  <include package="plone.dexterity" />\n+  <include package="plone.app.dexterity" /><!-- To initialize DublinCore behaviors -->\n+  <include\n+      package="plone.behavior"\n+      file="meta.zcml"\n+      />\n+\n+  <!-- http://groups.google.com/group/zope-core-dev/browse_thread/thread/6c10ebc16027017f -->\n+  <!-- ZCML of this package fails in Zope 2.13 for strange reason -->\n+  <exclude package="zope.contentprovider" />\n+\n+  <include file="ical.zcml" />\n+\n+  <adapter\n+      factory=".traverser.OccurrenceTraverser"\n+      permission="zope.Public"\n+      />\n+\n+  <adapter factory=".behaviors.EventAccessor" />\n+\n+  <adapter\n+      factory=".behaviors.start_indexer"\n+      name="start"\n+      />\n+  <adapter\n+      factory=".behaviors.end_indexer"\n+      name="end"\n+      />\n+  <adapter\n+      factory=".behaviors.location_indexer"\n+      name="location"\n+      />\n+  <adapter\n+      factory=".behaviors.sync_uid_indexer"\n+      name="sync_uid"\n+      />\n+\n+  <plone:behavior\n+      name="plone.eventbasic"\n+      title="Event Basic"\n+      description="Basic Event schema."\n+      provides=".behaviors.IEventBasic"\n+      />\n+\n+  <plone:behavior\n+      name="plone.eventrecurrence"\n+      title="Event Recurrence"\n+      description="Recurrence extension for Events."\n+      provides=".behaviors.IEventRecurrence"\n+      />\n+\n+  <plone:behavior\n+      name="plone.eventlocation"\n+      title="Event Location"\n+      description="Location extension for Events."\n+      provides=".behaviors.IEventLocation"\n+      />\n+\n+  <plone:behavior\n+      name="plone.eventattendees"\n+      title="Event Attendees"\n+      description="Attendees extension for Events."\n+      provides=".behaviors.IEventAttendees"\n+      />\n+\n+  <plone:behavior\n+      name="plone.eventcontact"\n+      title="Event Contact"\n+      description="Contact extension for Events."\n+      provides=".behaviors.IEventContact"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/dx/ical.zcml b/plone/app/event/dx/ical.zcml\nindex 32237d177..69310d4da 100644\n--- a/plone/app/event/dx/ical.zcml\n+++ b/plone/app/event/dx/ical.zcml\n@@ -1,19 +1,21 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    >\n \n-    <adapter factory="..ical.exporter.calendar_from_container"\n-        provides="plone.event.interfaces.IICalendar"\n-        for="plone.dexterity.interfaces.IDexterityContainer"\n-        />\n+  <adapter\n+      factory="..ical.exporter.calendar_from_container"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="plone.dexterity.interfaces.IDexterityContainer"\n+      />\n \n-    <browser:page\n-        for="plone.dexterity.interfaces.IDexterityContainer"\n-        name="ics_view"\n-        class="..ical.exporter.EventsICal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <browser:page\n+      name="ics_view"\n+      for="plone.dexterity.interfaces.IDexterityContainer"\n+      class="..ical.exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/ical/__init__.py b/plone/app/event/ical/__init__.py\nindex 50df7e310..10c25ed16 100644\n--- a/plone/app/event/ical/__init__.py\n+++ b/plone/app/event/ical/__init__.py\n@@ -1,7 +1,7 @@\n-from plone.app.event.ical.exporter import calendar_from_collection  # nopep8\n-from plone.app.event.ical.exporter import calendar_from_container  # nopep8\n-from plone.app.event.ical.exporter import calendar_from_event  # nopep8\n-from plone.app.event.ical.exporter import construct_icalendar  # nopep8\n-from plone.app.event.ical.exporter import EventsICal  # nopep8\n-from plone.app.event.ical.exporter import ICalendarEventComponent  # nopep8\n-from plone.app.event.ical.importer import ical_import  # nopep8\n+from plone.app.event.ical.exporter import calendar_from_collection  # noqa: F401\n+from plone.app.event.ical.exporter import calendar_from_container  # noqa: F401\n+from plone.app.event.ical.exporter import calendar_from_event  # noqa: F401\n+from plone.app.event.ical.exporter import construct_icalendar  # noqa: F401\n+from plone.app.event.ical.exporter import EventsICal  # noqa: F401\n+from plone.app.event.ical.exporter import ICalendarEventComponent  # noqa: F401\n+from plone.app.event.ical.importer import ical_import  # noqa: F401\ndiff --git a/plone/app/event/ical/configure.zcml b/plone/app/event/ical/configure.zcml\nindex 31e10b29e..d3d6a645f 100644\n--- a/plone/app/event/ical/configure.zcml\n+++ b/plone/app/event/ical/configure.zcml\n@@ -1,114 +1,112 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:zcml="http://namespaces.zope.org/zcml"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    i18n_domain="plone">\n-\n-    <adapter\n-        for="plone.event.interfaces.IEvent"\n-        factory=".exporter.ICalendarEventComponent"\n-        />\n-\n-    <adapter\n-        for="plone.event.interfaces.IOccurrence"\n-        factory=".exporter.ICalendarEventComponent"\n-        />\n-\n-    <adapter\n-        for="plone.event.interfaces.IEvent"\n-        provides="plone.event.interfaces.IICalendar"\n-        factory=".exporter.calendar_from_event"\n-        />\n-\n-    <adapter\n-        for="plone.event.interfaces.IOccurrence"\n-        provides="plone.event.interfaces.IICalendar"\n-        factory=".exporter.calendar_from_event"\n-        />\n-\n-    <adapter\n-        for="Products.CMFCore.interfaces.ISiteRoot"\n-        provides="plone.event.interfaces.IICalendar"\n-        factory=".exporter.calendar_from_container"\n-        />\n-\n-    <adapter\n-        for="plone.folder.interfaces.IFolder"\n-        provides="plone.event.interfaces.IICalendar"\n-        factory=".exporter.calendar_from_container"\n-        />\n-\n-    <adapter\n-        for="plone.app.contenttypes.interfaces.ICollection"\n-        provides="plone.event.interfaces.IICalendar"\n-        factory=".exporter.calendar_from_collection"\n-        zcml:condition="installed plone.app.contenttypes"\n-        />\n-\n-    <!-- ICal Browser Views -->\n-    <browser:page\n-        for="plone.event.interfaces.IEvent"\n-        name="ics_view"\n-        class=".exporter.EventsICal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <browser:page\n-        for="plone.event.interfaces.IOccurrence"\n-        name="ics_view"\n-        class=".exporter.EventsICal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <browser:page\n-        for="Products.CMFCore.interfaces.ISiteRoot"\n-        name="ics_view"\n-        class=".exporter.EventsICal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <browser:page\n-        for="plone.folder.interfaces.IFolder"\n-        name="ics_view"\n-        class=".exporter.EventsICal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <browser:page\n-        for="plone.app.contenttypes.interfaces.ICollection"\n-        name="ics_view"\n-        class=".exporter.EventsICal"\n-        permission="zope2.View"\n-        zcml:condition="installed plone.app.contenttypes"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <!-- Ical import -->\n-    <adapter factory=".importer.IcalendarImportSettings"/>\n-\n-    <browser:page\n-        for="plone.folder.interfaces.IFolder"\n-        name="ical_import_settings"\n-        class=".importer.IcalendarImportSettingsFormView"\n-        allowed_attributes="enable\n-                            disable"\n-        permission="plone.app.event.ImportIcal"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="ical_import_tool"\n-        class=".importer.IcalendarImportTool"\n-        allowed_attributes="enabled\n-                            available\n-                            available_disabled"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n+\n+  <adapter\n+      factory=".exporter.ICalendarEventComponent"\n+      for="plone.event.interfaces.IEvent"\n+      />\n+\n+  <adapter\n+      factory=".exporter.ICalendarEventComponent"\n+      for="plone.event.interfaces.IOccurrence"\n+      />\n+\n+  <adapter\n+      factory=".exporter.calendar_from_event"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="plone.event.interfaces.IEvent"\n+      />\n+\n+  <adapter\n+      factory=".exporter.calendar_from_event"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="plone.event.interfaces.IOccurrence"\n+      />\n+\n+  <adapter\n+      factory=".exporter.calendar_from_container"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      />\n+\n+  <adapter\n+      factory=".exporter.calendar_from_container"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="plone.folder.interfaces.IFolder"\n+      />\n+\n+  <adapter\n+      factory=".exporter.calendar_from_collection"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="plone.app.contenttypes.interfaces.ICollection"\n+      zcml:condition="installed plone.app.contenttypes"\n+      />\n+\n+  <!-- ICal Browser Views -->\n+  <browser:page\n+      name="ics_view"\n+      for="plone.event.interfaces.IEvent"\n+      class=".exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="ics_view"\n+      for="plone.event.interfaces.IOccurrence"\n+      class=".exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="ics_view"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      class=".exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="ics_view"\n+      for="plone.folder.interfaces.IFolder"\n+      class=".exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="ics_view"\n+      for="plone.app.contenttypes.interfaces.ICollection"\n+      class=".exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      zcml:condition="installed plone.app.contenttypes"\n+      />\n+\n+  <!-- Ical import -->\n+  <adapter factory=".importer.IcalendarImportSettings" />\n+\n+  <browser:page\n+      name="ical_import_settings"\n+      for="plone.folder.interfaces.IFolder"\n+      class=".importer.IcalendarImportSettingsFormView"\n+      allowed_attributes="enable                             disable"\n+      permission="plone.app.event.ImportIcal"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="ical_import_tool"\n+      for="*"\n+      class=".importer.IcalendarImportTool"\n+      allowed_attributes="enabled                             available                             available_disabled"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/ical/exporter.py b/plone/app/event/ical/exporter.py\nindex 6d4fb004a..bd9f81566 100644\n--- a/plone/app/event/ical/exporter.py\n+++ b/plone/app/event/ical/exporter.py\n@@ -66,13 +66,12 @@ def construct_icalendar(context, events):\n             tzmap = add_to_zones_map(tzmap, tz_end, acc.end)\n         cal.add_component(IICalendarEventComponent(event).to_ical())\n \n-    for (tzid, transitions) in tzmap.items():\n+    for tzid, transitions in tzmap.items():\n         cal_tz = icalendar.Timezone()\n         cal_tz.add("tzid", tzid)\n         cal_tz.add("x-lic-location", tzid)\n \n-        for (transition, tzinfo) in transitions.items():\n-\n+        for transition, tzinfo in transitions.items():\n             if tzinfo["dst"]:\n                 cal_tz_sub = icalendar.TimezoneDaylight()\n             else:\ndiff --git a/plone/app/event/ical/importer.py b/plone/app/event/ical/importer.py\nindex 022961c8a..a64e312b8 100644\n--- a/plone/app/event/ical/importer.py\n+++ b/plone/app/event/ical/importer.py\n@@ -100,7 +100,7 @@ def _from_list(ical, prop):\n                 # RFC5545 doesn\'t define clearly, if all day events should have\n                 # a end date one day after the start day at 0:00.\n                 # Internally, we handle all day events with start=0:00,\n-                # end=:23:59:59, so we substract one day here.\n+                # end=:23:59:59, so we subtract one day here.\n                 end = end - datetime.timedelta(days=1)\n             start = base.dt_start_of_day(date_to_datetime(start))\n             end = base.dt_end_of_day(date_to_datetime(end))\n@@ -231,7 +231,6 @@ def no_file_protocol_url(value):\n \n \n class IIcalendarImportSettings(Interface):\n-\n     event_type = schema.Choice(\n         title=_("ical_import_event_type_title", default="Event Type"),\n         description=_(\n@@ -335,7 +334,6 @@ def handleSaveImport(self, action):\n         sync_strategy = data["sync_strategy"]\n \n         if ical_file or ical_url:\n-\n             if ical_file:\n                 # File upload is not saved in settings\n                 ical_resource = ical_file.data\ndiff --git a/plone/app/event/portlets/configure.zcml b/plone/app/event/portlets/configure.zcml\nindex b9e8713a6..83beb2a30 100644\n--- a/plone/app/event/portlets/configure.zcml\n+++ b/plone/app/event/portlets/configure.zcml\n@@ -1,26 +1,28 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <plone:portlet\n-        name="portlets.Calendar"\n-        interface=".portlet_calendar.ICalendarPortlet"\n-        assignment=".portlet_calendar.Assignment"\n-        renderer=".portlet_calendar.Renderer"\n-        addview=".portlet_calendar.AddForm"\n-        editview=".portlet_calendar.EditForm"\n-        zcml:condition="have plone-5"\n-        />\n+  <plone:portlet\n+      name="portlets.Calendar"\n+      interface=".portlet_calendar.ICalendarPortlet"\n+      assignment=".portlet_calendar.Assignment"\n+      renderer=".portlet_calendar.Renderer"\n+      addview=".portlet_calendar.AddForm"\n+      editview=".portlet_calendar.EditForm"\n+      zcml:condition="have plone-5"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Events"\n-        interface=".portlet_events.IEventsPortlet"\n-        assignment=".portlet_events.Assignment"\n-        renderer=".portlet_events.Renderer"\n-        addview=".portlet_events.AddForm"\n-        editview=".portlet_events.EditForm"\n-        zcml:condition="have plone-5"\n-        />\n+  <plone:portlet\n+      name="portlets.Events"\n+      interface=".portlet_events.IEventsPortlet"\n+      assignment=".portlet_events.Assignment"\n+      renderer=".portlet_events.Renderer"\n+      addview=".portlet_events.AddForm"\n+      editview=".portlet_events.EditForm"\n+      zcml:condition="have plone-5"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/portlets/portlet_calendar.pt b/plone/app/event/portlets/portlet_calendar.pt\nindex e2da9fc69..81be89116 100644\n--- a/plone/app/event/portlets/portlet_calendar.pt\n+++ b/plone/app/event/portlets/portlet_calendar.pt\n@@ -1,75 +1,119 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n       i18n:domain="plone"\n-      tal:omit-tag="">\n+>\n \n   <div class="card portlet portlet-calendar"\n-      tal:define="navigation_root_url context/@@plone_portal_state/navigation_root_url; month view/month; year view/year;">\n+       tal:define="\n+         navigation_root_url context/@@plone_portal_state/navigation_root_url;\n+         month view/month;\n+         year view/year;\n+       "\n+  >\n \n     <div class="card-header text-center">\n-      <a href="#" rel="nofollow" class="calendarPrevious pat-contentloader" title="Previous month"\n-          tal:define="prev_month view/prev_month;\n-                      prev_year view/prev_year"\n-          tal:attributes="href view/prev_query;\n-                          data-year prev_year;\n-                          data-month prev_month;\n-                          data-pat-contentloader python: view.nav_pattern_options(prev_year, prev_month)"\n-          i18n:attributes="title title_previous_month;">&laquo;</a>\n+      <a class="calendarPrevious pat-contentloader"\n+         href="#"\n+         rel="nofollow"\n+         title="Previous month"\n+         tal:define="\n+           prev_month view/prev_month;\n+           prev_year view/prev_year;\n+         "\n+         tal:attributes="\n+           href view/prev_query;\n+           data-year prev_year;\n+           data-month prev_month;\n+           data-pat-contentloader python: view.nav_pattern_options(prev_year, prev_month);\n+         "\n+         i18n:attributes="title title_previous_month;"\n+      >&laquo;</a>\n \n-      <span i18n:translate="" tal:omit-tag="">\n-        <span i18n:name="monthname" i18n:translate=""\n-            tal:content="view/month_name"\n-            tal:omit-tag="">monthname</span>\n-        <span i18n:name="year" i18n:translate=""\n-            tal:content="year"\n-            tal:omit-tag="">year</span>\n+      <span tal:omit-tag=""\n+            i18n:translate=""\n+      >\n+        <span tal:content="view/month_name"\n+              tal:omit-tag=""\n+              i18n:name="monthname"\n+              i18n:translate=""\n+        >monthname</span>\n+        <span tal:content="year"\n+              tal:omit-tag=""\n+              i18n:name="year"\n+              i18n:translate=""\n+        >year</span>\n       </span>\n \n-      <a href="#" rel="nofollow" class="calendarNext pat-contentloader" title="Next month"\n-            tal:define="next_month view/next_month;\n-                        next_year view/next_year"\n-            tal:attributes="href view/next_query;\n-                            data-year next_year;\n-                            data-month next_month;\n-                            data-pat-contentloader python: view.nav_pattern_options(next_year, next_month)"\n-            i18n:attributes="title title_next_month;">&raquo;</a>\n+      <a class="calendarNext pat-contentloader"\n+         href="#"\n+         rel="nofollow"\n+         title="Next month"\n+         tal:define="\n+           next_month view/next_month;\n+           next_year view/next_year;\n+         "\n+         tal:attributes="\n+           href view/next_query;\n+           data-year next_year;\n+           data-month next_month;\n+           data-pat-contentloader python: view.nav_pattern_options(next_year, next_month);\n+         "\n+         i18n:attributes="title title_next_month;"\n+      >&raquo;</a>\n     </div>\n \n     <div class="card-body table-responsive">\n-      <table class="table table-sm table-borderless mb-0" summary="Calendar" i18n:attributes="summary summary_calendar">\n-        <caption class="hiddenStructure" i18n:translate="" tal:content="string:month-${month}">monthname</caption>\n+      <table class="table table-sm table-borderless mb-0"\n+             summary="Calendar"\n+             i18n:attributes="summary summary_calendar"\n+      >\n+        <caption class="hiddenStructure"\n+                 tal:content="string:month-${month}"\n+                 i18n:translate=""\n+        >monthname</caption>\n         <thead>\n           <tr class="weekdays"><tal:data repeat="weekday view/weekdays">\n-            <th scope="col" i18n:translate="" tal:content="weekday">Su</th>\n-          </tal:data></tr>\n+              <th scope="col"\n+                  tal:content="weekday"\n+                  i18n:translate=""\n+              >Su</th>\n+            </tal:data></tr>\n         </thead>\n         <tbody>\n           <tr tal:repeat="week view/cal_data">\n             <tal:block repeat="day week">\n-            <td class="event"\n-                tal:define="today day/today;\n-                            next_month day/next_month;\n-                            prev_month day/prev_month;\n-                            events day/events;\n-                            limit python:len(events) if events is not None else 0"\n-                tal:attributes="class python:u\'event%s%s%s%s\' %\n+              <td class="event"\n+                  tal:define="\n+                    today day/today;\n+                    next_month day/next_month;\n+                    prev_month day/prev_month;\n+                    events day/events;\n+                    limit python:len(events) if events is not None else 0;\n+                  "\n+                  tal:attributes="\n+                    class python:u\'event%s%s%s%s\' %\n                             ((\' today\' if today else \'\'),\n                             (\' cal_next_month\' if next_month else \'\'),\n                             (\' cal_prev_month\' if prev_month else \'\'),\n-                            (\' cal_has_events\' if events else \'\'))">\n-              <tal:comment tal:condition="nothing">Add span or a to style td children and not td</tal:comment>\n-              <span\n-                  tal:condition="not:events"\n-                  tal:content="day/day"></span>\n-              <a href=""\n-                  tal:condition="events"\n-                  tal:attributes="href python:view.date_events_url(day[\'date_string\']);\n-                                  title day/events_string;"\n-\n-                  tal:content="day/day">31</a>\n+                            (\' cal_has_events\' if events else \'\'));\n+                  "\n+              >\n+                <tal:comment tal:condition="nothing">Add span or a to style td children and not td</tal:comment>\n+                <span tal:condition="not:events"\n+                      tal:content="day/day"\n+                ></span>\n+                <a href=""\n+                   tal:condition="events"\n+                   tal:content="day/day"\n+                   tal:attributes="\n+                     href python:view.date_events_url(day[\'date_string\']);\n+                     title day/events_string;\n+                   "\n+                >31</a>\n \n-            </td>\n+              </td>\n             </tal:block>\n           </tr>\n         </tbody>\n@@ -78,4 +122,4 @@\n \n   </div>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/event/portlets/portlet_events.pt b/plone/app/event/portlets/portlet_events.pt\nindex 95beefc71..a3a1fe744 100644\n--- a/plone/app/event/portlets/portlet_events.pt\n+++ b/plone/app/event/portlets/portlet_events.pt\n@@ -1,71 +1,110 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n \n   <div class="card portlet portletEvents"\n-      i18n:domain="plone">\n+       i18n:domain="plone"\n+  >\n \n     <div class="card-header portletHeader">\n-      <a href="" class="tile"\n-          tal:define="next_link view/next_url"\n-          tal:omit-tag="not:next_link"\n-          tal:attributes="href next_link"\n-          i18n:translate="box_events">\n+      <a class="tile"\n+         href=""\n+         tal:define="\n+           next_link view/next_url;\n+         "\n+         tal:omit-tag="not:next_link"\n+         tal:attributes="\n+           href next_link;\n+         "\n+         i18n:translate="box_events"\n+      >\n           Upcoming Events\n       </a>\n     </div>\n \n     <div class="card-body portletContent">\n-      <ul tal:define="thumb_scale view/thumb_scale">\n+      <ul tal:define="\n+            thumb_scale view/thumb_scale;\n+          ">\n         <tal:events repeat="item view/events">\n-        <li class="portletItem"\n-            tal:define="oddrow repeat/item/odd;\n-                        item_url      item/url;\n-                        item_descr    item/description;\n-                        item_title    item/title;\n-                        item_location item/location;\n-                        item_hasimage python:getattr(item.context.aq_base, \'image\', None)"\n-            tal:attributes="class python:\'portletItem odd\' if oddrow else \'portletItem even\'">\n-          <a href="#" class="tile"\n-              tal:attributes="href item_url;\n-                              title item_descr"\n-              tal:define="scale item/context/@@images|nothing;">\n-            <span tal:condition="item_hasimage">\n-              <img tal:define="img_tag python:scale.scale(\'image\', scale=thumb_scale).tag(css_class=\'float-end thumb-\'+thumb_scale)"\n-                  tal:replace="structure img_tag" />\n-            </span>\n-            <span tal:replace="item_title">Some Event</span>\n-          </a>\n-          <span class="portletItemDetails">\n-            <tal:date replace="structure python:view.formatted_date(item)" />\n-            <span class="timezone"\n-                tal:define="tz item/timezone"\n-                tal:condition="tz">\n-              (<tal:tzname replace="tz">TZ</tal:tzname>)\n-            </span>\n-            <span class="location"\n-                tal:condition="item_location"> &mdash;\n-              <tal:location content="item_location">Location</tal:location>\n+          <li class="portletItem"\n+              tal:define="\n+                oddrow repeat/item/odd;\n+                item_url      item/url;\n+                item_descr    item/description;\n+                item_title    item/title;\n+                item_location item/location;\n+                item_hasimage python:getattr(item.context.aq_base, \'image\', None);\n+              "\n+              tal:attributes="\n+                class python:\'portletItem odd\' if oddrow else \'portletItem even\';\n+              "\n+          >\n+            <a class="tile"\n+               href="#"\n+               tal:define="\n+                 scale item/context/@@images|nothing;\n+               "\n+               tal:attributes="\n+                 href item_url;\n+                 title item_descr;\n+               "\n+            >\n+              <span tal:condition="item_hasimage">\n+                <img tal:define="\n+                       img_tag python:scale.scale(\'image\', scale=thumb_scale).tag(css_class=\'float-end thumb-\'+thumb_scale);\n+                     "\n+                     tal:replace="structure img_tag"\n+                />\n+              </span>\n+              <span tal:replace="item_title">Some Event</span>\n+            </a>\n+            <span class="portletItemDetails">\n+              <tal:date replace="structure python:view.formatted_date(item)" />\n+              <span class="timezone"\n+                    tal:define="\n+                      tz item/timezone;\n+                    "\n+                    tal:condition="tz"\n+              >\n+                (<tal:tzname replace="tz">TZ</tal:tzname>)\n+              </span>\n+              <span class="location"\n+                    tal:condition="item_location"\n+              >\n+                 &mdash;\n+                <tal:location content="item_location">Location</tal:location>\n+              </span>\n             </span>\n-          </span>\n-        </li>\n+          </li>\n         </tal:events>\n       </ul>\n     </div>\n \n     <div class="card-footer portletFooter d-flex justify-content-around">\n       <a class="p-6 tile previous-events"\n-          tal:define="prev_link view/prev_url"\n-          tal:condition="prev_link"\n-          tal:attributes="href prev_link"\n-          i18n:translate="box_previous_events">\n+         tal:define="\n+           prev_link view/prev_url;\n+         "\n+         tal:condition="prev_link"\n+         tal:attributes="\n+           href prev_link;\n+         "\n+         i18n:translate="box_previous_events"\n+      >\n         Previous events&hellip;\n       </a>\n       <a class="p-6 tile upcoming-events"\n-          tal:define="next_link view/next_url"\n-          tal:attributes="href next_link"\n-          i18n:translate="box_upcoming_events">\n+         tal:define="\n+           next_link view/next_url;\n+         "\n+         tal:attributes="\n+           href next_link;\n+         "\n+         i18n:translate="box_upcoming_events"\n+      >\n         Upcoming events&hellip;\n       </a>\n     </div>\ndiff --git a/plone/app/event/portlets/portlet_events.py b/plone/app/event/portlets/portlet_events.py\nindex ed7f3bf66..db67a036b 100644\n--- a/plone/app/event/portlets/portlet_events.py\n+++ b/plone/app/event/portlets/portlet_events.py\n@@ -28,7 +28,6 @@\n \n \n class IEventsPortlet(IPortletDataProvider):\n-\n     count = schema.Int(\n         title=_("Number of items to display"),\n         description=_("How many items to list."),\n@@ -80,7 +79,6 @@ class IEventsPortlet(IPortletDataProvider):\n \n @implementer(IEventsPortlet)\n class Assignment(base.Assignment):\n-\n     # reduce upgrade pain\n     thumb_scale = None\n     no_thumbs = False\n@@ -118,7 +116,6 @@ def _uid(self):\n \n \n class Renderer(base.Renderer):\n-\n     _template = ViewPageTemplateFile("portlet_events.pt")\n     _search_base = None\n \n@@ -200,7 +197,7 @@ def events(self):\n                 ret_mode=RET_MODE_ACCESSORS,\n                 expand=True,\n                 limit=data.count,\n-                **query\n+                **query,\n             )\n \n         return events\ndiff --git a/plone/app/event/profiles/default/actions.xml b/plone/app/event/profiles/default/actions.xml\nindex 5adfdd78e..5af965873 100644\n--- a/plone/app/event/profiles/default/actions.xml\n+++ b/plone/app/event/profiles/default/actions.xml\n@@ -1,42 +1,69 @@\n-<?xml version="1.0"?>\n-<object name="portal_actions" meta_type="Plone Actions Tool"\n-   xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Plone Actions Tool"\n+        name="portal_actions"\n+>\n \n- <object name="object" meta_type="CMF Action Category">\n-  <object name="ical_import_settings" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="title_ical_import">Ical import</property>\n-   <property name="description" i18n:translate="help_ical_import">Import Events from icalendar files.</property>\n-   <property name="url_expr">string:${object_url}/@@ical_import_settings</property>\n-   <property name="icon_expr"></property>\n-   <property name="available_expr">object/@@ical_import_tool/enabled|nothing</property>\n-   <property name="permissions">\n-    <element value="plone.app.event: Import Ical"/>\n-   </property>\n-   <property name="visible">True</property>\n+  <object meta_type="CMF Action Category"\n+          name="object"\n+  >\n+    <object meta_type="CMF Action"\n+            name="ical_import_settings"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate="title_ical_import"\n+      >Ical import</property>\n+      <property name="description"\n+                i18n:translate="help_ical_import"\n+      >Import Events from icalendar files.</property>\n+      <property name="url_expr">string:${object_url}/@@ical_import_settings</property>\n+      <property name="icon_expr" />\n+      <property name="available_expr">object/@@ical_import_tool/enabled|nothing</property>\n+      <property name="permissions">\n+        <element value="plone.app.event: Import Ical" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n   </object>\n- </object>\n \n- <object name="object_buttons" meta_type="CMF Action Category">\n-  <object name="ical_import_enable" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="title_ical_import_enable">Enable icalendar import</property>\n-   <property name="description" i18n:translate="help_ical_import_enable">Click to enable the icalendar import feature on this context.</property>\n-   <property name="url_expr">string:$object_url/@@ical_import_settings/enable</property>\n-   <property name="available_expr">object/@@ical_import_tool/available_disabled|nothing</property>\n-   <property name="permissions">\n-    <element value="plone.app.event: Import Ical" />\n-   </property>\n-   <property name="visible">True</property>\n+  <object meta_type="CMF Action Category"\n+          name="object_buttons"\n+  >\n+    <object meta_type="CMF Action"\n+            name="ical_import_enable"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate="title_ical_import_enable"\n+      >Enable icalendar import</property>\n+      <property name="description"\n+                i18n:translate="help_ical_import_enable"\n+      >Click to enable the icalendar import feature on this context.</property>\n+      <property name="url_expr">string:$object_url/@@ical_import_settings/enable</property>\n+      <property name="available_expr">object/@@ical_import_tool/available_disabled|nothing</property>\n+      <property name="permissions">\n+        <element value="plone.app.event: Import Ical" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n+    <object meta_type="CMF Action"\n+            name="ical_import_disable"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate="title_ical_import_disable"\n+      >Disable icalendar import</property>\n+      <property name="description"\n+                i18n:translate="help_ical_import_disable"\n+      >Click to disable the icalendar import feature on this context.</property>\n+      <property name="url_expr">string:$object_url/@@ical_import_settings/disable</property>\n+      <property name="available_expr">object/@@ical_import_tool/enabled|nothing</property>\n+      <property name="permissions">\n+        <element value="plone.app.event: Import Ical" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n   </object>\n-  <object name="ical_import_disable" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="title_ical_import_disable">Disable icalendar import</property>\n-   <property name="description" i18n:translate="help_ical_import_disable">Click to disable the icalendar import feature on this context.</property>\n-   <property name="url_expr">string:$object_url/@@ical_import_settings/disable</property>\n-   <property name="available_expr">object/@@ical_import_tool/enabled|nothing</property>\n-   <property name="permissions">\n-    <element value="plone.app.event: Import Ical" />\n-   </property>\n-   <property name="visible">True</property>\n-  </object>\n- </object>\n \n </object>\ndiff --git a/plone/app/event/profiles/default/browserlayer.xml b/plone/app/event/profiles/default/browserlayer.xml\nindex e8cc759ad..260a2f622 100644\n--- a/plone/app/event/profiles/default/browserlayer.xml\n+++ b/plone/app/event/profiles/default/browserlayer.xml\n@@ -1,6 +1,6 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <layers>\n-  <layer\n-      name="plone.app.event"\n-      interface="plone.app.event.interfaces.IBrowserLayer" />\n+  <layer interface="plone.app.event.interfaces.IBrowserLayer"\n+         name="plone.app.event"\n+  />\n </layers>\ndiff --git a/plone/app/event/profiles/default/controlpanel.xml b/plone/app/event/profiles/default/controlpanel.xml\nindex 3b80bc26e..43822dea8 100644\n--- a/plone/app/event/profiles/default/controlpanel.xml\n+++ b/plone/app/event/profiles/default/controlpanel.xml\n@@ -1,15 +1,14 @@\n-<?xml version="1.0"?>\n-<object\n-    name="portal_controlpanel"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    i18n:domain="plone"\n-    purge="False">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        name="portal_controlpanel"\n+        purge="False"\n+        i18n:domain="plone"\n+>\n \n-    <!-- Hide old calendar calendar settings if there -->\n-    <configlet\n-        title="Calendar"\n-        action_id="CalendarSettings"\n-        visible="False"\n-        />\n+  <!-- Hide old calendar calendar settings if there -->\n+  <configlet action_id="CalendarSettings"\n+             title="Calendar"\n+             visible="False"\n+  />\n \n </object>\ndiff --git a/plone/app/event/profiles/default/metadata.xml b/plone/app/event/profiles/default/metadata.xml\nindex d7cd1512a..d1aa804e1 100644\n--- a/plone/app/event/profiles/default/metadata.xml\n+++ b/plone/app/event/profiles/default/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>15</version>\n   <dependencies>\ndiff --git a/plone/app/event/profiles/default/portlets.xml b/plone/app/event/profiles/default/portlets.xml\nindex fe2d5ebd5..3028b1e87 100644\n--- a/plone/app/event/profiles/default/portlets.xml\n+++ b/plone/app/event/profiles/default/portlets.xml\n@@ -1,39 +1,34 @@\n-<?xml version="1.0"?>\n-<portlets\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    i18n:domain="plone">\n+<?xml version="1.0" encoding="utf-8"?>\n+<portlets xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+          i18n:domain="plone"\n+>\n \n- <portlet\n-   addview="portlets.Calendar"\n-   title="Calendar portlet"\n-   description="A portlet which can render a calendar."\n-   i18n:attributes="title;\n-                    description"\n-   >\n-   <for interface="plone.app.portlets.interfaces.IColumn" />\n-   <for interface="plone.app.portlets.interfaces.IDashboard" />\n- </portlet>\n+  <portlet addview="portlets.Calendar"\n+           description="A portlet which can render a calendar."\n+           title="Calendar portlet"\n+           i18n:attributes="title;                     description"\n+  >\n+    <for interface="plone.app.portlets.interfaces.IColumn" />\n+    <for interface="plone.app.portlets.interfaces.IDashboard" />\n+  </portlet>\n \n- <portlet\n-   addview="portlets.Events"\n-   title="Events"\n-   description="A portlet which can render a listing of recent events"\n-   i18n:attributes="title;\n-                    description"\n-   >\n-   <for interface="plone.app.portlets.interfaces.IColumn" />\n-   <for interface="plone.app.portlets.interfaces.IDashboard" />\n- </portlet>\n+  <portlet addview="portlets.Events"\n+           description="A portlet which can render a listing of recent events"\n+           title="Events"\n+           i18n:attributes="title;                     description"\n+  >\n+    <for interface="plone.app.portlets.interfaces.IColumn" />\n+    <for interface="plone.app.portlets.interfaces.IDashboard" />\n+  </portlet>\n \n- <assignment\n-     manager="plone.rightcolumn"\n-     category="context"\n-     key="/"\n-     type="portlets.Events"\n-     name="events"\n-     />\n+  <assignment category="context"\n+              key="/"\n+              manager="plone.rightcolumn"\n+              name="events"\n+              type="portlets.Events"\n+  />\n \n- <!-- EXAMPLE ASSIGNMENTS\n+  <!-- EXAMPLE ASSIGNMENTS\n  <assignment\n      manager="plone.rightcolumn"\n      category="context"\ndiff --git a/plone/app/event/profiles/default/registry.xml b/plone/app/event/profiles/default/registry.xml\nindex 3289fb8b3..c5afb6a66 100644\n--- a/plone/app/event/profiles/default/registry.xml\n+++ b/plone/app/event/profiles/default/registry.xml\n@@ -1,11 +1,13 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n \n-  <records prefix="plone.bundles/eventedit" interface=\'Products.CMFPlone.interfaces.IBundleRegistry\'>\n+  <records interface="Products.CMFPlone.interfaces.IBundleRegistry"\n+           prefix="plone.bundles/eventedit"\n+  >\n     <value key="enabled">True</value>\n     <value key="expression">python: member is not None</value>\n     <value key="jscompilation">++plone++plone.app.event/event.js</value>\n-    <value key="csscompilation"></value>\n+    <value key="csscompilation" />\n     <value key="load_async">False</value>\n     <value key="load_defer">False</value>\n   </records>\ndiff --git a/plone/app/event/profiles/default/rolemap.xml b/plone/app/event/profiles/default/rolemap.xml\nindex d4a41c5af..c3d542034 100644\n--- a/plone/app/event/profiles/default/rolemap.xml\n+++ b/plone/app/event/profiles/default/rolemap.xml\n@@ -1,11 +1,13 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <rolemap>\n   <permissions>\n-    <permission name="plone.app.event: Import Ical" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.event: Import Ical"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Editor"/>\n-      <role name="Owner"/>\n+      <role name="Editor" />\n+      <role name="Owner" />\n     </permission>\n   </permissions>\n </rolemap>\ndiff --git a/plone/app/event/profiles/default/types.xml b/plone/app/event/profiles/default/types.xml\nindex f62133b44..b6015b206 100644\n--- a/plone/app/event/profiles/default/types.xml\n+++ b/plone/app/event/profiles/default/types.xml\n@@ -1,6 +1,14 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n-<object name="portal_types" meta_type="Plone Types Tool">\n-  <object name="Plone Site" meta_type="Factory-based Type Information with dynamic views"/>\n-  <object name="Folder"     meta_type="Dexterity FTI"/>\n-  <object name="Collection" meta_type="Dexterity FTI"/>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Plone Site"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Folder"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Collection"\n+  />\n </object>\ndiff --git a/plone/app/event/profiles/default/types/Collection.xml b/plone/app/event/profiles/default/types/Collection.xml\nindex 1a79d3198..53b694a74 100644\n--- a/plone/app/event/profiles/default/types/Collection.xml\n+++ b/plone/app/event/profiles/default/types/Collection.xml\n@@ -1,6 +1,8 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="Collection">\n- <property name="view_methods" purge="False">\n-  <element value="event_listing"/>\n- </property>\n+  <property name="view_methods"\n+            purge="False"\n+  >\n+    <element value="event_listing" />\n+  </property>\n </object>\ndiff --git a/plone/app/event/profiles/default/types/Folder.xml b/plone/app/event/profiles/default/types/Folder.xml\nindex 84e858a28..5fa02da8a 100644\n--- a/plone/app/event/profiles/default/types/Folder.xml\n+++ b/plone/app/event/profiles/default/types/Folder.xml\n@@ -1,6 +1,8 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="Folder">\n- <property name="view_methods" purge="False">\n-  <element value="event_listing"/>\n- </property>\n+  <property name="view_methods"\n+            purge="False"\n+  >\n+    <element value="event_listing" />\n+  </property>\n </object>\ndiff --git a/plone/app/event/profiles/default/types/Plone_Site.xml b/plone/app/event/profiles/default/types/Plone_Site.xml\nindex 692af4add..cdb5f1927 100644\n--- a/plone/app/event/profiles/default/types/Plone_Site.xml\n+++ b/plone/app/event/profiles/default/types/Plone_Site.xml\n@@ -1,6 +1,8 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="Plone Site">\n- <property name="view_methods" purge="False">\n-  <element value="event_listing"/>\n- </property>\n+  <property name="view_methods"\n+            purge="False"\n+  >\n+    <element value="event_listing" />\n+  </property>\n </object>\ndiff --git a/plone/app/event/profiles/testing/metadata.xml b/plone/app/event/profiles/testing/metadata.xml\nindex 3cbcf5b88..22c4db4b2 100644\n--- a/plone/app/event/profiles/testing/metadata.xml\n+++ b/plone/app/event/profiles/testing/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>1</version>\n   <dependencies>\ndiff --git a/plone/app/event/profiles/testing/types.xml b/plone/app/event/profiles/testing/types.xml\nindex 9c625ec3a..868e9f9f9 100644\n--- a/plone/app/event/profiles/testing/types.xml\n+++ b/plone/app/event/profiles/testing/types.xml\n@@ -1,4 +1,8 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n-<object name="portal_types" meta_type="Plone Types Tool">\n-  <object name="plone.app.event.dx.event" meta_type="Dexterity FTI"/>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n+  <object meta_type="Dexterity FTI"\n+          name="plone.app.event.dx.event"\n+  />\n </object>\ndiff --git a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\nindex 945155667..0d221d5b3 100644\n--- a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n+++ b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n@@ -1,22 +1,27 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n-<object name="plone.app.event.dx.event" meta_type="Dexterity FTI"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    i18n:domain="plone">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="plone.app.event.dx.event"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property name="title" i18n:translate="">plone.app.event.dx.event</property>\n+  <property name="title"\n+            i18n:translate=""\n+  >plone.app.event.dx.event</property>\n   <property name="description"\n-      i18n:translate="">Events can be shown in calendars.</property>\n-  <property name="icon_expr"></property>\n+            i18n:translate=""\n+  >Events can be shown in calendars.</property>\n+  <property name="icon_expr" />\n   <property name="allow_discussion">False</property>\n \n   <!-- Hierarchy control -->\n- <property name="global_allow">True</property>\n- <property name="filter_content_types">True</property>\n- <property name="allowed_content_types"/>\n+  <property name="global_allow">True</property>\n+  <property name="filter_content_types">True</property>\n+  <property name="allowed_content_types" />\n \n   <!-- Schema, class and security -->\n-  <property name="schema"></property>\n+  <property name="schema" />\n   <property name="klass">plone.dexterity.content.Item</property>\n   <property name="add_permission">cmf.AddPortalContent</property>\n   <property name="model_source">\n@@ -24,47 +29,71 @@\n       &lt;schema&gt;\n       &lt;/schema&gt;\n   &lt;/model&gt;</property>\n-  <property name="model_file"></property>\n+  <property name="model_file" />\n \n   <!-- Enabled behaviors -->\n   <property name="behaviors">\n-    <element value="plone.eventbasic"/>\n-    <element value="plone.eventrecurrence"/>\n-    <element value="plone.eventlocation"/>\n-    <element value="plone.eventattendees"/>\n-    <element value="plone.eventcontact"/>\n-    <element value="plone.richtext"/>\n-    <element value="plone.dublincore"/>\n-    <element value="plone.namefromtitle"/>\n-    <element value="plone.allowdiscussion"/>\n-    <element value="plone.excludefromnavigation"/>\n-    <element value="plone.textindexer"/>\n+    <element value="plone.eventbasic" />\n+    <element value="plone.eventrecurrence" />\n+    <element value="plone.eventlocation" />\n+    <element value="plone.eventattendees" />\n+    <element value="plone.eventcontact" />\n+    <element value="plone.richtext" />\n+    <element value="plone.dublincore" />\n+    <element value="plone.namefromtitle" />\n+    <element value="plone.allowdiscussion" />\n+    <element value="plone.excludefromnavigation" />\n+    <element value="plone.textindexer" />\n   </property>\n \n   <!-- View and aliases -->\n- <property name="default_view">event_view</property>\n- <property name="default_view_fallback">False</property>\n- <property name="immediate_view">view</property>\n- <property name="view_methods">\n-  <element value="event_view"/>\n- </property>\n+  <property name="default_view">event_view</property>\n+  <property name="default_view_fallback">False</property>\n+  <property name="immediate_view">view</property>\n+  <property name="view_methods">\n+    <element value="event_view" />\n+  </property>\n \n- <alias from="event_view" to="@@event_view"/>\n- <alias from="(Default)" to="(dynamic view)"/>\n- <alias from="edit" to="@@edit"/>\n- <alias from="sharing" to="@@sharing"/>\n- <alias from="view" to="(selected layout)"/>\n+  <alias from="event_view"\n+         to="@@event_view"\n+  />\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n+  />\n+  <alias from="edit"\n+         to="@@edit"\n+  />\n+  <alias from="sharing"\n+         to="@@sharing"\n+  />\n+  <alias from="view"\n+         to="(selected layout)"\n+  />\n \n- <action title="View" action_id="view" category="object" condition_expr=""\n-    icon_expr="" link_target="" url_expr="string:${object_url}"\n-    visible="True" i18n:attributes="title">\n-  <permission value="View"/>\n- </action>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr=""\n+          link_target=""\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n+  </action>\n \n- <action title="Edit" action_id="edit" category="object" condition_expr=""\n-    icon_expr="" link_target="" url_expr="string:${object_url}/edit"\n-    visible="True" i18n:attributes="title">\n-  <permission value="Modify portal content"/>\n- </action>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr=""\n+          link_target=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n+  </action>\n \n </object>\ndiff --git a/plone/app/event/recurrence.zcml b/plone/app/event/recurrence.zcml\nindex 45a07e583..6324f9b04 100644\n--- a/plone/app/event/recurrence.zcml\n+++ b/plone/app/event/recurrence.zcml\n@@ -1,6 +1,7 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n   <adapter factory=".recurrence.RecurrenceSupport" />\n   <adapter factory=".recurrence.EventOccurrenceAccessor" />\n@@ -12,9 +13,10 @@\n \n   <!-- @@images view factory for occurrences -->\n   <browser:page\n-      for="plone.event.interfaces.IOccurrence"\n       name="images"\n+      for="plone.event.interfaces.IOccurrence"\n       class=".recurrence.ImageScalingViewFactory"\n-      permission="zope2.View" />\n+      permission="zope2.View"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/testing.py b/plone/app/event/testing.py\nindex a0a1e438e..e6e83ecfa 100644\n--- a/plone/app/event/testing.py\n+++ b/plone/app/event/testing.py\n@@ -99,7 +99,6 @@ def tearDownZope(self, app):\n \n \n class PAEventDXLayer(PloneSandboxLayer):\n-\n     defaultBases = (PAEvent_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\ndiff --git a/plone/app/event/tests/javascripts/test_event.html b/plone/app/event/tests/javascripts/test_event.html\nindex 8943fc14e..0dbd75ad5 100644\n--- a/plone/app/event/tests/javascripts/test_event.html\n+++ b/plone/app/event/tests/javascripts/test_event.html\n@@ -1,1077 +1,1190 @@\n <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"\n "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n \n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      dir="ltr" id="html">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      id="html"\n+      dir="ltr"\n+      lang="en"\n+      xml:lang="en"\n+>\n   <head>\n     <title>plone.app.event Test Suite</title>\n-    \n+\n     <!-- qUnit -->\n-    <link rel="stylesheet" href="../qunit/qunit.css" type="text/css" \n-          media="screen" />\n-    <script type="text/javascript" src="../qunit/qunit.js"></script>\n-\t\n+    <link href="../qunit/qunit.css"\n+          media="screen"\n+          rel="stylesheet"\n+          type="text/css"\n+    />\n+    <script src="../qunit/qunit.js"\n+            type="text/javascript"\n+    ></script>\n+\n     <!-- jQuery -->\n-    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>\n-    <script type="text/javascript" src="http://cdn.jquerytools.org/1.2.5/full/jquery.tools.min.js"></script>\n+    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"\n+            type="text/javascript"\n+    ></script>\n+    <script src="http://cdn.jquerytools.org/1.2.5/full/jquery.tools.min.js"\n+            type="text/javascript"\n+    ></script>\n+\n+    <!-- Tests -->\n+    <script src="test_event.js"\n+            type="text/javascript"\n+    ></script>\n+\n+  </head>\n+\n+  <body>\n+    <h1 id="qunit-header">plone.app.event Test Suite</h1>\n+\n+    <h2 id="qunit-banner"></h2>\n+\n+    <div id="qunit-testrunner-toolbar">\n+    </div>\n+\n+    <h2 id="qunit-userAgent"></h2>\n+\n+    <ol id="qunit-tests">\n+    </ol>\n+\n+    <div id="qunit-fixture">\n+      <div id="event">\n+        <div class="field ArchetypesBooleanWidget kssattr-atfieldname-wholeDay"\n+             id="archetypes-fieldname-wholeDay"\n+        >\n+\n+          <input class="noborder"\n+                 id="wholeDay"\n+                 name="wholeDay:boolean"\n+                 type="checkbox"\n+                 value="on"\n+          />\n+          <input name="wholeDay:boolean:default"\n+                 originalvalue=""\n+                 type="hidden"\n+                 value=""\n+          />\n+\n+          <label class="formQuestion"\n+                 for="wholeDay"\n+          >Whole day event</label>\n+\n+          <div class="formHelp"\n+               id="wholeDay_help"\n+          ></div>\n+\n+          <div class="fieldErrorBox"></div>\n+          <div></div>\n+        </div>\n+        <div class="field Archetypes DatetimeWidget kssattr-atfieldname-startDate"\n+             id="archetypes-fieldname-startDate"\n+        >\n+\n+          <div class="fieldErrorBox"></div>\n+          <div>\n+\n+            <!-- day -->\n+            <select class="day"\n+                    id="startDate-day"\n+                    name="startDate-day"\n+            >\n+\n+              <option selected="selected"\n+                      value="1"\n+              >01</option>\n+\n+\n+              <option value="2">02</option>\n+\n+\n+              <option value="3">03</option>\n+\n+\n+              <option value="4">04</option>\n+\n+\n+              <option value="5">05</option>\n+\n+\n+              <option value="6">06</option>\n+\n+\n+              <option value="7">07</option>\n+\n+\n+              <option value="8">08</option>\n+\n+\n+              <option value="9">09</option>\n+\n+\n+              <option value="10">10</option>\n+\n+\n+              <option value="11">11</option>\n+\n+\n+              <option value="12">12</option>\n+\n+\n+              <option value="13">13</option>\n+\n+\n+              <option value="14">14</option>\n+\n+\n+              <option value="15">15</option>\n+\n+\n+              <option value="16">16</option>\n+\n+\n+              <option value="17">17</option>\n+\n+\n+              <option value="18">18</option>\n+\n+\n+              <option value="19">19</option>\n+\n+\n+              <option value="20">20</option>\n+\n+\n+              <option value="21">21</option>\n+\n+\n+              <option value="22">22</option>\n+\n+\n+              <option value="23">23</option>\n+\n+\n+              <option value="24">24</option>\n+\n+\n+              <option value="25">25</option>\n+\n+\n+              <option value="26">26</option>\n+\n+\n+              <option value="27">27</option>\n+\n+\n+              <option value="28">28</option>\n+\n+\n+              <option value="29">29</option>\n+\n+\n+              <option value="30">30</option>\n+\n+\n+              <option value="31">31</option>\n+\n+            </select>\n+\n+            <span class="separator">/</span>\n+\n+            <!-- month -->\n+            <select class="month"\n+                    id="startDate-month"\n+                    name="startDate-month"\n+            >\n+\n+              <option value="1">January</option>\n+\n+\n+              <option selected="selected"\n+                      value="2"\n+              >February</option>\n+\n+\n+              <option value="3">March</option>\n+\n+\n+              <option value="4">April</option>\n+\n+\n+              <option value="5">May</option>\n+\n+\n+              <option value="6">June</option>\n+\n+\n+              <option value="7">July</option>\n+\n+\n+              <option value="8">August</option>\n+\n+\n+              <option value="9">September</option>\n+\n+\n+              <option value="10">October</option>\n+\n+\n+              <option value="11">November</option>\n+\n+\n+              <option value="12">December</option>\n+\n+            </select>\n+\n+            <span class="separator">/</span>\n+\n+            <!-- year -->\n+            <select class="year"\n+                    id="startDate-year"\n+                    name="startDate-year"\n+            >\n+\n+              <option value="2000">2000</option>\n+\n+\n+              <option value="2001">2001</option>\n+\n+\n+              <option value="2002">2002</option>\n+\n+\n+              <option value="2003">2003</option>\n+\n+\n+              <option value="2004">2004</option>\n+\n+\n+              <option value="2005">2005</option>\n+\n+\n+              <option value="2006">2006</option>\n+\n+\n+              <option value="2007">2007</option>\n+\n+\n+              <option value="2008">2008</option>\n+\n+\n+              <option value="2009">2009</option>\n+\n+\n+              <option value="2010">2010</option>\n+\n+\n+              <option selected="selected"\n+                      value="2011"\n+              >2011</option>\n+\n+\n+              <option value="2012">2012</option>\n+\n+\n+              <option value="2013">2013</option>\n+\n+\n+              <option value="2014">2014</option>\n+\n+\n+              <option value="2015">2015</option>\n+\n+\n+              <option value="2016">2016</option>\n+\n+\n+              <option value="2017">2017</option>\n+\n+\n+              <option value="2018">2018</option>\n+\n+\n+              <option value="2019">2019</option>\n+\n+            </select>\n+        &nbsp;\n+\n+            <input class="startDate-calendar date"\n+                   id="startDate"\n+                   name="startDate-calendar"\n+                   originalvalue=""\n+                   type="hidden"\n+            /><a class="caltrigger"\n+               href="#"\n+               style="width: 16px; vertical-align: middle; display: inline-block; background: url(&quot;popup_calendar.gif&quot;) repeat scroll 0% 0% transparent; height: 16px;"\n+            ></a>\n+            <script type="text/javascript">\n+                jQuery.tools.dateinput.localize("en", {months: "January,February,March,April,May,June,July,August,September,October,November,December",shortMonths: "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days: "Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday",shortDays: "Mon,Tue,Wed,Thu,Fri,Sat,Sun",});\n+                jQuery(".startDate-calendar").dateinput({lang: "en", value: new Date(2011, 1, 1, 16, 41), change: function() {\n+  var value = this.getValue();\n+  var parent = jQuery(this.getInput()).closest("div.DatetimeWidget");\n+  jQuery(parent).find(".year").val(value.getFullYear());\n+  jQuery(parent).find(".month").val(value.getMonth()+1);\n+  jQuery(parent).find(".day").val(value.getDate());\n+}, selectors: true, trigger: true, yearRange: [-10, 10]}).unbind(\'change\')\n+                    .bind(\'onShow\', function (event) {\n+                        var trigger_offset = jQuery(this).next().offset();\n+                        jQuery(this).data(\'dateinput\').getCalendar().offset(\n+                            {top: trigger_offset.top+20, left: trigger_offset.left}\n+                        );\n+                    });\n+                jQuery(".startDate-calendar").next().css({\'width\': \'16px\', \'vertical-align\': \'middle\', \'display\': \'inline-block\', \'background\': \'url(popup_calendar.gif)\', \'height\': \'16px\'});\n+\n+            </script>\n+\n+\n+            &nbsp;\n+            <span class="datetimewidget-time"\n+                  style=""\n+            >\n+\n+              <!-- hour -->\n+              <select class="hour"\n+                      id="startDate-hour"\n+                      name="startDate-hour"\n+              >\n+\n+                <option value="0">00</option>\n+\n+\n+                <option value="1">01</option>\n+\n+\n+                <option value="2">02</option>\n+\n+\n+                <option value="3">03</option>\n+\n+\n+                <option value="4">04</option>\n+\n+\n+                <option value="5">05</option>\n+\n+\n+                <option value="6">06</option>\n+\n+\n+                <option value="7">07</option>\n+\n+\n+                <option value="8">08</option>\n+\n+\n+                <option value="9">09</option>\n+\n+\n+                <option value="10">10</option>\n+\n+\n+                <option value="11">11</option>\n+\n+\n+                <option value="12">12</option>\n+\n+\n+                <option value="13">13</option>\n+\n+\n+                <option value="14">14</option>\n+\n+\n+                <option value="15">15</option>\n+\n+\n+                <option selected="selected"\n+                        value="16"\n+                >16</option>\n+\n+\n+                <option value="17">17</option>\n+\n+\n+                <option value="18">18</option>\n+\n+\n+                <option value="19">19</option>\n+\n+\n+                <option value="20">20</option>\n+\n+\n+                <option value="21">21</option>\n+\n+\n+                <option value="22">22</option>\n+\n+\n+                <option value="23">23</option>\n+\n+              </select>\n+\n+              <!-- minute -->\n+              <select class="min"\n+                      id="startDate-min"\n+                      name="startDate-min"\n+              >\n+\n+                <option value="0">00</option>\n+\n+\n+                <option value="1">01</option>\n+\n+\n+                <option value="2">02</option>\n+\n+\n+                <option value="3">03</option>\n+\n+\n+                <option value="4">04</option>\n+\n+\n+                <option value="5">05</option>\n+\n+\n+                <option value="6">06</option>\n+\n+\n+                <option value="7">07</option>\n+\n+\n+                <option value="8">08</option>\n+\n+\n+                <option value="9">09</option>\n+\n+\n+                <option value="10">10</option>\n+\n+\n+                <option value="11">11</option>\n+\n+\n+                <option value="12">12</option>\n+\n+\n+                <option value="13">13</option>\n+\n+\n+                <option value="14">14</option>\n+\n+\n+                <option value="15">15</option>\n+\n+\n+                <option value="16">16</option>\n+\n+\n+                <option value="17">17</option>\n+\n+\n+                <option value="18">18</option>\n+\n+\n+                <option value="19">19</option>\n+\n+\n+                <option value="20">20</option>\n+\n+\n+                <option value="21">21</option>\n+\n+\n+                <option value="22">22</option>\n+\n+\n+                <option value="23">23</option>\n+\n+\n+                <option value="24">24</option>\n+\n+\n+                <option value="25">25</option>\n+\n+\n+                <option value="26">26</option>\n+\n+\n+                <option value="27">27</option>\n+\n+\n+                <option value="28">28</option>\n+\n+\n+                <option value="29">29</option>\n+\n+\n+                <option value="30">30</option>\n+\n+\n+                <option value="31">31</option>\n+\n+\n+                <option value="32">32</option>\n+\n+\n+                <option value="33">33</option>\n+\n+\n+                <option value="34">34</option>\n+\n+\n+                <option value="35">35</option>\n+\n+\n+                <option value="36">36</option>\n+\n+\n+                <option value="37">37</option>\n+\n+\n+                <option value="38">38</option>\n+\n+\n+                <option value="39">39</option>\n+\n+\n+                <option value="40">40</option>\n+\n+\n+                <option selected="selected"\n+                        value="41"\n+                >41</option>\n+\n+\n+                <option value="42">42</option>\n+\n+\n+                <option value="43">43</option>\n+\n+\n+                <option value="44">44</option>\n+\n+\n+                <option value="45">45</option>\n+\n+\n+                <option value="46">46</option>\n+\n+\n+                <option value="47">47</option>\n+\n+\n+                <option value="48">48</option>\n+\n+\n+                <option value="49">49</option>\n+\n+\n+                <option value="50">50</option>\n+\n+\n+                <option value="51">51</option>\n+\n+\n+                <option value="52">52</option>\n+\n+\n+                <option value="53">53</option>\n+\n+\n+                <option value="54">54</option>\n+\n+\n+                <option value="55">55</option>\n+\n+\n+                <option value="56">56</option>\n+\n+\n+                <option value="57">57</option>\n+\n+\n+                <option value="58">58</option>\n+\n+\n+                <option value="59">59</option>\n+\n+              </select>\n+\n+              <!-- am/pm -->\n+\n+\n+            </span>\n+\n+\n+\n+            <input name="startDate-empty-marker"\n+                   originalvalue="1"\n+                   type="hidden"\n+                   value="1"\n+            />\n+\n+\n+\n+          </div>\n+        </div>\n+\n+\n+        <div class="field Archetypes DatetimeWidget kssattr-atfieldname-endDate"\n+             id="archetypes-fieldname-endDate"\n+        >\n+\n+          <div class="fieldErrorBox"></div>\n+          <div>\n+\n+            <!-- day -->\n+            <select class="day"\n+                    id="endDate-day"\n+                    name="endDate-day"\n+            >\n+\n+              <option selected="selected"\n+                      value="1"\n+              >01</option>\n+\n+\n+              <option value="2">02</option>\n+\n+\n+              <option value="3">03</option>\n+\n+\n+              <option value="4">04</option>\n+\n+\n+              <option value="5">05</option>\n+\n+\n+              <option value="6">06</option>\n+\n+\n+              <option value="7">07</option>\n+\n+\n+              <option value="8">08</option>\n+\n+\n+              <option value="9">09</option>\n+\n+\n+              <option value="10">10</option>\n+\n+\n+              <option value="11">11</option>\n+\n+\n+              <option value="12">12</option>\n+\n+\n+              <option value="13">13</option>\n+\n+\n+              <option value="14">14</option>\n+\n+\n+              <option value="15">15</option>\n+\n+\n+              <option value="16">16</option>\n+\n+\n+              <option value="17">17</option>\n+\n+\n+              <option value="18">18</option>\n+\n+\n+              <option value="19">19</option>\n+\n+\n+              <option value="20">20</option>\n+\n+\n+              <option value="21">21</option>\n+\n+\n+              <option value="22">22</option>\n+\n+\n+              <option value="23">23</option>\n+\n+\n+              <option value="24">24</option>\n+\n+\n+              <option value="25">25</option>\n+\n+\n+              <option value="26">26</option>\n+\n+\n+              <option value="27">27</option>\n+\n+\n+              <option value="28">28</option>\n+\n+\n+              <option value="29">29</option>\n+\n+\n+              <option value="30">30</option>\n+\n+\n+              <option value="31">31</option>\n+\n+            </select>\n+\n+            <span class="separator">/</span>\n+\n+            <!-- month -->\n+            <select class="month"\n+                    id="endDate-month"\n+                    name="endDate-month"\n+            >\n+\n+              <option value="1">January</option>\n+\n+\n+              <option selected="selected"\n+                      value="2"\n+              >February</option>\n+\n+\n+              <option value="3">March</option>\n+\n+\n+              <option value="4">April</option>\n+\n+\n+              <option value="5">May</option>\n+\n+\n+              <option value="6">June</option>\n+\n+\n+              <option value="7">July</option>\n+\n+\n+              <option value="8">August</option>\n+\n+\n+              <option value="9">September</option>\n+\n+\n+              <option value="10">October</option>\n+\n+\n+              <option value="11">November</option>\n+\n+\n+              <option value="12">December</option>\n+\n+            </select>\n+\n+            <span class="separator">/</span>\n+\n+            <!-- year -->\n+            <select class="year"\n+                    id="endDate-year"\n+                    name="endDate-year"\n+            >\n+\n+              <option value="2000">2000</option>\n+\n+\n+              <option value="2001">2001</option>\n+\n+\n+              <option value="2002">2002</option>\n+\n+\n+              <option value="2003">2003</option>\n+\n+\n+              <option value="2004">2004</option>\n+\n+\n+              <option value="2005">2005</option>\n+\n+\n+              <option value="2006">2006</option>\n+\n+\n+              <option value="2007">2007</option>\n+\n+\n+              <option value="2008">2008</option>\n+\n+\n+              <option value="2009">2009</option>\n+\n+\n+              <option value="2010">2010</option>\n+\n+\n+              <option selected="selected"\n+                      value="2011"\n+              >2011</option>\n+\n+\n+              <option value="2012">2012</option>\n+\n+\n+              <option value="2013">2013</option>\n+\n+\n+              <option value="2014">2014</option>\n+\n \n-\t    <!-- Tests -->\n-    <script type="text/javascript" src="test_event.js"></script>\n+              <option value="2015">2015</option>\n \n-  </head>\n \n-  <body>\n-    <h1 id="qunit-header">plone.app.event Test Suite</h1>\n+              <option value="2016">2016</option>\n \n-    <h2 id="qunit-banner"></h2>\n \n-    <div id="qunit-testrunner-toolbar">\n-    </div>\n+              <option value="2017">2017</option>\n \n-    <h2 id="qunit-userAgent"></h2>\n \n-    <ol id="qunit-tests">\n-    </ol>\n+              <option value="2018">2018</option>\n+\n+\n+              <option value="2019">2019</option>\n+\n+            </select>\n+        &nbsp;\n+\n+            <input class="endDate-calendar date"\n+                   id="endDate"\n+                   name="endDate-calendar"\n+                   originalvalue=""\n+                   type="hidden"\n+            /><a class="caltrigger"\n+               href="#"\n+               style="width: 16px; vertical-align: middle; display: inline-block; background: url(&quot;popup_calendar.gif&quot;) repeat scroll 0% 0% transparent; height: 16px;"\n+            ></a>\n+            <script type="text/javascript">\n+                jQuery.tools.dateinput.localize("en", {months: "January,February,March,April,May,June,July,August,September,October,November,December",shortMonths: "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days: "Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday",shortDays: "Mon,Tue,Wed,Thu,Fri,Sat,Sun",});\n+                jQuery(".endDate-calendar").dateinput({lang: "en", value: new Date(2011, 1, 1, 17, 41), change: function() {\n+  var value = this.getValue();\n+  var parent = jQuery(this.getInput()).closest("div.DatetimeWidget");\n+  jQuery(parent).find(".year").val(value.getFullYear());\n+  jQuery(parent).find(".month").val(value.getMonth()+1);\n+  jQuery(parent).find(".day").val(value.getDate());\n+}, selectors: true, trigger: true, yearRange: [-10, 10]}).unbind(\'change\')\n+                    .bind(\'onShow\', function (event) {\n+                        var trigger_offset = jQuery(this).next().offset();\n+                        jQuery(this).data(\'dateinput\').getCalendar().offset(\n+                            {top: trigger_offset.top+20, left: trigger_offset.left}\n+                        );\n+                    });\n+                jQuery(".endDate-calendar").next().css({\'width\': \'16px\', \'vertical-align\': \'middle\', \'display\': \'inline-block\', \'background\': \'url(popup_calendar.gif)\', \'height\': \'16px\'});\n+\n+            </script>\n+\n+\n+            &nbsp;\n+            <span class="datetimewidget-time"\n+                  style=""\n+            >\n+\n+              <!-- hour -->\n+              <select class="hour"\n+                      id="endDate-hour"\n+                      name="endDate-hour"\n+              >\n+\n+                <option value="0">00</option>\n+\n+\n+                <option value="1">01</option>\n+\n \n-<div id="qunit-fixture">\n-<div id="event">\n-<div id="archetypes-fieldname-wholeDay" class="field ArchetypesBooleanWidget  kssattr-atfieldname-wholeDay">\n-          \n-        <input type="checkbox" id="wholeDay" name="wholeDay:boolean" value="on" class="noborder">\n-        <input type="hidden" name="wholeDay:boolean:default" value="" originalvalue="">\n-      \n-          <label for="wholeDay" class="formQuestion">Whole day event</label>\n-          \n-          <div id="wholeDay_help" class="formHelp"></div>\n-          \n-          <div class="fieldErrorBox"></div>\n-          <div></div>\n-        </div>\n-<div id="archetypes-fieldname-startDate" class="field Archetypes DatetimeWidget  kssattr-atfieldname-startDate">\n-\n-                <div class="fieldErrorBox"></div>\n-                <div>\n-    \n-        <!-- day -->\n-        <select name="startDate-day" id="startDate-day" class="day">\n-            \n-                <option value="1" selected="selected">01</option>\n-            \n-            \n                 <option value="2">02</option>\n-            \n-            \n+\n+\n                 <option value="3">03</option>\n-            \n-            \n+\n+\n                 <option value="4">04</option>\n-            \n-            \n+\n+\n                 <option value="5">05</option>\n-            \n-            \n+\n+\n                 <option value="6">06</option>\n-            \n-            \n+\n+\n                 <option value="7">07</option>\n-            \n-            \n+\n+\n                 <option value="8">08</option>\n-            \n-            \n+\n+\n                 <option value="9">09</option>\n-            \n-            \n+\n+\n                 <option value="10">10</option>\n-            \n-            \n+\n+\n                 <option value="11">11</option>\n-            \n-            \n+\n+\n                 <option value="12">12</option>\n-            \n-            \n+\n+\n                 <option value="13">13</option>\n-            \n-            \n+\n+\n                 <option value="14">14</option>\n-            \n-            \n+\n+\n                 <option value="15">15</option>\n-            \n-            \n+\n+\n                 <option value="16">16</option>\n-            \n-            \n-                <option value="17">17</option>\n-            \n-            \n+\n+\n+                <option selected="selected"\n+                        value="17"\n+                >17</option>\n+\n+\n                 <option value="18">18</option>\n-            \n-            \n+\n+\n                 <option value="19">19</option>\n-            \n-            \n+\n+\n                 <option value="20">20</option>\n-            \n-            \n+\n+\n                 <option value="21">21</option>\n-            \n-            \n-                <option value="22">22</option>\n-            \n-            \n-                <option value="23">23</option>\n-            \n-            \n-                <option value="24">24</option>\n-            \n-            \n-                <option value="25">25</option>\n-            \n-            \n-                <option value="26">26</option>\n-            \n-            \n-                <option value="27">27</option>\n-            \n-            \n-                <option value="28">28</option>\n-            \n-            \n-                <option value="29">29</option>\n-            \n-            \n-                <option value="30">30</option>\n-            \n-            \n-                <option value="31">31</option>\n-            \n-        </select>\n-\n-        <span class="separator">/</span>\n-\n-        <!-- month -->\n-        <select class="month" name="startDate-month" id="startDate-month">\n-        \n-            <option value="1">January</option>\n-        \n-        \n-            <option value="2" selected="selected">February</option>\n-        \n-        \n-            <option value="3">March</option>\n-        \n-        \n-            <option value="4">April</option>\n-        \n-        \n-            <option value="5">May</option>\n-        \n-        \n-            <option value="6">June</option>\n-        \n-        \n-            <option value="7">July</option>\n-        \n-        \n-            <option value="8">August</option>\n-        \n-        \n-            <option value="9">September</option>\n-        \n-        \n-            <option value="10">October</option>\n-        \n-        \n-            <option value="11">November</option>\n-        \n-        \n-            <option value="12">December</option>\n-        \n-        </select>\n-\n-        <span class="separator">/</span>\n-\n-        <!-- year -->\n-        <select name="startDate-year" id="startDate-year" class="year">\n-            \n-                <option value="2000">2000</option>\n-            \n-            \n-                <option value="2001">2001</option>\n-            \n-            \n-                <option value="2002">2002</option>\n-            \n-            \n-                <option value="2003">2003</option>\n-            \n-            \n-                <option value="2004">2004</option>\n-            \n-            \n-                <option value="2005">2005</option>\n-            \n-            \n-                <option value="2006">2006</option>\n-            \n-            \n-                <option value="2007">2007</option>\n-            \n-            \n-                <option value="2008">2008</option>\n-            \n-            \n-                <option value="2009">2009</option>\n-            \n-            \n-                <option value="2010">2010</option>\n-            \n-            \n-                <option value="2011" selected="selected">2011</option>\n-            \n-            \n-                <option value="2012">2012</option>\n-            \n-            \n-                <option value="2013">2013</option>\n-            \n-            \n-                <option value="2014">2014</option>\n-            \n-            \n-                <option value="2015">2015</option>\n-            \n-            \n-                <option value="2016">2016</option>\n-            \n-            \n-                <option value="2017">2017</option>\n-            \n-            \n-                <option value="2018">2018</option>\n-            \n-            \n-                <option value="2019">2019</option>\n-            \n-        </select>\n-        &nbsp;\n-        \n-            <input type="hidden" class="startDate-calendar date" name="startDate-calendar" id="startDate" originalvalue=""><a href="#" class="caltrigger" style="width: 16px; vertical-align: middle; display: inline-block; background: url(&quot;popup_calendar.gif&quot;) repeat scroll 0% 0% transparent; height: 16px;"></a>\n-            <script type="text/javascript">\n-                jQuery.tools.dateinput.localize("en", {months: "January,February,March,April,May,June,July,August,September,October,November,December",shortMonths: "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days: "Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday",shortDays: "Mon,Tue,Wed,Thu,Fri,Sat,Sun",});\n-                jQuery(".startDate-calendar").dateinput({lang: "en", value: new Date(2011, 1, 1, 16, 41), change: function() {\n-  var value = this.getValue();\n-  var parent = jQuery(this.getInput()).closest("div.DatetimeWidget");\n-  jQuery(parent).find(".year").val(value.getFullYear());\n-  jQuery(parent).find(".month").val(value.getMonth()+1);\n-  jQuery(parent).find(".day").val(value.getDate());\n-}, selectors: true, trigger: true, yearRange: [-10, 10]}).unbind(\'change\')\n-                    .bind(\'onShow\', function (event) {\n-                        var trigger_offset = jQuery(this).next().offset();\n-                        jQuery(this).data(\'dateinput\').getCalendar().offset(\n-                            {top: trigger_offset.top+20, left: trigger_offset.left}\n-                        );\n-                    });\n-                jQuery(".startDate-calendar").next().css({\'width\': \'16px\', \'vertical-align\': \'middle\', \'display\': \'inline-block\', \'background\': \'url(popup_calendar.gif)\', \'height\': \'16px\'});\n \n-            </script>\n \n-        \n-            &nbsp;\n-            <span style="" class="datetimewidget-time">\n-\n-                <!-- hour -->\n-                <select name="startDate-hour" id="startDate-hour" class="hour">\n-                    \n-                        <option value="0">00</option>\n-                    \n-                    \n-                        <option value="1">01</option>\n-                    \n-                    \n-                        <option value="2">02</option>\n-                    \n-                    \n-                        <option value="3">03</option>\n-                    \n-                    \n-                        <option value="4">04</option>\n-                    \n-                    \n-                        <option value="5">05</option>\n-                    \n-                    \n-                        <option value="6">06</option>\n-                    \n-                    \n-                        <option value="7">07</option>\n-                    \n-                    \n-                        <option value="8">08</option>\n-                    \n-                    \n-                        <option value="9">09</option>\n-                    \n-                    \n-                        <option value="10">10</option>\n-                    \n-                    \n-                        <option value="11">11</option>\n-                    \n-                    \n-                        <option value="12">12</option>\n-                    \n-                    \n-                        <option value="13">13</option>\n-                    \n-                    \n-                        <option value="14">14</option>\n-                    \n-                    \n-                        <option value="15">15</option>\n-                    \n-                    \n-                        <option value="16" selected="selected">16</option>\n-                    \n-                    \n-                        <option value="17">17</option>\n-                    \n-                    \n-                        <option value="18">18</option>\n-                    \n-                    \n-                        <option value="19">19</option>\n-                    \n-                    \n-                        <option value="20">20</option>\n-                    \n-                    \n-                        <option value="21">21</option>\n-                    \n-                    \n-                        <option value="22">22</option>\n-                    \n-                    \n-                        <option value="23">23</option>\n-                    \n-                </select>\n-                \n-                <!-- minute -->\n-                <select name="startDate-min" id="startDate-min" class="min">\n-                    \n-                        <option value="0">00</option>\n-                    \n-                    \n-                        <option value="1">01</option>\n-                    \n-                    \n-                        <option value="2">02</option>\n-                    \n-                    \n-                        <option value="3">03</option>\n-                    \n-                    \n-                        <option value="4">04</option>\n-                    \n-                    \n-                        <option value="5">05</option>\n-                    \n-                    \n-                        <option value="6">06</option>\n-                    \n-                    \n-                        <option value="7">07</option>\n-                    \n-                    \n-                        <option value="8">08</option>\n-                    \n-                    \n-                        <option value="9">09</option>\n-                    \n-                    \n-                        <option value="10">10</option>\n-                    \n-                    \n-                        <option value="11">11</option>\n-                    \n-                    \n-                        <option value="12">12</option>\n-                    \n-                    \n-                        <option value="13">13</option>\n-                    \n-                    \n-                        <option value="14">14</option>\n-                    \n-                    \n-                        <option value="15">15</option>\n-                    \n-                    \n-                        <option value="16">16</option>\n-                    \n-                    \n-                        <option value="17">17</option>\n-                    \n-                    \n-                        <option value="18">18</option>\n-                    \n-                    \n-                        <option value="19">19</option>\n-                    \n-                    \n-                        <option value="20">20</option>\n-                    \n-                    \n-                        <option value="21">21</option>\n-                    \n-                    \n-                        <option value="22">22</option>\n-                    \n-                    \n-                        <option value="23">23</option>\n-                    \n-                    \n-                        <option value="24">24</option>\n-                    \n-                    \n-                        <option value="25">25</option>\n-                    \n-                    \n-                        <option value="26">26</option>\n-                    \n-                    \n-                        <option value="27">27</option>\n-                    \n-                    \n-                        <option value="28">28</option>\n-                    \n-                    \n-                        <option value="29">29</option>\n-                    \n-                    \n-                        <option value="30">30</option>\n-                    \n-                    \n-                        <option value="31">31</option>\n-                    \n-                    \n-                        <option value="32">32</option>\n-                    \n-                    \n-                        <option value="33">33</option>\n-                    \n-                    \n-                        <option value="34">34</option>\n-                    \n-                    \n-                        <option value="35">35</option>\n-                    \n-                    \n-                        <option value="36">36</option>\n-                    \n-                    \n-                        <option value="37">37</option>\n-                    \n-                    \n-                        <option value="38">38</option>\n-                    \n-                    \n-                        <option value="39">39</option>\n-                    \n-                    \n-                        <option value="40">40</option>\n-                    \n-                    \n-                        <option value="41" selected="selected">41</option>\n-                    \n-                    \n-                        <option value="42">42</option>\n-                    \n-                    \n-                        <option value="43">43</option>\n-                    \n-                    \n-                        <option value="44">44</option>\n-                    \n-                    \n-                        <option value="45">45</option>\n-                    \n-                    \n-                        <option value="46">46</option>\n-                    \n-                    \n-                        <option value="47">47</option>\n-                    \n-                    \n-                        <option value="48">48</option>\n-                    \n-                    \n-                        <option value="49">49</option>\n-                    \n-                    \n-                        <option value="50">50</option>\n-                    \n-                    \n-                        <option value="51">51</option>\n-                    \n-                    \n-                        <option value="52">52</option>\n-                    \n-                    \n-                        <option value="53">53</option>\n-                    \n-                    \n-                        <option value="54">54</option>\n-                    \n-                    \n-                        <option value="55">55</option>\n-                    \n-                    \n-                        <option value="56">56</option>\n-                    \n-                    \n-                        <option value="57">57</option>\n-                    \n-                    \n-                        <option value="58">58</option>\n-                    \n-                    \n-                        <option value="59">59</option>\n-                    \n-                </select>\n-\n-                <!-- am/pm -->\n-                \n+                <option value="22">22</option>\n \n-            </span>\n \n-        \n+                <option value="23">23</option>\n+\n+              </select>\n \n-        <input type="hidden" value="1" name="startDate-empty-marker" originalvalue="1">\n+              <!-- minute -->\n+              <select class="min"\n+                      id="endDate-min"\n+                      name="endDate-min"\n+              >\n \n-        \n+                <option value="0">00</option>\n \n-    </div>\n-  </div>\n \n+                <option value="1">01</option>\n \n-<div id="archetypes-fieldname-endDate" class="field Archetypes DatetimeWidget  kssattr-atfieldname-endDate">\n \n-                <div class="fieldErrorBox"></div>\n-                <div>\n-    \n-        <!-- day -->\n-        <select name="endDate-day" id="endDate-day" class="day">\n-            \n-                <option value="1" selected="selected">01</option>\n-            \n-            \n                 <option value="2">02</option>\n-            \n-            \n+\n+\n                 <option value="3">03</option>\n-            \n-            \n+\n+\n                 <option value="4">04</option>\n-            \n-            \n+\n+\n                 <option value="5">05</option>\n-            \n-            \n+\n+\n                 <option value="6">06</option>\n-            \n-            \n+\n+\n                 <option value="7">07</option>\n-            \n-            \n+\n+\n                 <option value="8">08</option>\n-            \n-            \n+\n+\n                 <option value="9">09</option>\n-            \n-            \n+\n+\n                 <option value="10">10</option>\n-            \n-            \n+\n+\n                 <option value="11">11</option>\n-            \n-            \n+\n+\n                 <option value="12">12</option>\n-            \n-            \n+\n+\n                 <option value="13">13</option>\n-            \n-            \n+\n+\n                 <option value="14">14</option>\n-            \n-            \n+\n+\n                 <option value="15">15</option>\n-            \n-            \n+\n+\n                 <option value="16">16</option>\n-            \n-            \n+\n+\n                 <option value="17">17</option>\n-            \n-            \n+\n+\n                 <option value="18">18</option>\n-            \n-            \n+\n+\n                 <option value="19">19</option>\n-            \n-            \n+\n+\n                 <option value="20">20</option>\n-            \n-            \n+\n+\n                 <option value="21">21</option>\n-            \n-            \n+\n+\n                 <option value="22">22</option>\n-            \n-            \n+\n+\n                 <option value="23">23</option>\n-            \n-            \n+\n+\n                 <option value="24">24</option>\n-            \n-            \n+\n+\n                 <option value="25">25</option>\n-            \n-            \n+\n+\n                 <option value="26">26</option>\n-            \n-            \n+\n+\n                 <option value="27">27</option>\n-            \n-            \n+\n+\n                 <option value="28">28</option>\n-            \n-            \n+\n+\n                 <option value="29">29</option>\n-            \n-            \n+\n+\n                 <option value="30">30</option>\n-            \n-            \n+\n+\n                 <option value="31">31</option>\n-            \n-        </select>\n-\n-        <span class="separator">/</span>\n-\n-        <!-- month -->\n-        <select class="month" name="endDate-month" id="endDate-month">\n-        \n-            <option value="1">January</option>\n-        \n-        \n-            <option value="2" selected="selected">February</option>\n-        \n-        \n-            <option value="3">March</option>\n-        \n-        \n-            <option value="4">April</option>\n-        \n-        \n-            <option value="5">May</option>\n-        \n-        \n-            <option value="6">June</option>\n-        \n-        \n-            <option value="7">July</option>\n-        \n-        \n-            <option value="8">August</option>\n-        \n-        \n-            <option value="9">September</option>\n-        \n-        \n-            <option value="10">October</option>\n-        \n-        \n-            <option value="11">November</option>\n-        \n-        \n-            <option value="12">December</option>\n-        \n-        </select>\n-\n-        <span class="separator">/</span>\n-\n-        <!-- year -->\n-        <select name="endDate-year" id="endDate-year" class="year">\n-            \n-                <option value="2000">2000</option>\n-            \n-            \n-                <option value="2001">2001</option>\n-            \n-            \n-                <option value="2002">2002</option>\n-            \n-            \n-                <option value="2003">2003</option>\n-            \n-            \n-                <option value="2004">2004</option>\n-            \n-            \n-                <option value="2005">2005</option>\n-            \n-            \n-                <option value="2006">2006</option>\n-            \n-            \n-                <option value="2007">2007</option>\n-            \n-            \n-                <option value="2008">2008</option>\n-            \n-            \n-                <option value="2009">2009</option>\n-            \n-            \n-                <option value="2010">2010</option>\n-            \n-            \n-                <option value="2011" selected="selected">2011</option>\n-            \n-            \n-                <option value="2012">2012</option>\n-            \n-            \n-                <option value="2013">2013</option>\n-            \n-            \n-                <option value="2014">2014</option>\n-            \n-            \n-                <option value="2015">2015</option>\n-            \n-            \n-                <option value="2016">2016</option>\n-            \n-            \n-                <option value="2017">2017</option>\n-            \n-            \n-                <option value="2018">2018</option>\n-            \n-            \n-                <option value="2019">2019</option>\n-            \n-        </select>\n-        &nbsp;\n-        \n-            <input type="hidden" class="endDate-calendar date" name="endDate-calendar" id="endDate" originalvalue=""><a href="#" class="caltrigger" style="width: 16px; vertical-align: middle; display: inline-block; background: url(&quot;popup_calendar.gif&quot;) repeat scroll 0% 0% transparent; height: 16px;"></a>\n-            <script type="text/javascript">\n-                jQuery.tools.dateinput.localize("en", {months: "January,February,March,April,May,June,July,August,September,October,November,December",shortMonths: "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days: "Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday",shortDays: "Mon,Tue,Wed,Thu,Fri,Sat,Sun",});\n-                jQuery(".endDate-calendar").dateinput({lang: "en", value: new Date(2011, 1, 1, 17, 41), change: function() {\n-  var value = this.getValue();\n-  var parent = jQuery(this.getInput()).closest("div.DatetimeWidget");\n-  jQuery(parent).find(".year").val(value.getFullYear());\n-  jQuery(parent).find(".month").val(value.getMonth()+1);\n-  jQuery(parent).find(".day").val(value.getDate());\n-}, selectors: true, trigger: true, yearRange: [-10, 10]}).unbind(\'change\')\n-                    .bind(\'onShow\', function (event) {\n-                        var trigger_offset = jQuery(this).next().offset();\n-                        jQuery(this).data(\'dateinput\').getCalendar().offset(\n-                            {top: trigger_offset.top+20, left: trigger_offset.left}\n-                        );\n-                    });\n-                jQuery(".endDate-calendar").next().css({\'width\': \'16px\', \'vertical-align\': \'middle\', \'display\': \'inline-block\', \'background\': \'url(popup_calendar.gif)\', \'height\': \'16px\'});\n \n-            </script>\n \n-        \n-            &nbsp;\n-            <span style="" class="datetimewidget-time">\n-\n-                <!-- hour -->\n-                <select name="endDate-hour" id="endDate-hour" class="hour">\n-                    \n-                        <option value="0">00</option>\n-                    \n-                    \n-                        <option value="1">01</option>\n-                    \n-                    \n-                        <option value="2">02</option>\n-                    \n-                    \n-                        <option value="3">03</option>\n-                    \n-                    \n-                        <option value="4">04</option>\n-                    \n-                    \n-                        <option value="5">05</option>\n-                    \n-                    \n-                        <option value="6">06</option>\n-                    \n-                    \n-                        <option value="7">07</option>\n-                    \n-                    \n-                        <option value="8">08</option>\n-                    \n-                    \n-                        <option value="9">09</option>\n-                    \n-                    \n-                        <option value="10">10</option>\n-                    \n-                    \n-                        <option value="11">11</option>\n-                    \n-                    \n-                        <option value="12">12</option>\n-                    \n-                    \n-                        <option value="13">13</option>\n-                    \n-                    \n-                        <option value="14">14</option>\n-                    \n-                    \n-                        <option value="15">15</option>\n-                    \n-                    \n-                        <option value="16">16</option>\n-                    \n-                    \n-                        <option value="17" selected="selected">17</option>\n-                    \n-                    \n-                        <option value="18">18</option>\n-                    \n-                    \n-                        <option value="19">19</option>\n-                    \n-                    \n-                        <option value="20">20</option>\n-                    \n-                    \n-                        <option value="21">21</option>\n-                    \n-                    \n-                        <option value="22">22</option>\n-                    \n-                    \n-                        <option value="23">23</option>\n-                    \n-                </select>\n-                \n-                <!-- minute -->\n-                <select name="endDate-min" id="endDate-min" class="min">\n-                    \n-                        <option value="0">00</option>\n-                    \n-                    \n-                        <option value="1">01</option>\n-                    \n-                    \n-                        <option value="2">02</option>\n-                    \n-                    \n-                        <option value="3">03</option>\n-                    \n-                    \n-                        <option value="4">04</option>\n-                    \n-                    \n-                        <option value="5">05</option>\n-                    \n-                    \n-                        <option value="6">06</option>\n-                    \n-                    \n-                        <option value="7">07</option>\n-                    \n-                    \n-                        <option value="8">08</option>\n-                    \n-                    \n-                        <option value="9">09</option>\n-                    \n-                    \n-                        <option value="10">10</option>\n-                    \n-                    \n-                        <option value="11">11</option>\n-                    \n-                    \n-                        <option value="12">12</option>\n-                    \n-                    \n-                        <option value="13">13</option>\n-                    \n-                    \n-                        <option value="14">14</option>\n-                    \n-                    \n-                        <option value="15">15</option>\n-                    \n-                    \n-                        <option value="16">16</option>\n-                    \n-                    \n-                        <option value="17">17</option>\n-                    \n-                    \n-                        <option value="18">18</option>\n-                    \n-                    \n-                        <option value="19">19</option>\n-                    \n-                    \n-                        <option value="20">20</option>\n-                    \n-                    \n-                        <option value="21">21</option>\n-                    \n-                    \n-                        <option value="22">22</option>\n-                    \n-                    \n-                        <option value="23">23</option>\n-                    \n-                    \n-                        <option value="24">24</option>\n-                    \n-                    \n-                        <option value="25">25</option>\n-                    \n-                    \n-                        <option value="26">26</option>\n-                    \n-                    \n-                        <option value="27">27</option>\n-                    \n-                    \n-                        <option value="28">28</option>\n-                    \n-                    \n-                        <option value="29">29</option>\n-                    \n-                    \n-                        <option value="30">30</option>\n-                    \n-                    \n-                        <option value="31">31</option>\n-                    \n-                    \n-                        <option value="32">32</option>\n-                    \n-                    \n-                        <option value="33">33</option>\n-                    \n-                    \n-                        <option value="34">34</option>\n-                    \n-                    \n-                        <option value="35">35</option>\n-                    \n-                    \n-                        <option value="36">36</option>\n-                    \n-                    \n-                        <option value="37">37</option>\n-                    \n-                    \n-                        <option value="38">38</option>\n-                    \n-                    \n-                        <option value="39">39</option>\n-                    \n-                    \n-                        <option value="40">40</option>\n-                    \n-                    \n-                        <option value="41" selected="selected">41</option>\n-                    \n-                    \n-                        <option value="42">42</option>\n-                    \n-                    \n-                        <option value="43">43</option>\n-                    \n-                    \n-                        <option value="44">44</option>\n-                    \n-                    \n-                        <option value="45">45</option>\n-                    \n-                    \n-                        <option value="46">46</option>\n-                    \n-                    \n-                        <option value="47">47</option>\n-                    \n-                    \n-                        <option value="48">48</option>\n-                    \n-                    \n-                        <option value="49">49</option>\n-                    \n-                    \n-                        <option value="50">50</option>\n-                    \n-                    \n-                        <option value="51">51</option>\n-                    \n-                    \n-                        <option value="52">52</option>\n-                    \n-                    \n-                        <option value="53">53</option>\n-                    \n-                    \n-                        <option value="54">54</option>\n-                    \n-                    \n-                        <option value="55">55</option>\n-                    \n-                    \n-                        <option value="56">56</option>\n-                    \n-                    \n-                        <option value="57">57</option>\n-                    \n-                    \n-                        <option value="58">58</option>\n-                    \n-                    \n-                        <option value="59">59</option>\n-                    \n-                </select>\n-\n-                <!-- am/pm -->\n-                \n+                <option value="32">32</option>\n+\n+\n+                <option value="33">33</option>\n+\n+\n+                <option value="34">34</option>\n+\n+\n+                <option value="35">35</option>\n+\n+\n+                <option value="36">36</option>\n+\n+\n+                <option value="37">37</option>\n+\n+\n+                <option value="38">38</option>\n+\n+\n+                <option value="39">39</option>\n+\n+\n+                <option value="40">40</option>\n+\n+\n+                <option selected="selected"\n+                        value="41"\n+                >41</option>\n+\n+\n+                <option value="42">42</option>\n+\n+\n+                <option value="43">43</option>\n+\n+\n+                <option value="44">44</option>\n+\n+\n+                <option value="45">45</option>\n+\n+\n+                <option value="46">46</option>\n+\n+\n+                <option value="47">47</option>\n+\n+\n+                <option value="48">48</option>\n+\n+\n+                <option value="49">49</option>\n+\n+\n+                <option value="50">50</option>\n+\n+\n+                <option value="51">51</option>\n+\n+\n+                <option value="52">52</option>\n+\n+\n+                <option value="53">53</option>\n+\n+\n+                <option value="54">54</option>\n+\n+\n+                <option value="55">55</option>\n+\n+\n+                <option value="56">56</option>\n+\n+\n+                <option value="57">57</option>\n+\n+\n+                <option value="58">58</option>\n+\n+\n+                <option value="59">59</option>\n+\n+              </select>\n+\n+              <!-- am/pm -->\n+\n \n             </span>\n \n-        \n \n-        <input type="hidden" value="1" name="endDate-empty-marker" originalvalue="1">\n \n-        \n+            <input name="endDate-empty-marker"\n+                   originalvalue="1"\n+                   type="hidden"\n+                   value="1"\n+            />\n+\n \n-    </div>\n-  </div>\n \n-</div>\n-</div>\n+          </div>\n+        </div>\n+\n+      </div>\n+    </div>\n     <!-- plone.app.event -->\n-    <script type="text/javascript" src="../../browser/event.js">\n+    <script src="../../browser/event.js"\n+            type="text/javascript"\n+    >\n     </script>\n   </body>\n \n </html>\n-\ndiff --git a/plone/app/event/tests/qunit/qunit.js b/plone/app/event/tests/qunit/qunit.js\nindex 30e03953f..b3dd1fcaf 100644\n--- a/plone/app/event/tests/qunit/qunit.js\n+++ b/plone/app/event/tests/qunit/qunit.js\n@@ -282,7 +282,7 @@ var QUnit = {\n \t},\n \t\n \t/**\n-\t * Specify the number of expected assertions to gurantee that failed test (no assertions are run at all) don\'t slip through.\n+\t * Specify the number of expected assertions to guarantee that failed test (no assertions are run at all) don\'t slip through.\n \t */\n \texpect: function(asserts) {\n \t\tconfig.current.expected = asserts;\n@@ -310,7 +310,7 @@ var QUnit = {\n \t * Checks that the first two arguments are equal, with an optional message.\n \t * Prints out both actual and expected values.\n \t *\n-\t * Prefered to ok( actual == expected, message )\n+\t * Preferred to ok( actual == expected, message )\n \t *\n \t * @example equal( format("Received {0} bytes.", 2), "Received 2 bytes." );\n \t *\n@@ -429,7 +429,7 @@ var config = {\n \tblocking: true\n };\n \n-// Load paramaters\n+// Load parameters\n (function() {\n \tvar location = window.location || { search: "", protocol: "file:" },\n \t\tGETParams = location.search.slice(1).split(\'&\');\n@@ -945,7 +945,7 @@ QUnit.equiv = function () {\n         // for string, boolean, number and null\n         function useStrictEquality(b, a) {\n             if (b instanceof a.constructor || a instanceof b.constructor) {\n-                // to catch short annotaion VS \'new\' annotation of a declaration\n+                // to catch short annotation VS \'new\' annotation of a declaration\n                 // e.g. var i = 1;\n                 //      var j = new Number(1);\n                 return a == b;\n@@ -972,7 +972,7 @@ QUnit.equiv = function () {\n             "regexp": function (b, a) {\n                 return QUnit.objectType(b) === "regexp" &&\n                     a.source === b.source && // the regex itself\n-                    a.global === b.global && // and its modifers (gmi) ...\n+                    a.global === b.global && // and its modifiers (gmi) ...\n                     a.ignoreCase === b.ignoreCase &&\n                     a.multiline === b.multiline;\n             },\n@@ -1020,7 +1020,7 @@ QUnit.equiv = function () {\n \n             "object": function (b, a) {\n                 var i, j, loop;\n-                var eq = true; // unless we can proove it\n+                var eq = true; // unless we can prove it\n                 var aProperties = [], bProperties = []; // collection of strings\n \n                 // comparing constructors is more strict than using instanceof\ndiff --git a/plone/app/event/tests/test_base_module.py b/plone/app/event/tests/test_base_module.py\nindex 34395d332..74fc78cf8 100644\n--- a/plone/app/event/tests/test_base_module.py\n+++ b/plone/app/event/tests/test_base_module.py\n@@ -453,7 +453,6 @@ class TestGetEventsDX(AbstractSampleDataEvents):\n     layer = PAEventDX_INTEGRATION_TESTING\n \n     def test_get_events(self):\n-\n         # whole range\n         res = get_events(self.portal)\n         self.assertEqual(len(res), 4)\n@@ -618,7 +617,7 @@ def _num_events(values):\n         # Test with range\n         #\n \n-        # Completly outside range and start, end given as datetime\n+        # Completely outside range and start, end given as datetime\n         cal = construct_calendar(\n             res, start=datetime(2000, 1, 1, 10, 0), end=datetime(2000, 1, 2, 10, 0)\n         )\n@@ -784,16 +783,6 @@ def test_expand_future_event(self):\n             "2014-05-08 10:00:00",\n             "2014-05-08 11:00:00",\n         )  # second recurrence\n-        rec3 = (\n-            "Next year",\n-            "2014-05-09 10:00:00",\n-            "2014-05-09 11:00:00",\n-        )  # third recurrence\n-        rec4 = (\n-            "Next year",\n-            "2014-05-10 10:00:00",\n-            "2014-05-10 11:00:00",\n-        )  # fourth recurrence\n \n         # expand_events from today+200 until today+300\n         res = self.fmt(\ndiff --git a/plone/app/event/tests/test_dx_behaviors.py b/plone/app/event/tests/test_dx_behaviors.py\nindex 9e0fcaf4d..22a830cf4 100644\n--- a/plone/app/event/tests/test_dx_behaviors.py\n+++ b/plone/app/event/tests/test_dx_behaviors.py\n@@ -435,7 +435,6 @@ def test_recurrence_indexing(self):\n \n \n class TestDXEventRecurrence(unittest.TestCase):\n-\n     layer = PAEventDX_INTEGRATION_TESTING\n \n     def test_recurrence(self):\n@@ -476,7 +475,7 @@ def test_validate_invariants_ok(self):\n \n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n     def test_validate_invariants_fail(self):\n@@ -499,7 +498,7 @@ def test_validate_invariants_edge(self):\n \n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n     def test_validate_invariants_openend(self):\n@@ -510,7 +509,7 @@ def test_validate_invariants_openend(self):\n \n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n     def test_validate_dont_validate_incomplete(self):\n@@ -524,21 +523,21 @@ def test_validate_dont_validate_incomplete(self):\n         mock.end = None\n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n         mock.start = None\n         mock.end = datetime(2016, 5, 18)\n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n         mock.start = None\n         mock.end = None\n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n \ndiff --git a/plone/app/event/tests/test_event_listing.py b/plone/app/event/tests/test_event_listing.py\nindex b40a5bb2d..5eb94662a 100644\n--- a/plone/app/event/tests/test_event_listing.py\n+++ b/plone/app/event/tests/test_event_listing.py\n@@ -63,7 +63,7 @@ def _collection_batching_base(self):\n         """Base preparation for batching tests below.\n \n         The event_listing view caches it\'s results on the request, so the\n-        batching tests below need to be in seperate test methods to get a fresh\n+        batching tests below need to be in separate test methods to get a fresh\n         environment with newly calculated results.\n         """\n         # plone.app.contenttypes ICollection type\n@@ -102,7 +102,7 @@ def test_collection_batching__reduce_by_request_parameter(self):\n \n     def test_date_filtering(self):\n         """Test if date filters are available on Collections without start or\n-        end search criterias.\n+        end search criteria.\n         """\n         # plone.app.contenttypes ICollection type\n         self.portal.invokeFactory(\n@@ -124,7 +124,7 @@ def test_date_filtering(self):\n \n     def test_no_date_filtering(self):\n         """Test if date filters are not available on Collections with start or\n-        end search criterias.\n+        end search criteria.\n         """\n         # plone.app.contenttypes ICollection type\n         self.portal.invokeFactory("Collection", "col_with_date_criterion", title="Col")\ndiff --git a/plone/app/event/tests/test_ical_import.py b/plone/app/event/tests/test_ical_import.py\nindex 05e0beb80..0e5fd7ae9 100644\n--- a/plone/app/event/tests/test_ical_import.py\n+++ b/plone/app/event/tests/test_ical_import.py\n@@ -12,7 +12,6 @@\n \n \n class TestICALImportSettings(unittest.TestCase):\n-\n     layer = PAEventDX_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/event/tests/test_icalendar.py b/plone/app/event/tests/test_icalendar.py\nindex 87269c0c0..c68e4adaa 100644\n--- a/plone/app/event/tests/test_icalendar.py\n+++ b/plone/app/event/tests/test_icalendar.py\n@@ -87,7 +87,7 @@ def test_event_ical(self):\n         )\n \n     def test_event_occurrence_ical(self):\n-        """A event occurrence should not conain recurrence definitions from\n+        """A event occurrence should not contain recurrence definitions from\n         it\'s parent.\n         """\n         headers, output, request = make_fake_response(self.request)\ndiff --git a/plone/app/event/tests/test_portlet_events.py b/plone/app/event/tests/test_portlet_events.py\nindex a2e0a8e63..0ce521935 100644\n--- a/plone/app/event/tests/test_portlet_events.py\n+++ b/plone/app/event/tests/test_portlet_events.py\n@@ -24,7 +24,6 @@\n from zope.component.hooks import setSite\n from zope.interface import alsoProvides\n \n-import pytz\n import unittest\n \n \ndiff --git a/plone/app/event/tests/test_recurrence.py b/plone/app/event/tests/test_recurrence.py\nindex eedc5a883..21e5a1cdd 100644\n--- a/plone/app/event/tests/test_recurrence.py\n+++ b/plone/app/event/tests/test_recurrence.py\n@@ -289,7 +289,6 @@ class MockEvent(SimpleItem):\n \n \n class TestRecurrenceSupport(unittest.TestCase):\n-\n     layer = PAEvent_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/event/upgrades/configure.zcml b/plone/app/event/upgrades/configure.zcml\nindex a51738675..0d7bc8f96 100644\n--- a/plone/app/event/upgrades/configure.zcml\n+++ b/plone/app/event/upgrades/configure.zcml\n@@ -1,31 +1,32 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:genericsetup="http://namespaces.zope.org/genericsetup">\n+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n+    >\n \n   <genericsetup:upgradeStep\n-      source="12"\n-      destination="13"\n       title="New IRichText behavior"\n       description="Enable the new IRichText instead of the IEventSummary behavior."\n       profile="plone.app.event:default"\n+      source="12"\n+      destination="13"\n       handler=".upgrades.enable_richtext_behavior"\n       />\n \n   <genericsetup:upgradeStep\n-      source="12"\n-      destination="13"\n       title="Attribute storage"\n       description="Migrate fields from annotation storage to attribute storage."\n       profile="plone.app.event:default"\n+      source="12"\n+      destination="13"\n       handler=".upgrades.upgrade_attribute_storage"\n       />\n \n   <genericsetup:upgradeStep\n-      source="14"\n-      destination="15"\n       title="Remove object-action event_listing_settings"\n       description=""\n       profile="plone.app.event:default"\n+      source="14"\n+      destination="15"\n       handler=".upgrades.remove_event_listing_settings"\n       />\n \ndiff --git a/plone/app/event/upgrades/upgrades.py b/plone/app/event/upgrades/upgrades.py\nindex a716af579..44c97bfcb 100644\n--- a/plone/app/event/upgrades/upgrades.py\n+++ b/plone/app/event/upgrades/upgrades.py\n@@ -51,7 +51,7 @@ def upgrade_attribute_storage(context):\n     for result in results:\n         try:\n             event = result.getObject()\n-        except:\n+        except Exception:\n             log.warning(\n                 "Not possible to fetch event object from catalog result for "\n                 "item: {}.".format(result.getPath())\n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2023-03-27T14:59:20+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.event/commit/ac3286e9ea5cb9d7b53ebb838d46ee2815a40d18

fix tests after zpretty

Files changed:
M plone/app/event/tests/test_event_summary.py
M plone/app/event/tests/test_event_view.py

b'diff --git a/plone/app/event/tests/test_event_summary.py b/plone/app/event/tests/test_event_summary.py\nindex 3a3a5587..2dab576e 100644\n--- a/plone/app/event/tests/test_event_summary.py\n+++ b/plone/app/event/tests/test_event_summary.py\n@@ -20,7 +20,8 @@ def test_event_summary__non_recurring(self):\n         output = view()\n \n         self.assertTrue("2013-05-15" in output)\n-        self.assertTrue("(Europe/Vienna / UTC200)" in output)\n+        self.assertTrue("Europe/Vienna" in output)\n+        self.assertTrue("UTC200" in output)\n         self.assertTrue("Graz" in output)\n         self.assertTrue("All dates" not in output)\n \ndiff --git a/plone/app/event/tests/test_event_view.py b/plone/app/event/tests/test_event_view.py\nindex 7b081cb6..e8a2ec13 100644\n--- a/plone/app/event/tests/test_event_view.py\n+++ b/plone/app/event/tests/test_event_view.py\n@@ -20,7 +20,8 @@ def test_event_view__non_recurring(self):\n \n         self.assertTrue("Future Event" in output)\n         self.assertTrue("2013-05-15" in output)\n-        self.assertTrue("(Europe/Vienna / UTC200)" in output)\n+        self.assertTrue("Europe/Vienna" in output)\n+        self.assertTrue("UTC200" in output)\n         self.assertTrue("Graz" in output)\n         self.assertTrue("All dates" not in output)\n \n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2023-03-27T16:00:11+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.event/commit/9c5bca28d75b36f50b8888e0558457e3c3bf9e88

add mandatory files for plone/meta

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
M .gitignore

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 00000000..b4158b89\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.gitignore b/.gitignore\nindex ec3efba4..4111b91a 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -4,7 +4,6 @@\n *.sw?\n *.wpr\n *~\n-.*\n bin/\n coverage/\n dev/\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 00000000..5848075c\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "e380661b"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 00000000..449e951a\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2023-03-27T17:48:05+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.event/commit/b5604f9070410807afb17d8bb241266e565cd755

Merge pull request #368 from plone/plone/meta

Config with `plone/meta`

Files changed:
A .editorconfig
A .meta.toml
A .pre-commit-config.yaml
A news/e380661b.internal
A tox.ini
M .gitignore
M CHANGES.rst
M docs/architectural-overview.rst
M docs/conf.py
M docs/designchoices.rst
M docs/index.rst
M plone/app/event/base.py
M plone/app/event/browser/configure.zcml
M plone/app/event/browser/event_listing.pt
M plone/app/event/browser/event_summary.pt
M plone/app/event/browser/event_view.pt
M plone/app/event/browser/formatted_date.pt
M plone/app/event/browser/formatted_start_date.pt
M plone/app/event/configure.zcml
M plone/app/event/dx/configure.zcml
M plone/app/event/dx/ical.zcml
M plone/app/event/ical/__init__.py
M plone/app/event/ical/configure.zcml
M plone/app/event/ical/exporter.py
M plone/app/event/ical/importer.py
M plone/app/event/portlets/configure.zcml
M plone/app/event/portlets/portlet_calendar.pt
M plone/app/event/portlets/portlet_events.pt
M plone/app/event/portlets/portlet_events.py
M plone/app/event/profiles/default/actions.xml
M plone/app/event/profiles/default/browserlayer.xml
M plone/app/event/profiles/default/controlpanel.xml
M plone/app/event/profiles/default/metadata.xml
M plone/app/event/profiles/default/portlets.xml
M plone/app/event/profiles/default/registry.xml
M plone/app/event/profiles/default/rolemap.xml
M plone/app/event/profiles/default/types.xml
M plone/app/event/profiles/default/types/Collection.xml
M plone/app/event/profiles/default/types/Folder.xml
M plone/app/event/profiles/default/types/Plone_Site.xml
M plone/app/event/profiles/testing/metadata.xml
M plone/app/event/profiles/testing/types.xml
M plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml
M plone/app/event/recurrence.zcml
M plone/app/event/testing.py
M plone/app/event/tests/javascripts/test_event.html
M plone/app/event/tests/qunit/qunit.js
M plone/app/event/tests/test_base_module.py
M plone/app/event/tests/test_dx_behaviors.py
M plone/app/event/tests/test_event_listing.py
M plone/app/event/tests/test_event_summary.py
M plone/app/event/tests/test_event_view.py
M plone/app/event/tests/test_ical_import.py
M plone/app/event/tests/test_icalendar.py
M plone/app/event/tests/test_portlet_events.py
M plone/app/event/tests/test_recurrence.py
M plone/app/event/upgrades/configure.zcml
M plone/app/event/upgrades/upgrades.py
M pyproject.toml
M setup.cfg
M setup.py
D build-i18n.sh
D buildout.cfg

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 000000000..b4158b89d\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,39 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\ndiff --git a/.gitignore b/.gitignore\nindex ec3efba43..4111b91a6 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -4,7 +4,6 @@\n *.sw?\n *.wpr\n *~\n-.*\n bin/\n coverage/\n dev/\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 000000000..5848075c3\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[meta]\n+template = "default"\n+commit-id = "e380661b"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 000000000..449e951ab\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,42 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.3.1\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.1.0\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.0.3\n+    hooks:\n+    -   id: zpretty\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.0.0\n+    hooks:\n+    -   id: flake8\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.2\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\ndiff --git a/CHANGES.rst b/CHANGES.rst\nindex c27c91a8b..f3c7e2604 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -251,7 +251,7 @@ Bug fixes:\n \n - Fixed searchable text indexer to avoid breaking when there is no text.\n   [davisagli]\n-- iCalendar categories are exepected as a comma separated string, not as multiple entries.\n+- iCalendar categories are expected as a comma separated string, not as multiple entries.\n   See https://www.kanzaki.com/docs/ical/categories.html\n   Needs fixed iCalendar >4.0.2\n   [jensens]\n@@ -751,7 +751,7 @@ Fixes:\n   addons (specifically ``collective.venue``) to override it and return a html\n   link to a location object instead. Instead of this hack, which also only\n   works for the location use case, override the necessary templates in your\n-  addons. In case of doubt, simplicity outweight extensibility options.\n+  addons. In case of doubt, simplicity outweigh extensibility options.\n   [thet]\n \n - Change ``adapts`` and ``implements`` to their decorator equivalents\n@@ -1109,7 +1109,7 @@ Fixes:\n \n - For ical exports, remove X-WR-CALNAME, X-WR-CALID and X-WR-CALDESC.\n   X-WR-CALNAME caused Outlook to create a new calendar on every import. These\n-  properties are not neccessary and not specified by RFC5545 anyways.\n+  properties are not necessary and not specified by RFC5545 anyways.\n   Fixes #109, closes #132.\n   [tomgross, thet]\n \n@@ -1218,14 +1218,14 @@ Fixes:\n   installations.\n   [thet]\n \n-- Remove the behaviors plone.app.relationfield.behavior.IRelatedItems adn\n+- Remove the behaviors plone.app.relationfield.behavior.IRelatedItems and\n   plone.app.versioningbehavior.behaviors.IVersionable from the Dexterity\n   example type. We don\'t depend on these packages and won\'t introduce an\n   explicit dependency on it.\n   [thet]\n \n - In portlet calendar and events, don\'t use the search_base directly to\n-  constuct calendar urls. The search base always starts from the Plone site\n+  construct calendar urls. The search base always starts from the Plone site\n   root, which led to wrong urls in Lineage subsites.\n   [thet]\n \n@@ -1270,7 +1270,7 @@ Fixes:\n   [jensens]\n \n - Remove event and calendar portlet assignments on plone.rightcolumn.\n-  Integrators should do assignments themselfes, as they are likely different\n+  Integrators should do assignments themselves, as they are likely different\n   from the standard assignment.\n   [thet]\n \n@@ -1321,10 +1321,10 @@ Fixes:\n   [thet]\n \n - Remove dependency on "persistent" to not use that one over the ZODB bundled\n-  package. "persistent" will become available as seperate package with ZODB 4.\n+  package. "persistent" will become available as separate package with ZODB 4.\n   [thet]\n \n-- Declare mimimum dependency on plone.event 1.0rc1.\n+- Declare minimum dependency on plone.event 1.0rc1.\n   [thet]\n \n - Buildout infrastructure update.\n@@ -1414,7 +1414,7 @@ Please note, the next release will have all deprections removed.\n - Fix compact event edit form layouts and don\'t float the recurrence widget.\n   [thet]\n \n-- Change default listing mode in event_listing and replace "All" with seperate\n+- Change default listing mode in event_listing and replace "All" with separate\n   "Future" and "Past" buttons.\n   [thet]\n \n@@ -1475,7 +1475,7 @@ Please note, the next release will have all deprections removed.\n \n - Let EventAccessor for Archetypes based content type return it\'s values from\n   property accessors instead properties directly. This let\'s return the correct\n-  value when an property get\'s overridden by archetypes.schemaextender.\n+  value when an property gets overridden by archetypes.schemaextender.\n   [thet]\n \n - Deprecate upgrade_step_2 to plone.app.event beta 2, which is likely not\n@@ -1498,7 +1498,7 @@ Please note, the next release will have all deprections removed.\n   Move related cmf_edit tests from Products.CMFPlone to plone.app.event.\n   [thet]\n \n-- Add Event profile definition for ATEvent completly in order to remove it from\n+- Add Event profile definition for ATEvent completely in order to remove it from\n   Products.CMFPlone. ATEvent is installed by ATContentTypes automatically as\n   part of upcoming plone.app.contenttypes merge.\n   [thet]\n@@ -1593,7 +1593,7 @@ Please note, the next release will have all deprections removed.\n   mode to \'day\' if a date was passed.\n   [thet]\n \n-- Backport from plone.app.portlets: Don\'t fail on invalid (ambigous) date\n+- Backport from plone.app.portlets: Don\'t fail on invalid (ambiguous) date\n   information in request (Commit a322676 on plone.app.portlets).\n   [tomgross]\n \n@@ -1720,7 +1720,7 @@ Please note, the next release will have all deprections removed.\n \n   - date_speller to format a date in a readable manner,\n \n-  - start_end_from_mode to return start and end date accordin to a mode string\n+  - start_end_from_mode to return start and end date according to a mode string\n     (today, past, future, etc.),\n \n   - dt_start_of_day and dt_end_of_day to set a date to the start of the day\ndiff --git a/build-i18n.sh b/build-i18n.sh\ndeleted file mode 100755\nindex 99c3e74c2..000000000\n--- a/build-i18n.sh\n+++ /dev/null\n@@ -1,13 +0,0 @@\n-#!/bin/sh\n-# Make sure, i18ndude is in your path.\n-I18NDUDE=i18ndude\n-I18NPATH=plone/app/event\n-DOMAIN=plone.app.event\n-$I18NDUDE rebuild-pot --pot $I18NPATH/locales/$DOMAIN.pot --create $DOMAIN $I18NPATH\n-$I18NDUDE sync --pot $I18NPATH/locales/$DOMAIN.pot $I18NPATH/locales/*/LC_MESSAGES/$DOMAIN.po\n-\n-## Don\'t automatically run the rebuild for the "plone" domain, as it puts too\n-## much message strings into it.\n-#DOMAIN=plone\n-#$I18NDUDE rebuild-pot --pot $I18NPATH/locales/$DOMAIN.pot --merge $I18NPATH/locales/merge-plone.pot --create $DOMAIN $I18NPATH\n-#$I18NDUDE sync --pot $I18NPATH/locales/$DOMAIN.pot $I18NPATH/locales/*/LC_MESSAGES/$DOMAIN.po\ndiff --git a/buildout.cfg b/buildout.cfg\ndeleted file mode 100644\nindex 8d58cd263..000000000\n--- a/buildout.cfg\n+++ /dev/null\n@@ -1,129 +0,0 @@\n-[buildout]\n-extends =\n-    https://raw.githubusercontent.com/plone/buildout.coredev/5.0/versions.cfg\n-parts =\n-    instance\n-# DEV\n-    i18ndude\n-    omelette\n-    zopepy\n-    sphinx\n-    checkversions\n-# TESTING\n-    test\n-    coverage-test\n-    coverage-report\n-    robot\n-\n-auto-checkout =\n-    Products.DateRecurringIndex\n-    icalendar\n-    jquery.recurrenceinput.js\n-    plone.app.event\n-    plone.event\n-    plone.formwidget.recurrence\n-\n-extensions += mr.developer\n-sources-dir = ${buildout:directory}/devsrc\n-develop = .\n-versions = versions\n-\n-# One of: CRITICAL, ERROR, WARNING, INFO, DEBUG, NOTSET\n-log-level = INFO\n-\n-\n-[instance]\n-recipe = plone.recipe.zope2instance\n-user = admin:admin\n-environment-vars = zope_i18n_compile_mo_files true\n-eggs =\n-    Plone\n-    Pillow\n-    plone.app.event\n-# DEVELOPMENT\n-    plone.reload\n-    plone.app.debugtoolbar\n-\n-# DEVELOPMENT\n-\n-[sources]\n-Products.DateRecurringIndex  = git git@github.com:collective/Products.DateRecurringIndex.git\n-icalendar                    = git git@github.com:collective/icalendar.git\n-jquery.recurrenceinput.js    = git git@github.com:collective/jquery.recurrenceinput.js.git egg=false\n-plone.event                  = git git@github.com:plone/plone.event.git\n-plone.formwidget.recurrence  = git git@github.com:plone/plone.formwidget.recurrence.git branch=master\n-# Looks like, `develop = .` doesn\'t work well with mr.developer. So we checkout\n-# plone.app.event to the buildout directory path.\n-plone.app.event = git git@github.com:plone/plone.app.event.git branch=master full-path=${buildout:directory}\n-\n-[i18ndude]\n-unzip = true\n-recipe = zc.recipe.egg\n-eggs = i18ndude\n-\n-[omelette]\n-recipe = collective.recipe.omelette\n-eggs =\n-    ${instance:eggs}\n-    ${test:eggs}\n-    ${robot:eggs}\n-\n-[zopepy]\n-recipe = zc.recipe.egg\n-eggs =\n-    ${instance:eggs}\n-    ${test:eggs}\n-    ${robot:eggs}\n-interpreter = zopepy\n-scripts = zopepy\n-\n-[sphinx]\n-recipe = collective.recipe.sphinxbuilder\n-source = ${buildout:directory}/docs\n-interpreter = ${buildout:directory}/bin/zopepy\n-\n-[checkversions]\n-recipe=zc.recipe.egg\n-eggs=z3c.checkversions [buildout]\n-\n-\n-# TESTING\n-\n-[environment]\n-BUILDOUT_DIR = ${buildout:directory}\n-zope_i18n_compile_mo_files = true\n-\n-[test]\n-recipe = zc.recipe.testrunner\n-defaults = [\'--auto-color\', \'--auto-progress\']\n-eggs =\n-    Products.DateRecurringIndex [test]\n-    icalendar [test]\n-    plone.app.event [test]\n-    plone.event [test]\n-    plone.formwidget.recurrence [test]\n-environment = environment\n-\n-[coverage-test]\n-recipe = zc.recipe.testrunner\n-eggs = ${test:eggs}\n-defaults = [\'--coverage\', \'../../coverage\', \'-v\', \'--auto-progress\']\n-\n-[coverage-report]\n-recipe = zc.recipe.egg\n-eggs = z3c.coverage\n-scripts = coveragereport\n-arguments = (\'coverage\', \'report\')\n-\n-[robot]\n-recipe = zc.recipe.egg\n-eggs =\n-    ${instance:eggs}\n-    plone.app.robotframework [debug]\n-\n-\n-# ALL\n-\n-[versions]\n-setuptools =\n-zc.buildout =\ndiff --git a/docs/architectural-overview.rst b/docs/architectural-overview.rst\nindex 0ca5b828e..5635d3025 100644\n--- a/docs/architectural-overview.rst\n+++ b/docs/architectural-overview.rst\n@@ -6,11 +6,11 @@ Design goals\n \n The development of plone.app.event was done with following design goals in mind:\n \n-  [a] Encapsulation and independence: All event related code should reside in a seperate package (splitted into other packages, where appropriate). Plone should be least dependend on plone.app.event. Best would be that one can deinstall this feature completly.\n+  [a] Encapsulation and independence: All event related code should reside in a separate package (split into other packages, where appropriate). Plone should be least depend on plone.app.event. Best would be that one can deinstall this feature completely.\n \n   [b] Dexterity support: plone.app.event should provide Dexterity behaviors, which can be used in Dexterity type.\n \n-  [c] Standards compliancy: the iCalendar / `RFC5545 <http://tools.ietf.org/html/rfc5545>`_ standard is wonderful flexible, so plone.app.event should provide support for it by allowing ical exports. This is also available for the current ATContentType based implementation, but plone.app.event aims to improve it. A future goal is to support CalDAV also.\n+  [c] Standards compliance: the iCalendar / `RFC5545 <http://tools.ietf.org/html/rfc5545>`_ standard is wonderful flexible, so plone.app.event should provide support for it by allowing ical exports. This is also available for the current ATContentType based implementation, but plone.app.event aims to improve it. A future goal is to support CalDAV also.\n \n   [d] Recurring events support based on the RFC5545 standard.\n \n@@ -20,7 +20,7 @@ The development of plone.app.event was done with following design goals in mind:\n \n   [g] Timezone support.\n \n-Encapsulation and independence: plone.app.event provides the Dexterity behaviors.  The calendar and event portlets were moved from plone.app.portlets into plone.app.event, where they belong semantically - thus improving encapsulation and independence and reducing interwoven dependencies.  The calendar portlet was completly refactored. The functionality of the CalendarTool (portal_calendar) was reimplenented. Important settings from the calendar-controlpanel are now available in the event configlet. Since the calendar portlet was the only consumer of the CalendarTool, the CalendarTool, the calendar controlpanel and the dependency to Products.CMFCalendar can be dropped. The new plone.app.widgets package implements z3cform based widgets, so the old datetime widget can be dropped. Python-dateutil provides recurrence calculations based on the RFC5545 standard - plone.formwidget.recurrence provides a awidget for recurrence and Products.DateRecurringIndex an appropriate index as a drop-in replacement for Zope\'s DateIndex. The iCalendar package was improved and is now used for plone.app.event to provide icalendar serialization. The timezone support is based on the pytz package. Plone now haves a portal timezone, User timezones and every event can define another timezone, if wished. User timezones are planned. Whole day events get their starttime set to 0:00 and endtime set to 23:59:59 - thats should be feasable in most cases (excluding any scientific events...).\n+Encapsulation and independence: plone.app.event provides the Dexterity behaviors.  The calendar and event portlets were moved from plone.app.portlets into plone.app.event, where they belong semantically - thus improving encapsulation and independence and reducing interwoven dependencies.  The calendar portlet was completely refactored. The functionality of the CalendarTool (portal_calendar) was reimplenented. Important settings from the calendar-controlpanel are now available in the event configlet. Since the calendar portlet was the only consumer of the CalendarTool, the CalendarTool, the calendar controlpanel and the dependency to Products.CMFCalendar can be dropped. The new plone.app.widgets package implements z3cform based widgets, so the old datetime widget can be dropped. Python-dateutil provides recurrence calculations based on the RFC5545 standard - plone.formwidget.recurrence provides a awidget for recurrence and Products.DateRecurringIndex an appropriate index as a drop-in replacement for Zope\'s DateIndex. The iCalendar package was improved and is now used for plone.app.event to provide icalendar serialization. The timezone support is based on the pytz package. Plone now haves a portal timezone, User timezones and every event can define another timezone, if wished. User timezones are planned. Whole day events get their starttime set to 0:00 and endtime set to 23:59:59 - that\'s should be feasible in most cases (excluding any scientific events...).\n \n \n Packages\n@@ -36,7 +36,7 @@ The "dx" submodule provides Dexterity behaviors (some granular ones). Like in th\n \n Both subpackages are only loaded, if the neccassary features are installed.\n \n-plone.app.event does not depend on CMFCalendar and the portal_calendar tool any more. Plone core\'s only consumer of this package was the calendar portlet anyways, which was completly rewritten.\n+plone.app.event does not depend on CMFCalendar and the portal_calendar tool any more. Plone core\'s only consumer of this package was the calendar portlet anyways, which was completely rewritten.\n \n base.py provides some basic event related functionality. Many of them need a context in order to get the correct timezone.\n \n@@ -72,7 +72,7 @@ Products.DateRecurringIndex\n \n Github: https://github.com/collective/Products.DateRecurringIndex\n \n-A drop-in replacement for Zope\'s DateIndex with support for recurring events.  Each recurrence get\'s an index entry.\n+A drop-in replacement for Zope\'s DateIndex with support for recurring events.  Each recurrence gets an index entry.\n \n \n icalendar\ndiff --git a/docs/conf.py b/docs/conf.py\nindex 754e531f5..b5d4d3368 100644\n--- a/docs/conf.py\n+++ b/docs/conf.py\n@@ -14,7 +14,7 @@\n \n language = "en"\n \n-from pkg_resources import get_distribution\n+from pkg_resources import get_distribution  # noqa: E402\n \n \n version = release = get_distribution(project).version\ndiff --git a/docs/designchoices.rst b/docs/designchoices.rst\nindex f1aede8c3..255188425 100644\n--- a/docs/designchoices.rst\n+++ b/docs/designchoices.rst\n@@ -19,6 +19,6 @@ Development design choices\n \n - We identified two major use-cases: 1) The event happens at a physical location, i.e. a project meeting happens in Madrid with participant traveling to Madrid weekly on monday at 9:00am.  2) A phone conference of an international organisation with participants from all over the world happens every work day at 10:00 am.\n \n-  In both cases we create the event with the date with a given timezone. So for use-case (1) the editor sits in Taipeh but edits a conference in Madrid, so she has to set the timezone of the event in the form. At display time usally the viewer is interested to see the local time of the conference in the output, so display should be in Europe/Madrid timezone.\n+  In both cases we create the event with the date with a given timezone. So for use-case (1) the editor sits in Taipeh but edits a conference in Madrid, so she has to set the timezone of the event in the form. At display time usually the viewer is interested to see the local time of the conference in the output, so display should be in Europe/Madrid timezone.\n \n-  In use-case (2) the editor usally refers to his own local timezone. He will keep the preset in the form. At display time the viewer is interested to see the date and time in his local timezone. On change of daylight-saving time in the original timezone the datetime was entered stays on 10:00am.  But if the participant in a other timezone has not this change it means he has the call scheduled one hour earlier or later in summer or winter time. So DST makes things again difficult, but heres no way to get rid of it as long as theres the concept of daylightsaving time is handled differently all over the world.\n+  In use-case (2) the editor usually refers to his own local timezone. He will keep the preset in the form. At display time the viewer is interested to see the date and time in his local timezone. On change of daylight-saving time in the original timezone the datetime was entered stays on 10:00am.  But if the participant in a other timezone has not this change it means he has the call scheduled one hour earlier or later in summer or winter time. So DST makes things again difficult, but heres no way to get rid of it as long as there\'s the concept of daylightsaving time is handled differently all over the world.\ndiff --git a/docs/index.rst b/docs/index.rst\nindex 98f2b4e89..f100ba03e 100644\n--- a/docs/index.rst\n+++ b/docs/index.rst\n@@ -21,11 +21,11 @@ plone.app.event - a calendar framework for Plone\n \n     It was developed with these goals in mind:\n \n-    - Encapsulation and independence: All event related code should reside in a single package. Relevant, re-usable functionality is split to seperate packages.  Plone\'s dependencies on calendar related code should be reduced to a minimum. plone.app.event should be able to be deinstalled from Plone.\n+    - Encapsulation and independence: All event related code should reside in a single package. Relevant, re-usable functionality is split to separate packages.  Plone\'s dependencies on calendar related code should be reduced to a minimum. plone.app.event should be able to be deinstalled from Plone.\n \n     - Dexterity and Archetypes support: plone.app.event should provide Dexterity behaviors, which can be used in Dexterity types and an ATEvent content type (factored out from ATContentTypes). For a Dexterity event type, use plone.app.contenttypes 1.1 or newer.\n \n-    - Standards compliancy: We support the icalendar standard (`RFC5545 <http://tools.ietf.org/html/rfc5545>`_) including recurrence.\n+    - Standards compliance: We support the icalendar standard (`RFC5545 <http://tools.ietf.org/html/rfc5545>`_) including recurrence.\n \n     - Recurring events based on the RFC5545 standard.\n \ndiff --git a/news/e380661b.internal b/news/e380661b.internal\nnew file mode 100644\nindex 000000000..c08f53991\n--- /dev/null\n+++ b/news/e380661b.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/plone/app/event/base.py b/plone/app/event/base.py\nindex 5da8252b1..fb3989bf1 100644\n--- a/plone/app/event/base.py\n+++ b/plone/app/event/base.py\n@@ -375,7 +375,7 @@ def _add_to_cal(cal_data, event, date):\n \n             # avoid long loops\n             if start and end_date < start:\n-                break  # if the date is completly outside the range\n+                break  # if the date is completely outside the range\n             if start and next_start_date < start:\n                 continue  # if start_date is outside but end reaches into range\n             if end and next_start_date > end:\n@@ -566,7 +566,7 @@ def DT(dt, exact=False):\n \n     :param dt: Python datetime, Python date, Zope DateTime instance or string.\n     :param exact: If True, the resolution goes down to microseconds. If False,\n-                  the resolution are seconds. Defaul is False.\n+                  the resolution are seconds. Default is False.\n     :type exact: Boolean\n     :returns: Zope DateTime\n     :rtype: Zope DateTime\n@@ -612,7 +612,7 @@ def guess_date_from(datestr, context=None):\n     """Returns a timezone aware date object if an arbitrary ASCII string is\n     formatted in an ISO date format, otherwise None is returned.\n \n-    Used for traversing and Occurence ids.\n+    Used for traversing and Occurrence ids.\n \n     :param datestr: Date string in an ISO format.\n     :type datestr: string\n@@ -964,7 +964,7 @@ def find_context(context, viewname=None, iface=None, as_url=False, append_view=T\n                         as_url, append the viewname to the url, if the context\n                         hasn\'t configured it as defaultView. Otherwise ignore\n                         this parameter.\n-    :returns: A context with the given view name, inteface or ISite root.\n+    :returns: A context with the given view name, interface or ISite root.\n     """\n     context = aq_inner(context)\n     ret = None\n@@ -1014,7 +1014,7 @@ def find_event_listing(context, as_url=False):\n # Workaround for buggy strftime with timezone handling in DateTime.\n # See: https://github.com/plone/plone.app.event/pull/47\n # TODO: should land in CMFPlone or fixed in DateTime.\n-_strftime = lambda v, fmt: pydt(v).strftime(fmt)\n+_strftime = lambda v, fmt: pydt(v).strftime(fmt)  # noqa: E731\n \n \n class PatchedDateTime(DateTime):\ndiff --git a/plone/app/event/browser/configure.zcml b/plone/app/event/browser/configure.zcml\nindex 27531808a..ea49f92b7 100644\n--- a/plone/app/event/browser/configure.zcml\n+++ b/plone/app/event/browser/configure.zcml\n@@ -3,115 +3,117 @@\n     xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:plone="http://namespaces.plone.org/plone"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <plone:static\n-        name="plone.app.event"\n-        type="plone"\n-        directory="resources"\n-        />\n+  <plone:static\n+      directory="resources"\n+      name="plone.app.event"\n+      type="plone"\n+      />\n \n-    <!-- Event listing -->\n-    <browser:page\n-        for="plone.event.interfaces.IEvent"\n-        name="event_listing"\n-        class=".event_listing.EventEventListing"\n-        template="event_listing.pt"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        menu="plone_displayviews"\n-        title="Event listing"\n-        />\n-    <browser:page\n-        for="*"\n-        name="event_listing"\n-        class=".event_listing.EventListing"\n-        template="event_listing.pt"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        menu="plone_displayviews"\n-        title="Event listing"\n-        />\n-    <browser:page\n-        for="*"\n-        name="event_listing_ical"\n-        class=".event_listing.EventListingIcal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <!-- Event listing -->\n+  <browser:page\n+      name="event_listing"\n+      for="plone.event.interfaces.IEvent"\n+      class=".event_listing.EventEventListing"\n+      template="event_listing.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      menu="plone_displayviews"\n+      title="Event listing"\n+      />\n+  <browser:page\n+      name="event_listing"\n+      for="*"\n+      class=".event_listing.EventListing"\n+      template="event_listing.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      menu="plone_displayviews"\n+      title="Event listing"\n+      />\n+  <browser:page\n+      name="event_listing_ical"\n+      for="*"\n+      class=".event_listing.EventListingIcal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n-    <!-- Event view -->\n-    <browser:page\n-        for="plone.event.interfaces.IEvent"\n-        name="event_view"\n-        class=".event_view.EventView"\n-        template="event_view.pt"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <!-- Event view -->\n+  <browser:page\n+      name="event_view"\n+      for="plone.event.interfaces.IEvent"\n+      class=".event_view.EventView"\n+      template="event_view.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n-    <browser:page\n-        for="plone.event.interfaces.IOccurrence"\n-        name="event_view"\n-        class=".event_view.EventView"\n-        template="event_view.pt"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <browser:page\n+      name="event_view"\n+      for="plone.event.interfaces.IOccurrence"\n+      class=".event_view.EventView"\n+      template="event_view.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n-    <browser:defaultView\n-        for="plone.event.interfaces.IOccurrence"\n-        name="event_view"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <browser:defaultView\n+      name="event_view"\n+      for="plone.event.interfaces.IOccurrence"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n-    <browser:page\n-        for="plone.event.interfaces.IEvent"\n-        name="event_summary"\n-        class=".event_summary.EventSummaryView"\n-        template="event_summary.pt"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <browser:page\n+      name="event_summary"\n+      for="plone.event.interfaces.IEvent"\n+      class=".event_summary.EventSummaryView"\n+      template="event_summary.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="event_summary"\n+      for="plone.event.interfaces.IOccurrence"\n+      class=".event_summary.EventSummaryView"\n+      template="event_summary.pt"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n-    <browser:page\n+  <configure\n+      package="plone.app.contenttypes.behaviors"\n+      zcml:condition="installed plone.app.contenttypes"\n+      >\n+    <browser:viewlet\n+        name="contentleadimage"\n         for="plone.event.interfaces.IOccurrence"\n-        name="event_summary"\n-        class=".event_summary.EventSummaryView"\n-        template="event_summary.pt"\n+        manager="plone.app.layout.viewlets.interfaces.IAboveContentTitle"\n+        class="plone.app.event.browser.leadimage_viewlet.LeadImageViewlet"\n+        template="leadimage.pt"\n         permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n         />\n+  </configure>\n \n-    <configure\n-        zcml:condition="installed plone.app.contenttypes"\n-        package="plone.app.contenttypes.behaviors">\n-      <browser:viewlet\n-          name="contentleadimage"\n-          for="plone.event.interfaces.IOccurrence"\n-          class="plone.app.event.browser.leadimage_viewlet.LeadImageViewlet"\n-          manager="plone.app.layout.viewlets.interfaces.IAboveContentTitle"\n-          template="leadimage.pt"\n-          permission="zope2.View"\n-          />\n-    </configure>\n+  <adapter\n+      factory=".formatted_date.FormattedDateProvider"\n+      provides="zope.contentprovider.interfaces.IContentProvider"\n+      for="zope.interface.Interface\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           zope.publisher.interfaces.browser.IBrowserView"\n+      name="formatted_date"\n+      />\n \n-    <adapter\n-        name="formatted_date"\n-        provides="zope.contentprovider.interfaces.IContentProvider"\n-        for="zope.interface.Interface\n-             zope.publisher.interfaces.browser.IBrowserRequest\n-             zope.publisher.interfaces.browser.IBrowserView"\n-        factory=".formatted_date.FormattedDateProvider"\n-        />\n-\n-    <adapter\n-        name="formatted_date"\n-        provides="zope.contentprovider.interfaces.IContentProvider"\n-        for="zope.interface.Interface\n-             zope.publisher.interfaces.browser.IBrowserRequest\n-             plone.portlets.interfaces.IPortletRenderer"\n-        factory=".formatted_date.FormattedStartDateProvider"\n-        />\n+  <adapter\n+      factory=".formatted_date.FormattedStartDateProvider"\n+      provides="zope.contentprovider.interfaces.IContentProvider"\n+      for="zope.interface.Interface\n+           zope.publisher.interfaces.browser.IBrowserRequest\n+           plone.portlets.interfaces.IPortletRenderer"\n+      name="formatted_date"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/browser/event_listing.pt b/plone/app/event/browser/event_listing.pt\nindex d9ae03141..e66e25e9c 100644\n--- a/plone/app/event/browser/event_listing.pt\n+++ b/plone/app/event/browser/event_listing.pt\n@@ -1,134 +1,151 @@\n-<html\n-    xmlns="http://www.w3.org/1999/xhtml"\n-    xml:lang="en"\n-    xmlns:tal="http://xml.zope.org/namespaces/tal"\n-    xmlns:metal="http://xml.zope.org/namespaces/metal"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    lang="en"\n-    metal:use-macro="context/main_template/macros/master"\n-    i18n:domain="plone">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n+      metal:use-macro="context/main_template/macros/master"\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n   <body>\n \n-    <metal:custom_title\n-        fill-slot="content-title"\n-        tal:define="header view/header_string">\n+    <metal:custom_title fill-slot="content-title"\n+                        tal:define="\n+                          header view/header_string;\n+                        "\n+    >\n       <h1 class="documentFirstHeading">\n-        <span\n-            tal:replace="header/main"\n-            tal:condition="header/main" />\n+        <span tal:condition="header/main"\n+              tal:replace="header/main"\n+        ></span>\n       </h1>\n-      <nav tal:define="mode request/mode|string:future; show_filter view/show_filter">\n+      <nav tal:define="\n+             mode request/mode|string:future;\n+             show_filter view/show_filter;\n+           ">\n         <ul class="mode_selector nav justify-content-end">\n           <tal:cond condition="show_filter">\n-            <li\n-                class="nav-item"\n-                tal:condition="python:mode==\'past\'">\n-              <a\n-                  class="mode_future nav-link"\n-                  href=""\n-                  tal:attributes="href view/mode_future_url"\n-                  i18n:translate="mode_future_link">Upcoming</a>\n+            <li class="nav-item"\n+                tal:condition="python:mode==\'past\'"\n+            >\n+              <a class="mode_future nav-link"\n+                 href=""\n+                 tal:attributes="\n+                   href view/mode_future_url;\n+                 "\n+                 i18n:translate="mode_future_link"\n+              >Upcoming</a>\n             </li>\n-            <li\n-                class="nav-item"\n-                tal:condition="python:mode==\'future\'">\n-              <a\n-                  class="mode_past nav-link"\n-                  href=""\n-                  tal:attributes="href view/mode_past_url"\n-                  i18n:translate="mode_past_link">Past</a>\n+            <li class="nav-item"\n+                tal:condition="python:mode==\'future\'"\n+            >\n+              <a class="mode_past nav-link"\n+                 href=""\n+                 tal:attributes="\n+                   href view/mode_past_url;\n+                 "\n+                 i18n:translate="mode_past_link"\n+              >Past</a>\n             </li>\n           </tal:cond>\n           <li class="nav-item">\n-            <a\n-                class="mode_ical nav-link"\n-                href=""\n-                tal:attributes="href view/ical_url"\n-                title="Download this event in iCal format"\n-                i18n:attributes="title title_add_to_ical;">\n+            <a class="mode_ical nav-link"\n+               href=""\n+               title="Download this event in iCal format"\n+               tal:attributes="\n+                 href view/ical_url;\n+               "\n+               i18n:attributes="title title_add_to_ical;"\n+            >\n               <span i18n:translate="label_add_to_ical">iCal</span>\n             </a>\n \n           </li>\n         </ul>\n       </nav>\n-      <h2\n+      <h2 tal:condition="header/sub"\n           tal:content="header/sub"\n-          tal:condition="header/sub" />\n+      ></h2>\n     </metal:custom_title>\n \n     <metal:content-core fill-slot="content-core">\n       <metal:block define-macro="content-core">\n-        <tal:def define="batch view/events;\n-                 toLocalizedTime nocall: context/@@plone/toLocalizedTime;">\n+        <tal:def define="\n+                   batch view/events;\n+                   toLocalizedTime nocall: context/@@plone/toLocalizedTime;\n+                 ">\n \n           <section>\n \n             <tal:items repeat="data batch">\n \n-              <article\n-                  itemscope\n-                  itemtype="https://schema.org/Event"\n-                  class="vevent tileItem d-flex align-items-start mb-3"\n-                  tal:define="startf python:view.date_speller(data.start)">\n+              <article class="vevent tileItem d-flex align-items-start mb-3"\n+                       itemscope\n+                       itemtype="https://schema.org/Event"\n+                       tal:define="\n+                         startf python:view.date_speller(data.start);\n+                       "\n+              >\n \n                 <ul class="hiddenStructure">\n-                  <li\n+                  <li class="dtstart"\n                       itemprop="startDate"\n-                      class="dtstart"\n-                      tal:content="data/start/isoformat">end</li>\n-                  <li\n+                      tal:content="data/start/isoformat"\n+                  >end</li>\n+                  <li class="dtend"\n                       itemprop="endDate"\n-                      class="dtend"\n-                      tal:content="data/end/isoformat">end</li>\n-                  <li\n-                      class="location"\n-                      itemscope\n+                      tal:content="data/end/isoformat"\n+                  >end</li>\n+                  <li class="location"\n                       itemprop="location"\n-                      itemtype="http://schema.org/Place">\n-                    <span\n-                        itemprop="address"\n-                        tal:content="data/location">location</span>\n+                      itemscope\n+                      itemtype="http://schema.org/Place"\n+                  >\n+                    <span itemprop="address"\n+                          tal:content="data/location"\n+                    >location</span>\n                   </li>\n                 </ul>\n \n                 <div class="cal_date card me-3 flex-shrink-0 text-center">\n-                  <div\n-                      class="cal_month card-header p-2"\n-                      tal:content="string:${startf/month_name}">Oct.\n+                  <div class="cal_month card-header p-2"\n+                       tal:content="string:${startf/month_name}"\n+                  >Oct.\n                   </div>\n                   <div class="card-body d-flex flex-column p-2">\n-                    <h3\n-                        class="cal_day card-title fs-1 m-0"\n-                        tal:content="string:${startf/day}">15</h3>\n-                    <span\n-                        class="cal_wkday card-text"\n-                        tal:content="python:startf[\'wkday_name\']">Tue</span>\n+                    <h3 class="cal_day card-title fs-1 m-0"\n+                        tal:content="string:${startf/day}"\n+                    >15</h3>\n+                    <span class="cal_wkday card-text"\n+                          tal:content="python:startf[\'wkday_name\']"\n+                    >Tue</span>\n                   </div>\n                 </div>\n \n                 <div class="cal_info clearfix">\n                   <h2 class="tileHeadline">\n-                    <a\n-                        href=""\n-                        itemprop="url"\n-                        class="url"\n-                        tal:attributes="href data/url">\n-                      <span\n-                          itemprop="name"\n-                          class="summary"\n-                          tal:content="data/title">Title</span>\n+                    <a class="url"\n+                       href=""\n+                       itemprop="url"\n+                       tal:attributes="\n+                         href data/url;\n+                       "\n+                    >\n+                      <span class="summary"\n+                            itemprop="name"\n+                            tal:content="data/title"\n+                      >Title</span>\n                     </a>\n                   </h2>\n                   <div class="documentByLine">\n                     <tal:date tal:replace="structure python:view.formatted_date(data)" />\n                   </div>\n \n-                  <p\n-                      itemprop="description"\n-                      class="description"\n-                      tal:condition="data/description"\n-                      tal:content="data/description" />\n+                  <p class="description"\n+                     itemprop="description"\n+                     tal:condition="data/description"\n+                     tal:content="data/description"\n+                  ></p>\n \n \n                 </div>\n@@ -139,7 +156,7 @@\n \n           </section>\n \n-          <div metal:use-macro="context/batch_macros/macros/navigation" />\n+          <div metal:use-macro="context/batch_macros/macros/navigation"></div>\n \n         </tal:def>\n       </metal:block>\ndiff --git a/plone/app/event/browser/event_summary.pt b/plone/app/event/browser/event_summary.pt\nindex 10ccf499b..be49b0daa 100644\n--- a/plone/app/event/browser/event_summary.pt\n+++ b/plone/app/event/browser/event_summary.pt\n@@ -1,24 +1,29 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n+      xml:lang="en"\n+      tal:omit-tag=""\n       i18n:domain="plone"\n-      tal:omit-tag="">\n+>\n \n   <div class="card event-summary">\n     <div class="card-body pb-1"\n-         tal:define="portal_url context/@@plone_portal_state/portal_url;\n-                     data python:view.data;\n-                     start_tzname data/timezone;\n-                     start_utcdelta python:data.start.tzinfo.utcoffset(data.start);\n-                     start_utcoffset python:(start_utcdelta.days*86400+start_utcdelta.seconds)*100/60/60;\n-                     start_utcoffset python:int(start_utcoffset);\n-                     excludes view/excludes;\n-                     next_occs view/next_occurrences;\n-                     has_occs view/has_occurrences;\n-                     num_more_occs view/num_more_occurrences;\n-                     icons python:context.restrictedTraverse(\'@@iconresolver\')">\n+         tal:define="\n+           portal_url context/@@plone_portal_state/portal_url;\n+           data python:view.data;\n+           start_tzname data/timezone;\n+           start_utcdelta python:data.start.tzinfo.utcoffset(data.start);\n+           start_utcoffset python:(start_utcdelta.days*86400+start_utcdelta.seconds)*100/60/60;\n+           start_utcoffset python:int(start_utcoffset);\n+           excludes view/excludes;\n+           next_occs view/next_occurrences;\n+           has_occs view/has_occurrences;\n+           num_more_occs view/num_more_occurrences;\n+           icons python:context.restrictedTraverse(\'@@iconresolver\');\n+         "\n+    >\n \n       <div class="row">\n         <div class="col event-when">\n@@ -27,14 +32,18 @@\n               <tal:icon replace="structure python:icons.tag(\'calendar\', tag_class=\'icon-inline\')" />\n             </div>\n             <div>\n-              <strong class="meta-label" i18n:translate="event_when">When</strong>\n+              <strong class="meta-label"\n+                      i18n:translate="event_when"\n+              >When</strong>\n               <p class="card-text h5">\n                 <span>\n                   <tal:date replace="structure python:view.formatted_date(context)" />\n                 </span>\n                 <span class="timezone text-muted small"\n-                      tal:condition="start_tzname">\n-                  (<tal:tzname replace="start_tzname">timezone name</tal:tzname> / UTC<tal:tzoffset replace="start_utcoffset" />)\n+                      tal:condition="start_tzname"\n+                >\n+                  (<tal:tzname replace="start_tzname">timezone name</tal:tzname>\n+                  / UTC<tal:tzoffset replace="start_utcoffset" />)\n                 </span>\n               </p>\n             </div>\n@@ -44,118 +53,193 @@\n \n       <div class="row ${python:has_occs and \'row-cols-1 row-cols-md-2\' or \'\'}">\n         <tal:cond condition="python:\'occurrences\' not in excludes and has_occs">\n-        <div class="col event-occurences">\n-          <div class="mb-3">\n-            <div class="d-flex">\n-              <div class="meta-icon">\n-                <tal:icon replace="structure python:icons.tag(\'calendar-week\', tag_class=\'icon-inline\')" />\n-              </div>\n-              <div class="event-all-dates">\n-                <strong class="meta-label" i18n:translate="">\n+          <div class="col event-occurences">\n+            <div class="mb-3">\n+              <div class="d-flex">\n+                <div class="meta-icon">\n+                  <tal:icon replace="structure python:icons.tag(\'calendar-week\', tag_class=\'icon-inline\')" />\n+                </div>\n+                <div class="event-all-dates">\n+                  <strong class="meta-label"\n+                          i18n:translate=""\n+                  >\n                   All dates\n-                </strong>\n-                <p class="card-text">\n-                  <span tal:repeat="occ next_occs">\n-                    <tal:def define="this_is_occ python: occ.absolute_url() == context.absolute_url()">\n-                    <a tal:attributes="href occ/absolute_url" tal:omit-tag="this_is_occ">\n-                      <strong tal:omit-tag="not: this_is_occ">\n-                        <tal:date replace="structure python:view.formatted_date(occ)"/>\n-                      </strong>\n-                    </a>\n-                    </tal:def>\n-                    <br />\n-                  </span>\n-                  <span tal:condition="num_more_occs">\n-                    <a tal:attributes="href string:${view/event_context/absolute_url}/@@event_listing"\n-                        tal:content="view/more_occurrences_text">\n+                  </strong>\n+                  <p class="card-text">\n+                    <span tal:repeat="occ next_occs">\n+                      <tal:def define="\n+                                 this_is_occ python: occ.absolute_url() == context.absolute_url();\n+                               ">\n+                        <a tal:omit-tag="this_is_occ"\n+                           tal:attributes="\n+                             href occ/absolute_url;\n+                           "\n+                        >\n+                          <strong tal:omit-tag="not: this_is_occ">\n+                            <tal:date replace="structure python:view.formatted_date(occ)" />\n+                          </strong>\n+                        </a>\n+                      </tal:def>\n+                      <br />\n+                    </span>\n+                    <span tal:condition="num_more_occs">\n+                      <a tal:content="view/more_occurrences_text"\n+                         tal:attributes="\n+                           href string:${view/event_context/absolute_url}/@@event_listing;\n+                         "\n+                      >\n                       There are 12 more occurrences.\n-                    </a>\n-                  </span>\n-                </p>\n+                      </a>\n+                    </span>\n+                  </p>\n+                </div>\n               </div>\n             </div>\n           </div>\n-        </div>\n         </tal:cond>\n \n-        <div class="row col ${python:len(next_occs) > 1 and \'row-cols-1 row-cols-md-1\' or \'row-cols-1 row-cols-md-2\'}">\n+        <div class="row col ${python:len(next_occs) &gt; 1 and \'row-cols-1 row-cols-md-1\' or \'row-cols-1 row-cols-md-2\'}">\n \n-          <div class="col event-location mb-3" tal:condition="python: data.location and \'location\' not in excludes">\n+          <div class="col event-location mb-3"\n+               tal:condition="python: data.location and \'location\' not in excludes"\n+          >\n             <div class="d-flex">\n               <div class="meta-icon">\n                 <tal:icon replace="structure python:icons.tag(\'geo-alt\', tag_class=\'icon-inline\')" />\n               </div>\n               <div>\n-                <strong class="meta-label" i18n:translate="event_where">Where</strong>\n-                <p class="card-text" itemprop="location" tal:content="data/location">Location</p>\n+                <strong class="meta-label"\n+                        i18n:translate="event_where"\n+                >Where</strong>\n+                <p class="card-text"\n+                   itemprop="location"\n+                   tal:content="data/location"\n+                >Location</p>\n               </div>\n             </div>\n           </div>\n \n           <tal:cond condition="python:\'contact\' not in excludes">\n \n-          <div class="col event-contact mb-3" tal:define="mail data/contact_email; name data/contact_name;" tal:condition="python:name or mail">\n-            <div class="d-flex">\n-              <div class="meta-icon">\n-                <tal:icon replace="structure python:icons.tag(\'person\', tag_class=\'icon-inline\')" />\n-              </div>\n-              <div>\n-                <strong class="meta-label" i18n:translate="contact_name">Contact Name</strong>\n-                <p class="card-text" tal:condition="mail"><a class="email" tal:attributes="href string:mailto:${mail}" tal:content="name">Mail</a></p>\n-                <p class="card-text" tal:condition="not:mail" tal:content="name">Name</p>\n+            <div class="col event-contact mb-3"\n+                 tal:define="\n+                   mail data/contact_email;\n+                   name data/contact_name;\n+                 "\n+                 tal:condition="python:name or mail"\n+            >\n+              <div class="d-flex">\n+                <div class="meta-icon">\n+                  <tal:icon replace="structure python:icons.tag(\'person\', tag_class=\'icon-inline\')" />\n+                </div>\n+                <div>\n+                  <strong class="meta-label"\n+                          i18n:translate="contact_name"\n+                  >Contact Name</strong>\n+                  <p class="card-text"\n+                     tal:condition="mail"\n+                  ><a class="email"\n+                       tal:content="name"\n+                       tal:attributes="\n+                         href string:mailto:${mail};\n+                       "\n+                    >Mail</a></p>\n+                  <p class="card-text"\n+                     tal:condition="not:mail"\n+                     tal:content="name"\n+                  >Name</p>\n+                </div>\n               </div>\n             </div>\n-          </div>\n \n-          <div class="col event-phone mb-3" tal:condition="data/contact_phone">\n-            <div class="d-flex">\n-              <div class="meta-icon">\n-                <tal:icon replace="structure python:icons.tag(\'phone\', tag_class=\'icon-inline\')" />\n-              </div>\n-              <div>\n-                <strong class="meta-label" i18n:translate="contact_phone">Contact Phone</strong>\n-                <p class="card-text"><a href="tel:${data/contact_phone}" title="Contact Phone" i18n:attributes="title contact_phone" tal:content="data/contact_phone">Contact Phone</a></p>\n+            <div class="col event-phone mb-3"\n+                 tal:condition="data/contact_phone"\n+            >\n+              <div class="d-flex">\n+                <div class="meta-icon">\n+                  <tal:icon replace="structure python:icons.tag(\'phone\', tag_class=\'icon-inline\')" />\n+                </div>\n+                <div>\n+                  <strong class="meta-label"\n+                          i18n:translate="contact_phone"\n+                  >Contact Phone</strong>\n+                  <p class="card-text"><a href="tel:${data/contact_phone}"\n+                       title="Contact Phone"\n+                       tal:content="data/contact_phone"\n+                       i18n:attributes="title contact_phone"\n+                    >Contact Phone</a></p>\n+                </div>\n               </div>\n             </div>\n-          </div>\n \n-          <div class="col event-attendees mb-3" tal:condition="data/attendees|nothing">\n-            <div class="d-flex">\n-              <div class="meta-icon">\n-                <tal:icon replace="structure python:icons.tag(\'people\', tag_class=\'icon-inline\')" />\n-              </div>\n-              <div>\n-                <strong class="meta-label" i18n:translate="contact_attendees">Attendees</strong>\n-                <p class="card-text">\n-                  <tal:attendees tal:repeat="item data/attendees"><span class="text-no-wrap" tal:content="item">Attendee</span><span tal:condition="not:repeat/item/end">, </span></tal:attendees>\n-                </p>\n+            <div class="col event-attendees mb-3"\n+                 tal:condition="data/attendees|nothing"\n+            >\n+              <div class="d-flex">\n+                <div class="meta-icon">\n+                  <tal:icon replace="structure python:icons.tag(\'people\', tag_class=\'icon-inline\')" />\n+                </div>\n+                <div>\n+                  <strong class="meta-label"\n+                          i18n:translate="contact_attendees"\n+                  >Attendees</strong>\n+                  <p class="card-text">\n+                    <tal:attendees tal:repeat="item data/attendees"><span class="text-no-wrap"\n+                            tal:content="item"\n+                      >Attendee</span><span tal:condition="not:repeat/item/end">,\n+                      </span></tal:attendees>\n+                  </p>\n+                </div>\n               </div>\n             </div>\n-          </div>\n \n           </tal:cond>\n \n-          <div class="col event-url mb-3" tal:condition="python: data.event_url and \'event_url\' not in excludes">\n+          <div class="col event-url mb-3"\n+               tal:condition="python: data.event_url and \'event_url\' not in excludes"\n+          >\n             <div class="d-flex">\n               <div class="meta-icon">\n                 <tal:icon replace="structure python:icons.tag(\'laptop\', tag_class=\'icon-inline\')" />\n               </div>\n               <div>\n-                <strong class="meta-label" i18n:translate="event_url">Web</strong>\n-                <p class="card-text"><a href="" tal:attributes="href data/event_url" i18n:translate="external_website">Visit external website</a></p>\n+                <strong class="meta-label"\n+                        i18n:translate="event_url"\n+                >Web</strong>\n+                <p class="card-text"><a href=""\n+                     tal:attributes="\n+                       href data/event_url;\n+                     "\n+                     i18n:translate="external_website"\n+                  >Visit external website</a></p>\n               </div>\n             </div>\n           </div>\n \n-          <div class="col event-add-ical mb-3" tal:condition="python:\'ical\' not in excludes">\n+          <div class="col event-add-ical mb-3"\n+               tal:condition="python:\'ical\' not in excludes"\n+          >\n             <div class="d-flex">\n               <div class="meta-icon">\n                 <tal:icon replace="structure python:icons.tag(\'calendar-plus\', tag_class=\'icon-inline\')" />\n               </div>\n               <div>\n-                <strong class="meta-label" i18n:translate="heading_add_to_calendar">Add event to calendar</strong>\n-                <p class="card-text" tal:define="here_url context/@@plone_context_state/object_url">\n-                  <a href="#" rel="nofollow" tal:attributes="href string:$here_url/ics_view" title="Download this event in iCal format" i18n:attributes="title title_add_to_ical;">iCal</a>\n+                <strong class="meta-label"\n+                        i18n:translate="heading_add_to_calendar"\n+                >Add event to calendar</strong>\n+                <p class="card-text"\n+                   tal:define="\n+                     here_url context/@@plone_context_state/object_url;\n+                   "\n+                >\n+                  <a href="#"\n+                     rel="nofollow"\n+                     title="Download this event in iCal format"\n+                     tal:attributes="\n+                       href string:$here_url/ics_view;\n+                     "\n+                     i18n:attributes="title title_add_to_ical;"\n+                  >iCal</a>\n                 </p>\n               </div>\n             </div>\ndiff --git a/plone/app/event/browser/event_view.pt b/plone/app/event/browser/event_view.pt\nindex 538fc067d..704521b77 100644\n--- a/plone/app/event/browser/event_view.pt\n+++ b/plone/app/event/browser/event_view.pt\n@@ -1,37 +1,65 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n-<body>\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n+  <body>\n \n-<metal:content-core fill-slot="content-core">\n-<metal:block define-macro="content-core">\n-<tal:def tal:define="data nocall:view/data">\n+    <metal:content-core fill-slot="content-core">\n+      <metal:block define-macro="content-core">\n+        <tal:def tal:define="\n+                   data nocall:view/data;\n+                 ">\n \n-  <div class="event clearfix" itemscope itemtype="https://schema.org/Event">\n+          <div class="event clearfix"\n+               itemscope\n+               itemtype="https://schema.org/Event"\n+          >\n \n-    <ul class="hiddenStructure">\n-      <li><a itemprop="url" class="url" href="" tal:attributes="href data/url" tal:content="data/url">url</a></li>\n-      <li itemprop="name" class="summary" tal:content="data/title">title</li>\n-      <li itemprop="startDate" class="dtstart" tal:content="data/start/isoformat">start</li>\n-      <li itemprop="endDate" class="dtend" tal:content="data/end/isoformat">end</li>\n-      <li itemprop="description" class="description" tal:content="data/description">description</li>\n-    </ul>\n+            <ul class="hiddenStructure">\n+              <li><a class="url"\n+                   href=""\n+                   itemprop="url"\n+                   tal:content="data/url"\n+                   tal:attributes="\n+                     href data/url;\n+                   "\n+                >url</a></li>\n+              <li class="summary"\n+                  itemprop="name"\n+                  tal:content="data/title"\n+              >title</li>\n+              <li class="dtstart"\n+                  itemprop="startDate"\n+                  tal:content="data/start/isoformat"\n+              >start</li>\n+              <li class="dtend"\n+                  itemprop="endDate"\n+                  tal:content="data/end/isoformat"\n+              >end</li>\n+              <li class="description"\n+                  itemprop="description"\n+                  tal:content="data/description"\n+              >description</li>\n+            </ul>\n \n-    <tal:eventsummary replace="structure context/@@event_summary"/>\n+            <tal:eventsummary replace="structure context/@@event_summary" />\n \n-    <div id="parent-fieldname-text" tal:condition="data/text">\n-      <tal:text content="structure data/text" />\n-    </div>\n+            <div id="parent-fieldname-text"\n+                 tal:condition="data/text"\n+            >\n+              <tal:text content="structure data/text" />\n+            </div>\n \n-  </div>\n+          </div>\n \n-</tal:def>\n-</metal:block>\n-</metal:content-core>\n+        </tal:def>\n+      </metal:block>\n+    </metal:content-core>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/event/browser/formatted_date.pt b/plone/app/event/browser/formatted_date.pt\nindex 777758e05..bf34010f4 100644\n--- a/plone/app/event/browser/formatted_date.pt\n+++ b/plone/app/event/browser/formatted_date.pt\n@@ -1,80 +1,103 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n+      xml:lang="en"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n-<body tal:omit-tag="" tal:define="date_dict view/date_dict;\n-                                  whole_day date_dict/whole_day;\n-                                  open_end date_dict/open_end">\n+      i18n:domain="plone"\n+>\n+  <body tal:define="\n+          date_dict view/date_dict;\n+          whole_day date_dict/whole_day;\n+          open_end date_dict/open_end;\n+        "\n+        tal:omit-tag=""\n+  >\n \n-  <tal:differentday\n-      tal:condition="not:date_dict/same_day"\n-      i18n:translate="event_when_differentday">\n-    <abbr class="dtstart"\n-        i18n:name="startdate"\n-        tal:attributes="title date_dict/start_iso">\n-      <span class="explain">\n-        <span tal:replace="date_dict/start_date">Start Date</span>\n-        <tal:notwholeday condition="not:whole_day">\n-          <tal:word\n-              i18n:translate="event_when_differentday_optional_word_between_date_and_time" />\n-          <span tal:replace="date_dict/start_time">Start Time</span>\n-        </tal:notwholeday>\n-      </span>\n-    </abbr>\n+    <tal:differentday tal:condition="not:date_dict/same_day"\n+                      i18n:translate="event_when_differentday"\n+    >\n+      <abbr class="dtstart"\n+            tal:attributes="\n+              title date_dict/start_iso;\n+            "\n+            i18n:name="startdate"\n+      >\n+        <span class="explain">\n+          <span tal:replace="date_dict/start_date">Start Date</span>\n+          <tal:notwholeday condition="not:whole_day">\n+            <tal:word i18n:translate="event_when_differentday_optional_word_between_date_and_time" />\n+            <span tal:replace="date_dict/start_time">Start Time</span>\n+          </tal:notwholeday>\n+        </span>\n+      </abbr>\n     to\n-    <abbr class="dtend"\n-        i18n:name="enddate"\n-        tal:attributes="title date_dict/end_iso">\n-      <span class="explain">\n-        <span tal:replace="date_dict/end_date">End Date</span>\n-        <tal:notwholeday condition="not:whole_day">\n-          <tal:word\n-              i18n:translate="event_when_differentday_optional_word_between_date_and_time" />\n-          <span tal:replace="date_dict/end_time">End Time</span>\n-        </tal:notwholeday>\n-      </span>\n-    </abbr>\n-  </tal:differentday>\n+      <abbr class="dtend"\n+            tal:attributes="\n+              title date_dict/end_iso;\n+            "\n+            i18n:name="enddate"\n+      >\n+        <span class="explain">\n+          <span tal:replace="date_dict/end_date">End Date</span>\n+          <tal:notwholeday condition="not:whole_day">\n+            <tal:word i18n:translate="event_when_differentday_optional_word_between_date_and_time" />\n+            <span tal:replace="date_dict/end_time">End Time</span>\n+          </tal:notwholeday>\n+        </span>\n+      </abbr>\n+    </tal:differentday>\n \n-  <tal:sameday tal:condition="date_dict/same_day">\n-    <tal:wholeday condition="whole_day">\n-      <span tal:replace="date_dict/start_date" i18n:translate="" />\n-    </tal:wholeday>\n-    <tal:open_end\n-        condition="python:open_end and not whole_day"\n-        i18n:translate="event_when_sameday_openend">\n-      <span class="datedisplay"\n-          tal:content="date_dict/start_date"\n-          i18n:name="date">Start Date</span>\n+    <tal:sameday tal:condition="date_dict/same_day">\n+      <tal:wholeday condition="whole_day">\n+        <span tal:replace="date_dict/start_date"\n+              i18n:translate=""\n+        ></span>\n+      </tal:wholeday>\n+      <tal:open_end condition="python:open_end and not whole_day"\n+                    i18n:translate="event_when_sameday_openend"\n+      >\n+        <span class="datedisplay"\n+              tal:content="date_dict/start_date"\n+              i18n:name="date"\n+        >Start Date</span>\n       from\n-      <abbr class="dtstart"\n-          tal:attributes="title date_dict/start_iso"\n-          i18n:name="starttime"\n-          tal:content="date_dict/start_time">Start Time\n-      </abbr>\n-    </tal:open_end>\n-    <tal:normal\n-        condition="python:not (whole_day or open_end)"\n-        i18n:translate="event_when_sameday">\n-      <span class="datedisplay"\n-          tal:content="date_dict/start_date"\n-          i18n:name="date">Start Date</span>\n+        <abbr class="dtstart"\n+              tal:content="date_dict/start_time"\n+              tal:attributes="\n+                title date_dict/start_iso;\n+              "\n+              i18n:name="starttime"\n+        >Start Time\n+        </abbr>\n+      </tal:open_end>\n+      <tal:normal condition="python:not (whole_day or open_end)"\n+                  i18n:translate="event_when_sameday"\n+      >\n+        <span class="datedisplay"\n+              tal:content="date_dict/start_date"\n+              i18n:name="date"\n+        >Start Date</span>\n       from\n-      <abbr class="dtstart"\n-          tal:attributes="title date_dict/start_iso"\n-          i18n:name="starttime"\n-          tal:content="date_dict/start_time">Start Time\n-      </abbr>\n+        <abbr class="dtstart"\n+              tal:content="date_dict/start_time"\n+              tal:attributes="\n+                title date_dict/start_iso;\n+              "\n+              i18n:name="starttime"\n+        >Start Time\n+        </abbr>\n       to\n-      <abbr class="dtend"\n-          tal:attributes="title date_dict/end_iso"\n-          i18n:name="endtime"\n-          tal:content="date_dict/end_time">End Time\n-      </abbr>\n-    </tal:normal>\n-  </tal:sameday>\n+        <abbr class="dtend"\n+              tal:content="date_dict/end_time"\n+              tal:attributes="\n+                title date_dict/end_iso;\n+              "\n+              i18n:name="endtime"\n+        >End Time\n+        </abbr>\n+      </tal:normal>\n+    </tal:sameday>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/event/browser/formatted_start_date.pt b/plone/app/event/browser/formatted_start_date.pt\nindex bf2375cbb..1857234b8 100644\n--- a/plone/app/event/browser/formatted_start_date.pt\n+++ b/plone/app/event/browser/formatted_start_date.pt\n@@ -1,17 +1,29 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n+      xml:lang="en"\n       tal:omit-tag=""\n-      i18n:domain="plone">\n-<body tal:omit-tag="" tal:define="date_dict view/date_dict">\n+      i18n:domain="plone"\n+>\n+  <body tal:define="\n+          date_dict view/date_dict;\n+        "\n+        tal:omit-tag=""\n+  >\n \n-  <span tal:replace="date_dict/start_date" />\n-  <tal:notwholeday condition="not:date_dict/whole_day">\n-    <abbr class="dtstart" tal:attributes="title date_dict/start_iso">\n-      <span class="explain" tal:content="date_dict/start_time">Start Time</span>\n-    </abbr>\n-  </tal:notwholeday>\n+    <span tal:replace="date_dict/start_date"></span>\n+    <tal:notwholeday condition="not:date_dict/whole_day">\n+      <abbr class="dtstart"\n+            tal:attributes="\n+              title date_dict/start_iso;\n+            "\n+      >\n+        <span class="explain"\n+              tal:content="date_dict/start_time"\n+        >Start Time</span>\n+      </abbr>\n+    </tal:notwholeday>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/event/configure.zcml b/plone/app/event/configure.zcml\nindex 64e995a17..d2ab79b46 100644\n--- a/plone/app/event/configure.zcml\n+++ b/plone/app/event/configure.zcml\n@@ -4,7 +4,8 @@\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:i18n="http://namespaces.zope.org/i18n"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n   <!-- external dependencies -->\n   <include package="plone.browserlayer" />\n@@ -25,39 +26,41 @@\n   <include package=".upgrades" />\n \n   <utility\n-      component=".vocabularies.SynchronizationStrategies"\n       name="plone.app.event.SynchronizationStrategies"\n+      component=".vocabularies.SynchronizationStrategies"\n       />\n \n   <genericsetup:registerProfile\n       name="default"\n-      directory="profiles/default"\n       title="plone.app.event"\n       description="plone.app.event framework registration."\n-      for="plone.base.interfaces.IPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n+      directory="profiles/default"\n       />\n \n   <genericsetup:registerProfile\n       name="testing"\n       title="plone.app.event testing"\n-      directory="profiles/testing"\n       description="Testing profile for plone.app.event"\n-      for="plone.base.interfaces.IPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IPloneSiteRoot"\n+      directory="profiles/testing"\n       />\n \n   <genericsetup:importStep\n       name="plone.app.event-catalog"\n-      handler="plone.app.event.setuphandlers.setup_catalog"\n       title="plone.app.event catalog setup"\n-      description="registers indices and metadata columns for plone.app.event">\n+      description="registers indices and metadata columns for plone.app.event"\n+      handler="plone.app.event.setuphandlers.setup_catalog"\n+      >\n     <depends name="plone.app.registry" />\n   </genericsetup:importStep>\n \n   <utility\n       factory=".setuphandlers.HiddenProfiles"\n+      provides="plone.base.interfaces.INonInstallable"\n       name="plone.app.event"\n-      provides="plone.base.interfaces.INonInstallable" />\n+      />\n \n </configure>\ndiff --git a/plone/app/event/dx/configure.zcml b/plone/app/event/dx/configure.zcml\nindex 4ab514716..850a06b2b 100644\n--- a/plone/app/event/dx/configure.zcml\n+++ b/plone/app/event/dx/configure.zcml\n@@ -1,63 +1,79 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    i18n_domain="plone">\n-\n-    <include package="plone.dexterity" />\n-    <include package="plone.app.dexterity" /><!-- To initialize DublinCore behaviors -->\n-    <include package="plone.behavior" file="meta.zcml" />\n-\n-    <!-- http://groups.google.com/group/zope-core-dev/browse_thread/thread/6c10ebc16027017f -->\n-    <!-- ZCML of this package fails in Zope 2.13 for strange reason -->\n-    <exclude package="zope.contentprovider" />\n-\n-    <include file="ical.zcml" />\n-\n-    <adapter\n-        factory=".traverser.OccurrenceTraverser"\n-        permission="zope.Public"\n-        />\n-\n-    <adapter factory=".behaviors.EventAccessor" />\n-\n-    <adapter name="start" factory=".behaviors.start_indexer" />\n-    <adapter name="end" factory=".behaviors.end_indexer" />\n-    <adapter name="location" factory=".behaviors.location_indexer" />\n-    <adapter name="sync_uid" factory=".behaviors.sync_uid_indexer" />\n-\n-    <plone:behavior\n-        name="plone.eventbasic"\n-        title="Event Basic"\n-        description="Basic Event schema."\n-        provides=".behaviors.IEventBasic"\n-        />\n-\n-    <plone:behavior\n-        name="plone.eventrecurrence"\n-        title="Event Recurrence"\n-        description="Recurrence extension for Events."\n-        provides=".behaviors.IEventRecurrence"\n-        />\n-\n-    <plone:behavior\n-        name="plone.eventlocation"\n-        title="Event Location"\n-        description="Location extension for Events."\n-        provides=".behaviors.IEventLocation"\n-        />\n-\n-    <plone:behavior\n-        name="plone.eventattendees"\n-        title="Event Attendees"\n-        description="Attendees extension for Events."\n-        provides=".behaviors.IEventAttendees"\n-        />\n-\n-    <plone:behavior\n-        name="plone.eventcontact"\n-        title="Event Contact"\n-        description="Contact extension for Events."\n-        provides=".behaviors.IEventContact"\n-        />\n+    i18n_domain="plone"\n+    >\n+\n+  <include package="plone.dexterity" />\n+  <include package="plone.app.dexterity" /><!-- To initialize DublinCore behaviors -->\n+  <include\n+      package="plone.behavior"\n+      file="meta.zcml"\n+      />\n+\n+  <!-- http://groups.google.com/group/zope-core-dev/browse_thread/thread/6c10ebc16027017f -->\n+  <!-- ZCML of this package fails in Zope 2.13 for strange reason -->\n+  <exclude package="zope.contentprovider" />\n+\n+  <include file="ical.zcml" />\n+\n+  <adapter\n+      factory=".traverser.OccurrenceTraverser"\n+      permission="zope.Public"\n+      />\n+\n+  <adapter factory=".behaviors.EventAccessor" />\n+\n+  <adapter\n+      factory=".behaviors.start_indexer"\n+      name="start"\n+      />\n+  <adapter\n+      factory=".behaviors.end_indexer"\n+      name="end"\n+      />\n+  <adapter\n+      factory=".behaviors.location_indexer"\n+      name="location"\n+      />\n+  <adapter\n+      factory=".behaviors.sync_uid_indexer"\n+      name="sync_uid"\n+      />\n+\n+  <plone:behavior\n+      name="plone.eventbasic"\n+      title="Event Basic"\n+      description="Basic Event schema."\n+      provides=".behaviors.IEventBasic"\n+      />\n+\n+  <plone:behavior\n+      name="plone.eventrecurrence"\n+      title="Event Recurrence"\n+      description="Recurrence extension for Events."\n+      provides=".behaviors.IEventRecurrence"\n+      />\n+\n+  <plone:behavior\n+      name="plone.eventlocation"\n+      title="Event Location"\n+      description="Location extension for Events."\n+      provides=".behaviors.IEventLocation"\n+      />\n+\n+  <plone:behavior\n+      name="plone.eventattendees"\n+      title="Event Attendees"\n+      description="Attendees extension for Events."\n+      provides=".behaviors.IEventAttendees"\n+      />\n+\n+  <plone:behavior\n+      name="plone.eventcontact"\n+      title="Event Contact"\n+      description="Contact extension for Events."\n+      provides=".behaviors.IEventContact"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/dx/ical.zcml b/plone/app/event/dx/ical.zcml\nindex 32237d177..69310d4da 100644\n--- a/plone/app/event/dx/ical.zcml\n+++ b/plone/app/event/dx/ical.zcml\n@@ -1,19 +1,21 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    >\n \n-    <adapter factory="..ical.exporter.calendar_from_container"\n-        provides="plone.event.interfaces.IICalendar"\n-        for="plone.dexterity.interfaces.IDexterityContainer"\n-        />\n+  <adapter\n+      factory="..ical.exporter.calendar_from_container"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="plone.dexterity.interfaces.IDexterityContainer"\n+      />\n \n-    <browser:page\n-        for="plone.dexterity.interfaces.IDexterityContainer"\n-        name="ics_view"\n-        class="..ical.exporter.EventsICal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+  <browser:page\n+      name="ics_view"\n+      for="plone.dexterity.interfaces.IDexterityContainer"\n+      class="..ical.exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/ical/__init__.py b/plone/app/event/ical/__init__.py\nindex 50df7e310..10c25ed16 100644\n--- a/plone/app/event/ical/__init__.py\n+++ b/plone/app/event/ical/__init__.py\n@@ -1,7 +1,7 @@\n-from plone.app.event.ical.exporter import calendar_from_collection  # nopep8\n-from plone.app.event.ical.exporter import calendar_from_container  # nopep8\n-from plone.app.event.ical.exporter import calendar_from_event  # nopep8\n-from plone.app.event.ical.exporter import construct_icalendar  # nopep8\n-from plone.app.event.ical.exporter import EventsICal  # nopep8\n-from plone.app.event.ical.exporter import ICalendarEventComponent  # nopep8\n-from plone.app.event.ical.importer import ical_import  # nopep8\n+from plone.app.event.ical.exporter import calendar_from_collection  # noqa: F401\n+from plone.app.event.ical.exporter import calendar_from_container  # noqa: F401\n+from plone.app.event.ical.exporter import calendar_from_event  # noqa: F401\n+from plone.app.event.ical.exporter import construct_icalendar  # noqa: F401\n+from plone.app.event.ical.exporter import EventsICal  # noqa: F401\n+from plone.app.event.ical.exporter import ICalendarEventComponent  # noqa: F401\n+from plone.app.event.ical.importer import ical_import  # noqa: F401\ndiff --git a/plone/app/event/ical/configure.zcml b/plone/app/event/ical/configure.zcml\nindex 31e10b29e..d3d6a645f 100644\n--- a/plone/app/event/ical/configure.zcml\n+++ b/plone/app/event/ical/configure.zcml\n@@ -1,114 +1,112 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:zcml="http://namespaces.zope.org/zcml"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    i18n_domain="plone">\n-\n-    <adapter\n-        for="plone.event.interfaces.IEvent"\n-        factory=".exporter.ICalendarEventComponent"\n-        />\n-\n-    <adapter\n-        for="plone.event.interfaces.IOccurrence"\n-        factory=".exporter.ICalendarEventComponent"\n-        />\n-\n-    <adapter\n-        for="plone.event.interfaces.IEvent"\n-        provides="plone.event.interfaces.IICalendar"\n-        factory=".exporter.calendar_from_event"\n-        />\n-\n-    <adapter\n-        for="plone.event.interfaces.IOccurrence"\n-        provides="plone.event.interfaces.IICalendar"\n-        factory=".exporter.calendar_from_event"\n-        />\n-\n-    <adapter\n-        for="Products.CMFCore.interfaces.ISiteRoot"\n-        provides="plone.event.interfaces.IICalendar"\n-        factory=".exporter.calendar_from_container"\n-        />\n-\n-    <adapter\n-        for="plone.folder.interfaces.IFolder"\n-        provides="plone.event.interfaces.IICalendar"\n-        factory=".exporter.calendar_from_container"\n-        />\n-\n-    <adapter\n-        for="plone.app.contenttypes.interfaces.ICollection"\n-        provides="plone.event.interfaces.IICalendar"\n-        factory=".exporter.calendar_from_collection"\n-        zcml:condition="installed plone.app.contenttypes"\n-        />\n-\n-    <!-- ICal Browser Views -->\n-    <browser:page\n-        for="plone.event.interfaces.IEvent"\n-        name="ics_view"\n-        class=".exporter.EventsICal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <browser:page\n-        for="plone.event.interfaces.IOccurrence"\n-        name="ics_view"\n-        class=".exporter.EventsICal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <browser:page\n-        for="Products.CMFCore.interfaces.ISiteRoot"\n-        name="ics_view"\n-        class=".exporter.EventsICal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <browser:page\n-        for="plone.folder.interfaces.IFolder"\n-        name="ics_view"\n-        class=".exporter.EventsICal"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <browser:page\n-        for="plone.app.contenttypes.interfaces.ICollection"\n-        name="ics_view"\n-        class=".exporter.EventsICal"\n-        permission="zope2.View"\n-        zcml:condition="installed plone.app.contenttypes"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <!-- Ical import -->\n-    <adapter factory=".importer.IcalendarImportSettings"/>\n-\n-    <browser:page\n-        for="plone.folder.interfaces.IFolder"\n-        name="ical_import_settings"\n-        class=".importer.IcalendarImportSettingsFormView"\n-        allowed_attributes="enable\n-                            disable"\n-        permission="plone.app.event.ImportIcal"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="ical_import_tool"\n-        class=".importer.IcalendarImportTool"\n-        allowed_attributes="enabled\n-                            available\n-                            available_disabled"\n-        permission="zope2.View"\n-        layer="..interfaces.IBrowserLayer"\n-        />\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone"\n+    >\n+\n+  <adapter\n+      factory=".exporter.ICalendarEventComponent"\n+      for="plone.event.interfaces.IEvent"\n+      />\n+\n+  <adapter\n+      factory=".exporter.ICalendarEventComponent"\n+      for="plone.event.interfaces.IOccurrence"\n+      />\n+\n+  <adapter\n+      factory=".exporter.calendar_from_event"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="plone.event.interfaces.IEvent"\n+      />\n+\n+  <adapter\n+      factory=".exporter.calendar_from_event"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="plone.event.interfaces.IOccurrence"\n+      />\n+\n+  <adapter\n+      factory=".exporter.calendar_from_container"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      />\n+\n+  <adapter\n+      factory=".exporter.calendar_from_container"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="plone.folder.interfaces.IFolder"\n+      />\n+\n+  <adapter\n+      factory=".exporter.calendar_from_collection"\n+      provides="plone.event.interfaces.IICalendar"\n+      for="plone.app.contenttypes.interfaces.ICollection"\n+      zcml:condition="installed plone.app.contenttypes"\n+      />\n+\n+  <!-- ICal Browser Views -->\n+  <browser:page\n+      name="ics_view"\n+      for="plone.event.interfaces.IEvent"\n+      class=".exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="ics_view"\n+      for="plone.event.interfaces.IOccurrence"\n+      class=".exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="ics_view"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      class=".exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="ics_view"\n+      for="plone.folder.interfaces.IFolder"\n+      class=".exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="ics_view"\n+      for="plone.app.contenttypes.interfaces.ICollection"\n+      class=".exporter.EventsICal"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      zcml:condition="installed plone.app.contenttypes"\n+      />\n+\n+  <!-- Ical import -->\n+  <adapter factory=".importer.IcalendarImportSettings" />\n+\n+  <browser:page\n+      name="ical_import_settings"\n+      for="plone.folder.interfaces.IFolder"\n+      class=".importer.IcalendarImportSettingsFormView"\n+      allowed_attributes="enable                             disable"\n+      permission="plone.app.event.ImportIcal"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n+\n+  <browser:page\n+      name="ical_import_tool"\n+      for="*"\n+      class=".importer.IcalendarImportTool"\n+      allowed_attributes="enabled                             available                             available_disabled"\n+      permission="zope2.View"\n+      layer="..interfaces.IBrowserLayer"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/ical/exporter.py b/plone/app/event/ical/exporter.py\nindex 6d4fb004a..bd9f81566 100644\n--- a/plone/app/event/ical/exporter.py\n+++ b/plone/app/event/ical/exporter.py\n@@ -66,13 +66,12 @@ def construct_icalendar(context, events):\n             tzmap = add_to_zones_map(tzmap, tz_end, acc.end)\n         cal.add_component(IICalendarEventComponent(event).to_ical())\n \n-    for (tzid, transitions) in tzmap.items():\n+    for tzid, transitions in tzmap.items():\n         cal_tz = icalendar.Timezone()\n         cal_tz.add("tzid", tzid)\n         cal_tz.add("x-lic-location", tzid)\n \n-        for (transition, tzinfo) in transitions.items():\n-\n+        for transition, tzinfo in transitions.items():\n             if tzinfo["dst"]:\n                 cal_tz_sub = icalendar.TimezoneDaylight()\n             else:\ndiff --git a/plone/app/event/ical/importer.py b/plone/app/event/ical/importer.py\nindex 022961c8a..a64e312b8 100644\n--- a/plone/app/event/ical/importer.py\n+++ b/plone/app/event/ical/importer.py\n@@ -100,7 +100,7 @@ def _from_list(ical, prop):\n                 # RFC5545 doesn\'t define clearly, if all day events should have\n                 # a end date one day after the start day at 0:00.\n                 # Internally, we handle all day events with start=0:00,\n-                # end=:23:59:59, so we substract one day here.\n+                # end=:23:59:59, so we subtract one day here.\n                 end = end - datetime.timedelta(days=1)\n             start = base.dt_start_of_day(date_to_datetime(start))\n             end = base.dt_end_of_day(date_to_datetime(end))\n@@ -231,7 +231,6 @@ def no_file_protocol_url(value):\n \n \n class IIcalendarImportSettings(Interface):\n-\n     event_type = schema.Choice(\n         title=_("ical_import_event_type_title", default="Event Type"),\n         description=_(\n@@ -335,7 +334,6 @@ def handleSaveImport(self, action):\n         sync_strategy = data["sync_strategy"]\n \n         if ical_file or ical_url:\n-\n             if ical_file:\n                 # File upload is not saved in settings\n                 ical_resource = ical_file.data\ndiff --git a/plone/app/event/portlets/configure.zcml b/plone/app/event/portlets/configure.zcml\nindex b9e8713a6..83beb2a30 100644\n--- a/plone/app/event/portlets/configure.zcml\n+++ b/plone/app/event/portlets/configure.zcml\n@@ -1,26 +1,28 @@\n-<configure xmlns="http://namespaces.zope.org/zope"\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n-    <plone:portlet\n-        name="portlets.Calendar"\n-        interface=".portlet_calendar.ICalendarPortlet"\n-        assignment=".portlet_calendar.Assignment"\n-        renderer=".portlet_calendar.Renderer"\n-        addview=".portlet_calendar.AddForm"\n-        editview=".portlet_calendar.EditForm"\n-        zcml:condition="have plone-5"\n-        />\n+  <plone:portlet\n+      name="portlets.Calendar"\n+      interface=".portlet_calendar.ICalendarPortlet"\n+      assignment=".portlet_calendar.Assignment"\n+      renderer=".portlet_calendar.Renderer"\n+      addview=".portlet_calendar.AddForm"\n+      editview=".portlet_calendar.EditForm"\n+      zcml:condition="have plone-5"\n+      />\n \n-    <plone:portlet\n-        name="portlets.Events"\n-        interface=".portlet_events.IEventsPortlet"\n-        assignment=".portlet_events.Assignment"\n-        renderer=".portlet_events.Renderer"\n-        addview=".portlet_events.AddForm"\n-        editview=".portlet_events.EditForm"\n-        zcml:condition="have plone-5"\n-        />\n+  <plone:portlet\n+      name="portlets.Events"\n+      interface=".portlet_events.IEventsPortlet"\n+      assignment=".portlet_events.Assignment"\n+      renderer=".portlet_events.Renderer"\n+      addview=".portlet_events.AddForm"\n+      editview=".portlet_events.EditForm"\n+      zcml:condition="have plone-5"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/portlets/portlet_calendar.pt b/plone/app/event/portlets/portlet_calendar.pt\nindex e2da9fc69..81be89116 100644\n--- a/plone/app/event/portlets/portlet_calendar.pt\n+++ b/plone/app/event/portlets/portlet_calendar.pt\n@@ -1,75 +1,119 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n       i18n:domain="plone"\n-      tal:omit-tag="">\n+>\n \n   <div class="card portlet portlet-calendar"\n-      tal:define="navigation_root_url context/@@plone_portal_state/navigation_root_url; month view/month; year view/year;">\n+       tal:define="\n+         navigation_root_url context/@@plone_portal_state/navigation_root_url;\n+         month view/month;\n+         year view/year;\n+       "\n+  >\n \n     <div class="card-header text-center">\n-      <a href="#" rel="nofollow" class="calendarPrevious pat-contentloader" title="Previous month"\n-          tal:define="prev_month view/prev_month;\n-                      prev_year view/prev_year"\n-          tal:attributes="href view/prev_query;\n-                          data-year prev_year;\n-                          data-month prev_month;\n-                          data-pat-contentloader python: view.nav_pattern_options(prev_year, prev_month)"\n-          i18n:attributes="title title_previous_month;">&laquo;</a>\n+      <a class="calendarPrevious pat-contentloader"\n+         href="#"\n+         rel="nofollow"\n+         title="Previous month"\n+         tal:define="\n+           prev_month view/prev_month;\n+           prev_year view/prev_year;\n+         "\n+         tal:attributes="\n+           href view/prev_query;\n+           data-year prev_year;\n+           data-month prev_month;\n+           data-pat-contentloader python: view.nav_pattern_options(prev_year, prev_month);\n+         "\n+         i18n:attributes="title title_previous_month;"\n+      >&laquo;</a>\n \n-      <span i18n:translate="" tal:omit-tag="">\n-        <span i18n:name="monthname" i18n:translate=""\n-            tal:content="view/month_name"\n-            tal:omit-tag="">monthname</span>\n-        <span i18n:name="year" i18n:translate=""\n-            tal:content="year"\n-            tal:omit-tag="">year</span>\n+      <span tal:omit-tag=""\n+            i18n:translate=""\n+      >\n+        <span tal:content="view/month_name"\n+              tal:omit-tag=""\n+              i18n:name="monthname"\n+              i18n:translate=""\n+        >monthname</span>\n+        <span tal:content="year"\n+              tal:omit-tag=""\n+              i18n:name="year"\n+              i18n:translate=""\n+        >year</span>\n       </span>\n \n-      <a href="#" rel="nofollow" class="calendarNext pat-contentloader" title="Next month"\n-            tal:define="next_month view/next_month;\n-                        next_year view/next_year"\n-            tal:attributes="href view/next_query;\n-                            data-year next_year;\n-                            data-month next_month;\n-                            data-pat-contentloader python: view.nav_pattern_options(next_year, next_month)"\n-            i18n:attributes="title title_next_month;">&raquo;</a>\n+      <a class="calendarNext pat-contentloader"\n+         href="#"\n+         rel="nofollow"\n+         title="Next month"\n+         tal:define="\n+           next_month view/next_month;\n+           next_year view/next_year;\n+         "\n+         tal:attributes="\n+           href view/next_query;\n+           data-year next_year;\n+           data-month next_month;\n+           data-pat-contentloader python: view.nav_pattern_options(next_year, next_month);\n+         "\n+         i18n:attributes="title title_next_month;"\n+      >&raquo;</a>\n     </div>\n \n     <div class="card-body table-responsive">\n-      <table class="table table-sm table-borderless mb-0" summary="Calendar" i18n:attributes="summary summary_calendar">\n-        <caption class="hiddenStructure" i18n:translate="" tal:content="string:month-${month}">monthname</caption>\n+      <table class="table table-sm table-borderless mb-0"\n+             summary="Calendar"\n+             i18n:attributes="summary summary_calendar"\n+      >\n+        <caption class="hiddenStructure"\n+                 tal:content="string:month-${month}"\n+                 i18n:translate=""\n+        >monthname</caption>\n         <thead>\n           <tr class="weekdays"><tal:data repeat="weekday view/weekdays">\n-            <th scope="col" i18n:translate="" tal:content="weekday">Su</th>\n-          </tal:data></tr>\n+              <th scope="col"\n+                  tal:content="weekday"\n+                  i18n:translate=""\n+              >Su</th>\n+            </tal:data></tr>\n         </thead>\n         <tbody>\n           <tr tal:repeat="week view/cal_data">\n             <tal:block repeat="day week">\n-            <td class="event"\n-                tal:define="today day/today;\n-                            next_month day/next_month;\n-                            prev_month day/prev_month;\n-                            events day/events;\n-                            limit python:len(events) if events is not None else 0"\n-                tal:attributes="class python:u\'event%s%s%s%s\' %\n+              <td class="event"\n+                  tal:define="\n+                    today day/today;\n+                    next_month day/next_month;\n+                    prev_month day/prev_month;\n+                    events day/events;\n+                    limit python:len(events) if events is not None else 0;\n+                  "\n+                  tal:attributes="\n+                    class python:u\'event%s%s%s%s\' %\n                             ((\' today\' if today else \'\'),\n                             (\' cal_next_month\' if next_month else \'\'),\n                             (\' cal_prev_month\' if prev_month else \'\'),\n-                            (\' cal_has_events\' if events else \'\'))">\n-              <tal:comment tal:condition="nothing">Add span or a to style td children and not td</tal:comment>\n-              <span\n-                  tal:condition="not:events"\n-                  tal:content="day/day"></span>\n-              <a href=""\n-                  tal:condition="events"\n-                  tal:attributes="href python:view.date_events_url(day[\'date_string\']);\n-                                  title day/events_string;"\n-\n-                  tal:content="day/day">31</a>\n+                            (\' cal_has_events\' if events else \'\'));\n+                  "\n+              >\n+                <tal:comment tal:condition="nothing">Add span or a to style td children and not td</tal:comment>\n+                <span tal:condition="not:events"\n+                      tal:content="day/day"\n+                ></span>\n+                <a href=""\n+                   tal:condition="events"\n+                   tal:content="day/day"\n+                   tal:attributes="\n+                     href python:view.date_events_url(day[\'date_string\']);\n+                     title day/events_string;\n+                   "\n+                >31</a>\n \n-            </td>\n+              </td>\n             </tal:block>\n           </tr>\n         </tbody>\n@@ -78,4 +122,4 @@\n \n   </div>\n \n-</html>\n\\ No newline at end of file\n+</html>\ndiff --git a/plone/app/event/portlets/portlet_events.pt b/plone/app/event/portlets/portlet_events.pt\nindex 95beefc71..a3a1fe744 100644\n--- a/plone/app/event/portlets/portlet_events.pt\n+++ b/plone/app/event/portlets/portlet_events.pt\n@@ -1,71 +1,110 @@\n <html xmlns="http://www.w3.org/1999/xhtml"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-      tal:omit-tag="">\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      tal:omit-tag=""\n+>\n \n   <div class="card portlet portletEvents"\n-      i18n:domain="plone">\n+       i18n:domain="plone"\n+  >\n \n     <div class="card-header portletHeader">\n-      <a href="" class="tile"\n-          tal:define="next_link view/next_url"\n-          tal:omit-tag="not:next_link"\n-          tal:attributes="href next_link"\n-          i18n:translate="box_events">\n+      <a class="tile"\n+         href=""\n+         tal:define="\n+           next_link view/next_url;\n+         "\n+         tal:omit-tag="not:next_link"\n+         tal:attributes="\n+           href next_link;\n+         "\n+         i18n:translate="box_events"\n+      >\n           Upcoming Events\n       </a>\n     </div>\n \n     <div class="card-body portletContent">\n-      <ul tal:define="thumb_scale view/thumb_scale">\n+      <ul tal:define="\n+            thumb_scale view/thumb_scale;\n+          ">\n         <tal:events repeat="item view/events">\n-        <li class="portletItem"\n-            tal:define="oddrow repeat/item/odd;\n-                        item_url      item/url;\n-                        item_descr    item/description;\n-                        item_title    item/title;\n-                        item_location item/location;\n-                        item_hasimage python:getattr(item.context.aq_base, \'image\', None)"\n-            tal:attributes="class python:\'portletItem odd\' if oddrow else \'portletItem even\'">\n-          <a href="#" class="tile"\n-              tal:attributes="href item_url;\n-                              title item_descr"\n-              tal:define="scale item/context/@@images|nothing;">\n-            <span tal:condition="item_hasimage">\n-              <img tal:define="img_tag python:scale.scale(\'image\', scale=thumb_scale).tag(css_class=\'float-end thumb-\'+thumb_scale)"\n-                  tal:replace="structure img_tag" />\n-            </span>\n-            <span tal:replace="item_title">Some Event</span>\n-          </a>\n-          <span class="portletItemDetails">\n-            <tal:date replace="structure python:view.formatted_date(item)" />\n-            <span class="timezone"\n-                tal:define="tz item/timezone"\n-                tal:condition="tz">\n-              (<tal:tzname replace="tz">TZ</tal:tzname>)\n-            </span>\n-            <span class="location"\n-                tal:condition="item_location"> &mdash;\n-              <tal:location content="item_location">Location</tal:location>\n+          <li class="portletItem"\n+              tal:define="\n+                oddrow repeat/item/odd;\n+                item_url      item/url;\n+                item_descr    item/description;\n+                item_title    item/title;\n+                item_location item/location;\n+                item_hasimage python:getattr(item.context.aq_base, \'image\', None);\n+              "\n+              tal:attributes="\n+                class python:\'portletItem odd\' if oddrow else \'portletItem even\';\n+              "\n+          >\n+            <a class="tile"\n+               href="#"\n+               tal:define="\n+                 scale item/context/@@images|nothing;\n+               "\n+               tal:attributes="\n+                 href item_url;\n+                 title item_descr;\n+               "\n+            >\n+              <span tal:condition="item_hasimage">\n+                <img tal:define="\n+                       img_tag python:scale.scale(\'image\', scale=thumb_scale).tag(css_class=\'float-end thumb-\'+thumb_scale);\n+                     "\n+                     tal:replace="structure img_tag"\n+                />\n+              </span>\n+              <span tal:replace="item_title">Some Event</span>\n+            </a>\n+            <span class="portletItemDetails">\n+              <tal:date replace="structure python:view.formatted_date(item)" />\n+              <span class="timezone"\n+                    tal:define="\n+                      tz item/timezone;\n+                    "\n+                    tal:condition="tz"\n+              >\n+                (<tal:tzname replace="tz">TZ</tal:tzname>)\n+              </span>\n+              <span class="location"\n+                    tal:condition="item_location"\n+              >\n+                 &mdash;\n+                <tal:location content="item_location">Location</tal:location>\n+              </span>\n             </span>\n-          </span>\n-        </li>\n+          </li>\n         </tal:events>\n       </ul>\n     </div>\n \n     <div class="card-footer portletFooter d-flex justify-content-around">\n       <a class="p-6 tile previous-events"\n-          tal:define="prev_link view/prev_url"\n-          tal:condition="prev_link"\n-          tal:attributes="href prev_link"\n-          i18n:translate="box_previous_events">\n+         tal:define="\n+           prev_link view/prev_url;\n+         "\n+         tal:condition="prev_link"\n+         tal:attributes="\n+           href prev_link;\n+         "\n+         i18n:translate="box_previous_events"\n+      >\n         Previous events&hellip;\n       </a>\n       <a class="p-6 tile upcoming-events"\n-          tal:define="next_link view/next_url"\n-          tal:attributes="href next_link"\n-          i18n:translate="box_upcoming_events">\n+         tal:define="\n+           next_link view/next_url;\n+         "\n+         tal:attributes="\n+           href next_link;\n+         "\n+         i18n:translate="box_upcoming_events"\n+      >\n         Upcoming events&hellip;\n       </a>\n     </div>\ndiff --git a/plone/app/event/portlets/portlet_events.py b/plone/app/event/portlets/portlet_events.py\nindex ed7f3bf66..db67a036b 100644\n--- a/plone/app/event/portlets/portlet_events.py\n+++ b/plone/app/event/portlets/portlet_events.py\n@@ -28,7 +28,6 @@\n \n \n class IEventsPortlet(IPortletDataProvider):\n-\n     count = schema.Int(\n         title=_("Number of items to display"),\n         description=_("How many items to list."),\n@@ -80,7 +79,6 @@ class IEventsPortlet(IPortletDataProvider):\n \n @implementer(IEventsPortlet)\n class Assignment(base.Assignment):\n-\n     # reduce upgrade pain\n     thumb_scale = None\n     no_thumbs = False\n@@ -118,7 +116,6 @@ def _uid(self):\n \n \n class Renderer(base.Renderer):\n-\n     _template = ViewPageTemplateFile("portlet_events.pt")\n     _search_base = None\n \n@@ -200,7 +197,7 @@ def events(self):\n                 ret_mode=RET_MODE_ACCESSORS,\n                 expand=True,\n                 limit=data.count,\n-                **query\n+                **query,\n             )\n \n         return events\ndiff --git a/plone/app/event/profiles/default/actions.xml b/plone/app/event/profiles/default/actions.xml\nindex 5adfdd78e..5af965873 100644\n--- a/plone/app/event/profiles/default/actions.xml\n+++ b/plone/app/event/profiles/default/actions.xml\n@@ -1,42 +1,69 @@\n-<?xml version="1.0"?>\n-<object name="portal_actions" meta_type="Plone Actions Tool"\n-   xmlns:i18n="http://xml.zope.org/namespaces/i18n">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Plone Actions Tool"\n+        name="portal_actions"\n+>\n \n- <object name="object" meta_type="CMF Action Category">\n-  <object name="ical_import_settings" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="title_ical_import">Ical import</property>\n-   <property name="description" i18n:translate="help_ical_import">Import Events from icalendar files.</property>\n-   <property name="url_expr">string:${object_url}/@@ical_import_settings</property>\n-   <property name="icon_expr"></property>\n-   <property name="available_expr">object/@@ical_import_tool/enabled|nothing</property>\n-   <property name="permissions">\n-    <element value="plone.app.event: Import Ical"/>\n-   </property>\n-   <property name="visible">True</property>\n+  <object meta_type="CMF Action Category"\n+          name="object"\n+  >\n+    <object meta_type="CMF Action"\n+            name="ical_import_settings"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate="title_ical_import"\n+      >Ical import</property>\n+      <property name="description"\n+                i18n:translate="help_ical_import"\n+      >Import Events from icalendar files.</property>\n+      <property name="url_expr">string:${object_url}/@@ical_import_settings</property>\n+      <property name="icon_expr" />\n+      <property name="available_expr">object/@@ical_import_tool/enabled|nothing</property>\n+      <property name="permissions">\n+        <element value="plone.app.event: Import Ical" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n   </object>\n- </object>\n \n- <object name="object_buttons" meta_type="CMF Action Category">\n-  <object name="ical_import_enable" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="title_ical_import_enable">Enable icalendar import</property>\n-   <property name="description" i18n:translate="help_ical_import_enable">Click to enable the icalendar import feature on this context.</property>\n-   <property name="url_expr">string:$object_url/@@ical_import_settings/enable</property>\n-   <property name="available_expr">object/@@ical_import_tool/available_disabled|nothing</property>\n-   <property name="permissions">\n-    <element value="plone.app.event: Import Ical" />\n-   </property>\n-   <property name="visible">True</property>\n+  <object meta_type="CMF Action Category"\n+          name="object_buttons"\n+  >\n+    <object meta_type="CMF Action"\n+            name="ical_import_enable"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate="title_ical_import_enable"\n+      >Enable icalendar import</property>\n+      <property name="description"\n+                i18n:translate="help_ical_import_enable"\n+      >Click to enable the icalendar import feature on this context.</property>\n+      <property name="url_expr">string:$object_url/@@ical_import_settings/enable</property>\n+      <property name="available_expr">object/@@ical_import_tool/available_disabled|nothing</property>\n+      <property name="permissions">\n+        <element value="plone.app.event: Import Ical" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n+    <object meta_type="CMF Action"\n+            name="ical_import_disable"\n+            i18n:domain="plone"\n+    >\n+      <property name="title"\n+                i18n:translate="title_ical_import_disable"\n+      >Disable icalendar import</property>\n+      <property name="description"\n+                i18n:translate="help_ical_import_disable"\n+      >Click to disable the icalendar import feature on this context.</property>\n+      <property name="url_expr">string:$object_url/@@ical_import_settings/disable</property>\n+      <property name="available_expr">object/@@ical_import_tool/enabled|nothing</property>\n+      <property name="permissions">\n+        <element value="plone.app.event: Import Ical" />\n+      </property>\n+      <property name="visible">True</property>\n+    </object>\n   </object>\n-  <object name="ical_import_disable" meta_type="CMF Action" i18n:domain="plone">\n-   <property name="title" i18n:translate="title_ical_import_disable">Disable icalendar import</property>\n-   <property name="description" i18n:translate="help_ical_import_disable">Click to disable the icalendar import feature on this context.</property>\n-   <property name="url_expr">string:$object_url/@@ical_import_settings/disable</property>\n-   <property name="available_expr">object/@@ical_import_tool/enabled|nothing</property>\n-   <property name="permissions">\n-    <element value="plone.app.event: Import Ical" />\n-   </property>\n-   <property name="visible">True</property>\n-  </object>\n- </object>\n \n </object>\ndiff --git a/plone/app/event/profiles/default/browserlayer.xml b/plone/app/event/profiles/default/browserlayer.xml\nindex e8cc759ad..260a2f622 100644\n--- a/plone/app/event/profiles/default/browserlayer.xml\n+++ b/plone/app/event/profiles/default/browserlayer.xml\n@@ -1,6 +1,6 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <layers>\n-  <layer\n-      name="plone.app.event"\n-      interface="plone.app.event.interfaces.IBrowserLayer" />\n+  <layer interface="plone.app.event.interfaces.IBrowserLayer"\n+         name="plone.app.event"\n+  />\n </layers>\ndiff --git a/plone/app/event/profiles/default/controlpanel.xml b/plone/app/event/profiles/default/controlpanel.xml\nindex 3b80bc26e..43822dea8 100644\n--- a/plone/app/event/profiles/default/controlpanel.xml\n+++ b/plone/app/event/profiles/default/controlpanel.xml\n@@ -1,15 +1,14 @@\n-<?xml version="1.0"?>\n-<object\n-    name="portal_controlpanel"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    i18n:domain="plone"\n-    purge="False">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        name="portal_controlpanel"\n+        purge="False"\n+        i18n:domain="plone"\n+>\n \n-    <!-- Hide old calendar calendar settings if there -->\n-    <configlet\n-        title="Calendar"\n-        action_id="CalendarSettings"\n-        visible="False"\n-        />\n+  <!-- Hide old calendar calendar settings if there -->\n+  <configlet action_id="CalendarSettings"\n+             title="Calendar"\n+             visible="False"\n+  />\n \n </object>\ndiff --git a/plone/app/event/profiles/default/metadata.xml b/plone/app/event/profiles/default/metadata.xml\nindex d7cd1512a..d1aa804e1 100644\n--- a/plone/app/event/profiles/default/metadata.xml\n+++ b/plone/app/event/profiles/default/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>15</version>\n   <dependencies>\ndiff --git a/plone/app/event/profiles/default/portlets.xml b/plone/app/event/profiles/default/portlets.xml\nindex fe2d5ebd5..3028b1e87 100644\n--- a/plone/app/event/profiles/default/portlets.xml\n+++ b/plone/app/event/profiles/default/portlets.xml\n@@ -1,39 +1,34 @@\n-<?xml version="1.0"?>\n-<portlets\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    i18n:domain="plone">\n+<?xml version="1.0" encoding="utf-8"?>\n+<portlets xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+          i18n:domain="plone"\n+>\n \n- <portlet\n-   addview="portlets.Calendar"\n-   title="Calendar portlet"\n-   description="A portlet which can render a calendar."\n-   i18n:attributes="title;\n-                    description"\n-   >\n-   <for interface="plone.app.portlets.interfaces.IColumn" />\n-   <for interface="plone.app.portlets.interfaces.IDashboard" />\n- </portlet>\n+  <portlet addview="portlets.Calendar"\n+           description="A portlet which can render a calendar."\n+           title="Calendar portlet"\n+           i18n:attributes="title;                     description"\n+  >\n+    <for interface="plone.app.portlets.interfaces.IColumn" />\n+    <for interface="plone.app.portlets.interfaces.IDashboard" />\n+  </portlet>\n \n- <portlet\n-   addview="portlets.Events"\n-   title="Events"\n-   description="A portlet which can render a listing of recent events"\n-   i18n:attributes="title;\n-                    description"\n-   >\n-   <for interface="plone.app.portlets.interfaces.IColumn" />\n-   <for interface="plone.app.portlets.interfaces.IDashboard" />\n- </portlet>\n+  <portlet addview="portlets.Events"\n+           description="A portlet which can render a listing of recent events"\n+           title="Events"\n+           i18n:attributes="title;                     description"\n+  >\n+    <for interface="plone.app.portlets.interfaces.IColumn" />\n+    <for interface="plone.app.portlets.interfaces.IDashboard" />\n+  </portlet>\n \n- <assignment\n-     manager="plone.rightcolumn"\n-     category="context"\n-     key="/"\n-     type="portlets.Events"\n-     name="events"\n-     />\n+  <assignment category="context"\n+              key="/"\n+              manager="plone.rightcolumn"\n+              name="events"\n+              type="portlets.Events"\n+  />\n \n- <!-- EXAMPLE ASSIGNMENTS\n+  <!-- EXAMPLE ASSIGNMENTS\n  <assignment\n      manager="plone.rightcolumn"\n      category="context"\ndiff --git a/plone/app/event/profiles/default/registry.xml b/plone/app/event/profiles/default/registry.xml\nindex 3289fb8b3..c5afb6a66 100644\n--- a/plone/app/event/profiles/default/registry.xml\n+++ b/plone/app/event/profiles/default/registry.xml\n@@ -1,11 +1,13 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <registry>\n \n-  <records prefix="plone.bundles/eventedit" interface=\'Products.CMFPlone.interfaces.IBundleRegistry\'>\n+  <records interface="Products.CMFPlone.interfaces.IBundleRegistry"\n+           prefix="plone.bundles/eventedit"\n+  >\n     <value key="enabled">True</value>\n     <value key="expression">python: member is not None</value>\n     <value key="jscompilation">++plone++plone.app.event/event.js</value>\n-    <value key="csscompilation"></value>\n+    <value key="csscompilation" />\n     <value key="load_async">False</value>\n     <value key="load_defer">False</value>\n   </records>\ndiff --git a/plone/app/event/profiles/default/rolemap.xml b/plone/app/event/profiles/default/rolemap.xml\nindex d4a41c5af..c3d542034 100644\n--- a/plone/app/event/profiles/default/rolemap.xml\n+++ b/plone/app/event/profiles/default/rolemap.xml\n@@ -1,11 +1,13 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <rolemap>\n   <permissions>\n-    <permission name="plone.app.event: Import Ical" acquire="True">\n+    <permission acquire="True"\n+                name="plone.app.event: Import Ical"\n+    >\n       <role name="Manager" />\n       <role name="Site Administrator" />\n-      <role name="Editor"/>\n-      <role name="Owner"/>\n+      <role name="Editor" />\n+      <role name="Owner" />\n     </permission>\n   </permissions>\n </rolemap>\ndiff --git a/plone/app/event/profiles/default/types.xml b/plone/app/event/profiles/default/types.xml\nindex f62133b44..b6015b206 100644\n--- a/plone/app/event/profiles/default/types.xml\n+++ b/plone/app/event/profiles/default/types.xml\n@@ -1,6 +1,14 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n-<object name="portal_types" meta_type="Plone Types Tool">\n-  <object name="Plone Site" meta_type="Factory-based Type Information with dynamic views"/>\n-  <object name="Folder"     meta_type="Dexterity FTI"/>\n-  <object name="Collection" meta_type="Dexterity FTI"/>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n+  <object meta_type="Factory-based Type Information with dynamic views"\n+          name="Plone Site"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Folder"\n+  />\n+  <object meta_type="Dexterity FTI"\n+          name="Collection"\n+  />\n </object>\ndiff --git a/plone/app/event/profiles/default/types/Collection.xml b/plone/app/event/profiles/default/types/Collection.xml\nindex 1a79d3198..53b694a74 100644\n--- a/plone/app/event/profiles/default/types/Collection.xml\n+++ b/plone/app/event/profiles/default/types/Collection.xml\n@@ -1,6 +1,8 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="Collection">\n- <property name="view_methods" purge="False">\n-  <element value="event_listing"/>\n- </property>\n+  <property name="view_methods"\n+            purge="False"\n+  >\n+    <element value="event_listing" />\n+  </property>\n </object>\ndiff --git a/plone/app/event/profiles/default/types/Folder.xml b/plone/app/event/profiles/default/types/Folder.xml\nindex 84e858a28..5fa02da8a 100644\n--- a/plone/app/event/profiles/default/types/Folder.xml\n+++ b/plone/app/event/profiles/default/types/Folder.xml\n@@ -1,6 +1,8 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="Folder">\n- <property name="view_methods" purge="False">\n-  <element value="event_listing"/>\n- </property>\n+  <property name="view_methods"\n+            purge="False"\n+  >\n+    <element value="event_listing" />\n+  </property>\n </object>\ndiff --git a/plone/app/event/profiles/default/types/Plone_Site.xml b/plone/app/event/profiles/default/types/Plone_Site.xml\nindex 692af4add..cdb5f1927 100644\n--- a/plone/app/event/profiles/default/types/Plone_Site.xml\n+++ b/plone/app/event/profiles/default/types/Plone_Site.xml\n@@ -1,6 +1,8 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <object name="Plone Site">\n- <property name="view_methods" purge="False">\n-  <element value="event_listing"/>\n- </property>\n+  <property name="view_methods"\n+            purge="False"\n+  >\n+    <element value="event_listing" />\n+  </property>\n </object>\ndiff --git a/plone/app/event/profiles/testing/metadata.xml b/plone/app/event/profiles/testing/metadata.xml\nindex 3cbcf5b88..22c4db4b2 100644\n--- a/plone/app/event/profiles/testing/metadata.xml\n+++ b/plone/app/event/profiles/testing/metadata.xml\n@@ -1,4 +1,4 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <metadata>\n   <version>1</version>\n   <dependencies>\ndiff --git a/plone/app/event/profiles/testing/types.xml b/plone/app/event/profiles/testing/types.xml\nindex 9c625ec3a..868e9f9f9 100644\n--- a/plone/app/event/profiles/testing/types.xml\n+++ b/plone/app/event/profiles/testing/types.xml\n@@ -1,4 +1,8 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n-<object name="portal_types" meta_type="Plone Types Tool">\n-  <object name="plone.app.event.dx.event" meta_type="Dexterity FTI"/>\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Types Tool"\n+        name="portal_types"\n+>\n+  <object meta_type="Dexterity FTI"\n+          name="plone.app.event.dx.event"\n+  />\n </object>\ndiff --git a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\nindex 945155667..0d221d5b3 100644\n--- a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n+++ b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n@@ -1,22 +1,27 @@\n-<?xml version="1.0" encoding="UTF-8"?>\n-<object name="plone.app.event.dx.event" meta_type="Dexterity FTI"\n-    xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-    i18n:domain="plone">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Dexterity FTI"\n+        name="plone.app.event.dx.event"\n+        i18n:domain="plone"\n+>\n \n   <!-- Basic properties -->\n-  <property name="title" i18n:translate="">plone.app.event.dx.event</property>\n+  <property name="title"\n+            i18n:translate=""\n+  >plone.app.event.dx.event</property>\n   <property name="description"\n-      i18n:translate="">Events can be shown in calendars.</property>\n-  <property name="icon_expr"></property>\n+            i18n:translate=""\n+  >Events can be shown in calendars.</property>\n+  <property name="icon_expr" />\n   <property name="allow_discussion">False</property>\n \n   <!-- Hierarchy control -->\n- <property name="global_allow">True</property>\n- <property name="filter_content_types">True</property>\n- <property name="allowed_content_types"/>\n+  <property name="global_allow">True</property>\n+  <property name="filter_content_types">True</property>\n+  <property name="allowed_content_types" />\n \n   <!-- Schema, class and security -->\n-  <property name="schema"></property>\n+  <property name="schema" />\n   <property name="klass">plone.dexterity.content.Item</property>\n   <property name="add_permission">cmf.AddPortalContent</property>\n   <property name="model_source">\n@@ -24,47 +29,71 @@\n       &lt;schema&gt;\n       &lt;/schema&gt;\n   &lt;/model&gt;</property>\n-  <property name="model_file"></property>\n+  <property name="model_file" />\n \n   <!-- Enabled behaviors -->\n   <property name="behaviors">\n-    <element value="plone.eventbasic"/>\n-    <element value="plone.eventrecurrence"/>\n-    <element value="plone.eventlocation"/>\n-    <element value="plone.eventattendees"/>\n-    <element value="plone.eventcontact"/>\n-    <element value="plone.richtext"/>\n-    <element value="plone.dublincore"/>\n-    <element value="plone.namefromtitle"/>\n-    <element value="plone.allowdiscussion"/>\n-    <element value="plone.excludefromnavigation"/>\n-    <element value="plone.textindexer"/>\n+    <element value="plone.eventbasic" />\n+    <element value="plone.eventrecurrence" />\n+    <element value="plone.eventlocation" />\n+    <element value="plone.eventattendees" />\n+    <element value="plone.eventcontact" />\n+    <element value="plone.richtext" />\n+    <element value="plone.dublincore" />\n+    <element value="plone.namefromtitle" />\n+    <element value="plone.allowdiscussion" />\n+    <element value="plone.excludefromnavigation" />\n+    <element value="plone.textindexer" />\n   </property>\n \n   <!-- View and aliases -->\n- <property name="default_view">event_view</property>\n- <property name="default_view_fallback">False</property>\n- <property name="immediate_view">view</property>\n- <property name="view_methods">\n-  <element value="event_view"/>\n- </property>\n+  <property name="default_view">event_view</property>\n+  <property name="default_view_fallback">False</property>\n+  <property name="immediate_view">view</property>\n+  <property name="view_methods">\n+    <element value="event_view" />\n+  </property>\n \n- <alias from="event_view" to="@@event_view"/>\n- <alias from="(Default)" to="(dynamic view)"/>\n- <alias from="edit" to="@@edit"/>\n- <alias from="sharing" to="@@sharing"/>\n- <alias from="view" to="(selected layout)"/>\n+  <alias from="event_view"\n+         to="@@event_view"\n+  />\n+  <alias from="(Default)"\n+         to="(dynamic view)"\n+  />\n+  <alias from="edit"\n+         to="@@edit"\n+  />\n+  <alias from="sharing"\n+         to="@@sharing"\n+  />\n+  <alias from="view"\n+         to="(selected layout)"\n+  />\n \n- <action title="View" action_id="view" category="object" condition_expr=""\n-    icon_expr="" link_target="" url_expr="string:${object_url}"\n-    visible="True" i18n:attributes="title">\n-  <permission value="View"/>\n- </action>\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr=""\n+          link_target=""\n+          title="View"\n+          url_expr="string:${object_url}"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="View" />\n+  </action>\n \n- <action title="Edit" action_id="edit" category="object" condition_expr=""\n-    icon_expr="" link_target="" url_expr="string:${object_url}/edit"\n-    visible="True" i18n:attributes="title">\n-  <permission value="Modify portal content"/>\n- </action>\n+  <action action_id="edit"\n+          category="object"\n+          condition_expr=""\n+          icon_expr=""\n+          link_target=""\n+          title="Edit"\n+          url_expr="string:${object_url}/edit"\n+          visible="True"\n+          i18n:attributes="title"\n+  >\n+    <permission value="Modify portal content" />\n+  </action>\n \n </object>\ndiff --git a/plone/app/event/recurrence.zcml b/plone/app/event/recurrence.zcml\nindex 45a07e583..6324f9b04 100644\n--- a/plone/app/event/recurrence.zcml\n+++ b/plone/app/event/recurrence.zcml\n@@ -1,6 +1,7 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:browser="http://namespaces.zope.org/browser">\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    >\n \n   <adapter factory=".recurrence.RecurrenceSupport" />\n   <adapter factory=".recurrence.EventOccurrenceAccessor" />\n@@ -12,9 +13,10 @@\n \n   <!-- @@images view factory for occurrences -->\n   <browser:page\n-      for="plone.event.interfaces.IOccurrence"\n       name="images"\n+      for="plone.event.interfaces.IOccurrence"\n       class=".recurrence.ImageScalingViewFactory"\n-      permission="zope2.View" />\n+      permission="zope2.View"\n+      />\n \n </configure>\ndiff --git a/plone/app/event/testing.py b/plone/app/event/testing.py\nindex a0a1e438e..e6e83ecfa 100644\n--- a/plone/app/event/testing.py\n+++ b/plone/app/event/testing.py\n@@ -99,7 +99,6 @@ def tearDownZope(self, app):\n \n \n class PAEventDXLayer(PloneSandboxLayer):\n-\n     defaultBases = (PAEvent_FIXTURE,)\n \n     def setUpZope(self, app, configurationContext):\ndiff --git a/plone/app/event/tests/javascripts/test_event.html b/plone/app/event/tests/javascripts/test_event.html\nindex 8943fc14e..0dbd75ad5 100644\n--- a/plone/app/event/tests/javascripts/test_event.html\n+++ b/plone/app/event/tests/javascripts/test_event.html\n@@ -1,1077 +1,1190 @@\n <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"\n "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n \n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      dir="ltr" id="html">\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      id="html"\n+      dir="ltr"\n+      lang="en"\n+      xml:lang="en"\n+>\n   <head>\n     <title>plone.app.event Test Suite</title>\n-    \n+\n     <!-- qUnit -->\n-    <link rel="stylesheet" href="../qunit/qunit.css" type="text/css" \n-          media="screen" />\n-    <script type="text/javascript" src="../qunit/qunit.js"></script>\n-\t\n+    <link href="../qunit/qunit.css"\n+          media="screen"\n+          rel="stylesheet"\n+          type="text/css"\n+    />\n+    <script src="../qunit/qunit.js"\n+            type="text/javascript"\n+    ></script>\n+\n     <!-- jQuery -->\n-    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>\n-    <script type="text/javascript" src="http://cdn.jquerytools.org/1.2.5/full/jquery.tools.min.js"></script>\n+    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"\n+            type="text/javascript"\n+    ></script>\n+    <script src="http://cdn.jquerytools.org/1.2.5/full/jquery.tools.min.js"\n+            type="text/javascript"\n+    ></script>\n+\n+    <!-- Tests -->\n+    <script src="test_event.js"\n+            type="text/javascript"\n+    ></script>\n+\n+  </head>\n+\n+  <body>\n+    <h1 id="qunit-header">plone.app.event Test Suite</h1>\n+\n+    <h2 id="qunit-banner"></h2>\n+\n+    <div id="qunit-testrunner-toolbar">\n+    </div>\n+\n+    <h2 id="qunit-userAgent"></h2>\n+\n+    <ol id="qunit-tests">\n+    </ol>\n+\n+    <div id="qunit-fixture">\n+      <div id="event">\n+        <div class="field ArchetypesBooleanWidget kssattr-atfieldname-wholeDay"\n+             id="archetypes-fieldname-wholeDay"\n+        >\n+\n+          <input class="noborder"\n+                 id="wholeDay"\n+                 name="wholeDay:boolean"\n+                 type="checkbox"\n+                 value="on"\n+          />\n+          <input name="wholeDay:boolean:default"\n+                 originalvalue=""\n+                 type="hidden"\n+                 value=""\n+          />\n+\n+          <label class="formQuestion"\n+                 for="wholeDay"\n+          >Whole day event</label>\n+\n+          <div class="formHelp"\n+               id="wholeDay_help"\n+          ></div>\n+\n+          <div class="fieldErrorBox"></div>\n+          <div></div>\n+        </div>\n+        <div class="field Archetypes DatetimeWidget kssattr-atfieldname-startDate"\n+             id="archetypes-fieldname-startDate"\n+        >\n+\n+          <div class="fieldErrorBox"></div>\n+          <div>\n+\n+            <!-- day -->\n+            <select class="day"\n+                    id="startDate-day"\n+                    name="startDate-day"\n+            >\n+\n+              <option selected="selected"\n+                      value="1"\n+              >01</option>\n+\n+\n+              <option value="2">02</option>\n+\n+\n+              <option value="3">03</option>\n+\n+\n+              <option value="4">04</option>\n+\n+\n+              <option value="5">05</option>\n+\n+\n+              <option value="6">06</option>\n+\n+\n+              <option value="7">07</option>\n+\n+\n+              <option value="8">08</option>\n+\n+\n+              <option value="9">09</option>\n+\n+\n+              <option value="10">10</option>\n+\n+\n+              <option value="11">11</option>\n+\n+\n+              <option value="12">12</option>\n+\n+\n+              <option value="13">13</option>\n+\n+\n+              <option value="14">14</option>\n+\n+\n+              <option value="15">15</option>\n+\n+\n+              <option value="16">16</option>\n+\n+\n+              <option value="17">17</option>\n+\n+\n+              <option value="18">18</option>\n+\n+\n+              <option value="19">19</option>\n+\n+\n+              <option value="20">20</option>\n+\n+\n+              <option value="21">21</option>\n+\n+\n+              <option value="22">22</option>\n+\n+\n+              <option value="23">23</option>\n+\n+\n+              <option value="24">24</option>\n+\n+\n+              <option value="25">25</option>\n+\n+\n+              <option value="26">26</option>\n+\n+\n+              <option value="27">27</option>\n+\n+\n+              <option value="28">28</option>\n+\n+\n+              <option value="29">29</option>\n+\n+\n+              <option value="30">30</option>\n+\n+\n+              <option value="31">31</option>\n+\n+            </select>\n+\n+            <span class="separator">/</span>\n+\n+            <!-- month -->\n+            <select class="month"\n+                    id="startDate-month"\n+                    name="startDate-month"\n+            >\n+\n+              <option value="1">January</option>\n+\n+\n+              <option selected="selected"\n+                      value="2"\n+              >February</option>\n+\n+\n+              <option value="3">March</option>\n+\n+\n+              <option value="4">April</option>\n+\n+\n+              <option value="5">May</option>\n+\n+\n+              <option value="6">June</option>\n+\n+\n+              <option value="7">July</option>\n+\n+\n+              <option value="8">August</option>\n+\n+\n+              <option value="9">September</option>\n+\n+\n+              <option value="10">October</option>\n+\n+\n+              <option value="11">November</option>\n+\n+\n+              <option value="12">December</option>\n+\n+            </select>\n+\n+            <span class="separator">/</span>\n+\n+            <!-- year -->\n+            <select class="year"\n+                    id="startDate-year"\n+                    name="startDate-year"\n+            >\n+\n+              <option value="2000">2000</option>\n+\n+\n+              <option value="2001">2001</option>\n+\n+\n+              <option value="2002">2002</option>\n+\n+\n+              <option value="2003">2003</option>\n+\n+\n+              <option value="2004">2004</option>\n+\n+\n+              <option value="2005">2005</option>\n+\n+\n+              <option value="2006">2006</option>\n+\n+\n+              <option value="2007">2007</option>\n+\n+\n+              <option value="2008">2008</option>\n+\n+\n+              <option value="2009">2009</option>\n+\n+\n+              <option value="2010">2010</option>\n+\n+\n+              <option selected="selected"\n+                      value="2011"\n+              >2011</option>\n+\n+\n+              <option value="2012">2012</option>\n+\n+\n+              <option value="2013">2013</option>\n+\n+\n+              <option value="2014">2014</option>\n+\n+\n+              <option value="2015">2015</option>\n+\n+\n+              <option value="2016">2016</option>\n+\n+\n+              <option value="2017">2017</option>\n+\n+\n+              <option value="2018">2018</option>\n+\n+\n+              <option value="2019">2019</option>\n+\n+            </select>\n+        &nbsp;\n+\n+            <input class="startDate-calendar date"\n+                   id="startDate"\n+                   name="startDate-calendar"\n+                   originalvalue=""\n+                   type="hidden"\n+            /><a class="caltrigger"\n+               href="#"\n+               style="width: 16px; vertical-align: middle; display: inline-block; background: url(&quot;popup_calendar.gif&quot;) repeat scroll 0% 0% transparent; height: 16px;"\n+            ></a>\n+            <script type="text/javascript">\n+                jQuery.tools.dateinput.localize("en", {months: "January,February,March,April,May,June,July,August,September,October,November,December",shortMonths: "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days: "Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday",shortDays: "Mon,Tue,Wed,Thu,Fri,Sat,Sun",});\n+                jQuery(".startDate-calendar").dateinput({lang: "en", value: new Date(2011, 1, 1, 16, 41), change: function() {\n+  var value = this.getValue();\n+  var parent = jQuery(this.getInput()).closest("div.DatetimeWidget");\n+  jQuery(parent).find(".year").val(value.getFullYear());\n+  jQuery(parent).find(".month").val(value.getMonth()+1);\n+  jQuery(parent).find(".day").val(value.getDate());\n+}, selectors: true, trigger: true, yearRange: [-10, 10]}).unbind(\'change\')\n+                    .bind(\'onShow\', function (event) {\n+                        var trigger_offset = jQuery(this).next().offset();\n+                        jQuery(this).data(\'dateinput\').getCalendar().offset(\n+                            {top: trigger_offset.top+20, left: trigger_offset.left}\n+                        );\n+                    });\n+                jQuery(".startDate-calendar").next().css({\'width\': \'16px\', \'vertical-align\': \'middle\', \'display\': \'inline-block\', \'background\': \'url(popup_calendar.gif)\', \'height\': \'16px\'});\n+\n+            </script>\n+\n+\n+            &nbsp;\n+            <span class="datetimewidget-time"\n+                  style=""\n+            >\n+\n+              <!-- hour -->\n+              <select class="hour"\n+                      id="startDate-hour"\n+                      name="startDate-hour"\n+              >\n+\n+                <option value="0">00</option>\n+\n+\n+                <option value="1">01</option>\n+\n+\n+                <option value="2">02</option>\n+\n+\n+                <option value="3">03</option>\n+\n+\n+                <option value="4">04</option>\n+\n+\n+                <option value="5">05</option>\n+\n+\n+                <option value="6">06</option>\n+\n+\n+                <option value="7">07</option>\n+\n+\n+                <option value="8">08</option>\n+\n+\n+                <option value="9">09</option>\n+\n+\n+                <option value="10">10</option>\n+\n+\n+                <option value="11">11</option>\n+\n+\n+                <option value="12">12</option>\n+\n+\n+                <option value="13">13</option>\n+\n+\n+                <option value="14">14</option>\n+\n+\n+                <option value="15">15</option>\n+\n+\n+                <option selected="selected"\n+                        value="16"\n+                >16</option>\n+\n+\n+                <option value="17">17</option>\n+\n+\n+                <option value="18">18</option>\n+\n+\n+                <option value="19">19</option>\n+\n+\n+                <option value="20">20</option>\n+\n+\n+                <option value="21">21</option>\n+\n+\n+                <option value="22">22</option>\n+\n+\n+                <option value="23">23</option>\n+\n+              </select>\n+\n+              <!-- minute -->\n+              <select class="min"\n+                      id="startDate-min"\n+                      name="startDate-min"\n+              >\n+\n+                <option value="0">00</option>\n+\n+\n+                <option value="1">01</option>\n+\n+\n+                <option value="2">02</option>\n+\n+\n+                <option value="3">03</option>\n+\n+\n+                <option value="4">04</option>\n+\n+\n+                <option value="5">05</option>\n+\n+\n+                <option value="6">06</option>\n+\n+\n+                <option value="7">07</option>\n+\n+\n+                <option value="8">08</option>\n+\n+\n+                <option value="9">09</option>\n+\n+\n+                <option value="10">10</option>\n+\n+\n+                <option value="11">11</option>\n+\n+\n+                <option value="12">12</option>\n+\n+\n+                <option value="13">13</option>\n+\n+\n+                <option value="14">14</option>\n+\n+\n+                <option value="15">15</option>\n+\n+\n+                <option value="16">16</option>\n+\n+\n+                <option value="17">17</option>\n+\n+\n+                <option value="18">18</option>\n+\n+\n+                <option value="19">19</option>\n+\n+\n+                <option value="20">20</option>\n+\n+\n+                <option value="21">21</option>\n+\n+\n+                <option value="22">22</option>\n+\n+\n+                <option value="23">23</option>\n+\n+\n+                <option value="24">24</option>\n+\n+\n+                <option value="25">25</option>\n+\n+\n+                <option value="26">26</option>\n+\n+\n+                <option value="27">27</option>\n+\n+\n+                <option value="28">28</option>\n+\n+\n+                <option value="29">29</option>\n+\n+\n+                <option value="30">30</option>\n+\n+\n+                <option value="31">31</option>\n+\n+\n+                <option value="32">32</option>\n+\n+\n+                <option value="33">33</option>\n+\n+\n+                <option value="34">34</option>\n+\n+\n+                <option value="35">35</option>\n+\n+\n+                <option value="36">36</option>\n+\n+\n+                <option value="37">37</option>\n+\n+\n+                <option value="38">38</option>\n+\n+\n+                <option value="39">39</option>\n+\n+\n+                <option value="40">40</option>\n+\n+\n+                <option selected="selected"\n+                        value="41"\n+                >41</option>\n+\n+\n+                <option value="42">42</option>\n+\n+\n+                <option value="43">43</option>\n+\n+\n+                <option value="44">44</option>\n+\n+\n+                <option value="45">45</option>\n+\n+\n+                <option value="46">46</option>\n+\n+\n+                <option value="47">47</option>\n+\n+\n+                <option value="48">48</option>\n+\n+\n+                <option value="49">49</option>\n+\n+\n+                <option value="50">50</option>\n+\n+\n+                <option value="51">51</option>\n+\n+\n+                <option value="52">52</option>\n+\n+\n+                <option value="53">53</option>\n+\n+\n+                <option value="54">54</option>\n+\n+\n+                <option value="55">55</option>\n+\n+\n+                <option value="56">56</option>\n+\n+\n+                <option value="57">57</option>\n+\n+\n+                <option value="58">58</option>\n+\n+\n+                <option value="59">59</option>\n+\n+              </select>\n+\n+              <!-- am/pm -->\n+\n+\n+            </span>\n+\n+\n+\n+            <input name="startDate-empty-marker"\n+                   originalvalue="1"\n+                   type="hidden"\n+                   value="1"\n+            />\n+\n+\n+\n+          </div>\n+        </div>\n+\n+\n+        <div class="field Archetypes DatetimeWidget kssattr-atfieldname-endDate"\n+             id="archetypes-fieldname-endDate"\n+        >\n+\n+          <div class="fieldErrorBox"></div>\n+          <div>\n+\n+            <!-- day -->\n+            <select class="day"\n+                    id="endDate-day"\n+                    name="endDate-day"\n+            >\n+\n+              <option selected="selected"\n+                      value="1"\n+              >01</option>\n+\n+\n+              <option value="2">02</option>\n+\n+\n+              <option value="3">03</option>\n+\n+\n+              <option value="4">04</option>\n+\n+\n+              <option value="5">05</option>\n+\n+\n+              <option value="6">06</option>\n+\n+\n+              <option value="7">07</option>\n+\n+\n+              <option value="8">08</option>\n+\n+\n+              <option value="9">09</option>\n+\n+\n+              <option value="10">10</option>\n+\n+\n+              <option value="11">11</option>\n+\n+\n+              <option value="12">12</option>\n+\n+\n+              <option value="13">13</option>\n+\n+\n+              <option value="14">14</option>\n+\n+\n+              <option value="15">15</option>\n+\n+\n+              <option value="16">16</option>\n+\n+\n+              <option value="17">17</option>\n+\n+\n+              <option value="18">18</option>\n+\n+\n+              <option value="19">19</option>\n+\n+\n+              <option value="20">20</option>\n+\n+\n+              <option value="21">21</option>\n+\n+\n+              <option value="22">22</option>\n+\n+\n+              <option value="23">23</option>\n+\n+\n+              <option value="24">24</option>\n+\n+\n+              <option value="25">25</option>\n+\n+\n+              <option value="26">26</option>\n+\n+\n+              <option value="27">27</option>\n+\n+\n+              <option value="28">28</option>\n+\n+\n+              <option value="29">29</option>\n+\n+\n+              <option value="30">30</option>\n+\n+\n+              <option value="31">31</option>\n+\n+            </select>\n+\n+            <span class="separator">/</span>\n+\n+            <!-- month -->\n+            <select class="month"\n+                    id="endDate-month"\n+                    name="endDate-month"\n+            >\n+\n+              <option value="1">January</option>\n+\n+\n+              <option selected="selected"\n+                      value="2"\n+              >February</option>\n+\n+\n+              <option value="3">March</option>\n+\n+\n+              <option value="4">April</option>\n+\n+\n+              <option value="5">May</option>\n+\n+\n+              <option value="6">June</option>\n+\n+\n+              <option value="7">July</option>\n+\n+\n+              <option value="8">August</option>\n+\n+\n+              <option value="9">September</option>\n+\n+\n+              <option value="10">October</option>\n+\n+\n+              <option value="11">November</option>\n+\n+\n+              <option value="12">December</option>\n+\n+            </select>\n+\n+            <span class="separator">/</span>\n+\n+            <!-- year -->\n+            <select class="year"\n+                    id="endDate-year"\n+                    name="endDate-year"\n+            >\n+\n+              <option value="2000">2000</option>\n+\n+\n+              <option value="2001">2001</option>\n+\n+\n+              <option value="2002">2002</option>\n+\n+\n+              <option value="2003">2003</option>\n+\n+\n+              <option value="2004">2004</option>\n+\n+\n+              <option value="2005">2005</option>\n+\n+\n+              <option value="2006">2006</option>\n+\n+\n+              <option value="2007">2007</option>\n+\n+\n+              <option value="2008">2008</option>\n+\n+\n+              <option value="2009">2009</option>\n+\n+\n+              <option value="2010">2010</option>\n+\n+\n+              <option selected="selected"\n+                      value="2011"\n+              >2011</option>\n+\n+\n+              <option value="2012">2012</option>\n+\n+\n+              <option value="2013">2013</option>\n+\n+\n+              <option value="2014">2014</option>\n+\n \n-\t    <!-- Tests -->\n-    <script type="text/javascript" src="test_event.js"></script>\n+              <option value="2015">2015</option>\n \n-  </head>\n \n-  <body>\n-    <h1 id="qunit-header">plone.app.event Test Suite</h1>\n+              <option value="2016">2016</option>\n \n-    <h2 id="qunit-banner"></h2>\n \n-    <div id="qunit-testrunner-toolbar">\n-    </div>\n+              <option value="2017">2017</option>\n \n-    <h2 id="qunit-userAgent"></h2>\n \n-    <ol id="qunit-tests">\n-    </ol>\n+              <option value="2018">2018</option>\n+\n+\n+              <option value="2019">2019</option>\n+\n+            </select>\n+        &nbsp;\n+\n+            <input class="endDate-calendar date"\n+                   id="endDate"\n+                   name="endDate-calendar"\n+                   originalvalue=""\n+                   type="hidden"\n+            /><a class="caltrigger"\n+               href="#"\n+               style="width: 16px; vertical-align: middle; display: inline-block; background: url(&quot;popup_calendar.gif&quot;) repeat scroll 0% 0% transparent; height: 16px;"\n+            ></a>\n+            <script type="text/javascript">\n+                jQuery.tools.dateinput.localize("en", {months: "January,February,March,April,May,June,July,August,September,October,November,December",shortMonths: "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days: "Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday",shortDays: "Mon,Tue,Wed,Thu,Fri,Sat,Sun",});\n+                jQuery(".endDate-calendar").dateinput({lang: "en", value: new Date(2011, 1, 1, 17, 41), change: function() {\n+  var value = this.getValue();\n+  var parent = jQuery(this.getInput()).closest("div.DatetimeWidget");\n+  jQuery(parent).find(".year").val(value.getFullYear());\n+  jQuery(parent).find(".month").val(value.getMonth()+1);\n+  jQuery(parent).find(".day").val(value.getDate());\n+}, selectors: true, trigger: true, yearRange: [-10, 10]}).unbind(\'change\')\n+                    .bind(\'onShow\', function (event) {\n+                        var trigger_offset = jQuery(this).next().offset();\n+                        jQuery(this).data(\'dateinput\').getCalendar().offset(\n+                            {top: trigger_offset.top+20, left: trigger_offset.left}\n+                        );\n+                    });\n+                jQuery(".endDate-calendar").next().css({\'width\': \'16px\', \'vertical-align\': \'middle\', \'display\': \'inline-block\', \'background\': \'url(popup_calendar.gif)\', \'height\': \'16px\'});\n+\n+            </script>\n+\n+\n+            &nbsp;\n+            <span class="datetimewidget-time"\n+                  style=""\n+            >\n+\n+              <!-- hour -->\n+              <select class="hour"\n+                      id="endDate-hour"\n+                      name="endDate-hour"\n+              >\n+\n+                <option value="0">00</option>\n+\n+\n+                <option value="1">01</option>\n+\n \n-<div id="qunit-fixture">\n-<div id="event">\n-<div id="archetypes-fieldname-wholeDay" class="field ArchetypesBooleanWidget  kssattr-atfieldname-wholeDay">\n-          \n-        <input type="checkbox" id="wholeDay" name="wholeDay:boolean" value="on" class="noborder">\n-        <input type="hidden" name="wholeDay:boolean:default" value="" originalvalue="">\n-      \n-          <label for="wholeDay" class="formQuestion">Whole day event</label>\n-          \n-          <div id="wholeDay_help" class="formHelp"></div>\n-          \n-          <div class="fieldErrorBox"></div>\n-          <div></div>\n-        </div>\n-<div id="archetypes-fieldname-startDate" class="field Archetypes DatetimeWidget  kssattr-atfieldname-startDate">\n-\n-                <div class="fieldErrorBox"></div>\n-                <div>\n-    \n-        <!-- day -->\n-        <select name="startDate-day" id="startDate-day" class="day">\n-            \n-                <option value="1" selected="selected">01</option>\n-            \n-            \n                 <option value="2">02</option>\n-            \n-            \n+\n+\n                 <option value="3">03</option>\n-            \n-            \n+\n+\n                 <option value="4">04</option>\n-            \n-            \n+\n+\n                 <option value="5">05</option>\n-            \n-            \n+\n+\n                 <option value="6">06</option>\n-            \n-            \n+\n+\n                 <option value="7">07</option>\n-            \n-            \n+\n+\n                 <option value="8">08</option>\n-            \n-            \n+\n+\n                 <option value="9">09</option>\n-            \n-            \n+\n+\n                 <option value="10">10</option>\n-            \n-            \n+\n+\n                 <option value="11">11</option>\n-            \n-            \n+\n+\n                 <option value="12">12</option>\n-            \n-            \n+\n+\n                 <option value="13">13</option>\n-            \n-            \n+\n+\n                 <option value="14">14</option>\n-            \n-            \n+\n+\n                 <option value="15">15</option>\n-            \n-            \n+\n+\n                 <option value="16">16</option>\n-            \n-            \n-                <option value="17">17</option>\n-            \n-            \n+\n+\n+                <option selected="selected"\n+                        value="17"\n+                >17</option>\n+\n+\n                 <option value="18">18</option>\n-            \n-            \n+\n+\n                 <option value="19">19</option>\n-            \n-            \n+\n+\n                 <option value="20">20</option>\n-            \n-            \n+\n+\n                 <option value="21">21</option>\n-            \n-            \n-                <option value="22">22</option>\n-            \n-            \n-                <option value="23">23</option>\n-            \n-            \n-                <option value="24">24</option>\n-            \n-            \n-                <option value="25">25</option>\n-            \n-            \n-                <option value="26">26</option>\n-            \n-            \n-                <option value="27">27</option>\n-            \n-            \n-                <option value="28">28</option>\n-            \n-            \n-                <option value="29">29</option>\n-            \n-            \n-                <option value="30">30</option>\n-            \n-            \n-                <option value="31">31</option>\n-            \n-        </select>\n-\n-        <span class="separator">/</span>\n-\n-        <!-- month -->\n-        <select class="month" name="startDate-month" id="startDate-month">\n-        \n-            <option value="1">January</option>\n-        \n-        \n-            <option value="2" selected="selected">February</option>\n-        \n-        \n-            <option value="3">March</option>\n-        \n-        \n-            <option value="4">April</option>\n-        \n-        \n-            <option value="5">May</option>\n-        \n-        \n-            <option value="6">June</option>\n-        \n-        \n-            <option value="7">July</option>\n-        \n-        \n-            <option value="8">August</option>\n-        \n-        \n-            <option value="9">September</option>\n-        \n-        \n-            <option value="10">October</option>\n-        \n-        \n-            <option value="11">November</option>\n-        \n-        \n-            <option value="12">December</option>\n-        \n-        </select>\n-\n-        <span class="separator">/</span>\n-\n-        <!-- year -->\n-        <select name="startDate-year" id="startDate-year" class="year">\n-            \n-                <option value="2000">2000</option>\n-            \n-            \n-                <option value="2001">2001</option>\n-            \n-            \n-                <option value="2002">2002</option>\n-            \n-            \n-                <option value="2003">2003</option>\n-            \n-            \n-                <option value="2004">2004</option>\n-            \n-            \n-                <option value="2005">2005</option>\n-            \n-            \n-                <option value="2006">2006</option>\n-            \n-            \n-                <option value="2007">2007</option>\n-            \n-            \n-                <option value="2008">2008</option>\n-            \n-            \n-                <option value="2009">2009</option>\n-            \n-            \n-                <option value="2010">2010</option>\n-            \n-            \n-                <option value="2011" selected="selected">2011</option>\n-            \n-            \n-                <option value="2012">2012</option>\n-            \n-            \n-                <option value="2013">2013</option>\n-            \n-            \n-                <option value="2014">2014</option>\n-            \n-            \n-                <option value="2015">2015</option>\n-            \n-            \n-                <option value="2016">2016</option>\n-            \n-            \n-                <option value="2017">2017</option>\n-            \n-            \n-                <option value="2018">2018</option>\n-            \n-            \n-                <option value="2019">2019</option>\n-            \n-        </select>\n-        &nbsp;\n-        \n-            <input type="hidden" class="startDate-calendar date" name="startDate-calendar" id="startDate" originalvalue=""><a href="#" class="caltrigger" style="width: 16px; vertical-align: middle; display: inline-block; background: url(&quot;popup_calendar.gif&quot;) repeat scroll 0% 0% transparent; height: 16px;"></a>\n-            <script type="text/javascript">\n-                jQuery.tools.dateinput.localize("en", {months: "January,February,March,April,May,June,July,August,September,October,November,December",shortMonths: "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days: "Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday",shortDays: "Mon,Tue,Wed,Thu,Fri,Sat,Sun",});\n-                jQuery(".startDate-calendar").dateinput({lang: "en", value: new Date(2011, 1, 1, 16, 41), change: function() {\n-  var value = this.getValue();\n-  var parent = jQuery(this.getInput()).closest("div.DatetimeWidget");\n-  jQuery(parent).find(".year").val(value.getFullYear());\n-  jQuery(parent).find(".month").val(value.getMonth()+1);\n-  jQuery(parent).find(".day").val(value.getDate());\n-}, selectors: true, trigger: true, yearRange: [-10, 10]}).unbind(\'change\')\n-                    .bind(\'onShow\', function (event) {\n-                        var trigger_offset = jQuery(this).next().offset();\n-                        jQuery(this).data(\'dateinput\').getCalendar().offset(\n-                            {top: trigger_offset.top+20, left: trigger_offset.left}\n-                        );\n-                    });\n-                jQuery(".startDate-calendar").next().css({\'width\': \'16px\', \'vertical-align\': \'middle\', \'display\': \'inline-block\', \'background\': \'url(popup_calendar.gif)\', \'height\': \'16px\'});\n \n-            </script>\n \n-        \n-            &nbsp;\n-            <span style="" class="datetimewidget-time">\n-\n-                <!-- hour -->\n-                <select name="startDate-hour" id="startDate-hour" class="hour">\n-                    \n-                        <option value="0">00</option>\n-                    \n-                    \n-                        <option value="1">01</option>\n-                    \n-                    \n-                        <option value="2">02</option>\n-                    \n-                    \n-                        <option value="3">03</option>\n-                    \n-                    \n-                        <option value="4">04</option>\n-                    \n-                    \n-                        <option value="5">05</option>\n-                    \n-                    \n-                        <option value="6">06</option>\n-                    \n-                    \n-                        <option value="7">07</option>\n-                    \n-                    \n-                        <option value="8">08</option>\n-                    \n-                    \n-                        <option value="9">09</option>\n-                    \n-                    \n-                        <option value="10">10</option>\n-                    \n-                    \n-                        <option value="11">11</option>\n-                    \n-                    \n-                        <option value="12">12</option>\n-                    \n-                    \n-                        <option value="13">13</option>\n-                    \n-                    \n-                        <option value="14">14</option>\n-                    \n-                    \n-                        <option value="15">15</option>\n-                    \n-                    \n-                        <option value="16" selected="selected">16</option>\n-                    \n-                    \n-                        <option value="17">17</option>\n-                    \n-                    \n-                        <option value="18">18</option>\n-                    \n-                    \n-                        <option value="19">19</option>\n-                    \n-                    \n-                        <option value="20">20</option>\n-                    \n-                    \n-                        <option value="21">21</option>\n-                    \n-                    \n-                        <option value="22">22</option>\n-                    \n-                    \n-                        <option value="23">23</option>\n-                    \n-                </select>\n-                \n-                <!-- minute -->\n-                <select name="startDate-min" id="startDate-min" class="min">\n-                    \n-                        <option value="0">00</option>\n-                    \n-                    \n-                        <option value="1">01</option>\n-                    \n-                    \n-                        <option value="2">02</option>\n-                    \n-                    \n-                        <option value="3">03</option>\n-                    \n-                    \n-                        <option value="4">04</option>\n-                    \n-                    \n-                        <option value="5">05</option>\n-                    \n-                    \n-                        <option value="6">06</option>\n-                    \n-                    \n-                        <option value="7">07</option>\n-                    \n-                    \n-                        <option value="8">08</option>\n-                    \n-                    \n-                        <option value="9">09</option>\n-                    \n-                    \n-                        <option value="10">10</option>\n-                    \n-                    \n-                        <option value="11">11</option>\n-                    \n-                    \n-                        <option value="12">12</option>\n-                    \n-                    \n-                        <option value="13">13</option>\n-                    \n-                    \n-                        <option value="14">14</option>\n-                    \n-                    \n-                        <option value="15">15</option>\n-                    \n-                    \n-                        <option value="16">16</option>\n-                    \n-                    \n-                        <option value="17">17</option>\n-                    \n-                    \n-                        <option value="18">18</option>\n-                    \n-                    \n-                        <option value="19">19</option>\n-                    \n-                    \n-                        <option value="20">20</option>\n-                    \n-                    \n-                        <option value="21">21</option>\n-                    \n-                    \n-                        <option value="22">22</option>\n-                    \n-                    \n-                        <option value="23">23</option>\n-                    \n-                    \n-                        <option value="24">24</option>\n-                    \n-                    \n-                        <option value="25">25</option>\n-                    \n-                    \n-                        <option value="26">26</option>\n-                    \n-                    \n-                        <option value="27">27</option>\n-                    \n-                    \n-                        <option value="28">28</option>\n-                    \n-                    \n-                        <option value="29">29</option>\n-                    \n-                    \n-                        <option value="30">30</option>\n-                    \n-                    \n-                        <option value="31">31</option>\n-                    \n-                    \n-                        <option value="32">32</option>\n-                    \n-                    \n-                        <option value="33">33</option>\n-                    \n-                    \n-                        <option value="34">34</option>\n-                    \n-                    \n-                        <option value="35">35</option>\n-                    \n-                    \n-                        <option value="36">36</option>\n-                    \n-                    \n-                        <option value="37">37</option>\n-                    \n-                    \n-                        <option value="38">38</option>\n-                    \n-                    \n-                        <option value="39">39</option>\n-                    \n-                    \n-                        <option value="40">40</option>\n-                    \n-                    \n-                        <option value="41" selected="selected">41</option>\n-                    \n-                    \n-                        <option value="42">42</option>\n-                    \n-                    \n-                        <option value="43">43</option>\n-                    \n-                    \n-                        <option value="44">44</option>\n-                    \n-                    \n-                        <option value="45">45</option>\n-                    \n-                    \n-                        <option value="46">46</option>\n-                    \n-                    \n-                        <option value="47">47</option>\n-                    \n-                    \n-                        <option value="48">48</option>\n-                    \n-                    \n-                        <option value="49">49</option>\n-                    \n-                    \n-                        <option value="50">50</option>\n-                    \n-                    \n-                        <option value="51">51</option>\n-                    \n-                    \n-                        <option value="52">52</option>\n-                    \n-                    \n-                        <option value="53">53</option>\n-                    \n-                    \n-                        <option value="54">54</option>\n-                    \n-                    \n-                        <option value="55">55</option>\n-                    \n-                    \n-                        <option value="56">56</option>\n-                    \n-                    \n-                        <option value="57">57</option>\n-                    \n-                    \n-                        <option value="58">58</option>\n-                    \n-                    \n-                        <option value="59">59</option>\n-                    \n-                </select>\n-\n-                <!-- am/pm -->\n-                \n+                <option value="22">22</option>\n \n-            </span>\n \n-        \n+                <option value="23">23</option>\n+\n+              </select>\n \n-        <input type="hidden" value="1" name="startDate-empty-marker" originalvalue="1">\n+              <!-- minute -->\n+              <select class="min"\n+                      id="endDate-min"\n+                      name="endDate-min"\n+              >\n \n-        \n+                <option value="0">00</option>\n \n-    </div>\n-  </div>\n \n+                <option value="1">01</option>\n \n-<div id="archetypes-fieldname-endDate" class="field Archetypes DatetimeWidget  kssattr-atfieldname-endDate">\n \n-                <div class="fieldErrorBox"></div>\n-                <div>\n-    \n-        <!-- day -->\n-        <select name="endDate-day" id="endDate-day" class="day">\n-            \n-                <option value="1" selected="selected">01</option>\n-            \n-            \n                 <option value="2">02</option>\n-            \n-            \n+\n+\n                 <option value="3">03</option>\n-            \n-            \n+\n+\n                 <option value="4">04</option>\n-            \n-            \n+\n+\n                 <option value="5">05</option>\n-            \n-            \n+\n+\n                 <option value="6">06</option>\n-            \n-            \n+\n+\n                 <option value="7">07</option>\n-            \n-            \n+\n+\n                 <option value="8">08</option>\n-            \n-            \n+\n+\n                 <option value="9">09</option>\n-            \n-            \n+\n+\n                 <option value="10">10</option>\n-            \n-            \n+\n+\n                 <option value="11">11</option>\n-            \n-            \n+\n+\n                 <option value="12">12</option>\n-            \n-            \n+\n+\n                 <option value="13">13</option>\n-            \n-            \n+\n+\n                 <option value="14">14</option>\n-            \n-            \n+\n+\n                 <option value="15">15</option>\n-            \n-            \n+\n+\n                 <option value="16">16</option>\n-            \n-            \n+\n+\n                 <option value="17">17</option>\n-            \n-            \n+\n+\n                 <option value="18">18</option>\n-            \n-            \n+\n+\n                 <option value="19">19</option>\n-            \n-            \n+\n+\n                 <option value="20">20</option>\n-            \n-            \n+\n+\n                 <option value="21">21</option>\n-            \n-            \n+\n+\n                 <option value="22">22</option>\n-            \n-            \n+\n+\n                 <option value="23">23</option>\n-            \n-            \n+\n+\n                 <option value="24">24</option>\n-            \n-            \n+\n+\n                 <option value="25">25</option>\n-            \n-            \n+\n+\n                 <option value="26">26</option>\n-            \n-            \n+\n+\n                 <option value="27">27</option>\n-            \n-            \n+\n+\n                 <option value="28">28</option>\n-            \n-            \n+\n+\n                 <option value="29">29</option>\n-            \n-            \n+\n+\n                 <option value="30">30</option>\n-            \n-            \n+\n+\n                 <option value="31">31</option>\n-            \n-        </select>\n-\n-        <span class="separator">/</span>\n-\n-        <!-- month -->\n-        <select class="month" name="endDate-month" id="endDate-month">\n-        \n-            <option value="1">January</option>\n-        \n-        \n-            <option value="2" selected="selected">February</option>\n-        \n-        \n-            <option value="3">March</option>\n-        \n-        \n-            <option value="4">April</option>\n-        \n-        \n-            <option value="5">May</option>\n-        \n-        \n-            <option value="6">June</option>\n-        \n-        \n-            <option value="7">July</option>\n-        \n-        \n-            <option value="8">August</option>\n-        \n-        \n-            <option value="9">September</option>\n-        \n-        \n-            <option value="10">October</option>\n-        \n-        \n-            <option value="11">November</option>\n-        \n-        \n-            <option value="12">December</option>\n-        \n-        </select>\n-\n-        <span class="separator">/</span>\n-\n-        <!-- year -->\n-        <select name="endDate-year" id="endDate-year" class="year">\n-            \n-                <option value="2000">2000</option>\n-            \n-            \n-                <option value="2001">2001</option>\n-            \n-            \n-                <option value="2002">2002</option>\n-            \n-            \n-                <option value="2003">2003</option>\n-            \n-            \n-                <option value="2004">2004</option>\n-            \n-            \n-                <option value="2005">2005</option>\n-            \n-            \n-                <option value="2006">2006</option>\n-            \n-            \n-                <option value="2007">2007</option>\n-            \n-            \n-                <option value="2008">2008</option>\n-            \n-            \n-                <option value="2009">2009</option>\n-            \n-            \n-                <option value="2010">2010</option>\n-            \n-            \n-                <option value="2011" selected="selected">2011</option>\n-            \n-            \n-                <option value="2012">2012</option>\n-            \n-            \n-                <option value="2013">2013</option>\n-            \n-            \n-                <option value="2014">2014</option>\n-            \n-            \n-                <option value="2015">2015</option>\n-            \n-            \n-                <option value="2016">2016</option>\n-            \n-            \n-                <option value="2017">2017</option>\n-            \n-            \n-                <option value="2018">2018</option>\n-            \n-            \n-                <option value="2019">2019</option>\n-            \n-        </select>\n-        &nbsp;\n-        \n-            <input type="hidden" class="endDate-calendar date" name="endDate-calendar" id="endDate" originalvalue=""><a href="#" class="caltrigger" style="width: 16px; vertical-align: middle; display: inline-block; background: url(&quot;popup_calendar.gif&quot;) repeat scroll 0% 0% transparent; height: 16px;"></a>\n-            <script type="text/javascript">\n-                jQuery.tools.dateinput.localize("en", {months: "January,February,March,April,May,June,July,August,September,October,November,December",shortMonths: "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days: "Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday",shortDays: "Mon,Tue,Wed,Thu,Fri,Sat,Sun",});\n-                jQuery(".endDate-calendar").dateinput({lang: "en", value: new Date(2011, 1, 1, 17, 41), change: function() {\n-  var value = this.getValue();\n-  var parent = jQuery(this.getInput()).closest("div.DatetimeWidget");\n-  jQuery(parent).find(".year").val(value.getFullYear());\n-  jQuery(parent).find(".month").val(value.getMonth()+1);\n-  jQuery(parent).find(".day").val(value.getDate());\n-}, selectors: true, trigger: true, yearRange: [-10, 10]}).unbind(\'change\')\n-                    .bind(\'onShow\', function (event) {\n-                        var trigger_offset = jQuery(this).next().offset();\n-                        jQuery(this).data(\'dateinput\').getCalendar().offset(\n-                            {top: trigger_offset.top+20, left: trigger_offset.left}\n-                        );\n-                    });\n-                jQuery(".endDate-calendar").next().css({\'width\': \'16px\', \'vertical-align\': \'middle\', \'display\': \'inline-block\', \'background\': \'url(popup_calendar.gif)\', \'height\': \'16px\'});\n \n-            </script>\n \n-        \n-            &nbsp;\n-            <span style="" class="datetimewidget-time">\n-\n-                <!-- hour -->\n-                <select name="endDate-hour" id="endDate-hour" class="hour">\n-                    \n-                        <option value="0">00</option>\n-                    \n-                    \n-                        <option value="1">01</option>\n-                    \n-                    \n-                        <option value="2">02</option>\n-                    \n-                    \n-                        <option value="3">03</option>\n-                    \n-                    \n-                        <option value="4">04</option>\n-                    \n-                    \n-                        <option value="5">05</option>\n-                    \n-                    \n-                        <option value="6">06</option>\n-                    \n-                    \n-                        <option value="7">07</option>\n-                    \n-                    \n-                        <option value="8">08</option>\n-                    \n-                    \n-                        <option value="9">09</option>\n-                    \n-                    \n-                        <option value="10">10</option>\n-                    \n-                    \n-                        <option value="11">11</option>\n-                    \n-                    \n-                        <option value="12">12</option>\n-                    \n-                    \n-                        <option value="13">13</option>\n-                    \n-                    \n-                        <option value="14">14</option>\n-                    \n-                    \n-                        <option value="15">15</option>\n-                    \n-                    \n-                        <option value="16">16</option>\n-                    \n-                    \n-                        <option value="17" selected="selected">17</option>\n-                    \n-                    \n-                        <option value="18">18</option>\n-                    \n-                    \n-                        <option value="19">19</option>\n-                    \n-                    \n-                        <option value="20">20</option>\n-                    \n-                    \n-                        <option value="21">21</option>\n-                    \n-                    \n-                        <option value="22">22</option>\n-                    \n-                    \n-                        <option value="23">23</option>\n-                    \n-                </select>\n-                \n-                <!-- minute -->\n-                <select name="endDate-min" id="endDate-min" class="min">\n-                    \n-                        <option value="0">00</option>\n-                    \n-                    \n-                        <option value="1">01</option>\n-                    \n-                    \n-                        <option value="2">02</option>\n-                    \n-                    \n-                        <option value="3">03</option>\n-                    \n-                    \n-                        <option value="4">04</option>\n-                    \n-                    \n-                        <option value="5">05</option>\n-                    \n-                    \n-                        <option value="6">06</option>\n-                    \n-                    \n-                        <option value="7">07</option>\n-                    \n-                    \n-                        <option value="8">08</option>\n-                    \n-                    \n-                        <option value="9">09</option>\n-                    \n-                    \n-                        <option value="10">10</option>\n-                    \n-                    \n-                        <option value="11">11</option>\n-                    \n-                    \n-                        <option value="12">12</option>\n-                    \n-                    \n-                        <option value="13">13</option>\n-                    \n-                    \n-                        <option value="14">14</option>\n-                    \n-                    \n-                        <option value="15">15</option>\n-                    \n-                    \n-                        <option value="16">16</option>\n-                    \n-                    \n-                        <option value="17">17</option>\n-                    \n-                    \n-                        <option value="18">18</option>\n-                    \n-                    \n-                        <option value="19">19</option>\n-                    \n-                    \n-                        <option value="20">20</option>\n-                    \n-                    \n-                        <option value="21">21</option>\n-                    \n-                    \n-                        <option value="22">22</option>\n-                    \n-                    \n-                        <option value="23">23</option>\n-                    \n-                    \n-                        <option value="24">24</option>\n-                    \n-                    \n-                        <option value="25">25</option>\n-                    \n-                    \n-                        <option value="26">26</option>\n-                    \n-                    \n-                        <option value="27">27</option>\n-                    \n-                    \n-                        <option value="28">28</option>\n-                    \n-                    \n-                        <option value="29">29</option>\n-                    \n-                    \n-                        <option value="30">30</option>\n-                    \n-                    \n-                        <option value="31">31</option>\n-                    \n-                    \n-                        <option value="32">32</option>\n-                    \n-                    \n-                        <option value="33">33</option>\n-                    \n-                    \n-                        <option value="34">34</option>\n-                    \n-                    \n-                        <option value="35">35</option>\n-                    \n-                    \n-                        <option value="36">36</option>\n-                    \n-                    \n-                        <option value="37">37</option>\n-                    \n-                    \n-                        <option value="38">38</option>\n-                    \n-                    \n-                        <option value="39">39</option>\n-                    \n-                    \n-                        <option value="40">40</option>\n-                    \n-                    \n-                        <option value="41" selected="selected">41</option>\n-                    \n-                    \n-                        <option value="42">42</option>\n-                    \n-                    \n-                        <option value="43">43</option>\n-                    \n-                    \n-                        <option value="44">44</option>\n-                    \n-                    \n-                        <option value="45">45</option>\n-                    \n-                    \n-                        <option value="46">46</option>\n-                    \n-                    \n-                        <option value="47">47</option>\n-                    \n-                    \n-                        <option value="48">48</option>\n-                    \n-                    \n-                        <option value="49">49</option>\n-                    \n-                    \n-                        <option value="50">50</option>\n-                    \n-                    \n-                        <option value="51">51</option>\n-                    \n-                    \n-                        <option value="52">52</option>\n-                    \n-                    \n-                        <option value="53">53</option>\n-                    \n-                    \n-                        <option value="54">54</option>\n-                    \n-                    \n-                        <option value="55">55</option>\n-                    \n-                    \n-                        <option value="56">56</option>\n-                    \n-                    \n-                        <option value="57">57</option>\n-                    \n-                    \n-                        <option value="58">58</option>\n-                    \n-                    \n-                        <option value="59">59</option>\n-                    \n-                </select>\n-\n-                <!-- am/pm -->\n-                \n+                <option value="32">32</option>\n+\n+\n+                <option value="33">33</option>\n+\n+\n+                <option value="34">34</option>\n+\n+\n+                <option value="35">35</option>\n+\n+\n+                <option value="36">36</option>\n+\n+\n+                <option value="37">37</option>\n+\n+\n+                <option value="38">38</option>\n+\n+\n+                <option value="39">39</option>\n+\n+\n+                <option value="40">40</option>\n+\n+\n+                <option selected="selected"\n+                        value="41"\n+                >41</option>\n+\n+\n+                <option value="42">42</option>\n+\n+\n+                <option value="43">43</option>\n+\n+\n+                <option value="44">44</option>\n+\n+\n+                <option value="45">45</option>\n+\n+\n+                <option value="46">46</option>\n+\n+\n+                <option value="47">47</option>\n+\n+\n+                <option value="48">48</option>\n+\n+\n+                <option value="49">49</option>\n+\n+\n+                <option value="50">50</option>\n+\n+\n+                <option value="51">51</option>\n+\n+\n+                <option value="52">52</option>\n+\n+\n+                <option value="53">53</option>\n+\n+\n+                <option value="54">54</option>\n+\n+\n+                <option value="55">55</option>\n+\n+\n+                <option value="56">56</option>\n+\n+\n+                <option value="57">57</option>\n+\n+\n+                <option value="58">58</option>\n+\n+\n+                <option value="59">59</option>\n+\n+              </select>\n+\n+              <!-- am/pm -->\n+\n \n             </span>\n \n-        \n \n-        <input type="hidden" value="1" name="endDate-empty-marker" originalvalue="1">\n \n-        \n+            <input name="endDate-empty-marker"\n+                   originalvalue="1"\n+                   type="hidden"\n+                   value="1"\n+            />\n+\n \n-    </div>\n-  </div>\n \n-</div>\n-</div>\n+          </div>\n+        </div>\n+\n+      </div>\n+    </div>\n     <!-- plone.app.event -->\n-    <script type="text/javascript" src="../../browser/event.js">\n+    <script src="../../browser/event.js"\n+            type="text/javascript"\n+    >\n     </script>\n   </body>\n \n </html>\n-\ndiff --git a/plone/app/event/tests/qunit/qunit.js b/plone/app/event/tests/qunit/qunit.js\nindex 30e03953f..b3dd1fcaf 100644\n--- a/plone/app/event/tests/qunit/qunit.js\n+++ b/plone/app/event/tests/qunit/qunit.js\n@@ -282,7 +282,7 @@ var QUnit = {\n \t},\n \t\n \t/**\n-\t * Specify the number of expected assertions to gurantee that failed test (no assertions are run at all) don\'t slip through.\n+\t * Specify the number of expected assertions to guarantee that failed test (no assertions are run at all) don\'t slip through.\n \t */\n \texpect: function(asserts) {\n \t\tconfig.current.expected = asserts;\n@@ -310,7 +310,7 @@ var QUnit = {\n \t * Checks that the first two arguments are equal, with an optional message.\n \t * Prints out both actual and expected values.\n \t *\n-\t * Prefered to ok( actual == expected, message )\n+\t * Preferred to ok( actual == expected, message )\n \t *\n \t * @example equal( format("Received {0} bytes.", 2), "Received 2 bytes." );\n \t *\n@@ -429,7 +429,7 @@ var config = {\n \tblocking: true\n };\n \n-// Load paramaters\n+// Load parameters\n (function() {\n \tvar location = window.location || { search: "", protocol: "file:" },\n \t\tGETParams = location.search.slice(1).split(\'&\');\n@@ -945,7 +945,7 @@ QUnit.equiv = function () {\n         // for string, boolean, number and null\n         function useStrictEquality(b, a) {\n             if (b instanceof a.constructor || a instanceof b.constructor) {\n-                // to catch short annotaion VS \'new\' annotation of a declaration\n+                // to catch short annotation VS \'new\' annotation of a declaration\n                 // e.g. var i = 1;\n                 //      var j = new Number(1);\n                 return a == b;\n@@ -972,7 +972,7 @@ QUnit.equiv = function () {\n             "regexp": function (b, a) {\n                 return QUnit.objectType(b) === "regexp" &&\n                     a.source === b.source && // the regex itself\n-                    a.global === b.global && // and its modifers (gmi) ...\n+                    a.global === b.global && // and its modifiers (gmi) ...\n                     a.ignoreCase === b.ignoreCase &&\n                     a.multiline === b.multiline;\n             },\n@@ -1020,7 +1020,7 @@ QUnit.equiv = function () {\n \n             "object": function (b, a) {\n                 var i, j, loop;\n-                var eq = true; // unless we can proove it\n+                var eq = true; // unless we can prove it\n                 var aProperties = [], bProperties = []; // collection of strings\n \n                 // comparing constructors is more strict than using instanceof\ndiff --git a/plone/app/event/tests/test_base_module.py b/plone/app/event/tests/test_base_module.py\nindex 34395d332..74fc78cf8 100644\n--- a/plone/app/event/tests/test_base_module.py\n+++ b/plone/app/event/tests/test_base_module.py\n@@ -453,7 +453,6 @@ class TestGetEventsDX(AbstractSampleDataEvents):\n     layer = PAEventDX_INTEGRATION_TESTING\n \n     def test_get_events(self):\n-\n         # whole range\n         res = get_events(self.portal)\n         self.assertEqual(len(res), 4)\n@@ -618,7 +617,7 @@ def _num_events(values):\n         # Test with range\n         #\n \n-        # Completly outside range and start, end given as datetime\n+        # Completely outside range and start, end given as datetime\n         cal = construct_calendar(\n             res, start=datetime(2000, 1, 1, 10, 0), end=datetime(2000, 1, 2, 10, 0)\n         )\n@@ -784,16 +783,6 @@ def test_expand_future_event(self):\n             "2014-05-08 10:00:00",\n             "2014-05-08 11:00:00",\n         )  # second recurrence\n-        rec3 = (\n-            "Next year",\n-            "2014-05-09 10:00:00",\n-            "2014-05-09 11:00:00",\n-        )  # third recurrence\n-        rec4 = (\n-            "Next year",\n-            "2014-05-10 10:00:00",\n-            "2014-05-10 11:00:00",\n-        )  # fourth recurrence\n \n         # expand_events from today+200 until today+300\n         res = self.fmt(\ndiff --git a/plone/app/event/tests/test_dx_behaviors.py b/plone/app/event/tests/test_dx_behaviors.py\nindex 9e0fcaf4d..22a830cf4 100644\n--- a/plone/app/event/tests/test_dx_behaviors.py\n+++ b/plone/app/event/tests/test_dx_behaviors.py\n@@ -435,7 +435,6 @@ def test_recurrence_indexing(self):\n \n \n class TestDXEventRecurrence(unittest.TestCase):\n-\n     layer = PAEventDX_INTEGRATION_TESTING\n \n     def test_recurrence(self):\n@@ -476,7 +475,7 @@ def test_validate_invariants_ok(self):\n \n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n     def test_validate_invariants_fail(self):\n@@ -499,7 +498,7 @@ def test_validate_invariants_edge(self):\n \n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n     def test_validate_invariants_openend(self):\n@@ -510,7 +509,7 @@ def test_validate_invariants_openend(self):\n \n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n     def test_validate_dont_validate_incomplete(self):\n@@ -524,21 +523,21 @@ def test_validate_dont_validate_incomplete(self):\n         mock.end = None\n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n         mock.start = None\n         mock.end = datetime(2016, 5, 18)\n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n         mock.start = None\n         mock.end = None\n         try:\n             IEventBasic.validateInvariants(mock)\n-        except:\n+        except Exception:\n             self.fail()\n \n \ndiff --git a/plone/app/event/tests/test_event_listing.py b/plone/app/event/tests/test_event_listing.py\nindex b40a5bb2d..5eb94662a 100644\n--- a/plone/app/event/tests/test_event_listing.py\n+++ b/plone/app/event/tests/test_event_listing.py\n@@ -63,7 +63,7 @@ def _collection_batching_base(self):\n         """Base preparation for batching tests below.\n \n         The event_listing view caches it\'s results on the request, so the\n-        batching tests below need to be in seperate test methods to get a fresh\n+        batching tests below need to be in separate test methods to get a fresh\n         environment with newly calculated results.\n         """\n         # plone.app.contenttypes ICollection type\n@@ -102,7 +102,7 @@ def test_collection_batching__reduce_by_request_parameter(self):\n \n     def test_date_filtering(self):\n         """Test if date filters are available on Collections without start or\n-        end search criterias.\n+        end search criteria.\n         """\n         # plone.app.contenttypes ICollection type\n         self.portal.invokeFactory(\n@@ -124,7 +124,7 @@ def test_date_filtering(self):\n \n     def test_no_date_filtering(self):\n         """Test if date filters are not available on Collections with start or\n-        end search criterias.\n+        end search criteria.\n         """\n         # plone.app.contenttypes ICollection type\n         self.portal.invokeFactory("Collection", "col_with_date_criterion", title="Col")\ndiff --git a/plone/app/event/tests/test_event_summary.py b/plone/app/event/tests/test_event_summary.py\nindex 3a3a55874..2dab576ed 100644\n--- a/plone/app/event/tests/test_event_summary.py\n+++ b/plone/app/event/tests/test_event_summary.py\n@@ -20,7 +20,8 @@ def test_event_summary__non_recurring(self):\n         output = view()\n \n         self.assertTrue("2013-05-15" in output)\n-        self.assertTrue("(Europe/Vienna / UTC200)" in output)\n+        self.assertTrue("Europe/Vienna" in output)\n+        self.assertTrue("UTC200" in output)\n         self.assertTrue("Graz" in output)\n         self.assertTrue("All dates" not in output)\n \ndiff --git a/plone/app/event/tests/test_event_view.py b/plone/app/event/tests/test_event_view.py\nindex 7b081cb60..e8a2ec13c 100644\n--- a/plone/app/event/tests/test_event_view.py\n+++ b/plone/app/event/tests/test_event_view.py\n@@ -20,7 +20,8 @@ def test_event_view__non_recurring(self):\n \n         self.assertTrue("Future Event" in output)\n         self.assertTrue("2013-05-15" in output)\n-        self.assertTrue("(Europe/Vienna / UTC200)" in output)\n+        self.assertTrue("Europe/Vienna" in output)\n+        self.assertTrue("UTC200" in output)\n         self.assertTrue("Graz" in output)\n         self.assertTrue("All dates" not in output)\n \ndiff --git a/plone/app/event/tests/test_ical_import.py b/plone/app/event/tests/test_ical_import.py\nindex 05e0beb80..0e5fd7ae9 100644\n--- a/plone/app/event/tests/test_ical_import.py\n+++ b/plone/app/event/tests/test_ical_import.py\n@@ -12,7 +12,6 @@\n \n \n class TestICALImportSettings(unittest.TestCase):\n-\n     layer = PAEventDX_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/event/tests/test_icalendar.py b/plone/app/event/tests/test_icalendar.py\nindex 87269c0c0..c68e4adaa 100644\n--- a/plone/app/event/tests/test_icalendar.py\n+++ b/plone/app/event/tests/test_icalendar.py\n@@ -87,7 +87,7 @@ def test_event_ical(self):\n         )\n \n     def test_event_occurrence_ical(self):\n-        """A event occurrence should not conain recurrence definitions from\n+        """A event occurrence should not contain recurrence definitions from\n         it\'s parent.\n         """\n         headers, output, request = make_fake_response(self.request)\ndiff --git a/plone/app/event/tests/test_portlet_events.py b/plone/app/event/tests/test_portlet_events.py\nindex a2e0a8e63..0ce521935 100644\n--- a/plone/app/event/tests/test_portlet_events.py\n+++ b/plone/app/event/tests/test_portlet_events.py\n@@ -24,7 +24,6 @@\n from zope.component.hooks import setSite\n from zope.interface import alsoProvides\n \n-import pytz\n import unittest\n \n \ndiff --git a/plone/app/event/tests/test_recurrence.py b/plone/app/event/tests/test_recurrence.py\nindex eedc5a883..21e5a1cdd 100644\n--- a/plone/app/event/tests/test_recurrence.py\n+++ b/plone/app/event/tests/test_recurrence.py\n@@ -289,7 +289,6 @@ class MockEvent(SimpleItem):\n \n \n class TestRecurrenceSupport(unittest.TestCase):\n-\n     layer = PAEvent_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/event/upgrades/configure.zcml b/plone/app/event/upgrades/configure.zcml\nindex a51738675..0d7bc8f96 100644\n--- a/plone/app/event/upgrades/configure.zcml\n+++ b/plone/app/event/upgrades/configure.zcml\n@@ -1,31 +1,32 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:genericsetup="http://namespaces.zope.org/genericsetup">\n+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n+    >\n \n   <genericsetup:upgradeStep\n-      source="12"\n-      destination="13"\n       title="New IRichText behavior"\n       description="Enable the new IRichText instead of the IEventSummary behavior."\n       profile="plone.app.event:default"\n+      source="12"\n+      destination="13"\n       handler=".upgrades.enable_richtext_behavior"\n       />\n \n   <genericsetup:upgradeStep\n-      source="12"\n-      destination="13"\n       title="Attribute storage"\n       description="Migrate fields from annotation storage to attribute storage."\n       profile="plone.app.event:default"\n+      source="12"\n+      destination="13"\n       handler=".upgrades.upgrade_attribute_storage"\n       />\n \n   <genericsetup:upgradeStep\n-      source="14"\n-      destination="15"\n       title="Remove object-action event_listing_settings"\n       description=""\n       profile="plone.app.event:default"\n+      source="14"\n+      destination="15"\n       handler=".upgrades.remove_event_listing_settings"\n       />\n \ndiff --git a/plone/app/event/upgrades/upgrades.py b/plone/app/event/upgrades/upgrades.py\nindex a716af579..44c97bfcb 100644\n--- a/plone/app/event/upgrades/upgrades.py\n+++ b/plone/app/event/upgrades/upgrades.py\n@@ -51,7 +51,7 @@ def upgrade_attribute_storage(context):\n     for result in results:\n         try:\n             event = result.getObject()\n-        except:\n+        except Exception:\n             log.warning(\n                 "Not possible to fetch event object from catalog result for "\n                 "item: {}.".format(result.getPath())\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615de2..9eb73f3c5 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,3 +1,5 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [tool.towncrier]\n filename = "CHANGES.rst"\n directory = "news/"\n@@ -18,3 +20,43 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+[tool.isort]\n+profile = "plone"\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # Zope dependencies\n+  \'Acquisition\', \'DateTime\', \'transaction\', \'zExceptions\', \'ZODB\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.deferredimport\', \'zope.event\',\n+  \'zope.exceptions\', \'zope.globalrequest\', \'zope.i18n\', \'zope.i18nmessageid\',\n+  \'zope.interface\', \'zope.lifecycleevent\', \'zope.location\', \'zope.publisher\',\n+  \'zope.schema\', \'zope.security\', \'zope.site\', \'zope.traversing\', \'AccessControl\',\n+]\n+\'plone.base\' = [\n+  \'AccessControl\', \'Products.BTreeFolder2\', \'Products.CMFCore\',\n+  \'Products.CMFDynamicViewFTI\', \'zope.deprecation\',\n+]\n+python-dateutil = [\'dateutil\']\ndiff --git a/setup.cfg b/setup.cfg\nindex 5032d9206..0da8f8fbc 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,14 +1,23 @@\n-[check-manifest]\n-ignore =\n-    *.cfg\n-    *.sh\n-\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n [bdist_wheel]\n universal = 0\n \n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+[check-manifest]\n+ignore =\n+    .editorconfig\n+    .meta.toml\n+    .pre-commit-config.yaml\n+    tox.ini\ndiff --git a/setup.py b/setup.py\nindex 0995488d6..2bc248b18 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -41,6 +41,7 @@\n     packages=find_packages(),\n     namespace_packages=["plone", "plone.app"],\n     include_package_data=True,\n+    python_requires=">=3.7",\n     zip_safe=False,\n     install_requires=[\n         "setuptools",\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 000000000..59995ab70\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,53 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    format\n+    lint\n+    test\n+\n+[testenv]\n+allowlist_externals =\n+    sh\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies and generate a graph out of them\n+deps =\n+    z3c.dependencychecker==2.11\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    dependencychecker\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,z3c.dependencychecker,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+usedevelop = true\n+constrain_package_deps = true\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+commands =\n+    zope-testrunner --test-path={toxinidir} -s plone.app.event\n+extras =\n+    test\n'

