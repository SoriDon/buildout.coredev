Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2017-01-11T07:16:53Z
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/05ad17fd656f1e02eeb94df9b4e3459551cc9dc7

don't fail on inconsistent catalog

Files changed:
M plone/app/linkintegrity/browser/info.py

diff --git a/plone/app/linkintegrity/browser/info.py b/plone/app/linkintegrity/browser/info.py
index eb10069..1ab93bd 100644
--- a/plone/app/linkintegrity/browser/info.py
+++ b/plone/app/linkintegrity/browser/info.py
@@ -55,7 +55,10 @@ def get_breaches(self, items=None):
             # list of uids that are ignored
             uids_to_ignore.extend([i.UID for i in brains_to_delete])
             for brain_to_delete in brains_to_delete:
-                obj_to_delete = brain_to_delete.getObject()
+                try:
+                    obj_to_delete = brain_to_delete.getObject()
+                except (AttributeError, KeyError):
+                    continue
                 for breach in self.get_breaches_for_item(obj):
                     add_breach = False
                     for source in breach['sources']:
@@ -108,7 +111,10 @@ def get_breaches_for_item(self, obj=None):
         if IFolder.providedBy(obj):
             brains = catalog(path={'query': obj_path})
             for brain in brains:
-                child = brain.getObject()
+                try:
+                    child = brain.getObject()
+                except (AttributeError, KeyError):
+                    continue
                 if child == obj:
                     continue
                 breaches = self.check_object(obj=child, excluded_path=obj_path)


Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2017-02-15T20:23:01Z
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/213d63dda661a389ea2f6770d64d5a2c2a4cda23

Add logging for skip of broken catalog items

Files changed:
M CHANGES.rst
M plone/app/linkintegrity/browser/info.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c93aa95..d0f349a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Show breakage info even if catalog is out of sync
+  [tomgross]
 
 
 3.1 (2016-12-30)
diff --git a/plone/app/linkintegrity/browser/info.py b/plone/app/linkintegrity/browser/info.py
index 1ab93bd..739a2e8 100644
--- a/plone/app/linkintegrity/browser/info.py
+++ b/plone/app/linkintegrity/browser/info.py
@@ -11,6 +11,10 @@
 from plone.app.linkintegrity.utils import linkintegrity_enabled
 from plone.uuid.interfaces import IUUID
 from zope.i18n import translate
+import logging
+
+
+logger = logging.getLogger(__name__)
 
 
 class DeleteConfirmationInfo(BrowserView):
@@ -58,6 +62,7 @@ def get_breaches(self, items=None):
                 try:
                     obj_to_delete = brain_to_delete.getObject()
                 except (AttributeError, KeyError):
+                    logger.excpetion('No object found for %s! Skipping', brain_to_delete)
                     continue
                 for breach in self.get_breaches_for_item(obj):
                     add_breach = False


Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2017-02-16T18:32:23+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/e04ecaa216c269168683eda005d8f749a5c27821

Merge pull request #46 from FHNW/master

Don't fail on inconsistent catalog

Files changed:
M CHANGES.rst
M plone/app/linkintegrity/browser/info.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 859b799..1709fbc 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Show breakage info even if catalog is out of sync
+  [tomgross]
 
 
 3.2.0 (2017-02-12)
diff --git a/plone/app/linkintegrity/browser/info.py b/plone/app/linkintegrity/browser/info.py
index eb10069..739a2e8 100644
--- a/plone/app/linkintegrity/browser/info.py
+++ b/plone/app/linkintegrity/browser/info.py
@@ -11,6 +11,10 @@
 from plone.app.linkintegrity.utils import linkintegrity_enabled
 from plone.uuid.interfaces import IUUID
 from zope.i18n import translate
+import logging
+
+
+logger = logging.getLogger(__name__)
 
 
 class DeleteConfirmationInfo(BrowserView):
@@ -55,7 +59,11 @@ def get_breaches(self, items=None):
             # list of uids that are ignored
             uids_to_ignore.extend([i.UID for i in brains_to_delete])
             for brain_to_delete in brains_to_delete:
-                obj_to_delete = brain_to_delete.getObject()
+                try:
+                    obj_to_delete = brain_to_delete.getObject()
+                except (AttributeError, KeyError):
+                    logger.excpetion('No object found for %s! Skipping', brain_to_delete)
+                    continue
                 for breach in self.get_breaches_for_item(obj):
                     add_breach = False
                     for source in breach['sources']:
@@ -108,7 +116,10 @@ def get_breaches_for_item(self, obj=None):
         if IFolder.providedBy(obj):
             brains = catalog(path={'query': obj_path})
             for brain in brains:
-                child = brain.getObject()
+                try:
+                    child = brain.getObject()
+                except (AttributeError, KeyError):
+                    continue
                 if child == obj:
                     continue
                 breaches = self.check_object(obj=child, excluded_path=obj_path)


