Repository: plone.restapi


Branch: refs/heads/master
Date: 2022-01-05T10:05:03+01:00
Author: Balázs Reé (reebalazs) <ree@greenfinity.hu>
Commit: https://github.com/plone/plone.restapi/commit/6fc315dfb8a9f2f631e20453828cdbd7b29cf637

Be permissive when testing the schema of the querystring endpoint (#1306)

Allow any additional property to be defined by plone.app.querystring,
otherwise no properties can ever be added. The change also makes sure
that all code depending on any existing attributes continues to work.
This is needed in favor of
https://github.com/plone/plone.app.querystring/pull/104 .

Files changed:
A news/1307.feature
M src/plone/restapi/tests/test_services_querystring.py

b'diff --git a/news/1307.feature b/news/1307.feature\nnew file mode 100644\nindex 000000000..13b86a742\n--- /dev/null\n+++ b/news/1307.feature\n@@ -0,0 +1 @@\n+Be permissive when testing the schema of the querystring endpoint [reebalazs]\ndiff --git a/src/plone/restapi/tests/test_services_querystring.py b/src/plone/restapi/tests/test_services_querystring.py\nindex 36289edef..1203ab633 100644\n--- a/src/plone/restapi/tests/test_services_querystring.py\n+++ b/src/plone/restapi/tests/test_services_querystring.py\n@@ -64,7 +64,14 @@ def test_endpoint_shows_field_config(self):\n             "values": {},\n             "vocabulary": None,\n         }\n-        self.assertEqual(expected_field_config, idx)\n+        # Be permissive with the check and only check the existing\n+        # attributes. (This gives plone.app.querystring to extend its schema\n+        # when that becomes necessary, while making sure that all code depending\n+        # on any existing attributes continues to work.)\n+        filtered_idx = {}\n+        for key in expected_field_config:\n+            filtered_idx[key] = idx.get(key, "NOT-FOUND")\n+        self.assertEqual(expected_field_config, filtered_idx)\n \n     def test_endpoint_inlines_vocabularies(self):\n         response = self.api_session.get("/@querystring")\n'

