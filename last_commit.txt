Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2022-03-23T21:16:34+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.multilingual/commit/6562528467512ac91e15c7913b7dab02613a80e7

Connect translations: always set basePath pattern option.

In the supported Plone versions this always works.
The code checked for `mockup` 2.4.0 minimum, which is used since Plone 5.1.
But in Plone 6.0 on ES `mockup` is no longer a Python package.

Files changed:
A news/6.bugfix
M src/plone/app/multilingual/browser/interfaces.py

b'diff --git a/news/6.bugfix b/news/6.bugfix\nnew file mode 100644\nindex 00000000..00563889\n--- /dev/null\n+++ b/news/6.bugfix\n@@ -0,0 +1,3 @@\n+Connect translations: always set basePath pattern option.\n+In the supported Plone versions this always works.\n+[maurits]\ndiff --git a/src/plone/app/multilingual/browser/interfaces.py b/src/plone/app/multilingual/browser/interfaces.py\nindex b42c4407..3f5391ea 100644\n--- a/src/plone/app/multilingual/browser/interfaces.py\n+++ b/src/plone/app/multilingual/browser/interfaces.py\n@@ -15,18 +15,6 @@\n from zope.interface import provider\n from zope.schema.interfaces import IContextAwareDefaultFactory\n \n-import pkg_resources\n-\n-\n-HAS_MOCKUP_240 = False\n-try:\n-    pkg_mockup = pkg_resources.get_distribution("mockup")\n-    HAS_MOCKUP_240 = pkg_mockup.parsed_version >= pkg_resources.parse_version(\n-        "2.4.0"\n-    )  # noqa\n-except pkg_resources.DistributionNotFound:\n-    pass\n-\n \n def make_relation_root_path(context):\n     ctx = getSite()\n@@ -86,15 +74,13 @@ class IConnectTranslation(model.Schema):\n         vocabulary="plone.app.multilingual.RootCatalog",\n         required=True,\n     )\n-\n-    if HAS_MOCKUP_240:\n-        directives.widget(\n-            "content",\n-            RelatedItemsFieldWidget,\n-            pattern_options={\n-                "basePath": make_relation_root_path,\n-            },\n-        )\n+    directives.widget(\n+        \'content\',\n+        RelatedItemsFieldWidget,\n+        pattern_options={\n+            \'basePath\': make_relation_root_path,\n+        }\n+    )\n \n \n interface.alsoProvides(IUpdateLanguage, IFormFieldProvider)\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2022-03-23T21:16:35+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.multilingual/commit/c4cfd4184467d2a0ca6d187c6b7e3217b56e0186

Fixed robot test for adding a translation.

Files changed:
M src/plone/app/multilingual/tests/robot/test_add_translation.robot

b'diff --git a/src/plone/app/multilingual/tests/robot/test_add_translation.robot b/src/plone/app/multilingual/tests/robot/test_add_translation.robot\nindex 01908b40..09f59f9e 100644\n--- a/src/plone/app/multilingual/tests/robot/test_add_translation.robot\n+++ b/src/plone/app/multilingual/tests/robot/test_add_translation.robot\n@@ -72,8 +72,10 @@ I link the document in English as a translation\n   Wait until element is visible  xpath=(//span[contains(., \'An English Document\')])\n   Click Element  xpath=(//span[contains(., \'An English Document\')])\n   Wait until page contains  An English Document\n-  \n-  Click Element  xpath=(//*[contains(@class, \'plone-modal-footer\')]//button[@id=\'form-buttons-connect_translation\'])\n+\n+  # We need a complicated xpath, because for some reason a button with this id is there twice.\n+  # The first one is hidden.\n+  Click Element  xpath=(//*[contains(@class, \'modal-footer\')]//button[@id=\'form-buttons-connect_translation\'])\n   Wait until page contains element  xpath=(//h3[@class="translationTitle"])\n   Sleep  5\n   Wait until element is visible  xpath=(//h3[@class="translationTitle"])\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2022-03-24T11:09:07+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/b42f4e10043b5174702ece8e1663aa7ee668836a

Fix robot test to reflect change in Mockup ES6 where relateditems widget default mode was changed from "auto" to "browse".

Files changed:
M src/plone/app/multilingual/tests/robot/test_add_translation.robot

b"diff --git a/src/plone/app/multilingual/tests/robot/test_add_translation.robot b/src/plone/app/multilingual/tests/robot/test_add_translation.robot\nindex 09f59f9e..63a5bb43 100644\n--- a/src/plone/app/multilingual/tests/robot/test_add_translation.robot\n+++ b/src/plone/app/multilingual/tests/robot/test_add_translation.robot\n@@ -67,6 +67,7 @@ I link the document in English as a translation\n   Click Element  css=#translations-overview .connectTranslationAction\n   Wait until page contains element  css=.select2-choices\n   Wait until element is visible  css=.select2-choices\n+  Click Element  css=#formfield-form-widgets-content .pat-relateditems-container button.mode.search\n   Input Text  css=#formfield-form-widgets-content .select2-input  en\n   Wait until page contains element  xpath=(//span[contains(., 'An English Document')])\n   Wait until element is visible  xpath=(//span[contains(., 'An English Document')])\n"

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2022-03-24T15:23:02+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/e98102f4d68ff48ab62083aacc2749aa9e1ff12a

Merge pull request #395 from plone/es6

Fix connection translations on ES6

Files changed:
A news/6.bugfix
M src/plone/app/multilingual/browser/interfaces.py
M src/plone/app/multilingual/tests/robot/test_add_translation.robot

b'diff --git a/news/6.bugfix b/news/6.bugfix\nnew file mode 100644\nindex 00000000..00563889\n--- /dev/null\n+++ b/news/6.bugfix\n@@ -0,0 +1,3 @@\n+Connect translations: always set basePath pattern option.\n+In the supported Plone versions this always works.\n+[maurits]\ndiff --git a/src/plone/app/multilingual/browser/interfaces.py b/src/plone/app/multilingual/browser/interfaces.py\nindex b42c4407..3f5391ea 100644\n--- a/src/plone/app/multilingual/browser/interfaces.py\n+++ b/src/plone/app/multilingual/browser/interfaces.py\n@@ -15,18 +15,6 @@\n from zope.interface import provider\n from zope.schema.interfaces import IContextAwareDefaultFactory\n \n-import pkg_resources\n-\n-\n-HAS_MOCKUP_240 = False\n-try:\n-    pkg_mockup = pkg_resources.get_distribution("mockup")\n-    HAS_MOCKUP_240 = pkg_mockup.parsed_version >= pkg_resources.parse_version(\n-        "2.4.0"\n-    )  # noqa\n-except pkg_resources.DistributionNotFound:\n-    pass\n-\n \n def make_relation_root_path(context):\n     ctx = getSite()\n@@ -86,15 +74,13 @@ class IConnectTranslation(model.Schema):\n         vocabulary="plone.app.multilingual.RootCatalog",\n         required=True,\n     )\n-\n-    if HAS_MOCKUP_240:\n-        directives.widget(\n-            "content",\n-            RelatedItemsFieldWidget,\n-            pattern_options={\n-                "basePath": make_relation_root_path,\n-            },\n-        )\n+    directives.widget(\n+        \'content\',\n+        RelatedItemsFieldWidget,\n+        pattern_options={\n+            \'basePath\': make_relation_root_path,\n+        }\n+    )\n \n \n interface.alsoProvides(IUpdateLanguage, IFormFieldProvider)\ndiff --git a/src/plone/app/multilingual/tests/robot/test_add_translation.robot b/src/plone/app/multilingual/tests/robot/test_add_translation.robot\nindex 01908b40..63a5bb43 100644\n--- a/src/plone/app/multilingual/tests/robot/test_add_translation.robot\n+++ b/src/plone/app/multilingual/tests/robot/test_add_translation.robot\n@@ -67,13 +67,16 @@ I link the document in English as a translation\n   Click Element  css=#translations-overview .connectTranslationAction\n   Wait until page contains element  css=.select2-choices\n   Wait until element is visible  css=.select2-choices\n+  Click Element  css=#formfield-form-widgets-content .pat-relateditems-container button.mode.search\n   Input Text  css=#formfield-form-widgets-content .select2-input  en\n   Wait until page contains element  xpath=(//span[contains(., \'An English Document\')])\n   Wait until element is visible  xpath=(//span[contains(., \'An English Document\')])\n   Click Element  xpath=(//span[contains(., \'An English Document\')])\n   Wait until page contains  An English Document\n-  \n-  Click Element  xpath=(//*[contains(@class, \'plone-modal-footer\')]//button[@id=\'form-buttons-connect_translation\'])\n+\n+  # We need a complicated xpath, because for some reason a button with this id is there twice.\n+  # The first one is hidden.\n+  Click Element  xpath=(//*[contains(@class, \'modal-footer\')]//button[@id=\'form-buttons-connect_translation\'])\n   Wait until page contains element  xpath=(//h3[@class="translationTitle"])\n   Sleep  5\n   Wait until element is visible  xpath=(//h3[@class="translationTitle"])\n'

