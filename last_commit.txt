Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2018-08-09T12:34:01-03:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/0c9d9cf0c14500b1f13dc7e3254f9520e0c466f8

move leftovers from controlpanel over here (#2495)

Files changed:
A Products/CMFPlone/controlpanel/permissions.zcml
M CHANGES.rst
M Products/CMFPlone/configure.zcml
M Products/CMFPlone/controlpanel/configure.zcml
M Products/CMFPlone/interfaces/controlpanel.py
M setup.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex cf16b316a..18c9158e8 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,6 +10,11 @@ Changelog\n \n Breaking changes:\n \n+- Remove all dependencies on plone.app.controlpanel. \n+  Third party code need either to depend on plone.app.controlpanel 4.0,\n+  which is a backward compatibilit package only, or also update to not depend on it anymore.\n+  [jensens]\n+\n - New browser view based login code - merged from plone.login (credits to esteele, pbauer, agitator, jensens, et al).\n   `portal_skins/plone_login` is now gone, see PLIP #2092.\n   Also, password reset view moved to login subfolder to keep things together.\ndiff --git a/Products/CMFPlone/configure.zcml b/Products/CMFPlone/configure.zcml\nindex 3a15caf27..0cdd0666a 100644\n--- a/Products/CMFPlone/configure.zcml\n+++ b/Products/CMFPlone/configure.zcml\n@@ -12,7 +12,6 @@\n   <include package="plone.app.content" />\n   <include package="plone.app.contentrules" />\n   <include package="plone.app.contenttypes" />\n-  <include package="plone.app.controlpanel" />\n   <include package="plone.app.customerize" />\n   <include package="plone.app.discussion" />\n   <include package="plone.app.folder" />\ndiff --git a/Products/CMFPlone/controlpanel/configure.zcml b/Products/CMFPlone/controlpanel/configure.zcml\nindex 93d5b4998..86f75133c 100644\n--- a/Products/CMFPlone/controlpanel/configure.zcml\n+++ b/Products/CMFPlone/controlpanel/configure.zcml\n@@ -8,5 +8,6 @@\n   <include package=".browser" />\n \n   <include file="events.zcml" />\n+  <include file="permissions.zcml" />\n \n </configure>\ndiff --git a/Products/CMFPlone/controlpanel/permissions.zcml b/Products/CMFPlone/controlpanel/permissions.zcml\nnew file mode 100644\nindex 000000000..7c128c130\n--- /dev/null\n+++ b/Products/CMFPlone/controlpanel/permissions.zcml\n@@ -0,0 +1,82 @@\n+<configure\n+    xmlns="http://namespaces.zope.org/zope">\n+\n+  <permission id="plone.app.controlpanel.Overview"\n+              title="Plone Site Setup: Overview">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.Editing"\n+              title="Plone Site Setup: Editing">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.Filtering"\n+              title="Plone Site Setup: Filtering">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.Language"\n+              title="Plone Site Setup: Language">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.Mail"\n+              title="Plone Site Setup: Mail">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.Markup"\n+              title="Plone Site Setup: Markup">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.Navigation"\n+              title="Plone Site Setup: Navigation">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.Search"\n+              title="Plone Site Setup: Search">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.Security"\n+              title="Plone Site Setup: Security">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.Site"\n+              title="Plone Site Setup: Site">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.Themes"\n+              title="Plone Site Setup: Themes">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.Types"\n+              title="Plone Site Setup: Types">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+  <permission id="plone.app.controlpanel.UsersAndGroups"\n+              title="Plone Site Setup: Users and Groups">\n+    <role name="Manager"/>\n+    <role name="Site Administrator"/>\n+  </permission>\n+\n+</configure>\ndiff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py\nindex d8fdac74d..b3359b94c 100644\n--- a/Products/CMFPlone/interfaces/controlpanel.py\n+++ b/Products/CMFPlone/interfaces/controlpanel.py\n@@ -4,6 +4,7 @@\n from Products.CMFPlone._compat import dump_json_to_text\n from Products.CMFPlone.interfaces.basetool import IPloneBaseTool\n from zope import schema\n+from zope.interface import Attribute\n from zope.interface import implementer\n from zope.interface import Interface\n from zope.interface import Invalid\n@@ -1788,3 +1789,31 @@ class INewActionSchema(Interface):\n     id = schema.ASCIILine(\n         title=_(u\'Id\'),\n         required=True)\n+\n+\n+class IPloneControlPanelView(Interface):\n+    """A marker interface for views showing a controlpanel.\n+    """\n+\n+\n+class IPloneControlPanelForm(IPloneControlPanelView):\n+    """Forms using plone.app.controlpanel\n+    """\n+\n+    def _on_save():\n+        """Callback mehod which can be implemented by control panels to\n+        react when the form is successfully saved. This avoids the need\n+        to re-define actions only to do some additional notification or\n+        configuration which cannot be handled by the normal schema adapter.\n+\n+        By default, does nothing.\n+        """\n+\n+\n+class IConfigurationChangedEvent(Interface):\n+    """An event which is fired after a configuration setting has been changed.\n+    """\n+\n+    context = Attribute("The configuration context which was changed.")\n+\n+    data = Attribute("The configuration data which was changed.")\ndiff --git a/setup.py b/setup.py\nindex 9c75e907b..21bf1349d 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -45,7 +45,6 @@\n     \'plone.app.contentmenu >= 1.1.6dev-r22380\',\n     \'plone.app.contentrules\',\n     \'plone.app.contenttypes\',\n-    \'plone.app.controlpanel\',\n     \'plone.app.customerize\',\n     \'plone.app.dexterity\',\n     \'plone.app.discussion\',\n'

