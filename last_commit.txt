Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2019-06-21T11:28:56+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/2290bc2fd2cb11e75a50f50909e89df72cde07cc

fixes plone/Products.CMFPlone#2885

Files changed:
A news/105.bugfix
M plone/app/z3cform/converters.py

b'diff --git a/news/105.bugfix b/news/105.bugfix\nnew file mode 100644\nindex 0000000..110cebc\n--- /dev/null\n+++ b/news/105.bugfix\n@@ -0,0 +1,2 @@\n+- Fixes: Keywords broken plone/Products.CMFPlone#2885\n+  [jensens]\ndiff --git a/plone/app/z3cform/converters.py b/plone/app/z3cform/converters.py\nindex 18eaf8d..c74a93e 100644\n--- a/plone/app/z3cform/converters.py\n+++ b/plone/app/z3cform/converters.py\n@@ -211,14 +211,16 @@ def toFieldValue(self, value):\n             if vocabulary is not None:\n                 try:\n                     term = vocabulary.getTermByToken(token)\n-                    untokenized_value.append(term.value)\n+                    if valueType:\n+                        untokenized_value.append(valueType(term.value))\n+                    else:\n+                        untokenized_value.append(term.value)\n                     continue\n                 except LookupError:\n                     pass\n             untokenized_value.append(\n                 valueType(token) if valueType else token,\n             )\n-\n         return collectionType(untokenized_value)\n \n \n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2019-06-21T15:08:41+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/2ff9480ef501b9f66fa9da2d8c6b97bff9df4914

Merge pull request #105 from plone/fix-CMFPlone-2885-keywordadding

fixes plone/Products.CMFPlone#2885

Files changed:
A news/105.bugfix
M plone/app/z3cform/converters.py

b'diff --git a/news/105.bugfix b/news/105.bugfix\nnew file mode 100644\nindex 0000000..110cebc\n--- /dev/null\n+++ b/news/105.bugfix\n@@ -0,0 +1,2 @@\n+- Fixes: Keywords broken plone/Products.CMFPlone#2885\n+  [jensens]\ndiff --git a/plone/app/z3cform/converters.py b/plone/app/z3cform/converters.py\nindex 18eaf8d..c74a93e 100644\n--- a/plone/app/z3cform/converters.py\n+++ b/plone/app/z3cform/converters.py\n@@ -211,14 +211,16 @@ def toFieldValue(self, value):\n             if vocabulary is not None:\n                 try:\n                     term = vocabulary.getTermByToken(token)\n-                    untokenized_value.append(term.value)\n+                    if valueType:\n+                        untokenized_value.append(valueType(term.value))\n+                    else:\n+                        untokenized_value.append(term.value)\n                     continue\n                 except LookupError:\n                     pass\n             untokenized_value.append(\n                 valueType(token) if valueType else token,\n             )\n-\n         return collectionType(untokenized_value)\n \n \n'

